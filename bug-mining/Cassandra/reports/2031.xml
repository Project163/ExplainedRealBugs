<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:37:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-5196] IllegalStateException thrown when running new installation with old data directories</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-5196</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;If you install 1.2.1 when there are existing data directories, the scrub operation fails, throwing this exception:&lt;/p&gt;

&lt;p&gt;ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2013-01-29 15:05:06,564 FileUtils.java (line 373) Stopping the gossiper and the RPC server&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2013-01-29 15:05:06,564 CassandraDaemon.java (line 387) Exception encountered during startup&lt;br/&gt;
java.lang.IllegalStateException: No configured daemon&lt;br/&gt;
	at org.apache.cassandra.service.StorageService.stopRPCServer(StorageService.java:314)&lt;br/&gt;
	at org.apache.cassandra.io.util.FileUtils.handleFSError(FileUtils.java:375)&lt;br/&gt;
	at org.apache.cassandra.db.Directories.&amp;lt;init&amp;gt;(Directories.java:113)&lt;br/&gt;
	at org.apache.cassandra.db.Directories.create(Directories.java:91)&lt;br/&gt;
	at org.apache.cassandra.db.ColumnFamilyStore.scrubDataDirectories(ColumnFamilyStore.java:403)&lt;br/&gt;
	at org.apache.cassandra.service.CassandraDaemon.setup(CassandraDaemon.java:174)&lt;br/&gt;
	at org.apache.cassandra.service.CassandraDaemon.activate(CassandraDaemon.java:370)&lt;br/&gt;
	at org.apache.cassandra.service.CassandraDaemon.main(CassandraDaemon.java:413)&lt;/p&gt;

&lt;p&gt;This condition should produce a more reasonable exception.&lt;/p&gt;</description>
                <environment>&lt;p&gt;CentOS 5.5&lt;/p&gt;</environment>
        <key id="12629800">CASSANDRA-5196</key>
            <summary>IllegalStateException thrown when running new installation with old data directories</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aleksey">Aleksey Yeschenko</assignee>
                                    <reporter username="rstrickland">Robert Strickland</reporter>
                        <labels>
                    </labels>
                <created>Tue, 29 Jan 2013 21:51:33 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:18 +0000</updated>
                            <resolved>Tue, 5 Feb 2013 23:43:39 +0000</resolved>
                                        <fixVersion>1.2.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13568236" author="iamaleksey" created="Thu, 31 Jan 2013 23:22:15 +0000"  >&lt;p&gt;The exception is thrown by this method:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    public static void createDirectory(File directory)
    {
        if (!directory.exists())
        {
            if (!directory.mkdirs())
                throw new FSWriteError(new IOException(&quot;Failed to mkdirs &quot; + directory), directory);
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So it seems like the directory didn&apos;t exist, it tried to create one, but failed (I assume it had something to do with permissions).&lt;/p&gt;

&lt;p&gt;Can&apos;t reproduce. Can you, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rstrickland&quot; class=&quot;user-hover&quot; rel=&quot;rstrickland&quot;&gt;rstrickland&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="13570444" author="iamaleksey" created="Mon, 4 Feb 2013 17:52:44 +0000"  >&lt;p&gt;Pretty sure this particular issue was caused by not having enough permissions to create the directories. Please reopen if that&apos;s not the case and you can reproduce.&lt;/p&gt;</comment>
                            <comment id="13570914" author="haifeng" created="Tue, 5 Feb 2013 03:27:44 +0000"  >&lt;p&gt;Issue reproduced on my machine.&lt;br/&gt;
Environment:&lt;br/&gt;
Redhat Linux, Cassandra 1.2.1 unzipped to a NFS mounted folder (/mnt/storage/cassandra). &lt;br/&gt;
Create data/commitlog folder manually in the NFS folder(mkdir -p /mnt/storage/cassandra/data, mkdir -p /mnt/storage/cassandra/commitlog).&lt;br/&gt;
config file updated.&lt;br/&gt;
Start Cassandra, &quot;bin/cassandra -f&quot;, same error found.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt; INFO 22:15:06,283 Found table data in data directories. Consider using the CLI to define your schema.&lt;br/&gt;
ERROR 22:15:06,495 Stopping the gossiper and the RPC server&lt;br/&gt;
ERROR 22:15:06,505 Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;OptionalTasks:1,5,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.IllegalStateException: No configured daemon&lt;br/&gt;
        at org.apache.cassandra.service.StorageService.stopRPCServer(StorageService.java:314)&lt;br/&gt;
        at org.apache.cassandra.io.util.FileUtils.handleFSError(FileUtils.java:375)&lt;br/&gt;
        at org.apache.cassandra.db.Directories.&amp;lt;init&amp;gt;(Directories.java:113)&lt;br/&gt;
        at org.apache.cassandra.db.Directories.create(Directories.java:91)&lt;br/&gt;
        at org.apache.cassandra.db.ColumnFamilyStore.createColumnFamilyStore(ColumnFamilyStore.java:379)&lt;br/&gt;
        at org.apache.cassandra.db.ColumnFamilyStore.createColumnFamilyStore(ColumnFamilyStore.java:364)&lt;br/&gt;
        at org.apache.cassandra.db.Table.initCf(Table.java:337)&lt;br/&gt;
        at org.apache.cassandra.db.Table.&amp;lt;init&amp;gt;(Table.java:280)&lt;br/&gt;
        at org.apache.cassandra.db.Table.open(Table.java:110)&lt;br/&gt;
        at org.apache.cassandra.db.Table.open(Table.java:88)&lt;br/&gt;
        at org.apache.cassandra.db.Table$1.apply(Table.java:82)&lt;br/&gt;
        at org.apache.cassandra.db.Table$1.apply(Table.java:79)&lt;br/&gt;
        at com.google.common.collect.Iterators$9.transform(Iterators.java:893)&lt;br/&gt;
        at com.google.common.collect.TransformedIterator.next(TransformedIterator.java:48)&lt;br/&gt;
        at org.apache.cassandra.db.ColumnFamilyStore.all(ColumnFamilyStore.java:1664)&lt;br/&gt;
        at org.apache.cassandra.db.MeteredFlusher.countFlushingBytes(MeteredFlusher.java:114)&lt;br/&gt;
        at org.apache.cassandra.db.MeteredFlusher.run(MeteredFlusher.java:41)&lt;br/&gt;
        at org.apache.cassandra.concurrent.DebuggableScheduledThreadPoolExecutor$UncomplainingRunnable.run(DebuggableScheduledThreadPoolExecutor.java:75)&lt;br/&gt;
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerRunAndReset(FutureTask.java:351)&lt;br/&gt;
        at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:178)&lt;br/&gt;
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:178)&lt;br/&gt;
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:722)&lt;br/&gt;
 INFO 22:15:06,560 No commitlog files found; skipping replay&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Remove above folders(data/commitlog) and restart Cannandra, issue resolved.&lt;/p&gt;</comment>
                            <comment id="13570919" author="iamaleksey" created="Tue, 5 Feb 2013 03:34:23 +0000"  >&lt;p&gt;What OS user was used when you created the /mnt/storage/cassandra/data directory? Did you use sudo? Did you run bin/cassandra -f as the same user? &lt;/p&gt;</comment>
                            <comment id="13570922" author="haifeng" created="Tue, 5 Feb 2013 03:42:20 +0000"  >&lt;p&gt;RHEL 6.2, 64bit.&lt;br/&gt;
All operations were done by root user.&lt;br/&gt;
/mnt/storage/cassandra not removed. data and commitlog folders removed.&lt;/p&gt;
&lt;blockquote&gt;

&lt;p&gt;drwxr-xr-x 4 root root      4096 Feb  4 22:18 cassandra&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="13571027" author="iamaleksey" created="Tue, 5 Feb 2013 04:20:38 +0000"  >&lt;p&gt;For some reason Java fails to create the directories. Or at least directory.mkdirs() call returns false. Unfortunately Java&apos;s file api won&apos;t give you any details, other than it thinks it failed - I don&apos;t see what we can do about those cases.&lt;/p&gt;

&lt;p&gt;I&apos;d like you to try one other thing, though.&lt;/p&gt;

&lt;p&gt;remove /mnt/storage/cassandra/data&lt;/p&gt;

&lt;p&gt;Start Cassandra (if I&apos;m reading you comment right - it should start fine).&lt;/p&gt;

&lt;p&gt;Stop Cassandra. Remove /mnt/storage/cassandra/data/* - all the sstable directories inside data, but NOT /mnt/storage/cassandra/data/ itself. Then start Cassandra again ant tell me if it works all right or fails as if you created it manually. Thanks. &lt;/p&gt;</comment>
                            <comment id="13571084" author="haifeng" created="Tue, 5 Feb 2013 06:24:58 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Stop Cassandra. Remove /mnt/storage/cassandra/data/* - all the sstable directories inside data, but NOT /mnt/storage/cassandra/data/ itself. Then start Cassandra again ant tell me if it works all right or fails as if you created it manually. Thanks.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Run Cassandra successfully, then stop it, remove &quot;/mnt/storage/cassandra/data/*&quot; and run Cassandra again, the Cassandra started without error.&lt;/p&gt;

&lt;p&gt;Then I did following test, no error found.&lt;br/&gt;
Remove all folders/files under /mnt/storage/cassandra/, create data folder manually, start Cassandra. &lt;/p&gt;
</comment>
                            <comment id="13571318" author="rstrickland" created="Tue, 5 Feb 2013 14:07:05 +0000"  >&lt;p&gt;In my case the directories were owned by &quot;cassandra&quot; and the service was started as &quot;cassandra&quot; using init.  Even starting as root resulted in the same failure.  Only deleting the directories entirely resolved the issue.  This worked in my case because it was an old installation and I didn&apos;t need the data, but it took me a while to figure this out since the exception was so misleading.&lt;/p&gt;</comment>
                            <comment id="13571717" author="iamaleksey" created="Tue, 5 Feb 2013 20:55:45 +0000"  >&lt;p&gt;While I don&apos;t think we can fix the directory creation itself in these cases, we can and should make failure handling user-friendlier. The attached patch changes the following things:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;doesn&apos;t attempt to stop RPC if it&apos;s not already started - gets rid of the non-obvious IllegalStateException&lt;/li&gt;
	&lt;li&gt;separately logs directory creation failure&lt;/li&gt;
	&lt;li&gt;stops native protocol as well if disk_failure_policy is &apos;stop&apos;&lt;/li&gt;
	&lt;li&gt;reduces log-spam when we fail to create multiple directories&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13571881" author="brandon.williams" created="Tue, 5 Feb 2013 23:16:26 +0000"  >&lt;p&gt;+1 on the patch, but I don&apos;t understand what the directory creation problem is in the case of it existing as user X, but then even running as root we raise an error.&lt;/p&gt;</comment>
                            <comment id="13571888" author="iamaleksey" created="Tue, 5 Feb 2013 23:20:32 +0000"  >&lt;blockquote&gt;&lt;p&gt;but I don&apos;t understand what the directory creation problem is in the case of it existing as user X, but then even running as root we raise an error.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t understand either - and I can&apos;t reproduce it (I tried).&lt;/p&gt;</comment>
                            <comment id="13571915" author="brandon.williams" created="Tue, 5 Feb 2013 23:33:28 +0000"  >&lt;p&gt;We can take a closer with the patch in place if it happens again.&lt;/p&gt;</comment>
                            <comment id="13571930" author="iamaleksey" created="Tue, 5 Feb 2013 23:43:22 +0000"  >&lt;p&gt;Yep. Committed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12568084" name="5196.txt" size="2051" author="aleksey" created="Tue, 5 Feb 2013 20:52:10 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>310296</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 41 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1hjun:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>310641</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>brandon.williams</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>