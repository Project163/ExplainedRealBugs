<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:29:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-19001] Check whether the startup warnings for unknown modules represent a legit problem or cosmetic issue</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-19001</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;During the 5.0 alpha 2 release &lt;a href=&quot;https://lists.apache.org/thread/lt3x0obr5cpbcydf5490pj6b2q0mz5zr&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;vote&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=paulo&quot; class=&quot;user-hover&quot; rel=&quot;paulo&quot;&gt;paulo&lt;/a&gt; raised the following concerns:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Launched a tarball-based 5.0-alpha2 container on top of
&lt;span class=&quot;code-quote&quot;&gt;&quot;eclipse-temurin:17-jre-focal&quot;&lt;/span&gt; and the server starts up fine, can run
nodetool and cqlsh.
I got these seemingly harmless JDK17 warnings during startup and when
running nodetool (no warnings on JDK11):
WARNING: Unknown module: jdk.attach specified to --add-exports
WARNING: Unknown module: jdk.compiler specified to --add-exports
WARNING: Unknown module: jdk.compiler specified to --add-opens
WARNING: A terminally deprecated method in java.lang.&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt; has been called
WARNING: &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;::setSecurityManager has been called by
org.apache.cassandra.security.ThreadAwareSecurityManager
(file:/opt/cassandra/lib/apache-cassandra-5.0-alpha2-SNAPSHOT.jar)
WARNING: Please consider reporting &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; to the maintainers of
org.apache.cassandra.security.ThreadAwareSecurityManager
WARNING: &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;::setSecurityManager will be removed in a &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; release
Anybody knows &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; these warnings are legit/expected ? We can create
follow-up tickets &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; needed.
$ java --version
openjdk 17.0.9 2023-10-17
OpenJDK &lt;span class=&quot;code-object&quot;&gt;Runtime&lt;/span&gt; Environment Temurin-17.0.9+9 (build 17.0.9+9)
OpenJDK 64-Bit Server VM Temurin-17.0.9+9 (build 17.0.9+9, mixed mode,
sharing)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Clarification: - When running nodetool only the &lt;span class=&quot;code-quote&quot;&gt;&quot;Unknown module&quot;&lt;/span&gt; warnings show up. All warnings show up during startup.&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We need to verify whether this presents a real problem in the features where those modules are expected to be used, or if it is a false alarm.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13556787">CASSANDRA-19001</key>
            <summary>Check whether the startup warnings for unknown modules represent a legit problem or cosmetic issue</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="edimitrova">Ekaterina Dimitrova</assignee>
                                    <reporter username="edimitrova">Ekaterina Dimitrova</reporter>
                        <labels>
                    </labels>
                <created>Sat, 4 Nov 2023 17:46:24 +0000</created>
                <updated>Fri, 10 Oct 2025 08:47:57 +0000</updated>
                            <resolved>Mon, 22 Jan 2024 16:30:07 +0000</resolved>
                                        <fixVersion>5.0-rc1</fixVersion>
                    <fixVersion>5.0</fixVersion>
                    <fixVersion>5.1</fixVersion>
                                    <component>Local/Other</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1800">0.5h</timespent>
                                <comments>
                            <comment id="17782914" author="edimitrova" created="Sat, 4 Nov 2023 17:50:30 +0000"  >&lt;p&gt;Related information, mentioned also in the release vote thread:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#160;Hi Paulo,

Thank you &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; testing and &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; raising the issue!
I can confirm I &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; not use the same JDK as you, and I did not see any
warnings on my machine on startup or when calling nodetool commands.

I believe on a quick check that jdk.attach was needed &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; nodetool sjk. (It
was mentioned on CASSANDRA-16895 at least)
About jdk.compiler - it was added as per &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; recommendation &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; chronicle
https:&lt;span class=&quot;code-comment&quot;&gt;//chronicle.software/chronicle-support-java-17/
&lt;/span&gt;
I &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; not believe we test with the mentioned JDK in CI, so additional
testing will be required to figure out things better.

As &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is alpha release - can we open a ticket to be resolved in the
next alpha/beta? It is up to PMC to decide, of course. Also, we need a bit
more investigation here. I can &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; to take a look tomorrow in more
detail &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; no one beats me to that.

Best regards,
Ekaterina&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
I am sorry, I totally forgot to address your other concern, Paulo. The
security manager is marked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; deprecation in JDK 17. So &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; warning is to
stress to people they need to take care of a replacement, sooner than
later. I believe we have somewhere an unassigned ticket in Open status to
address &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; topic.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17782919" author="edimitrova" created="Sat, 4 Nov 2023 18:41:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=paulo&quot; class=&quot;user-hover&quot; rel=&quot;paulo&quot;&gt;paulo&lt;/a&gt; , when you have time, please tell me what your JAVA_HOME points to.&#160;&lt;br/&gt;
Also, can you share with me the output of running:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
bin/nodetool sjk hh -n 10 --live &#160;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Thank you in advance.&lt;/p&gt;</comment>
                            <comment id="17782920" author="edimitrova" created="Sat, 4 Nov 2023 18:59:30 +0000"  >&lt;p&gt;I managed to reproduce your issue when I used JRE temurin-17.jre,&#160;&lt;/p&gt;

&lt;p&gt;17.0.9 (arm64) &quot;Eclipse Adoptium&quot; - &quot;OpenJDK 17.0.9&quot;:&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
bin/nodetool sjk hh -n 10 --live&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;
WARNING: Unknown module: jdk.attach specified to --add-exports
WARNING: Unknown module: jdk.compiler specified to --add-exports
WARNING: Unknown module: jdk.compiler specified to --add-opens
ERROR 14:29:47,480 Java home points to /Library/Java/JavaVirtualMachines/temurin-17.jre/Contents/Home make sure it is not a JRE path
ERROR 14:29:47,481 Failed to add tools.jar to classpath
java.lang.ClassNotFoundException: com.sun.tools.attach.VirtualMachine
 at java.base/jdk.internal.loader.BuiltinClassLoader.loadClass(Unknown Source)
 at java.base/jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass(Unknown Source)
 at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(Unknown Source)
 at org.gridkit.lab.jvm.attach.AttachAPI.&amp;lt;clinit&amp;gt;(AttachAPI.java:52)
 at org.gridkit.lab.jvm.attach.AttachManager.&amp;lt;clinit&amp;gt;(AttachManager.java:75)
 at org.gridkit.lab.jvm.attach.HeapHisto.getHistoLive(HeapHisto.java:40)
 at org.gridkit.jvmtool.cmd.HeapHistoCmd$Histo.run(HeapHistoCmd.java:97)
 at org.apache.cassandra.tools.nodetool.Sjk$Wrapper.run(Sjk.java:219)
 at org.apache.cassandra.tools.nodetool.Sjk.execute(Sjk.java:101)
 at org.apache.cassandra.tools.NodeTool$NodeToolCmd.runInternal(NodeTool.java:383)
 at org.apache.cassandra.tools.nodetool.Sjk.runInternal(Sjk.java:88)
 at org.apache.cassandra.tools.NodeTool$NodeToolCmd.run(NodeTool.java:368)
 at org.apache.cassandra.tools.NodeTool.execute(NodeTool.java:267)
 at org.apache.cassandra.tools.NodeTool.main(NodeTool.java:85)
java.lang.RuntimeException: java.util.concurrent.ExecutionException: java.lang.NoClassDefFoundError: com/sun/tools/attach/VirtualMachine
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Also, I saw the startup warnings.&lt;br/&gt;
I am more worried about chronicle as it might affect Audit Logging, and we depend on the library. We need to investigate further. We may be ok without that module for our usage, or chronicle has an updated release... To be investigated...&lt;/p&gt;</comment>
                            <comment id="17782924" author="edimitrova" created="Sat, 4 Nov 2023 19:56:47 +0000"  >&lt;p&gt;Stepping back for a bit... those internals are also used with JDK11, the modules were explicitly closed only after Java 11. Thus, we use the add-exports, add-opens, and that triggers the annoying warnings, etc.&lt;br/&gt;
I get the same result if I trigger the same command with JRE11:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#160;bin/nodetool sjk hh -n 10 --live &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;
ERROR 15:45:25,632 Java home points to /Library/Java/JavaVirtualMachines/temurin-11.jre/Contents/Home make sure it is not a JRE path
ERROR 15:45:25,634 Failed to add tools.jar to classpath
java.lang.ClassNotFoundException: com.sun.tools.attach.VirtualMachine
 at java.base/jdk.internal.loader.BuiltinClassLoader.loadClass(Unknown Source)
 at java.base/jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass(Unknown Source)
 at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(Unknown Source)
 at org.gridkit.lab.jvm.attach.AttachAPI.&amp;lt;clinit&amp;gt;(AttachAPI.java:52)
 at org.gridkit.lab.jvm.attach.AttachManager.&amp;lt;clinit&amp;gt;(AttachManager.java:75)
 at org.gridkit.lab.jvm.attach.HeapHisto.getHistoLive(HeapHisto.java:40)
 at org.gridkit.jvmtool.cmd.HeapHistoCmd$Histo.run(HeapHistoCmd.java:97)
 at org.apache.cassandra.tools.nodetool.Sjk$Wrapper.run(Sjk.java:219)
 at org.apache.cassandra.tools.nodetool.Sjk.execute(Sjk.java:101)
 at org.apache.cassandra.tools.NodeTool$NodeToolCmd.runInternal(NodeTool.java:383)
 at org.apache.cassandra.tools.nodetool.Sjk.runInternal(Sjk.java:88)
 at org.apache.cassandra.tools.NodeTool$NodeToolCmd.run(NodeTool.java:368)
 at org.apache.cassandra.tools.NodeTool.execute(NodeTool.java:267)
 at org.apache.cassandra.tools.NodeTool.main(NodeTool.java:85)
java.lang.RuntimeException: java.util.concurrent.ExecutionException: java.lang.NoClassDefFoundError: com/sun/tools/attach/VirtualMachine
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I tested also cassandra-4.1 with JRE11.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
bin/nodetool sjk hh -n 10 --live
ERROR 15:56:25,499 Java home points to /Library/Java/JavaVirtualMachines/temurin-11.jre/Contents/Home make sure it is not a JRE path
ERROR 15:56:25,500 Failed to add tools.jar to classpath
java.lang.ClassNotFoundException: com.sun.tools.attach.VirtualMachine
 at java.base/jdk.internal.loader.BuiltinClassLoader.loadClass(Unknown Source)
 at java.base/jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass(Unknown Source)
 at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(Unknown Source)
 at org.gridkit.lab.jvm.attach.AttachAPI.&amp;lt;clinit&amp;gt;(AttachAPI.java:52)
 at org.gridkit.lab.jvm.attach.AttachManager.&amp;lt;clinit&amp;gt;(AttachManager.java:75)
 at org.gridkit.lab.jvm.attach.HeapHisto.getHistoLive(HeapHisto.java:40)
 at org.gridkit.jvmtool.cmd.HeapHistoCmd$Histo.run(HeapHistoCmd.java:97)
 at org.apache.cassandra.tools.nodetool.Sjk$Wrapper.run(Sjk.java:219)
 at org.apache.cassandra.tools.nodetool.Sjk.execute(Sjk.java:101)
 at org.apache.cassandra.tools.NodeTool$NodeToolCmd.runInternal(NodeTool.java:371)
 at org.apache.cassandra.tools.nodetool.Sjk.runInternal(Sjk.java:88)
 at org.apache.cassandra.tools.NodeTool$NodeToolCmd.run(NodeTool.java:356)
 at org.apache.cassandra.tools.NodeTool.execute(NodeTool.java:259)
 at org.apache.cassandra.tools.NodeTool.main(NodeTool.java:83)
java.lang.RuntimeException: java.util.concurrent.ExecutionException: java.lang.NoClassDefFoundError: com/sun/tools/attach/VirtualMachine
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I have no reason to believe this will produce a different result on 4.0.x...&lt;br/&gt;
Also, for all the documentation I found, we recommend users use JDK.&#160; We test with JDK.&lt;/p&gt;</comment>
                            <comment id="17783439" author="edimitrova" created="Tue, 7 Nov 2023 01:21:09 +0000"  >&lt;p&gt;1) Actually, I do not see now the security manager warnings on startup, only on compile.&lt;/p&gt;

&lt;p&gt;But adding a suppression to the ThreadAwareSecurityManager should help with those &lt;em&gt;I think:&lt;/em&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@SuppressWarnings(&lt;span class=&quot;code-quote&quot;&gt;&quot;removal&quot;&lt;/span&gt;)
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ThreadAwareSecurityManager &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;SecurityManager&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=paulo&quot; class=&quot;user-hover&quot; rel=&quot;paulo&quot;&gt;paulo&lt;/a&gt;&#160;, do you mind to test whether this suppression solves completely the issue for you? I cannot reproduce this startup warning, only compilation.&lt;/p&gt;

&lt;p&gt;2) SJK cannot run sjk hh if not run with JDK. Nothing to do there and it gives an error message that explains that you should not use JRE. I do not like hacks to remove warnings when they have a real meaning so my suggestion is to add below comment in the options file. When people setup their Cassandra nodes they will decide what to do.&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
# You cannot run nodetool sjk hh without below option with JDK17.
# It will generate a startup warning &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; missing module when using JRE and not JDK; sjk hh will not be available.
# If you want to use JRE and not see the warning, you can comment below option. 
--add-exports jdk.attach/sun.tools.attach=ALL-UNNAMED&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;3) I tried running our CI without using the options that generate the reported warnings. Our CI does not show any problems, except the sjk error mentioned:&lt;br/&gt;
&lt;a href=&quot;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra?branch=19001-5.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra?branch=19001-5.0&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Though we know this doesn&apos;t mean there is no hidden problem. I just submitted an OpenHFT github issue question to verify what potential impact might be. Better to get advice from the source instead of guessing on my own.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17783461" author="paulo" created="Tue, 7 Nov 2023 03:22:34 +0000"  >&lt;p&gt;Hi Ekaterina, thanks for looking into this! I will try to reproduce and get back to you ASAP.&lt;/p&gt;</comment>
                            <comment id="17783621" author="edimitrova" created="Tue, 7 Nov 2023 13:07:13 +0000"  >&lt;p&gt;Thanks,&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=paulo&quot; class=&quot;user-hover&quot; rel=&quot;paulo&quot;&gt;paulo&lt;/a&gt; , appreciate it!&lt;/p&gt;</comment>
                            <comment id="17783625" author="paulo" created="Tue, 7 Nov 2023 13:34:32 +0000"  >&lt;blockquote&gt;&lt;p&gt;I do not see now the security manager warnings on startup, only on compile.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;It&apos;s possible to reproduce this by running the official cassandra docker image with:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ docker run --name test --rm -it cassandra:5.0-alpha2
$ docker logs test | grep &quot;WARNING:&quot; | grep -v &quot;Unknown&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;But in fact it doesn&apos;t look like it&apos;s possible to disable this startup warning according to &lt;a href=&quot;https://github.com/openjdk/jdk/blob/d22e368cb5dbd6812f1584c47c44b9b754a222af/src/java.base/share/classes/java/lang/System.java#L419&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this code&lt;/a&gt;. I will maybe submit a openjdk ticket to allow this to be overriden when the issue is known and is going to be addressed &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Perhaps we could log a message before initializing the security manager on JDK17 for users to ignore the Java ThreadAwareSecurityManager warning since it&apos;s going to be addressed on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-18711&quot; title=&quot;Replace intercepting System.exit by a custom SecurityManager with something else&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-18711&quot;&gt;CASSANDRA-18711&lt;/a&gt; ? Not sure if that&apos;s really needed or we can just ignore it for now &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;2) SJK cannot run sjk hh if not run with JDK.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It&apos;s possible to reproduce the SJK issue with the official 4.1 and 5.0 images, so indeed this is not a new issue:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ docker run --rm -it cassandra:latest nodetool sjk jps
$ docker run --rm -it cassandra:5.0-alpha2 nodetool sjk jps
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;But the &quot;Uknown module&quot; warnings show up on JRE17 even when running non-sjk commands:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ docker run --rm -it cassandra:5.0-alpha2 nodetool help
WARNING: Unknown module: jdk.attach specified to --add-exports
WARNING: Unknown module: jdk.compiler specified to --add-exports
WARNING: Unknown module: jdk.compiler specified to --add-opens
usage: nodetool [(-pwf &amp;lt;passwordFilePath&amp;gt; | --password-file &amp;lt;passwordFilePath&amp;gt;)]
        [(-p &amp;lt;port&amp;gt; | --port &amp;lt;port&amp;gt;)] [(-h &amp;lt;host&amp;gt; | --host &amp;lt;host&amp;gt;)]
        [(-pp | --print-port)] [(-pw &amp;lt;password&amp;gt; | --password &amp;lt;password&amp;gt;)]
        [(-u &amp;lt;username&amp;gt; | --username &amp;lt;username&amp;gt;)] &amp;lt;command&amp;gt; [&amp;lt;args&amp;gt;]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The warning above also shows up when launching the cassandra process:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ docker run --name test --rm -it cassandra:5.0-alpha2
$ docker logs test | grep &quot;WARNING: Unknown&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;To me the JDK is an optional dependency only to support &quot;nodetool sjk&quot;, but not needed to run standard nodetool commands or cassandra server AFAIU (correct me if wrong). So we could:&lt;/p&gt;

&lt;p&gt;1) Remove the following optional lines from &quot;jvm11-(client|server).options&quot; and &quot;jvm17-(client|server).options&quot;.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;--add-exports jdk.attach/sun.tools.attach=ALL-UNNAMED
--add-exports jdk.compiler/com.sun.tools.javac.file=ALL-UNNAMED
--add-opens jdk.compiler/com.sun.tools.javac=ALL-UNNAMED
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;2) Dynamically add these lines on cassandra-env.sh when a JDK is detected.&lt;/p&gt;

&lt;p&gt;3) Print a friendly message when &quot;nodetool sjk&quot; is executed but no JDK is present.&lt;/p&gt;

&lt;p&gt;WDYT?&lt;/p&gt;</comment>
                            <comment id="17783626" author="paulo" created="Tue, 7 Nov 2023 13:35:32 +0000"  >&lt;p&gt;FWIW none of this is probably blocker for beta release since these are either existing or &quot;unfixable&quot; issues, but it would be a nice to have.&lt;/p&gt;</comment>
                            <comment id="17783630" author="edimitrova" created="Tue, 7 Nov 2023 13:44:03 +0000"  >&lt;p&gt;I agree with you about sjk hh, but I think you missed that jdk.compiler modules were added for chronicle queues, used by audit logging. While I did not see any test failures when those were removed, I am not sure yet how chronicle relies on them yet and whether we do not have a problem with a code path not exercised in CI. That is something we need to clarify and I mentioned I am trying to do that with the chronicle team.&lt;/p&gt;</comment>
                            <comment id="17783631" author="edimitrova" created="Tue, 7 Nov 2023 13:48:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://chronicle.software/chronicle-support-java-17/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://chronicle.software/chronicle-support-java-17/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17783632" author="edimitrova" created="Tue, 7 Nov 2023 13:51:04 +0000"  >&lt;p&gt;&lt;blockquote&gt;&lt;/blockquote&gt;FWIW none of this is probably blocker for beta release since these are either existing or &quot;unfixable&quot; issues, but it would be a nice to have.&lt;/p&gt;
&lt;blockquote&gt;&lt;/blockquote&gt;
&lt;p&gt;I agree, as long as we clarify the chronicle part is not leading to some big issues under the hood, we should be good&lt;/p&gt;</comment>
                            <comment id="17785338" author="edimitrova" created="Sun, 12 Nov 2023 23:36:02 +0000"  >&lt;p&gt;I did not get any response to my github issues question to chronicle.&#160;&lt;/p&gt;

&lt;p&gt;The closest I found by searching into the repos was:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/OpenHFT/Chronicle-Queue/blob/9f03bc69b8f0ec36c505108bcc2b8370e6bde798/docs/antora/modules/demos/pages/message-history.adoc#L69&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/OpenHFT/Chronicle-Queue/blob/9f03bc69b8f0ec36c505108bcc2b8370e6bde798/docs/antora/modules/demos/pages/message-history.adoc#L69&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Mentioning errors, but I need to test it&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/OpenHFT/Chronicle-Wire/commit/eeb1004a9635240492e3bb0d100d03737f22300f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/OpenHFT/Chronicle-Wire/commit/eeb1004a9635240492e3bb0d100d03737f22300f&lt;/a&gt; - the commit is about performance, not sure whether if we remove those there won&apos;t be errors... need to be checked&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/OpenHFT/Chronicle-Wire/commit/9fc82fe42d414710e655ca9985eb2c151f8d38cb&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/OpenHFT/Chronicle-Wire/commit/9fc82fe42d414710e655ca9985eb2c151f8d38cb&lt;/a&gt; - mentions that those are needed to make it possible to run the demos in the repo.&lt;/p&gt;

&lt;p&gt;So this was from high-level digging in the repos. I need to look into the details of how this relates to us.&#160;&lt;/p&gt;</comment>
                            <comment id="17785519" author="michaelsembwever" created="Mon, 13 Nov 2023 15:07:15 +0000"  >&lt;p&gt;Agree that there&apos;s nothing here that is a blocker for beta or rc.  Just use the JDK as we recommend.&lt;/p&gt;

&lt;p&gt;Per the suggestions above, it makes sense that these exports/add-opens are only added when a JDK is detected (and we fail-fast any nodetool commands that need a JDK).&lt;/p&gt;</comment>
                            <comment id="17785690" author="edimitrova" created="Mon, 13 Nov 2023 23:13:52 +0000"  >&lt;blockquote&gt;&lt;blockquote&gt;&lt;p&gt;and we fail-fast any nodetool commands that need a JDK)&lt;/p&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;
&lt;p&gt;the nodetool sjk is clear, it fails itself with message you use JRE and you need JDK.&#160;&lt;/p&gt;



&lt;p&gt;As I explained, the exports/opens for Chronicle have unclear impact on audit ligging. Please check again what I said. Thanks&lt;/p&gt;</comment>
                            <comment id="17785691" author="paulo" created="Mon, 13 Nov 2023 23:21:12 +0000"  >&lt;blockquote&gt;&lt;p&gt;As I explained, the exports/opens for Chronicle have unclear impact on audit ligging. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Audit logging is an optional functionality as far as I understand. We can prevent startup if audit logging is enabled and a JDK is not detected.&lt;/p&gt;</comment>
                            <comment id="17785780" author="michaelsembwever" created="Tue, 14 Nov 2023 07:51:34 +0000"  >&lt;blockquote&gt;&lt;p&gt;As I explained, the exports/opens for Chronicle have unclear impact on audit logging.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We don&apos;t recommend using JRE.  We don&apos;t do any testing with it.  Our quickest fix is to just fail or warn that using JRE is not recommended (and that some features like audit logging and sjk may not work).  &lt;/p&gt;

&lt;p&gt;e.g.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ! command -v javac &amp;gt;/dev/&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ; then
   echo &lt;span class=&quot;code-quote&quot;&gt;&quot;WARNING: JRE is not recommended. Please install and use a JDK.  Some features may not work.&quot;&lt;/span&gt;
fi
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17785848" author="paulo" created="Tue, 14 Nov 2023 11:17:09 +0000"  >&lt;blockquote&gt;&lt;p&gt;Our quickest fix is to just fail or warn that using JRE is not recommended (and that some features like audit logging and sjk may not work)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This would break the official Cassandra &lt;a href=&quot;https://github.com/docker-library/cassandra/blob/master/5.0/Dockerfile&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;docker image&lt;/a&gt; that is built on top of JRE. Do we want to drop the unintended JRE support that has been proven to work over the years on this image ?&lt;/p&gt;

&lt;p&gt;I see the following options:&lt;br/&gt;
a) Make the JDK dependency optional, failing-fast if features that strictly require it are enabled. Add testing with JRE, preferably with the official docker image.&lt;br/&gt;
b) Make the JDK dependency strictly required, properly document this and work with the official docker image maintainers to update the image to use JDK instead.&lt;/p&gt;

&lt;p&gt;Wdyt?&lt;/p&gt;</comment>
                            <comment id="17785862" author="brandon.williams" created="Tue, 14 Nov 2023 12:01:58 +0000"  >&lt;blockquote&gt;&lt;p&gt;b) Make the JDK dependency strictly required, properly document this and work with the official docker image maintainers to update the image to use JDK instead.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If we &quot;don&apos;t recommend using JRE&quot; then this seems like the way to me, but I will note our packages only require a JRE as well.&lt;/p&gt;</comment>
                            <comment id="17786028" author="michaelsembwever" created="Tue, 14 Nov 2023 18:47:35 +0000"  >&lt;blockquote&gt;&lt;p&gt;This would break the official Cassandra docker image that is built on top of JRE. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;A warning would not &quot;break&quot; it.   It would inform users of the docker image of known limitations.  This buys us time to then deal with the issue properly as we wish.  (And the docker image maintainers may notice and change to JDK anyway&#8230;) &lt;/p&gt;</comment>
                            <comment id="17786885" author="paulo" created="Thu, 16 Nov 2023 18:26:15 +0000"  >&lt;blockquote&gt;&lt;p&gt;A warning would not &quot;break&quot; it. It would inform users of the docker image of known limitations. This buys us time to then deal with the issue properly as we wish. (And the docker image maintainers may notice and change to JDK anyway&#8230;)&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;It would deprecate JRE support which was previously supported (ie. JRE_HOME is mentioned &lt;a href=&quot;https://cassandra.apache.org/doc/latest/cassandra/reference/java17.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; and other places). If there are no hard dependencies on the JDK for core features, I would prefer to just require it for optional features like SJK and audit log. WDYT?&lt;/p&gt;

&lt;p&gt;One question that arises is whether we want to continue JRE support to core features. The benefits I can think of are smaller image size and fewer runtime dependencies.&lt;/p&gt;</comment>
                            <comment id="17788014" author="edimitrova" created="Mon, 20 Nov 2023 13:37:21 +0000"  >&lt;blockquote&gt;&lt;p&gt;I did not get any response to my github issues question to chronicle.&#160;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Still no response from the project. In the meantime, I received an email about whether we are interested in paid support with SLA from Chronicle Systems...&#160;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;It would deprecate JRE support which was previously supported (ie. JRE_HOME is mentioned&#160;&lt;a href=&quot;https://cassandra.apache.org/doc/latest/cassandra/reference/java17.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&#160;and other places).&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This would require ML discussion JRE vs JDK. I will start one later today.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;mentioned&#160;&lt;a href=&quot;https://cassandra.apache.org/doc/latest/cassandra/reference/java17.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&#160;and other places).&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Indeed, our documentation around JRE/JDK is inconsistent, and I see an opportunity to improve that, too.&lt;/p&gt;</comment>
                            <comment id="17788183" author="edimitrova" created="Mon, 20 Nov 2023 23:31:56 +0000"  >&lt;p&gt;Discussion thread started here: &lt;a href=&quot;https://lists.apache.org/thread/xtnj8ykboprz14ypsrxsx68hy44ypn8v&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://lists.apache.org/thread/xtnj8ykboprz14ypsrxsx68hy44ypn8v&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17791323" author="edimitrova" created="Wed, 29 Nov 2023 21:12:03 +0000"  >&lt;p&gt;After no objections for more than a week, I will continue as per the suggested plan:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;put a nice failure message in Sjk.java (e.g. &quot;JDK required for this nodetool command&quot;) ---&amp;gt; sjk already errors out, stating you need to use JDK&lt;/li&gt;
	&lt;li&gt;add a comment in cassandra.yaml in front of audit_logging_options stating compatibility with JRE is unknown (referencing the jira issue) --&amp;gt; also FQL&lt;/li&gt;
	&lt;li&gt;add the jdk add-opens and add-exports only when jdk is detected (javac is on path).&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17791395" author="edimitrova" created="Thu, 30 Nov 2023 01:15:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/ekaterinadimitrova2/cassandra/commit/613bb6d2cbc40924479eac044f78e0c4e584521b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;5.0 Patch&lt;/a&gt;, &lt;a href=&quot;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra?branch=19001-5.0-patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CI&lt;/a&gt;- CircleCI is having a bad day, hitting concurrency limits (too many CI runs) and returning a lot of address already in use, OS errors. We&apos;ve seen those before. I will check the failures one by one and rerun the tests tomorrow, but I wanted to leave the patch ready for review in the meantime so I can get feedback. Also, based on experience I am fairly sure the patch is not causing those issues. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=paulo&quot; class=&quot;user-hover&quot; rel=&quot;paulo&quot;&gt;paulo&lt;/a&gt;, do you mind to review, please? I tested also locally with JRE/JDK 11 and 17.&lt;/p&gt;

&lt;p&gt;The patch for trunk will be the same, I will propagate it and run tests after we confirm this is what we are looking for. &lt;br/&gt;
&#160;&lt;/p&gt;</comment>
                            <comment id="17791828" author="paulo" created="Thu, 30 Nov 2023 23:32:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=e.dimitrova&quot; class=&quot;user-hover&quot; rel=&quot;e.dimitrova&quot;&gt;e.dimitrova&lt;/a&gt; thanks for the patch! I&apos;ll take a look ASAP, hopefully tomorrow.&lt;/p&gt;</comment>
                            <comment id="17791845" author="edimitrova" created="Fri, 1 Dec 2023 00:08:19 +0000"  >&lt;p&gt;Thanks, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=paulo&quot; class=&quot;user-hover&quot; rel=&quot;paulo&quot;&gt;paulo&lt;/a&gt;, appreciate it!&lt;br/&gt;
In the meantime I looked into the CI run in more detail:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;test_bootstrap_and_cleanup - this seems to need investigation; seems to have been seen recently - &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-18660&quot; title=&quot;transient_replication_ring_test.py::TestTransientReplicationRing::test_bootstrap_and_cleanup&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-18660&quot;&gt;&lt;del&gt;CASSANDRA-18660&lt;/del&gt;&lt;/a&gt;. Actually in the other ticket the wait time for the message was 120 seconds, here we see it being 90. I do not believe this is related to what we do here, but seems worth it to open ticket and investigate.&lt;/li&gt;
	&lt;li&gt;test_decommissioned_wiped_node_can_join and test_shutdown_wiped_node_cannot_join failed with similar errors. And they also do not seem as something that could be triggered by this patch. I will open tickets and bisect.&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        &amp;lt;class &lt;span class=&quot;code-quote&quot;&gt;&apos;AssertionError&apos;&lt;/span&gt;&amp;gt;
        &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; [Row(key=b&lt;span class=&quot;code-quote&quot;&gt;&apos;PP...e9\xbb&apos;&lt;/span&gt;), ...] == [Row(key=b&lt;span class=&quot;code-quote&quot;&gt;&apos;5O...eL\xb6&apos;&lt;/span&gt;), ...]
  At index 0 diff: Row(key=b&lt;span class=&quot;code-quote&quot;&gt;&apos;PP9O0M9170&apos;&lt;/span&gt;, C0=b&lt;span class=&quot;code-quote&quot;&gt;&apos;|\xa4\xc7\xb99\xd4\xae*\x85\x8c\xb3T\xa6!\x15\xaa{u\x90Rz\xc7J\x9a\xdd\x97b\xdd-\x07|\x06*\x06&apos;&lt;/span&gt;, C1=b&quot;\x95g\x0f\xa2\x13Bha\xefW&apos;\xf9\x
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;test_move_single_node - seems unrelated and deserving a ticket:&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
failed on teardown with &lt;span class=&quot;code-quote&quot;&gt;&quot;Failed: Unexpected error found in node logs (see stdout &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; full details). Errors: [[node1] &lt;span class=&quot;code-quote&quot;&gt;&apos;ERROR [main] 2023-11-30 00:02:24,154 CassandraDaemon.java:877 - Fatal configuration error\norg.apache.cassandra.exceptions.ConfigurationException: Bootstrapping to existing token 0 is not allowed (decommission/removenode the old node first).\n\tat org.apache.cassandra.dht.BootStrapper.getSpecifiedTokens(BootStrapper.java:199)\n\tat org.apache.cassandra.dht.BootStrapper.getBootstrapTokens(BootStrapper.java:167)\n\tat org.apache.cassandra.service.StorageService.joinTokenRing(StorageService.java:1256)\n\tat org.apache.cassandra.service.StorageService.joinTokenRing(StorageService.java:1209)\n\tat org.apache.cassandra.service.StorageService.initServer(StorageService.java:988)\n\tat org.apache.cassandra.service.StorageService.initServer(StorageService.java:905)\n\tat org.apache.cassandra.service.CassandraDaemon.setup(CassandraDaemon.java:377)\n\tat org.apache.cassandra.service.CassandraDaemon.activate(CassandraDaemon.java:721)\n\tat org.apache.cassandra.service.CassandraDaemon.main(CassandraDaemon.java:855)&apos;&lt;/span&gt;]&quot;&lt;/span&gt;
Unexpected error found in node logs (see stdout &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; full details). Errors: [[node1] &lt;span class=&quot;code-quote&quot;&gt;&apos;ERROR [main] 2023-11-30 00:02:24,154 CassandraDaemon.java:877 - Fatal configuration error\norg.apache.cassandra.exceptions.ConfigurationException: Bootstrapping to existing token 0 is not allowed (decommission/removenode the old node first).\n\tat org.apache.cassandra.dht.BootStrapper.getSpecifiedTokens(BootStrapper.java:199)\n\tat org.apache.cassandra.dht.BootStrapper.getBootstrapTokens(BootStrapper.java:167)\n\tat org.apache.cassandra.service.StorageService.joinTokenRing(StorageService.java:1256)\n\tat org.apache.cassandra.service.StorageService.joinTokenRing(StorageService.java:1209)\n\tat org.apache.cassandra.service.StorageService.initServer(StorageService.java:988)\n\tat org.apache.cassandra.service.StorageService.initServer(StorageService.java:905)\n\tat org.apache.cassandra.service.CassandraDaemon.setup(CassandraDaemon.java:377)\n\tat org.apache.cassandra.service.CassandraDaemon.activate(CassandraDaemon.java:721)\n\tat org.apache.cassandra.service.CassandraDaemon.main(CassandraDaemon.java:855)&apos;&lt;/span&gt;]

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;test_expiration_overflow_policy_cap_default_ttl - unrelated, seems to deserve a ticket, CC &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Bereng&quot; class=&quot;user-hover&quot; rel=&quot;bereng&quot;&gt;Bereng&lt;/a&gt;, might be interested into the error we see (there is more in the logs of course, but this is outstanding to me):&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;gt;           raise self._final_exception
E           cassandra.InvalidRequest: Error from server: code=2200 [Invalid query] message=&lt;span class=&quot;code-quote&quot;&gt;&quot;Request on table ks.ttl_table with &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; ttl of 630720000 seconds exceeds maximum supported expiration date of 2038-01-19T03:14:06+00:00. In order to avoid &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; use a lower TTL, change the expiration date overflow policy or upgrade to a version where &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; limitation is fixed. See CASSANDRA-14092 and CASSANDRA-14227 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; more details.&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The rest seem to be either OS errors or timeouts. On rebase at the end I will run new full CI before commit and it will be confirmed&lt;/p&gt;</comment>
                            <comment id="17791933" author="bereng" created="Fri, 1 Dec 2023 07:50:02 +0000"  >&lt;p&gt;I&apos;ve been looking at the patch and I don&apos;t see how those ttl can come about. I checked the dtest code and all lgtm. The dtest even passes locally with both the 5.0 and this patch&apos;s code. So unless that CI was broken, there was some merge/rebase race or sthg esoteric along those lines I don&apos;t see anything. I would do a new run...&lt;/p&gt;</comment>
                            <comment id="17792275" author="edimitrova" created="Sat, 2 Dec 2023 00:14:24 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Bereng&quot; class=&quot;user-hover&quot; rel=&quot;bereng&quot;&gt;Bereng&lt;/a&gt;. I also do not see how this patch can trigger the error; the question is whether there might be some bug in general and whether we need a ticket to investigate further.&#160;&lt;br/&gt;
Looking into the logs, it seems like, as per &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/db/ExpirationDateOverflowHandling.java#L82&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this&lt;/a&gt; formula, the only way to see that message is if the current time is&#160;inaccurate. What bugs me is that the logger we use and the mentioned formula both use System.currentTimeMillis(), so I am not sure what happened... the logs seem to have the correct timing. &lt;br/&gt;
Another observation - we say in the test we set CAP policy, but then we end up with rejection. The logs show that the test failed with &quot;should not throw InvalidRequest.&quot; So internally, the policy needed to be appropriately set to CAP when Cassandra started, but we were throwing IRE, which, from what I saw, is attributed to the wrong current time.&#160;&lt;br/&gt;
At the same time, I found in node1 log from the logs where the test failed:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-Dcassandra.expiration_date_overflow_policy=CAP&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We do not see &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/db/ExpirationDateOverflowHandling.java#L60&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this warning&lt;/a&gt; in the logs.&lt;br/&gt;
Shall we open a ticket, or am I missing anything?&lt;br/&gt;
I also made a run in a loop of the test: &lt;a href=&quot;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/2594/workflows/81a5d412-8ce0-4914-83a6-ca6f984fb7ab/jobs/50164/artifacts&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/2594/workflows/81a5d412-8ce0-4914-83a6-ca6f984fb7ab/jobs/50164/artifacts&lt;/a&gt; (finished green)&lt;br/&gt;
Plus, running the whole class in a loop: &lt;a href=&quot;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/2595/workflows/1b438226-496b-4000-bce5-dc9e73b48460/jobs/50269/parallel-runs/0?filterBy=ALL&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/2595/workflows/1b438226-496b-4000-bce5-dc9e73b48460/jobs/50269/parallel-runs/0?filterBy=ALL&lt;/a&gt; &lt;del&gt;(still running)&lt;/del&gt; (finished green)&lt;/p&gt;

&lt;p&gt;Let&apos;s see.&#160;&lt;/p&gt;</comment>
                            <comment id="17795188" author="bereng" created="Mon, 11 Dec 2023 06:50:48 +0000"  >&lt;p&gt;I think, gut feeling, CI env was really unstable given the large number of failures that look related to env so that&apos;s probably the cause. I checked  the code/tests and they lgtm, I tested and got greens, you checked things and they lgty, you tested and you got greens. I don&apos;t think we have any other threads to start pulling. But if you have some idea of further things to look a ticket can be opened but what to look for?&lt;/p&gt;</comment>
                            <comment id="17799047" author="michaelsembwever" created="Wed, 20 Dec 2023 15:01:23 +0000"  >&lt;p&gt;Should we run CI again ? (agree that the above issues sound unrelated to this ticket)&lt;/p&gt;</comment>
                            <comment id="17799052" author="edimitrova" created="Wed, 20 Dec 2023 15:07:08 +0000"  >&lt;blockquote&gt;&lt;p&gt;Should we run CI again ? (agree that the above issues sound unrelated to this ticket)&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;You read my mind, I was about to ask &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=paulo&quot; class=&quot;user-hover&quot; rel=&quot;paulo&quot;&gt;paulo&lt;/a&gt; if he had the time to check this one so I can incorporate any potential feedback and rerun CI &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;br/&gt;
So... &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=paulo&quot; class=&quot;user-hover&quot; rel=&quot;paulo&quot;&gt;paulo&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="17799057" author="paulo" created="Wed, 20 Dec 2023 15:14:04 +0000"  >&lt;p&gt;I&apos;ll take a look at this today, will get back soon.&lt;/p&gt;</comment>
                            <comment id="17800870" author="paulo" created="Wed, 27 Dec 2023 20:22:27 +0000"  >&lt;p&gt;I finally got a chance to take a look at this, apologies for the delay. &lt;/p&gt;

&lt;p&gt;It looks like the &lt;a href=&quot;https://github.com/ekaterinadimitrova2/cassandra/blob/613bb6d2cbc40924479eac044f78e0c4e584521b/bin/cassandra.in.sh#L153&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;JDK detection check&lt;/a&gt; does not work when the JRE is on &lt;tt&gt;/opt/java/openjdk/bin/java&lt;/tt&gt; which is the case for the official docker image. I updated the check &lt;a href=&quot;https://github.com/pauloricardomg/cassandra/commit/97472afcc4f63291ebbbcc6aab476b0ccf12ce06&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;on this commit&lt;/a&gt; to check for the presence of the &lt;tt&gt;javac&lt;/tt&gt; executable on the &lt;tt&gt;$PATH&lt;/tt&gt; or &lt;tt&gt;$JAVA_HOME&lt;/tt&gt; to detect whether a JDK is present. Let me know what do you think.&lt;/p&gt;

&lt;p&gt;I checked that no more warnings &quot;Unknown module: jdk.attach specified to --add-exports&quot; are logged during server initialization, nor when calling nodetool commands when using JRE17:&lt;br/&gt;
&lt;b&gt;BEFORE:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ docker run --rm -it cassandra:5 nodetool help | cat | head -n10
WARNING: Unknown module: jdk.attach specified to --add-exports
WARNING: Unknown module: jdk.compiler specified to --add-exports
WARNING: Unknown module: jdk.compiler specified to --add-opens
usage: nodetool [(-p &amp;lt;port&amp;gt; | --port &amp;lt;port&amp;gt;)]
        [(-u &amp;lt;username&amp;gt; | --username &amp;lt;username&amp;gt;)]
        [(-pw &amp;lt;password&amp;gt; | --password &amp;lt;password&amp;gt;)]
        [(-pwf &amp;lt;passwordFilePath&amp;gt; | --password-file &amp;lt;passwordFilePath&amp;gt;)]
        [(-pp | --print-port)] [(-h &amp;lt;host&amp;gt; | --host &amp;lt;host&amp;gt;)] &amp;lt;command&amp;gt; [&amp;lt;args&amp;gt;]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;b&gt;AFTER:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ docker run --rm -it cassandra-test:5.0-19001 nodetool help | cat | head -n10
usage: nodetool [(-pw &amp;lt;password&amp;gt; | --password &amp;lt;password&amp;gt;)]
        [(-p &amp;lt;port&amp;gt; | --port &amp;lt;port&amp;gt;)]
        [(-pwf &amp;lt;passwordFilePath&amp;gt; | --password-file &amp;lt;passwordFilePath&amp;gt;)]
        [(-pp | --print-port)] [(-h &amp;lt;host&amp;gt; | --host &amp;lt;host&amp;gt;)]
        [(-u &amp;lt;username&amp;gt; | --username &amp;lt;username&amp;gt;)] &amp;lt;command&amp;gt; [&amp;lt;args&amp;gt;]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I also checked that nodetool sjk fails with this message on JRE17:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ docker run --rm -it cassandra-test:5.0-19001 nodetool sjk jps | head -n10
ERROR 17:22:29,631 Java home points to /opt/java/openjdk make sure it is not a JRE path
ERROR 17:22:29,632 Failed to add tools.jar to classpath
java.lang.ClassNotFoundException: com.sun.tools.attach.VirtualMachine
        at java.base/jdk.internal.loader.BuiltinClassLoader.loadClass(Unknown Source)
        at java.base/jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass(Unknown Source)
        at java.base/java.lang.ClassLoader.loadClass(Unknown Source)
        at org.gridkit.lab.jvm.attach.AttachAPI.&amp;lt;clinit&amp;gt;(AttachAPI.java:52)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;But works when a JDK17 is present:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ bin/nodetool sjk jps
22825   org.apache.cassandra.tools.NodeTool -p 7199 sjk jps
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I checked that all commands above have the same output on JRE11.&lt;/p&gt;

&lt;p&gt;I briefly tested the full query logger on a JRE17 with the patch above and it seems to be working:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;root@6c9f22a89594:/# nodetool enablefullquerylog --path /tmp/bla

root@6c9f22a89594:/# cqlsh
Connected to Test Cluster at 127.0.0.1:9042
[cqlsh 6.2.0 | Cassandra 5.0-beta1-SNAPSHOT | CQL spec 3.4.7 | Native protocol v5]
Use HELP for help.
cqlsh&amp;gt; CREATE KEYSPACE test WITH replication = {&apos;class&apos;: &apos;SimpleStrategy&apos;, &apos;replication_factor&apos;: 1};
cqlsh&amp;gt; exit

root@6c9f22a89594:/# /opt/cassandra/tools/bin/fqltool dump /tmp/bla
INFO  [main] 2023-12-27 16:56:34,673 DatabaseDescriptor.java:1557 - Supported sstable formats are: big -&amp;gt; org.apache.cassandra.io.sstable.format.big.BigFormat with singleton components: [Data.db, Index.db, Statistics.db, CompressionInfo.db, Filter.db, Summary.db, Digest.crc32, CRC.db, TOC.txt], bti -&amp;gt; org.apache.cassandra.io.sstable.format.bti.BtiFormat with singleton components: [Data.db, Partitions.db, Rows.db, Statistics.db, CompressionInfo.db, Filter.db, Digest.crc32, CRC.db, TOC.txt]
INFO  [main] 2023-12-27 16:56:34,723 Jvm.java:174 - Chronicle core loaded from file:/opt/cassandra/lib/chronicle-core-2.23.36.jar
INFO  [main] 2023-12-27 16:56:34,817 Slf4jExceptionHandler.java:44 - Took 6 ms to add mapping for /tmp/bla/metadata.cq4t
INFO  [main] 2023-12-27 16:56:34,859 Slf4jExceptionHandler.java:44 - Running under OpenJDK Runtime Environment 17.0.9+9 with 16 processors reported.
INFO  [main] 2023-12-27 16:56:34,860 Slf4jExceptionHandler.java:44 - Leave your e-mail to get information about the latest releases and patches at https://chronicle.software/release-notes/
INFO  [main] 2023-12-27 16:56:34,861 Slf4jExceptionHandler.java:44 - Process id: 1015 :: Chronicle Queue (5.23.37)
Type: single-query
Query start time: 1703696157539
Protocol version: 5
Generated timestamp:-9223372036854775808
Generated nowInSeconds:1703696157
Query: SELECT * FROM system.peers_v2
Values:

Type: single-query
Query start time: 1703696157544
Protocol version: 5
Generated timestamp:-9223372036854775808
Generated nowInSeconds:1703696157
Query: SELECT * FROM system.local WHERE key=&apos;local&apos;
Values:
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I inspected chronicle queue code and documentation and I think that a JDK is only required when the &lt;a href=&quot;https://github.com/OpenHFT/Chronicle-Queue?tab=readme-ov-file#high-level-interface-for-readingwriting&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;high level interface&lt;/a&gt; is used since it requires &lt;a href=&quot;https://github.com/OpenHFT/Chronicle-Wire?tab=readme-ov-file#spring-boot-and-dynamic-compilation-in-chronicle-wire&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dynamic JVM compilation to create object stubs&lt;/a&gt;. This seems to be corroborated by &lt;a href=&quot;https://github.com/OpenHFT/Chronicle-Queue/issues/909#issuecomment-924626439&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this comment&lt;/a&gt; which indicates the jdk compiler modules are not required by chronicle queue, despite the &lt;a href=&quot;https://chronicle.software/chronicle-support-java-17/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;chronicle documentation saying otherwise&lt;/a&gt;. From a quick code inspection it doesn&apos;t look like we&apos;re using this high level API (MethodWriter/MethodReader) in our chronicle queue usage so I don&apos;t think a JDK is required in our case. Tagging &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aweisberg&quot; class=&quot;user-hover&quot; rel=&quot;aweisberg&quot;&gt;aweisberg&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stefan.miklosovic&quot; class=&quot;user-hover&quot; rel=&quot;stefan.miklosovic&quot;&gt;stefan.miklosovic&lt;/a&gt; which may be familiar with the FQL machinery to confirm.&lt;/p&gt;

&lt;p&gt;I would prefer not to dis-recommend the use of JRE for FQL/Audit Logging unless we have evidence that it does not work via a unit test or user report so I created &lt;a href=&quot;https://github.com/pauloricardomg/cassandra/commit/33477b20edd045d8449b8ab0991adbb92e4af6fb&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this commit&lt;/a&gt; to remove this recommendation from the documentation and cassandra.yaml.&lt;/p&gt;

&lt;p&gt;If it&apos;s confirmed that FQL/Audit Log does not require JDK to function properly, then SJK will be the only known functionality to explicitly require an SDK to work. Given this is an optional command for operator troubleshooting, I don&apos;t think we should require the use of a JDK to run Cassandra unless there are relevant/core features that require it.&lt;/p&gt;

&lt;p&gt;Let me know what do you think.&lt;/p&gt;</comment>
                            <comment id="17800879" author="paulo" created="Wed, 27 Dec 2023 20:48:06 +0000"  >&lt;p&gt;Added &lt;a href=&quot;https://github.com/pauloricardomg/cassandra/commit/cdc4124873f2b29c4d42e3265a9c7f408bcd98c4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this commit&lt;/a&gt; to &lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...pauloricardomg:cassandra:19001-5.0-patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;pauloricardomg/19001-5.0-patch&lt;/a&gt; to fail &quot;nodetool sjk&quot; with a nicer message when a JDK is not found:&lt;/p&gt;

&lt;p&gt;&quot;nodetool sjk jps&quot; output with JDK17:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ bin/nodetool sjk jps
28270   org.apache.cassandra.tools.NodeTool -p 7199 sjk jps
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&quot;nodetool sjk jps&quot; output with JRE17:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ docker run --rm -it cassandra-test:5.0-19001 nodetool sjk jps | cat | head -n10
ERROR: JDK not detected and nodetool sjk requires JDK to work.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17801934" author="michaelsembwever" created="Tue, 2 Jan 2024 21:33:26 +0000"  >&lt;blockquote&gt;&lt;p&gt;I would prefer not to dis-recommend the use of JRE for FQL/Audit Logging unless we have evidence that it does not work via a unit test or user report so I created this commit to remove this recommendation from the documentation and cassandra.yaml.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Agree, given your analysis.&lt;/p&gt;</comment>
                            <comment id="17804491" author="edimitrova" created="Mon, 8 Jan 2024 22:36:30 +0000"  >&lt;p&gt;Thank you,&#160; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=paulo&quot; class=&quot;user-hover&quot; rel=&quot;paulo&quot;&gt;paulo&lt;/a&gt; for the extensive review and the patches! I truly appreciate it!&lt;/p&gt;

&lt;p&gt;Please find my responses below:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;JRE is on&#160;&lt;tt&gt;/opt/java/openjdk/bin/java&lt;/tt&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;LGTM, sorry I forgot about that earlier.&#160;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&#160;I updated the check&#160;&lt;a href=&quot;https://github.com/pauloricardomg/cassandra/commit/97472afcc4f63291ebbbcc6aab476b0ccf12ce06&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;on this commit&lt;/a&gt;&#160;to check for the presence of the&#160;&lt;tt&gt;javac&lt;/tt&gt;&#160;executable on the&#160;&lt;tt&gt;$PATH&lt;/tt&gt;&#160;or&#160;&lt;tt&gt;$JAVA_HOME&lt;/tt&gt;&#160;to detect whether a JDK is present. Let me know what do you think.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I was using the runtime check, not the javac command check, because you can have a few different installations on a machine, and while you try to use JRE, the check for javac still passes as you also have jdk11 for example, on the same machine&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Added&#160;&lt;a href=&quot;https://github.com/pauloricardomg/cassandra/commit/cdc4124873f2b29c4d42e3265a9c7f408bcd98c4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this commit&lt;/a&gt;&#160;to&#160;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...pauloricardomg:cassandra:19001-5.0-patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;pauloricardomg/19001-5.0-patch&lt;/a&gt;&#160;to fail &quot;nodetool sjk&quot; with a nicer message when a JDK is not found:&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I get below on my machine with that patch and JRE, just local build running on my laptop (I would have to clear from my path the jdk11 for the check to pass as expected):&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
bin/nodetool sjk jps
WARNING: Unknown module: jdk.compiler specified to --add-exports
WARNING: Unknown module: jdk.attach specified to --add-exports
WARNING: Unknown module: jdk.compiler specified to --add-opens
ERROR 14:04:02,644 Java home points to /Library/Java/JavaVirtualMachines/temurin-17.jre/Contents/Home make sure it is not a JRE path
ERROR 14:04:02,645 Failed to add tools.jar to classpath
java.lang.ClassNotFoundException: com.sun.tools.attach.VirtualMachine
 at java.base/jdk.internal.loader.BuiltinClassLoader.loadClass(Unknown Source)
 at java.base/jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass(Unknown Source)
 at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(Unknown Source)
 at org.gridkit.lab.jvm.attach.AttachAPI.&amp;lt;clinit&amp;gt;(AttachAPI.java:52)
 at org.gridkit.lab.jvm.attach.AttachManager.&amp;lt;clinit&amp;gt;(AttachManager.java:75)
 at org.gridkit.jvmtool.cmd.ProcListCmd$JPS.run(ProcListCmd.java:74)
 at org.apache.cassandra.tools.nodetool.Sjk$Wrapper.run(Sjk.java:219)
 at org.apache.cassandra.tools.nodetool.Sjk.runInternal(Sjk.java:83)
 at org.apache.cassandra.tools.NodeTool$NodeToolCmd.run(NodeTool.java:368)
 at org.apache.cassandra.tools.NodeTool.execute(NodeTool.java:267)
 at org.apache.cassandra.tools.NodeTool.main(NodeTool.java:85)
java.lang.NoClassDefFoundError: com/sun/tools/attach/VirtualMachine
 at org.gridkit.lab.jvm.attach.AttachManager$AttachManagerInt.getVmList(AttachManager.java:217)
 at org.gridkit.lab.jvm.attach.AttachManager$AttachManagerInt.internalListJavaProcesses(AttachManager.java:224)
 at org.gridkit.lab.jvm.attach.AttachManager.listJavaProcesses(AttachManager.java:105)
 at org.gridkit.jvmtool.cmd.ProcListCmd$JPS.run(ProcListCmd.java:74)
 at org.apache.cassandra.tools.nodetool.Sjk$Wrapper.run(Sjk.java:219)
 at org.apache.cassandra.tools.nodetool.Sjk.runInternal(Sjk.java:83)
 at org.apache.cassandra.tools.NodeTool$NodeToolCmd.run(NodeTool.java:368)
 at org.apache.cassandra.tools.NodeTool.execute(NodeTool.java:267)
 at org.apache.cassandra.tools.NodeTool.main(NodeTool.java:85)
Caused by: java.lang.ClassNotFoundException: com.sun.tools.attach.VirtualMachine
 at java.base/jdk.internal.loader.BuiltinClassLoader.loadClass(Unknown Source)
 at java.base/jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass(Unknown Source)
 at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(Unknown Source)
 ... 9 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Also, I believe we should not prevent from running all sjk commands with JRE. There are some which do not require the modules.&#160;&lt;/p&gt;

&lt;p&gt;For example - sjk ttop&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;I inspected chronicle queue code and documentation&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;There was lazy consensus on the ML around chronicle and JRE. Thus, I did not finish digging there but documented the recommendation. Also, we use chronicle-queue, chronicle-core, chronicle-bytes, chronicle-wire, and chronicle-threads, and &lt;a href=&quot;https://chronicle.software/chronicle-support-java-17/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;the docs&lt;/a&gt; are not particularly for chronicle-queue. If the community goes into that road, we must check them all. Furthermore, it could be performance-related, not definitive failure.&#160;&lt;/p&gt;</comment>
                            <comment id="17807387" author="edimitrova" created="Tue, 16 Jan 2024 18:21:25 +0000"  >&lt;p&gt;In the meantime I received the following response from Chronicle:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Unless you see a warning like following

Failed to compile generated method reader -
falling back to proxy method reader. Please report &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; failure as support &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;
proxy method readers will be dropped in x.25.

there should be no performance impact. As com.sun.tools.javac &lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; is used by the &lt;span class=&quot;code-object&quot;&gt;Compiler&lt;/span&gt; (which you exclude) and subsequently by Wire/Queue &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; compiling some optimized autogenerated classes.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With that said, I think we are good with what &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=paulo&quot; class=&quot;user-hover&quot; rel=&quot;paulo&quot;&gt;paulo&lt;/a&gt; suggested:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;I would prefer not to dis-recommend the use of JRE for FQL/Audit Logging unless we have evidence that it does not work via a unit test or user report so I created this commit to remove this recommendation from the documentation and cassandra.yaml.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It seems the only thing we need to handle then is: &lt;br/&gt;
1) Decide whether we want to be checking for runtime or javac (considering the case I mentioned)&lt;br/&gt;
2) IMHO, we should not prevent all sjk commands from running if JRE is detected &lt;/p&gt;</comment>
                            <comment id="17807408" author="paulo" created="Tue, 16 Jan 2024 18:56:38 +0000"  >&lt;p&gt;Thanks Ekaterina!&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;1) Decide whether we want to be checking for runtime or javac (considering the case I mentioned)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think checking for &apos;javac&apos; should be fine when JAVA_HOME is not defined. If JAVA_HOME is defined, then we check for the existence of &quot;${JAVA_HOME}/bin/javac&quot; to determine if it&apos;s running on a JDK. Would this fix your edge case?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;2) IMHO, we should not prevent all sjk commands from running if JRE is detected&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;sounds good to me, the warning from sjk itself &lt;tt&gt;ERROR 14:04:02,644 Java home points to /Library/Java/JavaVirtualMachines/temurin-17.jre/Contents/Home make sure it is not a JRE path&lt;/tt&gt; should be sufficient&lt;/p&gt;</comment>
                            <comment id="17807779" author="edimitrova" created="Wed, 17 Jan 2024 15:40:13 +0000"  >&lt;blockquote&gt;&lt;p&gt;I think checking for &apos;javac&apos; should be fine when JAVA_HOME is not defined. If JAVA_HOME is defined, then we check for the existence of &quot;${JAVA_HOME}/bin/javac&quot; to determine if it&apos;s running on a JDK. Would this fix your edge case?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;If JAVA_HOME is not defined, Cassandra checks what is in PATH first. Do we expect users to do more modifications to PATH to adhere? It sounds a bit risky to me; I hope I do not overengineer it. WDYT?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/bin/cassandra.in.sh#L98-L111&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/trunk/bin/cassandra.in.sh#L98-L111&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17807855" author="paulo" created="Wed, 17 Jan 2024 19:01:27 +0000"  >&lt;blockquote&gt;&lt;p&gt;If JAVA_HOME is not defined, Cassandra checks what is in PATH first. Do we expect users to do more modifications to PATH to adhere? It sounds a bit risky to me; I hope I do not overengineer it. WDYT?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;As far as I understand there is no reliable way to detect if there&apos;s a local JDK other than check if javac exists in JAVA_HOME or PATH. So the only way to figure out if the user is running on a JDK is to to check if javac exists in JAVA_HOME/bin first, if not check on PATH - this does not look like overengineering to me. What do you mean by &quot;expect users to do more modifications to PATH to adhere&quot;?&lt;/p&gt;</comment>
                            <comment id="17807935" author="edimitrova" created="Wed, 17 Jan 2024 23:40:20 +0000"  >&lt;p&gt;Rebased the branch, squashed commits:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/pull/3050/files&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/3050/files&lt;/a&gt; --&amp;gt; this is the final PR for 5.0&lt;/p&gt;

&lt;p&gt;If there are no more concerns I will run CI for both 5.0 and trunk tomorrow. (the patch will be the same for 5.0 and trunk)&lt;/p&gt;

&lt;p&gt;We will consider there is 1 JDK/JRE set on the PATH or JAVA_HOME being set or during development.&lt;/p&gt;</comment>
                            <comment id="17808268" author="edimitrova" created="Thu, 18 Jan 2024 15:26:08 +0000"  >&lt;p&gt;Got a GO from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=paulo&quot; class=&quot;user-hover&quot; rel=&quot;paulo&quot;&gt;paulo&lt;/a&gt; in Slack.&#160;&lt;/p&gt;

&lt;p&gt;Started CI here:&lt;/p&gt;

&lt;p&gt;5.0 - &lt;a href=&quot;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra?branch=19001-final&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra?branch=19001-final&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;trunk - &lt;a href=&quot;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra?branch=19001-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra?branch=19001-trunk&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I will check the results later.&#160;&lt;/p&gt;</comment>
                            <comment id="17808363" author="edimitrova" created="Thu, 18 Jan 2024 20:26:33 +0000"  >&lt;p&gt;All known failures:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;5.0:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;testLocalSerialLocalCommit-_jdk11 -&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-18851&quot; title=&quot;Test failure: junit.framework.TestSuite.org.apache.cassandra.distributed.test.CASMultiDCTest.testLocalSerialLocalCommit&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-18851&quot;&gt;CASSANDRA-18851&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;test_shutdown_wiped_node_cannot_join - fix was committed today, &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-19097&quot; title=&quot;Test Failure: bootstrap_test.TestBootstrap.*&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-19097&quot;&gt;&lt;del&gt;CASSANDRA-19097&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;testSparseMode-_jdk17 -&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-13169&quot; title=&quot;Test failure: org.apache.cassandra.index.sasi.disk.OnDiskIndexTest.testSparseMode-compression&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-13169&quot;&gt;CASSANDRA-13169&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;trunk:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;org.apache.cassandra.distributed.test.NativeTransportEncryptionOptionsTest -&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-19239&quot; title=&quot;jvm-dtests crash on java 17&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-19239&quot;&gt;CASSANDRA-19239&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Two simulator tests that are around out of memory and assertion error do not have associated tickets, but there is no way they are related to the startup changes we applied here - &lt;a href=&quot;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/2618/workflows/d0580d00-335d-4516-982b-624cfb3a1033/jobs/52854/tests#failed-test-0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/2618/workflows/d0580d00-335d-4516-982b-624cfb3a1033/jobs/52854/tests#failed-test-0&lt;/a&gt; I will open follow-up tickets for them.&#160;&lt;/p&gt;


&lt;p&gt;With all that said, I can commit this one tonight if nothing more is reported.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17808383" author="edimitrova" created="Thu, 18 Jan 2024 22:32:21 +0000"  >&lt;p&gt;I managed to reproduce the two simulator test failures on trunk without this patch; respective tickets opened:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-19279&quot; title=&quot;Test Failure: org.apache.cassandra.simulator.test.HarrySimulatorTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-19279&quot;&gt;&lt;del&gt;CASSANDRA-19279&lt;/del&gt;&lt;/a&gt; and&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-19280&quot; title=&quot;Test Failure: org.apache.cassandra.simulator.test.ShortPaxosSimulationTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-19280&quot;&gt;CASSANDRA-19280&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17808828" author="edimitrova" created="Fri, 19 Jan 2024 23:38:05 +0000"  >&lt;p&gt;I will commit this patch but keep the ticket open as I believe there is part 2. Packaging?&lt;br/&gt;
I see some differences between bin/cassandra.in.sh and redhat/cassandra.in.sh and it seems the debian diff on 5.0 was updated once in 2020 since it was created in 2019.&lt;br/&gt;
I am questioning my understanding around those files and how/ when we update them. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mck&quot; class=&quot;user-hover&quot; rel=&quot;mck&quot;&gt;mck&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt;, can you help me understand whether I should update those and, in general, when they are updated? Or were they just missed being updated in time? &lt;/p&gt;</comment>
                            <comment id="17808832" author="brandon.williams" created="Fri, 19 Jan 2024 23:48:03 +0000"  >&lt;p&gt;I don&apos;t think packaging should need this, since it controls the jre/jdk versions used already.  Given that, it&apos;s probably not material for the redhat in.sh to be updated here and the debian version is always updated and patched each time (though perhaps with fuzz now.)&lt;/p&gt;

&lt;p&gt;That said, we don&apos;t regularly update them unless it&apos;s necessary, so we could take this opportunity to do so.&lt;/p&gt;</comment>
                            <comment id="17808843" author="edimitrova" created="Sat, 20 Jan 2024 00:16:21 +0000"  >&lt;p&gt;I received an approval from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=paulo&quot; class=&quot;user-hover&quot; rel=&quot;paulo&quot;&gt;paulo&lt;/a&gt; in Slack to commit the current patch.&lt;br/&gt;
Done here:&lt;br/&gt;
To &lt;a href=&quot;https://github.com/apache/cassandra.git&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra.git&lt;/a&gt;&lt;br/&gt;
   &lt;a href=&quot;https://github.com/apache/cassandra/commit/9f5e45e5a21af2049b8874cd1663668059848f03&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;8fd44ca8fc..9f5e45e5a2 &lt;/a&gt;  cassandra-5.0 -&amp;gt; cassandra-5.0&lt;br/&gt;
   &lt;a href=&quot;https://github.com/apache/cassandra/commit/aa644c9dfa6680c73a9400f295f450b623dee784&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;03f0d37cb0..aa644c9dfa &lt;/a&gt;  trunk -&amp;gt; trunk&lt;/p&gt;</comment>
                            <comment id="17809421" author="smiklosovic" created="Mon, 22 Jan 2024 12:41:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=e.dimitrova&quot; class=&quot;user-hover&quot; rel=&quot;e.dimitrova&quot;&gt;e.dimitrova&lt;/a&gt; shouldn&apos;t be this ticket closed?&lt;/p&gt;</comment>
                            <comment id="17809464" author="edimitrova" created="Mon, 22 Jan 2024 14:12:07 +0000"  >&lt;blockquote&gt;&lt;p&gt;I don&apos;t think packaging should need this, since it controls the jre/jdk versions used already.&#160;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt;, I am not sure I understand you correctly. We do not control jdk/jre as part of the committed patch. We detect whether we use JDK or JRE and add necessary options in case it is JDK.&#160;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;That said, we don&apos;t regularly update them unless it&apos;s necessary, so we could take this opportunity to do so.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Opening a ticket to check those files on 4.0+ and clear all inconsistencies is good. WDYT?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=e.dimitrova&quot; class=&quot;user-hover&quot; rel=&quot;e.dimitrova&quot;&gt;e.dimitrova&lt;/a&gt;&#160;shouldn&apos;t be this ticket closed?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;There is a discussion about whether we need to patch also the rpm and debian packages, too. Thus, I left it open until we figure it out. &lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17809551" author="brandon.williams" created="Mon, 22 Jan 2024 16:26:05 +0000"  >&lt;blockquote&gt;&lt;p&gt;We detect whether we use JDK or JRE and add necessary options in case it is JDK. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We only install the JRE in packaging, but there is nothing to preclude someone from installing the JDK too, so now is good time to update the scripts in the packaging.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Opening a ticket to check those files on 4.0+ and clear all inconsistencies is good. WDYT?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sure, and I&apos;m happy to take that one.&lt;/p&gt;</comment>
                            <comment id="17809556" author="edimitrova" created="Mon, 22 Jan 2024 16:34:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-19283&quot; title=&quot;Update rpm and debian shell includes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-19283&quot;&gt;&lt;del&gt;CASSANDRA-19283&lt;/del&gt;&lt;/a&gt; was opened to facilitate the effort. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13545466">CASSANDRA-18711</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310760">
                    <name>Testing</name>
                                            <outwardlinks description="Testing discovered">
                                        <issuelink>
            <issuekey id="13565686">CASSANDRA-19283</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[edimitrova]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="13660" cascade-level=""><![CDATA[Packaging]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12969"><![CDATA[User Report]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 42 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1lelk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[e.dimitrova]]></customfieldvalue>
        <customfieldvalue><![CDATA[paulo]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12353513">5.0-alpha1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;To &lt;a href=&quot;https://github.com/apache/cassandra.git&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra.git&lt;/a&gt; 8fd44ca8fc..9f5e45e5a2 cassandra-5.0 -&amp;gt; cassandra-5.0 03f0d37cb0..aa644c9dfa trunk -&amp;gt; trunk&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/pull/3050/files&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/3050/files&lt;/a&gt; 5.0&lt;br/&gt;
The patch for trunk will be the same&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>