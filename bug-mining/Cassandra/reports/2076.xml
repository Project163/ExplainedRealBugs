<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:37:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-4021] CFS.scrubDataDirectories tries to delete nonexistent orphans</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-4021</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;The check only looks for a missing data file, then deletes all other components, however it&apos;s possible for the data file and another component to be missing, causing an error:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;
 WARN 17:19:28,765 Removing orphans for /var/lib/cassandra/data/system/HintsColumnFamily/system-HintsColumnFamily-hd-24492: [Index.db, Filter.db, Digest.sha1, Statistics.db, Data.db]
ERROR 17:19:28,766 Exception encountered during startup
java.lang.AssertionError: attempted to delete non-existing file system-HintsColumnFamily-hd-24492-Index.db
        at org.apache.cassandra.io.util.FileUtils.deleteWithConfirm(FileUtils.java:49)
        at org.apache.cassandra.io.util.FileUtils.deleteWithConfirm(FileUtils.java:44)
        at org.apache.cassandra.db.ColumnFamilyStore.scrubDataDirectories(ColumnFamilyStore.java:357)
        at org.apache.cassandra.service.AbstractCassandraDaemon.setup(AbstractCassandraDaemon.java:167)
        at org.apache.cassandra.service.AbstractCassandraDaemon.activate(AbstractCassandraDaemon.java:352)
        at org.apache.cassandra.thrift.CassandraDaemon.main(CassandraDaemon.java:105)
java.lang.AssertionError: attempted to delete non-existing file system-HintsColumnFamily-hd-24492-Index.db
        at org.apache.cassandra.io.util.FileUtils.deleteWithConfirm(FileUtils.java:49)
        at org.apache.cassandra.io.util.FileUtils.deleteWithConfirm(FileUtils.java:44)
        at org.apache.cassandra.db.ColumnFamilyStore.scrubDataDirectories(ColumnFamilyStore.java:357)
        at org.apache.cassandra.service.AbstractCassandraDaemon.setup(AbstractCassandraDaemon.java:167)
        at org.apache.cassandra.service.AbstractCassandraDaemon.activate(AbstractCassandraDaemon.java:352)
        at org.apache.cassandra.thrift.CassandraDaemon.main(CassandraDaemon.java:105)
Exception encountered during startup: attempted to delete non-existing file system-HintsColumnFamily-hd-24492-Index.db
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12545682">CASSANDRA-4021</key>
            <summary>CFS.scrubDataDirectories tries to delete nonexistent orphans</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yulinyen">Boris Yen</assignee>
                                    <reporter username="brandon.williams">Brandon Williams</reporter>
                        <labels>
                            <label>datastax_qa</label>
                    </labels>
                <created>Thu, 8 Mar 2012 17:22:50 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:37 +0000</updated>
                            <resolved>Mon, 11 Mar 2013 23:16:32 +0000</resolved>
                                        <fixVersion>1.1.11</fixVersion>
                    <fixVersion>1.2.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="13225496" author="brandon.williams" created="Thu, 8 Mar 2012 20:59:45 +0000"  >&lt;p&gt;Apparently this goes all the way back to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1471&quot; title=&quot;Improve SSTable discovery and allow for more components&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1471&quot;&gt;&lt;del&gt;CASSANDRA-1471&lt;/del&gt;&lt;/a&gt; but occurs very rarely.  Patch to attempt deletion without caring about success.&lt;/p&gt;</comment>
                            <comment id="13225669" author="jbellis" created="Thu, 8 Mar 2012 23:25:58 +0000"  >&lt;p&gt;The reasoning is that since the data component is written (renamed) last, the others should be there too if the data is.&lt;/p&gt;</comment>
                            <comment id="13225671" author="brandon.williams" created="Thu, 8 Mar 2012 23:29:10 +0000"  >&lt;p&gt;Aren&apos;t we actually firing this when the data does not exist, though?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (components.contains(Component.DATA) &amp;amp;&amp;amp; dataFile.length() &amp;gt; 0)
                &lt;span class=&quot;code-comment&quot;&gt;// everything appears to be in order... moving on.
&lt;/span&gt;                &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;

            &lt;span class=&quot;code-comment&quot;&gt;// missing the DATA file! all components are orphaned&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13227275" author="jbellis" created="Sun, 11 Mar 2012 23:59:50 +0000"  >&lt;p&gt;Not sure what you mean &amp;#8211; since data file is renamed last, it&apos;s normal (if the process was killed mid-flush) for components to exist without a data file.  But I can&apos;t think of a situation that would cause the inverse.  Are we perhaps deleting things asynchronously somewhere?&lt;/p&gt;</comment>
                            <comment id="13227276" author="brandon.williams" created="Mon, 12 Mar 2012 00:11:59 +0000"  >&lt;p&gt;I&apos;m not sure how this happened, I tried to repro artificially and wasn&apos;t able to.  Originally what happened is I was testing a patch that threw a TON of errors (all time was spent in logging), and after a ctrl-c and restart this happened.&lt;/p&gt;

&lt;p&gt;Is it really important to confirm the deletion here?  Being unable to start rather sucks.&lt;/p&gt;</comment>
                            <comment id="13242172" author="slebresne" created="Fri, 30 Mar 2012 09:08:25 +0000"  >&lt;p&gt;What&apos;s weird is that the INDEX component was clearly found at the beginning of scrubDataDirectories, but didn&apos;t existed anymore when we tried the deletion. However, this happens during AbstractDaemon.setup() so I don&apos;t think there can be any concurrent process deleting the file. Anyway, I don&apos;t thing the delete confirmation is very important but I&apos;m not fond of changing code when we don&apos;t understand what&apos;s going on. At least as long as nobody have reproduced without using a buggy patch initially.&lt;/p&gt;</comment>
                            <comment id="13242484" author="brandon.williams" created="Fri, 30 Mar 2012 16:00:51 +0000"  >&lt;p&gt;FWIW, there has been another case of this reported, but it was on Windows.&lt;/p&gt;</comment>
                            <comment id="13244695" author="jbellis" created="Mon, 2 Apr 2012 21:49:33 +0000"  >&lt;p&gt;I don&apos;t suppose you have a log file for that case?&lt;/p&gt;</comment>
                            <comment id="13425279" author="rcoli" created="Mon, 30 Jul 2012 21:46:37 +0000"  >&lt;p&gt;Trival repro case for something similar :&lt;/p&gt;

&lt;p&gt;1) create file named something-that-looks-like-a-sstable-but-isn&apos;t, for example the tablesnap-created filename &quot;ObfuscatedCF-hd-8813-Statistics.db-listdir.json&quot;, which users of tablesnap are relatively likely to accidentally have in their datadir.&lt;/p&gt;

&lt;p&gt;2) stop node.&lt;/p&gt;

&lt;p&gt;3) start.&lt;/p&gt;

&lt;p&gt;This case seems like an issue with the sstable identifying code, real sstables names don&apos;t end with random strings like &quot;-listdir.json&quot;. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13425285" author="jbellis" created="Mon, 30 Jul 2012 21:49:47 +0000"  >&lt;p&gt;My mind boggles that you appear to expect Cassandra to cope with arbitrary user-created files in the directories it is supposed to have control over.&lt;/p&gt;</comment>
                            <comment id="13425340" author="rcoli" created="Mon, 30 Jul 2012 22:48:41 +0000"  >&lt;p&gt;I don&apos;t especially &quot;expect&quot; Cassandra to cope with arbitrary user-created files in the directories it is supposed to have control over. The purpose of my comment was primarily to assist any other operator who might have accidentally created such a file, who would then google the exception and be confused because this ticket was marked no-repro.&lt;/p&gt;

&lt;p&gt;However.. the comment for scrubDataDirectories says the following :&lt;br/&gt;
&quot;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Removes unnecessary files from the cf directory at startup: these include temp files, orphans, zero-length files&lt;/li&gt;
	&lt;li&gt;and compacted sstables. Files that cannot be recognized will be ignored.&lt;br/&gt;
&quot;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So it is a goal to &quot;recognize&quot; files properly, and to &quot;ignore&quot; files that are not &quot;recognized&quot; properly.&lt;/p&gt;

&lt;p&gt;Further in the code we see..&lt;br/&gt;
&quot;&lt;br/&gt;
if (!&quot;snapshots&quot;.equals(name) &amp;amp;&amp;amp; !&quot;backups&quot;.equals(name) &amp;amp;&amp;amp; !name.contains(&quot;.json&quot;))&lt;br/&gt;
&quot;&lt;/p&gt;

&lt;p&gt;Which suggests that had my file not happened to have had suffix .json, it would have been &quot;recognized&quot; and at least logged an error about being an invalid file, even if it were not &quot;ignored,&quot; I would have had a chance of reading a relevant log message ...&lt;/p&gt;

&lt;p&gt;I agree that the practice of creating arbitrary files named like sstables, but with an additional &quot;-&quot; in them should be considered hazardous!&lt;/p&gt;

&lt;p&gt;But as we can easily &quot;recognize&quot; that any file with more &quot;-&quot; delimited elements in them than possible are not sstables, I continue to suggest that the user might prefer to discover this before Cassandra has tried and failed to treat such a file as a sstable, and refused to start as a result of trying to scrub the broken sstable. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13488504" author="yulinyen" created="Thu, 1 Nov 2012 06:35:48 +0000"  >&lt;p&gt;We also see similar error message, but it is not about the &apos;index&apos;. We are using 1.0.10.&lt;/p&gt;

&lt;p&gt;WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2012-09-05 08:32:01,804 ColumnFamilyStore.java (line 383) Removing orphans for /opt/ruckuswireless/wsg/db/data/wsg/inventorySummary-hd-91: &lt;span class=&quot;error&quot;&gt;&amp;#91;Statistics.db, Filter.db, Digest.sha1, Data.db, Index.db&amp;#93;&lt;/span&gt;&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2012-09-05 08:32:01,805 AbstractCassandraDaemon.java (line 373) Exception encountered during startup&lt;br/&gt;
java.lang.AssertionError: attempted to delete non-existing file inventorySummary-hd-91-Digest.sha1&lt;br/&gt;
	at org.apache.cassandra.io.util.FileUtils.deleteWithConfirm(FileUtils.java:49)&lt;br/&gt;
	at org.apache.cassandra.io.util.FileUtils.deleteWithConfirm(FileUtils.java:44)&lt;br/&gt;
	at org.apache.cassandra.db.ColumnFamilyStore.scrubDataDirectories(ColumnFamilyStore.java:388)&lt;br/&gt;
	at org.apache.cassandra.service.AbstractCassandraDaemon.setup(AbstractCassandraDaemon.java:193)&lt;br/&gt;
	at org.apache.cassandra.service.AbstractCassandraDaemon.activate(AbstractCassandraDaemon.java:356)&lt;br/&gt;
	at org.apache.cassandra.thrift.CassandraDaemon.main(CassandraDaemon.java:107)&lt;/p&gt;

&lt;p&gt;I was wondering if anyone could confirm that this is the same issue.&lt;/p&gt;</comment>
                            <comment id="13489061" author="brandon.williams" created="Thu, 1 Nov 2012 21:51:02 +0000"  >&lt;p&gt;It looks similar, what kind of environment was this in?&lt;/p&gt;</comment>
                            <comment id="13489182" author="yulinyen" created="Fri, 2 Nov 2012 00:50:15 +0000"  >&lt;p&gt;OS:&lt;br/&gt;
Linux TEST1 2.6.32.24 #1 SMP Wed Oct 3 14:51:26 CST 2012 x86_64 GNU/Linux&lt;/p&gt;

&lt;p&gt;Hardware:&lt;br/&gt;
24 cores, 48G memory, 12G for heap. &lt;/p&gt;

&lt;p&gt;The first time we saw this was after the server was shutdown abruptly (due to the hardware issue). We have not seen the same issue for a while. However, it happened again just a few days ago. Unfortunately, we could not find a consistent way to reproduce it.&lt;/p&gt;</comment>
                            <comment id="13491474" author="brandon.williams" created="Tue, 6 Nov 2012 14:19:37 +0000"  >&lt;p&gt;dtestbot managed to randomly reproduce this morning.  It looks like a race between compaction cleanup and forcible shutdown, then startup.  Log attached.&lt;/p&gt;</comment>
                            <comment id="13492021" author="yulinyen" created="Wed, 7 Nov 2012 01:12:42 +0000"  >&lt;p&gt;I might be wrong. From the log, it looks like C* is started twice in a row. Is this a possible cause? Anyway to workaround this?&lt;/p&gt;</comment>
                            <comment id="13495662" author="jbellis" created="Mon, 12 Nov 2012 21:49:47 +0000"  >&lt;p&gt;That&apos;s odd, because here&apos;s the code causing that assertion:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;.           File dataFile = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(desc.filenameFor(Component.DATA));
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (components.contains(Component.DATA) &amp;amp;&amp;amp; dataFile.length() &amp;gt; 0)
                &lt;span class=&quot;code-comment&quot;&gt;// everything appears to be in order... moving on.
&lt;/span&gt;                &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;

            &lt;span class=&quot;code-comment&quot;&gt;// missing the DATA file! all components are orphaned
&lt;/span&gt;            logger.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Removing orphans &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; {}: {}&quot;&lt;/span&gt;, desc, components);
            &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (Component component : components)
            {
                FileUtils.deleteWithConfirm(desc.filenameFor(component));
            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I must be missing something because these are the possibilities I see:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;.db exists and is non-empty.  we don&apos;t try to delete it.&lt;/li&gt;
	&lt;li&gt;.db exists and is empty.  we delete it, and do not get a &quot;file does not exist&quot; failure&lt;/li&gt;
	&lt;li&gt;.db does not exist (is not part of components), so we do not try to delete it&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="13559766" author="brandon.williams" created="Tue, 22 Jan 2013 16:47:46 +0000"  >&lt;p&gt;Saw this in the wild again.  It was encountered multiple times on the same component set preventing startup, in the following order: CompressionInfo, CompressionInfo, Index, CompressionInfo, CompressionInfo.  After that, it was finally able to startup so we weren&apos;t able to see which components existed or did not, but it looks like it does make incremental progress on the deletions with each restart.  I don&apos;t want to paper over something without understanding what&apos;s going on here, but it&apos;s highly annoying and visible when this error is fatal.  We aren&apos;t making progress here too quickly, so maybe in the interim we should add more logging around this and log something at ERROR instead of dying.&lt;/p&gt;</comment>
                            <comment id="13561870" author="sgpope" created="Thu, 24 Jan 2013 19:06:38 +0000"  >&lt;p&gt;Saw this today on one of our test machine. Windows box with Cassandra 1.1.5. It would be nice to have it log and continue instead of puking. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; On the bright side, it does make progress every time upon startup and eventually starts fine. Haven&apos;t been able to reproduce it since. Log:&lt;/p&gt;

&lt;p&gt;WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2013-01-24 13:01:50,480 ColumnFamilyStore.java (line 393) Removing orphans for C:\Program Files\Quest Software\MessageStats Business Insights\Storage\data\Doradus\MS_1_MessageParticipantPair_Terms\Doradus-MS_1_MessageParticipantPair_Terms-he-31: &lt;span class=&quot;error&quot;&gt;&amp;#91;Statistics.db, Filter.db, Digest.sha1, Data.db, Index.db&amp;#93;&lt;/span&gt;&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2013-01-24 13:01:50,480 AbstractCassandraDaemon.java (line 406) Exception encountered during startup&lt;br/&gt;
java.lang.AssertionError: attempted to delete non-existing file Doradus-MS_1_MessageParticipantPair_Terms-he-31-Filter.db&lt;br/&gt;
                at org.apache.cassandra.io.util.FileUtils.deleteWithConfirm(FileUtils.java:68)&lt;br/&gt;
                at org.apache.cassandra.io.util.FileUtils.deleteWithConfirm(FileUtils.java:63)&lt;br/&gt;
                at org.apache.cassandra.db.ColumnFamilyStore.scrubDataDirectories(ColumnFamilyStore.java:398)&lt;br/&gt;
                at org.apache.cassandra.service.AbstractCassandraDaemon.setup(AbstractCassandraDaemon.java:196)&lt;br/&gt;
                at org.apache.cassandra.service.AbstractCassandraDaemon.activate(AbstractCassandraDaemon.java:389)&lt;br/&gt;
                at org.apache.cassandra.thrift.CassandraDaemon.main(CassandraDaemon.java:106)&lt;br/&gt;
WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2013-01-24 13:35:32,656 ColumnFamilyStore.java (line 393) Removing orphans for C:\Program Files\Quest Software\MessageStats Business Insights\Storage\data\Doradus\MS_1_MessageParticipantPair_Terms\Doradus-MS_1_MessageParticipantPair_Terms-he-31: &lt;span class=&quot;error&quot;&gt;&amp;#91;Data.db, Digest.sha1, Filter.db, Index.db&amp;#93;&lt;/span&gt;&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2013-01-24 13:35:32,656 AbstractCassandraDaemon.java (line 406) Exception encountered during startup&lt;br/&gt;
java.lang.AssertionError: attempted to delete non-existing file Doradus-MS_1_MessageParticipantPair_Terms-he-31-Data.db&lt;br/&gt;
                at org.apache.cassandra.io.util.FileUtils.deleteWithConfirm(FileUtils.java:68)&lt;br/&gt;
                at org.apache.cassandra.io.util.FileUtils.deleteWithConfirm(FileUtils.java:63)&lt;br/&gt;
                at org.apache.cassandra.db.ColumnFamilyStore.scrubDataDirectories(ColumnFamilyStore.java:398)&lt;br/&gt;
                at org.apache.cassandra.service.AbstractCassandraDaemon.setup(AbstractCassandraDaemon.java:196)&lt;br/&gt;
                at org.apache.cassandra.service.AbstractCassandraDaemon.activate(AbstractCassandraDaemon.java:389)&lt;br/&gt;
                at org.apache.cassandra.thrift.CassandraDaemon.main(CassandraDaemon.java:106)&lt;br/&gt;
WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2013-01-24 13:35:44,559 ColumnFamilyStore.java (line 393) Removing orphans for C:\Program Files\Quest Software\MessageStats Business Insights\Storage\data\Doradus\MS_1_MessageParticipantPair_Terms\Doradus-MS_1_MessageParticipantPair_Terms-he-31: &lt;span class=&quot;error&quot;&gt;&amp;#91;Index.db, Digest.sha1, Data.db, Filter.db&amp;#93;&lt;/span&gt;&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2013-01-24 13:35:44,559 AbstractCassandraDaemon.java (line 406) Exception encountered during startup&lt;br/&gt;
java.lang.AssertionError: attempted to delete non-existing file Doradus-MS_1_MessageParticipantPair_Terms-he-31-Data.db&lt;br/&gt;
                at org.apache.cassandra.io.util.FileUtils.deleteWithConfirm(FileUtils.java:68)&lt;br/&gt;
                at org.apache.cassandra.io.util.FileUtils.deleteWithConfirm(FileUtils.java:63)&lt;br/&gt;
                at org.apache.cassandra.db.ColumnFamilyStore.scrubDataDirectories(ColumnFamilyStore.java:398)&lt;br/&gt;
                at org.apache.cassandra.service.AbstractCassandraDaemon.setup(AbstractCassandraDaemon.java:196)&lt;br/&gt;
                at org.apache.cassandra.service.AbstractCassandraDaemon.activate(AbstractCassandraDaemon.java:389)&lt;br/&gt;
                at org.apache.cassandra.thrift.CassandraDaemon.main(CassandraDaemon.java:106)&lt;/p&gt;</comment>
                            <comment id="13594321" author="yulinyen" created="Wed, 6 Mar 2013 03:50:16 +0000"  >&lt;p&gt;We saw this issue again on 1.0.10. It seems this happens when the file-name-change after compaction is not completed. The following are the sstables on our file system and the error we saw (the -ea option is removed):&lt;/p&gt;

&lt;p&gt;&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-   1 byan admin 66305 Mar  5 10:07 indexBytes-hd-111-Data.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-   1 byan admin    67 Mar  5 10:07 indexBytes-hd-111-Digest.sha1&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-   1 byan admin  1936 Mar  5 10:07 indexBytes-hd-111-Filter.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-   1 byan admin   333 Mar  5 10:07 indexBytes-hd-111-Index.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-   1 byan admin  4336 Mar  5 10:07 indexBytes-hd-111-Statistics.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-   1 byan admin   240 Mar  5 12:50 indexBytes-hd-112-Data.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-   1 byan admin    67 Mar  5 12:50 indexBytes-hd-112-Digest.sha1&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-   1 byan admin    16 Mar  5 12:50 indexBytes-hd-112-Filter.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-   1 byan admin    32 Mar  5 12:50 indexBytes-hd-112-Index.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-   1 byan admin  4336 Mar  5 12:50 indexBytes-hd-112-Statistics.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-   1 byan admin   240 Mar  5 15:18 indexBytes-hd-113-Data.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-   1 byan admin    67 Mar  5 15:18 indexBytes-hd-113-Digest.sha1&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-   1 byan admin    16 Mar  5 15:18 indexBytes-hd-113-Filter.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-   1 byan admin    32 Mar  5 15:18 indexBytes-hd-113-Index.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-   1 byan admin  4336 Mar  5 15:18 indexBytes-hd-113-Statistics.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-   1 byan admin   120 Mar  5 15:26 indexBytes-hd-114-Data.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-   1 byan admin    67 Mar  5 15:26 indexBytes-hd-114-Digest.sha1&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-   1 byan admin    16 Mar  5 15:26 indexBytes-hd-114-Filter.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-   1 byan admin    16 Mar  5 15:26 indexBytes-hd-114-Index.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-   1 byan admin  4336 Mar  5 15:26 indexBytes-hd-114-Statistics.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-   1 byan admin   333 Mar  5 15:26 indexBytes-hd-115-Index.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-   1 byan admin 66305 Mar  5 15:26 indexBytes-tmp-hd-115-Data.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-   1 byan admin    67 Mar  5 15:26 indexBytes-tmp-hd-115-Digest.sha1&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-   1 byan admin  1936 Mar  5 15:26 indexBytes-tmp-hd-115-Filter.db&lt;/p&gt;

&lt;p&gt;WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2013-03-05 10:43:22,494 ColumnFamilyStore.java (line 383) Removing orphans for /opt/test/tt/indexBytes-hd-115: &lt;span class=&quot;error&quot;&gt;&amp;#91;Digest.sha1, Index.db, Filter.db, Data.db&amp;#93;&lt;/span&gt;&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2013-03-05 10:43:22,494 AbstractCassandraDaemon.java (line 373) Exception encountered during startup&lt;br/&gt;
java.io.IOError: java.io.IOException: Failed to delete /opt/test/tt/indexBytes-hd-115-Digest.sha1&lt;br/&gt;
	at org.apache.cassandra.db.ColumnFamilyStore.scrubDataDirectories(ColumnFamilyStore.java:392)&lt;br/&gt;
	at org.apache.cassandra.service.AbstractCassandraDaemon.setup(AbstractCassandraDaemon.java:193)&lt;br/&gt;
	at org.apache.cassandra.service.AbstractCassandraDaemon.activate(AbstractCassandraDaemon.java:356)&lt;br/&gt;
	at org.apache.cassandra.thrift.CassandraDaemon.main(CassandraDaemon.java:107)&lt;br/&gt;
Caused by: java.io.IOException: Failed to delete /opt/ruckuswireless/wsg/db/data/wsg/indexBytes-hd-115-Digest.sha1&lt;br/&gt;
	at org.apache.cassandra.io.util.FileUtils.deleteWithConfirm(FileUtils.java:54)&lt;br/&gt;
	at org.apache.cassandra.io.util.FileUtils.deleteWithConfirm(FileUtils.java:44)&lt;br/&gt;
	at org.apache.cassandra.db.ColumnFamilyStore.scrubDataDirectories(ColumnFamilyStore.java:388)&lt;br/&gt;
	... 3 more&lt;/p&gt;


&lt;p&gt;It seems the &quot;Descriptor&quot; does not take the &quot;temporary&quot; flag into account in the &quot;hash&quot; and &quot;equals&quot; function. I was wondering if anyone could confirm this.&lt;/p&gt;</comment>
                            <comment id="13599460" author="jbellis" created="Mon, 11 Mar 2013 23:15:33 +0000"  >&lt;p&gt;Committed Boris&apos;s patch from the dev list (attached).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12624099">CASSANDRA-5071</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12517607" name="4021.txt" size="859" author="brandon.williams" created="Thu, 8 Mar 2012 20:59:45 +0000"/>
                            <attachment id="12552274" name="node1.log" size="23621" author="brandon.williams" created="Tue, 6 Nov 2012 14:19:37 +0000"/>
                            <attachment id="12573208" name="patch_4021.txt" size="1242" author="jbellis" created="Mon, 11 Mar 2013 23:15:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[yulinyen]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>230865</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 37 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0dvbb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>79002</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>