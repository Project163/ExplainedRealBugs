<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:29:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-19398] Test Failure: org.apache.cassandra.distributed.test.UpgradeSSTablesTest.truncateWhileUpgrading</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-19398</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/2646/workflows/bc2bba74-9e56-4bea-8de7-4ff840c4f450/jobs/56028/tests#failed-test-0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/2646/workflows/bc2bba74-9e56-4bea-8de7-4ff840c4f450/jobs/56028/tests#failed-test-0&lt;/a&gt;&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
junit.framework.AssertionFailedError at org.apache.cassandra.distributed.test.UpgradeSSTablesTest.truncateWhileUpgrading(UpgradeSSTablesTest.java:220) at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13568453">CASSANDRA-19398</key>
            <summary>Test Failure: org.apache.cassandra.distributed.test.UpgradeSSTablesTest.truncateWhileUpgrading</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bereng">Berenguer Blasi</assignee>
                                    <reporter username="edimitrova">Ekaterina Dimitrova</reporter>
                        <labels>
                    </labels>
                <created>Wed, 14 Feb 2024 16:14:29 +0000</created>
                <updated>Fri, 10 Oct 2025 08:47:58 +0000</updated>
                            <resolved>Wed, 6 Mar 2024 08:35:59 +0000</resolved>
                                        <fixVersion>5.0-rc1</fixVersion>
                    <fixVersion>5.0</fixVersion>
                    <fixVersion>5.1</fixVersion>
                                    <component>CI</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17817510" author="edimitrova" created="Wed, 14 Feb 2024 19:57:38 +0000"  >&lt;p&gt;Not reproduced on the commit that introduced the test:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
.circleci/generate.sh -h \ &#160; &#160;
&#160; -e REPEATED_UTEST_TARGET=test-jvm-dtest-some \
&#160; -e REPEATED_UTEST_CLASS=org.apache.cassandra.distributed.test.UpgradeSSTablesTest \
&#160; -e REPEATED_UTEST_METHODS=truncateWhileUpgrading \
&#160; -e REPEATED_UTEST_COUNT=2000
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/2649/workflows/b9524d18-a142-4394-b6ee-f41fef6da93d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/2649/workflows/b9524d18-a142-4394-b6ee-f41fef6da93d&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Reproduced on current 5.0:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
.circleci/generate.sh -ps &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-e REPEATED_JVM_DTESTS=org.apache.cassandra.distributed.test.UpgradeSSTablesTest#truncateWhileUpgrading -e REPEATED_JVM_DTESTS_COUNT=2000&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra?branch=19398-5.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra?branch=19398-5.0&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17821463" author="brandon.williams" created="Wed, 28 Feb 2024 00:44:20 +0000"  >&lt;p&gt;This bisects to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-18645&quot; title=&quot;Upgrade guava on trunk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-18645&quot;&gt;&lt;del&gt;CASSANDRA-18645&lt;/del&gt;&lt;/a&gt;, which can be seen failing &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/1486/workflows/eb7d55c8-165a-45c9-84b8-001a9e9b603c/jobs/73902&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; but &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/1487/workflows/0c210947-133c-4ec0-945c-af064d74f691/jobs/74004&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;passing&lt;/a&gt; on the commit just before. I wasn&apos;t able to reproduce this locally in many thousands of runs which seems a bit odd, and circle doesn&apos;t have the actual logs but we can know from the assertion they contain &quot;Compaction interrupted&quot; but it still doesn&apos;t really make sense why the Guava upgrade would cause this.&lt;/p&gt;</comment>
                            <comment id="17821562" author="bereng" created="Wed, 28 Feb 2024 08:39:50 +0000"  >&lt;p&gt;I don&apos;t know about the bisect. But I think the test is flawed. For &quot;Compaction Interrupted&quot; to be in the logs both the upgradesstables and the truncate need to collide. Given the async execution of those there are no warranties this should be the case. So the test should, imo: wait for a compaction task to start and through some byteman latch then issue the truncate,... The Guava upgrade might just have tweaked the threading scheduling logic somewhere deep in the code making this failure just more probable now. Wdyt?&lt;/p&gt;</comment>
                            <comment id="17821591" author="bereng" created="Wed, 28 Feb 2024 09:59:54 +0000"  >&lt;p&gt;Probably a simple latch, even not byteman injected, and a good comment in case it fails on a very rare occasion could suffice.&lt;/p&gt;</comment>
                            <comment id="17821635" author="brandon.williams" created="Wed, 28 Feb 2024 12:28:07 +0000"  >&lt;blockquote&gt;&lt;p&gt;But I think the test is flawed. For &quot;Compaction Interrupted&quot; to be in the logs both the upgradesstables and the truncate need to collide. Given the async execution of those there are no warranties this should be the case. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think that makes sense. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ifesdjeen&quot; class=&quot;user-hover&quot; rel=&quot;ifesdjeen&quot;&gt;ifesdjeen&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jmckenzie&quot; class=&quot;user-hover&quot; rel=&quot;jmckenzie&quot;&gt;jmckenzie&lt;/a&gt; this was your test, does this make sense to you?&lt;/p&gt;</comment>
                            <comment id="17822226" author="brandon.williams" created="Thu, 29 Feb 2024 16:52:59 +0000"  >&lt;p&gt;Actually, it seems to me that running the upgradesstables and the truncate simultaneously is done on purpose, since the name of the test implies this and I think &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/test/distributed/org/apache/cassandra/distributed/test/UpgradeSSTablesTest.java#L219&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this get()&lt;/a&gt; would come before the truncate if they were intended to be run serially?  Maybe I don&apos;t know what I&apos;m talking about though since I did that and &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/1488/workflows/ee46995e-353f-4772-a3a5-c42e3554e260/jobs/74105/tests&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;everything failed&lt;/a&gt; for some reason that isn&apos;t clear to me.&lt;/p&gt;</comment>
                            <comment id="17823077" author="bereng" created="Mon, 4 Mar 2024 08:33:01 +0000"  >&lt;p&gt;Yes they are intended to be ran simultaneously imo as well. You just have no warranties that will be the case. The truncate might complete and the upgrade might have not even started yet i.e.&lt;/p&gt;</comment>
                            <comment id="17823255" author="brandon.williams" created="Mon, 4 Mar 2024 16:31:54 +0000"  >&lt;p&gt;I see what you mean, nothing is guaranteed whatsoever in the current state.&lt;/p&gt;</comment>
                            <comment id="17823568" author="bereng" created="Tue, 5 Mar 2024 11:11:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt; I stole this one from you as agreed. I have submitted byteman latches to make the test&apos;s behavior more deterministic. I &lt;em&gt;think&lt;/em&gt; that is correct unless the original authors say otherwise.&lt;/p&gt;</comment>
                            <comment id="17823587" author="brandon.williams" created="Tue, 5 Mar 2024 12:26:52 +0000"  >&lt;p&gt;This looks good to me if you want to start on trunk.  As you say you&apos;ve only made it more deterministic so I don&apos;t think there should be any problem with the approach.&lt;/p&gt;</comment>
                            <comment id="17823622" author="bereng" created="Tue, 5 Mar 2024 13:43:51 +0000"  >&lt;p&gt;Added trunk which turned out green as well.&lt;/p&gt;</comment>
                            <comment id="17823665" author="brandon.williams" created="Tue, 5 Mar 2024 15:08:30 +0000"  >&lt;p&gt;Great job, +1&lt;/p&gt;</comment>
                            <comment id="17823910" author="bereng" created="Wed, 6 Mar 2024 08:36:09 +0000"  >&lt;p&gt;Thanks for the review&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13541767">CASSANDRA-18635</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310760">
                    <name>Testing</name>
                                                                <inwardlinks description="Discovered while testing">
                                        <issuelink>
            <issuekey id="13560611">CASSANDRA-19168</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[bereng]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
                                <customfieldvalue key="12990" cascade-level="1"><![CDATA[Test Failure]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12969"><![CDATA[User Report]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 35 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1ne8g:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12353512">5.0-rc</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/ebe07db6023493b4f0a1968af439fee1e664dbaf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/ebe07db6023493b4f0a1968af439fee1e664dbaf&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;See PR&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>