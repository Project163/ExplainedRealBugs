<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:17:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-16157] RTE during re-serialization for message filtering during 3.0 -&gt; 4.0 upgrade</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-16157</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;When trying to upgrade 3.0 to 4.0, we&#8217;re often running into a problem, if older node serves as a coordinator:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 15294 java.lang.RuntimeException: Can not deserialize message org.apache.cassandra.distributed.impl.MessageImpl@4c46aead
  15295         at org.apache.cassandra.distributed.impl.Instance.deserializeMessage(Instance.java:299) ~[dtest-4.0-beta3.jar:?]
  15296         at org.apache.cassandra.distributed.impl.Instance.lambda$receiveMessage$7(Instance.java:315) ~[dtest-4.0-beta3.jar:?]
  15297         at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) ~[?:1.8.0_232]
  15298         at java.util.concurrent.FutureTask.run(FutureTask.java:266) ~[?:1.8.0_232]
  15299         at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) ~[?:1.8.0_232]
  15300         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) ~[?:1.8.0_232]
  15301         at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [dtest-4.0-beta3.jar:?]
  15302         at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748) [?:1.8.0_232]
  15303 Caused by: java.io.EOFException
  15304         at org.apache.cassandra.io.util.RebufferingInputStream.readByte(RebufferingInputStream.java:180) ~[dtest-4.0-beta3.jar:?]
  15305         at org.apache.cassandra.utils.vint.VIntCoding.readUnsignedVInt(VIntCoding.java:68) ~[dtest-4.0-beta3.jar:?]
  15306         at org.apache.cassandra.io.util.RebufferingInputStream.readUnsignedVInt(RebufferingInputStream.java:243) ~[dtest-4.0-beta3.jar:?]
  15307         at org.apache.cassandra.net.Message$Serializer.deserializeHeaderPost40(Message.java:694) ~[dtest-4.0-beta3.jar:?]
  15308         at org.apache.cassandra.net.Message$Serializer.deserializePost40(Message.java:765) ~[dtest-4.0-beta3.jar:?]
  15309         at org.apache.cassandra.net.Message$Serializer.deserialize(Message.java:625) ~[dtest-4.0-beta3.jar:?]
  15310         at org.apache.cassandra.distributed.impl.Instance.deserializeMessage(Instance.java:295) ~[dtest-4.0-beta3.jar:?]
  15311         ... 7 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13330394">CASSANDRA-16157</key>
            <summary>RTE during re-serialization for message filtering during 3.0 -&gt; 4.0 upgrade</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ifesdjeen">Alex Petrov</assignee>
                                    <reporter username="ifesdjeen">Alex Petrov</reporter>
                        <labels>
                    </labels>
                <created>Thu, 1 Oct 2020 14:58:40 +0000</created>
                <updated>Sun, 3 Jan 2021 17:03:34 +0000</updated>
                            <resolved>Wed, 14 Oct 2020 08:59:25 +0000</resolved>
                                        <fixVersion>4.0-beta3</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Test/dtest/java</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17212213" author="ifesdjeen" created="Mon, 12 Oct 2020 08:03:31 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/pull/772&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/ifesdjeen/cassandra?branch=16157-npe-during-reserialization&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ci&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="17212755" author="yifanc" created="Tue, 13 Oct 2020 01:00:59 +0000"  >&lt;p&gt;I can produce the &lt;tt&gt;IllegalArgumentException&lt;/tt&gt; in the &lt;tt&gt;Instance#serializeMessage&lt;/tt&gt; code path by unapplying the patch. But I cannot reproduce the mentioned RTE in the &lt;tt&gt;deserializeMessage&lt;/tt&gt; code path. &lt;/p&gt;

&lt;p&gt;When applying the patch, the &lt;tt&gt;reserializationDuringUpgradeFrom30&lt;/tt&gt; test always passes. &lt;/p&gt;

&lt;p&gt;Beside, providing the &lt;tt&gt;toString&lt;/tt&gt; override in &lt;tt&gt;MessageImpl&lt;/tt&gt; to display the &lt;tt&gt;verb, id, version and from&lt;/tt&gt; can give better clarity in the exception message. For example, &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.RuntimeException: Can not deserialize message (verb: 1, id, 1, version: VERSION, from: IP)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17212761" author="dcapwell" created="Tue, 13 Oct 2020 01:27:04 +0000"  >&lt;p&gt;The other exception that happens is&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.IllegalArgumentException
		at org.apache.cassandra.net.NoPayload$1.serialize(NoPayload.java:40)
		at org.apache.cassandra.net.NoPayload$1.serialize(NoPayload.java:36)
		at org.apache.cassandra.net.Message$Serializer.serializePost40(Message.java:760)
		at org.apache.cassandra.net.Message$Serializer.serialize(Message.java:618)
		at org.apache.cassandra.distributed.impl.Instance.serializeMessage(Instance.java:291)
		at org.apache.cassandra.distributed.impl.Instance.lambda$registerInboundFilter$4(Instance.java:264)
		at org.apache.cassandra.net.InboundSink$Filtered.accept(InboundSink.java:62)
		at org.apache.cassandra.net.InboundSink$Filtered.accept(InboundSink.java:49)
		at org.apache.cassandra.net.InboundSink.accept(InboundSink.java:93)
		at org.apache.cassandra.distributed.impl.Instance.lambda$&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;$6(Instance.java:334)
		at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
		at java.util.concurrent.FutureTask.run(FutureTask.java:266)
		at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
		at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
		at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
		at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17212764" author="dcapwell" created="Tue, 13 Oct 2020 01:33:04 +0000"  >&lt;p&gt;Overall LGTM +1&lt;/p&gt;

&lt;p&gt;I left a comment about the test, it would be good to address it but fine if you do it before merging.  &lt;/p&gt;</comment>
                            <comment id="17213752" author="ifesdjeen" created="Wed, 14 Oct 2020 08:58:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yifanc&quot; class=&quot;user-hover&quot; rel=&quot;yifanc&quot;&gt;yifanc&lt;/a&gt; I&apos;ve added &lt;tt&gt;toString&lt;/tt&gt; to message. Thank you for reviewing!&lt;/p&gt;</comment>
                            <comment id="17213753" author="ifesdjeen" created="Wed, 14 Oct 2020 08:59:25 +0000"  >&lt;p&gt;Committed to trunk with &lt;a href=&quot;https://github.com/apache/cassandra/commit/5be83b6a72695253c552535d2b826209f144cc63&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;5be83b6a72695253c552535d2b826209f144cc63&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="13335018">CASSANDRA-16207</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13316170">CASSANDRA-15935</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[ifesdjeen]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12983" cascade-level=""><![CDATA[Availability]]></customfieldvalue>
                                <customfieldvalue key="12994" cascade-level="1"><![CDATA[Unavailable]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12970"><![CDATA[Unit Test]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 4 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0j34o:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[dcapwell]]></customfieldvalue>
        <customfieldvalue><![CDATA[yifanc]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12348285">4.0-beta1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/5be83b6a72695253c552535d2b826209f144cc63&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/5be83b6a72695253c552535d2b826209f144cc63&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;Test included&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>