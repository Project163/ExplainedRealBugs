<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:15:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-1353] commit log recovery is broken when the CL contains mutations to CFs that have been dropped</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-1353</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;This was working, so the fix should include a RecoveryManager test that checks for regressions.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12470756">CASSANDRA-1353</key>
            <summary>commit log recovery is broken when the CL contains mutations to CFs that have been dropped</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gdusbabek">Gary Dusbabek</assignee>
                                    <reporter username="gdusbabek">Gary Dusbabek</reporter>
                        <labels>
                    </labels>
                <created>Tue, 3 Aug 2010 19:51:13 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:19 +0000</updated>
                            <resolved>Wed, 4 Aug 2010 14:37:12 +0000</resolved>
                                        <fixVersion>0.7 beta 1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12895014" author="gdusbabek" created="Tue, 3 Aug 2010 20:01:19 +0000"  >&lt;p&gt;Connected to the target VM, address: &apos;127.0.0.1:49379&apos;, transport: &apos;socket&apos;&lt;br/&gt;
 INFO 14:55:18,246 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; Loading settings from /Users/gary.dusbabek/codes/apache/git-trunk/out/production/conf1/cassandra.yaml&lt;br/&gt;
DEBUG 14:55:18,658 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; Syncing log with a period of 10000&lt;br/&gt;
 INFO 14:55:18,658 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; DiskAccessMode &apos;auto&apos; determined to be mmap, indexAccessMode is mmap&lt;br/&gt;
DEBUG 14:55:18,683 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; setting auto_bootstrap to true&lt;br/&gt;
DEBUG 14:55:18,913 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; Starting CFS Statistics&lt;br/&gt;
DEBUG 14:55:18,939 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; Starting CFS Schema&lt;br/&gt;
DEBUG 14:55:19,028 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; Starting CFS Migrations&lt;br/&gt;
DEBUG 14:55:19,042 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; Starting CFS LocationInfo&lt;br/&gt;
DEBUG 14:55:19,056 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; Starting CFS HintsColumnFamily&lt;br/&gt;
 INFO 14:55:19,133 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; Loading schema version b72d969e-9f37-11df-903b-e700f669bcfc&lt;br/&gt;
DEBUG 14:55:19,153 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; collecting 0 of 2147483647: Avro/Schema:false:1368@1280864748965&lt;br/&gt;
DEBUG 14:55:19,154 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; collecting 1 of 2147483647: Keyspace1:false:62@1280864748965&lt;br/&gt;
 WARN 14:55:19,600 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; Schema definitions were defined both locally and in cassandra.yaml. Definitions in cassandra.yaml were ignored.&lt;br/&gt;
 INFO 14:55:19,615 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; Replaying /Users/gary.dusbabek/cass-configs/trunk/node1/commitlog/CommitLog-1280862145661.log, /Users/gary.dusbabek/cass-configs/trunk/node1/commitlog/CommitLog-1280864632989.log, /Users/gary.dusbabek/cass-configs/trunk/node1/commitlog/CommitLog-1280864746190.log, /Users/gary.dusbabek/cass-configs/trunk/node1/commitlog/CommitLog-1280864747315.log, /Users/gary.dusbabek/cass-configs/trunk/node1/commitlog/CommitLog-1280864748249.log, /Users/gary.dusbabek/cass-configs/trunk/node1/commitlog/CommitLog-1280864748880.log, /Users/gary.dusbabek/cass-configs/trunk/node1/commitlog/CommitLog-1280864749601.log, /Users/gary.dusbabek/cass-configs/trunk/node1/commitlog/CommitLog-1280864798401.log&lt;br/&gt;
DEBUG 14:55:19,642 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; Replaying /Users/gary.dusbabek/cass-configs/trunk/node1/commitlog/CommitLog-1280862145661.log starting at 276&lt;br/&gt;
DEBUG 14:55:19,642 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; Reading mutation at 276&lt;br/&gt;
DEBUG 14:55:19,788 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; replaying mutation for system.[B@7848fbc0: &lt;/p&gt;
{ColumnFamily(LocationInfo [B:false:1@1280862146155,])}
&lt;p&gt;DEBUG 14:55:19,835 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; Reading mutation at 424&lt;br/&gt;
DEBUG 14:55:19,836 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; replaying mutation for system.[B@764d2b11: {ColumnFamily(LocationInfo [&#127;&lt;/p&gt;</comment>
                            <comment id="12895029" author="gdusbabek" created="Tue, 3 Aug 2010 20:39:47 +0000"  >&lt;p&gt;It&apos;s easy to detect when a given cfid is gone, but without the old metadata, it is difficult to know how many bytes to skip over (since clock serialization length will vary, as will the column serialization length).&lt;/p&gt;</comment>
                            <comment id="12895037" author="gdusbabek" created="Tue, 3 Aug 2010 20:58:16 +0000"  >&lt;p&gt;We&apos;d generate even more garbage if we pre-serialized the CF and them framed it with a length field (so we could skip over the data).  &lt;/p&gt;

&lt;p&gt;One alternative I can think of is to keep and &apos;attic&apos; of dropped column family definitions in the system table so that it can be consulted in order to read old row mutations.  This is ugly though.&lt;/p&gt;</comment>
                            <comment id="12895042" author="jbellis" created="Tue, 3 Aug 2010 21:13:27 +0000"  >&lt;p&gt;we are including the length of the entire serialized record in CLS.write already.  (this is the value that recover reads in as serializedSize).  so we should just be able to skip to the next one w/o any extra changes (possibly by having RowMutation deserialize throw a ColumnFamilyNotFoundException, or something like that).&lt;/p&gt;</comment>
                            <comment id="12895102" author="jbellis" created="Wed, 4 Aug 2010 00:25:28 +0000"  >&lt;p&gt;WARN freaks people out, especially dozens of WARNs which is what&apos;s likely to happen here.&lt;/p&gt;

&lt;p&gt;It&apos;s more work, by if you make UCFE take just a CFID as a parameter and expose it, then recover can collect a count of rows skipped per CFID and log one message (i would vote for INFO but WARN is ok) at the end of the process.&lt;/p&gt;</comment>
                            <comment id="12895238" author="gdusbabek" created="Wed, 4 Aug 2010 12:46:47 +0000"  >&lt;p&gt;Updated patch to log less.&lt;/p&gt;</comment>
                            <comment id="12895257" author="gdusbabek" created="Wed, 4 Aug 2010 13:34:25 +0000"  >&lt;p&gt;No really, I uploaded the file this time.  This patch makes the changes Jonathan suggested.&lt;/p&gt;</comment>
                            <comment id="12895262" author="jbellis" created="Wed, 4 Aug 2010 13:54:30 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;the log message might be more helpful as something like&lt;/p&gt;

&lt;p&gt;Skipped %d mutations from unknown (probably removed) CF id %d&lt;/p&gt;</comment>
                            <comment id="12896362" author="hudson" created="Sun, 8 Aug 2010 13:52:26 +0000"  >&lt;p&gt;Integrated in Cassandra #510 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Cassandra/510/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Cassandra/510/&lt;/a&gt;)&lt;br/&gt;
    skip CL rows that have unrecoverable row mutations. patch by gdusbabek, reviewed by jbellis. &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1353&quot; title=&quot;commit log recovery is broken when the CL contains mutations to CFs that have been dropped&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1353&quot;&gt;&lt;del&gt;CASSANDRA-1353&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12451222" name="0001-skip-CL-rows-that-have-unrecoverable-row-mutations.patch" size="7024" author="gdusbabek" created="Wed, 4 Aug 2010 13:34:24 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[gdusbabek]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20099</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 16 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0g4jb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>92165</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>mdennis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[mdennis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>