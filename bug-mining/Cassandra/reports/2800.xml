<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:44:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6974] Replaying archived commitlogs isn&apos;t working</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6974</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I have a test for restoring archived commitlogs, which is not working in 2.1 HEAD.  My commitlogs consist of 30,000 inserts, but system.log indicates there were only 2 mutations replayed:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;INFO  [main] 2014-04-02 11:49:54,173 CommitLog.java:115 - Log replay complete, 2 replayed mutations
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There are several warnings in the logs about bad headers and invalid CRCs: &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;WARN  [main] 2014-04-02 11:49:54,156 CommitLogReplayer.java:138 - Encountered bad header at position 0 of commit log /tmp/dtest
-mZIlPE/test/node1/commitlogs/CommitLog-4-1396453793570.log, with invalid CRC. The end of segment marker should be zero.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;compare that to the same test run on 2.0, where it replayed many more mutations:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; INFO [main] 2014-04-02 11:49:04,673 CommitLog.java (line 132) Log replay complete, 35960 replayed mutations
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;ll attach the system logs for reference.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/riptano/cassandra-dtest/blob/master/snapshot_test.py#L75&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Here is the dtest to reproduce this&lt;/a&gt; - (This currently relies on the fix for snapshots available in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6965&quot; title=&quot;sstableloader fails to stream data&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6965&quot;&gt;&lt;del&gt;CASSANDRA-6965&lt;/del&gt;&lt;/a&gt;.)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12706212">CASSANDRA-6974</key>
            <summary>Replaying archived commitlogs isn&apos;t working</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="benedict">Benedict Elliott Smith</assignee>
                                    <reporter username="enigmacurry">Ryan McGuire</reporter>
                        <labels>
                            <label>qa-resolved</label>
                    </labels>
                <created>Wed, 2 Apr 2014 16:02:58 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:49 +0000</updated>
                            <resolved>Fri, 9 May 2014 15:06:32 +0000</resolved>
                                        <fixVersion>2.1 rc1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13958138" author="benedict" created="Wed, 2 Apr 2014 20:31:59 +0000"  >&lt;p&gt;Pretty obvious oversight when making the MT CL changes - didn&apos;t pay close enough attention to archiving. Basically we can archive before the CL is synced. I have a simple patch &lt;a href=&quot;https://github.com/belliottsmith/cassandra/tree/6974-badarchiving&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enigmacurry&quot; class=&quot;user-hover&quot; rel=&quot;enigmacurry&quot;&gt;enigmacurry&lt;/a&gt; could you confirm this fixes the bug? I&apos;ll try and setup dtests so I can test locally more easily in future.&lt;/p&gt;</comment>
                            <comment id="13958926" author="enigmacurry" created="Thu, 3 Apr 2014 16:19:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benedict&quot; class=&quot;user-hover&quot; rel=&quot;benedict&quot;&gt;benedict&lt;/a&gt; I haven&apos;t been able to get your patch working, I still see the &apos;bad header&apos; errors in the logs. To test it, I&apos;ve had to start on &lt;del&gt;trunk&lt;/del&gt; cassandra-2.1, apply the patch in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6978&quot; title=&quot;Table creation does not add all the columns until schema is updated again&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6978&quot;&gt;&lt;del&gt;CASSANDRA-6978&lt;/del&gt;&lt;/a&gt;, then merge in your changes from your branch. Perhaps I&apos;m doing a bad merge though.&lt;/p&gt;</comment>
                            <comment id="13958927" author="benedict" created="Thu, 3 Apr 2014 16:21:29 +0000"  >&lt;p&gt;You&apos;re getting them after trashing your archived log directory? Or does that happen automatically? (It didn&apos;t look like it, as there were logs from multiple runs present in the log file you uploaded)&lt;/p&gt;</comment>
                            <comment id="13958932" author="enigmacurry" created="Thu, 3 Apr 2014 16:27:17 +0000"  >&lt;p&gt;Yes, the backup location is cleared each run (it&apos;s a new temp directory each time the script runs.)&lt;/p&gt;

&lt;p&gt;The multiple runs you are seeing in the log file is part of the script itself, it creates the initial commitlogs, blows away the schema, shutsdown, edits the commitlog_archive.properties file, then starts back up. It&apos;s on the second startup that it tries to replay the archived commitlogs, and it&apos;s failing there.&lt;/p&gt;</comment>
                            <comment id="13958937" author="benedict" created="Thu, 3 Apr 2014 16:29:48 +0000"  >&lt;p&gt;OK, I&apos;ll have to get the test reproducing on my box then. Perhaps there are two problems.&lt;/p&gt;</comment>
                            <comment id="13959069" author="enigmacurry" created="Thu, 3 Apr 2014 18:34:59 +0000"  >&lt;p&gt;Here&apos;s the command I use to test that one test:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;CASSANDRA_DIR=/path/to/your/cstar MAX_HEAP_SIZE=1G HEAP_NEWSIZE=200M PRINT_DEBUG=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; nosetests2 -s -v snapshot_test.py:TestArchiveCommitlog.test_archive_commitlog
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13961788" author="benedict" created="Mon, 7 Apr 2014 11:33:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enigmacurry&quot; class=&quot;user-hover&quot; rel=&quot;enigmacurry&quot;&gt;enigmacurry&lt;/a&gt; I get different errors when I run this dtest. Initially, I get:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Streaming session ID: 25dea2f0-be47-11e3-8aa4-f765879d36e5
Exception in thread &quot;STREAM-OUT-/127.0.0.1&quot; java.lang.NullPointerException
	at org.apache.cassandra.streaming.ConnectionHandler$MessageHandler.signalCloseDone(ConnectionHandler.java:249)
	at org.apache.cassandra.streaming.ConnectionHandler$OutgoingMessageHandler.run(ConnectionHandler.java:375)
	at java.lang.Thread.run(Thread.java:744)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;then, after fixing, I get&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Exception in thread &quot;STREAM-OUT-/127.0.0.1&quot; java.lang.NullPointerException
	at org.apache.cassandra.streaming.StreamManager$StreamRateLimiter.&amp;lt;init&amp;gt;(StreamManager.java:79)
	at org.apache.cassandra.streaming.StreamManager.getRateLimiter(StreamManager.java:61)
	at org.apache.cassandra.streaming.StreamWriter.&amp;lt;init&amp;gt;(StreamWriter.java:60)
	at org.apache.cassandra.streaming.compress.CompressedStreamWriter.&amp;lt;init&amp;gt;(CompressedStreamWriter.java:47)
	at org.apache.cassandra.streaming.messages.OutgoingFileMessage$1.serialize(OutgoingFileMessage.java:51)
	at org.apache.cassandra.streaming.messages.OutgoingFileMessage$1.serialize(OutgoingFileMessage.java:40)
	at org.apache.cassandra.streaming.messages.StreamMessage.serialize(StreamMessage.java:45)
	at org.apache.cassandra.streaming.ConnectionHandler$OutgoingMessageHandler.sendMessage(ConnectionHandler.java:384)
	at org.apache.cassandra.streaming.ConnectionHandler$OutgoingMessageHandler.run(ConnectionHandler.java:355)
	at java.lang.Thread.run(Thread.java:744)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Is it possible the config for the test is specific to your setup? Looks like it&apos;s failing to find a localDc.&lt;/p&gt;</comment>
                            <comment id="13961904" author="enigmacurry" created="Mon, 7 Apr 2014 15:06:07 +0000"  >&lt;p&gt;I think you need to rebase off 2.1 now that &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6978&quot; title=&quot;Table creation does not add all the columns until schema is updated again&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6978&quot;&gt;&lt;del&gt;CASSANDRA-6978&lt;/del&gt;&lt;/a&gt; is fixed. I was applying that patch on your branch manually.&lt;/p&gt;</comment>
                            <comment id="13961905" author="enigmacurry" created="Mon, 7 Apr 2014 15:09:32 +0000"  >&lt;p&gt;I meant &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6965&quot; title=&quot;sstableloader fails to stream data&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6965&quot;&gt;&lt;del&gt;CASSANDRA-6965&lt;/del&gt;&lt;/a&gt;, rather.&lt;/p&gt;</comment>
                            <comment id="13962220" author="benedict" created="Mon, 7 Apr 2014 20:37:59 +0000"  >&lt;p&gt;OK, so looking at this a little more closely, I think your test is broken (not to say there may not still be some issues with archiving). I&apos;ve uploaded a new version anyway that improves upon my previous patch, but will wait until the dtest is corrected to proceed further.&lt;/p&gt;

&lt;p&gt;Specifically, it looks like you&apos;re simply copying all of the &quot;active&quot; commit logs (i.e. the ones in the commitlog directory) manually, without making any attempt to ensure they&apos;re actually synced to disk. You either need to wait until the periodic sync interval has passed (x2 probably, to be sure) or you need to drain() the node. Otherwise the CL data may be sitting in memory. You should never copy the CL segments straight from under C*, you must let it archive them for you.&lt;/p&gt;</comment>
                            <comment id="13963666" author="enigmacurry" created="Wed, 9 Apr 2014 00:43:02 +0000"  >&lt;p&gt;Whoops, I didn&apos;t mean to leave that copy command in there, the docs were sparse so I was just playing around with that bit. I took it out and it still fails on 2.1 HEAD and with your patch, but I&apos;m also running into a problem with sstableloader that I cataloged as &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7015&quot; title=&quot;sstableloader NPE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7015&quot;&gt;&lt;del&gt;CASSANDRA-7015&lt;/del&gt;&lt;/a&gt;. I&apos;m currently trying to refactor my test to get around that to see if I can still repro the archive loading error.&lt;/p&gt;</comment>
                            <comment id="13963682" author="enigmacurry" created="Wed, 9 Apr 2014 01:06:18 +0000"  >&lt;p&gt;OK, with my updated dtest, and on your 6974-badarchiving branch, with no rebases, I can still see the bad crc errors. It&apos;s only if I rebase your branch on cassandra-2.1 that I see the errors from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7015&quot; title=&quot;sstableloader NPE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7015&quot;&gt;&lt;del&gt;CASSANDRA-7015&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13965958" author="enigmacurry" created="Thu, 10 Apr 2014 22:52:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benedict&quot; class=&quot;user-hover&quot; rel=&quot;benedict&quot;&gt;benedict&lt;/a&gt; I wanted to test your suggestion of using drain() to ensure that 100% of the commitlogs get archived, which does not appear to work, I&apos;ve modified my script to test it both ways:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;test_archive_commitlog: Does not copy the active commitlogs, comes up short on the rows it should have on restore.&lt;/li&gt;
	&lt;li&gt;test_archive_commitlog_with_active_commitlog: Copies the active commitlogs before restore, has the right number of rows on restore.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;(Tested on cassadra-2.0)&lt;/p&gt;</comment>
                            <comment id="13966381" author="benedict" created="Fri, 11 Apr 2014 10:25:51 +0000"  >&lt;p&gt;OK, so this is a whole lot more complex a problem than it first appears. I was being thrown by the fact that some of the logs were replaying, but it seems those were the empty recycled logs created at startup. There are two problems to fix:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;To increase safety of log replay, we introduced a checksum of the log id into the header. Unfortunately it appears that on &lt;em&gt;restore&lt;/em&gt; the id in the filename is ignored and a fresh segment id is allocated. Not only does this mean logs are replayed out of order (so is probably undesirable), it also means that the new checksum is rejecting all restored log files as they have the wrong checksum for their id. However since we impose no constraints on the archive command, it is possible some users have been trashing the original segment name+id, so relying on it may be impossible. I&apos;m reticent to drop the checksum safety check, as it&apos;s tied into safety of the new CL model, though.&lt;/li&gt;
	&lt;li&gt;The test restores a CF, but creates a new CF and streams the old CFs data to it. The CL holds data against the old CF, and on replay ignores the mutations because the target CF does not exist&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbellis&quot; class=&quot;user-hover&quot; rel=&quot;jbellis&quot;&gt;jbellis&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vijay2win%40yahoo.com&quot; class=&quot;user-hover&quot; rel=&quot;vijay2win@yahoo.com&quot;&gt;vijay2win@yahoo.com&lt;/a&gt; do you have any opinion on point 1? We could encode the ID in the header itself, and use the ID on restore to construct the ID of the target file only, which would probably retain the present guarantees. Or we could throw a hissy fit if we&apos;re provided a non-standard name for the segment. This also brings up a point about CL and MS version - these are currently encoded in the name as well, so if somebody restores an old version against a new C* cluster, they&apos;ll find things don&apos;t go as planned, so we may want to consider encoding these in the header going forwards also. We can use the presence of the checksum to confirm that we&apos;re operating on a new enough version that supports the scheme.&lt;/p&gt;

&lt;p&gt;As to point 2, I&apos;m not sure if this is a problem with the test or with restore procedure: I&apos;m guessing it&apos;s not atypical to restore by creating a new cluster. In which case we have a whole separate problem to address. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yukim&quot; class=&quot;user-hover&quot; rel=&quot;yukim&quot;&gt;yukim&lt;/a&gt;: thoughts?&lt;/p&gt;

&lt;p&gt;Also, for the record &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enigmacurry&quot; class=&quot;user-hover&quot; rel=&quot;enigmacurry&quot;&gt;enigmacurry&lt;/a&gt;, the log files from the run where the inserts and archives happen are getting trashed, so diagnosing this was trickier than it might otherwise have been. Would be nice to fix that (I assume it may apply to other tests as well)&lt;/p&gt;</comment>
                            <comment id="13968508" author="vijay2win@yahoo.com" created="Mon, 14 Apr 2014 16:41:55 +0000"  >&lt;p&gt;Hi Bendict, &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Not only does this mean logs are replayed out of order&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I don&apos;t think we guarantee that the CL replay will be in order, with Cassandra we don&apos;t need to isn&apos;t it? May be i am missing something. With re use of the segments it is hard to sequence it based on the names... encoding an uniq id which increments all the time is what we are talking about?&lt;/p&gt;</comment>
                            <comment id="13968518" author="benedict" created="Mon, 14 Apr 2014 16:50:25 +0000"  >&lt;p&gt;Hi Vijay,&lt;/p&gt;

&lt;p&gt;It did actually matter for old counters, I think. Order probably doesn&apos;t matter now, but I can&apos;t say with certainty. That said, we do maintain it in all other situations, so I feel more comfortable maintaining if possible.&lt;/p&gt;

&lt;p&gt;However, either way we mostly use the checksum to provide safety for the replay of logs under the normal (non-archived) scenario. Otherwise there&apos;s the risk (without zeroing the file) of randomly encountering a portion of the CL that is old directly proceeding the end of the latest set of log messages to be synced (admittedly this would also require some kind of process failure mid-write, but that still leaves me uncomfortable - the CL is supposed to be bullet proof). We could simply always encode a random ID at the start of the file and checksum based on that instead of the segment id, though - that should provide the same guarantees, so long as we zero it as soon as we&apos;re done (though I like the fact that it gets done for us by simply renaming the file as things stand).&lt;/p&gt;</comment>
                            <comment id="13968534" author="enigmacurry" created="Mon, 14 Apr 2014 17:07:38 +0000"  >&lt;blockquote&gt;&lt;p&gt;the log files from the run where the inserts and archives happen are getting trashed&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benedict&quot; class=&quot;user-hover&quot; rel=&quot;benedict&quot;&gt;benedict&lt;/a&gt; - &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/commit/ace750ab40ad539056fdbbf87cedb425fcad9a84&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;fixed&lt;/a&gt;. Just throw a KEEP_LOGS=true in front of your nosetests command and you should end up with two symlinks in the logs directory when the test is done: &lt;b&gt;snapshot_test_pre-restore&lt;/b&gt; and &lt;b&gt;last&lt;/b&gt;, which are the logs before and after the cluster destruction/recreation. There&apos;s not too many tests where we actually destroy the cluster like this, so I think this is the only one that needed this fix.&lt;/p&gt;</comment>
                            <comment id="13975530" author="benedict" created="Mon, 21 Apr 2014 11:31:35 +0000"  >&lt;p&gt;I&apos;ve pushed -f a branch &lt;a href=&quot;https://github.com/belliottsmith/cassandra/tree/6974-badarchiving&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;This branch should fix any and all commit log related problems. The ball is now in &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yukim&quot; class=&quot;user-hover&quot; rel=&quot;yukim&quot;&gt;yukim&lt;/a&gt;&apos;s &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; court to address the replay of mutations that are associated with column families that have been assigned a different UUID.&lt;/p&gt;

&lt;p&gt;This patch does a number of things:&lt;br/&gt;
1) It ensures we always wait for the final sync of a segment before archiving&lt;br/&gt;
2) It writes a header out to each segment which contains the descriptor (id and version) the segment was created with&lt;br/&gt;
3) This header and any possible descriptor from the name are read during restore, and used to perform various sanity checks before restoring the segment with the same id as it was first created with&lt;br/&gt;
4) The &quot;base&quot; commit log segment id is now based on the max of current time and the largest currently extant segment id, to ensure we never reuse an old id&lt;br/&gt;
5) It also fiddles with the size and update of the crcs we&apos;re writing, as realised we&apos;ve been writing out two longs since time immemorial, when the crc is only 32bit, so we&apos;re wasting 8bytes per mutation; and also the sync marker crcs were being updated incorrectly, using update(int) which uses the int as a byte.&lt;/p&gt;</comment>
                            <comment id="13975700" author="yukim" created="Mon, 21 Apr 2014 16:41:15 +0000"  >&lt;p&gt;For the purpose of commitlog archiving, we have to find the way to restore from archived commitlog regardless of ColumnFamily UUID.&lt;br/&gt;
So I think we need to distinguish archived commitlog file from regular commitlog file.&lt;br/&gt;
Is there a sane way to do this?&lt;/p&gt;</comment>
                            <comment id="13976159" author="benedict" created="Mon, 21 Apr 2014 23:11:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yukim&quot; class=&quot;user-hover&quot; rel=&quot;yukim&quot;&gt;yukim&lt;/a&gt;: seems there is the alternative of being able to create a CF with an explicit UUID?&lt;/p&gt;

&lt;p&gt;We probably could treat this differently on replay if we wanted, though. Not sure if it&apos;s actually the correct behaviour since CFs could be dropped and recreated deliberately across restores, and we wouldn&apos;t be honouring that transition with that change.&lt;/p&gt;</comment>
                            <comment id="13976817" author="jbellis" created="Tue, 22 Apr 2014 14:21:39 +0000"  >&lt;blockquote&gt;&lt;p&gt;replay of mutations that are associated with column families that have been assigned a different UUID&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Hang on, that sounds like a non-goal to me.  If I had table users, dropped it, recreated w/ new schema, then pitr of rows against old table should not be attempted for new one.  Isn&apos;t that how it works?&lt;/p&gt;</comment>
                            <comment id="13976819" author="benedict" created="Tue, 22 Apr 2014 14:24:25 +0000"  >&lt;p&gt;I think restore involves recreating the CF? I&apos;m not familiar with it though, so it&apos;s possible it is indeed a non-issue, and only the dtest needs to be fixed after this test&lt;/p&gt;</comment>
                            <comment id="13976872" author="jbellis" created="Tue, 22 Apr 2014 14:56:14 +0000"  >&lt;p&gt;Hmm.  Historically we&apos;ve basically punted on restore across schema changes and said &quot;create the schema that should be present and we&apos;ll replay into that.&quot;  So that won&apos;t work anymore since the new CFID won&apos;t work.&lt;/p&gt;

&lt;p&gt;But I think we can can say something slightly different &amp;#8211; &quot;restore to a snapshot with the correct schema, then run pitr for anything not in the snapshot.&quot;  Which really is the best practice anyway, only difference is we need to be clear about &quot;snapshot after changing schema if you want to use pitr later.&quot;&lt;/p&gt;

&lt;p&gt;Eventually we&apos;re going to want to log schema changes in the CL and manage that automatically but we&apos;re a ways off from that.&lt;/p&gt;</comment>
                            <comment id="13976932" author="benedict" created="Tue, 22 Apr 2014 15:42:50 +0000"  >&lt;p&gt;Sounds reasonable to me.&lt;/p&gt;</comment>
                            <comment id="13978403" author="jbellis" created="Wed, 23 Apr 2014 16:35:28 +0000"  >&lt;p&gt;Does that mean this is ready to review?&lt;/p&gt;</comment>
                            <comment id="13978462" author="benedict" created="Wed, 23 Apr 2014 17:04:09 +0000"  >&lt;p&gt;yep&lt;/p&gt;</comment>
                            <comment id="13978717" author="benedict" created="Wed, 23 Apr 2014 19:05:56 +0000"  >&lt;p&gt;Just pushed a couple of tiny tweaks - removed a bad assert, made use of modern try/finally in a method and removed an erroneous import.&lt;/p&gt;
</comment>
                            <comment id="13993102" author="jbellis" created="Thu, 8 May 2014 21:01:36 +0000"  >&lt;p&gt;committed, with the addition of &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (EOFException e)
        {
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RuntimeException(e);
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;to CLD.fromHeader, since we don&apos;t want to turn EOF into FSRE&lt;/p&gt;</comment>
                            <comment id="13993247" author="mshuler" created="Thu, 8 May 2014 23:20:20 +0000"  >&lt;p&gt;This commit broke the CommitLogTest unit test:&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/job/cassandra-2.1_utest/251/testReport/junit/org.apache.cassandra.db/CommitLogTest/testExceedRecordLimit/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/job/cassandra-2.1_utest/251/testReport/junit/org.apache.cassandra.db/CommitLogTest/testExceedRecordLimit/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13993606" author="benedict" created="Fri, 9 May 2014 14:46:52 +0000"  >&lt;p&gt;In reducing the overhead size I broke the test which had the overhead size hardcoded. I&apos;ve exposed the size from CLS and use it in the test, so that we shouldn&apos;t have this problem in future.&lt;/p&gt;</comment>
                            <comment id="13993622" author="mshuler" created="Fri, 9 May 2014 14:59:16 +0000"  >&lt;p&gt;Thanks!  Test looks good with this patch.&lt;/p&gt;</comment>
                            <comment id="13993626" author="brandon.williams" created="Fri, 9 May 2014 15:06:32 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12706322">CASSANDRA-6978</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12707325">CASSANDRA-7015</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12737546">CASSANDRA-7846</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12638278" name="2.0.system.log" size="80257" author="enigmacurry" created="Wed, 2 Apr 2014 16:05:44 +0000"/>
                            <attachment id="12638279" name="2.1.system.log" size="80057" author="enigmacurry" created="Wed, 2 Apr 2014 16:05:44 +0000"/>
                            <attachment id="12644115" name="6974.txt" size="1887" author="benedict" created="Fri, 9 May 2014 14:46:52 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[benedict]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>384535</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 28 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1u8vz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>384803</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12326275">2.1 beta1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311124" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Tester</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>mshuler</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>