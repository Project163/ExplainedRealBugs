<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:37:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-5198] Fix CQL3 loose type validation of constants</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-5198</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;This works as it should.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;cqlsh:movies&amp;gt; select * from users where token (username) &amp;gt; token(&apos;&apos;) ;

 username  | created_date | email | firstname | lastname | password
-----------+--------------+-------+-----------+----------+----------
    bsmith |         null |  null |       bob |    smith |     null
 scapriolo |         null |  null |    stacey | capriolo |     null
 ecapriolo |         null |  null |    edward | capriolo |     null

cqlsh:movies&amp;gt; select * from users where token (username) &amp;gt; token(&apos;bsmith&apos;) ;

 username  | created_date | email | firstname | lastname | password
-----------+--------------+-------+-----------+----------+----------
 scapriolo |         null |  null |    stacey | capriolo |     null
 ecapriolo |         null |  null |    edward | capriolo |     null

cqlsh:movies&amp;gt; select * from users where token (username) &amp;gt; token(&apos;scapriolo&apos;) ;

 username  | created_date | email | firstname | lastname | password
-----------+--------------+-------+-----------+----------+----------
 ecapriolo |         null |  null |    edward | capriolo |     null

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But look what happens when you supply numbers into the token function.&lt;/p&gt;


&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;qlsh:movies&amp;gt; select * from users where token (username) &amp;gt; token(0) ;
 username  | created_date | email | firstname | lastname | password
-----------+--------------+-------+-----------+----------+----------
 ecapriolo |         null |  null |    edward | capriolo |     null
cqlsh:movies&amp;gt; select * from users where token (username) &amp;gt; token(1134314) ;

 username  | created_date | email | firstname | lastname | password
-----------+--------------+-------+-----------+----------+----------
    bsmith |         null |  null |       bob |    smith |     null
 scapriolo |         null |  null |    stacey | capriolo |     null
 ecapriolo |         null |  null |    edward | capriolo |     null

cqlsh:movies&amp;gt; select * from users where token (username) &amp;gt; token(113431431) ;
 username  | created_date | email | firstname | lastname | password
-----------+--------------+-------+-----------+----------+----------
 scapriolo |         null |  null |    stacey | capriolo |     null
 ecapriolo |         null |  null |    edward | capriolo |     null

cqlsh:movies&amp;gt; select * from users where token (username) &amp;gt; token(1134) ;
 username  | created_date | email | firstname | lastname | password
-----------+--------------+-------+-----------+----------+----------
 ecapriolo |         null |  null |    edward | capriolo |     null
cqlsh:movies&amp;gt; select * from users where token (username) &amp;gt; token(1134434) ;
 username  | created_date | email | firstname | lastname | password
-----------+--------------+-------+-----------+----------+----------
 scapriolo |         null |  null |    stacey | capriolo |     null
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This does not make sense to me. The token function is apparently converting integers to strings leading to seemingly unpredictable results. &lt;/p&gt;

&lt;p&gt;However I find this syntax odd, I feel like I should be able to say &lt;br/&gt;
&apos;token(username) &amp;gt; 0 and token(username) &amp;lt; 10&apos; because from a thrift side I can page tokens or I can page keys. In this case, I guess, I am only able to page keys because the token is not returned to the user.&lt;/p&gt;

&lt;p&gt;Is token 0 = &apos;&apos;? How do I arrive at the minimal token for and int column. &lt;/p&gt;

&lt;p&gt;Should the token() function at least be smart enough to reject integers for string columns?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12629829">CASSANDRA-5198</key>
            <summary>Fix CQL3 loose type validation of constants</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="appodictic">Edward Capriolo</reporter>
                        <labels>
                    </labels>
                <created>Wed, 30 Jan 2013 03:23:00 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:18 +0000</updated>
                            <resolved>Mon, 4 Feb 2013 09:53:12 +0000</resolved>
                                        <fixVersion>1.2.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13566324" author="slebresne" created="Wed, 30 Jan 2013 09:25:05 +0000"  >&lt;p&gt;So what happens is that &lt;tt&gt;token(0)&lt;/tt&gt; is basically interpreted as the equivalent of &lt;tt&gt;token(&apos;0&apos;)&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Now this is not specific to the token method at all. With the table used above, you can do:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;INSERT INTO users(username, firstname, lastname) VALUES (12, 42, 0)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and that will have the same effect than&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;INSERT INTO users(username, firstname, lastname) VALUES (&apos;12&apos;, &apos;42&apos;, &apos;0&apos;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In the same spirit, you can insert value &lt;tt&gt;&apos;12&apos;&lt;/tt&gt; in an int column.&lt;/p&gt;

&lt;p&gt;Now is that a good idea? I&apos;m not sure indeed. This is not really intentional and is more of an oversight (more precisely it&apos;s an inheritance of CQL2 that has never been fixed).&lt;/p&gt;

&lt;p&gt;I&apos;m fine fixing it (thus fixing the token special case), and in fact in favor of fixing it, but of course that will break anyone that relies on this loose validation (which may be no-one). Though I guess &quot;not validating types&quot; is more of a bug than a feature.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;I feel like I should be able to say &apos;token(username) &amp;gt; 0 and token(username) &amp;lt; 10&apos;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;You can with the caveat that currently the token needs to be quoted, so &lt;tt&gt;token(username) &amp;gt; &apos;0&apos; and token(username) &amp;lt; &apos;10&apos;&lt;/tt&gt;. The vague rational was that tokens are not always ints (i.e they are not in the case of OPP) so we only accept a string and pass that to the partitionner fromString method, oblivious to what the token type actually is. &lt;b&gt;But&lt;/b&gt; this is definitively neither intuitive, nor coherent with the behavior described above. So I suggest that if we do the change suggested above of actually doing type validation, we also use the occasion for properly typing tokens.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;because the token is not returned to the user&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;On that part I&apos;ll not that it is true with thrift too. If you want to page tokens thrift side, you have to compute the token from the keys returned. That being said, I&apos;m not opposed to allow the token function in select clause so you can do&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;SELECT username, token(username) FROM ...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;to save the token computation client side.&lt;/p&gt;</comment>
                            <comment id="13566615" author="slebresne" created="Wed, 30 Jan 2013 17:00:00 +0000"  >&lt;p&gt;Attached 3 patches related to the proposed changes above:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;the first one adds proper type validation. In other word, it rejects a string value when the column is int, or reject an int value when the column is a blob (instead of interpreting it as an hex value which I&apos;m pretty sure is counter-intuitive). This does however also reject a string value when the column is a blob, because I&apos;m far from convince than interpreting the content of the string as an hex value is particularly intuitive. But to allow inserting blobs, it allow a new type of hex constants (that must start with &apos;0x&apos;). In other words, if b is a blob column:
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;UPDATE ... SET b = &apos;00ff&apos; ...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;is not valid anymore, but&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;UPDATE ... SET b = 0x00ff ...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;is. I note that the patch ain&apos;t tiny because it required a few refactoring here and there&lt;br/&gt;
to be done properly, but overall I think those refactor actually improve the&lt;br/&gt;
code.&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;the second patch is mainly of cosmetic and make sure we use CQL3 type in CQL3 error message. I.e. &apos;map&amp;lt;text, int&amp;gt;&apos; rather than &apos;org.apache.cassandra.db.marshal.MapType(org.apache.cassandra.db.marshal.UTF8Type,org.apache.cassandra.db.marshal.UTF8Type.Int32Type)&apos;.&lt;/li&gt;
	&lt;li&gt;the third patch make sure we take the partitioner token type into account. So if your partitioner is M3P you should provide a bigint value, if it&apos;s RP a varint one and if it&apos;s OPP a blob one.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Those patches don&apos;t add yet support for the token function in select clause that I talk above. I also want to add conversion function that allow to say convert a string or a uuid to a blob, but I want to refactor a bit the (currently ugly) handling of functions to do that so that will follow later (and it can be done in another ticket).&lt;/p&gt;</comment>
                            <comment id="13566877" author="appodictic" created="Wed, 30 Jan 2013 20:34:56 +0000"  >&lt;p&gt;I like #1.&lt;br/&gt;
I advocate proper type validation. We recently had a MySQL update that was wrapping booleans in &apos;T&apos;, &apos;F&apos;, &apos;true&apos; and based on your database the results are different or non-intuitive. Personally, I do not like &quot;loose validation&quot; it encourages ambiguity. Hive went through something similar: &lt;a href=&quot;http://grokbase.com/t/hive/dev/125sw56a78/non-string-partition-columns&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://grokbase.com/t/hive/dev/125sw56a78/non-string-partition-columns&lt;/a&gt;, there was much ambiguity and misconceptions around &quot;loose validation&quot; and it became tech-dept that was hard to dig out of.&lt;/p&gt;</comment>
                            <comment id="13566998" author="iamaleksey" created="Wed, 30 Jan 2013 22:28:41 +0000"  >&lt;p&gt;+1 to the first three patches.&lt;/p&gt;</comment>
                            <comment id="13567556" author="slebresne" created="Thu, 31 Jan 2013 11:24:21 +0000"  >&lt;p&gt;Alight, since we seem to be in agreement, committed (and I&apos;ve updated the title to reflect the slightly broader scope).&lt;/p&gt;

&lt;p&gt;I&apos;ll open a separate ticket for adding conversion functions.&lt;/p&gt;</comment>
                            <comment id="13569019" author="tjake" created="Fri, 1 Feb 2013 19:55:50 +0000"  >&lt;p&gt;This is a breaking change for us or anyone who is using CQL with blobs.&lt;/p&gt;

&lt;p&gt;Since we no longer accept &apos;&apos; hex but 0x didn&apos;t previously work till now, there is no way to upgrade 1.2.x to 1.2.2 due to this change.&lt;/p&gt;

&lt;p&gt;I suggest you allow both formats for a single release and add a note in NEWS.txt, that way someone can deploy 1.2.2 then update their app to the new syntax&lt;/p&gt;</comment>
                            <comment id="13569024" author="iamaleksey" created="Fri, 1 Feb 2013 19:58:52 +0000"  >&lt;blockquote&gt;&lt;p&gt;I suggest you allow both formats for a single release and add a note in NEWS.txt, that way someone can deploy 1.2.2 then update their app to the new syntax&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13570091" author="slebresne" created="Mon, 4 Feb 2013 09:52:58 +0000"  >&lt;p&gt;Agreed. I&apos;ve re-allowed strings-as-blobs in commit b251e7aec03273ac14eeae79bee13422068d508b while (hopefully) making it clear it is deprecated (in particular it logs a warning (only once to avoid flooding) if you use a string as blob).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12567160" name="0001-Respect-CQL3-constant-types.txt" size="55580" author="slebresne" created="Wed, 30 Jan 2013 17:00:00 +0000"/>
                            <attachment id="12567161" name="0002-Improve-printing-of-type-in-error-message.txt" size="34182" author="slebresne" created="Wed, 30 Jan 2013 17:00:00 +0000"/>
                            <attachment id="12567162" name="0003-Respect-partitioner-type-for-Token-function.txt" size="9288" author="slebresne" created="Wed, 30 Jan 2013 17:00:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>310325</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 42 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1hk13:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>310670</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aleksey</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>