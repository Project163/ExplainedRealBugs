<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:10:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-165] RejectedExecutionException in getKeyRange</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-165</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Haven&apos;t been able to repro in unit tests but fails in system tests about 50% of the time.&lt;/p&gt;

&lt;p&gt;java.lang.RuntimeException: java.util.concurrent.RejectedExecutionException&lt;br/&gt;
	at org.apache.cassandra.service.RangeVerbHandler.doVerb(RangeVerbHandler.java:27)&lt;br/&gt;
	at org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:46)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:619)&lt;br/&gt;
Caused by: java.util.concurrent.RejectedExecutionException&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$AbortPolicy.rejectedExecution(ThreadPoolExecutor.java:1760)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor.reject(ThreadPoolExecutor.java:767)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor.execute(ThreadPoolExecutor.java:658)&lt;br/&gt;
	at java.util.concurrent.AbstractExecutorService.submit(AbstractExecutorService.java:92)&lt;br/&gt;
	at org.apache.cassandra.db.Memtable.sortedKeyIterator(Memtable.java:412)&lt;br/&gt;
	at org.apache.cassandra.db.Table.getKeyRangeUnsafe(Table.java:912)&lt;br/&gt;
	at org.apache.cassandra.db.Table.getKeyRange(Table.java:883)&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12425259">CASSANDRA-165</key>
            <summary>RejectedExecutionException in getKeyRange</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="jbellis">Jonathan Ellis</reporter>
                        <labels>
                    </labels>
                <created>Tue, 12 May 2009 19:19:22 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:38 +0000</updated>
                            <resolved>Wed, 13 May 2009 22:37:19 +0000</resolved>
                                        <fixVersion>0.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12708641" author="jbellis" created="Tue, 12 May 2009 21:34:22 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;commented on 163 initially by mistake&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;here is the problem&lt;/p&gt;

&lt;p&gt;    void put(String key, ColumnFamily columnFamily, CommitLog.CommitLogContext cLogCtx) throws IOException&lt;br/&gt;
    {&lt;br/&gt;
        isDirty_ = true;&lt;br/&gt;
        executor_.submit(new Putter(key, columnFamily));&lt;br/&gt;
        if (isThresholdViolated())&lt;/p&gt;
        {
            enqueueFlush(cLogCtx);
        }
&lt;p&gt;    }&lt;/p&gt;

&lt;p&gt;(enqueueFlush is the one that swaps out this memtable for a new one in CFS and calls shutdown)&lt;/p&gt;

&lt;p&gt;the problem is that we submit first and ask questions later, so we can clearly submit to this &lt;span class=&quot;error&quot;&gt;&amp;#91;old&amp;#93;&lt;/span&gt; memtable on one thread after another thread starts the shutdown.&lt;/p&gt;

&lt;p&gt;the only option I see is going to back to the old double-checked-ish logic of checking threshold first, then recursing to resubmit if we switch memtables. (overriding TPE.execute/addIfUnderMaximumPoolSize is not an option since liberal use of private variables is made.)&lt;/p&gt;</comment>
                            <comment id="12708662" author="urandom" created="Tue, 12 May 2009 22:35:16 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="12708667" author="urandom" created="Tue, 12 May 2009 22:48:38 +0000"  >&lt;p&gt;Spoke too soon. After more local test runs, I got a RejectedExecutionException in the same place.&lt;/p&gt;</comment>
                            <comment id="12708850" author="hudson" created="Wed, 13 May 2009 09:26:38 +0000"  >&lt;p&gt;Integrated in Cassandra #73 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Cassandra/73/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Cassandra/73/&lt;/a&gt;)&lt;br/&gt;
    to avoid adding work to terminating executor (which will raise an exception) we need to check for threshold violated &lt;em&gt;first&lt;/em&gt;, and move puts to the new memtable once flush has started.  patch by jbellis; reviewed by Eric Evans for &lt;/p&gt;</comment>
                            <comment id="12709020" author="jbellis" created="Wed, 13 May 2009 17:38:21 +0000"  >&lt;p&gt;    replace executor with locking.  the interaction between the executor service terminating and the CFS&lt;br/&gt;
    was inherently unsafe &amp;#8211; you would have to lock anyway to make it safe, the atomic reference wasn&apos;t&lt;br/&gt;
    enough, so at that point you might as well get rid of the executor.&lt;/p&gt;</comment>
                            <comment id="12709096" author="jbellis" created="Wed, 13 May 2009 19:58:09 +0000"  >&lt;p&gt;fixes regression mentioned in IRC.  (need to use a writelock for the put call too, not just the memtable switch.  duh.)&lt;/p&gt;</comment>
                            <comment id="12709154" author="urandom" created="Wed, 13 May 2009 22:01:00 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="12709186" author="jbellis" created="Wed, 13 May 2009 22:37:19 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12408036" name="165-2-v2.patch" size="25376" author="jbellis" created="Wed, 13 May 2009 19:58:09 +0000"/>
                            <attachment id="12408017" name="165-2.patch" size="22921" author="jbellis" created="Wed, 13 May 2009 17:38:21 +0000"/>
                            <attachment id="12407918" name="CASSANDRA-165.patch" size="1633" author="jbellis" created="Tue, 12 May 2009 20:43:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19580</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 28 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0fx9r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90988</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>