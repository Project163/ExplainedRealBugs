<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:32:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-4219] Problem with creating keyspace after drop</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-4219</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I&apos;m doing testing and wanted to drop a keyspace (with a column family) to re-add it with a different strategy. So I ran in cqlsh:&lt;/p&gt;

&lt;p&gt;DROP KEYSPACE PlayLog;&lt;/p&gt;

&lt;p&gt;CREATE KEYSPACE PlayLog WITH strategy_class = &apos;SimpleStrategy&apos;&lt;br/&gt;
 AND strategy_options:replication_factor = 2;&lt;/p&gt;

&lt;p&gt;And everything seemed to be fine. I ran some inserts, which also seemed to go fine, but then selecting them gave me:&lt;/p&gt;

&lt;p&gt;cqlsh:PlayLog&amp;gt; select count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; from playlog;&lt;br/&gt;
TSocket read 0 bytes&lt;/p&gt;

&lt;p&gt;I wasn&apos;t sure what was wrong, so I tried dropping and creating again, and now when I try to create I get:&lt;/p&gt;

&lt;p&gt;cqlsh&amp;gt; CREATE KEYSPACE PlayLog WITH strategy_class = &apos;SimpleStrategy&apos;&lt;br/&gt;
  ...   AND strategy_options:replication_factor = 2;&lt;br/&gt;
TSocket read 0 bytes&lt;/p&gt;

&lt;p&gt;And the keyspace doesn&apos;t get created. In the log it shows:&lt;/p&gt;

&lt;p&gt;ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;Thrift:4&amp;#93;&lt;/span&gt; 2012-05-03 18:23:05,124 CustomTThreadPoolServer.java (line 204) Error occurred during processing of message.&lt;br/&gt;
java.lang.RuntimeException: java.util.concurrent.ExecutionException: java.lang.AssertionError&lt;br/&gt;
       at org.apache.cassandra.utils.FBUtilities.waitOnFuture(FBUtilities.java:372)&lt;br/&gt;
       at org.apache.cassandra.service.MigrationManager.announce(MigrationManager.java:191)&lt;br/&gt;
       at org.apache.cassandra.service.MigrationManager.announceNewKeyspace(MigrationManager.java:129)&lt;br/&gt;
       at org.apache.cassandra.cql.QueryProcessor.processStatement(QueryProcessor.java:701)&lt;br/&gt;
       at org.apache.cassandra.cql.QueryProcessor.process(QueryProcessor.java:875)&lt;br/&gt;
       at org.apache.cassandra.thrift.CassandraServer.execute_cql_query(CassandraServer.java:1235)&lt;br/&gt;
       at org.apache.cassandra.thrift.Cassandra$Processor$execute_cql_query.getResult(Cassandra.java:3458)&lt;br/&gt;
       at org.apache.cassandra.thrift.Cassandra$Processor$execute_cql_query.getResult(Cassandra.java:3446)&lt;br/&gt;
       at org.apache.thrift.ProcessFunction.process(ProcessFunction.java:32)&lt;br/&gt;
       at org.apache.thrift.TBaseProcessor.process(TBaseProcessor.java:34)&lt;br/&gt;
       at org.apache.cassandra.thrift.CustomTThreadPoolServer$WorkerProcess.run(CustomTThreadPoolServer.java:186)&lt;br/&gt;
       at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(Unknown Source)&lt;br/&gt;
       at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)&lt;br/&gt;
       at java.lang.Thread.run(Unknown Source)&lt;br/&gt;
Caused by: java.util.concurrent.ExecutionException: java.lang.AssertionError&lt;br/&gt;
       at java.util.concurrent.FutureTask$Sync.innerGet(Unknown Source)&lt;br/&gt;
       at java.util.concurrent.FutureTask.get(Unknown Source)&lt;br/&gt;
       at org.apache.cassandra.utils.FBUtilities.waitOnFuture(FBUtilities.java:368)&lt;br/&gt;
       ... 13 more&lt;br/&gt;
Caused by: java.lang.AssertionError&lt;br/&gt;
       at org.apache.cassandra.db.DefsTable.updateKeyspace(DefsTable.java:441)&lt;br/&gt;
       at org.apache.cassandra.db.DefsTable.mergeKeyspaces(DefsTable.java:339)&lt;br/&gt;
       at org.apache.cassandra.db.DefsTable.mergeSchema(DefsTable.java:269)&lt;br/&gt;
       at org.apache.cassandra.service.MigrationManager$1.call(MigrationManager.java:214)&lt;br/&gt;
       at java.util.concurrent.FutureTask$Sync.innerRun(Unknown Source)&lt;br/&gt;
       at java.util.concurrent.FutureTask.run(Unknown Source)&lt;br/&gt;
       ... 3 more&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;MigrationStage:1&amp;#93;&lt;/span&gt; 2012-05-03 18:23:05,124 AbstractCassandraDaemon.java (line 134) Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;MigrationStage:1,5,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.AssertionError&lt;br/&gt;
       at org.apache.cassandra.db.DefsTable.updateKeyspace(DefsTable.java:441)&lt;br/&gt;
       at org.apache.cassandra.db.DefsTable.mergeKeyspaces(DefsTable.java:339)&lt;br/&gt;
       at org.apache.cassandra.db.DefsTable.mergeSchema(DefsTable.java:269)&lt;br/&gt;
       at org.apache.cassandra.service.MigrationManager$1.call(MigrationManager.java:214)&lt;br/&gt;
       at java.util.concurrent.FutureTask$Sync.innerRun(Unknown Source)&lt;br/&gt;
       at java.util.concurrent.FutureTask.run(Unknown Source)&lt;br/&gt;
       at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(Unknown Source)&lt;br/&gt;
       at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)&lt;br/&gt;
       at java.lang.Thread.run(Unknown Source)&lt;/p&gt;

&lt;p&gt;Any ideas how I can recover from this?&lt;/p&gt;

&lt;p&gt;I am running version 1.1.0 and have tried nodetool repair, cleanup, compact. I can create other keyspaces, but still can&apos;t create a keyspace called PlayLog even though it is not listed anywhere.&lt;/p&gt;

&lt;p&gt;Jeff&lt;/p&gt;</description>
                <environment>&lt;p&gt;Debian 6.0.4 x64&lt;/p&gt;</environment>
        <key id="12553879">CASSANDRA-4219</key>
            <summary>Problem with creating keyspace after drop</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="xedin">Pavel Yaskevich</assignee>
                                    <reporter username="jeffwilliams">Jeff Williams</reporter>
                        <labels>
                    </labels>
                <created>Fri, 4 May 2012 07:29:44 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:34 +0000</updated>
                            <resolved>Tue, 15 May 2012 14:20:35 +0000</resolved>
                                        <fixVersion>1.1.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="13268222" author="slebresne" created="Fri, 4 May 2012 09:27:46 +0000"  >&lt;p&gt;Would that be possible for you to try applying the attached patch (0001-Add-debug-logs.txt) on one of the machine, switch the log to DEBUG, try recreating said keyspace and send us the resulting log. This should give us more info on what&apos;s going on.&lt;/p&gt;

&lt;p&gt;Also, do you still have the log of when you first got the &apos;TSocket read 0 bytes&apos; during a select? Is there any corresponding errors?&lt;/p&gt;</comment>
                            <comment id="13268231" author="jeffwilliams" created="Fri, 4 May 2012 09:52:57 +0000"  >&lt;p&gt;I have attached the entire system.log from yesterday for the server I was running cqlsh on (10.20.20.25). The cluster is:&lt;/p&gt;

&lt;p&gt;oot@meta01:~# nodetool -h meta01 ring PlayLog3&lt;br/&gt;
Address         DC          Rack        Status State   Load            Effective-Owership  Token                                       &lt;br/&gt;
                                                                                           113427455640312821154458202477256070485     &lt;br/&gt;
10.20.20.25     CPH         R1          Up     Normal  27.88 MB        66.67%              0                                           &lt;br/&gt;
10.20.20.26     CPH         R1          Up     Normal  17.5 MB         66.67%              56713727820156410577229101238628035242      &lt;br/&gt;
10.20.20.24     CPH         R1          Up     Normal  72.44 MB        66.67%              113427455640312821154458202477256070485     &lt;/p&gt;

&lt;p&gt;However, I have switched from SimpleSnitch to PropertyFileSnitch this morning.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure about the times I run the commands and where that corresponds to in the log, but I&apos;m guessing you may know.&lt;/p&gt;

&lt;p&gt;I was testing fail-over and was shutting down the server 10.20.20.26 during writes as a testing. However, it looks like I took it down at 2012-05-03 16:07:13 and that it was down when I did the drop and create, which could be the cause. I see the first error soon after it came back up. Also, I remember that these &apos;Couldn&apos;t find cfId=1013&apos; errors occurred in the system.log on the other servers at the same time (I can send these if you want).&lt;/p&gt;

&lt;p&gt;I&apos;m currently running from the Debian packages. I&apos;ll try to apply the patch there and reinstall the packages.&lt;/p&gt;</comment>
                            <comment id="13268242" author="jeffwilliams" created="Fri, 4 May 2012 10:25:32 +0000"  >&lt;p&gt;Log for adding Keyspace with debug patch applied and log mode DEBUG.&lt;/p&gt;</comment>
                            <comment id="13268316" author="slebresne" created="Fri, 4 May 2012 12:56:36 +0000"  >&lt;p&gt;The weird part here is that this DEBUG log seems to say that the keyspace should exist before you even do the create keyspace (but if it was correctly loaded, you should get a different error, so something is wrong). Could you try restarting the node with DEBUG log and attach that (just wait for the node to be up and running). I want to try to see what&apos;s going on with the loading of that keyspace.&lt;/p&gt;</comment>
                            <comment id="13268947" author="jeffwilliams" created="Sat, 5 May 2012 12:30:38 +0000"  >&lt;p&gt;Debug log for node startup&lt;/p&gt;</comment>
                            <comment id="13270458" author="jeffwilliams" created="Tue, 8 May 2012 13:43:41 +0000"  >&lt;p&gt;Anything useful in that log?&lt;/p&gt;

&lt;p&gt;I seems to have replicated the issue somehow. Firstly, I moved the servers onto public IP&apos;s, though the last octet is the same:&lt;/p&gt;

&lt;p&gt;nodetool -h meta01 ring&lt;br/&gt;
Address         DC          Rack        Status State   Load            Owns                Token                                       &lt;br/&gt;
                                                                                           113427455640312821154458202477256070485     &lt;br/&gt;
91.223.192.25   CPH         R1          Up     Normal  11.2 MB         33.33%              0                                           &lt;br/&gt;
91.223.192.26   CPH         R1          Up     Normal  15.16 MB        33.33%              56713727820156410577229101238628035242      &lt;br/&gt;
91.223.192.24   CPH         R1          Up     Normal  20.11 MB        33.33%              113427455640312821154458202477256070485   &lt;/p&gt;

&lt;p&gt;I created a new keyspace PlayLog2 (PlayLog still does not work), and a column family playlog.&lt;/p&gt;

&lt;p&gt;This was available on all nodes. I then ran a few test inserts which worked fine. Then, to test fail-over, I shutdown the node 91.223.192.26 during inserts. The inserts completed fine and a while later I restarted the node 91.223.192.26. Then, when I went to re-run my tests, I see (Hector client):&lt;/p&gt;

&lt;p&gt;5710 &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-1&amp;#93;&lt;/span&gt; DEBUG me.prettyprint.cassandra.connection.client.HThriftClient  - Creating a new thrift connection to meta02.cph.aspiro.com(91.223.192.26):9160&lt;br/&gt;
5711 &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-0&amp;#93;&lt;/span&gt; DEBUG me.prettyprint.cassandra.connection.client.HThriftClient  - keyspace reseting from null to PlayLog2&lt;br/&gt;
Exception in thread &quot;Thread-1&quot; me.prettyprint.hector.api.exceptions.HInvalidRequestException: InvalidRequestException(why:Keyspace PlayLog2 does not exist)&lt;/p&gt;

&lt;p&gt;Sure enough, from command line client on 91.223.192.26, I see no PlayLog2 keyspace, yet it exists on 91.223.192.24 and 91.223.192.25. I have attached the system.log from 91.223.192.26 in the hope that it is useful.&lt;/p&gt;</comment>
                            <comment id="13270509" author="jeffwilliams" created="Tue, 8 May 2012 14:58:47 +0000"  >&lt;p&gt;Ok, I can now reproduce this on my cluster.&lt;/p&gt;

&lt;p&gt;If I start with all three servers running. And on one of the servers I create a keyspace, create a column family and test, it all works fine. If I then drop the keyspace and re-create it, everything continues to work. However, as soon as one of the nodes is restarted, the keyspace disappears on that node. If I restart every node in the cluster, then the keyspace cannot be seen anyhwere, however, I can still no longer create a keyspace with that name.&lt;/p&gt;</comment>
                            <comment id="13273114" author="jeffwilliams" created="Fri, 11 May 2012 08:17:16 +0000"  >&lt;p&gt;Hi Pavel,&lt;/p&gt;

&lt;p&gt;Have you been able to reproduce this? I am wanting to use these servers for production traffic and am wondering if this issue is a general bug, or due to a corruption in my cluster.&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Jeff&lt;/p&gt;</comment>
                            <comment id="13273163" author="xedin" created="Fri, 11 May 2012 10:45:45 +0000"  >&lt;p&gt;Hi Jeff, unfortunately I wasn&apos;t able to reproduce the situation you are seeing using the following steps: &lt;/p&gt;

&lt;p&gt;   1. run ccm cluster with 3 nodes&lt;br/&gt;
   2. create keyspace/cf and added some data&lt;br/&gt;
   3. stopped node 2&lt;br/&gt;
   4. dropped keyspace (using CLI from node 1)&lt;br/&gt;
   5. re-created keyspace and column family (using CLI from node 3 and on the other try from node 1)&lt;br/&gt;
   6. added some data to the keyspace&lt;br/&gt;
   7. started node 2&lt;/p&gt;

&lt;p&gt;I have seen some of (&apos;Couldn&apos;t find cfId=X) but this is unavoidable since we use sequential numbering of CFs and you have re-created one with the same name, we have an issue to switch to UUID ids too (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3794&quot; title=&quot;Avoid ID conflicts from concurrent schema changes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3794&quot;&gt;&lt;del&gt;CASSANDRA-3794&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;Can you try to run &apos;resetlocalschema&apos; nodetool command on the failing node? It would truncate all of the schema system tables and try to request it again and re-apply, this was designed specially to resolve such weird situations.&lt;/p&gt;
</comment>
                            <comment id="13273165" author="jeffwilliams" created="Fri, 11 May 2012 10:51:46 +0000"  >&lt;p&gt;Pavel,&lt;/p&gt;

&lt;p&gt;I am able to recreate this with a freshly installed cluster using the debian 1.1 packages. The steps are:&lt;/p&gt;

&lt;p&gt;1. Setup the cluster (I only had 2 nodes in my test)&lt;br/&gt;
2. create keyspace on node1 (confirm created on node2)&lt;br/&gt;
3. drop keyspace on node1 (confirm dropped on node2)&lt;br/&gt;
4. re-created keyspace on node1 (confirm re-created on node2)&lt;br/&gt;
5. restart node2&lt;br/&gt;
6. keyspace no longer exists on node2&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Jeff&lt;/p&gt;


</comment>
                            <comment id="13273170" author="xedin" created="Fri, 11 May 2012 11:06:13 +0000"  >&lt;p&gt;Yeah, I can reproduce this one - that happens because when you re-create keyspace it wouldn&apos;t change the UUID version from the original so when migration is send to the node2 originally it wouldn&apos;t correctly merge it into the system table. I will try to fix this one asap.&lt;/p&gt;</comment>
                            <comment id="13273491" author="xedin" created="Fri, 11 May 2012 18:33:02 +0000"  >&lt;p&gt;The problem was that when KS/CF is deleted row in the system table is marked for delete and all of it&apos;s columns are moved, so when it&apos;s re-created columns are added but row stays marked for delete, we need to check if given KS/CF doesn&apos;t have attributes in it&apos;s system table and if it&apos;s marked for delete all together, when we do schema version re-generate or load.&lt;/p&gt;</comment>
                            <comment id="13273493" author="xedin" created="Fri, 11 May 2012 18:34:24 +0000"  >&lt;p&gt;Jeff, I have done both scenarios you mentioned to check if everything now working as expected, can you please also confirm (just to double-check) if it works on your side too?...&lt;/p&gt;</comment>
                            <comment id="13273542" author="jeffwilliams" created="Fri, 11 May 2012 19:38:22 +0000"  >&lt;p&gt;Just did a quick test and it is looking good. The keyspace doesn&apos;t disappear! I&apos;ll do some more checks to make sure that all of the data inserts works before and after.&lt;/p&gt;</comment>
                            <comment id="13273674" author="jbellis" created="Fri, 11 May 2012 22:27:56 +0000"  >&lt;p&gt;do we need to test for row.cf.isEmpty when there was no deletion involved?&lt;/p&gt;

&lt;p&gt;do we need a removeDeleted call in there so the row tombstone can supress obsolete columns pre-compaction?&lt;/p&gt;</comment>
                            <comment id="13273683" author="xedin" created="Fri, 11 May 2012 22:35:03 +0000"  >&lt;p&gt;No, we only check for row.cf.isEmpty when row was marked for delete which could be that KS/CF was actually deleted (empty but row is still there) or re-created. Don&apos;t think that we should worry about removeDeleted because isMarkedForDelete + isEmpty gives us sufficient information.&lt;/p&gt;</comment>
                            <comment id="13273686" author="jbellis" created="Fri, 11 May 2012 22:39:33 +0000"  >&lt;blockquote&gt;&lt;p&gt;Don&apos;t think that we should worry about removeDeleted because isMarkedForDelete + isEmpty gives us sufficient information&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;To clarify: what I&apos;m concerned about is, if there is a row-level tombstone against a previously existing CF definition, then row.isEmpty will be false.  so (markedForDelete &amp;amp;&amp;amp; isEmpty) will also be false...&lt;/p&gt;</comment>
                            <comment id="13273695" author="xedin" created="Fri, 11 May 2012 22:51:01 +0000"  >&lt;p&gt;Ok, I understand your worries, we use CFS.getRangeSlice to fetch data which calls removeDeleted in the process of request processing.&lt;/p&gt;</comment>
                            <comment id="13273697" author="jbellis" created="Fri, 11 May 2012 22:57:28 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13275226" author="jeffwilliams" created="Tue, 15 May 2012 06:44:32 +0000"  >&lt;p&gt;I&apos;ve done some thorough testing now and this looks fixed. Thanks guys.&lt;/p&gt;</comment>
                            <comment id="13275788" author="xedin" created="Tue, 15 May 2012 14:20:36 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                            <comment id="13281148" author="dmuth" created="Tue, 22 May 2012 18:55:45 +0000"  >
&lt;p&gt;Good Afternoon,&lt;/p&gt;

&lt;p&gt;It turns out that I am having this exact issue, and I found this bug via Google.  As previously stated, I dropped a keyspace during testing, but was unable to re-create it.  Looking in system.schema_keyspaces still shows an entry for that keyspace, but I cannot drop that keyspcae either.&lt;/p&gt;

&lt;p&gt;First, is there anything I can do as a workaround, short of deleting all of my data and starting over?&lt;/p&gt;

&lt;p&gt;Second, this isn&apos;t in a cluster, it&apos;s a single machine, and a development machine at that.  So there&apos;s no confidential data involved.  If it would be of any help whatsoever, I&apos;d be happy to send copies of the entire /var/lib/cassandra/ directory.  Please let me know!&lt;/p&gt;

&lt;p&gt;Thanks for your time,&lt;/p&gt;

&lt;p&gt;&amp;#8211; Doug&lt;/p&gt;

</comment>
                            <comment id="13281154" author="xedin" created="Tue, 22 May 2012 19:04:21 +0000"  >&lt;p&gt;Hi Doug, I think that the best option would be to simply apply patch from this issue and re-compile Cassandra.&lt;/p&gt;</comment>
                            <comment id="13561375" author="mharris" created="Thu, 24 Jan 2013 02:46:01 +0000"  >&lt;p&gt;I am seeing this issue on version 1.1.6 as well upon dropping and recreating a keyspace.  Any idea whether there might have been a regression between the fix of this issue and the release of 1.1.6?&lt;/p&gt;

&lt;p&gt;java.lang.RuntimeException: java.util.concurrent.ExecutionException: java.lang.NullPointerException&lt;br/&gt;
	at org.apache.cassandra.utils.FBUtilities.waitOnFuture(FBUtilities.java:373)&lt;br/&gt;
	at org.apache.cassandra.service.MigrationManager.announce(MigrationManager.java:194)&lt;br/&gt;
	at org.apache.cassandra.service.MigrationManager.announceNewKeyspace(MigrationManager.java:127)&lt;br/&gt;
	at org.apache.cassandra.thrift.CassandraServer.system_add_keyspace(CassandraServer.java:992)&lt;br/&gt;
	... (redacted)&lt;br/&gt;
Caused by: java.util.concurrent.ExecutionException: java.lang.NullPointerException&lt;br/&gt;
	at java.util.concurrent.FutureTask$Sync.innerGet(FutureTask.java:222)&lt;br/&gt;
	at java.util.concurrent.FutureTask.get(FutureTask.java:83)&lt;br/&gt;
	at org.apache.cassandra.utils.FBUtilities.waitOnFuture(FBUtilities.java:369)&lt;br/&gt;
	... 64 more&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
	at org.apache.cassandra.db.DefsTable.updateKeyspace(DefsTable.java:518)&lt;br/&gt;
	at org.apache.cassandra.db.DefsTable.mergeKeyspaces(DefsTable.java:415)&lt;br/&gt;
	at org.apache.cassandra.db.DefsTable.mergeSchema(DefsTable.java:345)&lt;br/&gt;
	at org.apache.cassandra.service.MigrationManager$1.call(MigrationManager.java:217)&lt;br/&gt;
	at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)&lt;br/&gt;
	at java.util.concurrent.FutureTask.run(FutureTask.java:138)&lt;br/&gt;
	... 3 more&lt;/p&gt;</comment>
                            <comment id="13561383" author="brandon.williams" created="Thu, 24 Jan 2013 03:04:33 +0000"  >&lt;p&gt;Before 1.1.7 all bets are off for schema problems.  Jira is not the best support forum, try the mailing list or irc.&lt;/p&gt;</comment>
                            <comment id="13561391" author="mharris" created="Thu, 24 Jan 2013 03:32:36 +0000"  >&lt;p&gt;Your bug-tracking system isn&apos;t the right place to report that a bug that was supposed to be fixed might have a regression in a later version...?  Ok, I&apos;ll mail the list then...&lt;/p&gt;</comment>
                            <comment id="16303291" author="mhanna" created="Mon, 25 Dec 2017 14:36:27 +0000"  >&lt;p&gt;I think i have the same issue in C* 3.11.1&lt;/p&gt;

&lt;p&gt;i have a multi-dc cluster&lt;br/&gt;
6 nodes&lt;br/&gt;
2 DCs&lt;/p&gt;

&lt;p&gt;DC1&lt;br/&gt;
98&lt;br/&gt;
99 - seed&lt;br/&gt;
100&lt;/p&gt;

&lt;p&gt;DC2&lt;br/&gt;
101&lt;br/&gt;
102&lt;br/&gt;
103 - seed&lt;/p&gt;

&lt;p&gt;via cqlsh from 102&lt;br/&gt;
1. using a fresh cluster&lt;br/&gt;
2. create keyspace k2view_functionslu&lt;br/&gt;
3. create table&lt;br/&gt;
Works!&lt;/p&gt;

&lt;p&gt;from node 98&lt;br/&gt;
via cqlsh drop keyspace - succeded&lt;/p&gt;

&lt;p&gt;now from node 102&lt;br/&gt;
via cqlsh from 102&lt;br/&gt;
1. create keyspace k2view_functionslu&lt;br/&gt;
2. create table =&amp;gt; Keyspace k2view_functionslu doesn&apos;t exist&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;attacged logs from all nodes&lt;/li&gt;
	&lt;li&gt;attached schema version from all nodes&lt;/li&gt;
	&lt;li&gt;attached &quot;desc keyspaces&quot;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12525582" name="0001-Add-debug-logs.txt" size="1924" author="slebresne" created="Fri, 4 May 2012 09:27:45 +0000"/>
                            <attachment id="12526555" name="CASSANDRA-4219.patch" size="1418" author="xedin" created="Fri, 11 May 2012 18:33:02 +0000"/>
                            <attachment id="12903648" name="k2fabric.log.100" size="29262" author="mhanna" created="Mon, 25 Dec 2017 14:34:59 +0000"/>
                            <attachment id="12903647" name="k2fabric.log.101" size="29258" author="mhanna" created="Mon, 25 Dec 2017 14:34:59 +0000"/>
                            <attachment id="12903646" name="k2fabric.log.102" size="34015" author="mhanna" created="Mon, 25 Dec 2017 14:34:59 +0000"/>
                            <attachment id="12903645" name="k2fabric.log.103" size="27335" author="mhanna" created="Mon, 25 Dec 2017 14:34:59 +0000"/>
                            <attachment id="12903650" name="k2fabric.log.98" size="29259" author="mhanna" created="Mon, 25 Dec 2017 14:34:58 +0000"/>
                            <attachment id="12903649" name="k2fabric.log.99" size="27337" author="mhanna" created="Mon, 25 Dec 2017 14:34:59 +0000"/>
                            <attachment id="12903643" name="no-keyspace-ondisk.png" size="101951" author="mhanna" created="Mon, 25 Dec 2017 14:35:00 +0000"/>
                            <attachment id="12903644" name="no_keyspace.png" size="50562" author="mhanna" created="Mon, 25 Dec 2017 14:34:59 +0000"/>
                            <attachment id="12903642" name="schema_after_ks_creation.png" size="73593" author="mhanna" created="Mon, 25 Dec 2017 14:35:00 +0000"/>
                            <attachment id="12903641" name="schema_before_ks_creation.png" size="80261" author="mhanna" created="Mon, 25 Dec 2017 14:35:00 +0000"/>
                            <attachment id="12525993" name="system-91.223.192.26.log.gz" size="657152" author="jeffwilliams" created="Tue, 8 May 2012 13:44:06 +0000"/>
                            <attachment id="12525590" name="system-debug.log.gz" size="504343" author="jeffwilliams" created="Fri, 4 May 2012 10:25:32 +0000"/>
                            <attachment id="12525727" name="system-startup-debug.log.gz" size="106693" author="jeffwilliams" created="Sat, 5 May 2012 12:30:38 +0000"/>
                            <attachment id="12525585" name="system.log.gz" size="19002" author="jeffwilliams" created="Fri, 4 May 2012 09:44:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>16.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[xedin]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>238092</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 47 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gtdj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>96189</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>