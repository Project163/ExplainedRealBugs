<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:40:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6013] CAS may return false but still commit the insert</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6013</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;If a Paxos proposer proposes some value/update and that propose fail, there is no guarantee on whether this value will be accepted or not ultimately. Paxos guarantees that we&apos;ll agree on &quot;a&quot; value (for a given round in our case), but does not guarantee that the proposer of the agreed upon value will know it.  In particular, if for a given proposal at least one accepter has accepted it but not a quorum does, then that value might (but that&apos;s not guaranteed either) be replayed (and committed) by another proposer.&lt;/p&gt;

&lt;p&gt;Currently, if a proposer A proposes some update U but it is rejected, A will sleep a bit and retry U. But if U was accepted by at least one acceptor, some other proposer B might replay U, succeed and commit it. If A does its retry after that happens, he will prepare, check the condition, and probably find that the conditions don&apos;t apply anymore since U has been committed already. It will thus return false, even though U has been in fact committed.&lt;/p&gt;

&lt;p&gt;Unfortunately I&apos;m not sure there is an easy way for a proposer whose propose fails to know if the update will prevail or not eventually. Which mean the only acceptable solution I can see would be to return to the user &quot;I don&apos;t know&quot; (through some exception for instance). Which is annoying because having a proposal rejected won&apos;t be an extremely rare occurrence, even with relatively light contention, and returning &quot;I don&apos;t know&quot; often is a bit unfriendly.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12668285">CASSANDRA-6013</key>
            <summary>CAS may return false but still commit the insert</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="slebresne">Sylvain Lebresne</reporter>
                        <labels>
                            <label>LWT</label>
                    </labels>
                <created>Thu, 12 Sep 2013 15:31:58 +0000</created>
                <updated>Fri, 25 Oct 2019 13:11:04 +0000</updated>
                            <resolved>Mon, 16 Sep 2013 06:40:48 +0000</resolved>
                                        <fixVersion>2.0.1</fixVersion>
                                    <component>Feature/Lightweight Transactions</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13765687" author="jbellis" created="Thu, 12 Sep 2013 17:48:15 +0000"  >&lt;blockquote&gt;&lt;p&gt;if for a given proposal at least one accepter has accepted it but not a quorum does, then that value might (but that&apos;s not guaranteed either) be replayed (and committed) by another proposer&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Why not have the new leader require a quorum of replicas to say &quot;I have this unfinished business&quot; before replaying it?&lt;/p&gt;

&lt;p&gt;(I&apos;m pretty sure I had this logic in originally but you talked me out of it in the name of code simplification.)&lt;/p&gt;</comment>
                            <comment id="13766301" author="jbellis" created="Fri, 13 Sep 2013 07:25:00 +0000"  >&lt;p&gt;Okay, so the problem is not the retry per se, but when we have a &quot;split decision&quot; on the nodes that reply.  We can reduce the likelihood of that happening by waiting for all known live endpoints if that&apos;s required to hear from a majority.&lt;/p&gt;

&lt;p&gt;If we still don&apos;t hear from a majority, we can return a timeout; it&apos;s valid for a transaction to be committed after a timeout.&lt;/p&gt;

&lt;p&gt;Patch for the above attached.&lt;/p&gt;</comment>
                            <comment id="13766564" author="slebresne" created="Fri, 13 Sep 2013 15:53:21 +0000"  >&lt;p&gt;Unfortunately, I think this is a little grimmer than that. The problem is that a proposer shouldn&apos;t move on unless the propose was successful (in which case it returns to the client) or it is sure that the propose will &lt;b&gt;not&lt;/b&gt; be replayed (if it is sure of that, then retrying the proposed value with a newer ballot is safe; the current problem is that we retry with a newer ballot when we&apos;re not sure of that). In other words, we should timeout unless we are either successful or all nodes have answered and none have accepted. I&apos;m attaching a v2 doing that (but still tries to timeout as little as possible without compromising correctness).&lt;/p&gt;

&lt;p&gt;Unfortunately, this mean we&apos;ll timeout as soon as a proposer gets a propose reject but at least one acceptor had accepted it, which is not an extremely rare condition even with moderate contention. That being said, the current behavior is plain wrong, so unless someone has a much better idea that is easy to implement, we should probably go ahead with this for now.&lt;/p&gt;</comment>
                            <comment id="13767474" author="jbellis" created="Sat, 14 Sep 2013 12:23:52 +0000"  >&lt;p&gt;It looks to me like both uses of requiredTargets should actually be totalTargets.  v3 attached.&lt;/p&gt;</comment>
                            <comment id="13767480" author="slebresne" created="Sat, 14 Sep 2013 13:05:00 +0000"  >&lt;p&gt;I don&apos;t follow. getSuccessful/getAcceptCount is supposed to returned how many successful accepts we got. So that&apos;s how much time we decremented remainingRequired, i.e. its initial value (requiredTargets) minus it&apos;s current value. Similarly, in isFullyRefused, we want to validate that remainingRequired was never decremented (no-one accepted), so we want to compare it&apos;s current value with its initial value, requiredTargets (comparing to totalTargets will in fact always fail).&lt;/p&gt;

&lt;p&gt;I guess the code is more straightforward if we keep the number of accepts instead of the number of remaining accept: attaching v4 with that version (which is equivalent to v2, but with the updated comment of v3).&lt;/p&gt;</comment>
                            <comment id="13767513" author="jbellis" created="Sat, 14 Sep 2013 15:59:05 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13768105" author="slebresne" created="Mon, 16 Sep 2013 06:40:48 +0000"  >&lt;p&gt;Committed, thanks&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12603033" name="6013-v2.txt" size="6077" author="slebresne" created="Fri, 13 Sep 2013 15:53:21 +0000"/>
                            <attachment id="12603192" name="6013-v3.txt" size="6043" author="jbellis" created="Sat, 14 Sep 2013 12:24:39 +0000"/>
                            <attachment id="12603193" name="6013-v4.patch" size="6429" author="slebresne" created="Sat, 14 Sep 2013 13:05:00 +0000"/>
                            <attachment id="12602973" name="6013.txt" size="3186" author="jbellis" created="Fri, 13 Sep 2013 07:25:16 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>348219</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 10 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1o1lr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>348515</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>