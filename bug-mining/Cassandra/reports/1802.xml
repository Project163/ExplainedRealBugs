<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:35:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-4708] StorageProxy slow-down and memory leak</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-4708</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I am consistently observing slow-downs in StorageProxy caused by the NonBlockingHashMap used indirectly by MessagingService via the callbacks ExpiringMap.&lt;/p&gt;

&lt;p&gt;This seems do be due to NBHM having unbounded memory usage in the face of workloads with high key churn. As monotonically increasing integers are used as callback id&apos;s by MessagingService, the backing NBHM eventually ends up growing the backing store unboundedly. This causes it to also do very large and expensive backing store reallocation and migrations, causing throughput to drop to tens of operations per second, lasting seconds or even minutes. &lt;/p&gt;

&lt;p&gt;This behavior is especially noticable for high throughput workloads where the dataset is completely in ram and I&apos;m doing up to a hundred thousand reads per second.&lt;/p&gt;

&lt;p&gt;Replacing NBHM in ExpiringMap with the java standard library ConcurrentHashMap resolved the issue and allowed me to keep a consistent high throughput.&lt;/p&gt;

&lt;p&gt;An open issue on NBHM can be seen here: &lt;a href=&quot;http://sourceforge.net/tracker/?func=detail&amp;amp;aid=3563980&amp;amp;group_id=194172&amp;amp;atid=948362&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://sourceforge.net/tracker/?func=detail&amp;amp;aid=3563980&amp;amp;group_id=194172&amp;amp;atid=948362&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12608822">CASSANDRA-4708</key>
            <summary>StorageProxy slow-down and memory leak</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="danielnorberg">Daniel Norberg</assignee>
                                    <reporter username="danielnorberg">Daniel Norberg</reporter>
                        <labels>
                    </labels>
                <created>Mon, 24 Sep 2012 07:09:34 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:26 +0000</updated>
                            <resolved>Mon, 24 Sep 2012 15:11:19 +0000</resolved>
                                        <fixVersion>1.0.12</fixVersion>
                    <fixVersion>1.1.6</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13461641" author="danielnorberg" created="Mon, 24 Sep 2012 07:28:19 +0000"  >&lt;p&gt;Attached patch with the proposed fix; replaces NBHM with CHM in ExpiringMap.&lt;/p&gt;</comment>
                            <comment id="13461849" author="jbellis" created="Mon, 24 Sep 2012 15:11:19 +0000"  >&lt;p&gt;committed, thanks!&lt;/p&gt;

&lt;p&gt;(also commented on NBHM SF issue.)&lt;/p&gt;</comment>
                            <comment id="13461856" author="jbellis" created="Mon, 24 Sep 2012 15:19:52 +0000"  >&lt;p&gt;did a quick audit of NBHM usage elsewhere.  think we&apos;re okay, everything else has a pretty tiny amount of possible keys.  the main &quot;large&quot; maps are in the column containers where NBHM is a non-candidate since we need sorting.&lt;/p&gt;</comment>
                            <comment id="13461870" author="jbellis" created="Mon, 24 Sep 2012 15:44:33 +0000"  >&lt;p&gt;also committed to 1.0 branch&lt;/p&gt;</comment>
                            <comment id="13462429" author="scode" created="Tue, 25 Sep 2012 04:07:59 +0000"  >&lt;p&gt;Nice catch!&lt;/p&gt;

&lt;p&gt;FWIW, ConcurrentSkipListMap should probably be considered to avoid locking (though I believe it&apos;s generally slower and it&apos;ll be less memory compact).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12546260" name="0001-MessagingService-don-t-use-NBHM-in-ExpiringMap.patch" size="1838" author="danielnorberg" created="Mon, 24 Sep 2012 07:28:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[danielnorberg]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>256348</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 9 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gynr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>97045</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>