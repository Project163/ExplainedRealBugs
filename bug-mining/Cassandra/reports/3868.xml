<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:58:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-10357] mmap file boundary selection is broken for some large files</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-10357</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;If an early open interval occurs to close to an mmap boundary, the boundary can be lost. Patch available &lt;a href=&quot;https://github.com/belliottsmith/cassandra/tree/mmap-boundaries&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12873053">CASSANDRA-10357</key>
            <summary>mmap file boundary selection is broken for some large files</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="benedict">Benedict Elliott Smith</assignee>
                                    <reporter username="benedict">Benedict Elliott Smith</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 Sep 2015 17:38:07 +0000</created>
                <updated>Tue, 14 Oct 2025 12:14:00 +0000</updated>
                            <resolved>Wed, 30 Sep 2015 18:54:30 +0000</resolved>
                                        <fixVersion>2.1.10</fixVersion>
                    <fixVersion>2.2.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14790855" author="jbellis" created="Wed, 16 Sep 2015 18:19:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=krummas&quot; class=&quot;user-hover&quot; rel=&quot;krummas&quot;&gt;krummas&lt;/a&gt; to review&lt;/p&gt;</comment>
                            <comment id="14790888" author="JIRAUSER308715" created="Wed, 16 Sep 2015 18:35:54 +0000"  >&lt;p&gt;This was broken by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8750&quot; title=&quot;Ensure SSTableReader.last corresponds exactly with the file end&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8750&quot;&gt;&lt;del&gt;CASSANDRA-8750&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14790895" author="JIRAUSER308715" created="Wed, 16 Sep 2015 18:40:53 +0000"  >&lt;p&gt;I was hitting this, and I can confirm that after applying this patch and running upgradesstables I get multiple segments, and my sstable gets mmaped.&lt;/p&gt;</comment>
                            <comment id="14790909" author="tjake" created="Wed, 16 Sep 2015 18:47:57 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;&amp;gt; boundaries = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.boundaries);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;The scope of boundaries var is probably why this was overlooked initially. Can you make this more obvious?&lt;br/&gt;
We should add a note in NEWS.txt for users upgrading.  I guess anyone who has compression turned off potentially needs to run upgradesstables :/&lt;/p&gt;

&lt;p&gt;Any way to add a test for this easily?&lt;br/&gt;
Can you link the dtest and testall runs?&lt;/p&gt;</comment>
                            <comment id="14790920" author="benedict" created="Wed, 16 Sep 2015 18:51:37 +0000"  >&lt;blockquote&gt;&lt;p&gt;I guess anyone who has compression turned off potentially needs to run upgradesstables :/&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We could instead automatically detect this and fix it on opening the files.&lt;/p&gt;</comment>
                            <comment id="14790960" author="tjake" created="Wed, 16 Sep 2015 19:05:37 +0000"  >&lt;blockquote&gt;&lt;p&gt;We could instead automatically detect this and fix it on opening the files.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That would happen by passing false to buildSummary?  How will you know if the file is affected?&lt;/p&gt;</comment>
                            <comment id="14790968" author="benedict" created="Wed, 16 Sep 2015 19:12:09 +0000"  >&lt;p&gt;When deserializing bounds, if we find one that is larger than 2Gb, we can simply consult the file&apos;s index (or, in many cases, just the index summary) to decide if it&apos;s true, and if not compute some new acceptable bounds.&lt;/p&gt;</comment>
                            <comment id="14804802" author="JIRAUSER308715" created="Fri, 18 Sep 2015 01:15:35 +0000"  >&lt;p&gt;So what&apos;s the verdict here?  Do we want to do the simple fix here and some &quot;auto detect and correct&quot; separate?  Or is the auto correct easy enough that we will do that here?&lt;/p&gt;</comment>
                            <comment id="14805119" author="benedict" created="Fri, 18 Sep 2015 07:22:03 +0000"  >&lt;p&gt;I&apos;ve written the upgrade, it&apos;s really not very tough. I just need to test it. With summit/travel/preparations, that didn&apos;t happen yesterday, and may not happen today.&lt;/p&gt;

&lt;p&gt;That said I have nothing against committing this and then the upgrade.&lt;/p&gt;</comment>
                            <comment id="14900885" author="benedict" created="Mon, 21 Sep 2015 15:58:18 +0000"  >&lt;p&gt;I&apos;ve pushed a new version, with tests included, and the boundary logic rewritten, as I encountered another bug while fixing it and decided it was time to make the boundary logic more consistent across all users (this bug was related to the fact we do not serialize the length into the file, and if we haven&apos;t updated the length as a &quot;potential boundary&quot; we may not serialize the boundary just before the length into the file - in which case when we deserialize the bounds the last segment may be larger than &lt;tt&gt;MAX_SEGMENT_SIZE&lt;/tt&gt; even though it didn&apos;t need to be). &lt;/p&gt;</comment>
                            <comment id="14900975" author="tjake" created="Mon, 21 Sep 2015 16:55:37 +0000"  >&lt;p&gt;I don&apos;t see it on the linked branch&lt;/p&gt;</comment>
                            <comment id="14901030" author="benedict" created="Mon, 21 Sep 2015 17:22:45 +0000"  >&lt;p&gt;Sorry, I renamed the branch now we have a ticket number. it&apos;s &lt;a href=&quot;https://github.com/belliottsmith/cassandra/tree/10357&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It&apos;s just failed a bunch of dtests, however running them locally everything is fine, so going to kick them off again.&lt;/p&gt;</comment>
                            <comment id="14903410" author="tjake" created="Tue, 22 Sep 2015 20:54:39 +0000"  >&lt;p&gt;I asked &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Stefania&quot; class=&quot;user-hover&quot; rel=&quot;stefania&quot;&gt;Stefania&lt;/a&gt; to verify the logic in forceRepair and she agrees with the code.  If you could add some comments on that code it would be helpful for unfamiliar readers.&lt;/p&gt;

&lt;p&gt;The downside of this is we will run the check code on every sstable for all time if the boundaries are ok until it&apos;s compacted.  I&apos;d rather have a way to only check this once then follow on versions would never check.&lt;/p&gt;

&lt;p&gt;Nit: The magic constant you added, could you make that a const and refer to it vs using the actual number?&lt;/p&gt;
</comment>
                            <comment id="14935375" author="benedict" created="Tue, 29 Sep 2015 16:09:55 +0000"  >&lt;p&gt;I&apos;ve pushed an updated version &lt;a href=&quot;https://github.com/belliottsmith/cassandra/tree/10357&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; with coverage of the &lt;tt&gt;Builder&lt;/tt&gt; itself, ensuring we definitely create accurate boundaries, and improved code comments.&lt;/p&gt;</comment>
                            <comment id="14935660" author="tjake" created="Tue, 29 Sep 2015 19:09:05 +0000"  >&lt;p&gt;+1 pending clean CI tests.&lt;/p&gt;

&lt;p&gt;I&apos;d still like you to make that magic number a const on commit &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14938267" author="benedict" created="Wed, 30 Sep 2015 18:53:56 +0000"  >&lt;p&gt;Committed as c37562e345c24720c55428a8644191df68319812&lt;/p&gt;

&lt;p&gt;(with magic number extracted to const)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12838836">CASSANDRA-9619</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12703231">CASSANDRA-6916</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[benedict]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 7 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2k9gn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>tjake</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[tjake]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12329874">2.1.5</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>