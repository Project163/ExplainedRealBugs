<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:41:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6415] Snapshot repair blocks for ever if something happens to the &quot;I made my snapshot&quot; response</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6415</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;The &quot;snapshotLatch.await();&quot; can be waiting for ever and block all repair operations indefinitely if something happens that another node doesn&apos;t respond.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;            public void makeSnapshots(Collection&amp;lt;InetAddress&amp;gt; endpoints)
            {
                try
                {
                    snapshotLatch = new CountDownLatch(endpoints.size());
                    IAsyncCallback callback = new IAsyncCallback()
                    {
                        public boolean isLatencyForSnitch()
                        {
                            return false;
                        }

                        public void response(MessageIn msg)
                        {
                            RepairJob.this.snapshotLatch.countDown();
                        }
                    };
                    for (InetAddress endpoint : endpoints)
                        MessagingService.instance().sendRR(new SnapshotCommand(tablename, cfname, sessionName, false).createMessage(), endpoint, callback);
                    snapshotLatch.await();
                    snapshotLatch = null;
                }
                catch (InterruptedException e)
                {
                    throw new RuntimeException(e);
                }
            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12681617">CASSANDRA-6415</key>
            <summary>Snapshot repair blocks for ever if something happens to the &quot;I made my snapshot&quot; response</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yukim">Yuki Morishita</assignee>
                                    <reporter username="jeremiah">Jeremiah Jordan</reporter>
                        <labels>
                            <label>repair</label>
                    </labels>
                <created>Wed, 27 Nov 2013 17:47:28 +0000</created>
                <updated>Tue, 14 Oct 2025 12:09:17 +0000</updated>
                            <resolved>Mon, 2 Dec 2013 18:52:24 +0000</resolved>
                                        <fixVersion>1.2.13</fixVersion>
                    <fixVersion>2.0.4</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="13833988" author="yukim" created="Wed, 27 Nov 2013 17:56:30 +0000"  >&lt;p&gt;In detail, &apos;makeSnapshot&apos; happens after receiving all TreeResponses which are handled on single-threaded &apos;ANTI_ENTROPY&apos; stage. So when it stuck, receiving repair messages or Merkle tree comparisons are all blocked afterward.&lt;/p&gt;</comment>
                            <comment id="13836686" author="yukim" created="Mon, 2 Dec 2013 16:57:21 +0000"  >&lt;p&gt;I think it is better to re-think use of executors and threads around repair, for example, right now Differencer runs on ANTI_ENTROPY stage one by one.&lt;/p&gt;

&lt;p&gt;But IMO, that would be quite a change for 1.2.x, so I propose just changing Snapshot response message type to INTERNAL_RESPONSE instead of REQUEST_RESPONSE which is droppable by MessagingService. So at least snapshot request messages don&apos;t get lost in next 1.2 release.&lt;/p&gt;</comment>
                            <comment id="13836707" author="jbellis" created="Mon, 2 Dec 2013 17:28:21 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13836783" author="yukim" created="Mon, 2 Dec 2013 18:52:24 +0000"  >&lt;p&gt;Committed, thanks!&lt;/p&gt;</comment>
                            <comment id="13840696" author="jeromatron" created="Thu, 5 Dec 2013 23:39:55 +0000"  >&lt;p&gt;See the longer term solution here: &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6455&quot; title=&quot;Improve concurrency of repair process&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6455&quot;&gt;&lt;del&gt;CASSANDRA-6455&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13860841" author="nickmbailey" created="Thu, 2 Jan 2014 21:58:54 +0000"  >&lt;p&gt;This was also fixed in the 2.0 branch in 2.0.4 correct?&lt;/p&gt;</comment>
                            <comment id="13860845" author="jbellis" created="Thu, 2 Jan 2014 22:01:01 +0000"  >&lt;p&gt;Yes.&lt;/p&gt;</comment>
                            <comment id="13974462" author="cywjackson" created="Fri, 18 Apr 2014 20:47:32 +0000"  >&lt;p&gt;I ran into the stuck issue on 1.2.10&lt;/p&gt;

&lt;p&gt;Upgraded to 1.2.16, I could see repair is not &quot;stuck&quot;, in a sense I see multiple repair sessions/stages started and finished.&lt;/p&gt;

&lt;p&gt;But, in the end (after waiting a long time), I see that there is no more activity from the log, and also compactionstats/netstats, but yet the tpstats still show Active and Pending count in the stages:&lt;/p&gt;

&lt;p&gt;AntiEntropyStage                  1         2           5073         0                 0&lt;br/&gt;
AntiEntropySessions               1         1             44         0                 0&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13547055">CASSANDRA-18748</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12616573" name="6415-1.2.txt" size="1422" author="yukim" created="Mon, 2 Dec 2013 16:57:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[yukim]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>360881</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 31 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1q7kf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>361180</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12324948">1.2.10</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>