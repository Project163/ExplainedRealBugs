<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:12:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-14862] Fix incorrect sorting of replicas in SimpleStrategy.calculateNaturalReplicas</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-14862</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;The sorting of natural replicas in &lt;tt&gt;SimpleStrategy.calculateNaturalReplicas&lt;/tt&gt; committed as part of &lt;a href=&quot;https://github.com/apache/cassandra/commit/e645b9172c5d50fc2af407de724e46121edfe109#diff-0e1563a70b49cd81e9e11b4ddad15cf2L68&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;e645b917&lt;/a&gt; for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14726&quot; title=&quot;ReplicaCollection follow-up&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14726&quot;&gt;&lt;del&gt;CASSANDRA-14726&lt;/del&gt;&lt;/a&gt; has broken the &lt;tt&gt;TestTopology.test_size_estimates_multidc&lt;/tt&gt; dtest (&lt;a href=&quot;https://circleci.com/gh/jolynch/cassandra/245#tests/containers/48&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;example run&lt;/a&gt;) as the &quot;primary&quot; ranges have now changed. I&apos;m actually surprised only a single dtest fails as I believe we&apos;ve broken multi-dc &lt;tt&gt;SimpleStrategy&lt;/tt&gt; reasonably badly.&lt;/p&gt;

&lt;p&gt;In particular the &lt;tt&gt;SimpleStrategy.calculateNaturalReplicas&lt;/tt&gt; method cannot sort the endpoints by datacenter first. It has to leave them in the order that it found them else change which replicas are considered &quot;primary&quot; replicas (which mostly impacts repair and size estimates and the such).&lt;/p&gt;

&lt;p&gt;I have written a regression unit test for the SimpleStrategy and am running it through circleci now. Will post the patch shortly.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13195548">CASSANDRA-14862</key>
            <summary>Fix incorrect sorting of replicas in SimpleStrategy.calculateNaturalReplicas</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jolynch">Joey Lynch</assignee>
                                    <reporter username="jolynch">Joey Lynch</reporter>
                        <labels>
                            <label>4.0-QA</label>
                    </labels>
                <created>Thu, 1 Nov 2018 03:49:34 +0000</created>
                <updated>Fri, 15 May 2020 08:03:48 +0000</updated>
                            <resolved>Thu, 8 Nov 2018 02:47:20 +0000</resolved>
                                        <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Cluster/Membership</component>
                    <component>Consistency/Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16671090" author="jolynch" created="Thu, 1 Nov 2018 03:59:08 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...jolynch:CASSANDRA-14862&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;dtests:&lt;a href=&quot;https://circleci.com/gh/jolynch/cassandra/tree/CASSANDRA-14862&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://circleci.com/gh/jolynch/cassandra/tree/CASSANDRA-14862.png?circle-token= 1102a59698d04899ec971dd36e925928f7b521f5&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;Patch is up, tests are running. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benedict&quot; class=&quot;user-hover&quot; rel=&quot;benedict&quot;&gt;benedict&lt;/a&gt; do you think you can review?&lt;/p&gt;</comment>
                            <comment id="16671363" author="benedict" created="Thu, 1 Nov 2018 09:44:32 +0000"  >&lt;p&gt;Can we not break this dependency?  It seems that simply selecting the endpoint with the minimum token in (&lt;tt&gt;getPrimaryRangesForEndpoint&lt;/tt&gt; and &lt;tt&gt;getPrimaryRangeForEndpointWithinDC&lt;/tt&gt;) for any returned by &lt;tt&gt;calculateNaturalReplicas&lt;/tt&gt; would suffice?&lt;/p&gt;

&lt;p&gt;I&apos;m OK with also rolling back the change, as I&apos;m not sure I even intended to leave it in (it&apos;s a very limited impact optimisation, that might yield dividends later). &lt;/p&gt;

&lt;p&gt;But, I would rather we also found these dependencies and broke them.  Failing that, we need to document them.  This is an unnecessarily brittle state of affairs.&lt;/p&gt;</comment>
                            <comment id="16671473" author="benedict" created="Thu, 1 Nov 2018 11:10:58 +0000"  >&lt;p&gt;Ah, nevermind - that&apos;s not going to be easy to do.  I guess let&apos;s simply comment &lt;tt&gt;calculateNaturalEndpoints&lt;/tt&gt; to specify that the output order is defined as the token order of the replicas, and that these two methods depend on this.&lt;/p&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="16671919" author="jolynch" created="Thu, 1 Nov 2018 17:36:28 +0000"  >&lt;p&gt;Ok, I just pushed an updated commit (&lt;a href=&quot;https://github.com/apache/cassandra/commit/0d9e09fccc0acacc1b52e8d00dd0b8bfe86c81b0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;0d9e09fc&lt;/a&gt;) to my branch which clears up the &lt;tt&gt;calculateNaturalReplicas&lt;/tt&gt; docstring and lists the implicit dependence. dtests are re-running.&lt;/p&gt;
</comment>
                            <comment id="16673542" author="jolynch" created="Fri, 2 Nov 2018 18:52:40 +0000"  >&lt;p&gt;From Benedict on IRC:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;gt; I might change the language slightly, as I don&apos;t think it&apos;s 100% clear they should be returned in the sequence they occur following the search token (like, 95% clear but you need to think about it), but the important point (that it&apos;s depended on) is plenty clear.
&amp;gt; I&apos;d probably personally have written something like &quot;Calculate the natural endpoints for the given token. They are returned in the order they occur in the ring following the search token, as defined by the replication strategy&quot;, but I don&apos;t think it&apos;s terribly important&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Based on this feedback I have pushed an&#160;amended&#160;commit to (&lt;a href=&quot;https://github.com/jolynch/cassandra/commit/cafd44c8d9ae24c953a8d82746fc89bfe2465641&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cafd44c8&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16679212" author="iamaleksey" created="Thu, 8 Nov 2018 02:47:07 +0000"  >&lt;p&gt;Committed to trunk as &lt;a href=&quot;https://github.com/apache/cassandra/commit/2adfa92044381aa9093104f3a105f3dbd7dda94c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2adfa92044381aa9093104f3a105f3dbd7dda94c&lt;/a&gt;, thanks.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jolynch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 1 week, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|s0008g:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>benedict</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[benedict]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>