<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:50:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-8514] ArrayIndexOutOfBoundsException in nodetool cfhistograms</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-8514</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;When running nodetool cfhistograms on 2.1-HEAD, I am seeing the following exception:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;04:02 PM:~/cstar/cassandra[cassandra-2.1*]$ bin/nodetool cfhistograms keyspace1 standard1
objc[58738]: &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; JavaLaunchHelper is implemented in both /Library/Java/JavaVirtualMachines/jdk1.7.0_67.jdk/Contents/Home/bin/java and /Library/Java/JavaVirtualMachines/jdk1.7.0_67.jdk/Contents/Home/jre/lib/libinstrument.dylib. One of the two will be used. Which one is undefined.
error: 0
-- StackTrace --
java.lang.ArrayIndexOutOfBoundsException: 0
	at org.apache.cassandra.utils.EstimatedHistogram.newOffsets(EstimatedHistogram.java:75)
	at org.apache.cassandra.utils.EstimatedHistogram.&amp;lt;init&amp;gt;(EstimatedHistogram.java:60)
	at org.apache.cassandra.tools.NodeTool$CfHistograms.execute(NodeTool.java:946)
	at org.apache.cassandra.tools.NodeTool$NodeToolCmd.run(NodeTool.java:250)
	at org.apache.cassandra.tools.NodeTool.main(NodeTool.java:164)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I can reproduce this with these simple steps:&lt;br/&gt;
Start a new C* 2.1-HEAD node&lt;br/&gt;
Run &lt;tt&gt;cassandra-stress write n=10000&lt;/tt&gt;&lt;br/&gt;
Run &lt;tt&gt;nodetool cfhistograms keyspace1 standard1&lt;/tt&gt;&lt;/p&gt;</description>
                <environment>&lt;p&gt;OSX&lt;/p&gt;</environment>
        <key id="12762684">CASSANDRA-8514</key>
            <summary>ArrayIndexOutOfBoundsException in nodetool cfhistograms</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="blerer">Benjamin Lerer</assignee>
                                    <reporter username="philipthompson">Philip Thompson</reporter>
                        <labels>
                    </labels>
                <created>Thu, 18 Dec 2014 21:05:43 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:25 +0000</updated>
                            <resolved>Fri, 23 Jan 2015 22:34:25 +0000</resolved>
                                        <fixVersion>2.1.3</fixVersion>
                                    <component>Tool/nodetool</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14272017" author="yarin" created="Fri, 9 Jan 2015 22:50:53 +0000"  >&lt;p&gt;Yes, I&apos;ve seen this as well. Simple patch attached.&lt;/p&gt;</comment>
                            <comment id="14276206" author="jbellis" created="Tue, 13 Jan 2015 23:38:58 +0000"  >&lt;p&gt;It looks to me like the cause is this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;[] combineHistograms(Iterable&amp;lt;SSTableReader&amp;gt; sstables, GetHistogram getHistogram)
    {
        Iterator&amp;lt;SSTableReader&amp;gt; iterator = sstables.iterator();
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!iterator.hasNext())
        {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;[0];
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;... which really isn&apos;t a valid histogram bucket array.  So rather than hacking histogram to try to turn nonsense back into a histogram, would it make more sense to return null and deal with that correctly in nodetool?&lt;/p&gt;

&lt;p&gt;/cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=carlyeks&quot; class=&quot;user-hover&quot; rel=&quot;carlyeks&quot;&gt;carlyeks&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14285493" author="blerer" created="Wed, 21 Jan 2015 10:59:34 +0000"  >&lt;p&gt;I have to work on nodeTool today. So I will give a look to that problem.&lt;/p&gt;</comment>
                            <comment id="14285795" author="blerer" created="Wed, 21 Jan 2015 15:45:55 +0000"  >&lt;p&gt;Sorry &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yarin&quot; class=&quot;user-hover&quot; rel=&quot;yarin&quot;&gt;yarin&lt;/a&gt;. I did not realized that you had started to work on that ticket.&lt;/p&gt;</comment>
                            <comment id="14285799" author="yarin" created="Wed, 21 Jan 2015 15:50:22 +0000"  >&lt;p&gt;No problem &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blerer&quot; class=&quot;user-hover&quot; rel=&quot;blerer&quot;&gt;blerer&lt;/a&gt;, feel free to work on it. I just submitted a quick patch but as &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbellis&quot; class=&quot;user-hover&quot; rel=&quot;jbellis&quot;&gt;jbellis&lt;/a&gt; points out, it&apos;s better to fix the underlying problem.&lt;/p&gt;</comment>
                            <comment id="14285869" author="blerer" created="Wed, 21 Jan 2015 16:54:13 +0000"  >&lt;p&gt; I do not think that the fact that &lt;tt&gt;combineHistograms&lt;/tt&gt; returns an empty array is bad. I find it more natural than returning &lt;tt&gt;null&lt;/tt&gt;. Both cases would have broke &lt;tt&gt;NodeTool&lt;/tt&gt; anyway. &lt;br/&gt;
The patch checks the values returned by &lt;tt&gt;NodeProbe&lt;/tt&gt; and print an error message if no SSTables exist. The missing value are replaced by &lt;tt&gt;Double.NaN&lt;/tt&gt; as it is the case for the other error cases.  &lt;/p&gt;</comment>
                            <comment id="14285875" author="blerer" created="Wed, 21 Jan 2015 16:55:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbellis&quot; class=&quot;user-hover&quot; rel=&quot;jbellis&quot;&gt;jbellis&lt;/a&gt; do you want to be the reviewer?&lt;/p&gt;</comment>
                            <comment id="14286442" author="jbellis" created="Wed, 21 Jan 2015 22:31:39 +0000"  >&lt;p&gt;I still think null is a better &quot;nothing is here&quot; value than empty array (NPE is more obvious that someone forgot to handle a special case than AIOOB) but I&apos;m not going to argue, +1 from me.&lt;/p&gt;</comment>
                            <comment id="14289969" author="blerer" created="Fri, 23 Jan 2015 21:02:41 +0000"  >&lt;p&gt;Modified version of the patch to adapte to the changes made by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8662&quot; title=&quot;Switch cfhistograms from using yammer metrics in 2.1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8662&quot;&gt;&lt;del&gt;CASSANDRA-8662&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14289977" author="blerer" created="Fri, 23 Jan 2015 21:06:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbellis&quot; class=&quot;user-hover&quot; rel=&quot;jbellis&quot;&gt;jbellis&lt;/a&gt; I need an other review when you have time&lt;/p&gt;</comment>
                            <comment id="14290014" author="jbellis" created="Fri, 23 Jan 2015 21:33:31 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14290133" author="blerer" created="Fri, 23 Jan 2015 22:31:23 +0000"  >&lt;p&gt;Patch for trunk&lt;/p&gt;</comment>
                            <comment id="14290140" author="brandon.williams" created="Fri, 23 Jan 2015 22:34:25 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12693622" name="CASSANDRA-8514-V2.txt" size="7303" author="blerer" created="Wed, 21 Jan 2015 16:54:13 +0000"/>
                            <attachment id="12694241" name="CASSANDRA-8514-V3.txt" size="4221" author="blerer" created="Fri, 23 Jan 2015 21:02:41 +0000"/>
                            <attachment id="12694268" name="CASSANDRA-8514-trunk.txt" size="7133" author="blerer" created="Fri, 23 Jan 2015 22:31:23 +0000"/>
                            <attachment id="12691417" name="cassandra-2.1-8514-1.txt" size="573" author="yarin" created="Fri, 9 Jan 2015 22:50:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blerer]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 43 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i23le7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12328951">2.1.3</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311124" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Tester</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>philipthompson</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>