<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:32:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-19633] Replaced node is stuck in a loop calculating ranges</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-19633</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Hello,&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I am running into an issue where in a node that is replacing a dead (non-seed) node is stuck in calculating ranges forever. It eventually succeeds, however the time taken for calculating the ranges is not constant. I do sometimes see that it takes 24 hours to calculate ranges for each keyspace. Attached the flume graph of the cassandra process during this time, which points to the below code.&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Multimap&amp;lt;InetAddressAndPort, Range&amp;lt;Token&amp;gt;&amp;gt; getRangeFetchMapForNonTrivialRanges()
{
&lt;span class=&quot;code-comment&quot;&gt;//Get the graph with edges between ranges and their source endpoints
&lt;/span&gt;MutableCapacityGraph&amp;lt;Vertex, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt; graph = getGraph();
&lt;span class=&quot;code-comment&quot;&gt;//Add source and destination vertex and edges
&lt;/span&gt;addSourceAndDestination(graph, getDestinationLinkCapacity(graph));
&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; flow = 0;
MaximumFlowAlgorithmResult&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;, CapacityEdge&amp;lt;Vertex, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt;&amp;gt; result = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
&lt;span class=&quot;code-comment&quot;&gt;//We might not be working on all ranges
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (flow &amp;lt; getTotalRangeVertices(graph))
{
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (flow &amp;gt; 0)
{ &lt;span class=&quot;code-comment&quot;&gt;//We could not find a path with previous graph. Bump the capacity b/w endpoint vertices and destination by 1 incrementCapacity(graph, 1); }
&lt;/span&gt;MaximumFlowAlgorithm fordFulkerson = FordFulkersonAlgorithm.getInstance(DFSPathFinder.getInstance());
result = fordFulkerson.calc(graph, sourceVertex, destinationVertex, IntegerNumberSystem.getInstance());
&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; newFlow = result.calcTotalFlow();
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; newFlow &amp;gt; flow; &lt;span class=&quot;code-comment&quot;&gt;//We are not making progress which should not happen
&lt;/span&gt;flow = newFlow;
}
&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; getRangeFetchMapFromGraphResult(graph, result);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Digging through the logs, I see the below log line for a given keyspace `system_auth`&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
INFO [main] 2024-05-10 17:35:02,489 RangeStreamer.java:330 - Bootstrap: range Full(/10.135.56.214:7000,(5080189126057290696,5081324396311791613]) exists on Full(/10.135.56.157:7000,(5080189126057290696,5081324396311791613]) &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; keyspace system_auth&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;corresponding code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (Map.Entry&amp;lt;Replica, Replica&amp;gt; entry : fetchMap.flattenEntries())
logger.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;{}: range {} exists on {} &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; keyspace {}&quot;&lt;/span&gt;, description, entry.getKey(), entry.getValue(), keyspaceName);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;BUT do not see the below line for the corresponding keyspace&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
RangeStreamer.java:606 - Output from RangeFetchMapCalculator &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; keyspace&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;this means the code it&apos;s stuck in `getRangeFetchMap();`&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Multimap&amp;lt;InetAddressAndPort, Range&amp;lt;Token&amp;gt;&amp;gt; rangeFetchMapMap = calculator.getRangeFetchMap();
logger.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Output from RangeFetchMapCalculator &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; keyspace {}&quot;&lt;/span&gt;, keyspace);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Here is the cluster topology:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Cassandra version: 4.0.12&lt;/li&gt;
	&lt;li&gt;# of nodes: 190&lt;/li&gt;
	&lt;li&gt;Tokens (vnodes): 128&lt;/li&gt;
	&lt;li&gt;Profile Attached&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Initial hypothesis was that the graph calculation was taking longer due to the combination of nodes + tokens + tables but in the same cluster I see one of the node joined without any issues.&#160;&lt;br/&gt;
wondering if I am hitting a bug causing it to&#160; work sometimes but get into an infinite loop some times?&lt;br/&gt;
Please let me know if you need any other details and appreciate any pointers to debug this further.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13578924">CASSANDRA-19633</key>
            <summary>Replaced node is stuck in a loop calculating ranges</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="marcuse">Marcus Eriksson</assignee>
                                    <reporter username="jaid">Jai Bheemsen Rao Dhanwada</reporter>
                        <labels>
                            <label>Bootstrap</label>
                    </labels>
                <created>Sat, 11 May 2024 04:25:27 +0000</created>
                <updated>Tue, 5 Aug 2025 14:17:32 +0000</updated>
                            <resolved>Tue, 5 Aug 2025 14:16:47 +0000</resolved>
                                        <fixVersion>4.0.19</fixVersion>
                    <fixVersion>4.1.9</fixVersion>
                    <fixVersion>5.0.5</fixVersion>
                    <fixVersion>5.1</fixVersion>
                                    <component>Consistency/Bootstrap and Decommission</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="8400">2h 20m</timespent>
                                <comments>
                            <comment id="17846027" author="jaid" created="Mon, 13 May 2024 17:34:39 +0000"  >&lt;p&gt;This looks to be due to the optimization done in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4650&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;CASSANDRA-4650&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17846275" author="krummas" created="Tue, 14 May 2024 11:24:57 +0000"  >&lt;p&gt;I&apos;ve started looking at this and locally it produces a similar flame graph if I have a 200 node cluster, with 128 tokens/node and a keyspace with a large RF, I wrote up a temporary workaround patch to avoid doing the optimisation when on vnodes: &lt;a href=&quot;https://github.com/krummas/cassandra/commit/70e0d9972a94fa63fa991315412e79ef033561b2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/krummas/cassandra/commit/70e0d9972a94fa63fa991315412e79ef033561b2&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;But as I looked in to this I think the optimisation from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4650&quot; title=&quot;RangeStreamer should be smarter when picking endpoints for streaming in case of N &amp;gt;=3 in each DC.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4650&quot;&gt;&lt;del&gt;CASSANDRA-4650&lt;/del&gt;&lt;/a&gt; was broken by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14405&quot; title=&quot;Transient Replication: Metadata refactor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14405&quot;&gt;&lt;del&gt;CASSANDRA-14405&lt;/del&gt;&lt;/a&gt; (transient replication) - before that we made the 4650-optimisation based on all sources available for a range &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;, now we only supply a single source per range we need to stream &lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ll try to find some time to look in to this soon.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/apache/cassandra/blob/bf911cc6a852f9ef068318a3545611d9daa5112c/src/java/org/apache/cassandra/dht/RangeStreamer.java#L189-L197&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/bf911cc6a852f9ef068318a3545611d9daa5112c/src/java/org/apache/cassandra/dht/RangeStreamer.java#L189-L197&lt;/a&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/apache/cassandra/blob/6bae4f76fb043b4c3a3886178b5650b280e9a50b/src/java/org/apache/cassandra/dht/RangeStreamer.java#L531&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/6bae4f76fb043b4c3a3886178b5650b280e9a50b/src/java/org/apache/cassandra/dht/RangeStreamer.java#L531&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17846595" author="krummas" created="Wed, 15 May 2024 11:47:26 +0000"  >&lt;p&gt;I now have this reproducing locally using tokens/datacenters provided by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jaid&quot; class=&quot;user-hover&quot; rel=&quot;jaid&quot;&gt;jaid&lt;/a&gt;, thanks!&lt;/p&gt;

&lt;p&gt;This problem is indeed that we only provide one source for each range post &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14405&quot; title=&quot;Transient Replication: Metadata refactor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14405&quot;&gt;&lt;del&gt;CASSANDRA-14405&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The 4650-optimisation is done by setting up a graph where each source -&amp;gt; destination edge has the capacity of one - optimally we would stream each range from a unique source. If we can&apos;t find a flow using the capacity of one, we bump the capacity on all edges to two and try to calculate the flow again, and repeat this bumping until we have found a flow where we can &lt;a href=&quot;https://github.com/apache/cassandra/blob/75794540573b6f0c39094b5448fe73326e14e058/src/java/org/apache/cassandra/dht/RangeFetchMapCalculator.java#L134-L148&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;stream all ranges&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The problem is though that with only a single source per range we are very far away from being able to find a flow with edge-capacities of 1, so in this cluster this calculation is done 1000+ times, and each calculation takes several minutes (per keyspace). And the result is terrible anyway because we end up streaming from only two sources.&lt;/p&gt;

&lt;p&gt;Removing &lt;a href=&quot;https://github.com/apache/cassandra/blob/6bae4f76fb043b4c3a3886178b5650b280e9a50b/src/java/org/apache/cassandra/dht/RangeStreamer.java#L531&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this&lt;/a&gt; line allows us to only do the calculation once and we stream from 191 sources. It still takes several minutes to do the calculation, but we most likely save more time due to quicker streaming later. But as the comment says some downstream uses of &lt;tt&gt;sources&lt;/tt&gt; requires it to be only a single node, so I&apos;ll need to fix those places before submitting a patch.&lt;/p&gt;</comment>
                            <comment id="17847879" author="krummas" created="Mon, 20 May 2024 13:14:52 +0000"  >&lt;p&gt;opened PRs for 4.0,4.1,5.0,trunk&lt;/p&gt;

&lt;p&gt;will post CI runs soon&lt;/p&gt;</comment>
                            <comment id="17929206" author="brandon.williams" created="Fri, 21 Feb 2025 17:13:33 +0000"  >&lt;p&gt;Looks like this fell through the cracks but I know people are still running into this.&#160; Patches look good to me, I&apos;ll run CI:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;CI&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/driftx/cassandra/tree/CASSANDRA-19633-4.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/1839/workflows/4fc77ed7-0cc7-4972-8000-8c7940994db5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j8&lt;/a&gt;, &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/1839/workflows/94cfbc7d-5a0f-4029-954b-b5fedbc70968&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j11&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/driftx/cassandra/tree/CASSANDRA-19633-4.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4.1&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/1841/workflows/0278c37d-7153-4dc8-8b2b-88b626990b42&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j8&lt;/a&gt;, &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/1841/workflows/32245931-01f7-4c7d-b073-fdad4ba28ec2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j11&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/driftx/cassandra/tree/CASSANDRA-19633-5.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;5.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/1842/workflows/58f37d68-d0ce-4cb3-8564-36fc7e0e3059&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j11&lt;/a&gt;, &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/1842/workflows/397383e4-48a3-48bb-9409-66a0f7257744&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j17&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/driftx/cassandra/tree/CASSANDRA-19633-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/1840/workflows/7f2026d5-f686-476f-bfbc-c15bb3cfcb9a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j11&lt;/a&gt;, &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/1840/workflows/ef86abfb-4ee4-431d-a42e-5b5e86ccee7a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j17&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="17929221" author="brandon.williams" created="Fri, 21 Feb 2025 18:00:20 +0000"  >&lt;p&gt;Unfortunately I think the TestTransientReplicationRing failures in transient_replication_ring_test.py are new and valid. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcuse&quot; class=&quot;user-hover&quot; rel=&quot;marcuse&quot;&gt;marcuse&lt;/a&gt; can you look?&lt;/p&gt;</comment>
                            <comment id="17929231" author="jaid" created="Fri, 21 Feb 2025 18:47:55 +0000"  >&lt;p&gt;thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt; I added a comment to the PR: &lt;a href=&quot;https://github.com/apache/cassandra/pull/3317&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/3317.&lt;/a&gt; info logging on the rf would add massive amount of logs because this patch is mainly required for the clusters with larger token range. I tried this patch with the token ranges I provided to Marcus for reproducing and bootstrap of one node generates huge amounts of logs.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
311K Feb 20 18:58 system.log.20.zip
311K Feb 20 18:58 system.log.19.zip
311K Feb 20 18:58 system.log.18.zip
311K Feb 20 18:58 system.log.17.zip
310K Feb 20 18:58 system.log.16.zip
310K Feb 20 18:58 system.log.15.zip
311K Feb 20 18:58 system.log.14.zip
312K Feb 20 18:58 system.log.13.zip
310K Feb 20 18:58 system.log.12.zip
311K Feb 20 18:58 system.log.11.zip
312K Feb 20 18:58 system.log.10.zip
311K Feb 20 18:58 system.log.9.zip
312K Feb 20 18:58 system.log.8.zip
312K Feb 20 18:59 system.log.7.zip
311K Feb 20 18:59 system.log.6.zip
312K Feb 20 18:59 system.log.5.zip
312K Feb 20 18:59 system.log.4.zip
311K Feb 20 18:59 system.log.3.zip
313K Feb 20 18:59 system.log.2.zip
312K Feb 20 18:59 system.log.1.zip&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17929609" author="krummas" created="Mon, 24 Feb 2025 08:26:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt; I&apos;ll take a look this week&lt;/p&gt;</comment>
                            <comment id="17929748" author="bereng" created="Mon, 24 Feb 2025 12:37:56 +0000"  >&lt;p&gt;The problem is around the extra &apos;&lt;a href=&quot;https://github.com/driftx/cassandra/commit/0bf0c750a9e49f40164268bbda7cfe0a79bbeb70#diff-75577a8205d51cd637dc31ef7329aa16653471e5f4c066e5055eace1e638e413R618&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;break&lt;/a&gt;&apos; statement added. The offending test passes locally removing that and here is a CI &lt;a href=&quot;https://app.circleci.com/pipelines/github/bereng/cassandra/1250/workflows/8b9a05b3-f5d7-443e-b299-bc6ed0b34bfc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;run&lt;/a&gt; with that removed. My 2cts so far.&lt;/p&gt;</comment>
                            <comment id="17929914" author="brandon.williams" created="Mon, 24 Feb 2025 21:14:55 +0000"  >&lt;p&gt;Thanks, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bereng&quot; class=&quot;user-hover&quot; rel=&quot;bereng&quot;&gt;bereng&lt;/a&gt;!&lt;/p&gt;

&lt;p&gt;I&apos;ve removed the break and pushed that log to debug for &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jaid&quot; class=&quot;user-hover&quot; rel=&quot;jaid&quot;&gt;jaid&lt;/a&gt;, let&apos;s see how it goes:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;CI&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/driftx/cassandra/tree/CASSANDRA-19633-4.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/1843/workflows/0a973f8b-6d5b-47ff-b326-759bb6ce28db&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j8&lt;/a&gt;, &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/1843/workflows/e4bdb07d-1aa2-4d13-9c88-970a2af8d2d4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j11&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/driftx/cassandra/tree/CASSANDRA-19633-4.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4.1&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/1844/workflows/d879e564-bb44-404e-b03c-43711b026b95&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j8&lt;/a&gt;, &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/1844/workflows/60d951e6-4ec6-4ae1-9ac3-a4a3b4e42cab&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j11&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/driftx/cassandra/tree/CASSANDRA-19633-5.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;5.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/1845/workflows/74141820-d393-4c50-86c2-8ea759eab237&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j11&lt;/a&gt;, &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/1845/workflows/7c93a894-eb58-4bbb-872f-d1b8bb1575b3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j17&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/driftx/cassandra/tree/CASSANDRA-19633-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/1846/workflows/f5ac0580-7a2f-4bea-a0f5-12ee17ffec82&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j11&lt;/a&gt;, &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/1846/workflows/6013e133-9ec7-41ec-a214-cc03b5d89a89&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j17&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="17930046" author="bereng" created="Tue, 25 Feb 2025 06:17:06 +0000"  >&lt;p&gt;We get a different set of failures but it&apos;s a data point.&lt;/p&gt;</comment>
                            <comment id="17930095" author="krummas" created="Tue, 25 Feb 2025 07:13:17 +0000"  >&lt;p&gt;yeah I think the break is intended, will check out the test failure later this week&lt;/p&gt;</comment>
                            <comment id="17931065" author="bereng" created="Thu, 27 Feb 2025 09:27:26 +0000"  >&lt;p&gt;Just a note that running some CI with skipping the optimization when vndoes&amp;gt;X didn&apos;t fail in any dramatic ways.&lt;/p&gt;</comment>
                            <comment id="17931214" author="krummas" created="Thu, 27 Feb 2025 15:47:39 +0000"  >&lt;p&gt;so looking closer removing the `break` fixes everything on trunk&lt;/p&gt;

&lt;p&gt;but on 5.0 and older we stream from all sources instead of just one, I&apos;ll see if there is a simple fix&lt;/p&gt;</comment>
                            <comment id="17931400" author="bereng" created="Fri, 28 Feb 2025 08:47:48 +0000"  >&lt;p&gt;Yeah I couldn&apos;t come up with a simple fix but this is an area I am not familiar with. In any case given on some configs with high number of vnodes, either in testing or on small setups, maybe it would be an option to have a feature flag to skip the optimization at will.&lt;/p&gt;</comment>
                            <comment id="17936310" author="jaid" created="Mon, 17 Mar 2025 21:06:19 +0000"  >&lt;p&gt;I agree, probably provide a property in the cassandra.yaml to skip the optimized path so the users can decide to skip or not. Also I verified in the larger clusters that there not a significant improvement with or without optimized path. The bootstrap time is almost the same in both the cases.&#160;&lt;/p&gt;</comment>
                            <comment id="17937820" author="bereng" created="Mon, 24 Mar 2025 09:14:57 +0000"  >&lt;blockquote&gt;&lt;p&gt;Also I verified in the larger clusters that there not a significant improvement with or without optimized path&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That&apos;s interesting!&lt;/p&gt;</comment>
                            <comment id="17937979" author="jaid" created="Mon, 24 Mar 2025 18:33:02 +0000"  >&lt;p&gt;&amp;gt; Also I verified in the larger clusters that there not a significant improvement with or without optimized path&lt;/p&gt;

&lt;p&gt;What I meant was, in a larger cluster with vnodes the optimized doesn&apos;t improve the streaming much while compared to the non-optimized path.&lt;/p&gt;</comment>
                            <comment id="17943208" author="bereng" created="Thu, 10 Apr 2025 12:59:52 +0000"  >&lt;p&gt;I added a &lt;a href=&quot;https://github.com/apache/cassandra/pull/4075&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR&lt;/a&gt; with the feature flag which could be complementary to other fixes or unblock people while we wait for a final solution. &lt;a href=&quot;http://https://app.circleci.com/pipelines/github/bereng/cassandra?branch=CASSANDRA-19633-4.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CI&lt;/a&gt; LGTM. If I could get a +1, it&apos;s a small PR, I could put up the rest of the PRs/CI needed.&lt;/p&gt;</comment>
                            <comment id="17943238" author="brandon.williams" created="Thu, 10 Apr 2025 14:30:45 +0000"  >&lt;p&gt;Feature flag LGTM, +1.&lt;/p&gt;</comment>
                            <comment id="17943539" author="bereng" created="Fri, 11 Apr 2025 12:15:36 +0000"  >&lt;p&gt;All PRs with the FF and CI in them. If I get a +1 on them I&apos;ll merge.&lt;/p&gt;

&lt;p&gt;4.0 &lt;a href=&quot;https://github.com/apache/cassandra/pull/4075&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR&lt;/a&gt;&lt;br/&gt;
4.1 &lt;a href=&quot;https://github.com/apache/cassandra/pull/4082&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR&lt;/a&gt;&lt;br/&gt;
5.0 &lt;a href=&quot;https://github.com/apache/cassandra/pull/4083&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR&lt;/a&gt;&lt;br/&gt;
trunk &lt;a href=&quot;https://github.com/apache/cassandra/pull/4085&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17943544" author="brandon.williams" created="Fri, 11 Apr 2025 12:39:26 +0000"  >&lt;p&gt;I see &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-18432&quot; title=&quot;Test failure: org.apache.cassandra.index.sasi.SASICQLTest#testPagingWithClustering&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-18432&quot;&gt;CASSANDRA-18432&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-17308&quot; title=&quot;Test Failure: dtest-upgrade.upgrade_tests.bootstrap_upgrade_test.TestBootstrapUpgrade.test_failed_bootstrap_wiped_node_can_join&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-17308&quot;&gt;CASSANDRA-17308&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-20509&quot; title=&quot;Test failure: largecolumn_test.TestLargeColumn.test_cleanup&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-20509&quot;&gt;&lt;del&gt;CASSANDRA-20509&lt;/del&gt;&lt;/a&gt; and the MultiNodeTokenConflict is a timeout and probably environmental, but obviously not related here.  +1 on FF.&lt;/p&gt;</comment>
                            <comment id="17944266" author="bereng" created="Mon, 14 Apr 2025 07:30:16 +0000"  >&lt;p&gt;So:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Apologies I forgot the authorship in the commit message &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Too many different workflows in my head lately&lt;/li&gt;
	&lt;li&gt;I am closing this as of now we have a workaround in place.&lt;/li&gt;
	&lt;li&gt;Please feel free to reopen or create a new ticket when a proper solution is available.&lt;/li&gt;
	&lt;li&gt;Please shout if any of the above sounds wrong.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17944318" author="brandon.williams" created="Mon, 14 Apr 2025 10:22:25 +0000"  >&lt;p&gt;I don&apos;t think we need to close this out as that&apos;s a workaround and we can still complete a proper solution once this &apos;break&apos; thing is figured out?&lt;/p&gt;</comment>
                            <comment id="17944336" author="bereng" created="Mon, 14 Apr 2025 11:27:44 +0000"  >&lt;p&gt;Either keep this one open or open a new one. Both work for me. Reopened.&lt;/p&gt;</comment>
                            <comment id="18012117" author="smiklosovic" created="Tue, 5 Aug 2025 12:51:33 +0000"  >&lt;p&gt;I see that this was merged to 4.0, 4.1 and 5.0 while not in trunk and this ticket is open. It warned me on the creation of a new version after 5.0.5 was released that this is still open. I just proceeded forcefully. &lt;/p&gt;</comment>
                            <comment id="18012141" author="brandon.williams" created="Tue, 5 Aug 2025 14:16:47 +0000"  >&lt;p&gt;Keeping this open keeps causing this problem, so I opened &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-20817&quot; title=&quot;Replaced node is stuck in a loop calculating ranges follow up&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-20817&quot;&gt;CASSANDRA-20817&lt;/a&gt; to finish the solution.&#160; For anyone reading this later, this ticket only implements a workaround.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13068803" name="result1.html" size="12838" author="jaid" created="Sat, 11 May 2024 04:16:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12984" cascade-level=""><![CDATA[Degradation]]></customfieldvalue>
                                <customfieldvalue key="12996" cascade-level="1"><![CDATA[Slow Use Case]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12969"><![CDATA[User Report]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1p5uw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[bereng]]></customfieldvalue>
        <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12336842">4.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/fcea0b6fd8aa6685e7a7e4be5bcde0ee87efc75f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/fcea0b6fd8aa6685e7a7e4be5bcde0ee87efc75f&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;ci runs&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>