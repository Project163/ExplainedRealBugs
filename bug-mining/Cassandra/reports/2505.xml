<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:41:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-5428] CQL3 don&apos;t validate that collections haven&apos;t more than 64K elements</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-5428</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;This is somewhat similar to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5355&quot; title=&quot;Collection values size is not validated.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5355&quot;&gt;&lt;del&gt;CASSANDRA-5355&lt;/del&gt;&lt;/a&gt; but with a twist. When we serialize collections, not only does the size of the elements is limited to 64K, but the number of elements is too because it is also an unsigned short.&lt;/p&gt;

&lt;p&gt;Now the same argument than in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5355&quot; title=&quot;Collection values size is not validated.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5355&quot;&gt;&lt;del&gt;CASSANDRA-5355&lt;/del&gt;&lt;/a&gt; that collections are &quot;places to denormalize small amounts of data&quot; is true here too. So the fact that collections are limited to 64K elements is something I could live with. However, we don&apos;t validate that no more than 64K elements are inserted. And in fact, we can&apos;t validate it if the elements are added one by one.&lt;/p&gt;

&lt;p&gt;So in practice, you can insert more than 64K elements, but if you try to read it, you will only get back some subset of the collection. And the number of elements returned will correspond to the 2 last bytes of the real size (so a collection of 65536 elements will be returned as 1 element). Imo, that&apos;s more problematic.&lt;/p&gt;

&lt;p&gt;So since unfortunately we can&apos;t validate this at insertion, I suggest that as a first step we:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;document that limitation (in &lt;a href=&quot;http://cassandra.apache.org/doc/cql3/CQL.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassandra.apache.org/doc/cql3/CQL.html&lt;/a&gt; typically)&lt;/li&gt;
	&lt;li&gt;when we read a collection that has &amp;gt; 64K elements, we detect it and when serializing that for the client, we:
	&lt;ul&gt;
		&lt;li&gt;return as much as we can, i.e. the 64K first ones&lt;/li&gt;
		&lt;li&gt;log a warning that something is wrong&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;On the longer term, for 2.0, maybe we should just change the serialization format and use an int for the collection size, using an unsigned short was probably misguided. Of course that changes said serialization format so we have to bump the native protocol version for that (and thus can&apos;t do that in 1.2).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12641019">CASSANDRA-5428</key>
            <summary>CQL3 don&apos;t validate that collections haven&apos;t more than 64K elements</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="slebresne">Sylvain Lebresne</reporter>
                        <labels>
                    </labels>
                <created>Fri, 5 Apr 2013 10:56:04 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:15 +0000</updated>
                            <resolved>Tue, 3 Dec 2013 13:56:55 +0000</resolved>
                                        <fixVersion>1.2.13</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13623622" author="jbellis" created="Fri, 5 Apr 2013 13:37:44 +0000"  >&lt;p&gt;Sounds like a reasonable plan.&lt;/p&gt;</comment>
                            <comment id="13836416" author="slebresne" created="Mon, 2 Dec 2013 10:54:59 +0000"  >&lt;p&gt;Attaching patch that does the part 2. above, detecting when we&apos;re about to serialize a collection with &amp;gt; 64K elements, logging an error and sending only the first 64K elements. On the documentation part, I&apos;ve already ninja-committed a new paragraph to the doc for the limitations (no pushed online yet though).&lt;/p&gt;

&lt;p&gt;As already said above, this is obviously not perfect and next version of the native protocol we do, we should probably switch to an int to encode collection sizes.&lt;/p&gt;</comment>
                            <comment id="13836463" author="slebresne" created="Mon, 2 Dec 2013 12:10:25 +0000"  >&lt;p&gt;First version of the patch was incorrect, attaching corrected version.&lt;/p&gt;</comment>
                            <comment id="13836469" author="iamaleksey" created="Mon, 2 Dec 2013 12:35:03 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13837706" author="slebresne" created="Tue, 3 Dec 2013 13:56:55 +0000"  >&lt;p&gt;Committed, thanks&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12732120">CASSANDRA-7698</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12647261">CASSANDRA-5559</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12616542" name="5428.txt" size="4098" author="slebresne" created="Mon, 2 Dec 2013 12:10:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>321441</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 51 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1jglz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>321786</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aleksey</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>