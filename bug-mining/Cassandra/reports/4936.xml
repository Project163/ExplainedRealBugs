<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:10:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-14088] Forward slash in role name breaks CassandraAuthorizer</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-14088</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;The standard system authorizer (&lt;tt&gt;org.apache.cassandra.auth.CassandraAuthorizer&lt;/tt&gt;) stores the permissions granted to each user for a given resource in &lt;tt&gt;system_auth.role_permissions&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;A resource like the &lt;tt&gt;my_keyspace.items&lt;/tt&gt; table is stored as &lt;tt&gt;&quot;data/my_keyspace/items&quot;&lt;/tt&gt; (note the &lt;tt&gt;/&lt;/tt&gt; delimiter).&lt;/p&gt;

&lt;p&gt;Similarly, role resources (like the &lt;tt&gt;joe&lt;/tt&gt; role) are stored as &lt;tt&gt;&quot;roles/joe&quot;&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;The problem is that roles can be created with &lt;tt&gt;/&lt;/tt&gt; in their names, which confuses the authorizer when the table is queried.&lt;/p&gt;

&lt;p&gt;For example,&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ bin/cqlsh -u cassandra -p cassandra
Connected to Test Cluster at 127.0.0.1:9042.
[cqlsh 5.0.1 | Cassandra 4.0-SNAPSHOT | CQL spec 3.4.5 | Native protocol v4]
Use HELP &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; help.
cassandra@cqlsh&amp;gt; CREATE ROLE emperor;
cassandra@cqlsh&amp;gt; CREATE ROLE &lt;span class=&quot;code-quote&quot;&gt;&quot;ki/ng&quot;&lt;/span&gt;;
cassandra@cqlsh&amp;gt; GRANT ALTER ON ROLE &lt;span class=&quot;code-quote&quot;&gt;&quot;ki/ng&quot;&lt;/span&gt; TO emperor;
cassandra@cqlsh&amp;gt; LIST ROLES;

 role      | &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt; | login | options
-----------+-------+-------+---------
 cassandra |  True |  True |        {}
   emperor | False | False |        {}
     ki/ng | False | False |        {}

(3 rows)
cassandra@cqlsh&amp;gt; SELECT * FROM system_auth.role_permissions;

 role      | resource      | permissions
-----------+---------------+--------------------------------
   emperor |   roles/ki/ng |                      {&lt;span class=&quot;code-quote&quot;&gt;&apos;ALTER&apos;&lt;/span&gt;}
 cassandra | roles/emperor | {&lt;span class=&quot;code-quote&quot;&gt;&apos;ALTER&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;AUTHORIZE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;DROP&apos;&lt;/span&gt;}
 cassandra |   roles/ki/ng | {&lt;span class=&quot;code-quote&quot;&gt;&apos;ALTER&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;AUTHORIZE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;DROP&apos;&lt;/span&gt;}

(3 rows)
cassandra@cqlsh&amp;gt; LIST ALL PERMISSIONS OF emperor;
ServerError: java.lang.IllegalArgumentException: roles/ki/ng is not a valid role resource name
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here&apos;s the backtrace from the server process:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
ERROR [Native-Transport-Requests-1] 2017-12-01 11:07:52,811 QueryMessage.java:129 - Unexpected error during query
java.lang.IllegalArgumentException: roles/ki/ng is not a valid role resource name
        at org.apache.cassandra.auth.RoleResource.fromName(RoleResource.java:101) ~[main/:na]
        at org.apache.cassandra.auth.Resources.fromName(Resources.java:56) ~[main/:na]
        at org.apache.cassandra.auth.CassandraAuthorizer.listPermissionsForRole(CassandraAuthorizer.java:283) ~[main/:na]
        at org.apache.cassandra.auth.CassandraAuthorizer.list(CassandraAuthorizer.java:263) ~[main/:na]
        at org.apache.cassandra.cql3.statements.ListPermissionsStatement.list(ListPermissionsStatement.java:108) ~[main/:na]
        at org.apache.cassandra.cql3.statements.ListPermissionsStatement.execute(ListPermissionsStatement.java:96) ~[main/:na]
        at org.apache.cassandra.cql3.statements.AuthorizationStatement.execute(AuthorizationStatement.java:48) ~[main/:na]
        at org.apache.cassandra.cql3.QueryProcessor.processStatement(QueryProcessor.java:207) ~[main/:na]
        at org.apache.cassandra.cql3.QueryProcessor.process(QueryProcessor.java:238) ~[main/:na]
        at org.apache.cassandra.cql3.QueryProcessor.process(QueryProcessor.java:223) ~[main/:na]
        at org.apache.cassandra.transport.messages.QueryMessage.execute(QueryMessage.java:116) ~[main/:na]
        at org.apache.cassandra.transport.Message$Dispatcher.channelRead0(Message.java:517) [main/:na]
        at org.apache.cassandra.transport.Message$Dispatcher.channelRead0(Message.java:410) [main/:na]
        at io.netty.channel.SimpleChannelInboundHandler.channelRead(SimpleChannelInboundHandler.java:105) [netty-all-4.1.14.Final.jar:4.1.14.Final]
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [netty-all-4.1.14.Final.jar:4.1.14.Final]
        at io.netty.channel.AbstractChannelHandlerContext.access$600(AbstractChannelHandlerContext.java:38) [netty-all-4.1.14.Final.jar:4.1.14.Final]
        at io.netty.channel.AbstractChannelHandlerContext$7.run(AbstractChannelHandlerContext.java:353) [netty-all-4.1.14.Final.jar:4.1.14.Final]
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [na:1.8.0_151]
        at org.apache.cassandra.concurrent.AbstractLocalAwareExecutorService$FutureTask.run(AbstractLocalAwareExecutorService.java:162) [main/:na]
        at org.apache.cassandra.concurrent.SEPWorker.run(SEPWorker.java:109) [main/:na]
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748) [na:1.8.0_151]
ERROR [Native-Transport-Requests-1] 2017-12-01 11:07:52,812 ErrorMessage.java:389 - Unexpected exception during request
java.lang.IllegalArgumentException: roles/ki/ng is not a valid role resource name
        at org.apache.cassandra.auth.RoleResource.fromName(RoleResource.java:101) ~[main/:na]
        at org.apache.cassandra.auth.Resources.fromName(Resources.java:56) ~[main/:na]
        at org.apache.cassandra.auth.CassandraAuthorizer.listPermissionsForRole(CassandraAuthorizer.java:283) ~[main/:na]
        at org.apache.cassandra.auth.CassandraAuthorizer.list(CassandraAuthorizer.java:263) ~[main/:na]
        at org.apache.cassandra.cql3.statements.ListPermissionsStatement.list(ListPermissionsStatement.java:108) ~[main/:na]
        at org.apache.cassandra.cql3.statements.ListPermissionsStatement.execute(ListPermissionsStatement.java:96) ~[main/:na]
        at org.apache.cassandra.cql3.statements.AuthorizationStatement.execute(AuthorizationStatement.java:48) ~[main/:na]
        at org.apache.cassandra.cql3.QueryProcessor.processStatement(QueryProcessor.java:207) ~[main/:na]
        at org.apache.cassandra.cql3.QueryProcessor.process(QueryProcessor.java:238) ~[main/:na]
        at org.apache.cassandra.cql3.QueryProcessor.process(QueryProcessor.java:223) ~[main/:na]
        at org.apache.cassandra.transport.messages.QueryMessage.execute(QueryMessage.java:116) ~[main/:na]
        at org.apache.cassandra.transport.Message$Dispatcher.channelRead0(Message.java:517) [main/:na]
        at org.apache.cassandra.transport.Message$Dispatcher.channelRead0(Message.java:410) [main/:na]
        at io.netty.channel.SimpleChannelInboundHandler.channelRead(SimpleChannelInboundHandler.java:105) [netty-all-4.1.14.Final.jar:4.1.14.Final]
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [netty-all-4.1.14.Final.jar:4.1.14.Final]
        at io.netty.channel.AbstractChannelHandlerContext.access$600(AbstractChannelHandlerContext.java:38) [netty-all-4.1.14.Final.jar:4.1.14.Final]
        at io.netty.channel.AbstractChannelHandlerContext$7.run(AbstractChannelHandlerContext.java:353) [netty-all-4.1.14.Final.jar:4.1.14.Final]
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [na:1.8.0_151]
        at org.apache.cassandra.concurrent.AbstractLocalAwareExecutorService$FutureTask.run(AbstractLocalAwareExecutorService.java:162) [main/:na]
        at org.apache.cassandra.concurrent.SEPWorker.run(SEPWorker.java:109) [main/:na]
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748) [na:1.8.0_151]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;Git commit: 4c80eeece37d79f434078224a0504400ae10a20d (&lt;tt&gt;HEAD&lt;/tt&gt; of &lt;tt&gt;trunk&lt;/tt&gt;).&lt;/p&gt;</environment>
        <key id="13122203">CASSANDRA-14088</key>
            <summary>Forward slash in role name breaks CassandraAuthorizer</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="KurtG">Kurt Greaves</assignee>
                                    <reporter username="jhaberku">Jesse Haber-Kucharsky</reporter>
                        <labels>
                    </labels>
                <created>Fri, 1 Dec 2017 16:09:43 +0000</created>
                <updated>Tue, 14 Oct 2025 12:13:59 +0000</updated>
                            <resolved>Thu, 7 Dec 2017 21:22:36 +0000</resolved>
                                        <fixVersion>3.0.16</fixVersion>
                    <fixVersion>3.11.2</fixVersion>
                    <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Feature/Authorization</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16276250" author="kurtg" created="Mon, 4 Dec 2017 03:38:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...kgreav:14088-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt;&lt;br/&gt;
No reason for us to split in &lt;tt&gt;RoleResource::fromName&lt;/tt&gt; more than once, so just specified a max and added some tests to make sure we accept forward slashes and some other names correctly.&lt;br/&gt;
Patch is the same for trunk and 3.11. Should merge cleanly.&lt;/p&gt;</comment>
                            <comment id="16276491" author="snazy" created="Mon, 4 Dec 2017 09:13:09 +0000"  >&lt;p&gt;Before we continue with this one - what&apos;s the reason for the forward slash(es) in the role name?&lt;br/&gt;
The delimiter &lt;tt&gt;/&lt;/tt&gt; was chosen to split components - handling that differently across different resource types would be inconsistent.&lt;br/&gt;
I&apos;d be much more in favor of validating the role name in &lt;tt&gt;CreateRoleStatement&lt;/tt&gt; and restrict role names to a defined set of characters, like we do for keyspaces and tables.&lt;/p&gt;</comment>
                            <comment id="16281111" author="kurtg" created="Wed, 6 Dec 2017 23:21:27 +0000"  >&lt;p&gt;Wild guess but I&apos;d say it&apos;s probably because they have complicated role/permission domains and break them up by slashes in their environment, and would find it easiest to continue to use the same roles in C*, rather than having to change their delimiter. I&apos;ve seen similar cases before w.r.t PKI/CN&apos;s/DN&apos;s.&lt;/p&gt;

&lt;p&gt;Seeing as fromName is defined per resource I don&apos;t see why we can&apos;t have specific implementations for each &lt;tt&gt;Resource&lt;/tt&gt;. In fact, in &lt;tt&gt;DataResource&lt;/tt&gt; and &lt;tt&gt;FunctionResource&lt;/tt&gt; we already handle each name differently as we require 3 &lt;tt&gt;/&lt;/tt&gt; separators (+different sep&apos;s for &lt;tt&gt;FunctionResource&lt;/tt&gt;.&lt;br/&gt;
At the moment any character is allowed in a role name except for slash, because of this issue. We only really care about the first slash, if we ever cared about more than that we&apos;d be creating a new &lt;tt&gt;Resource&lt;/tt&gt; anyway.&lt;/p&gt;</comment>
                            <comment id="16281250" author="JIRAUSER308715" created="Thu, 7 Dec 2017 02:26:52 +0000"  >&lt;p&gt;Agreed, we should just limit to only splitting the first &quot;/&quot;.&lt;/p&gt;

&lt;p&gt;Patch LGTM +1.&lt;/p&gt;</comment>
                            <comment id="16282517" author="jjirsa" created="Thu, 7 Dec 2017 20:56:44 +0000"  >&lt;p&gt;This is marked ready to commit, but there&apos;s no mention of utest/dtests at all - if they&apos;re clean I&apos;ll commit, but could someone confirm that they&apos;re clean?&lt;/p&gt;</comment>
                            <comment id="16282536" author="JIRAUSER308715" created="Thu, 7 Dec 2017 21:11:59 +0000"  >&lt;p&gt;I ran the unit test locally that extensively tests the change.  Feel free to remove the ready to commit if you want a full dtest run for it, but given we don&apos;t have any dtests which uses &quot;/&quot; in a name I did not feel it was needed.&lt;/p&gt;</comment>
                            <comment id="16282548" author="jjirsa" created="Thu, 7 Dec 2017 21:22:36 +0000"  >&lt;p&gt;Works for me. Committed as &lt;tt&gt;f9de26a79de02e61624994e67e64f2c93fb5a35b&lt;/tt&gt; and merged up to 3.11/trunk. Thanks to all 3 of you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=KurtG&quot; class=&quot;user-hover&quot; rel=&quot;KurtG&quot;&gt;KurtG&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jjordan&quot; class=&quot;user-hover&quot; rel=&quot;jjordan&quot;&gt;jjordan&lt;/a&gt; , &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jhaberku&quot; class=&quot;user-hover&quot; rel=&quot;jhaberku&quot;&gt;jhaberku&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="16282744" author="kurtg" created="Thu, 7 Dec 2017 23:52:12 +0000"  >&lt;p&gt;For the record, unit tests passed for me (I just didn&apos;t bother checking because I&apos;d recently been flooded by build failures from CircleCI). &lt;a href=&quot;https://circleci.com/gh/kgreav/cassandra/45&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;unit&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Seems that it failed on &lt;a href=&quot;https://circleci.com/gh/kgreav/cassandra/44&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.11&lt;/a&gt; but on an unrelated error.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[KurtG]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 49 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3nfq7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jjordan</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jjordan]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>