<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:10:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-14002] Don&apos;t use SHA256 when building merkle trees</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-14002</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;We should avoid using SHA-2 when building merkle trees as we don&apos;t need a cryptographic hash function for this.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13116901">CASSANDRA-14002</key>
            <summary>Don&apos;t use SHA256 when building merkle trees</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="marcuse">Marcus Eriksson</assignee>
                                    <reporter username="marcuse">Marcus Eriksson</reporter>
                        <labels>
                    </labels>
                <created>Wed, 8 Nov 2017 07:58:58 +0000</created>
                <updated>Fri, 15 May 2020 08:01:06 +0000</updated>
                            <resolved>Mon, 5 Mar 2018 07:22:56 +0000</resolved>
                                        <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="16243527" author="krummas" created="Wed, 8 Nov 2017 08:30:58 +0000"  >&lt;p&gt;Patch for this &lt;a href=&quot;https://github.com/krummas/cassandra/commits/marcuse/nosharepairs&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; - it replaces the SHA-256 with Murmur3.&lt;/p&gt;

&lt;p&gt;Murmur3 is only 128 bit though, so the patch instead hashes every value twice using 2 different murmur3 instances with different seeds to get the same number of bits as SHA-256. The approach used is similar to what guava does in its ConcatenatedHashFunction.&lt;/p&gt;

&lt;p&gt;In my tests with semi-wide partitions (~100KB mean partition size) this reduces the time spent building merkle trees with at least 50%.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/422/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/422/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://circleci.com/gh/krummas/cassandra/173&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://circleci.com/gh/krummas/cassandra/173&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mkjellman&quot; class=&quot;user-hover&quot; rel=&quot;mkjellman&quot;&gt;mkjellman&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16244559" author="mkjellman" created="Wed, 8 Nov 2017 19:06:33 +0000"  >&lt;p&gt;awesome! I&apos;m guessing we don&apos;t need to worry about the upgrade path here because streaming will be broken between majors anyways, right?&lt;/p&gt;</comment>
                            <comment id="16244576" author="jasobrown" created="Wed, 8 Nov 2017 19:17:14 +0000"  >&lt;blockquote&gt;&lt;p&gt;we don&apos;t need to worry about the upgrade path here because streaming will be broken between majors anyways&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is correct, but not because &quot;streaming is broken between majors&quot;. There are no guarantees that an un-upgraded node would be parse to read sstables streamed to it from an upgrade node, as the sstable format may have changed (we do not force/guarantee backward compatibility of the sstable format). Thus, we don&apos;t support streaming between major versions (although there&apos;s nothing that bluntly states this, at least as far as I&apos;ve seen).&lt;/p&gt;</comment>
                            <comment id="16244696" author="mkjellman" created="Wed, 8 Nov 2017 20:44:02 +0000"  >&lt;p&gt;So +1 from me. Comments look good and I don&apos;t even see any code style related nits. 50% faster is a bigger win than I expected when I saw it in profiling a long long long time ago to be honest... so that&apos;s super awesome news! &lt;/p&gt;

&lt;p&gt;Looks like a few repair related dtests did fail but looking at stdout it seems that this is weirdness with the Apache Jenkins instance and ccm not starting instances cleanly and not any fallout from this change.&lt;/p&gt;</comment>
                            <comment id="16245359" author="krummas" created="Thu, 9 Nov 2017 08:27:51 +0000"  >&lt;p&gt;thanks for the review!&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;50% faster is a bigger win than I expected when I saw it in profiling&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;yeah, I think the biggest win is actually that guavas streaming hashers actually buffer the data to be hashed instead of hashing them byte-for-byte: &lt;a href=&quot;https://github.com/google/guava/blob/v23.3/guava/src/com/google/common/hash/AbstractStreamingHasher.java#L34&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/google/guava/blob/v23.3/guava/src/com/google/common/hash/AbstractStreamingHasher.java#L34&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;m rerunning the dtests &lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/424/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; before committing&lt;/p&gt;</comment>
                            <comment id="16245405" author="krummas" created="Thu, 9 Nov 2017 09:17:35 +0000"  >&lt;p&gt;also pushed a new commit after rebasing on latest trunk (upgrade guava to 23.3) if you could have a look &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mkjellman&quot; class=&quot;user-hover&quot; rel=&quot;mkjellman&quot;&gt;mkjellman&lt;/a&gt; (&lt;a href=&quot;https://github.com/krummas/cassandra/commits/marcuse/nosharepairs&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/krummas/cassandra/commits/marcuse/nosharepairs&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="16378941" author="mkjellman" created="Tue, 27 Feb 2018 17:00:28 +0000"  >&lt;p&gt;+1 to rebase.&lt;/p&gt;</comment>
                            <comment id="16385699" author="krummas" created="Mon, 5 Mar 2018 07:22:56 +0000"  >&lt;p&gt;and committed as &lt;tt&gt;68b81372cd838808b304d58677cdc86f6ec35ffa&lt;/tt&gt;, thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 37 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3mj3j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>mkjellman</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[mkjellman]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>