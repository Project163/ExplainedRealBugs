<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:41:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-5988] Make hint TTL customizable</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-5988</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Currently time to live for stored hints is hardcoded to be gc_grace_seconds. This causes problems for applications using backdated deletes as a form of optimistic locking. Hints for updates made to the same data on which delete was attempted can persist for days, making it impossible to determine if delete succeeded by doing read(ALL) after a reasonable delay. We need a way to explicitly configure hint TTL, either through schema parameter or through a yaml file.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12667676">CASSANDRA-5988</key>
            <summary>Make hint TTL customizable</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vkasar">Vishy Kasar</assignee>
                                    <reporter username="okibirev">Oleg Kibirev</reporter>
                        <labels>
                            <label>patch</label>
                    </labels>
                <created>Mon, 9 Sep 2013 21:45:11 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:06 +0000</updated>
                            <resolved>Mon, 28 Oct 2013 17:02:17 +0000</resolved>
                                        <fixVersion>1.2.12</fixVersion>
                    <fixVersion>2.0.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="13762414" author="kohlisankalp" created="Mon, 9 Sep 2013 22:45:31 +0000"  >&lt;p&gt;We also want to make sure that hint TTL is less than gc grace period. &lt;/p&gt;</comment>
                            <comment id="13765717" author="brandon.williams" created="Thu, 12 Sep 2013 18:11:00 +0000"  >&lt;p&gt;So this would be per-cf? That&apos;s how hints are TTL&apos;d currently.&lt;/p&gt;</comment>
                            <comment id="13765724" author="okibirev" created="Thu, 12 Sep 2013 18:15:23 +0000"  >&lt;p&gt;That would be ideal, yes. &lt;/p&gt;</comment>
                            <comment id="13765737" author="jbellis" created="Thu, 12 Sep 2013 18:27:05 +0000"  >&lt;p&gt;Hint TTL will be exactly gc grace for the reasons documented in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5314&quot; title=&quot;Replaying old batches can &amp;#39;undo&amp;#39; deletes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5314&quot;&gt;&lt;del&gt;CASSANDRA-5314&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&quot;using backdated deletes as a form of optimistic locking&quot; sounds like a bad idea, would you care to defend it? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13765765" author="okibirev" created="Thu, 12 Sep 2013 18:44:53 +0000"  >&lt;p&gt;Referencing the above JIRA, there is no harm in having smaller hint TTL.&lt;/p&gt;

&lt;p&gt;As for optimistic locking, the only other form (CAS) is not available until cassandra 2.0 and even then does not provide performance for very high volume operations.&lt;/p&gt;

&lt;p&gt;If the objective is to do a user facing operation and a background operation simultaneously and without external locking, and to have background operation lose if there is an intervening user operation, backdating the background operation by a certain amount is a good compromise between consistency and performance. This feature will safeguard against user operation failing, being only stored as a hint and then confusing the background process as to ultimate success or failure of the backdated operation.&lt;/p&gt;</comment>
                            <comment id="13801046" author="vkasar" created="Mon, 21 Oct 2013 20:35:37 +0000"  >&lt;p&gt;Index: branches/release/apache-cassandra-1.1.12/src/java/org/apache/cassandra/db/RowMutation.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; branches/release/apache-cassandra-1.1.12/src/java/org/apache/cassandra/db/RowMutation.java	(revision 105733)&lt;br/&gt;
+++ branches/release/apache-cassandra-1.1.12/src/java/org/apache/cassandra/db/RowMutation.java	(revision 105734)&lt;br/&gt;
@@ -123,6 +123,9 @@&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;}&lt;br/&gt;
      *&lt;br/&gt;
      */&lt;br/&gt;
+&lt;br/&gt;
+    static final int maxHintTTL = Integer.parseInt(System.getProperty(&quot;ciedb.maxHintTTL&quot;, String.valueOf(Integer.MAX_VALUE)));&lt;br/&gt;
+&lt;br/&gt;
     public static RowMutation hintFor(RowMutation mutation, ByteBuffer token) throws IOException&lt;br/&gt;
     {&lt;br/&gt;
         RowMutation rm = new RowMutation(Table.SYSTEM_TABLE, token);&lt;br/&gt;
@@ -131,7 +134,7 @@&lt;br/&gt;
         // determine the TTL for the RowMutation&lt;br/&gt;
         // this is set at the smallest GCGraceSeconds for any of the CFs in the RM&lt;br/&gt;
         // this ensures that deletes aren&apos;t &quot;undone&quot; by delivery of an old hint&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;int ttl = Integer.MAX_VALUE;&lt;br/&gt;
+        int ttl = maxHintTTL; //Integer.MAX_VALUE;&lt;br/&gt;
         for (ColumnFamily cf : mutation.getColumnFamilies())&lt;br/&gt;
             ttl = Math.min(ttl, cf.metadata().getGcGraceSeconds());&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="13801114" author="vkasar" created="Mon, 21 Oct 2013 21:33:19 +0000"  >&lt;p&gt;Attached the diff as a file 5988.txt&lt;/p&gt;</comment>
                            <comment id="13806920" author="brandon.williams" created="Mon, 28 Oct 2013 16:54:57 +0000"  >&lt;p&gt;I couldn&apos;t get this patch to apply, but it was simple enough to just recreate, so I committed it to 1.2.  It looks like we need a separate patch for 2.0/trunk, however.&lt;/p&gt;</comment>
                            <comment id="13806926" author="brandon.williams" created="Mon, 28 Oct 2013 17:02:17 +0000"  >&lt;p&gt;Committed to 2.0/trunk.&lt;/p&gt;</comment>
                            <comment id="13806938" author="brandon.williams" created="Mon, 28 Oct 2013 17:09:06 +0000"  >&lt;p&gt;I should note that I also changed the property name to &quot;cassandra.maxHintTTL&quot;&lt;/p&gt;</comment>
                            <comment id="15567501" author="kohlisankalp" created="Wed, 12 Oct 2016 04:12:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iamaleksey&quot; class=&quot;user-hover&quot; rel=&quot;iamaleksey&quot;&gt;iamaleksey&lt;/a&gt; I could not search &quot;cassandra.maxHintTTL&quot; in 3.0.9. With new hints in 3.0, how can we change this?&lt;/p&gt;</comment>
                            <comment id="15568350" author="iamaleksey" created="Wed, 12 Oct 2016 10:36:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kohlisankalp&quot; class=&quot;user-hover&quot; rel=&quot;kohlisankalp&quot;&gt;kohlisankalp&lt;/a&gt; Will need to either modify &lt;tt&gt;HintsDispatcher&lt;/tt&gt; logic to take &apos;maxhintttl&apos; into account (compared to current time - hint&apos;s creationTime), or do the same even earlier, in &lt;tt&gt;HintsReader&lt;/tt&gt;. The former is probably cleaner; the latter can be done a bit more efficiently - skipping hint body entirely if gcgs/creationTime/maxhinttl combination says the hint is basically dead.&lt;/p&gt;

&lt;p&gt;Don&apos;t have time atm to do it, but &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bdeggleston&quot; class=&quot;user-hover&quot; rel=&quot;bdeggleston&quot;&gt;bdeggleston&lt;/a&gt; should be pretty familiar with that code, as he added compression logic - I can review.&lt;/p&gt;</comment>
                            <comment id="15570311" author="kohlisankalp" created="Thu, 13 Oct 2016 00:07:12 +0000"  >&lt;p&gt;Without hintTTL, if we replay data older than GC grace, that will bring back data right? If it is not there in 3.0, it should be fixed as Major if not blocker? &lt;/p&gt;</comment>
                            <comment id="15572332" author="iamaleksey" created="Thu, 13 Oct 2016 15:59:32 +0000"  >&lt;p&gt;Nope, we are all good. We store creationTime and gcgs (at the time of hint&apos;s write), and check against current time (and current gcgs) before replaying. Essentially following the old behaviour, except even stricter (we use the min of gcgs at the time of writing the hint and the gcgs at the time of replay).&lt;/p&gt;

&lt;p&gt;What changed is that you cannot &lt;b&gt;override&lt;/b&gt; the &lt;b&gt;max&lt;/b&gt; hintttl in 3.0 anymore to make it lower - or larger - than the calculated value.&lt;/p&gt;</comment>
                            <comment id="15572584" author="kohlisankalp" created="Thu, 13 Oct 2016 17:19:59 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iamaleksey&quot; class=&quot;user-hover&quot; rel=&quot;iamaleksey&quot;&gt;iamaleksey&lt;/a&gt;. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12609531" name="5988.txt" size="1204" author="vkasar" created="Mon, 21 Oct 2013 21:32:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[vkasar]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>347613</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 5 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1nxvr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>347912</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>brandon.williams</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311124" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Tester</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>brandon.williams</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>