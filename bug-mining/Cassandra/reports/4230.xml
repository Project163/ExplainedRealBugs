<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:02:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-11574] clqsh: COPY FROM throws TypeError with Cython extensions enabled</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-11574</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Any COPY FROM command in cqlsh is throwing the following error:&lt;/p&gt;

&lt;p&gt;&quot;get_num_processes() takes no keyword arguments&quot;&lt;/p&gt;

&lt;p&gt;Example command: &lt;/p&gt;

&lt;p&gt;COPY inboxdata (to_user_id,to_user_network,created_time,attachments,from_user_id,from_user_name,from_user_network,id,message,to_user_name,updated_time) FROM &apos;inbox.csv&apos;;&lt;/p&gt;

&lt;p&gt;Similar commands worked parfectly in the previous versions such as 3.0.4&lt;/p&gt;</description>
                <environment>&lt;p&gt;Operating System: Ubuntu Server 14.04&lt;br/&gt;
JDK: Oracle JDK 8 update 77&lt;br/&gt;
Python: 2.7.6&lt;/p&gt;</environment>
        <key id="12958863">CASSANDRA-11574</key>
            <summary>clqsh: COPY FROM throws TypeError with Cython extensions enabled</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stefania">Stefania Alborghetti</assignee>
                                    <reporter username="masumsoft">Mahafuzur Rahman</reporter>
                        <labels>
                            <label>cqlsh</label>
                    </labels>
                <created>Thu, 14 Apr 2016 14:34:10 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:36 +0000</updated>
                            <resolved>Fri, 22 Apr 2016 01:48:18 +0000</resolved>
                                        <fixVersion>2.1.15</fixVersion>
                    <fixVersion>2.2.7</fixVersion>
                    <fixVersion>3.0.6</fixVersion>
                    <fixVersion>3.6</fixVersion>
                                    <component>Legacy/Tools</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="15244129" author="masumsoft" created="Sat, 16 Apr 2016 10:09:18 +0000"  >&lt;p&gt;Looks like the problem is in this line:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/pylib/cqlshlib/copyutil.py#L321&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/trunk/pylib/cqlshlib/copyutil.py#L321&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Here get_num_processes is being called as a kwarg. Looks like this should be a simple fix, though i&apos;m not very sure. As i&apos;m currently stuck with this problem, i wanted to know if changing this file in my installed cassandra would solve the problem or do i need to do some compilation steps to reload the changed python source? I&apos;ve installed cassandra from package installation (using apt-get). &lt;/p&gt;</comment>
                            <comment id="15250628" author="nandakishore.arvapaly@aggiemail.usu.edu" created="Wed, 20 Apr 2016 20:18:08 +0000"  >&lt;p&gt;Even I faced the same issue when trying to execute below command.&lt;/p&gt;

&lt;p&gt;copy movie(movieid,moviename,releasedyear) from &apos;/root/cassandra_data/moviebyyear.csv&apos;;&lt;/p&gt;

&lt;p&gt;These are the version I use&lt;br/&gt;
cqlsh 5.0.1, Cassandra 3.0.5, CQL spec 3.4.0 .&lt;/p&gt;

&lt;p&gt;I didn&apos;t faced this issue when i&apos;m using dsc20 version.&lt;/p&gt;

&lt;p&gt;Can someone please resolve this quickly.&lt;/p&gt;</comment>
                            <comment id="15251067" author="stefania" created="Thu, 21 Apr 2016 01:25:46 +0000"  >&lt;p&gt;I&apos;m really sorry but I cannot not reproduce this: not locally on my laptop running Ubuntu Trusty with python 2.7.6, nor on any of our CI servers, which run tests on Debian Jessie and Windows using Python 2.7. &lt;/p&gt;

&lt;p&gt;The line calling &lt;tt&gt;get_num_processes&lt;/tt&gt; or its signature haven&apos;t changed since 3.0.4 but the implementation has. It&apos;s worth testing it, although by reading &lt;a href=&quot;https://docs.python.org/2.7/reference/expressions.html#calls&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;the documentation&lt;/a&gt; I don&apos;t see why &lt;tt&gt;cap=16&lt;/tt&gt; would cause this issue now and not previously.&lt;/p&gt;

&lt;p&gt;It is safe to edit copyutil.py, no other changes or compilation is required:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;-        copy_options[&lt;span class=&quot;code-quote&quot;&gt;&apos;numprocesses&apos;&lt;/span&gt;] = &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;(opts.pop(&lt;span class=&quot;code-quote&quot;&gt;&apos;numprocesses&apos;&lt;/span&gt;, self.get_num_processes(cap=16)))
+        copy_options[&lt;span class=&quot;code-quote&quot;&gt;&apos;numprocesses&apos;&lt;/span&gt;] = &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;(opts.pop(&lt;span class=&quot;code-quote&quot;&gt;&apos;numprocesses&apos;&lt;/span&gt;, self.get_num_processes(16)))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Would you mind testing this change to see if it fixes it? &lt;/p&gt;

&lt;p&gt;If this doesn&apos;t work, could you share your schema and a sample csv file, along with the full output obtained by running cqlsh with the &lt;tt&gt;--debug&lt;/tt&gt; option?&lt;/p&gt;</comment>
                            <comment id="15251149" author="nandakishore.arvapaly@aggiemail.usu.edu" created="Thu, 21 Apr 2016 02:40:46 +0000"  >&lt;p&gt;Hi Stefania,&lt;/p&gt;

&lt;p&gt;I have tried the way you said but still faced the same issue.&lt;/p&gt;


&lt;p&gt;Here is my simple schema for table &quot;movie&quot;&lt;/p&gt;

&lt;p&gt;CREATE TABLE movie (&lt;br/&gt;
movieid int,&lt;br/&gt;
moviename text,&lt;br/&gt;
releasedyear int,&lt;br/&gt;
PRIMARY KEY(releasedyear,movieid,moviename)&lt;br/&gt;
);&lt;/p&gt;

&lt;p&gt;My sample data&lt;/p&gt;

&lt;p&gt;1,Toy Story,1995&lt;br/&gt;
2,Jumanji,1995&lt;br/&gt;
3,Grumpier Old Men,1995&lt;br/&gt;
4,Waiting to Exhale,1995&lt;br/&gt;
5,Father of the Bride Part II,1995&lt;br/&gt;
6,Heat,1995&lt;br/&gt;
7,Sabrina,1995&lt;br/&gt;
8,Tom and Huck,1995&lt;br/&gt;
9,Sudden Death,1995&lt;br/&gt;
10,GoldenEye,1995&lt;/p&gt;

&lt;p&gt;The command I used to get into cqlsh&lt;/p&gt;

&lt;p&gt;cqlsh 172.17.3.77 9042 --debug&lt;/p&gt;


&lt;p&gt;The COPY command I executed&lt;/p&gt;

&lt;p&gt;copy movie from &apos;/root/cassandra_data/moviebyyear.csv&apos;;&lt;/p&gt;


&lt;p&gt;The error I got&lt;br/&gt;
cqlsh:moviesdb&amp;gt; copy movie12 from &apos;/root/cassandra_data/moviebyyear12.csv&apos;;&lt;br/&gt;
Traceback (most recent call last):&lt;br/&gt;
  File &quot;/usr/bin/cqlsh.py&quot;, line 1191, in onecmd&lt;br/&gt;
    self.handle_statement(st, statementtext)&lt;br/&gt;
  File &quot;/usr/bin/cqlsh.py&quot;, line 1228, in handle_statement&lt;br/&gt;
    return custom_handler(parsed)&lt;br/&gt;
  File &quot;/usr/bin/cqlsh.py&quot;, line 1937, in do_copy&lt;br/&gt;
    task = ImportTask(self, ks, table, columns, fname, opts, DEFAULT_PROTOCOL_VERSION, CONFIG_FILE)&lt;br/&gt;
  File &quot;cqlshlib/copyutil.py&quot;, line 1052, in cqlshlib.copyutil.ImportTask._&lt;em&gt;init&lt;/em&gt;_ (cqlshlib/copyutil.c:27710)&lt;br/&gt;
    CopyTask._&lt;em&gt;init&lt;/em&gt;_(self, shell, ks, table, columns, fname, opts, protocol_version, config_file, &apos;from&apos;)&lt;br/&gt;
  File &quot;cqlshlib/copyutil.py&quot;, line 219, in cqlshlib.copyutil.CopyTask._&lt;em&gt;init&lt;/em&gt;_ (cqlshlib/copyutil.c:9708)&lt;br/&gt;
    self.options = self.parse_options(opts, direction)&lt;br/&gt;
  File &quot;cqlshlib/copyutil.py&quot;, line 320, in cqlshlib.copyutil.CopyTask.parse_options (cqlshlib/copyutil.c:11850)&lt;br/&gt;
    copy_options&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;numprocesses&amp;#39;&amp;#93;&lt;/span&gt; = int(opts.pop(&apos;numprocesses&apos;, self.get_num_processes(16)))&lt;br/&gt;
TypeError: get_num_processes() takes no keyword arguments&lt;/p&gt;</comment>
                            <comment id="15251194" author="stefania" created="Thu, 21 Apr 2016 03:43:29 +0000"  >&lt;p&gt;Try using this command: &lt;tt&gt;copy ks.movie (movieid, moviename, releasedyear) from &apos;movies.csv&apos;;&lt;/tt&gt;. Otherwise the columns in the table and file do not match and it should fail, as expected, with &lt;tt&gt;Failed to import 1 rows: ParseError - invalid literal for int() with base 10: &apos;Sabrina&apos;,  given up without retries&lt;/tt&gt; and so forth for each row.&lt;/p&gt;

&lt;p&gt;To see the column order in the table you can issue &lt;tt&gt;DESCRIBE TABLE table_name&lt;/tt&gt;. The release year is moved to the first column because it is the partition key, even though it is the third column in the CREATE TABLE command.&lt;/p&gt;

&lt;p&gt;Assuming the column names are specified, then it works fine for me. Could you confirm? If it still fails, what is your Python implementation and version?&lt;/p&gt;</comment>
                            <comment id="15251210" author="nandakishore.arvapaly@aggiemail.usu.edu" created="Thu, 21 Apr 2016 03:55:49 +0000"  >&lt;p&gt;I tried by giving the columns names too but still get the same error that I listed recently with --debug option.The order of columns in csv file and the copy command matches.&lt;/p&gt;

&lt;p&gt;copy moviesdb.movie(movieid,moviename,releasedyear) from &apos;/root/cassandra_data/moviebyyear.csv&apos;;&lt;/p&gt;

&lt;p&gt;The python version i&apos;m using is &quot;Python 2.7.6&quot;. I installed the python using tarball installation.&lt;/p&gt;</comment>
                            <comment id="15251237" author="stefania" created="Thu, 21 Apr 2016 04:28:17 +0000"  >&lt;p&gt;OK - let me see if I can reproduce using a Python tarball installation. My installation is based on the default Ubuntu packages: &lt;tt&gt;apt-get install -y python python-pip python-dev python-setuptools&lt;/tt&gt;, the version is also 2.7.6.&lt;/p&gt;</comment>
                            <comment id="15251314" author="stefania" created="Thu, 21 Apr 2016 05:46:23 +0000"  >&lt;p&gt;I&apos;ve installed Python 2.7.6 from a tarball, by following the instructions in the first answer of this &lt;a href=&quot;http://askubuntu.com/questions/101591/how-do-i-install-python-2-7-2-on-ubuntu&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;link&lt;/a&gt;, still no luck I&apos;m afraid.&lt;/p&gt;

&lt;p&gt;I&apos;m really in the dark here, let&apos;s try replacing the problematic line with these 2 lines, maybe we get more clues:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    num_processes = ImportTask.get_num_processes(16)
    copy_options[&lt;span class=&quot;code-quote&quot;&gt;&apos;numprocesses&apos;&lt;/span&gt;] = &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;(opts.pop(&lt;span class=&quot;code-quote&quot;&gt;&apos;numprocesses&apos;&lt;/span&gt;, num_processes))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As a workaround, you can also set &lt;tt&gt;num_processes&lt;/tt&gt; to a reasonable default, &lt;tt&gt;get_num_processes()&lt;/tt&gt; will return the number of cores on the machine minus 1, capped at 16, so you could set &lt;tt&gt;num_processes = 3&lt;/tt&gt; on a 4 core machine for example.&lt;/p&gt;
</comment>
                            <comment id="15251334" author="nandakishore.arvapaly@aggiemail.usu.edu" created="Thu, 21 Apr 2016 06:11:46 +0000"  >&lt;p&gt;Thanks for explaining about get_num_processes.&lt;/p&gt;

&lt;p&gt;I&apos;m running Spark and Cassandra on 2 nodes where spark already took the available 1 core in that machine which Cassandra is getting zero for that value. This is the main problem I guess. please let me know if this is issue.&lt;/p&gt;

&lt;p&gt;I have 2 nodes where I only 1 core each. When I start spark with these 2 as slaves and one of them as master, its taking the 1 core for each node making it unavailable for get_num_processes.&lt;/p&gt;

&lt;p&gt;So Can&apos;t I run the COPY command with 1 core machine?&lt;/p&gt;</comment>
                            <comment id="15251361" author="stefania" created="Thu, 21 Apr 2016 06:25:17 +0000"  >&lt;blockquote&gt;&lt;p&gt;spark already took the available 1 core in that machine which Cassandra is getting zero for that value. This is the main problem I guess. please let me know if this is issue.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No I don&apos;t think so. &lt;tt&gt;get_num_processes()&lt;/tt&gt; will never return zero and it uses &lt;tt&gt;get_num_cores()&lt;/tt&gt;, which relies on &lt;tt&gt;mp.cpu_count()&lt;/tt&gt;, doc &lt;a href=&quot;https://docs.python.org/2/library/multiprocessing.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;. This returns the number of cores available on the system, I don&apos;t think it would know that Spark has taken one.  Besides, even if the system only has one core, it should still work with 1 process. We have an environment variable that we set to simulate 1-core machines in our tests and Datastax tested COPY code on single core VMs as well. Also, it is the cores of the machine that runs cqlsh that matter, not the machine that runs the Cassandra server (just in case if this wasn&apos;t clear before). &lt;/p&gt;

&lt;p&gt;Are you still getting the exact same error with the two lines above? What about if you don&apos;t call &lt;tt&gt;get_num_processes&lt;/tt&gt; at all and fix &lt;tt&gt;num_processes&lt;/tt&gt; to 1, does that work?&lt;/p&gt;

&lt;p&gt;Full code here:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@staticmethod
    def get_num_processes(cap):
        &quot;&quot;&quot;
        Pick a reasonable number of child processes. We need to leave at
        least one core &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the parent or feeder process.
        &quot;&quot;&quot;
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; max(1, min(cap, CopyTask.get_num_cores() - 1))

    @staticmethod
    def get_num_cores():
        &quot;&quot;&quot;
        Return the number of cores &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; available. If the test environment variable
        is set, then &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; the number carried by &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; variable. This is to test single-core
        machine more easily.
        &quot;&quot;&quot;
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;:
            num_cores_for_testing = os.environ.get(&lt;span class=&quot;code-quote&quot;&gt;&apos;CQLSH_COPY_TEST_NUM_CORES&apos;&lt;/span&gt;, &apos;&apos;)
            ret = &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;(num_cores_for_testing) &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; num_cores_for_testing &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; mp.cpu_count()
            printdebugmsg(&lt;span class=&quot;code-quote&quot;&gt;&quot;Detected %d core(s)&quot;&lt;/span&gt; % (ret,))
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ret
        except NotImplementedError:
            printdebugmsg(&lt;span class=&quot;code-quote&quot;&gt;&quot;Failed to detect number of cores, returning 1&quot;&lt;/span&gt;)
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; 1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15251419" author="nandakishore.arvapaly@aggiemail.usu.edu" created="Thu, 21 Apr 2016 06:59:27 +0000"  >&lt;p&gt;I&apos;m not sure the exact reason but still facing the same problem. &lt;/p&gt;

&lt;p&gt;Traceback (most recent call last):&lt;br/&gt;
  File &quot;/usr/bin/cqlsh.py&quot;, line 1191, in onecmd&lt;br/&gt;
    self.handle_statement(st, statementtext)&lt;br/&gt;
  File &quot;/usr/bin/cqlsh.py&quot;, line 1228, in handle_statement&lt;br/&gt;
    return custom_handler(parsed)&lt;br/&gt;
  File &quot;/usr/bin/cqlsh.py&quot;, line 1937, in do_copy&lt;br/&gt;
    task = ImportTask(self, ks, table, columns, fname, opts, DEFAULT_PROTOCOL_VERSION, CONFIG_FILE)&lt;br/&gt;
  File &quot;cqlshlib/copyutil.py&quot;, line 1052, in cqlshlib.copyutil.ImportTask._&lt;em&gt;init&lt;/em&gt;_ (cqlshlib/copyutil.c:27710)&lt;br/&gt;
    def _&lt;em&gt;init&lt;/em&gt;_(self, shell, ks, table, columns, fname, opts, protocol_version, config_file):&lt;br/&gt;
  File &quot;cqlshlib/copyutil.py&quot;, line 219, in cqlshlib.copyutil.CopyTask._&lt;em&gt;init&lt;/em&gt;_ (cqlshlib/copyutil.c:9708)&lt;br/&gt;
    self.options = self.parse_options(opts, direction)&lt;br/&gt;
  File &quot;cqlshlib/copyutil.py&quot;, line 320, in cqlshlib.copyutil.CopyTask.parse_options (cqlshlib/copyutil.c:11850)&lt;br/&gt;
    anum_processes = 1&lt;br/&gt;
TypeError: get_num_processes() takes no keyword arguments&lt;/p&gt;

&lt;p&gt;I made the changes as below&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;root@nanda03 cassandra_data&amp;#93;&lt;/span&gt;# grep &quot;anum_processes&quot; /usr/lib/python2.7/site-packages/cqlshlib/copyutil.py&lt;br/&gt;
        anum_processes = 1&lt;br/&gt;
        copy_options&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;numprocesses&amp;#39;&amp;#93;&lt;/span&gt; = int(opts.pop(&apos;numprocesses&apos;, anum_processes))&lt;/p&gt;
</comment>
                            <comment id="15251482" author="stefania" created="Thu, 21 Apr 2016 07:29:11 +0000"  >&lt;p&gt;Move &lt;em&gt;copyutil.c&lt;/em&gt; somewhere else. Same thing if you also have a &lt;em&gt;copyutil.so&lt;/em&gt;. &lt;/p&gt;

&lt;p&gt;I assumed an updated .py file would cause the .c file to be recompiled when running the Python command but it doesn&apos;t look like it.&lt;/p&gt;</comment>
                            <comment id="15251502" author="nandakishore.arvapaly@aggiemail.usu.edu" created="Thu, 21 Apr 2016 07:49:49 +0000"  >&lt;p&gt;Awesome Stefania !!!&lt;br/&gt;
Now it worked.&lt;/p&gt;

&lt;p&gt;I replaced the python code as below and also it worked.&lt;br/&gt;
copy_options&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;numprocesses&amp;#39;&amp;#93;&lt;/span&gt; = int(opts.pop(&apos;numprocesses&apos;, self.get_num_processes(cap=16)))&lt;/p&gt;

&lt;p&gt;So the problem is with the python .pyc and .so file. I will keep that in mind.&lt;/p&gt;

&lt;p&gt;Thanks a lot for suggesting and spending your time.&lt;/p&gt;</comment>
                            <comment id="15251530" author="stefania" created="Thu, 21 Apr 2016 08:13:15 +0000"  >&lt;p&gt;You&apos;re welcome, thanks for helping us debug this.&lt;/p&gt;

&lt;p&gt;&lt;del&gt;.pyc&lt;/del&gt; .c and .so are actually Cython extensions and they must be deleted manually or else changing the .py has not effect. I had no idea they would be present in package deployments. &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11053&quot; title=&quot;COPY FROM on large datasets: fix progress report and optimize performance part 4&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11053&quot;&gt;&lt;del&gt;CASSANDRA-11053&lt;/del&gt;&lt;/a&gt;, which was delivered in 3.0.5, modified &lt;em&gt;pylib/setup.py&lt;/em&gt; so that people can create these files manually for added performance by typing &lt;tt&gt;python setup.py build_ext --inplace&lt;/tt&gt; in the pylib folder. They must be generated somewhere when the package is created. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mshuler&quot; class=&quot;user-hover&quot; rel=&quot;mshuler&quot;&gt;mshuler&lt;/a&gt;: do you know how the packaging process uses &lt;em&gt;pylib/setup.py&lt;/em&gt;?&lt;/p&gt;

&lt;p&gt;The initial solution, &lt;tt&gt;copy_options[&apos;numprocesses&apos;] = int(opts.pop(&apos;numprocesses&apos;, self.get_num_processes(16)))&lt;/tt&gt; is actually correct, provided the &lt;del&gt;.pyc&lt;/del&gt; .c and .so are regenerated by running &lt;tt&gt;python setup.py build_ext --inplace&lt;/tt&gt; or, as you already pointed out, if they are removed (in which case the original code also works).&lt;/p&gt;

&lt;p&gt;I will prepare a patch so that the Cython extensions also work.&lt;/p&gt;</comment>
                            <comment id="15251536" author="nandakishore.arvapaly@aggiemail.usu.edu" created="Thu, 21 Apr 2016 08:18:44 +0000"  >&lt;p&gt;May be its modified in tar file package but not in repository when we do yum install dsc30&lt;/p&gt;</comment>
                            <comment id="15251642" author="stefania" created="Thu, 21 Apr 2016 09:44:31 +0000"  >&lt;p&gt;Here is the patch for all branches affected:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.1&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.2&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.0&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/11574-2.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/11574-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/11574-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/11574&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-11574-2.1-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-11574-2.2-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-11574-3.0-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-11574-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;The 2.1 patch up-merges upwards without conflicts. It&apos;s so trivial that I&apos;ve run CI only on 3.0. We need to request to the test eng. team to set-up a cqlsh job where we run the copy tests with the Cython extensions enabled. cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=philipthompson&quot; class=&quot;user-hover&quot; rel=&quot;philipthompson&quot;&gt;philipthompson&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thobbs&quot; class=&quot;user-hover&quot; rel=&quot;thobbs&quot;&gt;thobbs&lt;/a&gt; or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pauloricardomg&quot; class=&quot;user-hover&quot; rel=&quot;pauloricardomg&quot;&gt;pauloricardomg&lt;/a&gt; would you mind reviewing?&lt;/p&gt;</comment>
                            <comment id="15252316" author="mshuler" created="Thu, 21 Apr 2016 17:47:59 +0000"  >&lt;p&gt;The deb rules builds the .so with a patch I am working on for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10853&quot; title=&quot;deb package migration to dh_python2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10853&quot;&gt;&lt;del&gt;CASSANDRA-10853&lt;/del&gt;&lt;/a&gt;, since cython is a new dependency. I assume Jake has cython installed by chance, otherwise the deb build exits.&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/debian/rules#L33-L34&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/trunk/debian/rules#L33-L34&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15252348" author="crolo" created="Thu, 21 Apr 2016 17:56:13 +0000"  >&lt;p&gt;Same issue in 3.5, available patch fixes it.&lt;/p&gt;

&lt;p&gt;+1 to this!&lt;/p&gt;</comment>
                            <comment id="15252798" author="thobbs" created="Thu, 21 Apr 2016 21:40:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Stefania&quot; class=&quot;user-hover&quot; rel=&quot;stefania&quot;&gt;Stefania&lt;/a&gt; +1 to the patch, and +1 on running the copy tests with and without Cython extensions enabled&lt;/p&gt;</comment>
                            <comment id="15253157" author="stefania" created="Fri, 22 Apr 2016 01:47:02 +0000"  >&lt;p&gt;Thanks everyone for your input and for the review Tyler.&lt;/p&gt;

&lt;p&gt;I&apos;ve created &lt;a href=&quot;https://datastax.jira.com/browse/CSTAR-505&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CSTAR-505&lt;/a&gt;(private) in order to test cqlsh copy with Cython extensions built.&lt;/p&gt;

&lt;p&gt;I&apos;ve created &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11630&quot; title=&quot;Make cython optional in pylib/setup.py&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11630&quot;&gt;&lt;del&gt;CASSANDRA-11630&lt;/del&gt;&lt;/a&gt; in order to modify &lt;em&gt;pylib/setup.py&lt;/em&gt; to exclude Cython extensions during packaging. I don&apos;t think we need the extensions by default. This was never the intention of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11053&quot; title=&quot;COPY FROM on large datasets: fix progress report and optimize performance part 4&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11053&quot;&gt;&lt;del&gt;CASSANDRA-11053&lt;/del&gt;&lt;/a&gt;. The intention was for people to build them manually when needed for performance reasons, as explained in &lt;a href=&quot;http://www.datastax.com/dev/blog/six-parameters-affecting-cqlsh-copy-from-performance&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this blog&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I&apos;ve committed this patch to 2.1 as 666bee6125af04602a61d4781435598085a503d5 and merged upwards.&lt;/p&gt;</comment>
                            <comment id="15253161" author="stefania" created="Fri, 22 Apr 2016 01:48:18 +0000"  >&lt;p&gt;Note: 2.1.15 release tag not yet available so leaving it as 2.1.x&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12970405">CASSANDRA-11816</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12961491">CASSANDRA-11630</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12970405">CASSANDRA-11816</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12932942">CASSANDRA-11053</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[stefania]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 30 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2w4kf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12334964">3.0.5</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>thobbs</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thobbs]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12334964">3.0.5</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>