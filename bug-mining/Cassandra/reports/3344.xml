<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:50:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6706] Duplicate rows returned when in clause has repeated values</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6706</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;If a value is repeated within an IN clause then repeated rows are returned for  the repeats:&lt;br/&gt;
cqlsh&amp;gt; create table t1(c1 text primary key);&lt;br/&gt;
cqlsh&amp;gt; insert into t1(c1) values (&apos;A&apos;);&lt;br/&gt;
cqlsh&amp;gt; select * from t1;&lt;/p&gt;

&lt;p&gt; c1&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;  A&lt;/p&gt;

&lt;p&gt;cqlsh&amp;gt; select * from t1 where c1 = &apos;A&apos;;&lt;/p&gt;

&lt;p&gt; c1&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;  A&lt;/p&gt;

&lt;p&gt;cqlsh&amp;gt; select * from t1 where c1 in( &apos;A&apos;);&lt;/p&gt;

&lt;p&gt; c1&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;  A&lt;/p&gt;

&lt;p&gt;cqlsh:dslog&amp;gt; select * from t1 where c1 in( &apos;A&apos;,&apos;A&apos;);&lt;/p&gt;

&lt;p&gt; c1&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;  A&lt;br/&gt;
  A&lt;/p&gt;</description>
                <environment>&lt;p&gt;Found on &lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;cqlsh 4.1.0 | Cassandra 2.0.3-SNAPSHOT | CQL spec 3.0.0 | Thrift protocol 19.38.0&amp;#93;&lt;/span&gt;&lt;/p&gt;</environment>
        <key id="12695163">CASSANDRA-6706</key>
            <summary>Duplicate rows returned when in clause has repeated values</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="blerer">Benjamin Lerer</assignee>
                                    <reporter username="Mehitabel">Gavin Casey</reporter>
                        <labels>
                            <label>cql</label>
                    </labels>
                <created>Fri, 14 Feb 2014 08:51:24 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:53 +0000</updated>
                            <resolved>Wed, 21 Jan 2015 19:27:04 +0000</resolved>
                                        <fixVersion>2.2.0 beta 1</fixVersion>
                                    <component>Legacy/CQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="13901413" author="slebresne" created="Fri, 14 Feb 2014 13:19:14 +0000"  >&lt;p&gt;That is kind of the intended behavior. Is it the best behavior? I don&apos;t know, though I&apos;m not sure it matters much in practice tbh. But when there is an IN, we do order the resulting rows following the order of the values in the IN (unless there is an explicit ordering that takes precedence of course) which kind of suggest we consider the IN values as a list rather than a set, and from that perspective, it&apos;s probably not entirely crazy to return duplicate results in that case. In particular, if you use a prepared marker for an IN, the server will expect a list, not a set for the values (and changing now would really break users). It&apos;s easy enough to avoid the duplication client side if you don&apos;t want duplicates.&lt;/p&gt;

&lt;p&gt;Don&apos;t get me wrong, I&apos;m not saying not returning duplicate in that case would be inferior, but rather that I don&apos;t see a big problem with the current behavior and so that I&apos;d rather not introduce a breaking change, even a small one, for no good reason.&lt;/p&gt;</comment>
                            <comment id="13901446" author="mehitabel" created="Fri, 14 Feb 2014 13:38:48 +0000"  >&lt;p&gt;If I were performing a calculation summing the results then the answer would be wrong. &lt;br/&gt;
I suppose it is arguable that I should know better than to put duplicates in an in clause but this bit me when I was generating a query by aggregating selection parameters from separate sources.&lt;br/&gt;
My background is much more extensive in relational databases and in Postgres (to take my preferred example) I would only get back one row for this query which in terms of correctness is absolutely what I would expect.&lt;/p&gt;</comment>
                            <comment id="14141223" author="philipthompson" created="Fri, 19 Sep 2014 20:19:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt; Should this be closed as Won&apos;t Fix or Not a Problem, or left open?&lt;/p&gt;</comment>
                            <comment id="14141266" author="philipthompson" created="Fri, 19 Sep 2014 20:46:52 +0000"  >&lt;p&gt;IRC discussion shows a desire to fix this in 3.0, but only to warn in 2.1.&lt;/p&gt;</comment>
                            <comment id="14141296" author="rcoli" created="Fri, 19 Sep 2014 21:05:15 +0000"  >&lt;p&gt;No DBA or developer familiar with SQL will expect this behavior. 100% of them will find it unexpected, and many will conclude it is a bug.&lt;/p&gt;

&lt;p&gt;I understand CQL is not SQL, but people expect similar semantics.&lt;/p&gt;</comment>
                            <comment id="14285507" author="blerer" created="Wed, 21 Jan 2015 11:22:50 +0000"  >&lt;p&gt;This behavior has apparently already been changed in trunk during the &lt;tt&gt;SelectStatement&lt;/tt&gt; refactoring &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7981&quot; title=&quot;Refactor SelectStatement&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7981&quot;&gt;&lt;del&gt;CASSANDRA-7981&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14285513" author="blerer" created="Wed, 21 Jan 2015 11:25:55 +0000"  >&lt;p&gt;The patch for 2.1 make sure that Cassandra will log a warning the first time a user execute a query containing an IN restriction with duplicate values on the primary key.&lt;/p&gt;

&lt;p&gt;The patch for trunk add unit tests to check the behavior and fix the &lt;tt&gt;CHANGES.txt&lt;/tt&gt; files.&lt;/p&gt;</comment>
                            <comment id="14285514" author="blerer" created="Wed, 21 Jan 2015 11:27:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=snazy&quot; class=&quot;user-hover&quot; rel=&quot;snazy&quot;&gt;snazy&lt;/a&gt; can you review?&lt;/p&gt;</comment>
                            <comment id="14285549" author="snazy" created="Wed, 21 Jan 2015 11:53:52 +0000"  >&lt;p&gt;Sure &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14285616" author="snazy" created="Wed, 21 Jan 2015 13:18:50 +0000"  >&lt;p&gt;+1 on the 2.1 patch. It triggers the warning once for the example in the ticket description.&lt;/p&gt;

&lt;p&gt;The trunk patch should have tests for duplicate IN values on the partition key.&lt;br/&gt;
It checks on duplicate IN values on the clustering key (even 2.1 does not return duplicates on CK duplicates).&lt;br/&gt;
You can simply add other assertions like &lt;tt&gt;SELECT * FROM %s WHERE k1 IN (?, ?) AND k2 = ?&lt;/tt&gt; or &lt;tt&gt;SELECT * FROM %s WHERE k1 IN (?, ?) AND k2 IN (?, ?)&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="14285632" author="blerer" created="Wed, 21 Jan 2015 13:43:41 +0000"  >&lt;p&gt;Adds the missing tests.&lt;/p&gt;</comment>
                            <comment id="14286119" author="snazy" created="Wed, 21 Jan 2015 19:27:04 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;committed as 0c2eaa9 (2.1) + 732986b (trunk, merge-commit)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12693568" name="CASSANDRA-6706-2.1.txt" size="2777" author="blerer" created="Wed, 21 Jan 2015 11:25:55 +0000"/>
                            <attachment id="12693589" name="CASSANDRA-6706-trunk-V2.txt" size="3736" author="blerer" created="Wed, 21 Jan 2015 13:43:41 +0000"/>
                            <attachment id="12693569" name="CASSANDRA-6706-trunk.txt" size="3449" author="blerer" created="Wed, 21 Jan 2015 11:25:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blerer]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>373671</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 43 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1se7r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>373971</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>snazy</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[snazy]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>