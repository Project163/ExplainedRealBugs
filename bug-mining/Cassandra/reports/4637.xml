<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:06:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-12876] Negative mean write latency</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-12876</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;The mean write latency returned by JMX turns negative every 30 minutes. As the attached screenshots show, the value turns negative every 30 minutes after the startup of the node.&lt;br/&gt;
We did not experience this behavior in 2.1.16.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13017722">CASSANDRA-12876</key>
            <summary>Negative mean write latency</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="eperott">Per Otterstr&#246;m</assignee>
                                    <reporter username="alprema">K&#233;vin LOVATO</reporter>
                        <labels>
                    </labels>
                <created>Thu, 3 Nov 2016 16:25:24 +0000</created>
                <updated>Fri, 15 May 2020 08:02:12 +0000</updated>
                            <resolved>Sun, 12 Feb 2017 07:33:37 +0000</resolved>
                                        <fixVersion>2.2.9</fixVersion>
                    <fixVersion>3.0.11</fixVersion>
                    <fixVersion>3.11.0</fixVersion>
                    <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Legacy/Observability</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15633349" author="cnlwsu" created="Thu, 3 Nov 2016 16:31:36 +0000"  >&lt;p&gt;I am certain this is related to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11752&quot; title=&quot;histograms/metrics in 2.2 do not appear recency biased&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11752&quot;&gt;&lt;del&gt;CASSANDRA-11752&lt;/del&gt;&lt;/a&gt; and its 30 min rescaling. if you access the values() of the histogram directly you wont see this for what its worth&lt;/p&gt;</comment>
                            <comment id="15633356" author="cnlwsu" created="Thu, 3 Nov 2016 16:32:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=eperott&quot; class=&quot;user-hover&quot; rel=&quot;eperott&quot;&gt;eperott&lt;/a&gt; any ideas?&lt;/p&gt;</comment>
                            <comment id="15646791" author="eperott" created="Tue, 8 Nov 2016 07:36:42 +0000"  >&lt;p&gt;Yes, must be related to the 30 minute rescaling. I&apos;m able o reproduce in a test cluster. I&apos;m seeing a similar pattern for the standard deviation as well.&lt;/p&gt;

&lt;p&gt;Can&apos;t make out why this happens just by reviewing code, but I&apos;ll run some more tests.&lt;/p&gt;</comment>
                            <comment id="15651375" author="alprema" created="Wed, 9 Nov 2016 16:36:33 +0000"  >&lt;p&gt;A zoom on the 30 minutes disturbance.&lt;/p&gt;</comment>
                            <comment id="15651382" author="alprema" created="Wed, 9 Nov 2016 16:40:33 +0000"  >&lt;p&gt;I looked at the code as well and can&apos;t see an obvious way to have negative values in decayingBuckets, even after a rescale(). Also, I noticed that the time during which the metric is negative lasts for about 3 minutes and it goes down under zero multiple times during this period of time (cf. &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12838191/12838191_negative_mean_details.PNG&quot; title=&quot;negative_mean_details.PNG attached to CASSANDRA-12876&quot;&gt;negative_mean_details.PNG&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;), where I would expect to see only one dip under zero if it was caused by the rescale. Hope those details will put you in the right direction.&lt;/p&gt;</comment>
                            <comment id="15655141" author="eperott" created="Thu, 10 Nov 2016 21:04:21 +0000"  >&lt;p&gt;Thanks for the input &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=alprema&quot; class=&quot;user-hover&quot; rel=&quot;alprema&quot;&gt;alprema&lt;/a&gt;!&lt;/p&gt;

&lt;p&gt;So, it appears that overflow doesn&apos;t happen during rescale, but when mean value is calculated. Triggered when all bucket values are added together. The sudden stop of negative values happened when rescale was triggerd.&lt;/p&gt;

&lt;p&gt;The attached patch will perform a rescale of the snapshot values when the snapshot is created, thereby avoiding overflow. As a side effect, this will make the max value to behave better. Before max value would continue to raise and then get a sudden drop every 30 minutes when rescale happend. Now, max value will appear to decay on a minute basis, whether value is peaking just before or after rescale.&lt;/p&gt;

&lt;p&gt;The patch includes a missing part from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11752&quot; title=&quot;histograms/metrics in 2.2 do not appear recency biased&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11752&quot;&gt;&lt;del&gt;CASSANDRA-11752&lt;/del&gt;&lt;/a&gt; that never were merged into 2.2 branch. It seem to apply clean on 3.0.x as well.&lt;/p&gt;</comment>
                            <comment id="15658190" author="alprema" created="Fri, 11 Nov 2016 21:11:53 +0000"  >&lt;p&gt;I updated a node of a test cluster with your patch and it works, no more negative values, thanks &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;The code in the patch was clear, but I&apos;m a bit confused regarding your explanation. You mention that the overflow happens because of the addition of all the buckets during the mean computation, only to be fixed by the rescaling (that happens every 30 minutes). But then why do I only observe negative values every 30 minutes ? Shouldn&apos;t I observe negative values all the time, and positive ones just after the rescale ?&lt;/p&gt;</comment>
                            <comment id="15663718" author="eperott" created="Mon, 14 Nov 2016 11:46:31 +0000"  >&lt;p&gt;Overflow don&apos;t happen at the start of the 30 minute cycle because 1) it takes a while to build up high enough values in the individual buckets and 2) values collected at the end of the 30-minute cycle will have much higher forward-decay weight which cause bucket values to build up much faster.&lt;/p&gt;

&lt;p&gt;In your case you are seeing this at the last 3 minutes of the 30-minute cycle, because only then will the forward-decay weight be high enough.&lt;/p&gt;</comment>
                            <comment id="15769926" author="alekiv" created="Thu, 22 Dec 2016 12:20:56 +0000"  >&lt;p&gt;Same problem with mean Read Latency on v3.0.9&lt;/p&gt;</comment>
                            <comment id="15828159" author="eperott" created="Wed, 18 Jan 2017 14:24:59 +0000"  >&lt;p&gt;Rebased patch and cleaned out left-overs from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11752&quot; title=&quot;histograms/metrics in 2.2 do not appear recency biased&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11752&quot;&gt;&lt;del&gt;CASSANDRA-11752&lt;/del&gt;&lt;/a&gt; as they are now merged into 2.2 branch.&lt;/p&gt;

&lt;p&gt;The patch applies cleanly on 2.2 up to trunk.&lt;/p&gt;</comment>
                            <comment id="15862229" author="jjirsa" created="Sat, 11 Feb 2017 05:30:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cnlwsu&quot; class=&quot;user-hover&quot; rel=&quot;cnlwsu&quot;&gt;cnlwsu&lt;/a&gt; still on your radar?&lt;/p&gt;</comment>
                            <comment id="15862627" author="cnlwsu" created="Sun, 12 Feb 2017 02:58:40 +0000"  >&lt;p&gt;I actually missed that I was reviewer, I&apos;m testing now.&lt;/p&gt;</comment>
                            <comment id="15862660" author="cnlwsu" created="Sun, 12 Feb 2017 05:45:31 +0000"  >&lt;p&gt;+1 from me, could reproduce the negative means before and couldn&apos;t afterwards.&lt;/p&gt;</comment>
                            <comment id="15862686" author="jjirsa" created="Sun, 12 Feb 2017 07:33:37 +0000"  >&lt;p&gt;Thanks to all three of you for your help on this &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=eperott&quot; class=&quot;user-hover&quot; rel=&quot;eperott&quot;&gt;eperott&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cnlwsu&quot; class=&quot;user-hover&quot; rel=&quot;cnlwsu&quot;&gt;cnlwsu&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=alprema&quot; class=&quot;user-hover&quot; rel=&quot;alprema&quot;&gt;alprema&lt;/a&gt; ! Committed to 2.2 as &lt;tt&gt;7e05f393f39c90ec0447b1cc893ff46901ae3071&lt;/tt&gt; and merged up to 3.0, 3.11, and trunk. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12848066" name="12876-2.2-v2.txt" size="4160" author="eperott" created="Wed, 18 Jan 2017 14:24:59 +0000"/>
                            <attachment id="12838428" name="12876-2.2.txt" size="5251" author="eperott" created="Thu, 10 Nov 2016 20:51:44 +0000"/>
                            <attachment id="12836881" name="negative_mean.png" size="58486" author="alprema" created="Thu, 3 Nov 2016 16:25:24 +0000"/>
                            <attachment id="12838191" name="negative_mean_details.PNG" size="29558" author="alprema" created="Wed, 9 Nov 2016 16:36:33 +0000"/>
                            <attachment id="12836882" name="negative_mean_periodicity.PNG" size="36659" author="alprema" created="Thu, 3 Nov 2016 16:25:24 +0000"/>
                            <attachment id="12844389" name="negative_mean_read_latency.png" size="33223" author="alekiv" created="Thu, 22 Dec 2016 12:21:39 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[eperott]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 40 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i35tav:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12337440">2.2.8</customfieldvalue>
    <customfieldvalue id="12337349">3.0.9</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>cnlwsu</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[cnlwsu]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>