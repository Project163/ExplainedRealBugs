<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:10:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-13873] Ref bug in Scrub</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-13873</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I&apos;m hitting a Ref bug when many scrubs run against a node.  This doesn&apos;t happen on 3.0.X.  I&apos;m not sure if/if not this happens with compactions too but I suspect it does.&lt;/p&gt;

&lt;p&gt;I&apos;m not seeing any Ref leaks or double frees.&lt;/p&gt;

&lt;p&gt;To Reproduce:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;./tools/bin/cassandra-stress write n=10m -rate threads=100&lt;br/&gt;
./bin/nodetool scrub&lt;br/&gt;
#Ctrl-C&lt;br/&gt;
./bin/nodetool scrub&lt;br/&gt;
#Ctrl-C&lt;br/&gt;
./bin/nodetool scrub&lt;br/&gt;
#Ctrl-C&lt;br/&gt;
./bin/nodetool scrub&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Eventually in the logs you get:&lt;br/&gt;
WARN  &lt;span class=&quot;error&quot;&gt;&amp;#91;RMI TCP Connection(4)-127.0.0.1&amp;#93;&lt;/span&gt; 2017-09-14 15:51:26,722 NoSpamLogger.java:97 - Spinning trying to capture readers &lt;span class=&quot;error&quot;&gt;&amp;#91;BigTableReader(path=&amp;#39;/home/jake/workspace/cassandra2/data/data/keyspace1/standard1-2eb5c780998311e79e09311efffdcd17/mc-5-big-Data.db&amp;#39;), BigTableReader(path=&amp;#39;/home/jake/workspace/cassandra2/data/data/keyspace1/standard1-2eb5c780998311e79e09311efffdcd17/mc-32-big-Data.db&amp;#39;), BigTableReader(path=&amp;#39;/home/jake/workspace/cassandra2/data/data/keyspace1/standard1-2eb5c780998311e79e09311efffdcd17/mc-31-big-Data.db&amp;#39;), BigTableReader(path=&amp;#39;/home/jake/workspace/cassandra2/data/data/keyspace1/standard1-2eb5c780998311e79e09311efffdcd17/mc-29-big-Data.db&amp;#39;), BigTableReader(path=&amp;#39;/home/jake/workspace/cassandra2/data/data/keyspace1/standard1-2eb5c780998311e79e09311efffdcd17/mc-27-big-Data.db&amp;#39;), BigTableReader(path=&amp;#39;/home/jake/workspace/cassandra2/data/data/keyspace1/standard1-2eb5c780998311e79e09311efffdcd17/mc-26-big-Data.db&amp;#39;), BigTableReader(path=&amp;#39;/home/jake/workspace/cassandra2/data/data/keyspace1/standard1-2eb5c780998311e79e09311efffdcd17/mc-20-big-Data.db&amp;#39;)&amp;#93;&lt;/span&gt;,&lt;br/&gt;
&lt;b&gt;released: &lt;span class=&quot;error&quot;&gt;&amp;#91;BigTableReader(path=&amp;#39;/home/jake/workspace/cassandra2/data/data/keyspace1/standard1-2eb5c780998311e79e09311efffdcd17/mc-5-big-Data.db&amp;#39;)&amp;#93;&lt;/span&gt;,&lt;/b&gt; &lt;/p&gt;

&lt;p&gt;This released table has a selfRef of 0 but is in the Tracker&lt;/p&gt;</description>
                <environment></environment>
        <key id="13102367">CASSANDRA-13873</key>
            <summary>Ref bug in Scrub</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="marcuse">Marcus Eriksson</assignee>
                                    <reporter username="tjake">T Jake Luciani</reporter>
                        <labels>
                    </labels>
                <created>Thu, 14 Sep 2017 19:59:27 +0000</created>
                <updated>Fri, 15 May 2020 08:00:19 +0000</updated>
                            <resolved>Mon, 11 Dec 2017 08:08:00 +0000</resolved>
                                        <fixVersion>2.2.12</fixVersion>
                    <fixVersion>3.0.16</fixVersion>
                    <fixVersion>3.11.2</fixVersion>
                    <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Legacy/Tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>11</watches>
                                                                                                                <comments>
                            <comment id="16166914" author="tjake" created="Thu, 14 Sep 2017 20:10:20 +0000"  >&lt;p&gt;I should probably mention this happens when we cancel compactions.  In 3.0 they would just wait till previous runs finished, now we cancel them.&lt;/p&gt;</comment>
                            <comment id="16210502" author="jkni" created="Thu, 19 Oct 2017 02:46:54 +0000"  >&lt;p&gt;It looks like this situation can occur when referencing canonical sstables. As far as I can tell, the issue reproduces only when we have an sstable in a lifecycle transaction with no referencers other than its selfref. If the lifecycle transaction updates this sstable, we&apos;ll put a new instance of the sstable reader in the tracker. This causes no problems when getting live sstables, but the canonical sstables can also include sstable readers from the compacting set. In this case, the sstable reader that got updated will still be in the compacting set, but we won&apos;t be able to reference it when we try to select and reference canonical sstables, since its instance tidier has run when its last ref was released in the lifecycle transaction. Note that the global tidier doesn&apos;t run, since the updated sstable reader is still referenced. With the reproduction provided above in the multiple scrub, the scrubs will eventually proceed once the lifecycle transaction finishes, since it will put an updated sstablereader in the tracker. If there is a situation where a lifecyce transaction needed to select canonical sstables to proceed, this could cause a deadlock.&lt;/p&gt;

&lt;p&gt;I pushed a branch at &lt;a href=&quot;https://github.com/jkni/cassandra/commit/ba70f70d97f648037e742a16bfdf1c8002d2be9c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;c13873-2.2&lt;/a&gt; that implements the simplest fix I can think of. The patch references the original sstables involved in a lifecycle transaction when we create the transaction, releasing these references whenever we do postCleanup or cancel an sstable reader from a transaction. I merged this forward and tests came back clean on all active branches. I&apos;m not sure if there is some existing mechanism that should cover this case - maybe &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=krummas&quot; class=&quot;user-hover&quot; rel=&quot;krummas&quot;&gt;krummas&lt;/a&gt; knows from reviewing &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9699&quot; title=&quot;Make choice of sstable reader types explicit&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9699&quot;&gt;&lt;del&gt;CASSANDRA-9699&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="16210874" author="krummas" created="Thu, 19 Oct 2017 11:03:44 +0000"  >&lt;blockquote&gt;&lt;p&gt;the scrubs will eventually proceed once the lifecycle transaction finishes,&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;but shouldn&apos;t cancelling the scrub-compaction also finish the txn?&lt;/p&gt;

&lt;p&gt;I&apos;ll take review unless you had someone else lined up - &lt;del&gt;is this still &quot;critical&quot; after your analysis &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jkni&quot; class=&quot;user-hover&quot; rel=&quot;jkni&quot;&gt;jkni&lt;/a&gt;&lt;/del&gt;? Edit: yup, looks like it&lt;/p&gt;</comment>
                            <comment id="16211081" author="jkni" created="Thu, 19 Oct 2017 14:05:06 +0000"  >&lt;p&gt;You&apos;re correct that cancelling will also finish the txn and allow operations to select and reference canonical sstables. In the specific repro that Jake provided, which is the case of multiple scrubs over the same cfs (an admittedly somewhat artificial case), we&apos;ll try to select and reference canonical sstables in the snapshot before cancelling the original scrub compaction, so the new scrubs will hang until the original scrub finishes.&lt;/p&gt;

&lt;p&gt;That&apos;d be great if you could review. I&apos;m admittedly very unfamiliar with this part of the code, so I expect my initial patch is a rough sketch of the eventual solution.&lt;/p&gt;

&lt;p&gt;As far as criticality goes, I could go either way. I know of no situations that this causes data loss or permanent deadlocks at this time, but it can potentially cause operations referencing canonical sstables to hang for long periods of time.&lt;/p&gt;</comment>
                            <comment id="16211130" author="krummas" created="Thu, 19 Oct 2017 14:32:59 +0000"  >&lt;p&gt;looks like this is a problem way back in 2.1 as well and my fix in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10829&quot; title=&quot;cleanup + repair generates a lot of logs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10829&quot;&gt;&lt;del&gt;CASSANDRA-10829&lt;/del&gt;&lt;/a&gt; only made the window where this can happen smaller&lt;/p&gt;</comment>
                            <comment id="16212604" author="krummas" created="Fri, 20 Oct 2017 12:47:58 +0000"  >&lt;p&gt;correction, there is only a tiny race just as we finish up compactions in 2.1 - not worth fixing at this point&lt;/p&gt;</comment>
                            <comment id="16212759" author="krummas" created="Fri, 20 Oct 2017 15:03:19 +0000"  >&lt;p&gt;The problem seems to be that we don&apos;t grab a reference before starting the compaction everywhere - we do it in &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/db/compaction/CompactionTask.java#L177&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CompactionTask&lt;/a&gt;, but not during &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/db/compaction/CompactionManager.java#L1095-L1098&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cleanup&lt;/a&gt; for example.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jkni&quot; class=&quot;user-hover&quot; rel=&quot;jkni&quot;&gt;jkni&lt;/a&gt; I think we should do your fix (and also remove the external ref-grabbing in CompactionTask), but maybe only in trunk? It feels a tiny bit safer to not touch &lt;tt&gt;LifecycleTransaction&lt;/tt&gt;/&lt;tt&gt;CompactionTask&lt;/tt&gt; in older versions and instead take the ref outside where we need it, but I&apos;m not entirely convinced, wdyt?&lt;/p&gt;</comment>
                            <comment id="16212774" author="jkni" created="Fri, 20 Oct 2017 15:17:01 +0000"  >&lt;p&gt;+1 - I&apos;d like to introduce as few changes as possible to older versions here. That combination sounds good to me. Do you want to prepare the patch for older versions or would you like me to?&lt;/p&gt;</comment>
                            <comment id="16216804" author="krummas" created="Tue, 24 Oct 2017 12:26:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/krummas/cassandra/commits/marcuse/13873&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/krummas/cassandra/commits/marcuse/13873&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/krummas/cassandra/commits/marcuse/13873-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/krummas/cassandra/commits/marcuse/13873-3.0&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/krummas/cassandra/commits/marcuse/13873-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/krummas/cassandra/commits/marcuse/13873-3.11&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/387/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/387/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/388/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/388/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/389/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/389/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://circleci.com/gh/krummas/cassandra/tree/marcuse%2F13873&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://circleci.com/gh/krummas/cassandra/tree/marcuse%2F13873&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://circleci.com/gh/krummas/cassandra/tree/marcuse%2F13873-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://circleci.com/gh/krummas/cassandra/tree/marcuse%2F13873-3.0&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://circleci.com/gh/krummas/cassandra/tree/marcuse%2F13873-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://circleci.com/gh/krummas/cassandra/tree/marcuse%2F13873-3.11&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16270733" author="krummas" created="Wed, 29 Nov 2017 13:39:39 +0000"  >&lt;p&gt;ping &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jkni&quot; class=&quot;user-hover&quot; rel=&quot;jkni&quot;&gt;jkni&lt;/a&gt; - should we port the trivial patch to trunk as well and get this in? We could improve it in another ticket I guess&lt;/p&gt;</comment>
                            <comment id="16271931" author="jkni" created="Thu, 30 Nov 2017 00:56:13 +0000"  >&lt;p&gt;Sorry for the latency here - my fault. The patch looks good to me. I considered a few other cases where a similar problem might exist. It seems to me the same issue could exist in in the Splitter/Upgrader, but since they&apos;re offline, I don&apos;t know what future changes would require another operation to reference canonical sstables in parallel. I also don&apos;t see anything in anticompaction grabbing a ref; am I missing something there?&lt;/p&gt;

&lt;p&gt;The patches look good for existing cases. Unfortunately, I let the dtests age out before taking a closer look, but I can rerun them after you look at the question above. I&apos;m +1 to merging the relatively trivial patches through to trunk and opening a ticket to improve it later. As you&apos;ve seen, I don&apos;t have a huge amount of bandwidth for this right now, so I&apos;d rather not delay a definite improvement with only the promise of a better one. Thanks for the patience.&lt;/p&gt;</comment>
                            <comment id="16272360" author="krummas" created="Thu, 30 Nov 2017 08:40:53 +0000"  >&lt;blockquote&gt;&lt;p&gt;Splitter/Upgrader, but since they&apos;re offline&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;yeah, don&apos;t think we need it here, we don&apos;t open early when doing offline operations and we should have no concurrent operations referencing sstables&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I also don&apos;t see anything in anticompaction grabbing a ref;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;looks like we do it &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-2.2/src/java/org/apache/cassandra/service/ActiveRepairService.java#L565-L584&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ll prepare the patches and start the dtests&lt;/p&gt;</comment>
                            <comment id="16272397" author="krummas" created="Thu, 30 Nov 2017 09:00:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/krummas/cassandra/commits/marcuse/13873&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/krummas/cassandra/commits/marcuse/13873&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/krummas/cassandra/commits/marcuse/13873-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/krummas/cassandra/commits/marcuse/13873-3.0&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/krummas/cassandra/commits/marcuse/13873-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/krummas/cassandra/commits/marcuse/13873-3.11&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/krummas/cassandra/commits/marcuse/13873-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/krummas/cassandra/commits/marcuse/13873-trunk&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/444/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/444/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/445/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/445/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/446/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/446/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/447/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/447/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://circleci.com/gh/krummas/cassandra/tree/marcuse%2F13873&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://circleci.com/gh/krummas/cassandra/tree/marcuse%2F13873&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://circleci.com/gh/krummas/cassandra/tree/marcuse%2F13873-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://circleci.com/gh/krummas/cassandra/tree/marcuse%2F13873-3.0&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://circleci.com/gh/krummas/cassandra/tree/marcuse%2F13873-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://circleci.com/gh/krummas/cassandra/tree/marcuse%2F13873-3.11&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://circleci.com/gh/krummas/cassandra/tree/marcuse%2F13873-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://circleci.com/gh/krummas/cassandra/tree/marcuse%2F13873-trunk&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16273882" author="jkni" created="Fri, 1 Dec 2017 03:38:37 +0000"  >&lt;p&gt;Thanks for the patches and CI. Both your remarks look correct to me; frankly, I have no idea how I missed that in anticompaction.&lt;/p&gt;

&lt;p&gt;Test results look good for the most part. There&apos;s a few flaky unit tests on 3.0/3.11 that appear to have failed the same way before the patch, pass for me locally, and appear to be at the limits of CircleCI&apos;s timeouts/resources. The 2.2 dtests timed out, so it seems worthwhile to trigger those again just in case. The only unusual failures on 3.0 dtests are a bunch of tests where Jolokia failed to attach for JMX. I&apos;m not sure if this is a known environmental problem on ASF dtests, but I was unable to reproduce this elsewhere.&lt;/p&gt;

&lt;p&gt;Overall, +1 to the patch for me, and this looks good to merge if none of the test issues I raised above worry you.&lt;/p&gt;</comment>
                            <comment id="16283714" author="krummas" created="Fri, 8 Dec 2017 15:22:26 +0000"  >&lt;p&gt;finally got the 2.2 tests run properly and the failures look unrelated: &lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/456/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/456/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ll get this committed (on monday..)&lt;/p&gt;</comment>
                            <comment id="16284384" author="jkni" created="Fri, 8 Dec 2017 23:08:50 +0000"  >&lt;p&gt;Great. Thanks!&lt;/p&gt;</comment>
                            <comment id="16285624" author="krummas" created="Mon, 11 Dec 2017 08:08:00 +0000"  >&lt;p&gt;and committed as &lt;tt&gt;3cd2c3c4ea4286562b2cb8443d6173ee251e6212&lt;/tt&gt;, thanks&lt;/p&gt;</comment>
                            <comment id="16322221" author="tsteinmaurer" created="Thu, 11 Jan 2018 13:47:02 +0000"  >&lt;p&gt;Any chance to get this back-ported also to 2.1.x? We are having a lots of 2.1 nodes out there in production with no immediate plan to upgrade, but e.g. we can&apos;t have a combination of &lt;tt&gt;nodetool cleanup&lt;/tt&gt; (e.g. after extending the cluster with additional nodes) and an hourly cron job taking snapshots. See linked issue &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11155&quot; title=&quot;Scrub/Cleanup block snapshots&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11155&quot;&gt;&lt;del&gt;CASSANDRA-11155&lt;/del&gt;&lt;/a&gt;. Thanks.&lt;/p&gt;</comment>
                            <comment id="16352058" author="kurtg" created="Mon, 5 Feb 2018 05:41:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tsteinmaurer&quot; class=&quot;user-hover&quot; rel=&quot;tsteinmaurer&quot;&gt;tsteinmaurer&lt;/a&gt; I couldn&apos;t reproduce the issue on my end. I suspect you need at least a few large SSTables to trigger the issue. Can you try building from &lt;a href=&quot;https://github.com/kgreav/cassandra/tree/13873-2.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this branch&lt;/a&gt;&#160;which is just latest 2.1 with the simple backport on top and seeing if it fixes the issue?&lt;/p&gt;</comment>
                            <comment id="16352133" author="tsteinmaurer" created="Mon, 5 Feb 2018 08:20:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=KurtG&quot; class=&quot;user-hover&quot; rel=&quot;KurtG&quot;&gt;KurtG&lt;/a&gt;, thanks for the follow-up. Unfortunately, I don&apos;t have a larger environment available to give your back-port a try at the moment, cause we have work-arounded the issue for our scaled out clusters beyond our replication factor by disabling and then re-enabling the hourly cron job taking snapshots.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12938412">CASSANDRA-11155</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 41 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3k35z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12337348">3.10</customfieldvalue>
    <customfieldvalue id="12339157">3.11.0</customfieldvalue>
    <customfieldvalue id="12336842">4.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jkni</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jkni]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>