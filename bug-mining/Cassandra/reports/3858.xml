<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:58:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-10434] Problem upgrading to 3.0 with UDA</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-10434</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Copy-pasting from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nutbunnies&quot; class=&quot;user-hover&quot; rel=&quot;nutbunnies&quot;&gt;nutbunnies&lt;/a&gt; comment on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9756&quot; title=&quot;Cleanup UDA code after 6717&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9756&quot;&gt;CASSANDRA-9756&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;upgrading from 2.2 to 3.0 with a UDA defined will throw the exception below and fail to start when upgraded to 3.0.&lt;br/&gt;
Used:&lt;br/&gt;
2.2: &lt;tt&gt;ae9b7e05222b2a25eda5618cf9eb17103e4d6d8b&lt;/tt&gt;&lt;br/&gt;
3.0: &lt;tt&gt;5c2912d1ce95aacdacb59ccc840b12cd9aa0c8f8&lt;/tt&gt;&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.cassandra.exceptions.UnrecognizedEntityException: Undefined name function_name in where clause (&apos;function_name = ?&apos;)
        at org.apache.cassandra.cql3.Relation.toColumnDefinition(Relation.java:259) ~[main/:na]
        at org.apache.cassandra.cql3.SingleColumnRelation.newEQRestriction(SingleColumnRelation.java:160) ~[main/:na]
        at org.apache.cassandra.cql3.Relation.toRestriction(Relation.java:137) ~[main/:na]
        at org.apache.cassandra.cql3.restrictions.StatementRestrictions.&amp;lt;init&amp;gt;(StatementRestrictions.java:151) ~[main/:na]
        at org.apache.cassandra.cql3.statements.SelectStatement$RawStatement.prepareRestrictions(SelectStatement.java:817) ~[main/:na]
        at org.apache.cassandra.cql3.statements.SelectStatement$RawStatement.prepare(SelectStatement.java:764) ~[main/:na]
        at org.apache.cassandra.cql3.statements.SelectStatement$RawStatement.prepare(SelectStatement.java:752) ~[main/:na]
        at org.apache.cassandra.cql3.QueryProcessor.getStatement(QueryProcessor.java:504) ~[main/:na]
        at org.apache.cassandra.cql3.QueryProcessor.parseStatement(QueryProcessor.java:241) ~[main/:na]
        at org.apache.cassandra.cql3.QueryProcessor.executeOnceInternal(QueryProcessor.java:336) ~[main/:na]
        at org.apache.cassandra.schema.LegacySchemaMigrator.query(LegacySchemaMigrator.java:882) ~[main/:na]
        at org.apache.cassandra.schema.LegacySchemaMigrator.readAggregateMetadata(LegacySchemaMigrator.java:849) ~[main/:na]
        at org.apache.cassandra.schema.LegacySchemaMigrator.readAggregate(LegacySchemaMigrator.java:830) ~[main/:na]
        at org.apache.cassandra.schema.LegacySchemaMigrator.lambda$readAggregates$216(LegacySchemaMigrator.java:823) ~[main/:na]
        at java.lang.Iterable.forEach(Iterable.java:75) ~[na:1.8.0_60]
        at org.apache.cassandra.schema.LegacySchemaMigrator.readAggregates(LegacySchemaMigrator.java:823) ~[main/:na]
        at org.apache.cassandra.schema.LegacySchemaMigrator.readKeyspace(LegacySchemaMigrator.java:166) ~[main/:na]
        at org.apache.cassandra.schema.LegacySchemaMigrator.lambda$readSchema$207(LegacySchemaMigrator.java:154) ~[main/:na]
        at java.util.ArrayList.forEach(ArrayList.java:1249) ~[na:1.8.0_60]
        at org.apache.cassandra.schema.LegacySchemaMigrator.readSchema(LegacySchemaMigrator.java:154) ~[main/:na]
        at org.apache.cassandra.schema.LegacySchemaMigrator.migrate(LegacySchemaMigrator.java:77) ~[main/:na]
        at org.apache.cassandra.service.CassandraDaemon.setup(CassandraDaemon.java:223) [main/:na]
        at org.apache.cassandra.service.CassandraDaemon.activate(CassandraDaemon.java:542) [main/:na]
        at org.apache.cassandra.service.CassandraDaemon.main(CassandraDaemon.java:668) [main/:na]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Can be reproduced with:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ccm stop
ccm remove uda_upgrade
ccm create -n 1 -v git:cassandra-2.2 uda_upgrade
ccm updateconf &apos;enable_user_defined_functions: true&apos;
ccm start

cat &amp;lt;&amp;lt; EOF | ccm node1 cqlsh
create keyspace ks WITH replication = {&apos;class&apos;: &apos;SimpleStrategy&apos;, &apos;replication_factor&apos;: 1};
USE ks;
CREATE FUNCTION func_1(current int, candidate int)
            CALLED ON NULL INPUT
            RETURNS int LANGUAGE java AS
            &apos;if (current == null) return candidate; else return Math.max(current, candidate);&apos;;
CREATE AGGREGATE agg_1(int)
            SFUNC func_1
            STYPE int
            INITCOND null;
EOF

sleep 10

echo &quot;Draining all nodes&quot;
ccm node1 nodetool drain
ccm stop

echo &quot;Upgrading to git:cassandra-3.0&quot;
ccm setdir -v git:cassandra-3.0
ccm start
echo &quot;Sleeping for version migrations&quot;
sleep 15
ccm checklogerror

ccm stop
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;</description>
                <environment></environment>
        <key id="12902075">CASSANDRA-10434</key>
            <summary>Problem upgrading to 3.0 with UDA</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="snazy">Robert Stupp</assignee>
                                    <reporter username="slebresne">Sylvain Lebresne</reporter>
                        <labels>
                    </labels>
                <created>Fri, 2 Oct 2015 08:48:55 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:54 +0000</updated>
                            <resolved>Thu, 8 Oct 2015 19:22:05 +0000</resolved>
                                        <fixVersion>3.0.0 rc2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14941069" author="snazy" created="Fri, 2 Oct 2015 12:21:48 +0000"  >&lt;p&gt;Got it working. Currently building a utest for it, which is more complicated as the production code.&lt;/p&gt;</comment>
                            <comment id="14947635" author="nutbunnies" created="Wed, 7 Oct 2015 21:28:16 +0000"  >&lt;p&gt;Confirmed patch fixes issue with exception post upgrade and UDA performs as expected post upgrade.  Once this has been merged I&apos;ll update the upgrading dtest to include UDA&apos;s in setup and verification.&lt;/p&gt;

&lt;p&gt;Ran with:&lt;br/&gt;
apache/cassandra-2.2 &lt;tt&gt;be89dae3ecfd98b2170732c45d7f95807d5c19af&lt;/tt&gt;&lt;br/&gt;
snazy/10434-uda-migration-3.0 &lt;tt&gt;b83a088f252e906faa9924def8e24997e072c109&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="14949102" author="iamaleksey" created="Thu, 8 Oct 2015 18:28:37 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14949208" author="snazy" created="Thu, 8 Oct 2015 19:22:05 +0000"  >&lt;p&gt;Thanks!&lt;br/&gt;
Committed as e1eed527f82637518e85d0569f59512b257ab70d&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[snazy]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 6 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2mj5r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aleksey</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>