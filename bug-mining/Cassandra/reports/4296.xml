<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:03:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-11763] Failure to read non-shallow pre-3.0 sstable index entries</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-11763</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;example failure in:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Parameterized/job/upgrade_tests-all-custom_branch_runs/12/testReport/upgrade_tests.upgrade_through_versions_test/ProtoV3Upgrade_AllVersions_RandomPartitioner_Skips_3_0_x_EndsAt_Trunk_HEAD/rolling_upgrade_test_2/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Parameterized/job/upgrade_tests-all-custom_branch_runs/12/testReport/upgrade_tests.upgrade_through_versions_test/ProtoV3Upgrade_AllVersions_RandomPartitioner_Skips_3_0_x_EndsAt_Trunk_HEAD/rolling_upgrade_test_2/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Logs are attached, relevant stack trace is here.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [main] 2016-05-11 16:26:06,555 CassandraDaemon.java:727 - Exception encountered during startup
java.lang.RuntimeException: java.util.concurrent.ExecutionException: java.lang.NegativeArraySizeException
	at org.apache.cassandra.hints.LegacyHintsMigrator.forceCompaction(LegacyHintsMigrator.java:119) ~[main/:na]
	at org.apache.cassandra.hints.LegacyHintsMigrator.compactLegacyHints(LegacyHintsMigrator.java:108) ~[main/:na]
	at org.apache.cassandra.hints.LegacyHintsMigrator.migrate(LegacyHintsMigrator.java:92) ~[main/:na]
	at org.apache.cassandra.service.CassandraDaemon.setup(CassandraDaemon.java:321) [main/:na]
	at org.apache.cassandra.service.CassandraDaemon.activate(CassandraDaemon.java:581) [main/:na]
	at org.apache.cassandra.service.CassandraDaemon.main(CassandraDaemon.java:710) [main/:na]
Caused by: java.util.concurrent.ExecutionException: java.lang.NegativeArraySizeException
	at java.util.concurrent.FutureTask.report(FutureTask.java:122) ~[na:1.8.0_51]
	at java.util.concurrent.FutureTask.get(FutureTask.java:192) ~[na:1.8.0_51]
	at org.apache.cassandra.hints.LegacyHintsMigrator.forceCompaction(LegacyHintsMigrator.java:115) ~[main/:na]
	... 5 common frames omitted
Caused by: java.lang.NegativeArraySizeException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
	at org.apache.cassandra.db.RowIndexEntry$LegacyShallowIndexedEntry.deserialize(RowIndexEntry.java:519) ~[main/:na]
	at org.apache.cassandra.db.RowIndexEntry$Serializer.deserialize(RowIndexEntry.java:321) ~[main/:na]
	at org.apache.cassandra.io.sstable.format.big.BigTableScanner$KeyScanningIterator.computeNext(BigTableScanner.java:310) ~[main/:na]
	at org.apache.cassandra.io.sstable.format.big.BigTableScanner$KeyScanningIterator.computeNext(BigTableScanner.java:265) ~[main/:na]
	at org.apache.cassandra.utils.AbstractIterator.hasNext(AbstractIterator.java:47) ~[main/:na]
	at org.apache.cassandra.io.sstable.format.big.BigTableScanner.hasNext(BigTableScanner.java:245) ~[main/:na]
	at org.apache.cassandra.utils.MergeIterator$Candidate.advance(MergeIterator.java:374) ~[main/:na]
	at org.apache.cassandra.utils.MergeIterator$ManyToOne.advance(MergeIterator.java:186) ~[main/:na]
	at org.apache.cassandra.utils.MergeIterator$ManyToOne.computeNext(MergeIterator.java:155) ~[main/:na]
	at org.apache.cassandra.utils.AbstractIterator.hasNext(AbstractIterator.java:47) ~[main/:na]
	at org.apache.cassandra.db.partitions.UnfilteredPartitionIterators$2.hasNext(UnfilteredPartitionIterators.java:150) ~[main/:na]
	at org.apache.cassandra.db.transform.BasePartitions.hasNext(BasePartitions.java:72) ~[main/:na]
	at org.apache.cassandra.db.compaction.CompactionIterator.hasNext(CompactionIterator.java:226) ~[main/:na]
	at org.apache.cassandra.db.compaction.CompactionTask.runMayThrow(CompactionTask.java:182) ~[main/:na]
	at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:28) ~[main/:na]
	at org.apache.cassandra.db.compaction.CompactionTask.executeInternal(CompactionTask.java:82) ~[main/:na]
	at org.apache.cassandra.db.compaction.AbstractCompactionTask.execute(AbstractCompactionTask.java:60) ~[main/:na]
	at org.apache.cassandra.db.compaction.CompactionManager$10.runMayThrow(CompactionManager.java:805) ~[main/:na]
	at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:28) ~[main/:na]
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) ~[na:1.8.0_51]
	at java.util.concurrent.FutureTask.run(FutureTask.java:266) ~[na:1.8.0_51]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) ~[na:1.8.0_51]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) ~[na:1.8.0_51]
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) ~[na:1.8.0_51]
ERROR [CompactionExecutor:1] 2016-05-11 16:26:06,559 CassandraDaemon.java:213 - Exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[CompactionExecutor:1,1,main]
java.lang.NegativeArraySizeException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
	at org.apache.cassandra.db.RowIndexEntry$LegacyShallowIndexedEntry.deserialize(RowIndexEntry.java:519) ~[main/:na]
	at org.apache.cassandra.db.RowIndexEntry$Serializer.deserialize(RowIndexEntry.java:321) ~[main/:na]
	at org.apache.cassandra.io.sstable.format.big.BigTableScanner$KeyScanningIterator.computeNext(BigTableScanner.java:310) ~[main/:na]
	at org.apache.cassandra.io.sstable.format.big.BigTableScanner$KeyScanningIterator.computeNext(BigTableScanner.java:265) ~[main/:na]
	at org.apache.cassandra.utils.AbstractIterator.hasNext(AbstractIterator.java:47) ~[main/:na]
	at org.apache.cassandra.io.sstable.format.big.BigTableScanner.hasNext(BigTableScanner.java:245) ~[main/:na]
	at org.apache.cassandra.utils.MergeIterator$Candidate.advance(MergeIterator.java:374) ~[main/:na]
	at org.apache.cassandra.utils.MergeIterator$ManyToOne.advance(MergeIterator.java:186) ~[main/:na]
	at org.apache.cassandra.utils.MergeIterator$ManyToOne.computeNext(MergeIterator.java:155) ~[main/:na]
	at org.apache.cassandra.utils.AbstractIterator.hasNext(AbstractIterator.java:47) ~[main/:na]
	at org.apache.cassandra.db.partitions.UnfilteredPartitionIterators$2.hasNext(UnfilteredPartitionIterators.java:150) ~[main/:na]
	at org.apache.cassandra.db.transform.BasePartitions.hasNext(BasePartitions.java:72) ~[main/:na]
	at org.apache.cassandra.db.compaction.CompactionIterator.hasNext(CompactionIterator.java:226) ~[main/:na]
	at org.apache.cassandra.db.compaction.CompactionTask.runMayThrow(CompactionTask.java:182) ~[main/:na]
	at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:28) ~[main/:na]
	at org.apache.cassandra.db.compaction.CompactionTask.executeInternal(CompactionTask.java:82) ~[main/:na]
	at org.apache.cassandra.db.compaction.AbstractCompactionTask.execute(AbstractCompactionTask.java:60) ~[main/:na]
	at org.apache.cassandra.db.compaction.CompactionManager$10.runMayThrow(CompactionManager.java:805) ~[main/:na]
	at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:28) ~[main/:na]
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) ~[na:1.8.0_51]
	at java.util.concurrent.FutureTask.run(FutureTask.java:266) ~[na:1.8.0_51]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) ~[na:1.8.0_51]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [na:1.8.0_51]
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [na:1.8.0_51]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12968611">CASSANDRA-11763</key>
            <summary>Failure to read non-shallow pre-3.0 sstable index entries</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="snazy">Robert Stupp</assignee>
                                    <reporter username="philipthompson">Philip Thompson</reporter>
                        <labels>
                            <label>dtest</label>
                    </labels>
                <created>Thu, 12 May 2016 14:51:38 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:33 +0000</updated>
                            <resolved>Mon, 30 May 2016 15:48:59 +0000</resolved>
                                        <fixVersion>3.6</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15281586" author="mambocab" created="Thu, 12 May 2016 15:01:10 +0000"  >&lt;p&gt;Seeing the same failure on &lt;tt&gt;TestUpgrade_current_2_2_x_To_next_3_x/rolling_upgrade_with_internode_ssl_test&lt;/tt&gt;:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Parameterized/job/upgrade_tests-all-custom_branch_runs/12/testReport/upgrade_tests.upgrade_through_versions_test/TestUpgrade_current_2_2_x_To_next_3_x/rolling_upgrade_with_internode_ssl_test/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Parameterized/job/upgrade_tests-all-custom_branch_runs/12/testReport/upgrade_tests.upgrade_through_versions_test/TestUpgrade_current_2_2_x_To_next_3_x/rolling_upgrade_with_internode_ssl_test/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/view/Parameterized/job/upgrade_tests-all-custom_branch_runs/12/testReport/upgrade_tests.upgrade_through_versions_test/TestUpgrade_current_2_2_x_To_next_3_x/rolling_upgrade_with_internode_ssl_test_2/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Parameterized/job/upgrade_tests-all-custom_branch_runs/12/testReport/upgrade_tests.upgrade_through_versions_test/TestUpgrade_current_2_2_x_To_next_3_x/rolling_upgrade_with_internode_ssl_test_2/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15297169" author="mambocab" created="Mon, 23 May 2016 21:54:14 +0000"  >&lt;p&gt;Seeing some corrupted SSTables as well: &lt;a href=&quot;https://gist.github.com/mambocab/6c6217e4b3f79d64bbe81cb2cf986abe&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/mambocab/6c6217e4b3f79d64bbe81cb2cf986abe&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15297302" author="mambocab" created="Mon, 23 May 2016 23:02:41 +0000"  >&lt;p&gt;For testing this for the 3.6 release, check out the &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/tree/upgrade_test_3.6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;upgrade_test_3.6 branch of the dtest repo&lt;/a&gt;, then run&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;UPGRADE_TEST_RUN=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; nosetests upgrade_tests/upgrade_through_versions_test.py:ProtoV3Upgrade_AllVersions_RandomPartitioner_Skips_3_0_x_EndsAt_Trunk_HEAD.rolling_upgrade_test
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15298291" author="tjake" created="Tue, 24 May 2016 14:48:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yukim&quot; class=&quot;user-hover&quot; rel=&quot;yukim&quot;&gt;yukim&lt;/a&gt; suggested this could well be a regression from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11206&quot; title=&quot;Support large partitions on the 3.0 sstable format&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11206&quot;&gt;&lt;del&gt;CASSANDRA-11206&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=snazy&quot; class=&quot;user-hover&quot; rel=&quot;snazy&quot;&gt;snazy&lt;/a&gt; can you dig in?&lt;/p&gt;</comment>
                            <comment id="15302110" author="snazy" created="Thu, 26 May 2016 14:05:52 +0000"  >&lt;p&gt;Yes, it looks like a regression by 11206. On it.&lt;/p&gt;</comment>
                            <comment id="15303844" author="snazy" created="Fri, 27 May 2016 09:50:55 +0000"  >&lt;p&gt;Hm. I&apos;m unable to run the dtest on my Mac nor on a beefy machine. Both fail during the first upgrade from 2.1.14 to 2.2.6 with timeouts.&lt;/p&gt;

&lt;p&gt;But I found an issue in &lt;tt&gt;RowIndexEntry&lt;/tt&gt;, which can definitely cause broken reads. There are two options to verify whether that&apos;s causing the bug:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Set &lt;tt&gt;column_index_cache_size_in_kb&lt;/tt&gt; to &lt;tt&gt;0&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;Use &lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...snazy:11763-dtest-upgrade-failure-trunk?expand=1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this branch&lt;/a&gt; instead of trunk in the dtest&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="15304026" author="snazy" created="Fri, 27 May 2016 12:55:21 +0000"  >&lt;p&gt;Still no luck to repro the dtest.&lt;br/&gt;
But I figured out how to repro with the modified utest &lt;tt&gt;LegacySSTableTest&lt;/tt&gt;. Without the patch the utest fails during compaction (as indicated by the dtest logs) - with the patch it works fine.&lt;/p&gt;

&lt;p&gt;Background: 3.6 has a bug (introduced by late refactorings) reading legacy non-shallow IndexedEntry objects (the non-shallow ones) since it accidentally uses the &lt;em&gt;new&lt;/em&gt; format (with vints).&lt;/p&gt;

&lt;p&gt;Eligible to merge to 3.6 or 3.7, too?&lt;/p&gt;</comment>
                            <comment id="15304033" author="snazy" created="Fri, 27 May 2016 13:00:48 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;cassandra-3.6&lt;/th&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-3.6...snazy:11763-dtest-upgrade-failure-3.6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/snazy/job/snazy-11763-dtest-upgrade-failure-3.6-testall/lastSuccessfulBuild/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/snazy/job/snazy-11763-dtest-upgrade-failure-3.6-dtest/lastSuccessfulBuild/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;cassandra-3.7&lt;/th&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-3.7...snazy:11763-dtest-upgrade-failure-3.7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/snazy/job/snazy-11763-dtest-upgrade-failure-3.7-testall/lastSuccessfulBuild/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/snazy/job/snazy-11763-dtest-upgrade-failure-3.7-dtest/lastSuccessfulBuild/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...snazy:11763-dtest-upgrade-failure-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/snazy/job/snazy-11763-dtest-upgrade-failure-trunk-testall/lastSuccessfulBuild/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/snazy/job/snazy-11763-dtest-upgrade-failure-trunk-dtest/lastSuccessfulBuild/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;Note: all branches (3.6, 3.7, trunk) contain the same commit (just not merged)&lt;/p&gt;</comment>
                            <comment id="15304073" author="tjake" created="Fri, 27 May 2016 13:41:16 +0000"  >&lt;p&gt;Waiting for test confirmation but that looks like it.&lt;/p&gt;</comment>
                            <comment id="15304551" author="snazy" created="Fri, 27 May 2016 18:49:54 +0000"  >&lt;p&gt;Tests for 3.7 + trunk look good (at least, I don&apos;t see a regression by the patch).&lt;/p&gt;

&lt;p&gt;The test is now broken for 3.6 - probably with &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9669&quot; title=&quot;If sstable flushes complete out of order, on restart we can fail to replay necessary commit log records&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9669&quot;&gt;&lt;del&gt;CASSANDRA-9669&lt;/del&gt;&lt;/a&gt;, which went into 3.0 and 3.7, but not into 3.6.&lt;/p&gt;</comment>
                            <comment id="15304561" author="tjake" created="Fri, 27 May 2016 18:55:53 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;regarding &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9669&quot; title=&quot;If sstable flushes complete out of order, on restart we can fail to replay necessary commit log records&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9669&quot;&gt;&lt;del&gt;CASSANDRA-9669&lt;/del&gt;&lt;/a&gt; we just need to make sure we release 3.0.7 and 3.7 at the same time.&lt;/p&gt;</comment>
                            <comment id="15306481" author="snazy" created="Mon, 30 May 2016 10:20:25 +0000"  >&lt;p&gt;Commit the patch to 3.7+trunk or also to 3.6?&lt;/p&gt;</comment>
                            <comment id="15306724" author="tjake" created="Mon, 30 May 2016 14:45:40 +0000"  >&lt;p&gt;3.6 up&lt;/p&gt;
</comment>
                            <comment id="15306777" author="snazy" created="Mon, 30 May 2016 15:48:59 +0000"  >&lt;p&gt;Thanks!&lt;br/&gt;
Committed as 8d22d9fd1842c59ea65a3793aceb5a78c5852351 to 3.6, merged to 3.7 and trunk.&lt;/p&gt;</comment>
                            <comment id="15306779" author="snazy" created="Mon, 30 May 2016 15:50:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=philipthompson&quot; class=&quot;user-hover&quot; rel=&quot;philipthompson&quot;&gt;philipthompson&lt;/a&gt;/&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhatch&quot; class=&quot;user-hover&quot; rel=&quot;rhatch&quot;&gt;rhatch&lt;/a&gt; can you run the upgrade test again to finally verify the fix?&lt;/p&gt;</comment>
                            <comment id="15308234" author="philipthompson" created="Tue, 31 May 2016 17:56:28 +0000"  >&lt;p&gt;Yes, I&apos;ve kicked off at &lt;a href=&quot;http://cassci.datastax.com/view/Parameterized/job/upgrade_tests-all-custom_branch_runs/25/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Parameterized/job/upgrade_tests-all-custom_branch_runs/25/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15310327" author="philipthompson" created="Wed, 1 Jun 2016 13:48:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tjake&quot; class=&quot;user-hover&quot; rel=&quot;tjake&quot;&gt;tjake&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=snazy&quot; class=&quot;user-hover&quot; rel=&quot;snazy&quot;&gt;snazy&lt;/a&gt;, I ran the tests and found an error in rolling_upgrade_test that I have never seen before and have not found a ticket for. Should I open a new bug?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Unexpected error in node2 log, error: 
ERROR [SharedPool-Worker-4] 2016-05-31 20:17:42,597 Message.java:611 - Unexpected exception during request; channel = [id: 0x152357bc, L:/127.0.0.2:9042 - R:/127.0.0.1:44896]
java.lang.AssertionError: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
	at org.apache.cassandra.db.ReadCommand$LegacyReadCommandSerializer.serializedSize(ReadCommand.java:1267) ~[main/:na]
	at org.apache.cassandra.db.ReadCommand$LegacyReadCommandSerializer.serializedSize(ReadCommand.java:1214) ~[main/:na]
	at org.apache.cassandra.net.MessageOut.payloadSize(MessageOut.java:161) ~[main/:na]
	at org.apache.cassandra.net.OutboundTcpConnectionPool.getConnection(OutboundTcpConnectionPool.java:72) ~[main/:na]
	at org.apache.cassandra.net.MessagingService.getConnection(MessagingService.java:609) ~[main/:na]
	at org.apache.cassandra.net.MessagingService.sendOneWay(MessagingService.java:758) ~[main/:na]
	at org.apache.cassandra.net.MessagingService.sendRR(MessagingService.java:701) ~[main/:na]
	at org.apache.cassandra.net.MessagingService.sendRRWithFailure(MessagingService.java:684) ~[main/:na]
	at org.apache.cassandra.service.AbstractReadExecutor.makeRequests(AbstractReadExecutor.java:110) ~[main/:na]
	at org.apache.cassandra.service.AbstractReadExecutor.makeDataRequests(AbstractReadExecutor.java:85) ~[main/:na]
	at org.apache.cassandra.service.AbstractReadExecutor$SpeculatingReadExecutor.executeAsync(AbstractReadExecutor.java:264) ~[main/:na]
	at org.apache.cassandra.service.StorageProxy$SinglePartitionReadLifecycle.doInitialQueries(StorageProxy.java:1702) ~[main/:na]
	at org.apache.cassandra.service.StorageProxy.fetchRows(StorageProxy.java:1657) ~[main/:na]
	at org.apache.cassandra.service.StorageProxy.readRegular(StorageProxy.java:1604) ~[main/:na]
	at org.apache.cassandra.service.StorageProxy.read(StorageProxy.java:1523) ~[main/:na]
	at org.apache.cassandra.db.SinglePartitionReadCommand.execute(SinglePartitionReadCommand.java:302) ~[main/:na]
	at org.apache.cassandra.service.pager.AbstractQueryPager.fetchPage(AbstractQueryPager.java:67) ~[main/:na]
	at org.apache.cassandra.service.pager.SinglePartitionPager.fetchPage(SinglePartitionPager.java:34) ~[main/:na]
	at org.apache.cassandra.cql3.statements.SelectStatement$Pager$NormalPager.fetchPage(SelectStatement.java:316) ~[main/:na]
	at org.apache.cassandra.cql3.statements.SelectStatement.execute(SelectStatement.java:352) ~[main/:na]
	at org.apache.cassandra.cql3.statements.SelectStatement.execute(SelectStatement.java:228) ~[main/:na]
	at org.apache.cassandra.cql3.statements.SelectStatement.execute(SelectStatement.java:78) ~[main/:na]
	at org.apache.cassandra.cql3.QueryProcessor.processStatement(QueryProcessor.java:208) ~[main/:na]
	at org.apache.cassandra.cql3.QueryProcessor.processPrepared(QueryProcessor.java:486) ~[main/:na]
	at org.apache.cassandra.cql3.QueryProcessor.processPrepared(QueryProcessor.java:463) ~[main/:na]
	at org.apache.cassandra.transport.messages.ExecuteMessage.execute(ExecuteMessage.java:130) ~[main/:na]
	at org.apache.cassandra.transport.Message$Dispatcher.channelRead0(Message.java:507) [main/:na]
	at org.apache.cassandra.transport.Message$Dispatcher.channelRead0(Message.java:401) [main/:na]
	at io.netty.channel.SimpleChannelInboundHandler.channelRead(SimpleChannelInboundHandler.java:105) [netty-all-4.0.36.Final.jar:4.0.36.Final]
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:292) [netty-all-4.0.36.Final.jar:4.0.36.Final]
	at io.netty.channel.AbstractChannelHandlerContext.access$600(AbstractChannelHandlerContext.java:32) [netty-all-4.0.36.Final.jar:4.0.36.Final]
	at io.netty.channel.AbstractChannelHandlerContext$7.run(AbstractChannelHandlerContext.java:283) [netty-all-4.0.36.Final.jar:4.0.36.Final]
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [na:1.8.0_51]
	at org.apache.cassandra.concurrent.AbstractLocalAwareExecutorService$FutureTask.run(AbstractLocalAwareExecutorService.java:164) [main/:na]
	at org.apache.cassandra.concurrent.SEPWorker.run(SEPWorker.java:105) [main/:na]
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [na:1.8.0_51]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15310334" author="tjake" created="Wed, 1 Jun 2016 13:53:36 +0000"  >&lt;p&gt;looks like &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11393&quot; title=&quot;dtest failure in upgrade_tests.upgrade_through_versions_test.ProtoV3Upgrade_2_1_UpTo_3_0_HEAD.rolling_upgrade_test&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11393&quot;&gt;&lt;del&gt;CASSANDRA-11393&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15310346" author="philipthompson" created="Wed, 1 Jun 2016 13:57:27 +0000"  >&lt;p&gt;JQL search fails me yet again. Then, no problems with the tests, and I no longer see the issue from this ticket &lt;span class=&quot;error&quot;&gt;&amp;#91;11763&amp;#93;&lt;/span&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12962714">CASSANDRA-11663</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12968662">CASSANDRA-11765</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12803668" name="node1.log" size="175429" author="philipthompson" created="Thu, 12 May 2016 14:51:38 +0000"/>
                            <attachment id="12803667" name="node1_debug.log" size="1041427" author="philipthompson" created="Thu, 12 May 2016 14:51:38 +0000"/>
                            <attachment id="12803670" name="node2.log" size="154516" author="philipthompson" created="Thu, 12 May 2016 14:51:38 +0000"/>
                            <attachment id="12803669" name="node2_debug.log" size="10102964" author="philipthompson" created="Thu, 12 May 2016 14:51:38 +0000"/>
                            <attachment id="12803672" name="node3.log" size="125560" author="philipthompson" created="Thu, 12 May 2016 14:51:38 +0000"/>
                            <attachment id="12803671" name="node3_debug.log" size="11775705" author="philipthompson" created="Thu, 12 May 2016 14:51:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[snazy]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 24 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2xs1b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12335055">3.6</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>tjake</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[tjake]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>