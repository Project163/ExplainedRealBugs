<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:18:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-1992] Bootstrap breaks data stored (missing rows, extra rows, column values modified)</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-1992</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Scenario:&lt;br/&gt;
Two fresh (empty /data /commitog /saved_caches dirs) cassandra installs.&lt;br/&gt;
Start first one.&lt;br/&gt;
Run data inserting program &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;,  run again in verify mode - all data intact.&lt;br/&gt;
Bootstrap 2nd node.&lt;br/&gt;
Run verification again, now it fails.&lt;/p&gt;

&lt;p&gt;Issue is very strange to me as cassandra works perfectly for me when cluster nodes stay the same for days now but any bootstrap ( 1 &lt;del&gt;&amp;gt; 2 nodes, 2 -&amp;gt; 3 nodes, 2&lt;/del&gt;&amp;gt;3 nodes RF=2) breaks data.&lt;/p&gt;

&lt;p&gt;I am running cassandra with 1GB heap size, 32bit userland on 64bit kernels, not sure what else could matter there.&lt;br/&gt;
Any hints ?&lt;br/&gt;
Thanks in advance, regards.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; simple program generating data and later verifying data.&lt;br/&gt;
&lt;a href=&quot;http://beauty.ant.gliwice.pl/bugs/cassandra-bootstrap/test.py&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://beauty.ant.gliwice.pl/bugs/cassandra-bootstrap/test.py&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; Logs from 1st node:&lt;br/&gt;
&lt;a href=&quot;http://beauty.ant.gliwice.pl/bugs/cassandra-bootstrap/system-3.4.log&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://beauty.ant.gliwice.pl/bugs/cassandra-bootstrap/system-3.4.log&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;3&amp;#93;&lt;/span&gt; Logs from 2nd (bootstraping node)&lt;br/&gt;
&lt;a href=&quot;http://beauty.ant.gliwice.pl/bugs/cassandra-bootstrap/system-3.8.log&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://beauty.ant.gliwice.pl/bugs/cassandra-bootstrap/system-3.8.log&lt;/a&gt;&lt;/p&gt;
</description>
                <environment>&lt;p&gt;Linux 2.6.36-1 #1 SMP Tue Nov 9 09:56:02 CET 2010 x86_64 Intel(R)&lt;em&gt;Core(TM)2_Quad_CPU&lt;/em&gt;__&lt;em&gt;Q8300&lt;/em&gt;_@_2.50GHz PLD Linux&lt;br/&gt;
glibc-2.12-4.i686&lt;br/&gt;
java-sun-1.6.0.22-1.i686&lt;/p&gt;</environment>
        <key id="12495685">CASSANDRA-1992</key>
            <summary>Bootstrap breaks data stored (missing rows, extra rows, column values modified)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="brandon.williams">Brandon Williams</assignee>
                                    <reporter username="matkor">Mateusz Korniak</reporter>
                        <labels>
                    </labels>
                <created>Sat, 15 Jan 2011 21:47:38 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:09 +0000</updated>
                            <resolved>Wed, 19 Jan 2011 19:32:01 +0000</resolved>
                                        <fixVersion>0.7.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                    <workratio workratioPercent="12"/>
                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="12" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                                    <row percentage="88" backgroundColor="transparent"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="12" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                                    <row percentage="88" backgroundColor="transparent"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="28800">8h</timeoriginalestimate>
                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3600">1h</timespent>
                                <comments>
                            <comment id="12982181" author="matkor" created="Sat, 15 Jan 2011 22:27:10 +0000"  >&lt;p&gt;Not sure if it is important but:&lt;/p&gt;

&lt;p&gt;After loading data ring looks like:&lt;br/&gt;
Address         Status State   Load            Owns    Token&lt;br/&gt;
192.168.3.4     Up     Normal  59.02 KB        100.00% 0&lt;/p&gt;

&lt;p&gt;After bootstraping:&lt;br/&gt;
192.168.3.4     Up     Normal  199.28 KB       56.45%  0&lt;br/&gt;
192.168.3.8     Up     Normal  115.03 KB       43.55%  74091174110465149971373554442555361956&lt;/p&gt;

&lt;p&gt;Load gets tripled on 1st node.&lt;/p&gt;</comment>
                            <comment id="12982209" author="stuhood" created="Sun, 16 Jan 2011 03:21:57 +0000"  >&lt;p&gt;Are both nodes reporting the same ring (via nodetool ring) after the bootstrap? The last entry in 3.8.log indicates that it thinks 3.4 is dead, but this might just be because you stopped the nodes before collecting the logs.&lt;/p&gt;

&lt;p&gt;Also, what exactly is the error you get from your script?&lt;/p&gt;</comment>
                            <comment id="12982277" author="matkor" created="Sun, 16 Jan 2011 10:51:23 +0000"  >&lt;p&gt;Stu,&lt;br/&gt;
Yes both nodes show same via nodetool ring: &lt;br/&gt;
192.168.3.4 Up Normal 199.28 KB 56.45% 0&lt;br/&gt;
192.168.3.8 Up Normal 115.03 KB 43.55% 74091174110465149971373554442555361956&lt;/p&gt;

&lt;p&gt;You are right, I stopped cluster by stopping 3.4 first. (Anyway it would be good to store information of gracefull shutdown of node in system.log, IMHO) &lt;/p&gt;

&lt;p&gt;Error is:&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;matkor@laptop-hp ~/src/caswife&amp;#93;&lt;/span&gt;$ python test.py&lt;br/&gt;
column_family: &apos;CF0&apos;&lt;br/&gt;
row_key: &apos;row=0 &apos;&lt;br/&gt;
row_key: &apos;row=1 \x00&apos;&lt;br/&gt;
row_key: &apos;row=2 \x00\x01&apos;&lt;br/&gt;
row_key: &apos;row=3 \x00\x01\x02&apos;&lt;br/&gt;
row_key: &apos;row=4 \x00\x01\x02\x03&apos;&lt;br/&gt;
row_key: &apos;row=5 \x00\x01\x02\x03\x04&apos;&lt;br/&gt;
row_key: &apos;row=6 \x00\x01\x02\x03\x04\x05&apos;&lt;br/&gt;
Traceback (most recent call last):&lt;br/&gt;
  File &quot;test.py&quot;, line 36, in &amp;lt;module&amp;gt;&lt;br/&gt;
    loaded_cols_dict = current_cf.get(row_key)&lt;br/&gt;
  File &quot;/usr/share/python2.7/site-packages/pycassa/columnfamily.py&quot;, line 362, in new_f&lt;br/&gt;
  File &quot;/usr/share/python2.7/site-packages/pycassa/columnfamily.py&quot;, line 429, in get&lt;br/&gt;
pycassa.cassandra.ttypes.NotFoundException: NotFoundException()&lt;/p&gt;

&lt;p&gt;So program found 7 rows but failed to find 8th as from my understanding of pycassa.&lt;/p&gt;</comment>
                            <comment id="12982283" author="matkor" created="Sun, 16 Jan 2011 11:31:57 +0000"  >&lt;p&gt;One more thing:&lt;br/&gt;
I repeated setup today, also reaching missing row(s) but 2nd node got different token 61078635599166706937511052402724559481&lt;br/&gt;
Following&lt;br/&gt;
&lt;a href=&quot;http://wiki.apache.org/cassandra/Operations#Load_balancing&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://wiki.apache.org/cassandra/Operations#Load_balancing&lt;/a&gt; ,&lt;br/&gt;
having 1st node token set to 0 and using RandomPartitioner, I would expect  2nd node toke to be set always in middle of token space to&lt;br/&gt;
850705917302346158658436518579420528&lt;br/&gt;
?&lt;/p&gt;
</comment>
                            <comment id="12982288" author="matkor" created="Sun, 16 Jan 2011 12:23:49 +0000"  >&lt;p&gt;Another thing: &lt;br/&gt;
By luck, I discovered that restarting one or both nodes makes data to be served again intact.&lt;br/&gt;
To avoid picking token 2nd node  randomness I set it explicitly to 85070591730234615865843651857942052864&lt;br/&gt;
.&lt;br/&gt;
So scenario is now:&lt;br/&gt;
Clean pycassa installs with tokens set to 0 and 85070591730234615865843651857942052864.&lt;/p&gt;

&lt;p&gt;Starting first node &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;, uploading data, verifing ok, ring:&lt;br/&gt;
192.168.3.4     Up     Normal  59.02 KB        100.00% 0&lt;/p&gt;

&lt;p&gt;Bootstraping 2nd node, waiting to finish streaming, data verification bad:&lt;br/&gt;
column_family: &apos;CF0&apos;&lt;br/&gt;
row_key: &apos;row=0 &apos;&lt;br/&gt;
Traceback (most recent call last):&lt;br/&gt;
  File &quot;test.py&quot;, line 36, in &amp;lt;module&amp;gt;&lt;br/&gt;
    loaded_cols_dict = current_cf.get(row_key)&lt;br/&gt;
  File &quot;/usr/share/python2.7/site-packages/pycassa/columnfamily.py&quot;, line 362, in new_f&lt;br/&gt;
  File &quot;/usr/share/python2.7/site-packages/pycassa/columnfamily.py&quot;, line 429, in get&lt;br/&gt;
pycassa.cassandra.ttypes.NotFoundException: NotFoundException()&lt;br/&gt;
Final ring (same on both nodes):&lt;br/&gt;
192.168.3.4     Up     Normal  199.28 KB       50.00%  0&lt;br/&gt;
192.168.3.8     Up     Normal  135.7 KB        50.00%  85070591730234615865843651857942052864&lt;/p&gt;

&lt;p&gt;Restaring 192.168.3.4, data &lt;em&gt;same&lt;/em&gt; &lt;em&gt;error&lt;/em&gt; as above, ring changes to:&lt;br/&gt;
192.168.3.4     Up     Normal  201.51 KB       50.00%  0&lt;br/&gt;
192.168.3.8     Up     Normal  135.7 KB        50.00%  85070591730234615865843651857942052864&lt;/p&gt;

&lt;p&gt;Restarting 192.168.3.8, data &lt;em&gt;verified&lt;/em&gt; &lt;em&gt;ok&lt;/em&gt; , ring changes on (same on both nodes) to:&lt;br/&gt;
192.168.3.4     Up     Normal  201.51 KB       50.00%  0&lt;br/&gt;
192.168.3.8     Up     Normal  145.8 KB        50.00%  85070591730234615865843651857942052864&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; Logs from 1st 192.168.3.4 node:&lt;br/&gt;
&lt;a href=&quot;http://beauty.ant.gliwice.pl/bugs/cassandra-bootstrap/logs_with_restart/system-3.4.log&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://beauty.ant.gliwice.pl/bugs/cassandra-bootstrap/logs_with_restart/system-3.4.log&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; Logs from 2nd 192.168.3.8 node:&lt;br/&gt;
&lt;a href=&quot;http://beauty.ant.gliwice.pl/bugs/cassandra-bootstrap/logs_with_restart/system-3.8.log&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://beauty.ant.gliwice.pl/bugs/cassandra-bootstrap/logs_with_restart/system-3.8.log&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;HIH, regards&lt;/p&gt;</comment>
                            <comment id="12982350" author="brandon.williams" created="Sun, 16 Jan 2011 18:25:13 +0000"  >&lt;p&gt;Since the issue appears to be a missing row, can you reproduce with contrib/py_stress?&lt;/p&gt;</comment>
                            <comment id="12982379" author="matkor" created="Sun, 16 Jan 2011 20:44:42 +0000"  >&lt;p&gt;Brandon, yes and no &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;br/&gt;
Unable with original contrib/py_stress as it uses only one CF to do all tests. Most of my issues looks like missing row in 2nd CF or broken data in 2nd CF (like contents of 1st CF injected into 2nd CF).&lt;br/&gt;
I slightly modified contrib/py_stress so it created 3 standard CFs and 3 super CFs &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; and allows to select one wants to operate via --column_family_idx= switch and I can reproduce:&lt;/p&gt;

&lt;p&gt;Starting 1st node.&lt;/p&gt;

&lt;p&gt;$ python stress.py --nodes 192.168.3.8 --operation insert  --num-keys 100 --progress-interval 5  --keep-going --column_family_idx=1       &lt;br/&gt;
Created keyspaces.  Sleeping 1s for propagation.&lt;br/&gt;
total,interval_op_rate,interval_key_rate,avg_latency,elapsed_time&lt;br/&gt;
100,20,20,0.00823852300644,0&lt;br/&gt;
$ python stress.py --nodes 192.168.3.8 --operation insert  --num-keys 100 --progress-interval 5  --keep-going --column_family_idx=2 &lt;br/&gt;
Keyspace already exists.&lt;br/&gt;
total,interval_op_rate,interval_key_rate,avg_latency,elapsed_time&lt;br/&gt;
100,20,20,0.00132475852966,0&lt;br/&gt;
$ python stress.py --nodes 192.168.3.8 --operation insert  --num-keys 100 --progress-interval 5  --keep-going --column_family_idx=3&lt;br/&gt;
Keyspace already exists.&lt;br/&gt;
total,interval_op_rate,interval_key_rate,avg_latency,elapsed_time&lt;br/&gt;
100,20,20,0.00138550519943,0&lt;/p&gt;

&lt;p&gt;Verification of data in each CF:&lt;br/&gt;
$ python stress.py --nodes 192.168.3.8 --operation read  --num-keys 100 --progress-interval 5  --keep-going --column_family_idx=3&lt;br/&gt;
total,interval_op_rate,interval_key_rate,avg_latency,elapsed_time&lt;br/&gt;
100,20,20,0.00282711744308,0&lt;br/&gt;
$ python stress.py --nodes 192.168.3.8 --operation read  --num-keys 100 --progress-interval 5  --keep-going --column_family_idx=2&lt;br/&gt;
total,interval_op_rate,interval_key_rate,avg_latency,elapsed_time&lt;br/&gt;
100,20,20,0.00149053096771,0&lt;br/&gt;
$ python stress.py --nodes 192.168.3.8 --operation read  --num-keys 100 --progress-interval 5  --keep-going --column_family_idx=1&lt;br/&gt;
total,interval_op_rate,interval_key_rate,avg_latency,elapsed_time&lt;br/&gt;
100,20,20,0.00125009775162,0&lt;/p&gt;

&lt;p&gt;Bootstrap 2nd node and now failure:&lt;br/&gt;
$ python stress.py --nodes 192.168.3.8 --operation read  --num-keys 100 --progress-interval 5  --keep-going --column_family_idx=1&lt;br/&gt;
total,interval_op_rate,interval_key_rate,avg_latency,elapsed_time&lt;br/&gt;
100,20,20,0.00376108169556,0&lt;br/&gt;
$ python stress.py --nodes 192.168.3.8 --operation read  --num-keys 100 --progress-interval 5  --keep-going --column_family_idx=2&lt;br/&gt;
Key 074 not found&lt;br/&gt;
Key 061 not found&lt;br/&gt;
Key 047 not found&lt;br/&gt;
( cut 40 more Key 0xx not found)&lt;br/&gt;
Key 047 not found&lt;br/&gt;
Key 042 not found&lt;br/&gt;
Key 058 not found&lt;br/&gt;
total,interval_op_rate,interval_key_rate,avg_latency,elapsed_time&lt;br/&gt;
Key 033 not found&lt;br/&gt;
100,20,20,0.00241538286209,0&lt;/p&gt;

&lt;p&gt;Similar failure for 3rd CF.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;: Modified stress.py from 0.7.0 with --column_family_idx= added.&lt;br/&gt;
&lt;a href=&quot;http://beauty.ant.gliwice.pl/bugs/cassandra-bootstrap/stress.py&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://beauty.ant.gliwice.pl/bugs/cassandra-bootstrap/stress.py&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12982381" author="matkor" created="Sun, 16 Jan 2011 20:51:14 +0000"  >&lt;p&gt;And again, restarting first node, cuts number of missing row by more or less half, restarting 2nd node cures all missing rows.&lt;/p&gt;</comment>
                            <comment id="12982561" author="ivol" created="Mon, 17 Jan 2011 09:33:20 +0000"  >&lt;p&gt;I have the exact same problem with an existing installation and was preparing to create an issue for it, but found this issue just before creating it. I&apos;ll describe the issue I have, maybe that provides some relevant information.&lt;/p&gt;

&lt;p&gt;I ran into this issue with Cassandra 0.7 trying to add just one node to an existing one-node cluster. The existing node contains already some data when the second node is added to the cluster. This is what I did:&lt;/p&gt;

&lt;p&gt;Setup&lt;br/&gt;
I have two nodes both running on Linux; a server called &apos;veers&apos; on 172.16.2.203 and a &apos;r2d2&apos; on 172.16.2.206. I use Cassandra 0.7 and only change the following settings in the cassandra.yaml and log4j-server.properties (I use the default values for all other entries):&lt;/p&gt;

&lt;p&gt;In cassandra.yaml:&lt;/p&gt;

&lt;p&gt;initial_token: 0&lt;br/&gt;
data_file_directories: /vol/users/ivol/cassandra_work/data&lt;br/&gt;
commitlog_directory: /vol/users/ivol/cassandra_work/commitlog&lt;br/&gt;
saved_caches_directory: /vol/users/ivol/cassandra_work/saved_caches&lt;br/&gt;
seeds: 172.16.2.203&lt;br/&gt;
listen_address: 172.16.2.203&lt;br/&gt;
rpc_address: 172.16.2.203&lt;/p&gt;

&lt;p&gt;In log4j-server.properties:&lt;/p&gt;

&lt;p&gt;log4j.appender.R.File=/vol/users/ivol/cassandra_work/system.log&lt;/p&gt;


&lt;p&gt;Now I start the first node and connect it using cassandra-cli. I add the following keyspace, column families and rows:&lt;/p&gt;

&lt;p&gt;create keyspace Default;&lt;br/&gt;
use Default;&lt;/p&gt;

&lt;p&gt;create column family Role;&lt;br/&gt;
set Role&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;user_1&amp;#39;&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;name&amp;#39;&amp;#93;&lt;/span&gt; = &apos;User 1&apos;;&lt;br/&gt;
set Role&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;user_2&amp;#39;&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;name&amp;#39;&amp;#93;&lt;/span&gt; = &apos;User 2&apos;;&lt;br/&gt;
set Role&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;user_3&amp;#39;&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;name&amp;#39;&amp;#93;&lt;/span&gt; = &apos;User 3&apos;;&lt;/p&gt;

&lt;p&gt;create column family Gadget;&lt;br/&gt;
set Gadget&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;gadget_1&amp;#39;&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;name&amp;#39;&amp;#93;&lt;/span&gt; = &apos;Gadget 1&apos;;&lt;br/&gt;
set Gadget&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;gadget_2&amp;#39;&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;name&amp;#39;&amp;#93;&lt;/span&gt; = &apos;Gadget 2&apos;;&lt;br/&gt;
set Gadget&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;gadget_3&amp;#39;&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;name&amp;#39;&amp;#93;&lt;/span&gt; = &apos;Gadget 3&apos;;&lt;/p&gt;

&lt;p&gt;After this &apos;list Role&apos; and &apos;list Gadget&apos; return the proper rows.&lt;/p&gt;

&lt;p&gt;Now I append a second node to the cluster, with this configuration:&lt;/p&gt;

&lt;p&gt;In cassandra.yaml:&lt;/p&gt;

&lt;p&gt;initial_token:&lt;br/&gt;
auto_bootstrap: true&lt;br/&gt;
data_file_directories: /vol/users/ivol/cassandra_work/data&lt;br/&gt;
commitlog_directory: /vol/users/ivol/cassandra_work/commitlog&lt;br/&gt;
saved_caches_directory: /vol/users/ivol/cassandra_work/saved_caches&lt;br/&gt;
seeds: 172.16.2.203&lt;br/&gt;
listen_address: 172.16.2.206&lt;br/&gt;
rpc_address: 172.16.2.206&lt;/p&gt;

&lt;p&gt;In log4j-server.properties:&lt;/p&gt;

&lt;p&gt;log4j.appender.R.File=/vol/users/ivol/cassandra_work/system.log&lt;/p&gt;


&lt;p&gt;Now I start the second node. Bootstrapping takes some time, about 2 minutes in total but finishes without any warnings or errors:&lt;/p&gt;

&lt;p&gt;...&lt;br/&gt;
INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2011-01-17 09:58:09,170 StorageService.java (line 399) Joining: getting load information&lt;br/&gt;
INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2011-01-17 09:58:09,171 StorageLoadBalancer.java (line 366) Sleeping 90000 ms to wait for load information...&lt;br/&gt;
INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipStage:1&amp;#93;&lt;/span&gt; 2011-01-17 09:58:10,447 Gossiper.java (line 577) Node /172.16.2.203 is now part of the cluster&lt;br/&gt;
INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;HintedHandoff:1&amp;#93;&lt;/span&gt; 2011-01-17 09:58:11,451 HintedHandOffManager.java (line 192) Started hinted handoff for endpoint /172.16.2.203&lt;br/&gt;
INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GossipStage:1&amp;#93;&lt;/span&gt; 2011-01-17 09:58:11,451 Gossiper.java (line 569) InetAddress /172.16.2.203 is now UP&lt;br/&gt;
INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;HintedHandoff:1&amp;#93;&lt;/span&gt; 2011-01-17 09:58:11,453 HintedHandOffManager.java (line 248) Finished hinted handoff of 0 rows to endpoint /172.16.2.203&lt;br/&gt;
INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2011-01-17 09:59:39,189 StorageService.java (line 399) Joining: getting bootstrap token&lt;br/&gt;
INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2011-01-17 09:59:39,203 BootStrapper.java (line 148) New token will be 110533280274756817580689726417060138498 to assume load from /172.16.2.203&lt;br/&gt;
INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2011-01-17 09:59:39,265 StorageService.java (line 399) Joining: sleeping 30000 ms for pending range setup&lt;br/&gt;
INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2011-01-17 10:00:09,272 StorageService.java (line 399) Bootstrapping&lt;br/&gt;
INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2011-01-17 10:00:09,663 CassandraDaemon.java (line 77) Binding thrift service to /172.16.2.206:9160&lt;br/&gt;
INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2011-01-17 10:00:09,666 CassandraDaemon.java (line 91) Using TFramedTransport with a max frame size of 15728640 bytes.&lt;br/&gt;
INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2011-01-17 10:00:09,671 CassandraDaemon.java (line 119) Listening for thrift clients...&lt;/p&gt;

&lt;p&gt;Although everything seemed to worked just fine, when node 2 is completely finished bootstrapping the rows in the &apos;Role&apos; and &apos;Gadget&apos; Column Families are messed up;&lt;/p&gt;

&lt;p&gt;list Role;&lt;/p&gt;

&lt;p&gt;-------------------&lt;br/&gt;
RowKey: user_3&lt;br/&gt;
=&amp;gt; (column=6e616d65, value=557365722033, timestamp=1295254678545000)&lt;/p&gt;

&lt;p&gt;1 Row Returned.&lt;/p&gt;


&lt;p&gt;list Gadget;&lt;/p&gt;

&lt;p&gt;-------------------&lt;br/&gt;
RowKey: user_2&lt;br/&gt;
=&amp;gt; (column=6e616d65, value=557365722032, timestamp=1295254678514000)&lt;br/&gt;
-------------------&lt;br/&gt;
RowKey: gadget_2&lt;br/&gt;
=&amp;gt; (column=6e616d65, value=4761646765742032, timestamp=1295254678805000)&lt;br/&gt;
-------------------&lt;br/&gt;
RowKey: gadget_3&lt;br/&gt;
=&amp;gt; (column=6e616d65, value=4761646765742033, timestamp=1295254679429000)&lt;br/&gt;
-------------------&lt;br/&gt;
RowKey: gadget_1&lt;br/&gt;
=&amp;gt; (column=6e616d65, value=4761646765742031, timestamp=1295254678771000)&lt;br/&gt;
-------------------&lt;br/&gt;
RowKey: user_1&lt;br/&gt;
=&amp;gt; (column=6e616d65, value=557365722031, timestamp=1295254678449000)&lt;/p&gt;

&lt;p&gt;5 Rows Returned.&lt;/p&gt;

&lt;p&gt;So 2 rows have been moved from CF &apos;Role&apos; to &apos;Gadget&apos;, just by adding a node to the cluster. The actual result differs each time I try, but always some rows have been moved to some other CF. The problem seems the same as the one described by Mateusz.&lt;/p&gt;

&lt;p&gt;I also found out that restarting the nodes seems to &apos;fix&apos; the issue. Also changing the replication factor from 1 to 2 most of the times &apos;resolves&apos; the issue.&lt;/p&gt;</comment>
                            <comment id="12982684" author="jbellis" created="Mon, 17 Jan 2011 15:57:38 +0000"  >&lt;p&gt;if restarting nodes fixes it, it sounds like the streamed data is not getting wired in correctly to the sstabletracker&lt;/p&gt;</comment>
                            <comment id="12983605" author="brandon.williams" created="Wed, 19 Jan 2011 08:21:19 +0000"  >&lt;p&gt;There were two bugs here in StreamInSession.  First, it was adding all streamed sstables to the last CFS it saw.  Secondly, secondary index generation was being performed against all sstables seen.  This patch switches from a scalar CFS and a separate list of all sstables to a hash of lists where the CFS is the key and the value is the sstables that belong to it.&lt;/p&gt;</comment>
                            <comment id="12983725" author="jbellis" created="Wed, 19 Jan 2011 14:29:23 +0000"  >&lt;p&gt;I think we need to get rid of StreamInSession.table and StreamHeader.table too, then.  (But leave it on the wire protocol as an empty string, for compatibility w/ 0.7.0)&lt;/p&gt;</comment>
                            <comment id="12983850" author="nickmbailey" created="Wed, 19 Jan 2011 19:24:56 +0000"  >&lt;p&gt;This would be a good test to have in the distributed test set up.&lt;/p&gt;</comment>
                            <comment id="12983854" author="jbellis" created="Wed, 19 Jan 2011 19:32:01 +0000"  >&lt;p&gt;Brandon said on IRC: &quot;maybe the table is there for some kind of reason, and the sessions are separated by keyspace.&quot;&lt;/p&gt;

&lt;p&gt;This is correct, so I&apos;m going to leave the table field even though it&apos;s currently not referenced.  So it&apos;s not dead weight. I added an assert that each sstable we&apos;re adding at the end of the session belongs to the table that the sender said it was for.&lt;/p&gt;

&lt;p&gt;Also added an assert to CFS.addSSTable to verify that the SSTR being added does belong to the CF it is being added to.&lt;/p&gt;

&lt;p&gt;Committed w/ those two additions.&lt;/p&gt;</comment>
                            <comment id="12983861" author="hudson" created="Wed, 19 Jan 2011 19:52:47 +0000"  >&lt;p&gt;Integrated in Cassandra-0.7 #177 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Cassandra-0.7/177/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hudson.apache.org/hudson/job/Cassandra-0.7/177/&lt;/a&gt;)&lt;br/&gt;
    fix streaming of multiple CFs during bootstrap&lt;br/&gt;
patch by brandonwilliams; reviewed by jbellis for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1992&quot; title=&quot;Bootstrap breaks data stored (missing rows, extra rows, column values modified)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1992&quot;&gt;&lt;del&gt;CASSANDRA-1992&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12989202" author="jdamick" created="Tue, 1 Feb 2011 13:41:15 +0000"  >&lt;p&gt;is there is any way to repair the problem without deleting all of my data? (shutting down and bringing back up did not solve the problem)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12468740" name="1992.txt" size="3109" author="brandon.williams" created="Wed, 19 Jan 2011 08:21:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20391</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 43 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0g8nj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>92832</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>