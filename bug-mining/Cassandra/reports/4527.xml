<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:05:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-12462] NullPointerException in CompactionInfo.getId(CompactionInfo.java:65)</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-12462</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Note: The same trace is cited in the last comment of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11961&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CASSANDRA-11961&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ve noticed that some of my nodes in my 2.1 cluster have fallen way behind on compactions, and have huge numbers (thousands) of uncompacted, tiny SSTables (~30MB or so).&lt;/p&gt;

&lt;p&gt;In diagnosing the issue, I&apos;ve found that &quot;nodetool compactionstats&quot; returns the exception below.  Restarting cassandra on the node here causes the pending tasks count to jump to ~2000.  Compactions run properly for about an hour, until this exception occurs again.  Once it occurs, I see the pending tasks value rapidly drop towards zero, but without any compactions actually running (the logs show no compactions finishing).  It would seem that this is causing compactions to fail on this node, which is leading to it running out of space, etc.&lt;/p&gt;


&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;redacted&amp;#93;&lt;/span&gt;# nodetool compactionstats&lt;br/&gt;
xss =  -ea -javaagent:/usr/share/cassandra/lib/jamm-0.3.0.jar -XX:+UseThreadPriorities -XX:ThreadPriorityPolicy=42 -Xms12G -Xmx12G -Xmn1000M -Xss255k&lt;br/&gt;
pending tasks: 5&lt;br/&gt;
error: null&lt;br/&gt;
&amp;#8211; StackTrace &amp;#8211;&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
	at org.apache.cassandra.db.compaction.CompactionInfo.getId(CompactionInfo.java:65)&lt;br/&gt;
	at org.apache.cassandra.db.compaction.CompactionInfo.asMap(CompactionInfo.java:118)&lt;br/&gt;
	at org.apache.cassandra.db.compaction.CompactionManager.getCompactions(CompactionManager.java:1405)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Unknown Source)&lt;br/&gt;
	at sun.reflect.misc.Trampoline.invoke(Unknown Source)&lt;br/&gt;
	at sun.reflect.GeneratedMethodAccessor3.invoke(Unknown Source)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Unknown Source)&lt;br/&gt;
	at sun.reflect.misc.MethodUtil.invoke(Unknown Source)&lt;br/&gt;
	at com.sun.jmx.mbeanserver.StandardMBeanIntrospector.invokeM2(Unknown Source)&lt;br/&gt;
	at com.sun.jmx.mbeanserver.StandardMBeanIntrospector.invokeM2(Unknown Source)&lt;br/&gt;
	at com.sun.jmx.mbeanserver.MBeanIntrospector.invokeM(Unknown Source)&lt;br/&gt;
	at com.sun.jmx.mbeanserver.PerInterface.getAttribute(Unknown Source)&lt;br/&gt;
	at com.sun.jmx.mbeanserver.MBeanSupport.getAttribute(Unknown Source)&lt;br/&gt;
	at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.getAttribute(Unknown Source)&lt;br/&gt;
	at com.sun.jmx.mbeanserver.JmxMBeanServer.getAttribute(Unknown Source)&lt;br/&gt;
	at javax.management.remote.rmi.RMIConnectionImpl.doOperation(Unknown Source)&lt;br/&gt;
	at javax.management.remote.rmi.RMIConnectionImpl.access$300(Unknown Source)&lt;br/&gt;
	at javax.management.remote.rmi.RMIConnectionImpl$PrivilegedOperation.run(Unknown Source)&lt;br/&gt;
	at javax.management.remote.rmi.RMIConnectionImpl.doPrivilegedOperation(Unknown Source)&lt;br/&gt;
	at javax.management.remote.rmi.RMIConnectionImpl.getAttribute(Unknown Source)&lt;br/&gt;
	at sun.reflect.GeneratedMethodAccessor11.invoke(Unknown Source)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Unknown Source)&lt;br/&gt;
	at sun.rmi.server.UnicastServerRef.dispatch(Unknown Source)&lt;br/&gt;
	at sun.rmi.transport.Transport$1.run(Unknown Source)&lt;br/&gt;
	at sun.rmi.transport.Transport$1.run(Unknown Source)&lt;br/&gt;
	at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
	at sun.rmi.transport.Transport.serviceCall(Unknown Source)&lt;br/&gt;
	at sun.rmi.transport.tcp.TCPTransport.handleMessages(Unknown Source)&lt;br/&gt;
	at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run0(Unknown Source)&lt;br/&gt;
	at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run(Unknown Source)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)&lt;br/&gt;
	at java.lang.Thread.run(Unknown Source)&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12997329">CASSANDRA-12462</key>
            <summary>NullPointerException in CompactionInfo.getId(CompactionInfo.java:65)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="szhou">Simon Zhou</assignee>
                                    <reporter username="jdeprizio">Jonathan DePrizio</reporter>
                        <labels>
                    </labels>
                <created>Mon, 15 Aug 2016 16:12:40 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:22 +0000</updated>
                            <resolved>Tue, 8 Nov 2016 15:48:31 +0000</resolved>
                                        <fixVersion>2.2.9</fixVersion>
                    <fixVersion>3.0.10</fixVersion>
                    <fixVersion>3.10</fixVersion>
                                    <component>Local/Compaction</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="15514830" author="szhou" created="Thu, 22 Sep 2016 23:43:27 +0000"  >&lt;p&gt;I repro&apos;ed the same issue with C* 2.2.5 and C* 3 should have the same issue.  I have a one line patch as attached. cc the original author of this line @jbellis to take a look.&lt;/p&gt;</comment>
                            <comment id="15514921" author="jjirsa" created="Fri, 23 Sep 2016 00:26:46 +0000"  >&lt;p&gt;When you&apos;re seeing this exception, do you have a schema mismatch? Have you recently added or removed a keyspace or table?&lt;/p&gt;</comment>
                            <comment id="15517038" author="szhou" created="Fri, 23 Sep 2016 17:24:49 +0000"  >&lt;p&gt;I don&apos;t see a schema mismatch, at least from the output of command &quot;nodetool describecluster&quot;. There should be new or removed keyspaces/tables recently because it&apos;s a shared dev cluster that&apos;s being actively used. But I don&apos;t know how to get the keyspace/table creation/deletion time.&lt;/p&gt;</comment>
                            <comment id="15534465" author="szhou" created="Thu, 29 Sep 2016 23:58:27 +0000"  >&lt;p&gt;patch attached.&lt;/p&gt;</comment>
                            <comment id="15534513" author="yukim" created="Fri, 30 Sep 2016 00:22:23 +0000"  >&lt;p&gt;The only case that &lt;tt&gt;cfm&lt;/tt&gt; in &lt;tt&gt;CompactionInfo&lt;/tt&gt; be &lt;tt&gt;null&lt;/tt&gt; is index summary distribution (see &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/io/sstable/IndexSummaryRedistribution.java#L309&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/io/sstable/IndexSummaryRedistribution.java#L309&lt;/a&gt; and &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/db/compaction/CompactionInfo.java#L47&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/db/compaction/CompactionInfo.java#L47&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;Index summary distibution runs across tables, so you cannot pass one table metadata.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=szhou&quot; class=&quot;user-hover&quot; rel=&quot;szhou&quot;&gt;szhou&lt;/a&gt; your patch only takes care of &lt;tt&gt;getId()&lt;/tt&gt;. You should patch all &lt;tt&gt;cfm&lt;/tt&gt; access in &lt;tt&gt;CompactionInfo&lt;/tt&gt; class and add null check.&lt;/p&gt;</comment>
                            <comment id="15564482" author="szhou" created="Tue, 11 Oct 2016 05:05:51 +0000"  >&lt;p&gt;Nice feedback. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yukim&quot; class=&quot;user-hover&quot; rel=&quot;yukim&quot;&gt;yukim&lt;/a&gt;. I&apos;ll update my patch shortly.&lt;/p&gt;</comment>
                            <comment id="15565749" author="szhou" created="Tue, 11 Oct 2016 15:26:42 +0000"  >&lt;p&gt;Patch v2 attached.&lt;/p&gt;</comment>
                            <comment id="15615987" author="szhou" created="Fri, 28 Oct 2016 17:15:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yukim&quot; class=&quot;user-hover&quot; rel=&quot;yukim&quot;&gt;yukim&lt;/a&gt;, could you help review patch v2? Thanks.&lt;/p&gt;</comment>
                            <comment id="15632806" author="yukim" created="Thu, 3 Nov 2016 14:06:03 +0000"  >&lt;p&gt;Thanks for the update, patch looks good to me.&lt;br/&gt;
I also put the patch to be applied from 2.2+, since the bug has been there also.&lt;br/&gt;
I&apos;m currently running the test with your codes, and it they are fine, I will commit.&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;testall&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;dtest&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/yukim/cassandra/tree/12462-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;12462-2.2&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/yukim/job/yukim-12462-2.2-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/yukim/job/yukim-12462-2.2-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/yukim/cassandra/tree/12462-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;12462-3.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/yukim/job/yukim-12462-3.0-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/yukim/job/yukim-12462-3.0-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/yukim/cassandra/tree/12462-3.X&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;12462-3.X&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/yukim/job/yukim-12462-3.X-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/yukim/job/yukim-12462-3.X-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/yukim/cassandra/tree/12462-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;12462-trunk&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/yukim/job/yukim-12462-trunk-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/yukim/job/yukim-12462-trunk-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15647909" author="yukim" created="Tue, 8 Nov 2016 15:48:33 +0000"  >&lt;p&gt;Tests look good, so I committed as &lt;tt&gt;cbebb29adf5d8b13e75fe60c2f7aa312420be35c&lt;/tt&gt;. Thanks!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12975841">CASSANDRA-11961</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12829956" name="0001-Fix-NPE-when-running-nodetool-compactionstats.patch" size="882" author="szhou" created="Thu, 22 Sep 2016 23:44:58 +0000"/>
                            <attachment id="12832681" name="CASSANDRA-12462-v2.patch" size="1684" author="szhou" created="Tue, 11 Oct 2016 15:26:42 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[szhou]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 2 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i32bpr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>yukim</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[yukim]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>