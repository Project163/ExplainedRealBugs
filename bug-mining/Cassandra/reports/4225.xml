<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:02:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-11474] cqlsh: COPY FROM should use regular inserts for single statement batches</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-11474</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I haven&apos;t reproduced it with a test yet but, from code inspection, if CQL rows are larger than &lt;tt&gt;batch_size_fail_threshold_in_kb&lt;/tt&gt; and this parameter cannot be changed, then data import will fail.&lt;/p&gt;

&lt;p&gt;Users can control the batch size by setting MAXBATCHSIZE.&lt;/p&gt;

&lt;p&gt;If a batch contains a single statement, there is no need to use a batch and we should use normal inserts instead or, alternatively, we should skip the batch size check for unlogged batches with only one statement.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12955158">CASSANDRA-11474</key>
            <summary>cqlsh: COPY FROM should use regular inserts for single statement batches</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stefania">Stefania Alborghetti</assignee>
                                    <reporter username="stefania">Stefania Alborghetti</reporter>
                        <labels>
                            <label>lhf</label>
                    </labels>
                <created>Fri, 1 Apr 2016 00:38:12 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:37 +0000</updated>
                            <resolved>Thu, 21 Apr 2016 01:56:38 +0000</resolved>
                                        <fixVersion>2.2.7</fixVersion>
                    <fixVersion>3.0.6</fixVersion>
                    <fixVersion>3.6</fixVersion>
                                    <component>Legacy/Tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15223589" author="stefania" created="Mon, 4 Apr 2016 01:38:19 +0000"  >&lt;p&gt;We should also make sure that if a child process aborts during startup, then the error message is displayed to the user. At the moment the only way to see exceptions thrown by worker processes during startup is via &lt;tt&gt;--debug&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15229555" author="stefania" created="Thu, 7 Apr 2016 02:28:20 +0000"  >&lt;p&gt;Patches and CI available here:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.2&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.0&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/11474-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/11474-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/11474&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-11474-2.2-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-11474-3.0-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-11474-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;There is a conflict from 2.2 to 3.0 whilst the 3.0 patch merges cleanly into trunk.&lt;/p&gt;

&lt;p&gt;I should also note that this is a pretty serious limitation of COPY FROM, albeit very unlikely to occur. However, we don&apos;t need the fix in 2.1 because &lt;tt&gt;batch_size_fail_threshold_in_kb&lt;/tt&gt; is only available in 2.2+.&lt;/p&gt;

&lt;p&gt;Additional dtest to reproduce the problem are available &lt;a href=&quot;https://github.com/stef1927/cassandra-dtest/tree/11474&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15229696" author="stefania" created="Thu, 7 Apr 2016 04:59:54 +0000"  >&lt;p&gt;CI looks good, this is ready for review.&lt;/p&gt;</comment>
                            <comment id="15229911" author="slebresne" created="Thu, 7 Apr 2016 08:33:59 +0000"  >&lt;p&gt;I haven&apos;t looked carefully at the patch as I&apos;m not too familiar with that code and I&apos;ll let somewhat more familiar review.&lt;/p&gt;

&lt;p&gt;But I&apos;ll note for the record that it&apos;s imo wrong that &lt;tt&gt;batch_size_fail_threshold_in_kb&lt;/tt&gt; doesn&apos;t apply to &lt;tt&gt;INSERT&lt;/tt&gt; too (I&apos;ve created &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11522&quot; title=&quot;batch_size_fail_threshold_in_kb shouldn&amp;#39;t only apply to batch&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11522&quot;&gt;&lt;del&gt;CASSANDRA-11522&lt;/del&gt;&lt;/a&gt; for the details) and that &lt;tt&gt;COPY FROM&lt;/tt&gt; shouldn&apos;t be in the business of avoiding server protections: If the user configures his server so that inserts above a certain size are rejected, then an import that violates that threshold &lt;em&gt;should&lt;/em&gt; fail.&lt;/p&gt;

&lt;p&gt;With that said, it kind of make sense I suppose to avoid batches when we don&apos;t have to on principle so I don&apos;t object to this patch in practice, I just disagree with the justification (and thus think this is pretty minor in practice).&lt;/p&gt;</comment>
                            <comment id="15229940" author="stefania" created="Thu, 7 Apr 2016 08:54:57 +0000"  >&lt;p&gt;Thanks for pointing this out, it wasn&apos;t clear to me. Until now I&apos;ve assumed &lt;tt&gt;batch_size_fail_threshold_in_kb&lt;/tt&gt; was in place to protect against LOGGED batches that are too large.&lt;/p&gt;

&lt;p&gt;Batching was introduced only recently in COPY FROM (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9302&quot; title=&quot;Optimize cqlsh COPY FROM, part 3&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9302&quot;&gt;&lt;del&gt;CASSANDRA-9302&lt;/del&gt;&lt;/a&gt;), so my concern was to restore any functionality that might have been removed by it.&lt;/p&gt;</comment>
                            <comment id="15241121" author="pauloricardomg" created="Thu, 14 Apr 2016 13:12:27 +0000"  >&lt;p&gt;LGTM, but given that &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10876&quot; title=&quot;Alter behavior of batch WARN and fail on single partition batches&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10876&quot;&gt;&lt;del&gt;CASSANDRA-10876&lt;/del&gt;&lt;/a&gt; removed this limitation for single partition batches on trunk, special casing single mutation batches on COPY FROM doesn&apos;t bring us much additional benefits, so I think we should include this only on 2.2 and 3.0 for code simplicity.&lt;/p&gt;

&lt;p&gt;Could you provide a trunk patch without the single insert optimization, but only with the error report and empty chunk fixes?&lt;/p&gt;</comment>
                            <comment id="15242254" author="stefania" created="Fri, 15 Apr 2016 01:12:40 +0000"  >&lt;p&gt;Thanks for the review.&lt;/p&gt;

&lt;p&gt;I&apos;ve removed the single insert special case from the patch on trunk but left the fix on reporting errors during the initialization phase of worker processes. I&apos;ve also prepared the ticket for commit by editing CHANGES.txt and the commit messages, please check if the description seems reasonable.&lt;/p&gt;

&lt;p&gt;I&apos;ve restarted CI, results are still pending.&lt;/p&gt;

&lt;p&gt;Also, here is the dtest &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/pull/928&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;pull request&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15249338" author="stefania" created="Wed, 20 Apr 2016 06:08:31 +0000"  >&lt;p&gt;CI results are good. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pauloricardomg&quot; class=&quot;user-hover&quot; rel=&quot;pauloricardomg&quot;&gt;pauloricardomg&lt;/a&gt; are you OK with the trunk patch as well now?&lt;/p&gt;</comment>
                            <comment id="15249720" author="pauloricardomg" created="Wed, 20 Apr 2016 12:01:01 +0000"  >&lt;p&gt;LGTM, I think we don&apos;t need to restrict &lt;tt&gt;test_reading_counter_without_batching&lt;/tt&gt; to version &amp;lt;= 3.5 (even though we currently don&apos;t exercise a specific code path on trunk, it can catch stuff in the future). If you agree, can you remove that restriction in the PR?&lt;/p&gt;

&lt;p&gt;After that you can mark this as ready to commit. Thank you!&lt;/p&gt;</comment>
                            <comment id="15251101" author="stefania" created="Thu, 21 Apr 2016 01:55:53 +0000"  >&lt;p&gt;Thank you, committed as eb072a0fa05292dd347e96d3bc45b445995227ec and pull request merged.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[stefania]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 30 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2vhqf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>pauloricardomg</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[pauloricardomg]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>