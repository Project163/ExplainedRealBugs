<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:04:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-12632] Failure in LogTransactionTest.testUnparsableFirstRecord-compression</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-12632</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Stacktrace:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;junit.framework.AssertionFailedError: [/home/automaton/cassandra/build/test/cassandra/data:161/TransactionLogsTest/mockcf23-73ad523078d311e6985893d33dad3001/mc-1-big-Index.db, /home/automaton/cassandra/build/test/cassandra/data:161/TransactionLogsTest/mockcf23-73ad523078d311e6985893d33dad3001/mc-1-big-TOC.txt, /home/automaton/cassandra/build/test/cassandra/data:161/TransactionLogsTest/mockcf23-73ad523078d311e6985893d33dad3001/mc-1-big-Filter.db, /home/automaton/cassandra/build/test/cassandra/data:161/TransactionLogsTest/mockcf23-73ad523078d311e6985893d33dad3001/mc-1-big-Data.db, /home/automaton/cassandra/build/test/cassandra/data:161/TransactionLogsTest/mockcf23-73ad523078d311e6985893d33dad3001/mc_txn_compaction_73af4e00-78d3-11e6-9858-93d33dad3001.log]
	at org.apache.cassandra.db.lifecycle.LogTransactionTest.assertFiles(LogTransactionTest.java:1228)
	at org.apache.cassandra.db.lifecycle.LogTransactionTest.assertFiles(LogTransactionTest.java:1196)
	at org.apache.cassandra.db.lifecycle.LogTransactionTest.testCorruptRecord(LogTransactionTest.java:1040)
	at org.apache.cassandra.db.lifecycle.LogTransactionTest.testUnparsableFirstRecord(LogTransactionTest.java:988)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Example failure:&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/job/cassandra-3.9_testall/89/testReport/junit/org.apache.cassandra.db.lifecycle/LogTransactionTest/testUnparsableFirstRecord_compression/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/job/cassandra-3.9_testall/89/testReport/junit/org.apache.cassandra.db.lifecycle/LogTransactionTest/testUnparsableFirstRecord_compression/&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13004498">CASSANDRA-12632</key>
            <summary>Failure in LogTransactionTest.testUnparsableFirstRecord-compression</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stefania">Stefania Alborghetti</assignee>
                                    <reporter username="jkni">Joel Knighton</reporter>
                        <labels>
                    </labels>
                <created>Tue, 13 Sep 2016 04:41:57 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:19 +0000</updated>
                            <resolved>Thu, 29 Sep 2016 01:32:11 +0000</resolved>
                                        <fixVersion>3.0.10</fixVersion>
                    <fixVersion>3.10</fixVersion>
                                    <component>Legacy/Testing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15486465" author="stefania" created="Tue, 13 Sep 2016 06:46:48 +0000"  >&lt;p&gt;The test failed because the new sstable files and txn log file did not exist. It&apos;s as if we could not read the first corrupt record and the transaction cleanup carried on. My guess is that in very rare cases a Java process may not read back the file contents that it just wrote to disk, even if it&apos;s the same thread. If so, we should be able to fix this by syncing the directory.&lt;/p&gt;

&lt;p&gt;I&apos;m multiplexing &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-testall-multiplex/20/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; to see if we can reproduce this.&lt;/p&gt;</comment>
                            <comment id="15489199" author="stefania" created="Wed, 14 Sep 2016 03:00:49 +0000"  >&lt;p&gt;The 3.9 multiplex &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-testall-multiplex/20/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;run&lt;/a&gt; produced 3 failures, 2 of which identical to this failure and one very similar. However, the 3.0 &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-testall-multiplex/21/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;run&lt;/a&gt; did not produce any failures.&lt;/p&gt;

&lt;p&gt;I&apos;m multiplexing the 3.9 &lt;a href=&quot;https://github.com/stef1927/cassandra/commits/12632-3.9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt; &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-testall-multiplex/23/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;. I&apos;ve also fixed some leaks.&lt;/p&gt;</comment>
                            <comment id="15489495" author="stefania" created="Wed, 14 Sep 2016 05:41:20 +0000"  >&lt;p&gt;Multiplex &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-testall-multiplex/23/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;run&lt;/a&gt; on 3.9 with the patch applied was successful.&lt;/p&gt;

&lt;p&gt;I propose to apply this &lt;a href=&quot;https://github.com/stef1927/cassandra/commits/12632-3.9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;, which involves a change only to &lt;tt&gt;LogTransactionTest&lt;/tt&gt;, to 3.0 and trunk.&lt;/p&gt;</comment>
                            <comment id="15526625" author="appodictic" created="Tue, 27 Sep 2016 16:18:43 +0000"  >&lt;p&gt;+1 non binding. Question I notice several tests in this class that open a tidier but do not clean it. In what particular cases is it needed vs not? Should this be worked into a @before or @after annotation ?&lt;/p&gt;</comment>
                            <comment id="15528308" author="stefania" created="Wed, 28 Sep 2016 04:05:17 +0000"  >&lt;p&gt;Thanks for the review! &lt;/p&gt;

&lt;p&gt;The tidiers contain a reference to the parent transaction, and what matters is for this reference to be released. This is done either by calling &lt;tt&gt;run()&lt;/tt&gt; or &lt;tt&gt;abort()&lt;/tt&gt; on the tidiers. So either we call one of these methods, or we pass the tidier to &lt;tt&gt;SSTableReader.markObsolete()&lt;/tt&gt;, which takes care of calling &lt;tt&gt;run()&lt;/tt&gt; when the sstable reference is released. I checked all the calls to &lt;tt&gt;LogTransaction.obsoleted()&lt;/tt&gt; in &lt;tt&gt;LogTransactionTest&lt;/tt&gt;, and it looks good to me, all tidiers are handled by one of the 3 mechanisms just described.&lt;/p&gt;

&lt;p&gt;Unless objections, I&apos;ll consider the non binding +1 a full +1 and commit tomorrow; this patch only modifies a unit test and is border line ninja fix in my opinion.&lt;/p&gt;</comment>
                            <comment id="15531483" author="stefania" created="Thu, 29 Sep 2016 01:31:29 +0000"  >&lt;p&gt;Committed to 3.0 as 5cebd1fb0d60e23ae5a30231e253806d58d0998e and merged into trunk.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[stefania]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 7 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i33jwv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12337344">3.9</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>appodictic</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[appodictic]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>