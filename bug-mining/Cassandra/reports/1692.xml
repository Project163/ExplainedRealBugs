<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:33:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-4420] Possible schema corruption with cql 3.0</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-4420</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;i&apos;ve got some problems while creating schemas with cql 3.0. After that i can&apos;t even start cassandra anymore.&lt;/p&gt;

&lt;p&gt;Following steps for reproduction were done on a new installation of cassandra:&lt;/p&gt;

&lt;p&gt;1. simply create a keyspace test via &quot;cqlsh -3&quot;&lt;/p&gt;

&lt;p&gt;create keyspace test with strategy_class = &apos;SimpleStrategy&apos; and strategy_options:replication_factor = 1;&lt;/p&gt;

&lt;p&gt;2. add cf with composite columns via &quot;cqlsh -3&quot;&lt;/p&gt;

&lt;p&gt;create table test1 (&lt;br/&gt;
    a int,&lt;br/&gt;
    b int,&lt;br/&gt;
    c int,&lt;br/&gt;
    d int,&lt;br/&gt;
    primary key (a, b, c)&lt;br/&gt;
);&lt;/p&gt;

&lt;p&gt;3. drop column family &lt;/p&gt;

&lt;p&gt;drop columnfamily test1;&lt;/p&gt;

&lt;p&gt;So until now everything went fine. Now i&apos;m trying to insert a slightly modified column family with the same name above.&lt;/p&gt;

&lt;p&gt;4. create new cf via &quot;cqlsh -3&quot;&lt;/p&gt;

&lt;p&gt;create table test1 (&lt;br/&gt;
    a int,&lt;br/&gt;
    b int,&lt;br/&gt;
    c int,&lt;br/&gt;
    primary key (a, b)&lt;br/&gt;
);&lt;/p&gt;

&lt;p&gt;This creation fails with following exception:&lt;/p&gt;


&lt;p&gt;java.lang.IndexOutOfBoundsException: Index: 2, Size: 2&lt;br/&gt;
        at java.util.ArrayList.RangeCheck(ArrayList.java:547)&lt;br/&gt;
        at java.util.ArrayList.get(ArrayList.java:322)&lt;br/&gt;
        at org.apache.cassandra.config.CFMetaData.getColumnDefinitionComparator(CFMetaData.java:1280)&lt;br/&gt;
        at org.apache.cassandra.config.ColumnDefinition.fromSchema(ColumnDefinition.java:256)&lt;br/&gt;
        at org.apache.cassandra.config.CFMetaData.addColumnDefinitionSchema(CFMetaData.java:1293)&lt;br/&gt;
        at org.apache.cassandra.config.CFMetaData.fromSchema(CFMetaData.java:1225)&lt;br/&gt;
        at org.apache.cassandra.config.KSMetaData.deserializeColumnFamilies(KSMetaData.java:294)&lt;br/&gt;
        at org.apache.cassandra.config.KSMetaData.fromSchema(KSMetaData.java:275)&lt;br/&gt;
        at org.apache.cassandra.db.DefsTable.loadFromTable(DefsTable.java:158)&lt;br/&gt;
        at org.apache.cassandra.config.DatabaseDescriptor.loadSchemas(DatabaseDescriptor.java:535)&lt;br/&gt;
        at org.apache.cassandra.service.AbstractCassandraDaemon.setup(AbstractCassandraDaemon.java:182)&lt;br/&gt;
        at org.apache.cassandra.service.AbstractCassandraDaemon.activate(AbstractCassandraDaemon.java:353)&lt;br/&gt;
        at org.apache.cassandra.thrift.CassandraDaemon.main(CassandraDaemon.java:106)&lt;/p&gt;


&lt;p&gt;Now at this point you can&apos;t do anything anymore via cql or cli. Shutting down and starting cassandra again throws same exceptions:&lt;/p&gt;


&lt;p&gt;ERROR 14:48:41,705 Exception encountered during startup&lt;br/&gt;
java.lang.IndexOutOfBoundsException: Index: 2, Size: 2&lt;br/&gt;
	at java.util.ArrayList.RangeCheck(ArrayList.java:547)&lt;br/&gt;
	at java.util.ArrayList.get(ArrayList.java:322)&lt;br/&gt;
	at org.apache.cassandra.config.CFMetaData.getColumnDefinitionComparator(CFMetaData.java:1280)&lt;br/&gt;
	at org.apache.cassandra.config.ColumnDefinition.fromSchema(ColumnDefinition.java:256)&lt;br/&gt;
	at org.apache.cassandra.config.CFMetaData.addColumnDefinitionSchema(CFMetaData.java:1293)&lt;br/&gt;
	at org.apache.cassandra.config.CFMetaData.fromSchema(CFMetaData.java:1225)&lt;br/&gt;
	at org.apache.cassandra.config.KSMetaData.deserializeColumnFamilies(KSMetaData.java:294)&lt;br/&gt;
	at org.apache.cassandra.config.KSMetaData.fromSchema(KSMetaData.java:275)&lt;br/&gt;
	at org.apache.cassandra.db.DefsTable.loadFromTable(DefsTable.java:158)&lt;br/&gt;
	at org.apache.cassandra.config.DatabaseDescriptor.loadSchemas(DatabaseDescriptor.java:535)&lt;br/&gt;
	at org.apache.cassandra.service.AbstractCassandraDaemon.setup(AbstractCassandraDaemon.java:182)&lt;br/&gt;
	at org.apache.cassandra.service.AbstractCassandraDaemon.activate(AbstractCassandraDaemon.java:353)&lt;br/&gt;
	at org.apache.cassandra.thrift.CassandraDaemon.main(CassandraDaemon.java:106)&lt;br/&gt;
java.lang.IndexOutOfBoundsException: Index: 2, Size: 2Exception encountered during startup: Index: 2, Size: 2&lt;/p&gt;

&lt;p&gt;	at java.util.ArrayList.RangeCheck(ArrayList.java:547)&lt;br/&gt;
	at java.util.ArrayList.get(ArrayList.java:322)&lt;br/&gt;
	at org.apache.cassandra.config.CFMetaData.getColumnDefinitionComparator(CFMetaData.java:1280)&lt;br/&gt;
	at org.apache.cassandra.config.ColumnDefinition.fromSchema(ColumnDefinition.java:256)&lt;br/&gt;
	at org.apache.cassandra.config.CFMetaData.addColumnDefinitionSchema(CFMetaData.java:1293)&lt;br/&gt;
	at org.apache.cassandra.config.CFMetaData.fromSchema(CFMetaData.java:1225)&lt;br/&gt;
	at org.apache.cassandra.config.KSMetaData.deserializeColumnFamilies(KSMetaData.java:294)&lt;br/&gt;
	at org.apache.cassandra.config.KSMetaData.fromSchema(KSMetaData.java:275)&lt;br/&gt;
	at org.apache.cassandra.db.DefsTable.loadFromTable(DefsTable.java:158)&lt;br/&gt;
	at org.apache.cassandra.config.DatabaseDescriptor.loadSchemas(DatabaseDescriptor.java:535)&lt;br/&gt;
	at org.apache.cassandra.service.AbstractCassandraDaemon.setup(AbstractCassandraDaemon.java:182)&lt;br/&gt;
	at org.apache.cassandra.service.AbstractCassandraDaemon.activate(AbstractCassandraDaemon.java:353)&lt;br/&gt;
	at org.apache.cassandra.thrift.CassandraDaemon.main(CassandraDaemon.java:106)&lt;/p&gt;


&lt;p&gt;Actually it&apos;s the result of a slightly different problem in combination with composite columns, but i will describe this later.&lt;/p&gt;

&lt;p&gt;I&apos;ve got no idea, what the problem is, there might be some corruption in table schemas, even after dropping tables.&lt;/p&gt;

&lt;p&gt;I have to delete cassandra data in order to get cassandra running again.&lt;/p&gt;

&lt;p&gt;Best Regards &lt;/p&gt;

&lt;p&gt;Bert Passek&lt;/p&gt;</description>
                <environment>&lt;p&gt;Lenny Squeeze&lt;/p&gt;</environment>
        <key id="12597764">CASSANDRA-4420</key>
            <summary>Possible schema corruption with cql 3.0</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="xedin">Pavel Yaskevich</assignee>
                                    <reporter username="bertpassek">bert Passek</reporter>
                        <labels>
                    </labels>
                <created>Fri, 6 Jul 2012 12:53:44 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:31 +0000</updated>
                            <resolved>Sun, 8 Jul 2012 11:11:43 +0000</resolved>
                                        <fixVersion>1.1.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13408697" author="xedin" created="Sat, 7 Jul 2012 15:58:40 +0000"  >&lt;p&gt;DROP TABLE wasn&apos;t deleting &quot;component_index&quot; column.&lt;/p&gt;</comment>
                            <comment id="13408836" author="jbellis" created="Sun, 8 Jul 2012 02:46:41 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13408895" author="xedin" created="Sun, 8 Jul 2012 11:11:43 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12535534" name="CASSANDRA-4420.patch" size="1055" author="xedin" created="Sat, 7 Jul 2012 15:58:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[xedin]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>256142</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 20 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gvo7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>96561</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>