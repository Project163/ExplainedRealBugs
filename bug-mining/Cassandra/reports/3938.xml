<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:59:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-10027] ALTER TABLE TYPE check broken</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-10027</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I stumbled onto the fact that 2.2.0 will allow you to ALTER TYPE of a &lt;tt&gt;varint&lt;/tt&gt; to the new &lt;tt&gt;date&lt;/tt&gt; type.  I thought that was an odd conversion to allow, so I attempted to query it.  I received an error on all subsequent queries, unless I exited or truncated the table.&lt;/p&gt;

&lt;p&gt;After truncating, I could then INSERT and query as normal.  But the new &lt;tt&gt;varint&lt;/tt&gt; values inserted simply were reflected as an offset of the minimum &lt;tt&gt;varint&lt;/tt&gt; value.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure why that&apos;s happening, but if we could simply prevent type conversion between &lt;tt&gt;varint&lt;/tt&gt; and &lt;tt&gt;date&lt;/tt&gt; (and just show the &quot;types are incompatible&quot; message) that should fix this.&lt;/p&gt;

&lt;p&gt;Steps to reproduce:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;aploetz@cqlsh:typeconversion&amp;gt; CREATE TABLE varinttest (key &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; PRIMARY KEY, c1 varint);
aploetz@cqlsh:typeconversion&amp;gt; INSERT INTO varinttest (key, c1) VALUES (1,1);
aploetz@cqlsh:typeconversion&amp;gt; SELECT * FROM varinttest ;

 key | c1
-----+----
   1 |  1

(1 rows)
aploetz@cqlsh:typeconversion&amp;gt; ALTER TABLE varinttest ALTER c1 TYPE date;
aploetz@cqlsh:typeconversion&amp;gt; SELECT * FROM varinttest ;
Traceback (most recent call last):
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/bin/cqlsh.py&quot;&lt;/span&gt;, line 1150, in perform_simple_statement
    rows = &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt;.result(self.session.default_timeout)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/share/cassandra/lib/cassandra-driver-internal-only-2.6.0c2.post.zip/cassandra-driver-2.6.0c2.post/cassandra/cluster.py&quot;&lt;/span&gt;, line 3296, in result
    raise self._final_exception
error: unpack requires a string argument of length 4

aploetz@cqlsh:typeconversion&amp;gt; SELECT * FROM varinttest ;
NoHostAvailable: (&lt;span class=&quot;code-quote&quot;&gt;&apos;Unable to complete the operation against any hosts&apos;&lt;/span&gt;, {&amp;lt;Host: 127.0.0.1 PloetzLabs&amp;gt;: ConnectionShutdown(&lt;span class=&quot;code-quote&quot;&gt;&apos;Connection to 127.0.0.1 is defunct&apos;&lt;/span&gt;,)})
aploetz@cqlsh:typeconversion&amp;gt; TRUNCATE varinttest ;
aploetz@cqlsh:typeconversion&amp;gt; SELECT * FROM varinttest ;

 key | c1
-----+----

(0 rows)
aploetz@cqlsh:typeconversion&amp;gt; INSERT INTO varinttest (key, c1) VALUES (1,1);
aploetz@cqlsh:typeconversion&amp;gt; INSERT INTO varinttest (key, c1) VALUES (2,2);
aploetz@cqlsh:typeconversion&amp;gt; INSERT INTO varinttest (key, c1) VALUES (3,3);
aploetz@cqlsh:typeconversion&amp;gt; SELECT * FROM varinttest ;

 key | c1
-----+-------------
   1 | -2147483647
   2 | -2147483646
   3 | -2147483645

(3 rows)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12853695">CASSANDRA-10027</key>
            <summary>ALTER TABLE TYPE check broken</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="blerer">Benjamin Lerer</assignee>
                                    <reporter username="aploetz">Aaron Ploetz</reporter>
                        <labels>
                    </labels>
                <created>Sun, 9 Aug 2015 15:20:28 +0000</created>
                <updated>Wed, 15 Oct 2025 09:49:02 +0000</updated>
                            <resolved>Thu, 12 Nov 2015 20:20:06 +0000</resolved>
                                        <fixVersion>2.2.4</fixVersion>
                    <fixVersion>3.0.1</fixVersion>
                    <fixVersion>3.1</fixVersion>
                                    <component>Legacy/CQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14679183" author="snazy" created="Sun, 9 Aug 2015 15:50:37 +0000"  >&lt;p&gt;This seems to be a regression caused by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6766&quot; title=&quot;allow now() -&amp;gt; uuid compatibility&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6766&quot;&gt;&lt;del&gt;CASSANDRA-6766&lt;/del&gt;&lt;/a&gt; since 2.0.9.&lt;br/&gt;
&lt;tt&gt;ALTER TABLE tab ALTER col&lt;/tt&gt; uses &lt;tt&gt;AbstractType.isValueCompatibleWith(AbstractType)&lt;/tt&gt; to check for compatibility.&lt;/p&gt;</comment>
                            <comment id="14996285" author="blerer" created="Mon, 9 Nov 2015 09:53:37 +0000"  >&lt;p&gt;The problem has been introduced when the &lt;tt&gt;SimpleDateType&lt;/tt&gt; was created.&lt;/p&gt;

&lt;p&gt;The &lt;tt&gt;date&lt;/tt&gt; type should be compatible with the &lt;tt&gt;int&lt;/tt&gt; type and not with the &lt;tt&gt;varint&lt;/tt&gt; type.&lt;/p&gt;

&lt;p&gt;The error was probably caused by the fact that internally the class representing the &lt;tt&gt;int&lt;/tt&gt; type is the &lt;tt&gt;Int32Type&lt;/tt&gt; and not the &lt;tt&gt;IntegerType&lt;/tt&gt;, while the &lt;tt&gt;bigint&lt;/tt&gt; type is represented by the &lt;tt&gt;LongType&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;The patch makes sure that the proper type is used and add some unit tests to check the proper behavior.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;The unit tests results for 2.2 are &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-10027-2.2-testall/1/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;The dtests results for 2.2 are &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-10027-2.2-dtest/1/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;The unit tests results for 3.0 are &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-10027-3.0-testall/2/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;The dtests results for 3.0 are &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-10027-3.0-dtest/4/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15002653" author="jmckenzie" created="Thu, 12 Nov 2015 18:59:23 +0000"  >&lt;p&gt;+1.&lt;/p&gt;

&lt;p&gt;Note: the patch you attached to this ticket is not for this ticket; dug around in your repo and reviewed based on the branch your tests are based off of.&lt;/p&gt;

&lt;p&gt;We&apos;ll handle other potential bugs of this nature, as well as other bugs with conversion, in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10311&quot; title=&quot;AbstractType value compatibility checks are broken for some of the implementations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10311&quot;&gt;&lt;del&gt;CASSANDRA-10311&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15002744" author="blerer" created="Thu, 12 Nov 2015 19:38:20 +0000"  >&lt;p&gt;Sorry, I attached the good patch.&lt;br/&gt;
Thanks for the review.&lt;/p&gt;</comment>
                            <comment id="15002844" author="blerer" created="Thu, 12 Nov 2015 20:19:27 +0000"  >&lt;p&gt;Committed in 2.2 at b05fe4ffee8f1c457a79013c2ddc88abcdadc6bb and merged into 3.0, 3.1 and trunk&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12863679">CASSANDRA-10311</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12726245">CASSANDRA-7523</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12772033" name="10027-2.2.txt" size="2741" author="blerer" created="Thu, 12 Nov 2015 19:37:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blerer]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 1 week, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2iibr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12332983">2.2.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>joshuamckenzie</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[joshuamckenzie]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>