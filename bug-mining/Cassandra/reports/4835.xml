<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:08:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-13594] Use an ExecutorService for repair commands instead of new Thread(..).start()</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-13594</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Currently when starting a new repair, we create a new Thread and start it immediately&lt;/p&gt;

&lt;p&gt;It would be nice to be able to 1) limit the number of threads and 2) reject starting new repair commands if we are already running too many.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13079386">CASSANDRA-13594</key>
            <summary>Use an ExecutorService for repair commands instead of new Thread(..).start()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="marcuse">Marcus Eriksson</assignee>
                                    <reporter username="marcuse">Marcus Eriksson</reporter>
                        <labels>
                    </labels>
                <created>Tue, 13 Jun 2017 06:23:12 +0000</created>
                <updated>Fri, 15 May 2020 08:01:56 +0000</updated>
                            <resolved>Mon, 14 Aug 2017 12:16:14 +0000</resolved>
                                        <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16047485" author="krummas" created="Tue, 13 Jun 2017 06:23:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/krummas/cassandra/commits/marcuse/limit_repair_command_threads&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/krummas/cassandra/commits/marcuse/limit_repair_command_threads&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;introduces 2 new config variables:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;repair_command_pool_size&lt;/tt&gt; - how many repair commands can we run at the same time&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;repair_command_pool_full_strategy&lt;/tt&gt; what do we do when the pool is full (&lt;tt&gt;queue&lt;/tt&gt; or &lt;tt&gt;reject&lt;/tt&gt;)&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16075507" author="aweisberg" created="Wed, 5 Jul 2017 22:05:07 +0000"  >&lt;p&gt;I think it&apos;s pretty unlikely there is a test dependency on repair command concurrency, but but maybe run the dtests just to be safe?&lt;/p&gt;

&lt;p&gt;The code itself looks good.&lt;/p&gt;</comment>
                            <comment id="16076012" author="krummas" created="Thu, 6 Jul 2017 06:34:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/119/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/119/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16076988" author="aweisberg" created="Thu, 6 Jul 2017 18:01:59 +0000"  >&lt;p&gt;Maybe a legit failure? &lt;br/&gt;
&lt;tt&gt;thread_count_repair_test (repair_tests.repair_test.TestRepair) ... Build timed out (after 20 minutes). Marking the build as aborted.&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="16077844" author="krummas" created="Fri, 7 Jul 2017 09:05:57 +0000"  >&lt;p&gt;Yes, it is&lt;/p&gt;

&lt;p&gt;Since we are reusing threads in the ExecutorService we need to clear out the tracing state between runs, I have pushed a commit that does that and restarted the dtests.&lt;/p&gt;</comment>
                            <comment id="16095030" author="aweisberg" created="Thu, 20 Jul 2017 17:23:11 +0000"  >&lt;p&gt;The dtest you started has almost certainly been aged out. &lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/145/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/145/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I think we need to set up archiving of information from Apache Jenkins since they are throwing away everything after a mere 10 builds.&lt;/p&gt;</comment>
                            <comment id="16118249" author="krummas" created="Tue, 8 Aug 2017 12:02:30 +0000"  >&lt;p&gt;Still trying to get dtests to run successfully, they seem quite broken right now&lt;/p&gt;</comment>
                            <comment id="16118439" author="aweisberg" created="Tue, 8 Aug 2017 15:07:13 +0000"  >&lt;p&gt;I&apos;ve noticed that short_read test seems to time out quite a bit. I&apos;ll run it locally a bit and see if it reproduces. I think I did before with no luck. This issue might only appear in Apache Jenkins.&lt;/p&gt;</comment>
                            <comment id="16123276" author="krummas" created="Fri, 11 Aug 2017 12:34:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/170/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/170/&lt;/a&gt; (&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12881450/12881450_13594.png&quot; title=&quot;13594.png attached to CASSANDRA-13594&quot;&gt;13594.png&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;)&lt;/p&gt;</comment>
                            <comment id="16123748" author="aweisberg" created="Fri, 11 Aug 2017 17:59:04 +0000"  >&lt;p&gt;Unrelated but I did manage to reproduce short_read_test failing after letting it run a lot of times.&lt;/p&gt;</comment>
                            <comment id="16125596" author="krummas" created="Mon, 14 Aug 2017 12:16:14 +0000"  >&lt;p&gt;Committed, thanks&lt;/p&gt;</comment>
                            <comment id="16127479" author="jkni" created="Tue, 15 Aug 2017 16:27:44 +0000"  >&lt;p&gt;This causes a test failure in &lt;tt&gt;DatabaseDescriptorRefTest&lt;/tt&gt; because of the new Config class - I&apos;ve pushed a fix &lt;a href=&quot;https://github.com/jkni/cassandra/commit/ec3e7a84e5bae4b6968ee39a39f331fe0f5dd036&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16127490" author="krummas" created="Tue, 15 Aug 2017 16:33:11 +0000"  >&lt;p&gt;+1, sorry about that, again...&lt;/p&gt;</comment>
                            <comment id="16127540" author="jkni" created="Tue, 15 Aug 2017 17:07:45 +0000"  >&lt;p&gt;No problem - fix committed as &lt;tt&gt;256a74faa31fcf25bdae753c563fa2c69f7f355c&lt;/tt&gt;. Thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12881450" name="13594.png" size="172340" author="marcuse" created="Fri, 11 Aug 2017 12:32:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 14 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3g74v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aweisberg</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aweisberg]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>