<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:17:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-15949] NPE thrown while updating speculative execution time if table is removed during task execution</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-15949</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14338&quot; title=&quot;Fix scheduling of speculative retry threshold recalculation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14338&quot;&gt;&lt;del&gt;CASSANDRA-14338&lt;/del&gt;&lt;/a&gt; fixed the scheduling the speculation retry threshold calculation, but if the task happens to be scheduled while a table is being dropped, it triggers an NPE. &lt;/p&gt;


&lt;p&gt;ERROR 2020-07-14T11:34:55,762 &lt;span class=&quot;error&quot;&gt;&amp;#91;OptionalTasks:1&amp;#93;&lt;/span&gt; org.apache.cassandra.service.CassandraDaemon:446 - Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;OptionalTasks:1,5,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.NullPointerException: null&lt;br/&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;at org.apache.cassandra.db.Keyspace.initCf(Keyspace.java:444) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;cassandra-4.0.0.jar:4.0.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;at org.apache.cassandra.db.Keyspace.&amp;lt;init&amp;gt;(Keyspace.java:346) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;cassandra-4.0.0.jar:4.0.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;at org.apache.cassandra.db.Keyspace.open(Keyspace.java:139) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;cassandra-4.0.0.jar:4.0.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;at org.apache.cassandra.db.Keyspace.open(Keyspace.java:116) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;cassandra-4.0.0.jar:4.0.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;at org.apache.cassandra.db.Keyspace$1.apply(Keyspace.java:102) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;cassandra-4.0.0.jar:4.0.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;at org.apache.cassandra.db.Keyspace$1.apply(Keyspace.java:99) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;cassandra-4.0.0.jar:4.0.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;at com.google.common.collect.Iterables$5.lambda$forEach$0(Iterables.java:704) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;guava-27.0-jre.jar:?&amp;#93;&lt;/span&gt;&lt;br/&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;at com.google.common.collect.IndexedImmutableSet.forEach(IndexedImmutableSet.java:45) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;guava-27.0-jre.jar:?&amp;#93;&lt;/span&gt;&lt;br/&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;at com.google.common.collect.Iterables$5.forEach(Iterables.java:704) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;guava-27.0-jre.jar:?&amp;#93;&lt;/span&gt;&lt;br/&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;at org.apache.cassandra.service.CassandraDaemon.lambda$setup$2(CassandraDaemon.java:412) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;cassandra-4.0.0.jar:4.0.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;at org.apache.cassandra.concurrent.DebuggableScheduledThreadPoolExecutor$UncomplainingRunnable.run(DebuggableScheduledThreadPoolExecutor.java:118) &lt;span class=&quot;error&quot;&gt;&amp;#91;cassandra-4.0.0.jar:4.0.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515) &lt;span class=&quot;error&quot;&gt;&amp;#91;?:?&amp;#93;&lt;/span&gt;&lt;br/&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:305) &lt;span class=&quot;error&quot;&gt;&amp;#91;?:?&amp;#93;&lt;/span&gt;&lt;br/&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:305) &lt;span class=&quot;error&quot;&gt;&amp;#91;?:?&amp;#93;&lt;/span&gt;&lt;br/&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) &lt;span class=&quot;error&quot;&gt;&amp;#91;?:?&amp;#93;&lt;/span&gt;&lt;br/&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) &lt;span class=&quot;error&quot;&gt;&amp;#91;?:?&amp;#93;&lt;/span&gt;&lt;br/&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) &lt;span class=&quot;error&quot;&gt;&amp;#91;netty-all-4.1.37.Final.jar:4.1.37.Final&amp;#93;&lt;/span&gt;&lt;br/&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;at java.lang.Thread.run(Thread.java:834) &lt;span class=&quot;error&quot;&gt;&amp;#91;?:?&amp;#93;&lt;/span&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13317016">CASSANDRA-15949</key>
            <summary>NPE thrown while updating speculative execution time if table is removed during task execution</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="maedhroz">Caleb Rackliffe</assignee>
                                    <reporter username="jmeredithco">Jon Meredith</reporter>
                        <labels>
                    </labels>
                <created>Wed, 15 Jul 2020 20:06:39 +0000</created>
                <updated>Wed, 16 Mar 2022 14:14:01 +0000</updated>
                            <resolved>Wed, 16 Sep 2020 20:44:59 +0000</resolved>
                                        <fixVersion>4.0-beta3</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Local/Other</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="7800">2h 10m</timespent>
                                <comments>
                            <comment id="17158688" author="jmeredithco" created="Wed, 15 Jul 2020 20:18:58 +0000"  >&lt;p&gt;Marked this as a degradation as from&#160;&lt;a href=&quot;https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ScheduledThreadPoolExecutor.html#scheduleAtFixedRate-java.lang.Runnable-long-long-java.util.concurrent.TimeUnit-&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ScheduledThreadPoolExecutor.html#scheduleAtFixedRate-java.lang.Runnable-long-long-java.util.concurrent.TimeUnit-&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&quot;If any execution of the task encounters an exception, subsequent executions are suppressed&quot;&lt;/p&gt;

&lt;p&gt;So if this hits while a table is being dropped,&#160;recomputation of speculative retry thresholds will halt node-wide.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17190424" author="maedhroz" created="Thu, 3 Sep 2020 22:55:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jmeredithco&quot; class=&quot;user-hover&quot; rel=&quot;jmeredithco&quot;&gt;jmeredithco&lt;/a&gt; Took a quick look, and it seems like this is nominally a consequence of &lt;tt&gt;Schema#keyspaces&lt;/tt&gt; and &lt;tt&gt;Schema#metadataRefs&lt;/tt&gt; not really being synchronized in any way. (i.e. The &lt;tt&gt;Keyspace&lt;/tt&gt; constructor finds &lt;tt&gt;TableMetadata&lt;/tt&gt;, but there is no &lt;tt&gt;TableMetadataRef&lt;/tt&gt; present by the time we need to pass it to &lt;tt&gt;initCf()&lt;/tt&gt;). My first instinct is to do two things:&lt;/p&gt;

&lt;p&gt;1.) Catch and log at WARN all exceptions from anywhere in the recomputation task rather than halting node-wide.&lt;br/&gt;
2.) Apprehend null &lt;tt&gt;TableMetadataRef&lt;/tt&gt; references in the &lt;tt&gt;Keyspace&lt;/tt&gt; constructor and log at INFO to avoid stopping progress even within a particular recomputation task for something transient like this.&lt;/p&gt;

&lt;p&gt;I&apos;ll work out a test that hits the original error and push up a patch w/ the above shortly...&lt;/p&gt;</comment>
                            <comment id="17190427" author="maedhroz" created="Thu, 3 Sep 2020 23:26:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/pull/733&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt; &lt;a href=&quot;https://app.circleci.com/pipelines/github/maedhroz/cassandra/105/workflows/36eededa-b5bc-4ecc-b3fa-592f12109884&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j8 tests&lt;/a&gt; &lt;a href=&quot;https://app.circleci.com/pipelines/github/maedhroz/cassandra/105/workflows/940fb0c2-7881-40fa-9daa-dc29859d27ec&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j11 tests&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;UPDATE: Tests are clean outside a couple already identified as flaky.&lt;/p&gt;</comment>
                            <comment id="17193979" author="maedhroz" created="Fri, 11 Sep 2020 04:04:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dcapwell&quot; class=&quot;user-hover&quot; rel=&quot;dcapwell&quot;&gt;dcapwell&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jmeredithco&quot; class=&quot;user-hover&quot; rel=&quot;jmeredithco&quot;&gt;jmeredithco&lt;/a&gt; I think I can see a sequence that produces the error above now. Here goes...&lt;/p&gt;

&lt;p&gt;1.) We drop a keyspace, which hits &lt;tt&gt;Schema#dropKeyspace()&lt;/tt&gt;.&lt;br/&gt;
2.) This winds around a bit, but finally clears the keyspace name from the &lt;tt&gt;keyspaceInstances&lt;/tt&gt; field of &lt;tt&gt;Schema&lt;/tt&gt;. However, the &lt;tt&gt;keyspaces&lt;/tt&gt; field still thinks the keyspace is present right before &lt;tt&gt;dropKeyspace()&lt;/tt&gt; proceeds to &lt;tt&gt;unload()&lt;/tt&gt;.&lt;br/&gt;
3.) At this point, the speculative retry threshold task decides it&apos;s a good time to run. It hits &lt;tt&gt;Keyspace.open()&lt;/tt&gt; and sees that, according to &lt;tt&gt;Schema#getKeyspaceInstance()&lt;/tt&gt;, the keyspace doesn&apos;t exist!&lt;br/&gt;
4.) We move into the &lt;tt&gt;Keyspace&lt;/tt&gt; constructor just in time to get a reference to a &lt;tt&gt;KeyspaceMetadata&lt;/tt&gt; from &lt;tt&gt;keyspaces&lt;/tt&gt; in &lt;tt&gt;Schema&lt;/tt&gt; that thinks the table in question still exists.&lt;br/&gt;
5.) Immediately after this happens, the original thread continues into &lt;tt&gt;unload()&lt;/tt&gt; and drops the hammer on everything, including &lt;tt&gt;metadataRefs&lt;/tt&gt;.&lt;br/&gt;
6.) The task thread wakes up and proceeds in the &lt;tt&gt;Keyspace&lt;/tt&gt; constructor to try to get a &lt;tt&gt;TableMetadataRef&lt;/tt&gt;, but of course, it&apos;s gone.&lt;/p&gt;

&lt;p&gt;If the sequence above is coherent, I think it means the &lt;a href=&quot;https://github.com/apache/cassandra/pull/733/files&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;current patch&lt;/a&gt; is at least an improvement, given it stops the &lt;tt&gt;Keyspace&lt;/tt&gt; constructor before it proceeds to &lt;tt&gt;initCf&lt;/tt&gt; and doesn&apos;t kill all future executions of the threshold update task in addition. My only concern is that we might still be able to hit &lt;tt&gt;initCf()&lt;/tt&gt; if we get a &lt;tt&gt;TableMetadataRef&lt;/tt&gt; &lt;em&gt;just&lt;/em&gt; before &lt;tt&gt;unload()&lt;/tt&gt; blows it away, which seems like it would create a new &lt;tt&gt;ColumnFamilyStore&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;So na&#239;ve question...why do we allow the speculative retry threshold updater task to create keyspaces at all, ever? It seems like we could approach this an entirely different way...by just having something like &lt;tt&gt;Keyspace.allExisting()&lt;/tt&gt; that just uses the non-null results of &lt;tt&gt;Schema#getKeyspaceInstance()&lt;/tt&gt; instead of &lt;tt&gt;Keyspace.open()&lt;/tt&gt;. Even if one of those instances is in the process of being removed, updating the thresholds on a doomed CFS is harmless. (Also, we can avoid a new esoteric bit of logging trying to explain how our schema updates work.)&lt;/p&gt;</comment>
                            <comment id="17194283" author="jmeredithco" created="Fri, 11 Sep 2020 14:09:37 +0000"  >&lt;p&gt;I like the `allExisting()` approach and agree updating thresholds in doomed CFS is harmless as long as there aren&apos;t issues relating to them being shutdown (the table metadata being invalid). I&apos;m not sure where the best point to actually iterate-over-metadata-of-all-loaded-CFS-without-loading-ever with the &lt;tt&gt;updateSpeculationThreshold function&lt;/tt&gt; which is what we really want to do. It&apos;s also not the end of the world to miss it as a keyspace is loading as it will be updated next time (as long as this doesn&apos;t crash updating of course).&lt;/p&gt;</comment>
                            <comment id="17194401" author="maedhroz" created="Fri, 11 Sep 2020 16:54:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jmeredithco&quot; class=&quot;user-hover&quot; rel=&quot;jmeredithco&quot;&gt;jmeredithco&lt;/a&gt; I&apos;ve taken both the testability ideas from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dcapwell&quot; class=&quot;user-hover&quot; rel=&quot;dcapwell&quot;&gt;dcapwell&lt;/a&gt; and the &quot;only run the update task on existing keyspaces&quot; approach and worked them into the patch, which is now &lt;a href=&quot;https://app.circleci.com/pipelines/github/maedhroz/cassandra?branch=CASSANDRA-15949&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;running through&lt;/a&gt; the tests again. Let me know what you think...&lt;/p&gt;</comment>
                            <comment id="17194454" author="dcapwell" created="Fri, 11 Sep 2020 17:25:19 +0000"  >&lt;p&gt;allExisting sounds better in this case, but if what you mentioned is true then we may have other race condition bugs (a lot of places use Keyspace.open) where a dropped keyspace comes back to life, which would impact metrics and would cause the cached Keyspace to have incorrect meta (org.apache.cassandra.schema.Schema#loadNew doesn&apos;t update meta)...&lt;/p&gt;</comment>
                            <comment id="17194468" author="dcapwell" created="Fri, 11 Sep 2020 17:53:09 +0000"  >&lt;p&gt;Patch looks good to me, it would avoid updater trying to open a keyspace and makes it so the constructor doesn&apos;t fail.  I am wondering though if all should actually be allExisting, so rather than adding a new method we fix this method to avoid the problem?  on-startup and on keyspace create we cache the Keyspace object, so Keyspace.open isn&apos;t actually needed in the majority of cases.&lt;/p&gt;

&lt;p&gt;Given the race above, I still think it may be best if Keyspace.open also locks on Schema so it has a consistent view during the open call and can learn if it still exists (only when the double check locking happens, not in the cache hit case).  &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aleksey&quot; class=&quot;user-hover&quot; rel=&quot;aleksey&quot;&gt;aleksey&lt;/a&gt; it would be great if we could get your feedback as well.&lt;/p&gt;</comment>
                            <comment id="17194544" author="maedhroz" created="Fri, 11 Sep 2020 22:06:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dcapwell&quot; class=&quot;user-hover&quot; rel=&quot;dcapwell&quot;&gt;dcapwell&lt;/a&gt; So just to summarize, the plan would be...&lt;/p&gt;

&lt;p&gt;1.) Remove the synchronization blocks on &lt;tt&gt;Keyspace&lt;/tt&gt;.&lt;br/&gt;
2.) Replace the sync block on &lt;tt&gt;Keyspace&lt;/tt&gt; in &lt;tt&gt;open()&lt;/tt&gt; w/ a sync block on the &lt;tt&gt;Schema&lt;/tt&gt; singleton. (This ensures most access still results in a cache hit.)&lt;br/&gt;
3.) Given it&apos;s no longer possible, remove the check in my patch for a null &lt;tt&gt;TableMetadataRef&lt;/tt&gt; and the logging accompanying it.&lt;/p&gt;

&lt;p&gt;Unless &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aleksey&quot; class=&quot;user-hover&quot; rel=&quot;aleksey&quot;&gt;aleksey&lt;/a&gt; has holes to poke in it, I like it...&lt;/p&gt;

&lt;p&gt;UPDATE: After taking a stab at this,  the &lt;a href=&quot;https://app.circleci.com/pipelines/github/maedhroz/cassandra?branch=CASSANDRA-15949&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;tests&lt;/a&gt; look unremarkable, aside from indicating that we need to rebase on trunk post-&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-15954&quot; title=&quot;When compaction gets interrupted, the exception should include the compactionId&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-15954&quot;&gt;&lt;del&gt;CASSANDRA-15954&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17194545" author="maedhroz" created="Fri, 11 Sep 2020 22:08:04 +0000"  >&lt;blockquote&gt;&lt;p&gt;I am wondering though if all should actually be allExisting, so rather than adding a new method we fix this method to avoid the problem?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It looks like you&apos;re probably right on this one, but given there are a dozen or so places to audit, I lean toward avoiding it in this patch.&lt;/p&gt;</comment>
                            <comment id="17196454" author="iamaleksey" created="Tue, 15 Sep 2020 18:25:30 +0000"  >&lt;p&gt;The PR looks good to me as currently is.&lt;/p&gt;

&lt;p&gt;And I&apos;m sure we have a ton of &lt;tt&gt;Keyspace.open()&lt;/tt&gt; around, all lazy-initializing the keyspaces, where sometimes we don&apos;t mean to do that. Out of scope of this issue, but maybe should indeed be looked into at some point.&lt;/p&gt;</comment>
                            <comment id="17196467" author="iamaleksey" created="Tue, 15 Sep 2020 18:41:08 +0000"  >&lt;p&gt;Relatedly, we might want to audit other similar uses of the executor with tasks not handling exceptions properly.&lt;/p&gt;</comment>
                            <comment id="17196475" author="dcapwell" created="Tue, 15 Sep 2020 18:48:01 +0000"  >&lt;blockquote&gt;&lt;p&gt;but given there are a dozen or so places to audit, I lean toward avoiding it in this patch.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;sounds good to me.&lt;/p&gt;</comment>
                            <comment id="17196535" author="dcapwell" created="Tue, 15 Sep 2020 20:19:09 +0000"  >&lt;p&gt;re-reviewed; with the lock on schema then this LGTM; +1.&lt;/p&gt;</comment>
                            <comment id="17196539" author="maedhroz" created="Tue, 15 Sep 2020 20:24:57 +0000"  >&lt;blockquote&gt;&lt;p&gt;The PR looks good to me as currently is.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aleksey&quot; class=&quot;user-hover&quot; rel=&quot;aleksey&quot;&gt;aleksey&lt;/a&gt; Thanks! Should I consider that a &quot;+1&quot;? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17196918" author="iamaleksey" created="Wed, 16 Sep 2020 11:48:10 +0000"  >&lt;blockquote&gt;&lt;p&gt;Thanks! Should I consider that a &quot;+1&quot;?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Indeed you should (:&lt;/p&gt;</comment>
                            <comment id="17197230" author="dcapwell" created="Wed, 16 Sep 2020 20:44:59 +0000"  >&lt;p&gt;CI results:&lt;br/&gt;
&lt;a href=&quot;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch/20/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch/20/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://app.circleci.com/pipelines/github/dcapwell/cassandra?branch=commit_remote_branch%2FCASSANDRA-15949-trunk-B03EA88E-B95B-40C8-BF76-DA566646C28C&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/dcapwell/cassandra?branch=commit_remote_branch%2FCASSANDRA-15949-trunk-B03EA88E-B95B-40C8-BF76-DA566646C28C&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I don&apos;t have as much history with Jenkins flaky tests, so I went off Circle CI&apos;s results for review.&lt;/p&gt;

&lt;p&gt;Also, Jenkins didn&apos;t have the same commit as circle as I ninja fixed an issue that was on trunk, so jenkins was missing ea322bfaa78b662c95711e6579b480b4d0f741c6&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[maedhroz]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12984" cascade-level=""><![CDATA[Degradation]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12969"><![CDATA[User Report]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 8 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0gsso:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
        <customfieldvalue><![CDATA[dcapwell]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12346093">4.0-alpha</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314136" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12348281">4.0-alpha1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/ca027c3c2262f5a6789dbf41a5656a7bcf02a5f2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/ca027c3c2262f5a6789dbf41a5656a7bcf02a5f2&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;clean Circle run&lt;/li&gt;
	&lt;li&gt;an additional test that provides guardrails around the Keyspace opening process (at least as it&apos;s used by the speculative retry threshold update task)&lt;/li&gt;
&lt;/ul&gt;
</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>