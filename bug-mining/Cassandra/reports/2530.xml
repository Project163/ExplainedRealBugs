<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:42:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6531] Failure to start after unclean shutdown - java.lang.IllegalArgumentException: bufferSize must be positive</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6531</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;We had a severe power outage in the lab that resulted in unclean shutdown of the Cassandra servers. After the power was back I tried to start the cluster. Two out of 6 nodes cannot start because of this exception:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; INFO 20:47:11,003 Initializing system.local
 INFO [main] 2013-12-27 20:47:11,003 ColumnFamilyStore.java (line 251) Initializing system.local
 INFO 20:47:11,006 Opening /hadoop/disk1/cassandra/data/system/local/system-local-jb-2478 (5836 bytes)
 INFO [SSTableBatchOpen:1] 2013-12-27 20:47:11,006 SSTableReader.java (line 223) Opening /hadoop/disk1/cassandra/data/system/local/system-local-jb-2478 (5836 bytes)
 INFO 20:47:11,006 Opening /hadoop/disk4/cassandra/data/system/local/system-local-jb-2479 (144 bytes)
 INFO [SSTableBatchOpen:2] 2013-12-27 20:47:11,006 SSTableReader.java (line 223) Opening /hadoop/disk4/cassandra/data/system/local/system-local-jb-2479 (144 bytes)
ERROR 20:47:12,366 Exception encountered during startup
java.lang.IllegalArgumentException: bufferSize must be positive
        at org.apache.cassandra.io.util.RandomAccessReader.&amp;lt;init&amp;gt;(RandomAccessReader.java:67)
        at org.apache.cassandra.io.compress.CompressedRandomAccessReader.&amp;lt;init&amp;gt;(CompressedRandomAccessReader.java:76)
        at org.apache.cassandra.io.compress.CompressedRandomAccessReader.open(CompressedRandomAccessReader.java:55)
        at org.apache.cassandra.io.sstable.SSTableReader.openDataReader(SSTableReader.java:1363)
        at org.apache.cassandra.io.sstable.SSTableScanner.&amp;lt;init&amp;gt;(SSTableScanner.java:67)
        at org.apache.cassandra.io.sstable.SSTableReader.getScanner(SSTableReader.java:1147)
        at org.apache.cassandra.db.RowIteratorFactory.getIterator(RowIteratorFactory.java:69)
        at org.apache.cassandra.db.ColumnFamilyStore.getSequentialIterator(ColumnFamilyStore.java:1526)
        at org.apache.cassandra.db.ColumnFamilyStore.getRangeSlice(ColumnFamilyStore.java:1645)
        at org.apache.cassandra.db.RangeSliceCommand.executeLocally(RangeSliceCommand.java:137)
        at org.apache.cassandra.cql3.statements.SelectStatement.executeInternal(SelectStatement.java:236)
        at org.apache.cassandra.cql3.statements.SelectStatement.executeInternal(SelectStatement.java:1)
        at org.apache.cassandra.cql3.QueryProcessor.processInternal(QueryProcessor.java:255)
        at org.apache.cassandra.db.SystemKeyspace.getUnfinishedCompactions(SystemKeyspace.java:206)
        at org.apache.cassandra.service.CassandraDaemon.setup(CassandraDaemon.java:261)
        at org.apache.cassandra.service.CassandraDaemon.activate(CassandraDaemon.java:461)
        at org.apache.cassandra.service.CassandraDaemon.main(CassandraDaemon.java:504)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Collecting the logs now, will attach to the issue in a moment. &lt;/p&gt;</description>
                <environment>&lt;p&gt;Cassandra 2.0.3 with patches for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6496&quot; title=&quot;Endless L0 LCS compactions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6496&quot;&gt;&lt;del&gt;CASSANDRA-6496&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6284&quot; title=&quot;Wrong tracking of minLevel in Leveled Compaction Strategy causing serious performance problems&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6284&quot;&gt;&lt;del&gt;CASSANDRA-6284&lt;/del&gt;&lt;/a&gt;, built from source; Linux; XFS on the data disks; 5 data disks; 6 nodes&lt;/p&gt;</environment>
        <key id="12686569">CASSANDRA-6531</key>
            <summary>Failure to start after unclean shutdown - java.lang.IllegalArgumentException: bufferSize must be positive</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="ngrigoriev">Nikolai Grigoriev</reporter>
                        <labels>
                            <label>compression</label>
                    </labels>
                <created>Fri, 27 Dec 2013 20:53:20 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:57 +0000</updated>
                            <resolved>Sat, 28 Dec 2013 06:18:00 +0000</resolved>
                                        <fixVersion>1.2.14</fixVersion>
                    <fixVersion>2.0.5</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13857723" author="ngrigoriev" created="Fri, 27 Dec 2013 20:55:00 +0000"  >&lt;p&gt;system log with default logging levels&lt;/p&gt;</comment>
                            <comment id="13857731" author="ngrigoriev" created="Fri, 27 Dec 2013 21:04:05 +0000"  >&lt;p&gt;Startup log with default logging level set to TRACE (log4j.rootLogger=TRACE,stdout,R). Interestingly enough I do not see the original exception in the log when I change it to TRACE and Cassandra process does not terminate. So I include the thread dump just in case.&lt;/p&gt;</comment>
                            <comment id="13857825" author="jbellis" created="Fri, 27 Dec 2013 23:02:04 +0000"  >&lt;p&gt;Patch to fsync compression metadata on close.  As near as I can tell this is a problem back to the introduction of compression in 1.0 (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-47&quot; title=&quot;SSTable compression&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-47&quot;&gt;&lt;del&gt;CASSANDRA-47&lt;/del&gt;&lt;/a&gt;). /cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xedin&quot; class=&quot;user-hover&quot; rel=&quot;xedin&quot;&gt;xedin&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tjake&quot; class=&quot;user-hover&quot; rel=&quot;tjake&quot;&gt;tjake&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13857851" author="ngrigoriev" created="Sat, 28 Dec 2013 00:03:13 +0000"  >&lt;p&gt;Do I understand correctly that this patch should eliminate/reduce the possibility of this to happen but won&apos;t help to start the node in my case? If so, I am going to try to abuse this JIRA a bit and ask if anyone could recommend a method of bringing this node back to life without wiping it? If such a method exists, of course. Thanks!&lt;/p&gt;</comment>
                            <comment id="13857872" author="jbellis" created="Sat, 28 Dec 2013 00:42:02 +0000"  >&lt;p&gt;The only straightforward approach (i.e.: doesn&apos;t involve writing code to rebuild the corrupt offsets from the data component) is to remove the affected sstables and repair.&lt;/p&gt;</comment>
                            <comment id="13857889" author="xedin" created="Sat, 28 Dec 2013 01:18:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbellis&quot; class=&quot;user-hover&quot; rel=&quot;jbellis&quot;&gt;jbellis&lt;/a&gt; I think we should fsync twice in this case - first time whe the header is finalized and second time on close.&lt;/p&gt;</comment>
                            <comment id="13857910" author="jbellis" created="Sat, 28 Dec 2013 01:51:11 +0000"  >&lt;p&gt;It&apos;s still -tmp at this point so a single sync is sufficient.&lt;/p&gt;</comment>
                            <comment id="13857912" author="ngrigoriev" created="Sat, 28 Dec 2013 02:03:29 +0000"  >&lt;p&gt;I believe the log messages were somewhat misleading. After messing with debug logs for a while I have found that the problem was, apparently, not with system KS. I have removed all stuff &amp;#42;compactions_in_progress&amp;#42; and that helped one of these two nodes in question to start. Another one seems to have an identity crisis as it believes that another node with the same address has already joined the cluster...but that seems to be another story.&lt;/p&gt;</comment>
                            <comment id="13857914" author="xedin" created="Sat, 28 Dec 2013 02:06:08 +0000"  >&lt;p&gt;Ah, I completely forgot about that, sure.&lt;/p&gt;</comment>
                            <comment id="13857953" author="jbellis" created="Sat, 28 Dec 2013 06:18:00 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                            <comment id="13857954" author="jbellis" created="Sat, 28 Dec 2013 06:19:32 +0000"  >&lt;p&gt;(Incidentally, the fix for the compactions in progress bug will be committed soon for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6086&quot; title=&quot;Node refuses to start with exception in ColumnFamilyStore.removeUnfinishedCompactionLeftovers when find that some to be removed files are already removed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6086&quot;&gt;&lt;del&gt;CASSANDRA-6086&lt;/del&gt;&lt;/a&gt;.)&lt;/p&gt;</comment>
                            <comment id="13858053" author="ngrigoriev" created="Sat, 28 Dec 2013 16:25:49 +0000"  >&lt;p&gt;Just one more suggestion for the fix. I think it is important to log the name of the problematic file every time an exception is thrown. This helps to correctly associate the exception with the file. In this case RandomAccessReader.java:67 throws an exception without this information. I have replaced that line with:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalArgumentException(&lt;span class=&quot;code-quote&quot;&gt;&quot;bufferSize must be positive &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; reading &quot;&lt;/span&gt; + file.getAbsolutePath());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13858081" author="mshuler" created="Sat, 28 Dec 2013 17:54:23 +0000"  >&lt;p&gt;committed patch causes:&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/job/cassandra-2.0_test/76/testReport/junit/org.apache.cassandra.io.compress/CompressedRandomAccessReaderTest/testResetAndTruncateCompressed/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/job/cassandra-2.0_test/76/testReport/junit/org.apache.cassandra.io.compress/CompressedRandomAccessReaderTest/testResetAndTruncateCompressed/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13858218" author="jbellis" created="Sun, 29 Dec 2013 02:49:47 +0000"  >&lt;p&gt;Updated close method to be idempotent.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12620674" name="6531.txt" size="1536" author="jbellis" created="Fri, 27 Dec 2013 23:02:04 +0000"/>
                            <attachment id="12620654" name="cassandra_jstack.txt" size="25066" author="ngrigoriev" created="Fri, 27 Dec 2013 21:04:05 +0000"/>
                            <attachment id="12620653" name="system.log.gz" size="11751" author="ngrigoriev" created="Fri, 27 Dec 2013 21:04:05 +0000"/>
                            <attachment id="12620651" name="system.log.gz" size="2866" author="ngrigoriev" created="Fri, 27 Dec 2013 20:55:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>365560</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 47 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1r0hz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>365868</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12325322">2.0.3</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>xedin</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[xedin]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12316349">1.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>