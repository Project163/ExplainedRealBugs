<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:11:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-14170] Loss of digits when doing CAST from varint/bigint to decimal</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-14170</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Cast functions from numeric types to decimal type are implemented as conversion to double first and then from double to decimal: &lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...blerer:10310-3.0#diff-6aa4a8f76df6c30c5bb4026b8c9251eeR80&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/compare/trunk...blerer:10310-3.0#diff-6aa4a8f76df6c30c5bb4026b8c9251eeR80&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;This can cause loss of digits for big values stored in varint or bigint. It is probably unexpected because decimal can store such values precisely.&lt;/p&gt;

&lt;p&gt;Examples:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;cqlsh&amp;gt; CREATE TABLE cast_bigint_test(k int PRIMARY KEY, bigint_clmn bigint);&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;cqlsh&amp;gt; INSERT INTO cast_bigint_test(k, decimal_clmn) VALUES(2, 9223372036854775807);&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;cqlsh&amp;gt; SELECT CAST(bigint_clmn AS decimal) FROM cast_bigint_test;&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;cast(bigint_clmn as decimal)&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;------------------------------&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;9.223372036854776E+18&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;(1 rows)&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;cqlsh&amp;gt; CREATE TABLE cast_varint_test (k int PRIMARY KEY, varint_clmn varint);&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;cqlsh&amp;gt; INSERT INTO cast_varint_test(k, varint_clmn) values(2, 1234567890123456789);&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;cqlsh&amp;gt; SELECT&#160;CAST(varint_clmn AS decimal)&#160;FROM cast_varint_test;&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;cast(varint_clmn as decimal)&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;------------------------------&lt;/tt&gt;&lt;br/&gt;
1.23456789012345677E+18&lt;br/&gt;
 &lt;tt&gt;(1 rows)&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment>&lt;p&gt;Tested with Cassandra 3.11.1 but this issue is present since the implementation of cast functions.&lt;/p&gt;</environment>
        <key id="13131535">CASSANDRA-14170</key>
            <summary>Loss of digits when doing CAST from varint/bigint to decimal</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="blerer">Benjamin Lerer</assignee>
                                    <reporter username="danfiala">Daniel Fiala</reporter>
                        <labels>
                    </labels>
                <created>Wed, 17 Jan 2018 10:22:34 +0000</created>
                <updated>Fri, 15 May 2020 08:00:58 +0000</updated>
                            <resolved>Wed, 14 Mar 2018 09:34:02 +0000</resolved>
                                        <fixVersion>3.11.3</fixVersion>
                    <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Legacy/CQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16365287" author="blerer" created="Thu, 15 Feb 2018 09:29:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=danfiala&quot; class=&quot;user-hover&quot; rel=&quot;danfiala&quot;&gt;danfiala&lt;/a&gt; Thanks for reporting the problem.&lt;/p&gt;

&lt;p&gt;I pushed a branch &lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-3.11...blerer:14170-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; to fix the problem and add some extra tests.&lt;/p&gt;

&lt;p&gt;The patch can be merge without trouble into trunk and the Unit tests runs fine on both branches. We do not have DTests for the &lt;tt&gt;CAST&lt;/tt&gt; operations.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adelapena&quot; class=&quot;user-hover&quot; rel=&quot;adelapena&quot;&gt;adelapena&lt;/a&gt; Could you review?&lt;/p&gt;</comment>
                            <comment id="16386024" author="adelapena" created="Mon, 5 Mar 2018 12:46:28 +0000"  >&lt;p&gt;Overall the patch looks good to me. However, the new test &lt;a href=&quot;https://github.com/blerer/cassandra/blob/4b1f5804837ae3164bb183fcb62077683621651a/test/unit/org/apache/cassandra/cql3/functions/CastFctsTest.java#L205-L212&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;testNoLossOfPrecisionForCastToDecimal&lt;/tt&gt;&lt;/a&gt; misses the &lt;tt&gt;@Test&lt;/tt&gt; annotation. Indeed, it fails due to &lt;a href=&quot;https://github.com/blerer/cassandra/blob/4b1f5804837ae3164bb183fcb62077683621651a/test/unit/org/apache/cassandra/cql3/functions/CastFctsTest.java#L208&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;a column names mismatch at the insert statement&lt;/a&gt;. I think it should be &lt;a href=&quot;https://github.com/adelapena/cassandra/commit/be44415a3f61e13720889cfd44482ee1142e8c1d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this way&lt;/a&gt;. If it&apos;s ok for you it can be addressed during commit.&lt;/p&gt;

&lt;p&gt;Nitpick: there is a misssed blank line in &lt;tt&gt;getDecimalConversionFunction&lt;/tt&gt; JavaDoc, &lt;a href=&quot;https://github.com/adelapena/cassandra/commit/86f8121f95adb60eef85edbcaf9fb3917ef5207f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16398331" author="blerer" created="Wed, 14 Mar 2018 09:33:13 +0000"  >&lt;p&gt;Thanks for picking up my mistakes &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. I was far to quick on that one. &lt;/p&gt;</comment>
                            <comment id="16398332" author="blerer" created="Wed, 14 Mar 2018 09:34:02 +0000"  >&lt;p&gt;Committed into 3.11 at 3fa7c0894449b5c6033a6c4f47ec3292d07268b8 and merged into trunk&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blerer]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 35 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3p073:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>adelapena</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[adelapena]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>