<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:04:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-12127] Queries with empty ByteBuffer values in clustering column restrictions fail for non-composite compact tables</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-12127</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;For the following table:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;CREATE TABLE myTable (pk &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,
                      c blob,
                      value &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,
                      PRIMARY KEY (pk, c)) WITH COMPACT STORAGE;
INSERT INTO myTable (pk, c, value) VALUES (1, textAsBlob(&lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt;), 1);
INSERT INTO myTable (pk, c, value) VALUES (1, textAsBlob(&lt;span class=&quot;code-quote&quot;&gt;&apos;2&apos;&lt;/span&gt;), 2);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The query: &lt;tt&gt;SELECT * FROM myTable WHERE pk = 1 AND c &amp;gt; textAsBlob(&apos;&apos;);&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Will result in the following Exception:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.ClassCastException: org.apache.cassandra.db.composites.Composites$EmptyComposite cannot be &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; to org.apache.cassandra.db.composites.CellName
	at org.apache.cassandra.db.composites.AbstractCellNameType.cellFromByteBuffer(AbstractCellNameType.java:188)
	at org.apache.cassandra.db.composites.AbstractSimpleCellNameType.makeCellName(AbstractSimpleCellNameType.java:125)
	at org.apache.cassandra.db.composites.AbstractCellNameType.makeCellName(AbstractCellNameType.java:254)
	at org.apache.cassandra.cql3.statements.SelectStatement.makeExclusiveSliceBound(SelectStatement.java:1206)
	at org.apache.cassandra.cql3.statements.SelectStatement.applySliceRestriction(SelectStatement.java:1214)
	at org.apache.cassandra.cql3.statements.SelectStatement.processColumnFamily(SelectStatement.java:1292)
	at org.apache.cassandra.cql3.statements.SelectStatement.process(SelectStatement.java:1259)
	at org.apache.cassandra.cql3.statements.SelectStatement.processResults(SelectStatement.java:299)
	[...]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The query: &lt;tt&gt;SELECT * FROM myTable WHERE pk = 1 AND c &amp;lt; textAsBlob(&apos;&apos;);&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Will return 2 rows instead of 0.&lt;/p&gt;

&lt;p&gt;The query: &lt;tt&gt;SELECT * FROM myTable WHERE pk = 1 AND c = textAsBlob(&apos;&apos;);&lt;/tt&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.AssertionError
	at org.apache.cassandra.db.composites.SimpleDenseCellNameType.create(SimpleDenseCellNameType.java:60)
	at org.apache.cassandra.cql3.statements.SelectStatement.addSelectedColumns(SelectStatement.java:853)
	at org.apache.cassandra.cql3.statements.SelectStatement.getRequestedColumns(SelectStatement.java:846)
	at org.apache.cassandra.cql3.statements.SelectStatement.makeFilter(SelectStatement.java:583)
	at org.apache.cassandra.cql3.statements.SelectStatement.getSliceCommands(SelectStatement.java:383)
	at org.apache.cassandra.cql3.statements.SelectStatement.getPageableCommand(SelectStatement.java:253)
	[...]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I checked 2.0 and &lt;tt&gt;SELECT * FROM myTable  WHERE pk = 1 AND c &amp;gt; textAsBlob(&apos;&apos;);&lt;/tt&gt; works properly but &lt;tt&gt;SELECT * FROM myTable WHERE pk = 1 AND c &amp;lt; textAsBlob(&apos;&apos;);&lt;/tt&gt; return the same wrong results than in 2.1.&lt;br/&gt;
The &lt;tt&gt;SELECT * FROM myTable WHERE pk = 1 AND c = textAsBlob(&apos;&apos;);&lt;/tt&gt; is rejected if a clear error message: &lt;tt&gt;Invalid empty value for clustering column of COMPACT TABLE&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;As it is not possible to insert an empty ByteBuffer value within the clustering column of a non-composite compact tables those queries do not&lt;br/&gt;
have a lot of meaning. &lt;tt&gt;SELECT * FROM myTable WHERE pk = 1 AND c &amp;lt; textAsBlob(&apos;&apos;);&lt;/tt&gt; and &lt;tt&gt;SELECT * FROM myTable WHERE pk = 1 AND c = textAsBlob(&apos;&apos;);&lt;/tt&gt; will return nothing&lt;br/&gt;
and &lt;tt&gt;SELECT * FROM myTable WHERE pk = 1 AND c &amp;gt; textAsBlob(&apos;&apos;);&lt;/tt&gt; will return the entire partition (pk = 1).&lt;/p&gt;

&lt;p&gt;In my opinion those queries should probably all be rejected as it seems that the fact that &lt;tt&gt;SELECT * FROM myTable  WHERE pk = 1 AND c &amp;gt; textAsBlob(&apos;&apos;);&lt;/tt&gt; was accepted in &lt;tt&gt;2.0&lt;/tt&gt; was due to a bug.&lt;br/&gt;
I am of course open to discussion.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12986295">CASSANDRA-12127</key>
            <summary>Queries with empty ByteBuffer values in clustering column restrictions fail for non-composite compact tables</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="blerer">Benjamin Lerer</assignee>
                                    <reporter username="blerer">Benjamin Lerer</reporter>
                        <labels>
                    </labels>
                <created>Fri, 1 Jul 2016 19:36:12 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:27 +0000</updated>
                            <resolved>Tue, 16 Aug 2016 13:54:41 +0000</resolved>
                                        <fixVersion>2.1.16</fixVersion>
                    <fixVersion>2.2.8</fixVersion>
                    <fixVersion>3.0.9</fixVersion>
                                    <component>Legacy/CQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                                                                <comments>
                            <comment id="15359588" author="jasobrown" created="Fri, 1 Jul 2016 20:36:52 +0000"  >&lt;p&gt;In the interest in completeness, I&apos;ve taken &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blerer&quot; class=&quot;user-hover&quot; rel=&quot;blerer&quot;&gt;blerer&lt;/a&gt; &apos;s sample queries (the difference being &amp;gt;, &amp;lt;, or = operators before &lt;tt&gt;textAsBlob()&lt;/tt&gt;), and discovered the following:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;op&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.0&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.1/2.2&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.0/trunk&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;tt&gt;&amp;gt;&lt;/tt&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; return 2 rows &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; ClassCastException &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; return 2 rows &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;tt&gt;&amp;lt;&lt;/tt&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; return 2 rows &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; ClassCastException &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; return 0 rows &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;tt&gt;=&lt;/tt&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &quot;Invalid empty value for clustering column of COMPACT TABLE&quot; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; AssertionError &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; return 0 rows &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;As this behavior (passing an empty buffer to &lt;tt&gt;textAsBlob()&lt;/tt&gt;) is allowable and correct as of 3.0 and trunk, I propose we fix this for 2.1 and 2.2 (I suspect it&apos;s the same fix, though I&apos;m not very familiar with this part of the code base). I agree with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blerer&quot; class=&quot;user-hover&quot; rel=&quot;blerer&quot;&gt;blerer&lt;/a&gt; that the behavior in 2.0 was certainly buggy, but the fact that it&apos;s working correctly in 3.0 and up indicates we should fix it for the intervening versions.&lt;/p&gt;

&lt;p&gt;UPDATE: we should fix it to behave like 3.0/trunk, not 2.0 &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;
</comment>
                            <comment id="15359730" author="ifesdjeen" created="Fri, 1 Jul 2016 22:16:20 +0000"  >&lt;p&gt;Great find &amp;amp; investigation! &lt;/p&gt;

&lt;p&gt;The behaviour of &lt;tt&gt;2.1&lt;/tt&gt; / &lt;tt&gt;2.2&lt;/tt&gt; can be explained by (leaving the class cast aside) the fact that there&apos;s no distinction between not specifying the clustering slice at all and specifying the empty buffer (therefore in both cases 2 rows are returned). Empty buffer would get translated to &lt;tt&gt;Composites#EMPTY&lt;/tt&gt; and afterwards get discarded by &lt;tt&gt;AtomicBTreeColumns#slice&lt;/tt&gt; as it checks for &lt;tt&gt;isEmpty&lt;/tt&gt; and replaces all empty bounds with &lt;tt&gt;null&lt;/tt&gt;. &lt;/p&gt;

&lt;p&gt;Semantically, &lt;tt&gt;&amp;gt;&lt;/tt&gt; with empty byte buffer would be same as specifying no condition at all, and in case with &lt;tt&gt;&amp;lt;&lt;/tt&gt; (same as &lt;tt&gt;=&lt;/tt&gt;) result is more or less known in advance: no results.&lt;/p&gt;</comment>
                            <comment id="15360295" author="blerer" created="Sat, 2 Jul 2016 19:22:54 +0000"  >&lt;blockquote&gt;&lt;p&gt;As this behavior (passing an empty buffer to textAsBlob()) is allowable and correct as of 3.0 and trunk, I propose we fix this for 2.1 and 2.2&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I agree with your suggestion. It makes more sense if 3.0 allows those queries.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I suspect it&apos;s the same fix, though I&apos;m not very familiar with this part of the code base&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This problem was solved with the Storage engine refactoring (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8099&quot; title=&quot;Refactor and modernize the storage engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8099&quot;&gt;&lt;del&gt;CASSANDRA-8099&lt;/del&gt;&lt;/a&gt;). By consequence, it will not be possible to do the same in 2.1 and 2.2.&lt;br/&gt;
As the behavior of those queries is pretty simple, I believe that we can fix the problem at the &lt;tt&gt;SelectStatement&lt;/tt&gt; level by doing some special handling for those queries. It will not be the nicest solution but, as the problem has been properly solved in 3.0, I think it is acceptable.  &lt;/p&gt;</comment>
                            <comment id="15362439" author="jasobrown" created="Tue, 5 Jul 2016 12:46:06 +0000"  >&lt;blockquote&gt;&lt;p&gt;By consequence, it will not be possible to do the same in 2.1 and 2.2.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sorry, I meant the fix will be the same between 2.1 and 2.2, not between 2.1 and 3.0.&lt;/p&gt;</comment>
                            <comment id="15365331" author="brandon.williams" created="Wed, 6 Jul 2016 23:27:04 +0000"  >&lt;p&gt;One possible solution.&lt;/p&gt;</comment>
                            <comment id="15365999" author="blerer" created="Thu, 7 Jul 2016 12:13:44 +0000"  >&lt;p&gt;Thanks for the patch. Unfortunatly, is only covers the problem of single slice restrictions with an empty start bound and the solution will not work if the table is sorted in descending order.&lt;/p&gt;

&lt;p&gt;I should have a patch ready today. Writing the tests to cover (hopefully) all of the possible queries took much more time than I expected.&lt;/p&gt;
</comment>
                            <comment id="15368345" author="blerer" created="Fri, 8 Jul 2016 20:12:31 +0000"  >&lt;p&gt;While working on this patch I ran into 2 other issues:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;in all the versions, for non-compact tables or compact tables with more than one clustering column, if the table was created with descending clustering order the ordering was not working properly when an empty ByteBuffer was used for a clustering column value. The problem was due to &lt;tt&gt;ReversedType::compareCustom()&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;in 3.9, queries with desending &lt;tt&gt;ORDER BY&lt;/tt&gt; and &lt;tt&gt;IN&lt;/tt&gt; restrictions on the clustering column were not returning the proper results. The regression has been introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9986&quot; title=&quot;Remove SliceableUnfilteredRowIterator&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9986&quot;&gt;&lt;del&gt;CASSANDRA-9986&lt;/del&gt;&lt;/a&gt; and was affecting &lt;tt&gt;SSTableReversedIterator&lt;/tt&gt;.&lt;/li&gt;
&lt;/ol&gt;


&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;utests&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;dtests&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...blerer:12127-2.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-12127-2.1-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-12127-2.1-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...blerer:12127-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.2&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-12127-2.2-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.2&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-12127-2.2-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.2&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...blerer:12127-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-12127-3.0-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-12127-3.0-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...blerer:12127-3.9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.9&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-12127-3.9-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.9&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-12127-3.9-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.9&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;The 2.1 and 2.2 patches:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;add support for queries on compact tables with EQ restrictions with empty value or slice restrictions with an empty value for end bound by returning no results&lt;/li&gt;
	&lt;li&gt;add support for queries on compact tables with IN restrictions with an empty value by ignoring that value&lt;/li&gt;
	&lt;li&gt;fix the handling of slice restrictions with an empty start bound on compact table with 1 clustering column&lt;/li&gt;
	&lt;li&gt;fix the &lt;tt&gt;ReversedType::compareCustom()&lt;/tt&gt; problem&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The 3.0 patch:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;fix the &lt;tt&gt;ReversedType::compareCustom()&lt;/tt&gt; problem&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The 3.9 patch:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;fix the &lt;tt&gt;ReversedType::compareCustom()&lt;/tt&gt; problem&lt;/li&gt;
	&lt;li&gt;fix the &lt;tt&gt;SSTableReversedIterator&lt;/tt&gt; problem&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;In the 2.2, 3.0 and 3.9 patches the &lt;tt&gt;SelectOrderByTest&lt;/tt&gt; test have been modify to check the ordering behavior when the data are stored within the memtables and the SSTables.&lt;/p&gt;
</comment>
                            <comment id="15378357" author="jasobrown" created="Thu, 14 Jul 2016 20:52:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blerer&quot; class=&quot;user-hover&quot; rel=&quot;blerer&quot;&gt;blerer&lt;/a&gt; In the 2.1 version, can you help me understand on &lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...blerer:12127-2.1#diff-75ebe654dcf6c8c474f787abaf47bb68R923&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this line&lt;/a&gt; why you are only checking the first element of the &lt;tt&gt;components&lt;/tt&gt; list?&lt;/p&gt;

&lt;p&gt;UPDATE: nevermind, figured it out myself&lt;/p&gt;</comment>
                            <comment id="15378429" author="thobbs" created="Thu, 14 Jul 2016 21:32:59 +0000"  >&lt;p&gt;I have not looked through the complete patches, but one thing that worries me is changing the behavior of &lt;tt&gt;ReversedType::compareCustom()&lt;/tt&gt;.  The new behavior is certain the correct behavior, but I&apos;m not sure how this change might interact with existing, incorrectly ordered data on disk.  It would be good to run some tests to determine what happens and how we can mitigate any problems before merging this.&lt;/p&gt;</comment>
                            <comment id="15378508" author="jasobrown" created="Thu, 14 Jul 2016 22:28:38 +0000"  >&lt;p&gt;I&apos;ve reviewed all four branches (haven&apos;t tried it out locally to see if the original problem is resolved), and they seem pretty reasonable. However I want to echo &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thobbs&quot; class=&quot;user-hover&quot; rel=&quot;thobbs&quot;&gt;thobbs&lt;/a&gt;&apos;s concerns wrt the changes in &lt;tt&gt;ReversedType&lt;/tt&gt;. we should carefully consider and test that one&lt;/p&gt;</comment>
                            <comment id="15383103" author="jasobrown" created="Mon, 18 Jul 2016 21:26:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blerer&quot; class=&quot;user-hover&quot; rel=&quot;blerer&quot;&gt;blerer&lt;/a&gt; or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thobbs&quot; class=&quot;user-hover&quot; rel=&quot;thobbs&quot;&gt;thobbs&lt;/a&gt; any updates?&lt;/p&gt;</comment>
                            <comment id="15394307" author="kohlisankalp" created="Tue, 26 Jul 2016 18:44:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blerer&quot; class=&quot;user-hover&quot; rel=&quot;blerer&quot;&gt;blerer&lt;/a&gt; any updates here. &lt;/p&gt;</comment>
                            <comment id="15394379" author="thobbs" created="Tue, 26 Jul 2016 19:24:11 +0000"  >&lt;p&gt;Benjamin is currently on vacation (I think he&apos;ll be back next week).  Is this ticket urgent for you?&lt;/p&gt;</comment>
                            <comment id="15394847" author="kohlisankalp" created="Wed, 27 Jul 2016 00:41:08 +0000"  >&lt;p&gt;We have added an internal patch for this but would be nice if we can get this one....we can wait till next week. &lt;/p&gt;</comment>
                            <comment id="15404043" author="blerer" created="Tue, 2 Aug 2016 14:10:12 +0000"  >&lt;p&gt;I will try to make &lt;tt&gt;scrub&lt;/tt&gt; able to correct that type of problems. &lt;/p&gt;</comment>
                            <comment id="15409135" author="blerer" created="Fri, 5 Aug 2016 08:09:18 +0000"  >&lt;p&gt;I have pushed a new commits in all the branches. The new commit modify &lt;tt&gt;scrub&lt;/tt&gt; to allow it to correct the ordering problem and add an upgrade section in the &lt;tt&gt;NEWS.txt&lt;/tt&gt;.  &lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;utests&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;dtests&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...blerer:12127-2.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-12127-2.1-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-12127-2.1-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...blerer:12127-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.2&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-12127-2.2-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.2&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-12127-2.2-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.2&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...blerer:12127-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-12127-3.0-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-12127-3.0-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...blerer:12127-3.9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.9&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-12127-3.9-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.9&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-12127-3.9-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.9&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15409981" author="thobbs" created="Fri, 5 Aug 2016 20:01:35 +0000"  >&lt;p&gt;The patches look good, overall.  Thank you for putting a lot of effort into improving the tests.&lt;/p&gt;

&lt;p&gt;I just have a few review comments:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;In the 2.1/2.2 patches in &lt;tt&gt;SelectStatement.makeExclusiveBound()&lt;/tt&gt;, why are we using &lt;tt&gt;.get(0&lt;/tt&gt; for the bound? It seems like we need to use the full set of values to make a proper exclusive bound.  (If this actually is a problem and our tests didn&apos;t catch it, we should add a test case for this.)&lt;/li&gt;
	&lt;li&gt;In &lt;tt&gt;Scubber&lt;/tt&gt;, it would be good to add a few comments around &lt;tt&gt;tryAppend()&lt;/tt&gt; and &lt;tt&gt;saveOutOfOrderRow()&lt;/tt&gt; that clarify which cells are kept and which are saved elsewhere.  (It looks like the behavior is to keep everything before the first out of order cell, and then save the remaining cells elsewhere.)  The logged message could also be improved to provide more details about this.&lt;/li&gt;
	&lt;li&gt;In &lt;tt&gt;collectOutOfOrderCells()&lt;/tt&gt;, there are extra curly braces for single-line while-loop.&lt;/li&gt;
	&lt;li&gt;In the 2.1/2.2 tests that loop through {{flush = 
{true, false}
&lt;p&gt;)), shouldn&apos;t &lt;tt&gt;flush&lt;/tt&gt; be set to &lt;tt&gt;false&lt;/tt&gt; in the first loop? Right now it&apos;s flushing and then reading from sstables twice.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15418796" author="blerer" created="Fri, 12 Aug 2016 13:14:45 +0000"  >&lt;p&gt;Thanks for the review. I pushed some commits to fix the review comments.&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;utests&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;dtests&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...blerer:12127-2.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-12127-2.1-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-12127-2.1-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...blerer:12127-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.2&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-12127-2.2-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.2&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-12127-2.2-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.2&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...blerer:12127-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-12127-3.0-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-12127-3.0-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...blerer:12127-3.9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.9&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-12127-3.9-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.9&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-12127-3.9-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.9&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15419044" author="thobbs" created="Fri, 12 Aug 2016 15:53:45 +0000"  >&lt;p&gt;+1 on the new commits.  If the tests look good, this should be ready to commit.&lt;/p&gt;</comment>
                            <comment id="15422748" author="blerer" created="Tue, 16 Aug 2016 13:53:28 +0000"  >&lt;p&gt;Thanks for the review.&lt;/p&gt;</comment>
                            <comment id="15422751" author="blerer" created="Tue, 16 Aug 2016 13:54:41 +0000"  >&lt;p&gt;Committed into 2.1 at 527d1897c0973491bb0db098ce5ea1e0bd78898f and merged into 2.2, 3.0, 3.9 and trunk.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13161035">CASSANDRA-14462</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12816529" name="12127.txt" size="3803" author="brandon.williams" created="Wed, 6 Jul 2016 23:29:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blerer]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 14 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i30g67:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jasobrown</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jasobrown]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>