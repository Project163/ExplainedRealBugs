<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:41:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6374] AssertionError for rows with zero columns</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6374</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;After upgrading from 1.2.5 to 1.2.9 and then to 2.0.2 we&apos;ve got those exceptions:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [FlushWriter:1] 2013-11-18 16:14:36,305 CassandraDaemon.java (line 187) Exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[FlushWriter:1,5,main]
java.lang.AssertionError
        at org.apache.cassandra.io.sstable.SSTableWriter.rawAppend(SSTableWriter.java:198)
        at org.apache.cassandra.io.sstable.SSTableWriter.append(SSTableWriter.java:186)
        at org.apache.cassandra.db.Memtable$FlushRunnable.writeSortedContents(Memtable.java:360)
        at org.apache.cassandra.db.Memtable$FlushRunnable.runWith(Memtable.java:315)
        at org.apache.cassandra.io.util.DiskAwareRunnable.runMayThrow(DiskAwareRunnable.java:48)
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:28)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:722)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Also found similar issue in this thread:&lt;br/&gt;
&lt;a href=&quot;http://www.mail-archive.com/user@cassandra.apache.org/msg32875.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.mail-archive.com/user@cassandra.apache.org/msg32875.html&lt;/a&gt;&lt;br/&gt;
There Aaron Morton said that its caused by leaving rows with zero columns - that&apos;s exactly what we do in some CFs (using Thrift &amp;amp; Astyanax).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12679880">CASSANDRA-6374</key>
            <summary>AssertionError for rows with zero columns</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="sv3k">Anton Gorbunov</reporter>
                        <labels>
                    </labels>
                <created>Tue, 19 Nov 2013 06:13:55 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:59 +0000</updated>
                            <resolved>Thu, 21 Nov 2013 21:15:10 +0000</resolved>
                                        <fixVersion>2.0.3</fixVersion>
                                        <due></due>
                            <votes>3</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="13826523" author="jbellis" created="Tue, 19 Nov 2013 13:53:08 +0000"  >&lt;p&gt;Under Thrift, a row with zero columns will be removed as soon as it compacts.  So this really is a bad idea.&lt;/p&gt;</comment>
                            <comment id="13827283" author="ash2k" created="Wed, 20 Nov 2013 03:25:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbellis&quot; class=&quot;user-hover&quot; rel=&quot;jbellis&quot;&gt;jbellis&lt;/a&gt; can you explain please what exactly is a bad idea here? We are ok with &quot;a row with zero columns will be removed as soon as it compacts&quot;. We just didn&apos;t expected this usage to be a problem - is it documented somewhere? It works fine with 1.2.x and do not work with 2.0.x.&lt;/p&gt;</comment>
                            <comment id="13827288" author="jbellis" created="Wed, 20 Nov 2013 03:30:58 +0000"  >&lt;p&gt;Rows that sort-of exist for a non-deterministic amount of time are not a feature I intend to support.  That it works in 1.2.x is a bug.&lt;/p&gt;</comment>
                            <comment id="13827297" author="ash2k" created="Wed, 20 Nov 2013 03:45:16 +0000"  >&lt;p&gt;Our scenario of usage is as follows:&lt;br/&gt;
We delete specific columns in a specific row. Sometimes those columns are the last ones. How can we delete the whole row if they are the last ones? We cannot read-check-delete_row_or_only_columns because it has a race between check and delete.&lt;/p&gt;</comment>
                            <comment id="13827335" author="jbellis" created="Wed, 20 Nov 2013 04:55:54 +0000"  >&lt;p&gt;We still support that.  The assertion only rejects no cells at all.  (A tombstone still counts as a cell.)&lt;/p&gt;

&lt;p&gt;That said, it&apos;s really the memtable&apos;s job to not flush empty rows even if it&apos;s rather antisocial to give it a batch containing zero mutations.&lt;/p&gt;</comment>
                            <comment id="13827340" author="jbellis" created="Wed, 20 Nov 2013 05:00:25 +0000"  >&lt;p&gt;Patch attached to do that.  I&apos;m a bit nervous though that I&apos;m not 100% sure if 1.2 was actually writing empty rows to sstables, or if it was rejecting them silently somewhere else.&lt;/p&gt;</comment>
                            <comment id="13829323" author="jasobrown" created="Thu, 21 Nov 2013 20:48:05 +0000"  >&lt;p&gt;+1. Agreed that flushing a zero column row is not a good idea.&lt;/p&gt;</comment>
                            <comment id="13829360" author="jbellis" created="Thu, 21 Nov 2013 21:15:10 +0000"  >&lt;p&gt;Committed&lt;/p&gt;</comment>
                            <comment id="13829623" author="ash2k" created="Fri, 22 Nov 2013 03:27:17 +0000"  >&lt;p&gt;Can this be fixed for 2.0.3 please? We need to upgrade our testing cluster to 2.0.x but cannot because of this issue.&lt;/p&gt;</comment>
                            <comment id="13830055" author="iamaleksey" created="Fri, 22 Nov 2013 15:37:20 +0000"  >&lt;blockquote&gt;&lt;p&gt;Can this be fixed for 2.0.3 please? We need to upgrade our testing cluster to 2.0.x but cannot because of this issue.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;2.0.3 vote is being restarted, so yes, it will be in 2.0.3.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12614789" name="6374.txt" size="784" author="jbellis" created="Wed, 20 Nov 2013 05:00:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>359238</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1pxh3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>359537</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12325023">2.0.2</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jasobrown</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jasobrown]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>