<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:37:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-5153] max client timestamp</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-5153</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;1. In public LazilyCompactedRow(CompactionController controller, List&amp;lt;? extends ICountableColumnIterator&amp;gt; rows)&lt;br/&gt;
   columnStats = new ColumnStats(reducer == null ? 0 : reducer.columns, reducer == null ? Long.MIN_VALUE : reducer.maxTimestampSeen,&lt;br/&gt;
                                      reducer == null ? new StreamingHistogram(SSTable.TOMBSTONE_HISTOGRAM_BIN_SIZE) : reducer.tombstones&lt;/p&gt;

&lt;p&gt;  Tthe maxTimestampSeen should be max(emptyColumnFamily.deletionInfo().maxTimestamp(), reducer.maxTimestampSeen)?&lt;/p&gt;

&lt;p&gt;2. In private ColumnFamily collectTimeOrderedData()&lt;br/&gt;
                // if we&apos;ve already seen a row tombstone with a timestamp greater&lt;br/&gt;
                // than the most recent update to this sstable, we&apos;re done, since the rest of the sstables&lt;br/&gt;
                // will also be older&lt;br/&gt;
                if (sstable.getMaxTimestamp() &amp;lt; mostRecentRowTombstone)&lt;br/&gt;
                    break; &lt;br/&gt;
   In the case that sstable.getMaxTimestamp == Long.MIN_VALUE, is it logical?&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12627370">CASSANDRA-5153</key>
            <summary>max client timestamp</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="wy96f">Wei Yang</reporter>
                        <labels>
                    </labels>
                <created>Mon, 14 Jan 2013 03:16:03 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:19 +0000</updated>
                            <resolved>Thu, 24 Jan 2013 14:58:34 +0000</resolved>
                                        <fixVersion>1.1.10</fixVersion>
                    <fixVersion>1.2.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13552412" author="jbellis" created="Mon, 14 Jan 2013 03:27:57 +0000"  >&lt;p&gt;What about max client timestamp?&lt;/p&gt;</comment>
                            <comment id="13554616" author="wy96f" created="Wed, 16 Jan 2013 01:40:18 +0000"  >&lt;p&gt;Any ideas?&lt;br/&gt;
Thanks&lt;/p&gt;</comment>
                            <comment id="13554845" author="jbellis" created="Wed, 16 Jan 2013 08:27:08 +0000"  >&lt;p&gt;I think you&apos;re right.  Patch attached to fix and to treat old sstables with MAX_VALUE instead of MIN.&lt;/p&gt;</comment>
                            <comment id="13558802" author="slebresne" created="Mon, 21 Jan 2013 14:40:46 +0000"  >&lt;p&gt;I think the correct fix in LCR would be:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;markedAt = emptyColumnFamily.getMarkedForDeleteAt();
maxTimestamp = reducer == null ? markedAt : Math.max(markedAt, reducer.maxTimestampSeen);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;because &lt;tt&gt;reducer == null&lt;/tt&gt; implies there is no columns for that row in any of the source SSTable, and thus guarantees we have a row tombstone (otherwise we wouldn&apos;t have written the row in the first place). And in fact, even if we were to write non-tombstoned empty rows, then MIN_VALUE would be the correct value for maxTimestamp.&lt;/p&gt;

&lt;p&gt;Also, while the default of MIN_VALUE for old non-timestamp-tracking sstables is clearly bogus and should be fixed, I would almost suggest not bumping the sstable version (I&apos;m still hesitant but leaning towards not doing it). The rational is that there are only 2 cases currently where a sstable can have a MIN_VALUE max timestamp:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;the sstable is a pre-1.0.10 one that don&apos;t track timestamp. Fixing SSTableMetada fixes that part.&lt;/li&gt;
	&lt;li&gt;the sstable is entirely and uniquely composed of row tombstones.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;The version bump is &quot;fixing&quot; only the latter but at the price of temporarly breaking the collectTimeOrderedData optimization for everyone that will upgrade to the version containing this. Granted collectTimeOrderedData is &quot;just an optimization&quot;, but having a sstable entirely composed of row tombstones is a pretty remote risk. And besides, for it to trigger a problem you actually need at least 2 sstables entirely composed of row tombstones (and even then there is no guaranteed you&apos;ll get the bug). Feels even more than remote.&lt;/p&gt;</comment>
                            <comment id="13561661" author="jbellis" created="Thu, 24 Jan 2013 14:58:34 +0000"  >&lt;p&gt;Committed w/ suggested changes.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12565093" name="5153.txt" size="3453" author="jbellis" created="Wed, 16 Jan 2013 08:27:09 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>304154</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 43 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i17js7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>252174</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>