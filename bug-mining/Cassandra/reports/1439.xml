<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:29:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-3864] Unit tests failures in 1.1</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-3864</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;On the current 1.1 branch I get the following errors:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;SSTableImportTest:
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[junit] Testcase: testImportSimpleCf(org.apache.cassandra.tools.SSTableImportTest):	Caused an ERROR
[junit] java.lang.Integer cannot be cast to java.lang.Long
[junit] java.lang.ClassCastException: java.lang.Integer cannot be cast to java.lang.Long
[junit] 	at org.apache.cassandra.tools.SSTableImport$JsonColumn.&amp;lt;init&amp;gt;(SSTableImport.java:132)
[junit] 	at org.apache.cassandra.tools.SSTableImport.addColumnsToCF(SSTableImport.java:191)
[junit] 	at org.apache.cassandra.tools.SSTableImport.addToStandardCF(SSTableImport.java:174)
[junit] 	at org.apache.cassandra.tools.SSTableImport.importUnsorted(SSTableImport.java:290)
[junit] 	at org.apache.cassandra.tools.SSTableImport.importJson(SSTableImport.java:255)
[junit] 	at org.apache.cassandra.tools.SSTableImportTest.testImportSimpleCf(SSTableImportTest.java:60)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;CompositeTypeTest:
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[junit] Testcase: testCompatibility(org.apache.cassandra.db.marshal.CompositeTypeTest):	Caused an ERROR
[junit] Invalid comparator class org.apache.cassandra.db.marshal.CompositeType: must define a public static instance field or a public static method getInstance(TypeParser).
[junit] org.apache.cassandra.config.ConfigurationException: Invalid comparator class org.apache.cassandra.db.marshal.CompositeType: must define a public static instance field or a public static method getInstance(TypeParser).
[junit] 	at org.apache.cassandra.db.marshal.TypeParser.getRawAbstractType(TypeParser.java:294)
[junit] 	at org.apache.cassandra.db.marshal.TypeParser.getAbstractType(TypeParser.java:268)
[junit] 	at org.apache.cassandra.db.marshal.TypeParser.parse(TypeParser.java:81)
[junit] 	at org.apache.cassandra.db.marshal.CompositeTypeTest.testCompatibility(CompositeTypeTest.java:216)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;DefsTest:
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[junit] Testcase: testUpdateColumnFamilyNoIndexes(org.apache.cassandra.db.DefsTest):	FAILED
[junit] Should have blown up when you used a different comparator.
[junit] junit.framework.AssertionFailedError: Should have blown up when you used a different comparator.
[junit] 	at org.apache.cassandra.db.DefsTest.testUpdateColumnFamilyNoIndexes(DefsTest.java:539)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;CompactSerializerTest:
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[junit] null
[junit] java.lang.ExceptionInInitializerError
[junit] 	at org.apache.cassandra.db.SystemTable.getCurrentLocalNodeId(SystemTable.java:437)
[junit] 	at org.apache.cassandra.utils.NodeId$LocalNodeIdHistory.&amp;lt;init&amp;gt;(NodeId.java:195)
[junit] 	at org.apache.cassandra.utils.NodeId$LocalIds.&amp;lt;clinit&amp;gt;(NodeId.java:43)
[junit] 	at java.lang.Class.forName0(Native Method)
[junit] 	at java.lang.Class.forName(Class.java:169)
[junit] 	at org.apache.cassandra.io.CompactSerializerTest$1DirScanner.scan(CompactSerializerTest.java:96)
[junit] 	at org.apache.cassandra.io.CompactSerializerTest$1DirScanner.scan(CompactSerializerTest.java:87)
[junit] 	at org.apache.cassandra.io.CompactSerializerTest$1DirScanner.scan(CompactSerializerTest.java:87)
[junit] 	at org.apache.cassandra.io.CompactSerializerTest$1DirScanner.scan(CompactSerializerTest.java:87)
[junit] 	at org.apache.cassandra.io.CompactSerializerTest$1DirScanner.scan(CompactSerializerTest.java:87)
[junit] 	at org.apache.cassandra.io.CompactSerializerTest$1DirScanner.scan(CompactSerializerTest.java:87)
[junit] 	at org.apache.cassandra.io.CompactSerializerTest.scanClasspath(CompactSerializerTest.java:129)
[junit] Caused by: java.lang.NullPointerException
[junit] 	at org.apache.cassandra.config.DatabaseDescriptor.createAllDirectories(DatabaseDescriptor.java:574)
[junit] 	at org.apache.cassandra.db.Table.&amp;lt;clinit&amp;gt;(Table.java:82)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;There is also some error RemoveSubColumnTest and RemoveSubColumnTest but I&apos;ll open a separate ticket for those as they may require a bit more discussion.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12541465">CASSANDRA-3864</key>
            <summary>Unit tests failures in 1.1</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="brandon.williams">Brandon Williams</assignee>
                                    <reporter username="slebresne">Sylvain Lebresne</reporter>
                        <labels>
                    </labels>
                <created>Mon, 6 Feb 2012 19:09:41 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:40 +0000</updated>
                            <resolved>Wed, 15 Feb 2012 15:14:44 +0000</resolved>
                                        <fixVersion>1.1.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13201486" author="slebresne" created="Mon, 6 Feb 2012 19:18:24 +0000"  >&lt;p&gt;Attached patches are fixing failures 1, 2 and 3 above. More precisely:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;SSTableImportTest: the patch speaks for itself. It&apos;s likely due a change of the jackson lib version or something like that.&lt;/li&gt;
	&lt;li&gt;CompositeTypeTest: this is a regression of commit 96ecaff5 that removed a perfectly fine (and useful) method&lt;/li&gt;
	&lt;li&gt;DefsTest: &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3657&quot; title=&quot;Allow extending CompositeType comparator&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3657&quot;&gt;&lt;del&gt;CASSANDRA-3657&lt;/del&gt;&lt;/a&gt; mad possible the kind of comparator change the test was testing (UTF8Type -&amp;gt; BytesType). The patch replaces that by a non-compatible change.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;For the CompactSerializerTest, I&apos;m a little bit less sure what the right fix is. As weird as that sound, the problem comes from BulkRecordWriter. Somehow the class is loaded by the test, which makes it replace the config field of DatabaseDescriptor by a Config object where data_file_directories is null (more precisely DatabaseDescriptor.initDefaultsOnly() is called). I&apos;m pretty sure there is something a little bit ugly in there, but since I&apos;m not sure how BulkRecordWriter is supposed to be used, I leave that to someone else.&lt;/p&gt;</comment>
                            <comment id="13202408" author="jbellis" created="Tue, 7 Feb 2012 14:08:37 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13202499" author="slebresne" created="Tue, 7 Feb 2012 16:08:30 +0000"  >&lt;p&gt;Committed, thanks.&lt;/p&gt;

&lt;p&gt;I&apos;m keeping this open so that we deal with the CompactSerializerTest/BulkRecordWriter failure, but I&apos;ll assign someone that actually know something about BulkRecordWriter.&lt;/p&gt;</comment>
                            <comment id="13202599" author="brandon.williams" created="Tue, 7 Feb 2012 18:32:24 +0000"  >&lt;p&gt;Hmm, I had to add SnapshotCommandSerializer to expectedClassNames in CompactSerializerTest, but after that it passes for me.&lt;/p&gt;</comment>
                            <comment id="13203651" author="slebresne" created="Wed, 8 Feb 2012 14:56:01 +0000"  >&lt;p&gt;That&apos;s weird, as I still get it every time.&lt;br/&gt;
But actually I think that is a bit dependent on the class loader, so this may be platform dependent (I&apos;m using sun java 1.6.0_26).&lt;/p&gt;

&lt;p&gt;In any case, I think there do is something fishy in there. Namely, BulkRecordWriter override the global configuration in it&apos;s static initializer. And the config it override with has data_file_directories == null. Which means that if the class Table is loaded after that, it will try to create default directories as part of the class initialization (unless StorageService.isClientMode == true) and will throw a NPE because data_file_directories == null. I&apos;m not too sure in which context exactly BulkRecordWriter is supposed to be used, but outside of making the unit test fail at least on my machine, it does sound fairly fragile.&lt;br/&gt;
Of course, that&apos;s another way to say that all our static initialization business is fragile, and we should fix that someday. Nevertheless, would it be reasonable for instance in BulkLoaderWriter to call something to set StorageService.isClientMode to true before changing the configuration (so that if Table is loaded later, we don&apos;t try to create the default directories)? &lt;/p&gt;</comment>
                            <comment id="13203764" author="brandon.williams" created="Wed, 8 Feb 2012 17:41:50 +0000"  >&lt;blockquote&gt;&lt;p&gt;That&apos;s weird, as I still get it every time.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think that&apos;s because I was running this test by itself, so BRW was never loaded (though I&apos;m pretty sure we need to add SnapshotCommandSerializer if we do get past this.)&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;BulkRecordWriter override the global configuration in it&apos;s static initializer&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That was a failed attempt to get around DD&apos;s static initialization (and yes, all our static initialization is a mess), but I&apos;ve reworked the approach in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3740&quot; title=&quot;While using BulkOutputFormat  unneccessarily look for the cassandra.yaml file.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3740&quot;&gt;&lt;del&gt;CASSANDRA-3740&lt;/del&gt;&lt;/a&gt; and that should pass since there is no static initialization.&lt;/p&gt;</comment>
                            <comment id="13203773" author="slebresne" created="Wed, 8 Feb 2012 17:48:50 +0000"  >&lt;blockquote&gt;&lt;p&gt;I think that&apos;s because I was running this test by itself&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I get it even if I run the test by itself. That&apos;s because CompactSerializerTest actually load pretty much every class during it&apos;s scanning. But I suppose the order in which it load stuffs is very platform dependent.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I&apos;m pretty sure we need to add SnapshotCommandSerializer if we do get past this&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That may very well be.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I&apos;ve reworked the approach in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3740&quot; title=&quot;While using BulkOutputFormat  unneccessarily look for the cassandra.yaml file.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3740&quot;&gt;&lt;del&gt;CASSANDRA-3740&lt;/del&gt;&lt;/a&gt; and that should pass since there is no static initialization&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Alright, let&apos;s wait for it. I&apos;ll retest and close this if that fixes it.&lt;/p&gt;</comment>
                            <comment id="13208534" author="slebresne" created="Wed, 15 Feb 2012 15:14:44 +0000"  >&lt;p&gt;Ok, I think the problems of that ticket are now all solved, closing&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12513469" name="0001-Fix-DefsTest.patch" size="1567" author="slebresne" created="Mon, 6 Feb 2012 19:10:56 +0000"/>
                            <attachment id="12513470" name="0002-Fix-SSTableImportTest.patch" size="1472" author="slebresne" created="Mon, 6 Feb 2012 19:10:56 +0000"/>
                            <attachment id="12513471" name="0003-Fix-CompositeTypeTest.patch" size="1179" author="slebresne" created="Mon, 6 Feb 2012 19:10:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>226752</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 40 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gp5r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>95506</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>