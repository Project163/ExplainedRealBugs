<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:24:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-16518] Node restart during joining sets protocol version to V3</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-16518</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;While joining nodes to a cluster, an old node crashed. The old node was recovered however clients (datastax java) refused to connect to it.&lt;/p&gt;

&lt;p&gt;The driver error:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Detected added or restarted Cassandra host /&amp;lt;ip&amp;gt;:&amp;lt;port&amp;gt; but ignoring it since it does not support the version V4 of the native protocol which is currently in use.&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In the recovered node cassandra logs:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;INFO  o.a.c.transport.ConfiguredLimit Detected peers which do not fully support protocol V4. Capping max negotiable version to V3&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I confirmed that ALL the nodes in the cluster, joining or otherwise, were&#160;apache-cassandra-3.11.6 so that error message was rather confusing.&lt;/p&gt;

&lt;p&gt; Eventually after digging through the code we got to the bottom of the issue:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-15193&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CASSANDRA-15193&lt;/a&gt;&#160;adds a check for node version, which reverts the protocol version to V3 if any peer fails the version check. Joining nodes have NULL for their version in the peers table, which fails the version check.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13365108">CASSANDRA-16518</key>
            <summary>Node restart during joining sets protocol version to V3</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stefan.miklosovic">Stefan Miklosovic</assignee>
                                    <reporter username="JosephClay">Joseph Clay</reporter>
                        <labels>
                    </labels>
                <created>Mon, 15 Mar 2021 02:18:55 +0000</created>
                <updated>Sun, 13 Mar 2022 19:06:32 +0000</updated>
                            <resolved>Tue, 8 Mar 2022 22:44:27 +0000</resolved>
                                        <fixVersion>3.0.27</fixVersion>
                    <fixVersion>3.11.13</fixVersion>
                                    <component>Messaging/Client</component>
                        <due></due>
                            <votes>3</votes>
                                    <watches>7</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="17301337" author="josephclay" created="Mon, 15 Mar 2021 02:26:01 +0000"  >&lt;p&gt;To work around the issue:&lt;br/&gt;
Adding the following to jvm opts in the cassandra-env&lt;br/&gt;
-Dcassandra.disable_max_protocol_auto_override=true&lt;br/&gt;
Works fine to get the node back up on v4&lt;/p&gt;</comment>
                            <comment id="17301689" author="brandon.williams" created="Mon, 15 Mar 2021 15:08:49 +0000"  >&lt;p&gt;Without digging into this, it seems to me the bug is having the bootstrapping (ie, non-member) node listed in the peers table before it has become a full member of the ring.&lt;/p&gt;</comment>
                            <comment id="17366661" author="stefan.miklosovic" created="Mon, 21 Jun 2021 15:09:17 +0000"  >&lt;p&gt;I was not able to reproduce this on 3.11.10, if you check the source of these messages, it is here in DynamicLimit which extends ConfiguredLimit in its private method &quot;maybeUpdateVersion&quot;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void maybeUpdateVersion(&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; allowLowering)
        {
            &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; enforceV3Cap = SystemKeyspace.loadPeerVersions()
                                                 .values()
                                                 .stream()
                                                 .anyMatch(v -&amp;gt; v.compareTo(MIN_VERSION_FOR_V4) &amp;lt; 0);

            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!enforceV3Cap)
            {
                maxVersion = ProtocolVersion.MAX_SUPPORTED_VERSION;
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
            }

            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (ProtocolVersion.V3.isSmallerThan(maxVersion) &amp;amp;&amp;amp; !allowLowering)
            {
                logger.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Detected peers which &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; not fully support protocol V4, but V4 was previously negotiable. &quot;&lt;/span&gt; +
                            &lt;span class=&quot;code-quote&quot;&gt;&quot;Not enforcing cap as &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; can cause issues &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; older client versions. After the next &quot;&lt;/span&gt; +
                            &lt;span class=&quot;code-quote&quot;&gt;&quot;restart the server will apply the cap&quot;&lt;/span&gt;);
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
            }

            logger.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Detected peers which &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; not fully support protocol V4. Capping max negotiable version to V3&quot;&lt;/span&gt;);
            maxVersion = ProtocolVersion.V3;
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So in order to get to the places where the first message is logged, &quot;enforceV3Cap&quot; has to be true so if (!enforceV3Cap) is false and it is skipped. Then, allowLowering has to be false. That means that maybeUpdateVersion accepts allowLowering as false. That is ever happening in DynamicLimit&apos;s method&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void updateMaxSupportedVersion()
        {
            maybeUpdateVersion(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;updateMaxSupportedVersion is ever called only in NativeTransportService:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void refreshMaxNegotiableProtocolVersion()
    {
        &lt;span class=&quot;code-comment&quot;&gt;// lowering the max negotiable protocol version is only safe &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; we haven&apos;t already
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// allowed clients to connect with a higher version. This still allows the max
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// version to be raised, as that is safe.
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (initialized)
            protocolVersionLimit.updateMaxSupportedVersion();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;That is called in CassandraDaemon:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void refreshMaxNativeProtocolVersion()
    {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (nativeTransportService != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
            nativeTransportService.refreshMaxNegotiableProtocolVersion();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;That is called in StorageService:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void refreshMaxNativeProtocolVersion()
    {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (daemon != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
        {
            daemon.refreshMaxNativeProtocolVersion();
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Now this is finally called at two places:&lt;/p&gt;

&lt;p&gt;1) In StorageService#onChange where a respective node gets info from Gossip or so:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; RELEASE_VERSION:
        SystemKeyspace.updatePeerReleaseVersion(endpoint, value.value, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;::refreshMaxNativeProtocolVersion, executor);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The other place is in StorageService#updatePeerInfo which is called from StorageService#handleStateNormal so that treats the case when a node enters NORMAL state.&lt;/p&gt;

&lt;p&gt;When you take the first place into account for now, lets see what it is doing:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void updatePeerReleaseVersion(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; InetAddress ep, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; value, &lt;span class=&quot;code-object&quot;&gt;Runnable&lt;/span&gt; postUpdateTask, ExecutorService executorService)
    {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (ep.equals(FBUtilities.getBroadcastAddress()))
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;

        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; req = &lt;span class=&quot;code-quote&quot;&gt;&quot;INSERT INTO system.%s (peer, release_version) VALUES (?, ?)&quot;&lt;/span&gt;;
        executorService.execute(() -&amp;gt; {
            executeInternal(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.format(req, PEERS), ep, value);
            postUpdateTask.run();
        });
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So, if the peer is not myself, insert the release version of that peer into system.peers AND AFTER THAT run the post update task, which happens to be our refreshMaxNativeProtocolVersion method.&lt;/p&gt;

&lt;p&gt;So as I said before, the fact that it would get so far to actually log that first message means that enforceV3Cap has to be true in the first place, so the result of this has to be true:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; enforceV3Cap = SystemKeyspace.loadPeerVersions()
        .values()
        .stream()
        .anyMatch(v -&amp;gt; v.compareTo(MIN_VERSION_FOR_V4) &amp;lt; 0);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Hence this clearly means that some version found in peers table has to be lower than MIN_VERSION_FOR_V4 which is:&lt;/p&gt;

&lt;p&gt;static final CassandraVersion MIN_VERSION_FOR_V4 = new CassandraVersion(&quot;3.0.0&quot;);&lt;/p&gt;

&lt;p&gt;But I wonder how is that even possible you get that version (hypothetically lower than 3.0.0) because you said that you are running on a cluster which has all nodes of same version, so lets dig deeper a bit:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    /**
     * Return a map of IP address to C* version. If an invalid version string, or no version
     * at all is stored &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; a given peer IP, then NULL_VERSION will be reported &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; that peer
     */
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; Map&amp;lt;InetAddress, CassandraVersion&amp;gt; loadPeerVersions()
    {
        Map&amp;lt;InetAddress, CassandraVersion&amp;gt; releaseVersionMap = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;&amp;gt;();
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (UntypedResultSet.Row row : executeInternal(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT peer, release_version FROM system.&quot;&lt;/span&gt; + PEERS))
        {
            InetAddress peer = row.getInetAddress(&lt;span class=&quot;code-quote&quot;&gt;&quot;peer&quot;&lt;/span&gt;);
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (row.has(&lt;span class=&quot;code-quote&quot;&gt;&quot;release_version&quot;&lt;/span&gt;))
            {
                &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;
                {
                    releaseVersionMap.put(peer, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CassandraVersion(row.getString(&lt;span class=&quot;code-quote&quot;&gt;&quot;release_version&quot;&lt;/span&gt;)));
                }
                &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IllegalArgumentException e)
                {
                    logger.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Invalid version string found &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; {}&quot;&lt;/span&gt;, peer);
                    releaseVersionMap.put(peer, NULL_VERSION);
                }
            }
            &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;
            {
                logger.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;No version string found &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; {}&quot;&lt;/span&gt;, peer);
                releaseVersionMap.put(peer, NULL_VERSION);
            }
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; releaseVersionMap;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So if all nodes are of a bigger release than 3.0.0, the only place where we would get versoin lower than 3.0.0 is, as you debugged, the returned NULL_VERSION.&lt;/p&gt;

&lt;p&gt;But I am failing to see how is that possible because if we recall what updatePeerReleaseVersion does:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        executorService.execute(() -&amp;gt; {
            executeInternal(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.format(req, PEERS), ep, value);
            postUpdateTask.run();
        });
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So we insert the record into system.peers but we fail to read it back? How is that possible? Any ideas?&lt;/p&gt;

&lt;p&gt;This might eventually mean that we insert NULL into DB, right ... so it means that onChange was invoked with RELEASE_VERSION state but its VersionedValue.value returns null which is even more interesting.&lt;/p&gt;

&lt;p&gt;To get the second log message (logger.info(&quot;Detected peers which do not fully support protocol V4. Capping max negotiable version to V3&quot;)&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;, for that, allowFiltering has to be true and that is called only in DynamicLimit&apos;s constructor which is initialised when a node starts - hence likely upon its start and it does not receive any state changes from the other nodes so system.peers has to contain that invalid value already.&lt;/p&gt;

&lt;p&gt;Hence it &lt;em&gt;seems&lt;/em&gt; like a joining node propagates is release version with null when it is joining or a restarted node upon its start receives a RELEASE_VERSION which is null while a node is joining.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Edit 1) I was not able to see that there is NULL in system.peers. In 3.11.10, there are only peers which are joined. During whole joining, all nodes already participating in the ring were containing only other nodes, not the nodes which were about to join yet.&lt;/p&gt;</comment>
                            <comment id="17366662" author="stefan.miklosovic" created="Mon, 21 Jun 2021 15:10:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt;&#160;maybe you could proofread my thinking here? Thanks in advance.&lt;/p&gt;</comment>
                            <comment id="17366663" author="stefan.miklosovic" created="Mon, 21 Jun 2021 15:11:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=samt&quot; class=&quot;user-hover&quot; rel=&quot;samt&quot;&gt;samt&lt;/a&gt;&#160;looping you in as you wrote that feature.&lt;/p&gt;</comment>
                            <comment id="17366683" author="stefan.miklosovic" created="Mon, 21 Jun 2021 15:45:00 +0000"  >&lt;p&gt;Few more observations to consider for &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=JosephClay&quot; class=&quot;user-hover&quot; rel=&quot;JosephClay&quot;&gt;JosephClay&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;If you check what StorgeService#prepareToJoin does:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
            getTokenMetadata().updateHostId(localHostId, FBUtilities.getBroadcastAddress());
            appStates.put(ApplicationState.NET_VERSION, valueFactory.networkVersion());
            appStates.put(ApplicationState.HOST_ID, valueFactory.hostId(localHostId));
            appStates.put(ApplicationState.RPC_ADDRESS, valueFactory.rpcaddress(FBUtilities.getBroadcastRpcAddress()));
            appStates.put(ApplicationState.RELEASE_VERSION, valueFactory.releaseVersion());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Release version is populated from FBUtilities.getReleaseVersionString():&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getReleaseVersionString()
    {
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (InputStream in = FBUtilities.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;getClassLoader().getResourceAsStream(&lt;span class=&quot;code-quote&quot;&gt;&quot;org/apache/cassandra/config/version.properties&quot;&lt;/span&gt;))
        {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (in == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
            {
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.getProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;cassandra.releaseVersion&quot;&lt;/span&gt;, UNKNOWN_RELEASE_VERSION);
            }
            Properties props = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Properties();
            props.load(in);
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; props.getProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;CassandraVersion&quot;&lt;/span&gt;);
        }
        &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e)
        {
            JVMStabilityInspector.inspectThrowable(e);
            logger.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Unable to load version.properties&quot;&lt;/span&gt;, e);
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;debug version&quot;&lt;/span&gt;;
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Are you sure that you have this file present? Also, are you sure that the version string is indeed 3.11.6? It might be different if you are building your own Cassandra distribution so it might have some unpredictable consequencies when there is some abritrary version in it and you gossip it to other nodes and so on. Does it strictly follow major.minor.patch format? If that resource is not found, as you see, it will default to system property and if that one is not set either, it will return &quot;Unknown&quot;.&lt;/p&gt;

&lt;p&gt;Then the Gossip is started:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Gossiper.instance.start(SystemKeyspace.incrementAndGetGeneration(), appStates); &lt;span class=&quot;code-comment&quot;&gt;// needed &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; node-ring gathering.&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Check what incrementAndGetGeneration is doing, if that node is starting, system.local is empty so it will generate its own generation but that generation is ignored in case it is lower than the generations of other nodes which might happen when time is &quot;behind&quot; on the joining node. Are you sure the time is same on all nodes?&lt;/p&gt;</comment>
                            <comment id="17366921" author="josephclay" created="Tue, 22 Jun 2021 01:04:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stefan.miklosovic&quot; class=&quot;user-hover&quot; rel=&quot;stefan.miklosovic&quot;&gt;stefan.miklosovic&lt;/a&gt;&#160;&lt;br/&gt;
We are building cassandra ourselves, the version is actually 3.11.6.1, the last .1 is our build number, i.e. first build (in case we ever need to differentiate multiple builds). I definitely saw NULL for version in system.peers for the joining node, do you think the custom version number causes this? For all UN nodes the version is properly populated.&lt;/p&gt;

&lt;p&gt;Regarding gossip and time, all nodes have NTP which i&apos;m reasonably sure was working correctly at the time.&lt;/p&gt;</comment>
                            <comment id="17367003" author="stefan.miklosovic" created="Tue, 22 Jun 2021 04:23:54 +0000"  >&lt;p&gt;3.11.6.1 should be parsed by CassandraVersion just fine. I ll try couple more times and I might downgrade to 3.11.6 to be exactly on par.&lt;/p&gt;</comment>
                            <comment id="17367549" author="stefan.miklosovic" created="Tue, 22 Jun 2021 17:32:37 +0000"  >&lt;p&gt;I am sorry &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=JosephClay&quot; class=&quot;user-hover&quot; rel=&quot;JosephClay&quot;&gt;JosephClay&lt;/a&gt;, I can not reproduce this.&lt;/p&gt;</comment>
                            <comment id="17425372" author="josephclay" created="Thu, 7 Oct 2021 07:07:58 +0000"  >&lt;p&gt;I was finally able to reproduce. So the issue only reproduces if you configure cassandra so that it uses preferred_ip. You need to set cassandra so that it has two ip address per node and broadcast address a different ip to listen address.&lt;/p&gt;

&lt;p&gt;Here is how i reproduced it in CCM:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;# Set ccm directory here
CCM_DIR=~/.ccm

# create cluster but don&apos;t start it
ccm create test -v 3.11.11 -n 3

# Configure cluster to use GossipingPropertyFileSnitch with prefer_local and different ips for broadcast and listen addresses
rm $CCM_DIR/test/node*/conf/cassandra-topology.properties
sed -i &apos;s/# prefer_local=true/prefer_local=true/&apos; $CCM_DIR/test/node*/conf/cassandra-rackdc.properties
sed -i &apos;s/endpoint_snitch.*/endpoint_snitch: GossipingPropertyFileSnitch/&apos; $CCM_DIR/test/node*/conf/cassandra.yaml
sed -i &apos;s/  - seeds:.*/  - seeds: 127.0.1.1/&apos; $CCM_DIR/test/node*/conf/cassandra.yaml
echo &apos;broadcast_address: 127.0.1.1&apos; &amp;gt;&amp;gt; $CCM_DIR/test/node1/conf/cassandra.yaml
echo &apos;broadcast_address: 127.0.1.2&apos; &amp;gt;&amp;gt; $CCM_DIR/test/node2/conf/cassandra.yaml
echo &apos;broadcast_address: 127.0.1.3&apos; &amp;gt;&amp;gt; $CCM_DIR/test/node3/conf/cassandra.yaml
echo &apos;listen_on_broadcast_address: true&apos; &amp;gt;&amp;gt; $CCM_DIR/test/node1/conf/cassandra.yaml
echo &apos;listen_on_broadcast_address: true&apos; &amp;gt;&amp;gt; $CCM_DIR/test/node2/conf/cassandra.yaml
echo &apos;listen_on_broadcast_address: true&apos; &amp;gt;&amp;gt; $CCM_DIR/test/node3/conf/cassandra.yaml

# Start nodes1 and 2 need to skip wait as the above config breaks it
ccm node1 start --skip-wait-other-notice
ccm node2 start --skip-wait-other-notice

# Wait for both nodes to be UN then put roughly a GB of data into the cluster
ccm stress write n=5000000

# Slow down streaming so joining takes long enough to see issue then start 3rd node
ccm node1 nodetool setstreamthroughput 1
ccm node2 nodetool setstreamthroughput 1
sed -i &apos;s/auto_bootstrap.*/auto_bootstrap: true/&apos; $CCM_DIR/test/node3/conf/cassandra.yaml
ccm node3 start --skip-wait-other-notice

# Wait for streaming to start then check which node that node3 is streaming off
ccm node3 nodetool netstats
# On my cluster node1 was streaming so i stop &amp;amp; started node 2
ccm node2 stop
ccm node2 start --skip-wait-other-notice&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;After that the restarted node logged this:&lt;br/&gt;
INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2021-10-07 17:54:40,637 ConfiguredLimit.java:108 - Detected peers which do not fully support protocol V4. Capping max negotiable version to V3&lt;/p&gt;

&lt;p&gt;Also if you tried to cqlsh to the restarted node:&lt;br/&gt;
Connection error: (&apos;Unable to connect to any servers&apos;, {&apos;127.0.0.2:9042&apos;: DriverException(&apos;ProtocolError returned from server while using explicitly set client protocol_version 4&apos;)})&lt;/p&gt;

&lt;p&gt;Errors in the node logs corresponding to attempted connection:&lt;br/&gt;
WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;epollEventLoopGroup-2-6&amp;#93;&lt;/span&gt; 2021-10-07 17:56:04,822 NoSpamLogger.java:94 - Protocol exception with client networking: org.apache.cassandra.transport.ProtocolException: Invalid or unsupported protocol version (4); supported versions are (3/v3, 4/v4, 5/v5-beta)&lt;/p&gt;

&lt;p&gt;You can cqlsh if you force the protocol version: cqlsh 127.0.0.2 --protocol-version=3&lt;/p&gt;

&lt;p&gt;Peers table:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; peer      | data_center | host_id                              | preferred_ip | rack  | release_version | rpc_address | schema_version                       | tokens
-----------+-------------+--------------------------------------+--------------+-------+-----------------+-------------+--------------------------------------+--------------------------
 127.0.1.1 |         dc1 | d4d86d82-d12b-4bae-a1a4-7f0ded9d9b79 |    127.0.0.1 | rack1 |         3.11.11 |   127.0.0.1 | d25c2da9-b17e-3aba-8682-6cf063aaca51 | {&apos;-9223372036854775808&apos;}

 127.0.1.3 |        null |                                 null |    127.0.0.3 |  null |            null |        null |                                 null |                     null&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;As you can see node3 the joining node has all nulls except for peer and preferred_ip columns. I believe the null in the release_version column causes the version check to fail.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17425598" author="brandon.williams" created="Thu, 7 Oct 2021 14:31:03 +0000"  >&lt;p&gt;Your analysis looks spot on to me.  I believe the check from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-15193&quot; title=&quot;Add ability to cap max negotiable protocol version&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-15193&quot;&gt;&lt;del&gt;CASSANDRA-15193&lt;/del&gt;&lt;/a&gt; is seeing the unknown version and capping the protocol. One possible way to solve this may be to get of preferred_ip altogether, an idea I&apos;ve floated on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16718&quot; title=&quot;Changing listen_address with prefer_local may lead to issues&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16718&quot;&gt;&lt;del&gt;CASSANDRA-16718&lt;/del&gt;&lt;/a&gt;, which is another problem regarding it. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=samt&quot; class=&quot;user-hover&quot; rel=&quot;samt&quot;&gt;samt&lt;/a&gt; wdyt?&lt;/p&gt;</comment>
                            <comment id="17497361" author="smiklosovic" created="Thu, 24 Feb 2022 12:17:26 +0000"  >&lt;p&gt;After my analysis I think it is enough if we just filter out versions which are null from here&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
         &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; enforceV3Cap = SystemKeyspace.loadPeerVersions()
                                                 .values()
                                                 .stream()
                                                 .anyMatch(v -&amp;gt; v.compareTo(MIN_VERSION_FOR_V4) &amp;lt; 0);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I have tried it manually and it will not hit that bug again.&lt;/p&gt;

&lt;p&gt;This should be done for 3.0 and 3.11. I ll provide patch soon.&lt;/p&gt;</comment>
                            <comment id="17499615" author="smiklosovic" created="Tue, 1 Mar 2022 15:43:02 +0000"  >&lt;p&gt;PR: &lt;a href=&quot;https://github.com/apache/cassandra/pull/1465&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/1465&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;build: &lt;a href=&quot;https://app.circleci.com/pipelines/github/instaclustr/cassandra/769/workflows/c3892242-fe82-449f-85e5-0e6bcdaae5c3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/instaclustr/cassandra/769/workflows/c3892242-fe82-449f-85e5-0e6bcdaae5c3&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt;&#160; would you mind to review?&lt;/p&gt;</comment>
                            <comment id="17499639" author="brandon.williams" created="Tue, 1 Mar 2022 16:29:47 +0000"  >&lt;p&gt;I think the real issue here is that we&apos;ve allowed a null release_version that never gets resolved, and this patch works around that by ignoring unset versions.  That said, we&apos;ve released versions that do this, so working around it seems like the only solution.  Can we add a test for this?&lt;/p&gt;</comment>
                            <comment id="17499664" author="smiklosovic" created="Tue, 1 Mar 2022 17:20:33 +0000"  >&lt;p&gt;I&apos;ve already tested this as well my colleagues and they are saying it just works as expected. Given how complex the test is going to be, I am admitting I am quite hesitant to spend too much time on this. Additioanlly, I am not completely sure what test I should write, in-jvm dtest or python one? There is a lot of moving parts here and I am afraid I am going to introduce another flaky eventually.&lt;/p&gt;

&lt;p&gt;Or maybe I could narrow down the scope of the test to test just stuff around ConfigLimit? What is your opinion on the scope the test should cover here?&lt;/p&gt;</comment>
                            <comment id="17502394" author="brandon.williams" created="Mon, 7 Mar 2022 16:24:27 +0000"  >&lt;p&gt;I guess you&apos;re right, this is a little tricky to test since you really need to be able to control gossip states to reproduce and then check the client protocol.  I&apos;d still like &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=samt&quot; class=&quot;user-hover&quot; rel=&quot;samt&quot;&gt;samt&lt;/a&gt; to take a look, but I&apos;m +1.&lt;/p&gt;</comment>
                            <comment id="17502550" author="smiklosovic" created="Mon, 7 Mar 2022 20:49:43 +0000"  >&lt;p&gt;I think the ultimate explanation why this is happening is like this (maybe handy for future readers / for reference)&lt;/p&gt;

&lt;p&gt;In Gossipper#applyStateLocally, it gets to:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (IEndpointStateChangeSubscriber subscriber : subscribers)
    subscriber.onJoin(ep, epState);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;One of subscribers is ReconnectableSnitchHelper, which will eventually call &quot;SystemKeyspace.updatePreferredIP&quot; which will write only peer and preferred ip. So for a joining node, it will insert only peer and preferred ip hence all other fields are null.&lt;/p&gt;

&lt;p&gt;Then, we kind of assume that the node will join, all is streamed etc. Once / upon it is fully joined, all other fields are populated so when another subscriber is triggered calling its onJoin again, the capping logic where it currently fails is called and it will do all the happy path with version populated and so on.&lt;/p&gt;

&lt;p&gt;However, if we stop the node while some other node is joining a cluster, once we restart it, we hit this bug, because only the first subscriber has managed to be called so other subscriber with capping logic will see nulls because nothing has updated them - because we just stopped it while other node was joining.&lt;/p&gt;

&lt;p&gt;Basically, we introduced nulls, never managed to fill the columns with non-nulls and the node crashed so restarted node sees nulls again and the capping logic will go south because it expects all stuff to be fully populated, which didnt happen, due to the node&apos;s failure.&lt;/p&gt;</comment>
                            <comment id="17502866" author="beobal" created="Tue, 8 Mar 2022 11:13:40 +0000"  >&lt;p&gt;Yeah, I don&apos;t really see another way around this bug in the short term, so I&apos;m +1 on the proposed patch.&lt;/p&gt;</comment>
                            <comment id="17503209" author="smiklosovic" created="Tue, 8 Mar 2022 22:41:25 +0000"  >&lt;p&gt;3.0 &lt;a href=&quot;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch/1481/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch/1481/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;3.11 &lt;a href=&quot;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch/1480/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch/1480/&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[smiklosovic]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12969"><![CDATA[User Report]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13101"><![CDATA[Clients]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 36 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0ornc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
        <customfieldvalue><![CDATA[samt]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12344930">3.0.19</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/4a15c5ad5a1a6b29be9aac6a8133f4dd936e1379&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/4a15c5ad5a1a6b29be9aac6a8133f4dd936e1379&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;manual test&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>