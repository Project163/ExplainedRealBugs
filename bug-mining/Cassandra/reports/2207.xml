<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:38:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-5668] NPE in net.OutputTcpConnection when tracing is enabled</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-5668</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I get multiple NullPointerException when trying to trace INSERT statements.&lt;/p&gt;

&lt;p&gt;To reproduce:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$ ccm create -v git:trunk
$ ccm populate -n 3
$ ccm start
$ ccm node1 cqlsh &amp;lt; 5668_npe_ddl.cql
$ ccm node1 cqlsh &amp;lt; 5668_npe_insert.cql
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And see many exceptions like this in the logs of node1:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [WRITE-/127.0.0.3] 2013-06-19 14:54:35,885 OutboundTcpConnection.java (line 197) error writing to /127.0.0.3
java.lang.NullPointerException
        at org.apache.cassandra.net.OutboundTcpConnection.writeConnected(OutboundTcpConnection.java:182)
        at org.apache.cassandra.net.OutboundTcpConnection.run(OutboundTcpConnection.java:144)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;This is similar to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5658&quot; title=&quot;TracingStage frequently times out&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5658&quot;&gt;&lt;del&gt;CASSANDRA-5658&lt;/del&gt;&lt;/a&gt; and is the reason that npe_ddl and npe_insert are separate files.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12653785">CASSANDRA-5668</key>
            <summary>NPE in net.OutputTcpConnection when tracing is enabled</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="enigmacurry">Ryan McGuire</reporter>
                        <labels>
                            <label>pull-request-available</label>
                            <label>qa-resolved</label>
                    </labels>
                <created>Wed, 19 Jun 2013 19:07:51 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:11 +0000</updated>
                            <resolved>Fri, 21 Jun 2013 19:19:35 +0000</resolved>
                                        <fixVersion>1.2.6</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="13688345" author="enigmacurry" created="Wed, 19 Jun 2013 19:27:05 +0000"  >&lt;p&gt;I&apos;ve tried to introduce sleeps in between INSERTs, even with 30s pauses between them I still see the same in the logs. I have also seen this fail on the very first INSERT.&lt;/p&gt;</comment>
                            <comment id="13688353" author="enigmacurry" created="Wed, 19 Jun 2013 19:32:02 +0000"  >&lt;p&gt;This is what one the traces looks like that failed:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;127.0.0.1	78	Parsing statement	Thrift:1
127.0.0.1	606	Peparing statement	Thrift:1
127.0.0.1	949	Determining replicas &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; mutation	Thrift:1
127.0.0.1	3577	Acquiring switchLock read lock	MutationStage:1
127.0.0.1	3622	Appending to commitlog	MutationStage:1
127.0.0.1	3754	Adding to test memtable	MutationStage:1
127.0.0.1	4936	Sending message to /127.0.0.2	WRITE-/127.0.0.2
127.0.0.2	37	Message received from /127.0.0.1	&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-4
127.0.0.2	562	Acquiring switchLock read lock	MutationStage:1
127.0.0.2	583	Appending to commitlog	MutationStage:1
127.0.0.1	32	Message received from /127.0.0.2	&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-7
127.0.0.2	634	Adding to test memtable	MutationStage:1
127.0.0.2	1033	Enqueuing response to /127.0.0.1	MutationStage:1
127.0.0.2	1217	Sending message to /127.0.0.1	WRITE-/127.0.0.1
127.0.0.1	132	Processing response from /127.0.0.2	RequestResponseStage:3
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With a replication factor of 3 it should be writing to all three nodes (127.0.0.1, 127.0.0.2, and 127.0.0.3) - 127.0.0.3 is conspicuously missing from that trace.&lt;/p&gt;</comment>
                            <comment id="13688431" author="jbellis" created="Wed, 19 Jun 2013 20:46:39 +0000"  >&lt;p&gt;attached additional assert to see where we are trying to trace without setting up the session first&lt;/p&gt;</comment>
                            <comment id="13688530" author="enigmacurry" created="Wed, 19 Jun 2013 22:08:18 +0000"  >&lt;p&gt;I ran with the patch, but I did not see any assertion errors.&lt;/p&gt;</comment>
                            <comment id="13688541" author="jbellis" created="Wed, 19 Jun 2013 22:15:11 +0000"  >&lt;p&gt;Hmm.  Take 2.&lt;/p&gt;</comment>
                            <comment id="13688553" author="enigmacurry" created="Wed, 19 Jun 2013 22:23:06 +0000"  >&lt;p&gt;OK, that prodcued the assertion errors. See attached system.log&lt;/p&gt;

&lt;p&gt;Also, I saw a lot of this in the cqlsh terminal:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;stdin&amp;gt;:9:Request did not complete within rpc_timeout.
&amp;lt;stdin&amp;gt;:10:Request did not complete within rpc_timeout.
&amp;lt;stdin&amp;gt;:11:&lt;span class=&quot;code-quote&quot;&gt;&apos;NoneType&apos;&lt;/span&gt; object is not iterable
&amp;lt;stdin&amp;gt;:12:Request did not complete within rpc_timeout.
&amp;lt;stdin&amp;gt;:13:Request did not complete within rpc_timeout.
&amp;lt;stdin&amp;gt;:14:&lt;span class=&quot;code-quote&quot;&gt;&apos;NoneType&apos;&lt;/span&gt; object is not iterable
&amp;lt;stdin&amp;gt;:15:&lt;span class=&quot;code-quote&quot;&gt;&apos;NoneType&apos;&lt;/span&gt; object is not iterable
&amp;lt;stdin&amp;gt;:16:Request did not complete within rpc_timeout.
&amp;lt;stdin&amp;gt;:17:&lt;span class=&quot;code-quote&quot;&gt;&apos;NoneType&apos;&lt;/span&gt; object is not iterable
&amp;lt;stdin&amp;gt;:18:Request did not complete within rpc_timeout.
&amp;lt;stdin&amp;gt;:19:Request did not complete within rpc_timeout.
&amp;lt;stdin&amp;gt;:20:&lt;span class=&quot;code-quote&quot;&gt;&apos;NoneType&apos;&lt;/span&gt; object is not iterable
&amp;lt;stdin&amp;gt;:21:&lt;span class=&quot;code-quote&quot;&gt;&apos;NoneType&apos;&lt;/span&gt; object is not iterable
&amp;lt;stdin&amp;gt;:22:&lt;span class=&quot;code-quote&quot;&gt;&apos;NoneType&apos;&lt;/span&gt; object is not iterable
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; </comment>
                            <comment id="13688569" author="jbellis" created="Wed, 19 Jun 2013 22:32:02 +0000"  >&lt;p&gt;So, .2 is sending two messages for this session, and the first is deleting the session when it&apos;s done.  (We know that the session is getting created correctly since the first patch, that checks at message send time, works fine.)&lt;/p&gt;

&lt;p&gt;The part I don&apos;t understand is, why two messages from .2?  There should only be one (responding to .1).&lt;/p&gt;

&lt;p&gt;(This could be problematic for cross-dc replication, although so far tracing seems to be working for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5632&quot; title=&quot;Cross-DC bandwidth-saving broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5632&quot;&gt;&lt;del&gt;CASSANDRA-5632&lt;/del&gt;&lt;/a&gt;.  But for same-dc, one message per replica should be straightforward.)&lt;/p&gt;</comment>
                            <comment id="13688581" author="jbellis" created="Wed, 19 Jun 2013 22:44:16 +0000"  >&lt;p&gt;Are we actually creating multiple sessions?&lt;/p&gt;

&lt;p&gt;Edit: Yes.&lt;/p&gt;</comment>
                            <comment id="13688866" author="jbellis" created="Thu, 20 Jun 2013 04:49:38 +0000"  >&lt;p&gt;Okay, here&apos;s what&apos;s happening.  I added logging of session cleanup:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; INFO [Thrift:1] 2013-06-19 23:36:51,719 Tracing.java (line 176) session 0702a620-d963-11e2-832d-53376523a4a2 is complete

java.lang.AssertionError: Asked to trace TYPE:MUTATION VERB:MUTATION for session 0702a620-d963-11e2-832d-53376523a4a2 but that state does not exist
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;cqlsh is requesting QUORUM CL (or ONE?) so once that&apos;s achieved the coordinator sends success to the client and closes the tracing session.&lt;/p&gt;

&lt;p&gt;if other messages have not yet gone out, then we error.&lt;/p&gt;

&lt;p&gt;But it gets worse...&lt;/p&gt;

&lt;p&gt;Once the coordinator&apos;s state is discarded, any late-arriving replies will create a new, &quot;non-local&quot; session.  Since the coordinator will not send any messages again for this session &amp;#8211; which is the trigger we use on replicas to indicate &quot;we&apos;re done&quot; &amp;#8211; the nonlocal session will persist indefinitely, &quot;leaking&quot; memory.&lt;/p&gt;

&lt;p&gt;I think we can solve both of these:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Make a static TraceState method that only needs the sessionid to be passed in to log an event.  OTC can use this to avoid having to look up tracestate at all; if it&apos;s cleared out, not a problem.&lt;/li&gt;
	&lt;li&gt;Make Tracing.sessions an expiring map so sessions we don&apos;t clean up manually still get removed&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Alternatively we could just go with #2 by itself and not try to cleanup manually at all.  Average case memory used will be worse, but maybe that is okay since we assume only a tiny fraction of requests are traced at all.&lt;/p&gt;

&lt;p&gt;What do you think &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="13689015" author="slebresne" created="Thu, 20 Jun 2013 08:38:23 +0000"  >&lt;p&gt;For what it&apos;s worth, I think that for the 2nd problem, another option might be to make Tracing.initializeMessage behave slightly differently depending on the message type. So if the state doesn&apos;t exist but the message type is a REQUEST_RESPONSE, we could create the state and set it in the threadLocal, but not save it in the global state map.&lt;/p&gt;

&lt;p&gt;It&apos;s a bit of a hack though, but it slightly bother me to leave this to expiration either so .... &lt;/p&gt;</comment>
                            <comment id="13689330" author="jbellis" created="Thu, 20 Jun 2013 15:25:15 +0000"  >&lt;p&gt;Good idea to check for REQUEST_RESPONSE, although it&apos;s not quite as easy as it sounds since we still need to be able to inject the TraceState into the executor stage.  Patch attached.&lt;/p&gt;

&lt;p&gt;(Note that once the session is closed we won&apos;t know elapsed time anymore.  I don&apos;t see a good way around this.)&lt;/p&gt;</comment>
                            <comment id="13690138" author="slebresne" created="Fri, 21 Jun 2013 08:46:28 +0000"  >&lt;p&gt;I don&apos;t think this patch can be committed as is: in both TracingExecutorService and ExpiredTracingState, the package declaration is before the license header, and I can&apos;t let that slide.&lt;/p&gt;

&lt;p&gt;But with that fixed, +1.&lt;/p&gt;</comment>
                            <comment id="13690328" author="jbellis" created="Fri, 21 Jun 2013 14:28:18 +0000"  >&lt;p&gt;Fixed and committed. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13690383" author="jbellis" created="Fri, 21 Jun 2013 15:25:55 +0000"  >&lt;p&gt;followup patch to make session cleanup check for REQUEST_RESPONSE instead of local-ness, to keep from destroying session prematurely in RMVH forwarding case.&lt;/p&gt;</comment>
                            <comment id="13690391" author="slebresne" created="Fri, 21 Jun 2013 15:31:41 +0000"  >&lt;p&gt;+1 on that follow up.&lt;/p&gt;</comment>
                            <comment id="13690401" author="jbellis" created="Fri, 21 Jun 2013 15:42:53 +0000"  >&lt;p&gt;committed.&lt;/p&gt;</comment>
                            <comment id="13690403" author="enigmacurry" created="Fri, 21 Jun 2013 15:44:04 +0000"  >&lt;p&gt;The NullPointerException is gone, however, I see an unexpected change in the trace after this commit.&lt;/p&gt;

&lt;p&gt;Prior to the patch, I do this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$ ccm create 5668
Current cluster is now: 5668
$ ccm populate -n 2:2
$ ccm start
$ ccm node1 cqlsh
Connected to 5668 at 127.0.0.1:9160.
[cqlsh 4.0.0 | Cassandra 2.0-SNAPSHOT | CQL spec 3.1.0 | Thrift protocol 19.37.0]
Use HELP &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; help.
cqlsh&amp;gt; CREATE KEYSPACE test WITH replication = {&lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;NetworkTopologyStrategy&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;dc1&apos;&lt;/span&gt;:2, &lt;span class=&quot;code-quote&quot;&gt;&apos;dc2&apos;&lt;/span&gt;:2};
cqlsh&amp;gt; CREATE TABLE test.test (id &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; PRIMARY KEY, value text);
cqlsh&amp;gt; tracing on;
Now tracing requests.
cqlsh&amp;gt; INSERT INTO test.test (id, value) VALUES ( 5, &lt;span class=&quot;code-quote&quot;&gt;&apos;asdf&apos;&lt;/span&gt;);

Tracing session: 5d3bdaa0-da87-11e2-9eaa-35db2404c433

 activity                                                       | timestamp    | source    | source_elapsed
----------------------------------------------------------------+--------------+-----------+----------------
                                             execute_cql3_query | 11:29:29,423 | 127.0.0.1 |              0
 Parsing INSERT INTO test.test (id, value) VALUES ( 5, &lt;span class=&quot;code-quote&quot;&gt;&apos;asdf&apos;&lt;/span&gt;); | 11:29:29,424 | 127.0.0.1 |           1082
                                             Peparing statement | 11:29:29,425 | 127.0.0.1 |           2241
                              Determining replicas &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; mutation | 11:29:29,425 | 127.0.0.1 |           2617
                                  Sending message to /127.0.0.2 | 11:29:29,432 | 127.0.0.1 |           9321
                                 Acquiring switchLock read lock | 11:29:29,433 | 127.0.0.1 |          10376
                                         Appending to commitlog | 11:29:29,433 | 127.0.0.1 |          10424
                                        Adding to test memtable | 11:29:29,433 | 127.0.0.1 |          10544
                                  Sending message to /127.0.0.3 | 11:29:29,435 | 127.0.0.1 |          12658
                               Message received from /127.0.0.1 | 11:29:29,436 | 127.0.0.2 |            102
                               Message received from /127.0.0.1 | 11:29:29,438 | 127.0.0.3 |            103
                        Enqueuing forwarded write to /127.0.0.4 | 11:29:29,441 | 127.0.0.3 |           3596
                                 Acquiring switchLock read lock | 11:29:29,441 | 127.0.0.3 |           3686
                                         Appending to commitlog | 11:29:29,441 | 127.0.0.3 |           3704
                                 Acquiring switchLock read lock | 11:29:29,442 | 127.0.0.2 |           5768
                                        Adding to test memtable | 11:29:29,442 | 127.0.0.3 |           3759
                                         Appending to commitlog | 11:29:29,442 | 127.0.0.2 |           5821
                                  Sending message to /127.0.0.4 | 11:29:29,442 | 127.0.0.3 |           3834
                                        Adding to test memtable | 11:29:29,442 | 127.0.0.2 |           5896
                               Enqueuing response to /127.0.0.1 | 11:29:29,442 | 127.0.0.3 |           4307
                               Enqueuing response to /127.0.0.1 | 11:29:29,443 | 127.0.0.2 |           6602
                               Message received from /127.0.0.3 | 11:29:29,444 | 127.0.0.4 |             92
                                  Sending message to /127.0.0.1 | 11:29:29,444 | 127.0.0.2 |           8037
                               Message received from /127.0.0.2 | 11:29:29,445 | 127.0.0.1 |             36
                            Processing response from /127.0.0.2 | 11:29:29,445 | 127.0.0.1 |            147
                                 Acquiring switchLock read lock | 11:29:29,452 | 127.0.0.4 |           8791
                                         Appending to commitlog | 11:29:29,452 | 127.0.0.4 |           8835
                                        Adding to test memtable | 11:29:29,452 | 127.0.0.4 |           8897
                               Enqueuing response to /127.0.0.1 | 11:29:29,453 | 127.0.0.4 |           9542
                                  Sending message to /127.0.0.1 | 11:29:29,454 | 127.0.0.4 |          10021
                               Message received from /127.0.0.4 | 11:29:29,454 | 127.0.0.1 |           9660
                            Processing response from /127.0.0.4 | 11:29:29,455 | 127.0.0.1 |           9804
                                               Request complete | 11:29:29,435 | 127.0.0.1 |          12668
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That&apos;s a 2x2 multi-dc cluster with a RF of 2 in each dc. I write a single INSERT and I see four nodes append to their commit log. All is well.&lt;/p&gt;

&lt;p&gt;After the patch, I see this trace:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Tracing session: c3da4d00-da87-11e2-9a95-35db2404c433

 activity                                                       | timestamp    | source    | source_elapsed
----------------------------------------------------------------+--------------+-----------+----------------
                                             execute_cql3_query | 11:32:21,587 | 127.0.0.1 |              0
 Parsing INSERT INTO test.test (id, value) VALUES ( 5, &lt;span class=&quot;code-quote&quot;&gt;&apos;asdf&apos;&lt;/span&gt;); | 11:32:21,587 | 127.0.0.1 |            495
                                             Peparing statement | 11:32:21,588 | 127.0.0.1 |            962
                              Determining replicas &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; mutation | 11:32:21,588 | 127.0.0.1 |           1108
                                  Sending message to /127.0.0.2 | 11:32:21,590 | 127.0.0.1 |           3341
                                  Sending message to /127.0.0.3 | 11:32:21,590 | 127.0.0.1 |           3920
                               Message received from /127.0.0.1 | 11:32:21,592 | 127.0.0.2 |             91
                               Message received from /127.0.0.1 | 11:32:21,593 | 127.0.0.3 |             93
                                 Acquiring switchLock read lock | 11:32:21,593 | 127.0.0.2 |           1398
                                         Appending to commitlog | 11:32:21,593 | 127.0.0.2 |           1447
                                        Adding to test memtable | 11:32:21,593 | 127.0.0.2 |           1517
                        Enqueuing forwarded write to /127.0.0.4 | 11:32:21,594 | 127.0.0.3 |           1266
                               Enqueuing response to /127.0.0.1 | 11:32:21,594 | 127.0.0.2 |           2573
                                 Acquiring switchLock read lock | 11:32:21,594 | 127.0.0.3 |           1343
                                         Appending to commitlog | 11:32:21,594 | 127.0.0.3 |           1360
                                        Adding to test memtable | 11:32:21,594 | 127.0.0.3 |           1412
                               Enqueuing response to /127.0.0.1 | 11:32:21,595 | 127.0.0.3 |           2060
                               Message received from /127.0.0.2 | 11:32:21,595 | 127.0.0.1 |           &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
                                  Sending message to /127.0.0.1 | 11:32:21,595 | 127.0.0.2 |           2850
                                  Sending message to /127.0.0.1 | 11:32:21,595 | 127.0.0.3 |           2442
                            Processing response from /127.0.0.2 | 11:32:21,595 | 127.0.0.1 |           &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
                                  Sending message to /127.0.0.4 | 11:32:21,595 | 127.0.0.3 |           2442
                               Message received from /127.0.0.3 | 11:32:21,595 | 127.0.0.1 |           &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
                            Processing response from /127.0.0.3 | 11:32:21,595 | 127.0.0.1 |           &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
                               Message received from /127.0.0.3 | 11:32:21,597 | 127.0.0.4 |             95
                                 Acquiring switchLock read lock | 11:32:21,598 | 127.0.0.4 |           1040
                                         Appending to commitlog | 11:32:21,598 | 127.0.0.4 |           1087
                                        Adding to test memtable | 11:32:21,598 | 127.0.0.4 |           1391
                               Enqueuing response to /127.0.0.1 | 11:32:21,599 | 127.0.0.4 |           1885
                               Message received from /127.0.0.4 | 11:32:21,600 | 127.0.0.1 |           &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
                                  Sending message to /127.0.0.1 | 11:32:21,600 | 127.0.0.4 |           3290
                            Processing response from /127.0.0.4 | 11:32:21,600 | 127.0.0.1 |           &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
                                               Request complete | 11:32:21,592 | 127.0.0.1 |           5564
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;127.0.0.1 (which also happens to be the coordinator) didn&apos;t write anything to it&apos;s commit log (according to the trace at least). Reproducible on cassandra-1.2 and trunk.&lt;/p&gt;
</comment>
                            <comment id="13690406" author="jbellis" created="Fri, 21 Jun 2013 15:46:27 +0000"  >&lt;p&gt;Did you get the followup patch in that?  Should have addressed it.&lt;/p&gt;</comment>
                            <comment id="13690411" author="enigmacurry" created="Fri, 21 Jun 2013 15:51:35 +0000"  >&lt;p&gt;I&apos;ve retested with the second patch, it&apos;s the same.&lt;/p&gt;</comment>
                            <comment id="13690434" author="jbellis" created="Fri, 21 Jun 2013 16:13:46 +0000"  >&lt;p&gt;fix pushed in 110d283afd780774a44368b17177b5e8e781e37f&lt;/p&gt;</comment>
                            <comment id="13690441" author="enigmacurry" created="Fri, 21 Jun 2013 16:21:22 +0000"  >&lt;p&gt;That works in cassandra-1.2 - if you commit to trunk, I&apos;ll test there too.&lt;/p&gt;</comment>
                            <comment id="13690537" author="jbellis" created="Fri, 21 Jun 2013 18:09:48 +0000"  >&lt;p&gt;Merged to trunk.&lt;/p&gt;</comment>
                            <comment id="13690617" author="enigmacurry" created="Fri, 21 Jun 2013 19:19:35 +0000"  >&lt;p&gt;+1 - all my tests are passing now. Thanks!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12653597">CASSANDRA-5658</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12588704" name="5668-assert-2.txt" size="1415" author="jbellis" created="Wed, 19 Jun 2013 22:15:11 +0000"/>
                            <attachment id="12588684" name="5668-assert.txt" size="894" author="jbellis" created="Wed, 19 Jun 2013 20:46:39 +0000"/>
                            <attachment id="12589085" name="5668-followup.txt" size="3364" author="jbellis" created="Fri, 21 Jun 2013 15:25:55 +0000"/>
                            <attachment id="12588666" name="5668-logs.tar.gz" size="7684" author="enigmacurry" created="Wed, 19 Jun 2013 19:11:13 +0000"/>
                            <attachment id="12588856" name="5668.txt" size="22325" author="jbellis" created="Thu, 20 Jun 2013 15:25:15 +0000"/>
                            <attachment id="12588665" name="5668_npe_ddl.cql" size="151" author="enigmacurry" created="Wed, 19 Jun 2013 19:10:19 +0000"/>
                            <attachment id="12588664" name="5668_npe_insert.cql" size="1123" author="enigmacurry" created="Wed, 19 Jun 2013 19:10:19 +0000"/>
                            <attachment id="12588710" name="system.log" size="42054" author="enigmacurry" created="Wed, 19 Jun 2013 22:23:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>334062</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 22 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1lmkv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>334388</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311124" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Tester</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>enigmacurry</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>