<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:00:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-10997] cqlsh_copy_tests failing en mass when vnodes are disabled</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-10997</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Check out &lt;a href=&quot;http://cassci.datastax.com/job/cassandra-2.1_novnode_dtest/186/testReport/cqlsh_tests.cqlsh_copy_tests/CqlshCopyTest/test_list_data/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;an example cassci failure&lt;/a&gt; as well as the &lt;a href=&quot;http://cassci.datastax.com/userContent/cstar_report/index.html?jobs=cassandra-2.1_novnode_dtest,cassandra-3.0_novnode_dtest,cassandra-2.2_novnode_dtest&amp;amp;show_known=true&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;full novnode report page&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Many COPY TO tests are failing when the cluster only has one token. The message &lt;tt&gt;Found no ranges to query, check begin and end tokens: None - None&lt;/tt&gt; is printed, and it appears to be coming from cqlsh, specfically in pylib/cqlshlib/copyutil.py&lt;/p&gt;</description>
                <environment></environment>
        <key id="12929250">CASSANDRA-10997</key>
            <summary>cqlsh_copy_tests failing en mass when vnodes are disabled</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stefania">Stefania Alborghetti</assignee>
                                    <reporter username="philipthompson">Philip Thompson</reporter>
                        <labels>
                            <label>dtest</label>
                    </labels>
                <created>Mon, 11 Jan 2016 18:27:06 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:45 +0000</updated>
                            <resolved>Thu, 14 Jan 2016 17:17:43 +0000</resolved>
                                        <fixVersion>2.1.13</fixVersion>
                    <fixVersion>2.2.5</fixVersion>
                    <fixVersion>3.0.3</fixVersion>
                    <fixVersion>3.3</fixVersion>
                                    <component>Legacy/Tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15092434" author="philipthompson" created="Mon, 11 Jan 2016 18:30:52 +0000"  >&lt;p&gt;Bisecting lets me see that this started happening &lt;span class=&quot;error&quot;&gt;&amp;#91;at least for some tests&amp;#93;&lt;/span&gt; on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9303&quot; title=&quot;Match cassandra-loader options in COPY FROM&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9303&quot;&gt;&lt;del&gt;CASSANDRA-9303&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15093847" author="stefania" created="Tue, 12 Jan 2016 13:02:28 +0000"  >&lt;p&gt;Here are the patches and dtests:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.1&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.2&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.0&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.3&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/10997-2.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/10997-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/10997-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/10997-3.3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/10997&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10997-2.1-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10997-2.2-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10997-3.0-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10997-3.3-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10997-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;I&apos;ve run the cqlsh copy dtests with vnodes disabled locally on 2.1. The patch applies to 2.2 onwards. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=philipthompson&quot; class=&quot;user-hover&quot; rel=&quot;philipthompson&quot;&gt;philipthompson&lt;/a&gt; is there a way to run dtests on Jenkins on dev branches with vnodes disabled?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pauloricardomg&quot; class=&quot;user-hover&quot; rel=&quot;pauloricardomg&quot;&gt;pauloricardomg&lt;/a&gt; are you able to take this for review? It shouldn&apos;t take long.&lt;/p&gt;</comment>
                            <comment id="15094370" author="philipthompson" created="Tue, 12 Jan 2016 17:46:34 +0000"  >&lt;p&gt;There is not. I will create one manually.&lt;/p&gt;</comment>
                            <comment id="15094415" author="philipthompson" created="Tue, 12 Jan 2016 18:11:17 +0000"  >&lt;p&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10997-2.1-novnode-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10997-2.1-novnode-dtest/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10997-2.2-novnode-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10997-2.2-novnode-dtest/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10997-3.0-novnode-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10997-3.0-novnode-dtest/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10997-3.3-novnode-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10997-3.3-novnode-dtest/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10997-novnode-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10997-novnode-dtest/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ll be expanding CI so we catch this problem earlier next time.&lt;/p&gt;</comment>
                            <comment id="15095254" author="pauloricardomg" created="Tue, 12 Jan 2016 23:59:30 +0000"  >&lt;p&gt;Fix and cqlsh copy dtests look good. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=philipthompson&quot; class=&quot;user-hover&quot; rel=&quot;philipthompson&quot;&gt;philipthompson&lt;/a&gt; could you just re-trigger the 2.2 non-vnode dtest, as there was a ci problem with this job.&lt;/p&gt;

&lt;p&gt;What I just didn&apos;t get though is why the original problem manifests with &lt;tt&gt;DISABLE_VNODES=true&lt;/tt&gt; but doesn&apos;t happen with &lt;tt&gt;NUM_TOKENS=1&lt;/tt&gt;. Any clues?&lt;/p&gt;</comment>
                            <comment id="15095261" author="pauloricardomg" created="Wed, 13 Jan 2016 00:04:03 +0000"  >&lt;p&gt;Some other non-vnodes dtests did not trigger correctly. Apparently cassci is down, so let&apos;s wait it until returns to re-trigger tests.&lt;/p&gt;</comment>
                            <comment id="15095839" author="stefania" created="Wed, 13 Jan 2016 08:54:04 +0000"  >&lt;p&gt;CI with vnodes disabled looks good to me. Thank you for setting it up &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=philipthompson&quot; class=&quot;user-hover&quot; rel=&quot;philipthompson&quot;&gt;philipthompson&lt;/a&gt;.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;What I just didn&apos;t get though is why the original problem manifests with &lt;tt&gt;DISABLE_VNODES=true&lt;/tt&gt; but doesn&apos;t happen with &lt;tt&gt;NUM_TOKENS=1&lt;/tt&gt;. Any clues?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We can print the ring in &lt;tt&gt;get_ranges()&lt;/tt&gt; to find out. With &lt;tt&gt;DISABLE_VNODES=TRUE&lt;/tt&gt; the ring only contains the minimum token:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;RING: [(&amp;lt;Murmur3Token: -9223372036854775808&amp;gt;, [&amp;lt;Host: 127.0.0.1 datacenter1&amp;gt;])]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With &lt;tt&gt;NUM_TOKENS=1&lt;/tt&gt; the ring contains a valid token:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;RING: [(&amp;lt;Murmur3Token: 4472249940582796662&amp;gt;, [&amp;lt;Host: 127.0.0.1 datacenter1&amp;gt;])]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If you recall in the original code we had a &lt;tt&gt;continue&lt;/tt&gt; statement in the loop to skip the minimum token, hence the problem was only affecting the minimum token, basically no vnodes and only one node in the ring.&lt;/p&gt;</comment>
                            <comment id="15095849" author="stefania" created="Wed, 13 Jan 2016 09:05:16 +0000"  >&lt;p&gt;3.3 and trunk ordinary jobs did not complete, I&apos;ve relaunched them just now.&lt;/p&gt;</comment>
                            <comment id="15096015" author="stefania" created="Wed, 13 Jan 2016 10:56:29 +0000"  >&lt;p&gt;CI completed, LGTM.&lt;/p&gt;</comment>
                            <comment id="15096041" author="pauloricardomg" created="Wed, 13 Jan 2016 11:28:58 +0000"  >&lt;p&gt;Got it, thanks for the explanation! LGTM, marking as ready to commit.&lt;/p&gt;</comment>
                            <comment id="15098298" author="iamaleksey" created="Thu, 14 Jan 2016 15:58:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Stefania&quot; class=&quot;user-hover&quot; rel=&quot;stefania&quot;&gt;Stefania&lt;/a&gt; Can you clarify merge requirements here?&lt;/p&gt;

&lt;p&gt;What branches can be merge automatically, and where should I apply the delta from the branches you provided, or else risk issues?&lt;/p&gt;

&lt;p&gt;My understanding here is that 2.1 and 2.2 patches are different, but the merge into 3.0 -&amp;gt; 3.3 -&amp;gt; trunk should be clean, and the code is identical?&lt;/p&gt;

&lt;p&gt;If so, can you provide an actual patch for 2.2? As a text file, or a 2.2 based branch without a merge commit?&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="15098342" author="stefania" created="Thu, 14 Jan 2016 16:24:56 +0000"  >&lt;p&gt;The only conflict I had was CHANGES.txt from 2.1 to 2.2, the rest should apply automatically.&lt;/p&gt;

&lt;p&gt;All patches are linked above, I repeat here 2.1 and 2.2:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.1&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.2&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/10997-2.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/10997-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15098430" author="iamaleksey" created="Thu, 14 Jan 2016 17:16:29 +0000"  >&lt;p&gt;Alright. Committed as &lt;a href=&quot;https://github.com/apache/cassandra/commit/c42716f2a91ff4e0e8b1ed50eb01edb46978a562&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;c42716f2a91ff4e0e8b1ed50eb01edb46978a562&lt;/a&gt; to 2.1 and merged with 2.2, 3.0, 3.3, and trunk. Thanks.&lt;/p&gt;

&lt;p&gt;FWIW, CHANGES.txt conflicts don&apos;t really count. It&apos;s sufficient for you to specify all the branches that require special treatment - either because there are merge conflicts, or because there are none, but some different changes need to be applied either way.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[stefania]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 44 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2r56v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>pauloricardomg</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[pauloricardomg]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>