<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:49:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-8320] 2.1.2: NullPointerException in SSTableWriter</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-8320</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;After upgrading to 2.1.2, I&apos;ve got tons of these exception in log:&lt;/p&gt;

&lt;p&gt;java.lang.NullPointerException: null&lt;br/&gt;
	at org.apache.cassandra.io.sstable.SSTableWriter.openEarly(SSTableWriter.java:381) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;cassandra-all-2.1.2.jar:2.1.2&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.io.sstable.SSTableRewriter.switchWriter(SSTableRewriter.java:295) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;cassandra-all-2.1.2.jar:2.1.2&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.io.sstable.SSTableRewriter.abort(SSTableRewriter.java:186) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;cassandra-all-2.1.2.jar:2.1.2&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.compaction.CompactionTask.runWith(CompactionTask.java:204) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;cassandra-all-2.1.2.jar:2.1.2&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.io.util.DiskAwareRunnable.runMayThrow(DiskAwareRunnable.java:48) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;cassandra-all-2.1.2.jar:2.1.2&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:28) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;cassandra-all-2.1.2.jar:2.1.2&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.compaction.CompactionTask.executeInternal(CompactionTask.java:75) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;cassandra-all-2.1.2.jar:2.1.2&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.compaction.AbstractCompactionTask.execute(AbstractCompactionTask.java:59) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;cassandra-all-2.1.2.jar:2.1.2&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.cassandra.db.compaction.CompactionManager$BackgroundCompactionTask.run(CompactionManager.java:232) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;cassandra-all-2.1.2.jar:2.1.2&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.7.0_60&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.util.concurrent.FutureTask.run(FutureTask.java:262) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.7.0_60&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.7.0_60&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) &lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.7.0_60&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:745) &lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.7.0_60&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;This error is prepended by the following problems:&lt;/p&gt;

&lt;p&gt;12:59:59.632 &lt;span class=&quot;error&quot;&gt;&amp;#91;NonPeriodicTasks:1&amp;#93;&lt;/span&gt; ERROR o.a.c.io.sstable.SSTableDeletingTask - Unable to delete E:\Upsource_11959\data\cassandra\data\system\schema_keyspaces-b0f2235744583cdb9631c43e59ce3676\system-schema_keyspaces-ka-4-Data.db (it will be removed on server restart; we&apos;ll also retry after GC)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12755386">CASSANDRA-8320</key>
            <summary>2.1.2: NullPointerException in SSTableWriter</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="marcuse">Marcus Eriksson</assignee>
                                    <reporter username="xvost">Evgeny Pasynkov</reporter>
                        <labels>
                    </labels>
                <created>Fri, 14 Nov 2014 15:14:26 +0000</created>
                <updated>Wed, 15 Oct 2025 09:49:06 +0000</updated>
                            <resolved>Sat, 29 Nov 2014 07:23:08 +0000</resolved>
                                        <fixVersion>2.1.3</fixVersion>
                                    <component>Legacy/Local Write-Read Paths</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14212367" author="krummas" created="Fri, 14 Nov 2014 15:18:27 +0000"  >&lt;p&gt;upgrading to 2.1.2 from what?&lt;/p&gt;</comment>
                            <comment id="14212375" author="xvost" created="Fri, 14 Nov 2014 15:24:10 +0000"  >&lt;p&gt;From 2.1.0 (So, this exception didn&apos;t occurred in 2.1.0)&lt;br/&gt;
The database is re-created from scratch using 2.1.2&lt;/p&gt;</comment>
                            <comment id="14212413" author="krummas" created="Fri, 14 Nov 2014 16:03:48 +0000"  >&lt;p&gt;ok, this happens when we call abort() on the SSTableWriter after calling finish() on it (typically, finish() throws exception, we then call abort() on the writer)&lt;/p&gt;</comment>
                            <comment id="14222780" author="krummas" created="Mon, 24 Nov 2014 08:28:36 +0000"  >&lt;p&gt;attaching patch to properly handle abort&lt;/p&gt;

&lt;p&gt;had to add a &apos;sharesBfWith&apos; field to SSTR, since we have not yet replaced the file, but we do share the bloom filter, otherwise we will close the bf when removing the tmplink file and fail removing the finished file&lt;/p&gt;</comment>
                            <comment id="14225364" author="jmckenzie" created="Tue, 25 Nov 2014 23:13:10 +0000"  >&lt;p&gt;+1, though I&apos;m hesitant that we&apos;re going further down the road of interrelationships between SSTableReaders w/regards to the resources they&apos;re reference counted to protect.  Right now we have replaces, replacedBy, both of which are protected behind a shared replaceLock on a linked-list chain of SSTableReaders, and now we&apos;re adding the (admittedly temporally short) notion of sharesBfWith.&lt;/p&gt;

&lt;p&gt;ISTM that we might be better served with a centralized keeper of &quot;ref counted low-level resources&quot; w/atomicity and self-deletion/release rather than trying to maintain locking guarantees across multiple SSTableReaders in a chain and maintaining these relationships between them, all for the purpose of cleanup.  This business of shuffling around who owns the closing of what resource in tidy() by checking all of these flags is proving to be a pain point.&lt;/p&gt;

&lt;p&gt;Either way - this looks like it should address the current problem here.&lt;/p&gt;</comment>
                            <comment id="14226306" author="krummas" created="Wed, 26 Nov 2014 15:24:15 +0000"  >&lt;p&gt;committed&lt;/p&gt;

&lt;p&gt;agree that it is pretty hard to reason about and that we should try to simplify, but lets do that in a new ticket&lt;/p&gt;</comment>
                            <comment id="14228612" author="dbrosius" created="Sat, 29 Nov 2014 03:13:59 +0000"  >&lt;p&gt;Please check: SSTableRewriter: 372&lt;/p&gt;

&lt;p&gt;finishAndThrow collects replace readers in the local collection &apos;toReplace&apos;  similarly to the finish method, but does nothing with this collection unlike the finish method. Should it? if not, there&apos;s no reason to collect them.&lt;/p&gt;</comment>
                            <comment id="14228663" author="krummas" created="Sat, 29 Nov 2014 07:23:08 +0000"  >&lt;p&gt;finishAndThrow() is supposed to only be copy and pasted from finish() with added throw statements in order to be able to test abort(), guess we could do something more fancy but imo it is not worth spending time on&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12683293" name="8320.patch" size="18464" author="marcuse" created="Mon, 24 Nov 2014 08:28:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 51 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i22dwn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>joshuamckenzie</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[joshuamckenzie]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12328841">2.1.2</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>