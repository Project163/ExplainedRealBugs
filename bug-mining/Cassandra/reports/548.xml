<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:17:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-1670] cannot move a node</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-1670</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;two node cluster (node0, node1).  node0 is listed as the only seed on both nodes.  Listen addresses explicitly set to an IP on both nodes. No initial token, no autobootstrap (but see below).  Bring up the ring.  Everything is fine on both nodes.&lt;/p&gt;

&lt;p&gt;decom node1.  verify decom completed correctly by reading the logs on both nodes.  rm all data/logs on node1.  bring node1 up again.&lt;/p&gt;

&lt;p&gt;One of two things happen:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;node0 thinks it is in a ring by itself, node1 thinks both nodes are in the ring.&lt;/li&gt;
	&lt;li&gt;both node0 and node1 think they are in rings by themselves&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;If you restart node0 after decom, it appears to work normally.&lt;/p&gt;

&lt;p&gt;Similar issues seem to present if you kill node1 (either when autobootstrapping before it completes or after it is in the ring) and removetoken.&lt;/p&gt;
</description>
                <environment>&lt;p&gt;RAX&lt;/p&gt;</environment>
        <key id="12478510">CASSANDRA-1670</key>
            <summary>cannot move a node</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gdusbabek">Gary Dusbabek</assignee>
                                    <reporter username="mdennis">Matthew F. Dennis</reporter>
                        <labels>
                    </labels>
                <created>Wed, 27 Oct 2010 22:28:04 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:14 +0000</updated>
                            <resolved>Wed, 3 Nov 2010 13:12:55 +0000</resolved>
                                        <fixVersion>0.7.0 rc 1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="12926469" author="mbulman" created="Fri, 29 Oct 2010 21:38:33 +0000"  >&lt;p&gt;Because move is decommission+bootstrap, the same behavior occurs when moving node1 as well.&lt;/p&gt;</comment>
                            <comment id="12927017" author="gdusbabek" created="Mon, 1 Nov 2010 15:54:54 +0000"  >&lt;p&gt;Looks like this bug goes all the way back to 0.6.&lt;/p&gt;</comment>
                            <comment id="12927021" author="gdusbabek" created="Mon, 1 Nov 2010 15:59:11 +0000"  >&lt;p&gt;The code that removes endpoints from Gossiper.justRemovedEndpoints after RING_DELAY was only getting called if the endpoint had a state attached to it.  Since state is removed for decommissioned nodes, the code was never getting called. &lt;/p&gt;</comment>
                            <comment id="12927025" author="jbellis" created="Mon, 1 Nov 2010 16:06:34 +0000"  >&lt;p&gt;how does moving the removal out of the for loop fix the state-attached-to-it problem?&lt;/p&gt;</comment>
                            <comment id="12927034" author="gdusbabek" created="Mon, 1 Nov 2010 16:38:56 +0000"  >&lt;p&gt;When a node is decommissioned, it gets added to justRemovedEndpoints_, but removed from endpointStateMap_.  The old code will only remove a node from justRemovedEndpoints_ if it currently exists in endpointStateMap_.  If the node stays in justRemovedEndpoints_ (which it will currently), it can never be recognized as part of the ring because of the check in Gossiper.handleNewJoin().&lt;/p&gt;</comment>
                            <comment id="12927198" author="mbulman" created="Mon, 1 Nov 2010 22:47:50 +0000"  >&lt;p&gt;Running from nodetool as well as ripcord decommission code (direct call to StorageService) gets:&lt;/p&gt;

&lt;p&gt;Exception in thread &quot;main&quot; java.lang.AssertionError&lt;br/&gt;
        at org.apache.cassandra.service.StorageService.getLocalToken(StorageService.java:1128)&lt;br/&gt;
        at org.apache.cassandra.service.StorageService.startLeaving(StorageService.java:1527)&lt;br/&gt;
        at org.apache.cassandra.service.StorageService.decommission(StorageService.java:1546)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:616)&lt;br/&gt;
        at com.sun.jmx.mbeanserver.StandardMBeanIntrospector.invokeM2(StandardMBeanIntrospector.java:111)&lt;br/&gt;
        at com.sun.jmx.mbeanserver.StandardMBeanIntrospector.invokeM2(StandardMBeanIntrospector.java:45)&lt;br/&gt;
        at com.sun.jmx.mbeanserver.MBeanIntrospector.invokeM(MBeanIntrospector.java:226)&lt;br/&gt;
        at com.sun.jmx.mbeanserver.PerInterface.invoke(PerInterface.java:138)&lt;br/&gt;
        at com.sun.jmx.mbeanserver.MBeanSupport.invoke(MBeanSupport.java:251)&lt;br/&gt;
        at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.invoke(DefaultMBeanServerInterceptor.java:857)&lt;br/&gt;
        at com.sun.jmx.mbeanserver.JmxMBeanServer.invoke(JmxMBeanServer.java:795)&lt;br/&gt;
        at javax.management.remote.rmi.RMIConnectionImpl.doOperation(RMIConnectionImpl.java:1450)&lt;br/&gt;
        at javax.management.remote.rmi.RMIConnectionImpl.access$200(RMIConnectionImpl.java:90)&lt;br/&gt;
        at javax.management.remote.rmi.RMIConnectionImpl$PrivilegedOperation.run(RMIConnectionImpl.java:1285)&lt;br/&gt;
        at javax.management.remote.rmi.RMIConnectionImpl.doPrivilegedOperation(RMIConnectionImpl.java:1383)&lt;br/&gt;
        at javax.management.remote.rmi.RMIConnectionImpl.invoke(RMIConnectionImpl.java:807)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:616)&lt;br/&gt;
        at sun.rmi.server.UnicastServerRef.dispatch(UnicastServerRef.java:322)&lt;br/&gt;
        at sun.rmi.transport.Transport$1.run(Transport.java:177)&lt;br/&gt;
        at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
        at sun.rmi.transport.Transport.serviceCall(Transport.java:173)&lt;br/&gt;
        at sun.rmi.transport.tcp.TCPTransport.handleMessages(TCPTransport.java:553)&lt;br/&gt;
        at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run0(TCPTransport.java:808)&lt;br/&gt;
        at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run(TCPTransport.java:667)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:636)&lt;/p&gt;</comment>
                            <comment id="12927422" author="gdusbabek" created="Tue, 2 Nov 2010 14:11:27 +0000"  >&lt;p&gt;Mike, can you provide a more complete log?  That trace is unrelated to the patch and likely indicates a different problem.&lt;/p&gt;</comment>
                            <comment id="12927463" author="mbulman" created="Tue, 2 Nov 2010 15:24:35 +0000"  >&lt;p&gt;That&apos;s all I get.  The only other thing I can add is that the node being decommissioned logs &quot;DECOMMISSIONING&quot; when level is set to DEBUG, and that the exception comes back almost immediately.  fwiw, I&apos;m running this on r1029870 of the .7 branch&lt;/p&gt;</comment>
                            <comment id="12927471" author="gdusbabek" created="Tue, 2 Nov 2010 15:34:32 +0000"  >&lt;p&gt;There should be more. What I&apos;m looking for is some indication that the node is not in the middle of a bootstrap operation, which would trigger this exception.&lt;/p&gt;</comment>
                            <comment id="12927484" author="mbulman" created="Tue, 2 Nov 2010 16:34:53 +0000"  >&lt;p&gt;INFO 15:48:22,176 Joining: getting load information                                                                                                                                                                        &lt;br/&gt;
 INFO 15:48:22,177 Sleeping 90000 ms to wait for load information...&lt;br/&gt;
DEBUG 15:48:23,053 GC for ParNew: 12 ms, 15822112 reclaimed leaving 15102720 used; max is 1268449280                                                                                                                        &lt;br/&gt;
DEBUG 15:48:23,166 attempting to connect to /184.106.231.n0&lt;br/&gt;
 INFO 15:48:23,553 Node /184.106.231.n0 is now part of the cluster                                                                                                                                                         &lt;br/&gt;
DEBUG 15:48:23,554 Resetting pool for /184.106.231.n0&lt;br/&gt;
DEBUG 15:48:23,559 Node /184.106.231.n0 state normal, token 104110673354167092736227093944218730763                                                                                                                        &lt;br/&gt;
DEBUG 15:48:23,559 New node /184.106.231.n0 at token 104110673354167092736227093944218730763&lt;br/&gt;
DEBUG 15:48:23,559 clearing cached endpoints                                                                                                                                                                                &lt;br/&gt;
DEBUG 15:48:24,167 attempting to connect to /184.106.231.n0&lt;br/&gt;
DEBUG 15:48:24,169 Disseminating load info ...                                                                                                                                                                              &lt;br/&gt;
 INFO 15:48:24,554 InetAddress /184.106.231.n0 is now UP&lt;br/&gt;
 INFO 15:48:24,554 Started hinted handoff for endpoint /184.106.231.n0                                                                                                                                                  &lt;br/&gt;
 INFO 15:48:24,557 Finished hinted handoff of 0 rows to endpoint /184.106.231.n0&lt;br/&gt;
DEBUG 15:49:24,169 Disseminating load info ...                                                                                                                                                                              &lt;br/&gt;
DEBUG 15:49:39,106 GC for ParNew: 16 ms, 16111512 reclaimed leaving 85537648 used; max is 1268449280&lt;br/&gt;
DEBUG 15:49:52,177 ... got load info                                                                                              &lt;br/&gt;
 INFO 15:49:52,177 Joining: getting bootstrap token&lt;br/&gt;
DEBUG 15:49:52,183 attempting to connect to /184.106.231.n0                                                                                                                                                                &lt;br/&gt;
DEBUG 15:49:52,191 Processing response on a callback from 270@/184.106.231.n0&lt;br/&gt;
 INFO 15:49:52,192 New token will be 19040081623932476870383442086276677899 to assume load from /184.106.231.n0                                                                                                             &lt;br/&gt;
DEBUG 15:49:52,193 clearing cached endpoints&lt;br/&gt;
DEBUG 15:49:52,194 Will try to load mx4j now, if it&apos;s in the classpath                                                                                                                                                      &lt;br/&gt;
 INFO 15:49:52,194 Will not load MX4J, mx4j-tools.jar is not in the classpath&lt;br/&gt;
 INFO 15:49:52,220 Binding thrift service to /0.0.0.0:9160                                                                                                                                                                  &lt;br/&gt;
 INFO 15:49:52,222 Using TFramedTransport with a max frame size of 15728640 bytes.&lt;br/&gt;
 INFO 15:49:52,226 Listening for thrift clients...                                                                                                                                                                          &lt;br/&gt;
DEBUG 15:50:24,170 Disseminating load info ...&lt;br/&gt;
DEBUG 15:50:52,247 DECOMMISSIONING                                                                                                                                                                                          &lt;br/&gt;
DEBUG 15:51:24,170 Disseminating load info ...&lt;br/&gt;
DEBUG 15:52:24,171 Disseminating load info ...                                                                                                                                                                              &lt;/p&gt;


&lt;p&gt;From n0:&lt;/p&gt;

&lt;p&gt;root@ripcord:/usr/src/cassandra/branches/cassandra-0.7# bin/nodetool -h 184.106.231.n0  ring                                                                                                                           &lt;br/&gt;
Address         Status State   Load            Token&lt;br/&gt;
                                       104110673354167092736227093944218730763                                                                                                                                             &lt;br/&gt;
184.106.228.n1 Up     Normal  5.3 KB          19040081623932476870383442086276677899&lt;br/&gt;
184.106.231.n0 Up     Normal  10.27 KB        104110673354167092736227093944218730763                                                                                                                                     &lt;/p&gt;

&lt;p&gt;root@ripcord:/usr/src/cassandra/branches/cassandra-0.7# bin/nodetool -h 184.106.228.n1 decommission &lt;br/&gt;
     &amp;lt;TRACE FROM MY PREVIOUS COMMENT&amp;gt;&lt;/p&gt;

&lt;p&gt;root@ripcord:/usr/src/cassandra/branches/cassandra-0.7# bin/nodetool -h 184.106.231.n0 ring&lt;br/&gt;
Address         Status State   Load            Token                                       &lt;br/&gt;
                                       104110673354167092736227093944218730763    &lt;br/&gt;
184.106.228.n1 Up     Normal  5.3 KB          19040081623932476870383442086276677899      &lt;br/&gt;
184.106.231.n0 Up     Normal  10.27 KB        104110673354167092736227093944218730763     &lt;/p&gt;</comment>
                            <comment id="12927652" author="mbulman" created="Tue, 2 Nov 2010 22:25:28 +0000"  >&lt;p&gt;Ok got it working properly.  Patch fixes the issue described.&lt;/p&gt;

&lt;p&gt;As a node, that patch doesn&apos;t work in 0.7 branch because justRemovedEndPoints_ (.6) is now justRemovedEndpoints (.7).  Not sure how you guys handle that, but the change is simple enough.&lt;/p&gt;</comment>
                            <comment id="12927661" author="jbellis" created="Tue, 2 Nov 2010 22:58:21 +0000"  >&lt;blockquote&gt;&lt;p&gt;The old code will only remove a node from justRemovedEndpoints_ if it currently exists in endpointStateMap_&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Isn&apos;t it &quot;remove from jRE if &lt;em&gt;any&lt;/em&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;other&amp;#93;&lt;/span&gt; node exists in eSM?&quot;  Which means this is only a bug in 2-node clusters?&lt;/p&gt;

&lt;p&gt;+1 if so, just trying to understand.&lt;/p&gt;</comment>
                            <comment id="12927840" author="gdusbabek" created="Wed, 3 Nov 2010 13:07:03 +0000"  >&lt;blockquote&gt;&lt;p&gt;sn&apos;t it &quot;remove from jRE if any &lt;span class=&quot;error&quot;&gt;&amp;#91;other&amp;#93;&lt;/span&gt; node exists in eSM?&quot; Which means this is only a bug in 2-node clusters?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes. good observation.  I&apos;ll only bother committing this to 0.7/trunk then.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12458550" name="1670-0.6.txt" size="1646" author="gdusbabek" created="Mon, 1 Nov 2010 15:59:11 +0000"/>
                            <attachment id="12458552" name="ASF.LICENSE.NOT.GRANTED--v1-0001-code-that-tidied-Gossiper.justRemovedEndpoints_-was-no.txt" size="2102" author="gdusbabek" created="Mon, 1 Nov 2010 16:28:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[gdusbabek]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20250</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 3 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0g6nz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>92510</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>