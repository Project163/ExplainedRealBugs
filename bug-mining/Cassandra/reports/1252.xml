<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:25:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-3388] StorageService.setMode() is used inconsistently</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-3388</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;&lt;tt&gt;StorageService.setMode()&lt;/tt&gt;, which ends up setting the OperationMode attribute of the related mbean, is used inconsistently.  In most places, it&apos;s used like &quot;&lt;tt&gt;setMode(&quot;MODE: details&quot;)&lt;/tt&gt;, but in a few places, it&apos;s used more like a normal log message.&lt;/p&gt;

&lt;p&gt;To make this attribute more usable through JMX, &lt;tt&gt;setMode()&lt;/tt&gt; should have a signature like &lt;tt&gt;setMode(mode, details)&lt;/tt&gt;, where the mode parameter could be an enum (or even just a string, the main thing is just being consistent).  The OperationMode JMX attribute should definitely remain a string, though.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12527840">CASSANDRA-3388</key>
            <summary>StorageService.setMode() is used inconsistently</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="thobbs">Tom Hobbs</reporter>
                        <labels>
                    </labels>
                <created>Wed, 19 Oct 2011 22:45:10 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:48 +0000</updated>
                            <resolved>Fri, 28 Oct 2011 17:23:57 +0000</resolved>
                                        <fixVersion>1.0.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13131099" author="jbellis" created="Wed, 19 Oct 2011 22:50:40 +0000"  >&lt;p&gt;We&apos;re talking about this, right?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void setMode(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; m, &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; log)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Why would we even expose this over JMX?  It&apos;s not intended to be public.&lt;/p&gt;</comment>
                            <comment id="13131153" author="thobbs" created="Wed, 19 Oct 2011 23:26:45 +0000"  >&lt;p&gt;Yes, that&apos;s the method.  Sorry, I forgot that there was also a &quot;log&quot; parameter.&lt;/p&gt;

&lt;p&gt;It&apos;s a fairly reliable way to figure out if a node is joining, moving, decommissioning, or has finished decommissioning.  I&apos;m open to alternative ways of discovering this reliably.  I assumed that&apos;s why this was exposed through JMX in the first place.&lt;/p&gt;</comment>
                            <comment id="13131257" author="jbellis" created="Thu, 20 Oct 2011 01:43:10 +0000"  >&lt;p&gt;I don&apos;t see setMode or getMode in StorageServiceMBean.  I&apos;m lost, how is it exposed through JMX?&lt;/p&gt;</comment>
                            <comment id="13131351" author="thobbs" created="Thu, 20 Oct 2011 04:08:14 +0000"  >&lt;p&gt;It&apos;s named getOperationMode().&lt;/p&gt;</comment>
                            <comment id="13131357" author="jbellis" created="Thu, 20 Oct 2011 04:25:43 +0000"  >&lt;p&gt;Ah, okay.&lt;/p&gt;

&lt;p&gt;setMode isn&apos;t exposed though, which is as it should be since it&apos;s informational only.  Setting it wouldn&apos;t actually change any internal state to match.&lt;/p&gt;</comment>
                            <comment id="13131361" author="thobbs" created="Thu, 20 Oct 2011 04:33:29 +0000"  >&lt;p&gt;Right, I wasn&apos;t suggesting that setMode() be exposed externally at all.  I was merely saying that the way it&apos;s used &lt;em&gt;internally&lt;/em&gt; is inconsistent.  (And since the attribute is readable through JMX, being consistent matters.)&lt;/p&gt;</comment>
                            <comment id="13131739" author="jbellis" created="Thu, 20 Oct 2011 16:31:23 +0000"  >&lt;p&gt;Ah, I get it now.  I was confused by the description of &quot;making this attribute more usable through JMX.&quot;&lt;/p&gt;</comment>
                            <comment id="13135215" author="thobbs" created="Tue, 25 Oct 2011 16:41:43 +0000"  >&lt;p&gt;A couple of comments on v1 of the patch:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;I think you accidentally lower-cased &apos;Leaving&apos; on one line&lt;/li&gt;
	&lt;li&gt;Everything is done consistently now, but I&apos;m a little bit concerned about this being accidentally broken in the future.  Would you mind either splitting the mode (currently just the string prefix) into a separate parameter or at least documenting the setMode() method with a note about how it should be used?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Thanks, Sylvain.&lt;/p&gt;</comment>
                            <comment id="13135258" author="slebresne" created="Tue, 25 Oct 2011 17:27:46 +0000"  >&lt;p&gt;Yeah right. I was going with the &apos;smallest diff&apos; approach but I agree we can make that cleaner. v2 does so by adding a Mode enumeration. A few details (that I think are ok but are worth mentioning):&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;the patch changes the semantic of the getOperationMode JMX attribute to only return the &quot;mode&quot;, not the message part. It can be changed back but I&apos;m not sure the message is really useful outside of the log itself and it feels slightly cleaner that way.&lt;/li&gt;
	&lt;li&gt;the modes are in caps. Again, feels more simple, natural but that can change.&lt;/li&gt;
	&lt;li&gt;I&apos;ve changed the last &quot;mode&quot; from Draining to Drained. Feels more useful/right that way.&lt;/li&gt;
	&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13135330" author="thobbs" created="Tue, 25 Oct 2011 18:52:43 +0000"  >&lt;p&gt;Minor note: &lt;tt&gt;setMode(Mode.DECOMMISSIONED, null, true);&lt;/tt&gt; could omit the &lt;tt&gt;null&lt;/tt&gt; parameter.&lt;/p&gt;

&lt;p&gt;Other than that, it looks perfect to me, and I agree with your thoughts.  Thanks!&lt;/p&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13138564" author="slebresne" created="Fri, 28 Oct 2011 17:23:57 +0000"  >&lt;p&gt;Committed (with suggested minor fix)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12500707" name="3388.patch" size="2780" author="slebresne" created="Tue, 25 Oct 2011 16:17:42 +0000"/>
                            <attachment id="12500725" name="3388_v2.patch" size="9805" author="slebresne" created="Tue, 25 Oct 2011 17:27:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>92099</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 4 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gjaf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>94555</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>thobbs</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thobbs]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>