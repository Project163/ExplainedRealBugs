<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:25:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-17422] Test Failure: org.apache.cassandra.net.OutboundMessageQueueTest.testRemove-cdc</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-17422</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Branch: 4.0&lt;br/&gt;
&lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-4.0/350/testReport/org.apache.cassandra.net/OutboundMessageQueueTest/testRemove_cdc/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-cassandra.apache.org/job/Cassandra-4.0/350/testReport/org.apache.cassandra.net/OutboundMessageQueueTest/testRemove_cdc/&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.NullPointerException
	at org.apache.cassandra.net.OutboundMessageQueueTest.testRemove(OutboundMessageQueueTest.java:91)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Failure: 1 of 3&lt;/p&gt;</description>
                <environment></environment>
        <key id="13432675">CASSANDRA-17422</key>
            <summary>Test Failure: org.apache.cassandra.net.OutboundMessageQueueTest.testRemove-cdc</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bereng">Berenguer Blasi</assignee>
                                    <reporter username="jmckenzie">Josh McKenzie</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Mar 2022 17:04:14 +0000</created>
                <updated>Tue, 12 Sep 2023 13:03:12 +0000</updated>
                            <resolved>Thu, 18 Aug 2022 07:40:45 +0000</resolved>
                                        <fixVersion>4.0.6</fixVersion>
                    <fixVersion>4.1-beta1</fixVersion>
                    <fixVersion>5.0-alpha1</fixVersion>
                    <fixVersion>5.0</fixVersion>
                                    <component>Test/unit</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="17555776" author="shylaja.kokoori@intel.com" created="Fri, 17 Jun 2022 22:17:07 +0000"  >&lt;p&gt;From my analysis, it looks like a timing issue.&lt;/p&gt;

&lt;p&gt;Occasionally in this test, by the time code flow reaches the line&lt;br/&gt;
&lt;em&gt;try (OutboundMessageQueue.WithLock lock = queue.lockOrCallback(0, () -&amp;gt; {}))&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;lock acquired on the queue prior to it has not been released. Therefore, lock has a null value resulting in the &lt;em&gt;NullPointerException&lt;/em&gt;.&lt;br/&gt;
When I added &lt;em&gt;Uninterruptibles.awaitUninterruptibly(lockUntil)&lt;/em&gt; before the line of code mentioned above, test ran for a long time without failing. &lt;/p&gt;

&lt;p&gt;Another option to fix this test, perhaps is to add a callback and check for the content of the queue in the callback.&#160;&lt;/p&gt;</comment>
                            <comment id="17556957" author="brandon.williams" created="Tue, 21 Jun 2022 14:52:12 +0000"  >&lt;p&gt;Could you create a pull request with your fix?&lt;/p&gt;</comment>
                            <comment id="17557745" author="shylaja.kokoori@intel.com" created="Thu, 23 Jun 2022 00:36:57 +0000"  >&lt;p&gt;I have attached a patch for review. Working on pull request&lt;/p&gt;</comment>
                            <comment id="17558184" author="shylaja.kokoori@intel.com" created="Thu, 23 Jun 2022 18:09:22 +0000"  >&lt;p&gt;I have created a pull request with the changes&lt;/p&gt;</comment>
                            <comment id="17558653" author="brandon.williams" created="Fri, 24 Jun 2022 19:09:56 +0000"  >&lt;p&gt;Thanks, I found it and linked it here.  While probably not entirely conclusive, &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/535/workflows/de2720c4-449e-4139-8cb9-006c91919482/jobs/6458/tests&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; are 10k runs unpatched showing the failure and &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/537/workflows/33f08814-afd1-45d3-a471-a512c6594219/jobs/6494&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; is the patched version showing success, and pre-commit runs for &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/536/workflows/265fb05e-5b1a-4c2b-8143-57b02e05ebee&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j8&lt;/a&gt; and &lt;a href=&quot;https://app.circleci.com/pipelines/github/driftx/cassandra/536/workflows/2b676de0-e79e-47bc-ad98-0b2694b05293&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;j11&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benedict&quot; class=&quot;user-hover&quot; rel=&quot;benedict&quot;&gt;benedict&lt;/a&gt; you wrote this test, would you like to review?&lt;/p&gt;</comment>
                            <comment id="17577889" author="bereng" created="Wed, 10 Aug 2022 09:35:45 +0000"  >&lt;p&gt;I think the current PR changes the behavior of the test. Previously we were removing from the queue &lt;em&gt;while&lt;/em&gt; the lock acquired &lt;a href=&quot;https://github.com/apache/cassandra/pull/1777/files#diff-01005beb5774536671b8fed6d3f6b57c90d837257da7581ac12807c234140043R66&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; was being held, whereas in the new PR that is not the case iiuc.&lt;/p&gt;

&lt;p&gt;But I have managed to repro locally with the repeatable runner, just adding to the test class:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;@RunWith(RepeatableRunner.class)
@RepeatableRunnerConfiguration(iterations = 300000)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I have an alternative &lt;a href=&quot;https://github.com/apache/cassandra/pull/1777/files#&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR&lt;/a&gt; which fixes the issue maintaining the original behavior. The explanation being the the call to get the lock the second time &lt;a href=&quot;https://github.com/apache/cassandra/pull/1777/files#diff-01005beb5774536671b8fed6d3f6b57c90d837257da7581ac12807c234140043R92&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; may return null if the autoclosable &lt;a href=&quot;https://github.com/apache/cassandra/pull/1777/files#diff-01005beb5774536671b8fed6d3f6b57c90d837257da7581ac12807c234140043R66&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; hasn&apos;t completed and released the lock in time. Adding a latch to catch that event fixes the test for me.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/pull/1777/files#&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR 4.0&lt;/a&gt; and &lt;a href=&quot;https://app.circleci.com/pipelines/github/bereng/cassandra/723/workflows/dbc40298-6c42-42af-8e4c-9d0c07d2e314/jobs/6507&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CI&lt;/a&gt; + local repro of bug/fix&lt;/p&gt;

&lt;p&gt;Wdyt makes sense? Do you want to create the 4.1, trunk PRs and test them locally or do you prefer I take over?&lt;/p&gt;</comment>
                            <comment id="17580397" author="brandon.williams" created="Tue, 16 Aug 2022 16:35:20 +0000"  >&lt;p&gt;This fell off my radar, but your PR looks good &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Bereng&quot; class=&quot;user-hover&quot; rel=&quot;bereng&quot;&gt;Bereng&lt;/a&gt; if you want to create the other branches and we can close this out.&lt;/p&gt;</comment>
                            <comment id="17580668" author="bereng" created="Wed, 17 Aug 2022 08:29:05 +0000"  >&lt;p&gt;Yep I was waiting for tomorrow, which would be the 1 month mark without any movement, to take it. So I pushed PRs, repro&apos;ed locally the fix and ran only junit on all branches as I don&apos;t think we need to hammer circle 10K per branch having the local repro already. If you +1 I&apos;ll commit.&lt;/p&gt;</comment>
                            <comment id="17580721" author="brandon.williams" created="Wed, 17 Aug 2022 10:36:18 +0000"  >&lt;p&gt;SGTM, +1.&lt;/p&gt;</comment>
                            <comment id="17581207" author="bereng" created="Thu, 18 Aug 2022 07:41:30 +0000"  >&lt;p&gt;Committed. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt; for the review and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=skokoori&quot; class=&quot;user-hover&quot; rel=&quot;skokoori&quot;&gt;skokoori&lt;/a&gt; for the pointers, I added you as a co-author &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17600989" author="shylaja.kokoori@intel.com" created="Tue, 6 Sep 2022 21:05:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bereng&quot; class=&quot;user-hover&quot; rel=&quot;bereng&quot;&gt;bereng&lt;/a&gt; , I was on vacation and did not see your previous comment. Thank you for resolving the issue&lt;/p&gt;</comment>
                            <comment id="17601131" author="bereng" created="Wed, 7 Sep 2022 04:46:01 +0000"  >&lt;p&gt;My pleasure!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13045471" name="CASSANDRA-17422.patch" size="1031" author="skokoori" created="Thu, 23 Jun 2022 00:35:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[bereng]]></customfieldvalue>
        <customfieldvalue><![CDATA[skokoori]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
                                <customfieldvalue key="12990" cascade-level="1"><![CDATA[Test Failure]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12970"><![CDATA[Unit Test]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 9 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12314420" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Mentor</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>brandon.williams</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z10aiw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[bereng]]></customfieldvalue>
        <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12336842">4.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/9f97adf63c67c8671a5477e7fc62dab75326bd6e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/9f97adf63c67c8671a5477e7fc62dab75326bd6e&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;Executed the test &lt;em&gt;OutboundMessageQueueTest.testRemove&lt;/em&gt; more than 100K iterations on my box multiple times&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>