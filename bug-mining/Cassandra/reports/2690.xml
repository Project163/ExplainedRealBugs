<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:43:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6646] Disk Failure Policy ignores CorruptBlockException</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6646</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;If Cassandra is using compression and has a bad drive or stable, it will throw an CorruptBlockException. &lt;br/&gt;
Disk Failure Policy only works if it is an FSError and does not work for IOExceptions like this. &lt;br/&gt;
We need to better handle such exceptions as it causes nodes to not respond to the co-ordinator causing the client to timeout. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12692930">CASSANDRA-6646</key>
            <summary>Disk Failure Policy ignores CorruptBlockException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="marcuse">Marcus Eriksson</assignee>
                                    <reporter username="kohlisankalp">Sankalp Kohli</reporter>
                        <labels>
                    </labels>
                <created>Mon, 3 Feb 2014 19:24:01 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:55 +0000</updated>
                            <resolved>Tue, 18 Mar 2014 07:16:10 +0000</resolved>
                                        <fixVersion>2.0.7</fixVersion>
                    <fixVersion>2.1 beta2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13934752" author="krummas" created="Fri, 14 Mar 2014 08:17:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kohlisankalp&quot; class=&quot;user-hover&quot; rel=&quot;kohlisankalp&quot;&gt;kohlisankalp&lt;/a&gt; do you have a stack trace? It looks to me like we catch all CorruptBlockExceptions and either rethrow them as FSError or CorruptSSTableException&lt;/p&gt;

&lt;p&gt;Attached patch makes CorruptSSTableException extend FSError to make the uncaught exception handler call handleFSError for them as well.&lt;/p&gt;</comment>
                            <comment id="13935373" author="kohlisankalp" created="Fri, 14 Mar 2014 18:14:30 +0000"  >&lt;p&gt;Here is the stack trace. It is CorruptSSTableException which is a problem. &lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage:2257&amp;#93;&lt;/span&gt; xxxxx CassandraDaemon.java (line 191) Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage:2257,5,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
org.apache.cassandra.io.sstable.CorruptSSTableException: org.apache.cassandra.io.compress.CorruptBlockException: (/xx/data/Cassandra/xxxxx/xxxxx/xxxxxxx-166-Data.db): corruption detected, chunk at 148883342 of length 23271.&lt;br/&gt;
       at org.apache.cassandra.io.compress.CompressedRandomAccessReader.reBuffer(CompressedRandomAccessReader.java:89)&lt;br/&gt;
       at org.apache.cassandra.io.util.RandomAccessReader.seek(RandomAccessReader.java:312)&lt;br/&gt;
       at org.apache.cassandra.io.util.PoolingSegmentedFile.getSegment(PoolingSegmentedFile.java:42)&lt;br/&gt;
       at org.apache.cassandra.io.sstable.SSTableReader.getFileDataInput(SSTableReader.java:1048)&lt;br/&gt;
       at org.apache.cassandra.db.columniterator.SimpleSliceReader.&amp;lt;init&amp;gt;(SimpleSliceReader.java:63)&lt;br/&gt;
       at org.apache.cassandra.db.columniterator.SSTableSliceIterator.createReader(SSTableSliceIterator.java:68)&lt;br/&gt;
       at org.apache.cassandra.db.columniterator.SSTableSliceIterator.&amp;lt;init&amp;gt;(SSTableSliceIterator.java:44)&lt;br/&gt;
       at org.apache.cassandra.db.filter.SliceQueryFilter.getSSTableColumnIterator(SliceQueryFilter.java:104)&lt;br/&gt;
       at org.apache.cassandra.db.filter.QueryFilter.getSSTableColumnIterator(QueryFilter.java:68)&lt;br/&gt;
       at org.apache.cassandra.db.CollationController.collectAllData(CollationController.java:272)&lt;br/&gt;
       at org.apache.cassandra.db.CollationController.getTopLevelColumns(CollationController.java:65)&lt;br/&gt;
       at org.apache.cassandra.db.ColumnFamilyStore.getTopLevelColumns(ColumnFamilyStore.java:1391)&lt;br/&gt;
       at org.apache.cassandra.db.ColumnFamilyStore.getColumnFamily(ColumnFamilyStore.java:1207)&lt;br/&gt;
       at org.apache.cassandra.db.ColumnFamilyStore.getColumnFamily(ColumnFamilyStore.java:1123)&lt;br/&gt;
       at org.apache.cassandra.db.Table.getRow(Table.java:347)&lt;br/&gt;
       at org.apache.cassandra.db.SliceFromReadCommand.getRow(SliceFromReadCommand.java:70)&lt;br/&gt;
       at org.apache.cassandra.db.ReadVerbHandler.doVerb(ReadVerbHandler.java:44)&lt;br/&gt;
       at org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:56)&lt;br/&gt;
       at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:895)&lt;br/&gt;
       at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:918)&lt;br/&gt;
       at java.lang.Thread.run(Thread.java:662)&lt;br/&gt;
Caused by: org.apache.cassandra.io.compress.CorruptBlockException: (xxxx-Data.db): corruption detected, chunk at 148883342 of length 23271.&lt;br/&gt;
       at org.apache.cassandra.io.compress.CompressedRandomAccessReader.decompressChunk(CompressedRandomAccessReader.java:120)&lt;br/&gt;
       at org.apache.cassandra.io.compress.CompressedRandomAccessReader.reBuffer(CompressedRandomAccessReader.java:85)&lt;br/&gt;
       ... 20 more&lt;/p&gt;</comment>
                            <comment id="13935396" author="jbellis" created="Fri, 14 Mar 2014 18:22:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iamaleksey&quot; class=&quot;user-hover&quot; rel=&quot;iamaleksey&quot;&gt;iamaleksey&lt;/a&gt; were you deliberately distinguishing CorruptSSTableException from FSError in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2118&quot; title=&quot;Provide failure modes if issues with the underlying filesystem of a node&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2118&quot;&gt;&lt;del&gt;CASSANDRA-2118&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="13935399" author="kohlisankalp" created="Fri, 14 Mar 2014 18:24:52 +0000"  >&lt;p&gt;The patch looks straightforward. The only thing is that now with default setting of stop for disk failure policy, Cassandra will stop on any bad stable. &lt;br/&gt;
Also work done in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2261&quot; title=&quot;During Compaction, Corrupt SSTables with rows that cause failures should be identified and blacklisted.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2261&quot;&gt;&lt;del&gt;CASSANDRA-2261&lt;/del&gt;&lt;/a&gt; will not matter here as Cassandra will stop on any bad stable. &lt;/p&gt;

&lt;p&gt;I would vote for the behavior in this ticket as you should replace your drive on corruption.  &lt;/p&gt;</comment>
                            <comment id="13935453" author="jbellis" created="Fri, 14 Mar 2014 18:58:01 +0000"  >&lt;p&gt;If anything I think we should add another setting (&quot;paranoid?&quot;) that would stop on corrupt sstables, because really that&apos;s a distinct scenario from actual FS errors.&lt;/p&gt;</comment>
                            <comment id="13935657" author="kohlisankalp" created="Fri, 14 Mar 2014 21:19:08 +0000"  >&lt;p&gt;+1&lt;br/&gt;
We might also need to count errors from unique stable and have a threshold for it. &lt;/p&gt;</comment>
                            <comment id="13935936" author="iamaleksey" created="Sat, 15 Mar 2014 02:16:33 +0000"  >&lt;p&gt;CorruptBlockException is not an FSError for a reason, yes. +1 for adding another option to stop on those.&lt;/p&gt;</comment>
                            <comment id="13938096" author="krummas" created="Mon, 17 Mar 2014 17:45:54 +0000"  >&lt;p&gt;add paranoid DiskFailurePolicy for CorruptSSTableExceptions&lt;/p&gt;</comment>
                            <comment id="13938127" author="jbellis" created="Mon, 17 Mar 2014 18:04:10 +0000"  >&lt;p&gt;sorry to bikeshed myself, maybe rename to stop_paranoid to emphasize that it shares behavior with stop?&lt;/p&gt;

&lt;p&gt;where did stopTransports get introduced?  i don&apos;t see it on trunk.&lt;/p&gt;</comment>
                            <comment id="13938131" author="krummas" created="Mon, 17 Mar 2014 18:08:23 +0000"  >&lt;blockquote&gt;&lt;p&gt;rename to stop_paranoid&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;sure&lt;/p&gt;

&lt;p&gt;it was introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6364&quot; title=&quot;There should be different disk_failure_policies for data and commit volumes or commit volume failure should always cause node exit&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6364&quot;&gt;&lt;del&gt;CASSANDRA-6364&lt;/del&gt;&lt;/a&gt; which was a 2.0-only fix, ill add it when i commit this&lt;/p&gt;</comment>
                            <comment id="13938148" author="kohlisankalp" created="Mon, 17 Mar 2014 18:15:46 +0000"  >&lt;p&gt;Let me look at the patch. &lt;/p&gt;</comment>
                            <comment id="13938647" author="kohlisankalp" created="Tue, 18 Mar 2014 01:15:18 +0000"  >&lt;p&gt;The patch looks quite straight forward. This will work for us. &lt;br/&gt;
We might also want to add another option to stop cassandra after we see error in x different stables. &lt;/p&gt;</comment>
                            <comment id="13938695" author="jbellis" created="Tue, 18 Mar 2014 02:13:57 +0000"  >&lt;p&gt;I&apos;m having trouble thinking of a scenario where one error is not enough but two or three is.  Let&apos;s keep it simple?&lt;/p&gt;</comment>
                            <comment id="13938703" author="kohlisankalp" created="Tue, 18 Mar 2014 02:29:12 +0000"  >&lt;p&gt;Sure. We can keep it simple. &lt;/p&gt;</comment>
                            <comment id="13938906" author="krummas" created="Tue, 18 Mar 2014 07:16:10 +0000"  >&lt;p&gt;committed, thanks&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12635124" name="0001-add-paranoid-disk-failure-option.patch" size="3907" author="marcuse" created="Mon, 17 Mar 2014 17:45:54 +0000"/>
                            <attachment id="12634674" name="0001-make-CorruptSSTableException-an-FSError-to-be-able-t.patch" size="1171" author="marcuse" created="Fri, 14 Mar 2014 08:17:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>371516</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 36 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1s107:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>371818</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>kohlisankalp</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[kohlisankalp]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>