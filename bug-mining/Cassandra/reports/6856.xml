<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:34:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-20787] Cassandra crashes on first boot with data_disk_usage_max_disk_size set when data directory is not created</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-20787</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;When starting a new node whose data directory is not yet created (e.g. $CASSANDRA_HOME/data/data) , and data_disk_usage_max_disk_size set to any value Cassandra will crash with the following exception:&lt;/p&gt;

&lt;p&gt;ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2025-07-14 15:34:21,880 CassandraDaemon.java:900 - Exception encountered during startup&lt;/p&gt;

&lt;p&gt;java.lang.RuntimeException: Cannot get data directories grouped by file store&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at org.apache.cassandra.service.disk.usage.DiskUsageMonitor.dataDirectoriesGroupedByFileStore(DiskUsageMonitor.java:202)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at org.apache.cassandra.service.disk.usage.DiskUsageMonitor.totalDiskSpace(DiskUsageMonitor.java:209)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at org.apache.cassandra.config.GuardrailsOptions.validateDataDiskUsageMaxDiskSize(GuardrailsOptions.java:786)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at org.apache.cassandra.config.GuardrailsOptions.&amp;lt;init&amp;gt;(GuardrailsOptions.java:83)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at org.apache.cassandra.config.DatabaseDescriptor.applyGuardrails(DatabaseDescriptor.java:1000)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at org.apache.cassandra.config.DatabaseDescriptor.applyAll(DatabaseDescriptor.java:396)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at org.apache.cassandra.config.DatabaseDescriptor.daemonInitialization(DatabaseDescriptor.java:204)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at org.apache.cassandra.config.DatabaseDescriptor.daemonInitialization(DatabaseDescriptor.java:188)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at org.apache.cassandra.service.CassandraDaemon.applyConfig(CassandraDaemon.java:797)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at org.apache.cassandra.service.CassandraDaemon.activate(CassandraDaemon.java:740)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at org.apache.cassandra.service.CassandraDaemon.main(CassandraDaemon.java:878)&lt;/p&gt;

&lt;p&gt;Caused by: java.nio.file.NoSuchFileException: /path/to/data&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at java.base/sun.nio.fs.UnixException.translateToIOException(UnixException.java:92)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at java.base/sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:111)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at java.base/sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:116)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at java.base/sun.nio.fs.UnixFileStore.devFor(UnixFileStore.java:61)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at java.base/sun.nio.fs.UnixFileStore.&amp;lt;init&amp;gt;(UnixFileStore.java:68)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at java.base/sun.nio.fs.LinuxFileStore.&amp;lt;init&amp;gt;(LinuxFileStore.java:49)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at java.base/sun.nio.fs.LinuxFileSystemProvider.getFileStore(LinuxFileSystemProvider.java:51)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at java.base/sun.nio.fs.LinuxFileSystemProvider.getFileStore(LinuxFileSystemProvider.java:39)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at java.base/sun.nio.fs.UnixFileSystemProvider.getFileStore(UnixFileSystemProvider.java:373)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at java.base/java.nio.file.Files.getFileStore(Files.java:1488)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at org.apache.cassandra.service.disk.usage.DiskUsageMonitor.dataDirectoriesGroupedByFileStore(DiskUsageMonitor.java:196)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;... 10 common frames omitted&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;This happens because DatabaseDescriptor#applyGuardrails() is called before any calls to DatabaseDescriptor#createAllDirectories occurs. Calling createAllDirectories before the call to applyGuardrails fixes this issue.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Reproduction steps:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Set a value in cassandra.yaml for data_disk_usage_max_disk_size&lt;/li&gt;
	&lt;li&gt;Start cassandra bin/cassandra -f&lt;/li&gt;
	&lt;li&gt;The crash should be observed on startup.&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="13624637">CASSANDRA-20787</key>
            <summary>Cassandra crashes on first boot with data_disk_usage_max_disk_size set when data directory is not created</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="isaacreath">Isaac Reath</assignee>
                                    <reporter username="isaacreath">Isaac Reath</reporter>
                        <labels>
                    </labels>
                <created>Fri, 25 Jul 2025 21:32:37 +0000</created>
                <updated>Wed, 30 Jul 2025 15:38:51 +0000</updated>
                            <resolved>Wed, 30 Jul 2025 15:38:32 +0000</resolved>
                                        <fixVersion>4.1.10</fixVersion>
                    <fixVersion>5.0.5</fixVersion>
                    <fixVersion>5.1</fixVersion>
                                    <component>Feature/Guardrails</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3600">1h</timespent>
                                <comments>
                            <comment id="18010058" author="paulo" created="Fri, 25 Jul 2025 22:07:07 +0000"  >&lt;p&gt;kick-off CI&lt;br/&gt;
4.1: &lt;a href=&quot;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch-before-5/2688/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch-before-5/2688/&lt;/a&gt;&lt;br/&gt;
5.0: &lt;a href=&quot;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch-5/352/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch-5/352/&lt;/a&gt;&lt;br/&gt;
trunk: &lt;a href=&quot;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch-5/353/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch-5/353/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="18010326" author="smiklosovic" created="Mon, 28 Jul 2025 09:35:22 +0000"  >&lt;p&gt;re-running 4.1 and trunk right now ... &lt;/p&gt;</comment>
                            <comment id="18010658" author="smiklosovic" created="Tue, 29 Jul 2025 12:41:32 +0000"  >&lt;p&gt;trunk &lt;a href=&quot;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch-5/359/#showFailuresLink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch-5/359/#showFailuresLink&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="18010850" author="smiklosovic" created="Wed, 30 Jul 2025 08:20:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/instaclustr/cassandra/tree/CASSANDRA-20787-4.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CASSANDRA-20787-4.1&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java8_pre-commit_tests                          
  &#10003; j8_build                                         5m 28s
  &#10003; j8_cqlsh_dtests_py3                              5m 48s
  &#10003; j8_cqlsh_dtests_py38                             5m 29s
  &#10003; j8_cqlsh_dtests_py38_vnode                       6m 10s
  &#10003; j8_cqlsh_dtests_py3_vnode                        6m 40s
  &#10003; j8_cqlshlib_cython_tests                        13m 11s
  &#10003; j8_cqlshlib_tests                                11m 2s
  &#10003; j8_jvm_dtests                                   13m 53s
  &#10003; j8_jvm_dtests_repeat                            19m 19s
  &#10003; j8_jvm_dtests_vnode                             14m 10s
  &#10003; j8_jvm_dtests_vnode_repeat                      18m 54s
  &#10003; j8_simulator_dtests                              3m 12s
  &#10003; j8_unit_tests                                    8m 37s
  &#10003; j8_utests_system_keyspace_directory             10m 23s
  &#10003; j11_unit_tests                                   10m 6s
  &#10003; j11_jvm_dtests_vnode_repeat                      18m 7s
  &#10003; j11_jvm_dtests_vnode                            12m 27s
  &#10003; j11_jvm_dtests_repeat                           17m 36s
  &#10003; j11_jvm_dtests                                  14m 36s
  &#10003; j11_dtests_vnode                                40m 55s
  &#10003; j11_cqlshlib_tests                                8m 3s
  &#10003; j11_cqlshlib_cython_tests                        9m 33s
  &#10003; j11_cqlsh_dtests_py3_vnode                       5m 56s
  &#10003; j11_cqlsh_dtests_py38_vnode                      6m 16s
  &#10003; j11_cqlsh_dtests_py38                            5m 44s
  &#10003; j11_cqlsh_dtests_py311_vnode                     6m 35s
  &#10003; j11_cqlsh_dtests_py311                           6m 17s
  &#10003; j11_cqlsh_dtests_py3                             5m 28s
  &#10005; j8_cqlsh_dtests_py311                            1m 25s
  &#10005; j8_cqlsh_dtests_py311_vnode                      1m 41s
  &#10005; j8_dtests                                       56m 16s
      refresh_test.TestRefresh test_refresh_deadlock_startup
  &#10005; j8_dtests_vnode                                 39m 43s
      bootstrap_test.TestBootstrap test_cleanup
  &#10005; j11_dtests                                      54m 53s
      refresh_test.TestRefresh test_refresh_deadlock_startup
java8_separate_tests                             
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/instaclustr/cassandra/5885/workflows/724100c6-1ac5-4f20-b56f-10367349fe55&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;java8_pre-commit_tests&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="18010851" author="smiklosovic" created="Wed, 30 Jul 2025 08:21:18 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="18010949" author="paulo" created="Wed, 30 Jul 2025 14:28:33 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;I wanted to note this moved directory creation from first keyspace access to storage service initialization, I don&apos;t think this is an issue since it&apos;s already being done in trunk.&lt;/p&gt;

&lt;p&gt;so for example, if startup checks fail, before directories would not be created and after this patch they will be. But this is fine since some startup checks (like the guardrails disk size check) require data dirs to be created.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[isaacreath]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12983" cascade-level=""><![CDATA[Availability]]></customfieldvalue>
                                <customfieldvalue key="12992" cascade-level="1"><![CDATA[Process Crash]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12969"><![CDATA[User Report]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1wyi8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[smiklosovic]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12351787">4.1-alpha1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/fcaa1b3e39d31c4d956519499e695f1d84801598&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/fcaa1b3e39d31c4d956519499e695f1d84801598&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;ul&gt;
	&lt;li&gt;Modified distributed test for this guardrail to ensure that this config path is exercised.&lt;/li&gt;
	&lt;li&gt;Run through reproduction instructions with and without patch applied.&lt;/li&gt;
&lt;/ul&gt;
</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>