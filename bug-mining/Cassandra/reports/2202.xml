<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:38:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-5632] Cross-DC bandwidth-saving broken</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-5632</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;We group messages by destination as follows to avoid sending multiple messages to a remote datacenter:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-comment&quot;&gt;// Multimap that holds onto all the messages and addresses meant &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; a specific datacenter
&lt;/span&gt;        Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, Multimap&amp;lt;Message, InetAddress&amp;gt;&amp;gt; dcMessages
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When we cleaned out the MessageProducer stuff for 2.0, this code&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;                    Multimap&amp;lt;Message, InetAddress&amp;gt; messages = dcMessages.get(dc);
...
                    messages.put(producer.getMessage(Gossiper.instance.getVersion(destination)), destination);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;turned into&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;                    Multimap&amp;lt;MessageOut, InetAddress&amp;gt; messages = dcMessages.get(dc);
...
                    messages.put(rm.createMessage(), destination);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Thus, we weren&apos;t actually grouping anything anymore &amp;#8211; each destination replica was stored under a separate Message key, unlike under the old CachingMessageProducer.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12652525">CASSANDRA-5632</key>
            <summary>Cross-DC bandwidth-saving broken</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="jbellis">Jonathan Ellis</reporter>
                        <labels>
                    </labels>
                <created>Wed, 12 Jun 2013 23:37:11 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:11 +0000</updated>
                            <resolved>Thu, 20 Jun 2013 20:54:58 +0000</resolved>
                                        <fixVersion>1.2.6</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="13681757" author="jbellis" created="Wed, 12 Jun 2013 23:38:39 +0000"  >&lt;p&gt;Backport of 62f429337caf0aa83b68720a5904e8527b840c80 from 2.0 to fix.&lt;/p&gt;</comment>
                            <comment id="13682842" author="hayato.shimizu" created="Thu, 13 Jun 2013 22:28:00 +0000"  >&lt;p&gt;Tested and fixed the issue.&lt;/p&gt;</comment>
                            <comment id="13686809" author="hayato.shimizu" created="Tue, 18 Jun 2013 15:04:06 +0000"  >&lt;p&gt;The patch fixes the issue of bandwidth-saving.&lt;/p&gt;

&lt;p&gt;However, there seems to be two regressive issues being introduced.&lt;/p&gt;

&lt;p&gt;1. DC2 coordinator selection by the DC1 coordinator is not equal across all available nodes in DC2. Some nodes in DC2 are unused as coordinators.&lt;br/&gt;
2. When using cqlsh, with EACH_QUORUM/ALL, with tracing on, on a row insert, RPC timeout occurs from a node that is not verifiable in the trace output.&lt;/p&gt;

&lt;p&gt;Trace output has been attached for a 6 node cluster, DC1:3, DC2:3 replication factor configuration. network-topology configuration is also attached for clarity.&lt;/p&gt;</comment>
                            <comment id="13686817" author="jbellis" created="Tue, 18 Jun 2013 15:18:02 +0000"  >&lt;blockquote&gt;&lt;p&gt;Secondary DC coordinator node is always the same node. This introduces a bottleneck in the secondary DC.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It&apos;s the same node for a given token range.  When all token ranges are considered, it is evenly spread.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;RPC timeout occurs from a node that is not verifiable in the trace output.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Well.  That&apos;s not a very useful error message, is it. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13686828" author="jbellis" created="Tue, 18 Jun 2013 15:29:43 +0000"  >&lt;p&gt;.55 is the forwarding node in DC2.  It logs that it applies the mutation and acks it:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    Enqueuing response to /192.168.56.50 | 05:57:33,825 | 192.168.56.55 |          14785
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But there is no &quot;Processing response from /192.168.56.55&quot; line logged by .50.  Hmm.&lt;/p&gt;</comment>
                            <comment id="13686886" author="jbellis" created="Tue, 18 Jun 2013 16:18:12 +0000"  >&lt;p&gt;You&apos;re not running with cross_node_timeout enabled, are you?  Because some of these clocks are minutes apart.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;# Enable operation timeout information exchange between nodes to accurately
# measure request timeouts, If disabled cassandra will assuming the request
# was forwarded to the replica instantly by the coordinator
#
# Warning: before enabling this property make sure to ntp is installed
# and the times are synchronized between the nodes.
cross_node_timeout: false
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13686986" author="jbellis" created="Tue, 18 Jun 2013 17:25:35 +0000"  >&lt;p&gt;I note that .55 doesn&apos;t ever log &quot;Sending message&quot; to .50 either.  So the message is getting dropped somewhere inside .55&apos;s MessagingService.&lt;/p&gt;

&lt;p&gt;cross_node_timeout is my best guess.  Next-best guess is that there&apos;s a reconnect somehow dropping the message a la &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5393&quot; title=&quot;Add retry mechanism to OTC for non-droppable_verbs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5393&quot;&gt;&lt;del&gt;CASSANDRA-5393&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13686989" author="jbellis" created="Tue, 18 Jun 2013 17:27:05 +0000"  >&lt;p&gt;v2 attached that rebases and does some further cleanup to improve trace messages.&lt;/p&gt;</comment>
                            <comment id="13687511" author="dbrosius" created="Wed, 19 Jun 2013 01:59:43 +0000"  >&lt;p&gt;other than simple FF, +LGTM&lt;/p&gt;

&lt;p&gt;-import org.apache.cassandra.tracing.Tracing;&lt;br/&gt;
+import org.apache.cassandra.tracing.4Tracing;&lt;/p&gt;</comment>
                            <comment id="13687561" author="jbellis" created="Wed, 19 Jun 2013 03:42:35 +0000"  >&lt;p&gt;Committed.  That should give Hayato an easier way to test at least. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13688451" author="hayato.shimizu" created="Wed, 19 Jun 2013 21:03:27 +0000"  >&lt;p&gt;It seems that issue 1. in my earlier comment was fixed with 1.2.5 by Yuki (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5424&quot; title=&quot;nodetool repair -pr on all nodes won&amp;#39;t repair the full range when a Keyspace isn&amp;#39;t in all DC&amp;#39;s&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5424&quot;&gt;&lt;del&gt;CASSANDRA-5424&lt;/del&gt;&lt;/a&gt;), where in 1.2.4 NetworkTopologyStrategy.calculateNaturalEndpoints HashSet replicas was changed to LinkedHashSet, so please ignore.&lt;/p&gt;</comment>
                            <comment id="13688838" author="enigmacurry" created="Thu, 20 Jun 2013 03:34:43 +0000"  >&lt;p&gt;I&apos;ve &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/pull/13/files&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;written a dtest&lt;/a&gt; that automates the testing of this issue.&lt;/p&gt;

&lt;p&gt;This test clearly shows that the coordinator was talking to more than one node in a different datacenter, and the patch resolves that issue. It also verifies that &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hayato.shimizu&quot; class=&quot;user-hover&quot; rel=&quot;hayato.shimizu&quot;&gt;hayato.shimizu&lt;/a&gt;&apos;s comment about using the same forwarder is not happening now.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbellis&quot; class=&quot;user-hover&quot; rel=&quot;jbellis&quot;&gt;jbellis&lt;/a&gt; - I noticed in your &lt;a href=&quot;http://www.datastax.com/dev/blog/advanced-request-tracing-in-cassandra-1-2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;blog post about tracing&lt;/a&gt; you said not to rely on the activity field, well, that&apos;s exactly what I&apos;m doing here. So, +1 to the idea of making those enums so this doesn&apos;t break in the future.&lt;/p&gt;</comment>
                            <comment id="13688840" author="jbellis" created="Thu, 20 Jun 2013 03:42:57 +0000"  >&lt;p&gt;Thanks, Ryan.  Go ahead and create a ticket for that and I&apos;ll put my next junior hire on it. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13773293" author="rcoli" created="Fri, 20 Sep 2013 18:46:34 +0000"  >&lt;p&gt;Do you have an &quot;affects&quot; version for this issue? Description says it started when a re-write for 2.0 started, but it affects 1.2.x so I&apos;m confused? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13773487" author="jeromatron" created="Fri, 20 Sep 2013 22:02:54 +0000"  >&lt;p&gt;I believe for the issue that was fixed here it originated in 1.2 and was present up through 1.2.5.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12678128">CASSANDRA-6314</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12588416" name="5632-v2.txt" size="9362" author="jbellis" created="Tue, 18 Jun 2013 17:27:05 +0000"/>
                            <attachment id="12587523" name="5632.txt" size="5440" author="jbellis" created="Wed, 12 Jun 2013 23:38:39 +0000"/>
                            <attachment id="12588382" name="cassandra-topology.properties" size="961" author="hayato.shimizu" created="Tue, 18 Jun 2013 15:02:24 +0000"/>
                            <attachment id="12588383" name="fix_patch_bug.log" size="4097" author="hayato.shimizu" created="Tue, 18 Jun 2013 15:02:24 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>332849</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 9 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1lf3r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>333177</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>dbrosius</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[dbrosius]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311124" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Tester</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>hayato.shimizu</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>