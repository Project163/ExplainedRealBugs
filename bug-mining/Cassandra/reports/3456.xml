<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:51:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-7976] Changes to index_interval table properties revert after subsequent modifications</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-7976</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;It appears that if you want to increase the sampling in *-Summary.db files, you would change the default for &lt;tt&gt;index_interval&lt;/tt&gt; table property from the &lt;tt&gt;128&lt;/tt&gt; default value to &lt;tt&gt;256&lt;/tt&gt; on a given CQL &lt;tt&gt;TABLE&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;However, if you &lt;tt&gt;ALTER TABLE&lt;/tt&gt; after setting the value, &lt;tt&gt;index_interval&lt;/tt&gt; returns to the default, &lt;tt&gt;128&lt;/tt&gt;. This is unexpected behavior. I would expect the value for &lt;tt&gt;index_interval&lt;/tt&gt; to not be affected by subsequent &lt;tt&gt;ALTER TABLE&lt;/tt&gt; statements.&lt;/p&gt;

&lt;p&gt;As noted in Environment, this was seen with a 2.0.9-SNAPSHOT built w/ `ccm`. &lt;/p&gt;

&lt;p&gt;If I just use a table from one of DataStax documentation tutorials (musicdb as mdb):&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;cqlsh:mdb&amp;gt; DESC TABLE songs;

CREATE TABLE songs (
  id uuid,
  album text,
  artist text,
  data blob,
  reviews list&amp;lt;text&amp;gt;,
  tags set&amp;lt;text&amp;gt;,
  title text,
  venue map&amp;lt;timestamp, text&amp;gt;,
  PRIMARY KEY ((id))
) WITH
  bloom_filter_fp_chance=0.010000 AND
  caching=&apos;KEYS_ONLY&apos; AND
  comment=&apos;&apos; AND
  dclocal_read_repair_chance=0.100000 AND
  gc_grace_seconds=864000 AND
  index_interval=128 AND
  read_repair_chance=0.000000 AND
  replicate_on_write=&apos;true&apos; AND
  populate_io_cache_on_flush=&apos;false&apos; AND
  default_time_to_live=0 AND
  speculative_retry=&apos;99.0PERCENTILE&apos; AND
  memtable_flush_period_in_ms=0 AND
  compaction={&apos;class&apos;: &apos;SizeTieredCompactionStrategy&apos;} AND
  compression={&apos;sstable_compression&apos;: &apos;LZ4Compressor&apos;};
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We&apos;ve got &lt;tt&gt;128&lt;/tt&gt; as expected.&lt;/p&gt;

&lt;p&gt;We alter it:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;cqlsh:mdb&amp;gt; ALTER TABLE songs WITH index_interval = 256; 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And the change appears: &lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;cqlsh:mdb&amp;gt; DESC TABLE songs;

CREATE TABLE songs (
  id uuid,
  album text,
  artist text,
  data blob,
  reviews list&amp;lt;text&amp;gt;,
  tags set&amp;lt;text&amp;gt;,
  title text,
  venue map&amp;lt;timestamp, text&amp;gt;,
  PRIMARY KEY ((id))
) WITH
  bloom_filter_fp_chance=0.010000 AND
  caching=&apos;KEYS_ONLY&apos; AND
  comment=&apos;&apos; AND
  dclocal_read_repair_chance=0.100000 AND
  gc_grace_seconds=864000 AND
  index_interval=256 AND
  read_repair_chance=0.000000 AND
  replicate_on_write=&apos;true&apos; AND
  populate_io_cache_on_flush=&apos;false&apos; AND
  default_time_to_live=0 AND
  speculative_retry=&apos;99.0PERCENTILE&apos; AND
  memtable_flush_period_in_ms=0 AND
  compaction={&apos;class&apos;: &apos;SizeTieredCompactionStrategy&apos;} AND
  compression={&apos;sstable_compression&apos;: &apos;LZ4Compressor&apos;};
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But if do another &lt;tt&gt;ALTER TABLE&lt;/tt&gt;, say, change the caching or comment, the &lt;tt&gt;index_interval&lt;/tt&gt; will revert back to &lt;tt&gt;128&lt;/tt&gt;.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;cqlsh:mdb&amp;gt; ALTER TABLE songs WITH caching = &apos;none&apos;; 
cqlsh:mdb&amp;gt; DESC TABLE songs; 

CREATE TABLE songs (
  id uuid,
  album text,
  artist text,
  data blob,
  reviews list&amp;lt;text&amp;gt;,
  tags set&amp;lt;text&amp;gt;,
  title text,
  venue map&amp;lt;timestamp, text&amp;gt;,
  PRIMARY KEY ((id))
) WITH
  bloom_filter_fp_chance=0.010000 AND
  caching=&apos;NONE&apos; AND
  comment=&apos;&apos; AND
  dclocal_read_repair_chance=0.100000 AND
  gc_grace_seconds=864000 AND
  index_interval=128 AND
  read_repair_chance=0.000000 AND
  replicate_on_write=&apos;true&apos; AND
  populate_io_cache_on_flush=&apos;false&apos; AND
  default_time_to_live=0 AND
  speculative_retry=&apos;99.0PERCENTILE&apos; AND
  memtable_flush_period_in_ms=0 AND
  compaction={&apos;class&apos;: &apos;SizeTieredCompactionStrategy&apos;} AND
  compression={&apos;sstable_compression&apos;: &apos;LZ4Compressor&apos;};
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It should be &lt;tt&gt;index_interval=256&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I know that 2.1 will replace &lt;tt&gt;index_interval&lt;/tt&gt;. &lt;/p&gt;

&lt;p&gt;I have not confirmed any behavior with &lt;tt&gt;min_index_interval&lt;/tt&gt; nor &lt;tt&gt;max_index_interval&lt;/tt&gt; (which is described in resolved #6379). &lt;/p&gt;</description>
                <environment>&lt;p&gt;cqlsh 4.1.1, Cassandra 2.0.9-SNAPSHOT (built w/ `ccm` on Mac OS X 10.9.4 with Java 1.7.0_67 - more detail below)&lt;/p&gt;

&lt;p&gt;$ java -version &lt;br/&gt;
java version &quot;1.7.0_67&quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.7.0_67-b01)&lt;br/&gt;
Java HotSpot(TM) 64-Bit Server VM (build 24.65-b04, mixed mode)&lt;/p&gt;

&lt;p&gt;$ mvn --version &lt;br/&gt;
Apache Maven 3.2.3 (33f8c3e1027c3ddde99d3cdebad2656a31e8fdf4; 2014-08-11T13:58:10-07:00)&lt;br/&gt;
Maven home: /usr/local/Cellar/maven/3.2.3/libexec&lt;br/&gt;
Java version: 1.7.0_67, vendor: Oracle Corporation&lt;br/&gt;
Java home: /Library/Java/JavaVirtualMachines/jdk1.7.0_67.jdk/Contents/Home/jre&lt;br/&gt;
Default locale: en_US, platform encoding: UTF-8&lt;br/&gt;
OS name: &quot;mac os x&quot;, version: &quot;10.9.4&quot;, arch: &quot;x86_64&quot;, family: &quot;mac&quot;&lt;/p&gt;</environment>
        <key id="12742613">CASSANDRA-7976</key>
            <summary>Changes to index_interval table properties revert after subsequent modifications</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stefania">Stefania Alborghetti</assignee>
                                    <reporter username="lenards">Andrew Lenards</reporter>
                        <labels>
                            <label>cql3</label>
                            <label>metadata</label>
                    </labels>
                <created>Fri, 19 Sep 2014 00:05:16 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:33 +0000</updated>
                            <resolved>Tue, 31 Mar 2015 16:39:02 +0000</resolved>
                                        <fixVersion>2.0.15</fixVersion>
                                    <component>Local/Config</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14382941" author="thobbs" created="Thu, 26 Mar 2015 23:35:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Stefania&quot; class=&quot;user-hover&quot; rel=&quot;stefania&quot;&gt;Stefania&lt;/a&gt; can you try to reproduce this and see what might be happening?&lt;/p&gt;</comment>
                            <comment id="14386275" author="stefania" created="Mon, 30 Mar 2015 06:30:52 +0000"  >&lt;p&gt;Verified &lt;tt&gt;index_interval&lt;/tt&gt; on cassandra-2.0 and reproduced the problem, added unit test.&lt;/p&gt;

&lt;p&gt;Verified &lt;tt&gt;min_index_interval&lt;/tt&gt; and &lt;tt&gt;max_index_interval&lt;/tt&gt; on trunk and cassandra-2.1 but could not reproduce.&lt;/p&gt;

&lt;p&gt;The problem for 2.0 is that the index interval is not updated in &lt;tt&gt;CFMetadata.apply()&lt;/tt&gt;. As a consequence, the index interval was never changed, this is clearly visible in the log file, despite what the cqlsh DESC command shows. The reason why the initial DESC command shows an updated index interval is that the migration manager pushes a schema change that was not correctly applied.&lt;/p&gt;

&lt;p&gt;When the index interval was changed into min and max on cassandra-2.1, &lt;tt&gt;CFMetadata.apply()&lt;/tt&gt; was fixed (verified on trunk).&lt;/p&gt;

&lt;p&gt;The patch for 2.0 is here: &lt;a href=&quot;https://github.com/stef1927/cassandra/commits/7976&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/stef1927/cassandra/commits/7976&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14388807" author="thobbs" created="Tue, 31 Mar 2015 16:39:02 +0000"  >&lt;p&gt;+1, committed as 88b2f38 with one minor change: I moved the new unit test to AlterTableTest.java (which already existed in 2.1).&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="14389622" author="stefania" created="Tue, 31 Mar 2015 23:16:31 +0000"  >&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12708455" name="7976-2.0.txt" size="4391" author="thobbs" created="Tue, 31 Mar 2015 16:37:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[stefania]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 33 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i208jb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>thobbs</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thobbs]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>