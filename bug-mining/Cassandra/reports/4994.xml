<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:11:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-14315] ThrottledUnfilteredIterator failed on UnfilteredRowIterator with only partition level info</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-14315</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;When repairing base table with MV, in order to avoid OOM, Cassandra-13299 added ThrottledUnfilteredIterator to split large partition into small chunks, but it didn&apos;t handle partition without unfiltered properly.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;repro&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// create cell tombstone, range tombstone, partition deletion
&lt;/span&gt;createTable(&lt;span class=&quot;code-quote&quot;&gt;&quot;CREATE TABLE %s (pk &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, ck1 &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, ck2 &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, v1 &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, v2 &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, PRIMARY KEY (pk, ck1, ck2))&quot;&lt;/span&gt;);
&lt;span class=&quot;code-comment&quot;&gt;// partition deletion
&lt;/span&gt;execute(&lt;span class=&quot;code-quote&quot;&gt;&quot;DELETE FROM %s USING TIMESTAMP 160 WHERE pk=1&quot;&lt;/span&gt;);

&lt;span class=&quot;code-comment&quot;&gt;// flush and generate 1 sstable
&lt;/span&gt;ColumnFamilyStore cfs = Keyspace.open(keyspace()).getColumnFamilyStore(currentTable());
cfs.forceBlockingFlush();
cfs.disableAutoCompaction();
cfs.forceMajorCompaction();

assertEquals(1, cfs.getLiveSSTables().size());
SSTableReader reader = cfs.getLiveSSTables().iterator().next();

&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (ISSTableScanner scanner = reader.getScanner();
        CloseableIterator&amp;lt;UnfilteredRowIterator&amp;gt; throttled = ThrottledUnfilteredIterator.throttle(scanner, 100))
{
    assertTrue(throttled.hasNext());
    UnfilteredRowIterator iterator = throttled.next();
    assertFalse(throttled.hasNext());
    assertFalse(iterator.hasNext());
    assertEquals(iterator.partitionLevelDeletion().markedForDeleteAt(), 160);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13145298">CASSANDRA-14315</key>
            <summary>ThrottledUnfilteredIterator failed on UnfilteredRowIterator with only partition level info</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jasonstack">Zhao Yang</assignee>
                                    <reporter username="jasonstack">Zhao Yang</reporter>
                        <labels>
                    </labels>
                <created>Thu, 15 Mar 2018 07:57:48 +0000</created>
                <updated>Fri, 15 May 2020 08:03:19 +0000</updated>
                            <resolved>Tue, 20 Mar 2018 02:22:17 +0000</resolved>
                                        <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Feature/Materialized Views</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="16400048" author="jasonstack" created="Thu, 15 Mar 2018 07:58:15 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/jasonstack/cassandra/commits/throttle-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;a href=&quot;https://github.com/jasonstack/cassandra-dtest/commits/throttle-mv&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;Changes:&lt;br/&gt;
1. when batch size is 0, don&apos;t throttle and return itself. (opt out)&lt;br/&gt;
2. when the original UnfilteredRowIterator has only partition level info, return itself once.&lt;br/&gt;
3. removed the assertion &quot;UnfilteredPartitionIterator should not contain empty partitions&quot;&lt;/p&gt;</comment>
                            <comment id="16405704" author="pauloricardomg" created="Tue, 20 Mar 2018 02:22:17 +0000"  >&lt;p&gt;Good catch! Patch and tests LGTM. Committed as &lt;tt&gt;5b9e985474e696a83d23e7cf4bedaf360cdb1eaf&lt;/tt&gt; to trunk. Thanks!&lt;/p&gt;</comment>
                            <comment id="16405722" author="pauloricardomg" created="Tue, 20 Mar 2018 02:43:46 +0000"  >&lt;p&gt;Committed dtest as &lt;tt&gt;2c1b986bc82ad29a4db06158043aceaaf473e17c&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="16405732" author="jasonstack" created="Tue, 20 Mar 2018 03:00:07 +0000"  >&lt;p&gt;Thanks for the review!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12915107" name="dtest.png" size="238298" author="jasonstack" created="Mon, 19 Mar 2018 10:20:35 +0000"/>
                            <attachment id="12915108" name="unit test.png" size="209248" author="jasonstack" created="Mon, 19 Mar 2018 10:20:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jasonstack]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 35 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3rbyf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>pauloricardomg</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[pauloricardomg]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>