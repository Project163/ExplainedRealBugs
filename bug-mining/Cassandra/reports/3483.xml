<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:52:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-8962] Fix SSTableRewriterTest on Windows</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-8962</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Platform specific failures:&lt;br/&gt;
org.apache.cassandra.io.sstable.SSTableRewriterTest.testNumberOfFiles_truncate&lt;br/&gt;
org.apache.cassandra.io.sstable.SSTableRewriterTest.testSmallFiles&lt;br/&gt;
org.apache.cassandra.io.sstable.SSTableRewriterTest.testNumberOfFiles_dont_clean_readers&lt;br/&gt;
org.apache.cassandra.io.sstable.SSTableRewriterTest.testNumberOfFiles_finish_empty_new_writer&lt;/p&gt;</description>
                <environment></environment>
        <key id="12781556">CASSANDRA-8962</key>
            <summary>Fix SSTableRewriterTest on Windows</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stefania">Stefania Alborghetti</assignee>
                                    <reporter username="jmckenzie">Josh McKenzie</reporter>
                        <labels>
                            <label>Windows</label>
                    </labels>
                <created>Thu, 12 Mar 2015 17:08:03 +0000</created>
                <updated>Wed, 15 Oct 2025 09:48:59 +0000</updated>
                            <resolved>Thu, 9 Apr 2015 20:12:24 +0000</resolved>
                                        <fixVersion>2.2.0 beta 1</fixVersion>
                                    <component>Legacy/Testing</component>
                    <component>Legacy/Tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14485913" author="jmckenzie" created="Wed, 8 Apr 2015 20:03:00 +0000"  >&lt;p&gt;Looks like a few different ones have cropped up (testOfflineAbort/2, testAllKeysReadable, getPositionsTest) - so long as the test passes on Windows I&apos;ll be happy enough.&lt;/p&gt;</comment>
                            <comment id="14486444" author="stefania" created="Thu, 9 Apr 2015 00:56:29 +0000"  >&lt;p&gt;Yes I think &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8893&quot; title=&quot;RandomAccessReader should share its FileChannel with all instances (via SegmentedFile)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8893&quot;&gt;&lt;del&gt;CASSANDRA-8893&lt;/del&gt;&lt;/a&gt; might have made things worse for Windows because we share the NIO channel all the way up to the SegmentedFile.Builder and so the files linger for longer on Windows.&lt;/p&gt;

&lt;p&gt;Anyway the patch is almost ready.&lt;/p&gt;</comment>
                            <comment id="14486541" author="stefania" created="Thu, 9 Apr 2015 01:53:22 +0000"  >&lt;p&gt;The patch is ready: &lt;a href=&quot;https://github.com/stef1927/cassandra/commits/8962&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/stef1927/cassandra/commits/8962&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The test passes on my box (Windows 7 and Ubuntu 14), provided the timeout is long enough (e.g. 120000) - otherwise occasionally it may time out, just like other tests.&lt;/p&gt;

&lt;p&gt;At line 233 (testFileRemoval()) I had to comment out one assertion as it is not possible to have those files deleted before writer.abort() is called, since it holds a reference to the NIO channel via SegmentedFile.Builder. If you are also happy dropping this assertion, please remove the commented out lines during commit.&lt;/p&gt;

&lt;p&gt;Also, I had to change some production code by manually releasing the new ss tables in the compaction task when it is offline. Without this, the split ss tables test leaves behind files that then cause the following tests to fail. These files cannot be deleted until the sstables are garbage collected. I suppose we could try to force a GC of those tables as an alternative but I think ultimately we want to fix all leaks so I modified the compaction task directly.&lt;/p&gt;</comment>
                            <comment id="14488172" author="jmckenzie" created="Thu, 9 Apr 2015 20:12:24 +0000"  >&lt;p&gt;The released ref on CompactionTask to prevent the leak looks good. I don&apos;t love having a split of where we release refs in online operations vs. offline but I&apos;d rather we err on the least invasive way to address that which this does.&lt;/p&gt;

&lt;p&gt;I went ahead and switched on FBUtilities.isWindows for that assertion that fails on Windows and works on linux. No reason to remove the check on the linux side though it&apos;s clearly not critical for operations to succeed.&lt;/p&gt;

&lt;p&gt;Committed - thanks!&lt;/p&gt;</comment>
                            <comment id="14488529" author="stefania" created="Thu, 9 Apr 2015 23:48:24 +0000"  >&lt;p&gt;Thank you, good to know about FBUtilities.isWindows, I&apos;ll keep it in mind next time! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[stefania]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 32 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i26p53:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>joshuamckenzie</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[joshuamckenzie]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>