<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:49:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-8244] Token, DecoratedKey, RowPosition and all bound types should not make any hidden references to the database partitioner</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-8244</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Currently some of the functionality of Token refers to StorageService.getPartitioner() to avoid needing an extra argument. This is in turn implicitly used by RowPosition and then Range, causing possible problems, for example when ranges on secondary indices are used in a murmur-partitioned database.&lt;/p&gt;

&lt;p&gt;These references should be removed to force explicit choice of partitioner by callers; alternatively, the Token interface could be changed to provide a reference to the partitioner that created it.&lt;/p&gt;

&lt;p&gt;(Note: the hidden reference to partitioner in serialization is a separate issue.)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12752397">CASSANDRA-8244</key>
            <summary>Token, DecoratedKey, RowPosition and all bound types should not make any hidden references to the database partitioner</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="blambov">Branimir Lambov</assignee>
                                    <reporter username="blambov">Branimir Lambov</reporter>
                        <labels>
                    </labels>
                <created>Mon, 3 Nov 2014 11:04:01 +0000</created>
                <updated>Wed, 15 Oct 2025 09:49:07 +0000</updated>
                            <resolved>Fri, 21 Nov 2014 16:04:24 +0000</resolved>
                                        <fixVersion>2.2.0 beta 1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14200374" author="blambov" created="Thu, 6 Nov 2014 16:14:21 +0000"  >&lt;p&gt;Proposed patch is uploaded for review on &lt;a href=&quot;https://github.com/blambov/cassandra/compare/8244-partitioner-in-token&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/blambov/cassandra/compare/8244-partitioner-in-token&lt;/a&gt;. Applies on top of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8230&quot; title=&quot;LongToken no longer needs to use a boxed Long&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8230&quot;&gt;&lt;del&gt;CASSANDRA-8230&lt;/del&gt;&lt;/a&gt; on trunk.&lt;/p&gt;

&lt;p&gt;Changes tokens and &lt;tt&gt;RingPosition&lt;/tt&gt; to provide a reference to the partitioner that created them, which is used to make sure Range/Bounds always use the correct partitioner for the bounds they contain. Previously this was quite easy to get wrong without noticing, see e.g. &lt;tt&gt;DataRange.allData&lt;/tt&gt;. To avoid increasing the space used by a token, this is done by moving the token type definitions inside the partitioner, which allows them to have a static reference to it, except &lt;tt&gt;LocalToken&lt;/tt&gt; which now replaces the reference to its comparator with a reference to the issuing partitioner.&lt;/p&gt;

&lt;p&gt;Removes custom key construction in &lt;tt&gt;SecondaryIndex.getIndexKeyFor&lt;/tt&gt; and delegates the task to the &lt;tt&gt;indexCfs&lt;/tt&gt; partitioner, the presence of which is already tested whenever &lt;tt&gt;getIndexKeyFor&lt;/tt&gt; is used.&lt;/p&gt;

&lt;p&gt;Adds static instances of the partitioners and a mechanism to choose them instead of instantiating a new copy in &lt;tt&gt;FBUtilities.newPartitioner&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Fixes &lt;tt&gt;KeyCollisionTest&lt;/tt&gt; which wasn&apos;t changing the partitioner as expected, and was also passing with the wrong partitioner.&lt;/p&gt;</comment>
                            <comment id="14200557" author="jmckenzie" created="Thu, 6 Nov 2014 17:58:25 +0000"  >&lt;p&gt;Grabbing review as per IRC&lt;/p&gt;</comment>
                            <comment id="14219526" author="jmckenzie" created="Thu, 20 Nov 2014 16:04:02 +0000"  >&lt;p&gt;getHeapSize on BigIntegerToken has a &apos;TODO: Probably wrong&apos; comment for getHeapSize().  While I agree, we should probably either fix that or create another ticket to address that and maybe reference it in the comment.&lt;/p&gt;

&lt;p&gt;nits:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;annotate @VisibleForTesting on RandomPartitioner.BigIntegerToken.BigIntegerToken(String token)&lt;/li&gt;
	&lt;li&gt;clean up import order on FBUtilities.java&lt;/li&gt;
	&lt;li&gt;looks like changes to a couple of the .db files under test snuck in on commit&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Looks good - nice cleanup!&lt;/p&gt;</comment>
                            <comment id="14220960" author="blambov" created="Fri, 21 Nov 2014 14:22:04 +0000"  >&lt;p&gt;Rebased new version and patch are uploaded, comparison &lt;a href=&quot;https://github.com/blambov/cassandra/compare/8244-partitioner-in-token&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;at the same location&lt;/a&gt;.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;getHeapSize on BigIntegerToken has a &apos;TODO: Probably wrong&apos; comment for getHeapSize()&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Sorry, that wasn&apos;t to be in the final code. Since the hashes are all fixed-size numbers, the heap size actually is correct, just badly named. Fixed static field name.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;annotate @VisibleForTesting on RandomPartitioner.BigIntegerToken.BigIntegerToken(String token)&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Done.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;clean up import order on FBUtilities.java&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Done.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;looks like changes to a couple of the .db files under test snuck in on commit&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Done.&lt;/p&gt;</comment>
                            <comment id="14221076" author="jmckenzie" created="Fri, 21 Nov 2014 16:04:24 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12749225">CASSANDRA-8143</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12753374">CASSANDRA-8268</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12682887" name="8244.patch" size="145069" author="blambov" created="Fri, 21 Nov 2014 14:22:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blambov]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i21w1b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>joshuamckenzie</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[joshuamckenzie]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>