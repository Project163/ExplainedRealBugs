<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:03:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-11996] SSTableSet.CANONICAL can miss sstables</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-11996</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;There is a race where we might miss sstables in SSTableSet.CANONICAL when we finish up a compaction.&lt;/p&gt;

&lt;p&gt;Reproducing unit test pushed &lt;a href=&quot;https://github.com/krummas/cassandra/commit/1292aaa61b89730cff0c022ed1262f45afd493e5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12978149">CASSANDRA-11996</key>
            <summary>SSTableSet.CANONICAL can miss sstables</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10000" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Urgent</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="marcuse">Marcus Eriksson</assignee>
                                    <reporter username="marcuse">Marcus Eriksson</reporter>
                        <labels>
                    </labels>
                <created>Mon, 13 Jun 2016 13:32:35 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:30 +0000</updated>
                            <resolved>Wed, 6 Jul 2016 06:18:09 +0000</resolved>
                                        <fixVersion>3.0.9</fixVersion>
                    <fixVersion>3.8</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15327505" author="krummas" created="Mon, 13 Jun 2016 14:36:32 +0000"  >&lt;p&gt;note that the unit test will not fail every run, run it in a loop to reproduce&lt;/p&gt;</comment>
                            <comment id="15352623" author="krummas" created="Tue, 28 Jun 2016 08:56:33 +0000"  >&lt;p&gt;Reverted to the 2.2 way of getting canonical sstables&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;testall&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;dtest&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/krummas/cassandra/tree/marcuse/canonical&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;marcuse/canonical&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/krummas/job/krummas-marcuse-canonical-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/krummas/job/krummas-marcuse-canonical-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/krummas/cassandra/tree/marcuse/canonical-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;marcuse/canonical-trunk&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/krummas/job/krummas-marcuse-canonical-trunk-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/krummas/job/krummas-marcuse-canonical-trunk-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15354722" author="stefania" created="Wed, 29 Jun 2016 07:27:07 +0000"  >&lt;p&gt;Shouldn&apos;t we only return the canonical sstables that are passed into select as a &lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...krummas:marcuse/canonical#diff-6a3c38153a6ec0316c9192d40f71fb40R139&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;parameter&lt;/a&gt;? By looking &lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...krummas:marcuse/canonical#diff-6a3c38153a6ec0316c9192d40f71fb40R151&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; and &lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...krummas:marcuse/canonical#diff-6a3c38153a6ec0316c9192d40f71fb40R159&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;, won&apos;t we return all compacting sstables that are not opened early, regardless of the filter applied by the callers of select?&lt;/p&gt;

&lt;p&gt;In the test, don&apos;t we need to call &lt;tt&gt;DatabaseDescriptor.setSSTablePreempiveOpenIntervalInMB()&lt;/tt&gt; with a lower interval at the beginning of the test as well?&lt;/p&gt;

&lt;p&gt;Nit: in the test, the &lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...krummas:marcuse/canonical#diff-02c4b3ac06af7b36bb219956c41616f6R887&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;runnable&lt;/a&gt; can be a lambda.&lt;/p&gt;</comment>
                            <comment id="15354775" author="krummas" created="Wed, 29 Jun 2016 08:16:20 +0000"  >&lt;blockquote&gt;&lt;p&gt;Shouldn&apos;t we only return the canonical sstables that are passed into select as a parameter?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;true, argh.. this approach wont work at all - the sstables passed in do not contain the original version of the sstable, JUST the early opened one when we are finishing up the compaction...&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;In the test, don&apos;t we need to call DatabaseDescriptor.setSSTablePreempiveOpenIntervalInMB()&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;no, this happens since we always open an &quot;early&quot; sstable when finishing writing an sstable &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/io/sstable/SSTableRewriter.java#L316&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/io/sstable/SSTableRewriter.java#L316&lt;/a&gt; - the &lt;tt&gt;setPreemptive...&lt;/tt&gt; i had in the finally clause was a copy and paste leftover&lt;/p&gt;</comment>
                            <comment id="15356989" author="krummas" created="Thu, 30 Jun 2016 12:16:39 +0000"  >&lt;p&gt;try nr 2:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;testall&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;dtest&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/krummas/cassandra/tree/marcuse/canonical&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;marcuse/canonical&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/krummas/job/krummas-marcuse-canonical-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/krummas/job/krummas-marcuse-canonical-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/krummas/cassandra/tree/marcuse/canonical-3.9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;marcuse/canonical-3.9&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/krummas/job/krummas-marcuse-canonical-3.9-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/krummas/job/krummas-marcuse-canonical-3.9-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/krummas/cassandra/tree/marcuse/canonical-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;marcuse/canonical-trunk&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/krummas/job/krummas-marcuse-canonical-trunk-testall&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/krummas/job/krummas-marcuse-canonical-trunk-dtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;same idea as before - get the sstables like in 2.2 but apply the filter &lt;b&gt;after&lt;/b&gt; getting the requested SSTableSet&lt;/p&gt;

&lt;p&gt;based it on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11944&quot; title=&quot;sstablesInBounds might not actually give all sstables within the bounds due to having start positions moved in sstables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11944&quot;&gt;&lt;del&gt;CASSANDRA-11944&lt;/del&gt;&lt;/a&gt; since that changed how we get sstable in bounds.&lt;/p&gt;</comment>
                            <comment id="15358333" author="stefania" created="Fri, 1 Jul 2016 03:48:47 +0000"  >&lt;p&gt;Thanks, I&apos;m out today but I will review this first thing next week. The ticket you are referring to is actually &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11944&quot; title=&quot;sstablesInBounds might not actually give all sstables within the bounds due to having start positions moved in sstables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11944&quot;&gt;&lt;del&gt;CASSANDRA-11944&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="15358457" author="krummas" created="Fri, 1 Jul 2016 05:57:36 +0000"  >&lt;blockquote&gt;&lt;p&gt;The ticket you are referring to is actually &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11944&quot; title=&quot;sstablesInBounds might not actually give all sstables within the bounds due to having start positions moved in sstables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11944&quot;&gt;&lt;del&gt;CASSANDRA-11944&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;oops, yep&lt;/p&gt;</comment>
                            <comment id="15360735" author="stefania" created="Mon, 4 Jul 2016 01:27:01 +0000"  >&lt;p&gt;Patch LGTM but the utests failed to launch on all branches so I&apos;ve restarted them. dtest failures are all accounted for (either known failures, or connection timeouts). &lt;/p&gt;</comment>
                            <comment id="15360832" author="stefania" created="Mon, 4 Jul 2016 05:07:43 +0000"  >&lt;p&gt;utests look good now, all failures happening on unpatched branches as well.&lt;/p&gt;

&lt;p&gt;Ticket can be committed as soon as &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11944&quot; title=&quot;sstablesInBounds might not actually give all sstables within the bounds due to having start positions moved in sstables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11944&quot;&gt;&lt;del&gt;CASSANDRA-11944&lt;/del&gt;&lt;/a&gt; is ready.&lt;/p&gt;</comment>
                            <comment id="15363854" author="krummas" created="Wed, 6 Jul 2016 06:18:10 +0000"  >&lt;p&gt;committed, thanks!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12975082">CASSANDRA-11944</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12981478">CASSANDRA-12052</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 19 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2zdpr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>stefania</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[stefania]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>