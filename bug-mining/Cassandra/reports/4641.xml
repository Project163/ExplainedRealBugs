<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:06:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-13018] Exceptions encountered calling getSeeds() breaks OTC thread</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-13018</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;OutboundTcpConnection.connect() calls getSeeds(). If getSeeds() throws an exception (for example, DD/Config invalid yaml error), messaging thread(s) break(s). &lt;/p&gt;</description>
                <environment></environment>
        <key id="13026505">CASSANDRA-13018</key>
            <summary>Exceptions encountered calling getSeeds() breaks OTC thread</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jjirsa">Jeff Jirsa</assignee>
                                    <reporter username="jjirsa">Jeff Jirsa</reporter>
                        <labels>
                            <label>lhf</label>
                    </labels>
                <created>Wed, 7 Dec 2016 23:05:18 +0000</created>
                <updated>Fri, 15 May 2020 08:02:25 +0000</updated>
                            <resolved>Fri, 17 Feb 2017 21:42:23 +0000</resolved>
                                        <fixVersion>2.2.10</fixVersion>
                    <fixVersion>3.0.11</fixVersion>
                    <fixVersion>3.11.0</fixVersion>
                    <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Legacy/Streaming and Messaging</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15795901" author="jasobrown" created="Tue, 3 Jan 2017 19:10:55 +0000"  >&lt;p&gt;On the whole, +1 to this patch and better code resilience. However, that whole call to &lt;tt&gt;DatabaseDescriptor#getSeeds()&lt;/tt&gt; has always looked funny to me. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt; added this, not associated with any jira. Brandon, can you shed some light on this, especially when the log message won&apos;t tell us much (in terms of the messaging version of the peer), as the only reason why &lt;tt&gt;maxTargetVersion == NO_VERSION&lt;/tt&gt; is if we failed to connect to the peer. &lt;/p&gt;

&lt;p&gt;tbh, I&apos;m more in the opinion of removing the &lt;tt&gt;if (..)&lt;/tt&gt; and the logged message altogether as we&apos;ve seen that call to &lt;tt&gt;DatabaseDescriptor#getSeeds()&lt;/tt&gt; spam the logs, hence why we limited the yaml logging in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11217&quot; title=&quot;Only log yaml config once, at startup&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11217&quot;&gt;&lt;del&gt;CASSANDRA-11217&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15795930" author="brandon.williams" created="Tue, 3 Jan 2017 19:19:33 +0000"  >&lt;p&gt;I added it, post facto, as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8768&quot; title=&quot;Using a Cassandra 2.0 seed doesn&amp;#39;t allow a new Cassandra 2.1 node to bootstrap&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8768&quot;&gt;&lt;del&gt;CASSANDRA-8768&lt;/del&gt;&lt;/a&gt;, since there&apos;s no other way of detecting that particular problem.&lt;/p&gt;</comment>
                            <comment id="15796372" author="jasobrown" created="Tue, 3 Jan 2017 22:17:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt; Thanks for the info and the link to the ticket.&lt;/p&gt;

&lt;p&gt;If we decide to keep the log message, I think it&apos;s in the wrong place. Currently, it&apos;s in the block that starts with &lt;tt&gt;if(maxTargetVersion == NO_VERSION)&lt;/tt&gt;, and that will only occur when we fail to connect to the peer. In that case the log message would read: &lt;tt&gt;Seed gossip version is -2147483648; will not connect with that version&lt;/tt&gt;, where &quot;-2147483648&quot; is &lt;tt&gt;Integer.MIN_VALUE&lt;/tt&gt;. I think this log message is more correctly placed in the &lt;tt&gt;if (targetVersion &amp;gt; maxTargetVersion)&lt;/tt&gt; block, because then we&apos;ve connected to and received the peer&apos;s messaging protocol version. WDYT?&lt;/p&gt;

&lt;p&gt;In either case, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jjirsa&quot; class=&quot;user-hover&quot; rel=&quot;jjirsa&quot;&gt;jjirsa&lt;/a&gt;&apos;s exception checking code should be added. I just want to make sure the actual thing it&apos;s guarding is executed in the correct place.&lt;/p&gt;</comment>
                            <comment id="15872302" author="jjirsa" created="Fri, 17 Feb 2017 18:58:32 +0000"  >&lt;p&gt;In reading through this and talking to Jason, it does appear that the log line is in the wrong place.&lt;/p&gt;

&lt;p&gt;The only way we end up in this block is if the connect fails (or rather, if we&apos;re unable to read the other side&apos;s version), but what we really want to guard against in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8768&quot; title=&quot;Using a Cassandra 2.0 seed doesn&amp;#39;t allow a new Cassandra 2.1 node to bootstrap&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8768&quot;&gt;&lt;del&gt;CASSANDRA-8768&lt;/del&gt;&lt;/a&gt; is connecting to an incompatible version - which is a few blocks down.&lt;/p&gt;</comment>
                            <comment id="15872328" author="jasobrown" created="Fri, 17 Feb 2017 19:09:45 +0000"  >&lt;p&gt;updated the patch as per the convo with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jjirsa&quot; class=&quot;user-hover&quot; rel=&quot;jjirsa&quot;&gt;jjirsa&lt;/a&gt;, pushed the code, and running tests:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.2&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.0&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.11&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/jasobrown/cassandra/tree/13018-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/jasobrown/cassandra/tree/13018-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/jasobrown/cassandra/tree/13018-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/jasobrown/cassandra/tree/13018-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/jasobrown/job/jasobrown-13018-2.2-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/jasobrown/job/jasobrown-13018-3.0-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/jasobrown/job/jasobrown-13018-3.11-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/jasobrown/job/jasobrown-13018-trunk-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/jasobrown/job/jasobrown-13018-2.2-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/jasobrown/job/jasobrown-13018-3.0-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/jasobrown/job/jasobrown-13018-3.11-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/jasobrown/job/jasobrown-13018-trunk-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15872412" author="jjirsa" created="Fri, 17 Feb 2017 19:52:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jasobrown&quot; class=&quot;user-hover&quot; rel=&quot;jasobrown&quot;&gt;jasobrown&lt;/a&gt; You&apos;ve corrected the logging bug, but left the broken OTC thread issue - that is, in your branches ( &lt;a href=&quot;https://github.com/jasobrown/cassandra/blob/abe3db6431b428a687bd918027c2d042f8986bbc/src/java/org/apache/cassandra/net/OutboundTcpConnection.java#L437&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jasobrown/cassandra/blob/abe3db6431b428a687bd918027c2d042f8986bbc/src/java/org/apache/cassandra/net/OutboundTcpConnection.java#L437&lt;/a&gt; for example ), you left the old call to getSeeds() unprotected, which can still throw and break.&lt;/p&gt;
</comment>
                            <comment id="15872431" author="jasobrown" created="Fri, 17 Feb 2017 20:04:33 +0000"  >&lt;p&gt;(facepalm) - fixing now. Thanks for catching that!&lt;/p&gt;</comment>
                            <comment id="15872439" author="jasobrown" created="Fri, 17 Feb 2017 20:08:10 +0000"  >&lt;p&gt;fixed all 4 branches&lt;/p&gt;</comment>
                            <comment id="15872483" author="jjirsa" created="Fri, 17 Feb 2017 20:38:03 +0000"  >&lt;p&gt;Changes lgtm!&lt;/p&gt;</comment>
                            <comment id="15872580" author="jasobrown" created="Fri, 17 Feb 2017 21:42:23 +0000"  >&lt;p&gt;committed as sha &lt;tt&gt;8556a2b932046ee0633b0e619d3dd04b57bb653e&lt;/tt&gt; to 2.2, 3.0, 3.11, and trunk. thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12845308" name="0001-Better-handle-config-errors-during-outbound-connecti.patch" size="2448" author="jjirsa" created="Mon, 2 Jan 2017 22:13:42 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jjirsa]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 39 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i37bif:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12332167">2.1.x</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jasobrown</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jasobrown]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>