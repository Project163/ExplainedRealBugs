<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:28:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-3554] Hints are not replayed unless node was marked down</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-3554</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;If B drops a write from A because it is overwhelmed (but not dead), A will hint the write.  But it will never get notified that B is back up (since it was never down), so it will never attempt hint delivery.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12533568">CASSANDRA-3554</key>
            <summary>Hints are not replayed unless node was marked down</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="jbellis">Jonathan Ellis</reporter>
                        <labels>
                            <label>hintedhandoff</label>
                            <label>jmx</label>
                    </labels>
                <created>Fri, 2 Dec 2011 05:46:15 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:45 +0000</updated>
                            <resolved>Thu, 22 Dec 2011 21:34:34 +0000</resolved>
                                        <fixVersion>1.0.7</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13161436" author="jbellis" created="Fri, 2 Dec 2011 05:48:46 +0000"  >&lt;p&gt;Unclear how we should tell when it&apos;s a good idea to re-attempt delivery in this scenario.&lt;/p&gt;

&lt;p&gt;Possibly the best solution is to just make FD smarter and mark nodes as &quot;effectively down&quot; in this situation.  A &quot;local&quot; FD as in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3533&quot; title=&quot;TimeoutException when there is a firewall issue.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3533&quot;&gt;&lt;del&gt;CASSANDRA-3533&lt;/del&gt;&lt;/a&gt; could address this.&lt;/p&gt;</comment>
                            <comment id="13161490" author="slebresne" created="Fri, 2 Dec 2011 08:40:15 +0000"  >&lt;p&gt;Couldn&apos;t B handles this? When it drops writes from A, it could record it. Then B could have a scheduled tasks that looks for locally dropped writes and decide if it&apos;s ok to get hints based on the mutation stage queue. It could then request the hint delivery from A.&lt;/p&gt;</comment>
                            <comment id="13161649" author="jbellis" created="Fri, 2 Dec 2011 14:11:07 +0000"  >&lt;p&gt;That could work, but I cringe at adding both &quot;pull&quot; and &quot;push&quot; modes for hint delivery, which has historically been a source of enough bugs that more complexity is counterindicated.&lt;/p&gt;</comment>
                            <comment id="13161703" author="brandon.williams" created="Fri, 2 Dec 2011 16:07:30 +0000"  >&lt;p&gt;At risk of heresy, would bringing the hourly scan back be so bad now that our hint model doesn&apos;t suck like it did the first time we did that? &lt;/p&gt;</comment>
                            <comment id="13161705" author="tjake" created="Fri, 2 Dec 2011 16:11:50 +0000"  >&lt;p&gt;Can we keep a running tally of hints per endpoint when they are written, when they reach a threshold we deliver them? + hourly scan &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13161712" author="jbellis" created="Fri, 2 Dec 2011 16:31:56 +0000"  >&lt;p&gt;The problem I have with a &quot;brute force&quot; hourly scan or hint threshold is that you&apos;re likely to run into the same overload scenario that caused the hinting in the first place.&lt;/p&gt;</comment>
                            <comment id="13161957" author="appodictic" created="Sat, 3 Dec 2011 00:27:39 +0000"  >&lt;p&gt;Could we use the badness detector in dynamic switch?&lt;/p&gt;</comment>
                            <comment id="13162824" author="tjake" created="Mon, 5 Dec 2011 15:22:30 +0000"  >&lt;p&gt;The other problem is even if we fix the replay issue it&apos;s still terribly slow due to excessive throttling&lt;/p&gt;

&lt;p&gt;I like the idea of changing from a push to pull mode for hint delivery. Similar to how mysql replication is client pull.  Clients know how swamped they are and can throttle their own delivery.&lt;/p&gt;

</comment>
                            <comment id="13162874" author="jbellis" created="Mon, 5 Dec 2011 17:03:23 +0000"  >&lt;p&gt;The problem with a pull model is that the node doing the pulling usually won&apos;t know &quot;I was down, therefore I should ask for hints.&quot;  (The exception is on restart, but hints due to overload conditions or GC pauses are much more common.)&lt;/p&gt;</comment>
                            <comment id="13162877" author="tjake" created="Mon, 5 Dec 2011 17:07:54 +0000"  >&lt;p&gt;Right, however its never going to know if hints are on a coordinator node due to the coordinator needed to drop some messages (backpressure?)&lt;/p&gt;

&lt;p&gt;So either the clients can poll all nodes slowly and fetch hints or we perhaps gossip hints available flag so nodes know when hints are there to read?&lt;/p&gt;</comment>
                            <comment id="13163247" author="jbellis" created="Tue, 6 Dec 2011 01:33:23 +0000"  >&lt;p&gt;Right.  So, not clearly simpler than doing something to our existing push model, but much more code churn.  I&apos;d rather stick with push.&lt;/p&gt;</comment>
                            <comment id="13164481" author="appodictic" created="Wed, 7 Dec 2011 16:19:58 +0000"  >&lt;p&gt;How expensive is the process of &quot;1) Wake Up. 2)Check for hints. 3) try to deliver them.&quot; As for parts 1 &amp;amp; 2 I would think we can do this more often then hourly, maybe a background thread that sleeps for N seconds and attempts again.  &lt;/p&gt;

&lt;p&gt;&lt;blockquote&gt;&lt;p&gt;&lt;br/&gt;
The other problem is even if we fix the replay issue it&apos;s still terribly slow due to excessive throttling&lt;/p&gt;&lt;/blockquote&gt; Side note. This throttle can not currently be adjusted at runtime. This should be JMX able. The default may be too low. Historically the problem was the hint sending node got hammered. In my mind the throttle was protecting that system.  &lt;/p&gt;</comment>
                            <comment id="13169963" author="jbellis" created="Thu, 15 Dec 2011 04:47:42 +0000"  >&lt;p&gt;Brute force fix attached to check for hints-to-deliver every 10 minutes.  If a hint cannot be replayed because of timing out, we abort (to that target).  Reduces default hint throttle delay to 1ms.&lt;/p&gt;</comment>
                            <comment id="13169964" author="jbellis" created="Thu, 15 Dec 2011 04:52:21 +0000"  >&lt;p&gt;0001 does some related cleanup, including moving the mbean method StorageService.deliverHints to HHOM.scheduleHintDelivery.&lt;/p&gt;</comment>
                            <comment id="13172708" author="jbellis" created="Mon, 19 Dec 2011 22:57:02 +0000"  >&lt;p&gt;combined patch against 1.0&lt;/p&gt;</comment>
                            <comment id="13172737" author="jbellis" created="Mon, 19 Dec 2011 23:34:32 +0000"  >&lt;p&gt;updated 1.0 rebase that is pre-1034 friendly&lt;/p&gt;</comment>
                            <comment id="13173128" author="brandon.williams" created="Tue, 20 Dec 2011 12:06:03 +0000"  >&lt;p&gt;I&apos;m not sure how exactly, but obviously the keys being passed here are not quite what we think they are:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;DEBUG 11:57:03,907 Started scheduleAllDeliveries
DEBUG 11:57:03,907 deliverHints to /7fff:ffff:ffff:ffff:ffff:ffff:ffff:fffe
DEBUG 11:57:03,908 deliverHints to /5555:5555:5555:5555:5555:5555:5555:5554
DEBUG 11:57:03,908 Checking remote(/7fff:ffff:ffff:ffff:ffff:ffff:ffff:fffe) schema before delivering hints
DEBUG 11:57:03,908 Finished scheduleAllDeliveries
ERROR 11:57:03,909 Fatal exception in thread Thread[HintedHandoff:3,1,main]
java.lang.NullPointerException
        at org.apache.cassandra.db.HintedHandOffManager.waitForSchemaAgreement(HintedHandOffManager.java:206)
        at org.apache.cassandra.db.HintedHandOffManager.deliverHintsToEndpoint(HintedHandOffManager.java:238)
        at org.apache.cassandra.db.HintedHandOffManager.access$200(HintedHandOffManager.java:84)
        at org.apache.cassandra.db.HintedHandOffManager$3.runMayThrow(HintedHandOffManager.java:383)
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:30)
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
        at java.lang.Thread.run(Thread.java:662)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13175036" author="jbellis" created="Thu, 22 Dec 2011 20:29:11 +0000"  >&lt;p&gt;You&apos;re right, we switched from InetAddress as the key to Tokens.  v2 attached.&lt;/p&gt;</comment>
                            <comment id="13175069" author="brandon.williams" created="Thu, 22 Dec 2011 21:18:31 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13175081" author="jbellis" created="Thu, 22 Dec 2011 21:34:34 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                            <comment id="13234300" author="jonma" created="Wed, 21 Mar 2012 11:59:05 +0000"  >&lt;p&gt;+1 &lt;br/&gt;
&quot;shedule deliver hints&quot; should have been more ealier brought in .&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12507477" name="0001-cleanup.patch" size="12214" author="jbellis" created="Thu, 15 Dec 2011 04:53:47 +0000"/>
                            <attachment id="12507476" name="0002-deliver.patch" size="5158" author="jbellis" created="Thu, 15 Dec 2011 04:47:42 +0000"/>
                            <attachment id="12508433" name="3554-1.0-v2.txt" size="15014" author="jbellis" created="Thu, 22 Dec 2011 20:29:11 +0000"/>
                            <attachment id="12507999" name="3554-1.0.txt" size="14069" author="jbellis" created="Mon, 19 Dec 2011 23:34:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>219296</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 35 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0glc7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>94887</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>brandon.williams</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>