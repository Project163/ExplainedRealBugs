<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:36:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-4843] When upgrading from 1.1.6 to 1.20 change in partitioner causes nodes not to start</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-4843</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;ERROR 10:17:20,341 Cannot open /home/edward/cassandra/data/system/schema_keyspaces/system-schema_keyspaces-hf-1 because partitioner does not match org.apache.cassandra.dht.RandomPartitioner != org.apache.cassandra.dht.Murmur3Partitioner&lt;/p&gt;

&lt;p&gt;This is because 1.2 has a new default partitioner, why are we changing the default? Is this wise? The current partitioner has been rock solid for years. &lt;/p&gt;

&lt;p&gt;Should the previously known partition be stored in the schema like the previously know seed nodes, and schema?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12612879">CASSANDRA-4843</key>
            <summary>When upgrading from 1.1.6 to 1.20 change in partitioner causes nodes not to start</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="appodictic">Edward Capriolo</reporter>
                        <labels>
                    </labels>
                <created>Sun, 21 Oct 2012 14:15:29 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:24 +0000</updated>
                            <resolved>Tue, 27 Nov 2012 15:36:18 +0000</resolved>
                                        <fixVersion>1.2.0 beta 3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13480973" author="appodictic" created="Sun, 21 Oct 2012 14:18:04 +0000"  >&lt;p&gt;The error message is strange as well.&lt;/p&gt;

&lt;p&gt;Changing paritioner on a existing cluster can cause data loose, Please verify your partitioner in cassandra.yaml&lt;/p&gt;

&lt;p&gt;&quot;Can cause data *loss&quot; is impossible because Cassandra will not even start. If it did start it would definitely cause data loss.&lt;/p&gt;</comment>
                            <comment id="13480974" author="appodictic" created="Sun, 21 Oct 2012 14:20:34 +0000"  >&lt;p&gt;Also the comments say, &lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;# - RandomPartitioner distributes rows across the cluster evenly by md5.
#   When in doubt, this is the best option.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If this is the best option why is another option chosen as the default?&lt;/p&gt;</comment>
                            <comment id="13481241" author="slebresne" created="Mon, 22 Oct 2012 07:38:02 +0000"  >&lt;blockquote&gt;&lt;p&gt;why are we changing the default?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The reason is that md5 is a bit cpu intensive and in some 2ndary index requests (that does a token computation for each key on disk it scans for internal reason that can&apos;t be changed easily) this was a bottleneck. The new default is the Murmur3Partitioner that is much cheaper to compute. Besides, for every query we do compute a bunch of token and vnodes will probably not reduce that, so it&apos;s a generic improvement.&lt;/p&gt;

&lt;p&gt;That being said, I fully agree that the current upgrade experience is pretty harsh (even the NEWS file don&apos;t clearly explain the action to take to avoid this error). And since we save the partitonner and don&apos;t start if the user change it in the yaml, maybe it&apos;s time to change the behavior so that if a partitioner is saved in the system table, we use that (and log a warning if it differs from the yaml configured one).&lt;/p&gt;
</comment>
                            <comment id="13481806" author="jbellis" created="Mon, 22 Oct 2012 21:15:55 +0000"  >&lt;blockquote&gt;&lt;p&gt;maybe it&apos;s time to change the behavior so that if a partitioner is saved in the system table, we use that&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Partitioner is saved per-sstable so we can do this panic doublecheck, but you have to know (or think you know) the partitioner before you can actually open up a system table.  I could be wrong, but I don&apos;t think it&apos;s a quick fix.&lt;/p&gt;

&lt;p&gt;In the meantime, I&apos;ve updated the comments and error message in 8f3d9b8371fa7c5dea83d45d83ec7fe4911a96c0.&lt;/p&gt;</comment>
                            <comment id="13482149" author="slebresne" created="Tue, 23 Oct 2012 06:19:34 +0000"  >&lt;blockquote&gt;&lt;p&gt;but you have to know (or think you know) the partitioner before you can actually open up a system table&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t think you do since the system table keyspace uses LocalStrategy (and this is hardcoded). That being said, even if we start saving the partitioner in the system table, it&apos;s possibly a little late for the upgrade to 1.2. I still think we should do it for 1.1.7 though (but to be clear, I&apos;m all for keeping the panic doublecheck when we open a sstable because that protects again a different problem anyway).&lt;/p&gt;</comment>
                            <comment id="13504676" author="jbellis" created="Tue, 27 Nov 2012 15:31:35 +0000"  >&lt;p&gt;We missed the 1.1.7 window so I think it&apos;s pretty safe to guess that most 1.2 upgraders won&apos;t have any extra safety information we add to 1.1.8.&lt;/p&gt;

&lt;p&gt;Patch attached to clarify the exception message. &lt;/p&gt;</comment>
                            <comment id="13504677" author="slebresne" created="Tue, 27 Nov 2012 15:33:26 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13504679" author="jbellis" created="Tue, 27 Nov 2012 15:36:18 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12555016" name="4843.txt" size="1119" author="jbellis" created="Tue, 27 Nov 2012 15:31:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>250189</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0audr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>61195</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>