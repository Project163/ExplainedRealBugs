<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:21:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-2633] Keys get lost in bootstrap</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-2633</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;When bootstrapping a new node, the key at the upper end of the new node&apos;s range can get lost.  To reproduce:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Set up one cassandra node, create a keyspace and column family and perform some inserts&lt;/li&gt;
	&lt;li&gt;Read every row back&lt;/li&gt;
	&lt;li&gt;Bootstrap a second node&lt;/li&gt;
	&lt;li&gt;Read every row back&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;You find one row is missing, whose row key is exactly equal to the token the new node gets (for OPP - for RP it&apos;s the key whose hash is equal to the token).  If you don&apos;t do the reads after the inserts, the key is not lost.  I tracked the problem down to o.a.c.io.sstable.SSTableReader in getPosition.  The problem is that the cached position is used if it is there (so only if the reads were performed).  But this is incorrect because the cached position is the start of the row, not the end.  This means the end row itself is not transferred.  This causes the last key in the range to get lost.&lt;/p&gt;

&lt;p&gt;Although I haven&apos;t seen it, this may occur during antientropy repairs too.&lt;/p&gt;

&lt;p&gt;The attached patch (against the 0.7 branch) fixes it by not using the cache for Operator.GT.  I haven&apos;t tested with 0.8 but from looking at the code I think the problem is present.&lt;/p&gt;

&lt;p&gt;This might be related to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1992&quot; title=&quot;Bootstrap breaks data stored (missing rows, extra rows, column values modified)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1992&quot;&gt;&lt;del&gt;CASSANDRA-1992&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12506829">CASSANDRA-2633</key>
            <summary>Keys get lost in bootstrap</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10000" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Urgent</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="richardlow">Richard Low</assignee>
                                    <reporter username="richardlow">Richard Low</reporter>
                        <labels>
                    </labels>
                <created>Wed, 11 May 2011 10:36:19 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:59 +0000</updated>
                            <resolved>Wed, 11 May 2011 20:55:23 +0000</resolved>
                                        <fixVersion>0.7.6</fixVersion>
                    <fixVersion>0.8.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                    <workratio workratioPercent="0"/>
                                                                    <timeoriginalestimate seconds="0">0h</timeoriginalestimate>
                            <timeestimate seconds="0">0h</timeestimate>
                                        <comments>
                            <comment id="13031748" author="jbellis" created="Wed, 11 May 2011 14:43:52 +0000"  >&lt;p&gt;So say we have a node A with rows A B C D on it.&lt;/p&gt;

&lt;p&gt;We bootstrap a node C.&lt;/p&gt;

&lt;p&gt;C requests (A, C] from A.&lt;/p&gt;

&lt;p&gt;A will do a GT scan starting with A.  So a cache hit will result in &lt;span class=&quot;error&quot;&gt;&amp;#91;A, C&amp;#93;&lt;/span&gt; being transferred instead. That is a bug, I&apos;ll see if I can create a unit test that demonstrates that separately.&lt;/p&gt;

&lt;p&gt;But I don&apos;t see how this affects the C row?&lt;/p&gt;</comment>
                            <comment id="13031768" author="richardlow" created="Wed, 11 May 2011 15:07:42 +0000"  >&lt;p&gt;A cache hit results in [A, C) being returned.  All GT scans with cache hits give positions at the start of the row rather than the end.  The above patch fixes both ends - skip over A, but include C.&lt;/p&gt;</comment>
                            <comment id="13031777" author="jbellis" created="Wed, 11 May 2011 15:22:00 +0000"  >&lt;p&gt;getPosition only affects start of scan, not end.&lt;/p&gt;</comment>
                            <comment id="13031787" author="slebresne" created="Wed, 11 May 2011 15:32:57 +0000"  >&lt;p&gt;Good catch. Attaching a unit test to catch the bug.&lt;/p&gt;</comment>
                            <comment id="13031789" author="richardlow" created="Wed, 11 May 2011 15:36:00 +0000"  >&lt;p&gt;It looks to me that for client reads, getPosition is just used for the start of an iterator, as you say.  But for streaming, getPosition is used for the end position too in SSTableReader.getPositionsForRanges.  Or have I misunderstood what&apos;s going on?&lt;/p&gt;</comment>
                            <comment id="13031791" author="slebresne" created="Wed, 11 May 2011 15:39:39 +0000"  >&lt;blockquote&gt;&lt;p&gt;But I don&apos;t see how this affects the C row?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This affects the C row because it will use the position of C found as the position where to stop scanning. But the position of C is the start of C, so when used as an end position, it excludes it. That is, getPositionForRanges will return (start of A, start of C), which results in scanning [A, C) as Richard says.&lt;/p&gt;

&lt;p&gt;So +1 on this.&lt;/p&gt;</comment>
                            <comment id="13031807" author="jbellis" created="Wed, 11 May 2011 16:03:06 +0000"  >&lt;p&gt;got it.  committed, thanks!&lt;/p&gt;</comment>
                            <comment id="13031995" author="hudson" created="Wed, 11 May 2011 19:44:05 +0000"  >&lt;p&gt;Integrated in Cassandra-0.7 #480 (See &lt;a href=&quot;https://builds.apache.org/hudson/job/Cassandra-0.7/480/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/hudson/job/Cassandra-0.7/480/&lt;/a&gt;)&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12478797" name="0.7-2633.txt" size="1309" author="richardlow" created="Wed, 11 May 2011 10:38:15 +0000"/>
                            <attachment id="12478832" name="0001-2633-unit-test.patch" size="2860" author="slebresne" created="Wed, 11 May 2011 15:32:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[richardlow]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20743</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 28 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gcj3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>93460</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>