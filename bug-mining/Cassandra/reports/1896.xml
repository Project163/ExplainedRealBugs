<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:36:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-4934] assertion error in offheap bloom filter</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-4934</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Saw this while running the dtests:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; INFO [CompactionExecutor:2] 2012-11-08 09:35:18,206 CompactionTask.java (line 116) Compacting [SSTableReader(path=&apos;/tmp/dtest-n2D_fM/test/node2/data/system/local/system-local-ia-9-Data.db&apos;), SSTableReader(path=&apos;/tmp/dtest-n2D_fM/test/node2/data/system/local/system-local-ia-11-Data.db&apos;), SSTableReader(path=&apos;/tmp/dtest-n2D_fM/test/node2/data/system/local/system-local-ia-10-Data.db&apos;), SSTableReader(path=&apos;/tmp/dtest-n2D_fM/test/node2/data/system/local/system-local-ia-13-Data.db&apos;)]
ERROR [CompactionExecutor:2] 2012-11-08 09:35:18,257 CassandraDaemon.java (line 132) Exception in thread Thread[CompactionExecutor:2,1,main]
java.lang.AssertionError: Memory was freed
    at org.apache.cassandra.io.util.Memory.checkPosition(Memory.java:134)
    at org.apache.cassandra.io.util.Memory.getByte(Memory.java:104)
    at org.apache.cassandra.utils.obs.OffHeapBitSet.get(OffHeapBitSet.java:60)
    at org.apache.cassandra.utils.BloomFilter.isPresent(BloomFilter.java:71)
    at org.apache.cassandra.db.compaction.CompactionController.shouldPurge(CompactionController.java:106)
    at org.apache.cassandra.db.compaction.PrecompactedRow.removeDeletedAndOldShards(PrecompactedRow.java:64)
    at org.apache.cassandra.db.compaction.PrecompactedRow.&amp;lt;init&amp;gt;(PrecompactedRow.java:95)
    at org.apache.cassandra.db.compaction.CompactionController.getCompactedRow(CompactionController.java:151)
    at org.apache.cassandra.db.compaction.CompactionIterable$Reducer.getReduced(CompactionIterable.java:72)
    at org.apache.cassandra.db.compaction.CompactionIterable$Reducer.getReduced(CompactionIterable.java:57)
    at org.apache.cassandra.utils.MergeIterator$ManyToOne.consume(MergeIterator.java:114)
    at org.apache.cassandra.utils.MergeIterator$ManyToOne.computeNext(MergeIterator.java:97)
    at com.google.common.collect.AbstractIterator.tryToComputeNext(AbstractIterator.java:143)
    at com.google.common.collect.AbstractIterator.hasNext(AbstractIterator.java:138)
    at com.google.common.collect.Iterators$8.computeNext(Iterators.java:734)
    at com.google.common.collect.AbstractIterator.tryToComputeNext(AbstractIterator.java:143)
    at com.google.common.collect.AbstractIterator.hasNext(AbstractIterator.java:138)
    at org.apache.cassandra.db.compaction.CompactionTask.runWith(CompactionTask.java:146)
    at org.apache.cassandra.io.util.DiskAwareRunnable.runMayThrow(DiskAwareRunnable.java:48)
    at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:28)
    at org.apache.cassandra.db.compaction.CompactionTask.execute(CompactionTask.java:69)
    at org.apache.cassandra.db.compaction.CompactionManager$BackgroundCompactionTask.run(CompactionManager.java:179)
    at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441)
    at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)
    at java.util.concurrent.FutureTask.run(FutureTask.java:138)
    at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
    at java.lang.Thread.run(Thread.java:662)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12615341">CASSANDRA-4934</key>
            <summary>assertion error in offheap bloom filter</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="brandon.williams">Brandon Williams</reporter>
                        <labels>
                    </labels>
                <created>Thu, 8 Nov 2012 15:57:13 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:23 +0000</updated>
                            <resolved>Fri, 9 Nov 2012 21:17:55 +0000</resolved>
                                        <fixVersion>1.2.0 beta 3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13493432" author="vijay2win@yahoo.com" created="Thu, 8 Nov 2012 19:35:26 +0000"  >&lt;p&gt;Looks like the compaction task is not referencing the SSTR which is understandable, not sure which part of the code is closing more than it is openings.... I can see one, but it is rare... any other error message in the logs (It will speedup the search for bug) &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; ? Thanks!&lt;/p&gt;</comment>
                            <comment id="13493436" author="brandon.williams" created="Thu, 8 Nov 2012 19:38:14 +0000"  >&lt;p&gt;I didn&apos;t see anything else useful, but here&apos;s the whole thing.&lt;/p&gt;</comment>
                            <comment id="13493751" author="vijay2win@yahoo.com" created="Fri, 9 Nov 2012 05:41:52 +0000"  >&lt;p&gt;From the logs i see the following events: &lt;/p&gt;

&lt;p&gt;at, 2012-11-08 09:35:18,257 compaction failed on &lt;/p&gt;

&lt;p&gt;SSTableReader(path=&apos;/tmp/dtest-n2D_fM/test/node2/data/system/local/system-local-ia-9-Data.db&apos;), &lt;br/&gt;
SSTableReader(path=&apos;/tmp/dtest-n2D_fM/test/node2/data/system/local/system-local-ia-11-Data.db&apos;), &lt;br/&gt;
SSTableReader(path=&apos;/tmp/dtest-n2D_fM/test/node2/data/system/local/system-local-ia-10-Data.db&apos;), &lt;br/&gt;
SSTableReader(path=&apos;/tmp/dtest-n2D_fM/test/node2/data/system/local/system-local-ia-13-Data.db&apos;)]&lt;/p&gt;

&lt;p&gt;at, 2012-11-08 09:35:18,290 Compaction completed sucessfully on&lt;/p&gt;

&lt;p&gt;SSTableReader(path=&apos;/tmp/dtest-n2D_fM/test/node2/data/system/local/system-local-ia-9-Data.db&apos;), &lt;br/&gt;
SSTableReader(path=&apos;/tmp/dtest-n2D_fM/test/node2/data/system/local/system-local-ia-11-Data.db&apos;), &lt;br/&gt;
SSTableReader(path=&apos;/tmp/dtest-n2D_fM/test/node2/data/system/local/system-local-ia-10-Data.db&apos;), &lt;br/&gt;
SSTableReader(path=&apos;/tmp/dtest-n2D_fM/test/node2/data/system/local/system-local-ia-12-Data.db&apos;), &lt;br/&gt;
SSTableReader(path=&apos;/tmp/dtest-n2D_fM/test/node2/data/system/local/system-local-ia-13-Data.db&apos;)]&lt;/p&gt;

&lt;p&gt;only thing which i can think of is to make Memory peer variable volatile but not sure i am looking at right places.&lt;/p&gt;</comment>
                            <comment id="13494082" author="jbellis" created="Fri, 9 Nov 2012 16:12:33 +0000"  >&lt;p&gt;I think the problem is that compaction never bothered to mark overlapped sstables (that it uses for tombstone purge checking) as referenced, so those can get free&apos;d out from under an ongoing compaction.  Before OHBS this was not a problem because the contents of those sstables was never referenced, only the bloom filter, which the GC kept around as long as it was needed.  But now we need to manually manage that.&lt;/p&gt;

&lt;p&gt;Patchset pushed to &lt;a href=&quot;http://github.com/jbellis/cassandra/branches/4934&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://github.com/jbellis/cassandra/branches/4934&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13494195" author="vijay2win@yahoo.com" created="Fri, 9 Nov 2012 18:41:26 +0000"  >&lt;p&gt;+1 (ignore my first comment getOverlappingSSTables will return a diffrent set).&lt;br/&gt;
Honestly, i did think about this somehow missed the overlapping SST code path earlier &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13494316" author="jbellis" created="Fri, 9 Nov 2012 21:17:55 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12552695" name="log.txt" size="37447" author="brandon.williams" created="Thu, 8 Nov 2012 19:38:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>255974</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 2 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0g6jz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>92492</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>vijay2win@yahoo.com</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[vijay2win@yahoo.com]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>