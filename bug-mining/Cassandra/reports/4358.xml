<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:03:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-11315] Fix upgrading sparse tables that are incorrectly marked as dense</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-11315</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;when trying to upgrade our development cluster from C* 2.2.5 to 3.0.3 Cassandra fails during startup.&lt;/p&gt;

&lt;p&gt;Here&apos;s the relevant log snippet:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[...]
INFO  [main] 2016-03-08 11:42:01,291 ColumnFamilyStore.java:381 - Initializing system.schema_triggers
INFO  [main] 2016-03-08 11:42:01,302 ColumnFamilyStore.java:381 - Initializing system.schema_usertypes
INFO  [main] 2016-03-08 11:42:01,313 ColumnFamilyStore.java:381 - Initializing system.schema_functions
INFO  [main] 2016-03-08 11:42:01,324 ColumnFamilyStore.java:381 - Initializing system.schema_aggregates
INFO  [main] 2016-03-08 11:42:01,576 SystemKeyspace.java:1284 - Detected version upgrade from 2.2.5 to 3.0.3, snapshotting system keyspace
WARN  [main] 2016-03-08 11:42:01,911 CompressionParams.java:382 - The sstable_compression option has been deprecated. You should use class instead
WARN  [main] 2016-03-08 11:42:01,959 CompressionParams.java:333 - The chunk_length_kb option has been deprecated. You should use chunk_length_in_kb instead
ERROR [main] 2016-03-08 11:42:02,638 CassandraDaemon.java:692 - Exception encountered during startup
java.lang.AssertionError: null
        at org.apache.cassandra.db.CompactTables.getCompactValueColumn(CompactTables.java:90) ~[apache-cassandra-3.0.3.jar:3.0.3]
        at org.apache.cassandra.config.CFMetaData.rebuild(CFMetaData.java:315) ~[apache-cassandra-3.0.3.jar:3.0.3]
        at org.apache.cassandra.config.CFMetaData.&amp;lt;init&amp;gt;(CFMetaData.java:291) ~[apache-cassandra-3.0.3.jar:3.0.3]
        at org.apache.cassandra.config.CFMetaData.create(CFMetaData.java:367) ~[apache-cassandra-3.0.3.jar:3.0.3]
        at org.apache.cassandra.schema.LegacySchemaMigrator.decodeTableMetadata(LegacySchemaMigrator.java:337) ~[apache-cassandra-3.0.3.jar:3.0.3]
        at org.apache.cassandra.schema.LegacySchemaMigrator.readTableMetadata(LegacySchemaMigrator.java:273) ~[apache-cassandra-3.0.3.jar:3.0.3]
        at org.apache.cassandra.schema.LegacySchemaMigrator.readTable(LegacySchemaMigrator.java:244) ~[apache-cassandra-3.0.3.jar:3.0.3]
        at org.apache.cassandra.schema.LegacySchemaMigrator.lambda$readTables$227(LegacySchemaMigrator.java:237) ~[apache-cassandra-3.0.3.jar:3.0.3]
        at java.util.ArrayList.forEach(ArrayList.java:1249) ~[na:1.8.0_74]
        at org.apache.cassandra.schema.LegacySchemaMigrator.readTables(LegacySchemaMigrator.java:237) ~[apache-cassandra-3.0.3.jar:3.0.3]
        at org.apache.cassandra.schema.LegacySchemaMigrator.readKeyspace(LegacySchemaMigrator.java:186) ~[apache-cassandra-3.0.3.jar:3.0.3]
        at org.apache.cassandra.schema.LegacySchemaMigrator.lambda$readSchema$224(LegacySchemaMigrator.java:177) ~[apache-cassandra-3.0.3.jar:3.0.3]
        at java.util.ArrayList.forEach(ArrayList.java:1249) ~[na:1.8.0_74]
        at org.apache.cassandra.schema.LegacySchemaMigrator.readSchema(LegacySchemaMigrator.java:177) ~[apache-cassandra-3.0.3.jar:3.0.3]
        at org.apache.cassandra.schema.LegacySchemaMigrator.migrate(LegacySchemaMigrator.java:77) ~[apache-cassandra-3.0.3.jar:3.0.3]
        at org.apache.cassandra.service.CassandraDaemon.setup(CassandraDaemon.java:223) [apache-cassandra-3.0.3.jar:3.0.3]
        at org.apache.cassandra.service.CassandraDaemon.activate(CassandraDaemon.java:551) [apache-cassandra-3.0.3.jar:3.0.3]
        at org.apache.cassandra.service.CassandraDaemon.main(CassandraDaemon.java:679) [apache-cassandra-3.0.3.jar:3.0.3]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;Ubuntu 14.04, Oracle Java 8, Apache Cassandra 2.2.5 -&amp;gt; 3.0.3, Apache Cassandra 2.2.6 -&amp;gt; 3.0.5&lt;/p&gt;</environment>
        <key id="12947982">CASSANDRA-11315</key>
            <summary>Fix upgrading sparse tables that are incorrectly marked as dense</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aleksey">Aleksey Yeschenko</assignee>
                                    <reporter username="luxifer">Dominik Keil</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Mar 2016 11:46:22 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:40 +0000</updated>
                            <resolved>Mon, 11 Jul 2016 13:35:16 +0000</resolved>
                                        <fixVersion>3.0.9</fixVersion>
                    <fixVersion>3.8</fixVersion>
                                    <component>Legacy/Distributed Metadata</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="15187122" author="iamaleksey" created="Wed, 9 Mar 2016 14:00:07 +0000"  >&lt;p&gt;Can you please attach your 2.2.5 schema? Thanks.&lt;/p&gt;</comment>
                            <comment id="15191045" author="iamaleksey" created="Fri, 11 Mar 2016 15:08:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=luxifer&quot; class=&quot;user-hover&quot; rel=&quot;luxifer&quot;&gt;luxifer&lt;/a&gt; Thanks for sending the data. I&apos;ll have a look next week.&lt;/p&gt;</comment>
                            <comment id="15208958" author="iamaleksey" created="Wed, 23 Mar 2016 18:59:26 +0000"  >&lt;p&gt;The issue is ultimately that your tables in &apos;Auth_0&apos; keyspace all have &lt;tt&gt;is_dense&lt;/tt&gt; set to &lt;tt&gt;true&lt;/tt&gt; in &lt;tt&gt;system.schema_columnfamilies&lt;/tt&gt;, while it should be false for all of them.&lt;/p&gt;

&lt;p&gt;How and when did you create that keyspace with the tables in the first place? Were you using cli or cqlsh? What version of C* did that first happen in?&lt;/p&gt;</comment>
                            <comment id="15208973" author="christianmovi" created="Wed, 23 Mar 2016 19:12:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iamaleksey&quot; class=&quot;user-hover&quot; rel=&quot;iamaleksey&quot;&gt;iamaleksey&lt;/a&gt;:&lt;br/&gt;
The Auth_0 keyspace was bascially created by CLI. It is one of the keyspaces created by our automated testsuite (it seems someone connected his IDE to the D system, so the schema was created there).&lt;/p&gt;

&lt;p&gt;One thing that is special: After creation, the tests modify the keyspace via the thrift API:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;            &lt;span class=&quot;code-comment&quot;&gt;// update gc grace seconds to 0
&lt;/span&gt;            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Cluster cluster = keyspace.getCluster();
            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; keyspaceName = keyspace.getKeyspace().getKeyspaceName();
            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; KeyspaceDefinition keyspaceDefinition = cluster.describeKeyspace(keyspaceName);
            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; List&amp;lt;ColumnFamilyDefinition&amp;gt; cfDefs = keyspaceDefinition.getCfDefs();
            &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ColumnFamilyDefinition cfDef : cfDefs)
            {
                cfDef.setGcGraceSeconds(0);
                cfDef.setMemtableFlushAfterMins(&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.MAX_VALUE);
                cfDef.setReadRepairChance(0.0);
                cfDef.setKeyCacheSavePeriodInSeconds(&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.MAX_VALUE);
                cluster.updateColumnFamily(cfDef);
            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15208977" author="iamaleksey" created="Wed, 23 Mar 2016 19:17:13 +0000"  >&lt;p&gt;Thanks. In the meantime, are you willing to experiment a little in staging, and set, manually, &lt;tt&gt;is_dense&lt;/tt&gt; to &lt;tt&gt;false&lt;/tt&gt; on all of those tables - using cqlsh - in 2.2.5, and then upgrade to 3.0.latest, see if you can read the data successfully then?&lt;/p&gt;</comment>
                            <comment id="15209006" author="christianmovi" created="Wed, 23 Mar 2016 19:37:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iamaleksey&quot; class=&quot;user-hover&quot; rel=&quot;iamaleksey&quot;&gt;iamaleksey&lt;/a&gt;:&lt;br/&gt;
How can we explicitly disable dense manually? I would simply rename the columns using CQLSH, to give them a CQL3 schema.&lt;/p&gt;

&lt;p&gt;btw: I assume MDS_0 has the same issue?&lt;/p&gt;</comment>
                            <comment id="15209159" author="iamaleksey" created="Wed, 23 Mar 2016 20:59:02 +0000"  >&lt;p&gt;Just use &lt;tt&gt;UPDATE&lt;/tt&gt; statements to &lt;tt&gt;SET is_dense = false&lt;/tt&gt; for those columns in &lt;tt&gt;system.schema_columnfamilies&lt;/tt&gt; table.&lt;/p&gt;</comment>
                            <comment id="15210195" author="luxifer" created="Thu, 24 Mar 2016 13:19:23 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iamaleksey&quot; class=&quot;user-hover&quot; rel=&quot;iamaleksey&quot;&gt;iamaleksey&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;now we&apos;re getting a different startup error &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;INFO  [main] 2016-03-24 13:16:37,282 SystemKeyspace.java:1284 - Detected version upgrade from 2.2.5 to 3.0.4, snapshotting system keyspace
WARN  [main] 2016-03-24 13:16:37,721 CompressionParams.java:382 - The sstable_compression option has been deprecated. You should use class instead
INFO  [ScheduledTasks:1] 2016-03-24 13:16:37,752 TokenMetadata.java:448 - Updating topology for all endpoints that have changed
WARN  [main] 2016-03-24 13:16:37,761 CompressionParams.java:333 - The chunk_length_kb option has been deprecated. You should use chunk_length_in_kb instead
ERROR [main] 2016-03-24 13:16:37,880 CassandraDaemon.java:692 - Exception encountered during startup
org.apache.cassandra.serializers.MarshalException: Unable to make long from &apos;value&apos;
        at org.apache.cassandra.db.marshal.LongType.fromString(LongType.java:72) ~[apache-cassandra-3.0.4.jar:3.0.4]
        at org.apache.cassandra.schema.LegacySchemaMigrator.createColumnFromColumnRow(LegacySchemaMigrator.java:621) ~[apache-cassandra-3.0.4.jar:3.0.4]
        at org.apache.cassandra.schema.LegacySchemaMigrator.createColumnsFromColumnRows(LegacySchemaMigrator.java:580) ~[apache-cassandra-3.0.4.jar:3.0.4]
        at org.apache.cassandra.schema.LegacySchemaMigrator.decodeTableMetadata(LegacySchemaMigrator.java:314) ~[apache-cassandra-3.0.4.jar:3.0.4]
        at org.apache.cassandra.schema.LegacySchemaMigrator.readTableMetadata(LegacySchemaMigrator.java:273) ~[apache-cassandra-3.0.4.jar:3.0.4]
        at org.apache.cassandra.schema.LegacySchemaMigrator.readTable(LegacySchemaMigrator.java:244) ~[apache-cassandra-3.0.4.jar:3.0.4]
        at org.apache.cassandra.schema.LegacySchemaMigrator.lambda$readTables$233(LegacySchemaMigrator.java:237) ~[apache-cassandra-3.0.4.jar:3.0.4]
        at java.util.ArrayList.forEach(ArrayList.java:1249) ~[na:1.8.0_74]
        at org.apache.cassandra.schema.LegacySchemaMigrator.readTables(LegacySchemaMigrator.java:237) ~[apache-cassandra-3.0.4.jar:3.0.4]
        at org.apache.cassandra.schema.LegacySchemaMigrator.readKeyspace(LegacySchemaMigrator.java:186) ~[apache-cassandra-3.0.4.jar:3.0.4]
        at org.apache.cassandra.schema.LegacySchemaMigrator.lambda$readSchema$230(LegacySchemaMigrator.java:177) ~[apache-cassandra-3.0.4.jar:3.0.4]
        at java.util.ArrayList.forEach(ArrayList.java:1249) ~[na:1.8.0_74]
        at org.apache.cassandra.schema.LegacySchemaMigrator.readSchema(LegacySchemaMigrator.java:177) ~[apache-cassandra-3.0.4.jar:3.0.4]
        at org.apache.cassandra.schema.LegacySchemaMigrator.migrate(LegacySchemaMigrator.java:77) ~[apache-cassandra-3.0.4.jar:3.0.4]
        at org.apache.cassandra.service.CassandraDaemon.setup(CassandraDaemon.java:223) [apache-cassandra-3.0.4.jar:3.0.4]
        at org.apache.cassandra.service.CassandraDaemon.activate(CassandraDaemon.java:551) [apache-cassandra-3.0.4.jar:3.0.4]
        at org.apache.cassandra.service.CassandraDaemon.main(CassandraDaemon.java:679) [apache-cassandra-3.0.4.jar:3.0.4]
Caused by: java.lang.NumberFormatException: For input string: &quot;value&quot;
        at java.lang.NumberFormatException.forInputString(NumberFormatException.java:65) ~[na:1.8.0_74]
        at java.lang.Long.parseLong(Long.java:589) ~[na:1.8.0_74]
        at java.lang.Long.parseLong(Long.java:631) ~[na:1.8.0_74]
        at org.apache.cassandra.db.marshal.LongType.fromString(LongType.java:68) ~[apache-cassandra-3.0.4.jar:3.0.4]
        ... 16 common frames omitted
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15210224" author="luxifer" created="Thu, 24 Mar 2016 13:36:06 +0000"  >&lt;p&gt;Interestingly, we now get another exception when starting with 2.2.5 again - but only on one of the two nodes. The reverting process was as follows: 1) delete all data files 2) link all data files from snapshot taken before the upgrade 3) start C* 2.2.5&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[...]
INFO  [main] 2016-03-24 13:23:51,167 ColumnFamilyStore.java:382 - Initializing system.range_xfers
ERROR [main] 2016-03-24 13:23:51,475 CassandraDaemon.java:638 - Exception encountered during startup
java.lang.IndexOutOfBoundsException: Index: 1, Size: 1
        at java.util.ArrayList.rangeCheck(ArrayList.java:653) ~[na:1.8.0_74]
        at java.util.ArrayList.set(ArrayList.java:444) ~[na:1.8.0_74]
        at org.apache.cassandra.config.CFMetaData.rebuild(CFMetaData.java:1265) ~[apache-cassandra-2.2.5.jar:2.2.5]
        at org.apache.cassandra.schema.LegacySchemaTables.createTableFromTableRowAndColumnRows(LegacySchemaTables.java:1115) ~[apache-cassandra-2.2.5.jar:2.2.5]
        at org.apache.cassandra.schema.LegacySchemaTables.createTableFromTableRowAndColumnsPartition(LegacySchemaTables.java:1017) ~[apache-cassandra-2.2.5.jar:2.2.5]
        at org.apache.cassandra.schema.LegacySchemaTables.createTableFromTableRow(LegacySchemaTables.java:1037) ~[apache-cassandra-2.2.5.jar:2.2.5]
        at org.apache.cassandra.schema.LegacySchemaTables.createTablesFromTablesPartition(LegacySchemaTables.java:1002) ~[apache-cassandra-2.2.5.jar:2.2.5]
        at org.apache.cassandra.schema.LegacySchemaTables.createKeyspaceFromSchemaPartitions(LegacySchemaTables.java:735) ~[apache-cassandra-2.2.5.jar:2.2.5]
        at org.apache.cassandra.schema.LegacySchemaTables.readSchemaFromSystemTables(LegacySchemaTables.java:219) ~[apache-cassandra-2.2.5.jar:2.2.5]
        at org.apache.cassandra.config.Schema.loadFromDisk(Schema.java:109) ~[apache-cassandra-2.2.5.jar:2.2.5]
        at org.apache.cassandra.config.Schema.loadFromDisk(Schema.java:99) ~[apache-cassandra-2.2.5.jar:2.2.5]
        at org.apache.cassandra.service.CassandraDaemon.setup(CassandraDaemon.java:209) [apache-cassandra-2.2.5.jar:2.2.5]
        at org.apache.cassandra.service.CassandraDaemon.activate(CassandraDaemon.java:516) [apache-cassandra-2.2.5.jar:2.2.5]
        at org.apache.cassandra.service.CassandraDaemon.main(CassandraDaemon.java:625) [apache-cassandra-2.2.5.jar:2.2.5]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There are no sstables for that table whatsoever... just a &quot;manifest.json&quot; file. Removing this did not help&lt;/p&gt;</comment>
                            <comment id="15210239" author="luxifer" created="Thu, 24 Mar 2016 13:47:13 +0000"  >&lt;p&gt;rm system/schema_&lt;b&gt;/&lt;/b&gt; did the trick but that wouldn&apos;t be so desirable at any rate &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15277937" author="luxifer" created="Tue, 10 May 2016 10:50:31 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iamaleksey&quot; class=&quot;user-hover&quot; rel=&quot;iamaleksey&quot;&gt;iamaleksey&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;do you have any news on that? We&apos;ve tried again, with yet another error &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ERROR [main] 2016-05-10 10:46:18,277 CassandraDaemon.java:692 - Exception encountered during startup
org.apache.cassandra.serializers.MarshalException: Unable to make long from &apos;value&apos;
        at org.apache.cassandra.db.marshal.LongType.fromString(LongType.java:72) ~[apache-cassandra-3.0.5.jar:3.0.5]
        at org.apache.cassandra.schema.LegacySchemaMigrator.createColumnFromColumnRow(LegacySchemaMigrator.java:682) ~[apache-cassandra-3.0.5.jar:3.0.5]
        at org.apache.cassandra.schema.LegacySchemaMigrator.createColumnsFromColumnRows(LegacySchemaMigrator.java:641) ~[apache-cassandra-3.0.5.jar:3.0.5]
        at org.apache.cassandra.schema.LegacySchemaMigrator.decodeTableMetadata(LegacySchemaMigrator.java:316) ~[apache-cassandra-3.0.5.jar:3.0.5]
        at org.apache.cassandra.schema.LegacySchemaMigrator.readTableMetadata(LegacySchemaMigrator.java:273) ~[apache-cassandra-3.0.5.jar:3.0.5]
        at org.apache.cassandra.schema.LegacySchemaMigrator.readTable(LegacySchemaMigrator.java:244) ~[apache-cassandra-3.0.5.jar:3.0.5]
        at org.apache.cassandra.schema.LegacySchemaMigrator.lambda$readTables$234(LegacySchemaMigrator.java:237) ~[apache-cassandra-3.0.5.jar:3.0.5]
        at java.util.ArrayList.forEach(ArrayList.java:1249) ~[na:1.8.0_91]
        at org.apache.cassandra.schema.LegacySchemaMigrator.readTables(LegacySchemaMigrator.java:237) ~[apache-cassandra-3.0.5.jar:3.0.5]
        at org.apache.cassandra.schema.LegacySchemaMigrator.readKeyspace(LegacySchemaMigrator.java:186) ~[apache-cassandra-3.0.5.jar:3.0.5]
        at org.apache.cassandra.schema.LegacySchemaMigrator.lambda$readSchema$231(LegacySchemaMigrator.java:177) ~[apache-cassandra-3.0.5.jar:3.0.5]
        at java.util.ArrayList.forEach(ArrayList.java:1249) ~[na:1.8.0_91]
        at org.apache.cassandra.schema.LegacySchemaMigrator.readSchema(LegacySchemaMigrator.java:177) ~[apache-cassandra-3.0.5.jar:3.0.5]
        at org.apache.cassandra.schema.LegacySchemaMigrator.migrate(LegacySchemaMigrator.java:77) ~[apache-cassandra-3.0.5.jar:3.0.5]
        at org.apache.cassandra.service.CassandraDaemon.setup(CassandraDaemon.java:223) [apache-cassandra-3.0.5.jar:3.0.5]
        at org.apache.cassandra.service.CassandraDaemon.activate(CassandraDaemon.java:551) [apache-cassandra-3.0.5.jar:3.0.5]
        at org.apache.cassandra.service.CassandraDaemon.main(CassandraDaemon.java:679) [apache-cassandra-3.0.5.jar:3.0.5]
Caused by: java.lang.NumberFormatException: For input string: &quot;value&quot;
        at java.lang.NumberFormatException.forInputString(NumberFormatException.java:65) ~[na:1.8.0_91]
        at java.lang.Long.parseLong(Long.java:589) ~[na:1.8.0_91]
        at java.lang.Long.parseLong(Long.java:631) ~[na:1.8.0_91]
        at org.apache.cassandra.db.marshal.LongType.fromString(LongType.java:68) ~[apache-cassandra-3.0.5.jar:3.0.5]
        ... 16 common frames omitted
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15277941" author="iamaleksey" created="Tue, 10 May 2016 10:52:45 +0000"  >&lt;blockquote&gt;&lt;p&gt;do you have any news on that? We&apos;ve tried again, with yet another error&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I know what the problem is (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11502&quot; title=&quot;Fix denseness and column metadata updates coming from Thrift&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11502&quot;&gt;&lt;del&gt;CASSANDRA-11502&lt;/del&gt;&lt;/a&gt;, originally), and I know how to fix the migration on 3.0 side. Just didn&apos;t have time to deal with it just yet. Probably next weekish.&lt;/p&gt;</comment>
                            <comment id="15329614" author="christianmovi" created="Tue, 14 Jun 2016 14:52:23 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iamaleksey&quot; class=&quot;user-hover&quot; rel=&quot;iamaleksey&quot;&gt;iamaleksey&lt;/a&gt;, do you still have this ticket on your radar? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15339709" author="iamaleksey" created="Mon, 20 Jun 2016 15:26:23 +0000"  >&lt;blockquote&gt;&lt;p&gt;Hi Aleksey Yeschenko, do you still have this ticket on your radar? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Literally next on my list (:&lt;/p&gt;</comment>
                            <comment id="15357023" author="iamaleksey" created="Thu, 30 Jun 2016 12:39:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=christianmovi&quot; class=&quot;user-hover&quot; rel=&quot;christianmovi&quot;&gt;christianmovi&lt;/a&gt; Writing tests now, but if you are willing to try the fix out, see &lt;a href=&quot;https://github.com/iamaleksey/cassandra/commits/11315-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this branch&lt;/a&gt;. Works locally, should work for you too.&lt;/p&gt;</comment>
                            <comment id="15364750" author="iamaleksey" created="Wed, 6 Jul 2016 17:56:12 +0000"  >&lt;p&gt;Working on dtest coverage for this with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhatch&quot; class=&quot;user-hover&quot; rel=&quot;rhatch&quot;&gt;rhatch&lt;/a&gt; - also for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12147&quot; title=&quot;Static thrift tables with non UTF8Type comparators can have column names converted incorrectly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12147&quot;&gt;&lt;del&gt;CASSANDRA-12147&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12023&quot; title=&quot;Schema upgrade bug with super columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12023&quot;&gt;&lt;del&gt;CASSANDRA-12023&lt;/del&gt;&lt;/a&gt; (all of similar structure). The patch is ready for review though.&lt;/p&gt;</comment>
                            <comment id="15365906" author="slebresne" created="Thu, 7 Jul 2016 10:10:36 +0000"  >&lt;p&gt;+1, with the very minor nit that I&apos;d rename &lt;tt&gt;s/filterOutRedundantRows/filterOutRedundantRowForSparse&lt;/tt&gt; to make it clearer why it can throw away what it does without having to look at the usage.&lt;/p&gt;</comment>
                            <comment id="15370759" author="iamaleksey" created="Mon, 11 Jul 2016 13:35:01 +0000"  >&lt;p&gt;Thanks. Committed as &lt;a href=&quot;https://github.com/apache/cassandra/commit/f37b6f145d3db2b14de38b2c75f390f7a3113c85&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;f37b6f145d3db2b14de38b2c75f390f7a3113c85&lt;/a&gt; to 3.0, with the nit addressed, and merged with 3.9 and trunk. Tests being worked on &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/commits/thrift_schema_upgrade&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12956207">CASSANDRA-11502</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 19 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ubvb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12334361">3.0.3</customfieldvalue>
    <customfieldvalue id="12334792">3.0.4</customfieldvalue>
    <customfieldvalue id="12334964">3.0.5</customfieldvalue>
    <customfieldvalue id="12335694">3.0.7</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>