<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:15:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-15727] Internode messaging connection setup between 4.0 and legacy SSL 3.0 fails if initial connection version incorrect</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-15727</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;This was discovered while testing upgrading an SSL enabled cluster from 3.0 to 4.0.  The 3.0 cluster was configured to only listen on the ssl storage port. When the upgraded 4.0 node started it received a gossip messsage that triggered a shadow round before it had correctly set the messaging versions for the other endpoints.&lt;/p&gt;

&lt;p&gt;Sending the message created the connection, but because the endpoint defaulted to &lt;tt&gt;VERSION_40&lt;/tt&gt; the initial connect attempt was to the regular &lt;tt&gt;storage_port&lt;/tt&gt;.  The 3.0 node was only listening on the &lt;tt&gt;ssl_storage_port&lt;/tt&gt;, so the connection was refused and the &lt;tt&gt;OutboundConnection.onFailure&lt;/tt&gt; handler was called.  As the shadow&lt;br/&gt;
gossip round had queued up a message, the &lt;tt&gt;hasPending&lt;/tt&gt; branch was followed and the connection was rescheduled, however the port is never recalculated as the original settings are used so it always fails.&lt;/p&gt;

&lt;p&gt;Meanwhile, the node discovered information about peers through inbound connection and gossip updating the messaging version for the endpoint which could have been used to make a valid connection.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13298436">CASSANDRA-15727</key>
            <summary>Internode messaging connection setup between 4.0 and legacy SSL 3.0 fails if initial connection version incorrect</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jmeredithco">Jon Meredith</assignee>
                                    <reporter username="jmeredithco">Jon Meredith</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 15 Apr 2020 03:06:38 +0000</created>
                <updated>Fri, 12 Feb 2021 17:08:42 +0000</updated>
                            <resolved>Wed, 13 May 2020 15:36:44 +0000</resolved>
                                        <fixVersion>4.0-beta1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Messaging/Internode</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1800">0.5h</timespent>
                                <comments>
                            <comment id="17083755" author="jmeredithco" created="Wed, 15 Apr 2020 03:11:47 +0000"  >&lt;p&gt;Patch here (opened as a PR with CircleCI hi-res config added on top)&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/cassandra/commit/2356e86bc43494af7f54a1006242a1db42957d82&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/2356e86bc43494af7f54a1006242a1db42957d82&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17083758" author="jmeredithco" created="Wed, 15 Apr 2020 03:15:26 +0000"  >&lt;p&gt;CircleCI &lt;a href=&quot;https://circleci.com/workflow-run/4db87bd0-acc6-48e8-afcc-d259841af5c2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Java8&lt;/a&gt; &lt;a href=&quot;https://circleci.com/workflow-run/f2969704-8d9b-4d9e-9af4-0f59186b08d5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Java11&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17086151" author="jmeredithco" created="Fri, 17 Apr 2020 23:29:53 +0000"  >&lt;p&gt;Looks like I have a test failure to deal with..&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[junit-timeout] Testsuite: org.apache.cassandra.net.ConnectionTest Tests run: 13, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 77.412 sec
[junit-timeout] 
[junit-timeout] Testcase: testPendingOutboundConnectionUpdatesMessageVersionOnReconnectAttempt(org.apache.cassandra.net.ConnectionTest):	Caused an ERROR
[junit-timeout] Local endpoint port 7011 doesn&apos;t match YAML configured port 7016 or legacy SSL port 7015
[junit-timeout] org.apache.cassandra.exceptions.ConfigurationException: Local endpoint port 7011 doesn&apos;t match YAML configured port 7016 or legacy SSL port 7015
[junit-timeout] 	at org.apache.cassandra.net.InboundConnectionSettings.withDefaults(InboundConnectionSettings.java:172)
[junit-timeout] 	at org.apache.cassandra.net.InboundSockets.addBindings(InboundSockets.java:190)
[junit-timeout] 	at org.apache.cassandra.net.InboundSockets.bindings(InboundSockets.java:184)
[junit-timeout] 	at org.apache.cassandra.net.InboundSockets.&amp;lt;init&amp;gt;(InboundSockets.java:168)
[junit-timeout] 	at org.apache.cassandra.net.ConnectionTest.testPendingOutboundConnectionUpdatesMessageVersionOnReconnectAttempt(ConnectionTest.java:586)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17086169" author="jmeredithco" created="Sat, 18 Apr 2020 00:02:37 +0000"  >&lt;p&gt;Committed fix for test failure - &lt;a href=&quot;https://app.circleci.com/pipelines/github/jonmeredith/cassandra/339/workflows/def20a38-cd04-4a7b-bfc6-7f15b3c1abd9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Java8&lt;/a&gt; &lt;a href=&quot;https://app.circleci.com/pipelines/github/jonmeredith/cassandra/339/workflows/8e63bc9c-7941-4bd6-af2f-e3a604181a7e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Java11&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17106331" author="iamaleksey" created="Wed, 13 May 2020 14:08:02 +0000"  >&lt;p&gt;The patch mostly looks good to me, but I think there is an issue with the logic in &lt;tt&gt;InboundSockets#addBindings()&lt;/tt&gt; - I &lt;b&gt;think&lt;/b&gt; it&apos;s possible for the ports to match in config but for encryption or legacy ssl storage port to not be enabled, thus never adding any bindings at all.&lt;/p&gt;

&lt;p&gt;Also some formatting nits and unnecessary `this` that we usually avoid.&lt;/p&gt;

&lt;p&gt;Pushed &lt;a href=&quot;https://github.com/iamaleksey/cassandra/commits/15727-4.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; - please have a look, as I&apos;m not certain about issue 1.&lt;/p&gt;</comment>
                            <comment id="17106357" author="jmeredithco" created="Wed, 13 May 2020 14:42:24 +0000"  >&lt;p&gt;Thanks for the review. &#160;The fix looks necessary to me, and the nits are all good. Please merge when you&apos;re happy with it.&lt;/p&gt;</comment>
                            <comment id="17106404" author="iamaleksey" created="Wed, 13 May 2020 15:36:44 +0000"  >&lt;p&gt;Cheers, committed as &lt;a href=&quot;https://github.com/apache/cassandra/commit/678ca3fc29c38b64a110dcf40693aa7840b0585c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;678ca3fc29c38b64a110dcf40693aa7840b0585c&lt;/a&gt; to trunk.&lt;/p&gt;</comment>
                            <comment id="17106575" author="benedict" created="Wed, 13 May 2020 18:50:50 +0000"  >&lt;p&gt;Sorry that I&apos;m late to this party, but might it be cleaner to move the setting of &lt;tt&gt;messagingVersion&lt;/tt&gt; into &lt;tt&gt;attempt&lt;/tt&gt; since we already do it there, and remove it from &lt;tt&gt;onCompletedHandshake/RETRY&lt;/tt&gt; and the class constructor?  This would capture all possible reasons &lt;tt&gt;messagingVersion&lt;/tt&gt; might have changed, and reduce the verbosity of this particular point in the code, possibly keeping its intent a bit clearer.&lt;/p&gt;</comment>
                            <comment id="17108321" author="iamaleksey" created="Fri, 15 May 2020 14:10:29 +0000"  >&lt;blockquote&gt;&lt;p&gt;Sorry that I&apos;m late to this party, but might it be cleaner to move the setting of messagingVersion into attempt since we already do it there, and remove it from onCompletedHandshake/RETRY and the class constructor? This would capture all possible reasons messagingVersion might have changed, and reduce the verbosity of this particular point in the code, possibly keeping its intent a bit clearer.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Good call. I&apos;ll ninja it, if nobody objects.&lt;/p&gt;

&lt;p&gt;EDIT: may or may have not done it in 17caa288c311e0364f81f78a85831c36f0f4917e&lt;/p&gt;</comment>
                            <comment id="17108400" author="jmeredithco" created="Fri, 15 May 2020 15:32:22 +0000"  >&lt;p&gt;Looks like an improvement to me. &#160;Thanks for both your help.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="13194136">CASSANDRA-14848</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[andrew.tolbert]]></customfieldvalue>
        <customfieldvalue><![CDATA[jmeredithco]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12983" cascade-level=""><![CDATA[Availability]]></customfieldvalue>
                                <customfieldvalue key="12994" cascade-level="1"><![CDATA[Unavailable]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12964"><![CDATA[Low Hanging Fruit]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12977"><![CDATA[Adhoc Test]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 26 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0dn5s:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12346093">4.0-alpha</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314136" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12348281">4.0-alpha1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/678ca3fc29c38b64a110dcf40693aa7840b0585c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;678ca3fc29c38b64a110dcf40693aa7840b0585c&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;Reproduced in ConnectionTest. testPendingOutboundConnectionUpdatesMessageVersionOnReconnectAttempt and checked the fix.&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>