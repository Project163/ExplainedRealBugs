<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:22:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-17167] ViewTests flaky on timeouts</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-17167</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Recently, specially on trunk, View*Test have stared timing out. This is bad for CI credibility when submitting a patch so it&apos;s worth splitting them yet again.&lt;/p&gt;

&lt;p&gt;Despite trunk being the main offender the patch will be also applied to 4.0 to be defensive about it.&lt;/p&gt;

&lt;p&gt;As we can see &lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-trunk/861/testReport/junit/org.apache.cassandra.cql3/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; the candidates are: ViewComplexLivenessTest, ViewComplexDeletionsTest, ViewComplexTest, ViewFilteringPKTest, ViewFilteringTest&lt;/p&gt;</description>
                <environment></environment>
        <key id="13413115">CASSANDRA-17167</key>
            <summary>ViewTests flaky on timeouts</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bereng">Berenguer Blasi</assignee>
                                    <reporter username="bereng">Berenguer Blasi</reporter>
                        <labels>
                    </labels>
                <created>Mon, 22 Nov 2021 09:50:03 +0000</created>
                <updated>Fri, 27 May 2022 19:25:05 +0000</updated>
                            <resolved>Fri, 26 Nov 2021 06:20:53 +0000</resolved>
                                        <fixVersion>4.0.2</fixVersion>
                    <fixVersion>4.1-alpha1</fixVersion>
                    <fixVersion>4.1</fixVersion>
                                    <component>Test/unit</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17447344" author="bereng" created="Mon, 22 Nov 2021 11:24:35 +0000"  >&lt;p&gt;Note for the reviewer:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adelapena&quot; class=&quot;user-hover&quot; rel=&quot;adelapena&quot;&gt;adelapena&lt;/a&gt; probably a quick review for you as we&apos;ve both been working on these tests.&lt;/p&gt;

&lt;p&gt;I split the tests that according to jenkins history have suffered the timeouts recently. It&apos;s just a plain split of test files.&lt;/p&gt;</comment>
                            <comment id="17447603" author="adelapena" created="Mon, 22 Nov 2021 20:02:27 +0000"  >&lt;p&gt;Sure, I&apos;ll take a look&lt;/p&gt;</comment>
                            <comment id="17447958" author="adelapena" created="Tue, 23 Nov 2021 11:50:30 +0000"  >&lt;p&gt;+1 to splitting those tests. Not sure however about applying the changes to 4.0 if we are only finding the failures in trunk. 4.0 misses the refactoring done by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1712&quot; title=&quot;Creating a SuperColumnFamily other than BytesType results in incorrect comparator types &quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1712&quot;&gt;&lt;del&gt;CASSANDRA-1712&lt;/del&gt;&lt;/a&gt;, which was done to avoid the code duplication introduced by the previous splitting of view tests done by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16670&quot; title=&quot;Flaky ViewComplexTest, ViewFilteringTest and InsertUpdateIfConditionTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16670&quot;&gt;&lt;del&gt;CASSANDRA-16670&lt;/del&gt;&lt;/a&gt;. Thus, this new test splitting is introducing even more core duplication in 4.0. I think I&apos;d prefer to either leave 4.0 unchanged or port back the changes introduced by&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-17122&quot; title=&quot;Add utilities for materialized views to CQLTester&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-17122&quot;&gt;&lt;del&gt;CASSANDRA-17122&lt;/del&gt;&lt;/a&gt; and then split, wdyt?&lt;/p&gt;

&lt;p&gt;It&apos;s interesting that we are seeing those timeouts only in trunk. &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-17122&quot; title=&quot;Add utilities for materialized views to CQLTester&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-17122&quot;&gt;&lt;del&gt;CASSANDRA-17122&lt;/del&gt;&lt;/a&gt; introduced changes to always wait for&#160; MV builds and updates even when it&apos;s not strictly required so we prevent accidental races. This however might make the tests slightly slower and thereof more prone to produce JUnit timeouts. That might explain the difference, although I&apos;m not sure the impact of those additional waits is noticeable. At least, I don&apos;t see a lot of difference locally.&lt;/p&gt;

&lt;p&gt;Do we have a PR for trunk with CI runs?&lt;/p&gt;</comment>
                            <comment id="17447969" author="bereng" created="Tue, 23 Nov 2021 12:09:37 +0000"  >&lt;p&gt;I reached similar conclusions to you.&lt;/p&gt;

&lt;p&gt;I did the 4.0 branch bc looking at jenkins test reports, despite being difficult to track, I was under the impression the same tests were close to timing out as well. Hence I thought doing 4.0 would be a good defensive move. I think porting 17122 would be a big effort with diminishing returns in 4.0. Trunk is a different story. So big refactor vs some minor code dup vs risk of timing out. I chose n2 for the best balance and return in my eyes. Would you prefer we leave 4.0 alone?&lt;/p&gt;

&lt;p&gt;I did not push a trunk branch yet bc I wanted to have feedback on a first pass on 4.0. I&apos;ll do a trunk PR now then.&lt;/p&gt;</comment>
                            <comment id="17448002" author="adelapena" created="Tue, 23 Nov 2021 13:16:24 +0000"  >&lt;p&gt;&amp;gt; So big refactor vs some minor code dup vs risk of timing out. I chose n2 for the best balance and return in my eyes. Would you prefer we leave 4.0 alone?&lt;/p&gt;

&lt;p&gt;Indeed porting the refactor is quite involved and it could be done to prevent a timeout problem that we might not have. However keep duplicating code in 4.0 doesn&apos;t sound good either, especially considering that the duplication doesn&apos;t look so minor to me. I we leave 4.0 alone we could always go back and split the tests if we see them failing, but I don&apos;t have a strong opinion on this and I&apos;d be ok splitting 4.0 if you think they are close to time out. If we go that way we should at least remove the duplications of &lt;tt&gt;createView&lt;/tt&gt;/&lt;tt&gt;updateView&lt;/tt&gt;/&lt;tt&gt;dropView&lt;/tt&gt; in the new &lt;tt&gt;ViewFiltering2Test&lt;/tt&gt; by calling the version of those methods in &lt;tt&gt;ViewFilteringTest&lt;/tt&gt;, as it&apos;s done by the other &lt;tt&gt;ViewFiltering*&lt;/tt&gt; tests.&lt;/p&gt;</comment>
                            <comment id="17448453" author="bereng" created="Wed, 24 Nov 2021 08:44:01 +0000"  >&lt;p&gt;Ah that dup code in &lt;tt&gt;ViewFiltering2Test&lt;/tt&gt; is an oversight, my bad. Yes that has to go and I did in the latest push. I left the split in 4.0 bc jenkins shows for some a failure but only in a blue moon. So as it is already there + removing that dup code I&apos;d leave it as it is now.&lt;/p&gt;

&lt;p&gt;I also pushed trunk. The only thing worth mentioning is again on &lt;tt&gt;ViewFiltering2Test&lt;/tt&gt; where I call &lt;tt&gt;ViewFilteringTest&lt;/tt&gt; enc setup/teardown methods rather than doing some parent common class which sounds like an overkill.&lt;/p&gt;</comment>
                            <comment id="17448690" author="adelapena" created="Wed, 24 Nov 2021 15:45:53 +0000"  >&lt;blockquote&gt;&lt;p&gt;I also pushed trunk. The only thing worth mentioning is again on ViewFiltering2Test where I call ViewFilteringTest enc setup/teardown methods rather than doing some parent common class which sounds like an overkill.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Thanks, I also think that a common superclass in the trunk case is an overkill. The patch for trunk looks good to me, I have left a couple of trivial suggestions on the PR.&lt;/p&gt;

&lt;p&gt;As for 4.0, I agree to splitting the tests if they are also timing out, and it seems they are. We don&apos;t need to port back the refactoring done in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1712&quot; title=&quot;Creating a SuperColumnFamily other than BytesType results in incorrect comparator types &quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1712&quot;&gt;&lt;del&gt;CASSANDRA-1712&lt;/del&gt;&lt;/a&gt;, but we could still try to reduce duplications a bit by extracting a common superclass for&#160;&lt;tt&gt;ViewFiltering*&lt;/tt&gt; tests, like we did with &lt;tt&gt;ViewComplexTester&lt;/tt&gt; in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-17070&quot; title=&quot;ViewComplexTest hardening&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-17070&quot;&gt;&lt;del&gt;CASSANDRA-17070&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://github.com/adelapena/cassandra/commit/e5b0937f80e6d7e8640b3ae1be99487bf895c642&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this way&lt;/a&gt;. That&apos;s a 5min refactor and gets rid of the duplications within the six flavours of &lt;tt&gt;ViewFiltering*Test&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I have run the split tests and all seem to finish in very reasonable and well balanced times, hopefully we won&apos;t need to split them again &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. Could we have some repeated runs of &lt;tt&gt;View*Test&lt;/tt&gt;, just to be sure that at least they aren&apos;t flaky on CircleCI?&lt;/p&gt;</comment>
                            <comment id="17449145" author="bereng" created="Thu, 25 Nov 2021 11:32:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adelapena&quot; class=&quot;user-hover&quot; rel=&quot;adelapena&quot;&gt;adelapena&lt;/a&gt; latest review comments addressed. The only downside is that I tried a 100 runs of &lt;tt&gt;View*Test&lt;/tt&gt; and circle timed out as you can see on the CI links. I don&apos;t think it makes much sense to try 50, 25, etc runs. I would go for the merge but lmk wdyt.&lt;/p&gt;</comment>
                            <comment id="17449157" author="adelapena" created="Thu, 25 Nov 2021 12:16:22 +0000"  >&lt;p&gt;Both PRs look good to me. With the common superclass &lt;tt&gt;ViewFilteringTester&lt;/tt&gt; we don&apos;t solve the problem of duplications in 4.0 but at least we don&apos;t contribute to it with this new splitting, which is nice.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;The only downside is that I tried a 100 runs of View*Test and circle timed out as you can see on the CI links. I don&apos;t think it makes much sense to try 50, 25, etc runs. I would go for the merge but lmk wdyt.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I was writing about this on the PR, we can run those tests with MIDRES to prevent the timeouts:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
.circleci/generate.sh -m \
  -e REPEATED_UTEST_TARGET=test \
  -e REPEATED_UTEST_COUNT=100 \
  -e REPEATED_UTEST_CLASS=View*Test
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;That&apos;s the config we used for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-17122&quot; title=&quot;Add utilities for materialized views to CQLTester&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-17122&quot;&gt;&lt;del&gt;CASSANDRA-17122&lt;/del&gt;&lt;/a&gt;. IIR both unit tests and repeated unit tests use the same resource class in LOWRES and MIDRES, and the only difference is parallelism. I&apos;m running them here:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/1171/workflows/4be538d8-6695-4f06-8fe5-b9e7149a6800&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4.0&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/1172/workflows/e27a399a-9076-4b5f-bd1e-7fa59444f9cb&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17449183" author="bereng" created="Thu, 25 Nov 2021 12:58:47 +0000"  >&lt;p&gt;Ah sorry I was out for lunch otherwise I would have done it myself. I intentionally went for low-res to get a constrained env bc on MID is like 100/24 ~= 4 runs per node. But it&apos;s better than nothing so sgtm.&lt;/p&gt;</comment>
                            <comment id="17449204" author="adelapena" created="Thu, 25 Nov 2021 13:38:20 +0000"  >&lt;p&gt;No worries &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. `View*Test` contains a bunch of slowish tests, it has taken around one hour even with the 25 parallel runners, but it has happily succeeded. I think we are ready to merge.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[bereng]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12970"><![CDATA[Unit Test]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 50 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0wyq8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[adelapena]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12350565">4.0.2</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/0764273608f501036f1f68e51185067856b934db&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/0764273608f501036f1f68e51185067856b934db&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;See PR&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>