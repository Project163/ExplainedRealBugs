<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:43:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6714] Fix replaying old (1.2) commitlog in Cassandra 2.0</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6714</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Our docs, and code, both explicitly say that you should drain a node before upgrading to a new major release.&lt;/p&gt;

&lt;p&gt;If you don&apos;t do what the docs explicitly tell you to do, however, Cassandra won&apos;t scream at you. Also, we &lt;b&gt;do&lt;/b&gt; currently have logic to replay 1.2 commitlog in 2.0, but it seems to be slightly broken, unfortunately.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Old node: Cassandra 1.2.15 (DSE)&lt;br/&gt;
New node: Cassandra 2.0.5.1 (DSE)&lt;/p&gt;</environment>
        <key id="12695522">CASSANDRA-6714</key>
            <summary>Fix replaying old (1.2) commitlog in Cassandra 2.0</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aleksey">Aleksey Yeschenko</assignee>
                                    <reporter username="pkolaczk">Piotr Kolaczkowski</reporter>
                        <labels>
                            <label>qa-resolved</label>
                    </labels>
                <created>Mon, 17 Feb 2014 14:08:54 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:53 +0000</updated>
                            <resolved>Tue, 18 Feb 2014 22:41:24 +0000</resolved>
                                        <fixVersion>2.0.6</fixVersion>
                    <fixVersion>2.1 beta1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="13903258" author="pkolaczk" created="Mon, 17 Feb 2014 14:10:38 +0000"  >&lt;p&gt;Discovered while testing &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6707&quot; title=&quot;AIOOBE when doing select count(*) from on a mixed cluster.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6707&quot;&gt;&lt;del&gt;CASSANDRA-6707&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;However, I will note that after upgrading the first node to 2.0, the results of select count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; were consistent but incorrect (I got 957815 as the result). After upgrading the second node to 2.0 I got another consistent but incorrect result (912873).&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="13904175" author="enigmacurry" created="Tue, 18 Feb 2014 15:49:55 +0000"  >&lt;p&gt;I&apos;ve modified our dtest to run a test without flush/drain and I&apos;m seeing the same thing (missing rows.)&lt;/p&gt;

&lt;p&gt;Another oddity is the schema is getting modified. Here&apos;s my schema on 1.2:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;CREATE KEYSPACE upgrade WITH replication = {
  &lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;SimpleStrategy&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;replication_factor&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;2&apos;&lt;/span&gt;
};

USE upgrade;

CREATE TABLE cf (
  k &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; PRIMARY KEY,
  v text
) WITH COMPACT STORAGE AND
  bloom_filter_fp_chance=0.010000 AND
  caching=&lt;span class=&quot;code-quote&quot;&gt;&apos;KEYS_ONLY&apos;&lt;/span&gt; AND
  comment=&apos;&apos; AND
  dclocal_read_repair_chance=0.000000 AND
  gc_grace_seconds=864000 AND
  read_repair_chance=0.100000 AND
  replicate_on_write=&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;&lt;/span&gt; AND
  compaction={&lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;SizeTieredCompactionStrategy&apos;&lt;/span&gt;} AND
  compression={&lt;span class=&quot;code-quote&quot;&gt;&apos;sstable_compression&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;SnappyCompressor&apos;&lt;/span&gt;};

CREATE INDEX vals ON cf (v);

CREATE TABLE countertable (
  k text PRIMARY KEY,
  c counter
) WITH COMPACT STORAGE AND
  bloom_filter_fp_chance=0.010000 AND
  caching=&lt;span class=&quot;code-quote&quot;&gt;&apos;KEYS_ONLY&apos;&lt;/span&gt; AND
  comment=&apos;&apos; AND
  dclocal_read_repair_chance=0.000000 AND
  gc_grace_seconds=864000 AND
  read_repair_chance=0.100000 AND
  replicate_on_write=&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;&lt;/span&gt; AND
  compaction={&lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;SizeTieredCompactionStrategy&apos;&lt;/span&gt;} AND
  compression={&lt;span class=&quot;code-quote&quot;&gt;&apos;sstable_compression&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;SnappyCompressor&apos;&lt;/span&gt;};
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And after an upgrade to 2.0:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;CREATE KEYSPACE upgrade WITH replication = {
  &lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;SimpleStrategy&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;replication_factor&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;2&apos;&lt;/span&gt;
};

USE upgrade;

CREATE TABLE cf (
  key &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,
  v text,
  PRIMARY KEY (key)
) WITH COMPACT STORAGE AND
  bloom_filter_fp_chance=0.010000 AND
  caching=&lt;span class=&quot;code-quote&quot;&gt;&apos;KEYS_ONLY&apos;&lt;/span&gt; AND
  comment=&apos;&apos; AND
  dclocal_read_repair_chance=0.000000 AND
  gc_grace_seconds=864000 AND
  index_interval=128 AND
  read_repair_chance=0.100000 AND
  replicate_on_write=&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;&lt;/span&gt; AND
  populate_io_cache_on_flush=&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;&lt;/span&gt; AND
  default_time_to_live=0 AND
  speculative_retry=&lt;span class=&quot;code-quote&quot;&gt;&apos;99.0PERCENTILE&apos;&lt;/span&gt; AND
  memtable_flush_period_in_ms=0 AND
  compaction={&lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;SizeTieredCompactionStrategy&apos;&lt;/span&gt;} AND
  compression={&lt;span class=&quot;code-quote&quot;&gt;&apos;sstable_compression&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;SnappyCompressor&apos;&lt;/span&gt;};

CREATE INDEX vals ON cf (v);

CREATE TABLE countertable (
  key text,
  c counter,
  PRIMARY KEY (key)
) WITH COMPACT STORAGE AND
  bloom_filter_fp_chance=0.010000 AND
  caching=&lt;span class=&quot;code-quote&quot;&gt;&apos;KEYS_ONLY&apos;&lt;/span&gt; AND
  comment=&apos;&apos; AND
  dclocal_read_repair_chance=0.000000 AND
  gc_grace_seconds=864000 AND
  index_interval=128 AND
  read_repair_chance=0.100000 AND
  replicate_on_write=&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;&lt;/span&gt; AND
  populate_io_cache_on_flush=&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;&lt;/span&gt; AND
  default_time_to_live=0 AND
  speculative_retry=&lt;span class=&quot;code-quote&quot;&gt;&apos;99.0PERCENTILE&apos;&lt;/span&gt; AND
  memtable_flush_period_in_ms=0 AND
  compaction={&lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;SizeTieredCompactionStrategy&apos;&lt;/span&gt;} AND
  compression={&lt;span class=&quot;code-quote&quot;&gt;&apos;sstable_compression&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;SnappyCompressor&apos;&lt;/span&gt;};
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Notice that the primary key column name has changed from &apos;k&apos; to &apos;key&apos; in both of my tables - there&apos;s nothing in my test code that does that, and it does not occur when I do the recommended flush/drain.&lt;/p&gt;</comment>
                            <comment id="13904411" author="iamaleksey" created="Tue, 18 Feb 2014 19:03:03 +0000"  >&lt;p&gt;Same reason.&lt;/p&gt;</comment>
                            <comment id="13904687" author="iamaleksey" created="Tue, 18 Feb 2014 22:12:58 +0000"  >&lt;p&gt;We are currently comparing the segment&apos;s messaging version to a commit log descriptor version, which is a bug introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5764&quot; title=&quot;CommitLogReplayer should calculate checksums differently for &amp;lt; 2.0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5764&quot;&gt;&lt;del&gt;CASSANDRA-5764&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The trivial-ish patch attached fixes that.&lt;/p&gt;</comment>
                            <comment id="13904696" author="jbellis" created="Tue, 18 Feb 2014 22:17:37 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13904733" author="iamaleksey" created="Tue, 18 Feb 2014 22:41:24 +0000"  >&lt;p&gt;Committed, thanks.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enigmacurry&quot; class=&quot;user-hover&quot; rel=&quot;enigmacurry&quot;&gt;enigmacurry&lt;/a&gt; leave the flush/drain off the dtest, let&apos;s have this scenario covered.&lt;/p&gt;</comment>
                            <comment id="13904735" author="enigmacurry" created="Tue, 18 Feb 2014 22:46:08 +0000"  >&lt;p&gt;Yea, we&apos;re testing both scenarios from now on.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12629836">CASSANDRA-5199</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12629648" name="6714.txt" size="3318" author="aleksey" created="Tue, 18 Feb 2014 22:10:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>374030</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 39 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1sgfb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>374330</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12325761">2.0.5</customfieldvalue>
    <customfieldvalue id="12324159">2.1 rc3</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311124" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Tester</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>enigmacurry</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>