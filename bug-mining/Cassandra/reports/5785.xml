<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:21:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-16774] BinLog does not close chronicle queue leaving this to GC to cleanup</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-16774</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;auditlog_test.py::TestAuditlog::test_archiving_fql  and test_fql_nodetool_options fail from time to time due to the test relying on a race condition; we do not close chronicle queue so rotation may not happen before stopping archiver, the tests fail if rotation happens before stopping archiver (which is done based off GC).&lt;/p&gt;</description>
                <environment></environment>
        <key id="13386861">CASSANDRA-16774</key>
            <summary>BinLog does not close chronicle queue leaving this to GC to cleanup</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dcapwell">David Capwell</assignee>
                                    <reporter username="dcapwell">David Capwell</reporter>
                        <labels>
                    </labels>
                <created>Wed, 30 Jun 2021 17:06:45 +0000</created>
                <updated>Fri, 10 Oct 2025 08:47:36 +0000</updated>
                            <resolved>Fri, 2 Jul 2021 18:33:46 +0000</resolved>
                                        <fixVersion>4.0.0</fixVersion>
                    <fixVersion>4.1-alpha1</fixVersion>
                    <fixVersion>4.1</fixVersion>
                                    <component>Test/dtest/python</component>
                    <component>Tool/fql</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="17372144" author="dcapwell" created="Wed, 30 Jun 2021 18:15:55 +0000"  >&lt;p&gt;tests look clean, only the two tests in this ticket are failing (as expected, they only pass when the race condition happens, which I just fixed); updating python dtests now&lt;/p&gt;</comment>
                            <comment id="17372152" author="dcapwell" created="Wed, 30 Jun 2021 18:37:06 +0000"  >&lt;p&gt;pushed python dtests and updated the CI to run against it&lt;/p&gt;</comment>
                            <comment id="17372161" author="maedhroz" created="Wed, 30 Jun 2021 19:07:13 +0000"  >&lt;p&gt;+1 (local dtest changes against your branch are green for me across a few runs)&lt;/p&gt;</comment>
                            <comment id="17372167" author="brandon.williams" created="Wed, 30 Jun 2021 19:34:52 +0000"  >&lt;p&gt;I bet this was the problem with &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16526&quot; title=&quot;BinLogTest is flaky&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16526&quot;&gt;&lt;del&gt;CASSANDRA-16526&lt;/del&gt;&lt;/a&gt; too.&lt;/p&gt;</comment>
                            <comment id="17372186" author="dcapwell" created="Wed, 30 Jun 2021 20:02:27 +0000"  >&lt;p&gt;looking at the test I feel more is going on as well.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;BinLog is async and max size is only used by the archiver, which is triggered on release (I don&apos;t see how we control it)&lt;/li&gt;
	&lt;li&gt;max weight is 10, and our records don&apos;t override weight, so 1 record = 1 weight; aka max queue size of 10 records&lt;/li&gt;
	&lt;li&gt;test is waiting until a log exists which has 2 records... but 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, and 10 are all valid states&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Unless I am missing something, org.apache.cassandra.utils.binlog.BinLogTest#flakyTestTruncationReleasesLogSpace doesn&apos;t make sense to me. The test would make more sense if it controlled the archiver and wrote 11 records, you can then detect release got triggered and then the log size should be 1&lt;/p&gt;

&lt;p&gt;But to your point, since stop doesn&apos;t release the resources the files cleanup when GC triggered, so previous tests may have other log files in the test directory&lt;/p&gt;</comment>
                            <comment id="17372528" author="krummas" created="Thu, 1 Jul 2021 08:39:02 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="17373701" author="dcapwell" created="Fri, 2 Jul 2021 17:44:37 +0000"  >&lt;p&gt;Starting commit&lt;/p&gt;

&lt;p&gt;CI Results (pending):&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Source&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Circle CI&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Jenkins&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;cassandra-4.0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/dcapwell/cassandra/tree/commit_remote_branch/CASSANDRA-16774-cassandra-4.0-F7958CBF-9DF6-44CE-A83C-E236C6694AFF&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/dcapwell/cassandra?branch=commit_remote_branch%2FCASSANDRA-16774-cassandra-4.0-F7958CBF-9DF6-44CE-A83C-E236C6694AFF&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;build&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch/888/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;build&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;trunk&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/dcapwell/cassandra/tree/commit_remote_branch/CASSANDRA-16774-trunk-F7958CBF-9DF6-44CE-A83C-E236C6694AFF&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/dcapwell/cassandra?branch=commit_remote_branch%2FCASSANDRA-16774-trunk-F7958CBF-9DF6-44CE-A83C-E236C6694AFF&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;build&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch/889/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;build&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="17373724" author="dcapwell" created="Fri, 2 Jul 2021 18:33:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra-dtest/commit/2fddec7e516a8a2dbfbd2ad51837116556116ee6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra-dtest/commit/2fddec7e516a8a2dbfbd2ad51837116556116ee6&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17375228" author="bereng" created="Tue, 6 Jul 2021 05:25:56 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I have been bisecting a bit and I think recent 4.0.0 &lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-4.0.0/44/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;failures&lt;/a&gt; and due to this ticket? Could sbdy familiar with it confirm please?&lt;/p&gt;

&lt;p&gt;Thx in advance&lt;/p&gt;</comment>
                            <comment id="17375869" author="maedhroz" created="Tue, 6 Jul 2021 17:09:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bereng&quot; class=&quot;user-hover&quot; rel=&quot;bereng&quot;&gt;bereng&lt;/a&gt; I think you are correct. The simplest fix is probably just to make sure that the two line change from &lt;a href=&quot;https://github.com/dcapwell/cassandra/commit/f0a7ea411fe237543200b3c67a2f0fb34536c162&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this commit&lt;/a&gt; ends up in 4.0.0 instead of just 4.0. Seems like a reasonable candidate for a ninja-fix.&lt;/p&gt;</comment>
                            <comment id="17375946" author="maedhroz" created="Tue, 6 Jul 2021 18:52:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bereng&quot; class=&quot;user-hover&quot; rel=&quot;bereng&quot;&gt;bereng&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcuse&quot; class=&quot;user-hover&quot; rel=&quot;marcuse&quot;&gt;marcuse&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=e.dimitrova&quot; class=&quot;user-hover&quot; rel=&quot;e.dimitrova&quot;&gt;e.dimitrova&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jmeredithco&quot; class=&quot;user-hover&quot; rel=&quot;jmeredithco&quot;&gt;jmeredithco&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dcapwell&quot; class=&quot;user-hover&quot; rel=&quot;dcapwell&quot;&gt;dcapwell&lt;/a&gt; Here is a small patch to back-port the change to &lt;tt&gt;cassandra-4.0.0&lt;/tt&gt; (with a Jenkins run in progress):&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/pull/1102&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;, &lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch/897/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Jenkins&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17375966" author="jmeredithco" created="Tue, 6 Jul 2021 19:30:21 +0000"  >&lt;p&gt;+1, change looks good pending tests.&lt;/p&gt;</comment>
                            <comment id="17376048" author="maedhroz" created="Tue, 6 Jul 2021 21:47:16 +0000"  >&lt;p&gt;Tests &lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch/897/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;look good&lt;/a&gt;,&#160;outside&#160;what appear to be 3 entirely unrelated failures.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=edimitrova&quot; class=&quot;user-hover&quot; rel=&quot;edimitrova&quot;&gt;edimitrova&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bereng&quot; class=&quot;user-hover&quot; rel=&quot;bereng&quot;&gt;bereng&lt;/a&gt; Any idea if the failure in &lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch/897/testReport/junit/org.apache.cassandra.distributed.test/UnableToParseClientMessageTest/badHeader_version_4_v4_/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;UnableToParseClientMessageTest&lt;/a&gt; is new. That&apos;s the only one I didn&apos;t find a Jira for.&lt;/p&gt;</comment>
                            <comment id="17376136" author="edimitrova" created="Wed, 7 Jul 2021 01:12:22 +0000"  >&lt;p&gt;I haven&apos;t seen it before. It doesn&apos;t fail for me locally in 4.0.0. Considering that the failing assert is based on a grep in the logs, I would say probably there is some test flakiness somewhere and we should improve the test... I can take a look these days. This failing test doesn&apos;t exercise the code you changed&lt;/p&gt;</comment>
                            <comment id="17376245" author="bereng" created="Wed, 7 Jul 2021 04:32:55 +0000"  >&lt;p&gt;The failures are unrelated. And that &lt;tt&gt;UnableToParseClientMessageTest&lt;/tt&gt; I&apos;d swear I&apos;ve seen before. So I think we&apos;re good to merge imo. +1&lt;/p&gt;</comment>
                            <comment id="17376677" author="maedhroz" created="Wed, 7 Jul 2021 16:20:32 +0000"  >&lt;p&gt;4.0.0 back-port committed as &lt;a href=&quot;https://github.com/apache/cassandra/commit/68bf950f72d20be9f31fd3f91669be7e28c050e4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/68bf950f72d20be9f31fd3f91669be7e28c050e4&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;(Also changed release to 4.0-rc3.)&lt;/p&gt;

&lt;p&gt;Thanks everyone!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[dcapwell]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
                                <customfieldvalue key="12986" cascade-level="1"><![CDATA[Recoverable Corruption / Loss]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12964"><![CDATA[Low Hanging Fruit]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12970"><![CDATA[Unit Test]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 18 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0sh00:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[maedhroz]]></customfieldvalue>
        <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12348281">4.0-alpha1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/f0a7ea411fe237543200b3c67a2f0fb34536c162&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/f0a7ea411fe237543200b3c67a2f0fb34536c162&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;python dtest&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>