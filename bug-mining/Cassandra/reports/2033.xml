<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:37:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-5068] CLONE - Once a host has been hinted to, log messages for it repeat every 10 mins even if no hints are delivered</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-5068</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;We have &quot;0 row&quot; hinted handoffs every 10 minutes like clockwork. This impacts our ability to monitor the cluster by adding persistent noise in the handoff metric.&lt;/p&gt;

&lt;p&gt;Previous mentions of this issue are here:&lt;br/&gt;
&lt;a href=&quot;http://www.mail-archive.com/user@cassandra.apache.org/msg25982.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.mail-archive.com/user@cassandra.apache.org/msg25982.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The hinted handoffs can be scrubbed away with&lt;br/&gt;
nodetool -h 127.0.0.1 scrub system HintsColumnFamily&lt;br/&gt;
but they return after anywhere from a few minutes to multiple hours later.&lt;/p&gt;

&lt;p&gt;These started to appear after an upgrade to 1.1.6 and haven&apos;t gone away despite rolling cleanups, rolling restarts, multiple rounds of scrubbing, etc.&lt;/p&gt;

&lt;p&gt;A few things we&apos;ve noticed about the handoffs:&lt;br/&gt;
1. The phantom handoff endpoint changes after a non-zero handoff comes through&lt;/p&gt;

&lt;p&gt;2. Sometimes a non-zero handoff will be immediately followed by an &quot;off schedule&quot; phantom handoff to the endpoint the phantom had been using before&lt;/p&gt;

&lt;p&gt;3. The sstable2json output seems to include multiple sub-sections for each handoff with the same &quot;deletedAt&quot; information.&lt;/p&gt;



&lt;p&gt;The phantom handoff endpoint changes after a non-zero handoff comes through:&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;HintedHandoff:1&amp;#93;&lt;/span&gt; 2012-12-11 06:57:35,093 HintedHandOffManager.java (line 392) Finished hinted handoff of 0 rows to endpoint /10.10.10.1&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;HintedHandoff:1&amp;#93;&lt;/span&gt; 2012-12-11 07:07:35,092 HintedHandOffManager.java (line 392) Finished hinted handoff of 0 rows to endpoint /10.10.10.1&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;HintedHandoff:1&amp;#93;&lt;/span&gt; 2012-12-11 07:07:37,915 HintedHandOffManager.java (line 392) Finished hinted handoff of 1058 rows to endpoint /10.10.10.2&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;HintedHandoff:1&amp;#93;&lt;/span&gt; 2012-12-11 07:17:35,093 HintedHandOffManager.java (line 392) Finished hinted handoff of 0 rows to endpoint /10.10.10.2&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;HintedHandoff:1&amp;#93;&lt;/span&gt; 2012-12-11 07:27:35,093 HintedHandOffManager.java (line 392) Finished hinted handoff of 0 rows to endpoint /10.10.10.2&lt;/p&gt;



&lt;p&gt;Sometimes a non-zero handoff will be immediately followed by an &quot;off schedule&quot; phantom handoff to the endpoint the phantom had been using before:&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;HintedHandoff:1&amp;#93;&lt;/span&gt; 2012-12-12 21:47:39,335 HintedHandOffManager.java (line 392) Finished hinted handoff of 0 rows to endpoint /10.10.10.3&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;HintedHandoff:1&amp;#93;&lt;/span&gt; 2012-12-12 21:57:39,335 HintedHandOffManager.java (line 392) Finished hinted handoff of 0 rows to endpoint /10.10.10.3&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;HintedHandoff:1&amp;#93;&lt;/span&gt; 2012-12-12 22:07:43,319 HintedHandOffManager.java (line 392) Finished hinted handoff of 1416 rows to endpoint /10.10.10.4&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;HintedHandoff:1&amp;#93;&lt;/span&gt; 2012-12-12 22:07:43,320 HintedHandOffManager.java (line 392) Finished hinted handoff of 0 rows to endpoint /10.10.10.3&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;HintedHandoff:1&amp;#93;&lt;/span&gt; 2012-12-12 22:17:39,357 HintedHandOffManager.java (line 392) Finished hinted handoff of 0 rows to endpoint /10.10.10.4&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;HintedHandoff:1&amp;#93;&lt;/span&gt; 2012-12-12 22:27:39,337 HintedHandOffManager.java (line 392) Finished hinted handoff of 0 rows to endpoint /10.10.10.4&lt;/p&gt;



&lt;p&gt;The first few entries from one of the json files:&lt;br/&gt;
{&lt;br/&gt;
    &quot;0aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&quot;: {&lt;br/&gt;
        &quot;ccf5dc203a2211e20000e154da71a9bb&quot;: &lt;/p&gt;
{
            &quot;deletedAt&quot;: -9223372036854775808, 
            &quot;subColumns&quot;: []
        }
&lt;p&gt;, &lt;br/&gt;
        &quot;ccf603303a2211e20000e154da71a9bb&quot;: &lt;/p&gt;
{
            &quot;deletedAt&quot;: -9223372036854775808, 
            &quot;subColumns&quot;: []
        }
&lt;p&gt;, &lt;/p&gt;</description>
                <environment>&lt;p&gt;cassandra 1.1.6&lt;br/&gt;
java 1.6.0_30&lt;/p&gt;</environment>
        <key id="12623863">CASSANDRA-5068</key>
            <summary>CLONE - Once a host has been hinted to, log messages for it repeat every 10 mins even if no hints are delivered</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="brandon.williams">Brandon Williams</assignee>
                                    <reporter username="peter-librato">Peter Haggerty</reporter>
                        <labels>
                            <label>qa-resolved</label>
                    </labels>
                <created>Thu, 13 Dec 2012 23:50:04 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:21 +0000</updated>
                            <resolved>Mon, 11 Feb 2013 19:06:24 +0000</resolved>
                                        <fixVersion>1.1.10</fixVersion>
                    <fixVersion>1.2.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="13531657" author="peter-librato" created="Thu, 13 Dec 2012 23:53:31 +0000"  >&lt;p&gt;Cloning &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3733&quot; title=&quot;Once a host has been hinted to, log messages for it repeat every 10 mins even if no hints are delivered&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3733&quot;&gt;&lt;del&gt;CASSANDRA-3733&lt;/del&gt;&lt;/a&gt; as it seems to be the same issue.&lt;/p&gt;</comment>
                            <comment id="13531678" author="peter-librato" created="Fri, 14 Dec 2012 00:11:58 +0000"  >&lt;p&gt;When there are zero-row hinted handoffs the output of &quot;list HintsColumnFamily&quot;&lt;br/&gt;
might show that 9 of 12 nodes in a ring have a row key like this:&lt;br/&gt;
9 of 12 nodes in a ring might have a row key like this:&lt;br/&gt;
RowKey: 75555555555555555555555555555554&lt;/p&gt;

&lt;p&gt;1 of the 12 nodes will have a different row key than all the rest:&lt;br/&gt;
RowKey: 15555555555555555555555555555554&lt;/p&gt;

&lt;p&gt;another 1-2 nodes might not have any RowKeys at all&lt;/p&gt;</comment>
                            <comment id="13531919" author="jbellis" created="Fri, 14 Dec 2012 02:18:05 +0000"  >&lt;p&gt;Somehow you&apos;ve got an empty hints row there that hasn&apos;t gotten compacted away.  Not sure how that&apos;s possible since we only ever do one handoff at a time per target, and each handoff does a full compaction after it&apos;s delivered hints successfully.&lt;/p&gt;</comment>
                            <comment id="13550878" author="mkjellman" created="Fri, 11 Jan 2013 06:23:36 +0000"  >&lt;p&gt;reproduced this in 1.2.0 after a rolling restart of the cluster&lt;/p&gt;</comment>
                            <comment id="13551212" author="brandon.williams" created="Fri, 11 Jan 2013 16:07:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mkjellman&quot; class=&quot;user-hover&quot; rel=&quot;mkjellman&quot;&gt;mkjellman&lt;/a&gt; can you post logs?&lt;/p&gt;</comment>
                            <comment id="13551235" author="brandon.williams" created="Fri, 11 Jan 2013 16:35:37 +0000"  >&lt;p&gt;I&apos;m not sure how we&apos;re getting into this situation with an empty hint row (machine restarted before compaction finished?) but one thing we can do to mitigate it is remove the check that we replayed &amp;gt; 0 rows before compacting.  It shouldn&apos;t really be necessary since the isEmpty check on hintStore should prevent it, unless something like this has happened.&lt;/p&gt;</comment>
                            <comment id="13551246" author="mkjellman" created="Fri, 11 Jan 2013 16:46:26 +0000"  >&lt;p&gt;a bit messy due to the repair log lines&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;tem-local-ib-671-Data.db&lt;span class=&quot;code-quote&quot;&gt;&apos;), SSTableReader(path=&apos;&lt;/span&gt;/data2/cassandra/system/local/system-local-ib-672-Data.db&lt;span class=&quot;code-quote&quot;&gt;&apos;), SSTableReader(path=&apos;&lt;/span&gt;/data2/cassandra/system/local/system-local-ib-670-Data.db&apos;)]
 INFO [CompactionExecutor:45] 2013-01-10 21:57:11,166 CompactionTask.java (line 267) Compacted 4 sstables to [/data/cassandra/system/local/system-local-ib-673,].  975 bytes to 590 (~60% of original) in 214ms = 0.002629MB/s.  4 tot
al rows, 1 unique.  Row merge counts were {1:0, 2:0, 3:0, 4:1, }
 INFO [GossipStage:1] 2013-01-10 21:57:16,342 Gossiper.java (line 772) InetAddress /10.8.30.102 is now dead.
 INFO [GossipStage:1] 2013-01-10 21:59:01,958 Gossiper.java (line 790) Node /10.8.30.102 has restarted, now UP
 INFO [GossipStage:1] 2013-01-10 21:59:01,959 Gossiper.java (line 758) InetAddress /10.8.30.102 is now UP
 INFO [HintedHandoff:2] 2013-01-10 21:59:01,960 HintedHandOffManager.java (line 293) Started hinted handoff &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; host: a1429d88-a084-46b2-a92d-81bb43b7ccc4 with IP: /10.8.30.102
 INFO [HintedHandoff:2] 2013-01-10 21:59:02,000 ColumnFamilyStore.java (line 647) Enqueuing flush of Memtable-hints@479784922(38/69 serialized/live bytes, 46 ops)
 INFO [FlushWriter:9] 2013-01-10 21:59:02,001 Memtable.java (line 424) Writing Memtable-hints@479784922(38/69 serialized/live bytes, 46 ops)
 INFO [FlushWriter:9] 2013-01-10 21:59:02,195 Memtable.java (line 458) Completed flushing /data2/cassandra/system/hints/system-hints-ib-187-Data.db (85 bytes) &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; commitlog position ReplayPosition(segmentId=1357883369951, position
=806355)
 INFO [CompactionExecutor:60] 2013-01-10 21:59:02,200 CompactionTask.java (line 120) Compacting [SSTableReader(path=&lt;span class=&quot;code-quote&quot;&gt;&apos;/data2/cassandra/system/hints/system-hints-ib-187-Data.db&apos;&lt;/span&gt;), SSTableReader(path=&apos;/data2/cassandra/system/hints/sy
stem-hints-ib-186-Data.db&apos;)]
 INFO [CompactionExecutor:60] 2013-01-10 21:59:02,431 CompactionTask.java (line 267) Compacted 2 sstables to [/data2/cassandra/system/hints/system-hints-ib-188,].  32,814 bytes to 32,729 (~99% of original) in 230ms = 0.135708MB/s.
  8 total rows, 7 unique.  Row merge counts were {1:8, 2:0, }
 INFO [HintedHandoff:2] 2013-01-10 21:59:02,432 HintedHandOffManager.java (line 408) Finished hinted handoff of 47 rows to endpoint /10.8.30.102
 INFO [GossipStage:1] 2013-01-10 21:59:11,999 StorageService.java (line 1288) Node /10.8.30.102 state jump to normal
 INFO [GossipStage:1] 2013-01-10 21:59:12,003 ColumnFamilyStore.java (line 647) Enqueuing flush of Memtable-peers@1233529943(306/5247 serialized/live bytes, 21 ops)
 INFO [FlushWriter:10] 2013-01-10 21:59:12,004 Memtable.java (line 424) Writing Memtable-peers@1233529943(306/5247 serialized/live bytes, 21 ops)
 INFO [FlushWriter:10] 2013-01-10 21:59:12,265 Memtable.java (line 458) Completed flushing /data2/cassandra/system/peers/system-peers-ib-589-Data.db (351 bytes) &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; commitlog position ReplayPosition(segmentId=1357883369951, position=806482)
 INFO [GossipStage:1] 2013-01-10 21:59:12,272 ColumnFamilyStore.java (line 647) Enqueuing flush of Memtable-local@1657301357(69/69 serialized/live bytes, 2 ops)
 INFO [FlushWriter:9] 2013-01-10 21:59:12,273 Memtable.java (line 424) Writing Memtable-local@1657301357(69/69 serialized/live bytes, 2 ops)
 INFO [FlushWriter:9] 2013-01-10 21:59:12,455 Memtable.java (line 458) Completed flushing /data2/cassandra/system/local/system-local-ib-674-Data.db (129 bytes) &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; commitlog position ReplayPosition(segmentId=1357883369951, position=806675)
 WARN [MemoryMeter:1] 2013-01-10 21:59:30,213 Memtable.java (line 191) setting live ratio to minimum of 1.0 instead of 0.09066707435830113
 INFO [MemoryMeter:1] 2013-01-10 21:59:30,214 Memtable.java (line 207) CFS(Keyspace=&lt;span class=&quot;code-quote&quot;&gt;&apos;evidence&apos;&lt;/span&gt;, ColumnFamily=&lt;span class=&quot;code-quote&quot;&gt;&apos;messages&apos;&lt;/span&gt;) liveRatio is 1.0 (just-counted was 1.0).  calculation took 7ms &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 55 columns
 INFO [HintedHandoff:1] 2013-01-10 22:00:20,287 HintedHandOffManager.java (line 293) Started hinted handoff &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; host: a1429d88-a084-46b2-a92d-81bb43b7ccc4 with IP: /10.8.30.102
 INFO [HintedHandoff:1] 2013-01-10 22:00:20,288 HintedHandOffManager.java (line 408) Finished hinted handoff of 0 rows to endpoint /10.8.30.102
 INFO [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-50] 2013-01-10 22:02:39,618 StorageService.java (line 2304) Starting repair command #1, repairing 1 ranges &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; keyspace evidence
 INFO [AntiEntropySessions:1] 2013-01-10 22:02:39,637 AntiEntropyService.java (line 652) [repair #815023d0-5bb4-11e2-906d-dd50a26832ff] &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; session: will sync /10.8.25.101, /10.8.30.14 on range (28356863910078205288614550619314017620,42535295865117307932921825928971026436] &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; evidence.[fingerprints, messages]
 INFO [AntiEntropySessions:1] 2013-01-10 22:02:39,646 AntiEntropyService.java (line 857) [repair #815023d0-5bb4-11e2-906d-dd50a26832ff] requesting merkle trees &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; fingerprints (to [/10.8.30.14, /10.8.25.101])
 INFO [ValidationExecutor:1] 2013-01-10 22:02:39,665 ColumnFamilyStore.java (line 647) Enqueuing flush of Memtable-fingerprints@1756165009(409626/409626 serialized/live bytes, 53 ops)
 INFO [FlushWriter:11] 2013-01-10 22:02:39,666 Memtable.java (line 424) Writing Memtable-fingerprints@1756165009(409626/409626 serialized/live bytes, 53 ops)
 INFO [FlushWriter:11] 2013-01-10 22:02:39,871 Memtable.java (line 458) Completed flushing /data2/cassandra/evidence/fingerprints/evidence-fingerprints-ib-195-Data.db (349405 bytes) &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; commitlog position ReplayPosition(segmentId=1357883369951, position=3000340)
 WARN [MemoryMeter:1] 2013-01-10 22:02:39,917 Memtable.java (line 191) setting live ratio to minimum of 1.0 instead of 0.03491183672633014
 INFO [MemoryMeter:1] 2013-01-10 22:02:39,917 Memtable.java (line 207) CFS(Keyspace=&lt;span class=&quot;code-quote&quot;&gt;&apos;evidence&apos;&lt;/span&gt;, ColumnFamily=&lt;span class=&quot;code-quote&quot;&gt;&apos;messages&apos;&lt;/span&gt;) liveRatio is 1.0 (just-counted was 1.0).  calculation took 19ms &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 106 columns
 INFO [AntiEntropyStage:1] 2013-01-10 22:05:31,251 AntiEntropyService.java (line 214) [repair #815023d0-5bb4-11e2-906d-dd50a26832ff] Received merkle tree &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; fingerprints from /10.8.25.101
 WARN [MemoryMeter:1] 2013-01-10 22:05:53,141 Memtable.java (line 191) setting live ratio to minimum of 1.0 instead of 0.0038005359709140643
 INFO [MemoryMeter:1] 2013-01-10 22:05:53,142 Memtable.java (line 207) CFS(Keyspace=&lt;span class=&quot;code-quote&quot;&gt;&apos;evidence&apos;&lt;/span&gt;, ColumnFamily=&lt;span class=&quot;code-quote&quot;&gt;&apos;fingerprints&apos;&lt;/span&gt;) liveRatio is 1.0 (just-counted was 1.0).  calculation took 6ms &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 10 columns
 INFO [MemoryMeter:1] 2013-01-10 22:08:53,699 Memtable.java (line 207) CFS(Keyspace=&lt;span class=&quot;code-quote&quot;&gt;&apos;brts&apos;&lt;/span&gt;, ColumnFamily=&lt;span class=&quot;code-quote&quot;&gt;&apos;evidence_index&apos;&lt;/span&gt;) liveRatio is 3.018170276918194 (just-counted was 3.018170276918194).  calculation took 24ms &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 235 columns
 INFO [HintedHandoff:2] 2013-01-10 22:10:20,290 HintedHandOffManager.java (line 293) Started hinted handoff &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; host: a1429d88-a084-46b2-a92d-81bb43b7ccc4 with IP: /10.8.30.102
 INFO [HintedHandoff:2] 2013-01-10 22:10:20,291 HintedHandOffManager.java (line 408) Finished hinted handoff of 0 rows to endpoint /10.8.30.102
 WARN [MemoryMeter:1] 2013-01-10 22:12:57,094 Memtable.java (line 191) setting live ratio to minimum of 1.0 instead of 0.033105659834837216
 INFO [MemoryMeter:1] 2013-01-10 22:12:57,095 Memtable.java (line 207) CFS(Keyspace=&lt;span class=&quot;code-quote&quot;&gt;&apos;evidence&apos;&lt;/span&gt;, ColumnFamily=&lt;span class=&quot;code-quote&quot;&gt;&apos;messages&apos;&lt;/span&gt;) liveRatio is 1.0 (just-counted was 1.0).  calculation took 18ms &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 213 columns
 INFO [HintedHandoff:1] 2013-01-10 22:20:20,293 HintedHandOffManager.java (line 293) Started hinted handoff &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; host: a1429d88-a084-46b2-a92d-81bb43b7ccc4 with IP: /10.8.30.102
 INFO [HintedHandoff:1] 2013-01-10 22:20:20,294 HintedHandOffManager.java (line 408) Finished hinted handoff of 0 rows to endpoint /10.8.30.102
 INFO [HintedHandoff:2] 2013-01-10 22:30:20,296 HintedHandOffManager.java (line 293) Started hinted handoff &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; host: a1429d88-a084-46b2-a92d-81bb43b7ccc4 with IP: /10.8.30.102
 INFO [HintedHandoff:2] 2013-01-10 22:30:20,297 HintedHandOffManager.java (line 408) Finished hinted handoff of 0 rows to endpoint /10.8.30.102
 INFO [HintedHandoff:1] 2013-01-10 22:40:20,299 HintedHandOffManager.java (line 293) Started hinted handoff &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; host: a1429d88-a084-46b2-a92d-81bb43b7ccc4 with IP: /10.8.30.102
 INFO [HintedHandoff:1] 2013-01-10 22:40:20,300 HintedHandOffManager.java (line 408) Finished hinted handoff of 0 rows to endpoint /10.8.30.102
 WARN [MemoryMeter:1] 2013-01-10 22:44:25,510 Memtable.java (line 191) setting live ratio to minimum of 1.0 instead of 0.03129749755193589
 INFO [MemoryMeter:1] 2013-01-10 22:44:25,510 Memtable.java (line 207) CFS(Keyspace=&lt;span class=&quot;code-quote&quot;&gt;&apos;evidence&apos;&lt;/span&gt;, ColumnFamily=&lt;span class=&quot;code-quote&quot;&gt;&apos;messages&apos;&lt;/span&gt;) liveRatio is 1.0 (just-counted was 1.0).  calculation took 20ms &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 387 columns
 WARN [MemoryMeter:1] 2013-01-10 22:47:55,174 Memtable.java (line 191) setting live ratio to minimum of 1.0 instead of 0.013355315914417125
 INFO [MemoryMeter:1] 2013-01-10 22:47:55,175 Memtable.java (line 207) CFS(Keyspace=&lt;span class=&quot;code-quote&quot;&gt;&apos;evidence&apos;&lt;/span&gt;, ColumnFamily=&lt;span class=&quot;code-quote&quot;&gt;&apos;fingerprints&apos;&lt;/span&gt;) liveRatio is 1.0 (just-counted was 1.0).  calculation took 11ms &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 63 columns
 INFO [HintedHandoff:2] 2013-01-10 22:50:20,302 HintedHandOffManager.java (line 293) Started hinted handoff &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; host: a1429d88-a084-46b2-a92d-81bb43b7ccc4 with IP: /10.8.30.102
 INFO [HintedHandoff:2] 2013-01-10 22:50:20,307 HintedHandOffManager.java (line 408) Finished hinted handoff of 0 rows to endpoint /10.8.30.102
 INFO [HintedHandoff:1] 2013-01-10 23:00:20,304 HintedHandOffManager.java (line 293) Started hinted handoff &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; host: a1429d88-a084-46b2-a92d-81bb43b7ccc4 with IP: /10.8.30.102
 INFO [HintedHandoff:1] 2013-01-10 23:00:20,305 HintedHandOffManager.java (line 408) Finished hinted handoff of 0 rows to endpoint /10.8.30.102
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;digest version&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;INFO [HintedHandoff:1] 2013-01-10 22:00:20,288 HintedHandOffManager.java (line 408) Finished hinted handoff of 0 rows to endpoint /10.8.30.102
 INFO [HintedHandoff:2] 2013-01-10 22:10:20,291 HintedHandOffManager.java (line 408) Finished hinted handoff of 0 rows to endpoint /10.8.30.102
 INFO [HintedHandoff:1] 2013-01-10 22:20:20,294 HintedHandOffManager.java (line 408) Finished hinted handoff of 0 rows to endpoint /10.8.30.102
 INFO [HintedHandoff:2] 2013-01-10 22:30:20,297 HintedHandOffManager.java (line 408) Finished hinted handoff of 0 rows to endpoint /10.8.30.102
 INFO [HintedHandoff:1] 2013-01-10 22:40:20,300 HintedHandOffManager.java (line 408) Finished hinted handoff of 0 rows to endpoint /10.8.30.102
 INFO [HintedHandoff:2] 2013-01-10 22:50:20,307 HintedHandOffManager.java (line 408) Finished hinted handoff of 0 rows to endpoint /10.8.30.102
 INFO [HintedHandoff:1] 2013-01-10 23:00:20,305 HintedHandOffManager.java (line 408) Finished hinted handoff of 0 rows to endpoint /10.8.30.102
 INFO [HintedHandoff:2] 2013-01-10 23:10:20,308 HintedHandOffManager.java (line 408) Finished hinted handoff of 0 rows to endpoint /10.8.30.102
 INFO [HintedHandoff:1] 2013-01-10 23:20:20,311 HintedHandOffManager.java (line 408) Finished hinted handoff of 0 rows to endpoint /10.8.30.102
 INFO [HintedHandoff:2] 2013-01-10 23:30:20,314 HintedHandOffManager.java (line 408) Finished hinted handoff of 0 rows to endpoint /10.8.30.102
 INFO [HintedHandoff:1] 2013-01-10 23:40:20,317 HintedHandOffManager.java (line 408) Finished hinted handoff of 0 rows to endpoint /10.8.30.102
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13551284" author="brandon.williams" created="Fri, 11 Jan 2013 17:16:20 +0000"  >&lt;p&gt;Hmm, so it did correctly compact just before logging:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; INFO [HintedHandoff:2] 2013-01-10 21:59:02,432 HintedHandOffManager.java (line 408) Finished hinted handoff of 47 rows to endpoint /10.8.30.102
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;m not sure why anything would be left after that.&lt;/p&gt;</comment>
                            <comment id="13557574" author="kmueller" created="Fri, 18 Jan 2013 20:34:03 +0000"  >&lt;p&gt;I&apos;m also seeing this, running 1.1.8 &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13571758" author="brandon.williams" created="Tue, 5 Feb 2013 21:43:04 +0000"  >&lt;p&gt;I ran into this in 1.2, and the problem is definitely old sstables full of tombstones being left behind:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; activity                                                                                        | timestamp    | source        | source_elapsed
-------------------------------------------------------------------------------------------------+--------------+---------------+----------------
                                                                              execute_cql3_query | 21:10:25,847 | 10.179.64.227 |              0
                                                                               Parsing statement | 21:10:25,847 | 10.179.64.227 |             39
                                                                              Peparing statement | 21:10:25,847 | 10.179.64.227 |            208
                                                                   Determining replicas to query | 21:10:25,847 | 10.179.64.227 |            316
 Executing seq scan across 2 sstables for [min(-9223372036854775808), min(-9223372036854775808)] | 21:10:25,870 | 10.179.64.227 |          23223
                                                          Read 0 live cells and 13800 tombstoned | 21:10:25,928 | 10.179.64.227 |          81432
                                                          Read 0 live cells and 13068 tombstoned | 21:10:26,015 | 10.179.64.227 |         168213
                                                                    Scanned 2 rows and matched 2 | 21:10:26,016 | 10.179.64.227 |         169206
                                                                                Request complete | 21:10:26,016 | 10.179.64.227 |         169585
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;The problem appears to occur here:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; INFO [GossipStage:1] 2013-02-04 22:54:34,828 Gossiper.java (line 754) InetAddress /10.179.111.137 is now UP
 INFO [GossipStage:1] 2013-02-04 22:54:34,830 Gossiper.java (line 754) InetAddress /10.179.65.102 is now UP
 INFO [HintedHandoff:1] 2013-02-04 22:54:34,830 HintedHandOffManager.java (line 297) Started hinted handoff for host: 5b49c861-0cf6-48dc-872a-7fcb89429dae with IP: /10.179.111.137
 INFO [HintedHandoff:2] 2013-02-04 22:54:34,830 HintedHandOffManager.java (line 297) Started hinted handoff for host: 0fd1d3b1-0f73-40fd-ab36-9f4b9636a205 with IP: /10.179.65.102
 INFO [HintedHandoff:2] 2013-02-04 22:54:41,039 ColumnFamilyStore.java (line 678) Enqueuing flush of Memtable-hints@164677298(1020984/1020984 serialized/live bytes, 39151 ops)
 INFO [FlushWriter:2] 2013-02-04 22:54:41,041 Memtable.java (line 453) Writing Memtable-hints@164677298(1020984/1020984 serialized/live bytes, 39151 ops)
 INFO [CompactionExecutor:8] 2013-02-04 22:54:41,043 CompactionTask.java (line 112) Compacting [SSTableReader(path=&apos;/var/lib/cassandra/data/system/hints/system-hints-ib-1-Data.db&apos;)]
 INFO [FlushWriter:2] 2013-02-04 22:54:41,200 Memtable.java (line 487) Completed flushing /var/lib/cassandra/data/system/hints/system-hints-ib-2-Data.db (166760 bytes) for commitlog position ReplayPosition(segmentId=1360018215672, position=11404848)
 INFO [CompactionExecutor:9] 2013-02-04 22:54:41,215 CompactionManager.java (line 452) SSTables for user defined compaction are already being compacted.
 INFO [HintedHandoff:2] 2013-02-04 22:54:41,216 HintedHandOffManager.java (line 412) Finished hinted handoff of 13909 rows to endpoint /10.179.65.102
 INFO [CompactionExecutor:8] 2013-02-04 22:54:41,444 CompactionTask.java (line 272) Compacted 1 sstables to [/var/lib/cassandra/data/system/hints/system-hints-ib-3,].  625,567 bytes to 625,567 (~100% of original) in 401ms = 1.487749MB/s.  2 total rows, 2 unique.  Row merge counts were {1:2, }
 INFO [HintedHandoff:1] 2013-02-04 22:54:41,445 HintedHandOffManager.java (line 412) Finished hinted handoff of 13230 rows to endpoint /10.179.111.137
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The problem is that with concurrent delivery we end up in a state where we have two sstables that contain tombstones, each containing some portion of them for the endpoints that were delivered to.  Since we never replay any rows again, we never compact again, and thus never evict the tombstones.&lt;/p&gt;

&lt;p&gt;I think I&apos;m back to what I proposed before of just removing the replayed &amp;gt; 0 check and letting isEmpty check handle the common case.&lt;/p&gt;
</comment>
                            <comment id="13571769" author="jbellis" created="Tue, 5 Feb 2013 21:51:22 +0000"  >&lt;p&gt;Shouldn&apos;t the &quot;I have &amp;gt; X % tombstones in this sstable&quot; code kick in?&lt;/p&gt;</comment>
                            <comment id="13571772" author="peter-librato" created="Tue, 5 Feb 2013 21:56:51 +0000"  >&lt;p&gt;We see this in 1.1.9 as well.&lt;/p&gt;</comment>
                            <comment id="13571782" author="brandon.williams" created="Tue, 5 Feb 2013 22:04:45 +0000"  >&lt;blockquote&gt;&lt;p&gt;Shouldn&apos;t the &quot;I have &amp;gt; X % tombstones in this sstable&quot; code kick in?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;As in the tombstone-aggressive code in STS?  I suspect we&apos;re ending up under the min compaction threshold all the time.&lt;/p&gt;</comment>
                            <comment id="13575973" author="slebresne" created="Mon, 11 Feb 2013 18:59:28 +0000"  >&lt;p&gt;I believe this is a consequence of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5241&quot; title=&quot;Fix forceBlockingFlush&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5241&quot;&gt;&lt;del&gt;CASSANDRA-5241&lt;/del&gt;&lt;/a&gt;. Now while we should probably fix &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5241&quot; title=&quot;Fix forceBlockingFlush&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5241&quot;&gt;&lt;del&gt;CASSANDRA-5241&lt;/del&gt;&lt;/a&gt;, relying on tombstone being always fully collected feels a bit fragile and not very useful since we have the isEmpty check at the beginning of the delivery. So +1 on the patch.&lt;/p&gt;</comment>
                            <comment id="13575988" author="brandon.williams" created="Mon, 11 Feb 2013 19:06:24 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10020">
                    <name>Cloners</name>
                                            <outwardlinks description="is a clone of">
                                        <issuelink>
            <issuekey id="12538223">CASSANDRA-3733</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12568090" name="5068.txt" size="919" author="brandon.williams" created="Tue, 5 Feb 2013 21:43:24 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>297583</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 41 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i14rjb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>235926</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311124" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Tester</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>enigmacurry</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>