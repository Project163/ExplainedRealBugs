<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:15:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-15503] Slow query log indicates opposite LTE when GTE operator</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-15503</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Slow query log is indicating a &apos;&amp;lt;=&apos; when a &quot;&amp;gt;=&quot; operator was sent. This appears to be a logging only issue, but it threw off development for a day figuring this out. Please fix.&lt;/p&gt;

&lt;p&gt;How to reproduce. Set slow query log timeout to 1 millisecond.&lt;/p&gt;

&lt;p&gt;In cqlsh run&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;CREATE TABLE atable (
      .id text,
      timestamp timestamp,
      PRIMARY KEY ((id), timestamp)
 ) WITH CLUSTERING ORDER BY (timestamp DESC);
insert into atable (id, timestamp) VALUES ( &apos;1&apos;,1);
insert into atable (id, timestamp) VALUES ( &apos;2&apos;,2);
insert into atable (id, timestamp) VALUES ( &apos;3&apos;,3);
insert into atable (id, timestamp) VALUES ( &apos;4&apos;,4);
insert into atable (id, timestamp) VALUES ( &apos;5&apos;,5);
insert into atable (id, timestamp) VALUES ( &apos;6&apos;,6);
insert into atable (id, timestamp) VALUES ( &apos;7&apos;,7);
insert into atable (id, timestamp) VALUES ( &apos;8&apos;,8);
insert into atable (id, timestamp) VALUES ( &apos;9&apos;,9);
insert into atable (id, timestamp) VALUES ( &apos;10&apos;,10);
insert into atable (id, timestamp) VALUES ( &apos;11&apos;,11);

select * from atable where timestamp &amp;gt;= &apos;1970-01-01 00:00:00.006+0000&apos; allow filtering;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;In the logs it prints:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;DEBUG 1 operations were slow in the last 5003 msecs:
&amp;lt;SELECT * FROM ks.atable WHERE timestamp &amp;lt;= 1970-01-01 00:00Z LIMIT 100&amp;gt;, time 7 msec - slow timeout 1 msec
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But the query works appropriately and returns&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; id | timestamp
----+---------------------------------
  6 | 1970-01-01 00:00:00.006000+0000
  7 | 1970-01-01 00:00:00.007000+0000
  9 | 1970-01-01 00:00:00.009000+0000
 10 | 1970-01-01 00:00:00.010000+0000
  8 | 1970-01-01 00:00:00.008000+0000
 11 | 1970-01-01 00:00:00.011000+0000

(6 rows)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13279460">CASSANDRA-15503</key>
            <summary>Slow query log indicates opposite LTE when GTE operator</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="adelapena">Andres de la Pe&#241;a</assignee>
                                    <reporter username="wally.baggaley@smartrg.com">Wallace Baggaley</reporter>
                        <labels>
                    </labels>
                <created>Tue, 14 Jan 2020 23:21:34 +0000</created>
                <updated>Thu, 18 Jun 2020 13:11:08 +0000</updated>
                            <resolved>Mon, 11 May 2020 11:20:04 +0000</resolved>
                                        <fixVersion>3.11.7</fixVersion>
                    <fixVersion>4.0-beta1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Observability/Logging</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3000">50m</timespent>
                                <comments>
                            <comment id="17018464" author="cscotta" created="Sat, 18 Jan 2020 01:41:05 +0000"  >&lt;p&gt;Confirmed this reproduces on 3.11.5, affecting strict equalities as well.&lt;/p&gt;

&lt;p&gt;Strict equality expressions aren&apos;t printed at all:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;cqlsh&amp;gt; select * from test.atable where timestamp = &apos;1975-01-01 00:00:00.006+0000&apos; allow filtering;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;=&amp;gt; &amp;lt;SELECT * FROM test.atable WHERE&#160; LIMIT 100&amp;gt;, time 11 msec - slow timeout 1 msec/cross-node&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;And as Wallace notes, inequalities are reversed:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;cqlsh&amp;gt; select * from test.atable where timestamp &amp;gt; &apos;1975-01-01 00:00:00.006+0000&apos; allow filtering;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;=&amp;gt; &amp;lt;SELECT * FROM test.atable WHERE timestamp&#160;&amp;lt; 1974-12-31 16:00-0800 LIMIT 100&amp;gt;, time 11 msec - slow timeout 1 msec/cross-node&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="17094462" author="adelapena" created="Tue, 28 Apr 2020 12:37:17 +0000"  >&lt;p&gt;The reversed inequalities are caused by the &lt;tt&gt;DESC&lt;/tt&gt; clustering order used by the table. &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-3.10/src/java/org/apache/cassandra/db/Slices.java#L623&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;Slices.ArrayBackedSlices#toCQLString&lt;/tt&gt;&lt;/a&gt; doesn&apos;t take into account that in case of reverse order the operators are internally reversed.&lt;/p&gt;

&lt;p&gt;As for the strict equality, there seems to be a mistake at the beginning of  &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-3.10/src/java/org/apache/cassandra/db/filter/ClusteringIndexNamesFilter.java#L192&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;ClusteringIndexNamesFilter#toCQLString&lt;/tt&gt;&lt;/a&gt;, where clustering restrictions with a single clustering or empty are not printed. This was introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7392&quot; title=&quot;Abort in-progress queries that time out&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7392&quot;&gt;&lt;del&gt;CASSANDRA-7392&lt;/del&gt;&lt;/a&gt;, specifically in &lt;a href=&quot;https://github.com/stef1927/cassandra/commit/27962122243d41d0bc994eccb84970dcba14306d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this commit&lt;/a&gt;. I think that they should not be printed only if there are no clusterings at all.&lt;/p&gt;

&lt;p&gt;Here is a patch addressing both problems:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;PR&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;utest&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;dtest&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.11&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/pull/568&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;568&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch-test/67/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;67&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch-dtest/88/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;88&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;trunk&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra/pull/569&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;569&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch-test/68/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;68&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch-dtest/89/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;89&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;dtest&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/apache/cassandra-dtest/pull/67&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;67&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="17100565" author="bereng" created="Wed, 6 May 2020 08:12:36 +0000"  >&lt;p&gt;LGTM after addressing review comments +1&lt;/p&gt;</comment>
                            <comment id="17104349" author="adelapena" created="Mon, 11 May 2020 11:18:46 +0000"  >&lt;p&gt;Thanks for the review. Committed to 3.11 branch as &lt;a href=&quot;https://github.com/apache/cassandra/commit/406a8596eb7ad18079df20121521b1c659063ef4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;406a8596eb7ad18079df20121521b1c659063ef4&lt;/a&gt;&#160;and merged up to &lt;a href=&quot;https://github.com/apache/cassandra/commit/5f61e94ea5d25aae1eb96e74512e55edef1cef14&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;. Dtest changes committed as &lt;a href=&quot;https://github.com/apache/cassandra-dtest/commit/10ff82bf779289da913b40c1058fd85bd748c986&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;10ff82bf779289da913b40c1058fd85bd748c986&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310660">
                    <name>Completes</name>
                                            <outwardlinks description="fixes">
                                        <issuelink>
            <issuekey id="13278995">CASSANDRA-15500</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12995474">CASSANDRA-12403</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[adelapena]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12969"><![CDATA[User Report]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 27 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0aihs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[adelapena]]></customfieldvalue>
        <customfieldvalue><![CDATA[bereng]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12337348">3.10</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/406a8596eb7ad18079df20121521b1c659063ef4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/406a8596eb7ad18079df20121521b1c659063ef4&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra-dtest/pull/67&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra-dtest/pull/67&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>