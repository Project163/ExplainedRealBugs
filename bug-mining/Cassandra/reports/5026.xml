<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:11:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-12244] progress in compactionstats is reported wrongly for view builds</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-12244</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;In the view build progress given by compactionstats, there are several issues :&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;                                     id   compaction type   keyspace         table   completed       total     unit   progress
   038d3690-4dbe-11e6-b207-21ec388d48e6        View build      mykeyspace   mytable   844 bytes   967 bytes   ranges     87.28%
Active compaction remaining time :        n/a
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;1) those are ranges, not bytes&lt;br/&gt;
2) it&apos;s not at 87.28%, it&apos;s at ~4%. the method for calculating progress in Cassandra is wrong: it neglects to sort the tokens it&apos;s iterating through (ViewBuilder.java) and thus ends up with a random number.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12991067">CASSANDRA-12244</key>
            <summary>progress in compactionstats is reported wrongly for view builds</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jasonstack">Zhao Yang</assignee>
                                    <reporter username="tvdw">Tom van der Woerdt</reporter>
                        <labels>
                            <label>lhf</label>
                    </labels>
                <created>Wed, 20 Jul 2016 09:47:44 +0000</created>
                <updated>Fri, 15 May 2020 08:01:34 +0000</updated>
                            <resolved>Fri, 4 May 2018 05:24:27 +0000</resolved>
                                        <fixVersion>3.0.17</fixVersion>
                    <fixVersion>3.11.3</fixVersion>
                    <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15389603" author="slebresne" created="Fri, 22 Jul 2016 14:28:40 +0000"  >&lt;p&gt;Sounds wrong indeed. Wants to give a short a patch by any chance?&lt;/p&gt;</comment>
                            <comment id="15639159" author="jasonstack" created="Sat, 5 Nov 2016 10:03:42 +0000"  >&lt;p&gt;1. change the compactionstats display to check if it&apos;s `bytes` unit before formating&lt;br/&gt;
2. added enum Unit - bytes, keys, ranges&lt;br/&gt;
3. change viewbuilder progress part to: first sort ranges then check num of ranges til last-built-token. &lt;/p&gt;

&lt;p&gt;commit:&lt;br/&gt;
&lt;a href=&quot;https://github.com/jasonstack/cassandra/commit/3fd19bc79fe5c8d6a0017e337296a702a5412173&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jasonstack/cassandra/commit/3fd19bc79fe5c8d6a0017e337296a702a5412173&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15656122" author="muru" created="Fri, 11 Nov 2016 04:45:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jasonstack&quot; class=&quot;user-hover&quot; rel=&quot;jasonstack&quot;&gt;jasonstack&lt;/a&gt; IMHO the ranges don&apos;t need to be sorted. You could do something like:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (Range&amp;lt;Token&amp;gt; range : StorageService.instance.getLocalRanges(baseCfs.keyspace.getName()))
        {
            rangesTotal++;
            &lt;span class=&quot;code-comment&quot;&gt;// Each range whose right boundary (largest value) is less than the lastToken can be considered as seen
&lt;/span&gt;            &lt;span class=&quot;code-comment&quot;&gt;// by the node.
&lt;/span&gt;
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ((lastToken != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &amp;amp;&amp;amp; lastToken.compareTo(range.right) &amp;gt; 0)
                rangesCompleted++;
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Making a collection and sorting it is a waste when you need to iterate over the ranges only once.&lt;/p&gt;</comment>
                            <comment id="15659573" author="jasonstack" created="Sat, 12 Nov 2016 12:14:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=muru&quot; class=&quot;user-hover&quot; rel=&quot;muru&quot;&gt;muru&lt;/a&gt; thanks for the comments. I updated the commit: &lt;a href=&quot;https://github.com/jasonstack/cassandra/commit/4339a960fe9cd2b42dc80192570d39287d6c9157&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jasonstack/cassandra/commit/4339a960fe9cd2b42dc80192570d39287d6c9157&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15857910" author="slebresne" created="Wed, 8 Feb 2017 12:13:41 +0000"  >&lt;p&gt;Sorry, I know I encouraged the submission of a patch here but that&apos;s not the part of the code I know the best and I&apos;m a bit swamped right now so I&apos;m gonna leave the review to someone else.&lt;/p&gt;</comment>
                            <comment id="16460524" author="michaelsembwever" created="Wed, 2 May 2018 05:10:02 +0000"  >&lt;p&gt;Patch looks good. Note in trunk it was fixed in a different manner, but the clash with the human readable flag was still there so I kept the introduction of the &lt;tt&gt;Unit&lt;/tt&gt; enum.&lt;/p&gt;


&lt;p&gt;I&apos;ve put your patch into relevant branches, and will commit once they go green.&lt;br/&gt;
In the meantime &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jasonstack&quot; class=&quot;user-hover&quot; rel=&quot;jasonstack&quot;&gt;jasonstack&lt;/a&gt;, could you please check i&apos;ve applied your patch appropriately in each branch and commit.&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Branch &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; uTest &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; dTest &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/thelastpickle/cassandra/tree/mck/cassandra-3.0_12244&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cassandra-3.0_12244&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/thelastpickle/cassandra/tree/mck%2Fcassandra-3.0_12244&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://circleci.com/gh/thelastpickle/cassandra/tree/mck%2Fcassandra-3.0_12244.svg?style=svg&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/540/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/540/&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/thelastpickle/cassandra/tree/mck/cassandra-3.11_12244&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cassandra-3.11_12244&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/thelastpickle/cassandra/tree/mck%2Fcassandra-3.11_12244&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://circleci.com/gh/thelastpickle/cassandra/tree/mck%2Fcassandra-3.11_12244.svg?style=svg&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/541/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/541/&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/thelastpickle/cassandra/tree/mck/trunk_12244&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk_12244&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/thelastpickle/cassandra/tree/mck%2Ftrunk_12244&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://circleci.com/gh/thelastpickle/cassandra/tree/mck%2Ftrunk_12244.svg?style=svg&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/542/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/542/&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="16462348" author="michaelsembwever" created="Thu, 3 May 2018 12:12:50 +0000"  >&lt;p&gt;Looking green. Trunk&apos;s &lt;tt&gt;test-all&lt;/tt&gt; is already broken, waiting on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14428&quot; title=&quot;Run ant eclipse-warnings in circleci&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14428&quot;&gt;&lt;del&gt;CASSANDRA-14428&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
And comparing failed dtests to their respective base branches:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;3.0: stable &lt;tt&gt;bootstrap_test.TestBootstrap.test_simultaneous_bootstrap&lt;/tt&gt; failed, tested locally ok.&lt;/li&gt;
	&lt;li&gt;3.11: no difference.&lt;/li&gt;
	&lt;li&gt;trunk: two additional failures: &lt;tt&gt;bootstrap_test.TestBootstrap.test_decommissioned_wiped_node_can_join&lt;/tt&gt; and &lt;tt&gt;repair_tests.repair_test.TestRepair.test_dc_repair&lt;/tt&gt;; neither are flakey but both tested locally ok.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16462388" author="jasonstack" created="Thu, 3 May 2018 12:57:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mck&quot; class=&quot;user-hover&quot; rel=&quot;mck&quot;&gt;mck&lt;/a&gt; thanks for the review, looks good to me.&lt;/p&gt;</comment>
                            <comment id="16463380" author="michaelsembwever" created="Fri, 4 May 2018 05:24:27 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jasonstack]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 28 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i31933:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12335694">3.0.7</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>mck</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[mck]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>