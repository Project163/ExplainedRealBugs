<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:25:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-17752] fix restarting of services on gossipping-only members</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-17752</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;When a node is started with -Dcassandra.join_ring=false, it is possible to talk to it via CQL. If we disable it via &quot;nodetool disablebinary&quot;, it is not possible to enable it back with &quot;nodetool enablebinary&quot;.&lt;/p&gt;

&lt;p&gt;The reason why is that enablebinary command eventually calls &quot;StorageService#checkServiceAllowedToStart&quot; and it throws when:&lt;/p&gt;

&lt;p&gt;1) the node is draining (which does not happen)&lt;br/&gt;
2) it is shutting down (which does not happen)&lt;br/&gt;
3) is not in NORMAL state - which happens.&lt;/p&gt;

&lt;p&gt;The state of the gossipping-only member is STARTING for ever.&lt;/p&gt;

&lt;p&gt;The check should make an exception here, like if it is in STARTING but -Dcassandra.join_ring=false, start it anyway.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13471394">CASSANDRA-17752</key>
            <summary>fix restarting of services on gossipping-only members</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="smiklosovic">Stefan Miklosovic</assignee>
                                    <reporter username="smiklosovic">Stefan Miklosovic</reporter>
                        <labels>
                    </labels>
                <created>Wed, 13 Jul 2022 11:47:07 +0000</created>
                <updated>Tue, 12 Sep 2023 13:02:41 +0000</updated>
                            <resolved>Wed, 27 Jul 2022 13:32:11 +0000</resolved>
                                        <fixVersion>3.0.28</fixVersion>
                    <fixVersion>3.11.14</fixVersion>
                    <fixVersion>4.0.6</fixVersion>
                    <fixVersion>4.1-beta1</fixVersion>
                    <fixVersion>5.0-alpha1</fixVersion>
                    <fixVersion>5.0</fixVersion>
                                    <component>Legacy/Core</component>
                    <component>Tool/nodetool</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="600">10m</timespent>
                                <comments>
                            <comment id="17566712" author="smiklosovic" created="Thu, 14 Jul 2022 08:34:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/pull/1732&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/1732&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I have renamed this ticket to describe this problem in broader sense. In the description of the ticket, I am dealing with native transport only.&lt;/p&gt;

&lt;p&gt;There was also an idea to get rid of this check completely but I would rather leave it there for now, preserving the previous solution, I would just fix the restarting.&lt;/p&gt;

&lt;p&gt;The problematic method is also called on these occasions:&lt;/p&gt;

&lt;p&gt;1) start of gossip - this is interesting corner case, but I think it should be possible to stop and start gossipping on a gossipping only member&lt;br/&gt;
2) start of thrift - I do not see any reason why restarting of thrift on gossipping only member should fail&lt;br/&gt;
3) start of native transport&lt;br/&gt;
4) start of auto compaction - again, this is fairly innocent operation as that node does not hold any data anyway.&lt;/p&gt;

&lt;p&gt;Fixing this will obviously fix respective enable/disable nodetool command combos.&lt;/p&gt;

&lt;p&gt;I will provide all other branches &amp;amp; build once we agree on the approach.&lt;/p&gt;</comment>
                            <comment id="17566963" author="smiklosovic" created="Thu, 14 Jul 2022 19:54:24 +0000"  >&lt;p&gt;build for 3.0 looks fine &lt;a href=&quot;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch/1827&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-cassandra.apache.org/view/patches/job/Cassandra-devbranch/1827&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17568568" author="brandon.williams" created="Tue, 19 Jul 2022 13:39:21 +0000"  >&lt;p&gt;Approach LGTM.&lt;/p&gt;</comment>
                            <comment id="17571490" author="smiklosovic" created="Tue, 26 Jul 2022 15:15:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt; I propose these branches to be merged based on the respective builds.&lt;/p&gt;

&lt;p&gt;branches:&lt;/p&gt;

&lt;p&gt;trunk &lt;a href=&quot;https://github.com/instaclustr/cassandra/tree/CASSANDRA-17752-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/instaclustr/cassandra/tree/CASSANDRA-17752-trunk&lt;/a&gt;&lt;br/&gt;
4.1 &lt;a href=&quot;https://github.com/instaclustr/cassandra/tree/CASSANDRA-17752-4.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/instaclustr/cassandra/tree/CASSANDRA-17752-4.1&lt;/a&gt;&lt;br/&gt;
4.0 &lt;a href=&quot;https://github.com/instaclustr/cassandra/tree/CASSANDRA-17752-4.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/instaclustr/cassandra/tree/CASSANDRA-17752-4.0&lt;/a&gt;&lt;br/&gt;
3.11 &lt;a href=&quot;https://github.com/instaclustr/cassandra/tree/CASSANDRA-17752-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/instaclustr/cassandra/tree/CASSANDRA-17752-3.11&lt;/a&gt;&lt;br/&gt;
3.0 &lt;a href=&quot;https://github.com/instaclustr/cassandra/tree/CASSANDRA-17752&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/instaclustr/cassandra/tree/CASSANDRA-17752&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;builds:&lt;/p&gt;

&lt;p&gt;trunk &lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch/1851/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-cassandra.apache.org/job/Cassandra-devbranch/1851/&lt;/a&gt;&lt;br/&gt;
4.1 &lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch/1849&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-cassandra.apache.org/job/Cassandra-devbranch/1849&lt;/a&gt;&lt;br/&gt;
4.0 &lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch/1847&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-cassandra.apache.org/job/Cassandra-devbranch/1847&lt;/a&gt;&lt;br/&gt;
3.11 &lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch/1848&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-cassandra.apache.org/job/Cassandra-devbranch/1848&lt;/a&gt;&lt;br/&gt;
3.0 &lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch/1827&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-cassandra.apache.org/job/Cassandra-devbranch/1827&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17571499" author="brandon.williams" created="Tue, 26 Jul 2022 15:24:00 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[smiklosovic]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12977"><![CDATA[Adhoc Test]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 16 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z16tx4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12338291">3.0.10</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/a7b53217bda59f04c7266136614c3e79ac44d0c2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/a7b53217bda59f04c7266136614c3e79ac44d0c2&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;in-jvm dtests&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>