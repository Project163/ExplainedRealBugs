<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:50:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-8268] Token serialization should not assume all tokens are created by the database partitioner</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-8268</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;This is also a hidden reference to StorageService.getPartitioner within Token, but this needs to be handled more carefully as we need to check whether tokens serialized with the wrong partitioner could be present in user data.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12753374">CASSANDRA-8268</key>
            <summary>Token serialization should not assume all tokens are created by the database partitioner</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="blambov">Branimir Lambov</assignee>
                                    <reporter username="blambov">Branimir Lambov</reporter>
                        <labels>
                    </labels>
                <created>Thu, 6 Nov 2014 11:57:14 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:29 +0000</updated>
                            <resolved>Thu, 29 Jan 2015 21:54:25 +0000</resolved>
                                        <fixVersion>2.2.0 beta 1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14200251" author="jbellis" created="Thu, 6 Nov 2014 14:51:31 +0000"  >&lt;p&gt;How would serialized tokens be in user data?&lt;/p&gt;</comment>
                            <comment id="14200303" author="blambov" created="Thu, 6 Nov 2014 15:14:54 +0000"  >&lt;p&gt;I think I used the wrong term here. I meant some data that is part of an user&apos;s existing database, be it the messages that old version nodes send or any system data stored.&lt;/p&gt;

&lt;p&gt;I actually don&apos;t know if there&apos;s anything that does not use the storage service partitioner that is ever serialized. Most probably there isn&apos;t or we&apos;d be seeing errors, but this needs to be determined for sure before anything to do with the serialization is changed.&lt;/p&gt;</comment>
                            <comment id="14200311" author="jbellis" created="Thu, 6 Nov 2014 15:20:55 +0000"  >&lt;p&gt;It&apos;s definitely safe to assume that anything that&apos;s not node-local (i.e. not system table or indexes) is using the cluster partitioner.&lt;/p&gt;</comment>
                            <comment id="14224568" author="blambov" created="Tue, 25 Nov 2014 14:10:41 +0000"  >&lt;p&gt;Patch uploaded, comparison viewable &lt;a href=&quot;https://github.com/blambov/cassandra/compare/8268-token-serialization-partitioner&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Moves the selection of partitioner for the de-serialization of &lt;tt&gt;Token&lt;/tt&gt; and Token-based entities (&lt;tt&gt;RowPosition&lt;/tt&gt;, &lt;tt&gt;Bounds&lt;/tt&gt;, &lt;tt&gt;Range&lt;/tt&gt; etc.) up to the messaging layer, where we can be confident which partitioner needs to be used. Makes the serialization of &lt;tt&gt;MerkleTree&lt;/tt&gt; correct in the case where the partitioner for the tree is different from &lt;tt&gt;StorageService.getPartitioner()&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Removes the last references to &lt;tt&gt;StorageService.getPartitioner()&lt;/tt&gt; from the Token-based classes.&lt;/p&gt;</comment>
                            <comment id="14224585" author="iamaleksey" created="Tue, 25 Nov 2014 14:20:12 +0000"  >&lt;p&gt;Can we get rid of StorageService.getPartitioner() altogether? There is no point in having both that and DatabaseDescriptor.getPartitioner() - with the former calling the latter.&lt;/p&gt;</comment>
                            <comment id="14224612" author="blambov" created="Tue, 25 Nov 2014 14:34:50 +0000"  >&lt;p&gt;I&apos;m not there yet. I want to keep it while removing its uses in stages, and finally remove it when I&apos;m sure what all of its current references need to be using.&lt;/p&gt;

&lt;p&gt;There are quite a few references left, including some in the preparation of select statements that need a bit more work.&lt;/p&gt;</comment>
                            <comment id="14224613" author="iamaleksey" created="Tue, 25 Nov 2014 14:36:32 +0000"  >&lt;p&gt;Sounds reasonable.&lt;/p&gt;</comment>
                            <comment id="14292215" author="iamaleksey" created="Mon, 26 Jan 2015 18:52:37 +0000"  >&lt;p&gt;I&apos;m assuming that this is stuck for lack of a reviewer. If so, I&apos;ll take it. Can you rebase for latest trunk?&lt;/p&gt;</comment>
                            <comment id="14293451" author="blambov" created="Tue, 27 Jan 2015 12:55:53 +0000"  >&lt;p&gt;The branch rebased cleanly and ran tests successfully (updated &lt;a href=&quot;https://github.com/blambov/cassandra/tree/8268-token-serialization-partitioner&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;at the same location&lt;/a&gt;), the patch should work without changes.&lt;/p&gt;</comment>
                            <comment id="14293460" author="iamaleksey" created="Tue, 27 Jan 2015 12:58:31 +0000"  >&lt;p&gt;Thanks. Will review ASAP.&lt;/p&gt;</comment>
                            <comment id="14296093" author="iamaleksey" created="Wed, 28 Jan 2015 23:53:32 +0000"  >&lt;p&gt;Code LGTM as is, but I&apos;d prefer to rename two methods if you don&apos;t mind:&lt;/p&gt;

&lt;p&gt;1. Make MS#serializationPartitioner() into MS#clusterPartitioner() or MS#globalPartitioner()&lt;br/&gt;
2. Make MS#verifyPartitioner() into MS#validatePartitioner(), and have it throw an AE (or a RTE) right there, vs. returning a boolean and have its callers to assert.&lt;/p&gt;</comment>
                            <comment id="14297047" author="blambov" created="Thu, 29 Jan 2015 15:55:10 +0000"  >&lt;p&gt;Done, using assert in validatePartitioner. Let me know if you prefer to also throw the error with assertions disabled.&lt;/p&gt;</comment>
                            <comment id="14297768" author="iamaleksey" created="Thu, 29 Jan 2015 21:54:25 +0000"  >&lt;p&gt;Made it throw an AssertionError, otherwise committed as is. Thanks!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310060">
                    <name>Container</name>
                                                                <inwardlinks description="Is contained by">
                                        <issuelink>
            <issuekey id="12749225">CASSANDRA-8143</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12752397">CASSANDRA-8244</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12695292" name="8268-v2.patch" size="34997" author="blambov" created="Thu, 29 Jan 2015 15:55:10 +0000"/>
                            <attachment id="12683558" name="8268.patch" size="35604" author="blambov" created="Tue, 25 Nov 2014 14:10:29 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blambov]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 42 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i221y7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aleksey</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>