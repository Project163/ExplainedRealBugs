<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:28:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-3655] NPE when running upgradesstables</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-3655</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Running a test upgrade from 0.7(version f sstables) to 1.0.&lt;br/&gt;
upgradesstables runs for about 40 minutes and then NPE&apos;s when trying to retrieve a key.&lt;/p&gt;

&lt;p&gt;No files have been succesfully upgraded. Likely related is that scrub (without having run upgrade) consumes all RAM and OOMs.&lt;/p&gt;

&lt;p&gt;Possible theory is that a lot of paths call IPartitioner&apos;s decorateKey, and, at least in the randompartitioner&apos;s implementation, if any of those callers pass a null ByteBuffer, they key will be null in the stack trace below.&lt;/p&gt;


&lt;p&gt;java.util.concurrent.ExecutionException: java.lang.NullPointerException&lt;br/&gt;
	at java.util.concurrent.FutureTask$Sync.innerGet(FutureTask.java:222)&lt;br/&gt;
	at java.util.concurrent.FutureTask.get(FutureTask.java:83)&lt;br/&gt;
	at org.apache.cassandra.db.compaction.CompactionManager.performAllSSTableOperation(CompactionManager.java:203)&lt;br/&gt;
	at org.apache.cassandra.db.compaction.CompactionManager.performSSTableRewrite(CompactionManager.java:219)&lt;br/&gt;
	at org.apache.cassandra.db.ColumnFamilyStore.sstablesRewrite(ColumnFamilyStore.java:970)&lt;br/&gt;
	at org.apache.cassandra.service.StorageService.upgradeSSTables(StorageService.java:1540)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
	at com.sun.jmx.mbeanserver.StandardMBeanIntrospector.invokeM2(StandardMBeanIntrospector.java:93)&lt;br/&gt;
	at com.sun.jmx.mbeanserver.StandardMBeanIntrospector.invokeM2(StandardMBeanIntrospector.java:27)&lt;br/&gt;
	at com.sun.jmx.mbeanserver.MBeanIntrospector.invokeM(MBeanIntrospector.java:208)&lt;br/&gt;
	at com.sun.jmx.mbeanserver.PerInterface.invoke(PerInterface.java:120)&lt;br/&gt;
	at com.sun.jmx.mbeanserver.MBeanSupport.invoke(MBeanSupport.java:262)&lt;br/&gt;
	at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.invoke(DefaultMBeanServerInterceptor.java:836)&lt;br/&gt;
	at com.sun.jmx.mbeanserver.JmxMBeanServer.invoke(JmxMBeanServer.java:761)&lt;br/&gt;
	at javax.management.remote.rmi.RMIConnectionImpl.doOperation(RMIConnectionImpl.java:1427)&lt;br/&gt;
	at javax.management.remote.rmi.RMIConnectionImpl.access$200(RMIConnectionImpl.java:72)&lt;br/&gt;
	at javax.management.remote.rmi.RMIConnectionImpl$PrivilegedOperation.run(RMIConnectionImpl.java:1265)&lt;br/&gt;
	at javax.management.remote.rmi.RMIConnectionImpl.doPrivilegedOperation(RMIConnectionImpl.java:1360)&lt;br/&gt;
	at javax.management.remote.rmi.RMIConnectionImpl.invoke(RMIConnectionImpl.java:788)&lt;br/&gt;
	at sun.reflect.GeneratedMethodAccessor39.invoke(Unknown Source)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
	at sun.rmi.server.UnicastServerRef.dispatch(UnicastServerRef.java:305)&lt;br/&gt;
	at sun.rmi.transport.Transport$1.run(Transport.java:159)&lt;br/&gt;
	at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
	at sun.rmi.transport.Transport.serviceCall(Transport.java:155)&lt;br/&gt;
	at sun.rmi.transport.tcp.TCPTransport.handleMessages(TCPTransport.java:535)&lt;br/&gt;
	at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run0(TCPTransport.java:790)&lt;br/&gt;
	at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run(TCPTransport.java:649)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:662)&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
	at org.apache.cassandra.db.compaction.PrecompactedRow.removeDeletedAndOldShards(PrecompactedRow.java:65)&lt;br/&gt;
	at org.apache.cassandra.db.compaction.PrecompactedRow.&amp;lt;init&amp;gt;(PrecompactedRow.java:92)&lt;br/&gt;
	at org.apache.cassandra.db.compaction.CompactionController.getCompactedRow(CompactionController.java:137)&lt;br/&gt;
	at org.apache.cassandra.db.compaction.CompactionIterable$Reducer.getReduced(CompactionIterable.java:102)&lt;br/&gt;
	at org.apache.cassandra.db.compaction.CompactionIterable$Reducer.getReduced(CompactionIterable.java:87)&lt;br/&gt;
	at org.apache.cassandra.utils.MergeIterator$OneToOne.computeNext(MergeIterator.java:200)&lt;br/&gt;
	at com.google.common.collect.AbstractIterator.tryToComputeNext(AbstractIterator.java:140)&lt;br/&gt;
	at com.google.common.collect.AbstractIterator.hasNext(AbstractIterator.java:135)&lt;br/&gt;
	at com.google.common.collect.Iterators$7.computeNext(Iterators.java:614)&lt;br/&gt;
	at com.google.common.collect.AbstractIterator.tryToComputeNext(AbstractIterator.java:140)&lt;br/&gt;
	at com.google.common.collect.AbstractIterator.hasNext(AbstractIterator.java:135)&lt;br/&gt;
	at org.apache.cassandra.db.compaction.CompactionTask.execute(CompactionTask.java:172)&lt;br/&gt;
	at org.apache.cassandra.db.compaction.CompactionManager$4.perform(CompactionManager.java:229)&lt;br/&gt;
	at org.apache.cassandra.db.compaction.CompactionManager$2.call(CompactionManager.java:182)&lt;br/&gt;
	at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)&lt;br/&gt;
	at java.util.concurrent.FutureTask.run(FutureTask.java:138)&lt;br/&gt;
	... 3 more&lt;/p&gt;</description>
                <environment>&lt;p&gt;1.0.5 + patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3618&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CASSANDRA-3618&lt;/a&gt;&lt;/p&gt;</environment>
        <key id="12535918">CASSANDRA-3655</key>
            <summary>NPE when running upgradesstables</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="tupshin">Tupshin Harper</reporter>
                        <labels>
                            <label>compaction</label>
                    </labels>
                <created>Tue, 20 Dec 2011 22:33:10 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:44 +0000</updated>
                            <resolved>Tue, 3 Jan 2012 15:27:29 +0000</resolved>
                                        <fixVersion>1.0.7</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13174997" author="jbellis" created="Thu, 22 Dec 2011 19:37:18 +0000"  >&lt;p&gt;The stacktrace indicates that either the controller or the cf parameters have to be null.  (key being null would NOT cause this exception.)&lt;/p&gt;

&lt;p&gt;Controller is always initialized to non-null except in one place in the Streaming code which should be irrelevant here.  And cf comes from merge(rows) which should also return non-null unless there&apos;s a deserialization exception.  I bet that&apos;s what&apos;s happening &amp;#8211; there should be errors in the log about &quot;Skipping row X&quot; in that case.&lt;/p&gt;

&lt;p&gt;Still, we shouldn&apos;t be ignoring those exceptions &amp;#8211; we should kill the compaction (or upgrade) and let the operator decide how to deal with them (e.g. with scrub).&lt;/p&gt;

&lt;p&gt;Patch to fix that behavior, clean up the Streaming controller use, and add extra assertions.&lt;/p&gt;</comment>
                            <comment id="13175090" author="slebresne" created="Thu, 22 Dec 2011 21:49:25 +0000"  >&lt;p&gt;+1 (It would help to know if the log from the error had &quot;Skipping row X&quot; to know if the hypothesis is correct but in any case I agree we shouldn&apos;t ignore those exceptions)&lt;/p&gt;</comment>
                            <comment id="13178777" author="slebresne" created="Tue, 3 Jan 2012 15:27:29 +0000"  >&lt;p&gt;Committed as even if didn&apos;t fixed the issue (which it probably did) it&apos;s an improvement.&lt;/p&gt;</comment>
                            <comment id="13179822" author="tupshin" created="Wed, 4 Jan 2012 20:03:58 +0000"  >&lt;p&gt;Original problem confirmed fixed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12508422" name="3655.txt" size="3780" author="jbellis" created="Thu, 22 Dec 2011 19:37:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>221601</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 46 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gmmn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>95096</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>