<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:43:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6893] Unintended update with conditional statement</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6893</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;After updated to 2.0.6, I have encountered the strange behavior of conditional updates.&lt;/p&gt;

&lt;p&gt;When I executed CQL like UPDATE test SET value = ? WHERE id = ? IF value = ? in concurrent, sometimes cassandra returns true even if value is not satisfied the condition.&lt;/p&gt;

&lt;p&gt;I have attached the program which reproduce this issue. The program works fine in cassandra 2.0.5. But it seems that resets values while execution in 2.0.6.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Ubuntu Precise 64bit / Cassandra 2.0.6&lt;/p&gt;</environment>
        <key id="12702597">CASSANDRA-6893</key>
            <summary>Unintended update with conditional statement</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="snamura">Suguru Namura</reporter>
                        <labels>
                            <label>LWT</label>
                            <label>qa-resolved</label>
                    </labels>
                <created>Thu, 20 Mar 2014 10:14:48 +0000</created>
                <updated>Fri, 25 Oct 2019 13:11:37 +0000</updated>
                            <resolved>Wed, 2 Apr 2014 18:15:39 +0000</resolved>
                                        <fixVersion>2.0.7</fixVersion>
                                    <component>Feature/Lightweight Transactions</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="13941717" author="jbellis" created="Thu, 20 Mar 2014 13:23:27 +0000"  >&lt;p&gt;can you bisect, Michael?&lt;/p&gt;</comment>
                            <comment id="13945818" author="mshuler" created="Mon, 24 Mar 2014 22:49:10 +0000"  >&lt;p&gt;If I understand the test case correctly, I should get (as I do in 2.0.5) a nice clean 1-1000 update series of:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;creating keyspace
creating table
insert default value
APPLIED 1
APPLIED 2
APPLIED 3
  &amp;lt;snip 4-997&amp;gt;
APPLIED 998
APPLIED 999
APPLIED 1000
FINAL VALUE IS 1000
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In 2.0.6, I get random series of 1-X, ending in a random FINAL VALUE.  Using the 2.0.6 and 2.0.5 git tags, this bisects to:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;b09d876914ad9c9fdf1af35cf48cdb98c27bbf32 is the first bad commit
commit b09d876914ad9c9fdf1af35cf48cdb98c27bbf32
Author: Sylvain Lebresne &amp;lt;sylvain@datastax.com&amp;gt;
Date:   Thu Jan 9 18:44:21 2014 +0100

    Add static columns in CQL3
    
    patch by slebresne; reviewed by iamaleksey for CASSANDRA-6561

:100644 100644 4fffb9acefb1fbb9172b5ed99bbeaa0d537b967b bbacc4d83babaf4880ab9f175509dc5fb88d6461 M      CHANGES.txt
:040000 040000 7ac6d76f9b69884c07342eed468327a2da1403ad aa93d5ffb85ce62b3cbe8d6d3e987cd9f147a26e M      doc
:040000 040000 7d15a4bf52f49b432b297a4e22554e40cabb6035 3fcc45ef24616cf2026b84059409a249d65cb9fd M      src
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13945825" author="jbellis" created="Mon, 24 Mar 2014 22:59:12 +0000"  >&lt;p&gt;Thanks, Michael.&lt;/p&gt;</comment>
                            <comment id="13946433" author="slebresne" created="Tue, 25 Mar 2014 12:02:36 +0000"  >&lt;p&gt;Pretty stupid bug, the code was reusing an object it shouldn&apos;t have. Attaching simple fix.&lt;/p&gt;</comment>
                            <comment id="13946598" author="mshuler" created="Tue, 25 Mar 2014 14:25:38 +0000"  >&lt;p&gt;Applied the patch to cassandra-2.0 HEAD and the test case now gives me a clean 1-1000 series.  +1&lt;/p&gt;</comment>
                            <comment id="13946642" author="jbellis" created="Tue, 25 Mar 2014 14:52:35 +0000"  >&lt;p&gt;Can we add a unit and/or dtest?&lt;/p&gt;</comment>
                            <comment id="13946747" author="slebresne" created="Tue, 25 Mar 2014 16:24:14 +0000"  >&lt;p&gt;Actually, we kind of have a dtest already: &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/blob/master/paxos_tests.py&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;paxos_test&lt;/a&gt;. It&apos;s doing something very similar to the java example above. However, it&apos;s running on a relatively modest number of threads so that it isn&apos;t reproducing this bug on my box with the currently hardcoded setting. But if I change said setting to match the ones of the test above, i.e. 1000 threads with 1 iteration each, then it does reproduce.&lt;/p&gt;

&lt;p&gt;So anyway, I modified said test so it runs with both the old parameters, and the new ones, the ones that reproduce this issue (let me note that I did run into &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6923&quot; title=&quot;Fix UnsupportedOperationException on CAS timeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6923&quot;&gt;&lt;del&gt;CASSANDRA-6923&lt;/del&gt;&lt;/a&gt; while reproducing, but that&apos;s a red herring). So anyway, we do have a dtest now.&lt;/p&gt;</comment>
                            <comment id="13947937" author="jbellis" created="Wed, 26 Mar 2014 14:05:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thobbs&quot; class=&quot;user-hover&quot; rel=&quot;thobbs&quot;&gt;thobbs&lt;/a&gt; to review&lt;/p&gt;</comment>
                            <comment id="13957298" author="iamaleksey" created="Wed, 2 Apr 2014 03:22:42 +0000"  >&lt;p&gt;Not able to reproduce on my macbook, neither using modified dtest not &lt;a href=&quot;https://github.com/iamaleksey/castorture&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/iamaleksey/castorture&lt;/a&gt;, with or without the patch, so far. Able to fail the test, but it&apos;s too conservative in its assert - &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; (value == N * I) and (errors == 0) and (gaveup == 0)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;is unrealistic with high enough contention.&lt;/p&gt;</comment>
                            <comment id="13957303" author="iamaleksey" created="Wed, 2 Apr 2014 03:41:18 +0000"  >&lt;p&gt;Not saying there isn&apos;t a bug - haven&apos;t looked at the patch yet - but you shouldn&apos;t expect &quot;a nice clean 1-1000 update&quot; under heavy contention, really.&lt;/p&gt;</comment>
                            <comment id="13957499" author="slebresne" created="Wed, 2 Apr 2014 09:47:03 +0000"  >&lt;p&gt;Fair enough, the test should be handling timeouts. But outside of that, I was wrong when I said that this was a test to reproduce that issue since that issue only happen with prepared statements and the dtest wasn&apos;t using them. So anyway, I pushed a fix of the paxos dtest so that it does uses a prepared statement and properly handles timeouts. The test doesn&apos;t pass on cassandra-2.0 (there is no {{errors}] but the value is incorrect), but does pass with the patch.&lt;/p&gt;</comment>
                            <comment id="13957883" author="iamaleksey" created="Wed, 2 Apr 2014 16:55:21 +0000"  >&lt;p&gt;All right, after switching castorture to use prepared statements was able to repro immediately with default params (w/ 30% of acknowledged writes lost). The attached patch fixes the issue. Reviewing now.&lt;/p&gt;</comment>
                            <comment id="13957923" author="iamaleksey" created="Wed, 2 Apr 2014 17:35:21 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; listAppliesTo(CFMetaData cfm, Iterator&amp;lt;Column&amp;gt; iter, List&amp;lt;ByteBuffer&amp;gt; elements)
        {
            &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (ByteBuffer e : elements)
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!iter.hasNext() || iter.next().value().equals(e))
                    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;should be !iter.next().value().equals(e), I think. Other than that LGTM.&lt;/p&gt;</comment>
                            <comment id="13957975" author="slebresne" created="Wed, 2 Apr 2014 18:15:39 +0000"  >&lt;p&gt;Committed (with added negation in listAppliesTo). Thanks&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12636672" name="6893.txt" size="13505" author="slebresne" created="Tue, 25 Mar 2014 12:02:36 +0000"/>
                            <attachment id="12635761" name="ConcurrentCASUpdate.java" size="3013" author="snamura" created="Thu, 20 Mar 2014 10:14:48 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>380936</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 33 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1tmtb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>381215</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12326170">2.0.6</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aleksey</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12326170">2.0.6</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12311124" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Tester</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>mshuler</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>