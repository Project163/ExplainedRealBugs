<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:39:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-5234] Table created through CQL3 are not accessble to Pig 0.10</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-5234</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Hi,&lt;br/&gt;
  i have faced a bug when creating table through CQL3 and trying to load data through pig 0.10 as follows:&lt;br/&gt;
java.lang.RuntimeException: Column family &apos;abc&apos; not found in keyspace &apos;XYZ&apos;&lt;br/&gt;
	at org.apache.cassandra.hadoop.pig.CassandraStorage.initSchema(CassandraStorage.java:1112)&lt;br/&gt;
	at org.apache.cassandra.hadoop.pig.CassandraStorage.setLocation(CassandraStorage.java:615).&lt;br/&gt;
This effects from Simple table to table with compound key. &lt;/p&gt;</description>
                <environment>&lt;p&gt;Red hat linux 5&lt;/p&gt;</environment>
        <key id="12631394">CASSANDRA-5234</key>
            <summary>Table created through CQL3 are not accessble to Pig 0.10</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="alexliu68">Alex Liu</assignee>
                                    <reporter username="shamim_ru">Shamim Ahmed</reporter>
                        <labels>
                    </labels>
                <created>Fri, 8 Feb 2013 08:13:31 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:18 +0000</updated>
                            <resolved>Fri, 28 Jun 2013 23:09:26 +0000</resolved>
                                        <fixVersion>1.2.7</fixVersion>
                                        <due></due>
                            <votes>4</votes>
                                    <watches>10</watches>
                                                                                                                <comments>
                            <comment id="13574581" author="iamaleksey" created="Fri, 8 Feb 2013 16:12:14 +0000"  >&lt;p&gt;This is not a bug - CQL3 tables are intentionally not included in thrift describe_keyspace(s) (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4377&quot; title=&quot;CQL3 column value validation bug&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4377&quot;&gt;&lt;del&gt;CASSANDRA-4377&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;</comment>
                            <comment id="13574731" author="brandon.williams" created="Fri, 8 Feb 2013 19:03:18 +0000"  >&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4421&quot; title=&quot;Support cql3 table definitions in Hadoop InputFormat&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4421&quot;&gt;&lt;del&gt;CASSANDRA-4421&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13615231" author="cscetbon" created="Wed, 27 Mar 2013 13:15:02 +0000"  >&lt;p&gt;It means that CQL3 column families are not accessible through thrift and for me it&apos;s an issue (I do not agree with your Resolution label). That&apos;s why Pig 0.11 cannot use it. Is there a way to solve it ?&lt;br/&gt;
I can help you if necessary&lt;/p&gt;</comment>
                            <comment id="13655851" author="cscetbon" created="Mon, 13 May 2013 08:48:14 +0000"  >&lt;p&gt;It should be fixed after &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4421&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;CASSANDRA-4421&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13659204" author="alexliu68" created="Thu, 16 May 2013 04:13:50 +0000"  >&lt;p&gt;I will work on it once I am done with other assignments soon.&lt;/p&gt;</comment>
                            <comment id="13659253" author="cscetbon" created="Thu, 16 May 2013 05:44:27 +0000"  >&lt;p&gt;thanks Alex !&lt;/p&gt;</comment>
                            <comment id="13660058" author="alexliu68" created="Thu, 16 May 2013 22:03:13 +0000"  >&lt;p&gt;To fix it, we need modify CassandraStorage to get CF meta data from system table instead of thrift describe_keyspace because of the CQL3 table doesn&apos;t show up in thrift describe_keyspace call.&lt;/p&gt;</comment>
                            <comment id="13670563" author="alexliu68" created="Thu, 30 May 2013 18:24:18 +0000"  >&lt;p&gt;Patch is attached. It&apos;s on top of the 4421 patch&lt;/p&gt;</comment>
                            <comment id="13670577" author="alexliu68" created="Thu, 30 May 2013 18:32:06 +0000"  >&lt;p&gt;pull @ &lt;a href=&quot;https://github.com/alexliu68/cassandra/pull/3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/alexliu68/cassandra/pull/3&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Use CassandraStorage for any cql3 tables, you will have composite columns in &quot;columns&quot; bag&lt;/p&gt;

&lt;p&gt;Use CqlStorage for any cql3 table.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;cassandra:&lt;span class=&quot;code-comment&quot;&gt;//[username:password@]&amp;lt;keyspace&amp;gt;/&amp;lt;columnfamily&amp;gt;[?[page_size=&amp;lt;size&amp;gt;]
&lt;/span&gt;[&amp;amp;columns=&amp;lt;col1,col2&amp;gt;][&amp;amp;output_query=&amp;lt;prepared_statement&amp;gt;]
[&amp;amp;where_clause=&amp;lt;clause&amp;gt;][&amp;amp;split_size=&amp;lt;size&amp;gt;][&amp;amp;partitioner=&amp;lt;partitioner&amp;gt;]]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;where &lt;br/&gt;
  page_size is the number of cql3 rows per page (the default is 1000, it&apos;s optional)&lt;/p&gt;

&lt;p&gt;  columns is the column names for the cql3 select query, it&apos;s optional&lt;/p&gt;

&lt;p&gt;  where_clause is the user defined where clause on the indexed column, it&apos;s optional&lt;/p&gt;

&lt;p&gt;  split_size is the number of C* rows per split which can be used to tune the number of mappers&lt;/p&gt;

&lt;p&gt;  output_query is the prepared query for inserting data to cql3 table (replace the = by @ and ? by #,&lt;br/&gt;
      because Pig can&apos;t take = and ? as url parameter values)&lt;/p&gt;

&lt;p&gt;Output row are in the following format&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;(((name, value), (name, value)), (value ... value), (value...value))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;where the name and value tuples are key name and value pairs.&lt;/p&gt;


&lt;p&gt;The input schema: ((name, value), (name, value), (name, value)) where keys are in the front.&lt;/p&gt;</comment>
                            <comment id="13683122" author="alexliu68" created="Fri, 14 Jun 2013 05:51:18 +0000"  >&lt;p&gt;I attach 5234-1.2-patch.txt to patch 1.2 branch. It update the last patch with the latest 4421 changes.&lt;/p&gt;</comment>
                            <comment id="13683125" author="alexliu68" created="Fri, 14 Jun 2013 05:53:39 +0000"  >&lt;p&gt;The patch resolves the following issues.&lt;/p&gt;

&lt;p&gt;1. allow access to cql3 type table through CassandraStorage.&lt;/p&gt;

&lt;p&gt;2. create new CqlStorage to easy access cql3 tables.&lt;/p&gt;</comment>
                            <comment id="13683236" author="cscetbon" created="Fri, 14 Jun 2013 09:23:41 +0000"  >&lt;p&gt;Do you think I can test them now ?&lt;/p&gt;</comment>
                            <comment id="13683447" author="alexliu68" created="Fri, 14 Jun 2013 15:34:21 +0000"  >&lt;p&gt;yes, I have done some testing.&lt;/p&gt;</comment>
                            <comment id="13683591" author="cscetbon" created="Fri, 14 Jun 2013 17:46:17 +0000"  >&lt;p&gt;Okay, I&apos;ll give it a try &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
thanks&lt;/p&gt;</comment>
                            <comment id="13685565" author="cscetbon" created="Mon, 17 Jun 2013 13:54:00 +0000"  >&lt;p&gt;My Pig script doesn&apos;t work anymore. I suppose you changed the input format ? &lt;br/&gt;
I get :&lt;br/&gt;
Projected field &lt;span class=&quot;error&quot;&gt;&amp;#91;filtre&amp;#93;&lt;/span&gt; does not exist in schema: key:chararray,columns:bag{:tuple(name:tuple(),value:byte array)}&lt;br/&gt;
when column family is created without COMPACT STORAGE&lt;/p&gt;

&lt;p&gt;Something weird is that I get no values when I should get some :&lt;br/&gt;
cqlsh:k1&amp;gt; SELECT * FROM cf1 WHERE ISE=&apos;XXXX&apos;;&lt;/p&gt;

&lt;p&gt; ise  | filtre | value_1&lt;br/&gt;
-----&lt;del&gt;&lt;ins&gt;&lt;/del&gt;------&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;--------&lt;br/&gt;
 XXXX |      1 |   81056&lt;/p&gt;

&lt;p&gt;2013-06-17 13:13:01,372 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; INFO  org.apache.pig.backend.hadoop.executionengine.util.MapRedUtil - Total input paths to process : 1&lt;br/&gt;
(XXXX,&lt;/p&gt;
{((),),((filtre),),((value_1),&amp;lt;?)}
&lt;p&gt;) &amp;lt;-- value not printable for filtre ?&lt;/p&gt;</comment>
                            <comment id="13685649" author="alexliu68" created="Mon, 17 Jun 2013 15:26:55 +0000"  >&lt;p&gt;Can you post your schema for the table and pig script, so I can test it.&lt;/p&gt;</comment>
                            <comment id="13685650" author="cscetbon" created="Mon, 17 Jun 2013 15:31:28 +0000"  >&lt;p&gt;&lt;a href=&quot;http://pastebin.com/Fub9t6j9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://pastebin.com/Fub9t6j9&lt;/a&gt; &amp;lt;-- my column family&lt;br/&gt;
&lt;a href=&quot;http://pastebin.com/HwKxsC4f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://pastebin.com/HwKxsC4f&lt;/a&gt; &amp;lt;-- my pig script&lt;/p&gt;</comment>
                            <comment id="13685660" author="alexliu68" created="Mon, 17 Jun 2013 15:48:01 +0000"  >&lt;p&gt;Can you just dump(data) to check whether you have all the data? Then do the following filter scripts.&lt;/p&gt;</comment>
                            <comment id="13685665" author="cscetbon" created="Mon, 17 Jun 2013 15:57:02 +0000"  >&lt;p&gt;You definitely broke something as I get different results when dumping data for cql2 and cql3 tables (same structure).&lt;br/&gt;
CQL2 : &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;* format is 
x: {key: chararray,value_1: (name: chararray,value: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;),filtre: (name: chararray,value: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;),columns: {(name: chararray,value: bytearray)}}
* rows are
(XXXX,(value_1,18584),(filtre,0),{})
(YYYY,(value_1,49926),(filtre,2),{})
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;CQL3 : &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;* format is 
x: {key: chararray,columns: {(name: (),value: bytearray)}}
* rows are
(XXXX,{((),),((filtre),),((value_1),??)})
(YYYY,{((),),((filtre),),((value_1),??)})
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="13685684" author="alexliu68" created="Mon, 17 Jun 2013 16:25:33 +0000"  >&lt;p&gt;CQL2 has different structure from CQL3, CQL2 is more to the legacy thrift type CF(Check the developer blog from datastax). You should follow the cql3 format to change your pig script. or use CqlStorage for easy data mapping for cql3 type table.&lt;/p&gt;</comment>
                            <comment id="13685687" author="alexliu68" created="Mon, 17 Jun 2013 16:28:20 +0000"  >&lt;p&gt;Use the following script to find the structure of cql3 table, then change your pig script&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;   rows = LOAD &lt;span class=&quot;code-quote&quot;&gt;&apos;cassandra:&lt;span class=&quot;code-comment&quot;&gt;//MyKeyspace/MyColumnFamily&apos;&lt;/span&gt; USING CassandraStorage();
&lt;/span&gt;   dump(rows);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13685703" author="cscetbon" created="Mon, 17 Jun 2013 16:54:02 +0000"  >&lt;p&gt;Great, CqlStorage() helps a lot to get same input.&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="13685973" author="alexliu68" created="Mon, 17 Jun 2013 20:55:20 +0000"  >&lt;p&gt;5234-1-1.2-patch.txt is attached to allow CassandraStorage to pass partitioner as parameter.&lt;/p&gt;</comment>
                            <comment id="13689769" author="alexliu68" created="Thu, 20 Jun 2013 22:28:25 +0000"  >&lt;p&gt;5234-2-1.2branch.txt is attached to use &quot;cql://&quot; instead of &quot;cassandra://&quot; for CqlStorage&lt;/p&gt;</comment>
                            <comment id="13692106" author="brandon.williams" created="Mon, 24 Jun 2013 16:21:55 +0000"  >&lt;p&gt;Hmm, I&apos;m seeing errors when running the examples/pig/test tests that don&apos;t use cql3.&lt;/p&gt;</comment>
                            <comment id="13692329" author="alexliu68" created="Mon, 24 Jun 2013 20:17:48 +0000"  >&lt;p&gt;I will fix it today.&lt;/p&gt;</comment>
                            <comment id="13693385" author="alexliu68" created="Tue, 25 Jun 2013 21:08:23 +0000"  >&lt;p&gt;The failed test is where there is filter for COUNT(columns)&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;-- filter to fully visible rows (no uuid columns) and dump
visible = FILTER rows BY COUNT(columns) == 0;
dump visible;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13693444" author="alexliu68" created="Tue, 25 Jun 2013 22:21:38 +0000"  >&lt;p&gt;It turns out to wide row schema issue which could be an error from previous version.&lt;/p&gt;

&lt;p&gt;5234-3-1.2branch.txt is attached to fixd failing to run examples/pig/test &lt;/p&gt;</comment>
                            <comment id="13694208" author="tharigopla" created="Wed, 26 Jun 2013 20:05:26 +0000"  >&lt;p&gt;@Alex I pulled the branch &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5234&quot; title=&quot;Table created through CQL3 are not accessble to Pig 0.10&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5234&quot;&gt;&lt;del&gt;CASSANDRA-5234&lt;/del&gt;&lt;/a&gt; and tried building it. But the build fails when compiling.&lt;/p&gt;</comment>
                            <comment id="13694214" author="alexliu68" created="Wed, 26 Jun 2013 20:16:11 +0000"  >&lt;p&gt;It works for me.&lt;/p&gt;

&lt;p&gt;try the commands&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;git checkout cassandra-1.2
patch -p1 &amp;lt; 5234-3-1.2branch.txt 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13694266" author="tharigopla" created="Wed, 26 Jun 2013 21:45:02 +0000"  >&lt;p&gt;@Alex: I did check out cassandra-1.2 and tried to apply the patch using &quot;patch -p1 &amp;lt; 5234-3-1.2branch.txt&quot; But it didnt work it threw and exception &amp;lt; is reserveed for future use.&lt;br/&gt;
So, I downloaded the patch 5234-3-1.2branch.txt and did a git apply and then committed the unstaged changes. Now when I browsed the file location cassandra &quot;/ src / java / org / apache / cassandra / hadoop / pig /&quot; the patch is not applied. Sorry for my naive questions, I am very new to git and cassandra.&lt;/p&gt;</comment>
                            <comment id="13694269" author="tharigopla" created="Wed, 26 Jun 2013 21:49:54 +0000"  >&lt;p&gt;The patch is applied. But do I have to worry about the &lt;/p&gt;

&lt;p&gt;5234-3-1.2branch.txt:22: trailing whitespace.&lt;br/&gt;
                partitioner = FBUtilities.newPartitioner(client.describe_partitioner());&lt;br/&gt;
5234-3-1.2branch.txt:735: trailing whitespace.&lt;/p&gt;

&lt;p&gt;5234-3-1.2branch.txt:925: trailing whitespace.&lt;/p&gt;

&lt;p&gt;5234-3-1.2branch.txt:1297: trailing whitespace.&lt;br/&gt;
        }&lt;br/&gt;
5234-3-1.2branch.txt:1321: trailing whitespace.&lt;/p&gt;
</comment>
                            <comment id="13694284" author="brandon.williams" created="Wed, 26 Jun 2013 21:56:52 +0000"  >&lt;p&gt;Committed, and created &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5709&quot; title=&quot;Convert pig example data population to cqlsh&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5709&quot;&gt;&lt;del&gt;CASSANDRA-5709&lt;/del&gt;&lt;/a&gt; for example follow-up.  Thanks!&lt;/p&gt;</comment>
                            <comment id="13694286" author="brandon.williams" created="Wed, 26 Jun 2013 21:57:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tharigopla&quot; class=&quot;user-hover&quot; rel=&quot;tharigopla&quot;&gt;tharigopla&lt;/a&gt; it&apos;s in the 1.2 branch now, just do a git pull.&lt;/p&gt;</comment>
                            <comment id="13694298" author="tharigopla" created="Wed, 26 Jun 2013 22:12:05 +0000"  >&lt;p&gt;Thanks Brandon&lt;/p&gt;</comment>
                            <comment id="13694337" author="alexliu68" created="Wed, 26 Jun 2013 22:58:24 +0000"  >&lt;p&gt;5234-3-trunk.txt patch for trunk branch is attached.&lt;/p&gt;</comment>
                            <comment id="13694821" author="tharigopla" created="Thu, 27 Jun 2013 15:55:43 +0000"  >&lt;p&gt;@Brandon. Thanks for your patience. I did a git pull on 1.2 and ran the build. It fails again.&lt;/p&gt;</comment>
                            <comment id="13694831" author="brandon.williams" created="Thu, 27 Jun 2013 16:09:45 +0000"  >&lt;p&gt;I recommend sending an email to user list with the details, as the 1.2 branch is obviously compiling for everyone and JIRA isn&apos;t a support forum.&lt;/p&gt;</comment>
                            <comment id="13703359" author="shamim_ru" created="Tue, 9 Jul 2013 15:07:24 +0000"  >&lt;p&gt;Hello Alex!&lt;br/&gt;
  I have got error when trying to send where_clause in cqlStorage URL as follows:&lt;br/&gt;
rows = LOAD &apos;cql://keyspace1/test?page_size=1&amp;amp;columns=title,age&amp;amp;split_size=4&amp;amp;where_clause=age=41&apos; USING CqlStorage();&lt;br/&gt;
and haven&apos;t find any way to escape the equal operator.&lt;br/&gt;
  It will be better to send the where_clause with URL encoding, for example where_clause=age%3D41.&lt;br/&gt;
However for a quick fix i have slightly modify the method getQueryMap as follows:&lt;br/&gt;
    /** decompose the query to store the parameters in a map*/&lt;br/&gt;
    public static Map&amp;lt;String, String&amp;gt; getQueryMap(String query) throws Exception&lt;br/&gt;
    {&lt;br/&gt;
        String[] params = query.split(&quot;&amp;amp;&quot;);&lt;br/&gt;
        Map&amp;lt;String, String&amp;gt; map = new HashMap&amp;lt;String, String&amp;gt;();&lt;br/&gt;
        for (String param : params)&lt;/p&gt;
        {
            String[] keyValue = param.split(&quot;=&quot;);
            map.put(keyValue[0], URLDecoder.decode(keyValue[1],&quot;UTF-8&quot;));
			
        }
&lt;p&gt;        return map;&lt;br/&gt;
    }&lt;br/&gt;
and now i can send the query with URL-Encoding character.&lt;/p&gt;</comment>
                            <comment id="13703414" author="alexliu68" created="Tue, 9 Jul 2013 15:55:00 +0000"  >&lt;p&gt;Thx, I will update the patch for it.&lt;/p&gt;</comment>
                            <comment id="13704306" author="shamim_ru" created="Wed, 10 Jul 2013 08:25:32 +0000"  >&lt;p&gt;add the patch as a temporary fix&lt;/p&gt;</comment>
                            <comment id="13713680" author="kkonrad" created="Fri, 19 Jul 2013 14:00:39 +0000"  >&lt;p&gt;I was trying it locally and I&apos;m not sure whether it fully works. My stacktrace and cassandra table schema is here: &lt;a href=&quot;http://pastebin.com/uPUAs9T2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://pastebin.com/uPUAs9T2&lt;/a&gt; (i tried using old cassandra:// ... - it worked for other table) and output when I used cql://.. is here: &lt;a href=&quot;http://pastebin.com/b0bKd7G3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://pastebin.com/b0bKd7G3&lt;/a&gt;   . I have worked on this with Pig in local mode. It might be important or not: this table contained counters.&lt;/p&gt;

&lt;p&gt;I was working on cassandra-1.2 with latest commit 27efded38d855b24f41e5332ffb29cd13d98f8da&lt;/p&gt;</comment>
                            <comment id="13722139" author="xcbsmith" created="Mon, 29 Jul 2013 03:41:49 +0000"  >&lt;p&gt;Just adding that I&apos;m getting the same result as Konrad Kurdej. I&apos;m using DSE 3.1, but I think this is the same bug. I was able to isolate the problem specifically to counter fields. Here&apos;s a simple set up and test case:&lt;/p&gt;

&lt;p&gt;cqlsh&amp;gt; create keyspace pigtest with REPLICATION = &lt;/p&gt;
{ &apos;class&apos;: &apos;SimpleStrategy&apos;, &apos;replication_factor&apos;: 1}
&lt;p&gt;;&lt;br/&gt;
cqlsh&amp;gt; use pigtest;&lt;br/&gt;
cqlsh:pigtest&amp;gt; create table foo ( key_1 text primary key, value_1 bigint );&lt;br/&gt;
cqlsh:pigtest&amp;gt; create table foo2 ( key_1 text primary key, value_1 counter );&lt;br/&gt;
cqlsh:pigtest&amp;gt; update foo set value_1 = 1 where key_1 = &apos;foo&apos;;&lt;br/&gt;
cqlsh:pigtest&amp;gt; update foo2 set value_1 = value_1 + 2 where key_1 = &apos;foo2&apos;;&lt;br/&gt;
cqlsh:pigtest&amp;gt; select * from foo;&lt;/p&gt;

&lt;p&gt; key_1 | value_1&lt;br/&gt;
------&lt;del&gt;+&lt;/del&gt;--------&lt;br/&gt;
   foo |       1&lt;/p&gt;

&lt;p&gt;cqlsh:pigtest&amp;gt; select * from foo2;&lt;/p&gt;

&lt;p&gt; key_1 | value_1&lt;br/&gt;
------&lt;del&gt;+&lt;/del&gt;--------&lt;br/&gt;
  foo2 |       2&lt;/p&gt;

&lt;p&gt;Now, the following grunt commands:&lt;/p&gt;

&lt;p&gt;counts = LOAD &apos;cassandra://pigtest/foo&apos; USING CassandraStorage();&lt;br/&gt;
dump counts;&lt;/p&gt;

&lt;p&gt;Will work, but:&lt;/p&gt;

&lt;p&gt;counts = LOAD &apos;cassandra://pigtest/foo2&apos; USING CassandraStorage();&lt;br/&gt;
dump counts;&lt;/p&gt;

&lt;p&gt;Will fail with the same stack trace that Konrad mentioned.&lt;/p&gt;</comment>
                            <comment id="13722500" author="xcbsmith" created="Mon, 29 Jul 2013 14:33:30 +0000"  >&lt;p&gt;This patch against the head appears to have fixed the problem for me. I applied it to DSE 3.1 and it also worked for me.&lt;/p&gt;

&lt;p&gt;Basic deal is to use LongType for validation too.&lt;/p&gt;</comment>
                            <comment id="13722717" author="alexliu68" created="Mon, 29 Jul 2013 17:47:31 +0000"  >&lt;p&gt;Use CqlStorage for your use case. CassandraStorage has some drawbacks.&lt;/p&gt;</comment>
                            <comment id="13722751" author="alexliu68" created="Mon, 29 Jul 2013 18:06:51 +0000"  >&lt;p&gt;CassandraStorage is legacy for any none-CQL3 tables. Use CqlStorage for CQL3 tables.&lt;/p&gt;</comment>
                            <comment id="13723264" author="marcostrama" created="Tue, 30 Jul 2013 01:55:21 +0000"  >&lt;p&gt;Cassandra 1.2.8 was released (after regression in 1.2.7), but this last patch for counters appears to be left. Anyone can confirm this?&lt;/p&gt;

&lt;p&gt;I downloaded the .deb from &lt;a href=&quot;http://people.apache.org/~eevans/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://people.apache.org/~eevans/&lt;/a&gt; but when in grunt i dump a table with counter column, get the error:&lt;/p&gt;

&lt;p&gt;java.lang.IndexOutOfBoundsException&lt;br/&gt;
	at java.nio.Buffer.checkIndex(Buffer.java:537)&lt;br/&gt;
	at java.nio.HeapByteBuffer.getLong(HeapByteBuffer.java:410)&lt;br/&gt;
	at org.apache.cassandra.db.context.CounterContext.total(CounterContext.java:477)&lt;br/&gt;
	at org.apache.cassandra.db.marshal.AbstractCommutativeType.compose(AbstractCommutativeType.java:34)&lt;br/&gt;
	at org.apache.cassandra.db.marshal.AbstractCommutativeType.compose(AbstractCommutativeType.java:25)&lt;br/&gt;
	at org.apache.cassandra.hadoop.pig.AbstractCassandraStorage.columnToTuple(AbstractCassandraStorage.java:137)&lt;br/&gt;
	at org.apache.cassandra.hadoop.pig.CqlStorage.getNext(CqlStorage.java:110)&lt;br/&gt;
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigRecordReader.nextKeyValue(PigRecordReader.java:211)&lt;br/&gt;
	at org.apache.hadoop.mapred.MapTask$NewTrackingRecordReader.nextKeyValue(MapTask.java:532)&lt;br/&gt;
	at org.apache.hadoop.mapreduce.MapContext.nextKeyValue(MapContext.java:67)&lt;br/&gt;
	at org.apache.hadoop.mapreduce.Mapper.run(Mapper.java:143)&lt;br/&gt;
	at org.apache.hadoop.mapred.MapTask.runNewMapper(MapTask.java:764)&lt;br/&gt;
	at org.apache.hadoop.mapred.MapTask.run(MapTask.java:370)&lt;br/&gt;
	at org.apache.hadoop.mapred.Child$4.run(Child.java:255)&lt;br/&gt;
	at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
	at javax.security.auth.Subject.doAs(Subject.java:416)&lt;br/&gt;
	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1149)&lt;br/&gt;
	at org.apache.hadoop.mapred.Child.main(Child.java:249)&lt;/p&gt;

&lt;p&gt;My table:&lt;br/&gt;
cqlsh:test&amp;gt; desc table votes_count_period3;&lt;/p&gt;

&lt;p&gt;CREATE TABLE votes_count_period3 (&lt;br/&gt;
  period text,&lt;br/&gt;
  poll timeuuid,&lt;br/&gt;
  votes counter,&lt;br/&gt;
  PRIMARY KEY (period, poll)&lt;br/&gt;
) WITH&lt;br/&gt;
  bloom_filter_fp_chance=0.010000 AND&lt;br/&gt;
  caching=&apos;KEYS_ONLY&apos; AND&lt;br/&gt;
  comment=&apos;&apos; AND&lt;br/&gt;
  dclocal_read_repair_chance=0.000000 AND&lt;br/&gt;
  gc_grace_seconds=864000 AND&lt;br/&gt;
  read_repair_chance=0.100000 AND&lt;br/&gt;
  replicate_on_write=&apos;true&apos; AND&lt;br/&gt;
  populate_io_cache_on_flush=&apos;false&apos; AND&lt;br/&gt;
  compaction=&lt;/p&gt;
{&apos;class&apos;: &apos;SizeTieredCompactionStrategy&apos;}
&lt;p&gt; AND&lt;br/&gt;
  compression=&lt;/p&gt;
{&apos;sstable_compression&apos;: &apos;SnappyCompressor&apos;}
&lt;p&gt;;&lt;/p&gt;
</comment>
                            <comment id="13723293" author="marcostrama" created="Tue, 30 Jul 2013 02:20:01 +0000"  >&lt;p&gt;I confirmed this issue. I downloaded the src, applied the patch and after build the cassandra jar, pig works with counter. This will be patched in 1.2.9?&lt;/p&gt;</comment>
                            <comment id="13723348" author="alexliu68" created="Tue, 30 Jul 2013 03:31:27 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13723395" author="xcbsmith" created="Tue, 30 Jul 2013 04:40:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=alexliu68&quot; class=&quot;user-hover&quot; rel=&quot;alexliu68&quot;&gt;alexliu68&lt;/a&gt; The patch is to the base class shared by CqlStorage and CassandraStorage. They were both broken and they are now both fixed.&lt;/p&gt;</comment>
                            <comment id="13759299" author="jlemire" created="Thu, 5 Sep 2013 18:35:48 +0000"  >&lt;p&gt;The last patch for counters to AbstractCassandraStorage.java has not been applied either to cassandra-1.2 or to the trunk. Consequently, the problem still exists in 1.2.9, as I could verify myself today. I found another recent bug report on SO for the same problem: &lt;a href=&quot;http://stackoverflow.com/questions/18553230/error-with-cassandra-pig-cql-counter-column&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/questions/18553230/error-with-cassandra-pig-cql-counter-column&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Should I open a new bug report for the counters bug even though we have a working patch or will you reopen the current issue?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12588405" name="5234-1-1.2-patch.txt" size="95801" author="alexliu68" created="Tue, 18 Jun 2013 16:13:27 +0000"/>
                            <attachment id="12587782" name="5234-1.2-patch.txt" size="95460" author="alexliu68" created="Fri, 14 Jun 2013 05:57:01 +0000"/>
                            <attachment id="12588946" name="5234-2-1.2branch.txt" size="95777" author="alexliu68" created="Thu, 20 Jun 2013 22:28:25 +0000"/>
                            <attachment id="12589677" name="5234-3-1.2branch.txt" size="98619" author="alexliu68" created="Tue, 25 Jun 2013 22:19:42 +0000"/>
                            <attachment id="12589811" name="5234-3-trunk.txt" size="100663" author="alexliu68" created="Wed, 26 Jun 2013 23:06:12 +0000"/>
                            <attachment id="12585444" name="5234.tx" size="91548" author="alexliu68" created="Thu, 30 May 2013 18:24:18 +0000"/>
                            <attachment id="12591607" name="fix_where_clause.patch" size="3216" author="shamim_ru" created="Wed, 10 Jul 2013 08:24:47 +0000"/>
                            <attachment id="12594708" name="pigCounter-patch.txt" size="803" author="xcbsmith" created="Mon, 29 Jul 2013 14:33:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[alexliu68]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>311890</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 11 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1hton:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>312236</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>brandon.williams</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>