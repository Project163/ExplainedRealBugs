<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:18:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-1316] Read repair does not always work correctly</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-1316</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Read repair does not always work.  At the least, we allow violation of the CL.ALL contract.  To reproduce, create a three node cluster with RF=3, and json2sstable one of the attached json files on each node.  This creates a row whose key is &apos;test&apos; with 9 columns, but only 3 columns are on each machine.  If you get_count this row in quick succession at CL.ALL, sometimes you will receive a count of 6, sometimes 9.  After the ReadRepairManager has sent the repairs, you will always get 9, which is the desired behavior.&lt;/p&gt;

&lt;p&gt;I have another data set obtained in the wild which never fully repairs for some reason, but it&apos;s a bit large to attach (600ish columns per machine.)  I&apos;m still trying to figure out why RR isn&apos;t working on this set, but I always get different results when reading at any CL including ALL, no matter how long I wait or how many reads I do.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12470095">CASSANDRA-1316</key>
            <summary>Read repair does not always work correctly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="brandon.williams">Brandon Williams</assignee>
                                    <reporter username="brandon.williams">Brandon Williams</reporter>
                        <labels>
                    </labels>
                <created>Sat, 24 Jul 2010 23:50:59 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:20 +0000</updated>
                            <resolved>Tue, 27 Jul 2010 16:47:29 +0000</resolved>
                                        <fixVersion>0.6.4</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="12892048" author="brandon.williams" created="Sat, 24 Jul 2010 23:53:27 +0000"  >&lt;p&gt;I tried to bisect this issue and went as far back as 0.4.2 without finding a successful version.  I will see if the data that never repairs can be scrubbed so I can attach it to this ticket for debugging.&lt;/p&gt;</comment>
                            <comment id="12892049" author="brandon.williams" created="Sun, 25 Jul 2010 00:02:56 +0000"  >&lt;p&gt;It looks like the key difference between the real data and the toy data that is attached is that the real data has the key in multiple sstables.  If left this way, RR never fully works, but if I force a compaction then it succeeds.&lt;/p&gt;</comment>
                            <comment id="12892142" author="brandon.williams" created="Sun, 25 Jul 2010 20:18:00 +0000"  >&lt;p&gt;Updated json files illustrate one possible scenario:  nodes 1 and 2 have a column, and node 3 has the column tombstoned with the same timestamp.  It looks like tombstones aren&apos;t taking precedence.&lt;/p&gt;</comment>
                            <comment id="12892328" author="brandon.williams" created="Mon, 26 Jul 2010 15:24:56 +0000"  >&lt;p&gt;Patch to solve one problem: use derterminBlockFor to set the correct response count passed to RRR, so CL.ALL works.&lt;/p&gt;</comment>
                            <comment id="12892340" author="jbellis" created="Mon, 26 Jul 2010 16:08:39 +0000"  >&lt;p&gt;v2 updates QRH arguments to use responseCount as well, even though it&apos;s ignored&lt;/p&gt;</comment>
                            <comment id="12892503" author="brandon.williams" created="Mon, 26 Jul 2010 22:11:05 +0000"  >&lt;p&gt;Committed RRRv2.&lt;/p&gt;</comment>
                            <comment id="12892616" author="jbellis" created="Tue, 27 Jul 2010 02:41:56 +0000"  >&lt;p&gt;patch that simplifies debugging by removing ReadRepairManager which is mostly 100-odd lines of obfuscation around MessagingService.sendOneWay.  (backport from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1077&quot; title=&quot;clean up ExpiringMap&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1077&quot;&gt;&lt;del&gt;CASSANDRA-1077&lt;/del&gt;&lt;/a&gt; which was applied to trunk two months ago)&lt;/p&gt;</comment>
                            <comment id="12892847" author="jbellis" created="Tue, 27 Jul 2010 16:47:29 +0000"  >&lt;p&gt;Brandon&apos;s first patch fixing reads at CL.ALL turns out to be the only bug.  The rest is obscure-but-valid behavior when expired tombstones haven&apos;t been replicated across the cluster (i.e., the tombstones exist on some nodes, but not all).  Let me give an example:&lt;/p&gt;

&lt;p&gt;say node A has columns x and y, where x is an expired tombstone with timestamp T1, and node B has live column x, at time T2 where T2 &amp;lt; T1.&lt;/p&gt;

&lt;p&gt;if you read at ALL you will see x from B and y from A.  you will &lt;em&gt;not&lt;/em&gt; see x from A &amp;#8211; since it is expired, it is no longer relevant off-node.  thus, the ALL read will send a repair of column x to A, since it was &quot;missing.&quot;&lt;/p&gt;

&lt;p&gt;But next time you read from A the tombstone will supress the newly-written copy of x-from-B still, because its timestamp is higher.  So the replicas won&apos;t converge.&lt;/p&gt;

&lt;p&gt;This is not a bug, because the design explicitly allows that behavior when tombstones expire before being propagated to all nodes; see &lt;a href=&quot;http://wiki.apache.org/cassandra/DistributedDeletes&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://wiki.apache.org/cassandra/DistributedDeletes&lt;/a&gt;.  The best way to avoid this of course is to run repair frequently enough to ensure that tombstones are propagated within GCGraceSeconds of being written.&lt;/p&gt;

&lt;p&gt;But if you do find yourself in this situation, you have two options to get things to converge again:&lt;/p&gt;

&lt;p&gt;1) the simplest option is to simply perform a major compaction on each node, which will eliminate all expired tombstones.&lt;/p&gt;

&lt;p&gt;2) but if you want to propagate as many of the tombstones as possible first, increase your GCGraceSeconds setting everywhere (requires rolling restart), and perform a full repair as described in &lt;a href=&quot;http://wiki.apache.org/cassandra/Operations&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://wiki.apache.org/cassandra/Operations&lt;/a&gt;.  After the repair is complete you can put GCGraceSeconds back to what it was.&lt;/p&gt;</comment>
                            <comment id="12970427" author="hudson" created="Sat, 11 Dec 2010 07:35:22 +0000"  >&lt;p&gt;Integrated in Cassandra-0.7 #70 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Cassandra-0.7/70/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hudson.apache.org/hudson/job/Cassandra-0.7/70/&lt;/a&gt;)&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12450474" name="001_correct_responsecount_in_RRR.txt" size="1118" author="brandon.williams" created="Mon, 26 Jul 2010 15:24:56 +0000"/>
                            <attachment id="12450552" name="1316-RRM.txt" size="7059" author="jbellis" created="Tue, 27 Jul 2010 02:41:56 +0000"/>
                            <attachment id="12450479" name="RRR-v2.txt" size="2756" author="jbellis" created="Mon, 26 Jul 2010 16:08:39 +0000"/>
                            <attachment id="12450423" name="cassandra-1.json" size="110" author="brandon.williams" created="Sun, 25 Jul 2010 20:15:09 +0000"/>
                            <attachment id="12450424" name="cassandra-2.json" size="110" author="brandon.williams" created="Sun, 25 Jul 2010 20:15:10 +0000"/>
                            <attachment id="12450425" name="cassandra-3.json" size="110" author="brandon.williams" created="Sun, 25 Jul 2010 20:15:10 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20077</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 50 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0g4bb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>92129</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>