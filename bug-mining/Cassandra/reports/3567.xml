<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:53:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-9334] Returning null from a trigger does not abort the write</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-9334</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;The javadoc for ITrigger seems to indicate that returning null means no mutations for the write will be applied at all:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;     * Called exactly once per CF update, returned mutations are atomically updated.
     *
     * @param key - Row Key for the update.
     * @param update - Update received for the CF
     * @return modifications to be applied, null if no action to be performed.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and indeed, TriggerExecutor.execute seems to have code for this:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;        if (augmentedMutations == null)
            return null;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;but it never fires.  In testing with a trigger that always returns null, the original mutation is still applied.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12828375">CASSANDRA-9334</key>
            <summary>Returning null from a trigger does not abort the write</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="samt">Sam Tunnicliffe</assignee>
                                    <reporter username="brandon.williams">Brandon Williams</reporter>
                        <labels>
                    </labels>
                <created>Fri, 8 May 2015 14:49:51 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:12 +0000</updated>
                            <resolved>Tue, 19 May 2015 11:14:22 +0000</resolved>
                                        <fixVersion>2.0.16</fixVersion>
                    <fixVersion>2.1.6</fixVersion>
                    <fixVersion>2.2.0 beta 1</fixVersion>
                                    <component>Legacy/Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14534813" author="beobal" created="Fri, 8 May 2015 16:19:27 +0000"  >&lt;p&gt;Well, it&apos;s been this way since triggers were introduced. The initial implementation of &lt;tt&gt;StorageProxy#mutateWithTriggers&lt;/tt&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void mutateWithTriggers(Collection&amp;lt;? &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; IMutation&amp;gt; mutations, ConsistencyLevel consistencyLevel, &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; mutateAtomically) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; WriteTimeoutException, UnavailableException,
        OverloadedException, InvalidRequestException
{
    Collection&amp;lt;RowMutation&amp;gt; tmutations = TriggerExecutor.instance.execute(mutations);
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (mutateAtomically || tmutations != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
    {
        Collection&amp;lt;RowMutation&amp;gt; allMutations = (Collection&amp;lt;RowMutation&amp;gt;) mutations;
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (tmutations != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
            allMutations.addAll(tmutations);
        StorageProxy.mutateAtomically(allMutations, consistencyLevel);
    }
    &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;
    {
        StorageProxy.mutate(mutations, consistencyLevel);
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So I would say it&apos;s a bug in the javadoc. &lt;br/&gt;
Do you think it&apos;s a valid use case to be able to abort the entire mutation via a trigger?&lt;/p&gt;</comment>
                            <comment id="14534817" author="brandon.williams" created="Fri, 8 May 2015 16:23:08 +0000"  >&lt;p&gt;I can think of a few instances where it could be useful.  For instance, if you want to run a multi-tenant cluster where you don&apos;t necessarily control the applications, but you want to forbid a &apos;badwords&apos; list in any field.  Or your trigger takes some action and if that fails, you want the write to fail as well.  I guess to do this properly though we&apos;d need to let augment throw IRE or something back to the client and break the interface in 3.x.&lt;/p&gt;</comment>
                            <comment id="14534830" author="beobal" created="Fri, 8 May 2015 16:28:20 +0000"  >&lt;p&gt;I agree&lt;/p&gt;</comment>
                            <comment id="14540041" author="beobal" created="Tue, 12 May 2015 15:32:36 +0000"  >&lt;p&gt;Now that &lt;tt&gt;CassandraException&lt;/tt&gt; is unchecked, in trunk you can get the result you&apos;re describing simply by throwing IRE from a trigger impl. We could go further and add a trigger-specific exception and CQL status code, but it might be better not to have details about triggers leak into the native protocol yet. &lt;/p&gt;

&lt;p&gt;That leaves the other scenario, as alluded to by the &lt;tt&gt;ITrigger&lt;/tt&gt; javadoc, where we want to silently drop the mutation. I suggest we defer for now and open a new JIRA for that if &amp;amp; when somebody needs it.&lt;/p&gt;</comment>
                            <comment id="14540042" author="beobal" created="Tue, 12 May 2015 15:33:12 +0000"  >&lt;p&gt;I&apos;ve attached a couple of trivial patches, the first is against 2.0 to fix up the javadoc and the second against trunk to add a test verifying the current behaviour on throwing an exception from &lt;tt&gt;ITrigger#execute&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="14540575" author="brandon.williams" created="Tue, 12 May 2015 19:46:03 +0000"  >&lt;p&gt;LGTM, +1&lt;/p&gt;</comment>
                            <comment id="14550244" author="beobal" created="Tue, 19 May 2015 11:14:22 +0000"  >&lt;p&gt;Committed the doc fix 2.0 in 37d81b9dcb08dd8c16a560591f46481b5d316841 and merged upwards.&lt;br/&gt;
Also, committed the new test to 2.2 in 86c9c00e98a1867deff3b8acc883d224b532197b with a tiny modification; The &lt;tt&gt;TriggerExecutor#executeInternal&lt;/tt&gt; catch any exception and wraps it in a &lt;tt&gt;RuntimeException&lt;/tt&gt;, so the catch block in the new test wasn&apos;t hit, though the check that the mutations are not applied is fine. That catch in &lt;tt&gt;TriggerExecutor&lt;/tt&gt; is too broad now that &lt;tt&gt;CassandraException&lt;/tt&gt; is a &lt;tt&gt;RuntimeException&lt;/tt&gt;, so I&apos;ve opened &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9421&quot; title=&quot;TriggerExecutor should not wrap all execution exceptions in a RuntimeException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9421&quot;&gt;&lt;del&gt;CASSANDRA-9421&lt;/del&gt;&lt;/a&gt; to have it handle CE better.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12732260" name="9334-2.0.txt" size="4438" author="samt" created="Tue, 12 May 2015 15:33:12 +0000"/>
                            <attachment id="12732259" name="9334-test-trunk.txt" size="2530" author="samt" created="Tue, 12 May 2015 15:33:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[samt]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 27 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ehdz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>brandon.williams</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>