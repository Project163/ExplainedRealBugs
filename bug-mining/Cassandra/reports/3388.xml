<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:51:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-8767] &quot;Added column does not sort as the last column&quot; when using new python driver</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-8767</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;We&apos;ve just upgraded one of our python apps from using the old cql library to the new python-driver. When running one particular query, it produces the attached assertion error in Cassandra. The query is: &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;SELECT buffer, id, type, json FROM events WHERE buffer = %(bid)s AND idkey = %(idkey)s ORDER BY id ASC&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Where buffer and idkey are integer primary keys, and id is the clustering key (ordered asc).&lt;/p&gt;

&lt;p&gt;This query, with identical parameters, does not cause this error using the old cql python library, or with the cqlsh client..&lt;/p&gt;</description>
                <environment>&lt;p&gt;Cassandra 2.0.10, python-driver 2.1.3&lt;/p&gt;</environment>
        <key id="12773540">CASSANDRA-8767</key>
            <summary>&quot;Added column does not sort as the last column&quot; when using new python driver</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thobbs">Tom Hobbs</assignee>
                                    <reporter username="russ">Russ Garrett</reporter>
                        <labels>
                            <label>qa-resolved</label>
                    </labels>
                <created>Mon, 9 Feb 2015 19:03:01 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:21 +0000</updated>
                            <resolved>Wed, 18 Feb 2015 17:38:44 +0000</resolved>
                                        <fixVersion>2.0.13</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14318421" author="philipthompson" created="Thu, 12 Feb 2015 15:50:47 +0000"  >&lt;p&gt;Can you print out the schema of the table? The output of &lt;tt&gt;DESCRIBE TABLE&lt;/tt&gt; from cqlsh, please. I will try to reproduce in 2.0.10, and see if it is still happening in 2.0.12.&lt;/p&gt;</comment>
                            <comment id="14318425" author="russ" created="Thu, 12 Feb 2015 15:53:51 +0000"  >&lt;p&gt;Thanks - table description attached.&lt;/p&gt;

&lt;p&gt;We&apos;re going to try and get our cluster upgraded to 2.0.12 shortly, but there didn&apos;t seem to be anything particularly promising in the changelog relating to this.&lt;/p&gt;</comment>
                            <comment id="14318439" author="thobbs" created="Thu, 12 Feb 2015 16:05:20 +0000"  >&lt;p&gt;In the meantime, you should be able to work around this by disabling paging (at least for this query) through the driver.  Neither cqlsh (in Cassandra 2.0) nor the old cql python library have paging, which is why you&apos;re not seeing the problem there.&lt;/p&gt;

&lt;p&gt;You can either disable paging &lt;a href=&quot;http://datastax.github.io/python-driver/api/cassandra/cluster.html#cassandra.cluster.Session.default_fetch_size&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;for the whole session&lt;/a&gt; or for &lt;a href=&quot;http://datastax.github.io/python-driver/api/cassandra/query.html#cassandra.query.Statement.fetch_size&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;the specific query&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14318483" author="philipthompson" created="Thu, 12 Feb 2015 16:24:21 +0000"  >&lt;p&gt;I&apos;m having trouble reproducing this. What fetch size are you using on the driver, the default? How large are your partitions, in cql rows?&lt;/p&gt;</comment>
                            <comment id="14318492" author="russ" created="Thu, 12 Feb 2015 16:27:39 +0000"  >&lt;p&gt;Fetch size would be the default. The partition sizes are quite variable - usually between 2000 and 20000 cql rows (which are each several hundred bytes in size uncompressed).&lt;/p&gt;</comment>
                            <comment id="14318525" author="philipthompson" created="Thu, 12 Feb 2015 16:50:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thobbs&quot; class=&quot;user-hover&quot; rel=&quot;thobbs&quot;&gt;thobbs&lt;/a&gt;, I wrote a dtest for this at &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/compare/8767&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/riptano/cassandra-dtest/compare/8767&lt;/a&gt; but it isn&apos;t reproducing. I&apos;ve tried different fetch sizes, different partition counts and sizes.&lt;/p&gt;</comment>
                            <comment id="14318570" author="russ" created="Thu, 12 Feb 2015 17:12:24 +0000"  >&lt;p&gt;Philip: this error is raised while iterating over the results of the query - not at the execute stage - so I don&apos;t think that test would trigger it on our system either.&lt;/p&gt;

&lt;p&gt;I haven&apos;t managed to reproduce it with a trivial amount of data on my development system, so there does seem to be a certain critical amount of data which needs to be hit to cause it.&lt;/p&gt;</comment>
                            <comment id="14318581" author="philipthompson" created="Thu, 12 Feb 2015 17:24:54 +0000"  >&lt;p&gt;I made an update that pulls all of the pages, still no repro yet.&lt;/p&gt;</comment>
                            <comment id="14318584" author="russ" created="Thu, 12 Feb 2015 17:27:03 +0000"  >&lt;p&gt;One other possibility is that you&apos;re not using LeveledCompactionStrategy - I&apos;m not familiar with the code so I have no idea whether that could make any difference.&lt;/p&gt;</comment>
                            <comment id="14320914" author="thobbs" created="Fri, 13 Feb 2015 22:54:48 +0000"  >&lt;p&gt;I&apos;m also unable to reproduce this or figure out what might be breaking by looking through the source code.  This looks the same as &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7867&quot; title=&quot;Added column does not sort as the last column&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7867&quot;&gt;&lt;del&gt;CASSANDRA-7867&lt;/del&gt;&lt;/a&gt;, where we also had no luck reproducing.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=russ&quot; class=&quot;user-hover&quot; rel=&quot;russ&quot;&gt;russ&lt;/a&gt; if I posted a patch that gave a more informative error message, would you be willing to apply it and try to reproduce again?&lt;/p&gt;</comment>
                            <comment id="14320924" author="russ" created="Fri, 13 Feb 2015 23:03:08 +0000"  >&lt;p&gt;Yes, although my preference would probably be to update to 2.0.12 first so it might take a little while for me to get it running.&lt;/p&gt;</comment>
                            <comment id="14320970" author="thobbs" created="Fri, 13 Feb 2015 23:29:10 +0000"  >&lt;p&gt;Okay, the attached file 8767-debug-logging.txt will log some info at ERROR level if this condition is hit.  The patch should apply to cassandra-2.0.10 or cassandra-2.0.12, so feel free to apply it whenever you&apos;d like.&lt;/p&gt;

&lt;p&gt;To apply it and build a new jar, do the following:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;git checkout cassandra-2.0.12
patch -p1 &amp;lt; 8767-debug-logging.txt
ant
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You should be able to drop the jar from that build into your normal environment.  Let me know if you have any questions.&lt;/p&gt;</comment>
                            <comment id="14324176" author="russ" created="Tue, 17 Feb 2015 13:41:37 +0000"  >&lt;p&gt;OK, I upgraded to 2.0.12 and applied the patch, and the resulting logging is attached.&lt;/p&gt;</comment>
                            <comment id="14324503" author="thobbs" created="Tue, 17 Feb 2015 17:26:10 +0000"  >&lt;p&gt;Thanks, that provides some insight.  It&apos;s adding the cell (&amp;lt;int-value&amp;gt;, &quot;json&quot;) after (&amp;lt;int-value&amp;gt;, &quot;type&quot;) with the same value for &amp;lt;int-value&amp;gt;.  The comparator for this schema includes a UTF8Type component at the end for the column name (and it&apos;s always in normal sorting order), so &quot;json&quot; should come before &quot;type&quot;.&lt;/p&gt;

&lt;p&gt;I was able to reproduce this with a multi-node cluster, so this is happening somewhere that the single-node path doesn&apos;t trigger.&lt;/p&gt;</comment>
                            <comment id="14324681" author="thobbs" created="Tue, 17 Feb 2015 19:02:53 +0000"  >&lt;p&gt;It looks like the root of the problem is that ColumnFamily serialization doesn&apos;t include a &lt;tt&gt;reversed&lt;/tt&gt; flag.  When the query is executed locally, the &lt;tt&gt;reversed&lt;/tt&gt; flag is set on the CF holding the results.  When it&apos;s executed remotely and then deserialized, it&apos;s not.  The &lt;tt&gt;reversed&lt;/tt&gt; flag is then used to alter the comparator for adding cells to the CF.  This causes the comparator to be incorrect for the remote-execution case, leading to the assertion error.&lt;/p&gt;</comment>
                            <comment id="14325661" author="slebresne" created="Wed, 18 Feb 2015 09:48:06 +0000"  >&lt;p&gt;While serializing the &lt;tt&gt;reversed&lt;/tt&gt; flag could maybe make sense (I say maybe because in practice we are serializing cells in (non-reversed) comparator order, so we&apos;d have to handle deserialization specially if we were doing that, which may not be an improvement (but I can agree the way we handle reversed queries is weird)), I don&apos;t think it&apos;s practical option. But as the CF on which this happen in the paging code is a shallow clone in the first place, and pager knows if it&apos;s a reversed query or not, I think we can just clone with the proper insertion order flag. Attaching trivial patch to show what I mean (untested and without tests, we should push the test you&apos;ve been using as dtest).&lt;/p&gt;</comment>
                            <comment id="14326241" author="thobbs" created="Wed, 18 Feb 2015 17:37:48 +0000"  >&lt;p&gt;I came up with an &lt;a href=&quot;https://github.com/thobbs/cassandra/commit/1af016a34af8d7258cd67b362fea73ebe69f919d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;identical patch&lt;/a&gt; yesterday.  It does fix the problem and doesn&apos;t break any paging tests.  I also pushed my &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/commit/08dad2fb575898b4a6a1bd9d43068093beff10d3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest test case&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I&apos;m a little worried that there may be other, similarly subtle breakage around how reversed CFs are handled, but since we haven&apos;t seen them yet and this fixes a known problem, +1 and committed.&lt;/p&gt;</comment>
                            <comment id="14329233" author="aboudreault" created="Fri, 20 Feb 2015 17:38:23 +0000"  >&lt;p&gt;Tested and LGTM. Thanks!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12738786">CASSANDRA-7867</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12698849" name="8767-debug-logging.txt" size="2075" author="thobbs" created="Fri, 13 Feb 2015 23:29:10 +0000"/>
                            <attachment id="12699450" name="8767.patch" size="2413" author="slebresne" created="Wed, 18 Feb 2015 09:48:18 +0000"/>
                            <attachment id="12698451" name="describe-table.txt" size="697" author="russ" created="Thu, 12 Feb 2015 15:52:54 +0000"/>
                            <attachment id="12699258" name="exception-with-logging.txt" size="2887" author="russ" created="Tue, 17 Feb 2015 13:41:37 +0000"/>
                            <attachment id="12697539" name="exception.txt" size="2380" author="russ" created="Mon, 9 Feb 2015 19:03:01 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thobbs]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 39 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i25do7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12327164">2.0.10</customfieldvalue>
    <customfieldvalue id="12328860">2.0.12</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>thobbs</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thobbs]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311124" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Tester</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aboudreault</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>