<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:51:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-8739] Don&apos;t check for overlap with sstables that have had their start positions moved in LCS</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-8739</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;When picking compaction candidates in LCS, we check that we won&apos;t cause any overlap in the higher level. Problem is that we compare the files that have had their start positions moved meaning we can cause overlap. We need to also include the tmplink files when checking this.&lt;/p&gt;

&lt;p&gt;Note that in 2.1 overlap is not as big problem as earlier, if adding an sstable would cause overlap, we send it back to L0 instead, meaning we do a bit more compaction but we never actually have overlap.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12772443">CASSANDRA-8739</key>
            <summary>Don&apos;t check for overlap with sstables that have had their start positions moved in LCS</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="marcuse">Marcus Eriksson</assignee>
                                    <reporter username="marcuse">Marcus Eriksson</reporter>
                        <labels>
                            <label>lcs</label>
                    </labels>
                <created>Wed, 4 Feb 2015 18:12:40 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:21 +0000</updated>
                            <resolved>Mon, 23 Mar 2015 08:33:28 +0000</resolved>
                                        <fixVersion>2.1.5</fixVersion>
                                    <component>Local/Compaction</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14306145" author="benedict" created="Wed, 4 Feb 2015 22:43:08 +0000"  >&lt;p&gt;I assume this is another race condition problem, because we shouldn&apos;t be able to compact any files that have had their starts moved? The only way it should be a problem is if we abort, and then mark compacting based on the starts during the move?&lt;/p&gt;

&lt;p&gt;For &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8689&quot; title=&quot;Assertion error in 2.1.2: ERROR [IndexSummaryManager:1]&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8689&quot;&gt;&lt;del&gt;CASSANDRA-8689&lt;/del&gt;&lt;/a&gt; I intend to make it so we only permit markCompacting to succeed on sstables in the live set. I&apos;m tempted to make it only succeed if the &lt;em&gt;exact instance&lt;/em&gt; is the one in the live set, so that if you&apos;re looking at a stale copy of the file (i.e. one with moved starts) you fail, and reselect your candidates. Would this solve this problem? &lt;/p&gt;</comment>
                            <comment id="14307153" author="krummas" created="Thu, 5 Feb 2015 12:43:42 +0000"  >&lt;p&gt;What I meant was that when we pick compaction candidates, we make sure that we don&apos;t cause overlap in the next level by checking the boundaries of the currently compacting sstables.&lt;/p&gt;

&lt;p&gt;The issue is smaller than I first thought though, since DataTracker.getCompacting() actually contains the original SSTR instances which don&apos;t have their start positions moved.&lt;/p&gt;

&lt;p&gt;The only time it fails is if L1 is empty, attaching patch to properly get the L0 compacting&lt;/p&gt;</comment>
                            <comment id="14307156" author="krummas" created="Thu, 5 Feb 2015 12:45:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=carlyeks&quot; class=&quot;user-hover&quot; rel=&quot;carlyeks&quot;&gt;carlyeks&lt;/a&gt; to review since I found this issue while reviewing &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7409&quot; title=&quot;Allow multiple overlapping sstables in L1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7409&quot;&gt;CASSANDRA-7409&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14307159" author="benedict" created="Thu, 5 Feb 2015 12:46:22 +0000"  >&lt;p&gt;My question is more how this then causes problems, if it fails to markCompacting the candidates it selects?&lt;/p&gt;</comment>
                            <comment id="14307164" author="krummas" created="Thu, 5 Feb 2015 12:50:47 +0000"  >&lt;p&gt;we pick a bunch of files for compaction (those are not currently compacting), then we make sure that by compacting those into L1, we don&apos;t cause any overlap in L1. We do that by comparing first/last keys in the candidates with the first/last keys of the sstables that are currently compacting.&lt;/p&gt;</comment>
                            <comment id="14307172" author="benedict" created="Thu, 5 Feb 2015 12:56:31 +0000"  >&lt;p&gt;Oh, right. Yes, now you&apos;ve spelled it out, I can see you were clearly stating it before and I was just missing it. (Thanks for bearing with me!)&lt;/p&gt;</comment>
                            <comment id="14327989" author="carlyeks" created="Thu, 19 Feb 2015 19:29:23 +0000"  >&lt;p&gt;I&apos;m not sure how the change to the way it calculates the L0 compacting makes a difference; it seems like they should be the same.&lt;/p&gt;

&lt;p&gt;The new L0 overlapping check makes sense.&lt;/p&gt;</comment>
                            <comment id="14345034" author="krummas" created="Tue, 3 Mar 2015 13:03:48 +0000"  >&lt;p&gt;the new compacting L0 calculation takes the sstable &lt;b&gt;instances&lt;/b&gt; from the datatracker compacting set - these instances are not the same as the ones in LCS L0 (the LCS L0 can have had their start positions moved), hoping to fix that in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8764&quot; title=&quot;Refactor the way we notify compaction strategies about early opened files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8764&quot;&gt;&lt;del&gt;CASSANDRA-8764&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14345036" author="benedict" created="Tue, 3 Mar 2015 13:05:25 +0000"  >&lt;p&gt;I&apos;m hoping to fix this in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8568&quot; title=&quot;Extend Transactional API to sstable lifecycle management&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8568&quot;&gt;&lt;del&gt;CASSANDRA-8568&lt;/del&gt;&lt;/a&gt; also&lt;/p&gt;</comment>
                            <comment id="14349862" author="carlyeks" created="Fri, 6 Mar 2015 02:51:57 +0000"  >&lt;p&gt;I missed that before.&lt;/p&gt;

&lt;p&gt;Makes sense; +1 on the patch.&lt;/p&gt;</comment>
                            <comment id="14375568" author="krummas" created="Mon, 23 Mar 2015 08:33:28 +0000"  >&lt;p&gt;committed, thanks&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12696752" name="0001-8739.patch" size="2245" author="marcuse" created="Thu, 5 Feb 2015 12:43:42 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 35 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2570f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>carlyeks</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[carlyeks]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>