<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:52:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-9251] Dropping a table while compacting causes exceptions</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-9251</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Run the attached test:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; [junit] ------------- ---------------- ---------------
    [junit] Testcase: testDropDuringCompaction(org.apache.cassandra.cql3.CrcCheckChanceTest):	Caused an ERROR
    [junit] java.util.concurrent.ExecutionException: java.lang.AssertionError
    [junit] java.lang.RuntimeException: java.util.concurrent.ExecutionException: java.lang.AssertionError
    [junit] 	at org.apache.cassandra.utils.FBUtilities.waitOnFuture(FBUtilities.java:402)
    [junit] 	at org.apache.cassandra.utils.FBUtilities.waitOnFutures(FBUtilities.java:391)
    [junit] 	at org.apache.cassandra.cql3.CrcCheckChanceTest.testDropDuringCompaction(CrcCheckChanceTest.java:144)
    [junit] Caused by: java.util.concurrent.ExecutionException: java.lang.AssertionError
    [junit] 	at java.util.concurrent.FutureTask.report(FutureTask.java:122)
    [junit] 	at java.util.concurrent.FutureTask.get(FutureTask.java:188)
    [junit] 	at org.apache.cassandra.utils.FBUtilities.waitOnFuture(FBUtilities.java:398)
    [junit] Caused by: java.lang.AssertionError
    [junit] 	at org.apache.cassandra.io.sstable.SSTableReader.markObsolete(SSTableReader.java:1706)
    [junit] 	at org.apache.cassandra.db.DataTracker.unmarkCompacting(DataTracker.java:240)
    [junit] 	at org.apache.cassandra.io.sstable.SSTableRewriter.replaceWithFinishedReaders(SSTableRewriter.java:495)
    [junit] 	at org.apache.cassandra.io.sstable.SSTableRewriter.finishAndMaybeThrow(SSTableRewriter.java:475)
    [junit] 	at org.apache.cassandra.io.sstable.SSTableRewriter.finish(SSTableRewriter.java:416)
    [junit] 	at org.apache.cassandra.io.sstable.SSTableRewriter.finish(SSTableRewriter.java:396)
    [junit] 	at org.apache.cassandra.db.compaction.CompactionTask.runMayThrow(CompactionTask.java:212)
    [junit] 	at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:28)
    [junit] 	at org.apache.cassandra.db.compaction.CompactionTask.executeInternal(CompactionTask.java:72)
    [junit] 	at org.apache.cassandra.db.compaction.AbstractCompactionTask.execute(AbstractCompactionTask.java:59)
    [junit] 	at org.apache.cassandra.db.compaction.CompactionManager$7.runMayThrow(CompactionManager.java:512)
    [junit] 	at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:28)
    [junit] 	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)
    [junit] 	at java.util.concurrent.FutureTask.run(FutureTask.java:262)
    [junit] 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
    [junit] 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
    [junit] 	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
    [junit] 	Suppressed: java.lang.IllegalStateException: Attempted to release a reference that has already been released
    [junit] 		at org.apache.cassandra.utils.concurrent.Ref$State.release(Ref.java:173)
    [junit] 		at org.apache.cassandra.utils.concurrent.Ref.release(Ref.java:77)
    [junit] 		at org.apache.cassandra.utils.concurrent.Refs.release(Refs.java:212)
    [junit] 		at org.apache.cassandra.db.DataTracker.replaceReaders(DataTracker.java:413)
    [junit] 		at org.apache.cassandra.db.DataTracker.replaceEarlyOpenedFiles(DataTracker.java:322)
    [junit] 		at org.apache.cassandra.io.sstable.SSTableRewriter.replaceWithFinishedReaders(SSTableRewriter.java:494)
    [junit] 		at org.apache.cassandra.io.sstable.SSTableRewriter.abort(SSTableRewriter.java:252)
    [junit] 		at org.apache.cassandra.db.compaction.CompactionTask.runMayThrow(CompactionTask.java:218)
    [junit] 

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12824393">CASSANDRA-9251</key>
            <summary>Dropping a table while compacting causes exceptions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="benedict">Benedict Elliott Smith</assignee>
                                    <reporter username="tjake">T Jake Luciani</reporter>
                        <labels>
                    </labels>
                <created>Mon, 27 Apr 2015 19:19:23 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:13 +0000</updated>
                            <resolved>Mon, 4 May 2015 18:39:55 +0000</resolved>
                                        <fixVersion>2.1.6</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14515832" author="benedict" created="Mon, 27 Apr 2015 23:19:01 +0000"  >&lt;p&gt;Pushed a fix &lt;a href=&quot;https://github.com/belliottsmith/cassandra/tree/9251&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This actually fixes the problem twice, just for good measure. First, it cancels any in progress compactions when dropping, which seems useful anyway and should prevent us ever calling unmarkCompacting during the invalid period.&lt;/p&gt;

&lt;p&gt;Second, it removes the extra pre-unmark check, and just calls unreference..() in the event we&apos;re invalid, since there doesn&apos;t appear to be a good reason to do it twice, and the second check is safer than the first.&lt;/p&gt;</comment>
                            <comment id="14519388" author="tjake" created="Wed, 29 Apr 2015 14:05:45 +0000"  >&lt;p&gt;Does this mean we will now block upto 1 minute for compaction to finish when we drop?  We shouldn&apos;t do that.&lt;/p&gt;</comment>
                            <comment id="14519418" author="benedict" created="Wed, 29 Apr 2015 14:27:55 +0000"  >&lt;p&gt;I&apos;m not sure why that would be a problem: we already wait for all pending reads and writes, then perform a full blocking flush, all of which could be very lengthy and well in excess of a minute. We&apos;ve already interrupted all compactions prior to doing this. However it&apos;s not essential that we do this, so I&apos;ve uploaded a patch that removes the &lt;em&gt;waiting&lt;/em&gt; but shutsdown and interrupts earlier also, to make it more likely it&apos;s done.&lt;/p&gt;</comment>
                            <comment id="14519491" author="tjake" created="Wed, 29 Apr 2015 14:52:11 +0000"  >&lt;p&gt;We want to do what we can to avoid the user getting a timeout when they run drop since it&apos;s confusing what todo next.  &lt;/p&gt;</comment>
                            <comment id="14519888" author="benedict" created="Wed, 29 Apr 2015 18:28:56 +0000"  >&lt;p&gt;just to clarify: i&apos;ve removed it already, just in case you missed the second half of the comment &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14519896" author="tjake" created="Wed, 29 Apr 2015 18:35:03 +0000"  >&lt;p&gt;+1 thx.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12728488" name="21test.txt" size="2128" author="tjake" created="Mon, 27 Apr 2015 19:20:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[benedict]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 29 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2dtpz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>tjake</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[tjake]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>