<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:00:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-10903] AssertionError while reading sstable when querying static column</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-10903</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I&apos;m able to consistently reproduce the following error:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;1  WARN [SharedPool-Worker-1] 2015-12-17 17:37:00,196  AbstractTracingAwareExecutorService.java (line 169) Uncaught exception on thread Thread[SharedPool-Worker-1,5,main]: {}
java.lang.AssertionError: null
    at org.apache.cassandra.db.columniterator.AbstractSSTableIterator$IndexState.updateBlock(AbstractSSTableIterator.java:463) ~[cassandra-all-3.0.0.740.jar:3.0.0.740]
    at org.apache.cassandra.db.columniterator.SSTableIterator$ForwardIndexedReader.computeNext(SSTableIterator.java:268) ~[cassandra-all-3.0.0.740.jar:3.0.0.740]
    at org.apache.cassandra.db.columniterator.SSTableIterator$ForwardReader.hasNextInternal(SSTableIterator.java:158) ~[cassandra-all-3.0.0.740.jar:3.0.0.740]
    at org.apache.cassandra.db.columniterator.AbstractSSTableIterator$Reader.hasNext(AbstractSSTableIterator.java:352) ~[cassandra-all-3.0.0.740.jar:3.0.0.740]
    at org.apache.cassandra.db.columniterator.AbstractSSTableIterator.hasNext(AbstractSSTableIterator.java:219) ~[cassandra-all-3.0.0.740.jar:3.0.0.740]
    at org.apache.cassandra.db.columniterator.SSTableIterator.hasNext(SSTableIterator.java:32) ~[cassandra-all-3.0.0.740.jar:3.0.0.740]
    at org.apache.cassandra.utils.MergeIterator$Candidate.advance(MergeIterator.java:369) ~[cassandra-all-3.0.0.740.jar:3.0.0.740]
    at org.apache.cassandra.utils.MergeIterator$ManyToOne.advance(MergeIterator.java:189) ~[cassandra-all-3.0.0.740.jar:3.0.0.740]
    at org.apache.cassandra.utils.MergeIterator$ManyToOne.computeNext(MergeIterator.java:158) ~[cassandra-all-3.0.0.740.jar:3.0.0.740]
    at org.apache.cassandra.utils.AbstractIterator.hasNext(AbstractIterator.java:47) ~[cassandra-all-3.0.0.740.jar:3.0.0.740]
    at org.apache.cassandra.db.rows.UnfilteredRowIterators$UnfilteredRowMergeIterator.computeNext(UnfilteredRowIterators.java:426) ~[cassandra-all-3.0.0.740.jar:3.0.0.740]
    at org.apache.cassandra.db.rows.UnfilteredRowIterators$UnfilteredRowMergeIterator.computeNext(UnfilteredRowIterators.java:286) ~[cassandra-all-3.0.0.740.jar:3.0.0.740]
    at org.apache.cassandra.utils.AbstractIterator.hasNext(AbstractIterator.java:47) ~[cassandra-all-3.0.0.740.jar:3.0.0.740]
    at org.apache.cassandra.db.transform.BaseRows.hasNext(BaseRows.java:108) ~[cassandra-all-3.0.0.740.jar:3.0.0.740]
    at org.apache.cassandra.db.rows.UnfilteredRowIteratorSerializer.serialize(UnfilteredRowIteratorSerializer.java:131) ~[cassandra-all-3.0.0.740.jar:3.0.0.740]
    at org.apache.cassandra.db.rows.UnfilteredRowIteratorSerializer.serialize(UnfilteredRowIteratorSerializer.java:87) ~[cassandra-all-3.0.0.740.jar:3.0.0.740]
    at org.apache.cassandra.db.rows.UnfilteredRowIteratorSerializer.serialize(UnfilteredRowIteratorSerializer.java:77) ~[cassandra-all-3.0.0.740.jar:3.0.0.740]
    at org.apache.cassandra.db.partitions.UnfilteredPartitionIterators$Serializer.serialize(UnfilteredPartitionIterators.java:298) ~[cassandra-all-3.0.0.740.jar:3.0.0.740]
    at org.apache.cassandra.db.ReadResponse$LocalDataResponse.build(ReadResponse.java:136) ~[cassandra-all-3.0.0.740.jar:3.0.0.740]
    at org.apache.cassandra.db.ReadResponse$LocalDataResponse.&amp;lt;init&amp;gt;(ReadResponse.java:128) ~[cassandra-all-3.0.0.740.jar:3.0.0.740]
    at org.apache.cassandra.db.ReadResponse$LocalDataResponse.&amp;lt;init&amp;gt;(ReadResponse.java:123) ~[cassandra-all-3.0.0.740.jar:3.0.0.740]
    at org.apache.cassandra.db.ReadResponse.createDataResponse(ReadResponse.java:65) ~[cassandra-all-3.0.0.740.jar:3.0.0.740]
    at org.apache.cassandra.db.ReadCommand.createResponse(ReadCommand.java:288) ~[cassandra-all-3.0.0.740.jar:3.0.0.740]
    at org.apache.cassandra.service.StorageProxy$LocalReadRunnable.runMayThrow(StorageProxy.java:1692) ~[cassandra-all-3.0.0.740.jar:3.0.0.740]
    at org.apache.cassandra.service.StorageProxy$DroppableRunnable.run(StorageProxy.java:2346) ~[cassandra-all-3.0.0.740.jar:3.0.0.740]
    at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) ~[na:1.8.0_45]
    at org.apache.cassandra.concurrent.AbstractTracingAwareExecutorService$FutureTask.run(AbstractTracingAwareExecutorService.java:164) ~[cassandra-all-3.0.0.740.jar:3.0.0.740]
    at org.apache.cassandra.concurrent.SEPWorker.run(SEPWorker.java:105) [cassandra-all-3.0.0.740.jar:3.0.0.740]
    at java.lang.Thread.run(Thread.java:745) [na:1.8.0_45]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This occurs while executing a query like:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;SELECT static_column FROM table WHERE partition_key = ?
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;on a table with one partition key and multiple clustering keys.  I&apos;m currently trying to create a more isolated reproduction.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12922893">CASSANDRA-10903</key>
            <summary>AssertionError while reading sstable when querying static column</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="thobbs">Tom Hobbs</reporter>
                        <labels>
                    </labels>
                <created>Thu, 17 Dec 2015 23:45:18 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:47 +0000</updated>
                            <resolved>Wed, 23 Dec 2015 14:19:35 +0000</resolved>
                                        <fixVersion>3.0.3</fixVersion>
                    <fixVersion>3.2</fixVersion>
                                    <component>Legacy/Local Write-Read Paths</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15066511" author="slebresne" created="Mon, 21 Dec 2015 14:50:40 +0000"  >&lt;p&gt;I originally though this might not be related to static columns but it actually is. Basically, queries that include static and have no clustering conditions will trigger this if partition is indexed (and I mean here the sstable &quot;row&quot; index). And that&apos;s because in that specific case we actually end up not calling some necessary initialization.&lt;/p&gt;

&lt;p&gt;Follows a patch to fix this:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/pcmanus/cassandra/commits/10903&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0 patch&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/pcmanus-10903-testall/2/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/pcmanus/job/pcmanus-10903-dtest/2/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;As of this writing, utests are clear but dtests are still running.&lt;/p&gt;

&lt;p&gt;The main change of this patch is to move the code from &lt;tt&gt;SSTableIterator.ForwardReader.init()&lt;/tt&gt; inside &lt;tt&gt;AbstractSSTableIterator.IndexState.updateBlock()&lt;/tt&gt; to make sure it&apos;s always called when we need it. The rest is mostly clean up as we don&apos;t need the &lt;tt&gt;init()&lt;/tt&gt; method and its related field anymore.&lt;/p&gt;

&lt;p&gt;The patch includes a basic unit test to reproduce the issue, but I&apos;ll work on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10911&quot; title=&quot;Unit tests for AbstractSSTableIterator and subclasses&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10911&quot;&gt;CASSANDRA-10911&lt;/a&gt; to get finer grained coverage of those classes.&lt;/p&gt;</comment>
                            <comment id="15068867" author="thobbs" created="Tue, 22 Dec 2015 22:50:49 +0000"  >&lt;p&gt;I&apos;ll leave the full review to Branimir, but I&apos;ll note that this patch does fix the issue for me.&lt;/p&gt;</comment>
                            <comment id="15069451" author="blambov" created="Wed, 23 Dec 2015 10:00:03 +0000"  >&lt;p&gt;Patch looks good overall.&lt;/p&gt;

&lt;p&gt;It is a bit unclear why the reverse iteration if fine, could you extend the test a little to also exercise the reversed iterator? Also, I think &lt;tt&gt;IndexState.updateBlock&lt;/tt&gt; needs an &lt;tt&gt;assert !reversed&lt;/tt&gt; or at least a comment to state that it is only used when going forwards.&lt;/p&gt;</comment>
                            <comment id="15069524" author="slebresne" created="Wed, 23 Dec 2015 11:22:51 +0000"  >&lt;p&gt;I&apos;ve pushed a simple followup that adds assertion and comment for &lt;tt&gt;udpateBlock&lt;/tt&gt; and adds the reverse case in the test (but again, indirect testing through CQL is not ideal and &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10911&quot; title=&quot;Unit tests for AbstractSSTableIterator and subclasses&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10911&quot;&gt;CASSANDRA-10911&lt;/a&gt; will be a better to get decently exhausting testing of this). For the records, the reverse case was not affected because we&apos;re unconditionally seeking to the last block which wasn&apos;t done as part of the &lt;tt&gt;init&lt;/tt&gt; method that was at fault here. &lt;/p&gt;</comment>
                            <comment id="15069546" author="blambov" created="Wed, 23 Dec 2015 11:58:11 +0000"  >&lt;p&gt;LGTM&lt;/p&gt;</comment>
                            <comment id="15069669" author="slebresne" created="Wed, 23 Dec 2015 14:19:35 +0000"  >&lt;p&gt;Committed, thanks.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12931480">CASSANDRA-11021</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 47 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2q2gf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12334152">3.0.1</customfieldvalue>
    <customfieldvalue id="12333943">3.1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>blambov</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blambov]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>