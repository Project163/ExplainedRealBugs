<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:35:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-4807] Compaction progress counts more than 100%</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-4807</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;&apos;nodetool compactionstats&apos; compaction progress counts more than 100%:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;pending tasks: 74
          compaction type        keyspace   column family bytes compacted     bytes total  progress
               Validation        KSP        CF1           56192578305         84652768917    66.38%
               Compaction        KSP        CF2           162018591           119913592     135.11%
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Hadn&apos;t experienced this before 1.1.3. Is it due to changes in 1.1.4-1.1.6 ?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12611845">CASSANDRA-4807</key>
            <summary>Compaction progress counts more than 100%</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yukim">Yuki Morishita</assignee>
                                    <reporter username="omid">Omid Aladini</reporter>
                        <labels>
                    </labels>
                <created>Mon, 15 Oct 2012 15:10:38 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:25 +0000</updated>
                            <resolved>Tue, 16 Oct 2012 23:12:03 +0000</resolved>
                                        <fixVersion>1.1.7</fixVersion>
                    <fixVersion>1.2.0 beta 2</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13477235" author="yukim" created="Tue, 16 Oct 2012 18:15:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=omid&quot; class=&quot;user-hover&quot; rel=&quot;omid&quot;&gt;omid&lt;/a&gt; What compaction strategy are you using? Do you turn on multithreaded compaction?&lt;/p&gt;</comment>
                            <comment id="13477241" author="azotcsit" created="Tue, 16 Oct 2012 18:21:56 +0000"  >&lt;p&gt;Yuki, I&apos;ve seen that too. I&apos;ve used the following configs:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;LCS with singlethreaded compaction (CompactionIterable).&lt;/li&gt;
	&lt;li&gt;snappy compression with chunk_length_kb = 32.&lt;/li&gt;
	&lt;li&gt;Cassandra 1.1.4.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13477262" author="omid" created="Tue, 16 Oct 2012 18:59:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yukim&quot; class=&quot;user-hover&quot; rel=&quot;yukim&quot;&gt;yukim&lt;/a&gt; LCS with snappy with chunk_length_kb = 64, sstable_size_in_mb = 10 and multithreaded compaction disabled on Cassandra 1.1.6.&lt;/p&gt;</comment>
                            <comment id="13477291" author="yukim" created="Tue, 16 Oct 2012 19:52:55 +0000"  >&lt;p&gt;Alexey, Omid,&lt;/p&gt;

&lt;p&gt;Thank you both for providing information.&lt;br/&gt;
I think this regression comes from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4587&quot; title=&quot;StackOverflowError in LeveledCompactionStrategy$LeveledScanner.computeNext&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4587&quot;&gt;&lt;del&gt;CASSANDRA-4587&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
compactionstats&apos; bytes compacted comes from LeveledScanner#getCurrentPosition(&lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-1.1.6/src/java/org/apache/cassandra/db/compaction/LeveledCompactionStrategy.java#L261&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/cassandra-1.1.6/src/java/org/apache/cassandra/db/compaction/LeveledCompactionStrategy.java#L261&lt;/a&gt;) when using LCS.&lt;/p&gt;

&lt;p&gt;We need to reset currentScanner to null after scanning through to the end, otherwise we would add twice for last scanned SSTable.&lt;/p&gt;

&lt;p&gt;Patch attached as well as unit test for this.&lt;br/&gt;
(github: &lt;a href=&quot;https://github.com/yukim/cassandra/tree/4807&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/yukim/cassandra/tree/4807&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="13477310" author="jbellis" created="Tue, 16 Oct 2012 20:13:38 +0000"  >&lt;p&gt;LGTM, +1.&lt;/p&gt;

&lt;p&gt;When committing, can you add a comment to the computeNext code explaining why we set to null?&lt;/p&gt;</comment>
                            <comment id="13477314" author="omid" created="Tue, 16 Oct 2012 20:21:02 +0000"  >&lt;p&gt;Thanks Yuki. It also probably affects compaction throttling, by throttling more than it should (&lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-1.1.6/src/java/org/apache/cassandra/db/compaction/CompactionManager.java#L612&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/cassandra-1.1.6/src/java/org/apache/cassandra/db/compaction/CompactionManager.java#L612&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="13477450" author="yukim" created="Tue, 16 Oct 2012 23:12:03 +0000"  >&lt;p&gt;Committed with comment.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=omid&quot; class=&quot;user-hover&quot; rel=&quot;omid&quot;&gt;omid&lt;/a&gt; Correct, though you pointed to cleanup source code which is not affected by this.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12549369" name="4807-1.1.txt" size="4314" author="yukim" created="Tue, 16 Oct 2012 19:52:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[yukim]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>248720</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 5 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i09xzz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>55949</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>