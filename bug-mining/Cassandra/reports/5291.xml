<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:14:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-14872] Update to version of python driver and update cqlsh to use driver metadata for virtual tables</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-14872</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;When virtual tables were implemented (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7622&quot; title=&quot;Implement virtual tables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7622&quot;&gt;&lt;del&gt;CASSANDRA-7622&lt;/del&gt;&lt;/a&gt;), cqlsh.py was updated to parse virtual keyspace metadata by making queries to the &lt;tt&gt;system_virtual_schema&lt;/tt&gt; table and included a TODO:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-python&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;# TODO remove after virtual tables are added to connection metadata&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Since python driver 3.15.0 (released in August), the driver now parses virtual keyspace metadata.   It would be good to update the bundled python driver and simplify cqlsh code to utilize its capability to parse virtual tables.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13196914">CASSANDRA-14872</key>
            <summary>Update to version of python driver and update cqlsh to use driver metadata for virtual tables</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="djoshi">Dinesh Joshi</assignee>
                                    <reporter username="andrew.tolbert">Andy Tolbert</reporter>
                        <labels>
                    </labels>
                <created>Wed, 7 Nov 2018 19:23:27 +0000</created>
                <updated>Fri, 15 May 2020 08:53:56 +0000</updated>
                            <resolved>Thu, 20 Feb 2020 23:43:56 +0000</resolved>
                                        <fixVersion>4.0-alpha4</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Tool/cqlsh</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="16945588" author="andrew.tolbert" created="Mon, 7 Oct 2019 04:51:17 +0000"  >&lt;p&gt;Newer versions of the python driver also fix some issues around python3, so upgrading would also benefit &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10190&quot; title=&quot;Python 3 support for cqlsh&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10190&quot;&gt;&lt;del&gt;CASSANDRA-10190&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16947742" author="cnlwsu" created="Wed, 9 Oct 2019 14:34:14 +0000"  >&lt;p&gt;We need a new build of the driver for &lt;a href=&quot;https://datastax-oss.atlassian.net/browse/PYTHON-1158&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://datastax-oss.atlassian.net/browse/PYTHON-1158&lt;/a&gt; and also need at least 3.19 for &lt;a href=&quot;https://datastax-oss.atlassian.net/browse/PYTHON-1118&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://datastax-oss.atlassian.net/browse/PYTHON-1118&lt;/a&gt; or the virtual table stuff wont work even with new builds.&lt;/p&gt;</comment>
                            <comment id="17040513" author="djoshi3" created="Wed, 19 Feb 2020 23:31:38 +0000"  >&lt;p&gt;I have upgraded the driver to the latest 3.21 release and cleaned up some of the custom modifications we made. All cqlsh pass. Other tests also pass except 3 which are flakey. Here&apos;s the changes to &lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...dineshjoshi:14872-trunk?expand=1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cassandra&lt;/a&gt;, &lt;a href=&quot;https://github.com/apache/cassandra-dtest/compare/master...dineshjoshi:14872-trunk?expand=1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cassandra-dtest&lt;/a&gt; and &lt;a href=&quot;https://circleci.com/workflow-run/e6d00eb0-0c74-4078-89ec-4449256e387e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CI&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17040586" author="dcapwell" created="Thu, 20 Feb 2020 02:42:42 +0000"  >&lt;p&gt;TR doesn&apos;t work&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
cqlsh&amp;gt; CREATE KEYSPACE bar WITH replication = {&lt;span class=&quot;code-quote&quot;&gt;&apos;class&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;NetworkTopologyStrategy&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;datacenter1&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;3/1&apos;&lt;/span&gt;};
cqlsh&amp;gt; DESCRIBE KEYSPACE bar;

&lt;span class=&quot;code-quote&quot;&gt;&apos;NoneType&apos;&lt;/span&gt; object has no attribute &lt;span class=&quot;code-quote&quot;&gt;&apos;export_for_schema&apos;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17040588" author="dcapwell" created="Thu, 20 Feb 2020 02:46:30 +0000"  >&lt;p&gt;vtables work&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
cqlsh&amp;gt; desc keyspaces;

system_virtual_schema  system_schema  system_views  system_distributed
bar                    system_auth    system        system_traces

cqlsh&amp;gt; describe system_views;

/*
Warning: Keyspace system_views is a virtual keyspace and cannot be recreated with CQL.
Structure, &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; reference:*/
&lt;span class=&quot;code-comment&quot;&gt;// VIRTUAL KEYSPACE system_views;
&lt;/span&gt;
/*
Warning: Table system_views.sstable_tasks is a virtual table and cannot be recreated with CQL.
Structure, &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; reference:
VIRTUAL TABLE system_views.sstable_tasks (
    keyspace_name text,
    table_name text,
    task_id uuid,
    kind text,
    progress bigint,
    total bigint,
    unit text,
    PRIMARY KEY (keyspace_name, table_name, task_id)
) WITH CLUSTERING ORDER BY (table_name ASC, task_id ASC)
    AND comment = &lt;span class=&quot;code-quote&quot;&gt;&apos;current sstable tasks&apos;&lt;/span&gt;;
*/
...
cqlsh&amp;gt; use system_views;
cqlsh:system_views&amp;gt; desc tables;

sstable_tasks       clients                   coordinator_write_latency
disk_usage          local_write_latency       tombstones_per_read
thread_pools        internode_outbound        settings
local_scan_latency  coordinator_scan_latency  max_partition_size
internode_inbound   coordinator_read_latency  caches
local_read_latency  rows_per_read
cqlsh:system_views&amp;gt; desc rows_per_read;

/*
Warning: Table system_views.rows_per_read is a virtual table and cannot be recreated with CQL.
Structure, &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; reference:
VIRTUAL TABLE system_views.rows_per_read (
    keyspace_name text,
    table_name text,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;50th&quot;&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;99th&quot;&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;,
    count bigint,
    max &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;,
    PRIMARY KEY ((keyspace_name, table_name))
) WITH comment = &apos;&apos;;
*/
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17040597" author="djoshi3" created="Thu, 20 Feb 2020 03:28:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dcapwell&quot; class=&quot;user-hover&quot; rel=&quot;dcapwell&quot;&gt;dcapwell&lt;/a&gt; thanks for testing. The latest `python-driver` doesn&apos;t seem to support DESCRIBE for transient replication enabled schemas. Originally I thought that the latest driver will fix the issue but it doesn&apos;t look like it. Lets not block on this. I&apos;ll reopen 15578 and work on when TR is added to the driver.&lt;/p&gt;

&lt;p&gt;For the curious, the issue the way we describe TR enabled RF which breaks the parsing here: &lt;a href=&quot;https://github.com/datastax/python-driver/blob/9297c74c9075b9eb732190f7f0bdf1b06493b808/cassandra/metadata.py#L503-L504&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/datastax/python-driver/blob/9297c74c9075b9eb732190f7f0bdf1b06493b808/cassandra/metadata.py#L503-L504&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17040686" author="andrew.tolbert" created="Thu, 20 Feb 2020 06:58:12 +0000"  >&lt;p&gt;I remember trying transient replication with the java driver and it not working (&lt;a href=&quot;https://datastax-oss.atlassian.net/browse/JAVA-2105&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;JAVA-2105&lt;/a&gt;), I suspect most/all client libraries that read schema need updates to parse it.&lt;/p&gt;</comment>
                            <comment id="17040697" author="andrew.tolbert" created="Thu, 20 Feb 2020 07:11:35 +0000"  >&lt;p&gt;Changes look great!  Played around with it a little bit and it&apos;s working well.  I like that autocompletion works flawlessly for vtables &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;One thing that is interesting is that geomet is a required dependency.  Since it&apos;s apache licensed and seems pretty small that doesn&apos;t seem like much of a deal.  I think it could be made optional in the python driver (it&apos;s used for parsing DSE-specific geospatial types) so might be something worth pursuing on that end (but don&apos;t think it&apos;s needed as a prereq to this).&lt;/p&gt;</comment>
                            <comment id="17040725" author="djoshi3" created="Thu, 20 Feb 2020 07:37:15 +0000"  >&lt;p&gt;Thanks for checking it out Andy. I considered making geomet optional. It will need some driver changes and I am reluctant to check in a custom build of the driver. So this is an ok compromise for the time being. As an added benefit of leaving it in, users can use this cqlsh to connect to DSE and all features that the driver support will continue functioning including the geospatial types.&lt;/p&gt;</comment>
                            <comment id="17040727" author="andrew.tolbert" created="Thu, 20 Feb 2020 07:44:00 +0000"  >&lt;blockquote&gt;
&lt;p&gt;It will need some driver changes and I am reluctant to check in a custom build of the driver. So this is an ok compromise for the time being&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1 agree we should proceed with it included as it seems like a small self-contained dependency, and it is really nice to not use a custom build.&lt;/p&gt;</comment>
                            <comment id="17041282" author="rustyrazorblade" created="Thu, 20 Feb 2020 20:21:13 +0000"  >&lt;p&gt;LGTM, +1.&lt;/p&gt;</comment>
                            <comment id="17041370" author="djoshi3" created="Thu, 20 Feb 2020 23:43:56 +0000"  >&lt;p&gt;Thanks every for the review and comments. Committed in &lt;a href=&quot;https://github.com/apache/cassandra/commit/f7b3317379dc13aa62eb442741423a3300f0f8c6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cassandra&lt;/a&gt; and &lt;a href=&quot;https://github.com/apache/cassandra-dtest/commit/18ccbb4d308c27b67a8d81a2c849dc27fc3e2b5c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cassandra-dtest&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="13285928">CASSANDRA-15578</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13165524">CASSANDRA-14512</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13285882">CASSANDRA-15576</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13285928">CASSANDRA-15578</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12858806">CASSANDRA-10190</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[djoshi]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 38 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|s008n4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[dcapwell]]></customfieldvalue>
        <customfieldvalue><![CDATA[rustyrazorblade]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12336842">4.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/f7b3317379dc13aa62eb442741423a3300f0f8c6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/f7b3317379dc13aa62eb442741423a3300f0f8c6&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;Run cqlsh tests&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>