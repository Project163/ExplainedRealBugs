<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:08:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-13730] Dropping a table doesn&apos;t drop its dropped columns</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-13730</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I&apos;m not sure if this is intended or not, but currently a table&apos;s dropped columns are not dropped when the table itself is dropped:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;cqlsh&amp;gt; create keyspace ks WITH replication={ &apos;class&apos; : &apos;SimpleStrategy&apos;, &apos;replication_factor&apos; : 1 } ;
cqlsh&amp;gt; use ks;
cqlsh:ks&amp;gt; create table  test (pk text primary key, c1 int);
cqlsh:ks&amp;gt; alter table test drop c1;
cqlsh:ks&amp;gt; drop table test;
cqlsh:ks&amp;gt; select * from system_schema.dropped_columns where keyspace_name = &apos;ks&apos; and table_name = &apos;test&apos;;

 keyspace_name | table_name | column_name | dropped_time                    | kind    | type
---------------+------------+-------------+---------------------------------+---------+------
            ks |       test |          c1 | 2017-07-25 17:53:47.651000+0000 | regular |  int

(1 rows)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This can have surprising consequences when creating another table with the same name.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13089965">CASSANDRA-13730</key>
            <summary>Dropping a table doesn&apos;t drop its dropped columns</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jasonstack">Zhao Yang</assignee>
                                    <reporter username="duarten">Duarte Nunes</reporter>
                        <labels>
                    </labels>
                <created>Tue, 25 Jul 2017 18:05:42 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:02 +0000</updated>
                            <resolved>Thu, 3 Aug 2017 13:43:57 +0000</resolved>
                                        <fixVersion>3.0.15</fixVersion>
                    <fixVersion>3.11.1</fixVersion>
                                    <component>Legacy/Distributed Metadata</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="16100688" author="iamaleksey" created="Tue, 25 Jul 2017 20:11:35 +0000"  >&lt;p&gt;It&apos;s most certainly unintended, and I can confirm that the necessary code is missing from &lt;tt&gt;SchemaKeyspace.makeDropTableMutation()&lt;/tt&gt; method.&lt;/p&gt;</comment>
                            <comment id="16100699" author="iamaleksey" created="Tue, 25 Jul 2017 20:17:38 +0000"  >&lt;p&gt;It&apos;s also really old, going all the way to 2.0. Should fix in 2.1 and upwards.&lt;/p&gt;</comment>
                            <comment id="16100728" author="duarten" created="Tue, 25 Jul 2017 20:30:11 +0000"  >&lt;p&gt;Weren&apos;t the dropped columns just a map before 3.0?&lt;/p&gt;</comment>
                            <comment id="16100739" author="iamaleksey" created="Tue, 25 Jul 2017 20:35:54 +0000"  >&lt;blockquote&gt;&lt;p&gt;Weren&apos;t the dropped columns just a map before 3.0?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Totally was. My memory is apparently garbage. Thanks.&lt;/p&gt;</comment>
                            <comment id="16101016" author="iamaleksey" created="Wed, 26 Jul 2017 00:54:00 +0000"  >&lt;p&gt;The reason nobody noticed before is that it shouldn&apos;t affect you, normally. Assuming the clock working even remotely correctly, timestamps of new columns in the new table will all be higher than dropped column times in the deleted table.&lt;/p&gt;

&lt;p&gt;You&apos;d be affected if you set timestamps manually to values &amp;lt; time of new table creation.&lt;/p&gt;

&lt;p&gt;You&apos;ll also be affected by being unable to re-add certain columns to schema - there are some validations in place forbidding you to re-add columns with types incompatible with dropped columns&apos; types (for collections in particular).&lt;/p&gt;

&lt;p&gt;It&apos;s still a bug though and should be fixed, but is a minor one.&lt;/p&gt;

&lt;p&gt;Unassigning myself as it&apos;s less impactful as I initially assumed. If nobody else picks it up, I will eventually fix it, once I don&apos;t have more important things on my plate.&lt;/p&gt;

&lt;p&gt;Feel free to take over. And thanks for spotting it in the first place (:&lt;/p&gt;</comment>
                            <comment id="16106299" author="jasonstack" created="Sun, 30 Jul 2017 03:15:01 +0000"  >&lt;p&gt;This might affect backup/restore.. &lt;/p&gt;

&lt;p&gt;1. backup&lt;br/&gt;
2. drop column&lt;br/&gt;
3. drop table&lt;br/&gt;
4. restore schema&lt;br/&gt;
5. restore sstable&lt;br/&gt;
6. data missing for dropped column&lt;/p&gt;</comment>
                            <comment id="16106386" author="stonefang" created="Sun, 30 Jul 2017 08:43:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jasonstack&quot; class=&quot;user-hover&quot; rel=&quot;jasonstack&quot;&gt;jasonstack&lt;/a&gt;&lt;br/&gt;
why restore process need to  check system_schema.dropped_columns?&lt;br/&gt;
should put system_schema.dropped_table first&lt;/p&gt;</comment>
                            <comment id="16106746" author="jasonstack" created="Mon, 31 Jul 2017 02:44:13 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/jasonstack/cassandra/commits/CASSANDRA-13730-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://circleci.com/gh/jasonstack/cassandra/295&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;unit&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; irrelevant&lt;br/&gt;
 compaction_test.TestCompaction_with_LeveledCompactionStrategy.fanout_size_test&lt;br/&gt;
 materialized_views_test.TestMaterializedViews.view_tombstone_test (known)&lt;br/&gt;
 bootstrap_test.TestBootstrap.consistent_range_movement_false_with_rf1_should_succeed_test(known) &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/jasonstack/cassandra/commits/CASSANDRA-13730-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.11&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://circleci.com/gh/jasonstack/cassandra/296&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;unit&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; passed dtest &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/jasonstack/cassandra/commits/CASSANDRA-13730-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://circleci.com/gh/jasonstack/cassandra/287&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;unit&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; irrelevant&lt;br/&gt;
 offline_tools_test.TestOfflineTools.sstableofflinerelevel_test&lt;br/&gt;
auth_test.TestAuth.system_auth_ks_is_alterable_test &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/commits/CASSANDRA-13730&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;clear corresponding dropped_columns entries when table is dropped.&lt;/p&gt;</comment>
                            <comment id="16111331" author="iamaleksey" created="Wed, 2 Aug 2017 17:09:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jasonstack&quot; class=&quot;user-hover&quot; rel=&quot;jasonstack&quot;&gt;jasonstack&lt;/a&gt; Looking good, only have one small nit: &lt;tt&gt;columnName.toString()&lt;/tt&gt; call is redundant, as &lt;tt&gt;columnName&lt;/tt&gt; is already a string. Should remove that call. Also, my (subjective) preference would be to pass &lt;tt&gt;DroppedColumn&lt;/tt&gt; and not &lt;tt&gt;String&lt;/tt&gt; as &lt;tt&gt;columnName&lt;/tt&gt; to &lt;tt&gt;dropDroppedColumnFromSchemaMutation()&lt;/tt&gt; method, for consistency with other similar methods in the class.&lt;/p&gt;

&lt;p&gt;Unit test and dtest look good to me.&lt;/p&gt;</comment>
                            <comment id="16112180" author="jasonstack" created="Thu, 3 Aug 2017 04:47:47 +0000"  >&lt;p&gt;thanks for reviewing. updated 3.0/3.1 branch.&lt;/p&gt;</comment>
                            <comment id="16112536" author="iamaleksey" created="Thu, 3 Aug 2017 10:10:18 +0000"  >&lt;p&gt;Thanks! LGTM, will commit soonish.&lt;/p&gt;</comment>
                            <comment id="16112699" author="iamaleksey" created="Thu, 3 Aug 2017 13:30:45 +0000"  >&lt;p&gt;Committed to 3.0 as &lt;a href=&quot;https://github.com/apache/cassandra/commit/d9eabd3d0cbf1287aa7d01bc23dd8e39c3acf232&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;d9eabd3d0cbf1287aa7d01bc23dd8e39c3acf232&lt;/a&gt; and merged into 3.11 and trunk, thanks.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jasonstack]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 15 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3hzun:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12339157">3.11.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aleksey</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>