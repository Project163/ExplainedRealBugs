<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:11:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-436] OOM during major compaction on many (hundreds) of sstables</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-436</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;compaction deserializes rows during compaction before they are needed, one per sstable.  if we only deserialized on-demand the current algorithm would be fine on nearly arbitrarily large numbers of sstables.  (this is only important b/c it is useful to disable compactions during bulk load.)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12435316">CASSANDRA-436</key>
            <summary>OOM during major compaction on many (hundreds) of sstables</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="jbellis">Jonathan Ellis</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 Sep 2009 14:35:00 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:34 +0000</updated>
                            <resolved>Thu, 17 Sep 2009 21:10:01 +0000</resolved>
                                        <fixVersion>0.5</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="12755104" author="jbellis" created="Mon, 14 Sep 2009 17:50:22 +0000"  >&lt;p&gt;04&lt;br/&gt;
    Replace PriorityQueue mess with a CompactionIterator that efficiently yields compacted Rows from a set of&lt;br/&gt;
    sstables by feeding CollationIterator into a ReducingIterator transform.  (&quot;Efficiently&quot; means we        &lt;br/&gt;
    never deserialize data until it is needed, so the number of sstables that can be compacted at once is    &lt;br/&gt;
    virtually unlimited, and if only one sstable contains a given key that row data will be copied over      &lt;br/&gt;
    without an intermediate de/serialize step.) This is a very natural fit                                   &lt;br/&gt;
    for the compaction algorithm and almost entirely gets rid of duplicated code between doFileCompaction and&lt;br/&gt;
    doAntiCompaction.&lt;/p&gt;

&lt;p&gt;03&lt;br/&gt;
    allow ReducingIterator to reduce from one type to a different one&lt;/p&gt;

&lt;p&gt;02&lt;br/&gt;
    copy FileStruct to SSTableScanner and remove cruft.  Migrate getKeyRange to new scanner class.&lt;/p&gt;

&lt;p&gt;01&lt;br/&gt;
    minor cleanup&lt;/p&gt;</comment>
                            <comment id="12755863" author="lenn0x" created="Wed, 16 Sep 2009 03:33:42 +0000"  >&lt;p&gt;I will be testing this tonight on our cluster. I&apos;ll need roughly 15-20 hours but should have some results tomorrow.&lt;/p&gt;</comment>
                            <comment id="12755918" author="lenn0x" created="Wed, 16 Sep 2009 07:40:02 +0000"  >&lt;p&gt;This needs to be rebased, I can&apos;t apply the last patch&lt;/p&gt;</comment>
                            <comment id="12756066" author="jbellis" created="Wed, 16 Sep 2009 14:51:53 +0000"  >&lt;p&gt;rebased&lt;/p&gt;</comment>
                            <comment id="12756111" author="lenn0x" created="Wed, 16 Sep 2009 17:12:47 +0000"  >&lt;p&gt;Tested on our cluster. Much better improvement! Before we were seeing 2-7GB of heap usage now its under 700MB.&lt;/p&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="12756787" author="jbellis" created="Thu, 17 Sep 2009 21:10:01 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                            <comment id="12757147" author="hudson" created="Fri, 18 Sep 2009 13:03:42 +0000"  >&lt;p&gt;Integrated in Cassandra #201 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Cassandra/201/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Cassandra/201/&lt;/a&gt;)&lt;br/&gt;
    Replace PriorityQueue mess with a CompactionIterator that efficiently yields compacted Rows from a set of sstables by feeding CollationIterator into a ReducingIterator transform.  (&quot;Efficiently&quot; means we never deserialize data until it is needed, so the number of sstables that can be compacted at once is  virtually unlimited, and if only one sstable contains a given key that row data will be copied over without an intermediate de/serialize step.) This is a very natural fit for the compaction algorithm and almost entirely gets rid of duplicated code between doFileCompaction and doAntiCompaction.&lt;br/&gt;
patch by jbellis; reviewed by goffinet for &lt;br/&gt;
allow ReducingIterator to reduce from one type to a different one&lt;br/&gt;
patch by jbellis; reviewed by goffinet for &lt;br/&gt;
copy FileStruct to SSTableScanner and remove cruft.  Migrate getKeyRange to new scanner class.&lt;br/&gt;
patch by jbellis; reviewed by goffinet for &lt;br/&gt;
minor fixes&lt;br/&gt;
patch by jbellis; reviewed by goffinet for &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12419775" name="ASF.LICENSE.NOT.GRANTED--0001-CASSANDRA-436-minor-fixes.txt" size="2101" author="jbellis" created="Wed, 16 Sep 2009 14:39:37 +0000"/>
                            <attachment id="12419547" name="ASF.LICENSE.NOT.GRANTED--0001-CASSANDRA-436-minor-fixes.txt" size="2101" author="jbellis" created="Mon, 14 Sep 2009 17:49:42 +0000"/>
                            <attachment id="12419776" name="ASF.LICENSE.NOT.GRANTED--0002-copy-FileStruct-to-SSTableScanner-and-remove-cruft.-M.txt" size="15089" author="jbellis" created="Wed, 16 Sep 2009 14:39:38 +0000"/>
                            <attachment id="12419548" name="ASF.LICENSE.NOT.GRANTED--0002-copy-FileStruct-to-SSTableScanner-and-remove-cruft.-M.txt" size="15089" author="jbellis" created="Mon, 14 Sep 2009 17:49:42 +0000"/>
                            <attachment id="12419777" name="ASF.LICENSE.NOT.GRANTED--0003-allow-ReducingIterator-to-reduce-from-one-type-to-a-di.txt" size="4362" author="jbellis" created="Wed, 16 Sep 2009 14:39:38 +0000"/>
                            <attachment id="12419549" name="ASF.LICENSE.NOT.GRANTED--0003-allow-ReducingIterator-to-reduce-from-one-type-to-a-di.txt" size="4362" author="jbellis" created="Mon, 14 Sep 2009 17:49:42 +0000"/>
                            <attachment id="12419778" name="ASF.LICENSE.NOT.GRANTED--0004-Replace-PriorityQueue-mess-with-a-CompactionIterator-t.txt" size="34742" author="jbellis" created="Wed, 16 Sep 2009 14:39:38 +0000"/>
                            <attachment id="12419550" name="ASF.LICENSE.NOT.GRANTED--0004-Replace-PriorityQueue-mess-with-a-CompactionIterator-t.txt" size="34752" author="jbellis" created="Mon, 14 Sep 2009 17:49:42 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19689</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 10 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0fyx3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>91255</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>