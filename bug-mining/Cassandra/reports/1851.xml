<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:35:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-4832] AssertionError: keys must not be empty</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-4832</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I&apos;m getting errors like this logged:&lt;/p&gt;

&lt;p&gt; INFO 07:08:32,104 Compacting &lt;span class=&quot;error&quot;&gt;&amp;#91;SSTableReader(path=&amp;#39;/var/lib/cassandra/data/Fusion/quoteinfo/Fusion-quoteinfo.quoteinfo_search_value_idx-hf-114-Data.db&amp;#39;), SSTableReader(path=&amp;#39;/var/lib/cassandra/data/Fusion/quoteinfo/Fusion-quoteinfo.quoteinfo_search_value_idx-hf-113-Data.db&amp;#39;), SSTableReader(path=&amp;#39;/var/lib/cassandra/data/Fusion/quoteinfo/Fusion-quoteinfo.quoteinfo_search_value_idx-hf-110-Data.db&amp;#39;), SSTableReader(path=&amp;#39;/var/lib/cassandra/data/Fusion/quoteinfo/Fusion-quoteinfo.quoteinfo_search_value_idx-hd-108-Data.db&amp;#39;), SSTableReader(path=&amp;#39;/var/lib/cassandra/data/Fusion/quoteinfo/Fusion-quoteinfo.quoteinfo_search_value_idx-hd-106-Data.db&amp;#39;), SSTableReader(path=&amp;#39;/var/lib/cassandra/data/Fusion/quoteinfo/Fusion-quoteinfo.quoteinfo_search_value_idx-hd-107-Data.db&amp;#39;), SSTableReader(path=&amp;#39;/var/lib/cassandra/data/Fusion/quoteinfo/Fusion-quoteinfo.quoteinfo_search_value_idx-hf-112-Data.db&amp;#39;), SSTableReader(path=&amp;#39;/var/lib/cassandra/data/Fusion/quoteinfo/Fusion-quoteinfo.quoteinfo_search_value_idx-hf-109-Data.db&amp;#39;), SSTableReader(path=&amp;#39;/var/lib/cassandra/data/Fusion/quoteinfo/Fusion-quoteinfo.quoteinfo_search_value_idx-hf-111-Data.db&amp;#39;)&amp;#93;&lt;/span&gt;&lt;br/&gt;
ERROR 07:08:32,108 Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:5,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.AssertionError: Keys must not be empty&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableWriter.beforeAppend(SSTableWriter.java:133)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableWriter.append(SSTableWriter.java:154)&lt;br/&gt;
        at org.apache.cassandra.db.compaction.CompactionTask.execute(CompactionTask.java:159)&lt;br/&gt;
        at org.apache.cassandra.db.compaction.CompactionManager$1.runMayThrow(CompactionManager.java:154)&lt;br/&gt;
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:30)&lt;br/&gt;
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441)&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)&lt;br/&gt;
        at java.util.concurrent.FutureTask.run(FutureTask.java:138)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:662)&lt;/p&gt;

&lt;p&gt;I&apos;m not really sure when this started happening; they tend to be logged during a repair but I can&apos;t reproduce the error 100% reliably.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Debian 6.0.5&lt;/p&gt;</environment>
        <key id="12612366">CASSANDRA-4832</key>
            <summary>AssertionError: keys must not be empty</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mithrandi">Tristan Seligmann</assignee>
                                    <reporter username="mithrandi">Tristan Seligmann</reporter>
                        <labels>
                            <label>indexing</label>
                    </labels>
                <created>Thu, 18 Oct 2012 05:15:28 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:25 +0000</updated>
                            <resolved>Mon, 22 Oct 2012 16:50:31 +0000</resolved>
                                        <fixVersion>1.1.7</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="13478687" author="mithrandi" created="Thu, 18 Oct 2012 05:31:58 +0000"  >&lt;p&gt;Actually, it seems like this gets logged any time Cassandra tries to flush this column family now.&lt;/p&gt;</comment>
                            <comment id="13478741" author="mithrandi" created="Thu, 18 Oct 2012 06:55:31 +0000"  >&lt;p&gt;After some further investigation, it looks like this began after I upgraded from 1.1.2 to 1.1.6. The assertion seems to have been introduced as part of some debugging in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4687&quot; title=&quot;Exception: DecoratedKey(xxx, yyy) != DecoratedKey(zzz, kkk)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4687&quot;&gt;&lt;del&gt;CASSANDRA-4687&lt;/del&gt;&lt;/a&gt;. I&apos;m not familiar with the code at all, but it seems to me that perhaps the assertion is bogus? If I have a secondary index on a particular column, and that column has an empty value in some row, would this not result in an empty key in the secondary index column family?&lt;/p&gt;</comment>
                            <comment id="13479512" author="mithrandi" created="Fri, 19 Oct 2012 00:08:04 +0000"  >&lt;p&gt;I modified my application to avoid inserting the empty column in question (which was a bug anyway; if that particular column was empty, the application should not have been doing an insert at all) and the problem has gone away, so it seems like my hypothesis is at least partially correct. I&apos;m going to attempt to reproduce this in a more controlled environment now that my immediate issue in production has been resolved.&lt;/p&gt;</comment>
                            <comment id="13480477" author="jbellis" created="Fri, 19 Oct 2012 22:45:32 +0000"  >&lt;p&gt;you&apos;re right that the assert is bogus.  removed it in 72dcc298d335721c053444249c157e9a6431ebea.&lt;/p&gt;</comment>
                            <comment id="13480848" author="cherro" created="Sat, 20 Oct 2012 22:35:19 +0000"  >&lt;p&gt;Came across this investigating an apparent deadlock in Schema Migrations.&lt;/p&gt;

&lt;p&gt;If this assertion fails on the flushWriter executor, it blocks indefinitely. Anything upstream locking-wise gets stuck also. This was on 1.1.6.&lt;/p&gt;

&lt;p&gt;Log output below, thread dump attached.&lt;/p&gt;

&lt;p&gt;ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:3&amp;#93;&lt;/span&gt; 2012-10-19 22:27:56,948 org.apache.cassandra.service.AbstractCassandraDaemon Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:3,5,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.AssertionError: Keys must not be empty&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableWriter.beforeAppend(SSTableWriter.java:133)&lt;br/&gt;
        at org.apache.cassandra.io.sstable.SSTableWriter.append(SSTableWriter.java:176)&lt;br/&gt;
        at org.apache.cassandra.db.Memtable.writeSortedContents(Memtable.java:295)&lt;br/&gt;
        at org.apache.cassandra.db.Memtable.access$600(Memtable.java:48)&lt;br/&gt;
        at org.apache.cassandra.db.Memtable$5.runMayThrow(Memtable.java:316)&lt;br/&gt;
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:30)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:662)&lt;/p&gt;
</comment>
                            <comment id="13481209" author="e1zorro" created="Mon, 22 Oct 2012 06:44:06 +0000"  >&lt;p&gt;I&apos;ve run into the same symptoms as Chris, but while attempting to migrate data between a 1.1.1 cluster and 1.1.6.&lt;/p&gt;

&lt;p&gt;Whilst using sstableloader to import the data, nodes would hit certain column indexes and stop processing further requests once the assertion was thrown - restarting the node would almost immediately throw the assertion again, and the node would just fail to rejoin the ring.&lt;/p&gt;

&lt;p&gt;tpstats would show active flushwriter tasks but no further node activity.&lt;/p&gt;

&lt;p&gt;We had to work around the issue by:&lt;/p&gt;

&lt;p&gt;1. Removing all indexes from our target cluster schema&lt;br/&gt;
2. Importing the data via sstableloader&lt;br/&gt;
3. Scanning through relevant column families and inserting data into any empty indexed columns&lt;br/&gt;
4. Re-applying the indexes to the target cluster schema&lt;/p&gt;

&lt;p&gt;Only then was the migration successful.&lt;/p&gt;

&lt;p&gt;I&apos;ll also note that attempting to apply an index to a column which has null data will also throw the cluster out of sync as the nodes which throw the assertion fail to migrate their schemas properly&lt;/p&gt;

&lt;p&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;Creating index: Transactions.TransactionsCountryCode&amp;#93;&lt;/span&gt; 2012-10-21 07:45:25,978 ColumnFamilyStore.java (line 659) Enqueuing flush of Memtable-Transactions.TransactionsCountryCode@1802367190(38862/169512 serialized/live bytes, 762 ops)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;Creating index: Transactions.TransactionsStatus&amp;#93;&lt;/span&gt; 2012-10-21 07:45:25,980 ColumnFamilyStore.java (line 659) Enqueuing flush of Memtable-Transactions.TransactionsStatus@673679943(38862/125966 serialized/live bytes, 762 ops)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:1&amp;#93;&lt;/span&gt; 2012-10-21 07:45:25,987 Memtable.java (line 264) Writing Memtable-Transactions.TransactionsCountryCode@1802367190(38862/169512 serialized/live bytes, 762 ops)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:2&amp;#93;&lt;/span&gt; 2012-10-21 07:45:26,004 Memtable.java (line 264) Writing Memtable-Transactions.TransactionsStatus@673679943(38862/125966 serialized/live bytes, 762 ops)&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:1&amp;#93;&lt;/span&gt; 2012-10-21 07:45:26,004 AbstractCassandraDaemon.java (line 135) Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:1,5,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.AssertionError: Keys must not be empty&lt;br/&gt;
	at org.apache.cassandra.io.sstable.SSTableWriter.beforeAppend(SSTableWriter.java:133)&lt;br/&gt;
	at org.apache.cassandra.io.sstable.SSTableWriter.append(SSTableWriter.java:176)&lt;br/&gt;
	at org.apache.cassandra.db.Memtable.writeSortedContents(Memtable.java:295)&lt;br/&gt;
	at org.apache.cassandra.db.Memtable.access$600(Memtable.java:48)&lt;br/&gt;
	at org.apache.cassandra.db.Memtable$5.runMayThrow(Memtable.java:316)&lt;br/&gt;
	at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:30)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:662)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:2&amp;#93;&lt;/span&gt; 2012-10-21 07:45:26,049 Memtable.java (line 305) Completed flushing /var/lib/cassandra/data/xxxxxx/Transactions/xxxxxx-Transactions.TransactionsStatus-hf-2-Data.db (35259 bytes) for commitlog position ReplayPosition(segmentId=1350805525722, position=0)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;Creating index: Transactions.TransactionsLastUpdateDate&amp;#93;&lt;/span&gt; 2012-10-21 07:45:26,313 ColumnFamilyStore.java (line 659) Enqueuing flush of Memtable-Transactions.TransactionsLastUpdateDate@1912098049(38862/240277 serialized/live bytes, 762 ops)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:2&amp;#93;&lt;/span&gt; 2012-10-21 07:45:26,314 Memtable.java (line 264) Writing Memtable-Transactions.TransactionsLastUpdateDate@1912098049(38862/240277 serialized/live bytes, 762 ops)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:2&amp;#93;&lt;/span&gt; 2012-10-21 07:45:26,743 Memtable.java (line 305) Completed flushing /var/lib/cassandra/data/xxxxxx/Transactions/xxxxxx-Transactions.TransactionsLastUpdateDate-hf-2-Data.db (37024 bytes) for commitlog position ReplayPosition(segmentId=1350805525722, position=0)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2012-10-21 07:45:27,052 CommitLogReplayer.java (line 272) Finished reading /var/lib/cassandra/commitlog/CommitLog-1350768744805.log&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; 2012-10-21 07:45:27,054 ColumnFamilyStore.java (line 659) Enqueuing flush of Memtable-Versions@1851630436(83/103 serialized/live bytes, 3 ops)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:2&amp;#93;&lt;/span&gt; 2012-10-21 07:45:27,054 Memtable.java (line 264) Writing Memtable-Versions@1851630436(83/103 serialized/live bytes, 3 ops)&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;FlushWriter:2&amp;#93;&lt;/span&gt; 2012-10-21 07:45:27,061 Memtable.java (line 305) Completed flushing /var/lib/cassandra/data/system/Versions/system-Versions-hf-1-Data.db (247 bytes) for commitlog position ReplayPosition(segmentId=1350805525722, position=0)&lt;/p&gt;</comment>
                            <comment id="13499636" author="scottfines" created="Sun, 18 Nov 2012 07:17:44 +0000"  >&lt;p&gt;Is there an actual patch for this, or a Workaround? We see this same AssertionError when attempting to start our nodes; restarting the node usually works correctly, however.&lt;/p&gt;</comment>
                            <comment id="13499652" author="jbellis" created="Sun, 18 Nov 2012 09:59:09 +0000"  >&lt;p&gt;The patch to fix this is git commit 72dcc298d335721c053444249c157e9a6431ebea.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12617622">CASSANDRA-4991</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12550155" name="FlushWriterKeyAssertionBlock.txt" size="115302" author="cherro" created="Sat, 20 Oct 2012 22:35:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[mithrandi]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>249477</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 1 week, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0aeqn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>58661</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>