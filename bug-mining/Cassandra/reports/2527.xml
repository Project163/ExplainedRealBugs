<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:42:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6418] auto_snapshots are not removable via &apos;nodetool clearsnapshot&apos;</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6418</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Snapshots of deleted CFs created via the &quot;auto_snapshot&quot; configuration parameter appear to not be tracked.  The result is that &apos;nodetool clearsnapshot &amp;lt;keyspace with deleted CFs&amp;gt;&apos; does nothing, and short of manually removing the files from the filesystem, deleted CFs remain indefinitely taking up space.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure if this is intended, but it seems pretty counter-intuitive.  I haven&apos;t found any documentation that indicates &quot;auto_snapshots&quot; would be ignored by &apos;nodetool clearsnapshot&apos;.&lt;/p&gt;</description>
                <environment>&lt;p&gt;auto_snapshot: true&lt;/p&gt;</environment>
        <key id="12681657">CASSANDRA-6418</key>
            <summary>auto_snapshots are not removable via &apos;nodetool clearsnapshot&apos;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lyubent">Lyuben Todorov</assignee>
                                    <reporter username="jre">J. Ryan Earl</reporter>
                        <labels>
                    </labels>
                <created>Wed, 27 Nov 2013 20:57:03 +0000</created>
                <updated>Wed, 11 Aug 2021 22:18:20 +0000</updated>
                            <resolved>Mon, 17 Mar 2014 18:05:06 +0000</resolved>
                                        <fixVersion>2.0.5</fixVersion>
                                    <component>Tool/nodetool</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13835359" author="lyubent" created="Fri, 29 Nov 2013 13:11:24 +0000"  >&lt;p&gt;Because cassandra uses CFStores to clear the snapshots once the CF is dropped, it goes out of scope. Changed the responsibility of clearing the snapshot from CFStore to o.a.c.db.Keyspace where the KS will use DatabaseDescriptor#getAllDataFileLocations to find the data directories then append the KS name and find all the CF dirs inside that KS directory instead of using the sstables&apos; directories. This can be extended to be more granular (per CF) where instead of using all the dirs inside the KS directory, the user can provide a list of CFs to be removed. &lt;/p&gt;</comment>
                            <comment id="13835516" author="jbellis" created="Fri, 29 Nov 2013 19:23:30 +0000"  >&lt;p&gt;Can you review &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mishail&quot; class=&quot;user-hover&quot; rel=&quot;mishail&quot;&gt;mishail&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="13839830" author="mishail" created="Thu, 5 Dec 2013 05:16:33 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    [javac] C:\Users\mishail\workspace\cassandra\src\java\org\apache\cassandra\db\compaction\CompactionManager.java:810: error: cannot find symbol
    [javac]                 cfs.clearSnapshot(snapshotName);
    [javac]                    ^
    [javac]   symbol:   method clearSnapshot(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;)
    [javac]   location: variable cfs of type ColumnFamilyStore
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For &lt;b&gt;getAllKSDirectories&lt;/b&gt;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;List&amp;lt;File&amp;gt; snapshotDirs = new ArrayList();&lt;/tt&gt; .It&apos;s a raw data type.  You probably meant either &lt;tt&gt;newArrayList()&lt;/tt&gt; or &lt;tt&gt;new ArrayList&amp;lt;&amp;gt;()&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;new File(dataDirectory + &quot;/&quot;  + ksName)&lt;/tt&gt; and &lt;tt&gt;File(dataDirectory + &quot;/&quot;  + ksName + &quot;/&quot; + cfDir)&lt;/tt&gt; - you should use &lt;tt&gt;org.apache.cassandra.db.Directories.join(String...)&lt;/tt&gt; instead that concatenation.&lt;/li&gt;
	&lt;li&gt;I think it would be better to use one of &lt;tt&gt;File.listFiles&lt;/tt&gt; methods instead of &lt;tt&gt;File.list()&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13840044" author="lyubent" created="Thu, 5 Dec 2013 12:18:05 +0000"  >&lt;p&gt;v2 adds a CFS#clearSnapshot function, and addresses all the nits.&lt;/p&gt;</comment>
                            <comment id="13841036" author="mishail" created="Fri, 6 Dec 2013 06:45:39 +0000"  >&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;getCFDirectory&lt;/tt&gt; assumes that CF resides in a single location. If I&apos;m correct, a CF can be in multiple dirs from &lt;tt&gt;DatabaseDescriptor.getAllDataFileLocations()&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;I suspect &lt;tt&gt;File.listFiles()&lt;/tt&gt; can return NULL if a directory doesn&apos;t exist&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Minor remarks&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;cfDir.exists() &amp;amp;&amp;amp; cfDir.isDirectory()&lt;/tt&gt; can be reduced to just &lt;tt&gt;cfDir.isDirectory()&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;You can use &lt;tt&gt;dataFileLocations&lt;/tt&gt; instead of &lt;tt&gt;DatabaseDescriptor.getAllDataFileLocations()&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13845983" author="lyubent" created="Thu, 12 Dec 2013 01:38:34 +0000"  >&lt;p&gt;Changed getCFDirectory to return a list of directories and added a check to ensure that CFs exist in v3.&lt;/p&gt;</comment>
                            <comment id="13854691" author="mishail" created="Sat, 21 Dec 2013 00:05:16 +0000"  >&lt;p&gt;Looking at that duplicated code in &lt;tt&gt;getKSDirectories&lt;/tt&gt; and &lt;tt&gt;getCFDirectory&lt;/tt&gt;, and in &lt;tt&gt;getCFDirectory&lt;/tt&gt; and &lt;tt&gt;Directories&lt;/tt&gt;&apos;s constructor, it occured to me that we don&apos;t need to call &lt;tt&gt;getCFDirectory&lt;/tt&gt; in a static context. The only place it&apos;s used is &lt;tt&gt;doValidationCompaction&lt;/tt&gt; where we always have a reference to CFS.&lt;/p&gt;

&lt;p&gt;I&apos;m attaching V4 of the patch. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lyubent&quot; class=&quot;user-hover&quot; rel=&quot;lyubent&quot;&gt;lyubent&lt;/a&gt; what do you think?&lt;/p&gt;</comment>
                            <comment id="13854741" author="lyubent" created="Sat, 21 Dec 2013 01:37:32 +0000"  >&lt;p&gt;LGTM, attaching v5 which adds a space to the for statement in &lt;tt&gt;Directories#getKSChildDirectories&lt;/tt&gt;... ocd ftw.&lt;/p&gt;</comment>
                            <comment id="13854759" author="mishail" created="Sat, 21 Dec 2013 02:25:16 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13854804" author="jbellis" created="Sat, 21 Dec 2013 06:36:46 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                            <comment id="13935309" author="nickmbailey" created="Fri, 14 Mar 2014 17:41:47 +0000"  >&lt;p&gt;This doesn&apos;t handle the entire keyspace no longer existing. Due to calling &apos;getValidKeyspace&apos; in storage service.&lt;/p&gt;</comment>
                            <comment id="13938121" author="nickmbailey" created="Mon, 17 Mar 2014 18:00:53 +0000"  >&lt;p&gt;Re-opening, let me know if I should create a separate ticket.&lt;/p&gt;</comment>
                            <comment id="13938129" author="mishail" created="Mon, 17 Mar 2014 18:05:06 +0000"  >&lt;p&gt;Let&apos;s use &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6821&quot; title=&quot;Cassandra can&amp;#39;t delete snapshots for keyspaces that no longer exist.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6821&quot;&gt;&lt;del&gt;CASSANDRA-6821&lt;/del&gt;&lt;/a&gt; fro that&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12699459">CASSANDRA-6821</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12687027">CASSANDRA-6540</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13394563">CASSANDRA-16843</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12616383" name="6418_cassandra-2.0.patch" size="3179" author="lyubent" created="Fri, 29 Nov 2013 13:12:13 +0000"/>
                            <attachment id="12619946" name="6418_cassandra-2.0_v5.patch" size="3731" author="lyubent" created="Sat, 21 Dec 2013 01:37:32 +0000"/>
                            <attachment id="12617156" name="6418_v2.patch" size="3993" author="lyubent" created="Thu, 5 Dec 2013 12:18:05 +0000"/>
                            <attachment id="12618337" name="6418_v3_cassandra-2.0.patch" size="3917" author="lyubent" created="Thu, 12 Dec 2013 01:38:34 +0000"/>
                            <attachment id="12619937" name="CASSANDRA-2.0-6418_v4.patch" size="4177" author="mishail" created="Sat, 21 Dec 2013 00:05:16 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[lyubent]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>360921</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 36 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1q7t3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>361220</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12325023">2.0.2</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>mishail</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[mishail]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>