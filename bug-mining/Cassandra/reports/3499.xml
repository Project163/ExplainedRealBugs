<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:52:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-9135] testScrubCorruptedCounterRow is failing under test-compression target</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-9135</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;org.apache.cassandra.db.ScrubTest.testScrubCorruptedCounterRow is failing with the following stack trace:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;org.apache.cassandra.io.sstable.CorruptSSTableException: org.apache.cassandra.io.compress.CorruptBlockException: (/home/automaton/cassandra/build/test/cassandra/data/Keyspace1/Counter1/Keyspace1-Counter1-jb-1-Data.db): corruption detected, chunk at 0 of length 79.
	at org.apache.cassandra.io.compress.CompressedRandomAccessReader.reBuffer(CompressedRandomAccessReader.java:91)
	at org.apache.cassandra.io.compress.CompressedThrottledReader.reBuffer(CompressedThrottledReader.java:41)
	at org.apache.cassandra.io.util.RandomAccessReader.seek(RandomAccessReader.java:283)
	at org.apache.cassandra.db.compaction.Scrubber.scrub(Scrubber.java:243)
	at org.apache.cassandra.db.ScrubTest.testScrubCorruptedCounterRow(ScrubTest.java:124)
Caused by: org.apache.cassandra.io.compress.CorruptBlockException: (/home/automaton/cassandra/build/test/cassandra/data/Keyspace1/Counter1/Keyspace1-Counter1-jb-1-Data.db): corruption detected, chunk at 0 of length 79.
	at org.apache.cassandra.io.compress.CompressedRandomAccessReader.decompressChunk(CompressedRandomAccessReader.java:122)
	at org.apache.cassandra.io.compress.CompressedRandomAccessReader.reBuffer(CompressedRandomAccessReader.java:87)
Caused by: java.io.IOException: FAILED_TO_UNCOMPRESS(5)
	at org.xerial.snappy.SnappyNative.throw_error(SnappyNative.java:78)
	at org.xerial.snappy.SnappyNative.rawUncompress(Native Method)
	at org.xerial.snappy.Snappy.rawUncompress(Snappy.java:395)
	at org.apache.cassandra.io.compress.SnappyCompressor.uncompress(SnappyCompressor.java:93)
	at org.apache.cassandra.io.compress.CompressedRandomAccessReader.decompressChunk(CompressedRandomAccessReader.java:118)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;ve bisected back 400 commits and can&apos;t find a time that this passed. Reproduce on 2.0-head with the following command:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ant test-compression -Dtest.name=ScrubTest&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12819432">CASSANDRA-9135</key>
            <summary>testScrubCorruptedCounterRow is failing under test-compression target</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thobbs">Tom Hobbs</assignee>
                                    <reporter username="philipthompson">Philip Thompson</reporter>
                        <labels>
                    </labels>
                <created>Wed, 8 Apr 2015 19:27:43 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:15 +0000</updated>
                            <resolved>Wed, 15 Apr 2015 22:53:33 +0000</resolved>
                                        <fixVersion>2.0.15</fixVersion>
                    <fixVersion>2.1.5</fixVersion>
                                    <component>Legacy/Testing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14486120" author="philipthompson" created="Wed, 8 Apr 2015 21:43:22 +0000"  >&lt;p&gt;Happening on both 2.0-head and 2.1-head, but not trunk&lt;/p&gt;</comment>
                            <comment id="14486194" author="thobbs" created="Wed, 8 Apr 2015 22:20:38 +0000"  >&lt;p&gt;The basic problem is that scrub can&apos;t currently handle corrupted compressed chunks.  I could make this test be skipped when compression is enabled during the tests, but really, this is something that scrub needs to be able to handle.&lt;/p&gt;

&lt;p&gt;I&apos;ve opened &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9140&quot; title=&quot;Scrub should handle corrupted compressed chunks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9140&quot;&gt;&lt;del&gt;CASSANDRA-9140&lt;/del&gt;&lt;/a&gt; to make that improvement to scrub.  I&apos;ll post a patch to skip the test for now.&lt;/p&gt;</comment>
                            <comment id="14486244" author="thobbs" created="Wed, 8 Apr 2015 22:43:23 +0000"  >&lt;p&gt;Also, the reason that the test is not failing on trunk is that the &lt;tt&gt;-Dcassandra.test.compression&lt;/tt&gt; setting isn&apos;t being honored by all unit tests now that schema definitions have been broken up into individual tests.  I&apos;ll attach a patch for that as well.&lt;/p&gt;</comment>
                            <comment id="14486349" author="thobbs" created="Wed, 8 Apr 2015 23:46:13 +0000"  >&lt;p&gt;I created &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9140&quot; title=&quot;Scrub should handle corrupted compressed chunks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9140&quot;&gt;&lt;del&gt;CASSANDRA-9140&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9141&quot; title=&quot;Scrub errors when attempting to abort&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9141&quot;&gt;&lt;del&gt;CASSANDRA-9141&lt;/del&gt;&lt;/a&gt; to address a couple of problems with scrub.&lt;/p&gt;

&lt;p&gt;The 9135-2.0-skip-test.txt patch will skip the test for now when compression is enabled.&lt;/p&gt;

&lt;p&gt;The 9135-trunk-fix-compression.txt patch updates the unit tests in trunk to make sure they use compressed sstables whenever the compression flag is set.&lt;/p&gt;</comment>
                            <comment id="14497161" author="philipthompson" created="Wed, 15 Apr 2015 22:41:48 +0000"  >&lt;p&gt;Test fails due to the skip as expected. Patch looks good, +1.&lt;/p&gt;</comment>
                            <comment id="14497177" author="thobbs" created="Wed, 15 Apr 2015 22:53:33 +0000"  >&lt;p&gt;Thanks, committed the skip patch to 2.0, 2.1, and trunk and committed the trunk patch to trunk only.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12819498">CASSANDRA-9141</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12819479">CASSANDRA-9140</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12724062" name="9135-2.0-skip-test.txt" size="1159" author="thobbs" created="Wed, 8 Apr 2015 23:43:17 +0000"/>
                            <attachment id="12724061" name="9135-trunk-fix-compression.txt" size="22268" author="thobbs" created="Wed, 8 Apr 2015 23:30:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thobbs]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 31 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2czq7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>philipthompson</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[philipthompson]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>