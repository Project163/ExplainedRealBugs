<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:12:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-14919] Regression in paging queries in mixed version clusters </title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-14919</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;The changes to handling legacy bounds in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14568&quot; title=&quot;Static collection deletions are corrupted in 3.0 -&amp;gt; 2.{1,2} messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14568&quot;&gt;&lt;del&gt;CASSANDRA-14568&lt;/del&gt;&lt;/a&gt;/&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14749&quot; title=&quot;Collection Deletions for Dropped Columns in 2.1/3.0 mixed-mode can delete rows&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14749&quot;&gt;&lt;del&gt;CASSANDRA-14749&lt;/del&gt;&lt;/a&gt;/&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14912&quot; title=&quot;LegacyLayout errors on collection tombstones from dropped columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14912&quot;&gt;&lt;del&gt;CASSANDRA-14912&lt;/del&gt;&lt;/a&gt; break paging queries where the coordinator is a legacy node and the replica is an upgraded node. &lt;/p&gt;

&lt;p&gt;The long-held assumption made by &lt;tt&gt;LegacyLayout::decodeBound&lt;/tt&gt; that &quot;There can be more components than the clustering size only in the case this is the bound of a collection range tombstone.&quot; is not true as serialized paged read commands may also include these type of bounds in their &lt;tt&gt;SliceQueryFilter&lt;/tt&gt;. The additional checks the more recent tickets add cause such queries to error when processed by a 3.0 replica.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13202226">CASSANDRA-14919</key>
            <summary>Regression in paging queries in mixed version clusters </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10000" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Urgent</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="samt">Sam Tunnicliffe</assignee>
                                    <reporter username="samt">Sam Tunnicliffe</reporter>
                        <labels>
                    </labels>
                <created>Tue, 4 Dec 2018 10:24:14 +0000</created>
                <updated>Fri, 2 Aug 2019 03:00:04 +0000</updated>
                            <resolved>Thu, 6 Dec 2018 16:18:25 +0000</resolved>
                                        <fixVersion>3.0.18</fixVersion>
                    <fixVersion>3.11.4</fixVersion>
                                    <component>CQL/Interpreter</component>
                    <component>Messaging/Internode</component>
                    <component>Messaging/Thrift</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16708819" author="beobal" created="Tue, 4 Dec 2018 14:59:48 +0000"  >&lt;p&gt;This issue showed up during work on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14421&quot; title=&quot;Reenable upgrade tests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14421&quot;&gt;&lt;del&gt;CASSANDRA-14421&lt;/del&gt;&lt;/a&gt; to re-enable the upgrade dtests. Using &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aweisberg&quot; class=&quot;user-hover&quot; rel=&quot;aweisberg&quot;&gt;aweisberg&lt;/a&gt;&apos;s dtest branch as a starting point, I&apos;ve verified that the upgrade tests concerned with paging are now passing (after some additional tweaks - see &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14920&quot; title=&quot;Some comparisons used for verifying paging queries in dtests only test the column names and not values&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14920&quot;&gt;&lt;del&gt;CASSANDRA-14920&lt;/del&gt;&lt;/a&gt;). I&apos;ve only run this locally though and haven&apos;t updated the CircleCI config to add those tests, leaving that to 14421.&lt;/p&gt;

&lt;p&gt;The CircleCI runs below are running with the current dtest master branch:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;CI&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/beobal/cassandra/tree/14919-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;14919-3.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/beobal/workflows/cassandra/tree/cci%2F14919-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;circle&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/beobal/cassandra/tree/14919-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;14919-3.11&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/beobal/workflows/cassandra/tree/cci%2F14919-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;circle&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;




&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16708908" author="aweisberg" created="Tue, 4 Dec 2018 15:53:31 +0000"  >&lt;p&gt;Typo in the links to the code.&lt;/p&gt;</comment>
                            <comment id="16708969" author="beobal" created="Tue, 4 Dec 2018 16:41:37 +0000"  >&lt;blockquote&gt;&lt;p&gt;Typo in the links to the code&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;oops, actually a failure to push those 2 branches. Fixed now&lt;/p&gt;</comment>
                            <comment id="16709312" author="benedict" created="Tue, 4 Dec 2018 21:57:31 +0000"  >&lt;p&gt;I&apos;m largely +1 the changes, but I wonder if we should be inserting some assertions around our expectations here.&lt;/p&gt;

&lt;p&gt;For instance, &lt;a href=&quot;https://github.com/beobal/cassandra/commit/b8bb748dca93deeae7c50319ab0634f599fedea9#diff-f53ee75d79fb30b497f6d1584d51d7d3R2429&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;, &lt;a href=&quot;https://github.com/beobal/cassandra/commit/b8bb748dca93deeae7c50319ab0634f599fedea9#diff-861bc950c82973fb8f97f179e35be7f3R1586&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; and &lt;a href=&quot;https://github.com/beobal/cassandra/commit/b8bb748dca93deeae7c50319ab0634f599fedea9#diff-f53ee75d79fb30b497f6d1584d51d7d3R374&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; at least we pretty much require that there be no column name in the payload?  If this is somehow present, something looks likely to have gone awry, since we are discarding it and have nothing in place to suggest this is OK (unlike &lt;a href=&quot;https://github.com/beobal/cassandra/commit/b8bb748dca93deeae7c50319ab0634f599fedea9#diff-861bc950c82973fb8f97f179e35be7f3R1093&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;)?&lt;/p&gt;

&lt;p&gt;I&apos;m also honestly not certain what the correct behaviour &lt;a href=&quot;https://github.com/beobal/cassandra/commit/b8bb748dca93deeae7c50319ab0634f599fedea9#diff-f53ee75d79fb30b497f6d1584d51d7d3R1245&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; is.  Presumably for thrift schemas, it is impossible to receive a collection name.  However I&apos;m very out-of-touch with the compatibility mechanisms for accessing CQL via thrift.  Can we legitimately receive a collection RT?  I doubt it, but I cannot be sure.&lt;/p&gt;</comment>
                            <comment id="16711443" author="beobal" created="Thu, 6 Dec 2018 13:32:21 +0000"  >&lt;blockquote&gt;&lt;p&gt;For instance, &lt;a href=&quot;https://github.com/beobal/cassandra/commit/b8bb748dca93deeae7c50319ab0634f599fedea9#diff-f53ee75d79fb30b497f6d1584d51d7d3R2429&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;, &lt;a href=&quot;https://github.com/beobal/cassandra/commit/b8bb748dca93deeae7c50319ab0634f599fedea9#diff-861bc950c82973fb8f97f179e35be7f3R1586&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; and &lt;a href=&quot;https://github.com/beobal/cassandra/commit/b8bb748dca93deeae7c50319ab0634f599fedea9#diff-f53ee75d79fb30b497f6d1584d51d7d3R374&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; at least we pretty much require that there be no column name in the payload? If this is somehow present, something looks likely to have gone awry, since we are discarding it and have nothing in place to suggest this is OK (unlike &lt;a href=&quot;https://github.com/beobal/cassandra/commit/b8bb748dca93deeae7c50319ab0634f599fedea9#diff-861bc950c82973fb8f97f179e35be7f3R1093&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;)? &#160;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Actually, in these slice cases (as opposed to RTs), this is safe and equivalent to the pre-14568/14749 behaviour. Previously, the column name element from a query slice would be erroneously identified as a collection name, but this was not problematic as we only ever used the &lt;tt&gt;LegacyBound.slice&lt;/tt&gt; field, which was correctly constructed as a result of the final element being popped from the list of components in &lt;tt&gt;decodeBound&lt;/tt&gt;. The same thing holds now, the difference being that we no longer incorrectly assign the &lt;tt&gt;LegacyBound&lt;/tt&gt; a collection name.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I&apos;m also honestly not certain what the correct behaviour here is. Presumably for thrift schemas, it is impossible to receive a collection name. However I&apos;m very out-of-touch with the compatibility mechanisms for accessing CQL via thrift. Can we legitimately receive a collection RT? I doubt it, but I cannot be sure.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;It&apos;s technically possible to receive a collection name here as they can always be hand rolled, but that&apos;s also fine. If a client were to send a deletion with a range slice that emulates a collection tombstone, we&apos;d process it as normal and delete the collection. It&apos;s going down exactly the same path as non-thrift requests, so an invalid slice bound (e.g. like a bound ending with a missing or non-collection column name) would be rejected.  &lt;/p&gt;</comment>
                            <comment id="16711474" author="benedict" created="Thu, 6 Dec 2018 13:52:25 +0000"  >&lt;blockquote&gt;&lt;p&gt;Actually, in these slice cases (as opposed to RTs), this is safe&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;But it isn&apos;t safe for the other end to have actually sent this, I think?  Since we ignore the value, we aren&apos;t going to be semantically equivalent to whatever was intended - either the other end has a bug, asking for something nonsensical, or we have a bug in that we treat it erroneously?&lt;/p&gt;

&lt;p&gt;With paging we know it is fine because there are comments indicating we expect the column name, and that our treatment of ignoring it is correct, but in these cases I&apos;m not sure it is logically possible to respond correctly to a request with this component?&lt;/p&gt;

&lt;p&gt;I agree ignoring it would be equivalent to 3.0.0 behaviour, but it might help our future selves to document and enforce these expectations.&lt;/p&gt;

&lt;p&gt;This isn&apos;t something I would block commit on, if you disagree though.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;It&apos;s technically possible to receive a collection name here&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I agree it&apos;s technically possible, I am just unsure if our API intended to actually support this, and if it is misuse to use it (if we are to introduce assertions).  Looking at 2.2, though, we only refuse super columns because our new schema cannot support them.  So it&apos;s probably the case that this remains equivalent in behaviour to 2.2, which is all that really matters.&lt;/p&gt;

&lt;p&gt;+1, however you decide to proceed.&lt;/p&gt;</comment>
                            <comment id="16711652" author="beobal" created="Thu, 6 Dec 2018 16:18:25 +0000"  >&lt;p&gt;I&apos;m all for helping our future selves and I hope that the comments and link to this discussion will do that. I&apos;ve stopped short of enforcing the expectations though, as what we have now fixes the breakage introduced by 14568/14749/14912 whilst retaining the fixes from those issues. It also preserves the behaviour of previous 3.0/3.x versions so I think this has the minimal risk of introducing new, unforeseen regressions. If it does transpire that there other cases where this existing behaviour is harmful, or this patch breaks something else we didn&apos;t consider, we can revisit then.&lt;/p&gt;

&lt;p&gt;Committed to 3.0 in &lt;tt&gt;11043610e38281f650f289a7f9286d306f1369e3&lt;/tt&gt; and merged to 3.11/trunk, thanks.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[samt]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12983" cascade-level=""><![CDATA[Availability]]></customfieldvalue>
                                <customfieldvalue key="12994" cascade-level="1"><![CDATA[Unavailable]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12966"><![CDATA[Challenging]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12970"><![CDATA[Unit Test]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 49 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|s0157c:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[benedict]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12333891">3.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>