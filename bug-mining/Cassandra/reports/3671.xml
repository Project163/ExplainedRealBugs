<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:55:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-9460] NullPointerException Creating Digest</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-9460</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;In the &lt;tt&gt;consistency_test.TestConsistency.short_read_test&lt;/tt&gt; dtest against cassandra-2.1, the following error occured:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ERROR [ReadRepairStage:3] 2015-05-22 16:35:25,034 CassandraDaemon.java:223 - Exception in thread Thread[ReadRepairStage:3,5,main]
java.lang.NullPointerException: null
    at org.apache.cassandra.db.ColumnFamily.updateDigest(ColumnFamily.java:390) ~[main/:na]
    at org.apache.cassandra.db.ColumnFamily.digest(ColumnFamily.java:383) ~[main/:na]
    at org.apache.cassandra.service.RowDigestResolver.resolve(RowDigestResolver.java:84) ~[main/:na]
    at org.apache.cassandra.service.RowDigestResolver.resolve(RowDigestResolver.java:28) ~[main/:na]
    at org.apache.cassandra.service.ReadCallback$AsyncRepairRunner.run(ReadCallback.java:176) ~[main/:na]
    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) ~[na:1.7.0_80]
    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) ~[na:1.7.0_80]
    at java.lang.Thread.run(Thread.java:745) ~[na:1.7.0_80]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;From a glance at the code in the stacktrace, it looks like there was a null cell in the ColumnFamily that we were creating a digest of.  This error is probably particular to &quot;short reads&quot;.&lt;/p&gt;

&lt;p&gt;Here&apos;s the failing test: &lt;a href=&quot;http://cassci.datastax.com/job/cassandra-2.1_dtest/lastCompletedBuild/testReport/consistency_test/TestConsistency/short_read_test/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/job/cassandra-2.1_dtest/lastCompletedBuild/testReport/consistency_test/TestConsistency/short_read_test/&lt;/a&gt;.  I&apos;ve attached the logs for the node with the error.&lt;/p&gt;

&lt;p&gt;We saw this issue against 2.1, but the problem may also exist with 2.0 and/or 2.2.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12832216">CASSANDRA-9460</key>
            <summary>NullPointerException Creating Digest</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tjake">T Jake Luciani</assignee>
                                    <reporter username="thobbs">Tom Hobbs</reporter>
                        <labels>
                    </labels>
                <created>Fri, 22 May 2015 17:58:14 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:10 +0000</updated>
                            <resolved>Tue, 25 Aug 2015 13:22:05 +0000</resolved>
                                        <fixVersion>2.1.9</fixVersion>
                    <fixVersion>2.2.1</fixVersion>
                                    <component>Legacy/Local Write-Read Paths</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14558071" author="stefania" created="Mon, 25 May 2015 09:46:12 +0000"  >&lt;p&gt;I haven&apos;t been able to reproduce this at all unfortunately.&lt;/p&gt;

&lt;p&gt;It definitely looks like a cell was null but I could not see why it would be null, perhaps an issue with the bounds? What do we mean exactly by &quot;short reads&quot;?&lt;/p&gt;</comment>
                            <comment id="14558280" author="jbellis" created="Mon, 25 May 2015 14:15:45 +0000"  >&lt;p&gt;Short reads are when a query comes in with LIMIT N, and each replica returns N rows to the coordinator, but after merging the results together the coordinator has less than N rows left because of non-shared tombstones.  At that point the coordinator needs to request extra rows from the replicas to satisfy the original query.&lt;/p&gt;

&lt;p&gt;Look for &lt;tt&gt;short reads&lt;/tt&gt; in StorageProxy.&lt;/p&gt;</comment>
                            <comment id="14558689" author="stefania" created="Tue, 26 May 2015 04:53:25 +0000"  >&lt;p&gt;Thanks for the explanation. &lt;/p&gt;

&lt;p&gt;I think this might be the problem. In SP.fetchRows() at line 1347:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Row row = exec.get();
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (row != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
{
    exec.command.maybeTrim(row);
    rows.add(row);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This code can trim, i.e. remove cells from the responses stored in the resolver of ReadCallback. Here is the relevant code:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; TResolved get() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; ReadTimeoutException, DigestMismatchException
{
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!await(command.getTimeout(), TimeUnit.MILLISECONDS))
    {
        &lt;span class=&quot;code-comment&quot;&gt;// Same as &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; writes, see AbstractWriteResponseHandler
&lt;/span&gt;        ReadTimeoutException ex = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ReadTimeoutException(consistencyLevel, received, blockfor, resolver.isDataPresent());

        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (logger.isDebugEnabled())
            logger.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Read timeout: {}&quot;&lt;/span&gt;, ex.toString());
        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; ex;
    }

    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; blockfor == 1 ? resolver.getData() : resolver.resolve();
}

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void response(MessageIn&amp;lt;TMessage&amp;gt; message)
{
    resolver.preprocess(message);
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; n = waitingFor(message)
          ? recievedUpdater.incrementAndGet(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;)
          : received;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (n &amp;gt;= blockfor &amp;amp;&amp;amp; resolver.isDataPresent())
    {
        condition.signalAll();
        &lt;span class=&quot;code-comment&quot;&gt;// kick off a background digest comparison &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is a result that (may have) arrived after
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// the original resolve that get() kicks off as soon as the condition is signaled
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (blockfor &amp;lt; endpoints.size() &amp;amp;&amp;amp; n == endpoints.size())
            StageManager.getStage(Stage.READ_REPAIR).execute(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AsyncRepairRunner());
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;These lines may run in parallel with the trimming, therefore giving the NPE above, since SP only waits for the resolve() called in get(), not the one in the AsyncRepairRunner.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (blockfor &amp;lt; endpoints.size() &amp;amp;&amp;amp; n == endpoints.size())
    StageManager.getStage(Stage.READ_REPAIR).execute(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AsyncRepairRunner());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If I am correct AsyncRepairRunner could iterate on the same cf that might be trimmed.&lt;/p&gt;

&lt;p&gt;However I am really struggling to reproduce it.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thobbs&quot; class=&quot;user-hover&quot; rel=&quot;thobbs&quot;&gt;thobbs&lt;/a&gt; do you think this might explain it?&lt;/p&gt;</comment>
                            <comment id="14559407" author="thobbs" created="Tue, 26 May 2015 17:10:52 +0000"  >&lt;p&gt;Good work on investigating this! I think your guess is correct.  We definitely need to calculate digests from the untrimmed data, so it seems like we will need to ensure digest calculations have finished before trimming responses.&lt;/p&gt;

&lt;p&gt;Normally it would be easy to take a digest before returning results to the StorageProxy, because we normally only issue one &quot;data&quot; request and always have to block for that.  However, with speculative retries, we may have multiple data responses.  So, we should block until we have a digest of the first data response (when CL &amp;gt; ONE), but not block for subsequent data responses (which should not get returned to the SP, and thus should not get trimmed).&lt;/p&gt;</comment>
                            <comment id="14564931" author="stefania" created="Fri, 29 May 2015 15:05:37 +0000"  >&lt;p&gt;I&apos;ve attached a tentative patch for 2.1.&lt;/p&gt;

&lt;p&gt;Basically we just attach the digest to the response and avoid calculating it multiple times. I thought about other approaches but they would all involve some significant redesign. &lt;/p&gt;

&lt;p&gt;I&apos;ve also added some basic utests for the response resolvers. Do you think we need additional dtests or is consistency_test.py enough?&lt;/p&gt;</comment>
                            <comment id="14589864" author="thobbs" created="Wed, 17 Jun 2015 14:40:52 +0000"  >&lt;p&gt;Assigning &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blerer&quot; class=&quot;user-hover&quot; rel=&quot;blerer&quot;&gt;blerer&lt;/a&gt; to review.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Do you think we need additional dtests or is consistency_test.py enough?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think consistency_test.py is probably good enough, but since we know there can be a problem with race conditions, it might be good to make the test loop a few times instead of doing a single pass.&lt;/p&gt;</comment>
                            <comment id="14625649" author="stefania" created="Tue, 14 Jul 2015 01:14:44 +0000"  >&lt;p&gt;I&apos;ve rebased and it applied without conflict. The latest CI will be available here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-9460-2.1-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-9460-2.1-testall/lastCompletedBuild/testReport/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-9460-2.1-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-9460-2.1-dtest/lastCompletedBuild/testReport/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The dtest pull request with the additional loop is &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/pull/388&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14626276" author="blerer" created="Tue, 14 Jul 2015 12:17:57 +0000"  >&lt;p&gt;I would just have encapsulated:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (result.digest() == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
 {
     ByteBuffer digest = ColumnFamily.digest(result.row().cf);
     &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!result.updateDigest(digest))
         &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; digest.equals(result.digest()) :
                  &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.format(&lt;span class=&quot;code-quote&quot;&gt;&quot;Digest mismatch : %s vs %s&quot;&lt;/span&gt;, digest.array(), result.digest().array());
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 
&lt;p&gt;into &lt;tt&gt;ReadResponse&lt;/tt&gt; to avoid duplicating it within &lt;tt&gt;RowDigestResolver&lt;/tt&gt;. &lt;/p&gt;

&lt;p&gt;Otherwise, the patch look good to me. I am just a bit annoyed by the fact that we cannot reproduce it.&lt;/p&gt;

&lt;p&gt;Let&apos;s not forget to add this ticket to the next retrospective.&lt;/p&gt;
</comment>
                            <comment id="14627380" author="stefania" created="Wed, 15 Jul 2015 01:14:18 +0000"  >&lt;p&gt;I&apos;ve encapsulated the code above into &lt;tt&gt;ReadResponse&lt;/tt&gt;, thank you for spotting the code duplication. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I am just a bit annoyed by the fact that we cannot reproduce it.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;So am I. However it does reproduce regularly on Jenkins, for example 2.1 builds #162, #151, #147, etc. I&apos;ve added a loop that repeats 10 times the failing tests (short_read_test and short_read_reversed_test), so if it is still a problem we should hopefully notice quite quickly on Jenkins. &lt;/p&gt;</comment>
                            <comment id="14627872" author="blerer" created="Wed, 15 Jul 2015 10:41:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Stefania&quot; class=&quot;user-hover&quot; rel=&quot;stefania&quot;&gt;Stefania&lt;/a&gt; The patch did not apply to trunk. Can you provide another one for trunk? &lt;/p&gt;</comment>
                            <comment id="14629052" author="stefania" created="Thu, 16 Jul 2015 01:37:23 +0000"  >&lt;p&gt;We could write something similar for trunk but a simple merge will not work because &lt;tt&gt;ReadResponse&lt;/tt&gt; and &lt;tt&gt;ResponseResolver&lt;/tt&gt; have changed too much. However, I am not sure we need to do this because the original code that caused the problem in &lt;tt&gt;StorageProxy.fetchRows()&lt;/tt&gt; is no longer there:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Row row = exec.get();
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (row != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
{
    exec.command.maybeTrim(row);
    rows.add(row);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There is no more trimming in the read command in favor of an iterator based approach. So I don&apos;t think we need to cache the digest in the data responses. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt;: could the iterators used in calculating the digest in the asynchronous read repair task ever become invalid?&lt;/p&gt;

&lt;p&gt;&amp;#8211;&lt;/p&gt;

&lt;p&gt;On a different subject, we have received these two Coverity defects, I think the second one we can ignore because we have an assertion to protect against the NPE whilst the first one is trivial to fix, see &lt;a href=&quot;https://github.com/stef1927/cassandra/commit/7e65d2c8010e49579ffc8a5781c3e158356fef56&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this commit&lt;/a&gt;. Could you submit this commit too?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;** CID 125556:  FindBugs: Correctness  (FB.VA_FORMAT_STRING_BAD_CONVERSION_FROM_ARRAY)
/src/java/org/apache/cassandra/db/ReadResponse.java: 75 in org.apache.cassandra.db.ReadResponse.setDigest(java.nio.ByteBuffer)()


________________________________________________________________________________________________________
*** CID 125556:  FindBugs: Correctness  (FB.VA_FORMAT_STRING_BAD_CONVERSION_FROM_ARRAY)
/src/java/org/apache/cassandra/db/ReadResponse.java: 75 in org.apache.cassandra.db.ReadResponse.setDigest(java.nio.ByteBuffer)()
69         &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void setDigest(ByteBuffer digest)
70         {
71             ByteBuffer curr = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.digest;
72             &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!digestUpdater.compareAndSet(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;, curr, digest))
73             {
74                 &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; digest.equals(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.digest) :
&amp;gt;&amp;gt;&amp;gt;     CID 125556:  FindBugs: Correctness  (FB.VA_FORMAT_STRING_BAD_CONVERSION_FROM_ARRAY)
&amp;gt;&amp;gt;&amp;gt;     Argument of type &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] formatted in useless way.
75                     &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.format(&lt;span class=&quot;code-quote&quot;&gt;&quot;Digest mismatch : %s vs %s&quot;&lt;/span&gt;, digest.array(), &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.digest.array());
76             }
77         }
78
79         &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isDigestQuery()
80         {

** CID 125555:  Null pointer dereferences  (NULL_RETURNS)
/src/java/org/apache/cassandra/service/RangeSliceResponseResolver.java: 70 in org.apache.cassandra.service.RangeSliceResponseResolver.getData()()


________________________________________________________________________________________________________
*** CID 125555:  Null pointer dereferences  (NULL_RETURNS)
/src/java/org/apache/cassandra/service/RangeSliceResponseResolver.java: 70 in org.apache.cassandra.service.RangeSliceResponseResolver.getData()()
64             &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.sources = endpoints;
65         }
66
67         &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; List&amp;lt;Row&amp;gt; getData()
68         {
69             &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; !responses.isEmpty();
&amp;gt;&amp;gt;&amp;gt;     CID 125555:  Null pointer dereferences  (NULL_RETURNS)
&amp;gt;&amp;gt;&amp;gt;     Accessing field of &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; object &lt;span class=&quot;code-quote&quot;&gt;&quot;responses.peek()&quot;&lt;/span&gt;.
70             &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; responses.peek().payload.rows;
71         }
72
73         &lt;span class=&quot;code-comment&quot;&gt;// Note: &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; would deserialize the response a 2nd time &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; getData was called first.
&lt;/span&gt;74         &lt;span class=&quot;code-comment&quot;&gt;// (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is not currently an issue since we don&apos;t &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; read repair &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range queries.)
&lt;/span&gt;75         &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Iterable&amp;lt;Row&amp;gt; resolve()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14629346" author="slebresne" created="Thu, 16 Jul 2015 07:11:41 +0000"  >&lt;blockquote&gt;&lt;p&gt;could the iterators used in calculating the digest in the asynchronous read repair task ever become invalid?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No. No iterator is ever used concurrently, and each iterator in DataResolver (both for digest and actual response) are recreated from the raw bytes of the response which definitively cannot change/be invalidated. Pretty sure you can merge this to trunk with &lt;tt&gt;--strategy=ours&lt;/tt&gt; (a.k.a, skip the commit).&lt;/p&gt;</comment>
                            <comment id="14629349" author="stefania" created="Thu, 16 Jul 2015 07:16:43 +0000"  >&lt;p&gt;Thank you for clarifying.&lt;/p&gt;</comment>
                            <comment id="14629658" author="blerer" created="Thu, 16 Jul 2015 12:41:31 +0000"  >&lt;p&gt;Thanks for the patches.&lt;/p&gt;

&lt;p&gt;Committed:&lt;br/&gt;
initial patch: b16d8c9caa8afa0c03cd6e4077d272b0c575404b&lt;br/&gt;
error message fix: 9ff5d44c4286a8fdb433e4b580d3f6129745b93b&lt;/p&gt;</comment>
                            <comment id="14698902" author="stefania" created="Mon, 17 Aug 2015 00:30:05 +0000"  >&lt;p&gt;I think this is still happening in 2.1:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://cassci.datastax.com/job/cassandra-2.1_dtest/223/testReport/consistency_test/TestConsistency/short_read_reversed_test/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/job/cassandra-2.1_dtest/223/testReport/consistency_test/TestConsistency/short_read_reversed_test/&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Unexpected error in node1 node log: [&lt;span class=&quot;code-quote&quot;&gt;&apos;ERROR [ReadRepairStage:2] 2015-08-14 16:23:58,917 CassandraDaemon.java:223 - Exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[ReadRepairStage:2,5,main] java.lang.NullPointerException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; \tat org.apache.cassandra.db.ColumnFamily.updateDigest(ColumnFamily.java:390) ~[main/:na] \tat org.apache.cassandra.db.ColumnFamily.digest(ColumnFamily.java:383) ~[main/:na] \tat org.apache.cassandra.service.RowDigestResolver.resolve(RowDigestResolver.java:90) ~[main/:na] \tat org.apache.cassandra.service.RowDigestResolver.resolve(RowDigestResolver.java:28) ~[main/:na] \tat org.apache.cassandra.service.ReadCallback$AsyncRepairRunner.run(ReadCallback.java:191) ~[main/:na] \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) ~[na:1.7.0_80] \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) ~[na:1.7.0_80] \tat java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) ~[na:1.7.0_80]&apos;&lt;/span&gt;]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14709962" author="tjake" created="Mon, 24 Aug 2015 20:00:50 +0000"  >&lt;p&gt;I posted a version that avoids mutating the cf and makes a copy of just what was trimmed.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/tjake/cassandra/tree/9460&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;github&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/job/tjake-9460-dtest/1/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/job/tjake-9460-testall/1/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;unit tests&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="14710477" author="stefania" created="Tue, 25 Aug 2015 02:49:42 +0000"  >&lt;p&gt;Both patch and CI LGTM.&lt;/p&gt;

&lt;p&gt;Thank you so much for this, I hadn&apos;t realized how easy it is to create a copy of the column family.&lt;/p&gt;</comment>
                            <comment id="14711245" author="tjake" created="Tue, 25 Aug 2015 13:22:05 +0000"  >&lt;p&gt;Committed in 147fe6d69d2efac8db47da9058e9a19f8ddc99fd&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12734881" name="node2.log" size="77051" author="thobbs" created="Fri, 22 May 2015 17:58:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[tjake]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 13 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2f46v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>stefania_alborghetti</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[stefania_alborghetti]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>