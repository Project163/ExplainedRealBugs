<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:21:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-2759] Scrub could lose increments and replicate that loss</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-2759</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;If scrub cannot &apos;repair&apos; a corrupted row, it will skip it. On node A, if the row contains some sub-count for A id, those will be lost forever since A is the source of truth on it&apos;s current id. We should thus renew node A id when that happens to avoid this (not unlike we do in cleanup).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12509845">CASSANDRA-2759</key>
            <summary>Scrub could lose increments and replicate that loss</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="slebresne">Sylvain Lebresne</reporter>
                        <labels>
                            <label>counters</label>
                    </labels>
                <created>Fri, 10 Jun 2011 16:20:55 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:57 +0000</updated>
                            <resolved>Tue, 14 Jun 2011 09:18:25 +0000</resolved>
                                        <fixVersion>0.8.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13047268" author="slebresne" created="Fri, 10 Jun 2011 16:23:39 +0000"  >&lt;p&gt;Attached patch against 0.8.&lt;/p&gt;

&lt;p&gt;The patch also add a new startup option to renew the node id on startup. This could be useful if someone lose one of it&apos;s sstable (because of a bad disk for instance) and don&apos;t want to fully decommission that node.&lt;/p&gt;

&lt;p&gt;This could arguably be splitted in another ticket though.&lt;/p&gt;</comment>
                            <comment id="13047273" author="jbellis" created="Fri, 10 Jun 2011 16:28:41 +0000"  >&lt;p&gt;what is &quot;renewing a node id?&quot;&lt;/p&gt;</comment>
                            <comment id="13047285" author="slebresne" created="Fri, 10 Jun 2011 16:54:58 +0000"  >&lt;p&gt;It&apos;s picking a new UUID for the current node to use for new counter increment.&lt;/p&gt;

&lt;p&gt;The problem is that on a given node we store deltas for it&apos;s current nodeId (to avoid synchronized read-before-write, but I&apos;m starting to wonder is that was the smartest ever). Anyway, if scrub skips a row, it may skip some of those deltas. Let&apos;s say at first there is no increments coming for this row for A as &apos;first distinguished replica&apos;. So far we are still kind of good, because on a read (with CL &amp;gt; ONE) the result coming from A will have a &apos;version&apos; for it&apos;s own sub-count smaller that the one on the other replica, so we will us the sub-count on those replica and return the correct value.&lt;/p&gt;

&lt;p&gt;However, as soon as A acknowledge new increments for this row, it will start inserting new deltas while he is not intrinsically up to date. Which will result in an definitive undercount.&lt;/p&gt;

&lt;p&gt;The goal of renewing the node id of A is to make sure that second part never happen (because after the renew A will add new deltas as A&apos;, not A anymore).&lt;/p&gt;

&lt;p&gt;Anyway, now that I&apos;ve plugged the brain this patch doesn&apos;t really works because A will never be repaired by the other nodes of it&apos;s now inconsistent value.&lt;/p&gt;

&lt;p&gt;So I have no clue how to actually fix that.&lt;/p&gt;</comment>
                            <comment id="13047306" author="slebresne" created="Fri, 10 Jun 2011 17:21:28 +0000"  >&lt;p&gt;It may be that the best short fix here is to make scrub &lt;b&gt;not&lt;/b&gt; skipping row on counter column families (though &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2614&quot; title=&quot;create Column and CounterColumn in the same column family&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2614&quot;&gt;&lt;del&gt;CASSANDRA-2614&lt;/del&gt;&lt;/a&gt; would change that to &apos;never ever skipping row&apos;) and just throw a RuntimeException.&lt;/p&gt;</comment>
                            <comment id="13047422" author="jbellis" created="Fri, 10 Jun 2011 20:10:49 +0000"  >&lt;blockquote&gt;&lt;p&gt;make scrub not skip rows on counter column families&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2614&quot; title=&quot;create Column and CounterColumn in the same column family&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2614&quot;&gt;&lt;del&gt;CASSANDRA-2614&lt;/del&gt;&lt;/a&gt; would change that to &apos;never ever skipping row&apos;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Only if you actually did have a counter in the column_metadata, right?&lt;/p&gt;</comment>
                            <comment id="13049031" author="slebresne" created="Tue, 14 Jun 2011 07:38:31 +0000"  >&lt;p&gt;Attaching patch to simply re-throw the exception instead of skipping the row for counter column families.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Only if you actually did have a counter in the column_metadata, right?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;right.&lt;/p&gt;</comment>
                            <comment id="13049065" author="jbellis" created="Tue, 14 Jun 2011 08:50:40 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;can you add a link to this issue in the &quot;dangerous&quot; comment?&lt;/p&gt;</comment>
                            <comment id="13049072" author="slebresne" created="Tue, 14 Jun 2011 09:18:25 +0000"  >&lt;p&gt;Committed with suggested comment update.&lt;/p&gt;</comment>
                            <comment id="13049276" author="hudson" created="Tue, 14 Jun 2011 17:02:37 +0000"  >&lt;p&gt;Integrated in Cassandra-0.8 #170 (See &lt;a href=&quot;https://builds.apache.org/job/Cassandra-0.8/170/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Cassandra-0.8/170/&lt;/a&gt;)&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12482523" name="0001-Don-t-skip-rows-on-scrub-for-counter-CFs.patch" size="2353" author="slebresne" created="Tue, 14 Jun 2011 07:38:31 +0000"/>
                            <attachment id="12482074" name="0001-Renew-nodeId-in-scrub-when-skipping-rows.patch" size="9062" author="slebresne" created="Fri, 10 Jun 2011 16:23:39 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20810</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 24 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gda7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>93582</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>