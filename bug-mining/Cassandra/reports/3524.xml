<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:52:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-9151] Anti-compaction is blocking ANTI_ENTROPY stage </title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-9151</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;In RepairMessageVerbHandler.doVerb case ANTICOMPACTION_REQUEST&lt;/p&gt;

&lt;p&gt;We block on ANTI_ENTROPY stage. This is not good as no other message could be processed till any anticompaction is running. This can cause snapshots for new repairs to fail.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12819749">CASSANDRA-9151</key>
            <summary>Anti-compaction is blocking ANTI_ENTROPY stage </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yukim">Yuki Morishita</assignee>
                                    <reporter username="kohlisankalp">Sankalp Kohli</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Apr 2015 17:43:42 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:15 +0000</updated>
                            <resolved>Mon, 4 May 2015 14:52:33 +0000</resolved>
                                        <fixVersion>2.1.6</fixVersion>
                    <fixVersion>2.2.0 beta 1</fixVersion>
                                    <component>Legacy/Streaming and Messaging</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                                                                <comments>
                            <comment id="14487762" author="jbellis" created="Thu, 9 Apr 2015 17:57:08 +0000"  >&lt;p&gt;What versions does this affect?&lt;/p&gt;</comment>
                            <comment id="14487845" author="kohlisankalp" created="Thu, 9 Apr 2015 18:19:25 +0000"  >&lt;p&gt;This affects 2.1.3 and trunk(3.0) &lt;/p&gt;</comment>
                            <comment id="14487855" author="kohlisankalp" created="Thu, 9 Apr 2015 18:22:27 +0000"  >&lt;p&gt;This might be causing &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8696&quot; title=&quot;nodetool repair on cassandra 2.1.2 keyspaces return java.lang.RuntimeException: Could not create snapshot&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8696&quot;&gt;CASSANDRA-8696&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14521228" author="yukim" created="Thu, 30 Apr 2015 09:49:02 +0000"  >&lt;p&gt;Attaching patch for fix against cassandra-2.1 branch.&lt;/p&gt;</comment>
                            <comment id="14521901" author="iamaleksey" created="Thu, 30 Apr 2015 17:30:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kohlisankalp&quot; class=&quot;user-hover&quot; rel=&quot;kohlisankalp&quot;&gt;kohlisankalp&lt;/a&gt; can you review soonish?&lt;/p&gt;</comment>
                            <comment id="14521917" author="rbfblk" created="Thu, 30 Apr 2015 17:39:02 +0000"  >&lt;p&gt;Are ANTICOMPACTION_REQUEST messages only sent when doing incremental repair? I&apos;ve seen &quot;Could not create snapshot&quot; in the logs like other users in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8696&quot; title=&quot;nodetool repair on cassandra 2.1.2 keyspaces return java.lang.RuntimeException: Could not create snapshot&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8696&quot;&gt;CASSANDRA-8696&lt;/a&gt;, but we&apos;ve only been using full repair. Trying to understand if this bug could still be the cause of this issue.&lt;/p&gt;</comment>
                            <comment id="14522019" author="yukim" created="Thu, 30 Apr 2015 18:36:29 +0000"  >&lt;p&gt;Yes, ANTICOMPATION_REQUEST is for incremental repair in 2.1.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8696&quot; title=&quot;nodetool repair on cassandra 2.1.2 keyspaces return java.lang.RuntimeException: Could not create snapshot&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8696&quot;&gt;CASSANDRA-8696&lt;/a&gt; can be caused by this, but it&apos;s likely caused by timeout waiting for snapshot to complete.&lt;br/&gt;
Workaround is to temporarily increase rpc_timeout, and we are extending timeout in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9261&quot; title=&quot;Prepare and Snapshot for repairs should use higher timeouts for expiring map&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9261&quot;&gt;&lt;del&gt;CASSANDRA-9261&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14522067" author="kohlisankalp" created="Thu, 30 Apr 2015 19:04:32 +0000"  >&lt;p&gt;I am +1 on the patch which I applied to 2.1. While looking at the 2.1 branch, I found one more potential issue not related to the patch. &lt;br/&gt;
We could potentially block this stage again since many methods are synchronized in ActiveRepairService. &lt;br/&gt;
Methods prepareForRepair(could block for 1 hour for prepare message response) and finishParentSession(this one block for anticompaction to finish) are synchronized and could hold on to the lock for a long time. &lt;br/&gt;
In RepairMessageVerbHandler.doVerb, if there is an exception for another repair, removeParentRepairSession(also synchronized) will block. &lt;/p&gt;

&lt;p&gt;I am not sure whether we can take this in another JIRA as this is blocking lot of people. &lt;/p&gt;</comment>
                            <comment id="14523706" author="yukim" created="Fri, 1 May 2015 19:03:11 +0000"  >&lt;p&gt;Thanks for review.&lt;br/&gt;
Let&apos;s open another JIRA for ParentRepairSession issue.&lt;/p&gt;</comment>
                            <comment id="14526702" author="yukim" created="Mon, 4 May 2015 14:52:33 +0000"  >&lt;p&gt;This was committed in &lt;tt&gt;6d06f32a7729524a195ad67ba82157e390dc3912&lt;/tt&gt;.&lt;br/&gt;
Follow up is created in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9292&quot; title=&quot;ParentRepairSession potentially block ANTI_ENTROPY stage&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9292&quot;&gt;&lt;del&gt;CASSANDRA-9292&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12787647">CASSANDRA-9097</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12729454" name="0001-Do-not-block-stage-when-performing-anticompaction.patch" size="11371" author="yukim" created="Thu, 30 Apr 2015 09:49:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[yukim]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 29 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2d1nj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12327256">2.1.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>