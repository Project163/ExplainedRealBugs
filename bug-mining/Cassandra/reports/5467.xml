<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:16:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-14939] fix some operational holes in incremental repair</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-14939</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Incremental repair has a few operational rough spots that make it more difficult to fully automate and operate at scale than it should be.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Visibility into whether pending repair data exists for a given token range.&lt;/li&gt;
	&lt;li&gt;Ability to force promotion/demotion of data for completed sessions instead of waiting for compaction.&lt;/li&gt;
	&lt;li&gt;Get the most recent repairedAt timestamp for a given token range.&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="13204999">CASSANDRA-14939</key>
            <summary>fix some operational holes in incremental repair</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bdeggleston">Blake Eggleston</assignee>
                                    <reporter username="bdeggleston">Blake Eggleston</reporter>
                        <labels>
                    </labels>
                <created>Mon, 17 Dec 2018 21:53:28 +0000</created>
                <updated>Fri, 9 Oct 2020 20:04:15 +0000</updated>
                            <resolved>Tue, 25 Aug 2020 22:30:17 +0000</resolved>
                                        <fixVersion>4.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="16724481" author="bdeggleston" created="Tue, 18 Dec 2018 21:26:06 +0000"  >&lt;p&gt;/cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mbyrd&quot; class=&quot;user-hover&quot; rel=&quot;mbyrd&quot;&gt;mbyrd&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=spodxx%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;spodxx@gmail.com&quot;&gt;spodxx@gmail.com&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16755376" author="bdeggleston" created="Tue, 29 Jan 2019 20:51:18 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/bdeggleston/cassandra/tree/14939-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/bdeggleston/cassandra-dtest/tree/14939&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/workflow-run/587857d3-8d7a-4710-906f-010f499d4910&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;circle&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;This adds &lt;tt&gt;&amp;#45;&amp;#45;cleanup&lt;/tt&gt;, &lt;tt&gt;&amp;#45;&amp;#45;summarize-pending&lt;/tt&gt;, and &lt;tt&gt;&amp;#45;&amp;#45;summarize-repaired&lt;/tt&gt; flags to &lt;tt&gt;nodetool repair_admin&lt;/tt&gt;. Each of which also accept keyspace/table and range args. To support reporting the min/max repairedAt time for a given token range across restarts, I had to alter the logic for purging old sessions. Finalized sessions will only be deleted if there is a newer session covering it&apos;s ranges.&lt;/p&gt;</comment>
                            <comment id="16757075" author="spodxx@gmail.com" created="Thu, 31 Jan 2019 09:52:34 +0000"  >&lt;p&gt;Can you please also add &lt;tt&gt;parentRepairSession&lt;/tt&gt; to &lt;a href=&quot;https://github.com/apache/cassandra/blob/a05785d82c621c9cd04d8a064c38fd2012ef981c/src/java/org/apache/cassandra/repair/RepairSession.java#L268&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this&lt;/a&gt; log statement, so we can get a link between parent and child sessionIds in the log files?&lt;/p&gt;</comment>
                            <comment id="16774116" author="krummas" created="Thu, 21 Feb 2019 14:27:47 +0000"  >&lt;p&gt;in general, this looks very nice and will be a huge help&lt;/p&gt;

&lt;p&gt;General stuff&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;We keep the LocalSessions around for 1 day in system.repairs - I guess it is possible to give incomplete information for summarizeRepaired after bounce for example? (I have no real solution other than keeping them around for a longer time)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;ColumnFamilyStore;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;test(s) for getPendingRepairStats&lt;/li&gt;
	&lt;li&gt;in getPendingRepairStats there is a potential NPE - the pending repair status can be removed between the isPendingRepair check and getting the pendingRepair UUID from the sstable&lt;/li&gt;
	&lt;li&gt;when we use &lt;tt&gt;runWithCompactionsDisabled&lt;/tt&gt;&#160;we could potentially pass in the ranges we need to cancel compactions for (totally ok leaving this for a future ticket though)&lt;/li&gt;
	&lt;li&gt;potential NPE - &lt;tt&gt;sst.isPendingRepair&lt;/tt&gt; call first, then &lt;tt&gt;sst.getPendingRepair&lt;/tt&gt; in the &lt;tt&gt;runWithCompactionsDisabled&lt;/tt&gt; call&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;CompactionStrategyManager;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;in &lt;tt&gt;releaseRepairedData&lt;/tt&gt; - we should probably make sure all the callables are cancelled if we catch that exception there, otherwise we might keep the sstables marked as compacting forever&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;PendingRepairManager;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;I think strategies can be removed even though we have the read lock - &lt;tt&gt;Set&amp;lt;SSTableReader&amp;gt; sstables = get(sessionID).getSSTables();&lt;/tt&gt; could NPE in that case&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Range;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;new &lt;tt&gt;Range.intersects(..)&lt;/tt&gt; method should probably have a test&lt;/li&gt;
	&lt;li&gt;same with new &lt;tt&gt;subtract&lt;/tt&gt; method - both get tested indirectly, but might be good with a few direct ones&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;LocalSessions;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;in &lt;tt&gt;getPendingStats&lt;/tt&gt; sessionIDs set is not used&lt;/li&gt;
	&lt;li&gt;in &lt;tt&gt;getPendingStats&lt;/tt&gt; when checking &lt;tt&gt;if (!Iterables.any(ranges, r -&amp;gt; r.intersects(session.ranges)))&lt;/tt&gt; session could be null - there is a null check right below which we could move up.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;RepairedState;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;This class could use a more comments&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;PendingStat;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;In &lt;tt&gt;addSSTable&lt;/tt&gt;, instead of checking &lt;tt&gt;Preconditions.checkArgument(sessionID != null);&lt;/tt&gt; we should probably just skip the sstable as it means it has been moved out of pending&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;PendingStats;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;seems to be a mismatch in the columns in &lt;tt&gt;to/fromComposite&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;SchemaArgsParser;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Untested&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I changed &lt;tt&gt;RepairAdmin&lt;/tt&gt; nodetool command to use subcommands to reduce some of the manual parameter verification;&lt;br/&gt;
 &lt;a href=&quot;https://github.com/krummas/cassandra/commits/blake/14939-trunk-nodetool&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/krummas/cassandra/commits/blake/14939-trunk-nodetool&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17034275" author="stefan.miklosovic" created="Tue, 11 Feb 2020 09:12:44 +0000"  >&lt;p&gt;Is there any chance this will appear in upcomming 4.x release? Is anybody working on this atm?&lt;/p&gt;</comment>
                            <comment id="17105760" author="kohlisankalp" created="Tue, 12 May 2020 21:36:00 +0000"  >&lt;p&gt;I think we should do this as part of 4.0-beta as it is important to users who will use IR in 4.0. IR has major changes in 4.0 and we hope lot more users will use this in 4.0!!&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jwest&quot; class=&quot;user-hover&quot; rel=&quot;jwest&quot;&gt;jwest&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17105790" author="jrwest" created="Tue, 12 May 2020 22:25:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kohlisankalp&quot; class=&quot;user-hover&quot; rel=&quot;kohlisankalp&quot;&gt;kohlisankalp&lt;/a&gt; I don&apos;t personally have enough background to comment on this ticket. With fresh eyes I saw it as a potential candidate for a follow up release since it hasn&apos;t been worked on for over one year and looks to be a set of improvements on an existing feature. I defer to those involved with the ticket and/or the community if its better to start a conversation on the mailing list. &lt;/p&gt;</comment>
                            <comment id="17171836" author="bdeggleston" created="Wed, 5 Aug 2020 23:43:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcuse&quot; class=&quot;user-hover&quot; rel=&quot;marcuse&quot;&gt;marcuse&lt;/a&gt;&#160;rebased on current trunk and addressed all review comments&lt;/p&gt;</comment>
                            <comment id="17181006" author="krummas" created="Thu, 20 Aug 2020 08:04:22 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;in getPendingStats when checking if (!Iterables.any(ranges, r -&amp;gt; r.intersects(session.ranges))) session could be null - there is a null check right below which we could move up.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Probably better to just skip it if the session is null (&lt;tt&gt;LocalSessions#getPendingStats&lt;/tt&gt;, line 278), feel free to fix on commit if you agree.&lt;/p&gt;</comment>
                            <comment id="17184764" author="bdeggleston" created="Tue, 25 Aug 2020 22:30:17 +0000"  >&lt;p&gt;Committed to trunk as&#160;&lt;a href=&quot;https://github.com/apache/cassandra/commit/c34317526fc6dbe559beb36cf44e24278656bdf2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;c34317526fc6dbe559beb36cf44e24278656bdf2 &lt;/a&gt;, thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[bdeggleston]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 12 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|u002f4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>marcuse</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12348281">4.0-alpha1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/c34317526fc6dbe559beb36cf44e24278656bdf2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/c34317526fc6dbe559beb36cf44e24278656bdf2&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>