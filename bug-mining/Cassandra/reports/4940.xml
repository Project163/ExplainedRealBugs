<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:10:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-14084] Disks can be imbalanced during replace of same address when using JBOD</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-14084</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;While investigating &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14083&quot; title=&quot;Avoid invalidating disk boundaries unnecessarily&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-14083&quot;&gt;&lt;del&gt;CASSANDRA-14083&lt;/del&gt;&lt;/a&gt;, I noticed that &lt;a href=&quot;https://github.com/apache/cassandra/blob/41904684bb5509595d11f008d0851c7ce625e020/src/java/org/apache/cassandra/db/DiskBoundaryManager.java#L91&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;we use the pending ranges to calculate the disk boundaries&lt;/a&gt; when the node is bootstrapping.&lt;/p&gt;

&lt;p&gt;The problem is that when the node is replacing a node with the same address, it &lt;a href=&quot;https://github.com/apache/cassandra/blob/41904684bb5509595d11f008d0851c7ce625e020/src/java/org/apache/cassandra/service/StorageService.java#L1449&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;sets itself as normal locally&lt;/a&gt; (for other unrelated reasons), so the local ranges will be null and consequently the disk boundaries will be null. This will cause the sstables to be randomly spread across disks potentially causing imbalance.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13121966">CASSANDRA-14084</key>
            <summary>Disks can be imbalanced during replace of same address when using JBOD</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pauloricardomg">Paulo Motta</assignee>
                                    <reporter username="pauloricardomg">Paulo Motta</reporter>
                        <labels>
                    </labels>
                <created>Thu, 30 Nov 2017 17:00:58 +0000</created>
                <updated>Fri, 15 May 2020 08:06:54 +0000</updated>
                            <resolved>Mon, 11 Dec 2017 20:24:57 +0000</resolved>
                                        <fixVersion>3.11.2</fixVersion>
                    <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16272977" author="pauloricardomg" created="Thu, 30 Nov 2017 17:18:23 +0000"  >&lt;p&gt;This situation is reproduced by &lt;a href=&quot;https://github.com/pauloricardomg/cassandra-dtest/commit/1b96dfd855d1b2fc10cbb4cf2e4c95d236ecd951#diff-1ef92939c7765f8c4041bada71208eebR51&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this dest&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The simple fix is to use normal tokens for replacement nodes with the same address:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/pauloricardomg/cassandra/tree/3.11-14084&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.11&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;CI looked clean when this was in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-13948&quot; title=&quot;Reload compaction strategies when JBOD disk boundary changes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-13948&quot;&gt;&lt;del&gt;CASSANDRA-13948&lt;/del&gt;&lt;/a&gt;, but I will submit again just to make sure this will not cause problems when committed separately.&lt;/p&gt;</comment>
                            <comment id="16274400" author="pauloricardomg" created="Fri, 1 Dec 2017 13:36:08 +0000"  >&lt;p&gt;testall is clean, dtest failures &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12900219/dtest14084.png&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;seem unrelated&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16285628" author="krummas" created="Mon, 11 Dec 2017 08:10:08 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="16286500" author="pauloricardomg" created="Mon, 11 Dec 2017 20:24:57 +0000"  >&lt;p&gt;Committed as &lt;tt&gt;50e6e721b2a81da7f11f60a2fa405fd46e5415d4&lt;/tt&gt; to cassandra-3.11 and merged up to master, and dtest as &lt;tt&gt;3d2a6cc738d87d30cca8d747305a5899ccf3712d&lt;/tt&gt;. Thanks for the review!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12993622">CASSANDRA-12344</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13121921">CASSANDRA-14083</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12900219" name="dtest14084.png" size="169678" author="pauloricardomg" created="Fri, 1 Dec 2017 13:35:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[pauloricardomg]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 49 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3ne9r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>marcuse</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>