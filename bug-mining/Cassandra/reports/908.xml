<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:21:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-2618] DynamicSnitch race in adding latencies</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-2618</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;ERROR 15:33:48,614 Fatal exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage:264,5,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.RuntimeException: java.util.NoSuchElementException&lt;br/&gt;
	at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:34)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:680)&lt;br/&gt;
Caused by: java.util.NoSuchElementException&lt;br/&gt;
	at java.util.concurrent.LinkedBlockingDeque.removeFirst(LinkedBlockingDeque.java:401)&lt;br/&gt;
	at java.util.concurrent.LinkedBlockingDeque.remove(LinkedBlockingDeque.java:621)&lt;br/&gt;
	at org.apache.cassandra.locator.AdaptiveLatencyTracker.add(DynamicEndpointSnitch.java:288)&lt;br/&gt;
	at org.apache.cassandra.locator.DynamicEndpointSnitch.receiveTiming(DynamicEndpointSnitch.java:202)&lt;br/&gt;
	at org.apache.cassandra.net.MessagingService.addLatency(MessagingService.java:152)&lt;br/&gt;
	at org.apache.cassandra.service.StorageProxy$LocalReadRunnable.runMayThrow(StorageProxy.java:642)&lt;br/&gt;
	at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:30)&lt;br/&gt;
	... 3 more&lt;br/&gt;
ERROR 15:33:48,615 Fatal exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;ReadStage:264,5,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.RuntimeException: java.util.NoSuchElementException&lt;br/&gt;
	at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:34)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:680)&lt;br/&gt;
Caused by: java.util.NoSuchElementException&lt;br/&gt;
	at java.util.concurrent.LinkedBlockingDeque.removeFirst(LinkedBlockingDeque.java:401)&lt;br/&gt;
	at java.util.concurrent.LinkedBlockingDeque.remove(LinkedBlockingDeque.java:621)&lt;br/&gt;
	at org.apache.cassandra.locator.AdaptiveLatencyTracker.add(DynamicEndpointSnitch.java:288)&lt;br/&gt;
	at org.apache.cassandra.locator.DynamicEndpointSnitch.receiveTiming(DynamicEndpointSnitch.java:202)&lt;br/&gt;
	at org.apache.cassandra.net.MessagingService.addLatency(MessagingService.java:152)&lt;br/&gt;
	at org.apache.cassandra.service.StorageProxy$LocalReadRunnable.runMayThrow(StorageProxy.java:642)&lt;br/&gt;
	at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:30)&lt;br/&gt;
	... 3 more&lt;/p&gt;

&lt;p&gt;What is happening that AdaptiveLatencyTracker.add is trying to add a latency, but the deque is full, so it makes a second effort to remove an entry from the deque and then try to add again.  However, when it tries to remove, the deque has already been emptied by DES.reset call clear() on all the ALTs.  This bug has existed for a long time, but it&apos;s very rare and difficult to trigger.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12506465">CASSANDRA-2618</key>
            <summary>DynamicSnitch race in adding latencies</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="brandon.williams">Brandon Williams</assignee>
                                    <reporter username="brandon.williams">Brandon Williams</reporter>
                        <labels>
                    </labels>
                <created>Fri, 6 May 2011 22:27:06 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:59 +0000</updated>
                            <resolved>Sat, 7 May 2011 01:43:43 +0000</resolved>
                                        <fixVersion>0.7.6</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13030174" author="brandon.williams" created="Fri, 6 May 2011 22:37:23 +0000"  >&lt;p&gt;Patch to avoid the race between add() and clear().&lt;/p&gt;</comment>
                            <comment id="13030231" author="tjake" created="Sat, 7 May 2011 00:10:10 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13030247" author="brandon.williams" created="Sat, 7 May 2011 01:43:43 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                            <comment id="13030253" author="stuhood" created="Sat, 7 May 2011 02:10:04 +0000"  >&lt;p&gt;Are we sure this fixes the race? ArrayDeque isn&apos;t a concurrent datastructure, so it&apos;s possible that its internals could race in such a way that it gets into a bad state. The size field not matching the index, for example.&lt;/p&gt;</comment>
                            <comment id="13030257" author="brandon.williams" created="Sat, 7 May 2011 02:16:47 +0000"  >&lt;p&gt;I can&apos;t say for certain since this is terribly difficult to repro (it&apos;s been there since DES inception and I&apos;ve only seen it once) but the patch definitely addressed a likely cause and is certainly needed either way.&lt;/p&gt;</comment>
                            <comment id="13030258" author="brandon.williams" created="Sat, 7 May 2011 02:17:47 +0000"  >&lt;p&gt;Also, we&apos;re using LinkedBlockingDeque which is a concurrent structure.&lt;/p&gt;</comment>
                            <comment id="13030279" author="hudson" created="Sat, 7 May 2011 05:20:30 +0000"  >&lt;p&gt;Integrated in Cassandra-0.7 #473 (See &lt;a href=&quot;https://builds.apache.org/hudson/job/Cassandra-0.7/473/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/hudson/job/Cassandra-0.7/473/&lt;/a&gt;)&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12478475" name="2618.txt" size="941" author="brandon.williams" created="Fri, 6 May 2011 22:37:23 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20731</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 29 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gcfz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>93446</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>