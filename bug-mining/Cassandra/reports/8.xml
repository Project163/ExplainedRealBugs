<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:10:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-34] Hinted handoff rows never get deleted</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-34</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;from the list: &quot;after the hints are delivered, the hinted keys are deleted from the hinted CF only, but not from the application CF.&quot;&lt;/p&gt;

&lt;p&gt;Prashant verified that this is a bug that can&apos;t be fixed until deletes are fully working.&lt;/p&gt;

&lt;p&gt;Note: when we fix this, see if we can do so w/o compromising the immediate-GC of the hinted CF keys.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12421771">CASSANDRA-34</key>
            <summary>Hinted handoff rows never get deleted</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="junrao">Jun Rao</assignee>
                                    <reporter username="jbellis">Jonathan Ellis</reporter>
                        <labels>
                    </labels>
                <created>Wed, 1 Apr 2009 13:50:00 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:40 +0000</updated>
                            <resolved>Tue, 5 May 2009 17:03:14 +0000</resolved>
                                        <fixVersion>0.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12705061" author="junrao" created="Fri, 1 May 2009 17:14:09 +0000"  >&lt;p&gt;Sending out hinted data needs correct RowMutation support.&lt;/p&gt;</comment>
                            <comment id="12705132" author="junrao" created="Fri, 1 May 2009 21:45:31 +0000"  >&lt;p&gt;Attach a fix. About the patch.&lt;/p&gt;

&lt;p&gt;1. Make sendMessage blocking.&lt;br/&gt;
2. Delete the rows in application CF after hinted data is sent. To do that, we need to collect the largest timestamp among columns in a CF and then delete the CF with the largest timestamp.&lt;br/&gt;
3. When a column is in a deleted CF and their timestamps are the same, the rule is that the deleted CF wins. This rule is needed for step 2 above. Change CFStore.removeDeleted according to this rule.&lt;/p&gt;</comment>
                            <comment id="12705168" author="junrao" created="Fri, 1 May 2009 22:53:56 +0000"  >&lt;p&gt;Patch v2. Added some description on hinted data gets delivered.&lt;/p&gt;</comment>
                            <comment id="12705319" author="jbellis" created="Sat, 2 May 2009 19:13:01 +0000"  >&lt;p&gt;any idea what the purpose of this code in runHints is?  why flush if nothing changed?&lt;/p&gt;

&lt;p&gt;            	if(hintedColumnFamily == null)&lt;/p&gt;
            	{
                    columnFamilyStore_.forceFlush();
            		return;
            	}</comment>
                            <comment id="12705321" author="jbellis" created="Sat, 2 May 2009 19:34:01 +0000"  >&lt;p&gt;also, now that we have range queries, it seems that a normal CF would be a better fit for this than a single super CF with keys as supercolumns.  i guess that is a separate issue.&lt;/p&gt;</comment>
                            <comment id="12705379" author="jbellis" created="Sun, 3 May 2009 03:27:49 +0000"  >&lt;p&gt;committed the sendMessage fix.  I&apos;ve reworked the rest substantially in two parts.&lt;/p&gt;

&lt;p&gt;01 is just refactoring / cleanup.&lt;/p&gt;

&lt;p&gt;02 includes your fix to deleteKey, and also:&lt;br/&gt;
 A make hint generation include a real timestamp so we can do meaningful deletes&lt;br/&gt;
 B call removeDeleted on the data we read locally to purge tombstones&lt;br/&gt;
 C because of (B) any supercolumn w/o subcolumns simply won&apos;t exist so we know we can skip re-deleting the endpoint data.  so deleteKey becomes deleteHintedData.&lt;br/&gt;
 D because deleted data is not immediately purged, increased the scheduled interval fro 20min to 60 to reduce the load of scanning the hint CF.&lt;/p&gt;

&lt;p&gt;(for another ticket: since all this is purely local data and not subject to read repair we should find a way to GC it immediately post-delete.)&lt;/p&gt;

&lt;p&gt;how does this look to you?&lt;/p&gt;</comment>
                            <comment id="12705415" author="hudson" created="Sun, 3 May 2009 12:31:49 +0000"  >&lt;p&gt;Integrated in Cassandra #57 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Cassandra/57/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Cassandra/57/&lt;/a&gt;)&lt;br/&gt;
    make sendMessage only return true after ack by recipient.&lt;br/&gt;
patch by Jun Rao; reviewed by jbellis for &lt;/p&gt;</comment>
                            <comment id="12705420" author="jbellis" created="Sun, 3 May 2009 14:11:13 +0000"  >&lt;p&gt;created &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-128&quot; title=&quot;Hinted handoff improvements&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-128&quot;&gt;&lt;del&gt;CASSANDRA-128&lt;/del&gt;&lt;/a&gt; for improvments beyond the scope of 0.3&lt;/p&gt;</comment>
                            <comment id="12705833" author="junrao" created="Tue, 5 May 2009 00:00:42 +0000"  >&lt;p&gt;Looked at the new patch. Here are some comments.&lt;/p&gt;

&lt;p&gt;1. Move the comments above sendMessage to the beginning of class.&lt;/p&gt;

&lt;p&gt;2. There is compilation error in MinorCompactionManager because of the removed HintedHandOff class.&lt;/p&gt;

&lt;p&gt;3. Your new code deletes a column using the same timestamp as the column to be deleted. This is a more fundamental question. If a column has a non-delete entry and a deleted entry with the same timestamp, which one wins? I don&apos;t think that we can rely on the ordering of the insertion/deletion. This is because the insertion and the deletion can end up in different SSTables. During compaction, FileStruct is sorted only by keys. Therefore, columns from different SSTables with the same key can come in arbitrary order. One solution is to modify CF.addColumn such that a deletion always wins when the column timestamp is the same. Not sure if there is any other implications, though.&lt;/p&gt;</comment>
                            <comment id="12705835" author="junrao" created="Tue, 5 May 2009 00:07:51 +0000"  >&lt;p&gt;4. It&apos;s probably worthwhile to make intervalInMins_ in HHM configurable.&lt;/p&gt;</comment>
                            <comment id="12706066" author="jbellis" created="Tue, 5 May 2009 15:30:36 +0000"  >&lt;p&gt;patch to make tombstones have higher precedence than non- for same timestamp in Column (and SuperColumn, to be consistent w/ C and CF)&lt;/p&gt;</comment>
                            <comment id="12706068" author="jbellis" created="Tue, 5 May 2009 15:31:39 +0000"  >&lt;p&gt;(incorporated changes for comments (1) and (2) into my patchset, not bothering resubmitting those unless you really want &apos;em)&lt;/p&gt;</comment>
                            <comment id="12706071" author="jbellis" created="Tue, 5 May 2009 15:32:50 +0000"  >&lt;p&gt;noted comment (4) on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-128&quot; title=&quot;Hinted handoff improvements&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-128&quot;&gt;&lt;del&gt;CASSANDRA-128&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12706089" author="junrao" created="Tue, 5 May 2009 16:38:01 +0000"  >&lt;p&gt;Comments for the new patch.&lt;br/&gt;
1. In CFStore.removeDeleted(), we should add comments to explain how we resolve the conflicts among CF, SC, and C when the timestamps are the same. As time goes, we are likely to forget those decisions that we have made.&lt;/p&gt;

&lt;p&gt;Other than that, the patch looks fine to me.&lt;/p&gt;</comment>
                            <comment id="12706104" author="jbellis" created="Tue, 5 May 2009 17:03:14 +0000"  >&lt;p&gt;done and committed.&lt;/p&gt;</comment>
                            <comment id="12706897" author="hudson" created="Thu, 7 May 2009 13:35:07 +0000"  >&lt;p&gt;Integrated in Cassandra #63 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Cassandra/63/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Cassandra/63/&lt;/a&gt;)&lt;/p&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12424213">CASSANDRA-120</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12421770">CASSANDRA-33</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12407102" name="0001-cleanup.patch" size="15432" author="jbellis" created="Sun, 3 May 2009 03:28:46 +0000"/>
                            <attachment id="12407103" name="0002-fix-HHM.patch" size="10331" author="jbellis" created="Sun, 3 May 2009 03:29:03 +0000"/>
                            <attachment id="12407253" name="0003-tombstones-take-priority-over-non-tombstones-w-the.patch" size="4890" author="jbellis" created="Tue, 5 May 2009 15:30:36 +0000"/>
                            <attachment id="12407039" name="issue34.patch_v1" size="5781" author="junrao" created="Fri, 1 May 2009 21:45:31 +0000"/>
                            <attachment id="12407045" name="issue34.patch_v2" size="6525" author="junrao" created="Fri, 1 May 2009 22:53:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[junrao]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19522</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 29 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0fwhb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90860</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>