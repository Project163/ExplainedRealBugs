<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:06:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-13282] Commitlog replay may fail if last mutation is within 4 bytes of end of segment</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-13282</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Following &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9749&quot; title=&quot;CommitLogReplayer continues startup after encountering errors&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9749&quot;&gt;&lt;del&gt;CASSANDRA-9749&lt;/del&gt;&lt;/a&gt; , stricter correctness checks on commitlog replay can incorrectly detect &quot;corrupt segments&quot; and stop commitlog replay (and potentially stop cassandra, depending on the configured policy). In &lt;tt&gt;CommitlogReplayer#replaySyncSection&lt;/tt&gt; we try to read a 4 byte int &lt;tt&gt;serializedSize&lt;/tt&gt;, and if it&apos;s 0 (which will happen due to zeroing when the segment was created), we continue on to the next segment. However, it appears that if a mutation is sized such that it ends with 1, 2, or 3 bytes remaining in the segment, we&apos;ll pass the &lt;tt&gt;isEOF&lt;/tt&gt; on the while loop but fail to read the &lt;tt&gt;serializedSize&lt;/tt&gt; int, and fail. &lt;/p&gt;</description>
                <environment></environment>
        <key id="13047190">CASSANDRA-13282</key>
            <summary>Commitlog replay may fail if last mutation is within 4 bytes of end of segment</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jjirsa">Jeff Jirsa</assignee>
                                    <reporter username="jjirsa">Jeff Jirsa</reporter>
                        <labels>
                    </labels>
                <created>Wed, 1 Mar 2017 05:02:41 +0000</created>
                <updated>Wed, 15 Oct 2025 09:49:00 +0000</updated>
                            <resolved>Mon, 13 Mar 2017 05:01:43 +0000</resolved>
                                        <fixVersion>2.2.10</fixVersion>
                    <fixVersion>3.0.13</fixVersion>
                    <fixVersion>3.11.0</fixVersion>
                    <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Legacy/Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15892831" author="jjirsa" created="Thu, 2 Mar 2017 19:23:13 +0000"  >&lt;p&gt;Will kick off CI in a bit, not going to do all 8 tests at once because I don&apos;t want to monopolize cassci, but links should be accurate once tests start. &lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Branch &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Unit Tests &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; DTests &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/jeffjirsa/cassandra/commits/cassandra-2.2-13282&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.2&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/jeffjirsa-cassandra-2.2-13282-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/jeffjirsa-cassandra-2.2-13282-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/jeffjirsa/cassandra/commits/cassandra-3.0-13282&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/jeffjirsa-cassandra-3.0-13282-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/jeffjirsa-cassandra-3.0-13282-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/jeffjirsa/cassandra/commits/cassandra-3.11-13282&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.11&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/jeffjirsa-cassandra-3.11-13282-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/jeffjirsa-cassandra-3.11-13282-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/jeffjirsa/cassandra/commits/cassandra-13282&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/jeffjirsa-cassandra-13282-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/job/jeffjirsa-cassandra-13282-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15892849" author="jjirsa" created="Thu, 2 Mar 2017 19:33:28 +0000"  >&lt;p&gt;Attaching a drawing for whichever reviewer wants this ticket - drawing created while discussing this offline because it&apos;s somewhat nuanced apparently. Basically when we allocate in &lt;tt&gt;sync()&lt;/tt&gt;, if we&apos;re at the end of a file, we return -1, and then the end marker for the segment gets set to the end of the file. Therefore within the while loop as we replay an individual sync section, we can get to a point where we throw trying to read an int from the unused tail of the section. &lt;/p&gt;</comment>
                            <comment id="15899472" author="jmckenzie" created="Tue, 7 Mar 2017 14:03:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt; to review.&lt;/p&gt;</comment>
                            <comment id="15901219" author="blambov" created="Wed, 8 Mar 2017 13:15:27 +0000"  >&lt;p&gt;Patch LGTM, but I want to make sure this isn&apos;t showing a more serious problem. Is an upgrade involved in triggering this issue?&lt;/p&gt;

&lt;p&gt;In 2.2+ we write the exact end of written data (&lt;tt&gt;endOfBuffer&lt;/tt&gt;) on &lt;tt&gt;sync()&lt;/tt&gt; and sync sections are thus always precisely sized, thus this should not be happening. We could end up in this situation upgrading from 2.1 and earlier, though. Perhaps we should only ignore this if the descriptor version is pre-2.2?&lt;/p&gt;</comment>
                            <comment id="15901363" author="jjirsa" created="Wed, 8 Mar 2017 14:46:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt; It does appear to require 2.1 commitlog segments, yes. I&apos;m not sure it&apos;s worth adding a descriptor guard onto it - it should be safe in both situations, though (as you mention) less meaningful in 2.2+. I&apos;m not opposed to it, but I&apos;m also not convinced it&apos;s necessary. Will defer to your opinion on that.&lt;/p&gt;</comment>
                            <comment id="15902606" author="blambov" created="Thu, 9 Mar 2017 07:21:36 +0000"  >&lt;p&gt;Not adding a guard is fine. I would change the comment a little, though, to mention such sections come from 2.1 and earlier.&lt;/p&gt;</comment>
                            <comment id="15906876" author="jjirsa" created="Mon, 13 Mar 2017 05:01:43 +0000"  >&lt;p&gt;Committed to 2.2 as &lt;a href=&quot;https://github.com/apache/cassandra/commit/beb9658dd5e18e3a6a4e8431b6549ae4c33365a9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;beb9658dd5e18e3a6a4e8431b6549ae4c33365a9&lt;/a&gt; and merged up to trunk with the slightly more verbose comment to clarify it&apos;s from 2.1 era commitlog segments. &lt;/p&gt;

&lt;p&gt;Thanks for the quick review, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt; &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12855676" name="whiteboard.png" size="8892754" author="jjirsa" created="Thu, 2 Mar 2017 19:30:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jjirsa]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12983" cascade-level=""><![CDATA[Availability]]></customfieldvalue>
                                <customfieldvalue key="12994" cascade-level="1"><![CDATA[Unavailable]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 36 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3arpj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>blambov</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blambov]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>