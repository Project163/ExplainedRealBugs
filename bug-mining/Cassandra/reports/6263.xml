<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:27:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-18647] CASTing a float to decimal adds wrong digits</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-18647</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;If I create a table with a &lt;b&gt;float&lt;/b&gt; (32-bit) column, and cast it to the &lt;b&gt;decimal&lt;/b&gt; type, the casting wrongly passes through the double (64-bit) type and picks up extra, wrong, digits. For example, if we have a column e of type &quot;float&quot;, and run&lt;/p&gt;

&lt;p&gt;INSERT INTO tbl (p, e) VALUES (1, 5.2)&lt;/p&gt;

&lt;p&gt;SELECT CAST(e AS decimal) FROM tbl WHERE p=1&lt;/p&gt;

&lt;p&gt;The result is the &quot;decimal&quot; value 5.199999809265137, with all those extra wrong digits. It would have been better to get back the decimal value 5.2, with only two significant digits.&lt;/p&gt;

&lt;p&gt;It appears that this happens because Cassandra&apos;s implementation first converts the 32-bit float into a 64-bit double, and only then converts that - with all the silly extra digits it picked up in the first conversion - into a &quot;decimal&quot; value.&lt;/p&gt;

&lt;p&gt;Contrast this with CAST(e AS text) which works correctly - it returns the string &quot;5.2&quot; - only the actual digits of the 32-bit floating point value are converted to the string, without inventing additional digits in the process.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13542450">CASSANDRA-18647</key>
            <summary>CASTing a float to decimal adds wrong digits</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="smiklosovic">Stefan Miklosovic</assignee>
                                    <reporter username="nyh">Nadav Har&apos;El</reporter>
                        <labels>
                    </labels>
                <created>Tue, 4 Jul 2023 21:27:05 +0000</created>
                <updated>Wed, 27 Mar 2024 17:39:24 +0000</updated>
                            <resolved>Wed, 12 Jul 2023 10:30:54 +0000</resolved>
                                        <fixVersion>3.11.16</fixVersion>
                    <fixVersion>4.0.11</fixVersion>
                    <fixVersion>4.1.3</fixVersion>
                    <fixVersion>5.0-alpha1</fixVersion>
                    <fixVersion>5.0</fixVersion>
                                    <component>CQL/Semantics</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="17740047" author="nyh" created="Wed, 5 Jul 2023 07:19:43 +0000"  >&lt;p&gt;By the way, there is a unit test - testNumericCastsInSelectionClause in test/unit/org/apache/cassandra/cql3/functions/CastFctsTest.java - that should have caught this bug. The problem is that it compares the result of the cast not to any specific value but to BigDecimal.valueOf(5.2F), and this BigDecimal.valueOf(float) is exactly the same function that the Cassandra implementation uses for this purpose, so the implementation and the test have the same bug and the test doesn&apos;t verify anything.&lt;/p&gt;

&lt;p&gt;I found the cause of this bug. It turns out that BigDecimal does &lt;b&gt;not&lt;/b&gt; have a float overload, only a double. The Java documentation says that:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;valueOf(double val) Translates a double into a BigDecimal, using the double&apos;s canonical string representation provided by the Double.toString(double) method.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;So the solution of how to turn a float into a Decimal is easy - just use &lt;b&gt;Float.toString(float)&lt;/b&gt; and then construct a BigDecimal using that string - do &lt;b&gt;not&lt;/b&gt; use BigDecimal.valueOf(double) on a float.&lt;/p&gt;

&lt;p&gt;So it seems the fix would be a two-line patch to getDecimalConversionFunction() in src/java/org/apache/cassandra/cql3/functions/CastFcts.java to do that. And also fix the test, of course.&lt;/p&gt;</comment>
                            <comment id="17740498" author="smiklosovic" created="Thu, 6 Jul 2023 08:57:42 +0000"  >&lt;p&gt;This is the PR &lt;a href=&quot;https://github.com/apache/cassandra/pull/2468/files&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/2468/files&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;I think this should go in from 3.11 up.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blerer&quot; class=&quot;user-hover&quot; rel=&quot;blerer&quot;&gt;blerer&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adelapena&quot; class=&quot;user-hover&quot; rel=&quot;adelapena&quot;&gt;adelapena&lt;/a&gt; ?&lt;/p&gt;</comment>
                            <comment id="17741636" author="adelapena" created="Mon, 10 Jul 2023 14:20:03 +0000"  >&lt;p&gt;The patch looks good to me. I think it should be applied from 3.0 since it&apos;s a bug fix. Do we have CI runs for it?&lt;/p&gt;</comment>
                            <comment id="17742050" author="smiklosovic" created="Tue, 11 Jul 2023 14:57:13 +0000"  >&lt;p&gt;3.11 &lt;a href=&quot;https://app.circleci.com/pipelines/github/instaclustr/cassandra/2680/workflows/3b05e246-e4af-494f-9156-7b74e66dd053&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/instaclustr/cassandra/2680/workflows/3b05e246-e4af-494f-9156-7b74e66dd053&lt;/a&gt;&lt;br/&gt;
4.0 j8 &lt;a href=&quot;https://app.circleci.com/pipelines/github/instaclustr/cassandra/2671/workflows/09167497-d534-4117-b365-cb397a2286f2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/instaclustr/cassandra/2671/workflows/09167497-d534-4117-b365-cb397a2286f2&lt;/a&gt;&lt;br/&gt;
4.0 j11 &lt;a href=&quot;https://app.circleci.com/pipelines/github/instaclustr/cassandra/2671/workflows/baff69d8-9852-4eae-8a4b-794977ef7e27&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/instaclustr/cassandra/2671/workflows/baff69d8-9852-4eae-8a4b-794977ef7e27&lt;/a&gt;&lt;br/&gt;
4.1 j8 &lt;a href=&quot;https://app.circleci.com/pipelines/github/instaclustr/cassandra/2670/workflows/b5748f43-d164-4106-a6c6-32c213886800&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/instaclustr/cassandra/2670/workflows/b5748f43-d164-4106-a6c6-32c213886800&lt;/a&gt;&lt;br/&gt;
4.1 j11 &lt;a href=&quot;https://app.circleci.com/pipelines/github/instaclustr/cassandra/2670/workflows/1d5cbfb7-6470-4ea3-b7e5-ba00ff03d4d9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/instaclustr/cassandra/2670/workflows/1d5cbfb7-6470-4ea3-b7e5-ba00ff03d4d9&lt;/a&gt;&lt;br/&gt;
trunk j8 &lt;a href=&quot;https://app.circleci.com/pipelines/github/instaclustr/cassandra/2646/workflows/10c901f0-f355-45f2-b9d1-9bbf240aa077&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/instaclustr/cassandra/2646/workflows/10c901f0-f355-45f2-b9d1-9bbf240aa077&lt;/a&gt;&lt;br/&gt;
trunk j11 &lt;a href=&quot;https://app.circleci.com/pipelines/github/instaclustr/cassandra/2646/workflows/424918c6-5630-4a99-8521-cc73ef80be44&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/instaclustr/cassandra/2646/workflows/424918c6-5630-4a99-8521-cc73ef80be44&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17742353" author="adelapena" created="Wed, 12 Jul 2023 10:12:37 +0000"  >&lt;p&gt;LGTM, +1&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[smiklosovic]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12969"><![CDATA[User Report]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 17 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1iylk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[adelapena]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12339157">3.11.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/7ec5126870f1bee853e63bfd98a73769c63abf3b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/7ec5126870f1bee853e63bfd98a73769c63abf3b&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;CI&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>