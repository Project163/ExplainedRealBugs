<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:29:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-3931] gossipers notion of schema differs from reality as reported by the nodes in question</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-3931</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;On a 1.1 cluster we happened to notice that &lt;tt&gt;nodetool gossipinfo | grep SCHEMA&lt;/tt&gt; reported disagreement:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  SCHEMA:59adb24e-f3cd-3e02-97f0-5b395827453f
  SCHEMA:59adb24e-f3cd-3e02-97f0-5b395827453f
  SCHEMA:b0d7bab7-c13c-37d9-9adb-8ab8a5b7215d
  SCHEMA:59adb24e-f3cd-3e02-97f0-5b395827453f
  SCHEMA:59adb24e-f3cd-3e02-97f0-5b395827453f
  SCHEMA:59adb24e-f3cd-3e02-97f0-5b395827453f
  SCHEMA:59adb24e-f3cd-3e02-97f0-5b395827453f
  SCHEMA:59adb24e-f3cd-3e02-97f0-5b395827453f
  SCHEMA:59adb24e-f3cd-3e02-97f0-5b395827453f
  SCHEMA:59adb24e-f3cd-3e02-97f0-5b395827453f
  SCHEMA:bcdbd318-82df-3518-89e3-6b72227b3f66
  SCHEMA:59adb24e-f3cd-3e02-97f0-5b395827453f
  SCHEMA:59adb24e-f3cd-3e02-97f0-5b395827453f
  SCHEMA:59adb24e-f3cd-3e02-97f0-5b395827453f
  SCHEMA:bcdbd318-82df-3518-89e3-6b72227b3f66
  SCHEMA:59adb24e-f3cd-3e02-97f0-5b395827453f
  SCHEMA:59adb24e-f3cd-3e02-97f0-5b395827453f
  SCHEMA:59adb24e-f3cd-3e02-97f0-5b395827453f
  SCHEMA:59adb24e-f3cd-3e02-97f0-5b395827453f
  SCHEMA:59adb24e-f3cd-3e02-97f0-5b395827453f
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;However, the result of a thrift &lt;tt&gt;describe_ring&lt;/tt&gt; on the cluster claims they all agree and that &lt;tt&gt;b0d7bab7-c13c-37d9-9adb-8ab8a5b7215d&lt;/tt&gt; is the schema they have.&lt;/p&gt;

&lt;p&gt;The schemas seem to &quot;actually&quot; propagate; e.g. dropping a keyspace actually drops the keyspace.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12543184">CASSANDRA-3931</key>
            <summary>gossipers notion of schema differs from reality as reported by the nodes in question</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="brandon.williams">Brandon Williams</assignee>
                                    <reporter username="scode">Peter Schuller</reporter>
                        <labels>
                    </labels>
                <created>Sun, 19 Feb 2012 04:09:07 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:39 +0000</updated>
                            <resolved>Tue, 21 Feb 2012 19:28:12 +0000</resolved>
                                        <fixVersion>1.1.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13211199" author="scode" created="Sun, 19 Feb 2012 04:11:01 +0000"  >&lt;p&gt;I forgot to mention that &lt;tt&gt;describe_ring&lt;/tt&gt; is using a piece of code that actually sends messages to other nodes asking for their schema, while &lt;tt&gt;gossipinfo&lt;/tt&gt; is giving the information contained in the Gossiper&apos;s endpoint state map.&lt;/p&gt;

&lt;p&gt;Given that the schema seems to &lt;b&gt;actually&lt;/b&gt; be propagated, I suspect this is only a gossiping propagation bug but that is not confirmed.&lt;/p&gt;</comment>
                            <comment id="13212627" author="brandon.williams" created="Tue, 21 Feb 2012 14:49:40 +0000"  >&lt;p&gt;Hmm, does hinted handoff work in this state?  I ask because we&apos;ve had this problem before and addressed it there:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        waited = 0;
        &lt;span class=&quot;code-comment&quot;&gt;// then wait &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the correct schema version.
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// usually we use DD.getDefsVersion, which checks the local schema uuid as stored in the system table.
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// here we check the one in gossip instead; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; serves as a canary to warn us &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; we introduce a bug that
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// causes the two to diverge (see CASSANDRA-2946)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13212786" author="brandon.williams" created="Tue, 21 Feb 2012 18:40:54 +0000"  >&lt;p&gt;Patch to update gossip when merging remote versions.&lt;/p&gt;</comment>
                            <comment id="13212810" author="brandon.williams" created="Tue, 21 Feb 2012 19:14:45 +0000"  >&lt;p&gt;v2 replaces all the one-off calls of passiveAnnounce by introducing updateVersionAndAnnounce in Schema.&lt;/p&gt;</comment>
                            <comment id="13212821" author="xedin" created="Tue, 21 Feb 2012 19:25:28 +0000"  >&lt;p&gt;+1 with nit: change in Migration is unnecessary because passiveAnnounce get&apos;s called as part of Migration.announce() routine so we don&apos;t need to change apply() behavior.&lt;/p&gt;</comment>
                            <comment id="13212825" author="brandon.williams" created="Tue, 21 Feb 2012 19:28:12 +0000"  >&lt;p&gt;Committed w/Migration.apply change removed.&lt;/p&gt;</comment>
                            <comment id="13213333" author="scode" created="Wed, 22 Feb 2012 05:31:38 +0000"  >&lt;p&gt;@Brandon For the record, we had HH turned off so I don&apos;t know.&lt;/p&gt;</comment>
                            <comment id="13510589" author="cherro" created="Wed, 5 Dec 2012 17:00:10 +0000"  >&lt;p&gt;FYI the fixes for this issue introduced issue &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5025&quot; title=&quot;Schema push/pull race&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5025&quot;&gt;&lt;del&gt;CASSANDRA-5025&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12515469" name="3931-v2.txt" size="4870" author="brandon.williams" created="Tue, 21 Feb 2012 19:14:45 +0000"/>
                            <attachment id="12515461" name="3931.txt" size="943" author="brandon.williams" created="Tue, 21 Feb 2012 18:40:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>228470</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 50 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gpy7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>95634</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>xedin</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[xedin]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>