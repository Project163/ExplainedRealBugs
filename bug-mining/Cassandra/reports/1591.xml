<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:32:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-4116] check most recent TS values in SSTables when a row tombstone has already been encountered</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-4116</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;once C* comes across a row tombstone, C* should check the TS on the tombstone against all SSTables.  If the most recent TS in an SST is older than the row tombstone, that entire SST (or the remainder of it) can be safely ignored.&lt;/p&gt;

&lt;p&gt;There are two drivers for this.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;avoid checking column values that could not possibly be in the result set&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;avoid OOMing because all the tombstones are temporarily kept in memory.&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12549563">CASSANDRA-4116</key>
            <summary>check most recent TS values in SSTables when a row tombstone has already been encountered</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="samt">Sam Tunnicliffe</assignee>
                                    <reporter username="mdennis">Matthew F. Dennis</reporter>
                        <labels>
                    </labels>
                <created>Wed, 4 Apr 2012 20:27:21 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:36 +0000</updated>
                            <resolved>Wed, 2 May 2012 15:02:09 +0000</resolved>
                                        <fixVersion>1.1.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13264388" author="beobal" created="Sat, 28 Apr 2012 19:37:14 +0000"  >&lt;p&gt;While I was working through this &amp;amp; testing with tiny amounts of data, I found that if the last (or only) update to a CF before a flush is a Row level delete then the maxTimeStamp on the resulting SSTable is incorrect. The second patch includes a fix + test for that - I included it as a separate patch as I was a bit less confident about screwing around with the SSTable metadata although all existing tests are still passing.&lt;/p&gt;</comment>
                            <comment id="13264508" author="beobal" created="Sun, 29 Apr 2012 12:12:51 +0000"  >&lt;p&gt;Updated patches because I realised the license header was missing from the new test source&lt;/p&gt;</comment>
                            <comment id="13265626" author="jbellis" created="Tue, 1 May 2012 04:03:48 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;.               &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (sstable.getMaxTimestamp() &amp;lt; mostRecentRowTombstone)
                    &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For &lt;tt&gt;collectTimeOrderedData&lt;/tt&gt;, I think that can be a &quot;break&quot; since we&apos;re scanning in reverse chronological order.&lt;/p&gt;

&lt;p&gt;For &lt;tt&gt;collectAllData&lt;/tt&gt;, I think it might be worth making (potentially) two passes: if we find a deletion marker on the first pass, we should do a second pass, so we can strip out sstables that we saw the first time before we knew about the marker.  This would improve the deletion case, without imposing the overhead of a sort or two passes on workloads with no deletes.&lt;/p&gt;</comment>
                            <comment id="13265881" author="beobal" created="Tue, 1 May 2012 16:11:57 +0000"  >&lt;p&gt;Updated patches as per comments. In &lt;tt&gt;collectAllData&lt;/tt&gt;, collect the eligible iterators in a multimap with key = maxTimestamp (I guess that its pretty unlikely for two sstables to have the exact same timestamp, but using a Multimap doesn&apos;t really add any cost). Then, if we did find a row tombstone, only keep the iterators from younger sstables. Otherwise, keep all that we collected.&lt;/p&gt;</comment>
                            <comment id="13266334" author="jbellis" created="Wed, 2 May 2012 04:30:17 +0000"  >&lt;p&gt;Committed patch 0001 to 1.1.1, with some cleanup.  (Main one was to use a Map&amp;lt;iterator, timestamp&amp;gt; instead of a multimap the other direction.)&lt;/p&gt;

&lt;p&gt;I suspect 0002 is needed for earlier releases as well, can you post a version against the 1.0 branch?&lt;/p&gt;</comment>
                            <comment id="13266461" author="beobal" created="Wed, 2 May 2012 09:32:58 +0000"  >&lt;p&gt;Added version of patch 0002 with fix to sstable maxTimeStamp against 1.0 branch&lt;/p&gt;</comment>
                            <comment id="13266616" author="jbellis" created="Wed, 2 May 2012 15:02:10 +0000"  >&lt;p&gt;thanks, committed.  (moved the fix into CF.maxTimestamp so the other code paths using that will benefit as well.)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12525178" name="ASF.LICENSE.NOT.GRANTED--v1-0001-CASSANDRA-4116-After-Row-tombstone-skip-earlier-SSTabl.txt" size="9207" author="samt" created="Tue, 1 May 2012 16:03:05 +0000"/>
                            <attachment id="12525179" name="ASF.LICENSE.NOT.GRANTED--v1-0002-CASSANDRA-4116-Set-SSTable-maxTimestamp-correctly-for-.txt" size="3106" author="samt" created="Tue, 1 May 2012 16:03:05 +0000"/>
                            <attachment id="12525270" name="CASSANDRA-4116-Set-SSTable-maxTimestamp-correctly-1.0.txt" size="4126" author="samt" created="Wed, 2 May 2012 09:32:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[samt]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>234554</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 29 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gs6f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>95995</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>