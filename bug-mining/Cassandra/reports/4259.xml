<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:02:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-9861] When forcibly exiting due to OOM, we should produce a heap dump</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-9861</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7507&quot; title=&quot;OOM creates unreliable state - die instantly better&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7507&quot;&gt;&lt;del&gt;CASSANDRA-7507&lt;/del&gt;&lt;/a&gt; introduced earlier termination on encountering an OOM, due to lack of certainty about system state. However a side effect is that we never produce heap dumps on OOM. We should ideally try to produce one forcibly before exiting.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12846836">CASSANDRA-9861</key>
            <summary>When forcibly exiting due to OOM, we should produce a heap dump</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="blerer">Benjamin Lerer</assignee>
                                    <reporter username="benedict">Benedict Elliott Smith</reporter>
                        <labels>
                            <label>lhf</label>
                    </labels>
                <created>Wed, 22 Jul 2015 10:01:45 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:03 +0000</updated>
                            <resolved>Wed, 4 May 2016 15:22:46 +0000</resolved>
                                        <fixVersion>2.2.7</fixVersion>
                    <fixVersion>3.0.7</fixVersion>
                    <fixVersion>3.7</fixVersion>
                                    <component>Local/Startup and Shutdown</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="15204111" author="blerer" created="Mon, 21 Mar 2016 12:40:23 +0000"  >&lt;p&gt;I guess the simplest way would be to add the &lt;tt&gt;-XX:+HeapDumpOnOutOfMemoryError&lt;/tt&gt;  command line argument to our startup scripts.&lt;/p&gt;</comment>
                            <comment id="15221736" author="blerer" created="Fri, 1 Apr 2016 14:17:16 +0000"  >&lt;blockquote&gt;&lt;p&gt;I guess the simplest way would be to add the -XX:+HeapDumpOnOutOfMemoryError command line argument to our startup scripts.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sorry, I initially misunderstood the problem.&lt;/p&gt;

&lt;p&gt;The patch use &lt;tt&gt;jmap&lt;/tt&gt; to generate a heap dump when the &lt;tt&gt;JVMStabilityInspector&lt;/tt&gt; detects an OOMError. &lt;br/&gt;
One issue is to retrieve the process ID to be able to execute the &lt;tt&gt;jmap&lt;/tt&gt; call. The Java API will only provide a reliable way for retrieving the process ID in Java 9. The current method used by the patch will work on the Oracle JVM but might not work on all the JVMs. If the process ID cannot be retrieved no dump will be generated.&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;utests&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;dtests&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-9861-2.2-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.2&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-9861-2.2-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.2&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-9861-3.0-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-9861-3.0-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15221744" author="blerer" created="Fri, 1 Apr 2016 14:18:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=JoshuaMcKenzie&quot; class=&quot;user-hover&quot; rel=&quot;JoshuaMcKenzie&quot;&gt;JoshuaMcKenzie&lt;/a&gt; could you review?&lt;/p&gt;</comment>
                            <comment id="15222973" author="snazy" created="Sat, 2 Apr 2016 17:44:05 +0000"  >&lt;p&gt;There&apos;s &lt;tt&gt;org.hyperic.sigar.Sigar#getPid&lt;/tt&gt; to get the process ID.&lt;br/&gt;
Maybe we should use &lt;tt&gt;jmap&lt;/tt&gt; from &lt;tt&gt;System.getProperty(&quot;java.home&quot;) + &quot;/bin/jmap&quot;&lt;/tt&gt; (resp. &lt;tt&gt;jmap.exe&lt;/tt&gt;) and only use &lt;tt&gt;map&lt;/tt&gt;/&lt;tt&gt;jmap.exe&lt;/tt&gt; as a fallback.&lt;/p&gt;</comment>
                            <comment id="15222974" author="snazy" created="Sat, 2 Apr 2016 17:46:07 +0000"  >&lt;p&gt;Adding the jmap option to also print the heap histogram as proposed in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9604&quot; title=&quot;Upon JVM OOM (Out Of Memory), print out a summary of heap histograms in addition to heap dump&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9604&quot;&gt;&lt;del&gt;CASSANDRA-9604&lt;/del&gt;&lt;/a&gt; sounds like a good option.&lt;/p&gt;</comment>
                            <comment id="15228154" author="blerer" created="Wed, 6 Apr 2016 11:55:52 +0000"  >&lt;p&gt;The new patch try to use Sigar for retrieving the pid and default to parsing the JVM name if Sigar is not initialized (which is the case on my machine).&lt;/p&gt;

&lt;p&gt;It also tries to resolve the path to jmap from JAVA_HOME and default to jmap if the file cannot be found.&lt;/p&gt;

&lt;p&gt;After the heap as been dumped an heap histogram will be writting to the log file. &lt;/p&gt;</comment>
                            <comment id="15268557" author="iamaleksey" created="Tue, 3 May 2016 11:39:07 +0000"  >&lt;p&gt;Looks all right to me. Only got some trivial syntactic nits, feel free to ignore them or change on commit:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;in &lt;tt&gt;HeapUtils&lt;/tt&gt; there is no need to wrap all the things in the try/catch block, only the two &lt;tt&gt;logProcessOutput()&lt;/tt&gt; calls should be in the block&lt;/li&gt;
	&lt;li&gt;new lines incorrect/missing in &lt;tt&gt;getProceddIdFromJvmName()&lt;/tt&gt; try/catch block&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15270821" author="blerer" created="Wed, 4 May 2016 15:21:57 +0000"  >&lt;p&gt;Thanks for the review.&lt;/p&gt;</comment>
                            <comment id="15270824" author="blerer" created="Wed, 4 May 2016 15:22:46 +0000"  >&lt;p&gt;Committed into 2.2 at b189a7f6c955908d8b79d2b4104562a38ea62979 and merged into 3.0, 3.7 and trunk &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12838262">CASSANDRA-9604</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12797288" name="9861-2.2-V2.txt" size="8966" author="blerer" created="Wed, 6 Apr 2016 11:55:52 +0000"/>
                            <attachment id="12796531" name="9861-2.2.txt" size="7013" author="blerer" created="Fri, 1 Apr 2016 14:17:16 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blerer]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 28 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2hjn3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aleksey</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>