<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:48:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-7924] Optimization of Java UDFs</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-7924</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Refactor &apos;java&apos; UDFs to optimize invocation. Goal is to remove reflection code. Implementation uses javassist to generate an instance of &lt;tt&gt;Function&lt;/tt&gt; that can be directly used.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12741243">CASSANDRA-7924</key>
            <summary>Optimization of Java UDFs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="snazy">Robert Stupp</assignee>
                                    <reporter username="snazy">Robert Stupp</reporter>
                        <labels>
                            <label>docs</label>
                            <label>lhf</label>
                            <label>udf</label>
                    </labels>
                <created>Sat, 13 Sep 2014 06:52:28 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:34 +0000</updated>
                            <resolved>Wed, 24 Sep 2014 15:48:03 +0000</resolved>
                                        <fixVersion>2.2.0 beta 1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14132599" author="snazy" created="Sat, 13 Sep 2014 08:10:55 +0000"  >&lt;p&gt;Patch with following changes:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;code generation for &apos;java&apos; UDFs now emits a class that basically extends/implements &lt;tt&gt;UDFunction&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;means: removal of reflection for &apos;java&apos; UDFs + no need for invocation-API&lt;/li&gt;
	&lt;li&gt;also (because it&apos;s trivial): &apos;class&apos; UDFs now use java.lang.invocation instead of java.lang.reflection&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14132600" author="snazy" created="Sat, 13 Sep 2014 08:11:36 +0000"  >&lt;p&gt;/cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt; for review?&lt;/p&gt;</comment>
                            <comment id="14132636" author="snazy" created="Sat, 13 Sep 2014 11:14:01 +0000"  >&lt;p&gt;patch updates (had wrong license header)&lt;/p&gt;</comment>
                            <comment id="14140631" author="blerer" created="Fri, 19 Sep 2014 14:18:11 +0000"  >&lt;p&gt;My comments:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;It seems to me that more than 90% of the code of &lt;tt&gt;AbstractJavaSourceUDF&lt;/tt&gt; is use to generate the code of the UDF classes. Due to that I think it should be better to convert it into a factory that do not extends UDFunction. It will make the things clearer on what is the main purpose of the class.&lt;/li&gt;
	&lt;li&gt;The code of &lt;tt&gt;AbstractJavaSourceUDF.buildUDF&lt;/tt&gt; should be split in smaller methods as it will make the code easier to read. I think that using &lt;tt&gt;String.format&lt;/tt&gt; instead of &lt;tt&gt;StringBuilder.append&lt;/tt&gt; will also help making the code more readable.&lt;/li&gt;
	&lt;li&gt;Calling &lt;tt&gt;CannotCompileException.getReason()&lt;/tt&gt; is the same as calling &lt;tt&gt;CannotCompileException.getMessage()&lt;/tt&gt; and calling&lt;br/&gt;
&lt;tt&gt;InvocationTargetException.getTargetException()&lt;/tt&gt; is the same as calling &lt;tt&gt;InvocationTargetException.getCause()&lt;/tt&gt;, so I think that you should decide if you perfer to append only the message or the full stack trace and merge the 3 catches into one.&lt;/li&gt;
	&lt;li&gt;You should remove the &lt;tt&gt;@SuppressWarnings&lt;/tt&gt; as they are only needed by your IDE (they actually trigger some warning in mine)&lt;/li&gt;
	&lt;li&gt;In &lt;tt&gt;UFTest.testFunctionCreationAndDrop&lt;/tt&gt;, could you add a test to verify that when one function as been drop you cannot call it anymore?&lt;/li&gt;
	&lt;li&gt;In &lt;tt&gt;UFTest.testCreateOrReplaceJavaFunction&lt;/tt&gt;, could you test that when you have replaced a function it will that one which is called?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14142442" author="snazy" created="Sun, 21 Sep 2014 13:27:39 +0000"  >&lt;p&gt;Patch v2 attached.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Replaced &lt;tt&gt;AbstractJavaSourceUDF&lt;/tt&gt; with &lt;tt&gt;JavaSourceUDFFactory&lt;/tt&gt; - generated functions now directly extend &lt;tt&gt;UDFunction&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;Split code generation into multiple methods and added comments to illustrate what&apos;s going on there. Replacing &lt;tt&gt;StringBuilder&lt;/tt&gt; with &lt;tt&gt;String.format&lt;/tt&gt; would not help much, because the parameter-loops would mess it up, too. Comments that illustrate how the generated code looks are there.&lt;/li&gt;
	&lt;li&gt;Simplified exception handling (as suggested). But &lt;tt&gt;InvocationTargetException&lt;/tt&gt; still requires special handling (we need the cause, not the ITE itself).&lt;/li&gt;
	&lt;li&gt;Added the two suggested tests.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14144803" author="blerer" created="Tue, 23 Sep 2014 13:46:49 +0000"  >&lt;p&gt;The code of &lt;tt&gt;JavaSourceUDFFactory&lt;/tt&gt; is much easier to read. Nice work.&lt;/p&gt;

&lt;p&gt;A few minor stuff:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Your large comments are good but they should be in the method javadocs and not in block comments. That way they will not interfer with the reading of the code but are there when the reader need to refer to them.&lt;/li&gt;
	&lt;li&gt;You sometime chain append and sometimes not. It is a bit disturbing. You should choose one and be consistent.&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="14145450" author="snazy" created="Tue, 23 Sep 2014 21:10:41 +0000"  >&lt;p&gt;patch v3 with fixes comments - branch updated, too&lt;/p&gt;</comment>
                            <comment id="14146130" author="blerer" created="Wed, 24 Sep 2014 09:37:45 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14146442" author="thobbs" created="Wed, 24 Sep 2014 15:48:03 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12720964">CASSANDRA-7395</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12668572" name="7924.txt" size="23666" author="snazy" created="Sat, 13 Sep 2014 11:14:01 +0000"/>
                            <attachment id="12670290" name="7924v2.txt" size="28217" author="snazy" created="Sun, 21 Sep 2014 13:21:32 +0000"/>
                            <attachment id="12670805" name="7924v3.txt" size="28279" author="snazy" created="Tue, 23 Sep 2014 21:10:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[snazy]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 8 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i20087:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>blerer</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blerer]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>