<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:52:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-9217] Error in cqlsh COPY TO</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-9217</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;On the current 2.1 branch I notice a few (possibly related) problems with cqlsh copy commands. I&apos;m writing them here together but we can separate if there are different causes.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;1. Cannot import from CSV if column name is &apos;date&apos;&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;Test file monthly.csv contents:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;stationid,metric,date
LAE,barometricpressure,2014-01-01 00:00:00+0000
LAE,barometricpressure,2014-02-01 00:00:00+0000
LAE,barometricpressure,2014-03-01 00:00:00+0000
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Steps:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;CREATE KEYSPACE IF NOT EXISTS weathercql WITH replication = { &apos;class&apos;: &apos;SimpleStrategy&apos;, &apos;replication_factor&apos;: &apos;1&apos; };
CREATE TABLE IF NOT EXISTS weathercql.monthly (
    stationid text,
    metric text,
    date timestamp,
    primary key (stationid, metric, date)
);
COPY weathercql.monthly (stationid, metric, date) FROM &apos;monthly.csv&apos; WITH HEADER=&apos;true&apos;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Result: the copy command fails unless date is enclosed in double quotes:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;cqlsh&amp;gt; COPY weathercql.monthly (stationid, metric, date) FROM &apos;monthly.csv&apos; WITH HEADER=&apos;true&apos;;
Improper COPY command.
cqlsh&amp;gt; COPY weathercql.monthly (stationid, metric, &quot;date&quot;) FROM &apos;monthly.csv&apos; WITH HEADER=&apos;true&apos;;
3 rows imported in 0.096 seconds.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If I instead name the &apos;date&apos; column as &apos;datex&apos;, it works without quotes.&lt;/p&gt;

&lt;p&gt;The same steps work on Cassandra 2.1.4 (release build).&lt;/p&gt;

&lt;p&gt;&lt;b&gt;2. Cannot copy to CSV&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;Sample data:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;create keyspace if not exists test with replication = {&apos;class&apos;:&apos;SimpleStrategy&apos;, &apos;replication_factor&apos;:1};
create table if not exists test.kv (key int primary key, value text);
insert into test.kv (key,value) values (1,&apos;alpha&apos;);
insert into test.kv (key,value) values (2,&apos;beta&apos;);
insert into test.kv (key,value) values (3,&apos;charlie&apos;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When you try to export to CSV, it throws what appears to be a Python error, and the file is not created correctly:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;cqlsh&amp;gt; copy test.kv (key,value) to &apos;test.csv&apos;;
global name &apos;meter&apos; is not defined
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The same steps work on Cassandra 2.1.4 (release build).&lt;/p&gt;

&lt;p&gt;&lt;b&gt;3. Copy from CSV inside CQL command file doesn&apos;t work&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;File kv.csv:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;key,value
1,&apos;a&apos;
2,&apos;b&apos;
3,&apos;c&apos;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;File kv.cql:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;create keyspace if not exists test with replication = {&apos;class&apos;: &apos;SimpleStrategy&apos;, &apos;replication_factor&apos;:1};
create table if not exists test.kv (key int primary key, value text);
truncate test.kv;
copy test.kv (key, value) from &apos;kv.csv&apos; with header=&apos;true&apos;;
select * from test.kv;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When command file passed to cqlsh, an error is reported on the `copy` command and it doesn&apos;t work:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ bin/cqlsh -f kv.cql
kv.cql:5:descriptor &apos;lower&apos; requires a &apos;str&apos; object but received a &apos;unicode&apos;
 key | value
-----+-------
(0 rows)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The same commands work correctly when run directly inside cqlsh or when executed with -e option like: &lt;tt&gt;bin/cqlsh -e &quot;copy test.kv (key, value) from &apos;kv.csv&apos; with header=&apos;true&apos;;&quot;&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;This third issue appears to also be broken in 2.1.4 and 2.1.3 release builds, but works in 2.1.2.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12822494">CASSANDRA-9217</key>
            <summary>Error in cqlsh COPY TO</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thobbs">Tom Hobbs</assignee>
                                    <reporter username="bcantoni">Brian Cantoni</reporter>
                        <labels>
                            <label>cqlsh</label>
                    </labels>
                <created>Mon, 20 Apr 2015 23:14:32 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:13 +0000</updated>
                            <resolved>Wed, 22 Apr 2015 15:52:16 +0000</resolved>
                                        <fixVersion>2.1.5</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14503987" author="sebastian.estevez@datastax.com" created="Mon, 20 Apr 2015 23:56:03 +0000"  >&lt;p&gt;If someone reaches this Jira and is in dire need of loading some bulk data. Give this a try:&lt;br/&gt;
&lt;a href=&quot;https://github.com/brianmhess/cassandra-loader&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/brianmhess/cassandra-loader&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14504031" author="bcantoni" created="Tue, 21 Apr 2015 00:33:40 +0000"  >&lt;p&gt;I did some git bisecting and each of the 3 issues points to a logical commit which changed the behaviors:&lt;/p&gt;

&lt;p&gt;1: commit 107545 for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7523&quot; title=&quot;add date and time types&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7523&quot;&gt;&lt;del&gt;CASSANDRA-7523&lt;/del&gt;&lt;/a&gt; (add date and time types)&lt;br/&gt;
2: commit 711090 for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8225&quot; title=&quot;Production-capable COPY FROM&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8225&quot;&gt;&lt;del&gt;CASSANDRA-8225&lt;/del&gt;&lt;/a&gt; (improve cqlsh &quot;copy from&quot; perf)&lt;br/&gt;
3: commit c49f66 for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8638&quot; title=&quot;CQLSH -f option should ignore BOM in files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8638&quot;&gt;&lt;del&gt;CASSANDRA-8638&lt;/del&gt;&lt;/a&gt; (handle unicode BOM at file start)&lt;/p&gt;

&lt;p&gt;Of these issues, #2 is probably the most important one. For #1 I imagine the remedy is to not use a field called &quot;date&quot;, and the scenario for #3 is probably not common.&lt;/p&gt;</comment>
                            <comment id="14505084" author="thobbs" created="Tue, 21 Apr 2015 15:05:18 +0000"  >&lt;p&gt;Issue #3 is &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9083&quot; title=&quot;cqlsh COPY functionality doesn&amp;#39;t work together with SOURCE or with cqlsh -f&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9083&quot;&gt;&lt;del&gt;CASSANDRA-9083&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14505706" author="thobbs" created="Tue, 21 Apr 2015 20:38:30 +0000"  >&lt;p&gt;The attached patch fixes COPY TO (and fixes a couple of minor unrelated cqlsh test failures).  I&apos;ve also started some basic dtests for COPY here: &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/commit/16c75a6f6c5fa6a1cd765775e185d407af373f82&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/riptano/cassandra-dtest/commit/16c75a6f6c5fa6a1cd765775e185d407af373f82&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14506738" author="stefania" created="Wed, 22 Apr 2015 09:50:35 +0000"  >&lt;p&gt;Code review is +1.&lt;/p&gt;

&lt;p&gt;Tests passing on my linux box:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;New dtest (test_copy_to)&lt;/li&gt;
	&lt;li&gt;Issues 1 and 2&lt;/li&gt;
	&lt;li&gt;Cqlshlib tests except for 2 failures below&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Still failing:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Issue 3&lt;/li&gt;
	&lt;li&gt;test_complete_in_update and test_complete_in_insert in cqlshlib&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Interestingly Issue 1 is working even without quotes for me, despite the patch did not address that.&lt;/p&gt;</comment>
                            <comment id="14507152" author="bcantoni" created="Wed, 22 Apr 2015 14:19:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Stefania&quot; class=&quot;user-hover&quot; rel=&quot;stefania&quot;&gt;Stefania&lt;/a&gt;, the source of issue 1 was &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7523&quot; title=&quot;add date and time types&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7523&quot;&gt;&lt;del&gt;CASSANDRA-7523&lt;/del&gt;&lt;/a&gt; (add date, time types) which was subsequently reverted from the 2.1 branch.&lt;/p&gt;</comment>
                            <comment id="14507165" author="stefania" created="Wed, 22 Apr 2015 14:30:16 +0000"  >&lt;p&gt;I see, thanks.&lt;/p&gt;</comment>
                            <comment id="14507294" author="thobbs" created="Wed, 22 Apr 2015 15:52:16 +0000"  >&lt;p&gt;Thanks, committed as &lt;tt&gt;93b36d4b&lt;/tt&gt; with a couple of additional minor fixes to the cqlsh completion tests to fix the failing cases you mentioned.  (They were expecting 3.0 behavior in a couple of places.)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12726992" name="9217-2.1.txt" size="5693" author="thobbs" created="Tue, 21 Apr 2015 20:38:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thobbs]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 30 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2die7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>stefania</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[stefania]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>