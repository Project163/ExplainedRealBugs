<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:19:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-16425] Improve handling of repair sessions during startup/shutdown</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-16425</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;We should send out a fail message on clean shutdown and if we find an ongoing repair session during startup we should fail it and tell participants.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13357005">CASSANDRA-16425</key>
            <summary>Improve handling of repair sessions during startup/shutdown</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="marcuse">Marcus Eriksson</assignee>
                                    <reporter username="marcuse">Marcus Eriksson</reporter>
                        <labels>
                    </labels>
                <created>Fri, 5 Feb 2021 09:24:26 +0000</created>
                <updated>Mon, 8 Mar 2021 17:13:13 +0000</updated>
                            <resolved>Mon, 8 Mar 2021 17:03:48 +0000</resolved>
                                        <fixVersion>4.0-rc1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Consistency/Repair</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17279497" author="krummas" created="Fri, 5 Feb 2021 09:29:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/krummas/cassandra/commits/marcuse/16425&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/krummas/cassandra/commits/marcuse/16425&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://app.circleci.com/pipelines/github/krummas/cassandra?branch=marcuse%2F16425&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/krummas/cassandra?branch=marcuse%2F16425&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17281190" author="clohfink" created="Mon, 8 Feb 2021 16:39:14 +0000"  >&lt;p&gt;failed test looks like flakey unrelated thing if can double check that.&lt;/p&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="17287824" author="michaelsembwever" created="Sat, 20 Feb 2021 23:17:05 +0000"  >&lt;p&gt;It &lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch/392/#showFailuresLink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;looks&lt;/a&gt; like this breaks the following three dtests:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch/392/testReport/junit/dtest.repair_tests.incremental_repair_test/TestIncRepair/test_manual_session_fail/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;repair_tests.incremental_repair_test.TestIncRepair.test_manual_session_fail&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch/392/testReport/junit/dtest.repair_tests.incremental_repair_test/TestIncRepair/test_manual_session_cancel_non_coordinator_failure/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;repair_tests.incremental_repair_test.TestIncRepair.test_manual_session_cancel_non_coordinator_failure&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch/392/testReport/junit/dtest.repair_tests.incremental_repair_test/TestIncRepair/test_manual_session_force_cancel/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;repair_tests.incremental_repair_test.TestIncRepair.test_manual_session_force_cancel&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Confirmed locally as well.&lt;/p&gt;</comment>
                            <comment id="17288252" author="bereng" created="Mon, 22 Feb 2021 08:36:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mck&quot; class=&quot;user-hover&quot; rel=&quot;mck&quot;&gt;mck&lt;/a&gt; contacted me asking if there was some duplication or overlap between this one and &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16446&quot; title=&quot;Parent repair sessions leak may lead to node long pauses&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16446&quot;&gt;&lt;del&gt;CASSANDRA-16446&lt;/del&gt;&lt;/a&gt;. I think they touch on the same area but on different points. Whereas &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcuse&quot; class=&quot;user-hover&quot; rel=&quot;marcuse&quot;&gt;marcuse&lt;/a&gt; is looking to have a clean startup/shutdown, which is perfectly valid, the other ticket tries to not leak them in the first place. I think they complement each other and are both valid if I am not missing anything.&lt;/p&gt;</comment>
                            <comment id="17288377" author="krummas" created="Mon, 22 Feb 2021 13:26:10 +0000"  >&lt;p&gt;ah thanks for noticing &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mck&quot; class=&quot;user-hover&quot; rel=&quot;mck&quot;&gt;mck&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;reason for the failures is that the node is bounced after adding the repair sessions to the table, which are then removed on startup by this patch&lt;/p&gt;

&lt;p&gt;migrated the tests to in-jvm dtests in the branch above and removed them from the python dtests here: &lt;a href=&quot;https://github.com/krummas/cassandra-dtest/commits/marcuse/16425&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/krummas/cassandra-dtest/commits/marcuse/16425&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17293669" author="michaelsembwever" created="Tue, 2 Mar 2021 12:29:55 +0000"  >&lt;p&gt;CI: &lt;a href=&quot;https://ci-cassandra.apache.org/blue/organizations/jenkins/Cassandra-devbranch/detail/Cassandra-devbranch/465/pipeline&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch/465/badge/icon&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/a&gt;, &lt;br/&gt;
based on&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/krummas/cassandra/commits/marcuse/16425&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cassandra&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/krummas/cassandra-dtest/commits/marcuse/16425&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17296276" author="aholmber" created="Fri, 5 Mar 2021 18:43:34 +0000"  >&lt;p&gt;I ran with rebased patch and tests following all the CI noise from this week, and it looks pretty good. There is a lot of red at first glance, but I think the failures are known and not related:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;python dtests failing two tests, addressed by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16483&quot; title=&quot;ColumnFilter::toString doesn&amp;#39;t return a valid CQL fragment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16483&quot;&gt;&lt;del&gt;CASSANDRA-16483&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;there are three jvm dtests failing everywhere, including trunk&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;One I haven&apos;t corroborated is &lt;tt&gt;testRecoverOverflowedExpirationWithSSTableScrub&lt;/tt&gt; in j11_unit_tests.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/aholmberg/cassandra?branch=CASSANDRA-16425&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/aholmberg/cassandra?branch=CASSANDRA-16425&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17296533" author="michaelsembwever" created="Sat, 6 Mar 2021 12:34:38 +0000"  >&lt;p&gt;CI run when through above, as well. &lt;tt&gt;testRecoverOverflowedExpirationWithSSTableScrub&lt;/tt&gt; looks ok &lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch/465/testReport/org.apache.cassandra.cql3.validation.operations/TTLTest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Of the 19 failures, most  (like Adam writes) can be attributed to other tickets and work. But it&apos;s a bit difficult to see clearly and there&apos;s a few that don&apos;t make sense. Kicking off a new rebased CI to double check&#8230; &lt;a href=&quot;https://ci-cassandra.apache.org/blue/organizations/jenkins/Cassandra-devbranch/detail/Cassandra-devbranch/466/pipeline&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch/466/badge/icon&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17297497" author="michaelsembwever" created="Mon, 8 Mar 2021 16:17:44 +0000"  >&lt;p&gt;The regressions from the above CI either cannot be reproduced locally or (for test_multi_partition_consistent_reads_after_write and test_resumable_rebuild)  are still the v5 crc known issues. &lt;/p&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="17297532" author="michaelsembwever" created="Mon, 8 Mar 2021 17:03:48 +0000"  >&lt;p&gt;Committed as &lt;a href=&quot;https://github.com/apache/cassandra/commit/5c84ed9ae8227e550630768a47fef7b2d1f1f1d7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;5c84ed9ae8227e550630768a47fef7b2d1f1f1d7&lt;/a&gt; and &lt;a href=&quot;https://github.com/apache/cassandra-dtest/commit/ad8ecc8ba492ad2492b57ead65593e0221182198&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ad8ecc8ba492ad2492b57ead65593e0221182198&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="13163" cascade-level=""><![CDATA[Code]]></customfieldvalue>
                                <customfieldvalue key="13164" cascade-level="1"><![CDATA[Bug - Unclear Impact]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12964"><![CDATA[Low Hanging Fruit]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12975"><![CDATA[Code Inspection]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 36 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0nefs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aholmber]]></customfieldvalue>
        <customfieldvalue><![CDATA[clohfink]]></customfieldvalue>
        <customfieldvalue><![CDATA[mck]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12348282">4.0-alpha2</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/5c84ed9ae8227e550630768a47fef7b2d1f1f1d7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/5c84ed9ae8227e550630768a47fef7b2d1f1f1d7&lt;/a&gt; &lt;a href=&quot;https://github.com/apache/cassandra-dtest/commit/ad8ecc8ba492ad2492b57ead65593e0221182198&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra-dtest/commit/ad8ecc8ba492ad2492b57ead65593e0221182198&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;unit test updated&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>