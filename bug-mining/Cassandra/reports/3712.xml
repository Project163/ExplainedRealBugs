<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:55:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-9031] nodetool info -T throws ArrayOutOfBounds when the node has not joined the cluster</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-9031</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;To reproduce, bring up a node that does not join the cluster, either using -Dcassandra.write_survey=true or -Dcassandra.join_ring=false, then run &apos;nodetool info -T&apos;. You&apos;ll get the following stack trace:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ID                     : e384209f-f7a9-4cff-8fd5-03adfaa0d846
Gossip active          : &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
Thrift active          : &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
Native Transport active: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
Load                   : 76.69 KB
Generation No          : 1427229938
Uptime (seconds)       : 728
Heap Memory (MB)       : 109.93 / 826.00
Off Heap Memory (MB)   : 0.01
Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.lang.IndexOutOfBoundsException: Index: 0, Size: 0
	at java.util.ArrayList.rangeCheck(ArrayList.java:635)
	at java.util.ArrayList.get(ArrayList.java:411)
	at org.apache.cassandra.tools.NodeProbe.getEndpoint(NodeProbe.java:676)
	at org.apache.cassandra.tools.NodeProbe.getDataCenter(NodeProbe.java:694)
	at org.apache.cassandra.tools.NodeCmd.printInfo(NodeCmd.java:666)
	at org.apache.cassandra.tools.NodeCmd.main(NodeCmd.java:1277)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After applying the attached patch, the new error is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ID                     : a7d76a2a-82d2-4faa-94e1-a30df6663ebb
Gossip active          : &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
Thrift active          : &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
Native Transport active: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
Load                   : 89.36 KB
Generation No          : 1427231804
Uptime (seconds)       : 12
Heap Memory (MB)       : 135.49 / 826.00
Off Heap Memory (MB)   : 0.01
Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.lang.RuntimeException: This node does not have any tokens. Perhaps it is not part of the ring?
	at org.apache.cassandra.tools.NodeProbe.getEndpoint(NodeProbe.java:678)
	at org.apache.cassandra.tools.NodeProbe.getDataCenter(NodeProbe.java:698)
	at org.apache.cassandra.tools.NodeCmd.printInfo(NodeCmd.java:676)
	at org.apache.cassandra.tools.NodeCmd.main(NodeCmd.java:1313)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12785308">CASSANDRA-9031</key>
            <summary>nodetool info -T throws ArrayOutOfBounds when the node has not joined the cluster</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yukim">Yuki Morishita</assignee>
                                    <reporter username="rkuris">Ron Kuris</reporter>
                        <labels>
                    </labels>
                <created>Tue, 24 Mar 2015 21:18:12 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:17 +0000</updated>
                            <resolved>Wed, 5 Aug 2015 22:07:38 +0000</resolved>
                                        <fixVersion>2.1.9</fixVersion>
                    <fixVersion>2.2.1</fixVersion>
                    <fixVersion>3.0 beta 1</fixVersion>
                                    <component>Tool/nodetool</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14387642" author="yukim" created="Mon, 30 Mar 2015 23:57:53 +0000"  >&lt;p&gt;Thanks for the patch.&lt;br/&gt;
Although your patch makes it clear tokens are not available yet, I think it&apos;d be better to skip showing DC/Rack info rather than throwing exception.&lt;br/&gt;
In addition to your patch, adding token check before displaying DC/Rack in &lt;tt&gt;NodeCmd#printInfo&lt;/tt&gt; would be nice.&lt;/p&gt;

&lt;p&gt;WDYT?&lt;/p&gt;</comment>
                            <comment id="14387820" author="rkuris" created="Tue, 31 Mar 2015 02:01:10 +0000"  >&lt;p&gt;Sounds good to me. Do you want me to submit another patch?&lt;/p&gt;</comment>
                            <comment id="14649498" author="yukim" created="Fri, 31 Jul 2015 17:18:48 +0000"  >&lt;p&gt;Sorry for the delay.&lt;br/&gt;
&lt;tt&gt;TokenMetadata#getToken&lt;/tt&gt; throws AssertionException when the node is not yet a member of the cluster.&lt;br/&gt;
Changing that methods behavior is a bit scary since it is used in other parts.&lt;/p&gt;

&lt;p&gt;Instead, we can use host ID to get endpoint from nodetool.&lt;br/&gt;
That way, we can display DC/Rack as well.&lt;/p&gt;

&lt;p&gt;patch pushed to here: &lt;a href=&quot;https://github.com/yukim/cassandra/tree/9031&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/yukim/cassandra/tree/9031&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14649517" author="jbellis" created="Fri, 31 Jul 2015 17:34:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Stefania&quot; class=&quot;user-hover&quot; rel=&quot;stefania&quot;&gt;Stefania&lt;/a&gt; to review&lt;/p&gt;</comment>
                            <comment id="14650203" author="stefania" created="Sat, 1 Aug 2015 07:46:36 +0000"  >&lt;p&gt;Maybe there is something I am missing so please double check but isn&apos;t this code&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getEndpoint()
    {
        Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; hostIdToEndpoint = ssProxy.getHostIdMap();
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; hostIdToEndpoint.get(ssProxy.getLocalHostId());
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;always going to return &lt;tt&gt;FBUtilities.getBroadcastAddress()&lt;/tt&gt;?&lt;/p&gt;

&lt;p&gt;Aside from this, code is +1.&lt;/p&gt;

&lt;p&gt;Technically we should have a dtest, but since the nodetool tests are yet to be implemented, perhaps we should link this ticket to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-9349&quot; title=&quot;nodetool is not explicitly tested&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-9349&quot;&gt;CASSANDRA-9349&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="14652666" author="yukim" created="Mon, 3 Aug 2015 22:24:29 +0000"  >&lt;p&gt;Thanks for the review.&lt;/p&gt;

&lt;p&gt;I guess the reason we are doing weired implementation for nodetool now is lack of the way to get endpoint, dc and rack info of connected node straight from JMX.&lt;br/&gt;
We can add JMX interface for those in 3.0. (will create that later.)&lt;/p&gt;

&lt;p&gt;For fix in 2.1 and 2.2, I think we need to stick with what we have for now.&lt;/p&gt;</comment>
                            <comment id="14654764" author="stefania" created="Wed, 5 Aug 2015 03:49:01 +0000"  >&lt;p&gt;Oh sorry about it, I forgot we are still client side.&lt;/p&gt;

&lt;p&gt;+1 to commit.&lt;/p&gt;
</comment>
                            <comment id="14659054" author="yukim" created="Wed, 5 Aug 2015 22:07:38 +0000"  >&lt;p&gt;Committed, thanks!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12828962">CASSANDRA-9349</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12707012" name="patch.txt" size="1468" author="rkuris" created="Tue, 24 Mar 2015 21:18:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[yukim]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 15 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i27auv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12329259">2.0.13</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>stefania</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[stefania]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>