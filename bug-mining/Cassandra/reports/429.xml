<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:16:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-1377] NPE aborts streaming operations for keyspaces with hyphens (&apos;-&apos;) in their names</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-1377</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;When streaming starts for operations such as repair or bootstrap, it will fail due to an NPE if they rows are in a keyspace that has a hyphen in its name.  One workaround for this issue would be to not use keyspace names containing hyphens.  It would be even nicer if streaming worked for keyspace names with hyphens, since keyspaces named like that seem to be fine in all other ways.&lt;/p&gt;

&lt;p&gt;To reproduce:&lt;br/&gt;
 1. With a multi-node ring, load up a keyspace with a hyphen in its name&lt;br/&gt;
 2. Add some data to that keyspace&lt;br/&gt;
 3. nodetool repair&lt;/p&gt;

&lt;p&gt;Expected results:&lt;br/&gt;
Repair operations complete normally&lt;/p&gt;

&lt;p&gt;Actual results:&lt;br/&gt;
Repair operations don&apos;t complete normally.  The stacktrace below is correlated with the repair request.  &lt;/p&gt;

&lt;p&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;AE-SERVICE-STAGE:1&amp;#93;&lt;/span&gt; 2010-06-30 14:11:29,744 AntiEntropyService.java (line 619) Performing streaming repair of 1 ranges to /10.255.0.20 for (my-keyspace,AColumnFamily)&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;MESSAGE-DESERIALIZER-POOL:1&amp;#93;&lt;/span&gt; 2010-06-30 14:11:30,034 DebuggableThreadPoolExecutor.java (line 101) Error in ThreadPoolExecutor&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
        at org.apache.cassandra.streaming.StreamInitiateVerbHandler.getNewNames(StreamInitiateVerbHandler.java:154)&lt;br/&gt;
        at org.apache.cassandra.streaming.StreamInitiateVerbHandler.doVerb(StreamInitiateVerbHandler.java:76)&lt;br/&gt;
        at org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:40)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:619)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12471303">CASSANDRA-1377</key>
            <summary>NPE aborts streaming operations for keyspaces with hyphens (&apos;-&apos;) in their names</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gdusbabek">Gary Dusbabek</assignee>
                                    <reporter username="bhoyt">Ben Hoyt</reporter>
                        <labels>
                    </labels>
                <created>Wed, 11 Aug 2010 14:54:58 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:19 +0000</updated>
                            <resolved>Thu, 12 Aug 2010 21:40:26 +0000</resolved>
                                        <fixVersion>0.6.5</fixVersion>
                    <fixVersion>0.7 beta 2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12897554" author="gdusbabek" created="Thu, 12 Aug 2010 02:40:49 +0000"  >&lt;p&gt;We currently disallow hyphens in CF names.  It sounds like we need to disallow it in KS names too.&lt;/p&gt;</comment>
                            <comment id="12897582" author="jbellis" created="Thu, 12 Aug 2010 05:15:41 +0000"  >&lt;p&gt;I vote for disallowing everything but \w characters - &lt;span class=&quot;error&quot;&gt;&amp;#91;a-zA-Z0-9_&amp;#93;&lt;/span&gt; &lt;/p&gt;</comment>
                            <comment id="12897842" author="gdusbabek" created="Thu, 12 Aug 2010 17:03:25 +0000"  >&lt;p&gt;0001 is for trunk, 1377-0.6 is for 0.6.&lt;/p&gt;</comment>
                            <comment id="12897888" author="jbellis" created="Thu, 12 Aug 2010 18:36:43 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="12898578" author="hudson" created="Sat, 14 Aug 2010 12:48:32 +0000"  >&lt;p&gt;Integrated in Cassandra #514 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Cassandra/514/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Cassandra/514/&lt;/a&gt;)&lt;br/&gt;
    disallow invalid ks+cf names. patch by gdusbabek, reviewed by jbellis. &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1377&quot; title=&quot;NPE aborts streaming operations for keyspaces with hyphens (&amp;#39;-&amp;#39;) in their names&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1377&quot;&gt;&lt;del&gt;CASSANDRA-1377&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12901007" author="hudson" created="Sat, 21 Aug 2010 11:14:32 +0000"  >&lt;p&gt;Integrated in Cassandra #518 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Cassandra/518/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hudson.apache.org/hudson/job/Cassandra/518/&lt;/a&gt;)&lt;br/&gt;
    CHANGES.txt and NEWS.txt update explaining the ramifications of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1377&quot; title=&quot;NPE aborts streaming operations for keyspaces with hyphens (&amp;#39;-&amp;#39;) in their names&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1377&quot;&gt;&lt;del&gt;CASSANDRA-1377&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12901538" author="gdusbabek" created="Mon, 23 Aug 2010 19:00:53 +0000"  >&lt;p&gt;eonnen in #cassandra has made a compelling argument that committing this to 0.6 breaks some backwards compatibility.  I am inclined to agree if the amount of work to handle dashes during streaming is trivial.&lt;/p&gt;</comment>
                            <comment id="12901542" author="jbellis" created="Mon, 23 Aug 2010 19:11:19 +0000"  >&lt;p&gt;We really need some &quot;reserved&quot; characters in keyspace/CF names.  You can make a case that restricting them to \w is going too far in the other direction, but hyphens have always been reserved, and letting them pass in keyspaces was definitely a bug that was going to bite us (see: this issue).&lt;/p&gt;</comment>
                            <comment id="12901545" author="jbellis" created="Mon, 23 Aug 2010 19:15:16 +0000"  >&lt;p&gt;(One of the reasons I&apos;d like to restrict to \w is that makes us not have to deal with people reporting bugs from Thrift strings being utf8-encoded in some languages and not in others.)&lt;/p&gt;</comment>
                            <comment id="12901610" author="eonnen" created="Mon, 23 Aug 2010 21:48:59 +0000"  >&lt;p&gt;We have a multi-tenant deployment hosting multiple customers, each with multiple deployments of our upstream software (think test/prod). For each customer deployment, we&apos;ve had a UUID identifying the instance since before the dawn of time, or at least since before Cassandra &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Up until this change, using a keyspace-UUID mapping worked perfectly, especially after set_keyspace was added to the lower-level client API which allowed us to have pools for a given customer with different customers able to have different throughput to a point.&lt;/p&gt;

&lt;p&gt;In hopes of getting this relaxed just a bit to allow &quot;-&quot;, I&apos;ve attached a fix for the bug in 0.6.0 tested with a keyspace name of &quot;e610eed7-c6be-449b-ad2c-562f35d75528&quot; which is a Type4 UUID. If you can broaden the limit here just a bit, we&apos;ll be good. I don&apos;t think it&apos;s all that unrealistic that users will want to have a keyspace correspond to real artifacts in their system (although I don&apos;t feel the same about CF names). This would at least broaden things just enough to allow UUIDs at that level.&lt;/p&gt;

&lt;p&gt;While I understand the need to limit what goes into the name of the keyspace and why, it&apos;s too restrictive for my needs and I&apos;ll argue against it at least and try and patch my way out of it as long as you&apos;ll listen.&lt;/p&gt;

&lt;p&gt;Happy to do the same for 0.7.0 if you&apos;re receptive.&lt;/p&gt;</comment>
                            <comment id="12901614" author="eonnen" created="Mon, 23 Aug 2010 21:51:33 +0000"  >&lt;p&gt;Fixes NPE with &quot;-&quot; in Keyspace names, re-allows using them at the DatabaseDescriptor.&lt;/p&gt;</comment>
                            <comment id="12901705" author="jbellis" created="Tue, 24 Aug 2010 02:08:15 +0000"  >&lt;p&gt;committed Erik&apos;s patch to 0.6 and trunk.&lt;/p&gt;

&lt;p&gt;I still think we need to make some explicit rules about reserved characters but I agree that 0.6.5 is not the place to make that change.&lt;/p&gt;</comment>
                            <comment id="12901713" author="eonnen" created="Tue, 24 Aug 2010 03:02:53 +0000"  >&lt;p&gt;This patch lightens the restriction on KS names to allow &quot;-&quot; in addition to &lt;br class=&quot;atl-forced-newline&quot; /&gt;w bringing in line the functionality w/ the 0.6 patch submitted earlier.&lt;/p&gt;</comment>
                            <comment id="12901714" author="eonnen" created="Tue, 24 Aug 2010 03:05:54 +0000"  >&lt;p&gt;Thanks Jonathan. I added one additional patch to relax things slightly in 0.7 trunk. Tested with a nodetool loadbalance and nodetool move with a two node ring and both worked fine. Lots of changes in the streaming code between 0.6 and 0.7 and it looks like the broken code didn&apos;t move forward into 0.7 near as I can tell in reading though it.&lt;/p&gt;</comment>
                            <comment id="12901718" author="eonnen" created="Tue, 24 Aug 2010 03:42:00 +0000"  >&lt;p&gt;Forgot to attach test in CAS-1377-1.patch&lt;/p&gt;</comment>
                            <comment id="12901858" author="gdusbabek" created="Tue, 24 Aug 2010 12:59:39 +0000"  >&lt;p&gt;Puts hyphen check back into CF definition.&lt;/p&gt;</comment>
                            <comment id="12901878" author="jbellis" created="Tue, 24 Aug 2010 13:37:27 +0000"  >&lt;p&gt;+1 hyphens-in-CF check&lt;/p&gt;</comment>
                            <comment id="12901879" author="gdusbabek" created="Tue, 24 Aug 2010 13:40:09 +0000"  >&lt;p&gt;committed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12452925" name="1377-0.6-check-for-dashes.txt" size="805" author="gdusbabek" created="Tue, 24 Aug 2010 12:59:39 +0000"/>
                            <attachment id="12451925" name="1377-0.6.txt" size="1459" author="gdusbabek" created="Thu, 12 Aug 2010 17:03:25 +0000"/>
                            <attachment id="12451923" name="ASF.LICENSE.NOT.GRANTED--v1-0001-disallow-invalid-ks-cf-names.txt" size="9756" author="gdusbabek" created="Thu, 12 Aug 2010 17:02:46 +0000"/>
                            <attachment id="12452887" name="CAS-1377-1.patch" size="702" author="eonnen" created="Tue, 24 Aug 2010 03:02:53 +0000"/>
                            <attachment id="12452889" name="CAS-1377-2.patch" size="811" author="eonnen" created="Tue, 24 Aug 2010 03:42:00 +0000"/>
                            <attachment id="12452863" name="CAS-1377.patch" size="2051" author="eonnen" created="Mon, 23 Aug 2010 21:51:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[gdusbabek]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20110</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 14 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0g4on:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>92189</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>