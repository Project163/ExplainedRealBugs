<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:28:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-3696] Adding another datacenter&apos;s node results in 0 rows returned on first datacenter</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-3696</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;On Cassandra-1.0.5:&lt;br/&gt;
1. Create a node in C* with a fresh installation and create a keyspace on that node with one column family -&lt;/p&gt;

&lt;p&gt;CREATE KEYSPACE test &lt;br/&gt;
WITH placement_strategy = &apos;SimpleStrategy&apos; &lt;br/&gt;
and strategy_options=&lt;/p&gt;
{replication_factor:1}
&lt;p&gt;;&lt;/p&gt;

&lt;p&gt;use test; &lt;br/&gt;
create column family cf1;&lt;/p&gt;

&lt;p&gt;2. Insert values into cf1 -&lt;/p&gt;

&lt;p&gt;set cf1&lt;span class=&quot;error&quot;&gt;&amp;#91;ascii(&amp;#39;k&amp;#39;)&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ascii(&amp;#39;c&amp;#39;)&amp;#93;&lt;/span&gt; = ascii(&apos;v&apos;);&lt;/p&gt;

&lt;p&gt;get cf1&lt;span class=&quot;error&quot;&gt;&amp;#91;ascii(&amp;#39;k&amp;#39;)&amp;#93;&lt;/span&gt;; &lt;br/&gt;
=&amp;gt; (column=63, value=v, timestamp=1325689630397000) &lt;br/&gt;
Returned 1 results.&lt;/p&gt;

&lt;p&gt;3. update the strategy options from simple to networktopology with &lt;/p&gt;
{Cassandra:1, Backup:1}
&lt;p&gt; &lt;br/&gt;
4. read from cf1 to make sure the options change doesn&apos;t affect anything -&lt;/p&gt;

&lt;p&gt;consistencylevel as LOCAL_QUORUM; &lt;br/&gt;
get cf1&lt;span class=&quot;error&quot;&gt;&amp;#91;ascii(&amp;#39;k&amp;#39;)&amp;#93;&lt;/span&gt;; &lt;br/&gt;
=&amp;gt; (column=63, value=v, timestamp=1325689630397000) &lt;br/&gt;
Returned 1 results.&lt;/p&gt;

&lt;p&gt;5. start a second node in the Backup datacenter &lt;br/&gt;
6. read from cf1 again (on the first node) -&lt;/p&gt;

&lt;p&gt;consistencylevel as LOCAL_QUORUM; &lt;br/&gt;
get cf1&lt;span class=&quot;error&quot;&gt;&amp;#91;ascii(&amp;#39;k&amp;#39;)&amp;#93;&lt;/span&gt;; &lt;br/&gt;
Returned 0 results.&lt;/p&gt;

&lt;p&gt;After about 60 seconds, &quot;get cf1&lt;span class=&quot;error&quot;&gt;&amp;#91;ascii(&amp;#39;k&amp;#39;)&amp;#93;&lt;/span&gt;&quot; started to return results again. &lt;/p&gt;

&lt;p&gt;Also, when running at a CL of ONE on 1.0&apos;s head, we were able to see issues as well.&lt;/p&gt;

&lt;p&gt;But, if more than one node was added to the second datacenter, then replication_strategy is changed, it seems okay.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12537228">CASSANDRA-3696</key>
            <summary>Adding another datacenter&apos;s node results in 0 rows returned on first datacenter</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="j.casares">Joaquin Casares</reporter>
                        <labels>
                    </labels>
                <created>Wed, 4 Jan 2012 19:02:33 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:43 +0000</updated>
                            <resolved>Thu, 5 Jan 2012 22:42:28 +0000</resolved>
                                        <fixVersion>0.8.10</fixVersion>
                    <fixVersion>1.0.7</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13179782" author="jbellis" created="Wed, 4 Jan 2012 19:24:52 +0000"  >&lt;p&gt;ONE is expected to not return results in this situation, if it happens to query the new node.  But LOCAL_QUORUM against the first node should be fine.&lt;/p&gt;

&lt;p&gt;Can you post the debug log of a query failing at LOCAL_QUORUM?  1.0 head preferred but 1.0.5 is fine if you already have it.&lt;/p&gt;</comment>
                            <comment id="13180069" author="brandon.williams" created="Thu, 5 Jan 2012 01:13:13 +0000"  >&lt;p&gt;I can reproduce this reliably, but only if read repair is on.  With it off, everything works.  Here is failed read:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;DEBUG [pool-2-thread-7] 2012-01-05 01:00:51,523 CassandraServer.java (line 323) get_slice
DEBUG [pool-2-thread-7] 2012-01-05 01:00:51,523 StorageProxy.java (line 603) Command/ConsistencyLevel is SliceFromReadCommand(table=&apos;Keyspace1&apos;, key=&apos;303637&apos;, column_parent=&apos;QueryPath(columnFamilyName=&apos;Standard1&apos;, superColumnName=&apos;null&apos;, columnName=&apos;null&apos;)&apos;, start=&apos;&apos;, finish=&apos;&apos;, reversed=false, count=5)/LOCAL_QUORUM
DEBUG [pool-2-thread-7] 2012-01-05 01:00:51,523 PropertyFileSnitch.java (line 90) Could not find end point information for cassandra-1/10.179.65.102, will use default
DEBUG [pool-2-thread-7] 2012-01-05 01:00:51,523 PropertyFileSnitch.java (line 90) Could not find end point information for /10.179.111.137, will use default
DEBUG [pool-2-thread-7] 2012-01-05 01:00:51,523 ReadCallback.java (line 77) Blockfor/repair is 1/true; setting up requests to /10.179.64.227,/10.179.111.137
DEBUG [pool-2-thread-7] 2012-01-05 01:00:51,523 PropertyFileSnitch.java (line 90) Could not find end point information for /10.179.111.137, will use default
DEBUG [pool-2-thread-7] 2012-01-05 01:00:51,523 StorageProxy.java (line 624) reading data from /10.179.64.227
DEBUG [pool-2-thread-7] 2012-01-05 01:00:51,524 StorageProxy.java (line 644) reading digest from /10.179.111.137
DEBUG [RequestResponseStage:9] 2012-01-05 01:00:51,526 ResponseVerbHandler.java (line 44) Processing response on a callback from 4145@/10.179.111.137
DEBUG [RequestResponseStage:10] 2012-01-05 01:00:51,526 ResponseVerbHandler.java (line 44) Processing response on a callback from 4144@/10.179.64.227
DEBUG [RequestResponseStage:9] 2012-01-05 01:00:51,526 AbstractRowResolver.java (line 66) Preprocessed digest response
DEBUG [RequestResponseStage:10] 2012-01-05 01:00:51,526 AbstractRowResolver.java (line 66) Preprocessed data response
DEBUG [RequestResponseStage:9] 2012-01-05 01:00:51,527 PropertyFileSnitch.java (line 90) Could not find end point information for /10.179.111.137, will use default
DEBUG [pool-2-thread-7] 2012-01-05 01:00:51,527 StorageProxy.java (line 672) Read: 3 ms.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In this case, 10.179.65.102 and 10.179.111.137 are in the first datacenter, and 10.179.64.227 is in the second.  Both DCs have an RF of one, .102 is always the coordinator and the client is using a single connection.&lt;/p&gt;

&lt;p&gt;For comparison, here is a successful local read where read repair did not fire (set to 10%):&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;
DEBUG [pool-2-thread-7] 2012-01-05 01:00:51,519 CassandraServer.java (line 323) get_slice
DEBUG [pool-2-thread-7] 2012-01-05 01:00:51,519 StorageProxy.java (line 603) Command/ConsistencyLevel is SliceFromReadCommand(table=&apos;Keyspace1&apos;, key=&apos;303632&apos;, column_parent=&apos;QueryPath(columnFamilyName=&apos;Standard1&apos;, superColumnName=&apos;null&apos;, columnName=&apos;null&apos;)&apos;, start=&apos;&apos;, finish=&apos;&apos;, reversed=false, count=5)/LOCAL_QUORUM
DEBUG [pool-2-thread-7] 2012-01-05 01:00:51,519 PropertyFileSnitch.java (line 90) Could not find end point information for cassandra-1/10.179.65.102, will use default
DEBUG [pool-2-thread-7] 2012-01-05 01:00:51,520 ReadCallback.java (line 77) Blockfor/repair is 1/false; setting up requests to cassandra-1/10.179.65.102
DEBUG [pool-2-thread-7] 2012-01-05 01:00:51,520 PropertyFileSnitch.java (line 90) Could not find end point information for cassandra-1/10.179.65.102, will use default
DEBUG [pool-2-thread-7] 2012-01-05 01:00:51,520 StorageProxy.java (line 619) reading data locally
DEBUG [ReadStage:93] 2012-01-05 01:00:51,520 StorageProxy.java (line 763) LocalReadRunnable reading SliceFromReadCommand(table=&apos;Keyspace1&apos;, key=&apos;303632&apos;, column_parent=&apos;QueryPath(columnFamilyName=&apos;Standard1&apos;, superColumnName=&apos;null&apos;, columnName=&apos;null&apos;)&apos;, start=&apos;&apos;, finish=&apos;&apos;, reversed=false, count=5)
DEBUG [ReadStage:93] 2012-01-05 01:00:51,520 CollationController.java (line 192) collectAllData
DEBUG [ReadStage:93] 2012-01-05 01:00:51,521 SliceQueryFilter.java (line 123) collecting 0 of 5: C0:false:34@1325724968371
DEBUG [ReadStage:93] 2012-01-05 01:00:51,521 SliceQueryFilter.java (line 123) collecting 1 of 5: C1:false:34@1325724968371
DEBUG [ReadStage:93] 2012-01-05 01:00:51,521 SliceQueryFilter.java (line 123) collecting 2 of 5: C2:false:34@1325724968371
DEBUG [ReadStage:93] 2012-01-05 01:00:51,521 SliceQueryFilter.java (line 123) collecting 3 of 5: C3:false:34@1325724968371
DEBUG [ReadStage:93] 2012-01-05 01:00:51,521 SliceQueryFilter.java (line 123) collecting 4 of 5: C4:false:34@1325724968371
DEBUG [pool-2-thread-7] 2012-01-05 01:00:51,522 StorageProxy.java (line 672) Read: 2 ms.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And one where it asked .137 for data (but did not leave the DC or repair):&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;DEBUG [pool-2-thread-7] 2012-01-05 01:00:51,514 CassandraServer.java (line 323) get_slice
DEBUG [pool-2-thread-7] 2012-01-05 01:00:51,514 StorageProxy.java (line 603) Command/ConsistencyLevel is SliceFromReadCommand(table=&apos;Keyspace1&apos;, key=&apos;303731&apos;, column_parent=&apos;QueryPath(columnFamilyName=&apos;Standard1&apos;, superColumnName=&apos;null&apos;, columnName=&apos;null&apos;)&apos;, start=&apos;&apos;, finish=&apos;&apos;, reversed=false, count=5)/LOCAL_QUORUM
DEBUG [pool-2-thread-7] 2012-01-05 01:00:51,514 PropertyFileSnitch.java (line 90) Could not find end point information for cassandra-1/10.179.65.102, will use default
DEBUG [pool-2-thread-7] 2012-01-05 01:00:51,514 PropertyFileSnitch.java (line 90) Could not find end point information for /10.179.111.137, will use default
DEBUG [pool-2-thread-7] 2012-01-05 01:00:51,514 PropertyFileSnitch.java (line 90) Could not find end point information for /10.179.111.137, will use default
DEBUG [pool-2-thread-7] 2012-01-05 01:00:51,515 ReadCallback.java (line 77) Blockfor/repair is 1/false; setting up requests to /10.179.111.137
DEBUG [pool-2-thread-7] 2012-01-05 01:00:51,515 PropertyFileSnitch.java (line 90) Could not find end point information for /10.179.111.137, will use default
DEBUG [pool-2-thread-7] 2012-01-05 01:00:51,515 StorageProxy.java (line 624) reading data from /10.179.111.137
DEBUG [RequestResponseStage:12] 2012-01-05 01:00:51,517 ResponseVerbHandler.java (line 44) Processing response on a callback from 4143@/10.179.111.137
DEBUG [RequestResponseStage:12] 2012-01-05 01:00:51,517 AbstractRowResolver.java (line 66) Preprocessed data response
DEBUG [RequestResponseStage:12] 2012-01-05 01:00:51,517 PropertyFileSnitch.java (line 90) Could not find end point information for /10.179.111.137, will use default
DEBUG [pool-2-thread-7] 2012-01-05 01:00:51,517 StorageProxy.java (line 672) Read: 2 ms.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13180157" author="jbellis" created="Thu, 5 Jan 2012 03:10:59 +0000"  >&lt;p&gt;Fix attached.  The problem is we were only pulling out the local-dc replicas when RR was enabled.  We still need to force a local-DC replica to the front of the endpoints list otherwise, since that will get the data read.&lt;/p&gt;</comment>
                            <comment id="13180467" author="jbellis" created="Thu, 5 Jan 2012 15:33:18 +0000"  >&lt;p&gt;(patch is against 1.0 but probably needed by 0.8 too.)&lt;/p&gt;</comment>
                            <comment id="13180673" author="vijay2win@yahoo.com" created="Thu, 5 Jan 2012 18:38:54 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13180906" author="jbellis" created="Thu, 5 Jan 2012 22:42:28 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12509499" name="3696.txt" size="4535" author="jbellis" created="Thu, 5 Jan 2012 03:10:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>222737</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 46 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gn4n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>95177</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>vijay2win@yahoo.com</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[vijay2win@yahoo.com]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>