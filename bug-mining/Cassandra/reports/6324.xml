<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:28:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-18756] TimeWindowCompactionStrategy with unsafe_aggressive_sstable_expiration keeps overlaping SSTable references</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-18756</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;When &lt;tt&gt;unsafe_aggressive_sstable_expiration&lt;/tt&gt; is turned on, TWCS should not create or maintain an iterator of overlapping sstables. However, because &lt;tt&gt;TimeWindowCompactionController&lt;/tt&gt; inherits from &lt;tt&gt;CompactionController&lt;/tt&gt; and only sets &lt;tt&gt;ignoreOverlaps&lt;/tt&gt; after the base class has constructed the overlap iterator, it ends up making an overlap iterator and then never updating it.&lt;/p&gt;

&lt;p&gt;The end result is that such a compaction keeps references to lots of and likely &lt;em&gt;all&lt;/em&gt; other SSTables on the node and thus delays the deletion of obsolete ones by hours or even days.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13547377">CASSANDRA-18756</key>
            <summary>TimeWindowCompactionStrategy with unsafe_aggressive_sstable_expiration keeps overlaping SSTable references</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ethan.brown">Ethan Brown</assignee>
                                    <reporter username="blambov">Branimir Lambov</reporter>
                        <labels>
                    </labels>
                <created>Tue, 15 Aug 2023 12:48:31 +0000</created>
                <updated>Wed, 1 Nov 2023 08:54:52 +0000</updated>
                            <resolved>Thu, 21 Sep 2023 14:26:30 +0000</resolved>
                                        <fixVersion>3.11.17</fixVersion>
                    <fixVersion>4.0.12</fixVersion>
                    <fixVersion>4.1.4</fixVersion>
                    <fixVersion>5.0-alpha2</fixVersion>
                    <fixVersion>5.0</fixVersion>
                    <fixVersion>5.1</fixVersion>
                                    <component>Local/Compaction</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1800">0.5h</timespent>
                                <comments>
                            <comment id="17754645" author="blambov" created="Tue, 15 Aug 2023 13:33:48 +0000"  >&lt;p&gt;Well, things are a bit more complex. Because the iterator is indeed created, the &lt;tt&gt;ignoreOverlaps&lt;/tt&gt; flag does not have the intended effect of not taking into account older sstables that may have data shadowed by a tombstone. This behaviour is helping make the option much safer than it would otherwise be, and cannot be changed without risking unexpected data resurrection.&lt;/p&gt;

&lt;p&gt;Because of this a fix for this issue should remove the overlap iterator part of the intended meaning of &lt;tt&gt;unsafe_aggressive_sstable_expiration&lt;/tt&gt;&#160;rather than make it work correctly.&lt;/p&gt;</comment>
                            <comment id="17761314" author="blambov" created="Fri, 1 Sep 2023 13:33:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mck&quot; class=&quot;user-hover&quot; rel=&quot;mck&quot;&gt;mck&lt;/a&gt;, could you do the second review this small patch which corrects a problem with &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-13418&quot; title=&quot;Allow TWCS to ignore overlaps when dropping fully expired sstables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-13418&quot;&gt;&lt;del&gt;CASSANDRA-13418&lt;/del&gt;&lt;/a&gt;? Your name came up as a reviewer for that ticket and it would be great to get the opinion of someone who has some context on it.&lt;/p&gt;</comment>
                            <comment id="17761365" author="michaelsembwever" created="Fri, 1 Sep 2023 18:01:59 +0000"  >&lt;p&gt;Given this feature can only be enabled with both the table option and a system variable, and it&apos;s overly clear the risks (and carefully documented), I would have no objection to making it work correctly.  It can have a dramatic saving on nodes for its intended use-cases.  I leave that call up to you both.&lt;/p&gt;

&lt;p&gt;Otherwise, +1 on the patch as it is.&lt;/p&gt;</comment>
                            <comment id="17761375" author="blambov" created="Fri, 1 Sep 2023 18:44:58 +0000"  >&lt;p&gt;There&apos;s a risk that making it work as intended will unexpectedly change behaviour for people that are already using the flag, and I would rather not do that. Especially if we change it in patch releases for all supported versions.&lt;/p&gt;

&lt;p&gt;If we are to enable that functionality, IMHO it should be under a different flag (and then only for a subset of versions).&lt;/p&gt;</comment>
                            <comment id="17761380" author="michaelsembwever" created="Fri, 1 Sep 2023 19:12:00 +0000"  >&lt;p&gt;&amp;gt; Especially if we change it in patch releases for all supported versions.&lt;/p&gt;

&lt;p&gt;Right. I would only do the change in a major, with a NEWS entry.&lt;/p&gt;</comment>
                            <comment id="17767588" author="blambov" created="Thu, 21 Sep 2023 14:26:30 +0000"  >&lt;p&gt;Commited (&lt;a href=&quot;https://github.com/apache/cassandra/commit/87c2af85c1305c130af7d66f83dec03a1c4a8bb2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.11&lt;/a&gt; &lt;a href=&quot;https://github.com/apache/cassandra/commit/c6385ac3ddccabdc7cb650b090fa69c0523274e8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4.0&lt;/a&gt; &lt;a href=&quot;https://github.com/apache/cassandra/commit/db6641fbb6fd0c439e14f94caecdeee999311c62&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4.1&lt;/a&gt; &lt;a href=&quot;https://github.com/apache/cassandra/commit/a23f4c0b15c684240ef0bcd55875610e8bd7179b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;5.0&lt;/a&gt; &lt;a href=&quot;https://github.com/apache/cassandra/commit/970ec2d1db5770c13a42e1f2862ea398317d0f15&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13061867">CASSANDRA-13418</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[ethan.brown]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12984" cascade-level=""><![CDATA[Degradation]]></customfieldvalue>
                                <customfieldvalue key="12995" cascade-level="1"><![CDATA[Resource Management]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12964"><![CDATA[Low Hanging Fruit]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12969"><![CDATA[User Report]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 7 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1jsko:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blambov]]></customfieldvalue>
        <customfieldvalue><![CDATA[mck]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12341002">3.11.1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/pull/2656&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/pull/2656&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;CI&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>