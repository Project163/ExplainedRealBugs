<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:05:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-12784] ReplicationAwareTokenAllocatorTest times out almost every time for 3.X and trunk</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-12784</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Example failure: &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://cassci.datastax.com/view/cassandra-3.X/job/cassandra-3.X_testall/lastCompletedBuild/testReport/org.apache.cassandra.dht.tokenallocator/ReplicationAwareTokenAllocatorTest/testNewClusterWithMurmur3Partitioner/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/cassandra-3.X/job/cassandra-3.X_testall/lastCompletedBuild/testReport/org.apache.cassandra.dht.tokenallocator/ReplicationAwareTokenAllocatorTest/testNewClusterWithMurmur3Partitioner/&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13011859">CASSANDRA-12784</key>
            <summary>ReplicationAwareTokenAllocatorTest times out almost every time for 3.X and trunk</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stefania">Stefania Alborghetti</assignee>
                                    <reporter username="stefania">Stefania Alborghetti</reporter>
                        <labels>
                    </labels>
                <created>Thu, 13 Oct 2016 02:19:58 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:17 +0000</updated>
                            <resolved>Tue, 18 Oct 2016 01:15:28 +0000</resolved>
                                        <fixVersion>3.10</fixVersion>
                                    <component>Legacy/Testing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15571222" author="stefania" created="Thu, 13 Oct 2016 08:13:41 +0000"  >&lt;p&gt;This test has been timing out since it was introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12647&quot; title=&quot;Improve vnode allocation on RandomPartitioner&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12647&quot;&gt;&lt;del&gt;CASSANDRA-12647&lt;/del&gt;&lt;/a&gt;. In fact, the problem is not &lt;tt&gt;testNewClusterWithMurmur3Partitioner&lt;/tt&gt;, which was previously called &lt;tt&gt;testNewCluster&lt;/tt&gt; and was timing out very rarely (due to the flaky utility?), but the new random partitioner tests. They take approximately twice as long as the murmur3 tests. On my laptop, with the current test configuration of 64 VNODES, the full test completes in approximately 500 seconds, see timings below. The total timeout on Jenkins is 600 seconds, therefore the test is almost always timing out given that the Jenkins VMs are slower. This analysis does not take into account the flaky utility, when this latter kicks in, there is no chance that the test completes within the timeout.&lt;/p&gt;

&lt;p&gt;I&apos;ve attached a JFR profile, &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12833067/12833067_ReplicationAwareTokenAllocatorTest.jfr.gz&quot; title=&quot;ReplicationAwareTokenAllocatorTest.jfr.gz attached to CASSANDRA-12784&quot;&gt;ReplicationAwareTokenAllocatorTest.jfr.gz&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;, the slowness of the random partitioner tests is due to the big integer math in &lt;tt&gt;BigIntegerToken.size()&lt;/tt&gt;. Unless we plan on improving the performance of the algorithm or of the big integer math, may I suggest reducing the scope of the test? I don&apos;t think it&apos;s reasonable to run a unit test that takes longer than 10 minutes, the full test can be moved to a burn test if required.&lt;/p&gt;

&lt;p&gt;One way to reduce the scope would be to reduce the number of iterations by reducing VNODES, do you have any other suggestions &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt; or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dikanggu&quot; class=&quot;user-hover&quot; rel=&quot;dikanggu&quot;&gt;dikanggu&lt;/a&gt;?&lt;/p&gt;

&lt;h5&gt;&lt;a name=&quot;Measurementsonmylaptop%3A&quot;&gt;&lt;/a&gt;Measurements on my laptop:&lt;/h5&gt;

&lt;p&gt;&lt;b&gt;64-VNODES:&lt;/b&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;testsuite errors=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; failures=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; hostname=&lt;span class=&quot;code-quote&quot;&gt;&quot;cuoricina&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.cassandra.dht.tokenallocator.ReplicationAwareTokenAllocatorTest&quot;&lt;/span&gt; skipped=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; tests=&lt;span class=&quot;code-quote&quot;&gt;&quot;4&quot;&lt;/span&gt; time=&lt;span class=&quot;code-quote&quot;&gt;&quot;483.197&quot;&lt;/span&gt; timestamp=&lt;span class=&quot;code-quote&quot;&gt;&quot;2016-10-13T04:18:10&quot;&lt;/span&gt;&amp;gt;
&amp;lt;properties&amp;gt;...&amp;lt;/properties&amp;gt;
&amp;lt;testcase classname=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.cassandra.dht.tokenallocator.ReplicationAwareTokenAllocatorTest&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;testExistingClusterWithRandomPartitioner&quot;&lt;/span&gt; time=&lt;span class=&quot;code-quote&quot;&gt;&quot;101.944&quot;&lt;/span&gt;/&amp;gt;
&amp;lt;testcase classname=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.cassandra.dht.tokenallocator.ReplicationAwareTokenAllocatorTest&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;testExistingClusterWithMurmur3Partitioner&quot;&lt;/span&gt; time=&lt;span class=&quot;code-quote&quot;&gt;&quot;51.654&quot;&lt;/span&gt;/&amp;gt;
&amp;lt;testcase classname=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.cassandra.dht.tokenallocator.ReplicationAwareTokenAllocatorTest&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;testNewClusterWithRandomPartitioner&quot;&lt;/span&gt; time=&lt;span class=&quot;code-quote&quot;&gt;&quot;218.88&quot;&lt;/span&gt;/&amp;gt;
&amp;lt;testcase classname=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.cassandra.dht.tokenallocator.ReplicationAwareTokenAllocatorTest&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;testNewClusterWithMurmur3Partitioner&quot;&lt;/span&gt; time=&lt;span class=&quot;code-quote&quot;&gt;&quot;110.613&quot;&lt;/span&gt;/&amp;gt;
&amp;lt;system-out&amp;gt;...&amp;lt;/system-out&amp;gt;
&amp;lt;system-err&amp;gt;
&amp;lt;![CDATA[ ]]&amp;gt;
&amp;lt;/system-err&amp;gt;
&amp;lt;/testsuite&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;b&gt;32-VNODES:&lt;/b&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;testsuite errors=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; failures=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; hostname=&lt;span class=&quot;code-quote&quot;&gt;&quot;cuoricina&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.cassandra.dht.tokenallocator.ReplicationAwareTokenAllocatorTest&quot;&lt;/span&gt; skipped=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; tests=&lt;span class=&quot;code-quote&quot;&gt;&quot;4&quot;&lt;/span&gt; time=&lt;span class=&quot;code-quote&quot;&gt;&quot;87.773&quot;&lt;/span&gt; timestamp=&lt;span class=&quot;code-quote&quot;&gt;&quot;2016-10-13T07:09:46&quot;&lt;/span&gt;&amp;gt;
&amp;lt;properties&amp;gt;...&amp;lt;/properties&amp;gt;
&amp;lt;testcase classname=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.cassandra.dht.tokenallocator.ReplicationAwareTokenAllocatorTest&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;testExistingClusterWithMurmur3Partitioner&quot;&lt;/span&gt; time=&lt;span class=&quot;code-quote&quot;&gt;&quot;9.548&quot;&lt;/span&gt;/&amp;gt;
&amp;lt;testcase classname=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.cassandra.dht.tokenallocator.ReplicationAwareTokenAllocatorTest&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;testNewClusterWithMurmur3Partitioner&quot;&lt;/span&gt; time=&lt;span class=&quot;code-quote&quot;&gt;&quot;18.18&quot;&lt;/span&gt;/&amp;gt;
&amp;lt;testcase classname=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.cassandra.dht.tokenallocator.ReplicationAwareTokenAllocatorTest&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;testExistingClusterWithRandomPartitioner&quot;&lt;/span&gt; time=&lt;span class=&quot;code-quote&quot;&gt;&quot;23.235&quot;&lt;/span&gt;/&amp;gt;
&amp;lt;testcase classname=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.cassandra.dht.tokenallocator.ReplicationAwareTokenAllocatorTest&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;testNewClusterWithRandomPartitioner&quot;&lt;/span&gt; time=&lt;span class=&quot;code-quote&quot;&gt;&quot;36.709&quot;&lt;/span&gt;/&amp;gt;
&amp;lt;system-out&amp;gt;...&amp;lt;/system-out&amp;gt;
&amp;lt;system-err&amp;gt;
&amp;lt;![CDATA[ ]]&amp;gt;
&amp;lt;/system-err&amp;gt;
&amp;lt;/testsuite&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;b&gt;16-VNODES:&lt;/b&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;testsuite errors=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; failures=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; hostname=&lt;span class=&quot;code-quote&quot;&gt;&quot;cuoricina&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.cassandra.dht.tokenallocator.ReplicationAwareTokenAllocatorTest&quot;&lt;/span&gt; skipped=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; tests=&lt;span class=&quot;code-quote&quot;&gt;&quot;4&quot;&lt;/span&gt; time=&lt;span class=&quot;code-quote&quot;&gt;&quot;89.858&quot;&lt;/span&gt; timestamp=&lt;span class=&quot;code-quote&quot;&gt;&quot;2016-10-13T06:56:31&quot;&lt;/span&gt;&amp;gt;
&amp;lt;properties&amp;gt;...&amp;lt;/properties&amp;gt;
&amp;lt;testcase classname=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.cassandra.dht.tokenallocator.ReplicationAwareTokenAllocatorTest&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;testExistingClusterWithMurmur3Partitioner&quot;&lt;/span&gt; time=&lt;span class=&quot;code-quote&quot;&gt;&quot;10.067&quot;&lt;/span&gt;/&amp;gt;
&amp;lt;testcase classname=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.cassandra.dht.tokenallocator.ReplicationAwareTokenAllocatorTest&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;testNewClusterWithMurmur3Partitioner&quot;&lt;/span&gt; time=&lt;span class=&quot;code-quote&quot;&gt;&quot;17.662&quot;&lt;/span&gt;/&amp;gt;
&amp;lt;testcase classname=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.cassandra.dht.tokenallocator.ReplicationAwareTokenAllocatorTest&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;testExistingClusterWithRandomPartitioner&quot;&lt;/span&gt; time=&lt;span class=&quot;code-quote&quot;&gt;&quot;23.678&quot;&lt;/span&gt;/&amp;gt;
&amp;lt;testcase classname=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.cassandra.dht.tokenallocator.ReplicationAwareTokenAllocatorTest&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;testNewClusterWithRandomPartitioner&quot;&lt;/span&gt; time=&lt;span class=&quot;code-quote&quot;&gt;&quot;38.345&quot;&lt;/span&gt;/&amp;gt;
&amp;lt;system-out&amp;gt;...&amp;lt;/system-out&amp;gt;
&amp;lt;system-err&amp;gt;
&amp;lt;![CDATA[ ]]&amp;gt;
&amp;lt;/system-err&amp;gt;
&amp;lt;/testsuite&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;b&gt;8-VNODES:&lt;/b&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;testsuite errors=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; failures=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; hostname=&lt;span class=&quot;code-quote&quot;&gt;&quot;cuoricina&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.cassandra.dht.tokenallocator.ReplicationAwareTokenAllocatorTest&quot;&lt;/span&gt; skipped=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; tests=&lt;span class=&quot;code-quote&quot;&gt;&quot;4&quot;&lt;/span&gt; time=&lt;span class=&quot;code-quote&quot;&gt;&quot;22.055&quot;&lt;/span&gt; timestamp=&lt;span class=&quot;code-quote&quot;&gt;&quot;2016-10-13T06:32:58&quot;&lt;/span&gt;&amp;gt;
&amp;lt;properties&amp;gt;...&amp;lt;/properties&amp;gt;
&amp;lt;testcase classname=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.cassandra.dht.tokenallocator.ReplicationAwareTokenAllocatorTest&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;testExistingClusterWithMurmur3Partitioner&quot;&lt;/span&gt; time=&lt;span class=&quot;code-quote&quot;&gt;&quot;3.219&quot;&lt;/span&gt;/&amp;gt;
&amp;lt;testcase classname=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.cassandra.dht.tokenallocator.ReplicationAwareTokenAllocatorTest&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;testNewClusterWithMurmur3Partitioner&quot;&lt;/span&gt; time=&lt;span class=&quot;code-quote&quot;&gt;&quot;4.336&quot;&lt;/span&gt;/&amp;gt;
&amp;lt;testcase classname=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.cassandra.dht.tokenallocator.ReplicationAwareTokenAllocatorTest&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;testExistingClusterWithRandomPartitioner&quot;&lt;/span&gt; time=&lt;span class=&quot;code-quote&quot;&gt;&quot;5.747&quot;&lt;/span&gt;/&amp;gt;
&amp;lt;testcase classname=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.cassandra.dht.tokenallocator.ReplicationAwareTokenAllocatorTest&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;testNewClusterWithRandomPartitioner&quot;&lt;/span&gt; time=&lt;span class=&quot;code-quote&quot;&gt;&quot;8.629&quot;&lt;/span&gt;/&amp;gt;
&amp;lt;system-out&amp;gt;...&amp;lt;/system-out&amp;gt;
&amp;lt;system-err&amp;gt;
&amp;lt;![CDATA[ ]]&amp;gt;
&amp;lt;/system-err&amp;gt;
&amp;lt;/testsuite&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;&lt;b&gt;4-VNODES:&lt;/b&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;testsuite errors=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; failures=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; hostname=&lt;span class=&quot;code-quote&quot;&gt;&quot;cuoricina&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.cassandra.dht.tokenallocator.ReplicationAwareTokenAllocatorTest&quot;&lt;/span&gt; skipped=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; tests=&lt;span class=&quot;code-quote&quot;&gt;&quot;4&quot;&lt;/span&gt; time=&lt;span class=&quot;code-quote&quot;&gt;&quot;22.55&quot;&lt;/span&gt; timestamp=&lt;span class=&quot;code-quote&quot;&gt;&quot;2016-10-13T07:21:39&quot;&lt;/span&gt;&amp;gt;
&amp;lt;properties&amp;gt;...&amp;lt;/properties&amp;gt;
&amp;lt;testcase classname=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.cassandra.dht.tokenallocator.ReplicationAwareTokenAllocatorTest&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;testExistingClusterWithMurmur3Partitioner&quot;&lt;/span&gt; time=&lt;span class=&quot;code-quote&quot;&gt;&quot;3.112&quot;&lt;/span&gt;/&amp;gt;
&amp;lt;testcase classname=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.cassandra.dht.tokenallocator.ReplicationAwareTokenAllocatorTest&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;testNewClusterWithMurmur3Partitioner&quot;&lt;/span&gt; time=&lt;span class=&quot;code-quote&quot;&gt;&quot;4.453&quot;&lt;/span&gt;/&amp;gt;
&amp;lt;testcase classname=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.cassandra.dht.tokenallocator.ReplicationAwareTokenAllocatorTest&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;testExistingClusterWithRandomPartitioner&quot;&lt;/span&gt; time=&lt;span class=&quot;code-quote&quot;&gt;&quot;6.112&quot;&lt;/span&gt;/&amp;gt;
&amp;lt;testcase classname=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.cassandra.dht.tokenallocator.ReplicationAwareTokenAllocatorTest&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;testNewClusterWithRandomPartitioner&quot;&lt;/span&gt; time=&lt;span class=&quot;code-quote&quot;&gt;&quot;8.766&quot;&lt;/span&gt;/&amp;gt;
&amp;lt;system-out&amp;gt;...&amp;lt;/system-out&amp;gt;
&amp;lt;system-err&amp;gt;
&amp;lt;![CDATA[ ]]&amp;gt;
&amp;lt;/system-err&amp;gt;
&amp;lt;/testsuite&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;&amp;#8211;&lt;/p&gt;

&lt;p&gt;I&apos;ve also noticed two failures with the following exception:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    [junit] ------------- ---------------- ---------------
    [junit] Testcase: testNewClusterWithRandomPartitioner(org.apache.cassandra.dht.tokenallocator.ReplicationAwareTokenAllocatorTest):  FAILED
    [junit] Expected max unit size below 1.2000, was 1.2241
    [junit] junit.framework.AssertionFailedError: Expected max unit size below 1.2000, was 1.2241
    [junit]     at org.apache.cassandra.dht.tokenallocator.ReplicationAwareTokenAllocatorTest.grow(ReplicationAwareTokenAllocatorTest.java:698)
    [junit]     at org.apache.cassandra.dht.tokenallocator.ReplicationAwareTokenAllocatorTest.testNewCluster(ReplicationAwareTokenAllocatorTest.java:629)
    [junit]     at org.apache.cassandra.dht.tokenallocator.ReplicationAwareTokenAllocatorTest.flakyTestNewCluster(ReplicationAwareTokenAllocatorTest.java:611)
    [junit]     at org.apache.cassandra.dht.tokenallocator.ReplicationAwareTokenAllocatorTest.flakyTestNewClusterWithRandomPartitioner(ReplicationAwareTokenAllocatorTest.java:583)
    [junit]     at org.apache.cassandra.Util.runCatchingAssertionError(Util.java:576)
    [junit]     at org.apache.cassandra.Util.flakyTest(Util.java:601)
    [junit]     at org.apache.cassandra.dht.tokenallocator.ReplicationAwareTokenAllocatorTest.testNewClusterWithRandomPartitioner(ReplicationAwareTokenAllocatorTest.java:568)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Is the flaky utility effective for the random partitioner tests?&lt;/p&gt;</comment>
                            <comment id="15571350" author="blambov" created="Thu, 13 Oct 2016 09:10:24 +0000"  >&lt;p&gt;Since the same test is being done for a large vnode count for the Murmur partitioner, I have absolutely nothing against reducing the scope of the random version to no higher than 16 vnodes.&lt;/p&gt;

&lt;p&gt;The flaky utility failure is caused by not catching the right error type for &lt;em&gt;some&lt;/em&gt; junit versions. The fix is to include &lt;tt&gt;|| AssertionFailedError&lt;/tt&gt; in the &lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/test/unit/org/apache/cassandra/Util.java#L579&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;catch&lt;/tt&gt;&lt;/a&gt; in &lt;tt&gt;runCatchingAssertionError&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15571415" author="stefania" created="Thu, 13 Oct 2016 09:30:26 +0000"  >&lt;blockquote&gt;&lt;p&gt;Since the same test is being done for a large vnode count for the Murmur partitioner, I have absolutely nothing against reducing the scope of the random version to no higher than 16 vnodes.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thanks, I&apos;ll change the test accordingly.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The flaky utility failure is caused by not catching the right error type for some junit versions. The fix is to include || AssertionFailedError in the catch in runCatchingAssertionError.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That&apos;s what I thought as well initially, but actually AssertionFailedError is a sub-class of AssertionError so that is not the reason. I verified in Intellij that if we call Assert.fail() in the same method, the exception is caught. I must admit I don&apos;t understand this yet, unless it really ran 5 times and it failed every time but the suppressed exceptions were not displayed. The trouble is that it is hard to reproduce. We can add more debug information and leave it until we can reproduce it.&lt;/p&gt;</comment>
                            <comment id="15571481" author="blambov" created="Thu, 13 Oct 2016 10:03:12 +0000"  >&lt;blockquote&gt;&lt;p&gt;AssertionFailedError is a sub-class of AssertionError&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Not in all JUnit versions. You local one is probably different from the one in CI.&lt;/p&gt;

&lt;p&gt;Additionally, the test itself imports &lt;tt&gt;junit.framework.Assert&lt;/tt&gt; (from JUnit 3) while it should import &lt;tt&gt;org.junit.Assert&lt;/tt&gt; (JUnit 4).&lt;/p&gt;</comment>
                            <comment id="15571794" author="stefania" created="Thu, 13 Oct 2016 12:36:57 +0000"  >&lt;p&gt;The failure was reproduced locally using the junit version specified in build.xml, which is 4.6, kind of old actually.&lt;/p&gt;

&lt;p&gt;At least in 4.6, &lt;tt&gt;unit.framework.AssertionFailedError&lt;/tt&gt; extends &lt;tt&gt;AssertionError&lt;/tt&gt;. Let me add some debug information and see if I can reproduce it again tomorrow, I&apos;ll try to multiplex it on Jenkins and then we should know for sure what is going on.&lt;/p&gt;

&lt;p&gt;Noted about changing the assert import. &lt;/p&gt;

&lt;p&gt;One more thing, if we want to leave &lt;tt&gt;testNewClusterWithMurmur3Partitioner&lt;/tt&gt; at 64 vnodes, then I suggest lowering the number of iterations in the flaky utility, or else a flaky run will time out.&lt;/p&gt;
</comment>
                            <comment id="15572959" author="dikanggu" created="Thu, 13 Oct 2016 19:43:24 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Stefania&quot; class=&quot;user-hover&quot; rel=&quot;stefania&quot;&gt;Stefania&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt;, let me know if there are anything I can help.&lt;/p&gt;</comment>
                            <comment id="15574319" author="stefania" created="Fri, 14 Oct 2016 05:48:54 +0000"  >&lt;p&gt;Sure, will do!&lt;/p&gt;</comment>
                            <comment id="15574329" author="stefania" created="Fri, 14 Oct 2016 05:53:32 +0000"  >&lt;p&gt;These are the new timings on my laptop with 64 vnodes for Murmur3 and 16 vnodes for Random:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;testsuite errors=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; failures=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; hostname=&lt;span class=&quot;code-quote&quot;&gt;&quot;cuoricina&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.cassandra.dht.tokenallocator.ReplicationAwareTokenAllocatorTest&quot;&lt;/span&gt; skipped=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; tests=&lt;span class=&quot;code-quote&quot;&gt;&quot;4&quot;&lt;/span&gt; time=&lt;span class=&quot;code-quote&quot;&gt;&quot;216.687&quot;&lt;/span&gt; timestamp=&lt;span class=&quot;code-quote&quot;&gt;&quot;2016-10-14T02:23:57&quot;&lt;/span&gt;&amp;gt;
&amp;lt;properties&amp;gt;...&amp;lt;/properties&amp;gt;
&amp;lt;testcase classname=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.cassandra.dht.tokenallocator.ReplicationAwareTokenAllocatorTest&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;testExistingClusterWithMurmur3Partitioner&quot;&lt;/span&gt; time=&lt;span class=&quot;code-quote&quot;&gt;&quot;44.718&quot;&lt;/span&gt;/&amp;gt;
&amp;lt;testcase classname=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.cassandra.dht.tokenallocator.ReplicationAwareTokenAllocatorTest&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;testNewClusterWithMurmur3Partitioner&quot;&lt;/span&gt; time=&lt;span class=&quot;code-quote&quot;&gt;&quot;90.62&quot;&lt;/span&gt;/&amp;gt;
&amp;lt;testcase classname=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.cassandra.dht.tokenallocator.ReplicationAwareTokenAllocatorTest&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;testExistingClusterWithRandomPartitioner&quot;&lt;/span&gt; time=&lt;span class=&quot;code-quote&quot;&gt;&quot;24.512&quot;&lt;/span&gt;/&amp;gt;
&amp;lt;testcase classname=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.cassandra.dht.tokenallocator.ReplicationAwareTokenAllocatorTest&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;testNewClusterWithRandomPartitioner&quot;&lt;/span&gt; time=&lt;span class=&quot;code-quote&quot;&gt;&quot;56.712&quot;&lt;/span&gt;/&amp;gt;
&amp;lt;system-out&amp;gt;...&amp;lt;/system-out&amp;gt;
&amp;lt;system-err&amp;gt;
&amp;lt;![CDATA[ ]]&amp;gt;
&amp;lt;/system-err&amp;gt;
&amp;lt;/testsuite&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Unfortunately Jenkins is much slower. I multiplexed the test 10 times &lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-testall-multiplex/25/testReport/org.apache.cassandra.dht.tokenallocator/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; and each iteration took approximately 5.5 minutes. There were no failures, so I could not reproduce the problem mentioned above.&lt;/p&gt;

&lt;p&gt;Because &lt;tt&gt;testNewClusterWithMurmur3Partitioner&lt;/tt&gt; takes 2.5 minutes on Jenkins, a flaky test will timeout if it performs more than 2 additional runs, so I changed the iterations to 2 for Murmur3 and 3 for Random. I&apos;ve also split the class into two sub-classes, so that the total limit of 10 minutes is doubled. Otherwise, if both tests are flaky in the same run, it will certainly timeout, and even if only &lt;tt&gt;testNewClusterWithMurmur3Partitioner&lt;/tt&gt; is flaky, the total time is very close to the 10 minutes limit.&lt;/p&gt;

&lt;p&gt;This is the full patch:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.X&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/12784-3.X&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/12784&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12784-3.X-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12784-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;I&apos;m also multiplexing 50 times the random partitioner tests &lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-testall-multiplex/26/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;, to see if we can reproduce any failures despite the flaky utility.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dikanggu&quot; class=&quot;user-hover&quot; rel=&quot;dikanggu&quot;&gt;dikanggu&lt;/a&gt;: who wants to be the reviewer?&lt;/p&gt;</comment>
                            <comment id="15574514" author="blambov" created="Fri, 14 Oct 2016 07:21:35 +0000"  >&lt;p&gt;+1. Nits:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;The stack printout for single flakes could be useful to track the history of a failure; I would prefer not to lose it, but I wouldn&apos;t stop the commit if that is something you think is worth sacrificing.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I would rename &lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...stef1927:12784-3.X#diff-f32c9e3d5921a2a50fe56db4612f14b4R548&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;flakyTestNewCluster&lt;/tt&gt; in the base class&lt;/a&gt; to just &lt;tt&gt;testNewCluster&lt;/tt&gt; since the individual runner is the one that declares it flaky and handles that.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Is there a reason to post the the commits view instead of the &lt;a href=&quot;https://github.com/stef1927/cassandra/tree/12784-3.X&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;the branch one&lt;/a&gt;? There&apos;s no direct way to get from the commits view to &lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...stef1927:12784-3.X&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;compare&lt;/a&gt; which is the one most useful for reviews.&lt;/p&gt;
</comment>
                            <comment id="15574654" author="stefania" created="Fri, 14 Oct 2016 08:31:27 +0000"  >&lt;p&gt;Thanks for the review.&lt;/p&gt;

&lt;p&gt;The multiplexed run returned a number of &lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-testall-multiplex/26/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;failures&lt;/a&gt; in &lt;tt&gt;RandomReplicationAwareTokenAllocatorTest.testExistingCluster&lt;/tt&gt;, is this test also expected to be flaky or is this a problem?&lt;/p&gt;

&lt;p&gt;Splitting the test caused a failure in testall, I&apos;ve fixed it and relaunched.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The stack printout for single flakes could be useful to track the history of a failure; I would prefer not to lose it, but I wouldn&apos;t stop the commit if that is something you think is worth sacrificing.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The stack printout is still there, the logger is smart enough to work it out, I&apos;ve tested it locally, see sample output below.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I would rename flakyTestNewCluster in the base class to just testNewCluster since the individual runner is the one that declares it flaky and handles that.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Done.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Is there a reason to post the the commits view instead of the the branch one? There&apos;s no direct way to get from the commits view to compare which is the one most useful for reviews.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Not really:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.X&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/tree/12784-3.X&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/tree/12784&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12784-3.X-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12784-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;&amp;#8211;&lt;/p&gt;

&lt;p&gt;Sample stack printout obtained by inserting a fake &lt;tt&gt;Assert.fail(&quot;Test message&quot;)&lt;/tt&gt;:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  [junit] INFO  [main] 2016-10-14 16:10:44,810 ?:? - Test failed. It tends to fail sometimes due to the random selection of the tokens in the first few nodes.
    [junit] java.lang.AssertionError: Test message
    [junit]     at org.junit.Assert.fail(Assert.java:88) ~[junit-4.12.jar:4.12]
    [junit]     at org.apache.cassandra.dht.tokenallocator.AbstractReplicationAwareTokenAllocatorTest.testNewCluster(AbstractReplicationAwareTokenAllocatorTest.java:592) ~[classes/:na]
    [junit]     at org.apache.cassandra.dht.tokenallocator.AbstractReplicationAwareTokenAllocatorTest.testNewCluster(AbstractReplicationAwareTokenAllocatorTest.java:563) ~[classes/:na]
    [junit]     at org.apache.cassandra.dht.tokenallocator.RandomReplicationAwareTokenAllocatorTest.flakyTestNewCluster(RandomReplicationAwareTokenAllocatorTest.java:51) [classes/:na]
    [junit]     at org.apache.cassandra.Util.runCatchingAssertionError(Util.java:581) ~[classes/:na]
    [junit]     at org.apache.cassandra.Util.flakyTest(Util.java:611) ~[classes/:na]
    [junit]     at org.apache.cassandra.dht.tokenallocator.RandomReplicationAwareTokenAllocatorTest.testNewClusterr(RandomReplicationAwareTokenAllocatorTest.java:44) [classes/:na]
    [junit]     at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:1.8.0_101]
    [junit]     at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[na:1.8.0_101]
    [junit]     at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:1.8.0_101]
    [junit]     at java.lang.reflect.Method.invoke(Method.java:498) ~[na:1.8.0_101]
    [junit]     at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50) [junit-4.12.jar:4.12]
    [junit]     at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12) [junit-4.12.jar:4.12]
    [junit]     at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47) [junit-4.12.jar:4.12]
    [junit]     at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17) [junit-4.12.jar:4.12]
    [junit]     at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325) [junit-4.12.jar:4.12]
    [junit]     at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78) [junit-4.12.jar:4.12]
    [junit]     at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57) [junit-4.12.jar:4.12]
    [junit]     at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290) [junit-4.12.jar:4.12]
    [junit]     at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71) [junit-4.12.jar:4.12]
    [junit]     at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288) [junit-4.12.jar:4.12]
    [junit]     at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58) [junit-4.12.jar:4.12]
    [junit]     at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268) [junit-4.12.jar:4.12]
    [junit]     at org.junit.runners.ParentRunner.run(ParentRunner.java:363) [junit-4.12.jar:4.12]
    [junit]     at junit.framework.JUnit4TestAdapter.run(JUnit4TestAdapter.java:38) [junit-4.12.jar:na]
    [junit]     at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.run(JUnitTestRunner.java:532) [ant-junit-1.9.3.jar:na]
    [junit]     at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.launch(JUnitTestRunner.java:1165) [ant-junit-1.9.3.jar:na]
    [junit]     at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.main(JUnitTestRunner.java:1016) [ant-junit-1.9.3.jar:na]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15574676" author="blambov" created="Fri, 14 Oct 2016 08:44:07 +0000"  >&lt;p&gt;&lt;tt&gt;testExistingCluster&lt;/tt&gt; is supposed to be deterministic as it uses a seeded random and should either always fail or always succeed. That random must be somehow changing in the multiplexed run.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The stack printout still there&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That&apos;s great, I did not know this trick.&lt;/p&gt;</comment>
                            <comment id="15574732" author="stefania" created="Fri, 14 Oct 2016 09:08:07 +0000"  >&lt;blockquote&gt;&lt;p&gt;testExistingCluster is supposed to be deterministic as it uses a seeded random and should either always fail or always succeed. That random must be somehow changing in the multiplexed run.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thank you, I&apos;ll have a look on Monday at why the random generator is changing.&lt;/p&gt;</comment>
                            <comment id="15581546" author="stefania" created="Mon, 17 Oct 2016 08:05:08 +0000"  >&lt;p&gt;&lt;tt&gt;testExistingCluster&lt;/tt&gt; is not deterministic for random partitioner because:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; BigIntegerToken getRandomToken(Random random)
    {
        BigInteger token = FBUtilities.hashToBigInteger(GuidGenerator.guidAsBytes(random));
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ( token.signum() == -1 )
            token = token.multiply(BigInteger.valueOf(-1L));
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BigIntegerToken(token);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; ByteBuffer guidAsBytes(Random random)
    {
        StringBuilder sbValueBeforeMD5 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StringBuilder();
        &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; time = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis();
        &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; rand = 0;
        rand = random.nextLong();
        sbValueBeforeMD5.append(s_id)
                        .append(&lt;span class=&quot;code-quote&quot;&gt;&quot;:&quot;&lt;/span&gt;)
                        .append(&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;.toString(time))
                        .append(&lt;span class=&quot;code-quote&quot;&gt;&quot;:&quot;&lt;/span&gt;)
                        .append(&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;.toString(rand));

        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; valueBeforeMD5 = sbValueBeforeMD5.toString();
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ByteBuffer.wrap(FBUtilities.threadLocalMD5Digest().digest(valueBeforeMD5.getBytes()));
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There is a dependency on the current time. I&apos;ve removed it in the latest &lt;a href=&quot;https://github.com/stef1927/cassandra/commit/b6e39d1105df6f1845c2a3928b454339b0e21201&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;commit&lt;/a&gt; and launched all tests:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.X&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/tree/12784-3.X&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/tree/12784&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12784-3.X-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12784-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12784-3.X-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12784-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;The only other caller of &lt;tt&gt;RandomPartitioner.getRandomToken(Random)&lt;/tt&gt; is compaction-stress (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11844&quot; title=&quot;Create compaction-stress&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11844&quot;&gt;&lt;del&gt;CASSANDRA-11844&lt;/del&gt;&lt;/a&gt;), and the documentation of &lt;tt&gt;CompationStress.generateTokens()&lt;/tt&gt; also indicates that this method should generate tokens in a deterministic way.&lt;/p&gt;</comment>
                            <comment id="15581844" author="blambov" created="Mon, 17 Oct 2016 10:30:39 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15584043" author="stefania" created="Tue, 18 Oct 2016 01:15:30 +0000"  >&lt;p&gt;Committed to 3.X as c6ec31bada33b9b803d09a863414ea9cad72752e and merged into trunk.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13013513">CASSANDRA-12812</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="13005227">CASSANDRA-12647</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12833067" name="ReplicationAwareTokenAllocatorTest.jfr.gz" size="2891128" author="stefania" created="Thu, 13 Oct 2016 08:06:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[stefania]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 5 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i34t93:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>blambov</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blambov]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>