<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:55:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-8735] Batch log replication is not randomized when there are only 2 racks</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-8735</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Batch log replication is not randomized and the same 2 nodes can be picked up when there are only 2 racks in the cluster.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-2.0.11/src/java/org/apache/cassandra/service/BatchlogEndpointSelector.java#L72-73&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/cassandra-2.0.11/src/java/org/apache/cassandra/service/BatchlogEndpointSelector.java#L72-73&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12772207">CASSANDRA-8735</key>
            <summary>Batch log replication is not randomized when there are only 2 racks</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="xapharius">Mihai Suteu</assignee>
                                    <reporter username="yukim">Yuki Morishita</reporter>
                        <labels>
                    </labels>
                <created>Wed, 4 Feb 2015 00:34:36 +0000</created>
                <updated>Tue, 14 Oct 2025 12:13:59 +0000</updated>
                            <resolved>Thu, 23 Jul 2015 15:29:00 +0000</resolved>
                                        <fixVersion>2.1.9</fixVersion>
                    <fixVersion>2.2.1</fixVersion>
                    <fixVersion>3.0 alpha 1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="14569849" author="xapharius" created="Tue, 2 Jun 2015 22:08:01 +0000"  >&lt;p&gt;Created a patch for cassandra-2.2&lt;br/&gt;
The file location changed since the original issue was for cassandra 2.0.10, but the bug still persisted.&lt;/p&gt;</comment>
                            <comment id="14569858" author="yukim" created="Tue, 2 Jun 2015 22:17:46 +0000"  >&lt;p&gt;Thanks for the patch. I will review it shortly.&lt;/p&gt;</comment>
                            <comment id="14570130" author="yukim" created="Wed, 3 Jun 2015 02:02:39 +0000"  >&lt;p&gt;So the patch will make &lt;tt&gt;BatchlogEndpointFilterTest#shouldSelectTwoFirstHostsFromSingleOtherRack&lt;/tt&gt; fail occasionally since the test is expected to be always the first two.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mishail&quot; class=&quot;user-hover&quot; rel=&quot;mishail&quot;&gt;mishail&lt;/a&gt; is this intended behavior? I saw the case where the same 2 nodes always getting a lot of batch log traffic.&lt;/p&gt;</comment>
                            <comment id="14570189" author="mishail" created="Wed, 3 Jun 2015 02:49:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yukim&quot; class=&quot;user-hover&quot; rel=&quot;yukim&quot;&gt;yukim&lt;/a&gt;. I don&apos;t remember. It looks like I made that test case based on the assumption that the behavior from Jonathan&apos;s patch &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6551&quot; title=&quot;Rack-aware batchlog replication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6551&quot;&gt;&lt;del&gt;CASSANDRA-6551&lt;/del&gt;&lt;/a&gt; #2 &lt;b&gt;is&lt;/b&gt; the expected one.&lt;/p&gt;</comment>
                            <comment id="14581097" author="yukim" created="Wed, 10 Jun 2015 21:11:35 +0000"  >&lt;p&gt;I think randomize filtered endpoint is necessary anyway, otherwise those deterministic two nodes always get batch log and will show high load compare to other nodes in the rack.&lt;/p&gt;

&lt;p&gt;Updated patch attached so that we don&apos;t need to cast for shuffle and modified test to remove deterministic assertion.&lt;/p&gt;</comment>
                            <comment id="14635816" author="JIRAUSER308715" created="Tue, 21 Jul 2015 21:04:32 +0000"  >&lt;p&gt;whats up with this? &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yukim&quot; class=&quot;user-hover&quot; rel=&quot;yukim&quot;&gt;yukim&lt;/a&gt;&apos;s update to the patch LGTM.&lt;/p&gt;</comment>
                            <comment id="14636196" author="yukim" created="Wed, 22 Jul 2015 04:27:00 +0000"  >&lt;p&gt;Branch for the patch (v2) attached: &lt;a href=&quot;https://github.com/yukim/cassandra/tree/8735-2.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/yukim/cassandra/tree/8735-2.1&lt;/a&gt;&lt;br/&gt;
testall: &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/yukim/job/yukim-8735-2.1-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/yukim/job/yukim-8735-2.1-testall/lastCompletedBuild/testReport/&lt;/a&gt;&lt;br/&gt;
dtest: &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/yukim/job/yukim-8735-2.1-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/yukim/job/yukim-8735-2.1-dtest/lastCompletedBuild/testReport/&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Yuki Morishita&apos;s update to the patch LGTM.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;So do you mean you looked at my patch reviewer and +1, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jjordan&quot; class=&quot;user-hover&quot; rel=&quot;jjordan&quot;&gt;jjordan&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="14638788" author="JIRAUSER308715" created="Thu, 23 Jul 2015 13:18:52 +0000"  >&lt;p&gt;Yeah. If this was just waiting for a new review. I reviewed the v2 patch and +1&lt;/p&gt;</comment>
                            <comment id="14638989" author="yukim" created="Thu, 23 Jul 2015 15:29:00 +0000"  >&lt;p&gt;Committed, thanks!&lt;/p&gt;</comment>
                            <comment id="16046896" author="dikanggu" created="Mon, 12 Jun 2017 18:25:11 +0000"  >&lt;p&gt;Hi, I&apos;m not seeing this patch in trunk or latest 3.0.X, is it reverted or overwritten in some version? Thanks.&lt;/p&gt;</comment>
                            <comment id="16114984" author="daniel.cranford" created="Fri, 4 Aug 2017 21:23:17 +0000"  >&lt;p&gt;Looks like it was reverted/overwritten (seemingly unintentionally) by the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7237&quot; title=&quot;Optimize batchlog manager to avoid full scans&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7237&quot;&gt;&lt;del&gt;CASSANDRA-7237&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;We&apos;ve seen this in production with Cassandra 3.9. One or two rack DCs always select the same two hosts for batch log replication.&lt;/p&gt;</comment>
                            <comment id="16116013" author="yukim" created="Mon, 7 Aug 2017 02:27:23 +0000"  >&lt;p&gt;Pinging &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iamaleksey&quot; class=&quot;user-hover&quot; rel=&quot;iamaleksey&quot;&gt;iamaleksey&lt;/a&gt;.&lt;br/&gt;
As Daniel pointed above, &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7237&quot; title=&quot;Optimize batchlog manager to avoid full scans&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7237&quot;&gt;&lt;del&gt;CASSANDRA-7237&lt;/del&gt;&lt;/a&gt; removed randomizing part in 3.0+ (&lt;a href=&quot;https://github.com/apache/cassandra/commit/762db474273f764b189d3613fce33943cd64701b#diff-642bb5d5ca328b50d59f2a550c94e5edR533&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/762db474273f764b189d3613fce33943cd64701b#diff-642bb5d5ca328b50d59f2a550c94e5edR533&lt;/a&gt;).&lt;br/&gt;
I cannot tell it was intentional or not, so can you take a look and see if it still need to be patched by this? Thanks.&lt;/p&gt;</comment>
                            <comment id="16116217" author="blambov" created="Mon, 7 Aug 2017 08:06:54 +0000"  >&lt;p&gt;I don&apos;t remember doing this on purpose, it looks like a bad merge.&lt;/p&gt;</comment>
                            <comment id="16119735" author="iamaleksey" created="Wed, 9 Aug 2017 11:25:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daniel.cranford&quot; class=&quot;user-hover&quot; rel=&quot;daniel.cranford&quot;&gt;daniel.cranford&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yukim&quot; class=&quot;user-hover&quot; rel=&quot;yukim&quot;&gt;yukim&lt;/a&gt; I think &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12884&quot; title=&quot;Batch logic can lead to unbalanced use of system.batches&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12884&quot;&gt;&lt;del&gt;CASSANDRA-12884&lt;/del&gt;&lt;/a&gt; (unresolved) covers the issue - whatever the origin of it was.&lt;/p&gt;</comment>
                            <comment id="16119979" author="daniel.cranford" created="Wed, 9 Aug 2017 14:24:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iamaleksey&quot; class=&quot;user-hover&quot; rel=&quot;iamaleksey&quot;&gt;iamaleksey&lt;/a&gt; Great, I didn&apos;t see any activity yet on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12884&quot; title=&quot;Batch logic can lead to unbalanced use of system.batches&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12884&quot;&gt;&lt;del&gt;CASSANDRA-12884&lt;/del&gt;&lt;/a&gt;, so I attached a patch there.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13018841">CASSANDRA-12884</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12687296">CASSANDRA-6551</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12738920" name="8735-v2.patch" size="2940" author="yukim" created="Wed, 10 Jun 2015 21:11:35 +0000"/>
                            <attachment id="12737016" name="CASSANDRA-8735.patch" size="1075" author="xapharius" created="Tue, 2 Jun 2015 22:08:01 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[xapharius]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 14 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i255kf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12327164">2.0.10</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jjordan</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jjordan]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>