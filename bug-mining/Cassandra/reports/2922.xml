<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:46:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-7414] After cleanup we can end up with non-compacting high level sstables</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-7414</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;If we run cleanup (or increase sstable size) on a node with LCS, we could end up with a bunch of sstables in higher levels that are &quot;never&quot; compacted.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12722195">CASSANDRA-7414</key>
            <summary>After cleanup we can end up with non-compacting high level sstables</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="marcuse">Marcus Eriksson</assignee>
                                    <reporter username="marcuse">Marcus Eriksson</reporter>
                        <labels>
                            <label>lcs</label>
                    </labels>
                <created>Wed, 18 Jun 2014 11:38:17 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:42 +0000</updated>
                            <resolved>Mon, 30 Jun 2014 06:48:22 +0000</resolved>
                                        <fixVersion>2.0.10</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14035602" author="krummas" created="Wed, 18 Jun 2014 11:39:26 +0000"  >&lt;p&gt;Attached patch tracks how long time (compaction rounds) it was since we last compacted into a given level, and if the time is too big, we bring in one of the sstables in that level into a lower-level compaction until the highest level is either empty or doing compaction.&lt;/p&gt;</comment>
                            <comment id="14036937" author="yukim" created="Thu, 19 Jun 2014 04:18:20 +0000"  >&lt;p&gt;Hmm, the problem here is not clear to me. Is it that it will be never compacted because compaction score changes when cleanup/sstable size change? I think if we continue to flush SSTables, eventually levels are filled up and reach compaction threshold.&lt;/p&gt;

&lt;p&gt;Some comments to the patch:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;getOverlappingStarvedSSTables: you can pull calculating min/max boundary out of the loop.&lt;/li&gt;
	&lt;li&gt;getOverlappingStarvedSSTables: why don&apos;t just add sstable to withStarvedCandidate instead of union set of 1 sstable.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14036981" author="krummas" created="Thu, 19 Jun 2014 05:38:34 +0000"  >&lt;blockquote&gt;&lt;p&gt;eventually levels are filled up and reach compaction threshold.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;It is this &quot;eventually&quot; I want to make shorter with the patch - if you change sstable size from 5MB to 160MB, it will take a very long time before there is ever any compaction into the highest level.&lt;/p&gt;</comment>
                            <comment id="14038274" author="kohlisankalp" created="Fri, 20 Jun 2014 02:21:14 +0000"  >&lt;p&gt;This time based feature can be used for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6621&quot; title=&quot;Add flag to disable STCS in L0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6621&quot;&gt;&lt;del&gt;CASSANDRA-6621&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;</comment>
                            <comment id="14038482" author="kohlisankalp" created="Fri, 20 Jun 2014 05:36:46 +0000"  >&lt;p&gt;&quot;if (logger.isDebugEnabled())&lt;br/&gt;
                    logger.debug(&quot;Compaction candidates for L{} are {}&quot;, i, toString(candidates));&quot;&lt;br/&gt;
You might move this logging down to include the sstable added by your new method. &lt;/p&gt;

&lt;p&gt;The patch looks good and will be very helpful &lt;/p&gt;

</comment>
                            <comment id="14041765" author="krummas" created="Tue, 24 Jun 2014 06:35:12 +0000"  >&lt;blockquote&gt;&lt;p&gt;getOverlappingStarvedSSTables: you can pull calculating min/max boundary out of the loop.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The loop will only be entered for the highest level which has sstables (and has not been compacted for a long time), so we always at most calculate min/max once&lt;/p&gt;

&lt;p&gt;attaching v2 which addresses the other comments&lt;/p&gt;</comment>
                            <comment id="14044102" author="kohlisankalp" created="Wed, 25 Jun 2014 21:55:37 +0000"  >&lt;p&gt;Looks good to me. Also this patch is against 2.0 so are we targeting 2.0.9 for this? &lt;/p&gt;</comment>
                            <comment id="14045300" author="yukim" created="Thu, 26 Jun 2014 22:59:04 +0000"  >&lt;p&gt;Is it good to loop beyond targetLevel in getOverlappingStarvedSSTables? I think we can ignore lower leveles.&lt;br/&gt;
Oherwise +1.&lt;/p&gt;</comment>
                            <comment id="14047429" author="krummas" created="Mon, 30 Jun 2014 06:48:22 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12652146" name="0001-Include-high-level-sstables-in-lower-level-compactio-v2.patch" size="6795" author="marcuse" created="Tue, 24 Jun 2014 06:35:12 +0000"/>
                            <attachment id="12651112" name="0001-Include-high-level-sstables-in-lower-level-compactio.patch" size="6328" author="marcuse" created="Wed, 18 Jun 2014 11:42:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>400391</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 21 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1wxaf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>400490</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>yukim</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[yukim]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>