<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:52:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-9137] nodetool doesn&apos;t work when Cassandra run with the property java.net.preferIPv6Addresses=true</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-9137</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;nodetool doesn&apos;t work when Cassandra run with the property &lt;tt&gt;java.net.preferIPv6Addresses=true&lt;/tt&gt;.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ sudo netstat -tlpn | grep $(cat /var/run/cassandra/cassandra.pid) | grep 7199
tcp6       0      0 ::1:7199                :::*                    LISTEN      27560/java
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ nodetool -h ::1 status
nodetool: Failed to connect to &apos;::1:7199&apos; - ConnectException: &apos;Connection refused&apos;.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Hardcoded value  of the property &lt;tt&gt;java.rmi.server.hostname&lt;/tt&gt; (&lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-2.1.4/src/java/org/apache/cassandra/service/CassandraDaemon.java#L91&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/cassandra-2.1.4/src/java/org/apache/cassandra/service/CassandraDaemon.java#L91&lt;/a&gt;) makes RMI returns the address &lt;tt&gt;127.0.0.1&lt;/tt&gt; instead of &lt;tt&gt;::1&lt;/tt&gt; that jmxServer listens to.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;21:52:26.300192 IP6 (hlim 64, next-header TCP (6) payload length: 259) ::1.7199 &amp;gt; ::1.58706: Flags [P.], cksum 0x010b (incorrect -&amp;gt; 0x6a57), seq 23:250, ack 88, win 2048, options [nop,nop,TS val 1833457 ecr 1833456], length 227
`......@...................................R.4...../...........
........Q....w..SZ.y...L.[....sr..javax.management.remote.rmi.RMIServerImpl_Stub...........pxr..java.rmi.server.RemoteStub......e....pxr..javSZ.y...L.[.....xoteObject.a...a3....pxpw4..UnicastRef2..	127.0.0.1...(.L....d
21:52:26.336400 IP6 (hlim 64, next-header TCP (6) payload length: 32) ::1.58706 &amp;gt; ::1.7199: Flags [.], cksum 0x0028 (incorrect -&amp;gt; 0xfe1c), seq 88, ack 250, win 2048, options [nop,nop,TS val 1833467 ecr 1833457], length 0
`.... .@.................................R...../.4.......(.....
........
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;jmxServer listens to the an ip address that was resolved from &lt;tt&gt;localhost&lt;/tt&gt; and it depends on value of the property &lt;tt&gt;java.net.preferIPv6Addresses&lt;/tt&gt; or lack of it (&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/utils/RMIServerSocketFactoryImpl.java#L13&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/trunk/src/java/org/apache/cassandra/utils/RMIServerSocketFactoryImpl.java#L13&lt;/a&gt;).&lt;br/&gt;
This is a simple patch that works correctly with &lt;tt&gt;java.net.preferIPv6Addresses=(true|false)&lt;/tt&gt; and &lt;tt&gt;java.net.preferIPv4Stack=(true|false)&lt;/tt&gt;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;diff --git a/src/java/org/apache/cassandra/service/CassandraDaemon.java b/src/java/org/apache/cassandra/service/CassandraDaemon.java
index 3e398bf..66e9cca 100644
--- a/src/java/org/apache/cassandra/service/CassandraDaemon.java
+++ b/src/java/org/apache/cassandra/service/CassandraDaemon.java
@@ -88,7 +88,7 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;CassandraDaemon
             }
             &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;
             {
-                &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.setProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;java.rmi.server.hostname&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;127.0.0.1&quot;&lt;/span&gt;);
+                &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.setProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;java.rmi.server.hostname&quot;&lt;/span&gt;, InetAddress.getLoopbackAddress().getHostAddress());

                 &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;
                 {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12819456">CASSANDRA-9137</key>
            <summary>nodetool doesn&apos;t work when Cassandra run with the property java.net.preferIPv6Addresses=true</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="d3rp">Andrey Trubachev</assignee>
                                    <reporter username="d3rp">Andrey Trubachev</reporter>
                        <labels>
                    </labels>
                <created>Wed, 8 Apr 2015 21:05:37 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:15 +0000</updated>
                            <resolved>Tue, 14 Apr 2015 19:34:48 +0000</resolved>
                                        <fixVersion>2.0.15</fixVersion>
                    <fixVersion>2.1.5</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14486134" author="philipthompson" created="Wed, 8 Apr 2015 21:49:16 +0000"  >&lt;p&gt;Could you turn your patch into a .txt file as described in wiki.apache.org/cassandra/HowToContribute ? &lt;/p&gt;</comment>
                            <comment id="14486154" author="aweisberg" created="Wed, 8 Apr 2015 21:59:04 +0000"  >&lt;p&gt;I have one question. toString() for InetAddress is &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;public String toString() {
    String hostName = holder().getHostName();
    return ((hostName != null) ? hostName : &quot;&quot;)
        + &quot;/&quot; + getHostAddress();
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Is that going to work correctly for javax.rmi.hostname? It&apos;s going to prepend the / and I am pretty sure some tools don&apos;t get it.&lt;/p&gt;</comment>
                            <comment id="14486797" author="d3rp" created="Thu, 9 Apr 2015 06:10:44 +0000"  >&lt;p&gt;Attached patches for both versions 2.0.14 and 2.1.4.&lt;/p&gt;</comment>
                            <comment id="14486814" author="d3rp" created="Thu, 9 Apr 2015 06:25:17 +0000"  >&lt;p&gt;I&apos;ve made extra checks&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; localhostIP = InetAddress.getLoopbackAddress().getHostAddress();
&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(localhostIP);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and this code returns &lt;tt&gt;127.0.0.1&lt;/tt&gt; or &lt;tt&gt;0:0:0:0:0:0:0:1&lt;/tt&gt; when &lt;tt&gt;java.net.preferIPv6Addresses&lt;/tt&gt; is &lt;tt&gt;true&lt;/tt&gt;.&lt;br/&gt;
Unfortunately, I&apos;m not experienced enough in Java to explain it in more details.&lt;/p&gt;</comment>
                            <comment id="14489463" author="d3rp" created="Fri, 10 Apr 2015 11:39:44 +0000"  >&lt;p&gt;I think &lt;tt&gt;.toString()&lt;/tt&gt; isn&apos;t used in the patch and &lt;tt&gt;.getHostAddress()&lt;/tt&gt; returns the IP address string without hostname and slash:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getHostAddress() {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; numericToTextFormat(getAddress());
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getHostAddress() {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; holder6.getHostAddress();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14494419" author="aweisberg" created="Tue, 14 Apr 2015 17:16:10 +0000"  >&lt;p&gt;OK I am +1 for this change&lt;/p&gt;</comment>
                            <comment id="14494720" author="jbellis" created="Tue, 14 Apr 2015 19:32:29 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12724144" name="cassandra-2.0.14-9137.txt" size="992" author="d3rp" created="Thu, 9 Apr 2015 06:02:30 +0000"/>
                            <attachment id="12724145" name="cassandra-2.1.4-9137.txt" size="990" author="d3rp" created="Thu, 9 Apr 2015 06:02:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[d3rp]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 32 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2czvb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12329670">2.0.14</customfieldvalue>
    <customfieldvalue id="12329381">2.1.4</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aweisberg</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aweisberg]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>