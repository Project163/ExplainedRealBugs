<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:12:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-724] Insert/Get Contention</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-724</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;We tried out the socket io patch in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-705&quot; title=&quot;explore replacing socket nio with blocking io&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-705&quot;&gt;&lt;del&gt;CASSANDRA-705&lt;/del&gt;&lt;/a&gt;, tested the latest JVM of b18 for 1.6. Still seeing very strange insert times. We see this with get_slices as well but it&apos;s easy to reproduce with batch_insert. I wonder if its related to Memtable contention, it&apos;s pretty easy to see the slow times when you restart the test script attached. We are running this on a 7 node cluster, &amp;lt;1% cpu. Consistency Level of 1.&lt;/p&gt;

&lt;p&gt;Results&lt;br/&gt;
---------------------&lt;br/&gt;
Slow insert test.10882 0.203548192978&lt;br/&gt;
Slow insert test.18005 0.203876972198&lt;br/&gt;
Slow insert test.21154 0.204496860504&lt;br/&gt;
Slow insert test.22054 0.0444049835205&lt;br/&gt;
Slow insert test.26445 0.201545000076&lt;/p&gt;</description>
                <environment></environment>
        <key id="12446007">CASSANDRA-724</key>
            <summary>Insert/Get Contention</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="lenn0x">Chris Goffinet</reporter>
                        <labels>
                    </labels>
                <created>Wed, 20 Jan 2010 08:26:59 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:29 +0000</updated>
                            <resolved>Thu, 4 Feb 2010 19:59:18 +0000</resolved>
                                        <fixVersion>0.6</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12802743" author="lenn0x" created="Wed, 20 Jan 2010 08:29:13 +0000"  >&lt;p&gt;Just an observation, we see this happening on 99% of keys that need to send a remote write.&lt;/p&gt;</comment>
                            <comment id="12803007" author="jbellis" created="Wed, 20 Jan 2010 21:48:30 +0000"  >&lt;p&gt;I can reproduce this on a single-node setup, so I think it is possible you are seeing two effects: one from the messagingservice stack (Brandon points out that this happens much more frequently w/o &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-705&quot; title=&quot;explore replacing socket nio with blocking io&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-705&quot;&gt;&lt;del&gt;CASSANDRA-705&lt;/del&gt;&lt;/a&gt;, than with it), and one from the commitlog sync (which I can reproduce on a single node system).&lt;/p&gt;</comment>
                            <comment id="12803045" author="jbellis" created="Wed, 20 Jan 2010 23:11:20 +0000"  >&lt;p&gt;this addresses latency from waiting for commitlog append to finish (which will be delayed if commitlog is busy syncing).  in batch mode we have to wait because that is part of our contract, but in periodic mode we do not.&lt;/p&gt;

&lt;p&gt;705 will be committed soon and that will address that.&lt;/p&gt;</comment>
                            <comment id="12803048" author="jbellis" created="Wed, 20 Jan 2010 23:25:33 +0000"  >&lt;p&gt;patch to add debug timing info if you want to investigate further.&lt;/p&gt;

&lt;p&gt;there does seem to be occasional latency spikes inside ColumnFamilyStore.apply that I do not yet understand.&lt;/p&gt;

&lt;p&gt;when cpus are busy w/ compaction latency increases.  no real surprise there.&lt;/p&gt;

&lt;p&gt;thrift sometimes adds 10s of ms of latency according to the differences b/t what my python client sees and what CassandraServer sees.  the java side of thrift does call setTcpNoDelay(true), but the python side does not &amp;#8211; the equivalent would be, setsockopt(SOL_TCP, TCP_NODELAY, 1).  that is probably the culprit.&lt;/p&gt;</comment>
                            <comment id="12803485" author="lenn0x" created="Thu, 21 Jan 2010 21:07:09 +0000"  >&lt;p&gt;We didn&apos;t see much change, I think applying debug is going to be required. It ranges from 45ms to 800ms sometimes.&lt;/p&gt;</comment>
                            <comment id="12803922" author="jbellis" created="Fri, 22 Jan 2010 22:56:20 +0000"  >&lt;p&gt;Brandon&apos;s did some more testing and found that the System.gc() we request (to allow cleaning up obsolete sstables after a compaction) is the culprit.&lt;/p&gt;

&lt;p&gt;Maybe it&apos;s time to experiment w/ the g1 garbage collector: &lt;a href=&quot;http://java.sun.com/javase/technologies/hotspot/gc/g1_intro.jsp&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://java.sun.com/javase/technologies/hotspot/gc/g1_intro.jsp&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively, one workaround might be to only issue the gc() request if we&apos;re within some percent of the disk filling up (we can use File.getUsableSpace / File.getTotalSpace for that)&lt;/p&gt;</comment>
                            <comment id="12805282" author="jbellis" created="Tue, 26 Jan 2010 23:27:07 +0000"  >&lt;p&gt;patches 02 and 03 will reduce your System.gc frequency (as long as you have spare disk space):&lt;/p&gt;

&lt;p&gt;03&lt;br/&gt;
    only gc if there are undeleted sstables that gc-ing could free&lt;/p&gt;

&lt;p&gt;02&lt;br/&gt;
    replace gc after each compaction w/ gc before compaction/flush only if we need it for the file space&lt;/p&gt;

&lt;p&gt;01&lt;br/&gt;
    decouple periodic sync mode from commit log append &lt;span class=&quot;error&quot;&gt;&amp;#91;original patch posted&amp;#93;&lt;/span&gt;&lt;/p&gt;
</comment>
                            <comment id="12829658" author="jbellis" created="Thu, 4 Feb 2010 17:23:57 +0000"  >&lt;p&gt;rebased again&lt;/p&gt;</comment>
                            <comment id="12829737" author="brandon.williams" created="Thu, 4 Feb 2010 19:49:16 +0000"  >&lt;p&gt;+1, much improved for me:&lt;/p&gt;

&lt;p&gt;Slow insert test.15910 0.0661840438843&lt;br/&gt;
Slow insert test.37799 0.073842048645&lt;br/&gt;
Slow insert test.38254 0.0541589260101&lt;br/&gt;
Slow insert test.46248 0.0541749000549&lt;br/&gt;
Slow insert test.56482 0.0474050045013&lt;br/&gt;
Slow insert test.70314 0.0435261726379&lt;br/&gt;
Slow insert test.76370 0.0660541057587&lt;br/&gt;
Slow insert test.170684 0.0553348064423&lt;br/&gt;
Slow insert test.170685 0.0560541152954&lt;br/&gt;
Slow insert test.202273 0.0667309761047&lt;/p&gt;

&lt;p&gt;I also confirmed w/verbose:gc that the long gc pauses related to compaction/deletion are gone.&lt;/p&gt;</comment>
                            <comment id="12829742" author="jbellis" created="Thu, 4 Feb 2010 19:59:18 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                            <comment id="12834894" author="hudson" created="Wed, 17 Feb 2010 17:54:47 +0000"  >&lt;p&gt;Integrated in Cassandra #357 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Cassandra/357/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Cassandra/357/&lt;/a&gt;)&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12434856" name="ASF.LICENSE.NOT.GRANTED--0001-decouple-periodic-sync-mode-from-commit-log-append.txt" size="4814" author="jbellis" created="Thu, 4 Feb 2010 19:04:08 +0000"/>
                            <attachment id="12434857" name="ASF.LICENSE.NOT.GRANTED--0002-replace-gc-after-each-compaction-w-gc-before-compactio.txt" size="11843" author="jbellis" created="Thu, 4 Feb 2010 19:04:08 +0000"/>
                            <attachment id="12434858" name="ASF.LICENSE.NOT.GRANTED--0003-only-gc-if-there-are-undeleted-sstables-that-gc-ing-co.txt" size="10182" author="jbellis" created="Thu, 4 Feb 2010 19:04:08 +0000"/>
                            <attachment id="12430946" name="debug.patch" size="5574" author="jbellis" created="Wed, 20 Jan 2010 23:25:33 +0000"/>
                            <attachment id="12430857" name="test_case.py" size="892" author="lenn0x" created="Wed, 20 Jan 2010 08:27:23 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19838</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 40 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0g0on:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>91541</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>