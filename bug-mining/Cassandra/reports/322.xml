<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:13:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-1040] read failure during flush</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-1040</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Joost Ouwerkerk writes:&lt;/p&gt;

&lt;p&gt;On a single-node cassandra cluster with basic config (-Xmx:1G)&lt;br/&gt;
loop {&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;insert 5,000 records in a single columnfamily with UUID keys and&lt;br/&gt;
random string values (between 1 and 1000 chars) in 5 different columns&lt;br/&gt;
spanning two different supercolumns&lt;/li&gt;
	&lt;li&gt;delete all the data by iterating over the rows with&lt;br/&gt;
get_range_slices(ONE) and calling remove(QUORUM) on each row id&lt;br/&gt;
returned (path containing only columnfamily)&lt;/li&gt;
	&lt;li&gt;count number of non-tombstone rows by iterating over the rows&lt;br/&gt;
with get_range_slices(ONE) and testing data.  Break if not zero.&lt;br/&gt;
}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;while this is running, call &quot;bin/nodetool -h localhost -p 8081 flush KeySpace&quot; in the background every minute or so.  When the data hits some critical size, the loop will break.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12463432">CASSANDRA-1040</key>
            <summary>read failure during flush</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10000" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Urgent</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="jbellis">Jonathan Ellis</reporter>
                        <labels>
                    </labels>
                <created>Fri, 30 Apr 2010 13:33:23 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:24 +0000</updated>
                            <resolved>Fri, 7 May 2010 21:31:52 +0000</resolved>
                                        <fixVersion>0.7 beta 1</fixVersion>
                                        <due></due>
                            <votes>2</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="12864635" author="jbellis" created="Thu, 6 May 2010 03:28:20 +0000"  >&lt;p&gt;Brandon&apos;s code to reproduce:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

#!/usr/bin/python
from telephus.protocol &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; ManagedCassandraClientFactory
from telephus.client &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; CassandraClient
from twisted.internet &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; defer

HOST = &lt;span class=&quot;code-quote&quot;&gt;&apos;cassandra-6&apos;&lt;/span&gt;
PORT = 9160
KEYSPACE = &lt;span class=&quot;code-quote&quot;&gt;&apos;Keyspace1&apos;&lt;/span&gt;
CF = &lt;span class=&quot;code-quote&quot;&gt;&apos;Standard1&apos;&lt;/span&gt;
SCF = &lt;span class=&quot;code-quote&quot;&gt;&apos;Super1&apos;&lt;/span&gt;
colname = &lt;span class=&quot;code-quote&quot;&gt;&apos;foo&apos;&lt;/span&gt;
scname = &lt;span class=&quot;code-quote&quot;&gt;&apos;bar&apos;&lt;/span&gt;

@defer.inlineCallbacks
def dostuff(client):
    &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; True:
        print &lt;span class=&quot;code-quote&quot;&gt;&quot;inserting&quot;&lt;/span&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; i in xrange(5000):
            yield client.insert(str(i), CF, &lt;span class=&quot;code-quote&quot;&gt;&apos;test&apos;&lt;/span&gt;, column=colname)
        print &lt;span class=&quot;code-quote&quot;&gt;&quot;removing&quot;&lt;/span&gt;
        res = yield client.get_range_slice(CF, count=10000)
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; ks in res:
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; len(ks.columns) &amp;gt; 0:
                yield client.remove(ks.key, CF)
        print &lt;span class=&quot;code-quote&quot;&gt;&quot;checking&quot;&lt;/span&gt;
        res = yield client.get_range_slice(CF, count=10000)
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; ks in res:
            &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; len(ks.columns) == 0
        print &lt;span class=&quot;code-quote&quot;&gt;&quot;ok&quot;&lt;/span&gt;

&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; __name__ == &lt;span class=&quot;code-quote&quot;&gt;&apos;__main__&apos;&lt;/span&gt;:
    from twisted.internet &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; reactor
    from twisted.python &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; log
    &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; sys
    log.startLogging(sys.stdout)

    f = ManagedCassandraClientFactory()
    c = CassandraClient(f, KEYSPACE)
    dostuff(c)
    reactor.connectTCP(HOST, PORT, f)
    reactor.run()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12864637" author="jbellis" created="Thu, 6 May 2010 03:41:07 +0000"  >&lt;p&gt;Also:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; x in seq `1 1000`; &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; bin/nodetool -h `hostname` flush Keyspace1; sleep 5; done
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12865261" author="stuhood" created="Fri, 7 May 2010 18:32:56 +0000"  >&lt;p&gt;Independent of (but related to) this issue, ColumnFamilyStore.getRangeRows has a race condition in memtable handling. The order of operations that might trigger the problem is:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Copy memtablesPendingFlush&lt;/li&gt;
	&lt;li&gt;(new memtable becomes pending)&lt;/li&gt;
	&lt;li&gt;Copy reference to current Memtable&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Swapping 3. with 1. would prevent new memtables from being ignored, but would mean we might scan one memtable twice. Making 1. and 3. atomic would remove the race, but is a longer time to hold the lock than we are use to.&lt;/p&gt;

&lt;p&gt;EDIT: this description only applies to trunk&lt;/p&gt;</comment>
                            <comment id="12865313" author="jbellis" created="Fri, 7 May 2010 21:14:46 +0000"  >&lt;p&gt;Most of this was caused by the bug Stu found for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1063&quot; title=&quot;tombstone-only rows in sstables can be ignored&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1063&quot;&gt;&lt;del&gt;CASSANDRA-1063&lt;/del&gt;&lt;/a&gt;, which has been committed separately.  Here is a patch to fix the trunk-only part explained above.  (We take the &quot;allow the original memtable to scanned twice occasionally&quot; approach, which is the one taken by getTopLevelColumns.)&lt;/p&gt;</comment>
                            <comment id="12865317" author="stuhood" created="Fri, 7 May 2010 21:26:27 +0000"  >&lt;p&gt;+1 for 1040.txt. Thanks!&lt;/p&gt;</comment>
                            <comment id="12865321" author="jbellis" created="Fri, 7 May 2010 21:31:52 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12443998" name="1040.txt" size="4961" author="jbellis" created="Fri, 7 May 2010 21:14:46 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19969</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 29 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0g2mv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>91857</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>