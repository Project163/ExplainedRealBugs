<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:38:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-5424] nodetool repair -pr on all nodes won&apos;t repair the full range when a Keyspace isn&apos;t in all DC&apos;s</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-5424</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;nodetool repair -pr on all nodes won&apos;t repair the full range when a Keyspace isn&apos;t in all DC&apos;s&lt;/p&gt;

&lt;p&gt;Commands follow, but the TL;DR of it, range (127605887595351923798765477786913079296,0] doesn&apos;t get repaired between .38 node and .236 node until I run a repair, no -pr, on .38&lt;/p&gt;

&lt;p&gt;It seems like primary arnge calculation doesn&apos;t take schema into account, but deciding who to ask for merkle tree&apos;s from does.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Address         DC          Rack        Status State   Load            Owns                Token                                       
                                                                                           127605887595351923798765477786913079296     
10.72.111.225   Cassandra   rack1       Up     Normal  455.87 KB       25.00%              0                                           
10.2.29.38      Analytics   rack1       Up     Normal  40.74 MB        25.00%              42535295865117307932921825928971026432      
10.46.113.236   Analytics   rack1       Up     Normal  20.65 MB        50.00%              127605887595351923798765477786913079296     

create keyspace Keyspace1
  with placement_strategy = &apos;NetworkTopologyStrategy&apos;
  and strategy_options = {Analytics : 2}
  and durable_writes = true;

-------
# nodetool -h 10.2.29.38 repair -pr Keyspace1 Standard1
[2013-04-03 15:46:58,000] Starting repair command #1, repairing 1 ranges for keyspace Keyspace1
[2013-04-03 15:47:00,881] Repair session b79b4850-9c75-11e2-0000-8b5bf6ebea9e for range (0,42535295865117307932921825928971026432] finished
[2013-04-03 15:47:00,881] Repair command #1 finished

root@ip-10-2-29-38:/home/ubuntu# grep b79b4850-9c75-11e2-0000-8b5bf6ebea9e /var/log/cassandra/system.log
 INFO [AntiEntropySessions:1] 2013-04-03 15:46:58,009 AntiEntropyService.java (line 676) [repair #b79b4850-9c75-11e2-0000-8b5bf6ebea9e] new session: will sync a1/10.2.29.38, /10.46.113.236 on range (0,42535295865117307932921825928971026432] for Keyspace1.[Standard1]
 INFO [AntiEntropySessions:1] 2013-04-03 15:46:58,015 AntiEntropyService.java (line 881) [repair #b79b4850-9c75-11e2-0000-8b5bf6ebea9e] requesting merkle trees for Standard1 (to [/10.46.113.236, a1/10.2.29.38])
 INFO [AntiEntropyStage:1] 2013-04-03 15:47:00,202 AntiEntropyService.java (line 211) [repair #b79b4850-9c75-11e2-0000-8b5bf6ebea9e] Received merkle tree for Standard1 from /10.46.113.236
 INFO [AntiEntropyStage:1] 2013-04-03 15:47:00,697 AntiEntropyService.java (line 211) [repair #b79b4850-9c75-11e2-0000-8b5bf6ebea9e] Received merkle tree for Standard1 from a1/10.2.29.38
 INFO [AntiEntropyStage:1] 2013-04-03 15:47:00,879 AntiEntropyService.java (line 1015) [repair #b79b4850-9c75-11e2-0000-8b5bf6ebea9e] Endpoints /10.46.113.236 and a1/10.2.29.38 are consistent for Standard1
 INFO [AntiEntropyStage:1] 2013-04-03 15:47:00,880 AntiEntropyService.java (line 788) [repair #b79b4850-9c75-11e2-0000-8b5bf6ebea9e] Standard1 is fully synced
 INFO [AntiEntropySessions:1] 2013-04-03 15:47:00,880 AntiEntropyService.java (line 722) [repair #b79b4850-9c75-11e2-0000-8b5bf6ebea9e] session completed successfully

root@ip-10-46-113-236:/home/ubuntu# grep b79b4850-9c75-11e2-0000-8b5bf6ebea9e /var/log/cassandra/system.log
 INFO [AntiEntropyStage:1] 2013-04-03 15:46:59,944 AntiEntropyService.java (line 244) [repair #b79b4850-9c75-11e2-0000-8b5bf6ebea9e] Sending completed merkle tree to /10.2.29.38 for (Keyspace1,Standard1)

root@ip-10-72-111-225:/home/ubuntu# grep b79b4850-9c75-11e2-0000-8b5bf6ebea9e /var/log/cassandra/system.log
root@ip-10-72-111-225:/home/ubuntu# 

-------
# nodetool -h 10.46.113.236  repair -pr Keyspace1 Standard1
[2013-04-03 15:48:00,274] Starting repair command #1, repairing 1 ranges for keyspace Keyspace1
[2013-04-03 15:48:02,032] Repair session dcb91540-9c75-11e2-0000-a839ee2ccbef for range (42535295865117307932921825928971026432,127605887595351923798765477786913079296] finished
[2013-04-03 15:48:02,033] Repair command #1 finished

root@ip-10-46-113-236:/home/ubuntu# grep dcb91540-9c75-11e2-0000-a839ee2ccbef /var/log/cassandra/system.log
 INFO [AntiEntropySessions:5] 2013-04-03 15:48:00,280 AntiEntropyService.java (line 676) [repair #dcb91540-9c75-11e2-0000-a839ee2ccbef] new session: will sync a0/10.46.113.236, /10.2.29.38 on range (42535295865117307932921825928971026432,127605887595351923798765477786913079296] for Keyspace1.[Standard1]
 INFO [AntiEntropySessions:5] 2013-04-03 15:48:00,285 AntiEntropyService.java (line 881) [repair #dcb91540-9c75-11e2-0000-a839ee2ccbef] requesting merkle trees for Standard1 (to [/10.2.29.38, a0/10.46.113.236])
 INFO [AntiEntropyStage:1] 2013-04-03 15:48:01,710 AntiEntropyService.java (line 211) [repair #dcb91540-9c75-11e2-0000-a839ee2ccbef] Received merkle tree for Standard1 from a0/10.46.113.236
 INFO [AntiEntropyStage:1] 2013-04-03 15:48:01,943 AntiEntropyService.java (line 211) [repair #dcb91540-9c75-11e2-0000-a839ee2ccbef] Received merkle tree for Standard1 from /10.2.29.38
 INFO [AntiEntropyStage:1] 2013-04-03 15:48:02,031 AntiEntropyService.java (line 1015) [repair #dcb91540-9c75-11e2-0000-a839ee2ccbef] Endpoints a0/10.46.113.236 and /10.2.29.38 are consistent for Standard1
 INFO [AntiEntropyStage:1] 2013-04-03 15:48:02,032 AntiEntropyService.java (line 788) [repair #dcb91540-9c75-11e2-0000-a839ee2ccbef] Standard1 is fully synced
 INFO [AntiEntropySessions:5] 2013-04-03 15:48:02,032 AntiEntropyService.java (line 722) [repair #dcb91540-9c75-11e2-0000-a839ee2ccbef] session completed successfully

root@ip-10-2-29-38:/home/ubuntu# grep dcb91540-9c75-11e2-0000-a839ee2ccbef /var/log/cassandra/system.log
 INFO [AntiEntropyStage:1] 2013-04-03 15:48:01,898 AntiEntropyService.java (line 244) [repair #dcb91540-9c75-11e2-0000-a839ee2ccbef] Sending completed merkle tree to /10.46.113.236 for (Keyspace1,Standard1)

root@ip-10-72-111-225:/home/ubuntu# grep dcb91540-9c75-11e2-0000-a839ee2ccbef /var/log/cassandra/system.log
root@ip-10-72-111-225:/home/ubuntu# 

-------
# nodetool -h 10.72.111.225  repair -pr Keyspace1 Standard1
[2013-04-03 15:48:30,417] Starting repair command #1, repairing 1 ranges for keyspace Keyspace1
[2013-04-03 15:48:30,428] Repair session eeb12670-9c75-11e2-0000-316d6fba2dbf for range (127605887595351923798765477786913079296,0] finished
[2013-04-03 15:48:30,428] Repair command #1 finished

root@ip-10-72-111-225:/home/ubuntu# grep eeb12670-9c75-11e2-0000-316d6fba2dbf /var/log/cassandra/system.log
 INFO [AntiEntropySessions:1] 2013-04-03 15:48:30,427 AntiEntropyService.java (line 676) [repair #eeb12670-9c75-11e2-0000-316d6fba2dbf] new session: will sync /10.72.111.225 on range (127605887595351923798765477786913079296,0] for Keyspace1.[Standard1]
 INFO [AntiEntropySessions:1] 2013-04-03 15:48:30,428 AntiEntropyService.java (line 681) [repair #eeb12670-9c75-11e2-0000-316d6fba2dbf] No neighbors to repair with on range (127605887595351923798765477786913079296,0]: session completed

root@ip-10-46-113-236:/home/ubuntu# grep eeb12670-9c75-11e2-0000-316d6fba2dbf /var/log/cassandra/system.log
root@ip-10-46-113-236:/home/ubuntu# 

root@ip-10-2-29-38:/home/ubuntu# grep eeb12670-9c75-11e2-0000-316d6fba2dbf /var/log/cassandra/system.log
root@ip-10-2-29-38:/home/ubuntu# 

---
root@ip-10-2-29-38:/home/ubuntu# nodetool -h 10.2.29.38 repair Keyspace1 Standard1
[2013-04-03 16:13:28,674] Starting repair command #2, repairing 3 ranges for keyspace Keyspace1
[2013-04-03 16:13:31,786] Repair session 6bb81c20-9c79-11e2-0000-8b5bf6ebea9e for range (42535295865117307932921825928971026432,127605887595351923798765477786913079296] finished
[2013-04-03 16:13:31,786] Repair session 6cb05ed0-9c79-11e2-0000-8b5bf6ebea9e for range (0,42535295865117307932921825928971026432] finished
[2013-04-03 16:13:31,806] Repair session 6d24a470-9c79-11e2-0000-8b5bf6ebea9e for range (127605887595351923798765477786913079296,0] finished
[2013-04-03 16:13:31,807] Repair command #2 finished

root@ip-10-2-29-38:/home/ubuntu# grep 6d24a470-9c79-11e2-0000-8b5bf6ebea9e /var/log/cassandra/system.log
 INFO [AntiEntropySessions:7] 2013-04-03 16:13:31,065 AntiEntropyService.java (line 676) [repair #6d24a470-9c79-11e2-0000-8b5bf6ebea9e] new session: will sync a1/10.2.29.38, /10.46.113.236 on range (127605887595351923798765477786913079296,0] for Keyspace1.[Standard1]
 INFO [AntiEntropySessions:7] 2013-04-03 16:13:31,065 AntiEntropyService.java (line 881) [repair #6d24a470-9c79-11e2-0000-8b5bf6ebea9e] requesting merkle trees for Standard1 (to [/10.46.113.236, a1/10.2.29.38])
 INFO [AntiEntropyStage:1] 2013-04-03 16:13:31,751 AntiEntropyService.java (line 211) [repair #6d24a470-9c79-11e2-0000-8b5bf6ebea9e] Received merkle tree for Standard1 from /10.46.113.236
 INFO [AntiEntropyStage:1] 2013-04-03 16:13:31,785 AntiEntropyService.java (line 211) [repair #6d24a470-9c79-11e2-0000-8b5bf6ebea9e] Received merkle tree for Standard1 from a1/10.2.29.38
 INFO [AntiEntropyStage:1] 2013-04-03 16:13:31,805 AntiEntropyService.java (line 1015) [repair #6d24a470-9c79-11e2-0000-8b5bf6ebea9e] Endpoints /10.46.113.236 and a1/10.2.29.38 are consistent for Standard1
 INFO [AntiEntropyStage:1] 2013-04-03 16:13:31,806 AntiEntropyService.java (line 788) [repair #6d24a470-9c79-11e2-0000-8b5bf6ebea9e] Standard1 is fully synced
 INFO [AntiEntropySessions:7] 2013-04-03 16:13:31,806 AntiEntropyService.java (line 722) [repair #6d24a470-9c79-11e2-0000-8b5bf6ebea9e] session completed successfully

root@ip-10-46-113-236:/home/ubuntu# grep 6d24a470-9c79-11e2-0000-8b5bf6ebea9e /var/log/cassandra/system.log 
 INFO [AntiEntropyStage:1] 2013-04-03 16:13:31,665 AntiEntropyService.java (line 244) [repair #6d24a470-9c79-11e2-0000-8b5bf6ebea9e] Sending completed merkle tree to /10.2.29.38 for (Keyspace1,Standard1)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12640546">CASSANDRA-5424</key>
            <summary>nodetool repair -pr on all nodes won&apos;t repair the full range when a Keyspace isn&apos;t in all DC&apos;s</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10000" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Urgent</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yukim">Yuki Morishita</assignee>
                                    <reporter username="jeremiah">Jeremiah Jordan</reporter>
                        <labels>
                    </labels>
                <created>Wed, 3 Apr 2013 16:58:15 +0000</created>
                <updated>Tue, 14 Oct 2025 12:13:58 +0000</updated>
                            <resolved>Fri, 19 Apr 2013 21:34:01 +0000</resolved>
                                        <fixVersion>1.2.5</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13622673" author="JIRAUSER308715" created="Thu, 4 Apr 2013 19:15:47 +0000"  >&lt;p&gt;Tested back on 1.1.7 (before some recent repair changes) and it has the same issue.&lt;/p&gt;</comment>
                            <comment id="13626786" author="yukim" created="Tue, 9 Apr 2013 16:36:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3912&quot; title=&quot;repair user provided custom token range (support incremental repair controlled by external agent)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3912&quot;&gt;&lt;del&gt;CASSANDRA-3912&lt;/del&gt;&lt;/a&gt; changed the behavior of repair to not perform if given range is not part of the local node for Keyspace that does not have replica.&lt;br/&gt;
For above case, StorageService#getLocalRanges &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-1.1.9/src/java/org/apache/cassandra/service/AntiEntropyService.java#L160&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; would return null for /10.72.111.225 and range (127605887595351923798765477786913079296,0].&lt;/p&gt;

&lt;p&gt;Repair always sends merkle tree request to local node and synchronizes with others, so the desired behavior would be to just send merkle tree requests to those who have replica and let them synchronize.&lt;/p&gt;</comment>
                            <comment id="13628001" author="yukim" created="Wed, 10 Apr 2013 17:16:37 +0000"  >&lt;p&gt;Patch attached against 1.1.&lt;/p&gt;

&lt;p&gt;It is basically rewrite of AntiEntropyService.getNeighbors, but I moved that static method to StorageService and renamed as getReplicaNodes because I felt that is more suitable place. And the method returns addresses of the replica nodes for given KS and range. Previously the method does not return the address of the local node, but the new version does only when the local node holds the replica.&lt;/p&gt;

&lt;p&gt;So for the above case, /10.72.111.225 sends tree request only to other nodes in Analytics DC for the range it holds, and if there is difference, the node let others to repair the data each other.&lt;/p&gt;</comment>
                            <comment id="13631821" author="jbellis" created="Mon, 15 Apr 2013 16:17:25 +0000"  >&lt;p&gt;As you know, I&apos;m pretty leery of making anything but the most superficial changes to 1.1.x at this point.&lt;/p&gt;

&lt;p&gt;Am I correct that a workaround would be, &quot;only run repair against a node that is an owner of the given range?&quot;&lt;/p&gt;</comment>
                            <comment id="13631831" author="JIRAUSER308715" created="Mon, 15 Apr 2013 16:29:03 +0000"  >&lt;p&gt;The work around is always use repair no -pr&lt;/p&gt;</comment>
                            <comment id="13631843" author="jbellis" created="Mon, 15 Apr 2013 16:43:55 +0000"  >&lt;p&gt;Thinking about it, -pr really should NOT affect ranges that aren&apos;t replicated to the node in question.  That&apos;s the whole point of that option!&lt;/p&gt;

&lt;p&gt;It looks to me like the real bug here is that repair is not NTS-aware: the &quot;primary range&quot; for .38 for Keyspace1 should be (127605887595351923798765477786913079296, 42535295865117307932921825928971026432], not (0, 42535295865117307932921825928971026432].&lt;/p&gt;</comment>
                            <comment id="13632548" author="yukim" created="Tue, 16 Apr 2013 04:19:14 +0000"  >&lt;p&gt;Ok, this time I created patch against 1.2.&lt;/p&gt;

&lt;p&gt;We&apos;ve been calculating the primary range just from the tokens of the node. The patch changes this to use replication strategy&apos;s calculateNaturalEndpoint, and use the first one returned by the method as &quot;the primary range&quot;. In order to do this in NTS though, I have to tweak a little bit(Set instead of List to use internally).&lt;/p&gt;

&lt;p&gt;By this way, we get the primary ranges for .38 for Keyspace1 above are (127...296, 0] and (0, 425...32]. For .225, it returns empty range(btw I had to fix repair for empty range also).&lt;br/&gt;
When using vnodes, it is not guaranteed to have consecutive ranges, so I decided to return in two separate ranges.&lt;/p&gt;</comment>
                            <comment id="13632933" author="jbellis" created="Tue, 16 Apr 2013 15:42:18 +0000"  >&lt;p&gt;Some questions:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Were we relying on the Set behavior to de-duplicate entries in &lt;tt&gt;replicas&lt;/tt&gt; before copying it into an ArrayList at the end, or was that just a case of being over-cautious?&lt;/li&gt;
	&lt;li&gt;Why don&apos;t we need to check &lt;tt&gt;ranges.size &amp;gt; 0&lt;/tt&gt; any more in &lt;tt&gt;forceRepairAsync&lt;/tt&gt;?&lt;/li&gt;
	&lt;li&gt;Do we need to fix other uses of &lt;tt&gt;tokenMetadata.getPrimaryRangesFor&lt;/tt&gt; such as &lt;tt&gt;SS.sampleKeyRange&lt;/tt&gt;?&lt;/li&gt;
	&lt;li&gt;Can we use &lt;tt&gt;getCachedEndpoints&lt;/tt&gt; instead of &lt;tt&gt;calculateNaturalEndpoints&lt;/tt&gt;?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Also:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;It&apos;s probably worth adding some comments to &lt;tt&gt;getPrimaryRangesForEndpoint&lt;/tt&gt; &amp;#8211; superficially, it looks like it is incorrect since it is still using the non-Strategy-aware &lt;tt&gt;metadata.getPredecessor&lt;/tt&gt;, but after working some examples I am satisfied that it does the right thing, as it does here.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13632946" author="yukim" created="Tue, 16 Apr 2013 16:06:06 +0000"  >&lt;blockquote&gt;&lt;p&gt;Were we relying on the Set behavior to de-duplicate entries in replicas before copying it into an ArrayList at the end, or was that just a case of being over-cautious?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;hmm, I think we need to check if we have duplicates.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Why don&apos;t we need to check ranges.size &amp;gt; 0 any more in forceRepairAsync?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I added &apos;isEmpty&apos; check at the beginning instead. Without that, repair command hangs on client side.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Do we need to fix other uses of tokenMetadata.getPrimaryRangesFor such as SS.sampleKeyRange?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I was not sure if we need to fix. It looks like sampleKeyRange is only used by nodetool.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Can we use getCachedEndpoints instead of calculateNaturalEndpoints?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Probably we can use getNaturalEndpoints, which uses cached endpoints.&lt;/p&gt;

&lt;p&gt;I&apos;ll brush up my patch with comments and unit tests.&lt;/p&gt;</comment>
                            <comment id="13632960" author="jbellis" created="Tue, 16 Apr 2013 16:19:21 +0000"  >&lt;blockquote&gt;&lt;p&gt;It looks like sampleKeyRange is only used by nodetool&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It&apos;s a minor problem (looks like it&apos;s mostly there to support OPP: &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2917&quot; title=&quot;expose calculate midrange for token in jmx&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2917&quot;&gt;&lt;del&gt;CASSANDRA-2917&lt;/del&gt;&lt;/a&gt;) but we should probably fix it.&lt;/p&gt;

&lt;p&gt;Also, it looks like Bootstrap is using it to determine where to bisect ranges.  We should fix that one way or another (where &quot;another&quot; might be &quot;get rid of token selection on bootstrap and force people to either use vnodes or specify token manually&quot;).  Separate ticket as followup is fine here IMO.&lt;/p&gt;</comment>
                            <comment id="13632971" author="jbellis" created="Tue, 16 Apr 2013 16:26:12 +0000"  >&lt;blockquote&gt;&lt;p&gt;get rid of token selection on bootstrap and force people to either use vnodes or specify token manually&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;To clarify: this would be best done in 2.0.&lt;/p&gt;</comment>
                            <comment id="13633274" author="yukim" created="Tue, 16 Apr 2013 20:00:52 +0000"  >&lt;p&gt;v3 attached.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;NTS now uses LinkedHashSet in calculateNaturalEndpoint to preserve insertion order while eliminating duplicates.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I think it is unsafe to use cached endpoints through getNaturalEndpoints since tokenMetadata cannot be consistent inside getPrimaryRangesForEndpoint, so I stick with impl from v2.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;fix sampleKeyRange. I think the problem is that the name tokenMetadata.getPrimaryRangeFor is confusing. Probably we should rename that to just getRangeFor.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Added test for getPrimaryRangesForEndpoint to StorageServiceServerTest.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13636872" author="jbellis" created="Fri, 19 Apr 2013 20:51:23 +0000"  >&lt;p&gt;I think this is fine the way it was:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;-        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (ranges.size() &amp;gt; 0)
-        {
-            &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;(createRepairTask(cmd, keyspace, ranges, isSequential, isLocal, columnFamilies)).start();
-        }
+        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;(createRepairTask(cmd, keyspace, ranges, isSequential, isLocal, columnFamilies)).start();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Otherwise LGTM.  Created &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5499&quot; title=&quot;Clean out TokenMetadata.getPrimaryRangeFor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5499&quot;&gt;&lt;del&gt;CASSANDRA-5499&lt;/del&gt;&lt;/a&gt; for followup.&lt;/p&gt;</comment>
                            <comment id="13636905" author="yukim" created="Fri, 19 Apr 2013 21:34:01 +0000"  >&lt;p&gt;Committed with above fix. Thanks!&lt;/p&gt;</comment>
                            <comment id="13663297" author="rcoli" created="Tue, 21 May 2013 19:37:03 +0000"  >&lt;blockquote&gt;
&lt;p&gt;get rid of token selection on bootstrap and force people to either use vnodes or specify token manually&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This has seemed operationally sane to me since approximately 0.6 series. We gain almost nothing (noobs will really be discouraged by having to set a token manually?) and expose ourselves to unnecessary complexity and edge cases like this. +1&lt;/p&gt;</comment>
                            <comment id="13663298" author="jbellis" created="Tue, 21 May 2013 19:39:41 +0000"  >&lt;p&gt;Done in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5518&quot; title=&quot;Clean out token range bisection on bootstrap&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5518&quot;&gt;&lt;del&gt;CASSANDRA-5518&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13673060" author="alprema" created="Mon, 3 Jun 2013 12:19:13 +0000"  >&lt;p&gt;We just applied 1.2.5 on our cluster and the repair hanging is fixed, but the -pr is still not working as expected.&lt;br/&gt;
Our cluster has two datacenters, let&apos;s call them dc1 and dc2, we created a Keyspace Test_Replication with replication factor &lt;em&gt;{ dc1: 3 }&lt;/em&gt; (no info for dc2) and ran a nodetool repair Test_Replication (that used to hang) on dc2 and it exited saying there was nothing to do (which is OK).&lt;br/&gt;
Then we changed the replication factor to &lt;em&gt;{ dc1: 3, dc2: 3 }&lt;/em&gt; and started a nodetool repair -pr Test_Replication on cassandra11@dc2 which output this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;user@cassandra11:~$ nodetool repair -pr Test_Replication
[2013-06-03 13:54:53,948] Starting repair command #1, repairing 1 ranges &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; keyspace Test_Replication
[2013-06-03 13:54:53,985] Repair session 676c00f0-cc44-11e2-bfd5-3d9212e452cc &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (0,1] finished
[2013-06-03 13:54:53,985] Repair command #1 finished
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;But even after flushing the Keyspace, there was no data on the server.&lt;br/&gt;
We then ran a full repair:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;user@cassandra11:~$ nodetool repair  Test_Replication
[2013-06-03 14:01:56,679] Starting repair command #2, repairing 6 ranges &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; keyspace Test_Replication
[2013-06-03 14:01:57,260] Repair session 63632d70-cc45-11e2-bfd5-3d9212e452cc &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (0,1] finished
[2013-06-03 14:01:57,260] Repair session 63650230-cc45-11e2-bfd5-3d9212e452cc &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (56713727820156410577229101238628035243,113427455640312821154458202477256070484] finished
[2013-06-03 14:01:57,260] Repair session 6385d0a0-cc45-11e2-bfd5-3d9212e452cc &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (1,56713727820156410577229101238628035242] finished
[2013-06-03 14:01:57,260] Repair session 639f7320-cc45-11e2-bfd5-3d9212e452cc &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (56713727820156410577229101238628035242,56713727820156410577229101238628035243] finished
[2013-06-03 14:01:57,260] Repair session 63af51a0-cc45-11e2-bfd5-3d9212e452cc &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (113427455640312821154458202477256070484,113427455640312821154458202477256070485] finished
[2013-06-03 14:01:57,295] Repair session 63b12660-cc45-11e2-bfd5-3d9212e452cc &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (113427455640312821154458202477256070485,0] finished
[2013-06-03 14:01:57,295] Repair command #2 finished
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;After which we could find the data on dc2 as expected.&lt;/p&gt;

&lt;p&gt;So it seems that -pr is still not working as expected, or maybe we&apos;re doing/understanding something wrong.&lt;br/&gt;
(I was not sure if I should open a new ticket or comment this one so please let me know if I should move it)&lt;/p&gt;</comment>
                            <comment id="13673125" author="jbellis" created="Mon, 3 Jun 2013 14:01:59 +0000"  >&lt;p&gt;What &lt;b&gt;should&lt;/b&gt; happen is that if you repair -pr on each node in dc2, then you will repair the full token space.  But for a single node, YMMV.  In particular, it&apos;s quite possible that this is correct:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Repair session 676c00f0-cc44-11e2-bfd5-3d9212e452cc for range (0,1] finished&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Note the tiny range involved.  (This indicates that your dc2 tokens are not balanced, btw.)&lt;/p&gt;</comment>
                            <comment id="13673163" author="jbellis" created="Mon, 3 Jun 2013 14:43:24 +0000"  >&lt;blockquote&gt;&lt;p&gt;This indicates that your dc2 tokens are not balanced, btw&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Hmm.  Actually I don&apos;t see how repair could generate only a single range in a 2-DC setup and NTS.  Can you post your ring?&lt;/p&gt;</comment>
                            <comment id="13673176" author="JIRAUSER308715" created="Mon, 3 Jun 2013 14:52:46 +0000"  >&lt;p&gt;With the following replication:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;{ dc1: 3, dc2: 3 }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And the following ring:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;node dc  token
n0   dc1 0
n1   dc2 1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That is the expected output from &quot;nodetool -h n1 repair -pr&quot;.  Do a &quot;nodetool -h n0 repair -pr&quot; and n1 will get a bunch of data.  -pr only repairs from current token to previous token, if you don&apos;t have any data with a token of &quot;1&quot;, then repair -pr won&apos;t do much for repairing n1.&lt;/p&gt;</comment>
                            <comment id="13673203" author="jbellis" created="Mon, 3 Jun 2013 15:28:52 +0000"  >&lt;p&gt;I should have said, 2-DC setup, NTS, and replicas in both DC.  And more than one node in each DC.&lt;/p&gt;

&lt;p&gt;In any case, I do see the problem now.  Working on a fix.&lt;/p&gt;</comment>
                            <comment id="13673235" author="JIRAUSER308715" created="Mon, 3 Jun 2013 15:54:05 +0000"  >&lt;p&gt;If there is a problem, glad you found it, but I don&apos;t see how multiple nodes changes the fact that the primary range of n1 is only (0,1] if both DC&apos;s have replicas.&lt;/p&gt;</comment>
                            <comment id="13673245" author="alprema" created="Mon, 3 Jun 2013 16:03:39 +0000"  >&lt;p&gt;&lt;b&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;EDIT&amp;#93;&lt;/span&gt; I didn&apos;t see your latests posts before posting, but I hope the extra data can help anyway&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;You were right to say that I need to run the repair -pr on the three nodes, because I only have one row (it&apos;s a test) in the CF so I guess I had to run the repair -pr on the node in charge of this key.&lt;br/&gt;
But I restarted my test and did the repair on all three nodes, and it didn&apos;t work either; here&apos;s the output:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;user@cassandra11:~$ nodetool repair -pr Test_Replication
[2013-06-03 13:54:53,948] Starting repair command #1, repairing 1 ranges &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; keyspace Test_Replication
[2013-06-03 13:54:53,985] Repair session 676c00f0-cc44-11e2-bfd5-3d9212e452cc &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (0,1] finished
[2013-06-03 13:54:53,985] Repair command #1 finished
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;user@cassandra12:~$ nodetool repair -pr Test_Replication
[2013-06-03 17:33:17,844] Starting repair command #1, repairing 1 ranges &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; keyspace Test_Replication
[2013-06-03 17:33:17,866] Repair session e9f38c50-cc62-11e2-af47-db8ca926a9c5 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (56713727820156410577229101238628035242,56713727820156410577229101238628035243] finished
[2013-06-03 17:33:17,866] Repair command #1 finished
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;user@cassandra13:~$ nodetool repair -pr Test_Replication
[2013-06-03 17:33:29,689] Starting repair command #1, repairing 1 ranges &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; keyspace Test_Replication
[2013-06-03 17:33:29,712] Repair session f102f3a0-cc62-11e2-ae98-39da3e693be3 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (113427455640312821154458202477256070484,113427455640312821154458202477256070485] finished
[2013-06-03 17:33:29,712] Repair command #1 finished
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The data is still not copied to the new datacenter, and I don&apos;t understand why the repair is made for those ranges (a range of 1??), it could be a problem of unbalanced cluster as you suggested, but we distributed the tokens as advised (+1 on the nodes of the new datacenter) as you can see in the following nodetool status:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;user@cassandra13:~$ nodetool status
Datacenter: dc1
=====================
Status=Up/Down
|/ State=Normal/Leaving/Joining/Moving
--  Address         Load       Owns   Host ID                               Token                                    Rac
UN  cassandra01     102 GB     33.3%  fa7672f5-77f0-4b41-b9d1-13bf63c39122  0                                        RC1
UN  cassandra02     88.73 GB   33.3%  c799df22-0873-4a99-a901-5ef5b00b7b1e  56713727820156410577229101238628035242   RC1
UN  cassandra03     50.86 GB   33.3%  5b9c6bc4-7ec7-417d-b92d-c5daa787201b  113427455640312821154458202477256070484  RC1
Datacenter: dc2
======================
Status=Up/Down
|/ State=Normal/Leaving/Joining/Moving
--  Address         Load       Owns   Host ID                               Token                                    Rac
UN  cassandra11     51.21 GB   0.0%   7b610455-3fd2-48a3-9315-895a4609be42  1                                        RC2
UN  cassandra12     45.02 GB   0.0%   8553f2c0-851c-4af2-93ee-2854c96de45a  56713727820156410577229101238628035243   RC2
UN  cassandra13     36.8 GB    0.0%   7f537660-9128-4c13-872a-6e026104f30e  113427455640312821154458202477256070485  RC2
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Furthermore the full repair works, as you can see in this log:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;user@cassandra11:~$ nodetool repair  Test_Replication
[2013-06-03 17:44:07,570] Starting repair command #5, repairing 6 ranges &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; keyspace Test_Replication
[2013-06-03 17:44:07,903] Repair session 6d37b720-cc64-11e2-bfd5-3d9212e452cc &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (0,1] finished
[2013-06-03 17:44:07,903] Repair session 6d3a0110-cc64-11e2-bfd5-3d9212e452cc &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (56713727820156410577229101238628035243,113427455640312821154458202477256070484] finished
[2013-06-03 17:44:07,903] Repair session 6d4d6200-cc64-11e2-bfd5-3d9212e452cc &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (1,56713727820156410577229101238628035242] finished
[2013-06-03 17:44:07,903] Repair session 6d581060-cc64-11e2-bfd5-3d9212e452cc &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (56713727820156410577229101238628035242,56713727820156410577229101238628035243] finished
[2013-06-03 17:44:07,903] Repair session 6d5ea010-cc64-11e2-bfd5-3d9212e452cc &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (113427455640312821154458202477256070484,113427455640312821154458202477256070485] finished
[2013-06-03 17:44:07,934] Repair session 6d604dc0-cc64-11e2-bfd5-3d9212e452cc &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; range (113427455640312821154458202477256070485,0] finished
[2013-06-03 17:44:07,934] Repair command #5 finished
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I hope this information can help, please let me know if you think it&apos;s a configuration issue, in which case I would talk to the mailing list.&lt;/p&gt;</comment>
                            <comment id="13673260" author="JIRAUSER308715" created="Mon, 3 Jun 2013 16:12:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=alprema&quot; class=&quot;user-hover&quot; rel=&quot;alprema&quot;&gt;alprema&lt;/a&gt; you need to run it on all 6 nodes.  repair -pr only repairs the primary range, when ever you use repair -pr you must run repair on every node which owns the data for the KS you are repairing.  If the KS is only in DC1, that is 3 nodes, if it is in DC1 and DC2 that is 6 nodes.&lt;/p&gt;</comment>
                            <comment id="13673261" author="jbellis" created="Mon, 3 Jun 2013 16:13:01 +0000"  >&lt;p&gt;I was right the first time; this is correct behavior.  Quoting from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5608&quot; title=&quot;&amp;quot;Primary range&amp;quot; repair still isn&amp;#39;t quite NTS-aware&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5608&quot;&gt;&lt;del&gt;CASSANDRA-5608&lt;/del&gt;&lt;/a&gt;:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The right way to use -pr is still to repair everywhere the data exists; if we made -pr affect everything in the DC regardless of other replicas, then repairing the full cluster would repair each range 1x for each DC, which is not what we want&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="13673327" author="alprema" created="Mon, 3 Jun 2013 17:15:21 +0000"  >&lt;p&gt;I redid the same test (creating the keyspace with data, then changing its replication factor so it&apos;s replicated in DC2, then repairing) and it turns out that if you don&apos;t run a repair on DC2 before changing the replication factor, the repair -pr works fine &amp;#45;_&amp;#45;.&lt;/p&gt;

&lt;p&gt;Anyway, your solution worked, thank you for your help and sorry I polluted JIRA with my questions.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12646612">CASSANDRA-5550</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12701211">CASSANDRA-6852</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12717200">CASSANDRA-7317</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12578041" name="5424-1.1.txt" size="7948" author="yukim" created="Wed, 10 Apr 2013 17:56:07 +0000"/>
                            <attachment id="12578865" name="5424-v2-1.2.txt" size="6100" author="yukim" created="Tue, 16 Apr 2013 04:19:14 +0000"/>
                            <attachment id="12579001" name="5424-v3-1.2.txt" size="19888" author="yukim" created="Tue, 16 Apr 2013 20:00:52 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[yukim]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>321006</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 25 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1jdwv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>321347</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>