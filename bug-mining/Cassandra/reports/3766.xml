<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:57:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-10139] Windows utest 2.2: NanoTimeToCurrentTimeMillisTest.testTimestampOrdering intermittent failure</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-10139</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;now = 1440076083035 convertedNow = 1440076083032 in iteration 8890001
junit.framework.AssertionFailedError: now = 1440076083035 convertedNow = 1440076083032 in iteration 8890001
	at org.apache.cassandra.utils.NanoTimeToCurrentTimeMillisTest.testTimestampOrdering(NanoTimeToCurrentTimeMillisTest.java:48)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;History: &lt;a href=&quot;http://cassci.datastax.com/view/cassandra-2.2/job/cassandra-2.2_utest_win32/lastCompletedBuild/testReport/org.apache.cassandra.utils/NanoTimeToCurrentTimeMillisTest/testTimestampOrdering/history/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;intermittent&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12857556">CASSANDRA-10139</key>
            <summary>Windows utest 2.2: NanoTimeToCurrentTimeMillisTest.testTimestampOrdering intermittent failure</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pauloricardomg">Paulo Motta</assignee>
                                    <reporter username="jmckenzie">Josh McKenzie</reporter>
                        <labels>
                            <label>Windows</label>
                    </labels>
                <created>Thu, 20 Aug 2015 15:09:43 +0000</created>
                <updated>Wed, 15 Oct 2025 09:49:04 +0000</updated>
                            <resolved>Mon, 24 Aug 2015 21:12:15 +0000</resolved>
                                        <fixVersion>2.2.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14706028" author="pauloricardomg" created="Fri, 21 Aug 2015 00:46:39 +0000"  >&lt;p&gt;I ran the test multiple times on Windows, and it passes, so this problem happens mostly on CI (intermittently). I found a minor bug in the test, in the assignment of the &lt;tt&gt;nowNanos&lt;/tt&gt; variable:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;nowNanos = &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.max(now, &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.nanoTime());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;But &lt;tt&gt;now&lt;/tt&gt; is actually &lt;tt&gt;System.currentTimeMillis()&lt;/tt&gt;, so it will always be smaller than &lt;tt&gt;System.naoTime()&lt;/tt&gt;. I changed the assignment to:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;nowNanos = &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.max(nowNanos, &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.nanoTime());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This could be the cause of the failures, if there is a clock synchronization service running on WIndows, but I&apos;m not sure of that.&lt;/p&gt;

&lt;p&gt;I think this might be caused by difference in the clock resolution on Linux and Windows. In the latest test failures there were the following time differences:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;convertedNow - lastConverted = &lt;a href=&quot;http://cassci.datastax.com/view/win32/job/cassandra-2.2_utest_win32/77/testReport/org.apache.cassandra.utils/NanoTimeToCurrentTimeMillisTest/testTimestampOrdering/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;11ms&lt;/a&gt;, &lt;a href=&quot;http://cassci.datastax.com/view/win32/job/cassandra-2.2_utest_win32/77/testReport/org.apache.cassandra.utils/NanoTimeToCurrentTimeMillisTest/testTimestampOrdering/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;6ms&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;convertedNow - now = &lt;a href=&quot;http://cassci.datastax.com/view/win32/job/cassandra-2.2_utest_win32/16/testReport/org.apache.cassandra.utils/NanoTimeToCurrentTimeMillisTest/testTimestampOrdering/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;23ms&lt;/a&gt;, &lt;a href=&quot;http://cassci.datastax.com/view/win32/job/cassandra-2.2_utest_win32/53/testReport/org.apache.cassandra.utils/NanoTimeToCurrentTimeMillisTest/testTimestampOrdering/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;17ms&lt;/a&gt;, &lt;a href=&quot;http://cassci.datastax.com/view/win32/job/cassandra-2.2_utest_win32/37/testReport/org.apache.cassandra.utils/NanoTimeToCurrentTimeMillisTest/testTimestampOrdering/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;19ms&lt;/a&gt;, &lt;a href=&quot;http://cassci.datastax.com/view/win32/job/cassandra-2.2_utest_win32/91/testReport/org.apache.cassandra.utils/NanoTimeToCurrentTimeMillisTest/testTimestampOrdering/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;5ms&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Based on these numbers, I added a tolerance on WIndows of 25ms for &lt;tt&gt;convertedNow - now&lt;/tt&gt; and a tolerance of 15ms for &lt;tt&gt;convertedNow - lastConverted&lt;/tt&gt;. These numbers are more or less accurate with the section &lt;b&gt;Clocks and Timers on Windows&lt;/b&gt; of this &lt;a href=&quot;https://blogs.oracle.com/dholmes/entry/inside_the_hotspot_vm_clocks&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;oracle blog post&lt;/a&gt;:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;On WIndows, System.currentTimeMillis() is updated at a constant rate regardless of how the timer interrupt has been programmed - depending on the platform this will either be 10ms or 15ms (this value seems tied to the default interrupt period).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The patch is available &lt;a href=&quot;https://github.com/apache/cassandra/compare/cassandra-2.2...pauloricardomg:10139-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; for review. Unit tests are available below:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-10139-2.2-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.2&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-10139-3.0-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-10139-trunk-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Adding &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aweisberg&quot; class=&quot;user-hover&quot; rel=&quot;aweisberg&quot;&gt;aweisberg&lt;/a&gt; as reviewer, since he is the original author of the test.&lt;/p&gt;</comment>
                            <comment id="14709615" author="aweisberg" created="Mon, 24 Aug 2015 16:57:41 +0000"  >&lt;p&gt;Thanks for catching the test bug.&lt;/p&gt;

&lt;p&gt;Can you update the comment in NanoTimeToCurrentTimeMillis on convert? It also mentions the two milliseconds specifically.&lt;/p&gt;

&lt;p&gt;Then +1&lt;/p&gt;</comment>
                            <comment id="14709664" author="pauloricardomg" created="Mon, 24 Aug 2015 17:26:07 +0000"  >&lt;p&gt;Thanks, updated comment on linked branch. Marking as &quot;Ready to Commit&quot;.&lt;/p&gt;</comment>
                            <comment id="14710067" author="jmckenzie" created="Mon, 24 Aug 2015 21:12:15 +0000"  >&lt;p&gt;Committed as &lt;tt&gt;06a053ddc928cb8a65c5ff6d1e83947f0bb81fc6&lt;/tt&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[pauloricardomg]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 13 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2j5u7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aweisberg</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aweisberg]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>