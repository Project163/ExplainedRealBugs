<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:08:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-13719] Potential AssertionError during ReadRepair of range tombstone and partition deletions</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-13719</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;When reconciling range tombstones for read repair in &lt;tt&gt;DataResolver.RepairMergeListener.MergeListener&lt;/tt&gt;, when we check if there is ongoing deletion repair for a source, we don&apos;t look for partition level deletions which throw off the logic and can throw an AssertionError.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13089070">CASSANDRA-13719</key>
            <summary>Potential AssertionError during ReadRepair of range tombstone and partition deletions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="slebresne">Sylvain Lebresne</reporter>
                        <labels>
                    </labels>
                <created>Fri, 21 Jul 2017 15:02:35 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:02 +0000</updated>
                            <resolved>Thu, 24 Aug 2017 09:40:13 +0000</resolved>
                                        <fixVersion>3.0.15</fixVersion>
                    <fixVersion>3.11.1</fixVersion>
                                    <component>Legacy/Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16096398" author="slebresne" created="Fri, 21 Jul 2017 15:46:42 +0000"  >&lt;p&gt;Pushed fix on the following branches:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/pcmanus/cassandra/tree/13719-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/pcmanus/cassandra/tree/13719-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.11&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/pcmanus/cassandra/tree/13719-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;There is a first commit that basically only add additional logging when the assertion that this triggers happen. I used it to debug the problem but I think it would be wise to commit it because it&apos;s the 2nd time we get an assertion error triggered in that method (the first being &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-13719&quot; title=&quot;Potential AssertionError during ReadRepair of range tombstone and partition deletions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-13719&quot;&gt;&lt;del&gt;CASSANDRA-13719&lt;/del&gt;&lt;/a&gt;) and I&apos;d rather we have more info to debug if this happens a 3rd time (not that I hope it will). The additional logging doesn&apos;t do anything unless an AssertionError is triggered, so it&apos;s kind of safe to add, it&apos;s just a minor code pollution if this is never useful again, which isn&apos;t a big deal.&lt;/p&gt;

&lt;p&gt;The 2nd commit is the real fix and includes a unit test&lt;/p&gt;</comment>
                            <comment id="16135108" author="slebresne" created="Mon, 21 Aug 2017 12:36:44 +0000"  >&lt;p&gt;Gentle ping that I&apos;ve just rebased the branches above and this is still good for review. I&apos;ve tried running CI with CircleCI and &lt;a href=&quot;https://circleci.com/gh/pcmanus/cassandra/3#tests/containers/0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;it looks ok&lt;/a&gt; (the build is marked failed, but afaict it&apos;s just the eclipse-warnings target that failed and from the logs, it&apos;s not even clear it&apos;s a genuine failure; all unit tests looks good however) though it&apos;s the first time I try it and I&apos;m not sure if/how to run dtests yet. &lt;/p&gt;</comment>
                            <comment id="16136596" author="blambov" created="Tue, 22 Aug 2017 10:05:18 +0000"  >&lt;p&gt;Is it not possible to have both a partition deletion repair and a condition suitable for the &lt;a href=&quot;https://github.com/apache/cassandra/commit/8900a8dd9c2a66dfb601031f0905edffc427557f#diff-8781f9483cca1cfc87145c767295cc79R360&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;markerToRepair == null&lt;/tt&gt; branch&lt;/a&gt;? E.g. partition deletion with time 10, range tombstone with time 11 between 1 and 10, with the other source having only a range tombstone with time 11 between 2 and 3? Moreover, if the second source includes a range tombstone with time 10 between 4 and 5 we may get trouble from &lt;a href=&quot;https://github.com/apache/cassandra/commit/8900a8dd9c2a66dfb601031f0905edffc427557f#diff-8781f9483cca1cfc87145c767295cc79R375&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;the other side of that branch&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt; I&apos;m not sure this can actually happen in practice, but it does not look too hard to fix: I think we need to check that the current deletion is not the same as the partition level deletion repair in all cases that generate tombstones.&lt;/p&gt;</comment>
                            <comment id="16138323" author="slebresne" created="Wed, 23 Aug 2017 13:17:27 +0000"  >&lt;p&gt;You are right, those were genuine problems, thanks. I force-pushed an update to the same branches to fix and added an additional unit tests for this particular problem.&lt;/p&gt;</comment>
                            <comment id="16138531" author="blambov" created="Wed, 23 Aug 2017 15:54:15 +0000"  >&lt;p&gt;LGTM&lt;/p&gt;</comment>
                            <comment id="16139826" author="slebresne" created="Thu, 24 Aug 2017 09:40:13 +0000"  >&lt;p&gt;Alright, committed, thanks.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 12 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3hupz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>blambov</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blambov]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>