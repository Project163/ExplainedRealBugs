<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:35:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-4579] CQL queries using LIMIT sometimes missing results</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-4579</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;In certain conditions, CQL queries using LIMIT clauses are not being given all of the expected results (whether unset column values or missing rows).&lt;/p&gt;

&lt;p&gt;Here are the condition sets I&apos;ve been able to identify:&lt;/p&gt;

&lt;p&gt;First mode: all rows are returned, but in the last row of results, all columns which are not part of the primary key receive no values, except for the first non-primary-key column. Conditions:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Table has a multi-component primary key&lt;/li&gt;
	&lt;li&gt;Table has more than one column which is not a component of the primary key&lt;/li&gt;
	&lt;li&gt;The number of results which would be returned by a query is equal to or more than the specified LIMIT&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Second mode: result has fewer rows than it should, lower than both the LIMIT and the actual number of matching rows. Conditions:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Table has a single-column primary key&lt;/li&gt;
	&lt;li&gt;Table has more than one column which is not a component of the primary key&lt;/li&gt;
	&lt;li&gt;The number of results which would be returned by a query is equal to or more than the specified LIMIT&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;It would make sense to me that this would have started with &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4329&quot; title=&quot;CQL3: Always use composite types by default&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4329&quot;&gt;&lt;del&gt;CASSANDRA-4329&lt;/del&gt;&lt;/a&gt;, but bisecting indicates that this behavior started with commit 91bdf7fb4220b27e9566c6673bf5dbd14153017c, implementing &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3647&quot; title=&quot;Support collection (list, set, and map) value types in CQL&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3647&quot;&gt;&lt;del&gt;CASSANDRA-3647&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Test case for the first failure mode:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;DROP KEYSPACE test;

CREATE KEYSPACE test
    WITH strategy_class = &apos;SimpleStrategy&apos;
    AND strategy_options:replication_factor = 1;

USE test;

CREATE TABLE testcf (
    a int,
    b int,
    c int,
    d int,
    e int,
    PRIMARY KEY (a, b)
);

INSERT INTO testcf (a, b, c, d, e) VALUES (1, 11, 111, 1111, 11111);
INSERT INTO testcf (a, b, c, d, e) VALUES (2, 22, 222, 2222, 22222);
INSERT INTO testcf (a, b, c, d, e) VALUES (3, 33, 333, 3333, 33333);
INSERT INTO testcf (a, b, c, d, e) VALUES (4, 44, 444, 4444, 44444);

SELECT * FROM testcf;

SELECT * FROM testcf LIMIT 1; -- columns d and e in result row are null
SELECT * FROM testcf LIMIT 2; -- columns d and e in last result row are null
SELECT * FROM testcf LIMIT 3; -- columns d and e in last result row are null
SELECT * FROM testcf LIMIT 4; -- columns d and e in last result row are null
SELECT * FROM testcf LIMIT 5; -- results are correct (4 rows returned)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test case for the second failure mode:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;CREATE KEYSPACE test
    WITH strategy_class = &apos;SimpleStrategy&apos;
    AND strategy_options:replication_factor = 1;

USE test;

CREATE TABLE testcf (
    a int primary key,
    b int,
    c int,
);

INSERT INTO testcf (a, b, c) VALUES (1, 11, 111);
INSERT INTO testcf (a, b, c) VALUES (2, 22, 222);
INSERT INTO testcf (a, b, c) VALUES (3, 33, 333);
INSERT INTO testcf (a, b, c) VALUES (4, 44, 444);

SELECT * FROM testcf;

SELECT * FROM testcf LIMIT 1; -- gives 1 row
SELECT * FROM testcf LIMIT 2; -- gives 1 row
SELECT * FROM testcf LIMIT 3; -- gives 2 rows
SELECT * FROM testcf LIMIT 4; -- gives 2 rows
SELECT * FROM testcf LIMIT 5; -- gives 3 rows
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12605133">CASSANDRA-4579</key>
            <summary>CQL queries using LIMIT sometimes missing results</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="thepaul">paul cannon</reporter>
                        <labels>
                            <label>cql</label>
                            <label>cql3</label>
                    </labels>
                <created>Mon, 27 Aug 2012 20:51:01 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:28 +0000</updated>
                            <resolved>Tue, 18 Sep 2012 06:35:47 +0000</resolved>
                                        <fixVersion>1.2.0 beta 1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13442709" author="thepaul" created="Mon, 27 Aug 2012 20:51:56 +0000"  >&lt;p&gt;Thanks to Christoph Hack for identifying the problem.&lt;/p&gt;</comment>
                            <comment id="13447687" author="slebresne" created="Tue, 4 Sep 2012 13:40:45 +0000"  >&lt;p&gt;There is indeed 2 bugs when counting columns with composites (introduced by the change made for collections, so 1.1 is not affected in particular).&lt;/p&gt;

&lt;p&gt;The first one is that to count the number of CQL row to return, SliceQueryFilter groups columns having the same composite prefix (i.e. all the columns belonging to the same CQL row) and count that as 1. However the code was stopping collecting columns as sound as the requested count was reached, without waiting having seen all the columns of the last &quot;group&quot;.&lt;/p&gt;

&lt;p&gt;The second one is that for NamesQueryFilter, each internal Cassandra row will yield exactly one CQL row, so we must use the &quot;count keys&quot; rather than &quot;count columns&quot; argument for getRangeSlice in that case.&lt;/p&gt;

&lt;p&gt;Attached fix for both (I&apos;ve pushed a dtest with the two examples from that ticket).&lt;/p&gt;</comment>
                            <comment id="13456857" author="slebresne" created="Mon, 17 Sep 2012 07:35:11 +0000"  >&lt;p&gt;Rebased patches attached.&lt;/p&gt;</comment>
                            <comment id="13457346" author="xedin" created="Mon, 17 Sep 2012 21:23:01 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13457639" author="slebresne" created="Tue, 18 Sep 2012 06:35:47 +0000"  >&lt;p&gt;Committed, thanks&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12545373" name="0001-Add-all-columns-from-a-prefix-group-before-stopping.txt" size="1774" author="slebresne" created="Mon, 17 Sep 2012 07:35:11 +0000"/>
                            <attachment id="12545374" name="0002-Fix-LIMIT-for-NamesQueryFilter.txt" size="2277" author="slebresne" created="Mon, 17 Sep 2012 07:35:11 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>256263</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 10 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gxc7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>96831</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>xedin</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[xedin]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>