<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:20:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-2377] NPE During Repair In StreamReplyVerbHandler</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-2377</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;MiscStage:4&amp;#93;&lt;/span&gt; 2011-03-24 02:45:05,172 DebuggableThreadPoolExecutor.java (line 103) Error in ThreadPoolExecutorjava.lang.NullPointerException&lt;br/&gt;
        at org.apache.cassandra.streaming.StreamReplyVerbHandler.doVerb(StreamReplyVerbHandler.java:62)        at org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:72)        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(Unknown Source)        at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)&lt;br/&gt;
        at java.lang.Thread.run(Unknown Source)&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;MiscStage:4&amp;#93;&lt;/span&gt; 2011-03-24 02:45:05,172 AbstractCassandraDaemon.java (line 112) Fatal exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;MiscStage:4,5,main&amp;#93;&lt;/span&gt;java.lang.NullPointerException&lt;br/&gt;
        at org.apache.cassandra.streaming.StreamReplyVerbHandler.doVerb(StreamReplyVerbHandler.java:62)        at org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:72)        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(Unknown Source)        at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)&lt;br/&gt;
        at java.lang.Thread.run(Unknown Source)&lt;/p&gt;</description>
                <environment>&lt;p&gt;CentOS&lt;/p&gt;</environment>
        <key id="12502261">CASSANDRA-2377</key>
            <summary>NPE During Repair In StreamReplyVerbHandler</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="brandon.williams">Brandon Williams</assignee>
                                    <reporter username="bcoverston">Benjamin Coverston</reporter>
                        <labels>
                    </labels>
                <created>Thu, 24 Mar 2011 06:57:42 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:03 +0000</updated>
                            <resolved>Thu, 24 Mar 2011 18:59:55 +0000</resolved>
                                        <fixVersion>0.7.5</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13010610" author="mishravivek" created="Thu, 24 Mar 2011 09:22:49 +0000"  >&lt;p&gt;As per my analysis,&lt;br/&gt;
I can see that it is happening because StreamOutSession is not instantiated.&lt;br/&gt;
Which is done via &quot;create&quot; call in StreamOutSession. &lt;/p&gt;

&lt;p&gt;StreamReplyVerbHandler should create a new session, in case StreamOutSession instance is null?&lt;/p&gt;

&lt;p&gt;Will this work as a solution?&lt;/p&gt;</comment>
                            <comment id="13010612" author="mishravivek" created="Thu, 24 Mar 2011 09:27:35 +0000"  >&lt;p&gt;Can you please provide more log or details on it?&lt;/p&gt;</comment>
                            <comment id="13010819" author="brandon.williams" created="Thu, 24 Mar 2011 18:30:41 +0000"  >&lt;p&gt;Patch to just log a warning when a stream command is received for an unknown session.&lt;/p&gt;</comment>
                            <comment id="13010824" author="jbellis" created="Thu, 24 Mar 2011 18:36:48 +0000"  >&lt;p&gt;What could cause unexpected stream commands?  Is there a deeper bug we should be looking for?&lt;/p&gt;</comment>
                            <comment id="13010832" author="bcoverston" created="Thu, 24 Mar 2011 18:42:27 +0000"  >&lt;p&gt;In the case I was looking at there were also some failures in compaction.&lt;/p&gt;

&lt;p&gt;This was seen after running a full repair on the node.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure that they are related:&lt;/p&gt;

&lt;p&gt;ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:1&amp;#93;&lt;/span&gt; 2011-03-24 01:56:48,515 AbstractCassandraDaemon.java (line 112) Fatal exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:1,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.IndexOutOfBoundsException&lt;br/&gt;
        at java.nio.Buffer.checkIndex(Unknown Source)&lt;br/&gt;
        at java.nio.HeapByteBuffer.getInt(Unknown Source)&lt;br/&gt;
        at org.apache.cassandra.db.DeletedColumn.getLocalDeletionTime(DeletedColumn.java:57)&lt;br/&gt;
        at org.apache.cassandra.db.ColumnFamilyStore.removeDeletedStandard(ColumnFamilyStore.java:879)&lt;br/&gt;
        at org.apache.cassandra.db.ColumnFamilyStore.removeDeletedColumnsOnly(ColumnFamilyStore.java:866)&lt;br/&gt;
        at org.apache.cassandra.db.ColumnFamilyStore.removeDeleted(ColumnFamilyStore.java:857)&lt;br/&gt;
        at org.apache.cassandra.io.PrecompactedRow.&amp;lt;init&amp;gt;(PrecompactedRow.java:94)&lt;br/&gt;
        at org.apache.cassandra.io.CompactionIterator.getCompactedRow(CompactionIterator.java:147)&lt;br/&gt;
        at org.apache.cassandra.io.CompactionIterator.getReduced(CompactionIterator.java:108)&lt;br/&gt;
        at org.apache.cassandra.io.CompactionIterator.getReduced(CompactionIterator.java:43)&lt;br/&gt;
        at org.apache.cassandra.utils.ReducingIterator.computeNext(ReducingIterator.java:73)&lt;br/&gt;
        at com.google.common.collect.AbstractIterator.tryToComputeNext(AbstractIterator.java:136)&lt;br/&gt;
        at com.google.common.collect.AbstractIterator.hasNext(AbstractIterator.java:131)&lt;br/&gt;
        at org.apache.commons.collections.iterators.FilterIterator.setNextObject(FilterIterator.java:183)&lt;br/&gt;
        at org.apache.commons.collections.iterators.FilterIterator.hasNext(FilterIterator.java:94)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager.doValidationCompaction(CompactionManager.java:822)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager.access$800(CompactionManager.java:56)&lt;br/&gt;
        at org.apache.cassandra.db.CompactionManager$6.call(CompactionManager.java:358)&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerRun(Unknown Source)&lt;br/&gt;
        at java.util.concurrent.FutureTask.run(Unknown Source)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(Unknown Source)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)&lt;br/&gt;
        at java.lang.Thread.run(Unknown Source)&lt;/p&gt;</comment>
                            <comment id="13010833" author="brandon.williams" created="Thu, 24 Mar 2011 18:42:31 +0000"  >&lt;p&gt;In this specific case, the machine was performing a repair and then restarted.  The other nodes then sent it session close commands, so really this is just a cosmetic problem.&lt;/p&gt;</comment>
                            <comment id="13010835" author="jbellis" created="Thu, 24 Mar 2011 18:46:13 +0000"  >&lt;p&gt;I think I&apos;d rather see it at debug level if it&apos;s expected.  +1 otherwise&lt;/p&gt;</comment>
                            <comment id="13010844" author="brandon.williams" created="Thu, 24 Mar 2011 18:59:55 +0000"  >&lt;p&gt;Committed with the message moved to debug.&lt;/p&gt;</comment>
                            <comment id="13010851" author="hudson" created="Thu, 24 Mar 2011 19:15:56 +0000"  >&lt;p&gt;Integrated in Cassandra-0.7 #406 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Cassandra-0.7/406/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hudson.apache.org/hudson/job/Cassandra-0.7/406/&lt;/a&gt;)&lt;br/&gt;
    Log a message when a streaming action for an unkown session is received&lt;br/&gt;
instead of NPE.&lt;br/&gt;
Patch by brandonwilliams, reviewed by jbellis for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2377&quot; title=&quot;NPE During Repair In StreamReplyVerbHandler&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2377&quot;&gt;&lt;del&gt;CASSANDRA-2377&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13011146" author="mishravivek" created="Fri, 25 Mar 2011 09:55:17 +0000"  >&lt;p&gt;I was going through the changes made. I wonder what should be the value of reply.getSessionID for:&lt;/p&gt;


&lt;p&gt; StreamReply reply = StreamReply.serializer.deserialize(new DataInputStream(bufIn), message.getVersion());&lt;/p&gt;

&lt;p&gt;Should we check for this, instead of &lt;/p&gt;

&lt;p&gt;if (session == null)&lt;/p&gt;
            {
                logger.warn(&quot;Received stream action &quot; + reply.action + &quot; for an unknown session from &quot; + message.getFrom());
                return;
         }&lt;br/&gt;
 &lt;br/&gt;
As per log it happens for :&lt;br/&gt;
&lt;br/&gt;
 case SESSION_FINISHED:&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
So changes should be something like this:&lt;br/&gt;
&lt;br/&gt;
if (SESSION_FINISHED.equals(reply.action.))&lt;br/&gt;
            {                logger.warn(&quot;Received stream action &quot; + reply.action + &quot; for an unknown session from &quot; + message.getFrom());                return;         }


&lt;p&gt;Idea is to save any additional static call on StreamOutSession.get(message.getFrom(), reply.sessionId), which results in object instantiation for new Pair&amp;lt;InetAddress, Long&amp;gt;(host, sessionId).&lt;/p&gt;

</comment>
                            <comment id="13011308" author="brandon.williams" created="Fri, 25 Mar 2011 17:49:14 +0000"  >&lt;p&gt;An unknown stream action could be received for any of them.  It&apos;s not hard to imagine a FILE_RETRY happening here, and all of them require a non-null session.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12474537" name="2377.txt" size="1145" author="brandon.williams" created="Thu, 24 Mar 2011 18:30:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20590</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 35 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gb13:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>93217</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>