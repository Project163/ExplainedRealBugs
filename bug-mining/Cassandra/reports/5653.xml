<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:19:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-15897] Dropping compact storage with 2.1-sstables on disk make them unreadable</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-15897</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Test reproducing: &lt;a href=&quot;https://github.com/krummas/cassandra/commits/marcuse/dropcompactstorage&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/krummas/cassandra/commits/marcuse/dropcompactstorage&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13313024">CASSANDRA-15897</key>
            <summary>Dropping compact storage with 2.1-sstables on disk make them unreadable</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="edimitrova">Ekaterina Dimitrova</assignee>
                                    <reporter username="marcuse">Marcus Eriksson</reporter>
                        <labels>
                    </labels>
                <created>Tue, 23 Jun 2020 11:01:41 +0000</created>
                <updated>Fri, 10 Oct 2025 08:47:58 +0000</updated>
                            <resolved>Thu, 11 Mar 2021 03:07:00 +0000</resolved>
                                        <fixVersion>3.0.25</fixVersion>
                    <fixVersion>3.11.11</fixVersion>
                    <fixVersion>4.0-rc1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Legacy/Local Write-Read Paths</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="17149210" author="slebresne" created="Wed, 1 Jul 2020 08:25:34 +0000"  >&lt;p&gt;The problem here is that the 2.X sstables layout is that of the &quot;compact&quot; table, and can&apos;t be read properly post-DROP COMPACT unless we still remember the table &quot;was&quot; compact.&lt;/p&gt;

&lt;p&gt;Overall, I can see only 2 main options:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;we remember somehow that a table &quot;was&quot; compact, even after a &lt;tt&gt;DROP COMPACT STORAGE&lt;/tt&gt;. The code reading legacy sstables could then use the old compact version of the table metadata, and I think this would work. One way to preserve this information could be that, instead of dropping the COMPOUND/DENSE flags when &lt;tt&gt;DROP COMPACT STORAGE&lt;/tt&gt; is used, we&apos;d preserve those but add a new &lt;tt&gt;COMPACT_STORAGE_DROPPED&lt;/tt&gt; flag. I think doing so would be relatively simple code-wise, and preserving the information that a table &lt;em&gt;was&lt;/em&gt; compact internally, at least until 4.0 (which can clean all that up) almost feel like a good idea (I doubt many people have tried &lt;tt&gt;DROP COMPACT STORAGE&lt;/tt&gt; yet, but some will have to to upgrade to 4.0 and keeping this info may help diagnose issues along the way). The downsides I can see however are:
	&lt;ul&gt;
		&lt;li&gt;adding a flag impacts drivers, at least when they read the schema (not that it completely break driver versions that won&apos;t know about the flag...).&lt;/li&gt;
		&lt;li&gt;DROP COMPACT STORAGE has been released a while ago already and this wouldn&apos;t be retroactive. Not sure it&apos;s a big deal, but I may not have think it through.&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;we don&apos;t &quot;allow&quot; DROP COMPACT STORAGE until all 2.x sstables have been upgraded.  Now, if we could easily reject DROP COMPACT STORAGE requests until all sstables are in the 3.x format, I probably wouldn&apos;t even suggest the first option above. But it&apos;s actually not trivial, because when a coordinator receive such requests, it has no way to know what sstable formats the other nodes have. So I guess there is 2 sub-options:
	&lt;ol&gt;
		&lt;li&gt;we clearly document that one should upgrade sstables on all nodes before trying DROP COMPACT STORAGE, but don&apos;t do more than that. Not amazing, but certainly the simplest option.&lt;/li&gt;
		&lt;li&gt;we start having each node gossip, say, the lowest sstable format version it has locally, so we can properly reject DROP COMPACT STORAGE until it&apos;s safe. My main personal caveat here is that I&apos;m always a tad nervous with adding things to Gossip in a minor. But I &lt;em&gt;think&lt;/em&gt; it&apos;s pretty safe to do so.&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I&apos;m happy to implement any of those solution we prefer (and of course, there may be better suggestions), but we need to pick. Personally, I&apos;d prefer avoiding 2.1 unless the other options prove more complex than I think, but I&apos;m not 100% sure between 1 and 2.2. Maybe 2.2 because it has not externally visible impact on drivers.&lt;/p&gt;

&lt;p&gt;Other opinions (going to arbitrarily ping &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcuse&quot; class=&quot;user-hover&quot; rel=&quot;marcuse&quot;&gt;marcuse&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ifesdjeen&quot; class=&quot;user-hover&quot; rel=&quot;ifesdjeen&quot;&gt;ifesdjeen&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aleksey&quot; class=&quot;user-hover&quot; rel=&quot;aleksey&quot;&gt;aleksey&lt;/a&gt; as people knowledgeable of COMPACT STORAGE but welcoming every opinion)?&lt;/p&gt;</comment>
                            <comment id="17149449" author="ifesdjeen" created="Wed, 1 Jul 2020 13:42:45 +0000"  >&lt;p&gt;I like the idea with &lt;tt&gt;COMPACT_STORAGE_DROPPED&lt;/tt&gt; flag, but that won&apos;t work for people who have already dropped them (however, disallowing dropping won&apos;t help them, either). You also did mention it won&apos;t be retroactive. &lt;/p&gt;

&lt;p&gt;I&apos;m personally in favour of not allowing &lt;tt&gt;DROP COMPACT STORAGE&lt;/tt&gt; unless all tables are upgraded, since it&apos;s a bit simpler to maintain. Maybe, depending on how &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-15811&quot; title=&quot;Improve DROP COMPACT STORAGE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-15811&quot;&gt;&lt;del&gt;CASSANDRA-15811&lt;/del&gt;&lt;/a&gt; is implemented, that can even be a node-local decision?&lt;/p&gt;</comment>
                            <comment id="17149466" author="slebresne" created="Wed, 1 Jul 2020 14:09:11 +0000"  >&lt;blockquote&gt;&lt;p&gt;Maybe, depending on how &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-15811&quot; title=&quot;Improve DROP COMPACT STORAGE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-15811&quot;&gt;&lt;del&gt;CASSANDRA-15811&lt;/del&gt;&lt;/a&gt; is implemented, that can even be a node-local decision?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Haven&apos;t though too long about that other ticket, so not sure if this would help. I do agree we should do something there though and happy to start the conversation on what exactly.&lt;/p&gt;</comment>
                            <comment id="17150206" author="iamaleksey" created="Thu, 2 Jul 2020 11:36:19 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;m personally in favour of not allowing DROP COMPACT STORAGE unless all tables are upgraded, since it&apos;s a bit simpler to maintain.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This also wouldn&apos;t be retroactive, though. I do weakly prefer the gossip route. And we might need a one-off tool/support in &lt;tt&gt;upgradesstables&lt;/tt&gt; to convert those 2.x sstables.&lt;/p&gt;</comment>
                            <comment id="17150347" author="slebresne" created="Thu, 2 Jul 2020 14:59:20 +0000"  >&lt;p&gt;I&apos;ll give a shot to the gossip route since that seems to win this popularity contest, even if not by a great margin.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;And we might need a one-off tool/support in upgradesstables to convert those 2.x sstables.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah. I&apos;ll look at adding a flag to &lt;tt&gt;upgradesstables&lt;/tt&gt;. &lt;/p&gt;

&lt;p&gt;That said, I suspect there may be corner cases that we can&apos;t entirely handle. For instance, if the user started adding/removing columns just after that &lt;tt&gt;DROP COMPACT STORAGE&lt;/tt&gt; and before figuring out that some tables couldn&apos;t be read, then we might be in the dark. Does not mean we shouldn&apos;t try handling those sstables in the simple case, but just to list a probable limitation.&lt;/p&gt;</comment>
                            <comment id="17185250" author="edimitrova" created="Wed, 26 Aug 2020 14:58:56 +0000"  >&lt;p&gt;I just added as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16063&quot; title=&quot;Fix user experience when upgrading to 4.0 with compact tables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16063&quot;&gt;&lt;del&gt;CASSANDRA-16063&lt;/del&gt;&lt;/a&gt; the following &lt;a href=&quot;https://github.com/ekaterinadimitrova2/cassandra/commit/9ff9130808c751c9253bdecaa27c453bb5e7a71c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;commit&lt;/a&gt;&lt;br/&gt;
 You might want to check it. &lt;br/&gt;
 I will soon publish the full patch for that ticket (it covers a couple of patches in a couple of repos), I have to run CI and confirm some of the upgrade tests but this was one of the things that was brought as part of that ticket.&lt;/p&gt;</comment>
                            <comment id="17210092" author="slebresne" created="Thu, 8 Oct 2020 09:09:12 +0000"  >&lt;p&gt;I wrote a patch for the Gossip option discussed a while back. It&apos;s &lt;a href=&quot;https://github.com/pcmanus/cassandra/commits/C-15897-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; and should be pretty complete as far as refusing `DROP COMPACT STORAGE` until no nodes have 2.x sstables anymore goes.&lt;/p&gt;

&lt;p&gt;I didn&apos;t got to updating &lt;tt&gt;upgradesstable&lt;/tt&gt; to allow migrating 2.x sstables for potential users that have already cornered themselves. And I&apos;m afraid I&apos;m unlikely to have time for that in the short term.&lt;/p&gt;

&lt;p&gt;So if we&apos;re ok with pushing update to &lt;tt&gt;upgradesstable&lt;/tt&gt; (or &lt;tt&gt;scrub&lt;/tt&gt;) to a followup (I could argue that no user has complained about this yet; maybe no-one has run into this yet), and are still ok with the Gossip approach, then the path is more or less ready for review.&lt;/p&gt;

&lt;p&gt;If we prefer having the &lt;tt&gt;upgradesstable&lt;/tt&gt; change in this ticket however, I cannot make promises on how quickly I can get to it (but I&apos;m happy to hand it over).&lt;/p&gt;</comment>
                            <comment id="17211382" author="edimitrova" created="Fri, 9 Oct 2020 20:41:28 +0000"  >&lt;p&gt;My personal preference would be to keep the work incremental - review and commit this work and open a new ticket on the other part. I can rebase and push CI on this one on Monday?&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17212735" author="edimitrova" created="Mon, 12 Oct 2020 23:45:23 +0000"  >&lt;p&gt;Branch rebased. CI running &lt;a href=&quot;https://jenkins-cm4.apache.org/job/Cassandra-devbranch-artifacts/83/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here &lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17218655" author="edimitrova" created="Wed, 21 Oct 2020 23:53:13 +0000"  >&lt;p&gt;Jenkins run is lost. I just &lt;a href=&quot;https://github.com/ekaterinadimitrova2/cassandra/tree/C-15897-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;rebased &lt;/a&gt;, reverted the local temporary check for the SSTables from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16063&quot; title=&quot;Fix user experience when upgrading to 4.0 with compact tables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16063&quot;&gt;&lt;del&gt;CASSANDRA-16063&lt;/del&gt;&lt;/a&gt;, and ran CI &lt;a href=&quot;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/424/workflows/fb25652e-1297-4a24-a5b1-b31afb732333&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here &lt;/a&gt;.&lt;br/&gt;
There are four tests that will need attention. I will look at them tomorrow. &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;test_prefer_local_reconnect_on_listen_address - snitch_test.TestGossipingPropertyFileSnitch - stable in &lt;a href=&quot;https://jenkins-cm4.apache.org/job/Cassandra-3.0/25/testReport/dtest.snitch_test/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Jenkins &lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;testDropSSTables - org.apache.cassandra.db.lifecycle.TrackerTest - stable in &lt;a href=&quot;https://jenkins-cm4.apache.org/job/Cassandra-3.0/25/testReport/org.apache.cassandra.db.lifecycle/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Jenkins &lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;testDropCompactWithClusteringAndValueColumnWithDeletesAndWrites - org.apache.cassandra.distributed.upgrade.CompactStorage2to3UpgradeTest&lt;/li&gt;
	&lt;li&gt;testDropCompactWithClusteringAndValueColumn - org.apache.cassandra.distributed.upgrade.CompactStorage2to3UpgradeTest&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17218657" author="edimitrova" created="Wed, 21 Oct 2020 23:57:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcuse&quot; class=&quot;user-hover&quot; rel=&quot;marcuse&quot;&gt;marcuse&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ifesdjeen&quot; class=&quot;user-hover&quot; rel=&quot;ifesdjeen&quot;&gt;ifesdjeen&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aleksey&quot; class=&quot;user-hover&quot; rel=&quot;aleksey&quot;&gt;aleksey&lt;/a&gt;, just to confirm you are ok with the approach proposed by Sylvain? Wanted to be sure before I invest time here. Also, do you accept the suggestion to pull update to upgradesstable (or scrub) to a followup ticket? &lt;/p&gt;</comment>
                            <comment id="17220778" author="edimitrova" created="Mon, 26 Oct 2020 15:50:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcuse&quot; class=&quot;user-hover&quot; rel=&quot;marcuse&quot;&gt;marcuse&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aleksey&quot; class=&quot;user-hover&quot; rel=&quot;aleksey&quot;&gt;aleksey&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ifesdjeen&quot; class=&quot;user-hover&quot; rel=&quot;ifesdjeen&quot;&gt;ifesdjeen&lt;/a&gt;, I was wondering whether you had the time to look at this one?&#160;&lt;/p&gt;</comment>
                            <comment id="17230282" author="jmeredithco" created="Wed, 11 Nov 2020 23:10:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ifesdjeen&quot; class=&quot;user-hover&quot; rel=&quot;ifesdjeen&quot;&gt;ifesdjeen&lt;/a&gt; does &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16217&quot; title=&quot;Minimal 4.0 COMPACT STORAGE backport&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16217&quot;&gt;&lt;del&gt;CASSANDRA-16217&lt;/del&gt;&lt;/a&gt; resolve the concerns in this ticket?&lt;/p&gt;</comment>
                            <comment id="17232830" author="ifesdjeen" created="Mon, 16 Nov 2020 15:30:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jmeredithco&quot; class=&quot;user-hover&quot; rel=&quot;jmeredithco&quot;&gt;jmeredithco&lt;/a&gt; if I understand the problem correctly, &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16217&quot; title=&quot;Minimal 4.0 COMPACT STORAGE backport&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16217&quot;&gt;&lt;del&gt;CASSANDRA-16217&lt;/del&gt;&lt;/a&gt; does not solve this one. 4.0 supports versions down to &lt;tt&gt;ma&lt;/tt&gt;, and 3.0 supports versions down to &lt;tt&gt;jb&lt;/tt&gt; (3.0 and 2.0.1 correspondingly). So by the time you&apos;re on 4.0, you should have no 2.0 sstables either way, and this needs to be fixed for 3.0.&lt;/p&gt;

&lt;p&gt;That said, we should make sure things are reversible: if we start upgrade sstable / commit log or flush processes, we better make sure we can finish it (or at least make a good effort to). &lt;/p&gt;</comment>
                            <comment id="17234925" author="edimitrova" created="Wed, 18 Nov 2020 18:52:31 +0000"  >&lt;p&gt;Talked to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ifesdjeen&quot; class=&quot;user-hover&quot; rel=&quot;ifesdjeen&quot;&gt;ifesdjeen&lt;/a&gt; on Slack.&#160;&lt;/p&gt;

&lt;p&gt;Considering the scope left until GA and that this issue fixes behavior in case someone didn&apos;t follow the instructions to upgrade sstables before dropping compact storage, this patch will be put on hold for later(for sure great improvement that should go in) in favor of solid documentation and NEWS.txt.&#160;&lt;/p&gt;

&lt;p&gt;Anyone against moving it to 4.x for example and posting a patch to update NEWS.txt and docs for now?&lt;/p&gt;</comment>
                            <comment id="17235512" author="ifesdjeen" created="Thu, 19 Nov 2020 14:32:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=e.dimitrova&quot; class=&quot;user-hover&quot; rel=&quot;e.dimitrova&quot;&gt;e.dimitrova&lt;/a&gt; will we need a fix in 4.0, since 2.0 sstables can&apos;t be read by 4.0?&lt;/p&gt;

&lt;p&gt;UPD: talked with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=e.dimitrova&quot; class=&quot;user-hover&quot; rel=&quot;e.dimitrova&quot;&gt;e.dimitrova&lt;/a&gt;, and I was responding to a different question. I was speaking only about 2.0 upgrades, but am generally +1 to do the proposed &quot;gossip&quot; solution, assuming we&apos;re talking about mixed-mode 2.0/3.0 cluster or 3.0/4.0 cluster that can might contain 2.0 sstables.&lt;/p&gt;</comment>
                            <comment id="17236398" author="edimitrova" created="Fri, 20 Nov 2020 19:43:14 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ifesdjeen&quot; class=&quot;user-hover&quot; rel=&quot;ifesdjeen&quot;&gt;ifesdjeen&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I just opened&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16295&quot; title=&quot;upgradesstables/scrub support for 2.x sstables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16295&quot;&gt;&lt;del&gt;CASSANDRA-16295&lt;/del&gt;&lt;/a&gt;&#160;for the upgradesstables/scrub support.&lt;/p&gt;

&lt;p&gt;And if no one pick up the current patch for the other problem in hand in this ticket, I can rebase and finish whatever is needed after Thanksgiving.&lt;/p&gt;</comment>
                            <comment id="17241928" author="edimitrova" created="Tue, 1 Dec 2020 23:05:48 +0000"  >&lt;p&gt;Patch rebased &lt;a href=&quot;https://github.com/ekaterinadimitrova2/cassandra/pull/79&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;. &#160;CI run can be found &lt;a href=&quot;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/529/workflows/7101b314-681a-40b9-a266-6286c4f27152&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;There was a collision between this patch &#160;and &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16228&quot; title=&quot;TableMetrics are exposed before ColumnFamilyStore is fully initialized&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16228&quot;&gt;&lt;del&gt;CASSANDRA-16228&lt;/del&gt;&lt;/a&gt; in &lt;a href=&quot;#diff-9baecde49b36a386d6200cb163d482dd70a816019ba2b45f0ff25c3ca4eabf28L184&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Tracker.java &lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To solve It I added a new flag &lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...ekaterinadimitrova2:15897-3.0#diff-9baecde49b36a386d6200cb163d482dd70a816019ba2b45f0ff25c3ca4eabf28R209&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;updatingSize&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;There are a few tests failing (same were failing before and after the rebase and they are not known failures)&lt;/p&gt;

&lt;p&gt;The only failing unit test is testDropSSTables which I &lt;a href=&quot;https://github.com/apache/cassandra/commit/dba4a86306bc13f1b421c500570deb3a3f06414f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;changed&lt;/a&gt; a bit to show what is the current sequence of messages to have it in mind while debugging. (That&apos;s why it is green in CircleCI)&lt;/p&gt;

&lt;p&gt;These are the other failures:&lt;/p&gt;

&lt;p&gt;&lt;em&gt;repairUnreplicatedKStest - org.apache.cassandra.distributed.test.RepairOperationalTest -&lt;/em&gt;&#160;not sure about this timeout whether it is related; have to check&lt;/p&gt;

&lt;p&gt;&lt;b&gt;EDIT:&lt;/b&gt;&#160;&lt;em&gt;repairUnreplicatedKStest - org.apache.cassandra.distributed.test.RepairOperationalTest -&lt;/em&gt;&#160;I ran it locally a few times and it passes successfully so I think it was circle ci timeout. Also, it doesn&apos;t seem related&lt;/p&gt;

&lt;p&gt;jvm upgrade test&#160;&lt;a href=&quot;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/529/workflows/7101b314-681a-40b9-a266-6286c4f27152/jobs/2942&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CompactStorage2to3UpgradeTest&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Also 1 dtest &lt;a href=&quot;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/529/workflows/7101b314-681a-40b9-a266-6286c4f27152/jobs/2940&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;TestGossipingPropertyFileSnitch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I will try to do a more detailed review and try to work out the failures but I guess also 2 committers for review will be needed. Also, &#160;I haven&apos;t dealt with our Gossip implementation up to now. &#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17248009" author="edimitrova" created="Fri, 11 Dec 2020 16:22:24 +0000"  >&lt;p&gt;First pass of review done. I don&apos;t see any issues with the patch itself, fixed formatting at a few places. Latest state of the branch &lt;a href=&quot;https://github.com/ekaterinadimitrova2/cassandra/pull/79&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The failing tests are test issues:&lt;br/&gt;
 &lt;em&gt;TestGossipingPropertyFileSnitch&lt;/em&gt; - it required &lt;a href=&quot;https://github.com/ekaterinadimitrova2/cassandra-dtest/commit/927a07d0cc9bfcc183d3a0e7c8959cd0c6c88c6a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;update&lt;/a&gt; of the VersionedValue in the assertions as the patch introduces a &lt;a href=&quot;https://github.com/pcmanus/cassandra/commit/2dd0d1cdbd2c0869bfb8e22be34e0d67a79a8742#diff-9bf2c26bc294ef9085e16bf287490223665eaa2eb8ec24bcf5bd8653c713644bR820&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;new application state update&lt;/a&gt;.&lt;br/&gt;
 &lt;em&gt;testDropSSTables&lt;/em&gt; - it turned out the previous commit I added is actually the &lt;a href=&quot;https://github.com/ekaterinadimitrova2/cassandra/pull/79/commits/dba4a86306bc13f1b421c500570deb3a3f06414f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;fix&lt;/a&gt;. As part of this patch a notification for added/loaded SSTables on start was added. This was done in order to accommodate this change and ensure no repetitive actions &lt;a href=&quot;https://github.com/pcmanus/cassandra/commit/2dd0d1cdbd2c0869bfb8e22be34e0d67a79a8742#diff-57723368d79933b3d7fcc00ce9d3b98335391901c88cf09176d063fd6eb10ba3R249&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;CompactStorage2to3UpgradeTest&lt;/em&gt; - &lt;del&gt;I am a bit puzzled about this one. It fails by complaining that the nodes do not have this patch. At the same time, I used ccm locally to run through the test scenario and everything works smoothly so I tend to believe I miss something from the nature of the jvm-upgrade tests&lt;/del&gt; &#160;Tests &lt;a href=&quot;https://github.com/ekaterinadimitrova2/cassandra/pull/79/commits/307ba7f6cf00364280b4a8155444f96689c9d5c2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;fixed&lt;/a&gt;, a bit of time is needed after the upgrade for the nodes to settle down&lt;/p&gt;

&lt;p&gt;&lt;del&gt;While I am fixing the last mentioned test,&lt;/del&gt; I think this patch is ready for second review. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ifesdjeen&quot; class=&quot;user-hover&quot; rel=&quot;ifesdjeen&quot;&gt;ifesdjeen&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aleksey&quot; class=&quot;user-hover&quot; rel=&quot;aleksey&quot;&gt;aleksey&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcuse&quot; class=&quot;user-hover&quot; rel=&quot;marcuse&quot;&gt;marcuse&lt;/a&gt; is anyone of you available? Or if &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt;&#160;can confirm my corrections/observations?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/535/workflows/62835302-6aeb-4a47-b009-c706ced77869&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CI run&lt;/a&gt;&lt;br/&gt;
 &lt;a href=&quot;https://github.com/ekaterinadimitrova2/cassandra/pull/79&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0 patch&lt;/a&gt;&lt;br/&gt;
 &lt;a href=&quot;https://github.com/ekaterinadimitrova2/cassandra-dtest/commit/927a07d0cc9bfcc183d3a0e7c8959cd0c6c88c6a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;DTests patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;NOTE:&lt;/b&gt; &#160;test_prefer_local_reconnect_on_listen_address failed in circleci as I forgot to change the dtest repo but the test succeeds locally with the proposed dtest patch&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17280656" author="edimitrova" created="Sun, 7 Feb 2021 20:49:50 +0000"  >&lt;ul&gt;
	&lt;li&gt;3.0 version reviewed(Thanks to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blerer&quot; class=&quot;user-hover&quot; rel=&quot;blerer&quot;&gt;blerer&lt;/a&gt;!) and more or less ready (depends on [~brandon.williams] &apos;s opinion as he agreed also to review it, thank you!)&lt;/li&gt;
	&lt;li&gt;It seems that upgradesstables works in 3.0 but not in 3.11 (lb SSTables are still presented after upgradesstables run), I corrected the version in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16295&quot; title=&quot;upgradesstables/scrub support for 2.x sstables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16295&quot;&gt;&lt;del&gt;CASSANDRA-16295&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;With this patch we ensure the lowest SSTables version to be past 3.0 but we don&apos;t guarantee that the SSTables will be upgraded to the last possible version for all 3.0 and 4.0 version C* nodes, which was the idea of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16063&quot; title=&quot;Fix user experience when upgrading to 4.0 with compact tables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16063&quot;&gt;&lt;del&gt;CASSANDRA-16063&lt;/del&gt;&lt;/a&gt; where we added the local check. This seems to me as a change of intention which I don&apos;t think it will be an issue as soon as:
	&lt;ul&gt;
		&lt;li&gt;We guarantee the old pre-V3 SSTables are not presented anymore&lt;/li&gt;
		&lt;li&gt;The minimal support for compact storage is removed with the next version&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;Since 4.0 cannot even read the lb SSTables, do we need a check at all when we drop compact storage or we would expect that there won&apos;t be already any that old SSTables on a cluster with 4.0 nodes?&#160;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;And last but not least, is this a 4.0 blocker? I started doubting it. Any opinion will be highly appreciated.&lt;/p&gt;</comment>
                            <comment id="17281371" author="brandon.williams" created="Mon, 8 Feb 2021 21:05:13 +0000"  >&lt;p&gt;+1 on 3.0.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Since 4.0 cannot even read the lb SSTables, do we need a check at all when we drop compact storage or we would expect that there won&apos;t be already any that old SSTables on a cluster with 4.0 nodes? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;After &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16063&quot; title=&quot;Fix user experience when upgrading to 4.0 with compact tables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16063&quot;&gt;&lt;del&gt;CASSANDRA-16063&lt;/del&gt;&lt;/a&gt;, shouldn&apos;t it refuse to start if there are old sstables?&lt;/p&gt;

&lt;p&gt;As far as 4.0 blocker goes, I do feel that we need all upgrade procedures finalized, and compact storage  would be one of them.&lt;/p&gt;</comment>
                            <comment id="17281832" author="edimitrova" created="Tue, 9 Feb 2021 15:14:05 +0000"  >&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;cite&gt;&#160;After &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16063&quot; title=&quot;Fix user experience when upgrading to 4.0 with compact tables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16063&quot;&gt;&lt;del&gt;CASSANDRA-16063&lt;/del&gt;&lt;/a&gt;, shouldn&apos;t it refuse to start if there are old sstables&lt;/cite&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16063&quot; title=&quot;Fix user experience when upgrading to 4.0 with compact tables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16063&quot;&gt;&lt;del&gt;CASSANDRA-16063&lt;/del&gt;&lt;/a&gt;&#160;- this is a refuse to start drop compact storage in case the sstables on the node we run it were not upgraded. It does not guarantee cluster-wise. That was differed to this ticket.&lt;/p&gt;</comment>
                            <comment id="17294224" author="edimitrova" created="Wed, 3 Mar 2021 02:12:45 +0000"  >&lt;p&gt;I believe more or less we agreed on the patch on the V3.0 branch &lt;a href=&quot;https://github.com/ekaterinadimitrova2/cassandra/pull/79/files&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I propagated it to &lt;a href=&quot;https://github.com/ekaterinadimitrova2/cassandra/pull/87/files&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.11&lt;/a&gt; and &lt;a href=&quot;https://github.com/ekaterinadimitrova2/cassandra/pull/88/files&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4.0&lt;/a&gt;. I tested locally successfully those patches. Because of the latest CI failures, I decided to wait running full CI a bit until the latest issues are resolved so we can see the situation better.&lt;/p&gt;

&lt;p&gt;I believe there is only a need of one test of mixed cluster of nodes 3/4 with old 2.2 sstables on the v3 node and attempt to drop compact storage on 4.0, I will add a python dtest tomorrow.&#160;&lt;/p&gt;</comment>
                            <comment id="17295299" author="edimitrova" created="Thu, 4 Mar 2021 14:29:28 +0000"  >&lt;p&gt;While testing I found a small bug in the 4.0 patch, fixed &lt;a href=&quot;https://github.com/ekaterinadimitrova2/cassandra/commit/dcbff670cc3569aaa10befdafa4294968cf8c3c6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here &lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;I found out there is some problem when running on mixed cluster 3/3.11 and 4.0&lt;br/&gt;
WIP &lt;a href=&quot;https://github.com/ekaterinadimitrova2/cassandra-dtest/commit/3e82370ce827d6a2587a991f8d73fb40e6d8b6c7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;tests &lt;/a&gt; showing the different use cases I was testing (no, I am not going to keep those test names, this is WIP). The tests marked with suffix &quot;fail&quot; are the problem ones.&lt;br/&gt;
If we have two nodes with old sstables on 3/3.11, upgrade the sstables on both nodes, and only one node upgrade to 4.0, then the DROP COMPACT STORAGE doesn&apos;t work, the request times out.&lt;br/&gt;
If we continue and upgrade also the second 3/3.11 node to 4.0 then DROP COMPACT STORAGE works. I need to investigate further today. If anyone has any ideas or was considering this issue in a way, please, let me know. &lt;/p&gt;</comment>
                            <comment id="17295305" author="brandon.williams" created="Thu, 4 Mar 2021 14:36:50 +0000"  >&lt;p&gt;I&apos;m not sure what the problem was, but your fix of removing a padding state in ApplicationState is incorrect, paddings should never be removed or consumed.  It look like this has been done in a couple other places, I&apos;ve created &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16484&quot; title=&quot;Audit consumption/removal of ApplicationState padding&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16484&quot;&gt;&lt;del&gt;CASSANDRA-16484&lt;/del&gt;&lt;/a&gt; to address these.&lt;/p&gt;</comment>
                            <comment id="17295311" author="edimitrova" created="Thu, 4 Mar 2021 14:46:06 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt;, while in general you are right in this case the situation is different.&lt;/p&gt;

&lt;p&gt;It is not really just a removal, during merge from the previous versions I had to substitute X4 with the&#160;SSTABLE_VERSIONS. If you compare the enums in 3.0/3.11 and 4.0 you can see it.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17295315" author="brandon.williams" created="Thu, 4 Mar 2021 14:50:31 +0000"  >&lt;blockquote&gt;&lt;p&gt;I had to substitute X4 with the SSTABLE_VERSIONS.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This was unfortunately incorrect too, then.  I&apos;ve written an explanation of the padding on &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16484&quot; title=&quot;Audit consumption/removal of ApplicationState padding&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16484&quot;&gt;&lt;del&gt;CASSANDRA-16484&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17295316" author="edimitrova" created="Thu, 4 Mar 2021 14:50:56 +0000"  >&lt;p&gt;Actually, do you mean that &lt;a href=&quot;https://github.com/ekaterinadimitrova2/cassandra/blob/dcbff670cc3569aaa10befdafa4294968cf8c3c6/src/java/org/apache/cassandra/gms/ApplicationState.java#L46&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;X1, X2, X3&lt;/a&gt; were consumed in a wrong way? (this was done in a different patch but we followed the same approach for the new SSTABLE_VERSIONS)&lt;/p&gt;</comment>
                            <comment id="17295317" author="brandon.williams" created="Thu, 4 Mar 2021 14:52:20 +0000"  >&lt;p&gt;Yes.&lt;/p&gt;</comment>
                            <comment id="17295446" author="edimitrova" created="Thu, 4 Mar 2021 17:20:37 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt;, I will leave the current patch as is and leave to you to fix the 4.0 padding in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16484&quot; title=&quot;Audit consumption/removal of ApplicationState padding&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16484&quot;&gt;&lt;del&gt;CASSANDRA-16484&lt;/del&gt;&lt;/a&gt;. &lt;br/&gt;
Also, the issue with the tests is not an issue, we can&apos;t execute ALTER table on a mixed cluster of 3 and 4 nodes. I guess I got confused after the timeout last night. &lt;br/&gt;
I will revise the tests and run last CI for final +1. I see our CI is back to normal, the latest issues were fixed&lt;/p&gt;</comment>
                            <comment id="17295676" author="edimitrova" created="Fri, 5 Mar 2021 01:13:20 +0000"  >&lt;p&gt;Patches:&lt;br/&gt;
 &lt;a href=&quot;https://github.com/ekaterinadimitrova2/cassandra/pull/79/files&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0 &lt;/a&gt; | &lt;a href=&quot;https://github.com/ekaterinadimitrova2/cassandra/pull/87/files&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.11 &lt;/a&gt; | &lt;a href=&quot;https://github.com/ekaterinadimitrova2/cassandra/pull/88/files&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk &lt;/a&gt; | &lt;a href=&quot;https://github.com/ekaterinadimitrova2/cassandra-dtest/pull/7/files&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;DTests &lt;/a&gt;&lt;br/&gt;
 CI:&lt;br/&gt;
 &lt;a href=&quot;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/655/workflows/5c9281e0-ccb1-423e-939a-6f42fb201d00&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0 &lt;/a&gt; | &lt;a href=&quot;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/657/workflows/570fcf4a-954d-4484-a2d6-3e8a0d296fdf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.11 &lt;/a&gt; | &lt;a href=&quot;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/659/workflows/7e6669a1-a325-4a28-bbc2-02694fee148f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk &lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The CI is still not fixed but at least unit tests and in-jvm look good.&lt;/p&gt;

&lt;p&gt;The in-jvm upgrade tests finished successfully locally, I just can&apos;t update in CircleCI the jars, I think?&lt;/p&gt;</comment>
                            <comment id="17296053" author="blerer" created="Fri, 5 Mar 2021 14:40:28 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="17296097" author="edimitrova" created="Fri, 5 Mar 2021 15:31:40 +0000"  >&lt;p&gt;Seems like MIDRES and config.yml &#160;were missed to be updated as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16474&quot; title=&quot;Multiple python dtest failures after promoting protocol v5 from beta&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16474&quot;&gt;&lt;del&gt;CASSANDRA-16474&lt;/del&gt;&lt;/a&gt; so that is why after rebase the CI was still failing. As an intermediate solution I updated the docker image &lt;a href=&quot;https://github.com/ekaterinadimitrova2/cassandra/commit/20b8ec3763fcbfb8c33d9fbc1ff78d83162c92d2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; and reran the CI &lt;a href=&quot;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/660/workflows/a703312e-e9fb-4a9e-8cd6-d33e6b95d274&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here &lt;/a&gt;. I don&apos;t think the failures are related to this patch.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I will open another ticket to update CircleCI config&lt;/p&gt;</comment>
                            <comment id="17297426" author="edimitrova" created="Mon, 8 Mar 2021 14:52:07 +0000"  >&lt;p&gt;I squashed and pushed a full CI run in Jenkins over the weekend but there are a few test failures that I should check now. They were not failing locally. I am going to work on them now and hopefully this could be committed until the end of the day if &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt;&#160;also approves the rest of the branches and the python dtests.&lt;/p&gt;</comment>
                            <comment id="17297541" author="edimitrova" created="Mon, 8 Mar 2021 17:16:11 +0000"  >&lt;p&gt;Rerunning python upgrade tests locally is slow. DTests small patch coming soon, definitely just a test issue due to timing issues&lt;/p&gt;</comment>
                            <comment id="17297674" author="brandon.williams" created="Mon, 8 Mar 2021 19:56:29 +0000"  >&lt;p&gt;It looks like you will need to rebase the ApplicationState changes after &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16184&quot; title=&quot;ClientRequestSize metric tests should be improved&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16184&quot;&gt;&lt;del&gt;CASSANDRA-16184&lt;/del&gt;&lt;/a&gt;, since I don&apos;t think this will merge cleanly there.&lt;/p&gt;</comment>
                            <comment id="17297796" author="edimitrova" created="Tue, 9 Mar 2021 02:38:17 +0000"  >&lt;p&gt;I think you meant &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16484&quot; title=&quot;Audit consumption/removal of ApplicationState padding&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-16484&quot;&gt;&lt;del&gt;CASSANDRA-16484&lt;/del&gt;&lt;/a&gt;, I just rebased and fixed that conflict.&lt;/p&gt;

&lt;p&gt;Also, I found a small bug in 4.0 patch and fixed the check &lt;a href=&quot;https://github.com/ekaterinadimitrova2/cassandra/commit/b4aa7beb9e4f513887c3af15c66acd297b7e4623#diff-3434848170f154654ec22746b39b1fc1ce747cf416dd9bdd10e14386983004f8R458-R459&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;, testing it in the DTests&#160;&lt;a href=&quot;https://github.com/ekaterinadimitrova2/cassandra-dtest/commit/099fffb72d432d0ac8fb2ed27a7fbfa0a56405d3#diff-a0ae22c334be9294ded78f79e39af70cead9ba41c023093d6254ee3dc41cb6ebR143-R147&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Jenkins runs:&lt;br/&gt;
&lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch/471/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt; | &lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch/472/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.11&lt;/a&gt; | &lt;a href=&quot;https://ci-cassandra.apache.org/job/Cassandra-devbranch/474/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;On commit I should redirect the DTests &lt;a href=&quot;https://github.com/ekaterinadimitrova2/cassandra-dtest/commit/099fffb72d432d0ac8fb2ed27a7fbfa0a56405d3#diff-a0ae22c334be9294ded78f79e39af70cead9ba41c023093d6254ee3dc41cb6ebR13-R15&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; to the Apache repo and revert the changes in the CircleCI config file.&lt;br/&gt;
The order of commits should be - first the python DTests and then the Cassandra patches.&lt;/p&gt;</comment>
                            <comment id="17298145" author="edimitrova" created="Tue, 9 Mar 2021 16:05:51 +0000"  >&lt;p&gt;Jenkins looks fine to me.&lt;/p&gt;

&lt;p&gt;On 3.0 the only new failures are:&lt;/p&gt;

&lt;p&gt;&#160;- &lt;em&gt;cql3.ViewLongTest&lt;/em&gt; but it seems resource issue, unrelated and it passed locally.&lt;/p&gt;

&lt;p&gt;&#160;- &lt;em&gt;upgrade_through_versions_test.TestUpgrade_current_2_1_x_To_indev_3_0_x&lt;/em&gt; seems unrelated too but I am rerunning those locally to double check what is going on.&#160;&lt;/p&gt;

&lt;p&gt;No new failures in 3.11 and 4.0&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt;&#160;if you don&apos;t have any concerns, I think I am ready to commit today as soon as&#160;&lt;em&gt;upgrade_through_versions_test.TestUpgrade_current_2_1_x_To_indev_3_0_x&lt;/em&gt; doesn&apos;t surprise me, still running, those are slow&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17299135" author="brandon.williams" created="Wed, 10 Mar 2021 21:08:02 +0000"  >&lt;p&gt;+1, though I&apos;ll note the addition of getApplicationState to the Gossiper has been handled by a subsequent call from getEndpointState historically, but I&apos;m not against the addition of the method here since there is no need to distinguish between not knowing the endpoint and it not having a given state.  In fact, I hope we use it more going forward.&lt;/p&gt;</comment>
                            <comment id="17299259" author="edimitrova" created="Thu, 11 Mar 2021 03:06:21 +0000"  >&lt;p&gt;DTests committed &lt;a href=&quot;https://github.com/apache/cassandra-dtest/commit/700f712c0ee87ea90c960e7fe92343bff7b2ba23&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;3.0 committed &lt;a href=&quot;https://github.com/apache/cassandra/commit/efde6a76f9807eaa0af80b5e85aa350ac8709a81&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;3.11 committed &lt;a href=&quot;https://github.com/apache/cassandra/commit/b6540009365b1986950510ecc28ee5740c64412e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;4.0 committed &lt;a href=&quot;https://github.com/apache/cassandra/commit/c7432e98a381c16cb63692e727c35e2909d7200a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;In 3.0 and 3.11 the docker image was not updated in config.yml after the latest changes, only LOWRES was updated so I used the opportunity to correct that.&lt;/p&gt;

&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt;&#160;for the patch.&lt;/p&gt;

&lt;p&gt;Thank you for the reviews and help &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blerer&quot; class=&quot;user-hover&quot; rel=&quot;blerer&quot;&gt;blerer&lt;/a&gt;&#160;and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17299826" author="edimitrova" created="Thu, 11 Mar 2021 19:37:24 +0000"  >&lt;p&gt;One of the in-jvm tests failed, now all compact storage related in-JVM upgrade tests require GOSSIP in order to take a decision whether DROP COMPACT STORAGE can or cannot be executed.&#160;&lt;/p&gt;

&lt;p&gt;I ninja-fixed it &lt;a href=&quot;https://github.com/apache/cassandra/commit/07babf3cb10bc11efad48cc7865c7425d7c27ce4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;br/&gt;
 The successful CI run can be found &lt;a href=&quot;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/694/workflows/0b29dcb6-2cb4-48e0-b119-5e0ab1b8d74f/jobs/3814&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I apologize for the inconvenience caused and thanks to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mck&quot; class=&quot;user-hover&quot; rel=&quot;mck&quot;&gt;mck&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blerer&quot; class=&quot;user-hover&quot; rel=&quot;blerer&quot;&gt;blerer&lt;/a&gt; for the pings. Appreciate it&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13323784">CASSANDRA-16063</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13341845">CASSANDRA-16295</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[edimitrova]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12984" cascade-level=""><![CDATA[Degradation]]></customfieldvalue>
                                <customfieldvalue key="12998" cascade-level="1"><![CDATA[Other Exception]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12970"><![CDATA[Unit Test]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 35 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0g4cw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blerer]]></customfieldvalue>
        <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
        <customfieldvalue><![CDATA[e.dimitrova]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/efde6a76f9807eaa0af80b5e85aa350ac8709a81&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/efde6a76f9807eaa0af80b5e85aa350ac8709a81&lt;/a&gt; &lt;a href=&quot;https://github.com/apache/cassandra-dtest/commit/700f712c0ee87ea90c960e7fe92343bff7b2ba23&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra-dtest/commit/700f712c0ee87ea90c960e7fe92343bff7b2ba23&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-15897?focusedCommentId=17299259&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#comment-17299259&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CASSANDRA-15897?focusedCommentId=17299259&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#comment-17299259&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>