<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:55:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-9874] Compact value columns aren&apos;t being migrated properly in 3.0</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-9874</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;To quote &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6717?focusedCommentId=14626965&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14626965&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;Tyler&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;2.1 and 3.0 currently have different behavior around default compact value columns. When you create a table like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;CREATE TABLE foo (
    k &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,
    c &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,
    PRIMARY KEY (k, c)
) WITH COMPACT STORAGE;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2.1 will add a &lt;tt&gt;compact_value&lt;/tt&gt; column to &lt;tt&gt;system.schema_columns&lt;/tt&gt; with an empty &lt;tt&gt;column_name&lt;/tt&gt; and a &lt;tt&gt;BytesType&lt;/tt&gt; validator.&lt;/p&gt;

&lt;p&gt;In 3.0, we instead add a &lt;tt&gt;regular&lt;/tt&gt; column with the default compact value name (&lt;tt&gt;value&lt;/tt&gt;) and an &lt;tt&gt;EmptyType&lt;/tt&gt; validator.&lt;/p&gt;

&lt;p&gt;The logic in 3.0 depends on having an &lt;tt&gt;EmptyType&lt;/tt&gt; column (see &lt;tt&gt;CompactTables.hasEmptyCompactValue()&lt;/tt&gt;) but current trunk doesn&apos;t migrate the column. &lt;tt&gt;LegacySchemaMigrator.addDefinitionForUpgrade()&lt;/tt&gt; almost does what we want, but doesn&apos;t add the &lt;tt&gt;EmptyType&lt;/tt&gt; column because it sees the existing &lt;tt&gt;compact_value&lt;/tt&gt; column.&lt;/p&gt;

</description>
                <environment></environment>
        <key id="12848386">CASSANDRA-9874</key>
            <summary>Compact value columns aren&apos;t being migrated properly in 3.0</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aleksey">Aleksey Yeschenko</assignee>
                                    <reporter username="aleksey">Aleksey Yeschenko</reporter>
                        <labels>
                    </labels>
                <created>Wed, 22 Jul 2015 21:22:52 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:03 +0000</updated>
                            <resolved>Thu, 23 Jul 2015 15:46:48 +0000</resolved>
                                        <fixVersion>3.0 alpha 1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14638806" author="slebresne" created="Thu, 23 Jul 2015 13:37:10 +0000"  >&lt;p&gt;lgtm, though as a very minor point, I&apos;m not sure I would have continued in &lt;tt&gt;hasRegularColumns&lt;/tt&gt; for the case where &lt;tt&gt;isEmptyCompactValueColumn(row)&lt;/tt&gt;. In theory, if we have a compact value in the first place, we shouldn&apos;t have any regular and continuing the loop is fine, but I don&apos;t like that being implicit. Especially since, if something is weird in the schema (we have both an empty compact and some regular), whether we go through the upgrade or not would currently depends on the order of thing in &lt;tt&gt;columnRows&lt;/tt&gt;. So I&apos;d have either returned &lt;tt&gt;false&lt;/tt&gt; directly for the empty compact case, so we&apos;re at least consistent in the face of brokenness, or make the loop validate we&apos;re not broken. Note: I probably wouldn&apos;t care too much for that kind of things normally, but we&apos;re doing a lot of stuff with the schema in this version, so being extra careful things are what we think they are doesn&apos;t feel wasted.&lt;/p&gt;</comment>
                            <comment id="14638810" author="iamaleksey" created="Thu, 23 Jul 2015 13:42:53 +0000"  >&lt;p&gt;Fair enough. Pushed as &lt;a href=&quot;https://github.com/iamaleksey/cassandra/commit/fe85c7354ae6e54be07cb02a917f67292cf67337&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this commit&lt;/a&gt;, will commit once cassci does her magic.&lt;/p&gt;</comment>
                            <comment id="14639034" author="iamaleksey" created="Thu, 23 Jul 2015 15:46:38 +0000"  >&lt;p&gt;Committed to trunk as &lt;tt&gt;2d55c1e8465015fd18cc71a1228489aaf5c6eea8&lt;/tt&gt;. Cassci &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/iamaleksey/job/iamaleksey-9874-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt; and &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/iamaleksey/job/iamaleksey-9874-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12842222">CASSANDRA-9704</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 17 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ht6n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>