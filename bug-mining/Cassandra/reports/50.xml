<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:10:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-208] OOM intermittently during compaction</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-208</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;jvm crashes intermittently during compaction. Our test data set is not that big, less than 10 GB.&lt;br/&gt;
When jvm is about to crash, we see that it consumes a lot of memory (exceeding the max heap size).&lt;/p&gt;

&lt;p&gt;The excessive memory usage during compaction is caused by the maintenance of blockIndexes_ in SSTable. this blockIndexes_ was only introduced to the apache version.&lt;/p&gt;</description>
                <environment>&lt;p&gt;arch: x86_64&lt;br/&gt;
os: Linux version 2.6.18-92.1.22.el5 &lt;br/&gt;
java: nio2-ea-bin-b99-linux-x64-05_feb_2009&lt;/p&gt;</environment>
        <key id="12426691">CASSANDRA-208</key>
            <summary>OOM intermittently during compaction</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10000" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Urgent</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="jihuang">Jiansheng Huang</reporter>
                        <labels>
                    </labels>
                <created>Fri, 29 May 2009 16:49:07 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:37 +0000</updated>
                            <resolved>Tue, 9 Jun 2009 17:47:20 +0000</resolved>
                                        <fixVersion>0.4</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="12714521" author="junrao" created="Fri, 29 May 2009 17:31:04 +0000"  >&lt;p&gt;In your data set, do you have a large row? Today, during compaction, a full row may have to be buffered in memory. See &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-16&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CASSANDRA-16&lt;/a&gt; for more on this.&lt;/p&gt;</comment>
                            <comment id="12714564" author="jihuang" created="Fri, 29 May 2009 19:43:22 +0000"  >&lt;p&gt;we don&apos;t have a large row, definitely not to a size which cannot fit in memory.&lt;/p&gt;</comment>
                            <comment id="12714635" author="jbellis" created="Fri, 29 May 2009 23:25:36 +0000"  >&lt;p&gt;blockindexes_ keeps the indexes in memory as the flush or compaction is performed, so they can be dumped at the end of the SSTable file.&lt;/p&gt;

&lt;p&gt;The old code on code.google dumped each index at the end of its block which avoided this problem (only one block&apos;s index would ever be in memory at once).  I&apos;m not sure why FB changed this behavior.  The only reason I can think of is that reading the index later won&apos;t require as many seeks, but this seems like a bad optimization to make since index reading is done once per sstable.&lt;/p&gt;

&lt;p&gt;I couldn&apos;t tell at first why this should cause OOM &amp;#8211; in both the google and apache versions we have indexMetadataMap_ which contains the same block index info, right?  Wrong, the difference is that iMM only contains the first entry from each block index.  So much less memory is used there.&lt;/p&gt;

&lt;p&gt;I guess we should switch back to the old, interleaved block indexing method.&lt;/p&gt;</comment>
                            <comment id="12715300" author="jbellis" created="Mon, 1 Jun 2009 23:22:31 +0000"  >&lt;p&gt;Or, how about this: we just stop storing multiple kinds of data in the SSTable file, and instead store the index entries and the bloom filter in separate on-disk files.&lt;/p&gt;

&lt;p&gt;Gains (vs interleaving):&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;simplicity (don&apos;t have to skip non-data keys, EOF is really EOF)&lt;/li&gt;
	&lt;li&gt;no more hard-coded &quot;keys&quot; in the sstable that will result in very weird-ass bugs if a client every uses one&lt;/li&gt;
	&lt;li&gt;behaves more like the FS cache expects since each section (index, data, bloom) is homogeneous and the &quot;if I read block A, I&apos;m more likely to need the next block&quot; assumption holds more often&lt;/li&gt;
	&lt;li&gt;retains goal of loading index on server start w/o seeking&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Losses:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;some seeking during flush/compaction to switch between writing data blocks and index blocks&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Although the &quot;no seeks on writes, at all&quot; claim is a cool one, in practice the amount of seeks we&apos;ll be doing is still negligible when buffering is done, i.e., still a huge win over traditional B-tree design where every update requires a seek.&lt;/p&gt;

&lt;p&gt;Thoughts?&lt;/p&gt;</comment>
                            <comment id="12715301" author="jbellis" created="Mon, 1 Jun 2009 23:24:07 +0000"  >&lt;p&gt;IMO we need to address the hard-coded-&quot;keys&quot; problem sooner or later, and having separate files is really the only sane solution.&lt;/p&gt;</comment>
                            <comment id="12715322" author="junrao" created="Tue, 2 Jun 2009 01:22:29 +0000"  >&lt;p&gt;Even if we take out the row index and BF, data is still mixed with column index.&lt;/p&gt;

&lt;p&gt;Interestingly, HBase&apos;s sstable format started with MapFile (1 file for index, 1 file for BF and 1 file for data) and has recently moved to the TFile (a spec can be found at &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-3315&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HADOOP-3315&lt;/a&gt;) format (1 file for everything). Although HBase probably did that mainly for reducing # of files (problem for HDFS master), it&apos;s probably worth while to take a look at their new design (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-61&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-61&lt;/a&gt;).&lt;/p&gt;</comment>
                            <comment id="12715329" author="jbellis" created="Tue, 2 Jun 2009 01:41:51 +0000"  >&lt;p&gt;Thanks for the links, that is interesting context.&lt;/p&gt;</comment>
                            <comment id="12715334" author="jbellis" created="Tue, 2 Jun 2009 02:06:49 +0000"  >&lt;p&gt;Another related link: &lt;a href=&quot;http://wiki.apache.org/hadoop/Hbase/NewFileFormat&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://wiki.apache.org/hadoop/Hbase/NewFileFormat&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;My take is that the designs are different enough that their reasons for moving to a single file don&apos;t really apply to cassandra.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;the old MapFile has a bunch of properties that make it general enough for Hadoop core but inefficient for hbase (e.g. storing the CF name once per key, keys appearing multiple times in the index)&lt;/li&gt;
	&lt;li&gt;they only index one key per block, so their index is much much smaller than ours, and they can get away with storing the index at the end of the file as cassandra currently does&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&amp;gt; Even if we take out the row index and BF, data is still mixed with column index. &lt;/p&gt;

&lt;p&gt;Not at the SSTable key/value level.  To sstable the value is just byte[] so the fact that CF serializes with indexes is an implementation detail.  (To the degree that SSTable or SF does care, that is an encapsulation violation &amp;#8211; one of the reasons this code is one of the less pleasant parts of cassandra to work in.)&lt;/p&gt;

&lt;p&gt;I will get a patch together that will implement the file splitting I proposed and we will see how that looks.  I think that&apos;s going to get us to a stable 0.3 fastest; if we want to radically re-think how indexing works (so we can go back to index-at-the-end-of-one-file) then I think that is a change to make in 0.4.  (The non-sparse index Cassandra uses may be necessary if you want to support large CF rows, or you will waste too much time scanning through those rows looking for keys when you only get to within 128 keys from the index.)&lt;/p&gt;

&lt;p&gt;One thing that piqued my curiosity: what is the hbase &quot;row index?&quot;  Looks like their &quot;key index&quot; is like our sstable indexes (with the difference mentioned above, that it only indexes one key per block).&lt;/p&gt;</comment>
                            <comment id="12715554" author="junrao" created="Tue, 2 Jun 2009 15:34:09 +0000"  >&lt;p&gt;When HBase was using the old format, rows are stored as &amp;lt;key,value&amp;gt; pairs in MapFile, where a key is rowkey:columnName:timestamp. The keys for every 128 rows are promoted to the row index. The benefit is that it&apos;s simple. There is only a single-level index (compared with row index and column index within a row in cassandra) and it can be used to efficiently look up a full row, a column within a row, or a version of a column in a row. On the other hand, if you make the index dense, the row keys are duplicated for columns within the same row.&lt;/p&gt;</comment>
                            <comment id="12716073" author="jbellis" created="Wed, 3 Jun 2009 21:39:56 +0000"  >&lt;p&gt;03&lt;br/&gt;
    split sstable into data, index, and bloom filter files&lt;/p&gt;

&lt;p&gt;02&lt;br/&gt;
    r/m &apos;touch&apos; code that populates a cache that is never used (and never updated on compaction either, so it&apos;s buggy too)&lt;/p&gt;

&lt;p&gt;01&lt;br/&gt;
    cleanup.  mostly just moving code around so its position makes more sense to me&lt;/p&gt;</comment>
                            <comment id="12716099" author="junrao" created="Wed, 3 Jun 2009 23:03:47 +0000"  >&lt;p&gt;can&apos;t apply patch to trunk. could you rebase?&lt;/p&gt;</comment>
                            <comment id="12716101" author="junrao" created="Wed, 3 Jun 2009 23:35:39 +0000"  >&lt;p&gt;just realize this is off 0.3 branch, never mind.&lt;/p&gt;</comment>
                            <comment id="12716299" author="jbellis" created="Thu, 4 Jun 2009 15:51:04 +0000"  >&lt;p&gt;Jiansheng: can you give us more details about your data set?  We are trying to figure out how likely it is for others to run into this, leaning towards moving this patch to trunk/0.4.&lt;/p&gt;

&lt;p&gt;The relevant data are&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;how many keys in the CF that fails to compact&lt;/li&gt;
	&lt;li&gt;average / max row size (column size x count) in that CF&lt;/li&gt;
	&lt;li&gt;jvm memory settings, and how much of the heap is free (according to e.g. jconsole) before compaction starts&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12716346" author="junrao" created="Thu, 4 Jun 2009 17:59:58 +0000"  >&lt;p&gt;Just browsed through the patch for now and found the following bug.&lt;/p&gt;

&lt;p&gt;In SSTable.afterAppend, the position added to indexEntries should be the position in the index file, not the position in the data file.&lt;/p&gt;</comment>
                            <comment id="12716352" author="jbellis" created="Thu, 4 Jun 2009 18:14:04 +0000"  >&lt;p&gt;Good catch.&lt;/p&gt;

&lt;p&gt;I will add a test for this in the version for trunk.&lt;/p&gt;</comment>
                            <comment id="12716359" author="jihuang" created="Thu, 4 Jun 2009 18:24:33 +0000"  >&lt;p&gt;To answer Jonathan&apos;s questions: (1) we have tested around several million keys, (2) avg row size ~ 2k, max row size ~ 10k. (3) tried several Xmx settings, max tried is 5G. Before compaction starts, pretty much most of the heap is free. I think the problem is easy to run into if the system is run with continuous traffic for over a week or so given that our test dataset has been fairly small.&lt;/p&gt;</comment>
                            <comment id="12716369" author="junrao" created="Thu, 4 Jun 2009 18:53:08 +0000"  >&lt;p&gt;Jiansheng, what&apos;s the average key size of a row?&lt;/p&gt;</comment>
                            <comment id="12716375" author="jihuang" created="Thu, 4 Jun 2009 19:18:00 +0000"  >&lt;p&gt;Jun, our key size is about 20 characters.&lt;/p&gt;</comment>
                            <comment id="12716387" author="junrao" created="Thu, 4 Jun 2009 20:18:39 +0000"  >&lt;p&gt;Hmm, with a key size of 40 bytes, even with 10 million keys, the space needed for all row index entries is about 400MB. That&apos;s way smaller than 5G. So, not sure whether the new SSTable format really solves this particular OOME problem.&lt;/p&gt;</comment>
                            <comment id="12716399" author="jbellis" created="Thu, 4 Jun 2009 20:54:53 +0000"  >&lt;p&gt;You&apos;re forgetting the BlockMetadata longs (extra 16 bytes per key) and Map overhead (32 bytes per key or more), which would be 880MB for 10M keys.&lt;/p&gt;

&lt;p&gt;Still smaller than 5G, though.  I guess we can get Jiansheng to test after applying the patch. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12716430" author="jbellis" created="Thu, 4 Jun 2009 22:31:04 +0000"  >&lt;p&gt;removed patches against 0.3 (to avoid confusion, i still have copies should they become necessary).&lt;/p&gt;

&lt;p&gt;added patches against trunk.&lt;/p&gt;</comment>
                            <comment id="12716452" author="jihuang" created="Thu, 4 Jun 2009 23:07:57 +0000"  >&lt;p&gt;Ok, then scale up the number of keys by 5 times, you will run into the problem. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12716453" author="junrao" created="Thu, 4 Jun 2009 23:35:22 +0000"  >&lt;p&gt;Some comments:&lt;br/&gt;
1. In SSTable.loadIndexFile, indexEntries could be empty if there are fewer than indexInterval keys. I don&apos;t see code dealing with empty indexEntries. A simple solution is to add the last index key to indexEntries when indexEntries is empty. Similarly, you have to fix the same case when an SSTable is first created. You have to remember the last index key being appended.&lt;/p&gt;

&lt;p&gt;2. In SSTable.next, need to deal with the case that getPosition() returns -1. &lt;/p&gt;

&lt;p&gt;3. In SSTable.getColumnGroupReader, change getNearestPostion() to getPostion(). Similar to 2, need to deal with returned position being -1.&lt;/p&gt;


&lt;p&gt;Also, we need to remember opening another issue to get rid of partitioner from KeyPosition.&lt;/p&gt;
</comment>
                            <comment id="12716472" author="jbellis" created="Fri, 5 Jun 2009 01:08:57 +0000"  >&lt;p&gt;1. empty memtables are not flushed, so there will be at least one key, and the first key will always be in indexEntries since 0 % interval == 0 for any interval.  lots of the tests have only one row.  I don&apos;t think there is a problem here.&lt;/p&gt;

&lt;p&gt;2. ok&lt;/p&gt;

&lt;p&gt;3. Hmm, if you have columns B C and D in a row, and you do a slice_from starting with A, don&apos;t you want B C D to be returned?  getNearestPosition will start the scan at B, but vanilla getPosition will return -1 if there is not an exact match.&lt;/p&gt;</comment>
                            <comment id="12716476" author="junrao" created="Fri, 5 Jun 2009 01:23:51 +0000"  >&lt;p&gt;3. That&apos;s true, but at the column level. At the row level, get_slice_from only cares about exact row match.&lt;/p&gt;</comment>
                            <comment id="12716477" author="jbellis" created="Fri, 5 Jun 2009 01:26:21 +0000"  >&lt;p&gt;Ah, thanks.  I got mixed up. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12716485" author="jbellis" created="Fri, 5 Jun 2009 03:19:02 +0000"  >&lt;p&gt;2. is handled by FileReader.next being a no-op if position == -1&lt;/p&gt;

&lt;p&gt;3. attached 04 patch to fix, and add more tests.  Also, makes sliceFrom able to handle &quot;&quot; as start column.&lt;/p&gt;</comment>
                            <comment id="12716650" author="junrao" created="Fri, 5 Jun 2009 15:47:03 +0000"  >&lt;p&gt;Were you able to run unit tests successfully? I saw a bunch of failures in tests like CompactionsTest and NameSortTest.&lt;/p&gt;</comment>
                            <comment id="12716675" author="jbellis" created="Fri, 5 Jun 2009 17:11:54 +0000"  >&lt;p&gt;I did have NameSortTest and TimeSortTest failing because they were extending CFST and hence running those tests as well, which caused problems since those sets of tests are supposed to be run independently.  Making NST and TST not inherit from CFST (which was only done for convenience) fixes that.   Here is the patch.&lt;/p&gt;

&lt;p&gt;I haven&apos;t seen compactions et al ever fail, no.&lt;/p&gt;</comment>
                            <comment id="12716696" author="junrao" created="Fri, 5 Jun 2009 18:03:48 +0000"  >&lt;p&gt;My ant test succeeds on linux, but fails under cygwin on windows. Here are some of the failures that I get. Those tests succeed on windows without your patch.&lt;/p&gt;

&lt;p&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Testcase: testCompactions(org.apache.cassandra.db.CompactionsTest): FAILED&lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; attempted to delete non-existing file Table1-Standard1-14-Filter.db&lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; junit.framework.AssertionFailedError: attempted to delete non-existing file Table1-Standard1-14-Filter.db&lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.apache.cassandra.io.SSTable.deleteWithConfirm(SSTable.java:103)&lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.apache.cassandra.io.SSTable.delete(SSTable.java:98)&lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.apache.cassandra.db.ColumnFamilyStore.doFileCompaction(ColumnFamilyStore.java:1373)&lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.apache.cassandra.db.ColumnFamilyStore.doCompaction(ColumnFamilyStore.java:849)&lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.apache.cassandra.db.CompactionsTest.testCompactions(CompactionsTest.java:63)&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Testcase: testNameSort10(org.apache.cassandra.db.NameSortTest):     FAILED&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; null&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; junit.framework.AssertionFailedError&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.apache.cassandra.db.NameSortTest.validateNameSort(NameSortTest.java:111)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.apache.cassandra.db.NameSortTest.testNameSort(NameSortTest.java:89)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.apache.cassandra.db.NameSortTest.testNameSort10(NameSortTest.java:43)&lt;/p&gt;</comment>
                            <comment id="12717309" author="jbellis" created="Mon, 8 Jun 2009 16:17:24 +0000"  >&lt;p&gt;do those tests pass after applying just 01 and 02?&lt;/p&gt;</comment>
                            <comment id="12717339" author="junrao" created="Mon, 8 Jun 2009 17:50:01 +0000"  >&lt;p&gt;The tests pass with just 01 and 02. They start failing with 03.&lt;/p&gt;</comment>
                            <comment id="12717377" author="jbellis" created="Mon, 8 Jun 2009 19:45:55 +0000"  >&lt;p&gt;committed 01 to avoid rebase hell.  (02 was merged via &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-222&quot; title=&quot;r/m touch from 0.3&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-222&quot;&gt;&lt;del&gt;CASSANDRA-222&lt;/del&gt;&lt;/a&gt; from 0.3.)&lt;/p&gt;</comment>
                            <comment id="12717452" author="jbellis" created="Mon, 8 Jun 2009 21:55:01 +0000"  >&lt;p&gt;208.patch integrates the old 03, 04, and 05 for convenience&lt;/p&gt;</comment>
                            <comment id="12717453" author="jbellis" created="Mon, 8 Jun 2009 21:56:03 +0000"  >&lt;p&gt;208-2 fixes syncing of the bloom filter files.  this fixes the compactions failure and all the others except timesort, which is not actually a new bug.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-223&quot; title=&quot;time-based slicing does not work correctly w/ &amp;quot;historical&amp;quot; memtables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-223&quot;&gt;&lt;del&gt;CASSANDRA-223&lt;/del&gt;&lt;/a&gt; shows that the timesort failure is caused by a bug in TimeFilter that dates back to the FB import.&lt;/p&gt;</comment>
                            <comment id="12717466" author="junrao" created="Mon, 8 Jun 2009 22:25:37 +0000"  >&lt;p&gt;Ok, now all tests pass except timesort.&lt;/p&gt;</comment>
                            <comment id="12717664" author="hudson" created="Tue, 9 Jun 2009 12:34:28 +0000"  >&lt;p&gt;Integrated in Cassandra #103 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Cassandra/103/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Cassandra/103/&lt;/a&gt;)&lt;br/&gt;
    cleanup SSTable-related code.  patch by jbellis; reviewed by Jun Rao for &lt;/p&gt;</comment>
                            <comment id="12717713" author="jbellis" created="Tue, 9 Jun 2009 15:39:35 +0000"  >&lt;p&gt;208-3 patches TST to only test what it was intended to test, not &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-223&quot; title=&quot;time-based slicing does not work correctly w/ &amp;quot;historical&amp;quot; memtables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-223&quot;&gt;&lt;del&gt;CASSANDRA-223&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12717758" author="junrao" created="Tue, 9 Jun 2009 17:21:21 +0000"  >&lt;p&gt;Patch 208-3 looks fine. All tests pass.&lt;/p&gt;</comment>
                            <comment id="12717765" author="jbellis" created="Tue, 9 Jun 2009 17:47:20 +0000"  >&lt;p&gt;committed 208 and 208-2 as a single commit, and 208-3 separately.&lt;/p&gt;

&lt;p&gt;jiansheng, does this resolve your OOM problems?&lt;/p&gt;</comment>
                            <comment id="12718068" author="hudson" created="Wed, 10 Jun 2009 13:12:06 +0000"  >&lt;p&gt;Integrated in Cassandra #104 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Cassandra/104/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Cassandra/104/&lt;/a&gt;)&lt;br/&gt;
    apply rows atomically, rather than one-column-at-a-time.  this avoids exposing the bug in time-sorted&lt;br/&gt;
columns discussed in #223.&lt;br/&gt;
patch by jbellis; reviewed by Jun Rao for &lt;br/&gt;
split sstable into data, index, and bloom filter files.  this allows us to avoid saving up index chunks&lt;br/&gt;
in memory until the sstable data is completely written, while still allowing fast scanning of the index&lt;br/&gt;
on startup.  it also simplifies the sstable/sequencefile code considerably.&lt;br/&gt;
patch by jbellis; reviewed by Jun Rao for  &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12409922" name="0004-fix-ColumnReader-add-tests.patch" size="7349" author="jbellis" created="Fri, 5 Jun 2009 03:19:43 +0000"/>
                            <attachment id="12410003" name="0005-fix-test-order-dependent-failures.patch" size="4212" author="jbellis" created="Fri, 5 Jun 2009 17:11:54 +0000"/>
                            <attachment id="12410180" name="208-2.patch" size="1279" author="jbellis" created="Mon, 8 Jun 2009 21:56:03 +0000"/>
                            <attachment id="12410228" name="208-3.patch" size="2089" author="jbellis" created="Tue, 9 Jun 2009 15:39:35 +0000"/>
                            <attachment id="12410179" name="208.patch" size="82857" author="jbellis" created="Mon, 8 Jun 2009 21:55:01 +0000"/>
                            <attachment id="12409910" name="ASF.LICENSE.NOT.GRANTED--0001-CASSANDRA-208-cleanup.txt" size="26950" author="jbellis" created="Thu, 4 Jun 2009 22:30:28 +0000"/>
                            <attachment id="12409911" name="ASF.LICENSE.NOT.GRANTED--0002-r-m-touch.txt" size="43466" author="jbellis" created="Thu, 4 Jun 2009 22:30:28 +0000"/>
                            <attachment id="12409912" name="ASF.LICENSE.NOT.GRANTED--0003-split-sstable-into-data-index-and-bloom-filter-files.txt" size="75234" author="jbellis" created="Thu, 4 Jun 2009 22:30:28 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19594</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 24 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0fxj3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>91030</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>