<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:12:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-14759] Transient-&gt;Full movements mishandle consistency level upgrade</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-14759</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;While we need treat a transitioning node as &#8216;full&#8217; for writes, so that it can safely begin serving full data requests once it has finished, we cannot maintain it in the &#8216;pending&#8217; collection else we will also increase our consistency requirements by a node that doesn&#8217;t exist.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13185829">CASSANDRA-14759</key>
            <summary>Transient-&gt;Full movements mishandle consistency level upgrade</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="benedict">Benedict Elliott Smith</assignee>
                                    <reporter username="benedict">Benedict Elliott Smith</reporter>
                        <labels>
                            <label>Availability</label>
                            <label>correctness</label>
                            <label>transient-replication</label>
                    </labels>
                <created>Tue, 18 Sep 2018 15:14:55 +0000</created>
                <updated>Fri, 15 May 2020 08:01:48 +0000</updated>
                            <resolved>Wed, 3 Oct 2018 13:50:40 +0000</resolved>
                                        <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Legacy/Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16619272" author="benedict" created="Tue, 18 Sep 2018 15:21:07 +0000"  >&lt;p&gt;I thought I had already committed this as one of my other patches, but it seems not.  I hope you don&apos;t mind both being tagged reviewers, since you&apos;ve been reviewing my other TR follow ups, but shis bug is a proper Blocker for 4.0.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/pull/270&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR&lt;/a&gt; &lt;a href=&quot;https://circleci.com/workflow-run/636b2eae-2d9e-4245-ad6b-462eab583f13&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CI&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I will follow up with some tests.&lt;/p&gt;</comment>
                            <comment id="16619311" author="aweisberg" created="Tue, 18 Sep 2018 15:47:13 +0000"  >&lt;p&gt;I think I understand this. It&apos;s fixing a deficiency in write availability where transient -&amp;gt; full would cause that replica to be unavailable for meeting write quorum requirements. Since it would remain present in pending it would also increase group size in blockFor.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; natural.filter(r -&amp;gt; !r.isTransient() || !pending.contains(r.endpoint(), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Specifically the &lt;tt&gt;!pending.contains(r.endpoint(), true)&lt;/tt&gt; (use of an enum instead of true/false might be a hair easier to follow for that API) causes it to no longer appear in natural and in pending instead.&lt;/p&gt;

&lt;p&gt;Once you have the tests I&apos;ll do a final review.&lt;/p&gt;</comment>
                            <comment id="16619334" author="benedict" created="Tue, 18 Sep 2018 15:56:20 +0000"  >&lt;blockquote&gt;&lt;p&gt;use of an enum instead of true/false might be a hair easier to follow for that API&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;del&gt;Agreed, I had that thought before too.  I&apos;ll update the API.&lt;/del&gt;&lt;/p&gt;

&lt;p&gt;Actually, the method is no longer used, so I&apos;ll remove it (for now)&lt;/p&gt;</comment>
                            <comment id="16620340" author="benedict" created="Wed, 19 Sep 2018 09:06:44 +0000"  >&lt;p&gt;I have added a simple test case for this functionality.&lt;/p&gt;</comment>
                            <comment id="16622587" author="aweisberg" created="Thu, 20 Sep 2018 19:34:33 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="16625832" author="ifesdjeen" created="Mon, 24 Sep 2018 13:37:51 +0000"  >&lt;p&gt;+1 as logic looks right, just two minor things for discussion:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;should we get rid of generics &lt;tt&gt;&amp;lt;E extends Endpoints&amp;lt;E&amp;gt;&amp;gt; E&lt;/tt&gt; there since we only have token writes and these methods are called with &lt;tt&gt;EndpointsForToken&lt;/tt&gt; only?&lt;/li&gt;
	&lt;li&gt;semantically, wouldn&apos;t it be better to leave full pending in pending and filter natural transient out? It might be slightly confusing that natural replica flips from transient to full: it doesn&apos;t seem as we have inherent limitations that prevent us from that, or?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16625894" author="benedict" created="Mon, 24 Sep 2018 14:25:22 +0000"  >&lt;blockquote&gt;&lt;p&gt;semantically, wouldn&apos;t it be better to leave full pending in pending and filter natural transient out? It might be slightly confusing that natural replica flips from transient to full: it doesn&apos;t seem as we have inherent limitations that prevent us from that, or?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It might be, but unfortunately pending is used - almost exclusively - to calculate how much we should boost our CL blockFor requirements by.  The sufficiency logic is the last bit of this codepath that could do with being refactored, but until we do this, it is probably more dangerous to leave it in the pending collection and risk boosting blockFor accidentally.&lt;/p&gt;</comment>
                            <comment id="16625897" author="benedict" created="Mon, 24 Sep 2018 14:29:32 +0000"  >&lt;blockquote&gt;&lt;p&gt;should we get rid of generics &amp;lt;E extends Endpoints&amp;lt;E&amp;gt;&amp;gt; E there since we only have token writes and these methods are called with EndpointsForToken only?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;ve made this change, and once I get a clean CI response I&apos;ll merge the patch in.  Thanks for the review!&lt;/p&gt;</comment>
                            <comment id="16636990" author="benedict" created="Wed, 3 Oct 2018 13:50:40 +0000"  >&lt;p&gt;I&apos;ve committed as &lt;a href=&quot;https://github.com/apache/cassandra/commit/daa3619ae63bb8b06d532890e51d288c189c787c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;daa3619ae63bb8b06d532890e51d288c189c787c&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;dtests are now very flaky on CircleCI, but all of the failures in the latest run have shown up in trunk runs for me on CircleCI.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="13183397">CASSANDRA-14697</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[benedict]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 6 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3y7t3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[ifesdjeen]]></customfieldvalue>
        <customfieldvalue><![CDATA[aweisberg]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>