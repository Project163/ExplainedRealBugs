<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:39:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-5718] Cql3 reader returns duplicate rows if the cluster column is reversed</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-5718</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;To reproduce it,&lt;/p&gt;

&lt;p&gt;cqlsh:test&amp;gt;  select * from wordfreq;&lt;/p&gt;

&lt;p&gt; title   | occurances | word&lt;br/&gt;
--------&lt;del&gt;&lt;ins&gt;&lt;/del&gt;----------&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;------&lt;br/&gt;
 alex123 |          4 |  liu3&lt;br/&gt;
   alex1 |      23456 |  liu2&lt;br/&gt;
  alex10 |         10 | liu10&lt;br/&gt;
  alex12 |         34 |  liu3&lt;br/&gt;
    alex |     123456 |  liu1&lt;br/&gt;
    alex |       1000 |   liu&lt;/p&gt;


&lt;p&gt;CREATE TABLE wordfreq ( title text, word text, occurances int, PRIMARY KEY (title,occurances)) WITH CLUSTERING ORDER by (occurances DESC);&lt;/p&gt;

&lt;p&gt;The hadoop job returns 7 rows instead of 6 rows. &lt;/p&gt;

&lt;p&gt;I will post a patch soon.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12655805">CASSANDRA-5718</key>
            <summary>Cql3 reader returns duplicate rows if the cluster column is reversed</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="alexliu68">Alex Liu</assignee>
                                    <reporter username="alexliu68">Alex Liu</reporter>
                        <labels>
                    </labels>
                <created>Tue, 2 Jul 2013 16:57:05 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:10 +0000</updated>
                            <resolved>Mon, 5 Aug 2013 22:00:56 +0000</resolved>
                                        <fixVersion>1.2.9</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13698179" author="alexliu68" created="Tue, 2 Jul 2013 20:23:50 +0000"  >&lt;p&gt;Patch for 1.2 branch is attached&lt;/p&gt;</comment>
                            <comment id="13705906" author="jbellis" created="Thu, 11 Jul 2013 15:13:28 +0000"  >&lt;p&gt;Looks to me like this doesn&apos;t handle reversed for non-composite cells.&lt;/p&gt;</comment>
                            <comment id="13709123" author="alexliu68" created="Mon, 15 Jul 2013 23:01:02 +0000"  >&lt;p&gt;create a compact table&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; CREATE TABLE wordfreq ( title text, word text, occurances &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, PRIMARY KEY (title,occurances)) 
 WITH COMPACT STORAGE and CLUSTERING ORDER by (occurances DESC);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;show the schema&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  cqlsh:test&amp;gt; select key_aliases, column_aliases, key_validator, comparator from system.schema_columnfamilies where   keyspace_name=&lt;span class=&quot;code-quote&quot;&gt;&apos;test&apos;&lt;/span&gt;;

 key_aliases | column_aliases | key_validator                            | comparator
-------------+----------------+------------------------------------------+-----------------------------------------------------------------------------------------
   [&lt;span class=&quot;code-quote&quot;&gt;&quot;title&quot;&lt;/span&gt;] | [&lt;span class=&quot;code-quote&quot;&gt;&quot;occurances&quot;&lt;/span&gt;] | org.apache.cassandra.db.marshal.UTF8Type | org.apache.cassandra.db.marshal.ReversedType(org.apache.cassandra.db.marshal.Int32Type)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It has the clustering column and reversed type defined for the table in system.schema_columnfamilies table.&lt;/p&gt;

&lt;p&gt;The patch covers the compact storage type tables. Is there any other type of thrift table I am missing? &lt;/p&gt;</comment>
                            <comment id="13722996" author="jbellis" created="Mon, 29 Jul 2013 21:25:41 +0000"  >&lt;p&gt;Right; I&apos;m saying that the only place this sets reversed away from its default of false is here:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;+        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (comparatorValidator &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; CompositeType)
+        {
+            &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; clusterColumns.size(); i++)
+                clusterColumns.get(i).reversed = (((CompositeType) comparatorValidator).types.get(i) &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; ReversedType);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13726678" author="alexliu68" created="Thu, 1 Aug 2013 18:04:54 +0000"  >&lt;p&gt;Oh, I get it. 5718-2-1.2-branch.txt is attached to fix the none-composite reversed type of comparator&lt;/p&gt;</comment>
                            <comment id="13727839" author="alexliu68" created="Fri, 2 Aug 2013 17:28:36 +0000"  >&lt;p&gt;5718-3-1.2-branch.txt is attached as the latest patch.&lt;/p&gt;</comment>
                            <comment id="13730018" author="jbellis" created="Mon, 5 Aug 2013 22:00:56 +0000"  >&lt;p&gt;LGTM, committed&lt;/p&gt;</comment>
                            <comment id="13981882" author="rohitbrai" created="Sat, 26 Apr 2014 04:40:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbellis&quot; class=&quot;user-hover&quot; rel=&quot;jbellis&quot;&gt;jbellis&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=alexliu68&quot; class=&quot;user-hover&quot; rel=&quot;alexliu68&quot;&gt;alexliu68&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;There is a regression in 2.0.x builds of Cassandra and the trunk.&lt;/p&gt;

&lt;p&gt;The changes done for this issue were inadvertently overwritten in a merge from 1.2 to 2.0&lt;br/&gt;
&lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=cassandra.git;a=blobdiff;f=src/java/org/apache/cassandra/hadoop/cql3/CqlPagingRecordReader.java;h=d9b9a39cebe0ec50e5e80c6f8057d4cce0646b6a;hp=b6e793c7e46adf3694c71e365833960c650c8152;hb=3a4d6beb;hpb=8e7d7285cdeac4f2527c933280d595bbddd26935&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=cassandra.git;a=blobdiff;f=src/java/org/apache/cassandra/hadoop/cql3/CqlPagingRecordReader.java;h=d9b9a39cebe0ec50e5e80c6f8057d4cce0646b6a;hp=b6e793c7e46adf3694c71e365833960c650c8152;hb=3a4d6beb;hpb=8e7d7285cdeac4f2527c933280d595bbddd26935&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Should I submit a patch against 2.0 and trunk?&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10020">
                    <name>Cloners</name>
                                                                <inwardlinks description="is cloned by">
                                        <issuelink>
            <issuekey id="12710800">CASSANDRA-7100</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12590500" name="5718-1.2-branch.txt" size="2565" author="alexliu68" created="Tue, 2 Jul 2013 20:23:50 +0000"/>
                            <attachment id="12595459" name="5718-2-1.2-branch.txt" size="2027" author="alexliu68" created="Thu, 1 Aug 2013 18:04:54 +0000"/>
                            <attachment id="12595633" name="5718-3-1.2-branch.txt" size="2808" author="alexliu68" created="Fri, 2 Aug 2013 17:28:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[alexliu68]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>336080</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 30 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1lyz3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>336404</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>