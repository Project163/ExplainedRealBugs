<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:22:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-2867] Starting 0.8.1 after upgrade from 0.7.6-2 fails</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-2867</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;After upgrading the binaries to 0.8.1 I get an exception when starting cassandra:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[root@bserv2 local]#  INFO 12:51:04,512 Logging initialized
 INFO 12:51:04,523 Heap size: 8329887744/8329887744
 INFO 12:51:04,524 JNA not found. Native methods will be disabled.
 INFO 12:51:04,531 Loading settings from file:/usr/local/apache-cassandra-0.8.1/conf/cassandra.yaml
 INFO 12:51:04,621 DiskAccessMode &apos;auto&apos; determined to be mmap, indexAccessMode is mmap
 INFO 12:51:04,707 Global memtable threshold is enabled at 2648MB
 INFO 12:51:04,708 Removing compacted SSTable files (see http://wiki.apache.org/cassandra/MemtableSSTable)
 INFO 12:51:04,713 Removing compacted SSTable files (see http://wiki.apache.org/cassandra/MemtableSSTable)
 INFO 12:51:04,714 Removing compacted SSTable files (see http://wiki.apache.org/cassandra/MemtableSSTable)
 INFO 12:51:04,716 Removing compacted SSTable files (see http://wiki.apache.org/cassandra/MemtableSSTable)
 INFO 12:51:04,717 Removing compacted SSTable files (see http://wiki.apache.org/cassandra/MemtableSSTable)
 INFO 12:51:04,719 Removing compacted SSTable files (see http://wiki.apache.org/cassandra/MemtableSSTable)
 INFO 12:51:04,770 reading saved cache /vm1/cassandraDB/saved_caches/system-IndexInfo-KeyCache
 INFO 12:51:04,776 Opening /vm1/cassandraDB/data/system/IndexInfo-f-9
 INFO 12:51:04,792 reading saved cache /vm1/cassandraDB/saved_caches/system-Schema-KeyCache
 INFO 12:51:04,794 Opening /vm1/cassandraDB/data/system/Schema-f-194
 INFO 12:51:04,797 Opening /vm1/cassandraDB/data/system/Schema-f-195
 INFO 12:51:04,802 Opening /vm1/cassandraDB/data/system/Schema-f-193
 INFO 12:51:04,811 Opening /vm1/cassandraDB/data/system/Migrations-f-193
 INFO 12:51:04,814 reading saved cache /vm1/cassandraDB/saved_caches/system-LocationInfo-KeyCache
 INFO 12:51:04,815 Opening /vm1/cassandraDB/data/system/LocationInfo-f-292
 INFO 12:51:04,843 Loading schema version 586e70fd-a332-11e0-828e-34b74a661156
ERROR 12:51:04,996 Exception encountered during startup.
org.apache.cassandra.db.marshal.MarshalException: A long is exactly 8 bytes: 15
        at org.apache.cassandra.db.marshal.LongType.getString(LongType.java:72)
        at org.apache.cassandra.config.CFMetaData.getDefaultIndexName(CFMetaData.java:971)
        at org.apache.cassandra.config.CFMetaData.inflate(CFMetaData.java:381)
        at org.apache.cassandra.config.KSMetaData.inflate(KSMetaData.java:172)
        at org.apache.cassandra.db.DefsTable.loadFromStorage(DefsTable.java:99)
        at org.apache.cassandra.config.DatabaseDescriptor.loadSchemas(DatabaseDescriptor.java:479)
        at org.apache.cassandra.service.AbstractCassandraDaemon.setup(AbstractCassandraDaemon.java:139)
        at org.apache.cassandra.service.AbstractCassandraDaemon.activate(AbstractCassandraDaemon.java:315)
        at org.apache.cassandra.thrift.CassandraDaemon.main(CassandraDaemon.java:80)
Exception encountered during startup.
org.apache.cassandra.db.marshal.MarshalException: A long is exactly 8 bytes: 15
        at org.apache.cassandra.db.marshal.LongType.getString(LongType.java:72)
        at org.apache.cassandra.config.CFMetaData.getDefaultIndexName(CFMetaData.java:971)
        at org.apache.cassandra.config.CFMetaData.inflate(CFMetaData.java:381)
        at org.apache.cassandra.config.KSMetaData.inflate(KSMetaData.java:172)
        at org.apache.cassandra.db.DefsTable.loadFromStorage(DefsTable.java:99)
        at org.apache.cassandra.config.DatabaseDescriptor.loadSchemas(DatabaseDescriptor.java:479)
        at org.apache.cassandra.service.AbstractCassandraDaemon.setup(AbstractCassandraDaemon.java:139)
        at org.apache.cassandra.service.AbstractCassandraDaemon.activate(AbstractCassandraDaemon.java:315)
        at org.apache.cassandra.thrift.CassandraDaemon.main(CassandraDaemon.java:80)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It seems this has something to do with indexes, and I do have a CF with an index on it, but it is not used.&lt;br/&gt;
I can try and remove the index with 0.7.x binaries, but I will wait a bit to see if anyone needs it to reproduce the bug.&lt;/p&gt;</description>
                <environment>&lt;p&gt;CentOS 5.6&lt;/p&gt;</environment>
        <key id="12513118">CASSANDRA-2867</key>
            <summary>Starting 0.8.1 after upgrade from 0.7.6-2 fails</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="kunda">Yaniv Kunda</reporter>
                        <labels>
                            <label>exception</label>
                            <label>index</label>
                            <label>starting</label>
                    </labels>
                <created>Thu, 7 Jul 2011 10:20:03 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:56 +0000</updated>
                            <resolved>Tue, 2 Aug 2011 16:05:46 +0000</resolved>
                                        <fixVersion>0.8.3</fixVersion>
                                        <due></due>
                            <votes>3</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13070044" author="andrden" created="Sat, 23 Jul 2011 20:18:48 +0000"  >&lt;p&gt;upgrade from 0.8 to 0.8.1 &lt;br/&gt;
(update: tried daily trunc build apache-cassandra-2011-07-20_16-02-23 with the same effect)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;just put new libararies and started cassandra (CentOS 5.6 64bit)&lt;br/&gt;
We are not using any CF indexes (only counters if that matters), &lt;br/&gt;
but it won&apos;t start, so I don&apos;t see a way to upgrade to 0.8.1:&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; INFO [main] 2011-07-23 19:32:23,446 SSTableReader.java (line 158) Opening /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/lib/cassandra/data/system/NodeIdInfo-g-1
 INFO [main] 2011-07-23 19:32:23,516 SSTableReader.java (line 158) Opening /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/lib/cassandra/data/system/Schema-g-74
 INFO [main] 2011-07-23 19:32:23,529 SSTableReader.java (line 158) Opening /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/lib/cassandra/data/system/Schema-g-73
 INFO [main] 2011-07-23 19:32:23,548 SSTableReader.java (line 158) Opening /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/lib/cassandra/data/system/Migrations-g-73
 INFO [main] 2011-07-23 19:32:23,561 SSTableReader.java (line 158) Opening /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/lib/cassandra/data/system/Migrations-g-74
 INFO [main] 2011-07-23 19:32:23,570 SSTableReader.java (line 158) Opening /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/lib/cassandra/data/system/LocationInfo-g-46
 INFO [main] 2011-07-23 19:32:23,587 SSTableReader.java (line 158) Opening /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/lib/cassandra/data/system/LocationInfo-g-45
 INFO [main] 2011-07-23 19:32:23,597 SSTableReader.java (line 158) Opening /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/lib/cassandra/data/system/HintsColumnFamily-g-1
 INFO [main] 2011-07-23 19:32:23,656 DatabaseDescriptor.java (line 478) Loading schema version 1e26a500-b538-11e0-0000-f03fd2ec87ff
ERROR [main] 2011-07-23 19:32:23,889 AbstractCassandraDaemon.java (line 332) Exception encountered during startup.
org.apache.cassandra.db.marshal.MarshalException: A &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; is exactly 8 bytes: 4
        at org.apache.cassandra.db.marshal.LongType.getString(LongType.java:72)
        at org.apache.cassandra.config.CFMetaData.getDefaultIndexName(CFMetaData.java:971)
        at org.apache.cassandra.config.CFMetaData.inflate(CFMetaData.java:381)
        at org.apache.cassandra.config.KSMetaData.inflate(KSMetaData.java:172)
        at org.apache.cassandra.db.DefsTable.loadFromStorage(DefsTable.java:99)
        at org.apache.cassandra.config.DatabaseDescriptor.loadSchemas(DatabaseDescriptor.java:479)
        at org.apache.cassandra.service.AbstractCassandraDaemon.setup(AbstractCassandraDaemon.java:139)
        at org.apache.cassandra.service.AbstractCassandraDaemon.activate(AbstractCassandraDaemon.java:315)
        at org.apache.cassandra.thrift.CassandraDaemon.main(CassandraDaemon.java:80)
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13070251" author="jbellis" created="Sun, 24 Jul 2011 20:56:09 +0000"  >&lt;p&gt;You have an index name set on at least one CF.  If you don&apos;t actually have an index on it, Cassandra shouldn&apos;t have let you set the index name, but it&apos;s possible an older version was not as rigorous about that.&lt;/p&gt;

&lt;p&gt;If you can&apos;t figure out where the index name is, you can also drop your schema and migrations system CFs and rebuild your schema from scratch.&lt;/p&gt;</comment>
                            <comment id="13071104" author="tarasp" created="Tue, 26 Jul 2011 13:48:55 +0000"  >&lt;p&gt;The patch trunk-2867.txt fixes the MarshalException on startup.&lt;/p&gt;</comment>
                            <comment id="13071122" author="jbellis" created="Tue, 26 Jul 2011 14:35:08 +0000"  >&lt;p&gt;Hmm, you have an index name on a subcolumn?  that&apos;s not supposed to be legal either &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13071641" author="tarasp" created="Wed, 27 Jul 2011 10:29:48 +0000"  >&lt;p&gt;No, just create the following column family and restart the server:&lt;/p&gt;

&lt;p&gt; create column family MailStat&lt;br/&gt;
  with column_type = Super&lt;br/&gt;
    and key_validation_class = UTF8Type&lt;br/&gt;
    and comparator = LongType&lt;br/&gt;
    and subcomparator = AsciiType&lt;br/&gt;
    and column_metadata = [&lt;br/&gt;
        &lt;/p&gt;
{column_name : subj, validation_class : UTF8Type}
&lt;p&gt;,&lt;br/&gt;
        &lt;/p&gt;
{column_name : body, validation_class : UTF8Type}
&lt;p&gt;,&lt;br/&gt;
        &lt;/p&gt;
{column_name : comment, validation_class : UTF8Type}
&lt;p&gt;,&lt;/p&gt;
        {column_name : categ, validation_class : AsciiType}
&lt;p&gt;    ];&lt;/p&gt;</comment>
                            <comment id="13071642" author="tarasp" created="Wed, 27 Jul 2011 10:32:41 +0000"  >&lt;p&gt;This problem is not related to migration, just 0.8.1 - 0.8.2 cannot start when there is a super column family with different comparators for supercolumns and metadata.&lt;/p&gt;</comment>
                            <comment id="13072242" author="redpriest" created="Thu, 28 Jul 2011 08:06:49 +0000"  >&lt;p&gt;Thanks Taras for commenting on the issue, I just ran into the same problem with a super column family with a TimeUUIDType comparator, and UTF8Type subcomparators; I can insert, get data all day long from the cluster while it is running fresh. But the moment I restart the cassandra node, I get the exception saying that TimeUUIDTypes must be exactly 16 bytes.&lt;/p&gt;

&lt;p&gt;Edit: Just verified your fix and it fixes my case as well.&lt;/p&gt;</comment>
                            <comment id="13073318" author="jbellis" created="Sun, 31 Jul 2011 04:15:22 +0000"  >&lt;p&gt;Thanks, I see the problem now &amp;#8211; it was generating an index name even if there was no index present on the column (which is always the case for supercolumns).&lt;/p&gt;

&lt;p&gt;Alternate patch attached to fix this.&lt;/p&gt;</comment>
                            <comment id="13076265" author="slebresne" created="Tue, 2 Aug 2011 15:27:43 +0000"  >&lt;p&gt;The attached patch has a lot of unrelated changes I believe, but considering the fix is the one line change in CFMetadata, then +1.&lt;/p&gt;</comment>
                            <comment id="13076289" author="jbellis" created="Tue, 2 Aug 2011 16:05:46 +0000"  >&lt;p&gt;committed, minus the extra stuff from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2894&quot; title=&quot;add paging to get_count&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2894&quot;&gt;&lt;del&gt;CASSANDRA-2894&lt;/del&gt;&lt;/a&gt; that was in the diff&lt;/p&gt;</comment>
                            <comment id="13076299" author="hudson" created="Tue, 2 Aug 2011 16:36:05 +0000"  >&lt;p&gt;Integrated in Cassandra-0.8 #252 (See &lt;a href=&quot;https://builds.apache.org/job/Cassandra-0.8/252/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Cassandra-0.8/252/&lt;/a&gt;)&lt;br/&gt;
    avoid trying to create index names, when no index exists&lt;br/&gt;
patch by jbellis; reviewed by slebresne for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2867&quot; title=&quot;Starting 0.8.1 after upgrade from 0.7.6-2 fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2867&quot;&gt;&lt;del&gt;CASSANDRA-2867&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;jbellis : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1153175&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1153175&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/config/CFMetaData.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12488340" name="2867-v2.txt" size="4151" author="jbellis" created="Sun, 31 Jul 2011 04:15:22 +0000"/>
                            <attachment id="12487834" name="trunk-2867.txt" size="734" author="tarasp" created="Tue, 26 Jul 2011 13:48:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20871</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 17 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gdxr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>93688</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>slebresne</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>