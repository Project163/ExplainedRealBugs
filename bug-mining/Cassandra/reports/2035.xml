<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:37:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-5225] Missing columns, errors when requesting specific columns from wide rows</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-5225</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;With Cassandra 1.2.1 (and probably 1.2.0), I&apos;m seeing some problems with Thrift queries that request a set of specific column names when the row is very wide.&lt;/p&gt;

&lt;p&gt;To reproduce, I&apos;m inserting 10 million columns into a single row and then randomly requesting three columns by name in a loop.  It&apos;s common for only one or two of the three columns to be returned.  I&apos;m also seeing stack traces like the following in the Cassandra log:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ERROR 13:12:01,017 Exception in thread Thread[ReadStage:76,5,main]
java.lang.RuntimeException: org.apache.cassandra.io.sstable.CorruptSSTableException: org.apache.cassandra.db.ColumnSerializer$CorruptColumnException: invalid column name length 0 (/var/lib/cassandra/data/Keyspace1/CF1/Keyspace1-CF1-ib-5-Data.db, 14035168 bytes remaining)
	at org.apache.cassandra.service.StorageProxy$DroppableRunnable.run(StorageProxy.java:1576)
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
	at java.lang.Thread.run(Thread.java:662)
Caused by: org.apache.cassandra.io.sstable.CorruptSSTableException: org.apache.cassandra.db.ColumnSerializer$CorruptColumnException: invalid column name length 0 (/var/lib/cassandra/data/Keyspace1/CF1/Keyspace1-CF1-ib-5-Data.db, 14035168 bytes remaining)
	at org.apache.cassandra.db.columniterator.SSTableNamesIterator.&amp;lt;init&amp;gt;(SSTableNamesIterator.java:69)
	at org.apache.cassandra.db.filter.NamesQueryFilter.getSSTableColumnIterator(NamesQueryFilter.java:81)
	at org.apache.cassandra.db.filter.QueryFilter.getSSTableColumnIterator(QueryFilter.java:68)
	at org.apache.cassandra.db.CollationController.collectTimeOrderedData(CollationController.java:133)
	at org.apache.cassandra.db.CollationController.getTopLevelColumns(CollationController.java:65)
	at org.apache.cassandra.db.ColumnFamilyStore.getTopLevelColumns(ColumnFamilyStore.java:1358)
	at org.apache.cassandra.db.ColumnFamilyStore.getColumnFamily(ColumnFamilyStore.java:1215)
	at org.apache.cassandra.db.ColumnFamilyStore.getColumnFamily(ColumnFamilyStore.java:1127)
	at org.apache.cassandra.db.Table.getRow(Table.java:355)
	at org.apache.cassandra.db.SliceByNamesReadCommand.getRow(SliceByNamesReadCommand.java:64)
	at org.apache.cassandra.service.StorageProxy$LocalReadRunnable.runMayThrow(StorageProxy.java:1052)
	at org.apache.cassandra.service.StorageProxy$DroppableRunnable.run(StorageProxy.java:1572)
	... 3 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This doesn&apos;t seem to happen when the row is smaller, so it might have something to do with incremental large row compaction.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12631118">CASSANDRA-5225</key>
            <summary>Missing columns, errors when requesting specific columns from wide rows</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10000" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Urgent</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="thobbs">Tom Hobbs</reporter>
                        <labels>
                    </labels>
                <created>Wed, 6 Feb 2013 19:19:43 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:18 +0000</updated>
                            <resolved>Wed, 13 Feb 2013 08:21:28 +0000</resolved>
                                        <fixVersion>1.2.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                                                                <comments>
                            <comment id="13572699" author="thobbs" created="Wed, 6 Feb 2013 19:20:13 +0000"  >&lt;p&gt;Attached python script reproduces the issue with pycassa.&lt;/p&gt;</comment>
                            <comment id="13572972" author="brandon.williams" created="Wed, 6 Feb 2013 23:00:29 +0000"  >&lt;p&gt;Bisect says the winner is &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3885&quot; title=&quot;Support multiple ranges in SliceQueryFilter&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3885&quot;&gt;&lt;del&gt;CASSANDRA-3885&lt;/del&gt;&lt;/a&gt;, but I never encountered the corrupt sstable exception.&lt;/p&gt;</comment>
                            <comment id="13573682" author="yukim" created="Thu, 7 Feb 2013 17:24:21 +0000"  >&lt;p&gt;It looks like cassandra is reading from wrong column index here(&lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-1.2/src/java/org/apache/cassandra/db/columniterator/SSTableNamesIterator.java#L236&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/cassandra-1.2/src/java/org/apache/cassandra/db/columniterator/SSTableNamesIterator.java#L236&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;Suppose we have col indexes of [&lt;span class=&quot;error&quot;&gt;&amp;#91;1..5&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;6..10&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;11..15&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;16..20&amp;#93;&lt;/span&gt;](numbers are column names), and we want to &apos;SELECT 2, 18 FROM CF&apos;;&lt;br/&gt;
First, we check &apos;2&apos; against indexes and get indexes&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;. Next, we check &apos;18&apos; against indexes with lastIndexIdx of 0.&lt;br/&gt;
Now, because we are limiting the second index check to the sublist of indexes&lt;span class=&quot;error&quot;&gt;&amp;#91;0, lastIndexIdx + 1&amp;#93;&lt;/span&gt; here(&lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-1.2/src/java/org/apache/cassandra/io/sstable/IndexHelper.java#L186&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/cassandra-1.2/src/java/org/apache/cassandra/io/sstable/IndexHelper.java#L186&lt;/a&gt;), it only checks against only first two indexes and gets wrong index position of indexes&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt;. So it thinks &apos;20&apos; is not in the sstable.&lt;/p&gt;

&lt;p&gt;In fact, if I removed sublisting part from IndexHelper.indexFor, SSTableNamesIterator started returning collect values. But I don&apos;t know that&apos;s the right way to do. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="13573712" author="slebresne" created="Thu, 7 Feb 2013 17:54:56 +0000"  >&lt;p&gt;With just eyeballing the code, I would say that the line at &lt;a href=&quot;https://github.com/apache/cassandra/blob/cassandra-1.2/src/java/org/apache/cassandra/io/sstable/IndexHelper.java#L179&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/cassandra-1.2/src/java/org/apache/cassandra/io/sstable/IndexHelper.java#L179&lt;/a&gt; should be:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;if (!reversed)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;i.e. both branch should be inverted. The goal of the lastIndex parameter is to ignore index block we know are &quot;behind&quot; us. So when we go forward (not reversed) you&apos;d want to look at &lt;span class=&quot;error&quot;&gt;&amp;#91;lastIndex, index.size()&amp;#93;&lt;/span&gt;, not the contrary.&lt;/p&gt;</comment>
                            <comment id="13573782" author="slebresne" created="Thu, 7 Feb 2013 18:59:36 +0000"  >&lt;p&gt;So attaching patch for this. Interestingly enough, the IndexHelperTest were broken too (which kind of make it obvious this was doing the wrong thing).&lt;/p&gt;

&lt;p&gt;I haven&apos;t tried the pycassa repro script to validate this fixes thing though.&lt;/p&gt;</comment>
                            <comment id="13573789" author="brandon.williams" created="Thu, 7 Feb 2013 19:05:56 +0000"  >&lt;p&gt;It still doesn&apos;t pass &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13574340" author="slebresne" created="Fri, 8 Feb 2013 09:12:22 +0000"  >&lt;p&gt;Are you sure you applied the patch correctly? I just tested the pycassa-repro.py test above and it fails every time without the patch but haven&apos;t failed once with the patch.&lt;/p&gt;</comment>
                            <comment id="13574358" author="mukundneharkar" created="Fri, 8 Feb 2013 09:56:54 +0000"  >&lt;p&gt;Yes..The patch works with my test code too..&lt;/p&gt;</comment>
                            <comment id="13574728" author="brandon.williams" created="Fri, 8 Feb 2013 18:59:27 +0000"  >&lt;p&gt;I applied the patch correctly, but the bug is in the pycassa script itself... I was hitting an edge case where it asked for the same column twice.&lt;/p&gt;</comment>
                            <comment id="13576905" author="eldenbishop" created="Tue, 12 Feb 2013 19:17:51 +0000"  >&lt;p&gt;This patch also fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5210&quot; title=&quot;DB is randomly and undetectably corrupted during high traffic column family flushes &quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5210&quot;&gt;&lt;del&gt;CASSANDRA-5210&lt;/del&gt;&lt;/a&gt;. I&apos;ll mark that one as a dupe.&lt;/p&gt;</comment>
                            <comment id="13577309" author="brandon.williams" created="Wed, 13 Feb 2013 03:22:53 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13577404" author="slebresne" created="Wed, 13 Feb 2013 08:21:28 +0000"  >&lt;p&gt;Committed, thanks.&lt;/p&gt;</comment>
                            <comment id="13596204" author="abashir" created="Thu, 7 Mar 2013 19:09:29 +0000"  >&lt;p&gt;This affects 1.1.x as well; will the fix be a part of 1.1.11?&lt;/p&gt;</comment>
                            <comment id="13596390" author="jbellis" created="Thu, 7 Mar 2013 21:23:53 +0000"  >&lt;p&gt;If you have a test case that fails against 1.1, please post it.&lt;/p&gt;</comment>
                            <comment id="13597675" author="abashir" created="Fri, 8 Mar 2013 23:10:10 +0000"  >&lt;p&gt;The reporter for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5210&quot; title=&quot;DB is randomly and undetectably corrupted during high traffic column family flushes &quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5210&quot;&gt;&lt;del&gt;CASSANDRA-5210&lt;/del&gt;&lt;/a&gt; (marked as a dupe of this) tested as far back as 0.8&lt;/p&gt;</comment>
                            <comment id="13597683" author="jbellis" created="Fri, 8 Mar 2013 23:17:40 +0000"  >&lt;p&gt;Nevertheless, the bug fixed here was a regression introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3885&quot; title=&quot;Support multiple ranges in SliceQueryFilter&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3885&quot;&gt;&lt;del&gt;CASSANDRA-3885&lt;/del&gt;&lt;/a&gt; for 1.2.0.&lt;/p&gt;</comment>
                            <comment id="13687111" author="dmeyer" created="Tue, 18 Jun 2013 19:41:51 +0000"  >&lt;p&gt;Added a dtest to cover this scenario:&lt;br/&gt;
&lt;a href=&quot;https://github.com/riptano/cassandra-dtest/blob/75bffeba0af410a41eb97b269ae1c94f4227c312/wide_rows_test.py&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/riptano/cassandra-dtest/blob/75bffeba0af410a41eb97b269ae1c94f4227c312/wide_rows_test.py&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13687334" author="dmeyer" created="Tue, 18 Jun 2013 22:58:17 +0000"  >&lt;p&gt;Fixed a small bug in the repro script.  Please use the &apos;corrected&apos; version.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12630217">CASSANDRA-5210</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12568441" name="5225.txt" size="3343" author="slebresne" created="Thu, 7 Feb 2013 18:59:36 +0000"/>
                            <attachment id="12588474" name="corrected-pycassa-repro.py" size="1156" author="dmeyer" created="Tue, 18 Jun 2013 22:58:17 +0000"/>
                            <attachment id="12568275" name="pycassa-repro.py" size="1112" author="thobbs" created="Wed, 6 Feb 2013 19:20:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>311614</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 22 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1hrzb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>311960</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>brandon.williams</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311124" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Tester</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>dmeyer</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>