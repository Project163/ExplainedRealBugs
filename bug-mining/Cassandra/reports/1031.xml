<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:22:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-2662] Nodes get ignored by dynamic snitch when read repair chance is zero</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-2662</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;DynamicEndpointSnitch falls back to subsnitch when one of the scores of the endpoints being compared is missing.&lt;/p&gt;

&lt;p&gt;This leads to a stable order of hosts until reads will lead to recorded scores. &lt;br/&gt;
If setting read repair chance to 0 and reads are performed with quorum then (rf - # quorum nodes) will never get reads.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12507590">CASSANDRA-2662</key>
            <summary>Nodes get ignored by dynamic snitch when read repair chance is zero</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="brandon.williams">Brandon Williams</assignee>
                                    <reporter username="doubleday">Daniel Doubleday</reporter>
                        <labels>
                    </labels>
                <created>Wed, 18 May 2011 10:55:32 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:59 +0000</updated>
                            <resolved>Thu, 28 Jul 2011 23:43:24 +0000</resolved>
                                        <fixVersion>0.7.9</fixVersion>
                    <fixVersion>0.8.5</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13035286" author="doubleday" created="Wed, 18 May 2011 10:58:27 +0000"  >&lt;p&gt;One very simple fix is to initialize scores with 0 which forces at least one read. &lt;/p&gt;

&lt;p&gt;Dunno if thats a good idea when using multi dc snitches ...&lt;/p&gt;</comment>
                            <comment id="13035431" author="brandon.williams" created="Wed, 18 May 2011 15:20:13 +0000"  >&lt;p&gt;To clarify what this patch does: on the first round, behavior is unchanged, it will fall back to the subsnitch as usual.  On the second round however, the nodes will have scores so the dynamic snitch will determine the best host.  This seems like a good idea, but I think we should proceed cautiously with regard to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1314&quot; title=&quot;snitch that prefers a single replica for all reads to a given key&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1314&quot;&gt;&lt;del&gt;CASSANDRA-1314&lt;/del&gt;&lt;/a&gt;.  This is certainly going to blow the cache on the second round, since the unpinned hosts at zero are guaranteed to be ranked higher than the pinned one.  However, in the current implementation, the badness threshold in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1519&quot; title=&quot;Add threshold to dynamic snitch&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1519&quot;&gt;&lt;del&gt;CASSANDRA-1519&lt;/del&gt;&lt;/a&gt; can never take effect at RR = 0 since the scores of the other replicas will always be null, and thus diversion to the subsnitch will always occur, returning the pinned replica.  With this patch, the second replica is likely to end up being the pinned one, which I think will be ok, as long as all coordinators agree, though this might not always be the case.&lt;/p&gt;</comment>
                            <comment id="13035597" author="brandon.williams" created="Wed, 18 May 2011 19:18:45 +0000"  >&lt;p&gt;Thinking this through a bit more:&lt;/p&gt;

&lt;p&gt;Given coordinator A, and replicas X, Y, and Z (in subsnitch order), on the first round X will be chosen, and let&apos;s say it receives a score of 1.  With the patch, at this point Y and Z will be initialized with zero.  On the next round, Y will be chosen, and let&apos;s say it receives a score of or near 1, depending on network latency.  On the third round, Z will be chosen, and let&apos;s say it also receives a score similar to Y.  Now the cache is hot on all nodes, and subsequent reads have the possibility to oscillate between all three based on network latency variance.  This can be mitigated though with the badness threshold.  With the badness threshold on, the first round will occur as before, but subsequent rounds will continue to use X until it degrades past the threshold, at which point they will use Y, until the dynamic snitch reset()s, at which point everything will repeat.  I don&apos;t think this is harmful to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1314&quot; title=&quot;snitch that prefers a single replica for all reads to a given key&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1314&quot;&gt;&lt;del&gt;CASSANDRA-1314&lt;/del&gt;&lt;/a&gt; after all.&lt;/p&gt;
</comment>
                            <comment id="13035618" author="brandon.williams" created="Wed, 18 May 2011 19:47:31 +0000"  >&lt;p&gt;There is one problem with this patch, rather that initializing the score to zero, it needs to create an empty AdaptiveLatencyTracker for them before checking the scores, otherwise DES.reset() will never have an effect on those hosts.&lt;/p&gt;</comment>
                            <comment id="13041717" author="brandon.williams" created="Tue, 31 May 2011 18:05:58 +0000"  >&lt;p&gt;Updated patch ensures ALTs are created for the hosts by using receiveTiming&lt;/p&gt;</comment>
                            <comment id="13072583" author="thepaul" created="Thu, 28 Jul 2011 22:56:01 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13072602" author="brandon.williams" created="Thu, 28 Jul 2011 23:43:24 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                            <comment id="13072619" author="hudson" created="Fri, 29 Jul 2011 00:24:43 +0000"  >&lt;p&gt;Integrated in Cassandra-0.7 #537 (See &lt;a href=&quot;https://builds.apache.org/job/Cassandra-0.7/537/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Cassandra-0.7/537/&lt;/a&gt;)&lt;br/&gt;
    DES shouldn&apos;t ignore nodes when the read repair chance is zero.&lt;br/&gt;
Patch by brandonwilliams reviewed by Paul Cannon for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-2662&quot; title=&quot;Nodes get ignored by dynamic snitch when read repair chance is zero&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-2662&quot;&gt;&lt;del&gt;CASSANDRA-2662&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;brandonwilliams : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1152038&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1152038&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/cassandra/branches/cassandra-0.7/src/java/org/apache/cassandra/locator/DynamicEndpointSnitch.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13088045" author="jbellis" created="Fri, 19 Aug 2011 22:50:14 +0000"  >&lt;p&gt;(This didn&apos;t get merged to 0.8 until just now.)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12480974" name="2662.txt" size="1186" author="brandon.williams" created="Tue, 31 May 2011 18:05:58 +0000"/>
                            <attachment id="12479566" name="dynsnitch.patch" size="821" author="doubleday" created="Wed, 18 May 2011 10:58:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20759</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 14 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gcpj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>93489</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>thepaul</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thepaul]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>