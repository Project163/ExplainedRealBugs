<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:58:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-8220] JDK bug prevents clean shutdown on OSX with Java 1.8.0_20</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-8220</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Clean shutdown on OSX with Java 1.8.0_20 does not work due to &lt;a href=&quot;https://bugs.openjdk.java.net/browse/JDK-8050499&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;JDK bug 8050499 fixed for Java 9&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Supplied patch provides a (very dirty) workaround to (hopefully) allow shutdown.&lt;/p&gt;

&lt;p&gt;Exception during shutdown looks like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR 22:23:15 Fatal exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[StorageServiceShutdownHook,5,main]
java.io.IOError: java.io.IOException: Unknown error: 316
	at org.apache.cassandra.net.MessagingService.shutdown(MessagingService.java:721) ~[trunk/na]
	at org.apache.cassandra.service.StorageService$1.runMayThrow(StorageService.java:553) ~[trunk/na]
	at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:28) ~[trunk/na]
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) ~[na:1.8.0_20]
Caused by: java.io.IOException: Unknown error: 316
	at sun.nio.ch.NativeThread.signal(Native Method) ~[na:1.8.0_20]
	at sun.nio.ch.ServerSocketChannelImpl.implCloseSelectableChannel(ServerSocketChannelImpl.java:283) ~[na:1.8.0_20]
	at java.nio.channels.spi.AbstractSelectableChannel.implCloseChannel(AbstractSelectableChannel.java:234) ~[na:1.8.0_20]
	at java.nio.channels.spi.AbstractInterruptibleChannel.close(AbstractInterruptibleChannel.java:115) ~[na:1.8.0_20]
	at sun.nio.ch.ServerSocketAdaptor.close(ServerSocketAdaptor.java:137) ~[na:1.8.0_20]
	at org.apache.cassandra.net.MessagingService$SocketThread.close(MessagingService.java:958) ~[trunk/na]
	at org.apache.cassandra.net.MessagingService.shutdown(MessagingService.java:717) ~[trunk/na]
	... 3 common frames omitted
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12751540">CASSANDRA-8220</key>
            <summary>JDK bug prevents clean shutdown on OSX with Java 1.8.0_20</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="snazy">Robert Stupp</assignee>
                                    <reporter username="snazy">Robert Stupp</reporter>
                        <labels>
                    </labels>
                <created>Wed, 29 Oct 2014 22:25:06 +0000</created>
                <updated>Fri, 17 Apr 2020 05:49:25 +0000</updated>
                            <resolved>Sat, 18 Jul 2015 12:32:53 +0000</resolved>
                                        <fixVersion>2.2.1</fixVersion>
                    <fixVersion>3.0 alpha 1</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="14191770" author="snazy" created="Fri, 31 Oct 2014 13:00:07 +0000"  >&lt;p&gt;Short update: backport of JDK-8050499 for Java8 is this ticket &lt;a href=&quot;https://bugs.openjdk.java.net/browse/JDK-8051771&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://bugs.openjdk.java.net/browse/JDK-8051771&lt;/a&gt; - an initial patch exists (but is not yet in)&lt;/p&gt;

&lt;p&gt;We should check for Java8 versions less than 1.8.0_40/60/whatever in the start script or add some &quot;not recommended Java version check&quot; in CassandraDaemon to ensure such bugs don&apos;t occur in production.&lt;/p&gt;</comment>
                            <comment id="14200055" author="festerwim" created="Thu, 6 Nov 2014 10:26:47 +0000"  >&lt;p&gt;I am running into the same issue. Due to this my unit tests (using Cassandra-Unit) are no longer running properly.&lt;/p&gt;</comment>
                            <comment id="14204095" author="snazy" created="Sun, 9 Nov 2014 20:22:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=festerwim&quot; class=&quot;user-hover&quot; rel=&quot;festerwim&quot;&gt;festerwim&lt;/a&gt; it forces even C* own unit tests to fail. Unfortunately there&apos;s no valid (non-dirty) solution for this yet - except downgrading the JDK to sth before 8u20.&lt;/p&gt;</comment>
                            <comment id="14337425" author="urthilak" created="Wed, 25 Feb 2015 23:11:37 +0000"  >&lt;p&gt;Hi team, is there a fix for this available yet?&lt;/p&gt;</comment>
                            <comment id="14346976" author="snazy" created="Wed, 4 Mar 2015 14:51:28 +0000"  >&lt;p&gt;Although the JDK patch for the &lt;a href=&quot;https://bugs.openjdk.java.net/browse/JDK-8051771&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Java8 backport&lt;/a&gt; seems available and targeted for 8u40, it is unfortunately not included in 8u40.&lt;/p&gt;</comment>
                            <comment id="14346980" author="snazy" created="Wed, 4 Mar 2015 14:53:11 +0000"  >&lt;p&gt;This is not a C* issue - it&apos;s a Java bug - so there&apos;s nothing the C* team can do to fix it.&lt;br/&gt;
It&apos;s basically caused by changes introduced in Java 1.4 and not fixed yet.&lt;/p&gt;</comment>
                            <comment id="14614237" author="snazy" created="Sun, 5 Jul 2015 12:52:27 +0000"  >&lt;p&gt;Since C* 3.0 is in sight, trunk already requires Java8 but we&apos;re still facing &lt;tt&gt;Unknown error: 316&lt;/tt&gt; in unit tests, I propose &lt;a href=&quot;https://github.com/snazy/cassandra/tree/8220-java8-316&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;the dirty hack in this branch&lt;/a&gt; to make it into trunk. Cassci links: &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/snazy/job/snazy-8220-java8-316-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtests&lt;/a&gt; &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/snazy/job/snazy-8220-java8-316-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14632352" author="iamaleksey" created="Sat, 18 Jul 2015 09:46:24 +0000"  >&lt;p&gt;+1 (but guard it with &amp;amp;&amp;amp; os==osx, as you&apos;ve suggested offline.&lt;/p&gt;</comment>
                            <comment id="14632416" author="snazy" created="Sat, 18 Jul 2015 12:32:53 +0000"  >&lt;p&gt;Committed with &quot;if (os==OSX)&quot; fix as 506068b181075281f160fde5fd7ffecf45177b2d for 2.2.1 + 3.0beta1&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13276848">SPARK-30385</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12678029" name="jdk8050499.txt" size="943" author="snazy" created="Wed, 29 Oct 2014 22:25:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[snazy]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 18 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i21qvb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>aleksey</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[aleksey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>