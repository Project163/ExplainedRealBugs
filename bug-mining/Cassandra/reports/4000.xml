<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:59:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-8805] runWithCompactionsDisabled only cancels compactions, which is not the only source of markCompacted</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-8805</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Operations like repair that may operate over all sstables cancel compactions before beginning, and fail if there are any files marked compacting after doing so. Redistribution of index summaries is not a compaction, so is not cancelled by this action, but does mark sstables as compacting, so such an action will fail to initiate if there is an index summary redistribution in progress. It seems that IndexSummaryManager needs to register itself as interruptible along with compactions (AFAICT no other actions that may markCompacting are not themselves compactions).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12774977">CASSANDRA-8805</key>
            <summary>runWithCompactionsDisabled only cancels compactions, which is not the only source of markCompacted</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="carlyeks">Carl Yeksigian</assignee>
                                    <reporter username="benedict">Benedict Elliott Smith</reporter>
                        <labels>
                    </labels>
                <created>Fri, 13 Feb 2015 18:12:44 +0000</created>
                <updated>Wed, 15 Oct 2025 09:49:00 +0000</updated>
                            <resolved>Fri, 11 Dec 2015 16:45:50 +0000</resolved>
                                        <fixVersion>2.1.13</fixVersion>
                    <fixVersion>2.2.5</fixVersion>
                    <fixVersion>3.0.3</fixVersion>
                    <fixVersion>3.2</fixVersion>
                                    <component>Local/Compaction</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14322704" author="benedict" created="Mon, 16 Feb 2015 12:23:27 +0000"  >&lt;p&gt;/cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thobbs&quot; class=&quot;user-hover&quot; rel=&quot;thobbs&quot;&gt;thobbs&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14326263" author="thobbs" created="Wed, 18 Feb 2015 17:56:07 +0000"  >&lt;p&gt;Are the changes to make IndexSummaryManager interruptible all that&apos;s needed here?&lt;/p&gt;</comment>
                            <comment id="14326284" author="benedict" created="Wed, 18 Feb 2015 18:07:14 +0000"  >&lt;p&gt;Pretty much. I think the best thing to do is create a new &quot;OperationType&quot; and register a CompactionInfo.Holder for it, so that it plugs into the existing framework&lt;/p&gt;</comment>
                            <comment id="14326378" author="benedict" created="Wed, 18 Feb 2015 18:55:52 +0000"  >&lt;p&gt;Not sure how I keep accidentally changing assignee to myself. Must be some keyboard shortcut...&lt;/p&gt;</comment>
                            <comment id="14526744" author="carlyeks" created="Mon, 4 May 2015 15:23:21 +0000"  >&lt;p&gt;Registering the index summary redistribution with the compaction manager and checking isStopRequested. Added a test to make sure that the CompactionInterruptedException was thrown.&lt;/p&gt;</comment>
                            <comment id="14555778" author="benedict" created="Fri, 22 May 2015 07:46:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=carlyeks&quot; class=&quot;user-hover&quot; rel=&quot;carlyeks&quot;&gt;carlyeks&lt;/a&gt;: The general approach looks good, but could I get a proper (rebased) branch up? If you could get things into a &quot;ready to commit&quot; state with CHANGES.txt wired up as well, that would be appreciated.&lt;/p&gt;

&lt;p&gt;I would like to move away from dealing with patch files, as it isn&apos;t conducive to the new commit process.&lt;/p&gt;

</comment>
                            <comment id="14567402" author="carlyeks" created="Mon, 1 Jun 2015 15:07:03 +0000"  >&lt;p&gt;I pushed up an &lt;a href=&quot;https://github.com/carlyeks/cassandra/tree/ticket/8805&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;update&lt;/a&gt;, but there is an issue with the tests timing out when the cancel test is run before the compaction race test (&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/carlyeks/job/carlyeks-ticket-8805-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/Dev/view/carlyeks/job/carlyeks-ticket-8805-testall/&lt;/a&gt;).&lt;/p&gt;</comment>
                            <comment id="14569384" author="benedict" created="Tue, 2 Jun 2015 16:40:25 +0000"  >&lt;p&gt;The rollback logic in the event of CIE is, unfortunately, likely to break things. Once a reader replaces another, it needs to be published or itself replaced. So we should either make visible the newly sampled readers (excluding the ones we haven&apos;t completed), or we should construct a new instance with the old summaries that are publised.&lt;/p&gt;

&lt;p&gt;Since the operation can also be very expensive, we should probably extract the resampling into a method that can itself check for the &lt;tt&gt;isStopRequested&lt;/tt&gt;, otherwise it could take a long time to acquiesce.&lt;/p&gt;</comment>
                            <comment id="14738939" author="carlyeks" created="Thu, 10 Sep 2015 15:38:58 +0000"  >&lt;p&gt;Cleaned this up and rebased. It replaces all of the sstables that it has already reindexed on a CompactionInterruptedException.&lt;br/&gt;
&lt;a href=&quot;https://github.com/carlyeks/cassandra/tree/ticket/8805&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/carlyeks/job/carlyeks-ticket-8805-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CI utest&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/carlyeks/job/carlyeks-ticket-8805-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CI dtest&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14742717" author="benedict" created="Sun, 13 Sep 2015 23:13:16 +0000"  >&lt;p&gt;Thanks. I&apos;ve pushed a version &lt;a href=&quot;https://github.com/belliottsmith/cassandra/tree/8805&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;, which just cleans up ever so slightly.&lt;/p&gt;

&lt;p&gt;As a note for the future, it&apos;s very helpful for review to avoid squashing until after we&apos;re ready to commit (or we reach some mutually agreed way point)&lt;/p&gt;</comment>
                            <comment id="14743872" author="carlyeks" created="Mon, 14 Sep 2015 17:29:50 +0000"  >&lt;p&gt;I think you need to add the &lt;tt&gt;newSSTables.add&lt;/tt&gt; back to the finally clause. Otherwise, changes look good.&lt;/p&gt;</comment>
                            <comment id="14743881" author="benedict" created="Mon, 14 Sep 2015 17:35:10 +0000"  >&lt;p&gt;There wasn&apos;t a finally clause before, and it&apos;s currently being executed in all normal executions (whereas under failure it is discarded anyway), so I must admit I&apos;m not certain what you&apos;re reasoning is. If you could elaborate I&apos;d appreciate it.&lt;/p&gt;</comment>
                            <comment id="14743887" author="carlyeks" created="Mon, 14 Sep 2015 17:37:56 +0000"  >&lt;p&gt;Sorry, I missed that you had moved it up &amp;#8211; looks good.&lt;/p&gt;</comment>
                            <comment id="14743949" author="benedict" created="Mon, 14 Sep 2015 18:12:21 +0000"  >&lt;p&gt;OK, great. Could you post upstream branch merges?&lt;/p&gt;</comment>
                            <comment id="15004473" author="carlyeks" created="Fri, 13 Nov 2015 18:40:25 +0000"  >&lt;p&gt;I&apos;ve pushed a rebased and squashed version, and merged it forward to trunk:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; 2.1 &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; 2.2 &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; 3.0 &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; trunk &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/carlyeks/cassandra/tree/ticket/8805/2.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/carlyeks/cassandra/tree/ticket/8805/2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/carlyeks/cassandra/tree/ticket/8805/3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/carlyeks/cassandra/tree/ticket/8805/trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/carlyeks/job/carlyeks-ticket-8805-2.1-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utest&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/carlyeks/job/carlyeks-ticket-8805-2.2-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utest&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/carlyeks/job/carlyeks-ticket-8805-3.0-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utest&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/carlyeks/job/carlyeks-ticket-8805-trunk-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utest&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/carlyeks/job/carlyeks-ticket-8805-2.1-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/carlyeks/job/carlyeks-ticket-8805-2.2-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/carlyeks/job/carlyeks-ticket-8805-3.0-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/carlyeks/job/carlyeks-ticket-8805-trunk-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

</comment>
                            <comment id="15004507" author="jmckenzie" created="Fri, 13 Nov 2015 18:58:00 +0000"  >&lt;p&gt;Swapped reviewer to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=krummas&quot; class=&quot;user-hover&quot; rel=&quot;krummas&quot;&gt;krummas&lt;/a&gt; for the home-stretch as Benedict&apos;s on vacation.&lt;/p&gt;</comment>
                            <comment id="15006393" author="krummas" created="Mon, 16 Nov 2015 09:31:53 +0000"  >&lt;p&gt;Patch looks good to me, but in the new test, could we verify that the tracker has the correct sstable instances? (ie, just verify that the finally clause in adjustSamplingLevels actually does the right thing). Also perhaps validate the data in StandardLowIndexInterval after compaction cancellation?&lt;/p&gt;</comment>
                            <comment id="15024796" author="carlyeks" created="Tue, 24 Nov 2015 16:38:09 +0000"  >&lt;p&gt;Pushed a commit which checks the sstables and the data. Kicked off new cassci runs.&lt;/p&gt;</comment>
                            <comment id="15026972" author="krummas" created="Wed, 25 Nov 2015 15:55:07 +0000"  >&lt;p&gt;ok, +1&lt;/p&gt;

&lt;p&gt;could you rebase the branches?&lt;/p&gt;</comment>
                            <comment id="15047215" author="carlyeks" created="Tue, 8 Dec 2015 18:34:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=krummas&quot; class=&quot;user-hover&quot; rel=&quot;krummas&quot;&gt;krummas&lt;/a&gt; just pushed rebased branches.&lt;/p&gt;</comment>
                            <comment id="15052996" author="krummas" created="Fri, 11 Dec 2015 16:45:50 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12730191" name="8805-2.1.txt" size="40871" author="carlyeks" created="Mon, 4 May 2015 15:23:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[carlyeks]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 49 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i25m33:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>marcuse</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>