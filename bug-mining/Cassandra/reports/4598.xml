<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:06:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-12794] COPY FROM with NULL=&apos;&apos; fails when inserting empty row in primary key</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-12794</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Using this table:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;CREATE TABLE testtab (  a_id text,  b_id text,  c_id text,  d_id text,  order_id uuid,  acc_id bigint,  bucket bigint,  r_id text,  ts bigint,  PRIMARY KEY ((a_id, b_id, c_id, d_id), order_id));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;insert one row:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;INSERT INTO testtab (a_id, b_id , c_id , d_id , order_id, r_id ) VALUES ( &apos;&apos;, &apos;&apos;, &apos;&apos;, &apos;a1&apos;, 645e7d3c-aef7-4e3c-b834-24b792cf2e55, &apos;r1&apos;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Use COPY to dump the row to temp.csv:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;copy testtab TO &apos;temp.csv&apos;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Which creates this file:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ cat temp.csv 
,,,a1,645e7d3c-aef7-4e3c-b834-24b792cf2e55,,,r1,
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Truncate the testtab table and then use copy from with NULL=&apos;&apos; to insert the row:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;cqlsh:sbkeyspace&amp;gt; COPY testtab FROM &apos;temp.csv&apos; with NULL=&apos;&apos;;
Using 1 child processes

Starting copy of sbkeyspace.testtab with columns [&apos;a_id&apos;, &apos;b_id&apos;, &apos;c_id&apos;, &apos;d_id&apos;, &apos;order_id&apos;, &apos;acc_id&apos;, &apos;bucket&apos;, &apos;r_id&apos;, &apos;ts&apos;].
Failed to import 1 rows: ParseError - Cannot insert null value for primary key column &apos;a_id&apos;. If you want to insert empty strings, consider using the WITH NULL=&amp;lt;marker&amp;gt; option for COPY.,  given up without retries
Failed to process 1 rows; failed rows written to import_sbkeyspace_testtab.err
Processed: 1 rows; Rate:       2 rows/s; Avg. rate:       3 rows/s
1 rows imported from 1 files in 0.398 seconds (0 skipped).
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It shows 1 rows inserted, but the table is empty:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;select * from testtab ;

 a_id | b_id | c_id | d_id | order_id | acc_id | bucket | r_id | ts
------+------+------+------+----------+--------+--------+------+----

(0 rows)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The same error is returned even without the with NULL=&apos;&apos;. Is it actually possible for copy from to insert an empty row into the primary key? The insert command shown above inserts the empty row for the primary key without any problems.&lt;/p&gt;

&lt;p&gt;Is this related to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7792?&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CASSANDRA-7792?&lt;/a&gt;&lt;/p&gt;</description>
                <environment>&lt;p&gt;Tested using C* 2.1.15&lt;/p&gt;</environment>
        <key id="13012685">CASSANDRA-12794</key>
            <summary>COPY FROM with NULL=&apos;&apos; fails when inserting empty row in primary key</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stefania">Stefania Alborghetti</assignee>
                                    <reporter username="sbassi">Sucwinder Bassi</reporter>
                        <labels>
                    </labels>
                <created>Sun, 16 Oct 2016 12:51:44 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:17 +0000</updated>
                            <resolved>Fri, 6 Jan 2017 09:09:29 +0000</resolved>
                                        <fixVersion>3.0.11</fixVersion>
                    <fixVersion>3.10</fixVersion>
                                    <component>Legacy/Tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15580906" author="stefania" created="Mon, 17 Oct 2016 01:42:47 +0000"  >&lt;p&gt;The idea of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7792&quot; title=&quot;Fix cqlsh null handling in COPY FROM&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7792&quot;&gt;&lt;del&gt;CASSANDRA-7792&lt;/del&gt;&lt;/a&gt; is that we set NULL to something other than the empty string, something that is not present in the csv, e.g. &lt;tt&gt;NULL=&apos;&amp;#45;&apos;&lt;/tt&gt;. The problem is that if we do this in this example, then it fails to convert the empty strings of the missing &lt;tt&gt;bigint&lt;/tt&gt; values when passing them to prepared statements. We could bypass this by disabling prepared statements with &lt;tt&gt;PREPAREDSTATEMENTS = False&lt;/tt&gt;, but then it throws another parsing error. The only workaround at the moment is to insert zeros for the missing &lt;tt&gt;bigint&lt;/tt&gt; values, and then it can be imported with something like &lt;tt&gt;NULL=&apos;-&apos;&lt;/tt&gt;. You can also copy only the columns that are present into the csv by specifying the column names in both the export and import commands.&lt;/p&gt;

&lt;p&gt;This specific example with empty strings in composite partition keys of type text, and empty &lt;tt&gt;bigint&lt;/tt&gt; fields is not something that we haven&apos;t tested so far, and we will need to fix it. &lt;/p&gt;</comment>
                            <comment id="15772222" author="stefania" created="Fri, 23 Dec 2016 07:41:35 +0000"  >&lt;p&gt;The fix consists in converting an empty string into a null value in the converters. In my opinion a null value is more appropriate for an empty string, rather than an arbitrary default value, such us a zero for integers for example. &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12471&quot; title=&quot;Allow for some form of &amp;quot;unset&amp;quot; in CQL&amp;#39;s COPY command.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12471&quot;&gt;CASSANDRA-12471&lt;/a&gt; will then allow replacing null with UNSET if preferred.&lt;/p&gt;

&lt;p&gt;It&apos;s also more efficient and simpler if we intercept the exception, rather than check for empty strings in all the converters so this is what I&apos;ve done. &lt;/p&gt;

&lt;p&gt;The example above can then be imported successfully with a NULL marker such as &lt;tt&gt;COPY testtab FROM &apos;temp.csv&apos; WITH NULL=&apos;-&apos;&lt;/tt&gt;, the empty bigints will be inserted as nulls.&lt;/p&gt;

&lt;p&gt;I don&apos;t think this is critical enough for 2.1 or 2.2 so I only prepared the patch for 3.0. It applies cleanly to all branches and I skipped 3.X for CI since it is very similar to 3.11:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.0&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.11&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/tree/12794-cqlsh-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/tree/12794-cqlsh-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/tree/12794-cqlsh&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12794-cqlsh-3.0-cqlsh-tests/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12794-cqlsh-3.11-cqlsh-tests/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-12794-cqlsh-cqlsh-tests/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;The dtest pull request is &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/pull/1415&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15801956" author="thobbs" created="Thu, 5 Jan 2017 17:29:40 +0000"  >&lt;p&gt;I think this is a good solution.  +1 on committing, the patch and tests look good.&lt;/p&gt;</comment>
                            <comment id="15804068" author="stefania" created="Fri, 6 Jan 2017 09:09:30 +0000"  >&lt;p&gt;Thanks for the review. Committed to 3.0 as 65bd45523584302572782c45b352bbd2bbd3c558 and merged upwards.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[stefania]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 45 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i34yd3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12334783">2.1.14</customfieldvalue>
    <customfieldvalue id="12335643">2.1.15</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>thobbs</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thobbs]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>