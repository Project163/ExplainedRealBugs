<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:30:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-4003] cqlsh still failing to handle decode errors in some column names</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-4003</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Columns which are expected to be text, but which are not valid utf8, cause cqlsh to display an error and not show any output:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;cqlsh:ks&amp;gt; CREATE COLUMNFAMILY test (a text PRIMARY KEY) WITH comparator = timestamp;
cqlsh:ks&amp;gt; INSERT INTO test (a, &apos;2012-03-05&apos;) VALUES (&apos;val1&apos;, &apos;val2&apos;);
cqlsh:ks&amp;gt; ASSUME test NAMES ARE text;
cqlsh:ks&amp;gt; select * from test;
&apos;utf8&apos; codec can&apos;t decode byte 0xe1 in position 4: invalid continuation byte
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;the traceback with cqlsh --debug:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Traceback (most recent call last):
  File &quot;bin/cqlsh&quot;, line 581, in onecmd
    self.handle_statement(st)
  File &quot;bin/cqlsh&quot;, line 606, in handle_statement
    return custom_handler(parsed)
  File &quot;bin/cqlsh&quot;, line 663, in do_select
    self.perform_statement_as_tokens(parsed.matched, decoder=decoder)
  File &quot;bin/cqlsh&quot;, line 666, in perform_statement_as_tokens
    return self.perform_statement(cqlhandling.cql_detokenize(tokens), decoder=decoder)
  File &quot;bin/cqlsh&quot;, line 693, in perform_statement
    self.print_result(self.cursor)
  File &quot;bin/cqlsh&quot;, line 728, in print_result
    self.print_static_result(cursor)
  File &quot;bin/cqlsh&quot;, line 742, in print_static_result
    formatted_names = map(self.myformat_colname, colnames)
  File &quot;bin/cqlsh&quot;, line 413, in myformat_colname
    wcwidth.wcswidth(name.decode(self.output_codec.name)))
  File &quot;/usr/local/Cellar/python/2.7.2/lib/python2.7/encodings/utf_8.py&quot;, line 16, in decode
    return codecs.utf_8_decode(input, errors, True)
UnicodeDecodeError: &apos;utf8&apos; codec can&apos;t decode byte 0xe1 in position 4: invalid continuation byte
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12545279">CASSANDRA-4003</key>
            <summary>cqlsh still failing to handle decode errors in some column names</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thepaul">paul cannon</assignee>
                                    <reporter username="thepaul">paul cannon</reporter>
                        <labels>
                            <label>cqlsh</label>
                    </labels>
                <created>Tue, 6 Mar 2012 04:55:03 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:38 +0000</updated>
                            <resolved>Tue, 27 Mar 2012 19:31:44 +0000</resolved>
                                        <fixVersion>1.0.9</fixVersion>
                    <fixVersion>1.1.0</fixVersion>
                                    <component>Legacy/Tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="13223873" author="thepaul" created="Wed, 7 Mar 2012 00:45:19 +0000"  >&lt;p&gt;A fix is pushed to my 4003 github branch, also tagged at &lt;a href=&quot;https://github.com/thepaul/cassandra/tree/pending/4003&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/thepaul/cassandra/tree/pending/4003&lt;/a&gt; .&lt;/p&gt;</comment>
                            <comment id="13224519" author="jbellis" created="Wed, 7 Mar 2012 17:24:35 +0000"  >&lt;p&gt;It looks like the core of the fix is this:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;+    def get_nametype(self, cursor, num):
+        &quot;&quot;&quot;
+        Determine the Cassandra type of a column name from the current row of
+        query results on the given cursor. The column in question is given by
+        its zero-based ordinal number within the row.
+
+        Pretty big hack, but necessary to differentiate some things like ascii
+        vs. blob hex. Probably this should be available from the driver
+        somehow, instead.
+        &quot;&quot;&quot;
+
+        row = cursor.result[cursor.rs_idx - 1]
+        col = row.columns[num]
+        schema = cursor.decoder.schema
+        return schema.name_types.get(col.name, schema.default_name_type)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Can you elaborate as to what&apos;s going on?&lt;/p&gt;</comment>
                            <comment id="13224545" author="thepaul" created="Wed, 7 Mar 2012 17:51:10 +0000"  >&lt;p&gt;Sure. Since the CQL driver deserializes column names before the client software (cqlsh) can see them, and does not expose the Cassandra data type for the column names, it was not always possible to determine from returned column names how they were meant to be interpreted. For example, it was sometimes impossible to tell TimeUUIDType from UUIDType, or any of the various integer or counter types apart, or even BytesType from AsciiType.&lt;/p&gt;

&lt;p&gt;Cqlsh makes an effort to display data in the most meaningful form, and secondarily to visually distinguish data that would otherwise be too ambiguous using colors. So it needs to know the original column name type.&lt;/p&gt;

&lt;p&gt;The CQL driver does not expose that, so this code uses internals to get it. Clearly it would make more sense to expose the info from the driver side, and I plan to do that, but it takes some extra process and testing. This hack is backwards compatible with older CQL driver versions, but possibly not forwards-compat.&lt;/p&gt;

&lt;p&gt;Maybe it would be best to do a runtime check against the driver to see if it supports exposing column types before making this call.&lt;/p&gt;</comment>
                            <comment id="13239583" author="thepaul" created="Tue, 27 Mar 2012 16:05:13 +0000"  >&lt;p&gt;The attached patch (also present in my updated 4003 branch) will check for column name-type support in the CQL driver before using the direct-inspection approach. python-cql version 1.0.10 supports this, but we don&apos;t need to require support for 1.0.10 yet.&lt;/p&gt;</comment>
                            <comment id="13239585" author="thepaul" created="Tue, 27 Mar 2012 16:06:51 +0000"  >&lt;p&gt;Since i linked the previous tag, the new one is at &lt;a href=&quot;https://github.com/thepaul/cassandra/tree/pending/4003-2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/thepaul/cassandra/tree/pending/4003-2&lt;/a&gt; .&lt;/p&gt;</comment>
                            <comment id="13239857" author="brandon.williams" created="Tue, 27 Mar 2012 19:31:44 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                            <comment id="13404999" author="jeromatron" created="Mon, 2 Jul 2012 10:56:05 +0000"  >&lt;p&gt;this should be fixed in python-cql version 1.0.10 and cassandra 1.0.9?  I&apos;m using dse 2.1 which is based on cassandra 1.0.10 and I did apt-show-versions of python cql and it says &quot;python-cql/stable uptodate 1.0.10-1&quot;.  I&apos;m still getting this error:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&apos;ascii&apos; codec can&apos;t decode byte 0xc3 in position 9: ordinal not in range(128)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Is there still the possibility for this to come up?  I&apos;m utilizing a solr_query in the where clause btw, if that makes any difference.&lt;/p&gt;</comment>
                            <comment id="13409904" author="thepaul" created="Mon, 9 Jul 2012 22:06:19 +0000"  >&lt;p&gt;That shouldn&apos;t make a difference. Can you tell me what data is in that cf/column and paste the full output of a minimal &quot;cqlsh --debug&quot; session with that query?&lt;/p&gt;</comment>
                            <comment id="14388547" author="gadelkareem" created="Tue, 31 Mar 2015 13:51:30 +0000"  >&lt;p&gt;I experience this bug while importing a file using SOURCE file&lt;/p&gt;</comment>
                            <comment id="14389474" author="thobbs" created="Tue, 31 Mar 2015 21:47:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gadelkareem&quot; class=&quot;user-hover&quot; rel=&quot;gadelkareem&quot;&gt;gadelkareem&lt;/a&gt; if you&apos;re seeing this problem with Cassandra 2.0 or 2.1, can you open a new ticket with more details and a new stacktrace?&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12707566">CASSANDRA-7018</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12520140" name="4003-2.txt" size="1230" author="thepaul" created="Tue, 27 Mar 2012 16:05:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thepaul]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>230465</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 34 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gqu7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>95778</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>brandon.williams</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>