<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:35:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-4833] get_count with &apos;count&apos; param between 1024 and ~actual column count fails</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-4833</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;If you run get_count() with the &apos;count&apos; param of the SliceRange set to a number between 1024 and (approximately) the actual number of columns in the row, something seems to silently fail internally, resulting in a client side timeout.  Using a &apos;count&apos; param outside of this range (lower or much higher) works just fine.&lt;/p&gt;

&lt;p&gt;This seems to affect all of 1.1 and 1.2.0-beta1, but not 1.0.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12612449">CASSANDRA-4833</key>
            <summary>get_count with &apos;count&apos; param between 1024 and ~actual column count fails</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yukim">Yuki Morishita</assignee>
                                    <reporter username="thobbs">Tom Hobbs</reporter>
                        <labels>
                    </labels>
                <created>Thu, 18 Oct 2012 16:56:28 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:25 +0000</updated>
                            <resolved>Mon, 22 Oct 2012 18:56:00 +0000</resolved>
                                        <fixVersion>1.1.7</fixVersion>
                    <fixVersion>1.2.0 beta 2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13479140" author="thobbs" created="Thu, 18 Oct 2012 16:58:47 +0000"  >&lt;p&gt;Attached script reproduces the issue with pycassa.&lt;/p&gt;</comment>
                            <comment id="13479333" author="yukim" created="Thu, 18 Oct 2012 20:36:24 +0000"  >&lt;p&gt;get_count runs into infinite loop when requesting with count param around a multiple of page size(1024).&lt;br/&gt;
Patch attached with unit test.&lt;/p&gt;</comment>
                            <comment id="13479358" author="thobbs" created="Thu, 18 Oct 2012 21:06:41 +0000"  >&lt;p&gt;I tested out the patch, and although the infinite loop isn&apos;t hit, the resulting count numbers are off.  For example, the repro script has 3050 columns, and when run produces these counts (manually edited for clarity):&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;specified count=1024: 1024 expected, got 1024
specified count=2^31: 3050 expected, got 2047
specified count=4000: 3050 expected, got 2047
specified count=3051: 3050 expected, got 2047
specified count=1025: 1025 expected, got 1024
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13480135" author="yukim" created="Fri, 19 Oct 2012 17:05:13 +0000"  >&lt;p&gt;You are right.&lt;br/&gt;
New version attached. I also modified test to match yours.&lt;/p&gt;

&lt;p&gt;get_count pages when requesting count more than page size (determined by average column size but max at 1024). Paging starts with the last column of previously fetched page, so newly fetched page may contains one overlapped column.&lt;br/&gt;
When page size is 1024, and we have more than 1024 columns in a row, counting with limit of 1025 columns always fails because we fetch 1 (1025 - 1024 page size) column on 2nd page and it contains only already fetched column. Same thing can happen around the actual number of columns in a row.&lt;/p&gt;

&lt;p&gt;Attached patch modified so that paging will fetch at least two columns.&lt;/p&gt;</comment>
                            <comment id="13480532" author="thobbs" created="Fri, 19 Oct 2012 23:43:32 +0000"  >&lt;p&gt;The latest patch fixes the issue and passes all of the pycassa tests.&lt;/p&gt;

&lt;p&gt;One comment on this conditional:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (requestedCount == 0 || columns.size() &amp;lt; predicate.slice_range.count)
        &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Since you&apos;re no longer decrementing requestedCount, the first half of the disjunction isn&apos;t needed.  If the user actually set a requestedCount of 0, the first column slice would be empty, so we wouldn&apos;t get this far.&lt;/p&gt;

&lt;p&gt;Other than that, I&apos;m +1 on the changes&lt;/p&gt;</comment>
                            <comment id="13481459" author="yukim" created="Mon, 22 Oct 2012 16:08:54 +0000"  >&lt;p&gt;Thanks for review, Tyler.&lt;/p&gt;

&lt;p&gt;What we want here is to fetch last page with remainder, not whole page size. So we still need requestedCount -= newColumns.&lt;/p&gt;

&lt;p&gt;Attaching v2 for this.&lt;/p&gt;</comment>
                            <comment id="13481483" author="thobbs" created="Mon, 22 Oct 2012 16:28:30 +0000"  >&lt;p&gt;The patch needs to be rebased, but I&apos;m +1 on the code changes&lt;/p&gt;</comment>
                            <comment id="13481631" author="yukim" created="Mon, 22 Oct 2012 18:56:00 +0000"  >&lt;p&gt;Committed, thanks!&lt;/p&gt;</comment>
                            <comment id="13549836" author="jbellis" created="Thu, 10 Jan 2013 17:50:23 +0000"  >&lt;p&gt;Updating affects-version to 1.1.0 since &quot;this seems to affect all of 1.1,&quot; and since the fix caused a regression with TTL data (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5099&quot; title=&quot;Since 1.1, get_count sometimes returns value smaller than actual column count&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5099&quot;&gt;&lt;del&gt;CASSANDRA-5099&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12550308" name="4833-1.1-v2.txt" size="6377" author="yukim" created="Mon, 22 Oct 2012 16:08:54 +0000"/>
                            <attachment id="12550008" name="4833-1.1.txt" size="5750" author="yukim" created="Fri, 19 Oct 2012 17:05:13 +0000"/>
                            <attachment id="12549708" name="4833-get-count-repro.py" size="900" author="thobbs" created="Thu, 18 Oct 2012 16:58:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[yukim]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>249596</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 45 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0aft3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>58834</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>thobbs</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thobbs]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>