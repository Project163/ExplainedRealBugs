<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:45:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6563] TTL histogram compactions not triggered at high &quot;Estimated droppable tombstones&quot; rate</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6563</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I have several column families in a largish cluster where virtually all columns are written with a (usually the same) TTL.  My understanding of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3442&quot; title=&quot;TTL histogram for sstable metadata&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3442&quot;&gt;&lt;del&gt;CASSANDRA-3442&lt;/del&gt;&lt;/a&gt; is that sstables that have a high ( &amp;gt; 20%) estimated percentage of droppable tombstones should be individually compacted.  This does not appear to be occurring with size tired compaction.&lt;/p&gt;

&lt;p&gt;Example from one node:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ ll /data/sstables/data/ks/Cf/*Data.db
-rw-rw-r-- 31 cassandra cassandra 26651211757 Nov 26 22:59 /data/sstables/data/ks/Cf/ks-Cf-ic-295562-Data.db
-rw-rw-r-- 31 cassandra cassandra  6272641818 Nov 27 02:51 /data/sstables/data/ks/Cf/ks-Cf-ic-296121-Data.db
-rw-rw-r-- 31 cassandra cassandra  1814691996 Dec  4 21:50 /data/sstables/data/ks/Cf/ks-Cf-ic-320449-Data.db
-rw-rw-r-- 30 cassandra cassandra 10909061157 Dec 11 17:31 /data/sstables/data/ks/Cf/ks-Cf-ic-340318-Data.db
-rw-rw-r-- 29 cassandra cassandra   459508942 Dec 12 10:37 /data/sstables/data/ks/Cf/ks-Cf-ic-342259-Data.db
-rw-rw-r--  1 cassandra cassandra      336908 Dec 12 12:03 /data/sstables/data/ks/Cf/ks-Cf-ic-342307-Data.db
-rw-rw-r--  1 cassandra cassandra     2063935 Dec 12 12:03 /data/sstables/data/ks/Cf/ks-Cf-ic-342309-Data.db
-rw-rw-r--  1 cassandra cassandra         409 Dec 12 12:03 /data/sstables/data/ks/Cf/ks-Cf-ic-342314-Data.db
-rw-rw-r--  1 cassandra cassandra    31180007 Dec 12 12:03 /data/sstables/data/ks/Cf/ks-Cf-ic-342319-Data.db
-rw-rw-r--  1 cassandra cassandra     2398345 Dec 12 12:03 /data/sstables/data/ks/Cf/ks-Cf-ic-342322-Data.db
-rw-rw-r--  1 cassandra cassandra       21095 Dec 12 12:03 /data/sstables/data/ks/Cf/ks-Cf-ic-342331-Data.db
-rw-rw-r--  1 cassandra cassandra       81454 Dec 12 12:03 /data/sstables/data/ks/Cf/ks-Cf-ic-342335-Data.db
-rw-rw-r--  1 cassandra cassandra     1063718 Dec 12 12:03 /data/sstables/data/ks/Cf/ks-Cf-ic-342339-Data.db
-rw-rw-r--  1 cassandra cassandra      127004 Dec 12 12:03 /data/sstables/data/ks/Cf/ks-Cf-ic-342344-Data.db
-rw-rw-r--  1 cassandra cassandra      146785 Dec 12 12:03 /data/sstables/data/ks/Cf/ks-Cf-ic-342346-Data.db
-rw-rw-r--  1 cassandra cassandra      697338 Dec 12 12:03 /data/sstables/data/ks/Cf/ks-Cf-ic-342351-Data.db
-rw-rw-r--  1 cassandra cassandra     3921428 Dec 12 12:03 /data/sstables/data/ks/Cf/ks-Cf-ic-342367-Data.db
-rw-rw-r--  1 cassandra cassandra      240332 Dec 12 12:03 /data/sstables/data/ks/Cf/ks-Cf-ic-342370-Data.db
-rw-rw-r--  1 cassandra cassandra       45669 Dec 12 12:03 /data/sstables/data/ks/Cf/ks-Cf-ic-342374-Data.db
-rw-rw-r--  1 cassandra cassandra    53127549 Dec 12 12:03 /data/sstables/data/ks/Cf/ks-Cf-ic-342375-Data.db
-rw-rw-r-- 16 cassandra cassandra 12466853166 Dec 25 22:40 /data/sstables/data/ks/Cf/ks-Cf-ic-396473-Data.db
-rw-rw-r-- 12 cassandra cassandra  3903237198 Dec 29 19:42 /data/sstables/data/ks/Cf/ks-Cf-ic-408926-Data.db
-rw-rw-r--  7 cassandra cassandra  3692260987 Jan  3 08:25 /data/sstables/data/ks/Cf/ks-Cf-ic-427733-Data.db
-rw-rw-r--  4 cassandra cassandra  3971403602 Jan  6 20:50 /data/sstables/data/ks/Cf/ks-Cf-ic-437537-Data.db
-rw-rw-r--  3 cassandra cassandra  1007832224 Jan  7 15:19 /data/sstables/data/ks/Cf/ks-Cf-ic-440331-Data.db
-rw-rw-r--  2 cassandra cassandra   896132537 Jan  8 11:05 /data/sstables/data/ks/Cf/ks-Cf-ic-447740-Data.db
-rw-rw-r--  1 cassandra cassandra   963039096 Jan  9 04:59 /data/sstables/data/ks/Cf/ks-Cf-ic-449425-Data.db
-rw-rw-r--  1 cassandra cassandra   232168351 Jan  9 10:14 /data/sstables/data/ks/Cf/ks-Cf-ic-450287-Data.db
-rw-rw-r--  1 cassandra cassandra    73126319 Jan  9 11:28 /data/sstables/data/ks/Cf/ks-Cf-ic-450307-Data.db
-rw-rw-r--  1 cassandra cassandra    40921916 Jan  9 12:08 /data/sstables/data/ks/Cf/ks-Cf-ic-450336-Data.db
-rw-rw-r--  1 cassandra cassandra    60881193 Jan  9 12:23 /data/sstables/data/ks/Cf/ks-Cf-ic-450341-Data.db
-rw-rw-r--  1 cassandra cassandra        4746 Jan  9 12:23 /data/sstables/data/ks/Cf/ks-Cf-ic-450350-Data.db
-rw-rw-r--  1 cassandra cassandra        5769 Jan  9 12:23 /data/sstables/data/ks/Cf/ks-Cf-ic-450352-Data.db
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;295562: Estimated droppable tombstones: 0.899035828535183
296121: Estimated droppable tombstones: 0.9135080937806197
320449: Estimated droppable tombstones: 0.8916766879896414
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;ve checked in on this example node several times and compactionstats has not shown any other activity that would be blocking the tombstone based compaction.  The TTL is in the 15-20 day range so an sstable from November should have had ample opportunities by January.&lt;/p&gt;</description>
                <environment>&lt;p&gt;1.2.12ish&lt;/p&gt;</environment>
        <key id="12688107">CASSANDRA-6563</key>
            <summary>TTL histogram compactions not triggered at high &quot;Estimated droppable tombstones&quot; rate</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pauloricardomg">Paulo Motta</assignee>
                                    <reporter username="cburroughs">Chris Burroughs</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Jan 2014 17:30:30 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:56 +0000</updated>
                            <resolved>Tue, 27 May 2014 08:53:25 +0000</resolved>
                                        <fixVersion>2.0.9</fixVersion>
                                    <component>Local/Compaction</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>11</watches>
                                                                                                                <comments>
                            <comment id="13867958" author="cburroughs" created="Fri, 10 Jan 2014 16:29:39 +0000"  >&lt;p&gt;I think this may actually be &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6568&quot; title=&quot;sstables incorrectly getting marked as &amp;quot;not live&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6568&quot;&gt;&lt;del&gt;CASSANDRA-6568&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13992809" author="pauloricardomg" created="Thu, 8 May 2014 14:52:07 +0000"  >&lt;p&gt;I&apos;ve also hit this bug and instrumented the code to identify what was happening. Below is a detailed explanation of the issues that lead to this:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3442&quot; title=&quot;TTL histogram for sstable metadata&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3442&quot;&gt;&lt;del&gt;CASSANDRA-3442&lt;/del&gt;&lt;/a&gt; introduced the automatic tombstone removal feature, which was one of the main new features of C* 1.2 (&lt;a href=&quot;http://www.datastax.com/dev/blog/tombstone-removal-improvement-in-1-2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.datastax.com/dev/blog/tombstone-removal-improvement-in-1-2&lt;/a&gt;).&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;In &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4022&quot; title=&quot;Compaction of hints can get stuck in a loop&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4022&quot;&gt;&lt;del&gt;CASSANDRA-4022&lt;/del&gt;&lt;/a&gt; the hints column family entered a compaction loop due to the single sstable compaction introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3442&quot; title=&quot;TTL histogram for sstable metadata&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3442&quot;&gt;&lt;del&gt;CASSANDRA-3442&lt;/del&gt;&lt;/a&gt; that was not clearing tombstones because compacted rows with a lower timestamp were present in other sstables. So, the same SSTable was being compated over and over due to a large tombstone ratio that never changed.&lt;br/&gt;
A new heuristic was introduced to estimate the number of keys of the candidate SSTable that overlaps with other SSTables to prevent &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4022&quot; title=&quot;Compaction of hints can get stuck in a loop&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4022&quot;&gt;&lt;del&gt;CASSANDRA-4022&lt;/del&gt;&lt;/a&gt;. However, this heuristic uses the token range to estimate the key overlap, which can be an accurate estimation if an OrderedPartitioner is used, but not for a RandomPartitioner, since most SSTables will contain the whole node&apos;s range. The result is that this heuristic not only prevents &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4022&quot; title=&quot;Compaction of hints can get stuck in a loop&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4022&quot;&gt;&lt;del&gt;CASSANDRA-4022&lt;/del&gt;&lt;/a&gt; from happening, but in my opinion it also prevents any tombstone compaction to happen at all, since most of the times the token ranges of all SSTables overlap. Jonathan Ellis even noted in the ticket discussion, &quot;I&apos;m worried that with SizeTiered compaction we&apos;ll have overlap in a lot of cases where we could still compact if we looked closer&quot;, but this worry was not taken further and the fix was integrated.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Even with the previous fix, the compaction bug reappeared in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4781&quot; title=&quot;Sometimes Cassandra starts compacting system-shema_columns cf repeatedly until the node is killed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4781&quot;&gt;&lt;del&gt;CASSANDRA-4781&lt;/del&gt;&lt;/a&gt;. Sylvain Lebresne noted that even with the estimation &quot;we could always end up in a case where the estimate thinks there is enough droppable tombstones, but in practice all the droppable tombstones are in overlapping ranges&quot;, and suggested to skip the worthDroppingTombstone check for SStables that were compacted before tombstone_compaction_interval seconds. The estimation was update because it contained a minor bug and the check for &quot;tombstone_compaction_interval&quot; was added.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So, after this change the code has pretty much been untouched since 1.2.0 and hasn&apos;t caused any problems since then, in my opinion because the tombstone compaction was never being triggered because of the conservative estimation, as illustrated in this JIRA ticket and the following mailing list threads:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://www.mail-archive.com/user@cassandra.apache.org/msg29979.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.mail-archive.com/user@cassandra.apache.org/msg29979.html&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;http://www.mail-archive.com/user@cassandra.apache.org/msg36144.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.mail-archive.com/user@cassandra.apache.org/msg36144.html&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://www.mail-archive.com/user@cassandra.apache.org/msg31760.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.mail-archive.com/user@cassandra.apache.org/msg31760.html&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://www.mail-archive.com/user@cassandra.apache.org/msg35793.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.mail-archive.com/user@cassandra.apache.org/msg35793.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;In my opinion, the tombstone_compaction_interval check is sufficient to prevent &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4022&quot; title=&quot;Compaction of hints can get stuck in a loop&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4022&quot;&gt;&lt;del&gt;CASSANDRA-4022&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-4781&quot; title=&quot;Sometimes Cassandra starts compacting system-shema_columns cf repeatedly until the node is killed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-4781&quot;&gt;&lt;del&gt;CASSANDRA-4781&lt;/del&gt;&lt;/a&gt;, since it will give time for rows to be merged and the tombstone compaction to execute succesfully, reducing the droppable tombstone ratio and avoiding the compaction loop. So, I propose removing altogether the heuristic to estimate the key overlap in order to decide if a sstable should be tombstone compacted, keeping only the droppable tombstone treshold and tombstone_compaction_interval to decide that.&lt;/p&gt;

&lt;p&gt;I&apos;m attaching the patch for 1.2, which I&apos;m testing in one of our production servers, and will provide a patch for 2.0.X soon. &lt;/p&gt;

&lt;p&gt;We already gained about 10% disk space due to tombstone compactions that were not being triggered before the patch. I will post the graphs soon with the space savings and decrease in droppable tombstone ratios. So far we haven&apos;t noticed any compaction loop.&lt;/p&gt;</comment>
                            <comment id="13992862" author="pauloricardomg" created="Thu, 8 May 2014 15:50:45 +0000"  >&lt;p&gt;Attached patch for cassandra-2.0.7.&lt;/p&gt;

&lt;p&gt;Removed check for &quot;CompactionController.getFullyExpiredSSTables(cfs, Collections.singleton(sstable), overlaps, gcBefore).size() &amp;gt; 0&quot; (added in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5228&quot; title=&quot;Track maximum ttl and use to expire entire sstables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5228&quot;&gt;&lt;del&gt;CASSANDRA-5228&lt;/del&gt;&lt;/a&gt;), because it is no longer necessary, since it is sufficient for the droppable tombstone ratio to be above the treshold for the tombstone compaction to be triggered.&lt;/p&gt;</comment>
                            <comment id="13992870" author="pauloricardomg" created="Thu, 8 May 2014 15:59:28 +0000"  >&lt;p&gt;Related issue: &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6654&quot; title=&quot;Droppable tombstones are not being removed from LCS table despite being above 20%&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6654&quot;&gt;&lt;del&gt;CASSANDRA-6654&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13992956" author="pauloricardomg" created="Thu, 8 May 2014 17:46:27 +0000"  >&lt;p&gt;The following graphs compare the droppable tombstone ratio vs storage load of an unpatched vs patched node until about 12 hours after the patch was applied. These are both for LCS and STCS CFs, so the bug is definitely affecting both, not only STCS.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Droppable Tombstone Ratio (unpatched vs patched)&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;float: left&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12643979/12643979_unpatched-droppable-ratio.png&quot; height=&quot;&amp;quot;50%&quot; width=&quot;50%&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;span class=&quot;image-wrap&quot; style=&quot;float: right&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12643978/12643978_patched-droppadble-ratio.png&quot; height=&quot;&amp;quot;50%&quot; width=&quot;50%&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Live disk space used (unpatched vs patched)&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;float: left&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12643976/12643976_unpatched-storage-load.png&quot; height=&quot;&amp;quot;50%&quot; width=&quot;50%&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;span class=&quot;image-wrap&quot; style=&quot;float: right&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12643977/12643977_patched-storage-load.png&quot; height=&quot;&amp;quot;50%&quot; width=&quot;50%&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="13993480" author="krummas" created="Fri, 9 May 2014 08:45:05 +0000"  >&lt;p&gt;have to say I don&apos;t really feel comfortable dropping these checks, we could start doing alot of extra unnecessary IO&lt;/p&gt;

&lt;p&gt;A better solution would be to get a more accurate estimate on how much the sstables overlap, (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6474&quot; title=&quot;Compaction strategy based on MinHash&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6474&quot;&gt;CASSANDRA-6474&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;What we could do now (in 2.0) is perhaps loosen checks a bit, for example, we should probably only check for overlap in sstables which contain data that is older than the data in one we want to compact, since those are the ones that can block dropping the tombstones.&lt;/p&gt;</comment>
                            <comment id="13993861" author="pauloricardomg" created="Fri, 9 May 2014 19:37:58 +0000"  >&lt;p&gt;You&apos;re right, dropping the checks increases necessary I/O but also unnecessary I/O. I made a comparison of the compacted bytes for 2 ranges (with and without patch). It&apos;s possible to see a huge increase of useful compactions, but also a relevant increase of useless compacted bytes (even though the compactions haven&apos;t stabilized yet).&lt;/p&gt;

&lt;p&gt;Subtitle:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;compact+: compacted bytes from useful compactions (compaction ratio &amp;lt; 100%)&lt;/li&gt;
	&lt;li&gt;tombstone+: compacted bytes from useful tombstone compactions (compaction ratio &amp;lt; 100%)&lt;/li&gt;
	&lt;li&gt;compact-: compacted bytes from useless compactions (compaction ratio = 100%)&lt;/li&gt;
	&lt;li&gt;tombstone-: compacted bytes from useless compactions (compaction ratio = 100%)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;b&gt;Unpatched vs Patched compacted bytes&lt;/b&gt; (range 1)&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;float: left&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12644169/12644169_unpatched1-compacted-bytes.png&quot; height=&quot;&amp;quot;50%&quot; width=&quot;50%&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;span class=&quot;image-wrap&quot; style=&quot;float: right&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12644170/12644170_patched1-compacted-bytes.png&quot; height=&quot;&amp;quot;50%&quot; width=&quot;50%&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Unpatched vs Patched compacted bytes&lt;/b&gt; (range 2)&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;float: left&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12644167/12644167_unpatched2-compacted-bytes.png&quot; height=&quot;&amp;quot;50%&quot; width=&quot;50%&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;span class=&quot;image-wrap&quot; style=&quot;float: right&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12644168/12644168_patched2-compacted-bytes.png&quot; height=&quot;&amp;quot;50%&quot; width=&quot;50%&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;What we want here is to increase the number of useful tombstone compactions without increasing the number of useless ones. I will implement a new patch that only takes older sstables into account to check for overlap and compare the results with the previous patch to see if we can achieve good results.&lt;/p&gt;</comment>
                            <comment id="14000258" author="pauloricardomg" created="Fri, 16 May 2014 20:29:08 +0000"  >&lt;p&gt;Below I will present some live cluster analysis about 10 days after deploying the original patch that entirely removes the check for range overlap in worthDroppingTombstones(). &lt;/p&gt;

&lt;p&gt;&lt;b&gt;Analysis Description&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;In our dataset we use both LCS and STCS, but most of the CFs are STCS. A significant portion of our dataset is comprised of append-only TTL-ed data, so a good match for tombstone compaction. Most of our large CFs with high droppable tombstone ratio use STCS, but there are a few that use LCS that also benefited from the patch. &lt;/p&gt;

&lt;p&gt;I deployed the patch in 2 different ranges with similar results. The metrics were collected between 1st of May and 16 of May, the nodes were patched on the 7th of May. Used cassandra version was 1.2.16.&lt;/p&gt;

&lt;p&gt;In the analysis I compare the total space used (Cassandra Load), tombstone Ratio, disk utilization (system disk xvbd util), total bytes compacted and system load (linux cpu). For the last three metrics I also calculate the integral of the metric to make it easier to compare the total amount during the period.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Analysis&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;Graphs: &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12645241/patch-v1-range1.png&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12645241/patch-v1-range1.png&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Each graph compares the metrics of the patched node with it&apos;s previous neighbor and next neighbor, no VNODES is used. So, the first row in the figure is node N-1, the second row is node N (the patched node, marked with asterisk), and the third row is node N+1.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;b&gt;Cassandra load&lt;/b&gt;: In the patched node, it&apos;s possible to see a sudden decrease of 7% of disk space when the patch was applied, due to the execution of single SSTable compactions. The growth rate of disk usage is also decreased after the patch, since tombstone are cleared more often. In the whole period, there was a 1.2% disk space increase in the patched node, against about 10% growth on the unpatched nodes.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;&lt;b&gt;Tombstone ratio&lt;/b&gt;: After the patch is applied, it&apos;s possible to see a decrease in the droppable tombstone ratio, that revolves around the default level of 20% after that. The droppable tombstone ratio of unpatched nodes remains high for most CFs, what indicates that tombstone compactions are not being triggered at all.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;&lt;b&gt;Disk utilization&lt;/b&gt;: it&apos;s not possible to detect any change in the disk utilization pattern after the patch is applied, what might indicate the I/O is not affected by the patch, at least for our mixed dataset. I double checked the IOPS graph for the period and there was not even a slight sign of change in the I/O pattern after the patch was applied. (&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12645312/patch-v1-iostat.png&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12645312/patch-v1-iostat.png&lt;/a&gt;)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;&lt;b&gt;Total Bytes compacted&lt;/b&gt;: The number of compacted bytes in the patched node was about 17% higher in the period. About 7% due to the initial tombstones that were cleared and more 7% due to cleared tombstones after the patch was applied (the difference between the 2 nodes sizes). The remaining 3% can be attributed to unnecessary compactions + normal variations because of different node ranges.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;&lt;b&gt;System CPU Load&lt;/b&gt;: Was not affected by the patch.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;b&gt;Alternative Patch&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;I implemented another version of the patch (v2) as suggested by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=krummas&quot; class=&quot;user-hover&quot; rel=&quot;krummas&quot;&gt;krummas&lt;/a&gt;, that instead of dropping the overlap check entirely, it only performs the check for SSTables containing rows with smaller timestamp than the candidate SSTable (&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12645316/1.2.16-CASSANDRA-6563-v2.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12645316/1.2.16-CASSANDRA-6563-v2.txt&lt;/a&gt;). &lt;/p&gt;

&lt;p&gt;One week ago I deployed this alternative patch on 2 of our production nodes, and unfortunately loosing the checks did not achieve significant results. I added some debugging log to the code and what I verified is that despite reducing the number of sstables to compare with, even if only one SSTable has a column with an equal or lower timestamp to the candidate SSTable, the token ranges of these sstables always overlap because of the Random Partitioner. So, this supports the claim that even with loosen checks, the single-sstable tombstone compaction is almost never being triggered. At least on the use cases that could benefit from it.&lt;/p&gt;

&lt;p&gt;The graphs for the alternative patch analysis can be found here: &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12645240/patch-v2-range3.png&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12645240/patch-v2-range3.png&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14000289" author="pauloricardomg" created="Fri, 16 May 2014 20:47:37 +0000"  >&lt;p&gt;Based on the previous analysis I propose the following alternatives:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Drop the sstable range overlap check and hope that the analysis can be generalized and I/O will not be significantly impacted by the dropping the check.&lt;/li&gt;
	&lt;li&gt;Since the check almost never lets tombstone compactions run, we can drop the check add a new CF property: enable_tombstone_compactions: false (default), and at least allow admins to safely enable tombstone compaction for CFs they know is a good match without impacting I/O in other CFs.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="14003134" author="krummas" created="Tue, 20 May 2014 12:01:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pauloricardomg&quot; class=&quot;user-hover&quot; rel=&quot;pauloricardomg&quot;&gt;pauloricardomg&lt;/a&gt; I think making it configurable is the way to go, calling the config option something like &quot;aggressive_tombstone_compactions&quot; or something, with default off.&lt;/p&gt;</comment>
                            <comment id="14005170" author="pauloricardomg" created="Wed, 21 May 2014 20:16:03 +0000"  >&lt;p&gt;Please find the new version of the patch here: &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12646087/1.2.16-CASSANDRA-6563-v3.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12646087/1.2.16-CASSANDRA-6563-v3.txt&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Comments:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;I have initially implemented on 1.2-branch, since that&apos;s the version we&apos;re using currently. After it&apos;s reviewed and everything is fine I can port the patch 2.0-branch, since I don&apos;t think there&apos;ll be significant differences.&lt;/li&gt;
	&lt;li&gt;I have called the property &quot;unchecked_tombstone_compaction&quot; (default: false), since aggressive_tombstone_compactions is too aggressive. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/tongue.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/li&gt;
	&lt;li&gt;I have added unit tests showing that tombstone compactions are not being properly executed (due to the check) when unchecked_tombstone_compaction is disabled, and are executed after the property is enabled, for both STCS and LCS.&lt;/li&gt;
	&lt;li&gt;During the implementation, I found a minor bug in AbstractCompactionStrategy&apos;s constructor:
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; AbstractCompactionStrategy(ColumnFamilyStore cfs, Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; options)
    {
        &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; cfs != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.cfs = cfs;
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.options = options;
    ...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The fact that AbstractCompactionStrategy.options has the same reference of CFMetadata.compactionStrategyOptions, means that ColumnFamilyStore.reload() does not reload the compaction strategy when a compaction strategy option changes, due to the following piece of code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void maybeReloadCompactionStrategy()
    {
        &lt;span class=&quot;code-comment&quot;&gt;// Check &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; there is a need &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; reloading
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (metadata.compactionStrategyClass.equals(compactionStrategy.getClass()) 
            &amp;amp;&amp;amp; metadata.compactionStrategyOptions.equals(compactionStrategy.options)) &lt;span class=&quot;code-comment&quot;&gt;//metadata.compactionStrategyOptions == compactionStrategy.options, so compaction is never reloaded
&lt;/span&gt;            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I spotted this in my test, when I tried changing the value of &quot;unchecked_tombstone_compaction&quot; from false to true and calling ColumnFamilyStore.reload() was not reloading the compaction strategy. I don&apos;t know if ColumnFamilyStore.reload() is only called during tests, or also whenever the schema changes. In order to fix the bug, I made AbstractCompactionStrategy.options an ImmutableMap, so if CFMetadata.compactionStrategyOptions is updated, ColumnFamilyStore.maybeReloadCompactionStrategy will actually reload the compaction strategy:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; AbstractCompactionStrategy(ColumnFamilyStore cfs, Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; options)
    {
        &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; cfs != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.cfs = cfs;
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.options = ImmutableMap.copyOf(options);
    ...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Should I file a new issue for this fix?&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14006208" author="krummas" created="Thu, 22 May 2014 18:02:52 +0000"  >&lt;blockquote&gt;&lt;p&gt;Should I file a new issue for this fix?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;yes.&lt;/p&gt;

&lt;p&gt;Thanks for the patch, could you rebase it on 2.0?&lt;/p&gt;</comment>
                            <comment id="14006597" author="pauloricardomg" created="Thu, 22 May 2014 23:22:49 +0000"  >&lt;p&gt;2.0 patch here: &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12646410/2.0-CASSANDRA-6563-v3.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12646410/2.0-CASSANDRA-6563-v3.txt&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Comments:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Due to the improvements to LCS in 2.0 I had to increase the TTL, sleep times and number of rows in testUncheckedTombstoneCompactionLeveledCompaction() to create an environment with overlapping-range sstables in multiple levels. Since this was mostly an &quot;educational&quot; test to show the benefits of the patch to LCS, and it was not totally deterministic, I decided to remove it in order not to burden the test suite. The main patch functionality is already well tested in testUncheckedTombstoneSizeTieredCompaction().&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14009507" author="krummas" created="Tue, 27 May 2014 08:53:25 +0000"  >&lt;p&gt;Committed as 367c741931c2a20eb2213650313dc238e8b0f3aa with added cqlsh support and documentation, also instead of Boolean.parseBoolean, I made sure the value is either &apos;true&apos; or &apos;false&apos;&lt;/p&gt;

&lt;p&gt;thanks!&lt;/p&gt;</comment>
                            <comment id="14104386" author="dhendry" created="Wed, 20 Aug 2014 19:20:09 +0000"  >&lt;p&gt;I initially tried something similar to what was done here (adding the option to entirely skip the overlap check) but ran into the infinite compaction problem. Our cassandra nodes have a lot of data (4+TB/node) which churns quite quickly (&amp;lt; one month) and the simple sstable age based heuristic was burning IO without actually getting rid of expired data (largely because individual compactions take so long).&lt;/p&gt;

&lt;p&gt;Based on how the CompactionController.shouldPurge() is implemented, which seems to be how the compaction process &lt;b&gt;actually&lt;/b&gt; decides if data can be dropped, I stared running this patch in production: &lt;a href=&quot;https://github.com/kikinteractive/cassandra/compare/cassandra-1.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/kikinteractive/cassandra/compare/cassandra-1.2&lt;/a&gt; . Basically it checks the sampled keys agains the bloom filters of overlapping SSTables to estimate overlap instead of trying to calculate it based on tokens. &lt;/p&gt;

&lt;p&gt;So far it seems to have been highly effective. Every tombstone compaction which has happened so far has resulted in sstable size reduction of at least the specified threshold. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12645316" name="1.2.16-CASSANDRA-6563-v2.txt" size="2035" author="pauloricardomg" created="Fri, 16 May 2014 20:09:43 +0000"/>
                            <attachment id="12646087" name="1.2.16-CASSANDRA-6563-v3.txt" size="17446" author="pauloricardomg" created="Wed, 21 May 2014 20:03:42 +0000"/>
                            <attachment id="12643957" name="1.2.16-CASSANDRA-6563.txt" size="2913" author="pauloricardomg" created="Thu, 8 May 2014 14:46:41 +0000"/>
                            <attachment id="12646410" name="2.0-CASSANDRA-6563-v3.txt" size="12217" author="pauloricardomg" created="Thu, 22 May 2014 23:09:17 +0000"/>
                            <attachment id="12643961" name="2.0.7-CASSANDRA-6563.txt" size="3104" author="pauloricardomg" created="Thu, 8 May 2014 15:50:45 +0000"/>
                            <attachment id="12645312" name="patch-v1-iostat.png" size="99271" author="pauloricardomg" created="Fri, 16 May 2014 19:47:49 +0000"/>
                            <attachment id="12645241" name="patch-v1-range1.png" size="394816" author="pauloricardomg" created="Fri, 16 May 2014 15:30:20 +0000"/>
                            <attachment id="12645240" name="patch-v2-range3.png" size="401228" author="pauloricardomg" created="Fri, 16 May 2014 15:30:20 +0000"/>
                            <attachment id="12643978" name="patched-droppadble-ratio.png" size="26599" author="pauloricardomg" created="Thu, 8 May 2014 17:33:43 +0000"/>
                            <attachment id="12643977" name="patched-storage-load.png" size="12369" author="pauloricardomg" created="Thu, 8 May 2014 17:33:43 +0000"/>
                            <attachment id="12644170" name="patched1-compacted-bytes.png" size="18842" author="pauloricardomg" created="Fri, 9 May 2014 19:19:35 +0000"/>
                            <attachment id="12644168" name="patched2-compacted-bytes.png" size="17754" author="pauloricardomg" created="Fri, 9 May 2014 19:19:35 +0000"/>
                            <attachment id="12643979" name="unpatched-droppable-ratio.png" size="14405" author="pauloricardomg" created="Thu, 8 May 2014 17:33:43 +0000"/>
                            <attachment id="12643976" name="unpatched-storage-load.png" size="14218" author="pauloricardomg" created="Thu, 8 May 2014 17:33:43 +0000"/>
                            <attachment id="12644169" name="unpatched1-compacted-bytes.png" size="17857" author="pauloricardomg" created="Fri, 9 May 2014 19:19:35 +0000"/>
                            <attachment id="12644167" name="unpatched2-compacted-bytes.png" size="18642" author="pauloricardomg" created="Fri, 9 May 2014 19:19:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>16.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[pauloricardomg]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>367113</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 13 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ra33:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>367423</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12323284">1.2.0 beta 2</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>marcuse</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>