<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:41:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6142] Remove multithreaded compaction (and precompactedrow)</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6142</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;There is at best a very small sweet spot for multithreaded compaction (ParallelCompactionIterable).  For large rows, we stall the pipeline and fall back to a single LCR pass.  For small rows, the overhead of the coordination outweighs the benefits of parallelization (45s to compact 2x1M stress rows with multithreading enabled, vs 35 with it disabled).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12672169">CASSANDRA-6142</key>
            <summary>Remove multithreaded compaction (and precompactedrow)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="jbellis">Jonathan Ellis</reporter>
                        <labels>
                    </labels>
                <created>Thu, 3 Oct 2013 15:38:51 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:03 +0000</updated>
                            <resolved>Wed, 30 Oct 2013 15:20:24 +0000</resolved>
                                        <fixVersion>2.1 beta1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13785287" author="jbellis" created="Thu, 3 Oct 2013 15:41:39 +0000"  >&lt;p&gt;I tried parallelizing at the OnDiskAtomIterator level instead (thread-per-iterator-per-partition, buffering into a queue) and for small partitions the performance is ridiculously bad, easily 100x worse than single threaded mode.&lt;/p&gt;

&lt;p&gt;Any better ideas &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=krummas&quot; class=&quot;user-hover&quot; rel=&quot;krummas&quot;&gt;krummas&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yukim&quot; class=&quot;user-hover&quot; rel=&quot;yukim&quot;&gt;yukim&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iamaleksey&quot; class=&quot;user-hover&quot; rel=&quot;iamaleksey&quot;&gt;iamaleksey&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt;?  If not I will post a patch to rip out PCI.&lt;/p&gt;</comment>
                            <comment id="13785321" author="krummas" created="Thu, 3 Oct 2013 16:32:10 +0000"  >&lt;p&gt;i tried improving it a while back as well, got basically the same results, yes, we should remove it&lt;/p&gt;

&lt;p&gt;concluded that the best way to improve the speed was to do more compactions in parallel (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5936&quot; title=&quot;Improve the way we pick L0 compaction candidates&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5936&quot;&gt;&lt;del&gt;CASSANDRA-5936&lt;/del&gt;&lt;/a&gt; - i should finish that up..)&lt;/p&gt;</comment>
                            <comment id="13785612" author="jbellis" created="Thu, 3 Oct 2013 22:36:54 +0000"  >&lt;p&gt;Pushed removal to &lt;a href=&quot;https://github.com/jbellis/cassandra/commits/6142&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jbellis/cassandra/commits/6142&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Also removes PrecompactedRow, which is no longer necessary, and fixes a couple existing bugs in LCR and Scrub that this revealed (last two commits).&lt;/p&gt;</comment>
                            <comment id="13793726" author="jbellis" created="Sun, 13 Oct 2013 17:40:31 +0000"  >&lt;p&gt;Belated clicked Submit Patch.&lt;/p&gt;</comment>
                            <comment id="13796515" author="krummas" created="Wed, 16 Oct 2013 07:50:15 +0000"  >&lt;p&gt;CompactionsPurgeTest fails:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    [junit] Testsuite: org.apache.cassandra.db.compaction.CompactionsPurgeTest
    [junit] Tests run: 6, Failures: 2, Errors: 0, Skipped: 0, Time elapsed: 9.365 sec
    [junit] 
    [junit] Testcase: testMinTimestampPurge(org.apache.cassandra.db.compaction.CompactionsPurgeTest):   FAILED
    [junit] expected:&amp;lt;2&amp;gt; but was:&amp;lt;1&amp;gt;
    [junit] junit.framework.AssertionFailedError: expected:&amp;lt;2&amp;gt; but was:&amp;lt;1&amp;gt;
    [junit]     at org.apache.cassandra.db.compaction.CompactionsPurgeTest.testMinTimestampPurge(CompactionsPurgeTest.java:185)
    [junit] 
    [junit] 
    [junit] Testcase: testCompactionPurgeTombstonedRow(org.apache.cassandra.db.compaction.CompactionsPurgeTest):        FAILED
    [junit] expected:&amp;lt;10&amp;gt; but was:&amp;lt;5&amp;gt;
    [junit] junit.framework.AssertionFailedError: expected:&amp;lt;10&amp;gt; but was:&amp;lt;5&amp;gt;
    [junit]     at org.apache.cassandra.db.compaction.CompactionsPurgeTest.testCompactionPurgeTombstonedRow(CompactionsPurgeTest.java:313)
    [junit] 
    [junit] 
    [junit] Test org.apache.cassandra.db.compaction.CompactionsPurgeTest FAILED
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and a few nits:&lt;br/&gt;
in LazilyCompactedRow:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;make reducer and merger final&lt;/li&gt;
	&lt;li&gt;remove comment about reducer being null on row 123&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13798480" author="jbellis" created="Thu, 17 Oct 2013 21:49:49 +0000"  >&lt;p&gt;Damn, not sure how I missed that.  Suspect another existing bug.  Will investigate.&lt;/p&gt;</comment>
                            <comment id="13799990" author="jbellis" created="Sat, 19 Oct 2013 20:02:41 +0000"  >&lt;p&gt;Pushed fixes for these to the same branch.  (They are indeed existing bugs in LCR.)&lt;/p&gt;</comment>
                            <comment id="13801548" author="krummas" created="Tue, 22 Oct 2013 06:58:15 +0000"  >&lt;p&gt;looks good to me&lt;/p&gt;

&lt;p&gt;regarding saveOutOfOrderRows, i guess a solution would be to flush a new sstable from the TreeSet when its size exceeds some limit? Unsure how common this is though.&lt;/p&gt;</comment>
                            <comment id="13801998" author="jbellis" created="Tue, 22 Oct 2013 16:41:01 +0000"  >&lt;p&gt;I&apos;m guessing not super common because the existing code will just break if it hits that case.  (A LCR object will throw errors if you try to use it after advancing the underlying stream to another row.)&lt;/p&gt;

&lt;p&gt;I guess the next step is probably for me to pull the fixes out for application to 2.0.&lt;/p&gt;</comment>
                            <comment id="13804861" author="jbellis" created="Fri, 25 Oct 2013 00:40:44 +0000"  >&lt;p&gt;Posted 2.0 fixes to &lt;a href=&quot;https://github.com/jbellis/cassandra/commits/6142-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jbellis/cassandra/commits/6142-2.0&lt;/a&gt;.  Note that b959e8ff3bccd3437de70d33da91307ab9c12a19 is a different, less-invasive approach than the one taken for trunk.&lt;/p&gt;</comment>
                            <comment id="13808820" author="krummas" created="Wed, 30 Oct 2013 07:40:42 +0000"  >&lt;p&gt;ok, looks good to me&lt;/p&gt;

&lt;p&gt;how about 1.2?&lt;/p&gt;</comment>
                            <comment id="13809198" author="jbellis" created="Wed, 30 Oct 2013 15:10:30 +0000"  >&lt;p&gt;The 2.0 backport was bad enough, I don&apos;t even want to think about 1.2.  They&apos;re all pretty rare corner cases, so I&apos;m fine with telling people to upgrade to 2.0 if they care.&lt;/p&gt;</comment>
                            <comment id="13809201" author="jbellis" created="Wed, 30 Oct 2013 15:13:15 +0000"  >&lt;p&gt;Split that out to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6274&quot; title=&quot;fixes for compacting larger-than-memory rows&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6274&quot;&gt;&lt;del&gt;CASSANDRA-6274&lt;/del&gt;&lt;/a&gt; to keep CHANGES clean when i tag it 2.0.3.&lt;/p&gt;</comment>
                            <comment id="13809210" author="jbellis" created="Wed, 30 Oct 2013 15:20:24 +0000"  >&lt;p&gt;Committed the MT and PCR removal to 2.1&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12714771">CASSANDRA-7249</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12671499">CASSANDRA-6118</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12552441">CASSANDRA-4182</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12722872">CASSANDRA-7428</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>351795</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 3 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1onkv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>352083</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>marcuse</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>