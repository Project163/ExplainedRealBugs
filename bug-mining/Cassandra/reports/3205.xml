<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:49:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-8182] Comparison method violates its general contract in IndexSummaryManager.redistributeSummaries</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-8182</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I found this exception while going over the logs of my new 2.1.0 production candidate cluster:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ERROR [IndexSummaryManager:1] 2014-10-23 14:37:56,727 CassandraDaemon.java:166 - Exception in thread Thread[IndexSummaryManager:1,1,main]
java.lang.IllegalArgumentException: Comparison method violates its general contract!
        at java.util.TimSort.mergeLo(TimSort.java:747) ~[na:1.7.0_67]
        at java.util.TimSort.mergeAt(TimSort.java:483) ~[na:1.7.0_67]
        at java.util.TimSort.mergeCollapse(TimSort.java:408) ~[na:1.7.0_67]
        at java.util.TimSort.sort(TimSort.java:214) ~[na:1.7.0_67]
        at java.util.TimSort.sort(TimSort.java:173) ~[na:1.7.0_67]
        at java.util.Arrays.sort(Arrays.java:659) ~[na:1.7.0_67]
        at java.util.Collections.sort(Collections.java:217) ~[na:1.7.0_67]
        at org.apache.cassandra.io.sstable.IndexSummaryManager.redistributeSummaries(IndexSummaryManager.java:277) ~[apache-cassandra-2.1.0.jar:2.1.0]
        at org.apache.cassandra.io.sstable.IndexSummaryManager.redistributeSummaries(IndexSummaryManager.java:238) ~[apache-cassandra-2.1.0.jar:2.1.0]
        at org.apache.cassandra.io.sstable.IndexSummaryManager$1.runMayThrow(IndexSummaryManager.java:139) ~[apache-cassandra-2.1.0.jar:2.1.0]
        at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:28) ~[apache-cassandra-2.1.0.jar:2.1.0]
        at org.apache.cassandra.concurrent.DebuggableScheduledThreadPoolExecutor$UncomplainingRunnable.run(DebuggableScheduledThreadPoolExecutor.java:75) ~[apache-cassandra-2.1.0.jar:2.1.0]
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471) [na:1.7.0_67]
        at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:304) [na:1.7.0_67]
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:178) [na:1.7.0_67]
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293) [na:1.7.0_67]
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) [na:1.7.0_67]
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) [na:1.7.0_67]
        at java.lang.Thread.run(Thread.java:745) [na:1.7.0_67]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There&apos;s some other cases of invalid comparison methods in the past, but not from this case.&lt;/p&gt;</description>
                <environment>&lt;p&gt;2.1.0&lt;/p&gt;</environment>
        <key id="12750283">CASSANDRA-8182</key>
            <summary>Comparison method violates its general contract in IndexSummaryManager.redistributeSummaries</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thobbs">Tom Hobbs</assignee>
                                    <reporter username="garo5">Juho M&#228;kinen</reporter>
                        <labels>
                    </labels>
                <created>Fri, 24 Oct 2014 06:24:43 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:30 +0000</updated>
                            <resolved>Tue, 28 Oct 2014 16:35:47 +0000</resolved>
                                        <fixVersion>2.1.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14182523" author="slebresne" created="Fri, 24 Oct 2014 07:21:24 +0000"  >&lt;p&gt;Looks like this come from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5519&quot; title=&quot;Reduce index summary memory use for cold sstables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5519&quot;&gt;&lt;del&gt;CASSANDRA-5519&lt;/del&gt;&lt;/a&gt;. I suspect the problem is that the comparison function uses the SSTableReader &lt;tt&gt;readMeter.fifteenMinuteRate()&lt;/tt&gt;, but if you&apos;re unlucky this value can change in the middle of the sorting (thus changing the comparison value for 2 sstables in the middle of the sorting). We probably should save those rate in a map or something before the sort and have the sorting refer to those saved and stable values.&lt;/p&gt;</comment>
                            <comment id="14182533" author="garo5" created="Fri, 24 Oct 2014 07:32:46 +0000"  >&lt;p&gt;I&apos;m not familiar of the inner workings of this issue, does this affect the stability of the cluster?&lt;/p&gt;</comment>
                            <comment id="14182560" author="slebresne" created="Fri, 24 Oct 2014 07:45:53 +0000"  >&lt;blockquote&gt;&lt;p&gt;does this affect the stability of the cluster?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No. When this happen, the task that check if it can reduce the memory of index summary (as per &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5519&quot; title=&quot;Reduce index summary memory use for cold sstables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5519&quot;&gt;&lt;del&gt;CASSANDRA-5519&lt;/del&gt;&lt;/a&gt;) will fail, but the whole thing is not critical in the first place (it&apos;s more a nice to have really) and it&apos;s retried every hour anyway (and it almost certainly won&apos;t fail consistently). Fixing this is more about removing a scary error from the log, it&apos;s largly unconsequential in practice.&lt;/p&gt;</comment>
                            <comment id="14183220" author="thobbs" created="Fri, 24 Oct 2014 18:24:25 +0000"  >&lt;p&gt;8182.txt uses a map to avoid changing values during the sort.&lt;/p&gt;</comment>
                            <comment id="14185097" author="blerer" created="Mon, 27 Oct 2014 12:48:06 +0000"  >&lt;p&gt;Just one small nit: &lt;br/&gt;
I think that &lt;tt&gt;IndexSummaryManager.redistributeSummaries&lt;/tt&gt; will be more readable if the comparator was a static inner class. &lt;/p&gt;</comment>
                            <comment id="14186951" author="thobbs" created="Tue, 28 Oct 2014 15:28:28 +0000"  >&lt;p&gt;The v2 patch moves the comparator to a static inner class.&lt;/p&gt;</comment>
                            <comment id="14187025" author="blerer" created="Tue, 28 Oct 2014 16:21:36 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14187053" author="thobbs" created="Tue, 28 Oct 2014 16:35:47 +0000"  >&lt;p&gt;Thanks, committed as c937657.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12677616" name="8182-v2.txt" size="3279" author="thobbs" created="Tue, 28 Oct 2014 15:28:28 +0000"/>
                            <attachment id="12676960" name="8182.txt" size="2237" author="thobbs" created="Fri, 24 Oct 2014 18:24:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thobbs]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i21j73:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12327256">2.1.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>blerer</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blerer]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12326275">2.1 beta1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>