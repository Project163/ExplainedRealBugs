<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:59:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-10788] Upgrade from 2.2.1 to 3.0.0 fails with NullPointerException</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-10788</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I tried to upgrade Cassandra from 2.2.1 to 3.0.0, however, I get this error on startup after Cassandra 3.0 software was installed:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [main] 2015-11-30 15:44:50,164 CassandraDaemon.java:702 - Exception encountered during startup
java.lang.NullPointerException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
	at org.apache.cassandra.io.util.FileUtils.delete(FileUtils.java:374) ~[apache-cassandra-3.0.0.jar:3.0.0]
	at org.apache.cassandra.db.SystemKeyspace.migrateDataDirs(SystemKeyspace.java:1341) ~[apache-cassandra-3.0.0.jar:3.0.0]
	at org.apache.cassandra.service.CassandraDaemon.setup(CassandraDaemon.java:180) [apache-cassandra-3.0.0.jar:3.0.0]
	at org.apache.cassandra.service.CassandraDaemon.activate(CassandraDaemon.java:561) [apache-cassandra-3.0.0.jar:3.0.0]
	at org.apache.cassandra.service.CassandraDaemon.main(CassandraDaemon.java:689) [apache-cassandra-3.0.0.jar:3.0.0]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12916975">CASSANDRA-10788</key>
            <summary>Upgrade from 2.2.1 to 3.0.0 fails with NullPointerException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stefania">Stefania Alborghetti</assignee>
                                    <reporter username="tomas0413">Tomas Ramanauskas</reporter>
                        <labels>
                    </labels>
                <created>Mon, 30 Nov 2015 14:53:23 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:48 +0000</updated>
                            <resolved>Fri, 4 Dec 2015 13:30:06 +0000</resolved>
                                        <fixVersion>3.0.1</fixVersion>
                    <fixVersion>3.1</fixVersion>
                                    <component>Local/Startup and Shutdown</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15031881" author="tomas0413" created="Mon, 30 Nov 2015 14:54:12 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;INFO  [main] 2015-11-30 15:44:45,255 YamlConfigurationLoader.java:87 - Configuration location: file:/etc/cassandra/cassandra.yaml
INFO  [main] 2015-11-30 15:44:45,327 YamlConfigurationLoader.java:179 - Node configuration:[authenticator=AllowAllAuthenticator; authorizer=AllowAllAuthorizer; auto_snapshot=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;; batch_size_fail_threshold_in_kb=50; batch_size_warn_threshold_in_kb=5; batchlog_replay_throttle_in_kb=1024; cas_contention_timeout_in_ms=1000; client_encryption_options=&amp;lt;REDACTED&amp;gt;; cluster_name=Track Cassandra Cluster; column_index_size_in_kb=64; commit_failure_policy=stop; commitlog_directory=/data/commitlog; commitlog_segment_size_in_mb=32; commitlog_sync=periodic; commitlog_sync_period_in_ms=10000; compaction_large_partition_warning_threshold_mb=100; compaction_throughput_mb_per_sec=16; concurrent_counter_writes=32; concurrent_materialized_view_writes=32; concurrent_reads=32; concurrent_writes=32; counter_cache_save_period=7200; counter_cache_size_in_mb=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;; counter_write_request_timeout_in_ms=5000; cross_node_timeout=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;; data_file_directories=[/data]; disk_failure_policy=stop; dynamic_snitch_badness_threshold=0.1; dynamic_snitch_reset_interval_in_ms=600000; dynamic_snitch_update_interval_in_ms=100; enable_scripted_user_defined_functions=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;; enable_user_defined_functions=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;; endpoint_snitch=GossipingPropertyFileSnitch; gc_warn_threshold_in_ms=1000; hinted_handoff_enabled=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;; hinted_handoff_throttle_in_kb=1024; hints_flush_period_in_ms=10000; incremental_backups=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;; index_summary_capacity_in_mb=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;; index_summary_resize_interval_in_minutes=60; inter_dc_tcp_nodelay=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;; internode_compression=all; key_cache_save_period=14400; key_cache_size_in_mb=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;; listen_address=10.9.3.220; max_hint_window_in_ms=10800000; max_hints_delivery_threads=2; max_hints_file_size_in_mb=128; memtable_allocation_type=heap_buffers; native_transport_port=9042; num_tokens=256; partitioner=org.apache.cassandra.dht.Murmur3Partitioner; permissions_validity_in_ms=2000; range_request_timeout_in_ms=10000; read_request_timeout_in_ms=5000; request_scheduler=org.apache.cassandra.scheduler.NoScheduler; request_timeout_in_ms=10000; roles_validity_in_ms=2000; row_cache_save_period=0; row_cache_size_in_mb=0; rpc_address=10.9.3.220; rpc_keepalive=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;; rpc_port=9160; rpc_server_type=sync; saved_caches_directory=/&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/lib/cassandra/saved_caches; seed_provider=[{class_name=org.apache.cassandra.locator.SimpleSeedProvider, parameters=[{seeds=10.9.3.220, 10.9.3.223}]}]; server_encryption_options=&amp;lt;REDACTED&amp;gt;; snapshot_before_compaction=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;; ssl_storage_port=7001; sstable_preemptive_open_interval_in_mb=50; start_native_transport=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;; start_rpc=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;; storage_port=7000; thrift_framed_transport_size_in_mb=15; tombstone_failure_threshold=100000; tombstone_warn_threshold=1000; tracetype_query_ttl=86400; tracetype_repair_ttl=604800; trickle_fsync=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;; trickle_fsync_interval_in_kb=10240; truncate_request_timeout_in_ms=60000; windows_timer_interval=1; write_request_timeout_in_ms=2000]
INFO  [main] 2015-11-30 15:44:45,364 DatabaseDescriptor.java:304 - DiskAccessMode &lt;span class=&quot;code-quote&quot;&gt;&apos;auto&apos;&lt;/span&gt; determined to be mmap, indexAccessMode is mmap
INFO  [main] 2015-11-30 15:44:45,477 DatabaseDescriptor.java:406 - Global memtable on-heap threshold is enabled at 983MB
INFO  [main] 2015-11-30 15:44:45,478 DatabaseDescriptor.java:410 - Global memtable off-heap threshold is enabled at 983MB
INFO  [main] 2015-11-30 15:44:45,589 GossipingPropertyFileSnitch.java:71 - Loaded cassandra-topology.properties &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; compatibility
INFO  [main] 2015-11-30 15:44:45,609 YamlConfigurationLoader.java:179 - Node configuration:[authenticator=AllowAllAuthenticator; authorizer=AllowAllAuthorizer; auto_snapshot=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;; batch_size_fail_threshold_in_kb=50; batch_size_warn_threshold_in_kb=5; batchlog_replay_throttle_in_kb=1024; cas_contention_timeout_in_ms=1000; client_encryption_options=&amp;lt;REDACTED&amp;gt;; cluster_name=Track Cassandra Cluster; column_index_size_in_kb=64; commit_failure_policy=stop; commitlog_directory=/data/commitlog; commitlog_segment_size_in_mb=32; commitlog_sync=periodic; commitlog_sync_period_in_ms=10000; compaction_large_partition_warning_threshold_mb=100; compaction_throughput_mb_per_sec=16; concurrent_counter_writes=32; concurrent_materialized_view_writes=32; concurrent_reads=32; concurrent_writes=32; counter_cache_save_period=7200; counter_cache_size_in_mb=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;; counter_write_request_timeout_in_ms=5000; cross_node_timeout=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;; data_file_directories=[/data]; disk_failure_policy=stop; dynamic_snitch_badness_threshold=0.1; dynamic_snitch_reset_interval_in_ms=600000; dynamic_snitch_update_interval_in_ms=100; enable_scripted_user_defined_functions=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;; enable_user_defined_functions=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;; endpoint_snitch=GossipingPropertyFileSnitch; gc_warn_threshold_in_ms=1000; hinted_handoff_enabled=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;; hinted_handoff_throttle_in_kb=1024; hints_flush_period_in_ms=10000; incremental_backups=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;; index_summary_capacity_in_mb=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;; index_summary_resize_interval_in_minutes=60; inter_dc_tcp_nodelay=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;; internode_compression=all; key_cache_save_period=14400; key_cache_size_in_mb=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;; listen_address=10.9.3.220; max_hint_window_in_ms=10800000; max_hints_delivery_threads=2; max_hints_file_size_in_mb=128; memtable_allocation_type=heap_buffers; native_transport_port=9042; num_tokens=256; partitioner=org.apache.cassandra.dht.Murmur3Partitioner; permissions_validity_in_ms=2000; range_request_timeout_in_ms=10000; read_request_timeout_in_ms=5000; request_scheduler=org.apache.cassandra.scheduler.NoScheduler; request_timeout_in_ms=10000; roles_validity_in_ms=2000; row_cache_save_period=0; row_cache_size_in_mb=0; rpc_address=10.9.3.220; rpc_keepalive=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;; rpc_port=9160; rpc_server_type=sync; saved_caches_directory=/&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/lib/cassandra/saved_caches; seed_provider=[{class_name=org.apache.cassandra.locator.SimpleSeedProvider, parameters=[{seeds=10.9.3.220, 10.9.3.223}]}]; server_encryption_options=&amp;lt;REDACTED&amp;gt;; snapshot_before_compaction=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;; ssl_storage_port=7001; sstable_preemptive_open_interval_in_mb=50; start_native_transport=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;; start_rpc=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;; storage_port=7000; thrift_framed_transport_size_in_mb=15; tombstone_failure_threshold=100000; tombstone_warn_threshold=1000; tracetype_query_ttl=86400; tracetype_repair_ttl=604800; trickle_fsync=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;; trickle_fsync_interval_in_kb=10240; truncate_request_timeout_in_ms=60000; windows_timer_interval=1; write_request_timeout_in_ms=2000]
INFO  [main] 2015-11-30 15:44:45,622 CassandraDaemon.java:429 - Hostname: sl-prod-cass-01.springer-sbm.com
INFO  [main] 2015-11-30 15:44:45,622 CassandraDaemon.java:436 - JVM vendor/version: Java HotSpot(TM) 64-Bit Server VM/1.8.0_66
INFO  [main] 2015-11-30 15:44:45,622 CassandraDaemon.java:437 - Heap size: 4123000832/4123000832
INFO  [main] 2015-11-30 15:44:45,623 CassandraDaemon.java:440 - Code Cache Non-heap memory: init = 2555904(2496K) used = 3804608(3715K) committed = 3866624(3776K) max = 251658240(245760K)
INFO  [main] 2015-11-30 15:44:45,623 CassandraDaemon.java:440 - Metaspace Non-heap memory: init = 0(0K) used = 15318216(14959K) committed = 15728640(15360K) max = -1(-1K)
INFO  [main] 2015-11-30 15:44:45,623 CassandraDaemon.java:440 - Compressed &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; Space Non-heap memory: init = 0(0K) used = 1909448(1864K) committed = 2097152(2048K) max = 1073741824(1048576K)
INFO  [main] 2015-11-30 15:44:45,623 CassandraDaemon.java:440 - Par Eden Space Heap memory: init = 671088640(655360K) used = 120796576(117965K) committed = 671088640(655360K) max = 671088640(655360K)
INFO  [main] 2015-11-30 15:44:45,623 CassandraDaemon.java:440 - Par Survivor Space Heap memory: init = 83886080(81920K) used = 0(0K) committed = 83886080(81920K) max = 83886080(81920K)
INFO  [main] 2015-11-30 15:44:45,623 CassandraDaemon.java:440 - CMS Old Gen Heap memory: init = 3368026112(3289088K) used = 0(0K) committed = 3368026112(3289088K) max = 3368026112(3289088K)
INFO  [main] 2015-11-30 15:44:45,624 CassandraDaemon.java:442 - Classpath: /etc/cassandra:/usr/share/cassandra/lib/airline-0.6.jar:/usr/share/cassandra/lib/antlr-runtime-3.5.2.jar:/usr/share/cassandra/lib/asm-5.0.4.jar:/usr/share/cassandra/lib/cassandra-driver-core-3.0.0-beta1-bb1bce4-SNAPSHOT-shaded.jar:/usr/share/cassandra/lib/commons-cli-1.1.jar:/usr/share/cassandra/lib/commons-codec-1.2.jar:/usr/share/cassandra/lib/commons-lang3-3.1.jar:/usr/share/cassandra/lib/commons-math3-3.2.jar:/usr/share/cassandra/lib/compress-lzf-0.8.4.jar:/usr/share/cassandra/lib/concurrentlinkedhashmap-lru-1.4.jar:/usr/share/cassandra/lib/disruptor-3.0.1.jar:/usr/share/cassandra/lib/ecj-4.4.2.jar:/usr/share/cassandra/lib/guava-18.0.jar:/usr/share/cassandra/lib/high-scale-lib-1.0.6.jar:/usr/share/cassandra/lib/jackson-core-asl-1.9.2.jar:/usr/share/cassandra/lib/jackson-mapper-asl-1.9.2.jar:/usr/share/cassandra/lib/jamm-0.3.0.jar:/usr/share/cassandra/lib/javax.inject.jar:/usr/share/cassandra/lib/jbcrypt-0.3m.jar:/usr/share/cassandra/lib/jcl-over-slf4j-1.7.7.jar:/usr/share/cassandra/lib/jgrapht-core-0.9.1.jar:/usr/share/cassandra/lib/jna-4.0.0.jar:/usr/share/cassandra/lib/joda-time-2.4.jar:/usr/share/cassandra/lib/json-simple-1.1.jar:/usr/share/cassandra/lib/libthrift-0.9.2.jar:/usr/share/cassandra/lib/log4j-over-slf4j-1.7.7.jar:/usr/share/cassandra/lib/logback-classic-1.1.3.jar:/usr/share/cassandra/lib/logback-core-1.1.3.jar:/usr/share/cassandra/lib/lz4-1.3.0.jar:/usr/share/cassandra/lib/metrics-core-3.1.0.jar:/usr/share/cassandra/lib/metrics-logback-3.1.0.jar:/usr/share/cassandra/lib/netty-all-4.0.23.Final.jar:/usr/share/cassandra/lib/ohc-core-0.4.2.jar:/usr/share/cassandra/lib/ohc-core-j8-0.4.2.jar:/usr/share/cassandra/lib/reporter-config3-3.0.0.jar:/usr/share/cassandra/lib/reporter-config-base-3.0.0.jar:/usr/share/cassandra/lib/sigar-1.6.4.jar:/usr/share/cassandra/lib/slf4j-api-1.7.7.jar:/usr/share/cassandra/lib/snakeyaml-1.11.jar:/usr/share/cassandra/lib/snappy-java-1.1.1.7.jar:/usr/share/cassandra/lib/ST4-4.0.8.jar:/usr/share/cassandra/lib/stream-2.5.2.jar:/usr/share/cassandra/lib/thrift-server-0.3.7.jar:/usr/share/cassandra/apache-cassandra-3.0.0.jar:/usr/share/cassandra/apache-cassandra.jar:/usr/share/cassandra/apache-cassandra-thrift-3.0.0.jar:/usr/share/cassandra/stress.jar::/usr/share/cassandra/lib/jamm-0.3.0.jar
INFO  [main] 2015-11-30 15:44:45,689 CLibrary.java:124 - JNA mlockall successful
WARN  [main] 2015-11-30 15:44:45,690 StartupChecks.java:115 - jemalloc shared library could not be preloaded to speed up memory allocations
WARN  [main] 2015-11-30 15:44:45,690 StartupChecks.java:147 - JMX is not enabled to receive remote connections. Please see cassandra-env.sh &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; more info.
INFO  [main] 2015-11-30 15:44:45,691 SigarLibrary.java:42 - Initializing SIGAR library
WARN  [main] 2015-11-30 15:44:45,700 SigarLibrary.java:167 - Cassandra server running in degraded mode. Is swap disabled? : &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,  Address space adequate? : &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,  nofile limit adequate? : &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, nproc limit adequate? : &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; 
INFO  [main] 2015-11-30 15:44:48,099 ColumnFamilyStore.java:381 - Initializing system.IndexInfo
INFO  [main] 2015-11-30 15:44:48,739 ColumnFamilyStore.java:381 - Initializing system.batches
INFO  [main] 2015-11-30 15:44:48,749 ColumnFamilyStore.java:381 - Initializing system.paxos
INFO  [main] 2015-11-30 15:44:48,770 ColumnFamilyStore.java:381 - Initializing system.local
INFO  [SSTableBatchOpen:1] 2015-11-30 15:44:48,787 BufferPool.java:226 - Global buffer pool is enabled, when pool is exahusted (max is 512 mb) it will allocate on heap
INFO  [main] 2015-11-30 15:44:48,814 CacheService.java:115 - Initializing key cache with capacity of 100 MBs.
INFO  [main] 2015-11-30 15:44:48,821 CacheService.java:137 - Initializing row cache with capacity of 0 MBs
INFO  [main] 2015-11-30 15:44:48,823 CacheService.java:166 - Initializing counter cache with capacity of 50 MBs
INFO  [main] 2015-11-30 15:44:48,824 CacheService.java:177 - Scheduling counter cache save to every 7200 seconds (going to save all keys).
INFO  [main] 2015-11-30 15:44:48,839 ColumnFamilyStore.java:381 - Initializing system.peers
INFO  [main] 2015-11-30 15:44:48,853 ColumnFamilyStore.java:381 - Initializing system.peer_events
INFO  [main] 2015-11-30 15:44:48,862 ColumnFamilyStore.java:381 - Initializing system.range_xfers
INFO  [main] 2015-11-30 15:44:48,915 ColumnFamilyStore.java:381 - Initializing system.compaction_history
INFO  [main] 2015-11-30 15:44:49,085 ColumnFamilyStore.java:381 - Initializing system.sstable_activity
INFO  [main] 2015-11-30 15:44:49,321 ColumnFamilyStore.java:381 - Initializing system.size_estimates
INFO  [main] 2015-11-30 15:44:49,449 ColumnFamilyStore.java:381 - Initializing system.available_ranges
INFO  [main] 2015-11-30 15:44:49,455 ColumnFamilyStore.java:381 - Initializing system.views_builds_in_progress
INFO  [main] 2015-11-30 15:44:49,461 ColumnFamilyStore.java:381 - Initializing system.built_views
INFO  [main] 2015-11-30 15:44:49,570 ColumnFamilyStore.java:381 - Initializing system.hints
INFO  [main] 2015-11-30 15:44:49,577 ColumnFamilyStore.java:381 - Initializing system.batchlog
INFO  [main] 2015-11-30 15:44:49,586 ColumnFamilyStore.java:381 - Initializing system.schema_keyspaces
INFO  [main] 2015-11-30 15:44:49,597 ColumnFamilyStore.java:381 - Initializing system.schema_columnfamilies
INFO  [main] 2015-11-30 15:44:49,609 ColumnFamilyStore.java:381 - Initializing system.schema_columns
INFO  [main] 2015-11-30 15:44:49,620 ColumnFamilyStore.java:381 - Initializing system.schema_triggers
INFO  [main] 2015-11-30 15:44:49,632 ColumnFamilyStore.java:381 - Initializing system.schema_usertypes
INFO  [main] 2015-11-30 15:44:49,643 ColumnFamilyStore.java:381 - Initializing system.schema_functions
INFO  [main] 2015-11-30 15:44:49,651 ColumnFamilyStore.java:381 - Initializing system.schema_aggregates
INFO  [main] 2015-11-30 15:44:49,829 SystemKeyspace.java:1269 - Detected version upgrade from 2.2.1 to 3.0.0, snapshotting system keyspace
ERROR [main] 2015-11-30 15:44:50,164 CassandraDaemon.java:702 - Exception encountered during startup
java.lang.NullPointerException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
	at org.apache.cassandra.io.util.FileUtils.delete(FileUtils.java:374) ~[apache-cassandra-3.0.0.jar:3.0.0]
	at org.apache.cassandra.db.SystemKeyspace.migrateDataDirs(SystemKeyspace.java:1341) ~[apache-cassandra-3.0.0.jar:3.0.0]
	at org.apache.cassandra.service.CassandraDaemon.setup(CassandraDaemon.java:180) [apache-cassandra-3.0.0.jar:3.0.0]
	at org.apache.cassandra.service.CassandraDaemon.activate(CassandraDaemon.java:561) [apache-cassandra-3.0.0.jar:3.0.0]
	at org.apache.cassandra.service.CassandraDaemon.main(CassandraDaemon.java:689) [apache-cassandra-3.0.0.jar:3.0.0]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15033953" author="tomas0413" created="Tue, 1 Dec 2015 16:08:25 +0000"  >&lt;p&gt;Here is TRACE level logging:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;TRACE [MemtablePostFlush:1] 2015-12-01 16:47:52,675 ColumnFamilyStore.java:868 - forceFlush requested but everything is clean in schema_columns
TRACE [main] 2015-12-01 16:47:52,675 ColumnFamilyStore.java:1563 - Snapshot &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; Keyspace(name=&lt;span class=&quot;code-quote&quot;&gt;&apos;system&apos;&lt;/span&gt;) keyspace data file /data/system/schema_columns-296e9c049bec3085827dc17d3df2122a/la-46-big-Data.db created in /data/system/schema_columns-296e9c049bec3085827dc17d3df2122a/snapshots/1448984872341-upgrade-2.2.1-3.0.0
TRACE [main] 2015-12-01 16:47:52,676 ColumnFamilyStore.java:1563 - Snapshot &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; Keyspace(name=&lt;span class=&quot;code-quote&quot;&gt;&apos;system&apos;&lt;/span&gt;) keyspace data file /data/system/schema_columns-296e9c049bec3085827dc17d3df2122a/la-45-big-Data.db created in /data/system/schema_columns-296e9c049bec3085827dc17d3df2122a/snapshots/1448984872341-upgrade-2.2.1-3.0.0
TRACE [main] 2015-12-01 16:47:52,676 ColumnFamilyStore.java:1563 - Snapshot &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; Keyspace(name=&lt;span class=&quot;code-quote&quot;&gt;&apos;system&apos;&lt;/span&gt;) keyspace data file /data/system/schema_columns-296e9c049bec3085827dc17d3df2122a/la-47-big-Data.db created in /data/system/schema_columns-296e9c049bec3085827dc17d3df2122a/snapshots/1448984872341-upgrade-2.2.1-3.0.0
TRACE [main] 2015-12-01 16:47:52,676 SystemKeyspace.java:1327 - Checking directory /data &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; old files
ERROR [main] 2015-12-01 16:47:52,751 CassandraDaemon.java:702 - Exception encountered during startup
java.lang.NullPointerException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
	at org.apache.cassandra.io.util.FileUtils.delete(FileUtils.java:374) ~[apache-cassandra-3.0.0.jar:3.0.0]
	at org.apache.cassandra.db.SystemKeyspace.migrateDataDirs(SystemKeyspace.java:1341) ~[apache-cassandra-3.0.0.jar:3.0.0]
	at org.apache.cassandra.service.CassandraDaemon.setup(CassandraDaemon.java:180) [apache-cassandra-3.0.0.jar:3.0.0]
	at org.apache.cassandra.service.CassandraDaemon.activate(CassandraDaemon.java:561) [apache-cassandra-3.0.0.jar:3.0.0]
	at org.apache.cassandra.service.CassandraDaemon.main(CassandraDaemon.java:689) [apache-cassandra-3.0.0.jar:3.0.0]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It looks like the code is expected legacy files under /data directory but it can&apos;t find any and call FileUtils.delete(null).&lt;/p&gt;</comment>
                            <comment id="15034463" author="philipthompson" created="Tue, 1 Dec 2015 19:48:46 +0000"  >&lt;p&gt;Do you have this issue upgrading from 2.2.3 as well?&lt;/p&gt;</comment>
                            <comment id="15035108" author="stefania" created="Wed, 2 Dec 2015 02:00:11 +0000"  >&lt;p&gt;This would happen if for some reason we have a file instead of a folder in the keyspace folder. I reproduced it with a new unit test, we had a bug in our directory filter. I&apos;ve also added a couple more trace messages.&lt;/p&gt;

&lt;p&gt;Patches and CI are here:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.0&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.1&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/10788-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/10788-3.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/10788&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10788-3.0-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10788-3.1-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10788-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10788-3.0-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10788-3.1-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10788-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15035115" author="stefania" created="Wed, 2 Dec 2015 02:05:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tomas0413&quot; class=&quot;user-hover&quot; rel=&quot;tomas0413&quot;&gt;tomas0413&lt;/a&gt;: could you please test the 3.0 patch to confirm it fixes your issue? Alternatively could you confirm if you have files in your keyspace folders?&lt;/p&gt;</comment>
                            <comment id="15035460" author="krummas" created="Wed, 2 Dec 2015 08:27:34 +0000"  >&lt;p&gt;+1 unless the dtests break&lt;/p&gt;</comment>
                            <comment id="15035488" author="stefania" created="Wed, 2 Dec 2015 08:57:19 +0000"  >&lt;p&gt;I think the new unit test may be causing &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/stef1927/job/stef1927-10788-3.0-testall/lastCompletedBuild/testReport/org.apache.cassandra.db/SystemKeyspaceTest/testLocalTokens/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this problem&lt;/a&gt;. I need to take a look, perhaps each test case runs in parallel, in which case wiping the data folder is a bad idea.&lt;/p&gt;

&lt;p&gt;As for the dtests, we need to pay particular attention to the upgrade tests.&lt;/p&gt;</comment>
                            <comment id="15035631" author="tomas0413" created="Wed, 2 Dec 2015 10:53:05 +0000"  >&lt;p&gt;Thanks, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Stefania&quot; class=&quot;user-hover&quot; rel=&quot;stefania&quot;&gt;Stefania&lt;/a&gt;! I&apos;ll check it this morning. Also quick question (I&apos;m new to Cassandra) - is there a binary patch available somewhere or do I have to build it myself from the source code?&lt;/p&gt;</comment>
                            <comment id="15035643" author="tomas0413" created="Wed, 2 Dec 2015 11:05:58 +0000"  >&lt;p&gt;I downloaded &lt;a href=&quot;http://cassci.datastax.com/view/cassandra-3.0/job/cassandra-3.0/lastSuccessfulBuild/artifact/build/apache-cassandra-3.0.0-SNAPSHOT-bin.tar.gz&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/cassandra-3.0/job/cassandra-3.0/lastSuccessfulBuild/artifact/build/apache-cassandra-3.0.0-SNAPSHOT-bin.tar.gz&lt;/a&gt; and &lt;a href=&quot;http://cassci.datastax.com/view/cassandra-3.0/job/cassandra-3.0/lastSuccessfulBuild/artifact/build/apache-cassandra-3.0.0-SNAPSHOT-src.tar.gz&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cassci.datastax.com/view/cassandra-3.0/job/cassandra-3.0/lastSuccessfulBuild/artifact/build/apache-cassandra-3.0.0-SNAPSHOT-src.tar.gz&lt;/a&gt;, but in the source code I see the code without a fix in SystemKeyspace.java&lt;/p&gt;</comment>
                            <comment id="15035663" author="stefania" created="Wed, 2 Dec 2015 11:25:08 +0000"  >&lt;p&gt;It has not been committed yet, you can build my github branch if you want to test it today:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/stef1927/cassandra/commits/10788-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/stef1927/cassandra/commits/10788-3.0&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Instructions &lt;a href=&quot;https://wiki.apache.org/cassandra/HowToBuild&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; but they are a bit old, specifically you need Java 8, not 7. Then &lt;em&gt;ant build&lt;/em&gt; should be sufficient.&lt;/p&gt;</comment>
                            <comment id="15035707" author="tomas0413" created="Wed, 2 Dec 2015 12:16:13 +0000"  >&lt;p&gt;Thanks, it worked! I was able to build apache-cassandra-3.0.0-SNAPSHOT.jar and starting Cassandra 3.0 doesn&apos;t throw NullPointerException anymore.&lt;/p&gt;</comment>
                            <comment id="15035743" author="tomas0413" created="Wed, 2 Dec 2015 12:50:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Stefania&quot; class=&quot;user-hover&quot; rel=&quot;stefania&quot;&gt;Stefania&lt;/a&gt; I&apos;m running 3.0 version on one node (the other 5 are running 2.2.1). Currently compaction jobs are in progress on the node running 3.0 version. &lt;br/&gt;
After jobs are finished, I&apos;d like to stop Cassandra and put the original JAR in place (downgrade from 3.0.0-SNAPSHOT to 3.0.0). Should this work?&lt;/p&gt;

&lt;p&gt;I see this when I connect to 3.0 node using cqlsh:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;cqlsh 5.0.1 | Cassandra 3.0.0-SNAPSHOT | CQL spec 3.3.1 | Native protocol v4&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="15036000" author="stefania" created="Wed, 2 Dec 2015 15:52:31 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;d like to stop Cassandra and put the original JAR in place (downgrade from 3.0.0-SNAPSHOT to 3.0.0). Should this work?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It should because the code with the bug only runs during an upgrade, if the data was migrated correctly to 3.0, then that code should not run, at least that&apos;s the theory. &lt;/p&gt;</comment>
                            <comment id="15037705" author="tomas0413" created="Thu, 3 Dec 2015 11:50:19 +0000"  >&lt;p&gt;It doesn&apos;t work:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;INFO  [main] 2015-12-03 12:46:20,346 SystemKeyspace.java:1269 - Detected version upgrade from 3.0.0-SNAPSHOT to 3.0.0, snapshotting system keyspace
ERROR [main] 2015-12-03 12:46:20,411 CassandraDaemon.java:702 - Exception encountered during startup
java.lang.NullPointerException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
	at org.apache.cassandra.io.util.FileUtils.delete(FileUtils.java:374) ~[apache-cassandra-3.0.0.jar:3.0.0]
	at org.apache.cassandra.db.SystemKeyspace.migrateDataDirs(SystemKeyspace.java:1341) ~[apache-cassandra-3.0.0.jar:3.0.0]
	at org.apache.cassandra.service.CassandraDaemon.setup(CassandraDaemon.java:180) [apache-cassandra-3.0.0.jar:3.0.0]
	at org.apache.cassandra.service.CassandraDaemon.activate(CassandraDaemon.java:561) [apache-cassandra-3.0.0.jar:3.0.0]
	at org.apache.cassandra.service.CassandraDaemon.main(CassandraDaemon.java:689) [apache-cassandra-3.0.0.jar:3.0.0]
^C
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Do you know if the new 3.0.x version will be released soon that will have this patch included?&lt;/p&gt;</comment>
                            <comment id="15039771" author="stefania" created="Fri, 4 Dec 2015 05:28:27 +0000"  >&lt;p&gt;This is where the existing version comes from:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;SELECT release_version FROM system.local WHERE key=&lt;span class=&quot;code-quote&quot;&gt;&apos;local&apos;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;ll mark this patch for our next release, 3.0.1/3.1; we release with cycles of approximately one month.&lt;/p&gt;</comment>
                            <comment id="15039773" author="stefania" created="Fri, 4 Dec 2015 05:35:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=krummas&quot; class=&quot;user-hover&quot; rel=&quot;krummas&quot;&gt;krummas&lt;/a&gt;: fixed utest, rebased and restarted CI.&lt;/p&gt;</comment>
                            <comment id="15041246" author="krummas" created="Fri, 4 Dec 2015 08:10:55 +0000"  >&lt;p&gt;I needed a tiny fix to be able to run the unit test alone from IDE: &lt;a href=&quot;https://github.com/krummas/cassandra/commits/stef/10788-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/krummas/cassandra/commits/stef/10788-3.0&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;other than that, I am +1 and will commit once dtests pass&lt;/p&gt;</comment>
                            <comment id="15041257" author="stefania" created="Fri, 4 Dec 2015 08:21:17 +0000"  >&lt;p&gt;Thanks for the fix!&lt;/p&gt;</comment>
                            <comment id="15041489" author="stefania" created="Fri, 4 Dec 2015 11:59:19 +0000"  >&lt;p&gt;CI completed, it seems OK to me.&lt;/p&gt;</comment>
                            <comment id="15041551" author="krummas" created="Fri, 4 Dec 2015 13:30:06 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                            <comment id="15048517" author="tomas0413" created="Wed, 9 Dec 2015 11:25:34 +0000"  >&lt;p&gt;Thanks everyone! I&apos;m rolling out 3.1 version now that the bug fix is included in 3.1. Everything seems to be working well at the moment.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[stefania]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 49 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2p2hr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>marcuse</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>