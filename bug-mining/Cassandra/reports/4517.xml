<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:05:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-12454] Unable to start on IPv6-only node with local JMX</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-12454</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;A Cassandra node using &lt;b&gt;default&lt;/b&gt; configuration is unable to start on &lt;b&gt;IPv6-only&lt;/b&gt; machine with the following error message:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [main] 2016-08-13 14:38:07,309 CassandraDaemon.java:731 - Bad URL path: :0:0:0:0:0:1/jndi/rmi:&lt;span class=&quot;code-comment&quot;&gt;//0:0:0:0:0:0:0:1:7199/jmxrmi&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The problem might be located in &lt;tt&gt;JMXServerUtils.createJMXServer()&lt;/tt&gt; (I am not sure, because there is no stack trace in &lt;tt&gt;system.log&lt;/tt&gt;):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; urlTemplate = &lt;span class=&quot;code-quote&quot;&gt;&quot;service:jmx:rmi:&lt;span class=&quot;code-comment&quot;&gt;//%1$s/jndi/rmi://%1$s:%2$d/jmxrmi&quot;&lt;/span&gt;;
&lt;/span&gt;...
&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; url = &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.format(urlTemplate, (serverAddress != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? serverAddress.getHostAddress() : &lt;span class=&quot;code-quote&quot;&gt;&quot;0.0.0.0&quot;&lt;/span&gt;), port);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;IPv6 addresses must be surrounded by square brackets when passed to &lt;tt&gt;JMXServiceURL&lt;/tt&gt;.&lt;br/&gt;
Disabling &lt;tt&gt;LOCAL_JMX&lt;/tt&gt; mode in &lt;tt&gt;cassandra-env.sh&lt;/tt&gt; (and enabling JMX authentication) helps.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Ubuntu Trusty, Oracle JDK 1.8.0_102-b14, IPv6-only host&lt;/p&gt;</environment>
        <key id="12997138">CASSANDRA-12454</key>
            <summary>Unable to start on IPv6-only node with local JMX</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="samt">Sam Tunnicliffe</assignee>
                                    <reporter username="incubos">Vadim Tsesko</reporter>
                        <labels>
                    </labels>
                <created>Sat, 13 Aug 2016 15:35:29 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:22 +0000</updated>
                            <resolved>Wed, 26 Oct 2016 16:49:06 +0000</resolved>
                                        <fixVersion>3.10</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15419969" author="incubos" created="Sat, 13 Aug 2016 15:36:45 +0000"  >&lt;p&gt;The patch:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;diff --git a/src/java/org/apache/cassandra/utils/JMXServerUtils.java b/src/java/org/apache/cassandra/utils/JMXServerUtils.java
index ad87efd..e420600 100644
--- a/src/java/org/apache/cassandra/utils/JMXServerUtils.java
+++ b/src/java/org/apache/cassandra/utils/JMXServerUtils.java
@@ -22,6 +22,8 @@ &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io.IOException;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.lang.management.ManagementFactory;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.lang.reflect.InvocationHandler;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.lang.reflect.Proxy;
+&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.net.Inet4Address;
+&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.net.Inet6Address;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.net.InetAddress;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.rmi.NoSuchObjectException;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.rmi.Remote;
@@ -76,7 +78,18 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;JMXServerUtils
         &lt;span class=&quot;code-comment&quot;&gt;// Configure the RMI client &amp;amp; server socket factories, including SSL config.
&lt;/span&gt;         env.putAll(configureJmxSocketFactories(serverAddress));

-        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; url = &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.format(urlTemplate, (serverAddress != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? serverAddress.getHostAddress() : &lt;span class=&quot;code-quote&quot;&gt;&quot;0.0.0.0&quot;&lt;/span&gt;), port);
+        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; hostAddress;
+        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (serverAddress == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
+            hostAddress = &lt;span class=&quot;code-quote&quot;&gt;&quot;0.0.0.0&quot;&lt;/span&gt;;
+        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (serverAddress &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; Inet4Address) {
+            hostAddress = serverAddress.getHostAddress();
+        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (serverAddress &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; Inet6Address) {
+            hostAddress = &lt;span class=&quot;code-quote&quot;&gt;&apos;[&apos;&lt;/span&gt; + serverAddress.getHostAddress() + &lt;span class=&quot;code-quote&quot;&gt;&apos;]&apos;&lt;/span&gt;;
+        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
+            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; UnsupportedOperationException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Unsupported InetAddress&quot;&lt;/span&gt;);
+        }
+
+        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; url = &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.format(urlTemplate, hostAddress, port);
         LocateRegistry.createRegistry(port,
                                      (RMIClientSocketFactory) env.get(RMIConnectorServer.RMI_CLIENT_SOCKET_FACTORY_ATTRIBUTE),
                                      (RMIServerSocketFactory) env.get(RMIConnectorServer.RMI_SERVER_SOCKET_FACTORY_ATTRIBUTE));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;And the result in &lt;tt&gt;LOCAL_JMX&lt;/tt&gt; mode:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;INFO  [main] 2016-08-13 18:51:36,511 JMXServerUtils.java:121 - Configured JMX server at: service:jmx:rmi:&lt;span class=&quot;code-comment&quot;&gt;//[0:0:0:0:0:0:0:1]/jndi/rmi://[0:0:0:0:0:0:0:1]:7199/jmxrmi&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15433318" author="beobal" created="Tue, 23 Aug 2016 18:10:55 +0000"  >&lt;p&gt;I believe this has already been addressed as a byproduct of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12109&quot; title=&quot;Configuring SSL for JMX connections forces requirement of local truststore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12109&quot;&gt;&lt;del&gt;CASSANDRA-12109&lt;/del&gt;&lt;/a&gt;, which will be in the upcoming 3.8 (&amp;amp; 3.9). There, the URL string is still incorrectly formatted but it is used only for logging,  not to construct a &lt;tt&gt;JMXServiceURL&lt;/tt&gt;. In my testing, this enables the JMX server to be initialised correctly. However, it does still log the incorrectly formatted service URL, which doesn&apos;t make for a great user experience as it will need modifying to include the &lt;tt&gt;[]&lt;/tt&gt; before use. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=incubos&quot; class=&quot;user-hover&quot; rel=&quot;incubos&quot;&gt;incubos&lt;/a&gt; if you&apos;re able to build from source, could you confirm that this works as expected in your setup with 3.8 please? I&apos;ll fix the incorrect log message and resolve this ticket if so.&lt;/p&gt;</comment>
                            <comment id="15434907" author="incubos" created="Wed, 24 Aug 2016 13:15:07 +0000"  >&lt;p&gt;Having tested &lt;tt&gt;cassandra-3.8&lt;/tt&gt; and &lt;tt&gt;cassandra-3.9&lt;/tt&gt; branches I confirm that &lt;tt&gt;LOCAL_JMX&lt;/tt&gt; mode works properly on IPv6-only machines.&lt;br/&gt;
Thank you.&lt;/p&gt;</comment>
                            <comment id="15436897" author="beobal" created="Thu, 25 Aug 2016 13:55:17 +0000"  >&lt;p&gt;Trivial patch for trunk which formats the JMX service URL correctly when logging. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/beobal/cassandra/commit/8275513373e888eb856126ccd6609397bf85f029&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/beobal/cassandra/commit/8275513373e888eb856126ccd6609397bf85f029&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15555225" author="ifesdjeen" created="Fri, 7 Oct 2016 14:28:06 +0000"  >&lt;p&gt;+1 for the patch. &lt;/p&gt;

&lt;p&gt;I know the change is harmless but to exclude human error (like imports or some other minor thing), I&apos;ve still triggered a CI. Hope you don&apos;t mind:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/ifesdjeen/cassandra/tree/12454-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-12454-trunk-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-12454-trunk-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/ifesdjeen/cassandra/tree/12454-3.X&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.X&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-12454-3.X-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://cassci.datastax.com/view/Dev/view/ifesdjeen/job/ifesdjeen-12454-3.X-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15608987" author="beobal" created="Wed, 26 Oct 2016 16:49:08 +0000"  >&lt;p&gt;Thanks for the review &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ifesdjeen&quot; class=&quot;user-hover&quot; rel=&quot;ifesdjeen&quot;&gt;ifesdjeen&lt;/a&gt;, committed to 3.X in &lt;tt&gt;bdd4a927fa13e9beff3bdc342ea6fe762b9997dc&lt;/tt&gt; and merged to trunk&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[samt]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 3 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i32ajb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>ifesdjeen</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[ifesdjeen]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12335693">3.7</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>