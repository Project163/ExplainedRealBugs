<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:19:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-1761] Indexes: Auto-generating the CFname may collide with user-generated names</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-1761</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;column_families:
  - name: CF
    comparator: BytesType
    column_metadata: 
      - name: foo
        index_name: 626172
        index_type: KEYS
      - name: bar
        index_type: KEYS&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Auto-generated versus user-supplied names collide in the YAML above. The code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;cfname = parentCf + &lt;span class=&quot;code-quote&quot;&gt;&quot;.&quot;&lt;/span&gt; + (info.getIndexName() == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? FBUtilities.bytesToHex(info.name) : info.getIndexName())&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;From the first ColumnDefinition, we create cfname = &quot;CF.626172&quot; (from the fail clause of the ternany, user-supplied name)&lt;br/&gt;
From the second ColumnDefinition, we create cfname = &quot;CF.626172&quot; (from the pass clause of the ternary, we generate the name)&lt;/p&gt;

&lt;p&gt;They&apos;re in hex form. This is possible, but fairly unlikely that someone will do this.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12480462">CASSANDRA-1761</key>
            <summary>Indexes: Auto-generating the CFname may collide with user-generated names</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jhermes">Jon Hermes</assignee>
                                    <reporter username="jhermes">Jon Hermes</reporter>
                        <labels>
                    </labels>
                <created>Fri, 19 Nov 2010 22:51:27 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:13 +0000</updated>
                            <resolved>Tue, 15 Mar 2011 16:27:04 +0000</resolved>
                                        <fixVersion>0.7.5</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="57600">16h</timeoriginalestimate>
                            <timeestimate seconds="57600">16h</timeestimate>
                                        <comments>
                            <comment id="12934061" author="jhermes" created="Sat, 20 Nov 2010 00:05:07 +0000"  >&lt;p&gt;CF.bar -&amp;gt; CF.626172.&lt;/p&gt;</comment>
                            <comment id="12972254" author="jbellis" created="Thu, 16 Dec 2010 22:33:14 +0000"  >&lt;p&gt;This will require some re-organization to solve.  Currently, ColumnDefinition index_name is just copied from CfDef and may be null; final index name is determined by CFMetaData.newIndexMetadata, which has no context as to what other indexes exist in the CF.&lt;/p&gt;

&lt;p&gt;What we should do is create the final index name at the CassandraServer level, and validate at that point that it does not cause conflicts with existing ones.  (Also: index_name and index_type fields of CD become final.)&lt;/p&gt;

&lt;p&gt;(This lets us return appropriate InvalidRequest exceptions to the client instead of failing with an internal error, too.)&lt;/p&gt;

&lt;p&gt;Then by the time we get to addIndex/newIndexMetadata, all we need to do is a final sanity check as a defense against users violating the one-schema-change-at-a-time rule.&lt;/p&gt;</comment>
                            <comment id="13006729" author="jhermes" created="Mon, 14 Mar 2011 23:59:45 +0000"  >&lt;p&gt;Because the column_metadata has to be passed in full, it can be fully validated in ThriftValidation of the cf_def in the system_&lt;/p&gt;
{update,add}
&lt;p&gt;_column_family and system_add_keyspace calls.&lt;/p&gt;

&lt;p&gt;In related news, I also found out that we never validated CfDefs in system_update_column_family, so I&apos;m surprised to say the least and glad it was found in an innocuous bug instead of something more serious.&lt;/p&gt;

&lt;p&gt;As for the one-schema-change-at-a-time rule, this is now enforced by default with validateSchemaAgreement() calls in CassandraServer.&lt;/p&gt;</comment>
                            <comment id="13006730" author="jhermes" created="Tue, 15 Mar 2011 00:03:09 +0000"  >&lt;p&gt;Also attaching repro script.&lt;/p&gt;

&lt;p&gt;Without patch you should see an error trying to register an MBean twice, and the first index will no longer work.&lt;br/&gt;
After patch you should see an IRE.&lt;/p&gt;</comment>
                            <comment id="13006733" author="jhermes" created="Tue, 15 Mar 2011 00:11:49 +0000"  >&lt;p&gt;1761.txt is for trunk.&lt;br/&gt;
1761-0.7.txt is for 0.7*.&lt;/p&gt;

&lt;p&gt;(Slight difference in imports makes it not apply cleanly.)&lt;/p&gt;</comment>
                            <comment id="13006994" author="jbellis" created="Tue, 15 Mar 2011 16:27:04 +0000"  >&lt;p&gt;committed w/ some improvements:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;added a system test&lt;/li&gt;
	&lt;li&gt;fix migration failure to throw InternalError back to client instead of InvalidRequestException (a bug found by the new test)&lt;/li&gt;
	&lt;li&gt;use Set instead of List for .contains checks&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13007009" author="hudson" created="Tue, 15 Mar 2011 16:46:45 +0000"  >&lt;p&gt;Integrated in Cassandra-0.7 #382 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Cassandra-0.7/382/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hudson.apache.org/hudson/job/Cassandra-0.7/382/&lt;/a&gt;)&lt;br/&gt;
    validate index names&lt;br/&gt;
patch by jhermes and jbellis for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1761&quot; title=&quot;Indexes: Auto-generating the CFname may collide with user-generated names&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1761&quot;&gt;&lt;del&gt;CASSANDRA-1761&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12473640" name="1761-0.7.txt" size="2539" author="jhermes" created="Tue, 15 Mar 2011 00:11:49 +0000"/>
                            <attachment id="12473638" name="1761.txt" size="2427" author="jhermes" created="Tue, 15 Mar 2011 00:00:28 +0000"/>
                            <attachment id="12473639" name="repro.cli" size="393" author="jhermes" created="Tue, 15 Mar 2011 00:03:09 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jhermes]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20298</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 37 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0g787:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>92601</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>