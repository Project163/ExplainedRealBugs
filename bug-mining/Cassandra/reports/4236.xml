<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:02:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-11654] sstabledump is not able to properly print out SSTable that may contain historical (but &quot;shadowed&quot;) row tombstone</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-11654</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;It is pretty trivial to reproduce. Here are the steps I used (on a single node C* 3.x cluster):&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;echo &quot;CREATE KEYSPACE IF NOT EXISTS testks WITH replication = {&apos;class&apos;: &apos;SimpleStrategy&apos;, &apos;replication_factor&apos;: &apos;1&apos;};&quot; | cqlsh
echo &quot;CREATE TABLE IF NOT EXISTS testks.testcf ( k int, c text, val0_int int, PRIMARY KEY (k, c) );&quot; | cqlsh
echo &quot;INSERT INTO testks.testcf (k, c, val0_int) VALUES (1, &apos;c1&apos;, 100);&quot; | cqlsh
echo &quot;DELETE FROM testks.testcf where k=1 and c=&apos;c1&apos;;&quot; | cqlsh
echo &quot;INSERT INTO testks.testcf (k, c, val0_int) VALUES (1, &apos;c1&apos;, 100);&quot; | cqlsh
nodetool flush testks testcf
echo &quot;SELECT * FROM testks.testcf;&quot; | cqlsh
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The last step from above will confirm that there is one live row in the testks.testcf table. However, if you now go to the actual SSTable file directory and run sstabledump like the following, you will see the row is still marked as deleted and no row content is shown:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ sstabledump ma-1-big-Data.db
[
  {
    &quot;partition&quot; : {
      &quot;key&quot; : [ &quot;1&quot; ],
      &quot;position&quot; : 0
    },
    &quot;rows&quot; : [
      {
        &quot;type&quot; : &quot;row&quot;,
        &quot;position&quot; : 18,
        &quot;clustering&quot; : [ &quot;c1&quot; ],
        &quot;liveness_info&quot; : { &quot;tstamp&quot; : 1461633248542342 },
        &quot;deletion_info&quot; : { &quot;deletion_time&quot; : 1461633248212499, &quot;tstamp&quot; : 1461633248 }
      }
    ]
  }
]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is reproduced in both latest 3.0.5 and 3.6-snapshot (i.e. trunk as of Apr 25, 2016).&lt;/p&gt;

&lt;p&gt;Looks like only row tombstone is affecting sstabledump. If you generate cell tombstones, even if you delete all non-PK &amp;amp; non-static columns in the row, as long as there is no explicit row delete (so the clustering is still considered alive), sstabledump will work just fine, see the following example steps:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;echo &quot;CREATE KEYSPACE IF NOT EXISTS testks WITH replication = {&apos;class&apos;: &apos;SimpleStrategy&apos;, &apos;replication_factor&apos;: &apos;1&apos;};&quot; | cqlsh
echo &quot;CREATE TABLE IF NOT EXISTS testks.testcf ( k int, c text, val0_int int, val1_int int, PRIMARY KEY (k, c) );&quot; | cqlsh
echo &quot;INSERT INTO testks.testcf (k, c, val0_int, val1_int) VALUES (1, &apos;c1&apos;, 100, 200);&quot; | cqlsh
echo &quot;DELETE val0_int, val1_int FROM testks.testcf where k=1 and c=&apos;c1&apos;;&quot; | cqlsh
echo &quot;INSERT INTO testks.testcf (k, c, val0_int, val1_int) VALUES (1, &apos;c1&apos;, 300, 400);&quot; | cqlsh
nodetool flush testks testcf
echo &quot;select * from testks.testcf;&quot; | cqlsh

$ sstabledump ma-1-big-Data.db
[
  {
    &quot;partition&quot; : {
      &quot;key&quot; : [ &quot;1&quot; ],
      &quot;position&quot; : 0
    },
    &quot;rows&quot; : [
      {
        &quot;type&quot; : &quot;row&quot;,
        &quot;position&quot; : 18,
        &quot;clustering&quot; : [ &quot;c1&quot; ],
        &quot;liveness_info&quot; : { &quot;tstamp&quot; : 1461634633566479 },
        &quot;cells&quot; : [
          { &quot;name&quot; : &quot;val0_int&quot;, &quot;value&quot; : &quot;300&quot; },
          { &quot;name&quot; : &quot;val1_int&quot;, &quot;value&quot; : &quot;400&quot; }
        ]
      }
    ]
  }
]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12962450">CASSANDRA-11654</key>
            <summary>sstabledump is not able to properly print out SSTable that may contain historical (but &quot;shadowed&quot;) row tombstone</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yukim">Yuki Morishita</assignee>
                                    <reporter username="weideng">Wei Deng</reporter>
                        <labels>
                            <label>Tools</label>
                    </labels>
                <created>Tue, 26 Apr 2016 01:22:40 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:35 +0000</updated>
                            <resolved>Tue, 26 Apr 2016 13:08:34 +0000</resolved>
                                        <fixVersion>3.0.6</fixVersion>
                    <fixVersion>3.6</fixVersion>
                                    <component>Legacy/Tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15257394" author="weideng" created="Tue, 26 Apr 2016 01:29:41 +0000"  >&lt;p&gt;BTW, this issue doesn&apos;t exist on sstable2json from C* 2.1. However, because sstabledump is a complete rewrite I don&apos;t think that information is quite relevant. It just proves that this problem is real for C* 3.x.&lt;/p&gt;</comment>
                            <comment id="15257449" author="yukim" created="Tue, 26 Apr 2016 02:27:08 +0000"  >&lt;p&gt;I think we can just dump cells regardless of deletion.&lt;br/&gt;
patch here: &lt;a href=&quot;https://github.com/yukim/cassandra/tree/11654-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/yukim/cassandra/tree/11654-3.0&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-javascript&quot;&gt;[
  {
    &lt;span class=&quot;code-quote&quot;&gt;&quot;partition&quot;&lt;/span&gt; : {
      &lt;span class=&quot;code-quote&quot;&gt;&quot;key&quot;&lt;/span&gt; : [ &lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; ],
      &lt;span class=&quot;code-quote&quot;&gt;&quot;position&quot;&lt;/span&gt; : 0
    },
    &lt;span class=&quot;code-quote&quot;&gt;&quot;rows&quot;&lt;/span&gt; : [
      {
        &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;row&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;position&quot;&lt;/span&gt; : 18,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;clustering&quot;&lt;/span&gt; : [ &lt;span class=&quot;code-quote&quot;&gt;&quot;c1&quot;&lt;/span&gt; ],
        &lt;span class=&quot;code-quote&quot;&gt;&quot;liveness_info&quot;&lt;/span&gt; : { &lt;span class=&quot;code-quote&quot;&gt;&quot;tstamp&quot;&lt;/span&gt; : 1461635395769314 },
        &lt;span class=&quot;code-quote&quot;&gt;&quot;deletion_info&quot;&lt;/span&gt; : { &lt;span class=&quot;code-quote&quot;&gt;&quot;deletion_time&quot;&lt;/span&gt; : 1461635395766379, &lt;span class=&quot;code-quote&quot;&gt;&quot;tstamp&quot;&lt;/span&gt; : 1461635395 },
        &lt;span class=&quot;code-quote&quot;&gt;&quot;cells&quot;&lt;/span&gt; : [
          { &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;val0_int&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;value&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;100&quot;&lt;/span&gt; }
        ]
      }
    ]
  }
]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Similar to what we get with &lt;tt&gt;sstabledump -d&lt;/tt&gt;:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[1]@0 Row[info=[ts=1461635395769314] del=deletedAt=1461635395766379, localDeletion=1461635395 ]: c1 | [val0_int=100 ts=1461635395769314]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15257472" author="cnlwsu" created="Tue, 26 Apr 2016 03:02:03 +0000"  >&lt;p&gt;+1, get a&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;cells&quot;&lt;/span&gt; : [ ]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;with tombstones but I think thats good.&lt;/p&gt;</comment>
                            <comment id="15257534" author="weideng" created="Tue, 26 Apr 2016 04:12:17 +0000"  >&lt;p&gt;+1 looks good with Yuki&apos;s patch.&lt;/p&gt;</comment>
                            <comment id="15258040" author="yukim" created="Tue, 26 Apr 2016 13:04:40 +0000"  >&lt;p&gt;Thanks for review, tests seems not broken, will commit.&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;testall&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;dtest&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/yukim/cassandra/tree/11654-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;11654-3.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/yukim/job/yukim-11654-3.0-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/yukim/job/yukim-11654-3.0-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15258048" author="yukim" created="Tue, 26 Apr 2016 13:08:34 +0000"  >&lt;p&gt;Committed as &lt;tt&gt;049d70c2e6654317978f23b6901dff524f5d1674&lt;/tt&gt;, thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[yukim]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 30 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2wq53:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12334792">3.0.4</customfieldvalue>
    <customfieldvalue id="12334964">3.0.5</customfieldvalue>
    <customfieldvalue id="12335055">3.6</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>cnlwsu</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[cnlwsu]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12334792">3.0.4</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>