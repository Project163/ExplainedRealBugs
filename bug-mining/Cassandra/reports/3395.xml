<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:51:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-8797] Tuple relation in select query is broken</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-8797</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Cassandra version 2.011 (and 2.0.12) &lt;/p&gt;

&lt;p&gt;1) Login to CQLSH&lt;/p&gt;

&lt;p&gt;2) Create a keyspace as below:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;CREATE TABLE test1 (campId int,grpId int,itmtypeId int, itemId int, PRIMARY KEY((campId, grpId), itmtypeId, itemid));&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;3) Insert 10 rows&lt;/p&gt;

&lt;p&gt;4) Run &lt;tt&gt;select * from test1&lt;/tt&gt; and it works&lt;/p&gt;

&lt;p&gt;5) Run a select query as below:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;select * from test1 where token(campid, grpid) = token(987654321, 4) and (itmtypeid, itemid) &amp;gt; (12347, 1234567812);&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;It fails with error &apos;TSocket read 0 bytes&apos;&lt;/p&gt;

&lt;p&gt;6) The actual error in the Cassandra server log is as below:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [Thrift:2] 2015-02-13 16:22:41,269 CustomTThreadPoolServer.java (line 222) Error occurred during processing of message.
java.lang.ClassCastException: org.apache.cassandra.cql3.MultiColumnRelation cannot be &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; to org.apache.cassandra.cql3.SingleColumnRelation 
at org.apache.cassandra.cql3.statements.SelectStatement$RawStatement.checkTokenFunctionArgumentsOrder(SelectStatement.java:1887)
at org.apache.cassandra.cql3.statements.SelectStatement$RawStatement.processPartitionKeyRestrictions(SelectStatement.java:1873)
at org.apache.cassandra.cql3.statements.SelectStatement$RawStatement.prepare(SelectStatement.java:1494)
at org.apache.cassandra.cql3.QueryProcessor.getStatement(QueryProcessor.java:333)
at org.apache.cassandra.cql3.QueryProcessor.process(QueryProcessor.java:171)
at org.apache.cassandra.thrift.CassandraServer.execute_cql3_query(CassandraServer.java:1958)
at org.apache.cassandra.thrift.Cassandra$Processor$execute_cql3_query.getResult(Cassandra.java:4486)
at org.apache.cassandra.thrift.Cassandra$Processor$execute_cql3_query.getResult(Cassandra.java:4470)
at org.apache.thrift.ProcessFunction.process(ProcessFunction.java:39)
at org.apache.thrift.TBaseProcessor.process(TBaseProcessor.java:39)
at org.apache.cassandra.thrift.CustomTThreadPoolServer$WorkerProcess.run(CustomTThreadPoolServer.java:204)
at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;Ubuntu 14.10&lt;br/&gt;
4 Cores and 8GB RAM&lt;/p&gt;</environment>
        <key id="12774853">CASSANDRA-8797</key>
            <summary>Tuple relation in select query is broken</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thobbs">Tom Hobbs</assignee>
                                    <reporter username="ajaygarga">Ajay</reporter>
                        <labels>
                    </labels>
                <created>Fri, 13 Feb 2015 10:55:21 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:20 +0000</updated>
                            <resolved>Thu, 19 Feb 2015 19:24:48 +0000</resolved>
                                        <fixVersion>2.1.5</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14320208" author="philipthompson" created="Fri, 13 Feb 2015 15:08:44 +0000"  >&lt;p&gt;I can reproduce this on 2.0-HEAD and 2.1-HEAD. It&apos;s unclear if this type of query is supported. Tyler will be able to confirm, and fix the exception regardless.&lt;/p&gt;

&lt;p&gt;Thank you for the detailed reproduction steps.&lt;/p&gt;</comment>
                            <comment id="14320257" author="philipthompson" created="Fri, 13 Feb 2015 15:14:48 +0000"  >&lt;p&gt;This does not happen on trunk, as it requires ALLOW FILTERING there. It does not error when ALLOW FILTERING is added.&lt;/p&gt;

&lt;p&gt;Reproducing does not require inserting any rows. You can skip straight from creating the table to the faulty select clause.&lt;/p&gt;</comment>
                            <comment id="14320305" author="ajaygarga" created="Fri, 13 Feb 2015 15:37:10 +0000"  >&lt;p&gt;Thanks for the quick response.  Does it work with ALLOW FILTERING in 2.0.11 or 2.0.12 as well?. Sorry I don&apos;t have access to the set up right now. &lt;/p&gt;</comment>
                            <comment id="14320317" author="philipthompson" created="Fri, 13 Feb 2015 15:50:43 +0000"  >&lt;p&gt;No it does not work in 2.0 or 2.1 even with allow filtering. The changes in trunk are due to an internal refactoring of select statement.&lt;/p&gt;</comment>
                            <comment id="14320324" author="ajaygarga" created="Fri, 13 Feb 2015 15:58:12 +0000"  >&lt;p&gt;Thanks.  When is 2.0.13 expected to be out?&lt;/p&gt;</comment>
                            <comment id="14320329" author="philipthompson" created="Fri, 13 Feb 2015 16:01:04 +0000"  >&lt;p&gt;2.0.12 just released so I would not expect it for a while. If you ask in #cassandra-dev on freenode, you may get a more helpful answer, sorry.&lt;/p&gt;</comment>
                            <comment id="14320344" author="ajaygarga" created="Fri, 13 Feb 2015 16:16:47 +0000"  >&lt;p&gt;Ok. Thanks&lt;/p&gt;</comment>
                            <comment id="14320558" author="thobbs" created="Fri, 13 Feb 2015 18:55:34 +0000"  >&lt;p&gt;The attached patches fix the issue on 2.0 and 2.1 and add a test for trunk.  (I also have branches &lt;a href=&quot;https://github.com/thobbs/cassandra/tree/CASSANDRA-8797-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.0&lt;/a&gt;, &lt;a href=&quot;https://github.com/thobbs/cassandra/tree/CASSANDRA-8797-2.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.1&lt;/a&gt;, and &lt;a href=&quot;https://github.com/thobbs/cassandra/tree/CASSANDRA-8797-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt;.)&lt;/p&gt;

&lt;p&gt;This problem only occurs when the &lt;tt&gt;token()&lt;/tt&gt; function is used along with a multi-column (tuple) relation on other columns.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blerer&quot; class=&quot;user-hover&quot; rel=&quot;blerer&quot;&gt;blerer&lt;/a&gt; I&apos;ve lost track of the various ALLOW FILTERING fixes we in progress, but the queries in the test are erroneously requiring it.  Is that fix covered by another ticket, or do we need to open a new one?&lt;/p&gt;</comment>
                            <comment id="14320598" author="blerer" created="Fri, 13 Feb 2015 19:18:23 +0000"  >&lt;p&gt;I think we will need to open another ticket. All the issues that we had with ALLOW FILTERING lately were cases where it should have been required but was not.&lt;br/&gt;
I will give it a better look during the review. &lt;/p&gt;</comment>
                            <comment id="14320641" author="blerer" created="Fri, 13 Feb 2015 19:43:41 +0000"  >&lt;p&gt;I had a look in the code and opened &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8806&quot; title=&quot;Some queries with Token restrictions require ALLOW FILTERING and should not&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8806&quot;&gt;&lt;del&gt;CASSANDRA-8806&lt;/del&gt;&lt;/a&gt; for this problem.&lt;/p&gt;</comment>
                            <comment id="14321311" author="blerer" created="Sat, 14 Feb 2015 09:23:20 +0000"  >&lt;p&gt;Just one nit for the 2.0 and 2.1 patches:&lt;br/&gt;
In &lt;tt&gt;SelectStatement.checkTokenFunctionArgumentsOrder&lt;/tt&gt; the &lt;tt&gt;singleColumnRelation.onToken&lt;/tt&gt; check can be removed from the second &lt;tt&gt;if&lt;/tt&gt; as it is already checked in the first one.&lt;/p&gt;</comment>
                            <comment id="14327982" author="thobbs" created="Thu, 19 Feb 2015 19:24:48 +0000"  >&lt;p&gt;Thanks, committed with the suggested change as &lt;tt&gt;ee160a97&lt;/tt&gt;.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12698784" name="8797-2.0.txt" size="3995" author="thobbs" created="Fri, 13 Feb 2015 18:55:34 +0000"/>
                            <attachment id="12698785" name="8797-2.1.txt" size="3520" author="thobbs" created="Fri, 13 Feb 2015 18:55:34 +0000"/>
                            <attachment id="12698786" name="8797-trunk.txt" size="1338" author="thobbs" created="Fri, 13 Feb 2015 18:55:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thobbs]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 39 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i25lbj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12327942">2.0.11</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>blerer</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blerer]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311124" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Tester</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>philipthompson</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>