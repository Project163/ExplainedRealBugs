<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:07:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-13236] corrupt flag error after upgrade from 2.2 to 3.0.10</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-13236</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;After upgrade from 2.2.5 to 3.0.9/10 we&apos;re getting a bunch of errors like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [SharedPool-Worker-1] 2017-02-17 12:58:43,859 Message.java:617 - Unexpected exception during request; channel = [id: 0xa8b98684, /10.0.70.104:56814 =&amp;gt; /10.0.80.24:9042]
java.io.IOError: java.io.IOException: Corrupt flags value &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; unfiltered partition (isStatic flag set): 160
        at org.apache.cassandra.db.rows.UnfilteredRowIteratorSerializer$1.computeNext(UnfilteredRowIteratorSerializer.java:222) ~[apache-cassandra-3.0.10.jar:3.0.10]
        at org.apache.cassandra.db.rows.UnfilteredRowIteratorSerializer$1.computeNext(UnfilteredRowIteratorSerializer.java:210) ~[apache-cassandra-3.0.10.jar:3.0.10]
        at org.apache.cassandra.utils.AbstractIterator.hasNext(AbstractIterator.java:47) ~[apache-cassandra-3.0.10.jar:3.0.10]
        at org.apache.cassandra.db.transform.BaseRows.hasNext(BaseRows.java:129) ~[apache-cassandra-3.0.10.jar:3.0.10]
        at org.apache.cassandra.cql3.statements.SelectStatement.processPartition(SelectStatement.java:749) ~[apache-cassandra-3.0.10.jar:3.0.10]
        at org.apache.cassandra.cql3.statements.SelectStatement.process(SelectStatement.java:711) ~[apache-cassandra-3.0.10.jar:3.0.10]
        at org.apache.cassandra.cql3.statements.SelectStatement.processResults(SelectStatement.java:400) ~[apache-cassandra-3.0.10.jar:3.0.10]
        at org.apache.cassandra.cql3.statements.SelectStatement.execute(SelectStatement.java:265) ~[apache-cassandra-3.0.10.jar:3.0.10]
        at org.apache.cassandra.cql3.statements.SelectStatement.execute(SelectStatement.java:224) ~[apache-cassandra-3.0.10.jar:3.0.10]
        at org.apache.cassandra.cql3.statements.SelectStatement.execute(SelectStatement.java:76) ~[apache-cassandra-3.0.10.jar:3.0.10]
        at org.apache.cassandra.cql3.QueryProcessor.processStatement(QueryProcessor.java:206) ~[apache-cassandra-3.0.10.jar:3.0.10]
        at org.apache.cassandra.cql3.QueryProcessor.processPrepared(QueryProcessor.java:487) ~[apache-cassandra-3.0.10.jar:3.0.10]
        at org.apache.cassandra.cql3.QueryProcessor.processPrepared(QueryProcessor.java:464) ~[apache-cassandra-3.0.10.jar:3.0.10]
        at org.apache.cassandra.transport.messages.ExecuteMessage.execute(ExecuteMessage.java:130) ~[apache-cassandra-3.0.10.jar:3.0.10]
        at org.apache.cassandra.transport.Message$Dispatcher.channelRead0(Message.java:513) [apache-cassandra-3.0.10.jar:3.0.10]
        at org.apache.cassandra.transport.Message$Dispatcher.channelRead0(Message.java:407) [apache-cassandra-3.0.10.jar:3.0.10]
        at io.netty.channel.SimpleChannelInboundHandler.channelRead(SimpleChannelInboundHandler.java:105) [netty-all-4.0.23.Final.jar:4.0.23.Final]
        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:333) [netty-all-4.0.23.Final.jar:4.0.23.Final]
        at io.netty.channel.AbstractChannelHandlerContext.access$700(AbstractChannelHandlerContext.java:32) [netty-all-4.0.23.Final.jar:4.0.23.Final]
        at io.netty.channel.AbstractChannelHandlerContext$8.run(AbstractChannelHandlerContext.java:324) [netty-all-4.0.23.Final.jar:4.0.23.Final]
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [na:1.8.0_72]
        at org.apache.cassandra.concurrent.AbstractLocalAwareExecutorService$FutureTask.run(AbstractLocalAwareExecutorService.java:164) [apache-cassandra-3.0.10.jar:3.0.10]
        at org.apache.cassandra.concurrent.SEPWorker.run(SEPWorker.java:105) [apache-cassandra-3.0.10.jar:3.0.10]
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [na:1.8.0_72]
Caused by: java.io.IOException: Corrupt flags value &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; unfiltered partition (isStatic flag set): 160
        at org.apache.cassandra.db.rows.UnfilteredSerializer.deserialize(UnfilteredSerializer.java:374) ~[apache-cassandra-3.0.10.jar:3.0.10]
        at org.apache.cassandra.db.rows.UnfilteredRowIteratorSerializer$1.computeNext(UnfilteredRowIteratorSerializer.java:217) ~[apache-cassandra-3.0.10.jar:3.0.10]
        ... 23 common frames omitted
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;cassandra 3.0.10&lt;/p&gt;</environment>
        <key id="13043967">CASSANDRA-13236</key>
            <summary>corrupt flag error after upgrade from 2.2 to 3.0.10</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10000" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Urgent</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="samt">Sam Tunnicliffe</assignee>
                                    <reporter username="ingard">ingard mev&#229;g</reporter>
                        <labels>
                    </labels>
                <created>Fri, 17 Feb 2017 11:59:23 +0000</created>
                <updated>Tue, 16 Apr 2019 09:30:09 +0000</updated>
                            <resolved>Wed, 10 May 2017 10:36:50 +0000</resolved>
                                        <fixVersion>3.0.14</fixVersion>
                    <fixVersion>3.11.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="15871775" author="jasobrown" created="Fri, 17 Feb 2017 12:27:13 +0000"  >&lt;p&gt;Can you share the schema and query?&lt;/p&gt;</comment>
                            <comment id="15871781" author="ingard" created="Fri, 17 Feb 2017 12:32:12 +0000"  >&lt;p&gt;I&apos;m not sure which queries causes this atm. Is there a way to find out from enabling logging or something else?&lt;/p&gt;</comment>
                            <comment id="15871800" author="ingard" created="Fri, 17 Feb 2017 12:47:59 +0000"  >&lt;p&gt;CREATE KEYSPACE keyspace WITH replication = &lt;/p&gt;
{&apos;class&apos;: &apos;SimpleStrategy&apos;, &apos;replication_factor&apos;: &apos;3&apos;}
&lt;p&gt;&#160; AND durable_writes = true;&lt;/p&gt;

&lt;p&gt;CREATE TABLE keyspace.public_uri_share (&lt;br/&gt;
&#160; &#160; uri text PRIMARY KEY,&lt;br/&gt;
&#160; &#160; collection_&lt;em&gt;username&lt;/em&gt;&lt;em&gt;type&lt;/em&gt;_id text&lt;br/&gt;
) WITH bloom_filter_fp_chance = 0.01&lt;br/&gt;
&#160; &#160; AND caching = &lt;/p&gt;
{&apos;keys&apos;: &apos;ALL&apos;, &apos;rows_per_partition&apos;: &apos;NONE&apos;}
&lt;p&gt;&#160; &#160; AND comment = &apos;&apos;&lt;br/&gt;
&#160; &#160; AND compaction = &lt;/p&gt;
{&apos;class&apos;: &apos;org.apache.cassandra.db.compaction.SizeTieredCompactionStrategy&apos;, &apos;max_threshold&apos;: &apos;32&apos;, &apos;min_threshold&apos;: &apos;4&apos;}
&lt;p&gt;&#160; &#160; AND compression = &lt;/p&gt;
{&apos;chunk_length_in_kb&apos;: &apos;64&apos;, &apos;class&apos;: &apos;org.apache.cassandra.io.compress.LZ4Compressor&apos;}
&lt;p&gt;&#160; &#160; AND crc_check_chance = 1.0&lt;br/&gt;
&#160; &#160; AND dclocal_read_repair_chance = 0.1&lt;br/&gt;
&#160; &#160; AND default_time_to_live = 0&lt;br/&gt;
&#160; &#160; AND gc_grace_seconds = 864000&lt;br/&gt;
&#160; &#160; AND max_index_interval = 2048&lt;br/&gt;
&#160; &#160; AND memtable_flush_period_in_ms = 0&lt;br/&gt;
&#160; &#160; AND min_index_interval = 128&lt;br/&gt;
&#160; &#160; AND read_repair_chance = 0.0&lt;br/&gt;
&#160; &#160; AND speculative_retry = &apos;99PERCENTILE&apos;;&lt;/p&gt;

&lt;p&gt;CREATE TABLE keyspace.photo_collections (&lt;br/&gt;
&#160; &#160; photo_&lt;em&gt;username&lt;/em&gt;_id text,&lt;br/&gt;
&#160; &#160; collection_&lt;em&gt;username&lt;/em&gt;&lt;em&gt;type&lt;/em&gt;_id text,&lt;br/&gt;
&#160; &#160; collection_photo_order bigint,&lt;br/&gt;
&#160; &#160; is_cover_photo boolean,&lt;br/&gt;
&#160; &#160; PRIMARY KEY (photo_&lt;em&gt;username&lt;/em&gt;&lt;em&gt;id, collection&lt;/em&gt;&lt;em&gt;username&lt;/em&gt;&lt;em&gt;type&lt;/em&gt;_id)&lt;br/&gt;
) WITH CLUSTERING ORDER BY (collection_&lt;em&gt;username&lt;/em&gt;&lt;em&gt;type&lt;/em&gt;_id ASC)&lt;br/&gt;
&#160; &#160; AND bloom_filter_fp_chance = 0.01&lt;br/&gt;
&#160; &#160; AND caching = &lt;/p&gt;
{&apos;keys&apos;: &apos;ALL&apos;, &apos;rows_per_partition&apos;: &apos;NONE&apos;}
&lt;p&gt;&#160; &#160; AND comment = &apos;&apos;&lt;br/&gt;
&#160; &#160; AND compaction = &lt;/p&gt;
{&apos;class&apos;: &apos;org.apache.cassandra.db.compaction.SizeTieredCompactionStrategy&apos;, &apos;max_threshold&apos;: &apos;32&apos;, &apos;min_threshold&apos;: &apos;4&apos;}
&lt;p&gt;&#160; &#160; AND compression = &lt;/p&gt;
{&apos;chunk_length_in_kb&apos;: &apos;64&apos;, &apos;class&apos;: &apos;org.apache.cassandra.io.compress.LZ4Compressor&apos;}
&lt;p&gt;&#160; &#160; AND crc_check_chance = 1.0&lt;br/&gt;
&#160; &#160; AND dclocal_read_repair_chance = 0.1&lt;br/&gt;
&#160; &#160; AND default_time_to_live = 0&lt;br/&gt;
&#160; &#160; AND gc_grace_seconds = 864000&lt;br/&gt;
&#160; &#160; AND max_index_interval = 2048&lt;br/&gt;
&#160; &#160; AND memtable_flush_period_in_ms = 0&lt;br/&gt;
&#160; &#160; AND min_index_interval = 128&lt;br/&gt;
&#160; &#160; AND read_repair_chance = 0.0&lt;br/&gt;
&#160; &#160; AND speculative_retry = &apos;99PERCENTILE&apos;;&lt;/p&gt;

&lt;p&gt;CREATE TABLE keyspace.comments_counts (&lt;br/&gt;
&#160; &#160; collection_&lt;em&gt;username&lt;/em&gt;&lt;em&gt;type&lt;/em&gt;_id text,&lt;br/&gt;
&#160; &#160; collection_photo_order bigint,&lt;br/&gt;
&#160; &#160; counter_value counter,&lt;br/&gt;
&#160; &#160; PRIMARY KEY (collection_&lt;em&gt;username&lt;/em&gt;&lt;em&gt;type&lt;/em&gt;_id, collection_photo_order)&lt;br/&gt;
) WITH CLUSTERING ORDER BY (collection_photo_order ASC)&lt;br/&gt;
&#160; &#160; AND bloom_filter_fp_chance = 0.01&lt;br/&gt;
&#160; &#160; AND caching = &lt;/p&gt;
{&apos;keys&apos;: &apos;ALL&apos;, &apos;rows_per_partition&apos;: &apos;NONE&apos;}
&lt;p&gt;&#160; &#160; AND comment = &apos;&apos;&lt;br/&gt;
&#160; &#160; AND compaction = &lt;/p&gt;
{&apos;class&apos;: &apos;org.apache.cassandra.db.compaction.SizeTieredCompactionStrategy&apos;, &apos;max_threshold&apos;: &apos;32&apos;, &apos;min_threshold&apos;: &apos;4&apos;}
&lt;p&gt;&#160; &#160; AND compression = &lt;/p&gt;
{&apos;chunk_length_in_kb&apos;: &apos;64&apos;, &apos;class&apos;: &apos;org.apache.cassandra.io.compress.LZ4Compressor&apos;}
&lt;p&gt;&#160; &#160; AND crc_check_chance = 1.0&lt;br/&gt;
&#160; &#160; AND dclocal_read_repair_chance = 0.1&lt;br/&gt;
&#160; &#160; AND default_time_to_live = 0&lt;br/&gt;
&#160; &#160; AND gc_grace_seconds = 864000&lt;br/&gt;
&#160; &#160; AND max_index_interval = 2048&lt;br/&gt;
&#160; &#160; AND memtable_flush_period_in_ms = 0&lt;br/&gt;
&#160; &#160; AND min_index_interval = 128&lt;br/&gt;
&#160; &#160; AND read_repair_chance = 0.0&lt;br/&gt;
&#160; &#160; AND speculative_retry = &apos;99PERCENTILE&apos;;&lt;/p&gt;

&lt;p&gt;CREATE TABLE keyspace.comments (&lt;br/&gt;
&#160; &#160; collection_&lt;em&gt;username&lt;/em&gt;&lt;em&gt;type&lt;/em&gt;_id text,&lt;br/&gt;
&#160; &#160; collection_photo_order bigint,&lt;br/&gt;
&#160; &#160; comment_id_order bigint,&lt;br/&gt;
&#160; &#160; comment text,&lt;br/&gt;
&#160; &#160; commenter_username text,&lt;br/&gt;
&#160; &#160; PRIMARY KEY (collection_&lt;em&gt;username&lt;/em&gt;&lt;em&gt;type&lt;/em&gt;_id, collection_photo_order, comment_id_order)&lt;br/&gt;
) WITH CLUSTERING ORDER BY (collection_photo_order ASC, comment_id_order ASC)&lt;br/&gt;
&#160; &#160; AND bloom_filter_fp_chance = 0.01&lt;br/&gt;
&#160; &#160; AND caching = &lt;/p&gt;
{&apos;keys&apos;: &apos;ALL&apos;, &apos;rows_per_partition&apos;: &apos;NONE&apos;}
&lt;p&gt;&#160; &#160; AND comment = &apos;&apos;&lt;br/&gt;
&#160; &#160; AND compaction = &lt;/p&gt;
{&apos;class&apos;: &apos;org.apache.cassandra.db.compaction.SizeTieredCompactionStrategy&apos;, &apos;max_threshold&apos;: &apos;32&apos;, &apos;min_threshold&apos;: &apos;4&apos;}
&lt;p&gt;&#160; &#160; AND compression = &lt;/p&gt;
{&apos;chunk_length_in_kb&apos;: &apos;64&apos;, &apos;class&apos;: &apos;org.apache.cassandra.io.compress.LZ4Compressor&apos;}
&lt;p&gt;&#160; &#160; AND crc_check_chance = 1.0&lt;br/&gt;
&#160; &#160; AND dclocal_read_repair_chance = 0.1&lt;br/&gt;
&#160; &#160; AND default_time_to_live = 0&lt;br/&gt;
&#160; &#160; AND gc_grace_seconds = 864000&lt;br/&gt;
&#160; &#160; AND max_index_interval = 2048&lt;br/&gt;
&#160; &#160; AND memtable_flush_period_in_ms = 0&lt;br/&gt;
&#160; &#160; AND min_index_interval = 128&lt;br/&gt;
&#160; &#160; AND read_repair_chance = 0.0&lt;br/&gt;
&#160; &#160; AND speculative_retry = &apos;99PERCENTILE&apos;;&lt;/p&gt;

&lt;p&gt;CREATE TABLE keyspace.photos (&lt;br/&gt;
&#160; &#160; username text,&lt;br/&gt;
&#160; &#160; id_shard int,&lt;br/&gt;
&#160; &#160; id text,&lt;br/&gt;
&#160; &#160; json text,&lt;br/&gt;
&#160; &#160; main_collection_&lt;em&gt;username&lt;/em&gt;&lt;em&gt;type&lt;/em&gt;_id text,&lt;br/&gt;
&#160; &#160; u_id text,&lt;br/&gt;
&#160; &#160; PRIMARY KEY ((username, id_shard), id)&lt;br/&gt;
) WITH CLUSTERING ORDER BY (id ASC)&lt;br/&gt;
&#160; &#160; AND bloom_filter_fp_chance = 0.01&lt;br/&gt;
&#160; &#160; AND caching = &lt;/p&gt;
{&apos;keys&apos;: &apos;ALL&apos;, &apos;rows_per_partition&apos;: &apos;NONE&apos;}
&lt;p&gt;&#160; &#160; AND comment = &apos;&apos;&lt;br/&gt;
&#160; &#160; AND compaction = &lt;/p&gt;
{&apos;class&apos;: &apos;org.apache.cassandra.db.compaction.SizeTieredCompactionStrategy&apos;, &apos;max_threshold&apos;: &apos;32&apos;, &apos;min_threshold&apos;: &apos;4&apos;}
&lt;p&gt;&#160; &#160; AND compression = &lt;/p&gt;
{&apos;chunk_length_in_kb&apos;: &apos;64&apos;, &apos;class&apos;: &apos;org.apache.cassandra.io.compress.LZ4Compressor&apos;}
&lt;p&gt;&#160; &#160; AND crc_check_chance = 1.0&lt;br/&gt;
&#160; &#160; AND dclocal_read_repair_chance = 0.1&lt;br/&gt;
&#160; &#160; AND default_time_to_live = 0&lt;br/&gt;
&#160; &#160; AND gc_grace_seconds = 864000&lt;br/&gt;
&#160; &#160; AND max_index_interval = 2048&lt;br/&gt;
&#160; &#160; AND memtable_flush_period_in_ms = 0&lt;br/&gt;
&#160; &#160; AND min_index_interval = 128&lt;br/&gt;
&#160; &#160; AND read_repair_chance = 0.0&lt;br/&gt;
&#160; &#160; AND speculative_retry = &apos;99PERCENTILE&apos;;&lt;/p&gt;

&lt;p&gt;CREATE TABLE keyspace.collection_types (&lt;br/&gt;
&#160; &#160; collection_type int PRIMARY KEY,&lt;br/&gt;
&#160; &#160; name text&lt;br/&gt;
) WITH bloom_filter_fp_chance = 0.01&lt;br/&gt;
&#160; &#160; AND caching = &lt;/p&gt;
{&apos;keys&apos;: &apos;ALL&apos;, &apos;rows_per_partition&apos;: &apos;NONE&apos;}
&lt;p&gt;&#160; &#160; AND comment = &apos;&apos;&lt;br/&gt;
&#160; &#160; AND compaction = &lt;/p&gt;
{&apos;class&apos;: &apos;org.apache.cassandra.db.compaction.SizeTieredCompactionStrategy&apos;, &apos;max_threshold&apos;: &apos;32&apos;, &apos;min_threshold&apos;: &apos;4&apos;}
&lt;p&gt;&#160; &#160; AND compression = &lt;/p&gt;
{&apos;chunk_length_in_kb&apos;: &apos;64&apos;, &apos;class&apos;: &apos;org.apache.cassandra.io.compress.LZ4Compressor&apos;}
&lt;p&gt;&#160; &#160; AND crc_check_chance = 1.0&lt;br/&gt;
&#160; &#160; AND dclocal_read_repair_chance = 0.1&lt;br/&gt;
&#160; &#160; AND default_time_to_live = 0&lt;br/&gt;
&#160; &#160; AND gc_grace_seconds = 864000&lt;br/&gt;
&#160; &#160; AND max_index_interval = 2048&lt;br/&gt;
&#160; &#160; AND memtable_flush_period_in_ms = 0&lt;br/&gt;
&#160; &#160; AND min_index_interval = 128&lt;br/&gt;
&#160; &#160; AND read_repair_chance = 0.0&lt;br/&gt;
&#160; &#160; AND speculative_retry = &apos;99PERCENTILE&apos;;&lt;/p&gt;

&lt;p&gt;CREATE TABLE keyspace.collections (&lt;br/&gt;
&#160; &#160; username text,&lt;br/&gt;
&#160; &#160; collection_type int,&lt;br/&gt;
&#160; &#160; collection_id bigint,&lt;br/&gt;
&#160; &#160; collection_data blob,&lt;br/&gt;
&#160; &#160; comments_lazy bigint,&lt;br/&gt;
&#160; &#160; comments_lazy_updated bigint,&lt;br/&gt;
&#160; &#160; json text,&lt;br/&gt;
&#160; &#160; last_modified bigint,&lt;br/&gt;
&#160; &#160; max_exif_timestamp bigint,&lt;br/&gt;
&#160; &#160; min_exif_timestamp bigint,&lt;br/&gt;
&#160; &#160; share_date bigint,&lt;br/&gt;
&#160; &#160; share_default_granted_authorization text,&lt;br/&gt;
&#160; &#160; share_non_public_share boolean,&lt;br/&gt;
&#160; &#160; share_remove_geo_data boolean,&lt;br/&gt;
&#160; &#160; share_secret text,&lt;br/&gt;
&#160; &#160; share_uri text,&lt;br/&gt;
&#160; &#160; subscribed_collection_started_date bigint,&lt;br/&gt;
&#160; &#160; subscribed_collection_username_&lt;em&gt;type&lt;/em&gt;_id text,&lt;br/&gt;
&#160; &#160; type_last_modified bigint static,&lt;br/&gt;
&#160; &#160; PRIMARY KEY ((username, collection_type), collection_id)&lt;br/&gt;
) WITH CLUSTERING ORDER BY (collection_id ASC)&lt;br/&gt;
&#160; &#160; AND bloom_filter_fp_chance = 0.01&lt;br/&gt;
&#160; &#160; AND caching = &lt;/p&gt;
{&apos;keys&apos;: &apos;ALL&apos;, &apos;rows_per_partition&apos;: &apos;NONE&apos;}
&lt;p&gt;&#160; &#160; AND comment = &apos;&apos;&lt;br/&gt;
&#160; &#160; AND compaction = &lt;/p&gt;
{&apos;class&apos;: &apos;org.apache.cassandra.db.compaction.SizeTieredCompactionStrategy&apos;, &apos;max_threshold&apos;: &apos;32&apos;, &apos;min_threshold&apos;: &apos;4&apos;}
&lt;p&gt;&#160; &#160; AND compression = &lt;/p&gt;
{&apos;chunk_length_in_kb&apos;: &apos;64&apos;, &apos;class&apos;: &apos;org.apache.cassandra.io.compress.LZ4Compressor&apos;}
&lt;p&gt;&#160; &#160; AND crc_check_chance = 1.0&lt;br/&gt;
&#160; &#160; AND dclocal_read_repair_chance = 0.1&lt;br/&gt;
&#160; &#160; AND default_time_to_live = 0&lt;br/&gt;
&#160; &#160; AND gc_grace_seconds = 864000&lt;br/&gt;
&#160; &#160; AND max_index_interval = 2048&lt;br/&gt;
&#160; &#160; AND memtable_flush_period_in_ms = 0&lt;br/&gt;
&#160; &#160; AND min_index_interval = 128&lt;br/&gt;
&#160; &#160; AND read_repair_chance = 0.0&lt;br/&gt;
&#160; &#160; AND speculative_retry = &apos;99PERCENTILE&apos;;&lt;/p&gt;

&lt;p&gt;CREATE TABLE keyspace.collection_photos_order (&lt;br/&gt;
&#160; &#160; username text,&lt;br/&gt;
&#160; &#160; collection_id bigint,&lt;br/&gt;
&#160; &#160; collection_photo_order bigint,&lt;br/&gt;
&#160; &#160; comments_lazy bigint,&lt;br/&gt;
&#160; &#160; comments_lazy_updated bigint,&lt;br/&gt;
&#160; &#160; last_modified bigint static,&lt;br/&gt;
&#160; &#160; likes_lazy bigint,&lt;br/&gt;
&#160; &#160; likes_lazy_updated bigint,&lt;br/&gt;
&#160; &#160; photo_&lt;em&gt;username&lt;/em&gt;_id text,&lt;br/&gt;
&#160; &#160; photo_metadata blob,&lt;br/&gt;
&#160; &#160; PRIMARY KEY ((username, collection_id), collection_photo_order)&lt;br/&gt;
) WITH CLUSTERING ORDER BY (collection_photo_order DESC)&lt;br/&gt;
&#160; &#160; AND bloom_filter_fp_chance = 0.01&lt;br/&gt;
&#160; &#160; AND caching = &lt;/p&gt;
{&apos;keys&apos;: &apos;ALL&apos;, &apos;rows_per_partition&apos;: &apos;NONE&apos;}
&lt;p&gt;&#160; &#160; AND comment = &apos;&apos;&lt;br/&gt;
&#160; &#160; AND compaction = &lt;/p&gt;
{&apos;class&apos;: &apos;org.apache.cassandra.db.compaction.SizeTieredCompactionStrategy&apos;, &apos;max_threshold&apos;: &apos;32&apos;, &apos;min_threshold&apos;: &apos;4&apos;}
&lt;p&gt;&#160; &#160; AND compression = &lt;/p&gt;
{&apos;chunk_length_in_kb&apos;: &apos;64&apos;, &apos;class&apos;: &apos;org.apache.cassandra.io.compress.LZ4Compressor&apos;}
&lt;p&gt;&#160; &#160; AND crc_check_chance = 1.0&lt;br/&gt;
&#160; &#160; AND dclocal_read_repair_chance = 0.1&lt;br/&gt;
&#160; &#160; AND default_time_to_live = 0&lt;br/&gt;
&#160; &#160; AND gc_grace_seconds = 864000&lt;br/&gt;
&#160; &#160; AND max_index_interval = 2048&lt;br/&gt;
&#160; &#160; AND memtable_flush_period_in_ms = 0&lt;br/&gt;
&#160; &#160; AND min_index_interval = 128&lt;br/&gt;
&#160; &#160; AND read_repair_chance = 0.0&lt;br/&gt;
&#160; &#160; AND speculative_retry = &apos;99PERCENTILE&apos;;&lt;/p&gt;

&lt;p&gt;CREATE TABLE keyspace.main_photos (&lt;br/&gt;
&#160; &#160; id text PRIMARY KEY,&lt;br/&gt;
&#160; &#160; json text,&lt;br/&gt;
&#160; &#160; main_collection_&lt;em&gt;username&lt;/em&gt;&lt;em&gt;type&lt;/em&gt;_id text,&lt;br/&gt;
&#160; &#160; u_id text,&lt;br/&gt;
&#160; &#160; username text&lt;br/&gt;
) WITH bloom_filter_fp_chance = 0.01&lt;br/&gt;
&#160; &#160; AND caching = &lt;/p&gt;
{&apos;keys&apos;: &apos;ALL&apos;, &apos;rows_per_partition&apos;: &apos;NONE&apos;}
&lt;p&gt;&#160; &#160; AND comment = &apos;&apos;&lt;br/&gt;
&#160; &#160; AND compaction = &lt;/p&gt;
{&apos;class&apos;: &apos;org.apache.cassandra.db.compaction.SizeTieredCompactionStrategy&apos;, &apos;max_threshold&apos;: &apos;32&apos;, &apos;min_threshold&apos;: &apos;4&apos;}
&lt;p&gt;&#160; &#160; AND compression = &lt;/p&gt;
{&apos;chunk_length_in_kb&apos;: &apos;64&apos;, &apos;class&apos;: &apos;org.apache.cassandra.io.compress.LZ4Compressor&apos;}
&lt;p&gt;&#160; &#160; AND crc_check_chance = 1.0&lt;br/&gt;
&#160; &#160; AND dclocal_read_repair_chance = 0.1&lt;br/&gt;
&#160; &#160; AND default_time_to_live = 0&lt;br/&gt;
&#160; &#160; AND gc_grace_seconds = 864000&lt;br/&gt;
&#160; &#160; AND max_index_interval = 2048&lt;br/&gt;
&#160; &#160; AND memtable_flush_period_in_ms = 0&lt;br/&gt;
&#160; &#160; AND min_index_interval = 128&lt;br/&gt;
&#160; &#160; AND read_repair_chance = 0.0&lt;br/&gt;
&#160; &#160; AND speculative_retry = &apos;99PERCENTILE&apos;;&lt;/p&gt;

&lt;p&gt;CREATE TABLE keyspace.collection_titles (&lt;br/&gt;
&#160; &#160; username text,&lt;br/&gt;
&#160; &#160; collection_type int,&lt;br/&gt;
&#160; &#160; collection_title text,&lt;br/&gt;
&#160; &#160; collection_&lt;em&gt;username&lt;/em&gt;&lt;em&gt;type&lt;/em&gt;_id text,&lt;br/&gt;
&#160; &#160; PRIMARY KEY ((username, collection_type), collection_title)&lt;br/&gt;
) WITH CLUSTERING ORDER BY (collection_title ASC)&lt;br/&gt;
&#160; &#160; AND bloom_filter_fp_chance = 0.01&lt;br/&gt;
&#160; &#160; AND caching = &lt;/p&gt;
{&apos;keys&apos;: &apos;ALL&apos;, &apos;rows_per_partition&apos;: &apos;NONE&apos;}
&lt;p&gt;&#160; &#160; AND comment = &apos;&apos;&lt;br/&gt;
&#160; &#160; AND compaction = &lt;/p&gt;
{&apos;class&apos;: &apos;org.apache.cassandra.db.compaction.SizeTieredCompactionStrategy&apos;, &apos;max_threshold&apos;: &apos;32&apos;, &apos;min_threshold&apos;: &apos;4&apos;}
&lt;p&gt;&#160; &#160; AND compression = &lt;/p&gt;
{&apos;chunk_length_in_kb&apos;: &apos;64&apos;, &apos;class&apos;: &apos;org.apache.cassandra.io.compress.LZ4Compressor&apos;}
&lt;p&gt;&#160; &#160; AND crc_check_chance = 1.0&lt;br/&gt;
&#160; &#160; AND dclocal_read_repair_chance = 0.1&lt;br/&gt;
&#160; &#160; AND default_time_to_live = 0&lt;br/&gt;
&#160; &#160; AND gc_grace_seconds = 864000&lt;br/&gt;
&#160; &#160; AND max_index_interval = 2048&lt;br/&gt;
&#160; &#160; AND memtable_flush_period_in_ms = 0&lt;br/&gt;
&#160; &#160; AND min_index_interval = 128&lt;br/&gt;
&#160; &#160; AND read_repair_chance = 0.0&lt;br/&gt;
&#160; &#160; AND speculative_retry = &apos;99PERCENTILE&apos;;&lt;/p&gt;

&lt;p&gt;CREATE TABLE keyspace.account_info (&lt;br/&gt;
&#160; &#160; username text PRIMARY KEY,&lt;br/&gt;
&#160; &#160; activated boolean,&lt;br/&gt;
&#160; &#160; import_state int,&lt;br/&gt;
&#160; &#160; last_read_accessed bigint,&lt;br/&gt;
&#160; &#160; last_write_accessed bigint,&lt;br/&gt;
&#160; &#160; locked_for_read boolean,&lt;br/&gt;
&#160; &#160; locked_for_write boolean,&lt;br/&gt;
&#160; &#160; u_id text&lt;br/&gt;
) WITH bloom_filter_fp_chance = 0.01&lt;br/&gt;
&#160; &#160; AND caching = &lt;/p&gt;
{&apos;keys&apos;: &apos;ALL&apos;, &apos;rows_per_partition&apos;: &apos;NONE&apos;}
&lt;p&gt;&#160; &#160; AND comment = &apos;&apos;&lt;br/&gt;
&#160; &#160; AND compaction = &lt;/p&gt;
{&apos;class&apos;: &apos;org.apache.cassandra.db.compaction.SizeTieredCompactionStrategy&apos;, &apos;max_threshold&apos;: &apos;32&apos;, &apos;min_threshold&apos;: &apos;4&apos;}
&lt;p&gt;&#160; &#160; AND compression = &lt;/p&gt;
{&apos;chunk_length_in_kb&apos;: &apos;64&apos;, &apos;class&apos;: &apos;org.apache.cassandra.io.compress.LZ4Compressor&apos;}
&lt;p&gt;&#160; &#160; AND crc_check_chance = 1.0&lt;br/&gt;
&#160; &#160; AND dclocal_read_repair_chance = 0.1&lt;br/&gt;
&#160; &#160; AND default_time_to_live = 0&lt;br/&gt;
&#160; &#160; AND gc_grace_seconds = 864000&lt;br/&gt;
&#160; &#160; AND max_index_interval = 2048&lt;br/&gt;
&#160; &#160; AND memtable_flush_period_in_ms = 0&lt;br/&gt;
&#160; &#160; AND min_index_interval = 128&lt;br/&gt;
&#160; &#160; AND read_repair_chance = 0.0&lt;br/&gt;
&#160; &#160; AND speculative_retry = &apos;99PERCENTILE&apos;;&lt;/p&gt;

&lt;p&gt;CREATE TABLE keyspace.likes_counter (&lt;br/&gt;
&#160; &#160; id_a text,&lt;br/&gt;
&#160; &#160; id_b text,&lt;br/&gt;
&#160; &#160; counter_value counter,&lt;br/&gt;
&#160; &#160; PRIMARY KEY (id_a, id_b)&lt;br/&gt;
) WITH CLUSTERING ORDER BY (id_b ASC)&lt;br/&gt;
&#160; &#160; AND bloom_filter_fp_chance = 0.01&lt;br/&gt;
&#160; &#160; AND caching = &lt;/p&gt;
{&apos;keys&apos;: &apos;ALL&apos;, &apos;rows_per_partition&apos;: &apos;NONE&apos;}
&lt;p&gt;&#160; &#160; AND comment = &apos;&apos;&lt;br/&gt;
&#160; &#160; AND compaction = &lt;/p&gt;
{&apos;class&apos;: &apos;org.apache.cassandra.db.compaction.SizeTieredCompactionStrategy&apos;, &apos;max_threshold&apos;: &apos;32&apos;, &apos;min_threshold&apos;: &apos;4&apos;}
&lt;p&gt;&#160; &#160; AND compression = &lt;/p&gt;
{&apos;chunk_length_in_kb&apos;: &apos;64&apos;, &apos;class&apos;: &apos;org.apache.cassandra.io.compress.LZ4Compressor&apos;}
&lt;p&gt;&#160; &#160; AND crc_check_chance = 1.0&lt;br/&gt;
&#160; &#160; AND dclocal_read_repair_chance = 0.1&lt;br/&gt;
&#160; &#160; AND default_time_to_live = 0&lt;br/&gt;
&#160; &#160; AND gc_grace_seconds = 864000&lt;br/&gt;
&#160; &#160; AND max_index_interval = 2048&lt;br/&gt;
&#160; &#160; AND memtable_flush_period_in_ms = 0&lt;br/&gt;
&#160; &#160; AND min_index_interval = 128&lt;br/&gt;
&#160; &#160; AND read_repair_chance = 0.0&lt;br/&gt;
&#160; &#160; AND speculative_retry = &apos;99PERCENTILE&apos;;&lt;/p&gt;

&lt;p&gt;CREATE TABLE keyspace.collection_subscribing_usernames (&lt;br/&gt;
&#160; &#160; collection_&lt;em&gt;username&lt;/em&gt;&lt;em&gt;type&lt;/em&gt;_id text,&lt;br/&gt;
&#160; &#160; subscribing_username text,&lt;br/&gt;
&#160; &#160; granted_authorization text,&lt;br/&gt;
&#160; &#160; subscription_start bigint,&lt;br/&gt;
&#160; &#160; PRIMARY KEY (collection_&lt;em&gt;username&lt;/em&gt;&lt;em&gt;type&lt;/em&gt;_id, subscribing_username)&lt;br/&gt;
) WITH CLUSTERING ORDER BY (subscribing_username ASC)&lt;br/&gt;
&#160; &#160; AND bloom_filter_fp_chance = 0.01&lt;br/&gt;
&#160; &#160; AND caching = &lt;/p&gt;
{&apos;keys&apos;: &apos;ALL&apos;, &apos;rows_per_partition&apos;: &apos;NONE&apos;}
&lt;p&gt;&#160; &#160; AND comment = &apos;&apos;&lt;br/&gt;
&#160; &#160; AND compaction = &lt;/p&gt;
{&apos;class&apos;: &apos;org.apache.cassandra.db.compaction.SizeTieredCompactionStrategy&apos;, &apos;max_threshold&apos;: &apos;32&apos;, &apos;min_threshold&apos;: &apos;4&apos;}
&lt;p&gt;&#160; &#160; AND compression = &lt;/p&gt;
{&apos;chunk_length_in_kb&apos;: &apos;64&apos;, &apos;class&apos;: &apos;org.apache.cassandra.io.compress.LZ4Compressor&apos;}
&lt;p&gt;&#160; &#160; AND crc_check_chance = 1.0&lt;br/&gt;
&#160; &#160; AND dclocal_read_repair_chance = 0.1&lt;br/&gt;
&#160; &#160; AND default_time_to_live = 0&lt;br/&gt;
&#160; &#160; AND gc_grace_seconds = 864000&lt;br/&gt;
&#160; &#160; AND max_index_interval = 2048&lt;br/&gt;
&#160; &#160; AND memtable_flush_period_in_ms = 0&lt;br/&gt;
&#160; &#160; AND min_index_interval = 128&lt;br/&gt;
&#160; &#160; AND read_repair_chance = 0.0&lt;br/&gt;
&#160; &#160; AND speculative_retry = &apos;99PERCENTILE&apos;;&lt;/p&gt;

&lt;p&gt;CREATE TABLE keyspace.collection_user_likes (&lt;br/&gt;
&#160; &#160; id_a text,&lt;br/&gt;
&#160; &#160; id_b text,&lt;br/&gt;
&#160; &#160; id_c text,&lt;br/&gt;
&#160; &#160; PRIMARY KEY (id_a, id_b, id_c)&lt;br/&gt;
) WITH CLUSTERING ORDER BY (id_b ASC, id_c ASC)&lt;br/&gt;
&#160; &#160; AND bloom_filter_fp_chance = 0.01&lt;br/&gt;
&#160; &#160; AND caching = &lt;/p&gt;
{&apos;keys&apos;: &apos;ALL&apos;, &apos;rows_per_partition&apos;: &apos;NONE&apos;}
&lt;p&gt;&#160; &#160; AND comment = &apos;&apos;&lt;br/&gt;
&#160; &#160; AND compaction = &lt;/p&gt;
{&apos;class&apos;: &apos;org.apache.cassandra.db.compaction.SizeTieredCompactionStrategy&apos;, &apos;max_threshold&apos;: &apos;32&apos;, &apos;min_threshold&apos;: &apos;4&apos;}
&lt;p&gt;&#160; &#160; AND compression = &lt;/p&gt;
{&apos;chunk_length_in_kb&apos;: &apos;64&apos;, &apos;class&apos;: &apos;org.apache.cassandra.io.compress.LZ4Compressor&apos;}
&lt;p&gt;&#160; &#160; AND crc_check_chance = 1.0&lt;br/&gt;
&#160; &#160; AND dclocal_read_repair_chance = 0.1&lt;br/&gt;
&#160; &#160; AND default_time_to_live = 0&lt;br/&gt;
&#160; &#160; AND gc_grace_seconds = 864000&lt;br/&gt;
&#160; &#160; AND max_index_interval = 2048&lt;br/&gt;
&#160; &#160; AND memtable_flush_period_in_ms = 0&lt;br/&gt;
&#160; &#160; AND min_index_interval = 128&lt;br/&gt;
&#160; &#160; AND read_repair_chance = 0.0&lt;br/&gt;
&#160; &#160; AND speculative_retry = &apos;99PERCENTILE&apos;;&lt;/p&gt;

&lt;p&gt;CREATE TABLE keyspace.likes (&lt;br/&gt;
&#160; &#160; id_a text,&lt;br/&gt;
&#160; &#160; id_b text,&lt;br/&gt;
&#160; &#160; PRIMARY KEY (id_a, id_b)&lt;br/&gt;
) WITH CLUSTERING ORDER BY (id_b ASC)&lt;br/&gt;
&#160; &#160; AND bloom_filter_fp_chance = 0.01&lt;br/&gt;
&#160; &#160; AND caching = &lt;/p&gt;
{&apos;keys&apos;: &apos;ALL&apos;, &apos;rows_per_partition&apos;: &apos;NONE&apos;}
&lt;p&gt;&#160; &#160; AND comment = &apos;&apos;&lt;br/&gt;
&#160; &#160; AND compaction = &lt;/p&gt;
{&apos;class&apos;: &apos;org.apache.cassandra.db.compaction.SizeTieredCompactionStrategy&apos;, &apos;max_threshold&apos;: &apos;32&apos;, &apos;min_threshold&apos;: &apos;4&apos;}
&lt;p&gt;&#160; &#160; AND compression = &lt;/p&gt;
{&apos;chunk_length_in_kb&apos;: &apos;64&apos;, &apos;class&apos;: &apos;org.apache.cassandra.io.compress.LZ4Compressor&apos;}
&lt;p&gt;&#160; &#160; AND crc_check_chance = 1.0&lt;br/&gt;
&#160; &#160; AND dclocal_read_repair_chance = 0.1&lt;br/&gt;
&#160; &#160; AND default_time_to_live = 0&lt;br/&gt;
&#160; &#160; AND gc_grace_seconds = 864000&lt;br/&gt;
&#160; &#160; AND max_index_interval = 2048&lt;br/&gt;
&#160; &#160; AND memtable_flush_period_in_ms = 0&lt;br/&gt;
&#160; &#160; AND min_index_interval = 128&lt;br/&gt;
&#160; &#160; AND read_repair_chance = 0.0&lt;br/&gt;
&#160; &#160; AND speculative_retry = &apos;99PERCENTILE&apos;;&lt;/p&gt;</comment>
                            <comment id="15871801" author="jasobrown" created="Fri, 17 Feb 2017 12:48:02 +0000"  >&lt;p&gt;The stack trace above indicates a select statement is happening. Is this occurring on &quot;every&quot; request, or only infrequently (as in a few times a minute or less)? Does this happen on all nodes, or a subset? Also, is the cluster completely transitioned to 3.0, or are you in middle of upgrading?&lt;/p&gt;

&lt;p&gt;As far as logging goes, I&apos;m not sure we have a way to dump error-inducing statements.&lt;/p&gt;</comment>
                            <comment id="15871807" author="ingard" created="Fri, 17 Feb 2017 12:53:06 +0000"  >&lt;p&gt;We started the upgrade process and got that error repeatedly when the server came back up. We found another similar ticket &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12088&quot; title=&quot;Upgrade corrupts SSTables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12088&quot;&gt;&lt;del&gt;CASSANDRA-12088&lt;/del&gt;&lt;/a&gt;, which again referred to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12582&quot; title=&quot;Removing static column results in ReadFailure due to CorruptSSTableException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12582&quot;&gt;&lt;del&gt;CASSANDRA-12582&lt;/del&gt;&lt;/a&gt;. Atm we&apos;ve upgraded all nodes to 3.0.10 and are in the process of running upgradesstables on them.&lt;br/&gt;
The error is still occuring on all nodes, including the ones which have finished the upgradesstables process.&lt;/p&gt;</comment>
                            <comment id="15871814" author="jasobrown" created="Fri, 17 Feb 2017 12:58:44 +0000"  >&lt;p&gt;Is the exception always/only about the &quot;Corrupt flags value for unfiltered partition (isStatic flag set): 160&quot;?&lt;/p&gt;</comment>
                            <comment id="15871819" author="ingard" created="Fri, 17 Feb 2017 13:04:35 +0000"  >&lt;p&gt;yes&lt;/p&gt;</comment>
                            <comment id="15871871" author="jasobrown" created="Fri, 17 Feb 2017 13:42:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ifesdjeen&quot; class=&quot;user-hover&quot; rel=&quot;ifesdjeen&quot;&gt;ifesdjeen&lt;/a&gt; or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Stefania&quot; class=&quot;user-hover&quot; rel=&quot;stefania&quot;&gt;Stefania&lt;/a&gt; any ideas what might be going here? It seems to be failing at &lt;tt&gt;UnfilteredSerializer#deserialize()&lt;/tt&gt;, where it checks the extended flags to see if the row is static (apparently the flags indicate the row is static).&lt;/p&gt;</comment>
                            <comment id="15871878" author="ingard" created="Fri, 17 Feb 2017 13:49:24 +0000"  >&lt;p&gt;as the upgradesstables process is running we&apos;re seeing a change (a bit too soon to conclude maybe). For instance:&lt;/p&gt;

&lt;p&gt;cqlsh&amp;gt; SELECT * FROM collections WHERE username = &apos;redacted&apos; AND collection_type in(0,1,2,3,4,5,6,7);&lt;br/&gt;
ServerError: java.io.IOError: java.io.IOException: Corrupt flags value for unfiltered partition (isStatic flag set): 160&lt;/p&gt;

&lt;p&gt;Its failing there, but sometimes it actually returns data. So maybe the problem is related to one or more of the replicated data sets not having completed the upgradesstables for that specific table yet?&lt;/p&gt;</comment>
                            <comment id="15872063" author="stefania" created="Fri, 17 Feb 2017 16:28:24 +0000"  >&lt;p&gt;My guess is that either the sstable(s) are corrupt, or it&apos;s incorrectly trying to read a static row as a regular row, like for &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12582&quot; title=&quot;Removing static column results in ReadFailure due to CorruptSSTableException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12582&quot;&gt;&lt;del&gt;CASSANDRA-12582&lt;/del&gt;&lt;/a&gt;. If you don&apos;t have too many sstables, you could try to reproduce it with &lt;tt&gt;tools/bin/sstabledump&lt;/tt&gt;. If you can reproduce it and can share the sstable with the problem, then we should be able to debug what is going on.&lt;/p&gt;</comment>
                            <comment id="15872530" author="ifesdjeen" created="Fri, 17 Feb 2017 21:13:07 +0000"  >&lt;p&gt;+1 on what &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Stefania&quot; class=&quot;user-hover&quot; rel=&quot;stefania&quot;&gt;Stefania&lt;/a&gt; said.&lt;/p&gt;

&lt;p&gt;Sometimes it&apos;s also useful to compare the outputs from the old and new sstables, might be helpful to understand how to fix the upgrade path.&lt;/p&gt;

&lt;p&gt;If you can&apos;t show the sstables, you could also try hex-dumping the part of buffer on the exception (with &lt;tt&gt;ByteBufferUtil#bytesAsHex&lt;/tt&gt;), this way you can understand if the sstable is completely off, or it&apos;s just this single byte is written incorrectly. Sometimes the offsets might be wrong, which leads into reader jumping and starting reading from the wrong point in the sstable. &lt;/p&gt;</comment>
                            <comment id="15872732" author="jjirsa" created="Fri, 17 Feb 2017 23:27:19 +0000"  >&lt;p&gt;Likely a dupe of &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12088&quot; title=&quot;Upgrade corrupts SSTables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12088&quot;&gt;&lt;del&gt;CASSANDRA-12088&lt;/del&gt;&lt;/a&gt; , marking as related. &lt;/p&gt;</comment>
                            <comment id="15873036" author="ingardm" created="Sat, 18 Feb 2017 07:33:40 +0000"  >&lt;p&gt;How do I go about comparing the tables? I&apos;ve run upgradesstables on every&lt;br/&gt;
node now, but I still have snapshops from before the upgrade.&lt;/p&gt;</comment>
                            <comment id="15874203" author="ingard" created="Mon, 20 Feb 2017 08:31:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jjirsa&quot; class=&quot;user-hover&quot; rel=&quot;jjirsa&quot;&gt;jjirsa&lt;/a&gt; Yes it might be. We found a change in the scema for one of the tables with 2 deleted static columns from back in april. However the query i mentioned earlier, was not reading from that table.&lt;/p&gt;</comment>
                            <comment id="15874212" author="ingard" created="Mon, 20 Feb 2017 08:37:05 +0000"  >&lt;p&gt;The error is completely gone after upgradesstables finished on all nodes.&lt;/p&gt;</comment>
                            <comment id="15951645" author="jjirsa" created="Fri, 31 Mar 2017 21:04:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ingard&quot; class=&quot;user-hover&quot; rel=&quot;ingard&quot;&gt;ingard&lt;/a&gt; - do you recall if your errors occurred on a cluster that started out as 2.0 and was upgraded 2.0 -&amp;gt; 2.2 -&amp;gt; 3.0 ? &lt;/p&gt;
</comment>
                            <comment id="15997710" author="beobal" created="Fri, 5 May 2017 01:43:29 +0000"  >&lt;p&gt;The error is being thrown when the coordinator deserialises the response from a replica (which may actually be itself) that is reading an old format sstable. The bug is in the serialisation of the replica response which does a double read of the static row, first as the static row, then incorrectly as the partition&apos;s regular row. This only affects tables with column indexes, so doesn&apos;t repro with narrow partitions. With support for pre-3.0 sstables going away in 4.0, the problem only affects 3.0 &amp;amp; 3.x.&lt;/p&gt;

&lt;p&gt;I&apos;ve pushed 3.0 &amp;amp; 3.11 branches and added a dtest to catch this scenario &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/pull/1469&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;, but I need to get up to speed on the new CI workflows, especially running dtests with custom a repo/branch&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;branch&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/beobal/cassandra/tree/13236-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;13236-3.0&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/beobal/cassandra/tree/13236-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;13236-3.11&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15998710" author="jjirsa" created="Fri, 5 May 2017 18:16:14 +0000"  >&lt;p&gt;Queued you up as builds #44 and #45 in dtests here: &lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Unit tests you can do on your own by linking your github account with circleci.com &lt;/p&gt;</comment>
                            <comment id="16003054" author="jjirsa" created="Tue, 9 May 2017 17:02:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=beobal&quot; class=&quot;user-hover&quot; rel=&quot;beobal&quot;&gt;beobal&lt;/a&gt; - Dtests have completed. I&apos;m copying the output below because ASF jenkins doesn&apos;t keep history forever.&lt;/p&gt;

&lt;p&gt;#44 (3.0) shows 14 failures: &lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/44/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/44/&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt; auth_test.TestAuth.system_auth_ks_is_alterable_test (Failed 19 times in the last 30 runs. Flakiness: 65%, Stability: 36%)	2 min 4 sec	4&lt;br/&gt;
 bootstrap_test.TestBootstrap.resumable_bootstrap_test (Failed 1 times in the last 10 runs. Flakiness: 11%, Stability: 90%)	2 min 31 sec	1&lt;br/&gt;
 bootstrap_test.TestBootstrap.simultaneous_bootstrap_test (Failed 26 times in the last 30 runs. Flakiness: 27%, Stability: 13%)	3 min 15 sec	7&lt;br/&gt;
 consistency_test.TestConsistency.short_read_test (Failed 3 times in the last 27 runs. Flakiness: 11%, Stability: 88%)	13 min	1&lt;br/&gt;
 consistency_test.TestConsistency.short_read_test (Failed 3 times in the last 27 runs. Flakiness: 11%, Stability: 88%)	14 min	1&lt;br/&gt;
 hintedhandoff_test.TestHintedHandoffConfig.hintedhandoff_dc_disabled_test (Failed 3 times in the last 10 runs. Flakiness: 44%, Stability: 70%)	1 min 30 sec	1&lt;br/&gt;
 hintedhandoff_test.TestHintedHandoffConfig.hintedhandoff_dc_reenabled_test (Failed 5 times in the last 13 runs. Flakiness: 58%, Stability: 61%)	1 min 51 sec	1&lt;br/&gt;
 hintedhandoff_test.TestHintedHandoffConfig.hintedhandoff_disabled_test (Failed 5 times in the last 13 runs. Flakiness: 58%, Stability: 61%)	1 min 36 sec	1&lt;br/&gt;
 hintedhandoff_test.TestHintedHandoffConfig.hintedhandoff_enabled_test (Failed 5 times in the last 13 runs. Flakiness: 58%, Stability: 61%)	1 min 34 sec	1&lt;br/&gt;
 paxos_tests.TestPaxos.contention_test_many_threads (Failed 9 times in the last 30 runs. Flakiness: 44%, Stability: 70%)	3 min 15 sec	1&lt;br/&gt;
 repair_tests.incremental_repair_test.TestIncRepair.multiple_full_repairs_lcs_test (Failed 3 times in the last 30 runs. Flakiness: 17%, Stability: 90%)	57 sec	1&lt;br/&gt;
 repair_tests.incremental_repair_test.TestIncRepair.multiple_full_repairs_lcs_test (Failed 3 times in the last 30 runs. Flakiness: 17%, Stability: 90%)	58 sec	1&lt;br/&gt;
 repair_tests.repair_test.TestRepair.dc_parallel_repair_test (Failed 2 times in the last 13 runs. Flakiness: 25%, Stability: 84%)	2 min 2 sec	1&lt;br/&gt;
 repair_tests.repair_test.TestRepair.dc_repair_test (Failed 3 times in the last 30 runs. Flakiness: 17%, Stability: 90%)	2 min 3 sec	1&lt;/p&gt;&lt;/blockquote&gt;


&lt;p&gt;#45 (3.11) shows 7 &lt;a href=&quot;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/45/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/view/A-D/view/Cassandra/job/Cassandra-devbranch-dtest/45/testReport/&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt; bootstrap_test.TestBootstrap.simultaneous_bootstrap_test (Failed 26 times in the last 30 runs. Flakiness: 24%, Stability: 13%)	3 min 19 sec	8&lt;br/&gt;
 cqlsh_tests.cqlsh_copy_tests.CqlshCopyTest.test_bulk_round_trip_with_timeouts (Failed 2 times in the last 30 runs. Flakiness: 10%, Stability: 93%)	2 min 57 sec	1&lt;br/&gt;
 hintedhandoff_test.TestHintedHandoffConfig.hintedhandoff_dc_disabled_test (Failed 4 times in the last 11 runs. Flakiness: 40%, Stability: 63%)	2 min 34 sec	2&lt;br/&gt;
 hintedhandoff_test.TestHintedHandoffConfig.hintedhandoff_dc_disabled_test (Failed 4 times in the last 11 runs. Flakiness: 40%, Stability: 63%)	2 min 34 sec	2&lt;br/&gt;
 replace_address_test.TestReplaceAddress.fail_without_replace_test (Failed 4 times in the last 10 runs. Flakiness: 33%, Stability: 60%)	3 min 29 sec	2&lt;br/&gt;
 topology_test.TestTopology.size_estimates_multidc_test (Failed 23 times in the last 30 runs. Flakiness: 41%, Stability: 23%)	2 min 8 sec	1&lt;br/&gt;
 topology_test.TestTopology.size_estimates_multidc_test (Failed 23 times in the last 30 runs. Flakiness: 41%, Stability: 23%)	2 min 11 sec	1&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I see &lt;a href=&quot;https://github.com/beobal/cassandra-dtest/commit/923b8d8d4f6738ac1afbab9221e7ec67cad09bf1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;an upgrade dtest&lt;/a&gt; for this issue - feel that&apos;s sufficient, or were you planning on adding a unit test? &lt;/p&gt;</comment>
                            <comment id="16003271" author="jjirsa" created="Tue, 9 May 2017 18:40:06 +0000"  >&lt;p&gt;Patch looks good to me. I don&apos;t see any indication that any of the dtest failures are related to this patch (they all seem reasonably flakey on their own, except resumable bootstrap test, which seems to have completed a bootstrap while the dtest thought it would still be in progress).&lt;/p&gt;

&lt;p&gt;+1&lt;/p&gt;
</comment>
                            <comment id="16004461" author="beobal" created="Wed, 10 May 2017 10:36:50 +0000"  >&lt;p&gt;Thanks, committed to 3.0 in &lt;tt&gt;415d06b1da7062c48e735c1c20ded031fa0349d2&lt;/tt&gt; and merged to 3.11 &amp;amp; trunk (with &lt;tt&gt;--s ours&lt;/tt&gt; in the latter case)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12982826">CASSANDRA-12088</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12982826">CASSANDRA-12088</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[samt]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 27 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3a8gv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jjirsa</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jjirsa]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>