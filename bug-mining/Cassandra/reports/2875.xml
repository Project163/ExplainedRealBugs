<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:45:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6523] &quot;Unable to contact any seeds!&quot; with multi-DC cluster and listen != broadcast address</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6523</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;New cluster:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Seeds: list of 6 internal IPs&lt;/li&gt;
	&lt;li&gt;listen address: internal ip&lt;/li&gt;
	&lt;li&gt;broadcast: external ip&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Two DC cluster, using GPFS where the external IPs are NATed.  Clusters fails to start with &quot;Unable to contact any seeds!&quot;&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Fail: Try to start a seed node&lt;/li&gt;
	&lt;li&gt;Fail: Try to start two seed nodes at the same time in the same DC&lt;/li&gt;
	&lt;li&gt;Success: Start two seed nodes at the same time in different DCs.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Presumably related to &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5768&quot; title=&quot;If a Seed can&amp;#39;t be contacted, a new node comes up as a cluster of 1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5768&quot;&gt;&lt;del&gt;CASSANDRA-5768&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</description>
                <environment>&lt;p&gt;1.2.13ish&lt;/p&gt;</environment>
        <key id="12686197">CASSANDRA-6523</key>
            <summary>&quot;Unable to contact any seeds!&quot; with multi-DC cluster and listen != broadcast address</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="brandon.williams">Brandon Williams</assignee>
                                    <reporter username="cburroughs">Chris Burroughs</reporter>
                        <labels>
                    </labels>
                <created>Mon, 23 Dec 2013 19:48:45 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:57 +0000</updated>
                            <resolved>Mon, 9 Jun 2014 19:29:19 +0000</resolved>
                                        <fixVersion>2.0.9</fixVersion>
                    <fixVersion>2.1 rc2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="13934138" author="jbellis" created="Thu, 13 Mar 2014 21:43:36 +0000"  >&lt;p&gt;Is this still a problem with 5768 fixed?&lt;/p&gt;</comment>
                            <comment id="13955303" author="cburroughs" created="Mon, 31 Mar 2014 15:37:19 +0000"  >&lt;p&gt;I believe it&apos;s a regression caused by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5768&quot; title=&quot;If a Seed can&amp;#39;t be contacted, a new node comes up as a cluster of 1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5768&quot;&gt;&lt;del&gt;CASSANDRA-5768&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14005965" author="cburroughs" created="Thu, 22 May 2014 14:43:18 +0000"  >&lt;p&gt;Still present in 2.0.x series.  There are a variety of stack overflow and mailing list threads threads with &quot;Unable to contact any seeds&quot;.&lt;/p&gt;

&lt;p&gt;I think the problem is that &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5768&quot; title=&quot;If a Seed can&amp;#39;t be contacted, a new node comes up as a cluster of 1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5768&quot;&gt;&lt;del&gt;CASSANDRA-5768&lt;/del&gt;&lt;/a&gt; isn&apos;t checking &quot;have I contacted a seed&quot; but &quot;am I connected to one of these IP addresses&quot;.  That ends up being  requirement that the seeds/broadcast/listen address line up in a particular way.&lt;/p&gt;</comment>
                            <comment id="14006502" author="brandon.williams" created="Thu, 22 May 2014 21:44:36 +0000"  >&lt;p&gt;It&apos;s comparing the actual IP address it received contact from to the seed list, so if it&apos;s being contacted by the broadcast address, but the seed is listed with the internal address, there won&apos;t be a match.  So, you&apos;d probably want a different seed list for DC 1 and DC 2, with the listen/broadcast switched for the seeds that aren&apos;t local.&lt;/p&gt;</comment>
                            <comment id="14007145" author="cburroughs" created="Fri, 23 May 2014 13:14:59 +0000"  >&lt;p&gt;I don&apos;t think that&apos;s an unreasonable requirement and I can roll with it but if there is an easy way the check could be made contact based instead of string equality based that would be nice.  Starting a cluster is often the first thing someone will do with Cassandra and NATs, firewalls hijacking DNS requests, reconnecting snitches all make this complicated (Top results on stack overflow disagree for example &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt;).&lt;/p&gt;

&lt;p&gt;Barring a more clever check I suggest changing the message to something like &quot;Seed check failed!  At least one boardcast_address must match IPs from seed list&quot;.  Seeing &quot;Handshaking with foo&quot; from the seed list and then &quot;Unable to contact any seeds!&quot; is a confusing experience.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://stackoverflow.com/questions/21261098/cassandra-unable-to-contact-seeds-if-using-aws-elastic-ip-address-only-works&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/questions/21261098/cassandra-unable-to-contact-seeds-if-using-aws-elastic-ip-address-only-works&lt;/a&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://stackoverflow.com/questions/20690987/apache-cassandra-unable-to-gossip-with-any-seeds&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/questions/20690987/apache-cassandra-unable-to-gossip-with-any-seeds&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14007252" author="brandon.williams" created="Fri, 23 May 2014 15:36:53 +0000"  >&lt;p&gt;Part of the problem, is we can&apos;t know a seed&apos;s broadcast_address without, of course, them gossiping it to us.  We could possibly extend the &apos;talked to a seed&apos; check to loop through the endpoints we know about and look for a matching broadcast_address, though that&apos;s a bit expensive and is kind of cheating since we want to know we talked to a seed directly, not that we were told about a seed, but I don&apos;t think that actually matters.  I&apos;ll have to think about it some.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Barring a more clever check I suggest changing the message to something like &quot;Seed check failed! At least one boardcast_address must match IPs from seed list&quot;.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Well, that&apos;s not entirely accurate either, since if you aren&apos;t using BCA at all, it&apos;s confusing.  We could print out the seeds with the error though, so at least between that and the handshaking messages you&apos;d get a clue.&lt;/p&gt;</comment>
                            <comment id="14011231" author="brandon.williams" created="Wed, 28 May 2014 15:53:00 +0000"  >&lt;p&gt;Patch to iterate through the endpoint map and compare both the endpoint address and INTERNAL_IP (if present) to the seeds list instead of tracking it on a per-contact basis.  Possibly expensive in a large cluster, but not called from the gossiper itself so that should be fine.&lt;/p&gt;

&lt;p&gt;I don&apos;t actually have a NAT setup and don&apos;t really want to make one (give myself the disease to test the cure), so if you could test this out Chris that&apos;d help.&lt;/p&gt;</comment>
                            <comment id="14014299" author="jasobrown" created="Fri, 30 May 2014 22:27:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cburroughs&quot; class=&quot;user-hover&quot; rel=&quot;cburroughs&quot;&gt;cburroughs&lt;/a&gt; Not sure how usable this suggestion is, but you could use the external addresses in the seeds list instead of the internal (or mixed per-dc). As GPFS is a &apos;reconnecting snitch&apos;, once the connection of the IP addr is established, the nodes in the same DC will switch over to the internal IP (listen_address). The length of time from node startup to switching the connection to internal IP should be rather short, so your traffic shouldn&apos;t be &apos;unusual&apos; for much time. However, what happens during that &apos;unusual&apos; time may be a deal breaker.&lt;/p&gt;

&lt;p&gt;I bring this up as that&apos;s what we did when running multi-region in ec2, and is what EC2MRS facilitates. &lt;/p&gt;</comment>
                            <comment id="14014663" author="garo5" created="Sat, 31 May 2014 14:04:27 +0000"  >&lt;p&gt;I have a similar issue described in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7292&quot; title=&quot;Can&amp;#39;t seed new node into ring with (public) ip of an old node&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7292&quot;&gt;&lt;del&gt;CASSANDRA-7292&lt;/del&gt;&lt;/a&gt; and in there I use the public ip addresses in the seeds list, but it does not help in my case. These two issues might or might not be connected.&lt;/p&gt;</comment>
                            <comment id="14020303" author="cburroughs" created="Fri, 6 Jun 2014 20:10:22 +0000"  >&lt;p&gt;Jason, thanks for the suggestion.  I think there are a very different ways I could work around it.  At this point though I&apos;d like to see it cleared up so others don&apos;t trip over it too.&lt;/p&gt;

&lt;p&gt;Tested driftx&apos;s patch on top of 2.0.8 with two DCs and the same NAT setup.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Started a node in DC A with auto_bootrap:false and it came up happy.&lt;/li&gt;
	&lt;li&gt;Started a second node in DC A, and it successfully bootstrapped.&lt;/li&gt;
	&lt;li&gt;Stopped all DC A nodes, started a node in DC B with auto_bootrap:true.  It failed with &quot;Unable to contact any seeds!&apos;&lt;/li&gt;
	&lt;li&gt;Started all DC A nodes, nodes in B could bootstrap.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So it looks like it works from my point of view.&lt;/p&gt;</comment>
                            <comment id="14025553" author="jasobrown" created="Mon, 9 Jun 2014 18:58:21 +0000"  >&lt;p&gt;+1 to @driftx&apos;s patch&lt;/p&gt;</comment>
                            <comment id="14025609" author="brandon.williams" created="Mon, 9 Jun 2014 19:29:19 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12647154" name="6523.txt" size="3114" author="brandon.williams" created="Wed, 28 May 2014 15:54:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[brandon.williams]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>365170</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 24 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1qxyf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>365475</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jasobrown</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jasobrown]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>