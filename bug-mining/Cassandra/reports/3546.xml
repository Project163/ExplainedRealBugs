<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:53:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-9197] Startup slowdown due to preloading jemalloc</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-9197</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;On my box, it seems that the jemalloc loading from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8714&quot; title=&quot;row-cache: use preloaded jemalloc w/ Unsafe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8714&quot;&gt;&lt;del&gt;CASSANDRA-8714&lt;/del&gt;&lt;/a&gt; made the process take ~10 seconds to even start (I have no explication for it). I don&apos;t know if it&apos;s specific to my machine or not, so that ticket is mainly so someone else can check if it sees the same, in particular for jenkins. If it does sees the same slowness, we might want to at least disable jemalloc for dtests.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12821306">CASSANDRA-9197</key>
            <summary>Startup slowdown due to preloading jemalloc</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="snazy">Robert Stupp</assignee>
                                    <reporter username="slebresne">Sylvain Lebresne</reporter>
                        <labels>
                    </labels>
                <created>Wed, 15 Apr 2015 21:07:18 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:14 +0000</updated>
                            <resolved>Tue, 12 May 2015 08:42:28 +0000</resolved>
                                        <fixVersion>2.2.0 beta 1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14497032" author="brandon.williams" created="Wed, 15 Apr 2015 21:21:08 +0000"  >&lt;p&gt;I too see this on my test cluster.  Trunk takes about 4s on startup before any text is printed where 2.1 takes less than a second.&lt;/p&gt;</comment>
                            <comment id="14497050" author="philipthompson" created="Wed, 15 Apr 2015 21:29:07 +0000"  >&lt;p&gt;It&apos;s less pronounced for me, but yes I also see it. Should I then change this to a test ticket about disabling jemalloc for dtests?&lt;/p&gt;</comment>
                            <comment id="14497079" author="slebresne" created="Wed, 15 Apr 2015 21:55:14 +0000"  >&lt;p&gt;So I guess we should definitively disable it for the tests. It&apos;s probably also a tad annoying when developing/testing too however, so I guess one question could be if we want to disable jemalloc by default and let people enable it if they actually use the row cache. I don&apos;t care too much either way though.&lt;/p&gt;</comment>
                            <comment id="14497093" author="jbellis" created="Wed, 15 Apr 2015 22:00:30 +0000"  >&lt;p&gt;Doesn&apos;t jemalloc affect all off-heap allocations, or is it really just row cache?&lt;/p&gt;</comment>
                            <comment id="14498447" author="snazy" created="Thu, 16 Apr 2015 18:20:59 +0000"  >&lt;p&gt;jemalloc affects all allocations (including all off-heap allocations)&lt;/p&gt;

&lt;p&gt;It might be possible that the shell script code in &lt;tt&gt;conf/cassandra-env.sh&lt;/tt&gt; gets slower since the &lt;tt&gt;find_library&lt;/tt&gt; might be a bit inefficient. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=philipthompson&quot; class=&quot;user-hover&quot; rel=&quot;philipthompson&quot;&gt;philipthompson&lt;/a&gt; can you try to let &lt;tt&gt;conf/cassandra-env.sh&lt;/tt&gt; skip the &quot;find the jemalloc lib&quot; code and hard-code &lt;tt&gt;CASSANDRA_LIBJEMALLOC&lt;/tt&gt; and see if that mitigates the problem?&lt;/p&gt;</comment>
                            <comment id="14498521" author="brandon.williams" created="Thu, 16 Apr 2015 19:03:49 +0000"  >&lt;p&gt;Also compounding this is after &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7254&quot; title=&quot;NPE on startup if another Cassandra instance is already running&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7254&quot;&gt;&lt;del&gt;CASSANDRA-7254&lt;/del&gt;&lt;/a&gt; we&apos;re launching the JVM twice.&lt;/p&gt;</comment>
                            <comment id="14503229" author="philipthompson" created="Mon, 20 Apr 2015 17:17:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=snazy&quot; class=&quot;user-hover&quot; rel=&quot;snazy&quot;&gt;snazy&lt;/a&gt;, as discussed on IRC. I only notice this problem at the magnitude Brandon or Sylvain are mentioning on linux, not OSX. With Linux, installing jemalloc and then hardcoding the path as you stated does improve the startup time.&lt;/p&gt;</comment>
                            <comment id="14504542" author="slebresne" created="Tue, 21 Apr 2015 07:54:43 +0000"  >&lt;blockquote&gt;&lt;p&gt;hardcoding the path as you stated does improve the startup time&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Out of curiosity, does it make it like without jemalloc? In other words, is it the &lt;tt&gt;find_library&lt;/tt&gt; method that improve the startup time, or is it both that and loading jemalloc?&lt;/p&gt;</comment>
                            <comment id="14504642" author="snazy" created="Tue, 21 Apr 2015 08:58:08 +0000"  >&lt;p&gt;It seems that the &lt;tt&gt;find_library&lt;/tt&gt; method causes the slowdown. I&apos;ve got some patch ready but want to check it first.&lt;/p&gt;</comment>
                            <comment id="14504655" author="snazy" created="Tue, 21 Apr 2015 09:18:28 +0000"  >&lt;p&gt;Patch removes probably expensive looping using shell &lt;tt&gt;while&lt;/tt&gt;/&lt;tt&gt;for&lt;/tt&gt; and replaces it with &lt;tt&gt;find&lt;/tt&gt;.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slebresne&quot; class=&quot;user-hover&quot; rel=&quot;slebresne&quot;&gt;slebresne&lt;/a&gt; can you check whether this solves the problem? I&apos;ve tested it on some Linux VMs (Debian + CentOS).&lt;/p&gt;</comment>
                            <comment id="14504676" author="slebresne" created="Tue, 21 Apr 2015 09:33:08 +0000"  >&lt;p&gt;Yes, the attached patch does seem to solve the problem. Haven&apos;t reviewed the patch more than that however.&lt;/p&gt;</comment>
                            <comment id="14504692" author="snazy" created="Tue, 21 Apr 2015 09:43:37 +0000"  >&lt;p&gt;Thanks, assigned to myself and Philip for review.&lt;/p&gt;</comment>
                            <comment id="14536362" author="snazy" created="Sat, 9 May 2015 10:58:50 +0000"  >&lt;p&gt;ping &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=philipthompson&quot; class=&quot;user-hover&quot; rel=&quot;philipthompson&quot;&gt;philipthompson&lt;/a&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14536616" author="philipthompson" created="Sat, 9 May 2015 14:36:00 +0000"  >&lt;p&gt;Sorry, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=snazy&quot; class=&quot;user-hover&quot; rel=&quot;snazy&quot;&gt;snazy&lt;/a&gt;, I never got the email notication for this. I&apos;ll check it out on Monday.&lt;/p&gt;</comment>
                            <comment id="14538002" author="philipthompson" created="Mon, 11 May 2015 14:51:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=snazy&quot; class=&quot;user-hover&quot; rel=&quot;snazy&quot;&gt;snazy&lt;/a&gt;, +1 to the patch.&lt;/p&gt;</comment>
                            <comment id="14539526" author="snazy" created="Tue, 12 May 2015 08:42:28 +0000"  >&lt;p&gt;Thanks, committed as 7b23b95fdecb9b756cff6a0884c73906e67e65dc&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12726831" name="9197.txt" size="2314" author="snazy" created="Tue, 21 Apr 2015 09:18:28 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[snazy]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 28 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2db3z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>philipthompson</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[philipthompson]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>