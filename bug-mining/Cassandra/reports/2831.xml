<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:45:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-6950] Secondary index query fails with tc range query when ordered by DESC</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-6950</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;    create table test4 ( name text, lname text, tc bigint, record text, PRIMARY KEY ((name, lname), tc)) WITH CLUSTERING ORDER BY (tc DESC) AND compaction=&lt;/p&gt;
{&apos;class&apos;: &apos;LeveledCompactionStrategy&apos;}
&lt;p&gt;;&lt;/p&gt;

&lt;p&gt;    create index test4_index ON test4(lname);&lt;/p&gt;

&lt;p&gt;Populate it with some data and non-zero tc values, then try:&lt;/p&gt;

&lt;p&gt;    select * from test4 where lname=&apos;blah&apos; and tc&amp;gt;0 allow filtering;&lt;/p&gt;

&lt;p&gt;And, (0 rows) returned, even though there are rows which should be found.&lt;/p&gt;

&lt;p&gt;When I create the table using CLUSTERING ORDER BY (tc ASC), the above query works. Rows are correctly returned based on the range check.&lt;/p&gt;

&lt;p&gt;Tried various combinations but with descending order on tc nothing works.&lt;/p&gt;</description>
                <environment>&lt;p&gt;RHEL 6.3 virtual guest, apache-cassandra-2.0.6-SNAPSHOT-src.tar.gz from build #284 (also tried with 2.0.5 with &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-6666&quot; title=&quot;Avoid accumulating tombstones after partial hint replay&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-6666&quot;&gt;&lt;del&gt;CASSANDRA-6666&lt;/del&gt;&lt;/a&gt; patch custom-applied with same result).&lt;/p&gt;</environment>
        <key id="12704312">CASSANDRA-6950</key>
            <summary>Secondary index query fails with tc range query when ordered by DESC</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="acampeau">Andre Campeau</reporter>
                        <labels>
                    </labels>
                <created>Fri, 28 Mar 2014 17:42:28 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:50 +0000</updated>
                            <resolved>Wed, 21 May 2014 09:39:57 +0000</resolved>
                                        <fixVersion>2.0.8</fixVersion>
                                    <component>Feature/2i Index</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13977508" author="jbellis" created="Tue, 22 Apr 2014 21:51:49 +0000"  >&lt;p&gt;duplicate?&lt;/p&gt;</comment>
                            <comment id="13979833" author="slebresne" created="Thu, 24 Apr 2014 15:23:45 +0000"  >&lt;p&gt;It does reproduce on the current cassandra-2.0 branch so I guess not (I&apos;ve pushed the dtest at &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/commit/56a0350eeaa84d01d358724cc915a3c548229c20&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/riptano/cassandra-dtest/commit/56a0350eeaa84d01d358724cc915a3c548229c20&lt;/a&gt;). I&apos;ll have a look.&lt;/p&gt;</comment>
                            <comment id="13990626" author="slebresne" created="Tue, 6 May 2014 13:19:39 +0000"  >&lt;p&gt;The problem is that when the 2ndary code checks if an indexed row satisfies the extra filters (so &lt;tt&gt;tc&amp;gt;0&lt;/tt&gt; in the example of the description), it does so (in &lt;tt&gt;ExtendedFilter.isSatisfiedBy&lt;/tt&gt;) using the underlying reverse comparator (so it check if the &lt;tt&gt;tc&lt;/tt&gt; value is greated than 0 in reverse order, i.e. if &lt;tt&gt;tc&lt;/tt&gt; is negative basically).&lt;/p&gt;

&lt;p&gt;As far as CQL3 goes we could fix it in &lt;tt&gt;ExtendedFilter.isSatisfiedBy&lt;/tt&gt; by check for ReversedType and ignoring it since the IndexExpression are really refering to the non-reverse order, but I guess that would break thrift. So attaching a patch that just reverse the IndexExpression in the first place in SelectStatement.&lt;/p&gt;</comment>
                            <comment id="13992904" author="thobbs" created="Thu, 8 May 2014 16:37:23 +0000"  >&lt;blockquote&gt;&lt;p&gt;As far as CQL3 goes we could fix it in ExtendedFilter.isSatisfiedBy by check for ReversedType and ignoring it since the IndexExpression are really refering to the non-reverse order, but I guess that would break thrift.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Actually, I think that would &lt;b&gt;fix&lt;/b&gt; thrift, because the current behavior could be considered wrong.  See the attached script to reproduce the issue, but to summarize, if we create an index on two columns:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;indexed: LongType&lt;/li&gt;
	&lt;li&gt;indexed2: ReversedType(LongType)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;insert data, then run a query equivalent to &lt;tt&gt;... WHERE indexed = 1 AND indexed2 &amp;lt; 4&lt;/tt&gt;, you&apos;ll get results where indexed2 &amp;gt; 4.&lt;/p&gt;

&lt;p&gt;I have to admit that it&apos;s a little confusing as to whether using ReversedType on indexed2 should invert the comparison, but I feel like ReversedType should only really affect the storage format and not value comparisons.&lt;/p&gt;

&lt;p&gt;In any case, it doesn&apos;t really make sense to use ReversedType on a column validator, so this is unlikely to affect anybody in practice.  So, unless I&apos;m missing another Thrift case that this could affect, I would just make your suggested fix in &lt;tt&gt;ExtendedFilter.isSatisfiedBy&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="13998724" author="slebresne" created="Thu, 15 May 2014 12:29:33 +0000"  >&lt;blockquote&gt;&lt;p&gt;Actually, I think that would fix thrift, because the current behavior could be considered wrong.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Well this is the whole question, what behavior is right for thrift &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. In thrift we never (to the best of my knowledge) special case code for a specific AbstractType, and starting doing so now in that case makes me slightly uncomfortable. In particular, the order  in thrift is so far always directly the one of said AbstractType. So does it makes more sense to ignore ReverseType as defaultValidator/column validator or not, I&apos;m not sure (and I don&apos;t think there is an absolute &quot;right&quot; answer) but doing so would risk breaking user that rely on the current behavior (that has been here basically forever). I&apos;d agree though that using ReversedType for a validator is somewhat whack and probably almost no-one does that, but I&apos;ll admit that I&apos;m leaning towards keeping things the way it is as far as thrift goes just in case someone relies on it (and if someone using this is bugged by this, he can easily remove the ReversedType use). I don&apos;t feel extremely strongly though, if we prefer going with changing thrift too, I&apos;ll just blame it on you if some user complains that we&apos;ve break his code in a minor release &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;</comment>
                            <comment id="14000193" author="thobbs" created="Fri, 16 May 2014 19:35:16 +0000"  >&lt;blockquote&gt;&lt;p&gt;I don&apos;t feel extremely strongly though, if we prefer going with changing thrift too, I&apos;ll just blame it on you if some user complains that we&apos;ve break his code in a minor release &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Hah, okay, I&apos;ll gladly take the blame if this breaks somebody&apos;s very strange code &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.  Fortunately it would be very easy to fix in that case: remove the ReversedType validator or reverse the query operator.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;In thrift we never (to the best of my knowledge) special case code for a specific AbstractType, and starting doing so now in that case makes me slightly uncomfortable.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I understand that feeling, but we probably should have just disallowed ReversedType for column validators in the first place.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;ExtendedFilter.isSatisfiedBy()&lt;/tt&gt; seems like the more logical and future-proof place to make the fix, so I vote for that.&lt;/p&gt;</comment>
                            <comment id="14000345" author="iamaleksey" created="Fri, 16 May 2014 21:29:56 +0000"  >&lt;p&gt;FWIW, I&apos;m against changing it for Thrift in 2.0.x. But support it for 2.1, so long as it&apos;s accompanied by a noticeable NEWS.txt entry. Breaking behaviour, even weird, should not be done this late in the minor-cycle (would be fair game in 2.0.1-2.0.3, but not in 2.0.9, sorry).&lt;/p&gt;</comment>
                            <comment id="14003026" author="slebresne" created="Tue, 20 May 2014 09:54:43 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;m against changing it for Thrift in 2.0.x. But support it for 2.1, so long as it&apos;s accompanied by a noticeable NEWS.txt entry.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;At which point, is there really a point bothering? With thrift, we&apos;re in &quot;don&apos;t break stuff for people&quot; mode after all, not &quot;change edge case behavior to be more logical for the years to come&quot;. Besides, I&apos;m still bugged by making a special case for ReversedType for thrift, it does sound very non-thrift-like to me, and whether or not it is more logical is debatable imo.&lt;/p&gt;

&lt;p&gt;In any case, I tend to agree with Aleksey that no matter what we do for 2.1 we should preserve the behavior in 2.0, so the currently attached patch stands for 2.0 and I&apos;d prefer we first focus on fixing what&apos;s definitively a bug for CQL. Let&apos;s maybe open a separate ticket to debate whether or not changing the thrift behavior is something we want?&lt;/p&gt;</comment>
                            <comment id="14003032" author="iamaleksey" created="Tue, 20 May 2014 09:58:37 +0000"  >&lt;blockquote&gt;&lt;p&gt;But support it for 2.1, so long as it&apos;s accompanied by a noticeable NEWS.txt entry.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Read as &quot;not against&quot;, as in +0.&lt;/p&gt;</comment>
                            <comment id="14003788" author="thobbs" created="Tue, 20 May 2014 18:30:40 +0000"  >&lt;p&gt;The Thrift behavior is such an uncommon case that I&apos;m not concerned about fixing it, I just thought it shouldn&apos;t get in the way of making our preferred fix.  If you prefer the current patch over changing &lt;tt&gt;ExtendedFilter.isSatisfiedBy()&lt;/tt&gt;, then I&apos;m +1 on the patch.&lt;/p&gt;</comment>
                            <comment id="14003794" author="iamaleksey" created="Tue, 20 May 2014 18:35:22 +0000"  >&lt;p&gt;Can we have both? Fix it in the logical place, and then break on the thrift side, to preserve the current behavior? Thus special-casing thrift logic, not CQL?&lt;/p&gt;</comment>
                            <comment id="14004529" author="slebresne" created="Wed, 21 May 2014 09:39:48 +0000"  >&lt;blockquote&gt;&lt;p&gt;Fix it in the logical place, and then break on the thrift side, to preserve the current behavior?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We could, but really, I didn&apos;t meant to imply that the way the attached patch fixes it is illogical per-se. I think it&apos;s fine and simple. So, because I want to release 2.0.8 and we should have this in, committed the attached patch based on Tyler +1. We can bikeshed later if needs be.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12643968" name="6950-pycassa-repro.py" size="1183" author="thobbs" created="Thu, 8 May 2014 16:37:23 +0000"/>
                            <attachment id="12643570" name="6950.txt" size="2527" author="slebresne" created="Tue, 6 May 2014 13:19:39 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>382646</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 26 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1tx8n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>382914</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12326170">2.0.6</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>thobbs</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thobbs]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>