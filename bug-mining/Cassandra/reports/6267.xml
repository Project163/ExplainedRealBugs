<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:27:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-17884] [jamm] Test failure: o.a.c.repair.RepairJobTest.testNoTreesRetainedAfterDifference</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-17884</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;The unit test&#160;&lt;tt&gt;org.apache.cassandra.repair.RepairJobTest#testNoTreesRetainedAfterDifference&lt;/tt&gt; seems to be slightly flaky at least in 4.0. We haven&apos;t seen it failing on Butler, but after &lt;a href=&quot;https://app.circleci.com/pipelines/github/jacek-lewandowski/cassandra/281/workflows/e6094c00-b611-4772-9772-205f4c76ecba/jobs/2126/tests&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;a failure on a patch branch&lt;/a&gt;, this repeated run shows a 0.28% flakiness:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/2076/workflows/8adbfe99-afb5-43af-84ad-43df2a2a86e2/jobs/20816/tests&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/adelapena/cassandra/2076/workflows/8adbfe99-afb5-43af-84ad-43df2a2a86e2/jobs/20816/tests&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://app.circleci.com/pipelines/github/adelapena/cassandra/2076/workflows/e550d8c2-7c35-4326-bd95-6909978d344b/jobs/20817/tests&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/adelapena/cassandra/2076/workflows/e550d8c2-7c35-4326-bd95-6909978d344b/jobs/20817/tests&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.reflect.InaccessibleObjectException: Unable to make field &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; jdk.internal.platform.cgroupv1.SubSystem$MemorySubSystem jdk.internal.platform.cgroupv1.Metrics.memory accessible: module java.base does not &lt;span class=&quot;code-quote&quot;&gt;&quot;opens jdk.internal.platform.cgroupv1&quot;&lt;/span&gt; to unnamed module @157853da
	at java.base/java.lang.reflect.AccessibleObject.checkCanSetAccessible(AccessibleObject.java:340)
	at java.base/java.lang.reflect.AccessibleObject.checkCanSetAccessible(AccessibleObject.java:280)
	at java.base/java.lang.reflect.Field.checkCanSetAccessible(Field.java:176)
	at java.base/java.lang.reflect.Field.setAccessible(Field.java:170)
	at org.github.jamm.MemoryMeter.addFieldChildren(MemoryMeter.java:330)
	at org.github.jamm.MemoryMeter.measureDeep(MemoryMeter.java:269)
	at org.apache.cassandra.utils.ObjectSizes.measureDeep(ObjectSizes.java:216)
	at org.apache.cassandra.repair.RepairJobTest.testNoTreesRetainedAfterDifference(RepairJobTest.java:271)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Flakiness is really low but the failure is clearly reproducible in j11.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13481104">CASSANDRA-17884</key>
            <summary>[jamm] Test failure: o.a.c.repair.RepairJobTest.testNoTreesRetainedAfterDifference</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="adelapena">Andres de la Pe&#241;a</reporter>
                        <labels>
                    </labels>
                <created>Mon, 12 Sep 2022 12:27:46 +0000</created>
                <updated>Fri, 10 Oct 2025 08:47:57 +0000</updated>
                                                <fixVersion>4.0.x</fixVersion>
                    <fixVersion>4.1.x</fixVersion>
                                    <component>Jamm</component>
                    <component>Test/unit</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17609611" author="edimitrova" created="Mon, 26 Sep 2022 17:45:42 +0000"  >&lt;p&gt;The issue is hit very rarely in this test with JDK11 on 4.0+.&lt;/p&gt;</comment>
                            <comment id="17609760" author="edimitrova" created="Tue, 27 Sep 2022 00:29:26 +0000"  >&lt;p&gt;I hit the issue with the MID resources in CircleCI but I suspect we should be able to hit it also without raising resources.&lt;/p&gt;

&lt;p&gt;Started a run here:&#160; &lt;a href=&quot;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/1951/workflows/843b1c08-b7c8-4da1-8ca9-a6df17e5b0f8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/1951/workflows/843b1c08-b7c8-4da1-8ca9-a6df17e5b0f8&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To be able to start that job we need to point CircleCI to the test we want to cover.&lt;/p&gt;

&lt;p&gt;In this case I did it by running the following command from the main cassandra folder, 4.0-based branch:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
.circleci/generate.sh -l &#160; -e REPEATED_UTEST_TARGET=test-jvm-dtest-some &#160; -e REPEATED_UTEST_COUNT=5000 &#160; 
-e REPEATED_UTEST_CLASS=org.apache.cassandra.repair.RepairJobTest &#160; -e REPEATED_UTEST_METHODS=testNoTreesRetainedAfterDifference&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;This resulted in the following commit - &lt;a href=&quot;https://github.com/ekaterinadimitrova2/cassandra/commit/597198f1c8043c4df043d17dfe85752de7227688&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/ekaterinadimitrova2/cassandra/commit/597198f1c8043c4df043d17dfe85752de7227688&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;As those are low resources the tests are still running. I will check the results tomorrow morning.&lt;/p&gt;</comment>
                            <comment id="17609773" author="edimitrova" created="Tue, 27 Sep 2022 01:50:23 +0000"  >&lt;p&gt;Confirmed, the test fails with the low resources too. Only thing is it takes three times more time to run in a loop the test with the free tier.&#160;&lt;/p&gt;</comment>
                            <comment id="17610019" author="edimitrova" created="Tue, 27 Sep 2022 12:12:04 +0000"  >&lt;p&gt;&lt;del&gt;I actually tried an unreleased in maven central jamm jar with the mid resources and this time I didn&apos;t see the issue. I will try one more run to confirm that the issue was solved and I am not missing anything.&lt;/del&gt;&lt;/p&gt;

&lt;p&gt;This is the &lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...ekaterinadimitrova2:cassandra:17884-4.0-hack&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt; where I added a jar including &lt;a href=&quot;https://github.com/jbellis/jamm/commit/33d78c1035211e5f9e69ad9247f3a0f6ef75c923&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this commit&lt;/a&gt; (this is not the latest work in the repo though)&#160;which was supposed to solve that issues with JDK11 according to the author commit message in the jamm repo.&lt;/p&gt;

&lt;p&gt;It seems it didn&apos;t and we are missing something else to filter.&#160;- &lt;a href=&quot;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/1955/workflows/20b3aa2c-fefd-42df-8ad0-b787add2fbb1/jobs/15494/steps&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/1955/workflows/20b3aa2c-fefd-42df-8ad0-b787add2fbb1/jobs/15494/steps&lt;/a&gt;&lt;br/&gt;
I added annoying print in the jamm code and verified it is printed in the CircleCI logs to ensure nothing went wrong and we use the new jar I plugged in.&lt;/p&gt;

&lt;p&gt;I also think we need to get back to the repo &lt;a href=&quot;https://github.com/ekaterinadimitrova2/jamm/blob/33d78c1035211e5f9e69ad9247f3a0f6ef75c923/src/org/github/jamm/TreePrinter.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;TreePrint&lt;/a&gt; class as I think it is really useful for debugging. Others think in the same way. If we feel it lacks some testing, better to add that than to remove it completely.&lt;/p&gt;</comment>
                            <comment id="17620376" author="edimitrova" created="Wed, 19 Oct 2022 14:05:00 +0000"  >&lt;p&gt;Another test in 4.0 hit the same issue - &lt;a href=&quot;https://app.circleci.com/pipelines/github/ekaterinadimitrova2/cassandra/1977/workflows/041331ac-fce0-47ac-b475-83759ac4e2c7/jobs/15701/tests#failed-test-0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testTruncationReleasesLogSpace&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17629134" author="shylaja.kokoori@intel.com" created="Fri, 4 Nov 2022 17:57:04 +0000"  >&lt;p&gt;Thanks for your help Ekaterina, posting summary of conversation we had here&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Issue I have seen so far with this test is when MemoryMeter tries to access fields from JDK internal classes like com.sun.&lt;b&gt;, jdk.internal.&lt;/b&gt; etc. There is a commit in jamm &lt;a href=&quot;https://github.com/jbellis/jamm/commit/33d78c1035211e5f9e69ad9247f3a0f6ef75c923&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jbellis/jamm/commit/33d78c1035211e5f9e69ad9247f3a0f6ef75c923&lt;/a&gt; (Ekaterina pointed me to) addressing this specific issue, but it does not seem to filter out all the JDK internal classes.&lt;/li&gt;
	&lt;li&gt;Also there might be a timing issue involved here. When I step into the code using IntelliJ and look at the values of the variables (adding latency), occurrence of the failure is delayed.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Still trying to figure out when the iteration in MemoryMeter.addFieldChildren should terminate.&lt;/p&gt;

&lt;p&gt;Avoiding access to these internal functions will help JDK11. Foreign function interface available as part of project Panama maybe another option, in later JDK versions, to get the object size.&lt;/p&gt;</comment>
                            <comment id="17684019" author="shylaja.kokoori@intel.com" created="Fri, 3 Feb 2023 20:17:46 +0000"  >&lt;p&gt;There are couple of tasks being worked on to resolve this issue&lt;br/&gt;
1) We suspect there are objects which should not be considered in the object size calculation and those classes need to be marked Unmetered. &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13055125/13055125_RepairSessionTree.txt&quot; title=&quot;RepairSessionTree.txt attached to CASSANDRA-17884&quot;&gt;RepairSessionTree.txt&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; contains a printout of the tree traversed by Jamm for a MeasurableRepairSession object, DebuggableThreadPoolExecutor is an example.&lt;/p&gt;

&lt;p&gt;2) Jamm library needs to handle modules/hidden classes/Java internal classes appropriately, Benjamin is looking into it.&lt;/p&gt;</comment>
                            <comment id="17719966" author="edimitrova" created="Fri, 5 May 2023 18:59:30 +0000"  >&lt;p&gt;Moving this one back to open to acknowledge it is not actively worked on now.&lt;/p&gt;

&lt;p&gt;This one is blocked on&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-18329&quot; title=&quot;Upgrade jamm; fix eclipse problems&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-18329&quot;&gt;&lt;del&gt;CASSANDRA-18329&lt;/del&gt;&lt;/a&gt;&#160;which will happen when new jamm version is released.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13397826">CASSANDRA-16895</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13528438">CASSANDRA-18329</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310760">
                    <name>Testing</name>
                                                                <inwardlinks description="Discovered while testing">
                                        <issuelink>
            <issuekey id="13477046">CASSANDRA-17819</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13055125" name="RepairSessionTree.txt" size="3584" author="skokoori" created="Fri, 3 Feb 2023 20:15:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
                                <customfieldvalue key="12990" cascade-level="1"><![CDATA[Test Failure]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12969"><![CDATA[User Report]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 27 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z18hig:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>