<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:56:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-9970] CQL 3.3 ordering in where clause produces different results when using &quot;IN...ORDER BY&quot;</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-9970</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;This is an issue I found with&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[cqlsh 5.0.1 | Cassandra 2.2.0 | CQL spec 3.3.0 | Native protocol v4]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Given this table and data:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;cqlsh&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;TABLE&lt;/span&gt; myschema.in_test (
   ...     col_1 &lt;span class=&quot;code-keyword&quot;&gt;int&lt;/span&gt;,
   ...     col_2 &lt;span class=&quot;code-keyword&quot;&gt;int&lt;/span&gt;,
   ...     col_3 &lt;span class=&quot;code-keyword&quot;&gt;int&lt;/span&gt;,
   ...     &lt;span class=&quot;code-keyword&quot;&gt;PRIMARY&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;KEY&lt;/span&gt; ((col_1, col_2), col_3)
   ... );
cqlsh&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;INTO&lt;/span&gt; myschema.in_test (col_1, col_2, col_3) &lt;span class=&quot;code-keyword&quot;&gt;VALUES&lt;/span&gt;(1, 1, 1);
cqlsh&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;INTO&lt;/span&gt; myschema.in_test (col_1, col_2, col_3) &lt;span class=&quot;code-keyword&quot;&gt;VALUES&lt;/span&gt;(1, 1, 2);
cqlsh&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;INTO&lt;/span&gt; myschema.in_test (col_1, col_2, col_3) &lt;span class=&quot;code-keyword&quot;&gt;VALUES&lt;/span&gt;(1, 1, 13);
cqlsh&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;INTO&lt;/span&gt; myschema.in_test (col_1, col_2, col_3) &lt;span class=&quot;code-keyword&quot;&gt;VALUES&lt;/span&gt;(1, 2, 10);
cqlsh&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;INTO&lt;/span&gt; myschema.in_test (col_1, col_2, col_3) &lt;span class=&quot;code-keyword&quot;&gt;VALUES&lt;/span&gt;(1, 2, 11);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This query behaves as expected (as described in &lt;a href=&quot;http://docs.datastax.com/en/cql/3.3/cql/cql_using/useQueryIN.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://docs.datastax.com/en/cql/3.3/cql/cql_using/useQueryIN.html&lt;/a&gt;)&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;cqlsh&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;select&lt;/span&gt; * &lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; myschema.in_test &lt;span class=&quot;code-keyword&quot;&gt;where&lt;/span&gt; col_1=1 &lt;span class=&quot;code-keyword&quot;&gt;and&lt;/span&gt; col_2 &lt;span class=&quot;code-keyword&quot;&gt;IN&lt;/span&gt; (1,2) &lt;span class=&quot;code-keyword&quot;&gt;order&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;by&lt;/span&gt; col_3 &lt;span class=&quot;code-keyword&quot;&gt;desc&lt;/span&gt;;
InvalidRequest: code=2200 [Invalid query] message=&lt;span class=&quot;code-quote&quot;&gt;&quot;Cannot page queries &lt;span class=&quot;code-keyword&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;both&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;BY&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;IN&lt;/span&gt; restriction &lt;span class=&quot;code-keyword&quot;&gt;on&lt;/span&gt; the &lt;span class=&quot;code-keyword&quot;&gt;partition&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;key&lt;/span&gt;; you must either remove the &lt;span class=&quot;code-keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;BY&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;or&lt;/span&gt; the &lt;span class=&quot;code-keyword&quot;&gt;IN&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;and&lt;/span&gt; sort client side, &lt;span class=&quot;code-keyword&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;disable&lt;/span&gt; paging &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; this query&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But if you swap the order of the statements in the where clause, the query executes without error and doesn&apos;t totally honor the &lt;em&gt;order by&lt;/em&gt; clause:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;cqlsh&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;select&lt;/span&gt; * &lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; myschema.in_test &lt;span class=&quot;code-keyword&quot;&gt;where&lt;/span&gt; col_2 &lt;span class=&quot;code-keyword&quot;&gt;IN&lt;/span&gt; (1,2) &lt;span class=&quot;code-keyword&quot;&gt;and&lt;/span&gt; col_1=1 &lt;span class=&quot;code-keyword&quot;&gt;order&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;by&lt;/span&gt; col_3 &lt;span class=&quot;code-keyword&quot;&gt;desc&lt;/span&gt;;

 col_1 | col_2 | col_3
&lt;span class=&quot;code-comment&quot;&gt;-------+-------+-------
&lt;/span&gt;     1 |     2 |    11
     1 |     2 |    10
     1 |     1 |    13
     1 |     1 |     2
     1 |     1 |     1

(5 &lt;span class=&quot;code-keyword&quot;&gt;rows&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Apologies in advance if this is working as intended, or I&apos;m duplicating an existing issue. Also please let me know if you need any additional info.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12851235">CASSANDRA-9970</key>
            <summary>CQL 3.3 ordering in where clause produces different results when using &quot;IN...ORDER BY&quot;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="blerer">Benjamin Lerer</assignee>
                                    <reporter username="marrrck">Marc Zbyszynski</reporter>
                        <labels>
                    </labels>
                <created>Mon, 3 Aug 2015 22:39:02 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:02 +0000</updated>
                            <resolved>Mon, 17 Aug 2015 10:51:03 +0000</resolved>
                                        <fixVersion>2.2.1</fixVersion>
                    <fixVersion>3.0 beta 1</fixVersion>
                                    <component>Legacy/CQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14681791" author="blerer" created="Tue, 11 Aug 2015 13:24:53 +0000"  >&lt;p&gt;Thanks for reporting the problem. The issue is a perfectly valid one.&lt;/p&gt;</comment>
                            <comment id="14681800" author="blerer" created="Tue, 11 Aug 2015 13:32:58 +0000"  >&lt;p&gt;The problem comes from the fact that the second query is not considered as an &lt;tt&gt;IN&lt;/tt&gt; query due to a problem in &lt;tt&gt;PrimaryKeyRestrictionSet&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;The patch fixes the problem and add a unit test to verify the behaviour when paging is off.&lt;br/&gt;
The DTest patch add a test to verify the behaviour with paging.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;the unit test result are &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-9970-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;the DTest results are &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-9970-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14681801" author="blerer" created="Tue, 11 Aug 2015 13:33:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Stefania&quot; class=&quot;user-hover&quot; rel=&quot;stefania&quot;&gt;Stefania&lt;/a&gt; could you review?&lt;/p&gt;</comment>
                            <comment id="14681809" author="stefania" created="Tue, 11 Aug 2015 13:41:29 +0000"  >&lt;p&gt;Sure.&lt;/p&gt;</comment>
                            <comment id="14692760" author="stefania" created="Wed, 12 Aug 2015 01:46:15 +0000"  >&lt;p&gt;Patch is +1, great job! &lt;/p&gt;

&lt;p&gt;Let&apos;s rerun the 2.2 dtests to shake off some flaky tests and let&apos;s apply the patch to 3.0 as well and check the CI results there too before committing.&lt;/p&gt;</comment>
                            <comment id="14697609" author="blerer" created="Fri, 14 Aug 2015 19:44:03 +0000"  >&lt;p&gt;The new unit tests caught a problem in the 3.0 branch. I found that there was an issue with the descending ordering for IN relations on the partition key columns. &lt;/p&gt;

&lt;p&gt;I added some extra tests.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;The new patch for 2.2 is &lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...blerer:9970&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;The patch for 3.0 is &lt;a href=&quot;https://github.com/apache/cassandra/compare/trunk...blerer:9970-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The results of the unit tests are &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-9970-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; and &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-9970-3.0-testall/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The results of the dtests are &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-9970-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; and &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/blerer/job/blerer-9970-3.0-dtest/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="14698905" author="stefania" created="Mon, 17 Aug 2015 00:49:07 +0000"  >&lt;p&gt;+1.&lt;/p&gt;

&lt;p&gt;I found a dtest on 2.2 failing only on this branch but it is clearly unrelated (Gossip) and therefore I opened &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10089&quot; title=&quot;NullPointerException in Gossip handleStateNormal&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10089&quot;&gt;&lt;del&gt;CASSANDRA-10089&lt;/del&gt;&lt;/a&gt; for it.&lt;/p&gt;</comment>
                            <comment id="14699365" author="blerer" created="Mon, 17 Aug 2015 10:51:03 +0000"  >&lt;p&gt;Cassandra commit: ee186b6b05569537eb979027176ccee57354c4da&lt;br/&gt;
DTest commit: 2ecff37420e15e4d2b0ab198c7f4b2fcbf230740&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12749838" name="9970.txt" size="3013" author="blerer" created="Tue, 11 Aug 2015 13:32:58 +0000"/>
                            <attachment id="12749839" name="dtest-CASSANDRA-9970.txt" size="1252" author="blerer" created="Tue, 11 Aug 2015 13:32:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blerer]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 14 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2iafb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>stefania</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[stefania]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12332983">2.2.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>