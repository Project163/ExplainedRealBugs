<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:48:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-8033] Filtering for CONTAINS on sets is broken</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-8033</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;With compound partition key, when you add index for one part and query by that AND with CONTAINS, the CONTAINS clause does nothing.&lt;/p&gt;

&lt;p&gt;Steps to reproduce:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;-- drop existing data
DROP TABLE IF EXISTS test;

-- create data
CREATE TABLE test (id1 &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, id2 &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, tag text, items set&amp;lt;text&amp;gt;, PRIMARY KEY ((id1, id2), tag));
INSERT INTO test (id1, id2, tag, items) VALUES (1, 1, &lt;span class=&quot;code-quote&quot;&gt;&apos;cars&apos;&lt;/span&gt;, {&lt;span class=&quot;code-quote&quot;&gt;&apos;ford&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;toyota&apos;&lt;/span&gt;});
INSERT INTO test (id1, id2, tag, items) VALUES (1, 2, &lt;span class=&quot;code-quote&quot;&gt;&apos;planes&apos;&lt;/span&gt;, {&lt;span class=&quot;code-quote&quot;&gt;&apos;airbus&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;boeing&apos;&lt;/span&gt;});
INSERT INTO test (id1, id2, tag, items) VALUES (2, 1, &lt;span class=&quot;code-quote&quot;&gt;&apos;cars&apos;&lt;/span&gt;, {&lt;span class=&quot;code-quote&quot;&gt;&apos;bmw&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ford&apos;&lt;/span&gt;});

-- &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; we create INDEX &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; items, query works ok
CREATE INDEX test_items ON test(items);
SELECT * FROM test WHERE items CONTAINS &lt;span class=&quot;code-quote&quot;&gt;&apos;ford&apos;&lt;/span&gt;;  -- returns 2 rows

-- even &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; works now (but won&apos;t work later)
SELECT * FROM test WHERE id1 = 1 AND items CONTAINS &lt;span class=&quot;code-quote&quot;&gt;&apos;ford&apos;&lt;/span&gt; ALLOW FILTERING;  -- returns 1 row

-- let&apos;s create the index on id1 instead
DROP INDEX test_items;
CREATE INDEX test_id1s ON test(id1);

-- these &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; all rows of id1 = 1 now, CONTAINS clause does nothing
SELECT * FROM test WHERE id1 = 1 AND items CONTAINS &lt;span class=&quot;code-quote&quot;&gt;&apos;ford&apos;&lt;/span&gt; ALLOW FILTERING;  -- should &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; 1 row but returns 2
SELECT * FROM test WHERE id1 = 1 AND items CONTAINS &lt;span class=&quot;code-quote&quot;&gt;&apos;doesnotexist&apos;&lt;/span&gt; ALLOW FILTERING;  -- should &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; 0 rows but returns 2

-- add index back
CREATE INDEX test_items ON test(items);

-- no effect, same as before
SELECT * FROM test WHERE id1 = 1 AND items CONTAINS &lt;span class=&quot;code-quote&quot;&gt;&apos;ford&apos;&lt;/span&gt; ALLOW FILTERING;  -- should &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; 1 row but returns 2
SELECT * FROM test WHERE id1 = 1 AND items CONTAINS &lt;span class=&quot;code-quote&quot;&gt;&apos;doesnotexist&apos;&lt;/span&gt; ALLOW FILTERING;  -- should &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; 0 rows but returns 2
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Sample output:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;cqlsh:stable&amp;gt; -- drop existing data
cqlsh:stable&amp;gt; DROP TABLE IF EXISTS test;
cqlsh:stable&amp;gt; 
cqlsh:stable&amp;gt; -- create data
cqlsh:stable&amp;gt; CREATE TABLE test (id1 &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, id2 &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, tag text, items set&amp;lt;text&amp;gt;, PRIMARY KEY ((id1, id2), tag));
cqlsh:stable&amp;gt; INSERT INTO test (id1, id2, tag, items) VALUES (1, 1, &lt;span class=&quot;code-quote&quot;&gt;&apos;cars&apos;&lt;/span&gt;, {&lt;span class=&quot;code-quote&quot;&gt;&apos;ford&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;toyota&apos;&lt;/span&gt;});
cqlsh:stable&amp;gt; INSERT INTO test (id1, id2, tag, items) VALUES (1, 2, &lt;span class=&quot;code-quote&quot;&gt;&apos;planes&apos;&lt;/span&gt;, {&lt;span class=&quot;code-quote&quot;&gt;&apos;airbus&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;boeing&apos;&lt;/span&gt;});
cqlsh:stable&amp;gt; INSERT INTO test (id1, id2, tag, items) VALUES (2, 1, &lt;span class=&quot;code-quote&quot;&gt;&apos;cars&apos;&lt;/span&gt;, {&lt;span class=&quot;code-quote&quot;&gt;&apos;bmw&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ford&apos;&lt;/span&gt;});
cqlsh:stable&amp;gt; 
cqlsh:stable&amp;gt; -- &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; we create INDEX &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; items, query works ok
cqlsh:stable&amp;gt; CREATE INDEX test_items ON test(items);
cqlsh:stable&amp;gt; SELECT * FROM test WHERE items CONTAINS &lt;span class=&quot;code-quote&quot;&gt;&apos;ford&apos;&lt;/span&gt;;  -- returns 2 rows

 id1 | id2 | tag  | items
-----+-----+------+--------------------
   2 |   1 | cars |    {&lt;span class=&quot;code-quote&quot;&gt;&apos;bmw&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ford&apos;&lt;/span&gt;}
   1 |   1 | cars | {&lt;span class=&quot;code-quote&quot;&gt;&apos;ford&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;toyota&apos;&lt;/span&gt;}

(2 rows)

cqlsh:stable&amp;gt; 
cqlsh:stable&amp;gt; -- even &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; works now (but won&apos;t work later)
cqlsh:stable&amp;gt; SELECT * FROM test WHERE id1 = 1 AND items CONTAINS &lt;span class=&quot;code-quote&quot;&gt;&apos;ford&apos;&lt;/span&gt; ALLOW FILTERING;  -- returns 1 row

 id1 | id2 | tag  | items
-----+-----+------+--------------------
   1 |   1 | cars | {&lt;span class=&quot;code-quote&quot;&gt;&apos;ford&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;toyota&apos;&lt;/span&gt;}

(1 rows)

cqlsh:stable&amp;gt; 
cqlsh:stable&amp;gt; -- let&apos;s create the index on id1 instead
cqlsh:stable&amp;gt; DROP INDEX test_items;
cqlsh:stable&amp;gt; CREATE INDEX test_id1s ON test(id1);
cqlsh:stable&amp;gt; 
cqlsh:stable&amp;gt; -- these &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; all rows of id1 = 1 now, CONTAINS clause does nothing
cqlsh:stable&amp;gt; SELECT * FROM test WHERE id1 = 1 AND items CONTAINS &lt;span class=&quot;code-quote&quot;&gt;&apos;ford&apos;&lt;/span&gt; ALLOW FILTERING;  -- should &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; 1 row but returns 2

 id1 | id2 | tag    | items
-----+-----+--------+----------------------
   1 |   2 | planes | {&lt;span class=&quot;code-quote&quot;&gt;&apos;airbus&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;boeing&apos;&lt;/span&gt;}
   1 |   1 |   cars |   {&lt;span class=&quot;code-quote&quot;&gt;&apos;ford&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;toyota&apos;&lt;/span&gt;}

(2 rows)

cqlsh:stable&amp;gt; SELECT * FROM test WHERE id1 = 1 AND items CONTAINS &lt;span class=&quot;code-quote&quot;&gt;&apos;doesnotexist&apos;&lt;/span&gt; ALLOW FILTERING;  -- should &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; 0 rows but returns 2

 id1 | id2 | tag    | items
-----+-----+--------+----------------------
   1 |   2 | planes | {&lt;span class=&quot;code-quote&quot;&gt;&apos;airbus&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;boeing&apos;&lt;/span&gt;}
   1 |   1 |   cars |   {&lt;span class=&quot;code-quote&quot;&gt;&apos;ford&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;toyota&apos;&lt;/span&gt;}

(2 rows)

cqlsh:stable&amp;gt; 
cqlsh:stable&amp;gt; -- add index back
cqlsh:stable&amp;gt; CREATE INDEX test_items ON test(items);
cqlsh:stable&amp;gt; 
cqlsh:stable&amp;gt; -- no effect, same as before
cqlsh:stable&amp;gt; SELECT * FROM test WHERE id1 = 1 AND items CONTAINS &lt;span class=&quot;code-quote&quot;&gt;&apos;ford&apos;&lt;/span&gt; ALLOW FILTERING;  -- should &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; 1 row but returns 2

 id1 | id2 | tag    | items
-----+-----+--------+----------------------
   1 |   2 | planes | {&lt;span class=&quot;code-quote&quot;&gt;&apos;airbus&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;boeing&apos;&lt;/span&gt;}
   1 |   1 |   cars |   {&lt;span class=&quot;code-quote&quot;&gt;&apos;ford&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;toyota&apos;&lt;/span&gt;}

(2 rows)

cqlsh:stable&amp;gt; SELECT * FROM test WHERE id1 = 1 AND items CONTAINS &lt;span class=&quot;code-quote&quot;&gt;&apos;doesnotexist&apos;&lt;/span&gt; ALLOW FILTERING;  -- should &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; 0 rows but returns 2

 id1 | id2 | tag    | items
-----+-----+--------+----------------------
   1 |   2 | planes | {&lt;span class=&quot;code-quote&quot;&gt;&apos;airbus&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;boeing&apos;&lt;/span&gt;}
   1 |   1 |   cars |   {&lt;span class=&quot;code-quote&quot;&gt;&apos;ford&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;toyota&apos;&lt;/span&gt;}

(2 rows)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;ubuntu 14.04 lts, cassandra 2.1.0&lt;/p&gt;</environment>
        <key id="12745249">CASSANDRA-8033</key>
            <summary>Filtering for CONTAINS on sets is broken</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thobbs">Tom Hobbs</assignee>
                                    <reporter username="tuukkamustonen">Tuukka Mustonen</reporter>
                        <labels>
                    </labels>
                <created>Wed, 1 Oct 2014 13:07:11 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:32 +0000</updated>
                            <resolved>Tue, 7 Oct 2014 15:23:30 +0000</resolved>
                                        <fixVersion>2.1.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14155267" author="thobbs" created="Wed, 1 Oct 2014 18:40:13 +0000"  >&lt;p&gt;The problem was that when filtering for CONTAINS on sets, we were comparing cell values with the index expression instead of the cell names.&lt;/p&gt;

&lt;p&gt;8033-2.1.txt fixes that and adds a unit test that reproduces the issue.&lt;/p&gt;</comment>
                            <comment id="14155270" author="thobbs" created="Wed, 1 Oct 2014 18:41:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blerer&quot; class=&quot;user-hover&quot; rel=&quot;blerer&quot;&gt;blerer&lt;/a&gt; can you review?&lt;/p&gt;</comment>
                            <comment id="14160154" author="blerer" created="Mon, 6 Oct 2014 10:11:31 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14161997" author="thobbs" created="Tue, 7 Oct 2014 15:23:30 +0000"  >&lt;p&gt;Thanks, committed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12672378" name="8033-2.1.txt" size="3291" author="thobbs" created="Wed, 1 Oct 2014 18:40:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[thobbs]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 7 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i20oo7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12327256">2.1.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>blerer</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blerer]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>