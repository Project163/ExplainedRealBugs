<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:11:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-14540] Internode messaging handshake sends wrong messaging version number</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-14540</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;With the refactor of internode messaging to netty in 4.0, we abstracted the protocol handshakes messages into a class and handlers. There is a bug when the initiator of the connection sends, in the third message of the handshake, it&apos;s own default protocol version number (&lt;tt&gt;MessagingService.current_version&lt;/tt&gt;), rather than the negotiated version. This was not causing any obvious problems when &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-8457&quot; title=&quot;nio MessagingService&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-8457&quot;&gt;&lt;del&gt;CASSANDRA-8457&lt;/del&gt;&lt;/a&gt; was initially committed, but the bug is exposed after &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7544&quot; title=&quot;Allow storage port to be configurable per node&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7544&quot;&gt;&lt;del&gt;CASSANDRA-7544&lt;/del&gt;&lt;/a&gt;. The problem is during rolling upgrades of 3.0/3.X to 4.0, nodes cannot correctly connect. &lt;/p&gt;</description>
                <environment></environment>
        <key id="13167817">CASSANDRA-14540</key>
            <summary>Internode messaging handshake sends wrong messaging version number</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10000" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Urgent</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jasobrown">Jason Brown</assignee>
                                    <reporter username="jasobrown">Jason Brown</reporter>
                        <labels>
                    </labels>
                <created>Sat, 23 Jun 2018 12:16:36 +0000</created>
                <updated>Fri, 15 May 2020 08:06:13 +0000</updated>
                            <resolved>Mon, 25 Jun 2018 13:42:58 +0000</resolved>
                                        <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Legacy/Streaming and Messaging</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16521066" author="jasobrown" created="Sat, 23 Jun 2018 12:18:23 +0000"  >&lt;p&gt;Here is a one-line patch to send the correctly negotiated version.&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;internode-msg-version-fix&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/jasobrown/cassandra/tree/internode-msg-version-fix&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/jasobrown/workflows/cassandra/tree/internode-msg-version-fix&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utests &amp;amp; dtests&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;Note: the failing &lt;tt&gt;MessagingServiceTest&lt;/tt&gt; utest is unrelated to this change, and is failing on &lt;a href=&quot;https://circleci.com/gh/jasobrown/workflows/cassandra/tree/trunk-circle&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;vanilla trunk&lt;/a&gt;. I&apos;ll resolve that in a separate ticket.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aweisberg&quot; class=&quot;user-hover&quot; rel=&quot;aweisberg&quot;&gt;aweisberg&lt;/a&gt; / &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=djoshi3&quot; class=&quot;user-hover&quot; rel=&quot;djoshi3&quot;&gt;djoshi3&lt;/a&gt;: Can one of you review, please?&lt;/p&gt;</comment>
                            <comment id="16521596" author="djoshi3" created="Sun, 24 Jun 2018 20:03:32 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jasobrown&quot; class=&quot;user-hover&quot; rel=&quot;jasobrown&quot;&gt;jasobrown&lt;/a&gt;, this is a good catch. Just curious if the upgrade tests dtest caught this?&lt;/p&gt;

&lt;p&gt;Regarding, the change, would it be possible to add a test in &lt;tt&gt;OutboundHandshakeHandlerTest&lt;/tt&gt; to check that we use the negotiated version number?&lt;/p&gt;</comment>
                            <comment id="16521707" author="jasobrown" created="Sun, 24 Jun 2018 22:29:26 +0000"  >&lt;p&gt;upgrade_tests are currently disabled/non-funcational (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-14421&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CASSANDRA-14421&lt;/a&gt;) (sadpanda). I&apos;m working on that soon-ish. &lt;/p&gt;

&lt;p&gt;I can add a test, and thanks for the push!&lt;/p&gt;</comment>
                            <comment id="16521709" author="jasobrown" created="Sun, 24 Jun 2018 23:03:36 +0000"  >&lt;p&gt;Tests added to &lt;tt&gt;OutboundHandshakeHandlerTest&lt;/tt&gt;, and a new commit is on the same branch.&lt;/p&gt;</comment>
                            <comment id="16521858" author="djoshi3" created="Mon, 25 Jun 2018 05:16:49 +0000"  >&lt;p&gt;Thanks, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jasobrown&quot; class=&quot;user-hover&quot; rel=&quot;jasobrown&quot;&gt;jasobrown&lt;/a&gt;&#160;LGTM +1&lt;/p&gt;</comment>
                            <comment id="16522292" author="jasobrown" created="Mon, 25 Jun 2018 13:42:58 +0000"  >&lt;p&gt;committed as sha &lt;tt&gt;5db822b71ad7278ca6443455d029dd79e22388d8&lt;/tt&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="13163194">CASSANDRA-14485</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jasobrown]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 21 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3v5vz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>djoshi</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[djoshi]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>