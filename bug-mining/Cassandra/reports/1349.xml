<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:28:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-3616] Temp SSTable and file descriptor leak</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-3616</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;Discussion about this started in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3532&quot; title=&quot;Compaction cleanupIfNecessary costly when many files in data dir&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3532&quot;&gt;&lt;del&gt;CASSANDRA-3532&lt;/del&gt;&lt;/a&gt;.  It&apos;s on it&apos;s own ticket now.&lt;/p&gt;

&lt;p&gt;Anyhow:&lt;br/&gt;
The nodes in my cluster are using a lot of file descriptors, holding open tmp files. A few are using 50K+, nearing their limit (on Solaris, of 64K).&lt;/p&gt;

&lt;p&gt;Here&apos;s a small snippet of lsof:&lt;br/&gt;
java 828 appdeployer *162u VREG 181,65540 0 333884 /data1/cassandra/data/MA_DDR/messages_meta-tmp-hb-776518-Data.db&lt;br/&gt;
java 828 appdeployer *163u VREG 181,65540 0 333502 /data1/cassandra/data/MA_DDR/messages_meta-tmp-hb-776452-Data.db&lt;br/&gt;
java 828 appdeployer *165u VREG 181,65540 0 333929 /data1/cassandra/data/MA_DDR/messages_meta-tmp-hb-776527-Index.db&lt;br/&gt;
java 828 appdeployer *166u VREG 181,65540 0 333859 /data1/cassandra/data/MA_DDR/messages_meta-tmp-hb-776514-Data.db&lt;br/&gt;
java 828 appdeployer *167u VREG 181,65540 0 333663 /data1/cassandra/data/MA_DDR/messages_meta-tmp-hb-776480-Data.db&lt;br/&gt;
java 828 appdeployer *168u VREG 181,65540 0 333812 /data1/cassandra/data/MA_DDR/messages_meta-tmp-hb-776506-Index.db&lt;/p&gt;

&lt;p&gt;I spot checked a few and found they still exist on the filesystem too:&lt;br/&gt;
rw-rr- 1 appdeployer appdeployer 0 Dec 12 07:16 /data1/cassandra/data/MA_DDR/messages_meta-tmp-hb-776506-Index.db&lt;/p&gt;


&lt;p&gt;After more investigation, it seems to happen during a CompactionTask.&lt;br/&gt;
I waited until I saw some &lt;del&gt;tmp&lt;/del&gt; files hanging around in the data dir:&lt;/p&gt;

&lt;p&gt;&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-   1 appdeployer appdeployer       0 Dec 12 21:47:10 2011 messages_meta-tmp-hb-788904-Data.db&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-   1 appdeployer appdeployer       0 Dec 12 21:47:10 2011 messages_meta-tmp-hb-788904-Index.db&lt;/p&gt;

&lt;p&gt;and then found this in the logs:&lt;br/&gt;
 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:18839&amp;#93;&lt;/span&gt; 2011-12-12 21:47:07,173 CompactionTask.java (line 113) Compacting &lt;span class=&quot;error&quot;&gt;&amp;#91;SSTableReader(path=&amp;#39;/data1/cassandra/data/MA_DDR/messages_meta-hb-760408-Data.db&amp;#39;), SSTableReader(path=&amp;#39;/data1/cassandra/data/MA_DDR/messages_meta-hb-760413-Data.db&amp;#39;), SSTableReader(path=&amp;#39;/data1/cassandra/data/MA_DDR/messages_meta-hb-760409-Data.db&amp;#39;), SSTableReader(path=&amp;#39;/data1/cassandra/data/MA_DDR/messages_meta-hb-788314-Data.db&amp;#39;), SSTableReader(path=&amp;#39;/data1/cassandra/data/MA_DDR/messages_meta-hb-760407-Data.db&amp;#39;), SSTableReader(path=&amp;#39;/data1/cassandra/data/MA_DDR/messages_meta-hb-760412-Data.db&amp;#39;), SSTableReader(path=&amp;#39;/data1/cassandra/data/MA_DDR/messages_meta-hb-760410-Data.db&amp;#39;), SSTableReader(path=&amp;#39;/data1/cassandra/data/MA_DDR/messages_meta-hb-760411-Data.db&amp;#39;)&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:18839&amp;#93;&lt;/span&gt; 2011-12-12 21:47:10,461 CompactionTask.java (line 218) Compacted to &lt;span class=&quot;error&quot;&gt;&amp;#91;/data1/cassandra/data/MA_DDR/messages_meta-hb-788896-Data.db,/data1/cassandra/data/MA_DDR/messages_meta-hb-788897-Data.db,/data1/cassandra/data/MA_DDR/messages_meta-hb-788898-Data.db,/data1/cassandra/data/MA_DDR/messages_meta-hb-788899-Data.db,/data1/cassandra/data/MA_DDR/messages_meta-hb-788900-Data.db,/data1/cassandra/data/MA_DDR/messages_meta-hb-788901-Data.db,/data1/cassandra/data/MA_DDR/messages_meta-hb-788902-Data.db,/data1/cassandra/data/MA_DDR/messages_meta-hb-788903-Data.db,&amp;#93;&lt;/span&gt;.  83,899,295 to 83,891,657 (~99% of original) bytes for 75,662 keys at 24.332518MB/s.  Time: 3,288ms.&lt;/p&gt;

&lt;p&gt;Note that the timestamp of the 2nd log line matches the last modified time of the files, and has IDs leading up to, &lt;b&gt;but not including 788904&lt;/b&gt;.&lt;/p&gt;

&lt;p&gt;I thought this might be relavent information, but I haven&apos;t found the specific cause yet.&lt;/p&gt;</description>
                <environment>&lt;p&gt;1.0.5 + &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3532&quot; title=&quot;Compaction cleanupIfNecessary costly when many files in data dir&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3532&quot;&gt;&lt;del&gt;CASSANDRA-3532&lt;/del&gt;&lt;/a&gt; patch&lt;br/&gt;
Solaris 10&lt;/p&gt;</environment>
        <key id="12534843">CASSANDRA-3616</key>
            <summary>Temp SSTable and file descriptor leak</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slebresne">Sylvain Lebresne</assignee>
                                    <reporter username="eparusel">Eric Parusel</reporter>
                        <labels>
                    </labels>
                <created>Mon, 12 Dec 2011 22:07:21 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:44 +0000</updated>
                            <resolved>Mon, 19 Dec 2011 09:28:15 +0000</resolved>
                                        <fixVersion>1.0.7</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="13169498" author="jborgstrom" created="Wed, 14 Dec 2011 16:56:50 +0000"  >&lt;p&gt;Just a quick &quot;me too&quot;.&lt;/p&gt;

&lt;p&gt;After upgrading from 1.0.3 to 1.0.6 I see a bunch of left over 0 byte tmp files:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;-rw-r--r--  1 cassandra 215          0 Dec 14 16:25 LogTokenIndex-tmp-hc-3175-Data.db
-rw-r--r--  1 cassandra 215          0 Dec 14 16:25 LogTokenIndex-tmp-hc-3175-Index.db
-rw-r--r--  1 cassandra 215          0 Dec 14 16:33 LogToken-tmp-hc-3093-Data.db
-rw-r--r--  1 cassandra 215          0 Dec 14 16:33 LogToken-tmp-hc-3093-Index.db
-rw-r--r--  1 cassandra 215          0 Dec 14 16:37 LogToken-tmp-hc-3104-Data.db
-rw-r--r--  1 cassandra 215          0 Dec 14 16:37 LogToken-tmp-hc-3104-Index.db
-rw-r--r--  1 cassandra 215          0 Dec 14 16:37 LogToken-tmp-hc-3105-Data.db
-rw-r--r--  1 cassandra 215          0 Dec 14 16:37 LogToken-tmp-hc-3105-Index.db
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The timestamp suggests that they were created during a nodetool repair session.&lt;/p&gt;</comment>
                            <comment id="13170323" author="jbellis" created="Thu, 15 Dec 2011 16:17:19 +0000"  >&lt;p&gt;Eric, do you also see correlation w/ repair operations?&lt;/p&gt;</comment>
                            <comment id="13170333" author="eparusel" created="Thu, 15 Dec 2011 16:32:10 +0000"  >&lt;p&gt;I haven&apos;t run a repair lately (no deletes at this time, I plan on setting up scheduled repairs though), but can run one to find out in the next few hours.&lt;/p&gt;

&lt;p&gt;So far I&apos;ve only correlated it with compaction.&lt;br/&gt;
I should note we&apos;re using LeveledCompactionStrategy.&lt;/p&gt;</comment>
                            <comment id="13170393" author="brandon.williams" created="Thu, 15 Dec 2011 18:29:23 +0000"  >&lt;p&gt;I can reproduce this with SizeTieredStrategy.&lt;/p&gt;</comment>
                            <comment id="13170396" author="jbellis" created="Thu, 15 Dec 2011 18:35:59 +0000"  >&lt;p&gt;Just with compaction?  Did you get a debug log?&lt;/p&gt;</comment>
                            <comment id="13170414" author="brandon.williams" created="Thu, 15 Dec 2011 19:05:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-3532&quot; title=&quot;Compaction cleanupIfNecessary costly when many files in data dir&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-3532&quot;&gt;&lt;del&gt;CASSANDRA-3532&lt;/del&gt;&lt;/a&gt; is the culprit here.&lt;/p&gt;</comment>
                            <comment id="13170442" author="slebresne" created="Thu, 15 Dec 2011 19:47:22 +0000"  >&lt;p&gt;I believe the problem is that when compaction is over we were creating an empty (and useless) writer. Previously we were just deleting it right away because the &apos;cleanupIfNeeded&apos; was in the finally.&lt;/p&gt;

&lt;p&gt;Patch attached to not create it in the first place.&lt;/p&gt;</comment>
                            <comment id="13170481" author="jbellis" created="Thu, 15 Dec 2011 20:41:16 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13171192" author="eparusel" created="Fri, 16 Dec 2011 21:02:50 +0000"  >&lt;p&gt;1.0.6 + 3616.patch fixes this issue for me, thanks!&lt;/p&gt;</comment>
                            <comment id="13172130" author="slebresne" created="Mon, 19 Dec 2011 09:28:15 +0000"  >&lt;p&gt;Committed, thanks&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12507568" name="3616.patch" size="1490" author="slebresne" created="Thu, 15 Dec 2011 19:47:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[slebresne]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>220527</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 49 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gm3b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>95009</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jbellis</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>