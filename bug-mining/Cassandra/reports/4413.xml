<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:04:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-12436] Under some races commit log may incorrectly think it has unflushed data</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-12436</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;This can mainfest itself as a &quot;Failed to force-recycle all segments; at least one segment is still in use with dirty CFs.&quot; message after &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11828&quot; title=&quot;Commit log needs to track unflushed intervals rather than positions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11828&quot;&gt;&lt;del&gt;CASSANDRA-11828&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12996604">CASSANDRA-12436</key>
            <summary>Under some races commit log may incorrectly think it has unflushed data</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="blambov">Branimir Lambov</assignee>
                                    <reporter username="blambov">Branimir Lambov</reporter>
                        <labels>
                    </labels>
                <created>Thu, 11 Aug 2016 12:54:13 +0000</created>
                <updated>Tue, 14 Oct 2025 12:13:55 +0000</updated>
                            <resolved>Mon, 22 Aug 2016 19:35:08 +0000</resolved>
                                        <fixVersion>3.0.9</fixVersion>
                    <fixVersion>3.9</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="15417236" author="blambov" created="Thu, 11 Aug 2016 13:31:18 +0000"  >&lt;p&gt;Patch uploaded here:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/blambov/cassandra/tree/12436-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/job/blambov-12436-3.0-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/job/blambov-12436-3.0-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/blambov/cassandra/tree/12436-3.9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.9&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/job/blambov-12436-3.9-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/job/blambov-12436-3.9-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;Stops removing empty memtables from list sent to post-flush, adds test and improves logging.&lt;/p&gt;</comment>
                            <comment id="15417444" author="tjake" created="Thu, 11 Aug 2016 15:34:00 +0000"  >&lt;p&gt;Can you explain why a empty memtable would cause a dirty section in the CL?  &lt;/p&gt;

&lt;p&gt;Nit: &lt;a href=&quot;https://github.com/blambov/cassandra/commit/fc5375d3db26a7aab56f329576330c7732b8aa73#diff-98f5acb96aa6d684781936c141132e2aR1075&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;This comment&lt;/a&gt; is no longer accurate, we don&apos;t remove the memtable anymore&lt;/p&gt;</comment>
                            <comment id="15417495" author="blambov" created="Thu, 11 Aug 2016 16:05:45 +0000"  >&lt;p&gt;The dirty set is a single interval, so that it can be easily updated on allocation (from performance point of view it is infeasible to track the dirty positions more closely). If there is a write after the empty memtable&apos;s flush, the dirty interval will also cover the commit log positions between the creation of that memtable and its flushing, which will have advanced if writes to other tables happened during that period.&lt;/p&gt;

&lt;p&gt;The comment is actually accurate, we do remove the tables from the CFS&apos;s live list. We no longer remove them from the set to flush + post-flush.&lt;/p&gt;</comment>
                            <comment id="15417517" author="tjake" created="Thu, 11 Aug 2016 16:19:02 +0000"  >&lt;p&gt;Ok I get it thx.  &lt;/p&gt;

&lt;p&gt;The 3.0 dtests look bad assume its environmental. assuming tests work out clean +1&lt;/p&gt;</comment>
                            <comment id="15417733" author="JIRAUSER308715" created="Thu, 11 Aug 2016 18:44:58 +0000"  >&lt;p&gt;dtests are failing with:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Subprocess [&lt;span class=&quot;code-quote&quot;&gt;&apos;stress&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;write&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;n=10K&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;no-warmup&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;-rate&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;threads=8&apos;&lt;/span&gt;] exited with non-zero status; exit status: 1; 
stderr: Error: Could not find or load main &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.cassandra.stress.Stress
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=philipthompson&quot; class=&quot;user-hover&quot; rel=&quot;philipthompson&quot;&gt;philipthompson&lt;/a&gt; is there a known problem with those right now?&lt;/p&gt;</comment>
                            <comment id="15417794" author="jkni" created="Thu, 11 Aug 2016 19:25:05 +0000"  >&lt;p&gt;The problem here is with the 3.0 branch. Unfortunately, it is concealed by a few unfortunate things.&lt;/p&gt;

&lt;p&gt;The &lt;a href=&quot;http://cassci.datastax.com/job/blambov-12436-3.0-testall/1/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0 unit tests&lt;/a&gt; didn&apos;t actually run because unit test compilation failed. There is a bug in some of the test tooling such that it doesn&apos;t preserve return codes, so a build that fails on compilation will run no tests and appear as passing (since it has no failed tests). I&apos;m doing my best to get this fixed soon and may do it myself.&lt;/p&gt;

&lt;p&gt;On the 3.0 dtests, some ran successfully because of the order of compilation (C* -&amp;gt; C* unit tests -&amp;gt; C* tooling). Since the bug was in C* unit tests, stress didn&apos;t get built so the class was missing.&lt;/p&gt;

&lt;p&gt;The problem is in the unit test added. CDC introduced the segmentManager field. It was called allocator in previous versions, including 3.0. In addition, the &lt;tt&gt;executeFormattedQuery&lt;/tt&gt; method was added in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12282&quot; title=&quot;SSTablesIteratedTest.testDeletionOnIndexedSSTableASC-compression failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12282&quot;&gt;&lt;del&gt;CASSANDRA-12282&lt;/del&gt;&lt;/a&gt;, which hasn&apos;t been committed to 3.0.&lt;/p&gt;
</comment>
                            <comment id="15418582" author="blambov" created="Fri, 12 Aug 2016 09:32:17 +0000"  >&lt;p&gt;I should have noticed the strangely short time of the testall run. Fixed now, the only failures are tests that have recently also failed on base.&lt;/p&gt;</comment>
                            <comment id="15419005" author="tjake" created="Fri, 12 Aug 2016 15:32:17 +0000"  >&lt;p&gt;Committed to 3.0 as &lt;tt&gt;5cef78af9214308ef817de43ec36054a2549329c&lt;/tt&gt;&lt;br/&gt;
Committed to 3.9 as &lt;tt&gt;ca556c442049808c013bd20649d6611eb4a01a61&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Does this also affect 3.8? If so we should cherry pick to there. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blambov&quot; class=&quot;user-hover&quot; rel=&quot;blambov&quot;&gt;blambov&lt;/a&gt; can you post a 3.8 branch if so?&lt;/p&gt;</comment>
                            <comment id="15420853" author="blambov" created="Mon, 15 Aug 2016 11:12:23 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/blambov/cassandra/tree/12436-3.8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.8&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/job/blambov-12436-3.8-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;utest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/job/blambov-12436-3.8-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;The tests are quite dirty on the 3.8 base, patch doesn&apos;t look different.&lt;/p&gt;</comment>
                            <comment id="15431462" author="iamaleksey" created="Mon, 22 Aug 2016 19:34:54 +0000"  >&lt;p&gt;Given that we are planning to push out 3.8 and 3.9 off cassandra-3.9 both, I&apos;m closing the ticket, as it will go into 3.8 just by virtue of being committed to cassandra-3.9 already.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12970714">CASSANDRA-11828</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blambov]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 13 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3278v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>tjake</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[tjake]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>