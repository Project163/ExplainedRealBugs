<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:14:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-14740] BlockingReadRepair does not maintain monotonicity during range movements</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-14740</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;The BlockingReadRepair code introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-10726&quot; title=&quot;Read repair inserts should not be blocking&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-10726&quot;&gt;&lt;del&gt;CASSANDRA-10726&lt;/del&gt;&lt;/a&gt; requires that each of the queried nodes are written to, but pending nodes are not considered. &#160;If there is a pending range movement, one of these writes may be &#8216;lost&#8217; when the range movement completes.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13184634">CASSANDRA-14740</key>
            <summary>BlockingReadRepair does not maintain monotonicity during range movements</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10000" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Urgent</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="benedict">Benedict Elliott Smith</assignee>
                                    <reporter username="benedict">Benedict Elliott Smith</reporter>
                        <labels>
                            <label>correctness</label>
                    </labels>
                <created>Wed, 12 Sep 2018 14:39:01 +0000</created>
                <updated>Mon, 21 Dec 2020 08:08:00 +0000</updated>
                            <resolved>Tue, 4 Feb 2020 14:08:47 +0000</resolved>
                                        <fixVersion>4.0-alpha4</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Legacy/Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                                                                <comments>
                            <comment id="16891474" author="benedict" created="Tue, 23 Jul 2019 23:43:41 +0000"  >&lt;p&gt;Patch available &lt;a href=&quot;https://github.com/belliottsmith/cassandra/tree/14740&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;; &lt;a href=&quot;https://circleci.com/workflow-run/9b4bc0a4-ba24-4a29-a6fd-4bf78f125432&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;tests&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16892249" author="benedict" created="Wed, 24 Jul 2019 22:30:22 +0000"  >&lt;p&gt;The basic approach is quite simple: when we repair, we build a &lt;tt&gt;WritePlan&lt;/tt&gt;, but we only select those nodes we need to meet the consistency level of the operation we are performing, and we only consider live nodes.  We prefer those nodes we have read from.  If they are all present, and they are sufficient to meet consistency, we behave as before.  In any other scenario, we build a partition representing all differences we have seen, and propagate this to any node that wasn&apos;t one of the original targets.&lt;/p&gt;

&lt;p&gt;There are some minor inefficiencies, such as not handling the case where the ownership of only one node has changed, and there is no node pending, in which case we &lt;em&gt;might&lt;/em&gt; be able to only propagate the difference found on reconciling the presumably replaced node (though if unsafe bootstrap occurred even this would not be acceptable, but this might be an acceptable consistency failure given the semantic guarantees of this).  &lt;/p&gt;

&lt;p&gt;We also don&apos;t bother to avoid merging the complete diff row with any other pending repairs if we have to perform an additional write.  It&apos;s assume that these scenario are rare, and not worth the significant extra complexity.&lt;/p&gt;

&lt;p&gt;Unfortunately fixing unit tests was painful and not super beautiful.  This is because read-repair now consults the ring to decide who a repair should be routed to, instead of assuming it is sufficient to write to those we read from.  The tests as written assume the ring can be empty, and also that replication factor isn&apos;t relevant, so to avoid completely rewriting the tests, I have done some ugly things.&lt;/p&gt;</comment>
                            <comment id="17020151" author="beobal" created="Tue, 21 Jan 2020 11:18:33 +0000"  >&lt;p&gt;This is nice. As well as addressing the bug, using a &lt;tt&gt;ReplicaPlan&lt;/tt&gt; for the writes really clarifies &lt;tt&gt;BlockingPartitionRepair&lt;/tt&gt; &amp;amp; &lt;tt&gt;BlockingReadRepair&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;There&apos;s a copy/paste bug in &lt;tt&gt;RowIteratorMergeListener::applyToPartition&lt;/tt&gt; in the &lt;tt&gt;buildFullDiff&lt;/tt&gt; branch, where it should be setting &lt;tt&gt;repairs&lt;span class=&quot;error&quot;&gt;&amp;#91;repairs.length - 1&amp;#93;&lt;/span&gt;&lt;/tt&gt;. This is causing the new &lt;tt&gt;movingTokenReadRepairTest&lt;/tt&gt; failure, but locally at least, it doesn&apos;t affect the other tests in that fixture so I&apos;m not sure what&apos;s going on in CircleCI.&lt;/p&gt;

&lt;p&gt;The patch also needs a rebase, but it doesn&apos;t look too onerous.&lt;/p&gt;

&lt;p&gt;Nits:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;BlockingReadRepair&lt;/tt&gt; #54: extraneous comment&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;ReadRepairTest&lt;/tt&gt; #199: formatting&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;RowIteratorMergeListener&lt;/tt&gt;: unused import&lt;/li&gt;
	&lt;li&gt;I find the style of having the conditions and statements for an &lt;tt&gt;if/else&lt;/tt&gt; on the same line (&lt;tt&gt;RowIteratorMergeListener&lt;/tt&gt; #373) makes them harder to parse. This is clearly rather subjective though and maybe just because it&apos;s not followed more universally in the project - feel free to ignore.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17024495" author="benedict" created="Mon, 27 Jan 2020 16:54:53 +0000"  >&lt;p&gt;Thanks, I&apos;ve addressed your comments and pushed.  I still need to figure out how to parse CircleCI results.&lt;/p&gt;</comment>
                            <comment id="17026597" author="benedict" created="Thu, 30 Jan 2020 11:04:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://circleci.com/workflow-run/1e09aaed-8345-484f-bc9d-a9b018005520&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CircleCI&lt;/a&gt; looks clean (I think? I&apos;m losing faith in my ability to understand its UX, or its ability to understand our output)&lt;/p&gt;
</comment>
                            <comment id="17029857" author="beobal" created="Tue, 4 Feb 2020 14:08:47 +0000"  >&lt;p&gt;Committed to trunk in &lt;tt&gt;0f22dab1a015cb84d9857f940de5a256bfbee083&lt;/tt&gt;. Final CI run after rebasing with only previously known failures: &lt;a href=&quot;https://circleci.com/workflow-run/3cb3c20e-6dea-4fd6-8aff-193e1e7d298b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;jdk8&lt;/a&gt;&#160;&amp;amp; &lt;a href=&quot;https://circleci.com/workflow-run/024ba3cd-c112-4f73-a562-b364ea420e3c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;jdk11&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17030047" author="dcapwell" created="Tue, 4 Feb 2020 18:32:16 +0000"  >&lt;p&gt;spoke to sam about this; MessageForwardingTest is a regression and not an existing issue.&lt;/p&gt;

&lt;p&gt;This test used to fail on java 11 (was stable on java 8) because of a change in behavior of java Streams; Blake fixed that in 1f7e3c2835c79363025a01a8470ee85d17457cf8 and since then the test has been stable.&lt;/p&gt;

&lt;p&gt;The test is now failing in both java 8 and java 11 and isn&apos;t flaky, fails 100% of the time.&lt;/p&gt;</comment>
                            <comment id="17030054" author="beobal" created="Tue, 4 Feb 2020 18:39:31 +0000"  >&lt;p&gt;Sorry, this broke &lt;tt&gt;MessageForwardingTest&lt;/tt&gt; by forcing the RF of the test keyspace to 3; I mistakenly thought that test was already failing before. &lt;br/&gt;
Fixed in a follow up commit &lt;a href=&quot;https://github.com/apache/cassandra/commit/cb4314ee96922f870f5b30d6594a42d2007a5bb2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;cb4314ee96&lt;/tt&gt;&lt;/a&gt; with CI runs for &lt;a href=&quot;https://circleci.com/workflow-run/3e9a34a0-a6b7-4b41-9e7f-667233f858c6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;jdk8&lt;/a&gt; and &lt;a href=&quot;https://circleci.com/workflow-run/442cd66f-25c4-4d39-988b-7bdd3aceae5a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;jdk11&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13184606">CASSANDRA-14722</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12913901">CASSANDRA-10726</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[benedict]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
                                <customfieldvalue key="12987" cascade-level="1"><![CDATA[Transient Incorrect Response]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12975"><![CDATA[Code Inspection]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 41 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3y0gn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[samt]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12346093">4.0-alpha</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314136" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12348281">4.0-alpha1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/0f22dab1a015cb84d9857f940de5a256bfbee083&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/0f22dab1a015cb84d9857f940de5a256bfbee083&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;dtest included&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>