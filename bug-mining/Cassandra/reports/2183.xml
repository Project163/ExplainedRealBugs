<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:38:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-5589] ArrayIndexOutOfBoundsException in LeveledManifest</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-5589</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;The following stack trace was in the system.log:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2&amp;#93;&lt;/span&gt; 2013-05-22 16:19:32,402 CassandraDaemon.java (line 174) Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;CompactionExecutor:2,1,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
 java.lang.ArrayIndexOutOfBoundsException: 5&lt;br/&gt;
	at org.apache.cassandra.db.compaction.LeveledManifest.skipLevels(LeveledManifest.java:176)&lt;br/&gt;
	at org.apache.cassandra.db.compaction.LeveledManifest.promote(LeveledManifest.java:215)&lt;br/&gt;
	at org.apache.cassandra.db.compaction.LeveledCompactionStrategy.handleNotification(LeveledCompactionStrategy.java:155)&lt;br/&gt;
	at org.apache.cassandra.db.DataTracker.notifySSTablesChanged(DataTracker.java:410)&lt;br/&gt;
	at org.apache.cassandra.db.DataTracker.replaceCompactedSSTables(DataTracker.java:223)&lt;br/&gt;
	at org.apache.cassandra.db.ColumnFamilyStore.replaceCompactedSSTables(ColumnFamilyStore.java:991)&lt;br/&gt;
	at org.apache.cassandra.db.compaction.CompactionTask.runWith(CompactionTask.java:230)&lt;br/&gt;
	at org.apache.cassandra.io.util.DiskAwareRunnable.runMayThrow(DiskAwareRunnable.java:48)&lt;br/&gt;
	at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:28)&lt;br/&gt;
	at org.apache.cassandra.db.compaction.CompactionTask.executeInternal(CompactionTask.java:58)&lt;br/&gt;
	at org.apache.cassandra.db.compaction.AbstractCompactionTask.execute(AbstractCompactionTask.java:60)&lt;br/&gt;
	at org.apache.cassandra.db.compaction.CompactionManager$BackgroundCompactionTask.run(CompactionManager.java:188)&lt;/p&gt;&lt;/blockquote&gt;</description>
                <environment></environment>
        <key id="12649106">CASSANDRA-5589</key>
            <summary>ArrayIndexOutOfBoundsException in LeveledManifest</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbellis">Jonathan Ellis</assignee>
                                    <reporter username="jeromatron">Jeremy Hanna</reporter>
                        <labels>
                            <label>compaction</label>
                    </labels>
                <created>Thu, 23 May 2013 12:36:17 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:12 +0000</updated>
                            <resolved>Thu, 23 May 2013 19:51:07 +0000</resolved>
                                        <fixVersion>1.2.6</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13665270" author="jbellis" created="Thu, 23 May 2013 15:33:55 +0000"  >&lt;p&gt;The manifest is assuming that when the sstable size is increased, existing sstables are magically resized to that, which is not the case.&lt;/p&gt;

&lt;p&gt;Fix attached, with an additional warning to not increase sstable size above 1GB (which is what the user has done here).&lt;/p&gt;</comment>
                            <comment id="13665325" author="krummas" created="Thu, 23 May 2013 16:31:20 +0000"  >&lt;p&gt;lgtm&lt;/p&gt;</comment>
                            <comment id="13665556" author="jbellis" created="Thu, 23 May 2013 19:51:07 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                            <comment id="14147833" author="jeffery.griffith" created="Thu, 25 Sep 2014 15:04:46 +0000"  >&lt;p&gt;hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbellis&quot; class=&quot;user-hover&quot; rel=&quot;jbellis&quot;&gt;jbellis&lt;/a&gt;, it looks like this problem may not have been the total # of generations allocated because I can still see this in 1.2.19. The stack trace is the same as Jeremy&apos;s however the index out of bounds is 9 (log 10 of 1 billion=9 from your fix.) skipLevels does not check newLevel against generations.length however the fix obviously isn&apos;t that simple since it needs to return the newLevel... some other logic problem in the loop termination?&lt;/p&gt;

&lt;p&gt;    private int skipLevels(int newLevel, Iterable&amp;lt;SSTableReader&amp;gt; added)&lt;br/&gt;
    {&lt;br/&gt;
        while (maxBytesForLevel(newLevel) &amp;lt; SSTableReader.getTotalBytes(added)&lt;br/&gt;
            &amp;amp;&amp;amp; generations&lt;span class=&quot;error&quot;&gt;&amp;#91;(newLevel + 1)&amp;#93;&lt;/span&gt;.isEmpty())&lt;/p&gt;
        {
            newLevel++;
        }
&lt;p&gt;        return newLevel;&lt;br/&gt;
    }&lt;/p&gt;

&lt;p&gt;Apparently, this seems to have begun when someone set the max sstable size to 400MB. Going back to 300MB it seems to have gone away.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12584513" name="5589.txt" size="2449" author="jbellis" created="Thu, 23 May 2013 15:33:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[jbellis]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>329433</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 8 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ku3r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>329768</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>marcuse</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[marcuse]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>