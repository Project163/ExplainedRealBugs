<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:56:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-9973] java.lang.IllegalStateException: Unable to compute when histogram overflowed</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-9973</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I recently, and probably mistakenly, upgraded one of my production C* clusters to 2.2.0.  I am seeing these errors in the logs, followed by an intense period of garbage collection until the node, then the ring, becomes crippled:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [OptionalTasks:1] 2015-08-04 03:24:56,057 CassandraDaemon.java:182 - Exception in thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[OptionalTasks:1,5,main]
java.lang.IllegalStateException: Unable to compute when histogram overflowed
        at org.apache.cassandra.utils.EstimatedHistogram.percentile(EstimatedHistogram.java:179) ~[apache-cassandra-2.2.0.jar:2.2.0]
        at org.apache.cassandra.metrics.EstimatedHistogramReservoir$HistogramSnapshot.getValue(EstimatedHistogramReservoir.java:84) ~[apache-cassandra-2.2.0.jar:2.2.0]
        at org.apache.cassandra.db.ColumnFamilyStore$3.run(ColumnFamilyStore.java:405) ~[apache-cassandra-2.2.0.jar:2.2.0]
        at org.apache.cassandra.concurrent.DebuggableScheduledThreadPoolExecutor$UncomplainingRunnable.run(DebuggableScheduledThreadPoolExecutor.java:118) ~[apache-cassandra-2.2.0.jar:2.2.0]
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [na:1.8.0_45]
        at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:308) [na:1.8.0_45]
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:180) [na:1.8.0_45]
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:294) [na:1.8.0_45]
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) [na:1.8.0_45]
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [na:1.8.0_45]
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [na:1.8.0_45]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I am not sure if the GC instability is this or something else, but I though this histogram overflow issue was fixed in 2.1.3?  Anyway, reporting now as a possible regression.  Please let me know what I can provide in terms of information to help with this.  Thanks!&lt;/p&gt;</description>
                <environment></environment>
        <key id="12851291">CASSANDRA-9973</key>
            <summary>java.lang.IllegalStateException: Unable to compute when histogram overflowed</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tjake">T Jake Luciani</assignee>
                                    <reporter username="mwmanley">Mark Manley</reporter>
                        <labels>
                    </labels>
                <created>Tue, 4 Aug 2015 03:30:30 +0000</created>
                <updated>Tue, 16 Apr 2019 09:31:02 +0000</updated>
                            <resolved>Fri, 14 Aug 2015 14:27:36 +0000</resolved>
                                        <fixVersion>2.2.1</fixVersion>
                                    <component>Legacy/Observability</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14680119" author="merentafo" created="Mon, 10 Aug 2015 13:40:08 +0000"  >&lt;p&gt;The same here after upgrade from 2.1.8 to 2.2.0 &lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;OptionalTasks:1&amp;#93;&lt;/span&gt; 2015-08-10 13:39:14,439 CassandraDaemon.java:182 - Exception in thread Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;OptionalTasks:1,5,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.IllegalStateException: Unable to compute when histogram overflowed&lt;br/&gt;
        at org.apache.cassandra.utils.EstimatedHistogram.percentile(EstimatedHistogram.java:179) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0.jar:2.2.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.cassandra.metrics.EstimatedHistogramReservoir$HistogramSnapshot.getValue(EstimatedHistogramReservoir.java:84) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0.jar:2.2.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.cassandra.db.ColumnFamilyStore$3.run(ColumnFamilyStore.java:405) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0.jar:2.2.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.cassandra.concurrent.DebuggableScheduledThreadPoolExecutor$UncomplainingRunnable.run(DebuggableScheduledThreadPoolExecutor.java:118) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;apache-cassandra-2.2.0.jar:2.2.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) &lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_51&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:308) &lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_51&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:180) &lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_51&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:294) &lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_51&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) &lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_51&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) &lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_51&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:745) &lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.8.0_51&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="14680226" author="tjake" created="Mon, 10 Aug 2015 14:58:34 +0000"  >&lt;p&gt;This looks like a regression from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-5657&quot; title=&quot;Upgrade metrics lib and remove deprecated metrics&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-5657&quot;&gt;&lt;del&gt;CASSANDRA-5657&lt;/del&gt;&lt;/a&gt; where we replaced the default metrics histogram with our estimated histogram.  The histogram is padded to support values upto 12B but looks like readlatency is kept in nanoseconds which is cutting it too close.  So we should pad this to handle 30 seconds of nanoseconds? Patch attached.&lt;/p&gt;
</comment>
                            <comment id="14680259" author="tjake" created="Mon, 10 Aug 2015 15:32:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mwmanley&quot; class=&quot;user-hover&quot; rel=&quot;mwmanley&quot;&gt;mwmanley&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=merentafo&quot; class=&quot;user-hover&quot; rel=&quot;merentafo&quot;&gt;merentafo&lt;/a&gt; What do you have set for your read timeouts?&lt;/p&gt;</comment>
                            <comment id="14680286" author="mwmanley" created="Mon, 10 Aug 2015 15:55:39 +0000"  >&lt;p&gt;read_request_timeout_in_ms: 10000&lt;/p&gt;</comment>
                            <comment id="14681573" author="merentafo" created="Tue, 11 Aug 2015 10:10:34 +0000"  >&lt;p&gt;read_request_timeout_in_ms: 40000&lt;/p&gt;</comment>
                            <comment id="14681999" author="tjake" created="Tue, 11 Aug 2015 16:05:39 +0000"  >&lt;p&gt;Ok bumping this upto &amp;gt; 4 hours of nanoseconds which should be more than enough. branch here &lt;a href=&quot;https://github.com/tjake/cassandra/tree/9973&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tjake/cassandra/tree/9973&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14682001" author="carlyeks" created="Tue, 11 Aug 2015 16:07:17 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14697099" author="tjake" created="Fri, 14 Aug 2015 14:27:36 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                            <comment id="14708448" author="mwmanley" created="Sun, 23 Aug 2015 17:31:15 +0000"  >&lt;p&gt;Do we have an ETA for the release date of 2.2.1?  My ring was again crippled this morning when several of my nodes spewed out hundreds of these errors a minute.  It corresponds to the time that they stopped answering requests reliably.  If there is a workaround for 2.2.0, I am all ears.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="14709550" author="tjake" created="Mon, 24 Aug 2015 16:20:21 +0000"  >&lt;p&gt;2.2.1 should be out this week.  In the meantime if you disable speculative retry you should avoid this issue.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12749609" name="9973.txt" size="577" author="tjake" created="Mon, 10 Aug 2015 14:59:29 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[tjake]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 13 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2iaqv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12332983">2.2.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>carlyeks</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[carlyeks]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>