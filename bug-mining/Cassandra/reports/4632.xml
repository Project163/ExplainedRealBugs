<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:06:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-13114] Upgrade netty to 4.0.44 to fix memory leak with client encryption</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-13114</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12032&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CASSANDRA-12032&lt;/a&gt; updated netty for Cassandra 3.8, but this wasn&apos;t backported. Netty 4.0.23, which ships with Cassandra 3.0.x, has some serious bugs around memory handling for SSL connections.&lt;/p&gt;

&lt;p&gt;It would be nice if both were updated to 4.0.42, a version released this year.&lt;/p&gt;

&lt;p&gt;4.0.23 makes it impossible for me to run SSL, because nodes run out of memory every ~30 minutes. This was fixed in 4.0.27.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13033102">CASSANDRA-13114</key>
            <summary>Upgrade netty to 4.0.44 to fix memory leak with client encryption</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10000" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Urgent</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="spod">Stefan Podkowinski</assignee>
                                    <reporter username="tvdw">Tom van der Woerdt</reporter>
                        <labels>
                    </labels>
                <created>Mon, 9 Jan 2017 16:35:00 +0000</created>
                <updated>Tue, 14 Oct 2025 12:13:57 +0000</updated>
                            <resolved>Thu, 9 Feb 2017 20:16:20 +0000</resolved>
                                        <fixVersion>2.1.17</fixVersion>
                    <fixVersion>2.2.9</fixVersion>
                    <fixVersion>3.0.11</fixVersion>
                    <fixVersion>3.11.0</fixVersion>
                    <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>11</watches>
                                                                                                                <comments>
                            <comment id="15814421" author="spodxx@gmail.com" created="Tue, 10 Jan 2017 09:13:39 +0000"  >&lt;p&gt;Netty 4.0.23 has been introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-7761&quot; title=&quot;Upgrade netty and enable epoll event loop&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-7761&quot;&gt;&lt;del&gt;CASSANDRA-7761&lt;/del&gt;&lt;/a&gt; and is used since 2.1.1. Looking at the &lt;a href=&quot;http://netty.io/news/2015/04/02/4-0-27-Final.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4.0.27 release notes&lt;/a&gt; I assume that &lt;a href=&quot;https://github.com/netty/netty/issues/3567&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;#3567&lt;/a&gt; fixes the memory issue you&apos;re referring to? If I read the ticket correctly, the bug does not manifest in 4.0.23, but only after updating to 4.0.25/26. Can you link the actual issue that makes you believe 4.0.23 is affected in case there&apos;s something I&apos;m missing here?&lt;/p&gt;</comment>
                            <comment id="15814433" author="tvdw" created="Tue, 10 Jan 2017 09:17:31 +0000"  >&lt;p&gt;Sorry, the actual fixes are in 4.0.24 (&lt;a href=&quot;http://netty.io/news/2014/10/29/4-0-24-Final.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://netty.io/news/2014/10/29/4-0-24-Final.html&lt;/a&gt; / &lt;a href=&quot;https://github.com/netty/netty/pull/3058&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/netty/netty/pull/3058&lt;/a&gt; / &lt;a href=&quot;https://github.com/netty/netty/issues/3057&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/netty/netty/issues/3057&lt;/a&gt;).&lt;/p&gt;</comment>
                            <comment id="15837609" author="spodxx@gmail.com" created="Wed, 25 Jan 2017 11:54:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=snazy&quot; class=&quot;user-hover&quot; rel=&quot;snazy&quot;&gt;snazy&lt;/a&gt;, since you&apos;ve been working on a couple of related issues (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12032&quot; title=&quot;Update to Netty 4.0.39&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12032&quot;&gt;&lt;del&gt;CASSANDRA-12032&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12033&quot; title=&quot;Use Netty&amp;#39;s off-heap allocator instead of ByteBuffer.allocateDirect()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12033&quot;&gt;&lt;del&gt;CASSANDRA-12033&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12034&quot; title=&quot;Special handling for Netty&amp;#39;s direct memory allocation failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12034&quot;&gt;&lt;del&gt;CASSANDRA-12034&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11937&quot; title=&quot;Clean up buffer trimming large buffers in DataOutputBuffer after the Netty upgrade&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11937&quot;&gt;&lt;del&gt;CASSANDRA-11937&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-11818&quot; title=&quot;C* does neither recover nor trigger stability inspector on direct memory OOM&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-11818&quot;&gt;&lt;del&gt;CASSANDRA-11818&lt;/del&gt;&lt;/a&gt;).. what would be your suggestion when it comes to back-porting  some of these to further stabilize memory management in 2.x and 3.0? Do you see any issues updating netty to 4.0.42 on all branches, regardless of any back-porting decisions for the listed tickets?&lt;/p&gt;</comment>
                            <comment id="15837704" author="snazy" created="Wed, 25 Jan 2017 13:08:28 +0000"  >&lt;p&gt;No objections regarding a &lt;em&gt;minor&lt;/em&gt; netty upgrade, if that solves real SSL issues / an existing bug.  I&apos;d just be very careful with dependency changes since 4.0.37 introduced a couple of issues.&lt;br/&gt;
Would setting &lt;tt&gt;-XX:MaxDirectMemorySize=SomeBigValue&lt;/tt&gt; help in this case?&lt;br/&gt;
However, I do object introducing the new stuff from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12032&quot; title=&quot;Update to Netty 4.0.39&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12032&quot;&gt;&lt;del&gt;CASSANDRA-12032&lt;/del&gt;&lt;/a&gt; in 2.2 or 3.0, because it is a new thing, which is disabled by default in 3.x.&lt;/p&gt;</comment>
                            <comment id="15837758" author="tvdw" created="Wed, 25 Jan 2017 13:47:04 +0000"  >&lt;p&gt;4.0.39 has been tested pretty well with 3.x by now, so it should be relatively safe (much safer than, say, 3.0.36, which not only hasn&apos;t been tested, but also won&apos;t get the attention that 3.0.39 would get if it is used by both 3.0 and 3.x). Definitely don&apos;t pick 4.1!&lt;/p&gt;

&lt;p&gt;As for setting MaxDirectMemorySize: it was set to 20GB when I filed this ticket. No luck &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Side-note: &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-13126&quot; title=&quot;native transport protocol corruption when using SSL&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-13126&quot;&gt;CASSANDRA-13126&lt;/a&gt; is a related issue, on clusters with SSL enabled even non SSL clients may be impacted due to this netty issue.&lt;/p&gt;</comment>
                            <comment id="15837856" author="spodxx@gmail.com" created="Wed, 25 Jan 2017 14:55:54 +0000"  >&lt;p&gt;I admit that I don&apos;t really have an opinion on using any particular version. Any reasons not to go with the latest stable 4.0 release? &lt;/p&gt;

&lt;p&gt;Let&apos;s try a CI run using 4.0.43:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.1&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;2.2&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.0&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;3.11&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;trunk&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/spodkowinski/cassandra/tree/CASSANDRA-13114-2.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/spodkowinski/cassandra/tree/CASSANDRA-13114-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/spodkowinski/cassandra/tree/CASSANDRA-13114-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/spodkowinski/cassandra/tree/CASSANDRA-13114-3.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/spodkowinski/cassandra/tree/CASSANDRA-13114-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/spodkowinski/job/spodkowinski-CASSANDRA-13114-2.1-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/spodkowinski/job/spodkowinski-CASSANDRA-13114-2.2-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/spodkowinski/job/spodkowinski-CASSANDRA-13114-3.0-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/spodkowinski/job/spodkowinski-CASSANDRA-13114-3.11-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/spodkowinski/job/spodkowinski-CASSANDRA-13114-trunk-dtest/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dtest&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/spodkowinski/job/spodkowinski-CASSANDRA-13114-2.1-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/spodkowinski/job/spodkowinski-CASSANDRA-13114-2.2-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/spodkowinski/job/spodkowinski-CASSANDRA-13114-3.0-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/spodkowinski/job/spodkowinski-CASSANDRA-13114-3.11-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/spodkowinski/job/spodkowinski-CASSANDRA-13114-trunk-testall/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;testall&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;



&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jasobrown&quot; class=&quot;user-hover&quot; rel=&quot;jasobrown&quot;&gt;jasobrown&lt;/a&gt;, you have any strong preference for netty releases and gossip 2.0?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=norman&quot; class=&quot;user-hover&quot; rel=&quot;norman&quot;&gt;norman&lt;/a&gt;, anything to double check or look out for from our side while updating from 4.0.23 -&amp;gt; 4.0.43?&lt;/p&gt;</comment>
                            <comment id="15838465" author="norman" created="Wed, 25 Jan 2017 19:55:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=spodxx%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;spodxx@gmail.com&quot;&gt;spodxx@gmail.com&lt;/a&gt; nope just upgrade to 4.0.43. FTW &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; That said we will release 4.0.44.Final end of this week or next week latest.&lt;/p&gt;</comment>
                            <comment id="15842958" author="spodxx@gmail.com" created="Fri, 27 Jan 2017 15:09:57 +0000"  >&lt;p&gt;Some insights on dtest results:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;local_quorum_bootstrap_test&lt;/tt&gt;&lt;br/&gt;
See &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12437&quot; title=&quot;dtest failure in bootstrap_test.TestBootstrap.local_quorum_bootstrap_test&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12437&quot;&gt;CASSANDRA-12437&lt;/a&gt;, &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/pull/1429&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR&lt;/a&gt; created&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;test_tombstone_failure_v3&lt;/tt&gt;&lt;br/&gt;
Seems to be &lt;a href=&quot;http://cassci.datastax.com/view/cassandra-2.1/job/cassandra-2.1_dtest/lastCompletedBuild/testReport/read_failures_test/TestReadFailures/test_tombstone_failure_v3/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;failing on constant basis&lt;/a&gt;, I&apos;ve opened a &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/pull/1430&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;cqlsh_tests.cqlsh_tests.CqlshSmokeTest.test_alter_table&lt;/tt&gt; and&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;cql_tests.MiscellaneousCQLTester.prepared_statement_invalidation_test&lt;/tt&gt;&lt;br/&gt;
Fallout from &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-12443&quot; title=&quot;Remove alter type support&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-12443&quot;&gt;&lt;del&gt;CASSANDRA-12443&lt;/del&gt;&lt;/a&gt; and already addressed in &lt;a href=&quot;https://github.com/riptano/cassandra-dtest/pull/1427&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Other tests seem to be flaky or have known issues.&lt;/p&gt;</comment>
                            <comment id="15845707" author="norman" created="Mon, 30 Jan 2017 19:12:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=spodxx%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;spodxx@gmail.com&quot;&gt;spodxx@gmail.com&lt;/a&gt; FYI netty 4.0.44.Final was released earlier today. &lt;a href=&quot;http://netty.io/news/2017/01/30/4-0-44-Final-4-1-8-Final.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://netty.io/news/2017/01/30/4-0-44-Final-4-1-8-Final.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15848416" author="spodxx@gmail.com" created="Wed, 1 Feb 2017 14:21:29 +0000"  >&lt;p&gt;Updated the patch to 4.0.44 and latest CI results already reflect the version change.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=snazy&quot; class=&quot;user-hover&quot; rel=&quot;snazy&quot;&gt;snazy&lt;/a&gt;, would you review the patch?&lt;/p&gt;</comment>
                            <comment id="15848697" author="JIRAUSER308715" created="Wed, 1 Feb 2017 17:45:21 +0000"  >&lt;p&gt;You probably want to run some QUORUM stress smoke tests to make sure there are no regressions there.&lt;/p&gt;</comment>
                            <comment id="15849931" author="snazy" created="Thu, 2 Feb 2017 13:57:45 +0000"  >&lt;p&gt;I can, but would need some time.&lt;/p&gt;

&lt;p&gt;EDIT: &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jjordan&quot; class=&quot;user-hover&quot; rel=&quot;jjordan&quot;&gt;jjordan&lt;/a&gt;&apos;s suggestion makes sense. We already had an issue with a regression in Netty - just want to prevent a second upgrade-revert-upgrade-ticket &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15850427" author="mshuler" created="Thu, 2 Feb 2017 20:24:49 +0000"  >&lt;p&gt;I built SNAPSHOT artifacts on top of current &lt;tt&gt;cassandra-3.0&lt;/tt&gt; for Tom to test: &lt;a href=&quot;http://people.apache.org/~mshuler/13114_netty-4.0.44_3.0/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://people.apache.org/~mshuler/13114_netty-4.0.44_3.0/&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;commit cd9a6590dd950d456278461919d7e6a079531ee4 (HEAD -&amp;gt; 13114_netty-4.0.44_3.0, github/13114_netty-4.0.44_3.0)
Author: Stefan Podkowinski &amp;lt;s.podkowinski@gmail.com&amp;gt;
Date:   Wed Jan 25 15:16:25 2017 +0100

    Upgrade to netty 4.0.44
    
    patch by Stefan Podkowinski; reviewed by X for CASSANDRA-13114

 CHANGES.txt                                                             |   1 +
 build.xml                                                               |   2 +-
 lib/licenses/{netty-all-4.0.23.Final.txt =&amp;gt; netty-all-4.0.44.Final.txt} |   0
 lib/netty-all-4.0.23.Final.jar                                          | Bin 1779991 -&amp;gt; 0 bytes
 lib/netty-all-4.0.44.Final.jar                                          | Bin 0 -&amp;gt; 2342652 bytes
 src/java/org/apache/cassandra/transport/Message.java                    |  12 ++++++++----
 6 files changed, 10 insertions(+), 5 deletions(-)

commit 6caf3c4f13bb29e3fd732365210be6b3c954f04a (origin/cassandra-3.0, cassandra-3.0)
Author: Michael Shuler &amp;lt;michael@pbandjelly.org&amp;gt;
Date:   Wed Feb 1 14:39:35 2017 -0600

    Remove &apos;no upgrades&apos; note from NEWS.txt

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15851357" author="snazy" created="Fri, 3 Feb 2017 11:19:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=spodxx%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;spodxx@gmail.com&quot;&gt;spodxx@gmail.com&lt;/a&gt; can you explain the code change in &lt;tt&gt;Message&lt;/tt&gt;? It looks like it doesn&apos;t change anything.&lt;/p&gt;</comment>
                            <comment id="15851430" author="spodxx@gmail.com" created="Fri, 3 Feb 2017 12:36:43 +0000"  >&lt;p&gt;Any exceptions caught by Netty will be logged by &lt;tt&gt;UnexpectedChannelExceptionHandler&lt;/tt&gt;. Before the changes to &lt;tt&gt;Message&lt;/tt&gt;, this would only happen when the channel would still be open. In Netty 4.0.23 this seems to be the case, in 4.0.44 the channel is now closed (at least for handshake errors, which makes sense) when &lt;tt&gt;exceptionCaught&lt;/tt&gt; is called. What the patch does is simply to log the exception in both cases, while leaving the error reply sending case as it was (keep sending reply only in case channel is still open). I&apos;ve noticed the changed behaviour through a dtest, &lt;a href=&quot;http://cassci.datastax.com/view/Dev/view/spodkowinski/job/spodkowinski-CASSANDRA-13114-3.11-dtest/1/testReport/junit/native_transport_ssl_test/NativeTransportSSL/connect_to_ssl_test/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;see results&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;As for the mentioned performance regression tests, I&apos;ve only have a single physical host available for cstar_perf, so I can&apos;t really stress test multi-node setups. A single node tests with and without ssl didn&apos;t show any significant changes, but the results are little meaningful. Besides I also can&apos;t find any way to test the actual memory leak issue at hand by simulating lots of connecting and deconnecting clients.&lt;/p&gt;
</comment>
                            <comment id="15851442" author="snazy" created="Fri, 3 Feb 2017 12:43:29 +0000"  >&lt;p&gt;Ah - logging takes place in the &lt;tt&gt;apply&lt;/tt&gt; method. OK, makes sense.&lt;/p&gt;</comment>
                            <comment id="15851522" author="tvdw" created="Fri, 3 Feb 2017 14:07:24 +0000"  >&lt;p&gt;I&apos;ve deployed &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mshuler&quot; class=&quot;user-hover&quot; rel=&quot;mshuler&quot;&gt;mshuler&lt;/a&gt;&apos;s snapshot build to most nodes in the cluster that previously experienced this issue, and re-enabled TLS on a few hundred clients. The nodes still on 3.0.10 quickly showed memory issues, while the nodes on 3.0.11-SNAPSHOT were happy.&lt;/p&gt;

&lt;p&gt;So I upgraded the remaining nodes and enabled TLS on another ~50000 clients, many many more than I originally needed to cause problems.&lt;/p&gt;

&lt;p&gt;Nothing broke.&lt;/p&gt;

&lt;p&gt;So basically I can confirm that this patch fixes the problem, and at least for my test cases (one involves fairly heavy use of QUORUM reads and writes) doesn&apos;t appear to introduce new ones. I wouldn&apos;t take that over good dtests/utests, but it&apos;s a useful data point to have.&lt;/p&gt;</comment>
                            <comment id="15859746" author="mshuler" created="Thu, 9 Feb 2017 16:26:06 +0000"  >&lt;p&gt;I set this ticket as a blocker for 3.0.11.&lt;/p&gt;

&lt;p&gt;Is there any additional testing required to merge this to the cassandra-3.0 branch, so we can release 3.0.11?  Thanks!&lt;/p&gt;</comment>
                            <comment id="15859998" author="snazy" created="Thu, 9 Feb 2017 18:58:12 +0000"  >&lt;p&gt;Patch LGTM - however, is this going into 3.0...trunk or 2.1...trunk? Fix version (and summary) say 3.0, but there are patches for 2.1 and 2.2, too.&lt;/p&gt;</comment>
                            <comment id="15860044" author="spodxx@gmail.com" created="Thu, 9 Feb 2017 19:30:43 +0000"  >&lt;p&gt;I don&apos;t think this is critical enough for 2.1, as you have to have large enough direct allocations through netty that will exhaust the memory between regular CMS runs. So you don&apos;t necessarily have to run into this problem and there&apos;s an easy workaround by not enabling disableexplicitgc (as described in &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-13126&quot; title=&quot;native transport protocol corruption when using SSL&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-13126&quot;&gt;CASSANDRA-13126&lt;/a&gt;) or by simply replacing the netty jar with a new version. &lt;br/&gt;
But 2.2 and 3.0 - why not? Both are supported and it should be possible to do a library updated there.&lt;/p&gt;</comment>
                            <comment id="15860121" author="snazy" created="Thu, 9 Feb 2017 20:16:20 +0000"  >&lt;p&gt;Alright, committed as eb0f443705425bac93f92a5e7e04ea5def77b1d8 to 2.1 and merged up to trunk.&lt;/p&gt;</comment>
                            <comment id="15864543" author="jjirsa" created="Mon, 13 Feb 2017 22:04:03 +0000"  >&lt;p&gt;Was this dire enough to go into 2.1 ?  Seems like a pretty high bar for a .17 release. &lt;/p&gt;
</comment>
                            <comment id="15866605" author="snazy" created="Tue, 14 Feb 2017 20:35:55 +0000"  >&lt;p&gt;Well, the new netty version &lt;em&gt;should&lt;/em&gt; not hurt. But if you run into this SSL/netty issue, it hurts a lot.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13160939">CASSANDRA-14460</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13035233">CASSANDRA-13126</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13021551">CASSANDRA-12928</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12980654">CASSANDRA-12032</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12850429" name="13114_netty-4.0.44_2.x-3.0.patch" size="4875569" author="spod" created="Wed, 1 Feb 2017 14:17:43 +0000"/>
                            <attachment id="12850428" name="13114_netty-4.0.44_3.11.patch" size="5455314" author="spod" created="Wed, 1 Feb 2017 14:17:43 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[spod]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 40 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i38g73:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12338291">3.0.10</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>snazy</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[snazy]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12963"><![CDATA[Critical]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>