<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:28:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-2805] Clean up mbeans that return Internal Cassandra types</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-2805</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;We need to clean up wherever we return internal cassandra objects over jmx. Namely CompactionInfo objects as well as Tokens. There may be a few other examples.&lt;/p&gt;

&lt;p&gt;This is bad for two reasons&lt;/p&gt;

&lt;p&gt;1. You have to load the cassandra jar when querying these mbeans, which sucks.&lt;br/&gt;
2. Stuff breaks between versions when things are moved. For example, &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1610&quot; title=&quot;Pluggable Compaction&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1610&quot;&gt;&lt;del&gt;CASSANDRA-1610&lt;/del&gt;&lt;/a&gt; moves the compaction related classes around. Any code querying those jmx mbeans in 0.8.0 is now broken in 0.8.2. (assuming those moves stay in the 0.8 branch)&lt;/p&gt;

&lt;p&gt;For things like CompactionInfo we should just expose more mbean methods or serialize to something standard like json.&lt;/p&gt;

&lt;p&gt;I&apos;d like to target this for 0.8.2. Since we&apos;ve already broken compatibility between 0.8.0 and 0.8.1, I&apos;d say just fix this everywhere now.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12511159">CASSANDRA-2805</key>
            <summary>Clean up mbeans that return Internal Cassandra types</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10003" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Low</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nickmbailey">Nick Bailey</assignee>
                                    <reporter username="nickmbailey">Nick Bailey</reporter>
                        <labels>
                            <label>lhf</label>
                    </labels>
                <created>Tue, 21 Jun 2011 20:46:48 +0000</created>
                <updated>Tue, 16 Apr 2019 09:32:57 +0000</updated>
                            <resolved>Sat, 31 Dec 2011 16:19:08 +0000</resolved>
                                        <fixVersion>1.1.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13059144" author="jbellis" created="Sat, 2 Jul 2011 23:20:52 +0000"  >&lt;p&gt;If you can list which methods to clean up, this would be a good ticket for the surprisingly frequently asked, &quot;What&apos;s a good place to get my feet wet in the Cassandra code?&quot;&lt;/p&gt;</comment>
                            <comment id="13059901" author="nickmbailey" created="Tue, 5 Jul 2011 13:37:00 +0000"  >&lt;p&gt;Off the top of my head:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;A CompactionInfo object is returned when getting compactions from the CompactionManager mbean.&lt;/li&gt;
	&lt;li&gt;Sub-types of Token objects are returned when calling getTokenToEndpointMap (StorageService mbean i think).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I&apos;ll see if i can&apos;t look around for any more.&lt;/p&gt;</comment>
                            <comment id="13059960" author="appodictic" created="Tue, 5 Jul 2011 15:38:39 +0000"  >&lt;p&gt;Maybe the JMX CompositeType could be returned instead of JSON? &lt;/p&gt;</comment>
                            <comment id="13059967" author="nickmbailey" created="Tue, 5 Jul 2011 15:49:06 +0000"  >&lt;p&gt;Didn&apos;t know that existed. I guess it is specifically designed to address this kind of problem?&lt;/p&gt;

&lt;p&gt;A quick look makes it seem overly complicated and verbose. If we want to avoid json we can still allow for more complicated types like Map&amp;lt;String&amp;gt; and whatnot. The main problem is just having to include the cassandra jar when querying jmx. From what I can tell it&apos;s basically impossible to do jmx-type stuff on a non-jvm language anyway, so maybe we don&apos;t really need json.&lt;/p&gt;</comment>
                            <comment id="13060039" author="appodictic" created="Tue, 5 Jul 2011 17:53:03 +0000"  >&lt;p&gt;CompositeData is a JMX type that holds a key value map of other JMX types and can be nested. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://docs.jboss.org/jbossas/javadoc/4.0.1-sp1/jmx/javax/management/openmbean/CompositeDataSupport.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://docs.jboss.org/jbossas/javadoc/4.0.1-sp1/jmx/javax/management/openmbean/CompositeDataSupport.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This should allows us to return complex objects over JMX without having to resort to JSON serializing things.&lt;/p&gt;</comment>
                            <comment id="13060885" author="gauravsh" created="Wed, 6 Jul 2011 22:38:00 +0000"  >&lt;p&gt;Unless someone else has already started, I am planning to take this one up.&lt;/p&gt;</comment>
                            <comment id="13061413" author="nickmbailey" created="Thu, 7 Jul 2011 16:23:48 +0000"  >&lt;p&gt;Ed,&lt;/p&gt;

&lt;p&gt;I&apos;m not sure I see the advantage of a JMX Composite type as opposed to using something like a Map&amp;lt;String, Int&amp;gt; approach in any place that needs &apos;complex&apos; types. &lt;/p&gt;</comment>
                            <comment id="13066059" author="gauravsh" created="Fri, 15 Jul 2011 16:28:56 +0000"  >&lt;p&gt;Based on my research so far scanning the MBean&apos;s and their internal users (NodeProbe, NodeCmd and CliClient), there are 4 Cassandra-type dependencies: CompactionInfo, CompactionType, Token, Range. Addressing them individually and discussing my plan:&lt;/p&gt;

&lt;p&gt;1. CompactionInfo/CompactionType&lt;br/&gt;
Now, CompactionInfo/CompactionType are manageable with a Map as suggested but Range and Token are a bit tightly coupled and more involved.&lt;/p&gt;

&lt;p&gt;2. Range&lt;br/&gt;
Since Range already has the partitioner (either injected or implicit from StorageService), I believe I can add 2 new constructors that look like:&lt;br/&gt;
    public Range(String left, String right)&lt;br/&gt;
    public Range(String left, String right, IPartitioner partitioner)&lt;/p&gt;

&lt;p&gt;and use the partioner.getTokenFactory().fromString() to curate the left and right Token&apos;s.&lt;/p&gt;

&lt;p&gt;Also, to replace the StorageServiceMBean&apos;s:&lt;br/&gt;
    public Map&amp;lt;Range, List&amp;lt;String&amp;gt;&amp;gt; getRangeToEndpointMap(String keyspace);&lt;br/&gt;
    public Map&amp;lt;Range, List&amp;lt;String&amp;gt;&amp;gt; getPendingRangeToEndpointMap(String keyspace);&lt;/p&gt;

&lt;p&gt;based on their usages, the Range in StorageService can be safely copied to something like a Pair/Tuple.&lt;/p&gt;

&lt;p&gt;I noticed that the getRangeToAddressMap() is not exposed on the StorageServiceMBean interface - is that by design (not that I am complaining because right now, it is 1 less dependency to decouple but if it is an omission, I need to account for it)?&lt;/p&gt;

&lt;p&gt;3. Token&lt;br/&gt;
I can change all MBean interfaces that need a Token to the corresponding String representation using partitioner.getTokenFactory().toString() and then reconstruct back using the fromString()&lt;/p&gt;</comment>
                            <comment id="13066704" author="nickmbailey" created="Sun, 17 Jul 2011 18:32:25 +0000"  >&lt;p&gt;I&apos;m not sure you need to add any constructors to Range. How about just an asPair() method or something similar that returns the tokens that make up the range converted to strings?&lt;/p&gt;

&lt;p&gt;Everything else looks fine. getRangeToAddressMap() isn&apos;t needed because getRangeToEndpointMap() is exposed.&lt;/p&gt;

&lt;p&gt;Another thing that might be nice to fix here is the getNaturalEndpoints() method. It currently only takes a byte array or byteBuffer object which makes it impossible to call from something like jconsole. It would be nice to overload that with another method that takes a string as the key so you can call it from jconsole.&lt;/p&gt;</comment>
                            <comment id="13092084" author="jbellis" created="Fri, 26 Aug 2011 22:01:09 +0000"  >&lt;p&gt;Guarav, are you still working on this?&lt;/p&gt;</comment>
                            <comment id="13096319" author="nickmbailey" created="Fri, 2 Sep 2011 21:30:00 +0000"  >&lt;p&gt;I&apos;m probably going to take this and try and get it done quickly before the 1.0 freeze. I&apos;d really like to solve this problem before 1.0 and then be strict on preventing this in future mbean methods.&lt;/p&gt;</comment>
                            <comment id="13125332" author="nickmbailey" created="Tue, 11 Oct 2011 19:52:47 +0000"  >&lt;p&gt;Obviously I didn&apos;t get this done before the 1.0 freeze. And of course, this breaks between 0.8 and 1.0 since the serial version of CompactionInfo changes.&lt;/p&gt;

&lt;p&gt;Can we target this for 1.0.1?&lt;/p&gt;</comment>
                            <comment id="13125531" author="jbellis" created="Wed, 12 Oct 2011 01:51:52 +0000"  >&lt;p&gt;I don&apos;t think we should break compatibility in a minor release.&lt;/p&gt;</comment>
                            <comment id="13125534" author="nickmbailey" created="Wed, 12 Oct 2011 02:01:58 +0000"  >&lt;p&gt;I agree my main argument though is that we have a history of doing it unknowingly. Especially something like this where any update the the CompactionInfo requires updating the serialization version and then breaks compatibility.&lt;/p&gt;

&lt;p&gt;I suppose I can live with this in 1.1 and a &apos;let&apos;s try really really really hard not to break compatibility in the 1.0.x releases.&lt;/p&gt;</comment>
                            <comment id="13177350" author="nickmbailey" created="Thu, 29 Dec 2011 19:48:28 +0000"  >&lt;p&gt;Should take care of any instances where internal types are returned over jmx.&lt;/p&gt;</comment>
                            <comment id="13177744" author="yukim" created="Fri, 30 Dec 2011 20:10:14 +0000"  >&lt;p&gt;Nick,&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I think double brace initialization should be avoided at CompactionInfo#asMap. (yeah, I know Java syntax is sucks.)&lt;/li&gt;
	&lt;li&gt;I prefer &lt;tt&gt;Integer/Long.toString(val)&lt;/tt&gt; over &lt;tt&gt;new Integer/Long(val).toString()&lt;/tt&gt;.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;but, otherwise +1.&lt;/p&gt;</comment>
                            <comment id="13177757" author="nickmbailey" created="Fri, 30 Dec 2011 21:06:19 +0000"  >&lt;p&gt;Alright removed the double brace &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;, and updated to use static toString.&lt;/p&gt;</comment>
                            <comment id="13177790" author="yukim" created="Fri, 30 Dec 2011 22:22:20 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13178036" author="jbellis" created="Sat, 31 Dec 2011 16:19:08 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12508954" name="0001-Don-t-return-internal-types-over-jmx.patch" size="25004" author="nickmbailey" created="Fri, 30 Dec 2011 21:06:19 +0000"/>
                            <attachment id="12508879" name="0001-Don-t-return-internal-types-over-jmx.patch" size="24997" author="nickmbailey" created="Thu, 29 Dec 2011 19:48:28 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[nickmbailey]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1929</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 47 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gdkf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>93628</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>yukim</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[yukim]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12961"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>