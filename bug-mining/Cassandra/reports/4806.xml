<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:08:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-13272] &quot;nodetool bootstrap resume&quot; does not exit</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-13272</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I have a script that calls &quot;nodetool bootstrap resume&quot; after a failed join (in my environment some streams sometimes fail due to mis-tuning of stream bandwidth settings). However, if the streams fail again, nodetool won&apos;t exit.&lt;/p&gt;

&lt;p&gt;Last lines before it just hangs forever :&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[2017-02-26 07:02:42,287] received file /var/lib/cassandra/data/keyspace/table-63d5d42009fa11e5879ebd9463bffdac/mc-12670-big-Data.db (progress: 1112%)
[2017-02-26 07:02:42,287] received file /var/lib/cassandra/data/keyspace/table-63d5d42009fa11e5879ebd9463bffdac/mc-12670-big-Data.db (progress: 1112%)
[2017-02-26 07:02:59,843] received file /var/lib/cassandra/data/keyspace/table-63d5d42009fa11e5879ebd9463bffdac/mc-12671-big-Data.db (progress: 1112%)
[2017-02-26 09:25:51,000] session with /10.x.y.z complete (progress: 1112%)
[2017-02-26 09:33:45,017] session with /10.x.y.z complete (progress: 1112%)
[2017-02-26 09:39:27,216] session with /10.x.y.z complete (progress: 1112%)
[2017-02-26 09:53:33,084] session with /10.x.y.z complete (progress: 1112%)
[2017-02-26 09:55:07,115] session with /10.x.y.z complete (progress: 1112%)
[2017-02-26 10:06:49,557] session with /10.x.y.z complete (progress: 1112%)
[2017-02-26 10:40:55,880] session with /10.x.y.z complete (progress: 1112%)
[2017-02-26 11:09:21,025] session with /10.x.y.z complete (progress: 1112%)
[2017-02-26 12:44:35,755] session with /10.x.y.z complete (progress: 1112%)
[2017-02-26 12:49:18,867] session with /10.x.y.z complete (progress: 1112%)
[2017-02-26 13:23:50,611] session with /10.x.y.z complete (progress: 1112%)
[2017-02-26 13:23:50,612] Stream failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;At that point (&quot;Stream failed&quot;) I would expect nodetool to exit with a non-zero exit code. Instead, it just wants me to ^C it.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13046521">CASSANDRA-13272</key>
            <summary>&quot;nodetool bootstrap resume&quot; does not exit</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="Wimtie">Tim Lamballais</assignee>
                                    <reporter username="tvdw">Tom van der Woerdt</reporter>
                        <labels>
                            <label>lhf</label>
                    </labels>
                <created>Mon, 27 Feb 2017 01:10:17 +0000</created>
                <updated>Fri, 15 May 2020 08:01:30 +0000</updated>
                            <resolved>Fri, 14 Jul 2017 09:49:55 +0000</resolved>
                                        <fixVersion>2.2.11</fixVersion>
                    <fixVersion>3.0.15</fixVersion>
                    <fixVersion>3.11.1</fixVersion>
                    <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Legacy/Streaming and Messaging</component>
                    <component>Local/Startup and Shutdown</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="16028423" author="wimtie" created="Mon, 29 May 2017 14:38:59 +0000"  >&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;diff --git a/src/java/org/apache/cassandra/service/StorageService.java b/src/java/org/apache/cassandra/service/StorageService.java
index 9bc046f..d7c1aa5 100644
--- a/src/java/org/apache/cassandra/service/StorageService.java
+++ b/src/java/org/apache/cassandra/service/StorageService.java
@@ -1287,8 +1287,9 @@ public class StorageService extends NotificationBroadcasterSupport implements IE
                 @Override
                 public void onFailure(Throwable e)
                 {
-                    String message = &quot;Error during bootstrap: &quot; + e.getCause().getMessage();
-                    logger.error(message, e.getCause());
+                    Throwable cause = Throwables.getRootCause(e);
+                    String message = &quot;Error during bootstrap: &quot; + cause.getMessage();
+                    logger.error(message, cause);
                     progressSupport.progress(&quot;bootstrap&quot;, new ProgressEvent(ProgressEventType.ERROR, 1, 1, message));
                     progressSupport.progress(&quot;bootstrap&quot;, new ProgressEvent(ProgressEventType.COMPLETE, 1, 1, &quot;Resume bootstrap complete&quot;));
                 }
diff --git a/src/java/org/apache/cassandra/utils/Throwables.java b/src/java/org/apache/cassandra/utils/Throwables.java
index 5ad9686..30fc9f4 100644
--- a/src/java/org/apache/cassandra/utils/Throwables.java
+++ b/src/java/org/apache/cassandra/utils/Throwables.java
@@ -30,6 +30,18 @@ import org.apache.cassandra.io.FSWriteError;

 public final class Throwables
 {
+    public static Throwable getRootCause(Throwable t)
+    {
+        Throwable cause = t.getCause();
+        if (cause == null) {
+            return t;
+        }
+        while (cause.getCause() != null) {
+            cause = cause.getCause();
+        }
+        return cause;
+    }
+
     public enum FileOpType { READ, WRITE }

     public interface DiscreteAction&amp;lt;E extends Exception&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16074970" author="blerer" created="Wed, 5 Jul 2017 15:48:08 +0000"  >&lt;p&gt;Thanks for the patch.&lt;/p&gt;

&lt;p&gt;I guess, based on the patch, that the problem came from the fact that &lt;tt&gt;e.getCause().getMessage()&lt;/tt&gt; was causing a &lt;tt&gt;NPE&lt;/tt&gt;?&lt;/p&gt;

&lt;p&gt;Regarding the patch, could you add some javadoc and a unit test for &lt;tt&gt;Throwables::getRootCause&lt;/tt&gt;.&lt;br/&gt;
Could you also attach the patch as a file?&lt;/p&gt;</comment>
                            <comment id="16074990" author="blerer" created="Wed, 5 Jul 2017 15:55:56 +0000"  >&lt;p&gt;I just realize that your patch change the current behavior. The cause should be the cause of the Exception or the Exception itself not the root cause of the all chain.&lt;/p&gt;</comment>
                            <comment id="16076144" author="blerer" created="Thu, 6 Jul 2017 08:17:03 +0000"  >&lt;p&gt;I had a look at the sources and I am not sure to understand the purpose of the original code. Everywhere else in &lt;tt&gt;StorageService&lt;/tt&gt; the full chain of Exceptions is being logged.&lt;/p&gt;

&lt;p&gt;If the wrapping Exception was created without a message it will automatically use the message of the wrapped exception. Due to that, we should probably use:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;                @Override
                &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void onFailure(Throwable e)
                {
                    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; message = &lt;span class=&quot;code-quote&quot;&gt;&quot;Error during bootstrap: &quot;&lt;/span&gt; + e.getMessage();
                    logger.error(message, e);
                    progressSupport.progress(&lt;span class=&quot;code-quote&quot;&gt;&quot;bootstrap&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ProgressEvent(ProgressEventType.ERROR, 1, 1, message));
                    progressSupport.progress(&lt;span class=&quot;code-quote&quot;&gt;&quot;bootstrap&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ProgressEvent(ProgressEventType.COMPLETE, 1, 1, &lt;span class=&quot;code-quote&quot;&gt;&quot;Resume bootstrap complete&quot;&lt;/span&gt;));
                }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yukim&quot; class=&quot;user-hover&quot; rel=&quot;yukim&quot;&gt;yukim&lt;/a&gt; Do you remember why you used the exception cause instead of the exception?&lt;/p&gt;</comment>
                            <comment id="16077675" author="yukim" created="Fri, 7 Jul 2017 06:20:20 +0000"  >&lt;p&gt;I think at the time I thought &lt;tt&gt;Throwable e&lt;/tt&gt; is usually &lt;tt&gt;ExecutionException&lt;/tt&gt; so I wanted to get what caused that execution error.&lt;br/&gt;
I&apos;m not sure what&apos;s causing its cause to be null, but it looks it can happen.&lt;br/&gt;
I think we need proper null handling there.&lt;/p&gt;</comment>
                            <comment id="16080063" author="blerer" created="Mon, 10 Jul 2017 09:28:26 +0000"  >&lt;blockquote&gt;&lt;p&gt;I think at the time I thought &lt;tt&gt;Throwable e&lt;/tt&gt; is usually &lt;tt&gt;ExecutionException&lt;/tt&gt; so I wanted to get what caused that execution error.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;In this case, we should probably retrieve the cause only if &lt;tt&gt;e&lt;/tt&gt; is an &lt;tt&gt;ExecutionException&lt;/tt&gt; and the cause is not &lt;tt&gt;null&lt;/tt&gt;. It should never be the case if &lt;tt&gt;e&lt;/tt&gt; is an &lt;tt&gt;ExecutionException&lt;/tt&gt; but better be safe than sorry.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Wimtie&quot; class=&quot;user-hover&quot; rel=&quot;Wimtie&quot;&gt;Wimtie&lt;/a&gt; could you update your patch? &lt;/p&gt;
</comment>
                            <comment id="16080131" author="wimtie" created="Mon, 10 Jul 2017 10:30:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blerer&quot; class=&quot;user-hover&quot; rel=&quot;blerer&quot;&gt;blerer&lt;/a&gt;, I&apos;ll update it to retrieve the cause in case of ExecutionException. It&apos;ll then pass that message back to the client, but I&apos;ll use the original throwable in the call to log.error, so we don&apos;t lose the original stacktrace in the logs.&lt;/p&gt;

&lt;p&gt;Cheerio,&lt;/p&gt;

&lt;p&gt;Tim&lt;/p&gt;</comment>
                            <comment id="16080213" author="wimtie" created="Mon, 10 Jul 2017 11:49:58 +0000"  >&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;From 1fd3c4eef678eda01f1f33c95760c1976675455f Mon Sep 17 00:00:00 2001
From: Timothy George Lamballais Tessensohn &amp;lt;timothy.lamballais@booking.com&amp;gt;
Date: Mon, 10 Jul 2017 13:47:19 +0200
Subject: [PATCH] fix NPE when stream fails

https://issues.apache.org/jira/browse/CASSANDRA-13272
---
 src/java/org/apache/cassandra/service/StorageService.java | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/src/java/org/apache/cassandra/service/StorageService.java b/src/java/org/apache/cassandra/service/StorageService.java
index 143b402d78..919df0cda3 100644
--- a/src/java/org/apache/cassandra/service/StorageService.java
+++ b/src/java/org/apache/cassandra/service/StorageService.java
@@ -1287,8 +1287,11 @@ public class StorageService extends NotificationBroadcasterSupport implements IE
                 @Override
                 public void onFailure(Throwable e)
                 {
-                    String message = &quot;Error during bootstrap: &quot; + e.getCause().getMessage();
-                    logger.error(message, e.getCause());
+                    String message = e.getMessage();
+                    logger.error(message, e);
+                    if (e instanceof ExecutionException &amp;amp;&amp;amp; e.getCause() != null) {
+                        message = e.getCause().getMessage();
+                    }
                     progressSupport.progress(&quot;bootstrap&quot;, new ProgressEvent(ProgressEventType.ERROR, 1, 1, message));
                     progressSupport.progress(&quot;bootstrap&quot;, new ProgressEvent(ProgressEventType.COMPLETE, 1, 1, &quot;Resume bootstrap complete&quot;));
                 }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16087112" author="blerer" created="Fri, 14 Jul 2017 09:45:46 +0000"  >&lt;p&gt;Thanks for the patch. I ran CI on the 2.2 branch for extra safety and the failing tests are unrelated.&lt;/p&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="16087116" author="blerer" created="Fri, 14 Jul 2017 09:49:55 +0000"  >&lt;p&gt;Committed into 2.2 at 5b982d790bffbf1beb92fd605f6f213914ba4b63 and merged into 3.0, 3.11 and trunk&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[Wimtie]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 18 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3anl3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311421" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Reproduced In</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12338291">3.0.10</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>blerer</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[blerer]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12324945">2.2.0 beta 1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>