<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 22:13:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-1122] Lack of subcomparator_type will corrupt the keyspace in Thrift system_add_keyspace()</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-1122</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;I had a problem earlier where I create a Keyspace by reading the default yaml config shipped with the above cassandra package and after parsing and creating the keyspace with PHP Thrift system_add_keysapce command, I would get &apos;TException: Error: Internal error processing describe_keyspace &apos; when trying to get describe_keyspace. In cassandra-cli I get the same error.&lt;/p&gt;

&lt;p&gt;The cassandra log shows a null pointed exception:&lt;br/&gt;
ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-39&amp;#93;&lt;/span&gt; 2010-05-24 14:17:35,204 Cassandra.java (line 1943) Internal error processing describe_keyspace&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
	at org.apache.cassandra.thrift.CassandraServer.describe_keyspace(CassandraServer.java:476)&lt;br/&gt;
	at org.apache.cassandra.thrift.Cassandra$Processor$describe_keyspace.process(Cassandra.java:1939)&lt;br/&gt;
	at org.apache.cassandra.thrift.Cassandra$Processor.process(Cassandra.java:1276)&lt;br/&gt;
	at org.apache.thrift.server.TThreadPoolServer$WorkerProcess.run(TThreadPoolServer.java:253)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:636)&lt;/p&gt;

&lt;p&gt;I traced down the problem to where I define cassandra_CfDef. When the type is Super and subcomparator_type is not set, Thrift code does not set it to any default value but blank &quot;&quot;. The command system_add_keyspace() runs with no problem. Whatever happens in Cassandra afterwards, will create a useless keyspace.&lt;/p&gt;

&lt;p&gt;Here is my code snippet to generate the exception:&lt;/p&gt;

&lt;p&gt; &amp;lt;?php&lt;br/&gt;
$GLOBALS&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;THRIFT_ROOT&amp;#39;&amp;#93;&lt;/span&gt; = &apos;/usr/share/php/Thrift&apos;;&lt;br/&gt;
require_once $GLOBALS&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;THRIFT_ROOT&amp;#39;&amp;#93;&lt;/span&gt;.&apos;/packages/cassandra/Cassandra.php&apos;;&lt;br/&gt;
require_once $GLOBALS&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;THRIFT_ROOT&amp;#39;&amp;#93;&lt;/span&gt;.&apos;/packages/cassandra/cassandra_types.php&apos;;&lt;br/&gt;
require_once $GLOBALS&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;THRIFT_ROOT&amp;#39;&amp;#93;&lt;/span&gt;.&apos;/transport/TSocket.php&apos;;&lt;br/&gt;
require_once $GLOBALS&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;THRIFT_ROOT&amp;#39;&amp;#93;&lt;/span&gt;.&apos;/protocol/TBinaryProtocol.php&apos;;&lt;br/&gt;
require_once $GLOBALS&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;THRIFT_ROOT&amp;#39;&amp;#93;&lt;/span&gt;.&apos;/transport/TFramedTransport.php&apos;;&lt;br/&gt;
require_once $GLOBALS&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;THRIFT_ROOT&amp;#39;&amp;#93;&lt;/span&gt;.&apos;/transport/TBufferedTransport.php&apos;;&lt;/p&gt;

&lt;p&gt;try &lt;/p&gt;
{
  // Make a connection to the Thrift interface to Cassandra
  $socket = new TSocket(&apos;127.0.0.1&apos;, 9160);
  $transport = new TBufferedTransport($socket, 1024, 1024);
  $protocol = new TBinaryProtocolAccelerated($transport);
  $client = new CassandraClient($protocol);
  $transport-&amp;gt;open();

  //Try creating some keyspace/column family defs
  $ks = new cassandra_KsDef();
  $ks-&amp;gt;name = &apos;agoudarzi_Keyspace1&apos;;
  $ks-&amp;gt;strategy_class = &apos;org.apache.cassandra.locator.RackUnawareStrategy&apos;;
  $ks-&amp;gt;replication_factor = &apos;1&apos;;
  
  //Now add a column family to it
  $cf = new cassandra_CfDef();
  $cf-&amp;gt;name = &apos;Super3&apos;;
  $cf-&amp;gt;table = &apos;agoudarzi_Keyspace1&apos;;
  $cf-&amp;gt;column_type = &apos;Super&apos;;
  $cf-&amp;gt;comparator_type = &apos;LongType&apos;;
  $cf-&amp;gt;row_cache_size = &apos;0&apos;;
  $cf-&amp;gt;key_cache_size = &apos;50&apos;;
  $cf-&amp;gt;comment = &apos;A column family with supercolumns, whose column names are Longs (8 bytes)&apos;;
  $ks-&amp;gt;cf_defs[] = $cf;

  $client-&amp;gt;system_add_keyspace($ks);
  
  sleep(2);
  
  //Try to check if keyspace description is good
  $client-&amp;gt;set_keyspace(&apos;agoudarzi_Keyspace1&apos;);
  $rs = $client-&amp;gt;describe_keyspace(&apos;agoudarzi_Keyspace1&apos;);

  $transport-&amp;gt;close();

}
&lt;p&gt; catch (TException $tx) {&lt;br/&gt;
   print &apos;TException: &apos;.$tx-&amp;gt;why. &apos; Error: &apos;.$tx-&amp;gt;getMessage() . &quot;\n&quot;;&lt;br/&gt;
}&lt;br/&gt;
?&amp;gt;&lt;/p&gt;

&lt;p&gt;I think a default subcomparator should be set by thrift or other defensive method be used to prevent this problem.&lt;/p&gt;

&lt;p&gt;Please investigate. &lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</description>
                <environment>&lt;p&gt;CentOS 5.2 - Linux 2.6.18-164.15.1.el5 #1 SMP Wed Mar 17 11:30:06 EDT 2010 x86_64 x86_64 x86_64 GNU/Linux&lt;br/&gt;
apache-cassandra-2010-05-21_13-27-42&lt;br/&gt;
Thrift 2.0 with patch &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-780&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/THRIFT-780&lt;/a&gt;&lt;br/&gt;
PHP 5.2&lt;/p&gt;</environment>
        <key id="12465309">CASSANDRA-1122</key>
            <summary>Lack of subcomparator_type will corrupt the keyspace in Thrift system_add_keyspace()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gdusbabek">Gary Dusbabek</assignee>
                                    <reporter username="arya">Arya Goudarzi</reporter>
                        <labels>
                    </labels>
                <created>Mon, 24 May 2010 21:27:11 +0000</created>
                <updated>Tue, 16 Apr 2019 09:33:23 +0000</updated>
                            <resolved>Wed, 26 May 2010 19:04:00 +0000</resolved>
                                        <fixVersion>0.7 beta 1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12870851" author="arya" created="Mon, 24 May 2010 21:29:11 +0000"  >&lt;p&gt;The PHP Code to reproduce this exception. &lt;/p&gt;</comment>
                            <comment id="12871878" author="gdusbabek" created="Wed, 26 May 2010 18:36:08 +0000"  >&lt;p&gt;Before &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-44&quot; title=&quot;It is difficult to modify the set of ColumnFamliies in an existing cluster&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-44&quot;&gt;&lt;del&gt;CASSANDRA-44&lt;/del&gt;&lt;/a&gt;, we assumed defaulted CF.subcolumcomparator to BytesType if it wasn&apos;t specified on a supercolumn.  We can&apos;t have a conditional default in thrift, so make it right on the server.&lt;/p&gt;

&lt;p&gt;Includes a system test that could reproduce the error prior to the patch.&lt;/p&gt;</comment>
                            <comment id="12871879" author="jbellis" created="Wed, 26 May 2010 18:36:13 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="12872202" author="hudson" created="Thu, 27 May 2010 12:47:29 +0000"  >&lt;p&gt;Integrated in Cassandra #447 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Cassandra/447/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Cassandra/447/&lt;/a&gt;)&lt;br/&gt;
    CFMeta.subcolumncomparator should default to BytesType if cftype==Super. patch by gdusbabek, reviewed by jbellis. &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1122&quot; title=&quot;Lack of subcomparator_type will corrupt the keyspace in Thrift system_add_keyspace()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-1122&quot;&gt;&lt;del&gt;CASSANDRA-1122&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12445574" name="0001-CFMeta.subcolumncomparator-should-default-to-BytesTy.patch" size="3065" author="gdusbabek" created="Wed, 26 May 2010 18:33:40 +0000"/>
                            <attachment id="12445388" name="test_cass.php" size="1726" author="arya" created="Mon, 24 May 2010 21:29:11 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[gdusbabek]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19999</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 26 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0g34v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>91938</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>