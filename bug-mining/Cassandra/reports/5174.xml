<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:13:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-14802] calculatePendingRanges assigns more pending ranges than necessary </title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-14802</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;p&gt;This might be a good thing, but should probably be configurable, and made consistent.  Presently, in a number of circumstances where there are multiple range movements, &lt;tt&gt;calculatePendingRanges&lt;/tt&gt; will assign a pending range to a node that will not ultimately own it.  If done consistently, this might make range movements resilient to node failures / aborted range movements, since all nodes will be receiving all ranges they might own under any incomplete range ownership movements.  But done inconsistently it seems only to reduce availability in the cluster, by potentially increasing the number of pending nodes unnecessarily.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13189135">CASSANDRA-14802</key>
            <summary>calculatePendingRanges assigns more pending ranges than necessary </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="samt">Sam Tunnicliffe</assignee>
                                    <reporter username="benedict">Benedict Elliott Smith</reporter>
                        <labels>
                    </labels>
                <created>Wed, 3 Oct 2018 11:23:00 +0000</created>
                <updated>Fri, 15 May 2020 13:48:15 +0000</updated>
                            <resolved>Fri, 15 May 2020 13:48:15 +0000</resolved>
                                        <fixVersion>4.0-alpha1</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Legacy/Coordination</component>
                    <component>Legacy/Distributed Metadata</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16754286" author="beobal" created="Mon, 28 Jan 2019 19:30:02 +0000"  >&lt;p&gt;During concurrent replacements without any actual range movements occurring, the pending ranges calculation can also be incorrect due to the fact that we don&apos;t differentiate between &lt;tt&gt;BOOTSTRAP&lt;/tt&gt; and &lt;tt&gt;BOOTSTRAP_REPLACE&lt;/tt&gt;.&lt;br/&gt;
Updating &lt;tt&gt;allLeftMetadata&lt;/tt&gt; with the tokens &amp;amp; endpoint for a &lt;tt&gt;BOOTSTRAP_REPLACE&lt;/tt&gt; doesn&apos;t grow the ring as it&apos;s a straight up replacement, so the subsequent removal of the new endpoint after we grab its new ranges actually constitutes a shrink, skewing the ownership represented by &lt;tt&gt;allLeftMetadata&lt;/tt&gt;. If there are concurrent replacements happening, this then makes the pending ranges calculation for those tokens completely off.&lt;/p&gt;

</comment>
                            <comment id="16755227" author="benedict" created="Tue, 29 Jan 2019 17:45:08 +0000"  >&lt;p&gt;I did not describe the issue when I filed this JIRA, as I had not fully investigated the extent of the problem, but to describe the issue I found that instigated filing this issue: once a node&apos;s move has been processed we remove the node from the ring, including its original position, so that future range ownership calculations operate from a ring that entirely lacks this node.  This can cause the same problem of skewing ownership calculations for later nodes, causing it to pile up onto nodes that can never actually own the range.&lt;/p&gt;

&lt;p&gt;That is to say that these problems sound like the same basic issue, however for BOOTSTRAP_REPLACE we can maybe fix it more readily.&lt;/p&gt;</comment>
                            <comment id="16784562" author="beobal" created="Tue, 5 Mar 2019 15:24:26 +0000"  >&lt;p&gt;The &lt;tt&gt;BOOTSTRAP_REPLACE&lt;/tt&gt; case is, I think, relatively straightforward to fix. As this is fairly simple to reason about/implement/test, IMO we could consider it for 4.0 and defer the more complex general case for now. This isn&apos;t a new regression and getting it right (&amp;amp; validating it) is going to be quite involved, so it feels a bit of a risk for the 4.0 timeframe.&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;branch&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;CI&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://github.com/beobal/cassandra/tree/14802-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;14802-trunk&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://circleci.com/gh/beobal/workflows/cassandra/tree/cci%2F14802-trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;circle&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="16785881" author="benedict" created="Wed, 6 Mar 2019 17:12:39 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;This isn&apos;t a new regression and getting it right (&amp;amp; validating it) is going to be quite involved, so it feels a bit of a risk for the 4.0 timeframe.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;FWIW, I will need to look at this class again soon because transient replication complicated it, and it is known to not work with transient replication.  In the process, I may see how challenging it would be to more comprehensively fix and test the class, as it is currently very non-obvious to work with.  It might be possible to formulate it in a clearer manner, but we&apos;ll see; obviously, not if it risk 4.0.&lt;/p&gt;</comment>
                            <comment id="16797134" author="beobal" created="Wed, 20 Mar 2019 12:45:42 +0000"  >&lt;p&gt;Thanks, committed to trunk in &lt;tt&gt;4f53bc87261b470adf292fdf37ed4e81bb6f8704&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="17108301" author="jmckenzie" created="Fri, 15 May 2020 13:48:11 +0000"  >&lt;p&gt;Some how status: resolved w/Resolution: Unresolved. Re-opening to fix.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[samt]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 26 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3ys4f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[benedict]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12327256">2.1.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;Unit test included&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>