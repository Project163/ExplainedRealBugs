<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:15:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CASSANDRA-15528] Fix flakey test - org.apache.cassandra.index.sasi.SASIIndexTest testInvalidate</title>
                <link>https://issues.apache.org/jira/browse/CASSANDRA-15528</link>
                <project id="12310865" key="CASSANDRA">Apache Cassandra</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
junit.framework.AssertionFailedError: [key0, key2918, key2919, key2920, key2921, key2922, key2924, key2926, key2927, key2928]
	at org.apache.cassandra.index.sasi.SASIIndexTest.testInvalidate(SASIIndexTest.java:874)
	at org.apache.cassandra.index.sasi.SASIIndexTest.testInvalidate(SASIIndexTest.java:852)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13281511">CASSANDRA-15528</key>
            <summary>Fix flakey test - org.apache.cassandra.index.sasi.SASIIndexTest testInvalidate</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10002" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Normal</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gianluca">Gianluca Righetto</assignee>
                                    <reporter username="dcapwell">David Capwell</reporter>
                        <labels>
                    </labels>
                <created>Fri, 24 Jan 2020 23:40:22 +0000</created>
                <updated>Fri, 10 Oct 2025 08:47:56 +0000</updated>
                            <resolved>Thu, 19 Mar 2020 19:52:59 +0000</resolved>
                                        <fixVersion>4.0-alpha4</fixVersion>
                    <fixVersion>4.0</fixVersion>
                                    <component>Test/unit</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="17023336" author="dcapwell" created="Fri, 24 Jan 2020 23:41:07 +0000"  >&lt;p&gt;The failure was seen on java 11&lt;/p&gt;</comment>
                            <comment id="17034480" author="edimitrova" created="Tue, 11 Feb 2020 14:16:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dcapwell&quot; class=&quot;user-hover&quot; rel=&quot;dcapwell&quot;&gt;dcapwell&lt;/a&gt;&#160;Same for this one, dependent on&#160; &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-15526&quot; title=&quot;Fix flakey test - org.apache.cassandra.index.sasi.SASIIndexTest testConcurrentMemtableReadsAndWrites&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-15526&quot;&gt;&lt;del&gt;CASSANDRA-15526&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;(You reproduce it in case the other one fails and for me only the other one fails, only on Ubuntu VM so ),&lt;/p&gt;

&lt;p&gt;I am gonna put this one for now as blocked by the other one until we come up with solution there. Then we can check whether our assumption for dependency is valid. About &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-15526&quot; title=&quot;Fix flakey test - org.apache.cassandra.index.sasi.SASIIndexTest testConcurrentMemtableReadsAndWrites&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-15526&quot;&gt;&lt;del&gt;CASSANDRA-15526&lt;/del&gt;&lt;/a&gt;,&#160;I didn&apos;t find any other issue than the one mentioned already by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jrwest&quot; class=&quot;user-hover&quot; rel=&quot;jrwest&quot;&gt;jrwest&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;As per the Java doc:&lt;/p&gt;

&lt;p&gt;&quot;Beware that, unlike in most collections, the &lt;tt&gt;size&lt;/tt&gt; method is &lt;em&gt;not&lt;/em&gt; a constant-time operation. Because of the asynchronous nature of these sets, determining the current number of elements requires a traversal of the elements, and so may report inaccurate results if this collection is modified during traversal.&quot;&lt;/p&gt;

&lt;p&gt;Probably we will need to find a more reliable test. TBD&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17053092" author="gianluca" created="Fri, 6 Mar 2020 07:19:00 +0000"  >&lt;p&gt;I&apos;m able to reproduce this by inducing a failure on line 1108 of o.a.c.i.s.SASIIndexTest.java&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/blob/3f2a248da11448ed9fd38467e4b353ed4df4888f/test/unit/org/apache/cassandra/index/sasi/SASIIndexTest.java#L1108&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/blob/3f2a248da11448ed9fd38467e4b353ed4df4888f/test/unit/org/apache/cassandra/index/sasi/SASIIndexTest.java#L1108&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;What is happening here is that when an exception or assertion error is thrown at that point, JUnit moves on to the next test, but the ExecutorService (on line 1084) continues to process the insertions in the background (even after the keyspace is truncated in the @Before/cleanup step), which pollutes the results of this test.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-15526&quot; title=&quot;Fix flakey test - org.apache.cassandra.index.sasi.SASIIndexTest testConcurrentMemtableReadsAndWrites&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-15526&quot;&gt;&lt;del&gt;CASSANDRA-15526&lt;/del&gt;&lt;/a&gt; made this more apparent, but the fix for that doesn&apos;t necessarily fix this one. The proper fix here is to shutdown (and wait for) the ExecutorService before running another test method.&lt;/p&gt;

&lt;p&gt;I&apos;m submitting a patch that adds a try/finally block and shuts down the insertion threads.&lt;/p&gt;</comment>
                            <comment id="17053830" author="edimitrova" created="Sat, 7 Mar 2020 00:48:48 +0000"  >&lt;p&gt;Thanks for the patch. As we agreed, review will be completed when you are done with CI, flakey test multiplication.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17062553" author="jasonstack" created="Thu, 19 Mar 2020 13:15:58 +0000"  >&lt;p&gt;the patch LGTM, one minor nit: I think we don&apos;t need to update release note or CHANGES.txt for test fix, as it&apos;s not user visible..&lt;/p&gt;</comment>
                            <comment id="17062564" author="edimitrova" created="Thu, 19 Mar 2020 13:39:36 +0000"  >&lt;p&gt;That&apos;s a good topic. I was looking into the CHANGES.txt and it looks like it&apos;s a practice changes to the unit tests to be added.&lt;br/&gt;
Not sure whether someone started that unnecessarily and the others followed him/her or this is how it was agreed at some point.&lt;/p&gt;</comment>
                            <comment id="17062849" author="gianluca" created="Thu, 19 Mar 2020 18:33:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=e.dimitrova&quot; class=&quot;user-hover&quot; rel=&quot;e.dimitrova&quot;&gt;e.dimitrova&lt;/a&gt; dtests results attached&lt;/p&gt;</comment>
                            <comment id="17062871" author="edimitrova" created="Thu, 19 Mar 2020 19:05:56 +0000"  >&lt;p&gt;LGTM +1&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandon.williams&quot; class=&quot;user-hover&quot; rel=&quot;brandon.williams&quot;&gt;brandon.williams&lt;/a&gt; can you, please commit this one? Thanks!&lt;/p&gt;</comment>
                            <comment id="17062896" author="brandon.williams" created="Thu, 19 Mar 2020 19:52:59 +0000"  >&lt;p&gt;Commited, thanks!&lt;/p&gt;</comment>
                            <comment id="17063505" author="ifesdjeen" created="Fri, 20 Mar 2020 16:47:34 +0000"  >&lt;p&gt;This commit has broken eclipse-warnings check. I&apos;ve ninja&apos;d the fix for trunk &lt;a href=&quot;https://github.com/apache/cassandra/commit/a01d05d9a73211fb91c068e133d78ef8ccf34b4e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;a01d05d9a73211fb91c068e133d78ef8ccf34b4e&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310361">
                    <name>Blocked</name>
                                            <outwardlinks description="Blocked">
                                        <issuelink>
            <issuekey id="13281509">CASSANDRA-15526</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13281510">CASSANDRA-15527</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13358396">CASSANDRA-16444</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12995814" name="15528-4.0-alpha.txt" size="4235" author="gianluca" created="Fri, 6 Mar 2020 07:20:21 +0000"/>
                            <attachment id="12997149" name="15528-dtests-results.png" size="395594" author="gianluca" created="Thu, 19 Mar 2020 18:32:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313920" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Authors</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[gianluca]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12313825" key="com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect">
                        <customfieldname>Bug Category</customfieldname>
                        <customfieldvalues>
                                                    <customfieldvalue key="12982" cascade-level=""><![CDATA[Correctness]]></customfieldvalue>
                                <customfieldvalue key="12990" cascade-level="1"><![CDATA[Test Failure]]></customfieldvalue>
            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313821" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12965"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313822" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Discovered By</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12970"><![CDATA[Unit Test]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12313922" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Impacts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13100"><![CDATA[None]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 34 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12313921" key="jira.plugin.projectspecificselectfield.jpssf:multicftype">
                        <customfieldname>Platform</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="13076"><![CDATA[All]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0aurc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12313420" key="com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker">
                        <customfieldname>Reviewers</customfieldname>
                        <customfieldvalues>
                                    <customfieldvalue><![CDATA[e.dimitrova]]></customfieldvalue>
        <customfieldvalue><![CDATA[jasonstack]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313820" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Severity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="12962"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311420" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12346093">4.0-alpha</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12314136" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Since Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12348281">4.0-alpha1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12313924" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Source Control Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cassandra/commit/1a735f36b988157f1e7143852c4e3749649ee25d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cassandra/commit/1a735f36b988157f1e7143852c4e3749649ee25d&lt;/a&gt;&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313823" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Test and Documentation Plan</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;In order to reproduce this issue, induce an exception on line 1108 of o.a.c.i.s.SASIIndexTest.java and execute the unit tests. After applying the provided patch, the issue is not reproducible anymore.&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>