diff --git a/CHANGES.txt b/CHANGES.txt
index c35d5948c1..d8595ef485 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -1,4 +1,5 @@
 4.0.0
+ * Fix CassandraVersion::compareTo (CASSANDRA-16794)
  * BinLog does not close chronicle queue leaving this to GC to cleanup (CASSANDRA-16774)
 Merged from 3.11:
 Merged from 3.0:
diff --git a/src/java/org/apache/cassandra/utils/CassandraVersion.java b/src/java/org/apache/cassandra/utils/CassandraVersion.java
index 497b4ebe71..62b9b5417f 100644
--- a/src/java/org/apache/cassandra/utils/CassandraVersion.java
+++ b/src/java/org/apache/cassandra/utils/CassandraVersion.java
@@ -27,6 +27,8 @@ import java.util.regex.Pattern;
 
 import com.google.common.annotations.VisibleForTesting;
 import com.google.common.base.Suppliers;
+
+import org.apache.commons.lang3.ArrayUtils;
 import org.apache.commons.lang3.StringUtils;
 
 /**
@@ -109,7 +111,7 @@ public class CassandraVersion implements Comparable<CassandraVersion>
     {
         return patch == 0 && hotfix == NO_HOTFIX && preRelease != null && preRelease.length == 0 && build == null
                ? this
-               : new CassandraVersion(major, minor, 0, NO_HOTFIX, new String[0], null);
+               : new CassandraVersion(major, minor, 0, NO_HOTFIX, ArrayUtils.EMPTY_STRING_ARRAY, null);
     }
 
     private static String[] parseIdentifiers(String version, String str)
@@ -190,16 +192,34 @@ public class CassandraVersion implements Comparable<CassandraVersion>
                 if (i2 != null)
                     return 1;
 
-                int c = ids1[i].compareTo(ids2[i]);
+                int c = ids1[i].compareToIgnoreCase(ids2[i]);
                 if (c != 0)
                     return c;
             }
         }
 
         if (ids1.length < ids2.length)
-            return -1;
+        {
+            // If the preRelease is empty it means that it is a family lower bound and that the first identifier is smaller than the second one
+            // (e.g. 4.0.0- < 4.0.0-beta1)
+            if (ids1.length == 0)
+                return -1;
+
+            // If the difference in length is only due to SNAPSHOT we know that the second identifier is smaller than the first one.
+            // (e.g. 4.0.0-rc1 > 4.0.0-rc1-SNAPSHOT)
+            return (ids2.length - ids1.length) == 1 && ids2[ids2.length - 1].equalsIgnoreCase("SNAPSHOT") ? 1 : -1;
+        }
         if (ids1.length > ids2.length)
-            return 1;
+        {
+            // If the preRelease is empty it means that it is a family lower bound and that the second identifier is smaller than the first one
+            // (e.g. 4.0.0-beta1 > 4.0.0-)
+            if (ids2.length == 0)
+                return 1;
+
+            // If the difference in length is only due to SNAPSHOT we know that the first identifier is smaller than the second one.
+            // (e.g. 4.0.0-rc1-SNAPSHOT < 4.0.0-rc1)
+            return (ids1.length - ids2.length) == 1 && ids1[ids1.length - 1].equalsIgnoreCase("SNAPSHOT") ? -1 : 1;
+        }
         return 0;
     }
 
diff --git a/test/unit/org/apache/cassandra/utils/CassandraVersionTest.java b/test/unit/org/apache/cassandra/utils/CassandraVersionTest.java
index b83990eae2..b9789f54bb 100644
--- a/test/unit/org/apache/cassandra/utils/CassandraVersionTest.java
+++ b/test/unit/org/apache/cassandra/utils/CassandraVersionTest.java
@@ -19,25 +19,27 @@ package org.apache.cassandra.utils;
 
 import java.lang.reflect.InvocationTargetException;
 import java.lang.reflect.Method;
+import java.util.ArrayList;
 import java.util.Arrays;
 import java.util.Collections;
 import java.util.List;
 
 import com.google.common.base.Splitter;
-import org.apache.commons.lang.CharRange;
+
+import org.apache.commons.lang3.ArrayUtils;
+
 import org.junit.Assert;
-import org.junit.Ignore;
 import org.junit.Test;
 
 import com.datastax.driver.core.VersionNumber;
-import org.apache.cassandra.io.sstable.format.Version;
 import org.assertj.core.api.Assertions;
 import org.quicktheories.core.Gen;
 import org.quicktheories.generators.Generate;
 import org.quicktheories.generators.SourceDSL;
-import org.quicktheories.impl.Constraint;
 
 import static org.junit.Assert.assertArrayEquals;
+import static org.junit.Assert.assertEquals;
+import static org.junit.Assert.assertNotEquals;
 import static org.junit.Assert.assertThat;
 import static org.junit.Assert.assertTrue;
 import static org.junit.Assert.fail;
@@ -149,13 +151,13 @@ public class CassandraVersionTest
     }
 
     @Test
-    public void testComparison()
+    public void testCompareTo()
     {
         CassandraVersion v1, v2;
 
         v1 = new CassandraVersion("1.2.3");
         v2 = new CassandraVersion("1.2.4");
-        assertTrue(v1.compareTo(v2) == -1);
+        assertTrue(v1.compareTo(v2) < 0);
 
         v1 = new CassandraVersion("1.2.3");
         v2 = new CassandraVersion("1.2.3");
@@ -163,24 +165,94 @@ public class CassandraVersionTest
 
         v1 = new CassandraVersion("1.2.3");
         v2 = new CassandraVersion("2.0.0");
-        assertTrue(v1.compareTo(v2) == -1);
-        assertTrue(v2.compareTo(v1) == 1);
+        assertTrue(v1.compareTo(v2) < 0);
+        assertTrue(v2.compareTo(v1) > 0);
 
         v1 = new CassandraVersion("1.2.3");
         v2 = new CassandraVersion("1.2.3-alpha");
-        assertTrue(v1.compareTo(v2) == 1);
+        assertTrue(v1.compareTo(v2) > 0);
 
         v1 = new CassandraVersion("1.2.3");
         v2 = new CassandraVersion("1.2.3+foo");
-        assertTrue(v1.compareTo(v2) == -1);
+        assertTrue(v1.compareTo(v2) < 0);
 
         v1 = new CassandraVersion("1.2.3");
         v2 = new CassandraVersion("1.2.3-alpha+foo");
-        assertTrue(v1.compareTo(v2) == 1);
+        assertTrue(v1.compareTo(v2) > 0);
 
         v1 = new CassandraVersion("1.2.3-alpha+1");
         v2 = new CassandraVersion("1.2.3-alpha+2");
-        assertTrue(v1.compareTo(v2) == -1);
+        assertTrue(v1.compareTo(v2) < 0);
+
+        v1 = new CassandraVersion("4.0-rc2");
+        v2 = new CassandraVersion("4.0-rc1");
+        assertTrue(v1.compareTo(v2) > 0);
+        assertTrue(v2.compareTo(v1) < 0);
+
+        v1 = new CassandraVersion("4.0-rc2");
+        v2 = new CassandraVersion("4.0-rc1");
+        assertTrue(v1.compareTo(v2) > 0);
+        assertTrue(v2.compareTo(v1) < 0);
+
+        v1 = new CassandraVersion("4.0.0");
+        v2 = new CassandraVersion("4.0-rc2");
+        assertTrue(v1.compareTo(v2) > 0);
+        assertTrue(v2.compareTo(v1) < 0);
+
+        v1 = new CassandraVersion("1.2.3-SNAPSHOT");
+        v2 = new CassandraVersion("1.2.3-alpha");
+        assertTrue(v1.compareTo(v2) > 0);
+        assertTrue(v2.compareTo(v1) < 0);
+
+        v1 = new CassandraVersion("1.2.3-SNAPSHOT");
+        v2 = new CassandraVersion("1.2.3-alpha-SNAPSHOT");
+        assertTrue(v1.compareTo(v2) > 0);
+        assertTrue(v2.compareTo(v1) < 0);
+
+        v1 = new CassandraVersion("1.2.3-SNAPSHOT");
+        v2 = new CassandraVersion("1.2.3");
+        assertTrue(v1.compareTo(v2) < 0);
+        assertTrue(v2.compareTo(v1) > 0);
+
+        v1 = new CassandraVersion("1.2-SNAPSHOT");
+        v2 = new CassandraVersion("1.2.3");
+        assertTrue(v1.compareTo(v2) < 0);
+        assertTrue(v2.compareTo(v1) > 0);
+
+        v1 = new CassandraVersion("1.2.3-SNAPSHOT");
+        v2 = new CassandraVersion("1.2");
+        assertTrue(v1.compareTo(v2) > 0);
+        assertTrue(v2.compareTo(v1) < 0);
+
+        v1 = new CassandraVersion("1.2-rc2");
+        v2 = new CassandraVersion("1.2.3-SNAPSHOT");
+        assertTrue(v1.compareTo(v2) < 0);
+        assertTrue(v2.compareTo(v1) > 0);
+
+        v1 = new CassandraVersion("1.2.3-rc2");
+        v2 = new CassandraVersion("1.2-SNAPSHOT");
+        assertTrue(v1.compareTo(v2) > 0);
+        assertTrue(v2.compareTo(v1) < 0);
+
+        v1 = CassandraVersion.CASSANDRA_4_0;
+        v2 = new CassandraVersion("4.0.0-SNAPSHOT");
+        assertTrue(v1.compareTo(v2) < 0);
+        assertTrue(v2.compareTo(v1) > 0);
+
+        v1 = new CassandraVersion("4.0");
+        v2 = new CassandraVersion("4.0.0");
+        assertTrue(v1.compareTo(v2) == 0);
+        assertTrue(v2.compareTo(v1) == 0);
+
+        v1 = new CassandraVersion("4.0").familyLowerBound.get();
+        v2 = new CassandraVersion("4.0.0");
+        assertTrue(v1.compareTo(v2) < 0);
+        assertTrue(v2.compareTo(v1) > 0);
+
+        v1 = new CassandraVersion("4.0").familyLowerBound.get();
+        v2 = new CassandraVersion("4.0");
+        assertTrue(v1.compareTo(v2) < 0);
+        assertTrue(v2.compareTo(v1) > 0);
     }
 
     @Test
@@ -192,41 +264,74 @@ public class CassandraVersionTest
     }
 
     @Test
-    public void testSnapshot()
+    public void testEquals()
     {
-        CassandraVersion prev, next;
-
-        prev = new CassandraVersion("2.1.5");
-        next = new CassandraVersion("2.1.5.123");
-        assertTrue(prev.compareTo(next) < 0);
-
-        prev = next;
-        next = new CassandraVersion("2.2.0-beta1-SNAPSHOT");
-        assertTrue(prev.compareTo(next) < 0);
-
-        prev = new CassandraVersion("2.2.0-beta1");
-        next = new CassandraVersion("2.2.0-rc1-SNAPSHOT");
-        assertTrue(prev.compareTo(next) < 0);
-
-        prev = next;
-        next = new CassandraVersion("2.2.0");
-        assertTrue(prev.compareTo(next) < 0);
-
-        prev = next;
-        next = new CassandraVersion("3.1");
-        assertTrue(prev.compareTo(next) < 0);
+        assertEquals(new CassandraVersion("3.0"), new CassandraVersion("3.0.0"));
+        assertNotEquals(new CassandraVersion("3.0"), new CassandraVersion("3.0").familyLowerBound.get());
+        assertNotEquals(new CassandraVersion("3.0.0"), new CassandraVersion("3.0.0").familyLowerBound.get());
+        assertNotEquals(new CassandraVersion("3.0.0"), new CassandraVersion("3.0").familyLowerBound.get());
+    }
 
-        prev = next;
-        next = new CassandraVersion("3.1.1");
-        assertTrue(prev.compareTo(next) < 0);
+    @Test
+    public void testFamilyLowerBound()
+    {
+        CassandraVersion expected = new CassandraVersion(3, 0, 0, CassandraVersion.NO_HOTFIX, ArrayUtils.EMPTY_STRING_ARRAY, null);
+        assertEquals(expected, new CassandraVersion("3.0.0-alpha1-SNAPSHOT").familyLowerBound.get());
+        assertEquals(expected, new CassandraVersion("3.0.0-alpha1").familyLowerBound.get());
+        assertEquals(expected, new CassandraVersion("3.0.0-rc1-SNAPSHOT").familyLowerBound.get());
+        assertEquals(expected, new CassandraVersion("3.0.0-rc1").familyLowerBound.get());
+        assertEquals(expected, new CassandraVersion("3.0.0-SNAPSHOT").familyLowerBound.get());
+        assertEquals(expected, new CassandraVersion("3.0.0").familyLowerBound.get());
+        assertEquals(expected, new CassandraVersion("3.0.1-SNAPSHOT").familyLowerBound.get());
+        assertEquals(expected, new CassandraVersion("3.0.1").familyLowerBound.get());
+    }
 
-        prev = next;
-        next = new CassandraVersion("3.2-rc1-SNAPSHOT");
-        assertTrue(prev.compareTo(next) < 0);
+    @Test
+    public void testOrderWithSnapshotsAndFamilyLowerBound()
+    {
+        List<CassandraVersion> expected = Arrays.asList(new CassandraVersion("2.0").familyLowerBound.get(),
+                                                        new CassandraVersion("2.1.5"),
+                                                        new CassandraVersion("2.1.5.123"),
+                                                        new CassandraVersion("2.2").familyLowerBound.get(),
+                                                        new CassandraVersion("2.2.0-beta1-snapshot"),
+                                                        new CassandraVersion("2.2.0-beta1"),
+                                                        new CassandraVersion("2.2.0-beta2-SNAPSHOT"),
+                                                        new CassandraVersion("2.2.0-beta2"),
+                                                        new CassandraVersion("2.2.0-rc1-snapshot"),
+                                                        new CassandraVersion("2.2.0-rc1"),
+                                                        new CassandraVersion("2.2.0-SNAPSHOT"),
+                                                        new CassandraVersion("2.2.0"),
+                                                        new CassandraVersion("3.0").familyLowerBound.get(),
+                                                        new CassandraVersion("3.0-alpha1"),
+                                                        new CassandraVersion("3.0-alpha2-SNAPSHOT"),
+                                                        new CassandraVersion("3.0-alpha2"),
+                                                        new CassandraVersion("3.0-beta1"),
+                                                        new CassandraVersion("3.0-beta2-SNAPSHOT"),
+                                                        new CassandraVersion("3.0-beta2"),
+                                                        new CassandraVersion("3.0-RC1-SNAPSHOT"),
+                                                        new CassandraVersion("3.0-RC1"),
+                                                        new CassandraVersion("3.0-RC2-SNAPSHOT"),
+                                                        new CassandraVersion("3.0-RC2"),
+                                                        new CassandraVersion("3.0-SNAPSHOT"),
+                                                        new CassandraVersion("3.0.0"),
+                                                        new CassandraVersion("3.0.1-SNAPSHOT"),
+                                                        new CassandraVersion("3.0.1"),
+                                                        new CassandraVersion("3.2").familyLowerBound.get(),
+                                                        new CassandraVersion("3.2-SNAPSHOT"),
+                                                        new CassandraVersion("3.2"));
+
+        for (int i = 0; i < 100; i++)
+        {
+            List<CassandraVersion> shuffled = new ArrayList<>(expected);
+            Collections.shuffle(shuffled);
 
-        prev = next;
-        next = new CassandraVersion("3.2");
-        assertTrue(prev.compareTo(next) < 0);
+            List<CassandraVersion> sorted = new ArrayList<>(shuffled);
+            Collections.sort(sorted);
+            if (!expected.equals(sorted))
+            {
+                fail("Expecting " + shuffled + " to be sorted into " + expected + " but was sorted into " + sorted);
+            }
+        }
     }
 
     private static void assertThrows(String str)
