diff --git a/test/distributed/org/apache/cassandra/distributed/impl/Instance.java b/test/distributed/org/apache/cassandra/distributed/impl/Instance.java
index 6ad0712710..47e2b32073 100644
--- a/test/distributed/org/apache/cassandra/distributed/impl/Instance.java
+++ b/test/distributed/org/apache/cassandra/distributed/impl/Instance.java
@@ -83,6 +83,7 @@ import org.apache.cassandra.gms.Gossiper;
 import org.apache.cassandra.gms.VersionedValue;
 import org.apache.cassandra.hints.HintsService;
 import org.apache.cassandra.index.SecondaryIndexManager;
+import org.apache.cassandra.io.IVersionedAsymmetricSerializer;
 import org.apache.cassandra.io.sstable.IndexSummaryManager;
 import org.apache.cassandra.io.sstable.format.SSTableReader;
 import org.apache.cassandra.io.util.DataInputBuffer;
@@ -91,6 +92,7 @@ import org.apache.cassandra.io.util.FileUtils;
 import org.apache.cassandra.locator.InetAddressAndPort;
 import org.apache.cassandra.net.Message;
 import org.apache.cassandra.net.MessagingService;
+import org.apache.cassandra.net.NoPayload;
 import org.apache.cassandra.net.Verb;
 import org.apache.cassandra.schema.Schema;
 import org.apache.cassandra.schema.SchemaConstants;
@@ -110,6 +112,7 @@ import org.apache.cassandra.tools.NodeTool;
 import org.apache.cassandra.tracing.TraceState;
 import org.apache.cassandra.tracing.Tracing;
 import org.apache.cassandra.transport.messages.ResultMessage;
+import org.apache.cassandra.utils.ByteArrayUtil;
 import org.apache.cassandra.utils.DiagnosticSnapshotService;
 import org.apache.cassandra.utils.ExecutorUtils;
 import org.apache.cassandra.utils.FBUtilities;
@@ -285,9 +288,18 @@ public class Instance extends IsolatedExecutor implements IInvokableInstance
 
     private static IMessage serializeMessage(InetAddressAndPort from, InetAddressAndPort to, Message<?> messageOut)
     {
+        int version = MessagingService.instance().versions.get(to);
+        if (messageOut.verb().serializer() == ((IVersionedAsymmetricSerializer) NoPayload.serializer) || messageOut.payload == null)
+        {
+            return new MessageImpl(messageOut.verb().id,
+                                   ByteArrayUtil.EMPTY_BYTE_ARRAY,
+                                   messageOut.id(),
+                                   version,
+                                   fromCassandraInetAddressAndPort(from));
+        }
+
         try (DataOutputBuffer out = new DataOutputBuffer(1024))
         {
-            int version = MessagingService.instance().versions.get(to);
             Message.serializer.serialize(messageOut, out, version);
             byte[] bytes = out.toByteArray();
             if (messageOut.serializedSize(version) != bytes.length)
diff --git a/test/distributed/org/apache/cassandra/distributed/impl/MessageImpl.java b/test/distributed/org/apache/cassandra/distributed/impl/MessageImpl.java
index ebc31b1225..607e890ff1 100644
--- a/test/distributed/org/apache/cassandra/distributed/impl/MessageImpl.java
+++ b/test/distributed/org/apache/cassandra/distributed/impl/MessageImpl.java
@@ -21,7 +21,7 @@ package org.apache.cassandra.distributed.impl;
 import java.net.InetSocketAddress;
 
 import org.apache.cassandra.distributed.api.IMessage;
-import org.apache.cassandra.distributed.shared.NetworkTopology;
+import org.apache.cassandra.utils.ByteArrayUtil;
 
 // a container for simplifying the method signature for per-instance message handling/delivery
 public class MessageImpl implements IMessage
@@ -65,5 +65,16 @@ public class MessageImpl implements IMessage
     {
         return from;
     }
+
+    public String toString()
+    {
+        return "MessageImpl{" +
+               "verb=" + verb +
+               ", bytes=" + ByteArrayUtil.bytesToHex(bytes) +
+               ", id=" + id +
+               ", version=" + version +
+               ", from=" + from +
+               '}';
+    }
 }
 
diff --git a/test/distributed/org/apache/cassandra/distributed/upgrade/UpgradeTest.java b/test/distributed/org/apache/cassandra/distributed/upgrade/UpgradeTest.java
index 3ec28180e3..9ce7867f48 100644
--- a/test/distributed/org/apache/cassandra/distributed/upgrade/UpgradeTest.java
+++ b/test/distributed/org/apache/cassandra/distributed/upgrade/UpgradeTest.java
@@ -35,27 +35,25 @@ public class UpgradeTest extends UpgradeTestBase
         .upgrade(Versions.Major.v22, Versions.Major.v30, Versions.Major.v3X)
         .upgrade(Versions.Major.v30, Versions.Major.v3X, Versions.Major.v4)
         .setup((cluster) -> {
-            //TODO fix - this is a jvm-dtest bug where we get null when we want the NoPayload object
-            cluster.setUncaughtExceptionsFilter(t ->
-                                                t instanceof IllegalArgumentException 
-                                                && t.getStackTrace()[0].getClassName().startsWith("org.apache.cassandra.net.NoPayload"));
             cluster.schemaChange("CREATE TABLE " + KEYSPACE + ".tbl (pk int, ck int, v int, PRIMARY KEY (pk, ck))");
 
             cluster.get(1).executeInternal("INSERT INTO " + KEYSPACE + ".tbl (pk, ck, v) VALUES (1, 1, 1)");
             cluster.get(2).executeInternal("INSERT INTO " + KEYSPACE + ".tbl (pk, ck, v) VALUES (1, 2, 2)");
             cluster.get(3).executeInternal("INSERT INTO " + KEYSPACE + ".tbl (pk, ck, v) VALUES (1, 3, 3)");
         })
-        .runAfterClusterUpgrade((cluster) -> {
-            assertRows(cluster.coordinator(1).execute("SELECT * FROM " + KEYSPACE + ".tbl WHERE pk = ?",
-                                                      ConsistencyLevel.ALL,
-                                                      1),
-                       row(1, 1, 1),
-                       row(1, 2, 2),
-                       row(1, 3, 3));
+        .runAfterNodeUpgrade((cluster, node) -> {
+            for (int i = 1; i <= cluster.size(); i++)
+            {
+                assertRows(cluster.coordinator(1).execute("SELECT * FROM " + KEYSPACE + ".tbl WHERE pk = ?",
+                                                          ConsistencyLevel.ALL,
+                                                          1),
+                           row(1, 1, 1),
+                           row(1, 2, 2),
+                           row(1, 3, 3));
+            }
         }).run();
     }
     
-    
     @Test
     public void simpleUpgradeWithNetworkAndGossipTest() throws Throwable
     {
