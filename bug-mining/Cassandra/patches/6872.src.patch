diff --git a/src/java/org/apache/cassandra/db/compaction/CompactionTask.java b/src/java/org/apache/cassandra/db/compaction/CompactionTask.java
index 6916755dfc..ce28e6b26f 100644
--- a/src/java/org/apache/cassandra/db/compaction/CompactionTask.java
+++ b/src/java/org/apache/cassandra/db/compaction/CompactionTask.java
@@ -469,9 +469,8 @@ public class CompactionTask extends AbstractCompactionTask
             {
                 while (scanner.hasNext())
                 {
-                    UnfilteredRowIterator partition = scanner.next();
-
-                    try (WriteContext ctx = cfs.keyspace.getWriteHandler().createContextForIndexing())
+                    try (UnfilteredRowIterator partition = scanner.next();
+                         WriteContext ctx = cfs.keyspace.getWriteHandler().createContextForIndexing())
                     {
                         List<Index.Indexer> indexers = new ArrayList<>();
                         for (int i = 0; i < indexes.size(); i++)
