diff --git a/CHANGES.txt b/CHANGES.txt
index a1a9a32f1a..31a8a3290c 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -2,6 +2,8 @@
  * avoid unproductive deserializing of cached rows during compaction
    (CASSANDRA-3921)
  * Show Effective Owership via Nodetool ring <keyspace> (CASSANDRA-3412)
+ * fix concurrency issues with CQL keyspace creation (CASSANDRA-3903)
+
 
 1.1-beta1
  * add nodetool rebuild_index (CASSANDRA-3583)
diff --git a/src/java/org/apache/cassandra/config/Schema.java b/src/java/org/apache/cassandra/config/Schema.java
index 0c8ced41df..e1047c2046 100644
--- a/src/java/org/apache/cassandra/config/Schema.java
+++ b/src/java/org/apache/cassandra/config/Schema.java
@@ -409,8 +409,15 @@ public class Schema
      */
     public void fixCFMaxId()
     {
-        // never set it to less than 1000. this ensures that we have enough system CFids for future use.
-        cfIdGen.set(cfIdMap.size() == 0 ? MIN_CF_ID : Math.max(Collections.max(cfIdMap.values()) + 1, MIN_CF_ID));
+        int cval, nval;
+        do
+        {
+            cval = cfIdGen.get();
+            int inMap = cfIdMap.isEmpty() ? 0 : Collections.max(cfIdMap.values()) + 1;
+            // never set it to less than 1000. this ensures that we have enough system CFids for future use.
+            nval = Math.max(Math.max(inMap, cval), MIN_CF_ID);
+        }
+        while (!cfIdGen.compareAndSet(cval, nval));
     }
 
     /**
diff --git a/src/java/org/apache/cassandra/db/ColumnFamilyStore.java b/src/java/org/apache/cassandra/db/ColumnFamilyStore.java
index fcc5c25410..dac9ded207 100644
--- a/src/java/org/apache/cassandra/db/ColumnFamilyStore.java
+++ b/src/java/org/apache/cassandra/db/ColumnFamilyStore.java
@@ -1519,11 +1519,10 @@ public class ColumnFamilyStore implements ColumnFamilyStoreMBean
 
     public static Iterable<ColumnFamilyStore> all()
     {
-        Iterable<ColumnFamilyStore>[] stores = new Iterable[Schema.instance.getTables().size()];
-        int i = 0;
+        List<Iterable<ColumnFamilyStore>> stores = new ArrayList<Iterable<ColumnFamilyStore>>(Schema.instance.getTables().size());
         for (Table table : Table.all())
         {
-            stores[i++] = table.getColumnFamilyStores();
+            stores.add(table.getColumnFamilyStores());
         }
         return Iterables.concat(stores);
     }
