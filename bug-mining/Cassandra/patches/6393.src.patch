diff --git a/src/java/org/apache/cassandra/db/ColumnFamilyStore.java b/src/java/org/apache/cassandra/db/ColumnFamilyStore.java
index 83957a6260..1dc2687c40 100644
--- a/src/java/org/apache/cassandra/db/ColumnFamilyStore.java
+++ b/src/java/org/apache/cassandra/db/ColumnFamilyStore.java
@@ -1495,9 +1495,8 @@ public class ColumnFamilyStore implements ColumnFamilyStoreMBean, Memtable.Owner
 
     public VersionedLocalRanges localRangesWeighted()
     {
-        ClusterMetadata metadata = ClusterMetadata.current();
         if (!SchemaConstants.isLocalSystemKeyspace(getKeyspaceName())
-            && getPartitioner() == metadata.partitioner)
+            && getPartitioner() == ClusterMetadata.current().partitioner)
         {
             DiskBoundaryManager.VersionedRangesAtEndpoint versionedLocalRanges = DiskBoundaryManager.getVersionedLocalRanges(this);
             Set<Range<Token>> localRanges = versionedLocalRanges.rangesAtEndpoint.ranges();
diff --git a/src/java/org/apache/cassandra/db/compaction/UnifiedCompactionStrategy.java b/src/java/org/apache/cassandra/db/compaction/UnifiedCompactionStrategy.java
index 0cb1f46cc8..361f67d8cb 100644
--- a/src/java/org/apache/cassandra/db/compaction/UnifiedCompactionStrategy.java
+++ b/src/java/org/apache/cassandra/db/compaction/UnifiedCompactionStrategy.java
@@ -302,10 +302,15 @@ public class UnifiedCompactionStrategy extends AbstractCompactionStrategy
         synchronized (this)
         {
             // Recheck after entering critical section, another thread may have beaten us to it.
-            while (shardManager == null || shardManager.isOutOfDate(ClusterMetadata.current().epoch.getEpoch()))
+            while (shardManager == null ||
+                   // Short circuit for local keyspaces which may be initialised before ClusterMetadata
+                   (cfs.localRangesWeighted().ringVersion != ColumnFamilyStore.RING_VERSION_IRRELEVANT
+                    && shardManager.isOutOfDate(ClusterMetadata.current().epoch.getEpoch())))
+            {
                 shardManager = ShardManager.create(cfs);
-            // Note: this can just as well be done without the synchronization (races would be benign, just doing some
-            // redundant work). For the current usages of this blocking is fine and expected to perform no worse.
+                // Note: this can just as well be done without the synchronization (races would be benign, just doing some
+                // redundant work). For the current usages of this blocking is fine and expected to perform no worse.
+            }
         }
     }
 
