diff --git a/src/java/org/apache/cassandra/db/commitlog/CommitLog.java b/src/java/org/apache/cassandra/db/commitlog/CommitLog.java
index 14c18c952e..c50beb6c63 100644
--- a/src/java/org/apache/cassandra/db/commitlog/CommitLog.java
+++ b/src/java/org/apache/cassandra/db/commitlog/CommitLog.java
@@ -270,9 +270,9 @@ public class CommitLog implements CommitLogMBean
             buffer.putInt((int) checksum.getValue());
 
             // checksummed mutation
-            Mutation.serializer.serialize(mutation, dos, MessagingService.current_version);
             copy = buffer.duplicate();
-            copy.limit((int) size);
+            Mutation.serializer.serialize(mutation, dos, MessagingService.current_version);
+            copy.limit(copy.position() + (int) size);
             checksum.update(copy);
             buffer.putInt((int) checksum.getValue());
         }
diff --git a/test/unit/org/apache/cassandra/db/RecoveryManagerFlushedTest.java b/test/unit/org/apache/cassandra/db/RecoveryManagerFlushedTest.java
index 57e7966c7d..e24af0f106 100644
--- a/test/unit/org/apache/cassandra/db/RecoveryManagerFlushedTest.java
+++ b/test/unit/org/apache/cassandra/db/RecoveryManagerFlushedTest.java
@@ -29,6 +29,7 @@ import org.apache.cassandra.db.compaction.CompactionManager;
 import org.apache.cassandra.db.commitlog.CommitLog;
 import org.apache.cassandra.exceptions.ConfigurationException;
 import org.apache.cassandra.schema.KeyspaceParams;
+import org.apache.cassandra.schema.SchemaKeyspace;
 import org.apache.cassandra.utils.FBUtilities;
 
 public class RecoveryManagerFlushedTest
@@ -55,6 +56,8 @@ public class RecoveryManagerFlushedTest
     {
         // Flush everything that may be in the commit log now to start fresh
         FBUtilities.waitOnFutures(Keyspace.open(SystemKeyspace.NAME).flush());
+        FBUtilities.waitOnFutures(Keyspace.open(SchemaKeyspace.NAME).flush());
+
 
         CompactionManager.instance.disableAutoCompaction();
 
