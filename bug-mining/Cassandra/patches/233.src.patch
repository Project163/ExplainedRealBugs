diff --git a/CHANGES.txt b/CHANGES.txt
index 10d4f4fe1e..d74c0263ea 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -1,5 +1,6 @@
 0.5.0 dev
  * Bootstrap improvements (several tickets)
+ * add nodeprobe repair anti-entropy feature (CASSANDRA-193, CASSANDRA-520)
  * fix possibility of partition when many nodes restart at once
    in clusters with multiple seeds (CASSANDRA-150)
  * fix NPE in get_range_slice when no data is found (CASSANDRA-578)
@@ -14,6 +15,7 @@
    (see contrib/client_only for an example of use)
  * make consistency_level functional in get_range_slice (CASSANDRA-568)
  * optimize key deserialization for RandomPartitioner (CASSANDRA-581)
+ * avoid GCing tombstones except on major compaction (CASSANDRA-604)
 
 
 0.5.0 beta
diff --git a/NEWS.txt b/NEWS.txt
index a94ceb6587..9ce55745f8 100644
--- a/NEWS.txt
+++ b/NEWS.txt
@@ -7,7 +7,7 @@
    (If more writes come in after the flush command, starting 0.5 will error
    out; if that happens, just go back to 0.4 and flush again.)
 
-1. Bootstrap, move, and load balancing have been added.
+1. Bootstrap, move, load balancing, and active repair have been added.
    See http://wiki.apache.org/cassandra/Operations
 
 2. Performance improvements across the board, especially on the write
diff --git a/src/java/org/apache/cassandra/db/ColumnFamilyStore.java b/src/java/org/apache/cassandra/db/ColumnFamilyStore.java
index 214a7308ff..5dbc5ac369 100644
--- a/src/java/org/apache/cassandra/db/ColumnFamilyStore.java
+++ b/src/java/org/apache/cassandra/db/ColumnFamilyStore.java
@@ -815,7 +815,7 @@ public final class ColumnFamilyStore implements ColumnFamilyStoreMBean
           logger_.debug("Expected bloom filter size : " + expectedBloomFilterSize);
 
         SSTableWriter writer = null;
-        CompactionIterator ci = new CompactionIterator(sstables, getDefaultGCBefore());
+        CompactionIterator ci = new CompactionIterator(sstables, getDefaultGCBefore(), sstables.size() == ssTables_.size());
         Iterator nni = new FilterIterator(ci, PredicateUtils.notNullPredicate());
 
         try
@@ -905,7 +905,7 @@ public final class ColumnFamilyStore implements ColumnFamilyStoreMBean
           logger_.debug("Expected bloom filter size : " + expectedBloomFilterSize);
 
         SSTableWriter writer;
-        CompactionIterator ci = new CompactionIterator(sstables, gcBefore); // retain a handle so we can call close()
+        CompactionIterator ci = new CompactionIterator(sstables, gcBefore, major); // retain a handle so we can call close()
         Iterator nni = new FilterIterator(ci, PredicateUtils.notNullPredicate());
 
         try
@@ -958,7 +958,7 @@ public final class ColumnFamilyStore implements ColumnFamilyStoreMBean
     void doReadonlyCompaction(InetAddress initiator) throws IOException
     {
         Collection<SSTableReader> sstables = ssTables_.getSSTables();
-        CompactionIterator ci = new CompactionIterator(sstables, getDefaultGCBefore());
+        CompactionIterator ci = new CompactionIterator(sstables, getDefaultGCBefore(), true);
         try
         {
             Iterator nni = new FilterIterator(ci, PredicateUtils.notNullPredicate());
diff --git a/src/java/org/apache/cassandra/io/CompactionIterator.java b/src/java/org/apache/cassandra/io/CompactionIterator.java
index d3442fb497..7fd5cf3869 100644
--- a/src/java/org/apache/cassandra/io/CompactionIterator.java
+++ b/src/java/org/apache/cassandra/io/CompactionIterator.java
@@ -23,6 +23,7 @@ package org.apache.cassandra.io;
 
 import java.io.Closeable;
 import java.io.IOException;
+import java.io.IOError;
 import java.util.List;
 import java.util.ArrayList;
 import java.util.Comparator;
@@ -41,12 +42,14 @@ public class CompactionIterator extends ReducingIterator<IteratingRow, Compactio
 
     private final List<IteratingRow> rows = new ArrayList<IteratingRow>();
     private final int gcBefore;
+    private boolean major;
 
     @SuppressWarnings("unchecked")
-    public CompactionIterator(Iterable<SSTableReader> sstables, int gcBefore) throws IOException
+    public CompactionIterator(Iterable<SSTableReader> sstables, int gcBefore, boolean major) throws IOException
     {
         super(getCollatingIterator(sstables));
         this.gcBefore = gcBefore;
+        this.major = major;
     }
 
     @SuppressWarnings("unchecked")
@@ -84,35 +87,54 @@ public class CompactionIterator extends ReducingIterator<IteratingRow, Compactio
         DataOutputBuffer buffer = new DataOutputBuffer();
         DecoratedKey key = rows.get(0).getKey();
 
-        ColumnFamily cf = null;
-        for (IteratingRow row : rows)
+        try
         {
-            ColumnFamily thisCF;
-            try
+            if (rows.size() > 1 || major)
             {
-                thisCF = row.getColumnFamily();
-            }
-            catch (IOException e)
-            {
-                logger.error("Skipping row " + key + " in " + row.getPath(), e);
-                continue;
-            }
-            if (cf == null)
-            {
-                cf = thisCF;
+                ColumnFamily cf = null;
+                for (IteratingRow row : rows)
+                {
+                    ColumnFamily thisCF;
+                    try
+                    {
+                        thisCF = row.getColumnFamily();
+                    }
+                    catch (IOException e)
+                    {
+                        logger.error("Skipping row " + key + " in " + row.getPath(), e);
+                        continue;
+                    }
+                    if (cf == null)
+                    {
+                        cf = thisCF;
+                    }
+                    else
+                    {
+                        cf.addAll(thisCF);
+                    }
+                }
+                ColumnFamily cfPurged = major ? ColumnFamilyStore.removeDeleted(cf, gcBefore) : cf;
+                if (cfPurged == null)
+                    return null;
+                ColumnFamily.serializer().serializeWithIndexes(cfPurged, buffer);
             }
             else
             {
-                cf.addAll(thisCF);
+                assert rows.size() == 1;
+                try
+                {
+                    rows.get(0).echoData(buffer);
+                }
+                catch (IOException e)
+                {
+                    throw new IOError(e);
+                }
             }
         }
-        rows.clear();
-
-        ColumnFamily cfPurged = ColumnFamilyStore.removeDeleted(cf, gcBefore);
-        if (cfPurged == null)
-            return null;
-        ColumnFamily.serializer().serializeWithIndexes(cfPurged, buffer);
-
+        finally
+        {
+            rows.clear();
+        }
         return new CompactedRow(key, buffer);
     }
 
diff --git a/test/unit/org/apache/cassandra/db/CompactionsTest.java b/test/unit/org/apache/cassandra/db/CompactionsTest.java
index 01994e7cdb..41231471ff 100644
--- a/test/unit/org/apache/cassandra/db/CompactionsTest.java
+++ b/test/unit/org/apache/cassandra/db/CompactionsTest.java
@@ -25,6 +25,7 @@ import java.util.concurrent.Future;
 import java.util.ArrayList;
 import java.util.Set;
 import java.util.HashSet;
+import java.util.Collection;
 
 import org.junit.Test;
 
@@ -105,15 +106,25 @@ public class CompactionsTest extends CleanupHelper
         }
         store.forceBlockingFlush();
 
-        // resurrect one row
+        // resurrect one column
         rm = new RowMutation(TABLE1, key);
         rm.add(new QueryPath(cfName, null, String.valueOf(5).getBytes()), new byte[0], 2);
         rm.apply();
         store.forceBlockingFlush();
 
-        // compact and test that all columns but the resurrected one is completely gone
-        store.doFileCompaction(store.getSSTables(), Integer.MAX_VALUE);
+        // verify that non-major compaction does no GC to ensure correctness (see CASSANDRA-604)
+        Collection<SSTableReader> sstablesIncomplete = store.getSSTables();
+        rm = new RowMutation(TABLE1, key + "x");
+        rm.add(new QueryPath(cfName, null, "0".getBytes()), new byte[0], 0);
+        rm.apply();
+        store.forceBlockingFlush();
+        store.doFileCompaction(sstablesIncomplete, Integer.MAX_VALUE);
         ColumnFamily cf = table.getColumnFamilyStore(cfName).getColumnFamily(new IdentityQueryFilter(key, new QueryPath(cfName)));
+        assert cf.getColumnCount() == 10;
+
+        // major compact and test that all columns but the resurrected one is completely gone
+        store.doFileCompaction(store.getSSTables(), Integer.MAX_VALUE);
+        cf = table.getColumnFamilyStore(cfName).getColumnFamily(new IdentityQueryFilter(key, new QueryPath(cfName)));
         assert cf.getColumnCount() == 1;
         assert cf.getColumn(String.valueOf(5).getBytes()) != null;
     }
