diff --git a/src/main/java/net/lingala/zip4j/tasks/AbstractAddFileToZipTask.java b/src/main/java/net/lingala/zip4j/tasks/AbstractAddFileToZipTask.java
index a2b17a0..dfb1385 100644
--- a/src/main/java/net/lingala/zip4j/tasks/AbstractAddFileToZipTask.java
+++ b/src/main/java/net/lingala/zip4j/tasks/AbstractAddFileToZipTask.java
@@ -102,8 +102,7 @@ public abstract class AbstractAddFileToZipTask<T> extends AsyncZipTask<T> {
 
       //If an entry already exists, we have to remove that entry first and then add content again.
       //In this case, add corresponding work
-      String relativeFileName = getRelativeFileName(fileToAdd.getAbsolutePath(), zipParameters.getDefaultFolderPath(),
-          zipParameters.getRootFolderNameInZip());
+      String relativeFileName = getRelativeFileName(fileToAdd.getAbsolutePath(), zipParameters);
       FileHeader fileHeader = getFileHeader(getZipModel(), relativeFileName);
       if (fileHeader != null) {
         totalWork += (getZipModel().getZipFile().length() - fileHeader.getCompressedSize());
@@ -165,8 +164,7 @@ public abstract class AbstractAddFileToZipTask<T> extends AsyncZipTask<T> {
     clonedZipParameters.setLastModifiedFileTime(fileToAdd.lastModified());
 
     if (!Zip4jUtil.isStringNotNullAndNotEmpty(zipParameters.getFileNameInZip())) {
-      String relativeFileName = getRelativeFileName(fileToAdd.getAbsolutePath(), zipParameters.getDefaultFolderPath(),
-          zipParameters.getRootFolderNameInZip());
+      String relativeFileName = getRelativeFileName(fileToAdd.getAbsolutePath(), zipParameters);
       clonedZipParameters.setFileNameInZip(relativeFileName);
     }
 
@@ -198,8 +196,7 @@ public abstract class AbstractAddFileToZipTask<T> extends AsyncZipTask<T> {
     }
 
     for (File file : files) {
-      String fileName = getRelativeFileName(file.getAbsolutePath(), zipParameters.getDefaultFolderPath(),
-          zipParameters.getRootFolderNameInZip());
+      String fileName = getRelativeFileName(file.getAbsolutePath(), zipParameters);
 
       FileHeader fileHeader = getFileHeader(zipModel, fileName);
       if (fileHeader != null) {
diff --git a/src/main/java/net/lingala/zip4j/util/FileUtils.java b/src/main/java/net/lingala/zip4j/util/FileUtils.java
index 5aa6311..ec1c118 100644
--- a/src/main/java/net/lingala/zip4j/util/FileUtils.java
+++ b/src/main/java/net/lingala/zip4j/util/FileUtils.java
@@ -2,6 +2,7 @@ package net.lingala.zip4j.util;
 
 import net.lingala.zip4j.exception.ZipException;
 import net.lingala.zip4j.model.ZipModel;
+import net.lingala.zip4j.model.ZipParameters;
 import net.lingala.zip4j.progress.ProgressMonitor;
 
 import java.io.File;
@@ -181,14 +182,13 @@ public class FileUtils {
     return splitZipFiles;
   }
 
-  public static String getRelativeFileName(String file, String rootFolderPath, String rootFolderNameInZip)
-      throws ZipException {
+  public static String getRelativeFileName(String fileToAdd, ZipParameters zipParameters) throws ZipException {
 
     String fileName;
     try {
-      String fileCanonicalPath = new File(file).getCanonicalPath();
-      if (isStringNotNullAndNotEmpty(rootFolderPath)) {
-        File rootFolderFile = new File(rootFolderPath);
+      String fileCanonicalPath = new File(fileToAdd).getCanonicalPath();
+      if (isStringNotNullAndNotEmpty(zipParameters.getDefaultFolderPath())) {
+        File rootFolderFile = new File(zipParameters.getDefaultFolderPath());
         String rootFolderFileRef = rootFolderFile.getCanonicalPath();
 
         if (!rootFolderFileRef.endsWith(FILE_SEPARATOR)) {
@@ -208,34 +208,41 @@ public class FileUtils {
         } else {
           String bkFileName = tmpFileName.substring(0, tmpFileName.lastIndexOf(tmpFile.getName()));
           bkFileName = bkFileName.replaceAll("\\\\", "/");
-          tmpFileName = bkFileName + tmpFile.getName();
+          tmpFileName = bkFileName + getNameOfFileInZip(tmpFile, zipParameters.getFileNameInZip());
         }
 
         fileName = tmpFileName;
       } else {
         File relFile = new File(fileCanonicalPath);
+        fileName = getNameOfFileInZip(relFile, zipParameters.getFileNameInZip());
         if (relFile.isDirectory()) {
-          fileName = relFile.getName() + ZIP_FILE_SEPARATOR;
-        } else {
-          fileName = relFile.getName();
+          fileName += ZIP_FILE_SEPARATOR;
         }
       }
     } catch (IOException e) {
       throw new ZipException(e);
     }
 
+    String rootFolderNameInZip = zipParameters.getRootFolderNameInZip();
     if (Zip4jUtil.isStringNotNullAndNotEmpty(rootFolderNameInZip)) {
       if (!rootFolderNameInZip.endsWith("\\") && !rootFolderNameInZip.endsWith("/")) {
         rootFolderNameInZip = rootFolderNameInZip + InternalZipConstants.FILE_SEPARATOR;
       }
 
-      rootFolderNameInZip = rootFolderNameInZip.replaceAll("\\\\", "/");
+      rootFolderNameInZip = rootFolderNameInZip.replaceAll("\\\\", ZIP_FILE_SEPARATOR);
       fileName = rootFolderNameInZip + fileName;
     }
 
     return fileName;
   }
 
+  private static String getNameOfFileInZip(File fileToAdd, String fileNameInZip) {
+    if (isStringNotNullAndNotEmpty(fileNameInZip)) {
+      return fileNameInZip;
+    }
+    return fileToAdd.getName();
+  }
+
   public static boolean isZipEntryDirectory(String fileNameInZip) {
     return fileNameInZip.endsWith("/") || fileNameInZip.endsWith("\\");
   }
diff --git a/src/main/java/net/lingala/zip4j/util/InternalZipConstants.java b/src/main/java/net/lingala/zip4j/util/InternalZipConstants.java
index f9bc38f..0f71307 100755
--- a/src/main/java/net/lingala/zip4j/util/InternalZipConstants.java
+++ b/src/main/java/net/lingala/zip4j/util/InternalZipConstants.java
@@ -16,6 +16,7 @@
 
 package net.lingala.zip4j.util;
 
+import java.io.File;
 import java.nio.charset.Charset;
 
 public final class InternalZipConstants {
@@ -48,7 +49,7 @@ public final class InternalZipConstants {
 
   public static final String ZIP_STANDARD_CHARSET = "Cp437";
 
-  public static final String FILE_SEPARATOR = System.getProperty("file.separator");
+  public static final String FILE_SEPARATOR = File.separator;
 
   public static final String ZIP_FILE_SEPARATOR = "/";
 
diff --git a/src/test/java/net/lingala/zip4j/CreateZipFileIT.java b/src/test/java/net/lingala/zip4j/CreateZipFileIT.java
index d73e421..0f964d6 100644
--- a/src/test/java/net/lingala/zip4j/CreateZipFileIT.java
+++ b/src/test/java/net/lingala/zip4j/CreateZipFileIT.java
@@ -268,6 +268,22 @@ public class CreateZipFileIT extends AbstractIT {
     testCreateZipFileWithFileEntryComment("测试中文_", Charset.forName("GBK"));
   }
 
+  @Test
+  public void testAddingSameFileMultipleTimesResultsInOnlyOneFileInZip() throws IOException {
+    ZipFile zipFile = new ZipFile(generatedZipFile);
+    ZipParameters zipParameters = new ZipParameters();
+    zipParameters.setFileNameInZip("renamed-file.pdf");
+
+    zipFile.addFile(getTestFileFromResources("sample.pdf"), zipParameters);
+    zipFile.addFile(getTestFileFromResources("sample.pdf"), zipParameters);
+    zipFile.addFile(getTestFileFromResources("sample.pdf"), zipParameters);
+
+    assertThat(zipFile.getFileHeaders()).hasSize(1);
+    assertThat(zipFile.getFileHeaders().get(0).getFileName()).isEqualTo("renamed-file.pdf");
+
+    verifyZipFileByExtractingAllFiles(generatedZipFile, null, outputFolder, 1, false);
+  }
+
   private void testCreateZipFileWithFileEntryComment(String fileCommentPrefix, Charset charset) throws IOException {
     ZipParameters zipParameters = new ZipParameters();
     ZipFile zipFile = initializeZipFileWithCharset(charset);
diff --git a/src/test/java/net/lingala/zip4j/util/FileUtilsTest.java b/src/test/java/net/lingala/zip4j/util/FileUtilsTest.java
index df2c38d..926d8e4 100644
--- a/src/test/java/net/lingala/zip4j/util/FileUtilsTest.java
+++ b/src/test/java/net/lingala/zip4j/util/FileUtilsTest.java
@@ -2,6 +2,7 @@ package net.lingala.zip4j.util;
 
 import net.lingala.zip4j.exception.ZipException;
 import net.lingala.zip4j.model.ZipModel;
+import net.lingala.zip4j.model.ZipParameters;
 import org.junit.Rule;
 import org.junit.Test;
 import org.junit.rules.ExpectedException;
@@ -15,6 +16,7 @@ import java.nio.file.attribute.FileTime;
 import java.nio.file.spi.FileSystemProvider;
 import java.util.List;
 
+import static net.lingala.zip4j.util.InternalZipConstants.FILE_SEPARATOR;
 import static org.assertj.core.api.Assertions.assertThat;
 import static org.mockito.Mockito.doThrow;
 import static org.mockito.Mockito.mock;
@@ -248,26 +250,58 @@ public class FileUtilsTest {
 
   @Test
   public void testGetRelativeFileNameWhenRootFoldersAreNull() throws ZipException {
-    assertThat(FileUtils.getRelativeFileName("somefile.txt", null, null)).isEqualTo("somefile.txt");
+    assertThat(FileUtils.getRelativeFileName("somefile.txt", new ZipParameters())).isEqualTo("somefile.txt");
   }
 
   @Test
   public void testGetRelativeFileWithRootFolderNameInZip() throws ZipException {
-    String expectedRootFolder = "rootfolder" + InternalZipConstants.FILE_SEPARATOR + "somefile.txt";
-    assertThat(FileUtils.getRelativeFileName("somefile.txt", null, "rootfolder")).isEqualTo(expectedRootFolder);
+    String expectetdFileName = "rootfolder" + FILE_SEPARATOR + "somefile.txt";
+    ZipParameters zipParameters = new ZipParameters();
+    zipParameters.setRootFolderNameInZip("rootfolder");
+    assertThat(FileUtils.getRelativeFileName("somefile.txt", zipParameters)).isEqualTo(expectetdFileName);
   }
 
   @Test
   public void testGetRelativeFileWithRootFolderNameInZipWithFileSeparator() throws ZipException {
-    String expectedRootFolder = "rootfolder" + InternalZipConstants.FILE_SEPARATOR + "somefile.txt";
-    assertThat(FileUtils.getRelativeFileName("somefile.txt", null, "rootfolder" + File.separator))
-        .isEqualTo(expectedRootFolder);
+    String expectetdFileName = "rootfolder" + FILE_SEPARATOR + "somefile.txt";
+    ZipParameters zipParameters = new ZipParameters();
+    zipParameters.setRootFolderNameInZip("rootfolder" + File.separator);
+    assertThat(FileUtils.getRelativeFileName("somefile.txt", zipParameters)).isEqualTo(expectetdFileName);
   }
 
   @Test
   public void testGetRelativeFileWithRootFolderNameInZipWithSeparatorsInName() throws ZipException {
-    String expectedRootFolder = "rootfolder" + InternalZipConstants.FILE_SEPARATOR + "somefile.txt";
-    assertThat(FileUtils.getRelativeFileName("somefile.txt", null, "rootfolder\\")).isEqualTo(expectedRootFolder);
+    String expectedRootFolder = "rootfolder" + FILE_SEPARATOR + "somefile.txt";
+    ZipParameters zipParameters = new ZipParameters();
+    zipParameters.setRootFolderNameInZip("rootfolder\\");
+    assertThat(FileUtils.getRelativeFileName("somefile.txt", zipParameters)).isEqualTo(expectedRootFolder);
+  }
+
+  @Test
+  public void testGetRelativeFileWithDifferentFileNameInZip() throws ZipException {
+    ZipParameters zipParameters = new ZipParameters();
+    zipParameters.setFileNameInZip("anotherName.txt");
+    assertThat(FileUtils.getRelativeFileName("somefile.txt", zipParameters)).isEqualTo("anotherName.txt");
+  }
+
+  @Test
+  public void testGetRelativeFileWithDifferentFileNameInZipAndRootFolderName() throws ZipException {
+    String expectedRootFolder = "rootfolder" + FILE_SEPARATOR + "anotherName.txt";
+    ZipParameters zipParameters = new ZipParameters();
+    zipParameters.setFileNameInZip("anotherName.txt");
+    zipParameters.setRootFolderNameInZip("rootfolder");
+    assertThat(FileUtils.getRelativeFileName("somefile.txt", zipParameters)).isEqualTo(expectedRootFolder);
+  }
+
+  @Test
+  public void testGetRelativeFileWithDifferentFileNameInZipAndRootFolderNameAndDefaultFolderPath() throws ZipException {
+    String expectedRootFolder = "rootfolder" + FILE_SEPARATOR + "anotherFolder" + FILE_SEPARATOR + "anotherName.txt";
+    ZipParameters zipParameters = new ZipParameters();
+    zipParameters.setFileNameInZip("anotherName.txt");
+    zipParameters.setDefaultFolderPath("defaultFolderPath");
+    zipParameters.setRootFolderNameInZip("rootfolder");
+    assertThat(FileUtils.getRelativeFileName("defaultFolderPath" + FILE_SEPARATOR + "anotherFolder" + FILE_SEPARATOR
+            + "somefile.txt", zipParameters)).isEqualTo(expectedRootFolder);
   }
 
   @Test
