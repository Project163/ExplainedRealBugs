diff --git a/src/main/java/net/lingala/zip4j/headers/HeaderWriter.java b/src/main/java/net/lingala/zip4j/headers/HeaderWriter.java
index 6b346f5..38d2533 100755
--- a/src/main/java/net/lingala/zip4j/headers/HeaderWriter.java
+++ b/src/main/java/net/lingala/zip4j/headers/HeaderWriter.java
@@ -60,7 +60,8 @@ public class HeaderWriter {
       rawIO.writeLongLittleEndian(longBuff, 0, localFileHeader.getLastModifiedTime());
       byteArrayOutputStream.write(longBuff, 0, 4);
 
-      rawIO.writeIntLittleEndian(byteArrayOutputStream, (int) localFileHeader.getCrc());
+      rawIO.writeLongLittleEndian(longBuff, 0, localFileHeader.getCrc());
+      byteArrayOutputStream.write(longBuff, 0, 4);
       long uncompressedSize = localFileHeader.getUncompressedSize();
 
       if (uncompressedSize >= ZIP_64_SIZE_LIMIT) {
@@ -150,7 +151,9 @@ public class HeaderWriter {
 
     try (ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream()) {
       rawIO.writeIntLittleEndian(byteArrayOutputStream, (int) HeaderSignature.EXTRA_DATA_RECORD.getValue());
-      rawIO.writeIntLittleEndian(byteArrayOutputStream, (int) localFileHeader.getCrc());
+
+      rawIO.writeLongLittleEndian(longBuff, 0, localFileHeader.getCrc());
+      byteArrayOutputStream.write(longBuff, 0, 4);
 
       if (localFileHeader.isWriteCompressedSizeInZip64ExtraRecord()) {
         rawIO.writeLongLittleEndian(byteArrayOutputStream, localFileHeader.getCompressedSize());
@@ -422,9 +425,12 @@ public class HeaderWriter {
       rawIO.writeShortLittleEndian(byteArrayOutputStream, fileHeader.getVersionNeededToExtract());
       byteArrayOutputStream.write(fileHeader.getGeneralPurposeFlag());
       rawIO.writeShortLittleEndian(byteArrayOutputStream, fileHeader.getCompressionMethod().getCode());
+
       rawIO.writeLongLittleEndian(longBuff, 0, fileHeader.getLastModifiedTime());
       byteArrayOutputStream.write(longBuff, 0, 4);
-      rawIO.writeIntLittleEndian(byteArrayOutputStream, (int) (fileHeader.getCrc()));
+
+      rawIO.writeLongLittleEndian(longBuff, 0, fileHeader.getCrc());
+      byteArrayOutputStream.write(longBuff, 0, 4);
 
       if (fileHeader.getCompressedSize() >= ZIP_64_SIZE_LIMIT || fileHeader.getUncompressedSize() >= ZIP_64_SIZE_LIMIT) {
         rawIO.writeLongLittleEndian(longBuff, 0, ZIP_64_SIZE_LIMIT);
diff --git a/src/main/java/net/lingala/zip4j/io/outputstream/ZipStandardCipherOutputStream.java b/src/main/java/net/lingala/zip4j/io/outputstream/ZipStandardCipherOutputStream.java
index 7c3651b..af1a41e 100644
--- a/src/main/java/net/lingala/zip4j/io/outputstream/ZipStandardCipherOutputStream.java
+++ b/src/main/java/net/lingala/zip4j/io/outputstream/ZipStandardCipherOutputStream.java
@@ -17,7 +17,7 @@ class ZipStandardCipherOutputStream extends CipherOutputStream<StandardEncrypter
   @Override
   protected StandardEncrypter initializeEncrypter(OutputStream outputStream, ZipParameters zipParameters, char[] password) throws IOException, ZipException {
     long key = getEncryptionKey(zipParameters);
-    StandardEncrypter encrypter = new StandardEncrypter(password, (key & 0x0000ffff) << 16);
+    StandardEncrypter encrypter = new StandardEncrypter(password, key);
     writeHeaders(encrypter.getHeaderBytes());
     return encrypter;
   }
@@ -39,9 +39,10 @@ class ZipStandardCipherOutputStream extends CipherOutputStream<StandardEncrypter
 
   private long getEncryptionKey(ZipParameters zipParameters) {
     if (zipParameters.isWriteExtendedLocalFileHeader()) {
-      return Zip4jUtil.javaToDosTime(zipParameters.getLastModifiedFileTime());
+      long dosTime = Zip4jUtil.javaToDosTime(zipParameters.getLastModifiedFileTime());
+      return (dosTime & 0x0000ffff) << 16;
     }
 
-    return zipParameters.getEntrySize();
+    return zipParameters.getEntryCRC();
   }
 }
diff --git a/src/main/java/net/lingala/zip4j/tasks/AbstractAddFileToZipTask.java b/src/main/java/net/lingala/zip4j/tasks/AbstractAddFileToZipTask.java
index 4264d4f..9affe8f 100644
--- a/src/main/java/net/lingala/zip4j/tasks/AbstractAddFileToZipTask.java
+++ b/src/main/java/net/lingala/zip4j/tasks/AbstractAddFileToZipTask.java
@@ -168,7 +168,7 @@ public abstract class AbstractAddFileToZipTask<T> extends AsyncZipTask<T> {
     } else {
       if (clonedZipParameters.isEncryptFiles() && clonedZipParameters.getEncryptionMethod() == ZIP_STANDARD) {
         progressMonitor.setCurrentTask(CALCULATE_CRC);
-        clonedZipParameters.setEntryCRC((int) computeFileCrc(fileToAdd, progressMonitor));
+        clonedZipParameters.setEntryCRC(computeFileCrc(fileToAdd, progressMonitor));
         progressMonitor.setCurrentTask(ADD_ENTRY);
       }
 
