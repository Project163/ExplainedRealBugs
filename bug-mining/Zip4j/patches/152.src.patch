diff --git a/src/main/java/net/lingala/zip4j/io/inputstream/ZipInputStream.java b/src/main/java/net/lingala/zip4j/io/inputstream/ZipInputStream.java
index c5fc7d0..dbc006c 100755
--- a/src/main/java/net/lingala/zip4j/io/inputstream/ZipInputStream.java
+++ b/src/main/java/net/lingala/zip4j/io/inputstream/ZipInputStream.java
@@ -152,10 +152,6 @@ public class ZipInputStream extends InputStream {
       return -1;
     }
 
-    if (localFileHeader.isDirectory()) {
-      return -1;
-    }
-
     try {
       int readLen = decompressedInputStream.read(b, off, len);
 
diff --git a/src/main/java/net/lingala/zip4j/io/outputstream/ZipOutputStream.java b/src/main/java/net/lingala/zip4j/io/outputstream/ZipOutputStream.java
index 33e7eee..a20beb0 100755
--- a/src/main/java/net/lingala/zip4j/io/outputstream/ZipOutputStream.java
+++ b/src/main/java/net/lingala/zip4j/io/outputstream/ZipOutputStream.java
@@ -20,6 +20,7 @@ import java.io.OutputStream;
 import java.nio.charset.Charset;
 import java.util.zip.CRC32;
 
+import static net.lingala.zip4j.util.FileUtils.isZipEntryDirectory;
 import static net.lingala.zip4j.util.InternalZipConstants.BUFF_SIZE;
 import static net.lingala.zip4j.util.InternalZipConstants.MIN_BUFF_SIZE;
 
@@ -72,12 +73,19 @@ public class ZipOutputStream extends OutputStream {
 
   public void putNextEntry(ZipParameters zipParameters) throws IOException {
     verifyZipParameters(zipParameters);
-    initializeAndWriteFileHeader(zipParameters);
+
+    ZipParameters clonedZipParameters = new ZipParameters(zipParameters);
+    if (isZipEntryDirectory(zipParameters.getFileNameInZip())) {
+      clonedZipParameters.setWriteExtendedLocalFileHeader(false);
+      clonedZipParameters.setCompressionMethod(CompressionMethod.STORE);
+      clonedZipParameters.setEncryptFiles(false);
+    }
+    initializeAndWriteFileHeader(clonedZipParameters);
 
     //Initialisation of below compressedOutputStream should happen after writing local file header
     //because local header data should be written first and then the encryption header data
     //and below initialisation writes encryption header data
-    compressedOutputStream = initializeCompressedOutputStream(zipParameters);
+    compressedOutputStream = initializeCompressedOutputStream(clonedZipParameters);
     this.entryClosed = false;
   }
 
@@ -220,7 +228,7 @@ public class ZipOutputStream extends OutputStream {
   private void verifyZipParameters(ZipParameters zipParameters) {
     if (zipParameters.getCompressionMethod() == CompressionMethod.STORE
         && zipParameters.getEntrySize() < 0
-        && !isEntryDirectory(zipParameters.getFileNameInZip())
+        && !isZipEntryDirectory(zipParameters.getFileNameInZip())
         && zipParameters.isWriteExtendedLocalFileHeader()) {
       throw new IllegalArgumentException("uncompressed size should be set for zip entries of compression type store");
     }
@@ -235,8 +243,4 @@ public class ZipOutputStream extends OutputStream {
 
     return fileHeader.getAesExtraDataRecord().getAesVersion().equals(AesVersion.ONE);
   }
-
-  private boolean isEntryDirectory(String entryName) {
-    return entryName.endsWith("/") || entryName.endsWith("\\");
-  }
 }
diff --git a/src/test/java/net/lingala/zip4j/io/inputstream/ZipInputStreamIT.java b/src/test/java/net/lingala/zip4j/io/inputstream/ZipInputStreamIT.java
index 649fbcd..959cad8 100644
--- a/src/test/java/net/lingala/zip4j/io/inputstream/ZipInputStreamIT.java
+++ b/src/test/java/net/lingala/zip4j/io/inputstream/ZipInputStreamIT.java
@@ -97,55 +97,55 @@ public class ZipInputStreamIT extends AbstractIT {
   @Test
   public void testExtractDeflateWithAesEncryption256AndV1() throws IOException {
     File createdZipFile = createZipFile(CompressionMethod.DEFLATE, true, EncryptionMethod.AES, AesKeyStrength.KEY_STRENGTH_256, PASSWORD, AesVersion.ONE);
-    extractZipFileWithInputStreams(createdZipFile, PASSWORD, InternalZipConstants.BUFF_SIZE, AesVersion.ONE);
+    extractZipFileWithInputStreams(createdZipFile, PASSWORD);
   }
 
   @Test
   public void testExtractWithReadLengthLessThan16WithAesAndStoreCompression() throws IOException {
     File createZipFile = createZipFile(CompressionMethod.STORE, true, EncryptionMethod.AES, AesKeyStrength.KEY_STRENGTH_256, PASSWORD);
-    extractZipFileWithInputStreams(createZipFile, PASSWORD, 15, AesVersion.TWO);
+    extractZipFileWithInputStreams(createZipFile, PASSWORD, 15);
   }
 
   @Test
   public void testExtractWithReadLengthLessThan16WithAesAndDeflateCompression() throws IOException {
     File createZipFile = createZipFile(CompressionMethod.DEFLATE, true, EncryptionMethod.AES, AesKeyStrength.KEY_STRENGTH_256, PASSWORD);
-    extractZipFileWithInputStreams(createZipFile, PASSWORD, 15, AesVersion.TWO);
+    extractZipFileWithInputStreams(createZipFile, PASSWORD, 15);
   }
 
   @Test
   public void testExtractWithReadLengthLessThan16WithZipCryptoAndStoreCompression() throws IOException {
     File createZipFile = createZipFile(CompressionMethod.DEFLATE, true, EncryptionMethod.ZIP_STANDARD, null, PASSWORD);
-    extractZipFileWithInputStreams(createZipFile, PASSWORD, 12, null);
+    extractZipFileWithInputStreams(createZipFile, PASSWORD, 12);
   }
 
   @Test
   public void testExtractWithReadLengthLessThan16WithZipCryptoAndDeflateCompression() throws IOException {
     File createZipFile = createZipFile(CompressionMethod.DEFLATE, true, EncryptionMethod.ZIP_STANDARD, null, PASSWORD);
-    extractZipFileWithInputStreams(createZipFile, PASSWORD, 5, null);
+    extractZipFileWithInputStreams(createZipFile, PASSWORD, 5);
   }
 
   @Test
   public void testExtractWithReadLengthGreaterThanButNotMultipleOf16WithAesAndStoreCompression() throws IOException {
     File createZipFile = createZipFile(CompressionMethod.STORE, true, EncryptionMethod.AES, AesKeyStrength.KEY_STRENGTH_256, PASSWORD);
-    extractZipFileWithInputStreams(createZipFile, PASSWORD, (16 * 4) + 1, AesVersion.TWO);
+    extractZipFileWithInputStreams(createZipFile, PASSWORD, (16 * 4) + 1);
   }
 
   @Test
   public void testExtractWithReadLengthGreaterThanButNotMultipleOf16WithAesAndDeflateCompression() throws IOException {
     File createZipFile = createZipFile(CompressionMethod.DEFLATE, true, EncryptionMethod.AES, AesKeyStrength.KEY_STRENGTH_256, PASSWORD);
-    extractZipFileWithInputStreams(createZipFile, PASSWORD, (16 * 8) - 10, AesVersion.TWO);
+    extractZipFileWithInputStreams(createZipFile, PASSWORD, (16 * 8) - 10);
   }
 
   @Test
   public void testExtractWithReadLengthGreaterThanButNotMultipleOf16WithZipCryptoAndStoreCompression() throws IOException {
     File createZipFile = createZipFile(CompressionMethod.DEFLATE, true, EncryptionMethod.ZIP_STANDARD, null, PASSWORD);
-    extractZipFileWithInputStreams(createZipFile, PASSWORD, (16 * 2) - 6, null);
+    extractZipFileWithInputStreams(createZipFile, PASSWORD, (16 * 2) - 6);
   }
 
   @Test
   public void testExtractWithReadLengthGreaterThanButNotMultipleOf16WithZipCryptoAndDeflateCompression() throws IOException {
     File createZipFile = createZipFile(CompressionMethod.DEFLATE, true, EncryptionMethod.ZIP_STANDARD, null, PASSWORD);
-    extractZipFileWithInputStreams(createZipFile, PASSWORD, (16 * 10) - 11, null);
+    extractZipFileWithInputStreams(createZipFile, PASSWORD, (16 * 10) - 11);
   }
 
   @Test
@@ -295,12 +295,22 @@ public class ZipInputStreamIT extends AbstractIT {
     }
   }
 
+  @Test
+  public void testExtractZipFileWithDirectoriesContainingExtendedLocalFileHeader() throws IOException {
+    extractZipFileWithInputStreams(TestUtils.getTestArchiveFromResources("dirs_with_extended_local_file_headers.zip"),
+        null, InternalZipConstants.BUFF_SIZE, false, 2);
+  }
+
   private void extractZipFileWithInputStreams(File zipFile, char[] password) throws IOException {
-    extractZipFileWithInputStreams(zipFile, password, 4096, AesVersion.TWO);
+    extractZipFileWithInputStreams(zipFile, password, InternalZipConstants.BUFF_SIZE);
   }
 
-  private void extractZipFileWithInputStreams(File zipFile, char[] password, int bufferLength, AesVersion aesVersion)
-      throws IOException {
+  private void extractZipFileWithInputStreams(File zipFile, char[] password, int bufferLength) throws IOException {
+    extractZipFileWithInputStreams(zipFile, password, bufferLength, true, FILES_TO_ADD.size());
+  }
+
+  private void extractZipFileWithInputStreams(File zipFile, char[] password, int bufferLength,
+                                              boolean verifyFileContents, int numberOfEntriesExpected) throws IOException {
     LocalFileHeader localFileHeader;
     int readLen;
     byte[] readBuffer = new byte[bufferLength];
@@ -316,13 +326,15 @@ public class ZipInputStreamIT extends AbstractIT {
             }
           }
           verifyLocalFileHeader(localFileHeader);
-          verifyFileContent(getTestFileFromResources(localFileHeader.getFileName()), extractedFile);
+          if (verifyFileContents) {
+            verifyFileContent(getTestFileFromResources(localFileHeader.getFileName()), extractedFile);
+          }
           numberOfEntriesExtracted++;
         }
       }
     }
 
-    assertThat(numberOfEntriesExtracted).isEqualTo(FILES_TO_ADD.size());
+    assertThat(numberOfEntriesExtracted).isEqualTo(numberOfEntriesExpected);
   }
 
   private void verifyLocalFileHeader(LocalFileHeader localFileHeader) {
diff --git a/src/test/java/net/lingala/zip4j/io/outputstream/ZipOutputStreamIT.java b/src/test/java/net/lingala/zip4j/io/outputstream/ZipOutputStreamIT.java
index 813c84d..776cde8 100644
--- a/src/test/java/net/lingala/zip4j/io/outputstream/ZipOutputStreamIT.java
+++ b/src/test/java/net/lingala/zip4j/io/outputstream/ZipOutputStreamIT.java
@@ -238,6 +238,21 @@ public class ZipOutputStreamIT extends AbstractIT {
     verifyZipFileByExtractingAllFiles(generatedZipFile, outputFolder, 1);
   }
 
+  @Test
+  public void testCreateZipFileWithDirectoriesAndExtendedLocalFileHeaderIsSuccessful() throws IOException {
+    try (ZipOutputStream zos = new ZipOutputStream(new FileOutputStream(generatedZipFile))) {
+      putNextEntryAndCloseEntry(zos, "dir1/");
+      putNextEntryAndCloseEntry(zos, "dir2/");
+    }
+
+    ZipFile zipFile = new ZipFile(generatedZipFile);
+    List<FileHeader> fileHeaders = zipFile.getFileHeaders();
+    for (FileHeader fileHeader : fileHeaders) {
+      assertThat(fileHeader.isDataDescriptorExists()).isFalse();
+    }
+    verifyZipFileByExtractingAllFiles(generatedZipFile, outputFolder, 2);
+  }
+
   private void testZipOutputStream(CompressionMethod compressionMethod, boolean encrypt,
                                    EncryptionMethod encryptionMethod, AesKeyStrength aesKeyStrength,
                                    AesVersion aesVersion)
@@ -434,4 +449,11 @@ public class ZipOutputStreamIT extends AbstractIT {
 
     return zipFile;
   }
+
+  private void putNextEntryAndCloseEntry(ZipOutputStream zipOutputStream, String fileName) throws IOException {
+    ZipParameters zipParameters = new ZipParameters();
+    zipParameters.setFileNameInZip(fileName);
+    zipOutputStream.putNextEntry(zipParameters);
+    zipOutputStream.closeEntry();
+  }
 }
diff --git a/src/test/java/net/lingala/zip4j/testutils/TestUtils.java b/src/test/java/net/lingala/zip4j/testutils/TestUtils.java
index 0f84fa0..da094ca 100644
--- a/src/test/java/net/lingala/zip4j/testutils/TestUtils.java
+++ b/src/test/java/net/lingala/zip4j/testutils/TestUtils.java
@@ -13,6 +13,7 @@ import java.io.IOException;
 import java.io.InputStream;
 import java.io.OutputStream;
 import java.io.UnsupportedEncodingException;
+import java.net.URL;
 import java.net.URLDecoder;
 import java.nio.file.Files;
 import java.nio.file.Path;
@@ -164,8 +165,11 @@ public class TestUtils {
   private static File getFileFromResources(String parentFolder, String fileName) {
     try {
       String path = "/" + parentFolder + "/" + fileName;
-      String utfDecodedFilePath = URLDecoder.decode(TestUtils.class.getResource(path).getFile(),
-          InternalZipConstants.CHARSET_UTF_8.toString());
+      URL fileUrl = TestUtils.class.getResource(path);
+      if (fileUrl == null) {
+        throw new RuntimeException("File not found " + path);
+      }
+      String utfDecodedFilePath = URLDecoder.decode(fileUrl.getFile(), InternalZipConstants.CHARSET_UTF_8.toString());
       return new File(utfDecodedFilePath);
     } catch (UnsupportedEncodingException e) {
       throw new RuntimeException(e);
diff --git a/src/test/resources/test-archives/dirs_with_extended_local_file_headers.zip b/src/test/resources/test-archives/dirs_with_extended_local_file_headers.zip
new file mode 100644
index 0000000..62cf4ba
Binary files /dev/null and b/src/test/resources/test-archives/dirs_with_extended_local_file_headers.zip differ
