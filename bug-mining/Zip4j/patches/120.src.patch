diff --git a/src/main/java/net/lingala/zip4j/headers/HeaderReader.java b/src/main/java/net/lingala/zip4j/headers/HeaderReader.java
index 5bccf40..39f26b1 100755
--- a/src/main/java/net/lingala/zip4j/headers/HeaderReader.java
+++ b/src/main/java/net/lingala/zip4j/headers/HeaderReader.java
@@ -202,11 +202,11 @@ public class HeaderReader {
         }
 
         fileHeader.setFileName(fileName);
-        fileHeader.setDirectory(fileName.endsWith("/") || fileName.endsWith("\\"));
       } else {
         fileHeader.setFileName(null);
       }
 
+      fileHeader.setDirectory(isDirectory(fileHeader.getExternalFileAttributes(), fileHeader.getFileName()));
       readExtraDataRecords(zip4jRaf, fileHeader);
       readZip64ExtendedInfo(fileHeader, rawIO);
       readAesExtraDataRecord(fileHeader, rawIO);
@@ -750,4 +750,17 @@ public class HeaderReader {
       return null;
     }
   }
+
+  public boolean isDirectory(byte[] externalFileAttributes, String fileName) {
+    // first check if DOS attributes are set (lower order bytes from external attributes). If yes, check if the 4th bit
+    // which represents a directory is set. If UNIX attributes are set (higher order two bytes), check for the 6th bit
+    // in 4th byte which  represents a directory flag.
+    if (externalFileAttributes[0] != 0 && isBitSet(externalFileAttributes[0], 4)) {
+      return true;
+    } else if (externalFileAttributes[3] != 0 && isBitSet(externalFileAttributes[3], 6))  {
+      return true;
+    }
+
+    return fileName != null && (fileName.endsWith("/") || fileName.endsWith("\\"));
+  }
 }
diff --git a/src/main/java/net/lingala/zip4j/io/inputstream/ZipInputStream.java b/src/main/java/net/lingala/zip4j/io/inputstream/ZipInputStream.java
index fea6922..d4ddb06 100755
--- a/src/main/java/net/lingala/zip4j/io/inputstream/ZipInputStream.java
+++ b/src/main/java/net/lingala/zip4j/io/inputstream/ZipInputStream.java
@@ -94,6 +94,10 @@ public class ZipInputStream extends InputStream {
       localFileHeader.setCrc(fileHeader.getCrc());
       localFileHeader.setCompressedSize(fileHeader.getCompressedSize());
       localFileHeader.setUncompressedSize(fileHeader.getUncompressedSize());
+      // file header's directory flag is more reliable than local file header's directory flag as file header has
+      // additional external file attributes which has a directory flag defined. In local file header, the only way
+      // to determine if an entry is directory is to check if the file name has a trailing forward slash "/"
+      localFileHeader.setDirectory(fileHeader.isDirectory());
       canSkipExtendedLocalFileHeader = true;
     } else {
       canSkipExtendedLocalFileHeader = false;
diff --git a/src/main/java/net/lingala/zip4j/util/FileUtils.java b/src/main/java/net/lingala/zip4j/util/FileUtils.java
index d6bfe11..b7f7adf 100644
--- a/src/main/java/net/lingala/zip4j/util/FileUtils.java
+++ b/src/main/java/net/lingala/zip4j/util/FileUtils.java
@@ -232,11 +232,11 @@ public class FileUtils {
         File tmpFile = new File(fileCanonicalPath);
 
         if (tmpFile.isDirectory()) {
-          tmpFileName = tmpFileName.replaceAll("\\\\", "/");
+          tmpFileName = tmpFileName.replaceAll("\\\\", ZIP_FILE_SEPARATOR);
           tmpFileName += ZIP_FILE_SEPARATOR;
         } else {
           String bkFileName = tmpFileName.substring(0, tmpFileName.lastIndexOf(tmpFile.getName()));
-          bkFileName = bkFileName.replaceAll("\\\\", "/");
+          bkFileName = bkFileName.replaceAll("\\\\", ZIP_FILE_SEPARATOR);
           tmpFileName = bkFileName + getNameOfFileInZip(tmpFile, zipParameters.getFileNameInZip());
         }
 
@@ -493,6 +493,7 @@ public class FileUtils {
       windowsAttribute = setBitIfApplicable(dosFileAttributes.isReadOnly(), windowsAttribute, 0);
       windowsAttribute = setBitIfApplicable(dosFileAttributes.isHidden(), windowsAttribute, 1);
       windowsAttribute = setBitIfApplicable(dosFileAttributes.isSystem(), windowsAttribute, 2);
+      windowsAttribute = setBitIfApplicable(dosFileAttributes.isDirectory(), windowsAttribute, 4);
       windowsAttribute = setBitIfApplicable(dosFileAttributes.isArchive(), windowsAttribute, 5);
       fileAttributes[0] = windowsAttribute;
     } catch (IOException e) {
diff --git a/src/test/java/net/lingala/zip4j/util/FileUtilsTestWindows.java b/src/test/java/net/lingala/zip4j/util/FileUtilsTestWindows.java
index 19a5255..f2f68bb 100644
--- a/src/test/java/net/lingala/zip4j/util/FileUtilsTestWindows.java
+++ b/src/test/java/net/lingala/zip4j/util/FileUtilsTestWindows.java
@@ -102,6 +102,15 @@ public class FileUtilsTestWindows {
 
   @Test
   public void testGetFileAttributesReturnsAttributesAsDefined() throws IOException {
+    testGetFileAttributes(false);
+  }
+
+  @Test
+  public void testGetFileAttributesForDirectory() throws IOException {
+    testGetFileAttributes(true);
+  }
+
+  private void testGetFileAttributes(boolean isDirectory) throws IOException {
     File file = mock(File.class);
     Path path = mock(Path.class);
     when(file.toPath()).thenReturn(path);
@@ -113,12 +122,17 @@ public class FileUtilsTestWindows {
     when(dosFileAttributes.isHidden()).thenReturn(true);
     when(dosFileAttributes.isSystem()).thenReturn(true);
     when(dosFileAttributes.isArchive()).thenReturn(true);
+    if (isDirectory) {
+      when(dosFileAttributes.isDirectory()).thenReturn(isDirectory);
+    }
+
 
     byte[] attributes = FileUtils.getFileAttributes(file);
 
     assertThat(isBitSet(attributes[0], 0)).isTrue();
     assertThat(isBitSet(attributes[0], 1)).isTrue();
     assertThat(isBitSet(attributes[0], 2)).isTrue();
+    assertThat(isBitSet(attributes[0], 4)).isEqualTo(isDirectory);
     assertThat(isBitSet(attributes[0], 5)).isTrue();
   }
 
