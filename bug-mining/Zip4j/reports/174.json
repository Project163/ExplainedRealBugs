{"url":"https://api.github.com/repos/srikanth-lingala/zip4j/issues/410","repository_url":"https://api.github.com/repos/srikanth-lingala/zip4j","labels_url":"https://api.github.com/repos/srikanth-lingala/zip4j/issues/410/labels{/name}","comments_url":"https://api.github.com/repos/srikanth-lingala/zip4j/issues/410/comments","events_url":"https://api.github.com/repos/srikanth-lingala/zip4j/issues/410/events","html_url":"https://github.com/srikanth-lingala/zip4j/issues/410","id":1163814970,"node_id":"I_kwDOCwUnhM5FXmg6","number":410,"title":"How to correctly add empty folder entries with ZipOutputStream","user":{"login":"daghendrik","id":1830026,"node_id":"MDQ6VXNlcjE4MzAwMjY=","avatar_url":"https://avatars.githubusercontent.com/u/1830026?v=4","gravatar_id":"","url":"https://api.github.com/users/daghendrik","html_url":"https://github.com/daghendrik","followers_url":"https://api.github.com/users/daghendrik/followers","following_url":"https://api.github.com/users/daghendrik/following{/other_user}","gists_url":"https://api.github.com/users/daghendrik/gists{/gist_id}","starred_url":"https://api.github.com/users/daghendrik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/daghendrik/subscriptions","organizations_url":"https://api.github.com/users/daghendrik/orgs","repos_url":"https://api.github.com/users/daghendrik/repos","events_url":"https://api.github.com/users/daghendrik/events{/privacy}","received_events_url":"https://api.github.com/users/daghendrik/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1347122727,"node_id":"MDU6TGFiZWwxMzQ3MTIyNzI3","url":"https://api.github.com/repos/srikanth-lingala/zip4j/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":1623761937,"node_id":"MDU6TGFiZWwxNjIzNzYxOTM3","url":"https://api.github.com/repos/srikanth-lingala/zip4j/labels/resolved","name":"resolved","color":"b8dd11","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"srikanth-lingala","id":3450302,"node_id":"MDQ6VXNlcjM0NTAzMDI=","avatar_url":"https://avatars.githubusercontent.com/u/3450302?v=4","gravatar_id":"","url":"https://api.github.com/users/srikanth-lingala","html_url":"https://github.com/srikanth-lingala","followers_url":"https://api.github.com/users/srikanth-lingala/followers","following_url":"https://api.github.com/users/srikanth-lingala/following{/other_user}","gists_url":"https://api.github.com/users/srikanth-lingala/gists{/gist_id}","starred_url":"https://api.github.com/users/srikanth-lingala/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/srikanth-lingala/subscriptions","organizations_url":"https://api.github.com/users/srikanth-lingala/orgs","repos_url":"https://api.github.com/users/srikanth-lingala/repos","events_url":"https://api.github.com/users/srikanth-lingala/events{/privacy}","received_events_url":"https://api.github.com/users/srikanth-lingala/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"srikanth-lingala","id":3450302,"node_id":"MDQ6VXNlcjM0NTAzMDI=","avatar_url":"https://avatars.githubusercontent.com/u/3450302?v=4","gravatar_id":"","url":"https://api.github.com/users/srikanth-lingala","html_url":"https://github.com/srikanth-lingala","followers_url":"https://api.github.com/users/srikanth-lingala/followers","following_url":"https://api.github.com/users/srikanth-lingala/following{/other_user}","gists_url":"https://api.github.com/users/srikanth-lingala/gists{/gist_id}","starred_url":"https://api.github.com/users/srikanth-lingala/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/srikanth-lingala/subscriptions","organizations_url":"https://api.github.com/users/srikanth-lingala/orgs","repos_url":"https://api.github.com/users/srikanth-lingala/repos","events_url":"https://api.github.com/users/srikanth-lingala/events{/privacy}","received_events_url":"https://api.github.com/users/srikanth-lingala/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":2,"created_at":"2022-03-09T11:24:43Z","updated_at":"2022-03-28T15:14:29Z","closed_at":"2022-03-28T15:14:29Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I'm getting \"Error 79 - Inappropriate file type or format.\" on macOS Montery if I try to extract a file that's created using ZipOutPutStream and that contains empty folders. \r\n\r\nOn Windows 11, using the built in Zip utility, no error is shown. When using 7zip on Windows, the files and folders are successfully extracted, but 7zip warns me about \"Header errors\". On Mac, I was able to successfully extract the empty folders using a tool called \"The Unarchiver\".\r\n\r\nI'm not sure if I'm adding the empty folder zip entries correct. Basically, I'm just looping over all the empty folders that should be added to the zip first, and then, in a secondary loop, I'm adding all the actual files.\r\n\r\nA folder is added like this, where the filename is the folder path with a trailing \"/\":\r\n```\r\nzipParameters.setFileNameInZip(\"/20220310T0800 - 75 - test/1 - Presenter - test/\"));\r\n```\r\n\r\nRelevant part of the code:\r\n```\r\n  .....\r\n\r\n  ByteArrayOutputStream bos = new ByteArrayOutputStream();\r\n  try(ZipOutputStream zos = initializeZipOutputStream(bos, input.isEncryptZip(), password )) {\r\n\r\n      // Add all empty folders first\r\n      for (String emptyFolder : emptyFolders){\r\n          zipParameters.setFileNameInZip(emptyFolder);\r\n          zos.putNextEntry(zipParameters);\r\n          zos.closeEntry();\r\n      }\r\n\r\n      ..... loop adding actual files here (code removed. Is just like the example in the readme).\r\n\r\n      // closing the stream and uploading to AWS S3\r\n      zos.close();\r\n      s3Client.putObject(putObjectRequest, RequestBody.fromBytes(bos.toByteArray()));\r\n  }\r\n\r\n  .....\r\n\r\n```\r\n\r\nAttached an example Zip generated by Zip4j with one empty folder and one folder with a file. \r\n\r\n[futureconf2021-20220309T1159AM.zip](https://github.com/srikanth-lingala/zip4j/files/8214041/futureconf2021-20220309T1159AM.zip)\r\n","closed_by":{"login":"srikanth-lingala","id":3450302,"node_id":"MDQ6VXNlcjM0NTAzMDI=","avatar_url":"https://avatars.githubusercontent.com/u/3450302?v=4","gravatar_id":"","url":"https://api.github.com/users/srikanth-lingala","html_url":"https://github.com/srikanth-lingala","followers_url":"https://api.github.com/users/srikanth-lingala/followers","following_url":"https://api.github.com/users/srikanth-lingala/following{/other_user}","gists_url":"https://api.github.com/users/srikanth-lingala/gists{/gist_id}","starred_url":"https://api.github.com/users/srikanth-lingala/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/srikanth-lingala/subscriptions","organizations_url":"https://api.github.com/users/srikanth-lingala/orgs","repos_url":"https://api.github.com/users/srikanth-lingala/repos","events_url":"https://api.github.com/users/srikanth-lingala/events{/privacy}","received_events_url":"https://api.github.com/users/srikanth-lingala/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/srikanth-lingala/zip4j/issues/410/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/srikanth-lingala/zip4j/issues/410/timeline","performed_via_github_app":null,"state_reason":"completed"}