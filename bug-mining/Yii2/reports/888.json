{"url":"https://api.github.com/repos/yiisoft/yii2/issues/19911","repository_url":"https://api.github.com/repos/yiisoft/yii2","labels_url":"https://api.github.com/repos/yiisoft/yii2/issues/19911/labels{/name}","comments_url":"https://api.github.com/repos/yiisoft/yii2/issues/19911/comments","events_url":"https://api.github.com/repos/yiisoft/yii2/issues/19911/events","html_url":"https://github.com/yiisoft/yii2/issues/19911","id":1820571617,"node_id":"I_kwDOADRbGc5sg7fh","number":19911,"title":"Allow ActiveRecord::getAttributeLabel() to override labels of deeply nested relations","user":{"login":"PowerGamer1","id":8275897,"node_id":"MDQ6VXNlcjgyNzU4OTc=","avatar_url":"https://avatars.githubusercontent.com/u/8275897?v=4","gravatar_id":"","url":"https://api.github.com/users/PowerGamer1","html_url":"https://github.com/PowerGamer1","followers_url":"https://api.github.com/users/PowerGamer1/followers","following_url":"https://api.github.com/users/PowerGamer1/following{/other_user}","gists_url":"https://api.github.com/users/PowerGamer1/gists{/gist_id}","starred_url":"https://api.github.com/users/PowerGamer1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/PowerGamer1/subscriptions","organizations_url":"https://api.github.com/users/PowerGamer1/orgs","repos_url":"https://api.github.com/users/PowerGamer1/repos","events_url":"https://api.github.com/users/PowerGamer1/events{/privacy}","received_events_url":"https://api.github.com/users/PowerGamer1/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/yiisoft/yii2/milestones/71","html_url":"https://github.com/yiisoft/yii2/milestone/71","labels_url":"https://api.github.com/repos/yiisoft/yii2/milestones/71/labels","id":9418758,"node_id":"MI_kwDOADRbGc4Aj7gG","number":71,"title":"2.0.49","description":"","creator":{"login":"samdark","id":47294,"node_id":"MDQ6VXNlcjQ3Mjk0","avatar_url":"https://avatars.githubusercontent.com/u/47294?v=4","gravatar_id":"","url":"https://api.github.com/users/samdark","html_url":"https://github.com/samdark","followers_url":"https://api.github.com/users/samdark/followers","following_url":"https://api.github.com/users/samdark/following{/other_user}","gists_url":"https://api.github.com/users/samdark/gists{/gist_id}","starred_url":"https://api.github.com/users/samdark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samdark/subscriptions","organizations_url":"https://api.github.com/users/samdark/orgs","repos_url":"https://api.github.com/users/samdark/repos","events_url":"https://api.github.com/users/samdark/events{/privacy}","received_events_url":"https://api.github.com/users/samdark/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":33,"state":"closed","created_at":"2023-05-20T16:24:55Z","updated_at":"2023-08-29T14:18:03Z","due_on":null,"closed_at":"2023-08-29T14:18:03Z"},"comments":0,"created_at":"2023-07-25T15:14:51Z","updated_at":"2023-08-26T03:06:54Z","closed_at":"2023-08-26T03:06:54Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"The `ActiveRecord::getAttributeLabel()` method is able to fetch labels from related models. The documentation for this method is unclear and the current behaviour of this method leads to inconsistency in its handling of labels for attributes of related model overridden in primary model depending on how deeply relations are nested.\r\n\r\nFor example:\r\n```PHP\r\nclass OrderItem extends \\yii\\db\\ActiveRecord\r\n{\r\n    public function attributeLabels()\r\n    {\r\n        return [\r\n            'order.id' => 'Order ID',\r\n// Currently have to define the same label already defined in `Order` model \r\n// to get correct label value of 'Customer name' for $orderItem->getAttributeLabel('order.customer.name').\r\n//            'order.customer.name' => 'Customer name', \r\n        ];\r\n    }\r\n    public function getOrder()\r\n    {\r\n        return $this->hasOne(Order::class, [/*...*/]);\r\n    }\r\n}\r\n\r\nclass Order extends \\yii\\db\\ActiveRecord\r\n{\r\n    public function attributeLabels()\r\n    {\r\n        return [\r\n            'id' => 'ID',\r\n            'customer.name' => 'Customer name',\r\n        ];\r\n    }\r\n    public function getCustomer()\r\n    {\r\n        return $this->hasOne(Customer::class, [/*...*/]);\r\n    }\r\n}\r\n\r\nclass Customer extends \\yii\\db\\ActiveRecord\r\n{\r\n    public function attributeLabels()\r\n    {\r\n        return [\r\n            'name' => 'Name',\r\n        ];\r\n    }\r\n}\r\n\r\n\r\nvar_dump($orderItem->getAttributeLabel('order.id')); // Line (1)\r\n// Returns 'Order ID' - overridden label from primary model `OrderItem` instead of 'ID' from related model `Order`.\r\n\r\nvar_dump($orderItem->getAttributeLabel('order.customer.name'); // Line (2)\r\n // Returns 'Name' - from related model 'Customer' instead of overridden label 'Customer name' from primary model `Order`.\r\n```\r\n\r\nLets say `ActiveRecord::getAttributeLabel()` allows overridding in primary model labels for attributes of related model. Then for the example above:\r\n- line (1) - ok;\r\n- line (2) - BUG.\r\n\r\nAnd vice versa, if such override is not allowed:\r\n- line (1) - BUG;\r\n- line (2) - ok.\r\n\r\nSince having the ability to override the labels in primary model for all levels of nesting is actually useful (as illustrated by the example above) the fact it does not work for deeply nested relations should be treated as a bug and fixed.\r\n\r\n### Additional info\r\n\r\n| Q                | A\r\n| ---------------- | ---\r\n| Yii version      | 2.0.48.1\r\n","closed_by":{"login":"samdark","id":47294,"node_id":"MDQ6VXNlcjQ3Mjk0","avatar_url":"https://avatars.githubusercontent.com/u/47294?v=4","gravatar_id":"","url":"https://api.github.com/users/samdark","html_url":"https://github.com/samdark","followers_url":"https://api.github.com/users/samdark/followers","following_url":"https://api.github.com/users/samdark/following{/other_user}","gists_url":"https://api.github.com/users/samdark/gists{/gist_id}","starred_url":"https://api.github.com/users/samdark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samdark/subscriptions","organizations_url":"https://api.github.com/users/samdark/orgs","repos_url":"https://api.github.com/users/samdark/repos","events_url":"https://api.github.com/users/samdark/events{/privacy}","received_events_url":"https://api.github.com/users/samdark/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/yiisoft/yii2/issues/19911/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/yiisoft/yii2/issues/19911/timeline","performed_via_github_app":null,"state_reason":"completed"}