{"url":"https://api.github.com/repos/yiisoft/yii2/issues/18203","repository_url":"https://api.github.com/repos/yiisoft/yii2","labels_url":"https://api.github.com/repos/yiisoft/yii2/issues/18203/labels{/name}","comments_url":"https://api.github.com/repos/yiisoft/yii2/issues/18203/comments","events_url":"https://api.github.com/repos/yiisoft/yii2/issues/18203/events","html_url":"https://github.com/yiisoft/yii2/issues/18203","id":667022462,"node_id":"MDU6SXNzdWU2NjcwMjI0NjI=","number":18203,"title":"Yii2 butchers SQLSTATE error in \\yii\\db\\Exception","user":{"login":"PowerGamer1","id":8275897,"node_id":"MDQ6VXNlcjgyNzU4OTc=","avatar_url":"https://avatars.githubusercontent.com/u/8275897?v=4","gravatar_id":"","url":"https://api.github.com/users/PowerGamer1","html_url":"https://github.com/PowerGamer1","followers_url":"https://api.github.com/users/PowerGamer1/followers","following_url":"https://api.github.com/users/PowerGamer1/following{/other_user}","gists_url":"https://api.github.com/users/PowerGamer1/gists{/gist_id}","starred_url":"https://api.github.com/users/PowerGamer1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/PowerGamer1/subscriptions","organizations_url":"https://api.github.com/users/PowerGamer1/orgs","repos_url":"https://api.github.com/users/PowerGamer1/repos","events_url":"https://api.github.com/users/PowerGamer1/events{/privacy}","received_events_url":"https://api.github.com/users/PowerGamer1/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":33208443,"node_id":"MDU6TGFiZWwzMzIwODQ0Mw==","url":"https://api.github.com/repos/yiisoft/yii2/labels/type:bug","name":"type:bug","color":"e102d8","default":false,"description":"Bug"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/yiisoft/yii2/milestones/54","html_url":"https://github.com/yiisoft/yii2/milestone/54","labels_url":"https://api.github.com/repos/yiisoft/yii2/milestones/54/labels","id":5612722,"node_id":"MDk6TWlsZXN0b25lNTYxMjcyMg==","number":54,"title":"2.0.37","description":"","creator":{"login":"samdark","id":47294,"node_id":"MDQ6VXNlcjQ3Mjk0","avatar_url":"https://avatars.githubusercontent.com/u/47294?v=4","gravatar_id":"","url":"https://api.github.com/users/samdark","html_url":"https://github.com/samdark","followers_url":"https://api.github.com/users/samdark/followers","following_url":"https://api.github.com/users/samdark/following{/other_user}","gists_url":"https://api.github.com/users/samdark/gists{/gist_id}","starred_url":"https://api.github.com/users/samdark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samdark/subscriptions","organizations_url":"https://api.github.com/users/samdark/orgs","repos_url":"https://api.github.com/users/samdark/repos","events_url":"https://api.github.com/users/samdark/events{/privacy}","received_events_url":"https://api.github.com/users/samdark/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":31,"state":"closed","created_at":"2020-07-02T18:17:24Z","updated_at":"2020-08-07T20:14:37Z","due_on":null,"closed_at":"2020-08-07T20:14:37Z"},"comments":9,"created_at":"2020-07-28T12:10:28Z","updated_at":"2022-06-22T15:41:54Z","closed_at":"2020-08-05T14:06:30Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### What steps will reproduce the problem?\r\n```PHP\r\n// Execute under MySQL.\r\ntry\r\n{\r\n\t\\Yii::$app->getDb()->createCommand('SELECT * FROM does_not_exist')->execute();\r\n}\r\ncatch(\\yii\\db\\Exception $e)\r\n{\r\n\tvar_dump($e->getCode());\r\n\tdie;\r\n}\r\n```\r\n\r\n### What is the expected result?\r\nWhen executed under MySQL:\r\n42S02\r\n\r\n### What do you get instead?\r\n42\r\n\r\n### Additional info\r\nSQLSTATE value is NOT an integer! It can contain letter characters! This fact is correctly handled by PHP (PDOException::getCode() returns a string):\r\n\r\nhttps://www.php.net/manual/en/class.pdoexception.php#pdoexception.props.code\r\n> *code*\r\n>     SQLSTATE error code. Use Exception::getCode() to access it. \r\n\r\nhttps://www.php.net/manual/en/exception.getcode.php\r\n> Returns the exception code as integer in Exception but possibly as other type in Exception descendants (for example as string in PDOException). \r\n\r\nBut for some reason Yii2 decided it would be a good idea to just convert this string code with letters to integer completely butchering its value in the process (in yii2\\db\\Schema.php):\r\n```PHP\r\n    public function convertException(\\Exception $e, $rawSql)\r\n    {\r\n        // ...\r\n        return new $exceptionClass($message, $errorInfo, (int)$e->getCode(), $e);\r\n    }\r\n```\r\nThis needs to be fixed ASAP.\r\n\r\n\r\n| Q                | A\r\n| ---------------- | ---\r\n| Yii version      | 2.0.32\r\n| PHP version      | 7.4.3\r\n| Operating system |Windows 10\r\n","closed_by":{"login":"samdark","id":47294,"node_id":"MDQ6VXNlcjQ3Mjk0","avatar_url":"https://avatars.githubusercontent.com/u/47294?v=4","gravatar_id":"","url":"https://api.github.com/users/samdark","html_url":"https://github.com/samdark","followers_url":"https://api.github.com/users/samdark/followers","following_url":"https://api.github.com/users/samdark/following{/other_user}","gists_url":"https://api.github.com/users/samdark/gists{/gist_id}","starred_url":"https://api.github.com/users/samdark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samdark/subscriptions","organizations_url":"https://api.github.com/users/samdark/orgs","repos_url":"https://api.github.com/users/samdark/repos","events_url":"https://api.github.com/users/samdark/events{/privacy}","received_events_url":"https://api.github.com/users/samdark/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/yiisoft/yii2/issues/18203/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/yiisoft/yii2/issues/18203/timeline","performed_via_github_app":null,"state_reason":"completed"}