{"url":"https://api.github.com/repos/yiisoft/yii2/issues/18483","repository_url":"https://api.github.com/repos/yiisoft/yii2","labels_url":"https://api.github.com/repos/yiisoft/yii2/issues/18483/labels{/name}","comments_url":"https://api.github.com/repos/yiisoft/yii2/issues/18483/comments","events_url":"https://api.github.com/repos/yiisoft/yii2/issues/18483/events","html_url":"https://github.com/yiisoft/yii2/issues/18483","id":785146606,"node_id":"MDU6SXNzdWU3ODUxNDY2MDY=","number":18483,"title":"Feature request: db event names in yii\\log\\Logger and yii\\debug\\panels\\DbPanel","user":{"login":"atiline","id":72824678,"node_id":"MDQ6VXNlcjcyODI0Njc4","avatar_url":"https://avatars.githubusercontent.com/u/72824678?v=4","gravatar_id":"","url":"https://api.github.com/users/atiline","html_url":"https://github.com/atiline","followers_url":"https://api.github.com/users/atiline/followers","following_url":"https://api.github.com/users/atiline/following{/other_user}","gists_url":"https://api.github.com/users/atiline/gists{/gist_id}","starred_url":"https://api.github.com/users/atiline/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/atiline/subscriptions","organizations_url":"https://api.github.com/users/atiline/orgs","repos_url":"https://api.github.com/users/atiline/repos","events_url":"https://api.github.com/users/atiline/events{/privacy}","received_events_url":"https://api.github.com/users/atiline/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":33330247,"node_id":"MDU6TGFiZWwzMzMzMDI0Nw==","url":"https://api.github.com/repos/yiisoft/yii2/labels/status:ready%20for%20adoption","name":"status:ready for adoption","color":"02e10c","default":false,"description":"Feel free to implement this issue."},{"id":33332028,"node_id":"MDU6TGFiZWwzMzMzMjAyOA==","url":"https://api.github.com/repos/yiisoft/yii2/labels/type:enhancement","name":"type:enhancement","color":"d7e102","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/yiisoft/yii2/milestones/61","html_url":"https://github.com/yiisoft/yii2/milestone/61","labels_url":"https://api.github.com/repos/yiisoft/yii2/milestones/61/labels","id":6240935,"node_id":"MDk6TWlsZXN0b25lNjI0MDkzNQ==","number":61,"title":"2.0.41","description":"","creator":{"login":"samdark","id":47294,"node_id":"MDQ6VXNlcjQ3Mjk0","avatar_url":"https://avatars.githubusercontent.com/u/47294?v=4","gravatar_id":"","url":"https://api.github.com/users/samdark","html_url":"https://github.com/samdark","followers_url":"https://api.github.com/users/samdark/followers","following_url":"https://api.github.com/users/samdark/following{/other_user}","gists_url":"https://api.github.com/users/samdark/gists{/gist_id}","starred_url":"https://api.github.com/users/samdark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samdark/subscriptions","organizations_url":"https://api.github.com/users/samdark/orgs","repos_url":"https://api.github.com/users/samdark/repos","events_url":"https://api.github.com/users/samdark/events{/privacy}","received_events_url":"https://api.github.com/users/samdark/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":51,"state":"closed","created_at":"2020-12-23T15:46:03Z","updated_at":"2021-04-27T20:58:58Z","due_on":null,"closed_at":"2021-03-03T21:53:13Z"},"comments":6,"created_at":"2021-01-13T14:22:02Z","updated_at":"2021-01-14T16:15:15Z","closed_at":"2021-01-14T16:15:15Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Feature request\r\n\r\nHi!\r\n\r\nI am using Doctrine ORM with Yii2.\r\nNow I want to add SQL logging to Yii2 default Logger and Debug panel. I create own Doctrine SqlLogger and use `\\Yii::beginProfile()` and `\\Yii::endProfile()` to create profiling.\r\n\r\nI want SQL events to be displayed in the default Debug panel (in DB section) and Logs.\r\n\r\nBy default, `yii\\log\\Logger` and `yii\\debug\\panels\\DbPanel` have similar functions to find out if an event is from DB category or not:\r\n\r\n`yii\\log\\Logger`:\r\n```php\r\npublic function getProfileLogs()\r\n{\r\n    return $this->getLogMessages(Logger::LEVEL_PROFILE, ['yii\\db\\Command::query', 'yii\\db\\Command::execute']);\r\n}\r\n```\r\n\r\nand\r\n\r\n`yii\\debug\\panels\\DbPanel`:\r\n```php\r\npublic function getDbProfiling()\r\n{\r\n    $timings = $this->getProfiling(['yii\\db\\Command::query', 'yii\\db\\Command::execute']);\r\n    $count = count($timings);\r\n    $time = 0;\r\n    foreach ($timings as $timing) {\r\n        $time += $timing['duration'];\r\n    }\r\n    return [$count, $time];\r\n}\r\n```\r\n\r\nTo overwrite these methods I have to create my own classes and add them to DI container or Debug module settings.\r\nIt is not very flexible as there is no way to add any other event to this list (`['yii\\db\\Command::query', 'yii\\db\\Command::execute']`).\r\n\r\nI suggest adding to both classes public property like\r\n\r\n```php\r\n/**\r\n * @var array of db commands names\r\n */\r\npublic $dbCommandsNames = ['yii\\db\\Command::query', 'yii\\db\\Command::execute'];\r\n```\r\n\r\nand use them in functions:\r\n\r\n```php\r\npublic function getProfileLogs()\r\n{\r\n    return $this->getLogMessages(Logger::LEVEL_PROFILE, $this->dbCommandsNames);\r\n}\r\n```\r\n\r\nand\r\n\r\n```php\r\npublic function getDbProfiling()\r\n{\r\n    $timings = $this->getProfiling($this->dbCommandsNames);\r\n    $count = count($timings);\r\n    $time = 0;\r\n    foreach ($timings as $timing) {\r\n        $time += $timing['duration'];\r\n    }\r\n    return [$count, $time];\r\n}\r\n```\r\n\r\nThis will allow to add own event names to this list using the DI container or the Debug module settings (without creating own classes).","closed_by":{"login":"samdark","id":47294,"node_id":"MDQ6VXNlcjQ3Mjk0","avatar_url":"https://avatars.githubusercontent.com/u/47294?v=4","gravatar_id":"","url":"https://api.github.com/users/samdark","html_url":"https://github.com/samdark","followers_url":"https://api.github.com/users/samdark/followers","following_url":"https://api.github.com/users/samdark/following{/other_user}","gists_url":"https://api.github.com/users/samdark/gists{/gist_id}","starred_url":"https://api.github.com/users/samdark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samdark/subscriptions","organizations_url":"https://api.github.com/users/samdark/orgs","repos_url":"https://api.github.com/users/samdark/repos","events_url":"https://api.github.com/users/samdark/events{/privacy}","received_events_url":"https://api.github.com/users/samdark/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/yiisoft/yii2/issues/18483/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/yiisoft/yii2/issues/18483/timeline","performed_via_github_app":null,"state_reason":"completed"}