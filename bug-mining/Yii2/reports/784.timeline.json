[{"url":"https://api.github.com/repos/yiisoft/yii2/issues/comments/824219911","html_url":"https://github.com/yiisoft/yii2/issues/18611#issuecomment-824219911","issue_url":"https://api.github.com/repos/yiisoft/yii2/issues/18611","id":824219911,"node_id":"MDEyOklzc3VlQ29tbWVudDgyNDIxOTkxMQ==","user":{"login":"bizley","id":8577314,"node_id":"MDQ6VXNlcjg1NzczMTQ=","avatar_url":"https://avatars.githubusercontent.com/u/8577314?v=4","gravatar_id":"","url":"https://api.github.com/users/bizley","html_url":"https://github.com/bizley","followers_url":"https://api.github.com/users/bizley/followers","following_url":"https://api.github.com/users/bizley/following{/other_user}","gists_url":"https://api.github.com/users/bizley/gists{/gist_id}","starred_url":"https://api.github.com/users/bizley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bizley/subscriptions","organizations_url":"https://api.github.com/users/bizley/orgs","repos_url":"https://api.github.com/users/bizley/repos","events_url":"https://api.github.com/users/bizley/events{/privacy}","received_events_url":"https://api.github.com/users/bizley/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-21T17:07:32Z","updated_at":"2021-04-21T17:07:32Z","body":"Is `$mutex->acquire($mutexName);` in A returning `true`?","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/yiisoft/yii2/issues/comments/824219911/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"bizley","id":8577314,"node_id":"MDQ6VXNlcjg1NzczMTQ=","avatar_url":"https://avatars.githubusercontent.com/u/8577314?v=4","gravatar_id":"","url":"https://api.github.com/users/bizley","html_url":"https://github.com/bizley","followers_url":"https://api.github.com/users/bizley/followers","following_url":"https://api.github.com/users/bizley/following{/other_user}","gists_url":"https://api.github.com/users/bizley/gists{/gist_id}","starred_url":"https://api.github.com/users/bizley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bizley/subscriptions","organizations_url":"https://api.github.com/users/bizley/orgs","repos_url":"https://api.github.com/users/bizley/repos","events_url":"https://api.github.com/users/bizley/events{/privacy}","received_events_url":"https://api.github.com/users/bizley/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/yiisoft/yii2/issues/comments/824230479","html_url":"https://github.com/yiisoft/yii2/issues/18611#issuecomment-824230479","issue_url":"https://api.github.com/repos/yiisoft/yii2/issues/18611","id":824230479,"node_id":"MDEyOklzc3VlQ29tbWVudDgyNDIzMDQ3OQ==","user":{"login":"goncaloe","id":615966,"node_id":"MDQ6VXNlcjYxNTk2Ng==","avatar_url":"https://avatars.githubusercontent.com/u/615966?v=4","gravatar_id":"","url":"https://api.github.com/users/goncaloe","html_url":"https://github.com/goncaloe","followers_url":"https://api.github.com/users/goncaloe/followers","following_url":"https://api.github.com/users/goncaloe/following{/other_user}","gists_url":"https://api.github.com/users/goncaloe/gists{/gist_id}","starred_url":"https://api.github.com/users/goncaloe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/goncaloe/subscriptions","organizations_url":"https://api.github.com/users/goncaloe/orgs","repos_url":"https://api.github.com/users/goncaloe/repos","events_url":"https://api.github.com/users/goncaloe/events{/privacy}","received_events_url":"https://api.github.com/users/goncaloe/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-21T17:24:57Z","updated_at":"2021-04-21T17:24:57Z","body":"Yes, returns true;\r\nThe problem is in Mutex::isAcquired() is not checking the file / database of mutex, but only check the `$this->_locks` (that is not filled in second request)","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/yiisoft/yii2/issues/comments/824230479/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"goncaloe","id":615966,"node_id":"MDQ6VXNlcjYxNTk2Ng==","avatar_url":"https://avatars.githubusercontent.com/u/615966?v=4","gravatar_id":"","url":"https://api.github.com/users/goncaloe","html_url":"https://github.com/goncaloe","followers_url":"https://api.github.com/users/goncaloe/followers","following_url":"https://api.github.com/users/goncaloe/following{/other_user}","gists_url":"https://api.github.com/users/goncaloe/gists{/gist_id}","starred_url":"https://api.github.com/users/goncaloe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/goncaloe/subscriptions","organizations_url":"https://api.github.com/users/goncaloe/orgs","repos_url":"https://api.github.com/users/goncaloe/repos","events_url":"https://api.github.com/users/goncaloe/events{/privacy}","received_events_url":"https://api.github.com/users/goncaloe/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":4626434090,"node_id":"MDEyOkxhYmVsZWRFdmVudDQ2MjY0MzQwOTA=","url":"https://api.github.com/repos/yiisoft/yii2/issues/events/4626434090","actor":{"login":"bizley","id":8577314,"node_id":"MDQ6VXNlcjg1NzczMTQ=","avatar_url":"https://avatars.githubusercontent.com/u/8577314?v=4","gravatar_id":"","url":"https://api.github.com/users/bizley","html_url":"https://github.com/bizley","followers_url":"https://api.github.com/users/bizley/followers","following_url":"https://api.github.com/users/bizley/following{/other_user}","gists_url":"https://api.github.com/users/bizley/gists{/gist_id}","starred_url":"https://api.github.com/users/bizley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bizley/subscriptions","organizations_url":"https://api.github.com/users/bizley/orgs","repos_url":"https://api.github.com/users/bizley/repos","events_url":"https://api.github.com/users/bizley/events{/privacy}","received_events_url":"https://api.github.com/users/bizley/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2021-04-21T17:44:14Z","label":{"name":"type:bug","color":"e102d8"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/yiisoft/yii2/issues/comments/824596060","html_url":"https://github.com/yiisoft/yii2/issues/18611#issuecomment-824596060","issue_url":"https://api.github.com/repos/yiisoft/yii2/issues/18611","id":824596060,"node_id":"MDEyOklzc3VlQ29tbWVudDgyNDU5NjA2MA==","user":{"login":"ivan-redooc","id":11387801,"node_id":"MDQ6VXNlcjExMzg3ODAx","avatar_url":"https://avatars.githubusercontent.com/u/11387801?v=4","gravatar_id":"","url":"https://api.github.com/users/ivan-redooc","html_url":"https://github.com/ivan-redooc","followers_url":"https://api.github.com/users/ivan-redooc/followers","following_url":"https://api.github.com/users/ivan-redooc/following{/other_user}","gists_url":"https://api.github.com/users/ivan-redooc/gists{/gist_id}","starred_url":"https://api.github.com/users/ivan-redooc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivan-redooc/subscriptions","organizations_url":"https://api.github.com/users/ivan-redooc/orgs","repos_url":"https://api.github.com/users/ivan-redooc/repos","events_url":"https://api.github.com/users/ivan-redooc/events{/privacy}","received_events_url":"https://api.github.com/users/ivan-redooc/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-22T07:06:05Z","updated_at":"2021-04-22T07:06:05Z","body":"@goncaloe it seem to me because in actionB you don't follow the pattern \"try & check\", but you go directly to the check, eg:\r\n\r\n```PHP\r\npublic function actionB(){\r\n    $mutexName = 'test_mutex';\r\n    $mutex = \\Yii::createObject([\r\n        'class' => \\yii\\mutex\\FileMutex::class,\r\n        'mutexPath' => '@runtime/mutex',\r\n    ]);\r\n    \r\n    // try\r\n    $mutex->acquire($mutexName);\r\n    \r\n    // check\r\n    if($mutex->isAcquired($mutexName)){\r\n        echo \"mutex is acquired\\n\";\r\n    }\r\n    else {\r\n        echo \"mutex is not acquired\\n\";\r\n    }\r\n}\r\n\r\n```","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/yiisoft/yii2/issues/comments/824596060/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ivan-redooc","id":11387801,"node_id":"MDQ6VXNlcjExMzg3ODAx","avatar_url":"https://avatars.githubusercontent.com/u/11387801?v=4","gravatar_id":"","url":"https://api.github.com/users/ivan-redooc","html_url":"https://github.com/ivan-redooc","followers_url":"https://api.github.com/users/ivan-redooc/followers","following_url":"https://api.github.com/users/ivan-redooc/following{/other_user}","gists_url":"https://api.github.com/users/ivan-redooc/gists{/gist_id}","starred_url":"https://api.github.com/users/ivan-redooc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivan-redooc/subscriptions","organizations_url":"https://api.github.com/users/ivan-redooc/orgs","repos_url":"https://api.github.com/users/ivan-redooc/repos","events_url":"https://api.github.com/users/ivan-redooc/events{/privacy}","received_events_url":"https://api.github.com/users/ivan-redooc/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":4628875110,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDYyODg3NTExMA==","url":"https://api.github.com/repos/yiisoft/yii2/issues/events/4628875110","actor":{"login":"goncaloe","id":615966,"node_id":"MDQ6VXNlcjYxNTk2Ng==","avatar_url":"https://avatars.githubusercontent.com/u/615966?v=4","gravatar_id":"","url":"https://api.github.com/users/goncaloe","html_url":"https://github.com/goncaloe","followers_url":"https://api.github.com/users/goncaloe/followers","following_url":"https://api.github.com/users/goncaloe/following{/other_user}","gists_url":"https://api.github.com/users/goncaloe/gists{/gist_id}","starred_url":"https://api.github.com/users/goncaloe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/goncaloe/subscriptions","organizations_url":"https://api.github.com/users/goncaloe/orgs","repos_url":"https://api.github.com/users/goncaloe/repos","events_url":"https://api.github.com/users/goncaloe/events{/privacy}","received_events_url":"https://api.github.com/users/goncaloe/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-04-22T07:06:05Z","performed_via_github_app":null},{"id":4628875113,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQ2Mjg4NzUxMTM=","url":"https://api.github.com/repos/yiisoft/yii2/issues/events/4628875113","actor":{"login":"goncaloe","id":615966,"node_id":"MDQ6VXNlcjYxNTk2Ng==","avatar_url":"https://avatars.githubusercontent.com/u/615966?v=4","gravatar_id":"","url":"https://api.github.com/users/goncaloe","html_url":"https://github.com/goncaloe","followers_url":"https://api.github.com/users/goncaloe/followers","following_url":"https://api.github.com/users/goncaloe/following{/other_user}","gists_url":"https://api.github.com/users/goncaloe/gists{/gist_id}","starred_url":"https://api.github.com/users/goncaloe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/goncaloe/subscriptions","organizations_url":"https://api.github.com/users/goncaloe/orgs","repos_url":"https://api.github.com/users/goncaloe/repos","events_url":"https://api.github.com/users/goncaloe/events{/privacy}","received_events_url":"https://api.github.com/users/goncaloe/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-04-22T07:06:05Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/yiisoft/yii2/issues/comments/824622338","html_url":"https://github.com/yiisoft/yii2/issues/18611#issuecomment-824622338","issue_url":"https://api.github.com/repos/yiisoft/yii2/issues/18611","id":824622338,"node_id":"MDEyOklzc3VlQ29tbWVudDgyNDYyMjMzOA==","user":{"login":"bizley","id":8577314,"node_id":"MDQ6VXNlcjg1NzczMTQ=","avatar_url":"https://avatars.githubusercontent.com/u/8577314?v=4","gravatar_id":"","url":"https://api.github.com/users/bizley","html_url":"https://github.com/bizley","followers_url":"https://api.github.com/users/bizley/followers","following_url":"https://api.github.com/users/bizley/following{/other_user}","gists_url":"https://api.github.com/users/bizley/gists{/gist_id}","starred_url":"https://api.github.com/users/bizley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bizley/subscriptions","organizations_url":"https://api.github.com/users/bizley/orgs","repos_url":"https://api.github.com/users/bizley/repos","events_url":"https://api.github.com/users/bizley/events{/privacy}","received_events_url":"https://api.github.com/users/bizley/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-22T07:48:53Z","updated_at":"2021-04-22T07:48:53Z","body":"Yes, but idea of mutex is to be used in different processes as well.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/yiisoft/yii2/issues/comments/824622338/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"bizley","id":8577314,"node_id":"MDQ6VXNlcjg1NzczMTQ=","avatar_url":"https://avatars.githubusercontent.com/u/8577314?v=4","gravatar_id":"","url":"https://api.github.com/users/bizley","html_url":"https://github.com/bizley","followers_url":"https://api.github.com/users/bizley/followers","following_url":"https://api.github.com/users/bizley/following{/other_user}","gists_url":"https://api.github.com/users/bizley/gists{/gist_id}","starred_url":"https://api.github.com/users/bizley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bizley/subscriptions","organizations_url":"https://api.github.com/users/bizley/orgs","repos_url":"https://api.github.com/users/bizley/repos","events_url":"https://api.github.com/users/bizley/events{/privacy}","received_events_url":"https://api.github.com/users/bizley/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/yiisoft/yii2/issues/comments/824805586","html_url":"https://github.com/yiisoft/yii2/issues/18611#issuecomment-824805586","issue_url":"https://api.github.com/repos/yiisoft/yii2/issues/18611","id":824805586,"node_id":"MDEyOklzc3VlQ29tbWVudDgyNDgwNTU4Ng==","user":{"login":"ivan-redooc","id":11387801,"node_id":"MDQ6VXNlcjExMzg3ODAx","avatar_url":"https://avatars.githubusercontent.com/u/11387801?v=4","gravatar_id":"","url":"https://api.github.com/users/ivan-redooc","html_url":"https://github.com/ivan-redooc","followers_url":"https://api.github.com/users/ivan-redooc/followers","following_url":"https://api.github.com/users/ivan-redooc/following{/other_user}","gists_url":"https://api.github.com/users/ivan-redooc/gists{/gist_id}","starred_url":"https://api.github.com/users/ivan-redooc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivan-redooc/subscriptions","organizations_url":"https://api.github.com/users/ivan-redooc/orgs","repos_url":"https://api.github.com/users/ivan-redooc/repos","events_url":"https://api.github.com/users/ivan-redooc/events{/privacy}","received_events_url":"https://api.github.com/users/ivan-redooc/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-22T12:40:50Z","updated_at":"2021-04-22T12:40:50Z","body":"> Yes, but idea of mutex is to be used in different processes as well.\r\n\r\nOf course, but the [documentation](https://www.yiiframework.com/doc/api/2.0/yii-mutex-mutex) show the pattern to use:\r\n\r\n> The Mutex component allows mutual execution of concurrent processes in order to prevent \"race conditions\".\r\n> \r\n> This is achieved by using a \"lock\" mechanism. Each possibly concurrent thread cooperates by acquiring a lock before accessing the corresponding data.\r\n\r\n```PHP\r\nif ($mutex->acquire($mutexName)) {\r\n    // business logic execution\r\n} else {\r\n    // execution is blocked!\r\n}\r\n```\r\n\r\nAnd for I understand, the correct approach is **to try** to _acquire_ the mutex **to check** if the mutex is available.\r\n\r\nIMHO the real purpose of _isAcquired_ is the flow control in the **same** process **after** tryed to _acquire_ the mutex, with or without success.\r\n\r\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/yiisoft/yii2/issues/comments/824805586/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ivan-redooc","id":11387801,"node_id":"MDQ6VXNlcjExMzg3ODAx","avatar_url":"https://avatars.githubusercontent.com/u/11387801?v=4","gravatar_id":"","url":"https://api.github.com/users/ivan-redooc","html_url":"https://github.com/ivan-redooc","followers_url":"https://api.github.com/users/ivan-redooc/followers","following_url":"https://api.github.com/users/ivan-redooc/following{/other_user}","gists_url":"https://api.github.com/users/ivan-redooc/gists{/gist_id}","starred_url":"https://api.github.com/users/ivan-redooc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivan-redooc/subscriptions","organizations_url":"https://api.github.com/users/ivan-redooc/orgs","repos_url":"https://api.github.com/users/ivan-redooc/repos","events_url":"https://api.github.com/users/ivan-redooc/events{/privacy}","received_events_url":"https://api.github.com/users/ivan-redooc/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/yiisoft/yii2/issues/comments/824917322","html_url":"https://github.com/yiisoft/yii2/issues/18611#issuecomment-824917322","issue_url":"https://api.github.com/repos/yiisoft/yii2/issues/18611","id":824917322,"node_id":"MDEyOklzc3VlQ29tbWVudDgyNDkxNzMyMg==","user":{"login":"goncaloe","id":615966,"node_id":"MDQ6VXNlcjYxNTk2Ng==","avatar_url":"https://avatars.githubusercontent.com/u/615966?v=4","gravatar_id":"","url":"https://api.github.com/users/goncaloe","html_url":"https://github.com/goncaloe","followers_url":"https://api.github.com/users/goncaloe/followers","following_url":"https://api.github.com/users/goncaloe/following{/other_user}","gists_url":"https://api.github.com/users/goncaloe/gists{/gist_id}","starred_url":"https://api.github.com/users/goncaloe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/goncaloe/subscriptions","organizations_url":"https://api.github.com/users/goncaloe/orgs","repos_url":"https://api.github.com/users/goncaloe/repos","events_url":"https://api.github.com/users/goncaloe/events{/privacy}","received_events_url":"https://api.github.com/users/goncaloe/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-22T14:58:28Z","updated_at":"2021-04-22T14:58:28Z","body":"@ivan-redooc In my case, I have to check in web app if a console action (synchronization that takes a long time) is running (mutex is locked).\r\nIf it is unlocked, I show a button to start synchronization.\r\n\r\nThis should be possible, without using the acquire() function.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/yiisoft/yii2/issues/comments/824917322/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"goncaloe","id":615966,"node_id":"MDQ6VXNlcjYxNTk2Ng==","avatar_url":"https://avatars.githubusercontent.com/u/615966?v=4","gravatar_id":"","url":"https://api.github.com/users/goncaloe","html_url":"https://github.com/goncaloe","followers_url":"https://api.github.com/users/goncaloe/followers","following_url":"https://api.github.com/users/goncaloe/following{/other_user}","gists_url":"https://api.github.com/users/goncaloe/gists{/gist_id}","starred_url":"https://api.github.com/users/goncaloe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/goncaloe/subscriptions","organizations_url":"https://api.github.com/users/goncaloe/orgs","repos_url":"https://api.github.com/users/goncaloe/repos","events_url":"https://api.github.com/users/goncaloe/events{/privacy}","received_events_url":"https://api.github.com/users/goncaloe/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":4631429371,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDYzMTQyOTM3MQ==","url":"https://api.github.com/repos/yiisoft/yii2/issues/events/4631429371","actor":{"login":"ivan-redooc","id":11387801,"node_id":"MDQ6VXNlcjExMzg3ODAx","avatar_url":"https://avatars.githubusercontent.com/u/11387801?v=4","gravatar_id":"","url":"https://api.github.com/users/ivan-redooc","html_url":"https://github.com/ivan-redooc","followers_url":"https://api.github.com/users/ivan-redooc/followers","following_url":"https://api.github.com/users/ivan-redooc/following{/other_user}","gists_url":"https://api.github.com/users/ivan-redooc/gists{/gist_id}","starred_url":"https://api.github.com/users/ivan-redooc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivan-redooc/subscriptions","organizations_url":"https://api.github.com/users/ivan-redooc/orgs","repos_url":"https://api.github.com/users/ivan-redooc/repos","events_url":"https://api.github.com/users/ivan-redooc/events{/privacy}","received_events_url":"https://api.github.com/users/ivan-redooc/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-04-22T14:58:29Z","performed_via_github_app":null},{"id":4631429381,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQ2MzE0MjkzODE=","url":"https://api.github.com/repos/yiisoft/yii2/issues/events/4631429381","actor":{"login":"ivan-redooc","id":11387801,"node_id":"MDQ6VXNlcjExMzg3ODAx","avatar_url":"https://avatars.githubusercontent.com/u/11387801?v=4","gravatar_id":"","url":"https://api.github.com/users/ivan-redooc","html_url":"https://github.com/ivan-redooc","followers_url":"https://api.github.com/users/ivan-redooc/followers","following_url":"https://api.github.com/users/ivan-redooc/following{/other_user}","gists_url":"https://api.github.com/users/ivan-redooc/gists{/gist_id}","starred_url":"https://api.github.com/users/ivan-redooc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivan-redooc/subscriptions","organizations_url":"https://api.github.com/users/ivan-redooc/orgs","repos_url":"https://api.github.com/users/ivan-redooc/repos","events_url":"https://api.github.com/users/ivan-redooc/events{/privacy}","received_events_url":"https://api.github.com/users/ivan-redooc/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-04-22T14:58:29Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/yiisoft/yii2/issues/comments/825429515","html_url":"https://github.com/yiisoft/yii2/issues/18611#issuecomment-825429515","issue_url":"https://api.github.com/repos/yiisoft/yii2/issues/18611","id":825429515,"node_id":"MDEyOklzc3VlQ29tbWVudDgyNTQyOTUxNQ==","user":{"login":"ivan-redooc","id":11387801,"node_id":"MDQ6VXNlcjExMzg3ODAx","avatar_url":"https://avatars.githubusercontent.com/u/11387801?v=4","gravatar_id":"","url":"https://api.github.com/users/ivan-redooc","html_url":"https://github.com/ivan-redooc","followers_url":"https://api.github.com/users/ivan-redooc/followers","following_url":"https://api.github.com/users/ivan-redooc/following{/other_user}","gists_url":"https://api.github.com/users/ivan-redooc/gists{/gist_id}","starred_url":"https://api.github.com/users/ivan-redooc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivan-redooc/subscriptions","organizations_url":"https://api.github.com/users/ivan-redooc/orgs","repos_url":"https://api.github.com/users/ivan-redooc/repos","events_url":"https://api.github.com/users/ivan-redooc/events{/privacy}","received_events_url":"https://api.github.com/users/ivan-redooc/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-23T06:43:35Z","updated_at":"2021-04-23T06:43:51Z","body":"> This should be possible, without using the acquire() function.\r\n\r\nI don't agree, it's the lock pattern, you cannot check without lock.  \r\n\r\nSo here the obvious solution:\r\n```PHP\r\nif ($mutex->acquire($mutexName)) {\r\n    $mutex->release($mutexName);\r\n  // show the button\r\n} else {\r\n    // show the message \"still working\"\r\n}\r\n```\r\n\r\nIn other environments, with strong concurrency, you can simply always show the button because you will don't know if the mutex will be free when you click it.\r\n\r\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/yiisoft/yii2/issues/comments/825429515/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ivan-redooc","id":11387801,"node_id":"MDQ6VXNlcjExMzg3ODAx","avatar_url":"https://avatars.githubusercontent.com/u/11387801?v=4","gravatar_id":"","url":"https://api.github.com/users/ivan-redooc","html_url":"https://github.com/ivan-redooc","followers_url":"https://api.github.com/users/ivan-redooc/followers","following_url":"https://api.github.com/users/ivan-redooc/following{/other_user}","gists_url":"https://api.github.com/users/ivan-redooc/gists{/gist_id}","starred_url":"https://api.github.com/users/ivan-redooc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivan-redooc/subscriptions","organizations_url":"https://api.github.com/users/ivan-redooc/orgs","repos_url":"https://api.github.com/users/ivan-redooc/repos","events_url":"https://api.github.com/users/ivan-redooc/events{/privacy}","received_events_url":"https://api.github.com/users/ivan-redooc/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/yiisoft/yii2/issues/comments/825446057","html_url":"https://github.com/yiisoft/yii2/issues/18611#issuecomment-825446057","issue_url":"https://api.github.com/repos/yiisoft/yii2/issues/18611","id":825446057,"node_id":"MDEyOklzc3VlQ29tbWVudDgyNTQ0NjA1Nw==","user":{"login":"mikehaertl","id":675062,"node_id":"MDQ6VXNlcjY3NTA2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/675062?v=4","gravatar_id":"","url":"https://api.github.com/users/mikehaertl","html_url":"https://github.com/mikehaertl","followers_url":"https://api.github.com/users/mikehaertl/followers","following_url":"https://api.github.com/users/mikehaertl/following{/other_user}","gists_url":"https://api.github.com/users/mikehaertl/gists{/gist_id}","starred_url":"https://api.github.com/users/mikehaertl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikehaertl/subscriptions","organizations_url":"https://api.github.com/users/mikehaertl/orgs","repos_url":"https://api.github.com/users/mikehaertl/repos","events_url":"https://api.github.com/users/mikehaertl/events{/privacy}","received_events_url":"https://api.github.com/users/mikehaertl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-23T07:13:41Z","updated_at":"2021-04-23T07:13:41Z","body":"@ivan-redooc Why would you ever want to check for `isAcquired()` in the same process where you acquired the lock? As you said the recommended pattern is:\r\n\r\n```\r\nif ($mutex->acquire($key)) {\r\n    // Got mutex here. It makes no sense to check for isAcquired() again.\r\n} else {\r\n    // no mutex\r\n}\r\n```\r\n\r\nThat's also the pattern I use. I've never used `isAcquired()`. But I would have expected that I could use it wherever I want not just in the same process that acquired the lock. So I would say that the issue is valid.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/yiisoft/yii2/issues/comments/825446057/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mikehaertl","id":675062,"node_id":"MDQ6VXNlcjY3NTA2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/675062?v=4","gravatar_id":"","url":"https://api.github.com/users/mikehaertl","html_url":"https://github.com/mikehaertl","followers_url":"https://api.github.com/users/mikehaertl/followers","following_url":"https://api.github.com/users/mikehaertl/following{/other_user}","gists_url":"https://api.github.com/users/mikehaertl/gists{/gist_id}","starred_url":"https://api.github.com/users/mikehaertl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikehaertl/subscriptions","organizations_url":"https://api.github.com/users/mikehaertl/orgs","repos_url":"https://api.github.com/users/mikehaertl/repos","events_url":"https://api.github.com/users/mikehaertl/events{/privacy}","received_events_url":"https://api.github.com/users/mikehaertl/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":4635182887,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDYzNTE4Mjg4Nw==","url":"https://api.github.com/repos/yiisoft/yii2/issues/events/4635182887","actor":{"login":"ivan-redooc","id":11387801,"node_id":"MDQ6VXNlcjExMzg3ODAx","avatar_url":"https://avatars.githubusercontent.com/u/11387801?v=4","gravatar_id":"","url":"https://api.github.com/users/ivan-redooc","html_url":"https://github.com/ivan-redooc","followers_url":"https://api.github.com/users/ivan-redooc/followers","following_url":"https://api.github.com/users/ivan-redooc/following{/other_user}","gists_url":"https://api.github.com/users/ivan-redooc/gists{/gist_id}","starred_url":"https://api.github.com/users/ivan-redooc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivan-redooc/subscriptions","organizations_url":"https://api.github.com/users/ivan-redooc/orgs","repos_url":"https://api.github.com/users/ivan-redooc/repos","events_url":"https://api.github.com/users/ivan-redooc/events{/privacy}","received_events_url":"https://api.github.com/users/ivan-redooc/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-04-23T07:13:41Z","performed_via_github_app":null},{"id":4635182891,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQ2MzUxODI4OTE=","url":"https://api.github.com/repos/yiisoft/yii2/issues/events/4635182891","actor":{"login":"ivan-redooc","id":11387801,"node_id":"MDQ6VXNlcjExMzg3ODAx","avatar_url":"https://avatars.githubusercontent.com/u/11387801?v=4","gravatar_id":"","url":"https://api.github.com/users/ivan-redooc","html_url":"https://github.com/ivan-redooc","followers_url":"https://api.github.com/users/ivan-redooc/followers","following_url":"https://api.github.com/users/ivan-redooc/following{/other_user}","gists_url":"https://api.github.com/users/ivan-redooc/gists{/gist_id}","starred_url":"https://api.github.com/users/ivan-redooc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivan-redooc/subscriptions","organizations_url":"https://api.github.com/users/ivan-redooc/orgs","repos_url":"https://api.github.com/users/ivan-redooc/repos","events_url":"https://api.github.com/users/ivan-redooc/events{/privacy}","received_events_url":"https://api.github.com/users/ivan-redooc/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-04-23T07:13:41Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/yiisoft/yii2/issues/comments/825461615","html_url":"https://github.com/yiisoft/yii2/issues/18611#issuecomment-825461615","issue_url":"https://api.github.com/repos/yiisoft/yii2/issues/18611","id":825461615,"node_id":"MDEyOklzc3VlQ29tbWVudDgyNTQ2MTYxNQ==","user":{"login":"mikehaertl","id":675062,"node_id":"MDQ6VXNlcjY3NTA2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/675062?v=4","gravatar_id":"","url":"https://api.github.com/users/mikehaertl","html_url":"https://github.com/mikehaertl","followers_url":"https://api.github.com/users/mikehaertl/followers","following_url":"https://api.github.com/users/mikehaertl/following{/other_user}","gists_url":"https://api.github.com/users/mikehaertl/gists{/gist_id}","starred_url":"https://api.github.com/users/mikehaertl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikehaertl/subscriptions","organizations_url":"https://api.github.com/users/mikehaertl/orgs","repos_url":"https://api.github.com/users/mikehaertl/repos","events_url":"https://api.github.com/users/mikehaertl/events{/privacy}","received_events_url":"https://api.github.com/users/mikehaertl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-23T07:40:10Z","updated_at":"2021-04-23T07:40:10Z","body":"I see that `isAcquired()` was just recently added in #18151. To be honest I'm not sure if this was such a good idea. As we see in this issue it gives the wrong impression that you can use it everywhere. While in fact it's only useful in the same process where you acquired the lock. But mutexes whole point is to work across multiple processes. \r\n\r\nThe real fix would be to add a `abstract protected checkLock()` method that child classes must implement. But IMO that's not an option either as it could break BC (and maybe not every backend supports such a check without obtaining the lock).\r\n\r\nThe way I see it: There is no fix. So we should put a big warning message above `isAcquired()` to make it clear that it does *not* work in every scenario. Maybe even mark it as deprecated.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/yiisoft/yii2/issues/comments/825461615/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mikehaertl","id":675062,"node_id":"MDQ6VXNlcjY3NTA2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/675062?v=4","gravatar_id":"","url":"https://api.github.com/users/mikehaertl","html_url":"https://github.com/mikehaertl","followers_url":"https://api.github.com/users/mikehaertl/followers","following_url":"https://api.github.com/users/mikehaertl/following{/other_user}","gists_url":"https://api.github.com/users/mikehaertl/gists{/gist_id}","starred_url":"https://api.github.com/users/mikehaertl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikehaertl/subscriptions","organizations_url":"https://api.github.com/users/mikehaertl/orgs","repos_url":"https://api.github.com/users/mikehaertl/repos","events_url":"https://api.github.com/users/mikehaertl/events{/privacy}","received_events_url":"https://api.github.com/users/mikehaertl/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/yiisoft/yii2/issues/comments/825495511","html_url":"https://github.com/yiisoft/yii2/issues/18611#issuecomment-825495511","issue_url":"https://api.github.com/repos/yiisoft/yii2/issues/18611","id":825495511,"node_id":"MDEyOklzc3VlQ29tbWVudDgyNTQ5NTUxMQ==","user":{"login":"bizley","id":8577314,"node_id":"MDQ6VXNlcjg1NzczMTQ=","avatar_url":"https://avatars.githubusercontent.com/u/8577314?v=4","gravatar_id":"","url":"https://api.github.com/users/bizley","html_url":"https://github.com/bizley","followers_url":"https://api.github.com/users/bizley/followers","following_url":"https://api.github.com/users/bizley/following{/other_user}","gists_url":"https://api.github.com/users/bizley/gists{/gist_id}","starred_url":"https://api.github.com/users/bizley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bizley/subscriptions","organizations_url":"https://api.github.com/users/bizley/orgs","repos_url":"https://api.github.com/users/bizley/repos","events_url":"https://api.github.com/users/bizley/events{/privacy}","received_events_url":"https://api.github.com/users/bizley/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-23T08:32:59Z","updated_at":"2021-04-23T08:32:59Z","body":"Hm, why not fix `isAcquired` to not check its internal `_locks` state but rather to directly check the storage it uses? Why cannot it be fixed?","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/yiisoft/yii2/issues/comments/825495511/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"bizley","id":8577314,"node_id":"MDQ6VXNlcjg1NzczMTQ=","avatar_url":"https://avatars.githubusercontent.com/u/8577314?v=4","gravatar_id":"","url":"https://api.github.com/users/bizley","html_url":"https://github.com/bizley","followers_url":"https://api.github.com/users/bizley/followers","following_url":"https://api.github.com/users/bizley/following{/other_user}","gists_url":"https://api.github.com/users/bizley/gists{/gist_id}","starred_url":"https://api.github.com/users/bizley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bizley/subscriptions","organizations_url":"https://api.github.com/users/bizley/orgs","repos_url":"https://api.github.com/users/bizley/repos","events_url":"https://api.github.com/users/bizley/events{/privacy}","received_events_url":"https://api.github.com/users/bizley/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/yiisoft/yii2/issues/comments/825501354","html_url":"https://github.com/yiisoft/yii2/issues/18611#issuecomment-825501354","issue_url":"https://api.github.com/repos/yiisoft/yii2/issues/18611","id":825501354,"node_id":"MDEyOklzc3VlQ29tbWVudDgyNTUwMTM1NA==","user":{"login":"mikehaertl","id":675062,"node_id":"MDQ6VXNlcjY3NTA2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/675062?v=4","gravatar_id":"","url":"https://api.github.com/users/mikehaertl","html_url":"https://github.com/mikehaertl","followers_url":"https://api.github.com/users/mikehaertl/followers","following_url":"https://api.github.com/users/mikehaertl/following{/other_user}","gists_url":"https://api.github.com/users/mikehaertl/gists{/gist_id}","starred_url":"https://api.github.com/users/mikehaertl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikehaertl/subscriptions","organizations_url":"https://api.github.com/users/mikehaertl/orgs","repos_url":"https://api.github.com/users/mikehaertl/repos","events_url":"https://api.github.com/users/mikehaertl/events{/privacy}","received_events_url":"https://api.github.com/users/mikehaertl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-23T08:41:54Z","updated_at":"2021-04-23T08:41:54Z","body":"@bizley How would you do that? We only have `abstract acquireLock()` and `abstract releaseLock()`. But we don't want to acquire the lock, we only want to check it. So we would need `abstract checkLock()`. This is\r\n\r\n1. BC break (what if someone implemented their own Mutex child class?)\r\n2. not every backend supports it. E.g. with Mysql you can't check if a lock is obtained. At least not easily.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/yiisoft/yii2/issues/comments/825501354/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mikehaertl","id":675062,"node_id":"MDQ6VXNlcjY3NTA2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/675062?v=4","gravatar_id":"","url":"https://api.github.com/users/mikehaertl","html_url":"https://github.com/mikehaertl","followers_url":"https://api.github.com/users/mikehaertl/followers","following_url":"https://api.github.com/users/mikehaertl/following{/other_user}","gists_url":"https://api.github.com/users/mikehaertl/gists{/gist_id}","starred_url":"https://api.github.com/users/mikehaertl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikehaertl/subscriptions","organizations_url":"https://api.github.com/users/mikehaertl/orgs","repos_url":"https://api.github.com/users/mikehaertl/repos","events_url":"https://api.github.com/users/mikehaertl/events{/privacy}","received_events_url":"https://api.github.com/users/mikehaertl/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":4635601371,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDYzNTYwMTM3MQ==","url":"https://api.github.com/repos/yiisoft/yii2/issues/events/4635601371","actor":{"login":"bizley","id":8577314,"node_id":"MDQ6VXNlcjg1NzczMTQ=","avatar_url":"https://avatars.githubusercontent.com/u/8577314?v=4","gravatar_id":"","url":"https://api.github.com/users/bizley","html_url":"https://github.com/bizley","followers_url":"https://api.github.com/users/bizley/followers","following_url":"https://api.github.com/users/bizley/following{/other_user}","gists_url":"https://api.github.com/users/bizley/gists{/gist_id}","starred_url":"https://api.github.com/users/bizley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bizley/subscriptions","organizations_url":"https://api.github.com/users/bizley/orgs","repos_url":"https://api.github.com/users/bizley/repos","events_url":"https://api.github.com/users/bizley/events{/privacy}","received_events_url":"https://api.github.com/users/bizley/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-04-23T08:41:54Z","performed_via_github_app":null},{"id":4635601375,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQ2MzU2MDEzNzU=","url":"https://api.github.com/repos/yiisoft/yii2/issues/events/4635601375","actor":{"login":"bizley","id":8577314,"node_id":"MDQ6VXNlcjg1NzczMTQ=","avatar_url":"https://avatars.githubusercontent.com/u/8577314?v=4","gravatar_id":"","url":"https://api.github.com/users/bizley","html_url":"https://github.com/bizley","followers_url":"https://api.github.com/users/bizley/followers","following_url":"https://api.github.com/users/bizley/following{/other_user}","gists_url":"https://api.github.com/users/bizley/gists{/gist_id}","starred_url":"https://api.github.com/users/bizley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bizley/subscriptions","organizations_url":"https://api.github.com/users/bizley/orgs","repos_url":"https://api.github.com/users/bizley/repos","events_url":"https://api.github.com/users/bizley/events{/privacy}","received_events_url":"https://api.github.com/users/bizley/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-04-23T08:41:54Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/yiisoft/yii2/issues/comments/825504991","html_url":"https://github.com/yiisoft/yii2/issues/18611#issuecomment-825504991","issue_url":"https://api.github.com/repos/yiisoft/yii2/issues/18611","id":825504991,"node_id":"MDEyOklzc3VlQ29tbWVudDgyNTUwNDk5MQ==","user":{"login":"bizley","id":8577314,"node_id":"MDQ6VXNlcjg1NzczMTQ=","avatar_url":"https://avatars.githubusercontent.com/u/8577314?v=4","gravatar_id":"","url":"https://api.github.com/users/bizley","html_url":"https://github.com/bizley","followers_url":"https://api.github.com/users/bizley/followers","following_url":"https://api.github.com/users/bizley/following{/other_user}","gists_url":"https://api.github.com/users/bizley/gists{/gist_id}","starred_url":"https://api.github.com/users/bizley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bizley/subscriptions","organizations_url":"https://api.github.com/users/bizley/orgs","repos_url":"https://api.github.com/users/bizley/repos","events_url":"https://api.github.com/users/bizley/events{/privacy}","received_events_url":"https://api.github.com/users/bizley/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-23T08:47:12Z","updated_at":"2021-04-23T08:47:12Z","body":"No, there is `Mutex::isAcquired()` method that is fine for the abstraction but should and must be extended for implementations. There we can do the actual check.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/yiisoft/yii2/issues/comments/825504991/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"bizley","id":8577314,"node_id":"MDQ6VXNlcjg1NzczMTQ=","avatar_url":"https://avatars.githubusercontent.com/u/8577314?v=4","gravatar_id":"","url":"https://api.github.com/users/bizley","html_url":"https://github.com/bizley","followers_url":"https://api.github.com/users/bizley/followers","following_url":"https://api.github.com/users/bizley/following{/other_user}","gists_url":"https://api.github.com/users/bizley/gists{/gist_id}","starred_url":"https://api.github.com/users/bizley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bizley/subscriptions","organizations_url":"https://api.github.com/users/bizley/orgs","repos_url":"https://api.github.com/users/bizley/repos","events_url":"https://api.github.com/users/bizley/events{/privacy}","received_events_url":"https://api.github.com/users/bizley/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/yiisoft/yii2/issues/comments/825507054","html_url":"https://github.com/yiisoft/yii2/issues/18611#issuecomment-825507054","issue_url":"https://api.github.com/repos/yiisoft/yii2/issues/18611","id":825507054,"node_id":"MDEyOklzc3VlQ29tbWVudDgyNTUwNzA1NA==","user":{"login":"mikehaertl","id":675062,"node_id":"MDQ6VXNlcjY3NTA2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/675062?v=4","gravatar_id":"","url":"https://api.github.com/users/mikehaertl","html_url":"https://github.com/mikehaertl","followers_url":"https://api.github.com/users/mikehaertl/followers","following_url":"https://api.github.com/users/mikehaertl/following{/other_user}","gists_url":"https://api.github.com/users/mikehaertl/gists{/gist_id}","starred_url":"https://api.github.com/users/mikehaertl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikehaertl/subscriptions","organizations_url":"https://api.github.com/users/mikehaertl/orgs","repos_url":"https://api.github.com/users/mikehaertl/repos","events_url":"https://api.github.com/users/mikehaertl/events{/privacy}","received_events_url":"https://api.github.com/users/mikehaertl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-23T08:50:21Z","updated_at":"2021-04-23T08:50:21Z","body":"But point 2 still holds true: You can't check for a lock in MySQL without obtaining the lock (which is not what you want wenn you call `isAcquired()` - otherwhise you could also call `acquire()`).\r\n\r\nAnd if you implemented your own child class, you may have not implementation for `isAcquired()` - and so the situation in this issue can still hit you.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/yiisoft/yii2/issues/comments/825507054/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mikehaertl","id":675062,"node_id":"MDQ6VXNlcjY3NTA2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/675062?v=4","gravatar_id":"","url":"https://api.github.com/users/mikehaertl","html_url":"https://github.com/mikehaertl","followers_url":"https://api.github.com/users/mikehaertl/followers","following_url":"https://api.github.com/users/mikehaertl/following{/other_user}","gists_url":"https://api.github.com/users/mikehaertl/gists{/gist_id}","starred_url":"https://api.github.com/users/mikehaertl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikehaertl/subscriptions","organizations_url":"https://api.github.com/users/mikehaertl/orgs","repos_url":"https://api.github.com/users/mikehaertl/repos","events_url":"https://api.github.com/users/mikehaertl/events{/privacy}","received_events_url":"https://api.github.com/users/mikehaertl/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/yiisoft/yii2/issues/comments/825511087","html_url":"https://github.com/yiisoft/yii2/issues/18611#issuecomment-825511087","issue_url":"https://api.github.com/repos/yiisoft/yii2/issues/18611","id":825511087,"node_id":"MDEyOklzc3VlQ29tbWVudDgyNTUxMTA4Nw==","user":{"login":"bizley","id":8577314,"node_id":"MDQ6VXNlcjg1NzczMTQ=","avatar_url":"https://avatars.githubusercontent.com/u/8577314?v=4","gravatar_id":"","url":"https://api.github.com/users/bizley","html_url":"https://github.com/bizley","followers_url":"https://api.github.com/users/bizley/followers","following_url":"https://api.github.com/users/bizley/following{/other_user}","gists_url":"https://api.github.com/users/bizley/gists{/gist_id}","starred_url":"https://api.github.com/users/bizley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bizley/subscriptions","organizations_url":"https://api.github.com/users/bizley/orgs","repos_url":"https://api.github.com/users/bizley/repos","events_url":"https://api.github.com/users/bizley/events{/privacy}","received_events_url":"https://api.github.com/users/bizley/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-23T08:56:52Z","updated_at":"2021-04-23T08:56:52Z","body":"I can see there is something like IS_USED_LOCK on MySQL but I've never used it before.\r\n\r\nYou are right about this custom implementations but if we can write the warning on this method at least someone can read it and realize it. And we can fix the core implementations.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/yiisoft/yii2/issues/comments/825511087/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"bizley","id":8577314,"node_id":"MDQ6VXNlcjg1NzczMTQ=","avatar_url":"https://avatars.githubusercontent.com/u/8577314?v=4","gravatar_id":"","url":"https://api.github.com/users/bizley","html_url":"https://github.com/bizley","followers_url":"https://api.github.com/users/bizley/followers","following_url":"https://api.github.com/users/bizley/following{/other_user}","gists_url":"https://api.github.com/users/bizley/gists{/gist_id}","starred_url":"https://api.github.com/users/bizley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bizley/subscriptions","organizations_url":"https://api.github.com/users/bizley/orgs","repos_url":"https://api.github.com/users/bizley/repos","events_url":"https://api.github.com/users/bizley/events{/privacy}","received_events_url":"https://api.github.com/users/bizley/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/yiisoft/yii2/issues/comments/825522635","html_url":"https://github.com/yiisoft/yii2/issues/18611#issuecomment-825522635","issue_url":"https://api.github.com/repos/yiisoft/yii2/issues/18611","id":825522635,"node_id":"MDEyOklzc3VlQ29tbWVudDgyNTUyMjYzNQ==","user":{"login":"mikehaertl","id":675062,"node_id":"MDQ6VXNlcjY3NTA2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/675062?v=4","gravatar_id":"","url":"https://api.github.com/users/mikehaertl","html_url":"https://github.com/mikehaertl","followers_url":"https://api.github.com/users/mikehaertl/followers","following_url":"https://api.github.com/users/mikehaertl/following{/other_user}","gists_url":"https://api.github.com/users/mikehaertl/gists{/gist_id}","starred_url":"https://api.github.com/users/mikehaertl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikehaertl/subscriptions","organizations_url":"https://api.github.com/users/mikehaertl/orgs","repos_url":"https://api.github.com/users/mikehaertl/repos","events_url":"https://api.github.com/users/mikehaertl/events{/privacy}","received_events_url":"https://api.github.com/users/mikehaertl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-23T09:16:10Z","updated_at":"2021-04-23T09:16:10Z","body":"Ups, right, I missed that. `IS_USED_LOCK()` (or `IS_FREE_LOCK()`) should work indeed. But this must also be checked for the other DBMS we have mutexes for.\r\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/yiisoft/yii2/issues/comments/825522635/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mikehaertl","id":675062,"node_id":"MDQ6VXNlcjY3NTA2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/675062?v=4","gravatar_id":"","url":"https://api.github.com/users/mikehaertl","html_url":"https://github.com/mikehaertl","followers_url":"https://api.github.com/users/mikehaertl/followers","following_url":"https://api.github.com/users/mikehaertl/following{/other_user}","gists_url":"https://api.github.com/users/mikehaertl/gists{/gist_id}","starred_url":"https://api.github.com/users/mikehaertl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikehaertl/subscriptions","organizations_url":"https://api.github.com/users/mikehaertl/orgs","repos_url":"https://api.github.com/users/mikehaertl/repos","events_url":"https://api.github.com/users/mikehaertl/events{/privacy}","received_events_url":"https://api.github.com/users/mikehaertl/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":4635803518,"node_id":"MDEyOkxhYmVsZWRFdmVudDQ2MzU4MDM1MTg=","url":"https://api.github.com/repos/yiisoft/yii2/issues/events/4635803518","actor":{"login":"bizley","id":8577314,"node_id":"MDQ6VXNlcjg1NzczMTQ=","avatar_url":"https://avatars.githubusercontent.com/u/8577314?v=4","gravatar_id":"","url":"https://api.github.com/users/bizley","html_url":"https://github.com/bizley","followers_url":"https://api.github.com/users/bizley/followers","following_url":"https://api.github.com/users/bizley/following{/other_user}","gists_url":"https://api.github.com/users/bizley/gists{/gist_id}","starred_url":"https://api.github.com/users/bizley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bizley/subscriptions","organizations_url":"https://api.github.com/users/bizley/orgs","repos_url":"https://api.github.com/users/bizley/repos","events_url":"https://api.github.com/users/bizley/events{/privacy}","received_events_url":"https://api.github.com/users/bizley/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2021-04-23T09:21:58Z","label":{"name":"status:ready for adoption","color":"02e10c"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/yiisoft/yii2/issues/comments/825574922","html_url":"https://github.com/yiisoft/yii2/issues/18611#issuecomment-825574922","issue_url":"https://api.github.com/repos/yiisoft/yii2/issues/18611","id":825574922,"node_id":"MDEyOklzc3VlQ29tbWVudDgyNTU3NDkyMg==","user":{"login":"diego-mathis","id":22345162,"node_id":"MDQ6VXNlcjIyMzQ1MTYy","avatar_url":"https://avatars.githubusercontent.com/u/22345162?v=4","gravatar_id":"","url":"https://api.github.com/users/diego-mathis","html_url":"https://github.com/diego-mathis","followers_url":"https://api.github.com/users/diego-mathis/followers","following_url":"https://api.github.com/users/diego-mathis/following{/other_user}","gists_url":"https://api.github.com/users/diego-mathis/gists{/gist_id}","starred_url":"https://api.github.com/users/diego-mathis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/diego-mathis/subscriptions","organizations_url":"https://api.github.com/users/diego-mathis/orgs","repos_url":"https://api.github.com/users/diego-mathis/repos","events_url":"https://api.github.com/users/diego-mathis/events{/privacy}","received_events_url":"https://api.github.com/users/diego-mathis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-23T10:51:14Z","updated_at":"2021-04-23T10:51:14Z","body":"I expect that isAcquired does what it does. If i did not acquire a mutex in the current process, then isAcquired should return false.\r\nMaybe I interpret the english incorrect, but that is what I understand from the wording, Mutex Is Acquired.\r\n\r\nSo maybe a secondary function, Mutex isLocked()\r\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/yiisoft/yii2/issues/comments/825574922/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"diego-mathis","id":22345162,"node_id":"MDQ6VXNlcjIyMzQ1MTYy","avatar_url":"https://avatars.githubusercontent.com/u/22345162?v=4","gravatar_id":"","url":"https://api.github.com/users/diego-mathis","html_url":"https://github.com/diego-mathis","followers_url":"https://api.github.com/users/diego-mathis/followers","following_url":"https://api.github.com/users/diego-mathis/following{/other_user}","gists_url":"https://api.github.com/users/diego-mathis/gists{/gist_id}","starred_url":"https://api.github.com/users/diego-mathis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/diego-mathis/subscriptions","organizations_url":"https://api.github.com/users/diego-mathis/orgs","repos_url":"https://api.github.com/users/diego-mathis/repos","events_url":"https://api.github.com/users/diego-mathis/events{/privacy}","received_events_url":"https://api.github.com/users/diego-mathis/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/yiisoft/yii2/issues/comments/825606919","html_url":"https://github.com/yiisoft/yii2/issues/18611#issuecomment-825606919","issue_url":"https://api.github.com/repos/yiisoft/yii2/issues/18611","id":825606919,"node_id":"MDEyOklzc3VlQ29tbWVudDgyNTYwNjkxOQ==","user":{"login":"mikehaertl","id":675062,"node_id":"MDQ6VXNlcjY3NTA2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/675062?v=4","gravatar_id":"","url":"https://api.github.com/users/mikehaertl","html_url":"https://github.com/mikehaertl","followers_url":"https://api.github.com/users/mikehaertl/followers","following_url":"https://api.github.com/users/mikehaertl/following{/other_user}","gists_url":"https://api.github.com/users/mikehaertl/gists{/gist_id}","starred_url":"https://api.github.com/users/mikehaertl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikehaertl/subscriptions","organizations_url":"https://api.github.com/users/mikehaertl/orgs","repos_url":"https://api.github.com/users/mikehaertl/repos","events_url":"https://api.github.com/users/mikehaertl/events{/privacy}","received_events_url":"https://api.github.com/users/mikehaertl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-23T11:55:25Z","updated_at":"2021-04-23T11:55:25Z","body":"I'm afraid that if we change this, it will break the initial use case that @rhertogh reported in #18151 \r\n\r\n> It would be used in a model's save function to ensure it is only called when the mutex is active. The mutex itself would be acquired in different places and wraps different models.\r\n\r\nConsider this code:\r\n\r\n```php\r\npublic function beforeSave()\r\n{\r\n    if (!Yii::$app->mutex->acquire('somekey')) {\r\n        return false;\r\n    }\r\n}\r\n\r\npublic function afterSave()\r\n{\r\n    if (Yii::$app->mutex->isAcquired('somekey')) {\r\n        // do dangerous things here....\r\n    }\r\n}\r\n```\r\n\r\n * Current situation: Code in `afterSave()` will only be executed, if the lock was acquired **in the same process** (which happened most likely in `beforeSave()` - but that's not even guaranteed to be the case)\r\n * After the proposed change: Code in `afterSave()` will even be executed if the lock was acquired **by another process in another instance of the active record**. \r\n\r\nI actually think, that @rhertogh 's problem should rather be solved in his own code, like:\r\n\r\n\r\n```php\r\npublic $hasLock = false;\r\n\r\npublic function beforeSave()\r\n{\r\n    if (!Yii::$app->mutex->acquire('somekey')) {\r\n        return false;\r\n    } else {\r\n        $this->hasLock = true;\r\n    }\r\n}\r\n\r\npublic function afterSave()\r\n{\r\n    if ($this->hasLock) {\r\n        // do dangerous things here....\r\n    }\r\n}\r\n```","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/yiisoft/yii2/issues/comments/825606919/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mikehaertl","id":675062,"node_id":"MDQ6VXNlcjY3NTA2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/675062?v=4","gravatar_id":"","url":"https://api.github.com/users/mikehaertl","html_url":"https://github.com/mikehaertl","followers_url":"https://api.github.com/users/mikehaertl/followers","following_url":"https://api.github.com/users/mikehaertl/following{/other_user}","gists_url":"https://api.github.com/users/mikehaertl/gists{/gist_id}","starred_url":"https://api.github.com/users/mikehaertl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikehaertl/subscriptions","organizations_url":"https://api.github.com/users/mikehaertl/orgs","repos_url":"https://api.github.com/users/mikehaertl/repos","events_url":"https://api.github.com/users/mikehaertl/events{/privacy}","received_events_url":"https://api.github.com/users/mikehaertl/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":4636481079,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDYzNjQ4MTA3OQ==","url":"https://api.github.com/repos/yiisoft/yii2/issues/events/4636481079","actor":{"login":"rhertogh","id":1292337,"node_id":"MDQ6VXNlcjEyOTIzMzc=","avatar_url":"https://avatars.githubusercontent.com/u/1292337?v=4","gravatar_id":"","url":"https://api.github.com/users/rhertogh","html_url":"https://github.com/rhertogh","followers_url":"https://api.github.com/users/rhertogh/followers","following_url":"https://api.github.com/users/rhertogh/following{/other_user}","gists_url":"https://api.github.com/users/rhertogh/gists{/gist_id}","starred_url":"https://api.github.com/users/rhertogh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rhertogh/subscriptions","organizations_url":"https://api.github.com/users/rhertogh/orgs","repos_url":"https://api.github.com/users/rhertogh/repos","events_url":"https://api.github.com/users/rhertogh/events{/privacy}","received_events_url":"https://api.github.com/users/rhertogh/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-04-23T11:55:25Z","performed_via_github_app":null},{"id":4636481087,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQ2MzY0ODEwODc=","url":"https://api.github.com/repos/yiisoft/yii2/issues/events/4636481087","actor":{"login":"rhertogh","id":1292337,"node_id":"MDQ6VXNlcjEyOTIzMzc=","avatar_url":"https://avatars.githubusercontent.com/u/1292337?v=4","gravatar_id":"","url":"https://api.github.com/users/rhertogh","html_url":"https://github.com/rhertogh","followers_url":"https://api.github.com/users/rhertogh/followers","following_url":"https://api.github.com/users/rhertogh/following{/other_user}","gists_url":"https://api.github.com/users/rhertogh/gists{/gist_id}","starred_url":"https://api.github.com/users/rhertogh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rhertogh/subscriptions","organizations_url":"https://api.github.com/users/rhertogh/orgs","repos_url":"https://api.github.com/users/rhertogh/repos","events_url":"https://api.github.com/users/rhertogh/events{/privacy}","received_events_url":"https://api.github.com/users/rhertogh/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-04-23T11:55:25Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/yiisoft/yii2/issues/comments/825694610","html_url":"https://github.com/yiisoft/yii2/issues/18611#issuecomment-825694610","issue_url":"https://api.github.com/repos/yiisoft/yii2/issues/18611","id":825694610,"node_id":"MDEyOklzc3VlQ29tbWVudDgyNTY5NDYxMA==","user":{"login":"ivan-redooc","id":11387801,"node_id":"MDQ6VXNlcjExMzg3ODAx","avatar_url":"https://avatars.githubusercontent.com/u/11387801?v=4","gravatar_id":"","url":"https://api.github.com/users/ivan-redooc","html_url":"https://github.com/ivan-redooc","followers_url":"https://api.github.com/users/ivan-redooc/followers","following_url":"https://api.github.com/users/ivan-redooc/following{/other_user}","gists_url":"https://api.github.com/users/ivan-redooc/gists{/gist_id}","starred_url":"https://api.github.com/users/ivan-redooc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivan-redooc/subscriptions","organizations_url":"https://api.github.com/users/ivan-redooc/orgs","repos_url":"https://api.github.com/users/ivan-redooc/repos","events_url":"https://api.github.com/users/ivan-redooc/events{/privacy}","received_events_url":"https://api.github.com/users/ivan-redooc/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-23T14:23:30Z","updated_at":"2021-04-23T14:24:34Z","body":"@mikehaertl I prefer \r\n\r\n```PHP\r\npublic function afterSave()\r\n{\r\n    if (Yii::$app->mutex->isAcquired('somekey')) {\r\n        // do dangerous things here....\r\n    }\r\n}\r\n```\r\n\r\nto \r\n\r\n```PHP\r\npublic function afterSave()\r\n{\r\n    if ($this->hasLock) {\r\n        // do dangerous things here....\r\n    }\r\n}\r\n\r\n```\r\nbecause the Mutex keeps the responsability to know own status. \r\n\r\nOf course an improve to the documentation of _isAcquired_ should be necessary.\r\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/yiisoft/yii2/issues/comments/825694610/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ivan-redooc","id":11387801,"node_id":"MDQ6VXNlcjExMzg3ODAx","avatar_url":"https://avatars.githubusercontent.com/u/11387801?v=4","gravatar_id":"","url":"https://api.github.com/users/ivan-redooc","html_url":"https://github.com/ivan-redooc","followers_url":"https://api.github.com/users/ivan-redooc/followers","following_url":"https://api.github.com/users/ivan-redooc/following{/other_user}","gists_url":"https://api.github.com/users/ivan-redooc/gists{/gist_id}","starred_url":"https://api.github.com/users/ivan-redooc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivan-redooc/subscriptions","organizations_url":"https://api.github.com/users/ivan-redooc/orgs","repos_url":"https://api.github.com/users/ivan-redooc/repos","events_url":"https://api.github.com/users/ivan-redooc/events{/privacy}","received_events_url":"https://api.github.com/users/ivan-redooc/received_events","type":"User","user_view_type":"public","site_admin":false}}]