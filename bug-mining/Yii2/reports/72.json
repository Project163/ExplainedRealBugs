{"url":"https://api.github.com/repos/yiisoft/yii2/issues/11725","repository_url":"https://api.github.com/repos/yiisoft/yii2","labels_url":"https://api.github.com/repos/yiisoft/yii2/issues/11725/labels{/name}","comments_url":"https://api.github.com/repos/yiisoft/yii2/issues/11725/comments","events_url":"https://api.github.com/repos/yiisoft/yii2/issues/11725/events","html_url":"https://github.com/yiisoft/yii2/issues/11725","id":159167423,"node_id":"MDU6SXNzdWUxNTkxNjc0MjM=","number":11725,"title":"Selecting data for translation","user":{"login":"OndrejVasicek","id":3864012,"node_id":"MDQ6VXNlcjM4NjQwMTI=","avatar_url":"https://avatars.githubusercontent.com/u/3864012?v=4","gravatar_id":"","url":"https://api.github.com/users/OndrejVasicek","html_url":"https://github.com/OndrejVasicek","followers_url":"https://api.github.com/users/OndrejVasicek/followers","following_url":"https://api.github.com/users/OndrejVasicek/following{/other_user}","gists_url":"https://api.github.com/users/OndrejVasicek/gists{/gist_id}","starred_url":"https://api.github.com/users/OndrejVasicek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/OndrejVasicek/subscriptions","organizations_url":"https://api.github.com/users/OndrejVasicek/orgs","repos_url":"https://api.github.com/users/OndrejVasicek/repos","events_url":"https://api.github.com/users/OndrejVasicek/events{/privacy}","received_events_url":"https://api.github.com/users/OndrejVasicek/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":33330692,"node_id":"MDU6TGFiZWwzMzMzMDY5Mg==","url":"https://api.github.com/repos/yiisoft/yii2/labels/status:under%20development","name":"status:under development","color":"0b02e1","default":false,"description":"Someone is working on a pull request."},{"id":33332028,"node_id":"MDU6TGFiZWwzMzMzMjAyOA==","url":"https://api.github.com/repos/yiisoft/yii2/labels/type:enhancement","name":"type:enhancement","color":"d7e102","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"samdark","id":47294,"node_id":"MDQ6VXNlcjQ3Mjk0","avatar_url":"https://avatars.githubusercontent.com/u/47294?v=4","gravatar_id":"","url":"https://api.github.com/users/samdark","html_url":"https://github.com/samdark","followers_url":"https://api.github.com/users/samdark/followers","following_url":"https://api.github.com/users/samdark/following{/other_user}","gists_url":"https://api.github.com/users/samdark/gists{/gist_id}","starred_url":"https://api.github.com/users/samdark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samdark/subscriptions","organizations_url":"https://api.github.com/users/samdark/orgs","repos_url":"https://api.github.com/users/samdark/repos","events_url":"https://api.github.com/users/samdark/events{/privacy}","received_events_url":"https://api.github.com/users/samdark/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"samdark","id":47294,"node_id":"MDQ6VXNlcjQ3Mjk0","avatar_url":"https://avatars.githubusercontent.com/u/47294?v=4","gravatar_id":"","url":"https://api.github.com/users/samdark","html_url":"https://github.com/samdark","followers_url":"https://api.github.com/users/samdark/followers","following_url":"https://api.github.com/users/samdark/following{/other_user}","gists_url":"https://api.github.com/users/samdark/gists{/gist_id}","starred_url":"https://api.github.com/users/samdark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samdark/subscriptions","organizations_url":"https://api.github.com/users/samdark/orgs","repos_url":"https://api.github.com/users/samdark/repos","events_url":"https://api.github.com/users/samdark/events{/privacy}","received_events_url":"https://api.github.com/users/samdark/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/yiisoft/yii2/milestones/17","html_url":"https://github.com/yiisoft/yii2/milestone/17","labels_url":"https://api.github.com/repos/yiisoft/yii2/milestones/17/labels","id":1580065,"node_id":"MDk6TWlsZXN0b25lMTU4MDA2NQ==","number":17,"title":"2.0.9","description":"","creator":{"login":"cebe","id":189796,"node_id":"MDQ6VXNlcjE4OTc5Ng==","avatar_url":"https://avatars.githubusercontent.com/u/189796?v=4","gravatar_id":"","url":"https://api.github.com/users/cebe","html_url":"https://github.com/cebe","followers_url":"https://api.github.com/users/cebe/followers","following_url":"https://api.github.com/users/cebe/following{/other_user}","gists_url":"https://api.github.com/users/cebe/gists{/gist_id}","starred_url":"https://api.github.com/users/cebe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cebe/subscriptions","organizations_url":"https://api.github.com/users/cebe/orgs","repos_url":"https://api.github.com/users/cebe/repos","events_url":"https://api.github.com/users/cebe/events{/privacy}","received_events_url":"https://api.github.com/users/cebe/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":153,"state":"closed","created_at":"2016-02-12T16:35:34Z","updated_at":"2017-05-23T21:32:15Z","due_on":"2016-07-09T07:00:00Z","closed_at":"2016-07-11T13:40:39Z"},"comments":14,"created_at":"2016-06-08T13:46:12Z","updated_at":"2016-06-25T12:49:29Z","closed_at":"2016-06-25T12:49:29Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### What steps will reproduce the problem?\n- using the 'yii\\i18n\\DbMessageSource' for translations\n- calling Yii:t() with sourceLanguage different  from language\n### What is the expected result?\n\nSome clean, performance-considering query. Something like this:\n\n``` SQL\nSELECT\n    \"t1\".\"message\" AS \"message\",\n    \"t2\".\"translation\" AS \"translation\"\nFROM\n    sp_source_message t1\nJOIN sp_message t2 ON (\"t1\".\"id\" = \"t2\".\"id\")\nWHERE\n    \"t1\".\"category\" = 'app'\nAND (\n    \"t2\".\"language\" = 'cs-CZ'\n    OR \"t2\".\"language\" = 'cs'\n)\n```\n### What do you get instead?\n\n``` SQL\n(\n    SELECT\n        \"t1\".\"message\" AS \"message\",\n        \"t2\".\"translation\" AS \"translation\"\n    FROM\n        \"sp_source_message\" \"t1\",\n        \"sp_message\" \"t2\"\n    WHERE\n        (\"t1\".\"id\" = \"t2\".\"id\")\n    AND (\"t1\".\"category\" = 'app')\n    AND (\"t2\".\"language\" = 'cs-CZ')\n)\nUNION ALL\n    (\n        SELECT\n            \"t1\".\"message\" AS \"message\",\n            \"t2\".\"translation\" AS \"translation\"\n        FROM\n            \"sp_source_message\" \"t1\",\n            \"sp_message\" \"t2\"\n        WHERE\n            (\n                (\"t1\".\"id\" = \"t2\".\"id\")\n                AND (\"t1\".\"category\" = 'app')\n                AND (\"t2\".\"language\" = 'cs')\n            )\n        AND (\n            \"t2\".\"id\" NOT IN (\n                SELECT\n                    \"id\"\n                FROM\n                    \"sp_message\"\n                WHERE\n                    \"language\" = 'cs-CZ'\n            )\n        )\n    )\n```\n### Additional info\n\nDo we really need to seek for the ‘cs-CZ’ form of language? In the message table is only ‘cs’. Probably because my translation setting for console.\nBut even though – maybe I’m missing something, but the original query with subqueries seems to be unnecessary and highly ineffective. There is no need to explain what it does. It’s quite clear.\n\nThe other thing are indexes. There aren’t any. For small web, it’s not a problem, but I think this is a great example, where inserting and updating are so rare, that the ratio for read/insert(update) is extremely high.\nSo I wouldn’t hesitate to put indexes on language and category columns. I know how indexes works and I know that in many cases, they will be useless, because the number of same content in these columns will be same. But it’s still far better situation to have useless index on table, where reading is much higher, then situation we have large message table with loads of categories and no indexes. At least the category column is important. But again – from the principal perspective… :)\nI know there is a caching option, but it just covers the problem.\n\n| Q | A |\n| --- | --- |\n| Yii version | 2.0.8 |\n| PHP version | 5.6.15 |\n| Operating system | Win10 |\n","closed_by":{"login":"samdark","id":47294,"node_id":"MDQ6VXNlcjQ3Mjk0","avatar_url":"https://avatars.githubusercontent.com/u/47294?v=4","gravatar_id":"","url":"https://api.github.com/users/samdark","html_url":"https://github.com/samdark","followers_url":"https://api.github.com/users/samdark/followers","following_url":"https://api.github.com/users/samdark/following{/other_user}","gists_url":"https://api.github.com/users/samdark/gists{/gist_id}","starred_url":"https://api.github.com/users/samdark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samdark/subscriptions","organizations_url":"https://api.github.com/users/samdark/orgs","repos_url":"https://api.github.com/users/samdark/repos","events_url":"https://api.github.com/users/samdark/events{/privacy}","received_events_url":"https://api.github.com/users/samdark/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/yiisoft/yii2/issues/11725/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/yiisoft/yii2/issues/11725/timeline","performed_via_github_app":null,"state_reason":"completed"}