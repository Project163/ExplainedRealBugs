{"url":"https://api.github.com/repos/yiisoft/yii2/issues/10405","repository_url":"https://api.github.com/repos/yiisoft/yii2","labels_url":"https://api.github.com/repos/yiisoft/yii2/issues/10405/labels{/name}","comments_url":"https://api.github.com/repos/yiisoft/yii2/issues/10405/comments","events_url":"https://api.github.com/repos/yiisoft/yii2/issues/10405/events","html_url":"https://github.com/yiisoft/yii2/issues/10405","id":122512252,"node_id":"MDU6SXNzdWUxMjI1MTIyNTI=","number":10405,"title":"Preflight Response while making a POST request.","user":{"login":"harshitchaudhary","id":4983996,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQ5ODM5OTY=","avatar_url":"https://avatars.githubusercontent.com/u/4983996?v=4","gravatar_id":"","url":"https://api.github.com/users/harshitchaudhary","html_url":"https://github.com/harshitchaudhary","followers_url":"https://api.github.com/users/harshitchaudhary/followers","following_url":"https://api.github.com/users/harshitchaudhary/following{/other_user}","gists_url":"https://api.github.com/users/harshitchaudhary/gists{/gist_id}","starred_url":"https://api.github.com/users/harshitchaudhary/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harshitchaudhary/subscriptions","organizations_url":"https://api.github.com/users/harshitchaudhary/orgs","repos_url":"https://api.github.com/users/harshitchaudhary/repos","events_url":"https://api.github.com/users/harshitchaudhary/events{/privacy}","received_events_url":"https://api.github.com/users/harshitchaudhary/received_events","type":"Organization","user_view_type":"public","site_admin":false},"labels":[{"id":33208865,"node_id":"MDU6TGFiZWwzMzIwODg2NQ==","url":"https://api.github.com/repos/yiisoft/yii2/labels/type:docs","name":"type:docs","color":"207de5","default":false,"description":"Documentation"},{"id":128432317,"node_id":"MDU6TGFiZWwxMjg0MzIzMTc=","url":"https://api.github.com/repos/yiisoft/yii2/labels/feature:rest","name":"feature:rest","color":"bfd4f2","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"cebe","id":189796,"node_id":"MDQ6VXNlcjE4OTc5Ng==","avatar_url":"https://avatars.githubusercontent.com/u/189796?v=4","gravatar_id":"","url":"https://api.github.com/users/cebe","html_url":"https://github.com/cebe","followers_url":"https://api.github.com/users/cebe/followers","following_url":"https://api.github.com/users/cebe/following{/other_user}","gists_url":"https://api.github.com/users/cebe/gists{/gist_id}","starred_url":"https://api.github.com/users/cebe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cebe/subscriptions","organizations_url":"https://api.github.com/users/cebe/orgs","repos_url":"https://api.github.com/users/cebe/repos","events_url":"https://api.github.com/users/cebe/events{/privacy}","received_events_url":"https://api.github.com/users/cebe/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"cebe","id":189796,"node_id":"MDQ6VXNlcjE4OTc5Ng==","avatar_url":"https://avatars.githubusercontent.com/u/189796?v=4","gravatar_id":"","url":"https://api.github.com/users/cebe","html_url":"https://github.com/cebe","followers_url":"https://api.github.com/users/cebe/followers","following_url":"https://api.github.com/users/cebe/following{/other_user}","gists_url":"https://api.github.com/users/cebe/gists{/gist_id}","starred_url":"https://api.github.com/users/cebe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cebe/subscriptions","organizations_url":"https://api.github.com/users/cebe/orgs","repos_url":"https://api.github.com/users/cebe/repos","events_url":"https://api.github.com/users/cebe/events{/privacy}","received_events_url":"https://api.github.com/users/cebe/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/yiisoft/yii2/milestones/17","html_url":"https://github.com/yiisoft/yii2/milestone/17","labels_url":"https://api.github.com/repos/yiisoft/yii2/milestones/17/labels","id":1580065,"node_id":"MDk6TWlsZXN0b25lMTU4MDA2NQ==","number":17,"title":"2.0.9","description":"","creator":{"login":"cebe","id":189796,"node_id":"MDQ6VXNlcjE4OTc5Ng==","avatar_url":"https://avatars.githubusercontent.com/u/189796?v=4","gravatar_id":"","url":"https://api.github.com/users/cebe","html_url":"https://github.com/cebe","followers_url":"https://api.github.com/users/cebe/followers","following_url":"https://api.github.com/users/cebe/following{/other_user}","gists_url":"https://api.github.com/users/cebe/gists{/gist_id}","starred_url":"https://api.github.com/users/cebe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cebe/subscriptions","organizations_url":"https://api.github.com/users/cebe/orgs","repos_url":"https://api.github.com/users/cebe/repos","events_url":"https://api.github.com/users/cebe/events{/privacy}","received_events_url":"https://api.github.com/users/cebe/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":153,"state":"closed","created_at":"2016-02-12T16:35:34Z","updated_at":"2017-05-23T21:32:15Z","due_on":"2016-07-09T07:00:00Z","closed_at":"2016-07-11T13:40:39Z"},"comments":1,"created_at":"2015-12-16T14:14:48Z","updated_at":"2016-06-20T15:14:38Z","closed_at":"2016-06-20T15:14:38Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I am trying to use Yii2 Rest to develop an APP. after Trying a lot am into an unknown issue. If I send a CORS request for the first time. I get this response, and keep getting this unless i do a tweak like I return the post data just after the actionFunction. This is my initial code\n\n``` php\nclass UserController extends Controller \n {\n    public function beforeAction($action) {\n        $this->enableCsrfValidation = false;\n        return parent::beforeAction($action);\n    }\n\n    public function actions()\n    {\n        $actions = parent::actions();\n        unset($actions['create']);\n\n        return [\n            'error' => [\n                'class' => 'yii\\web\\ErrorAction',\n            ],\n            'options' => [\n                'class' => 'app\\components\\OptionsAction',\n            ],\n\n        ];\n\n        //return $actions;\n    }\n\n    public function behaviors() {\n        $behaviors = parent::behaviors();\n\n        $behaviors['authenticator'] = [\n            'class' => HttpBearerAuth::className(),\n            'only' => ['dashboard'],\n        ];\n\n        $behaviors['contentNegotiator'] = [\n            'class' => ContentNegotiator::className(),\n            'formats' => [\n                'application/json' => Response::FORMAT_JSON,\n            ],\n        ];\n\n        $behaviors['corsFilter'] = [\n            'class' => \\yii\\filters\\Cors::className(),\n            'cors' => [\n                // restrict access to\n                'Origin' => ['http://192.168.0.108','http://localhost','*'],\n                'Access-Control-Request-Method' => ['GET', 'POST', 'OPTIONS', '*'],\n                // Allow only POST and PUT methods\n                'Access-Control-Request-Headers' => ['*'],\n                // Allow only headers 'X-Wsse'\n                'Access-Control-Allow-Credentials' => null,\n                // Allow OPTIONS caching\n                'Access-Control-Max-Age' => 86400,\n                // Allow the X-Pagination-Current-Page header to be exposed to the browser.\n                'Access-Control-Expose-Headers' => ['X-Pagination-Current-Page'],\n            ],     \n        ]; \n\n        return $behaviors ;\n    }\n\n    protected function verbs()\n    {\n        return [\n            'register' => ['POST','OPTIONS'],\n            'seller-details' => ['POST','OPTIONS'],\n            'address' => ['POST','OPTIONS'],\n            'login' => ['POST','OPTIONS'],\n            'index' => ['GET', 'HEAD'],\n            'view' => ['GET', 'HEAD'],\n            'create' => ['POST'],\n            'update' => ['PUT', 'PATCH'],\n            'delete' => ['DELETE'],         \n        ];\n    } \n```\n\n**and This is my actionFunction**\n\n``` php\npublic function actionAddress() {\n\n        $data = Yii::$app->request->post();\n        $seller = User::findIdentityByAccessToken($data['auth_key']);\n\n        $seller_address = new Addresses() ;\n\n        try {\n            $seller_address->id = '0' ;\n            $seller_address->user_id = $seller->id ;\n            $seller_address->fullName = $data['fullName'];\n            $seller_address->address1 = $data['address1'];\n            $seller_address->address2 = $data['address2'];\n            $seller_address->city = $data['city'];\n            $seller_address->zip = $data['zip'];\n            $seller_address->country = $data['country'];\n            $seller_address->phoneNumber = $data['phoneNumber'];\n            $seller_address->landmark = $data['landmark'];\n            $seller_address->addressType = $data['addressType'];\n            $seller_address->status = '0';\n\n            if(!($seller_address->save())) {\n                    $response = $seller_address->getErrors('fullName');\n                    if(!empty($response)) {\n                        throw new ErrorException(\"Please fill the Name\");\n                    }\n                    $response = $seller_address->getErrors('address1');\n                    if(!empty($response)) {\n                        throw new ErrorException(\"Please fill the address\");\n                    }\n                    $response = $seller_address->getErrors('city');\n                    if(!empty($response)) {\n                        throw new ErrorException(\"Please fill the city\");\n                    }\n                    $response = $seller_address->getErrors('zip');\n                    if(!empty($response)) {\n                        throw new ErrorException(\"Please fill the zip\");\n                    }\n                    $response = $seller_address->getErrors('country');\n                    if(!empty($response)) {\n                        throw new ErrorException(\"Please fill the country\");\n                    }\n                    $response = $seller_address->getErrors('phoneNumber');\n                    if(!empty($response)) {\n                        throw new ErrorException(\"Please fill the phone number\");\n                    }\n            }\n\n                $response = [\n                    'data' => $data,\n                    'message' => 'Seller address updated successfully',\n                ];\n\n                return $response;\n        }\n\n        catch(Exception $e) {\n            throw new Exception($e);\n\n        }\n\n    }\n```\n\n Here is the screenshot of the error\n![screen shot 2015-12-16 at 7 24 43 pm](https://cloud.githubusercontent.com/assets/4983996/11842889/8be2ec56-a42c-11e5-892a-c753534057a8.png)\n# I made this change into my actionFunction\n\n``` php\npublic function actionAddress() {\n\n        $data = Yii::$app->request->post();\n                return $data ; // I returned the data here \n        $seller = User::findIdentityByAccessToken($data['auth_key']);\n\n        $seller_address = new Addresses() ;\n\n        try {\n            $seller_address->id = '0' ;\n            $seller_address->user_id = $seller->id ;\n            $seller_address->fullName = $data['fullName'];\n            $seller_address->address1 = $data['address1'];\n            $seller_address->address2 = $data['address2'];\n            $seller_address->city = $data['city'];\n            $seller_address->zip = $data['zip'];\n            $seller_address->country = $data['country'];\n            $seller_address->phoneNumber = $data['phoneNumber'];\n            $seller_address->landmark = $data['landmark'];\n            $seller_address->addressType = $data['addressType'];\n            $seller_address->status = '0';\n\n            if(!($seller_address->save())) {\n                    $response = $seller_address->getErrors('fullName');\n                    if(!empty($response)) {\n                        throw new ErrorException(\"Please fill the Name\");\n                    }\n                    $response = $seller_address->getErrors('address1');\n                    if(!empty($response)) {\n                        throw new ErrorException(\"Please fill the address\");\n                    }\n                    $response = $seller_address->getErrors('city');\n                    if(!empty($response)) {\n                        throw new ErrorException(\"Please fill the city\");\n                    }\n                    $response = $seller_address->getErrors('zip');\n                    if(!empty($response)) {\n                        throw new ErrorException(\"Please fill the zip\");\n                    }\n                    $response = $seller_address->getErrors('country');\n                    if(!empty($response)) {\n                        throw new ErrorException(\"Please fill the country\");\n                    }\n                    $response = $seller_address->getErrors('phoneNumber');\n                    if(!empty($response)) {\n                        throw new ErrorException(\"Please fill the phone number\");\n                    }\n            }\n\n                $response = [\n                    'data' => $data,\n                    'message' => 'Seller address updated successfully',\n                ];\n\n                return $response;\n        }\n\n        catch(Exception $e) {\n            throw new Exception($e);\n\n        }\n\n    }\n```\n\n**After returning this data I reverted my actionFunction to the original state and It worked afterwards for every request**\n\nHere is the screenshot for the success\n\n![screen shot 2015-12-16 at 7 42 19 pm](https://cloud.githubusercontent.com/assets/4983996/11843022/35133b50-a42d-11e5-97c8-ba526dc0fa0b.png)\n\nThis happened to my every function, for some function it worked with the same configuration. I am not sure why this is happening I tried searching on google and issues up here on github but cant resolve this. Any suggestion is welcomed.\n","closed_by":{"login":"cebe","id":189796,"node_id":"MDQ6VXNlcjE4OTc5Ng==","avatar_url":"https://avatars.githubusercontent.com/u/189796?v=4","gravatar_id":"","url":"https://api.github.com/users/cebe","html_url":"https://github.com/cebe","followers_url":"https://api.github.com/users/cebe/followers","following_url":"https://api.github.com/users/cebe/following{/other_user}","gists_url":"https://api.github.com/users/cebe/gists{/gist_id}","starred_url":"https://api.github.com/users/cebe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cebe/subscriptions","organizations_url":"https://api.github.com/users/cebe/orgs","repos_url":"https://api.github.com/users/cebe/repos","events_url":"https://api.github.com/users/cebe/events{/privacy}","received_events_url":"https://api.github.com/users/cebe/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/yiisoft/yii2/issues/10405/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/yiisoft/yii2/issues/10405/timeline","performed_via_github_app":null,"state_reason":"completed"}