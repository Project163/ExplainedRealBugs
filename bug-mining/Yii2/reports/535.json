{"url":"https://api.github.com/repos/yiisoft/yii2/issues/15850","repository_url":"https://api.github.com/repos/yiisoft/yii2","labels_url":"https://api.github.com/repos/yiisoft/yii2/issues/15850/labels{/name}","comments_url":"https://api.github.com/repos/yiisoft/yii2/issues/15850/comments","events_url":"https://api.github.com/repos/yiisoft/yii2/issues/15850/events","html_url":"https://github.com/yiisoft/yii2/issues/15850","id":303189792,"node_id":"MDU6SXNzdWUzMDMxODk3OTI=","number":15850,"title":"AssetManager unnecessarily checks for writable basePath when not configured to publish any assets","user":{"login":"monzol","id":5273472,"node_id":"MDQ6VXNlcjUyNzM0NzI=","avatar_url":"https://avatars.githubusercontent.com/u/5273472?v=4","gravatar_id":"","url":"https://api.github.com/users/monzol","html_url":"https://github.com/monzol","followers_url":"https://api.github.com/users/monzol/followers","following_url":"https://api.github.com/users/monzol/following{/other_user}","gists_url":"https://api.github.com/users/monzol/gists{/gist_id}","starred_url":"https://api.github.com/users/monzol/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/monzol/subscriptions","organizations_url":"https://api.github.com/users/monzol/orgs","repos_url":"https://api.github.com/users/monzol/repos","events_url":"https://api.github.com/users/monzol/events{/privacy}","received_events_url":"https://api.github.com/users/monzol/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":33208443,"node_id":"MDU6TGFiZWwzMzIwODQ0Mw==","url":"https://api.github.com/repos/yiisoft/yii2/labels/type:bug","name":"type:bug","color":"e102d8","default":false,"description":"Bug"},{"id":33330247,"node_id":"MDU6TGFiZWwzMzMzMDI0Nw==","url":"https://api.github.com/repos/yiisoft/yii2/labels/status:ready%20for%20adoption","name":"status:ready for adoption","color":"02e10c","default":false,"description":"Feel free to implement this issue."}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/yiisoft/yii2/milestones/25","html_url":"https://github.com/yiisoft/yii2/milestone/25","labels_url":"https://api.github.com/repos/yiisoft/yii2/milestones/25/labels","id":2562828,"node_id":"MDk6TWlsZXN0b25lMjU2MjgyOA==","number":25,"title":"2.0.16","description":"","creator":{"login":"cebe","id":189796,"node_id":"MDQ6VXNlcjE4OTc5Ng==","avatar_url":"https://avatars.githubusercontent.com/u/189796?v=4","gravatar_id":"","url":"https://api.github.com/users/cebe","html_url":"https://github.com/cebe","followers_url":"https://api.github.com/users/cebe/followers","following_url":"https://api.github.com/users/cebe/following{/other_user}","gists_url":"https://api.github.com/users/cebe/gists{/gist_id}","starred_url":"https://api.github.com/users/cebe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cebe/subscriptions","organizations_url":"https://api.github.com/users/cebe/orgs","repos_url":"https://api.github.com/users/cebe/repos","events_url":"https://api.github.com/users/cebe/events{/privacy}","received_events_url":"https://api.github.com/users/cebe/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":291,"state":"closed","created_at":"2017-06-05T18:03:36Z","updated_at":"2019-01-30T23:57:22Z","due_on":"2019-02-01T08:00:00Z","closed_at":"2019-01-30T23:57:22Z"},"comments":4,"created_at":"2018-03-07T17:28:07Z","updated_at":"2018-12-15T22:54:22Z","closed_at":"2018-12-15T22:54:22Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### What steps will reproduce the problem?\r\n- Configure AssetManager to use assets already in web accessible folder or external assets from CDN\r\n- Set permission on assets folder to read-only (755) (this is a standard security measure on our production servers)\r\n\r\n### What is the expected result?\r\nUse the configured assets without publishing or checking for writable publish path\r\n\r\n### What do you get instead?\r\nInvalid Configuration â€“ yii\\base\\InvalidConfigException\r\nThe directory is not writable by the Web process: /var/www/htdocs/admin/assets\r\n1. in /var/www/includes/vendor/yiisoft/yii2/web/AssetManager.php at line 215\r\n\r\n### Additional info\r\nMy AssetManager config:\r\n```\r\nreturn [\r\n    // Map file names to external resources\r\n    'assetMap' => [\r\n        'jquery.js'         => \"//ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.js\",\r\n        'bootstrap.css'     => \"//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.css\",\r\n        'bootstrap.js'      => \"//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.js\",\r\n    ],\r\n\r\n    // Do not publish Yii assets and dependencies\r\n    'bundles' => [\r\n        'yii\\web\\YiiAsset'                   => false,\r\n        'yii\\web\\JqueryAsset'                => false,\r\n        'yii\\bootstrap\\BootstrapAsset'       => false,\r\n        'yii\\bootstrap\\BootstrapPluginAsset' => false,\r\n    ],\r\n];\r\n```\r\nMy AppAsset class:\r\n```\r\nclass AppAsset extends AssetBundle\r\n{\r\n    public $basePath = false;\r\n    public $baseUrl = '@web/assets';\r\n\r\n    public $css = [\r\n        'bootstrap.css',\r\n    ];\r\n\r\n    public $js = [\r\n        'jquery.js',\r\n        'bootstrap.js',\r\n        'js/yii.js',\r\n        'js/yii.activeForm.js',\r\n        'js/yii.captcha.js',\r\n        'js/yii.gridView.js',\r\n        'js/yii.validation.js',\r\n    ];\r\n\r\n    public $depends = [ ];\r\n}\r\n```\r\n\r\n| Q                | A\r\n| ---------------- | ---\r\n| Yii version      | 2.0.14.1\r\n| PHP version      | 5.6.31\r\n| Operating system | Linux CentOS 7\r\n\r\nThe problem is caused by the AssetManager::init() method where the basePath is checked if it's an existing and writable directory regardless of the need for such check. \r\n\r\nCould this check be moved from the init() method to somewhere where it's more relevant and only perform the check when asset publishing is involved?\r\n\r\nMy workaround for now is to point the basePath to a writable directory, which is currently the yii-runtime, even though nothing gets published there. This satisfies the check in AssetManager::init(). The other workaround would be to override the init() method but I don't want that in case new functionality is added in later versions.\r\n\r\n","closed_by":{"login":"samdark","id":47294,"node_id":"MDQ6VXNlcjQ3Mjk0","avatar_url":"https://avatars.githubusercontent.com/u/47294?v=4","gravatar_id":"","url":"https://api.github.com/users/samdark","html_url":"https://github.com/samdark","followers_url":"https://api.github.com/users/samdark/followers","following_url":"https://api.github.com/users/samdark/following{/other_user}","gists_url":"https://api.github.com/users/samdark/gists{/gist_id}","starred_url":"https://api.github.com/users/samdark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samdark/subscriptions","organizations_url":"https://api.github.com/users/samdark/orgs","repos_url":"https://api.github.com/users/samdark/repos","events_url":"https://api.github.com/users/samdark/events{/privacy}","received_events_url":"https://api.github.com/users/samdark/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/yiisoft/yii2/issues/15850/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/yiisoft/yii2/issues/15850/timeline","performed_via_github_app":null,"state_reason":"completed"}