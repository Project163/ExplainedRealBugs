{"url":"https://api.github.com/repos/yiisoft/yii2/issues/16092","repository_url":"https://api.github.com/repos/yiisoft/yii2","labels_url":"https://api.github.com/repos/yiisoft/yii2/issues/16092/labels{/name}","comments_url":"https://api.github.com/repos/yiisoft/yii2/issues/16092/comments","events_url":"https://api.github.com/repos/yiisoft/yii2/issues/16092/events","html_url":"https://github.com/yiisoft/yii2/issues/16092","id":313912790,"node_id":"MDU6SXNzdWUzMTM5MTI3OTA=","number":16092,"title":"ActiveRecord: innerJoinWith('foo')->joinWith('foo.bar') = duplicate join on 'foo'","user":{"login":"jurchiks","id":542788,"node_id":"MDQ6VXNlcjU0Mjc4OA==","avatar_url":"https://avatars.githubusercontent.com/u/542788?v=4","gravatar_id":"","url":"https://api.github.com/users/jurchiks","html_url":"https://github.com/jurchiks","followers_url":"https://api.github.com/users/jurchiks/followers","following_url":"https://api.github.com/users/jurchiks/following{/other_user}","gists_url":"https://api.github.com/users/jurchiks/gists{/gist_id}","starred_url":"https://api.github.com/users/jurchiks/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jurchiks/subscriptions","organizations_url":"https://api.github.com/users/jurchiks/orgs","repos_url":"https://api.github.com/users/jurchiks/repos","events_url":"https://api.github.com/users/jurchiks/events{/privacy}","received_events_url":"https://api.github.com/users/jurchiks/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":33208443,"node_id":"MDU6TGFiZWwzMzIwODQ0Mw==","url":"https://api.github.com/repos/yiisoft/yii2/labels/type:bug","name":"type:bug","color":"e102d8","default":false,"description":"Bug"},{"id":115010082,"node_id":"MDU6TGFiZWwxMTUwMTAwODI=","url":"https://api.github.com/repos/yiisoft/yii2/labels/feature:db","name":"feature:db","color":"bfd4f2","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/yiisoft/yii2/milestones/50","html_url":"https://github.com/yiisoft/yii2/milestone/50","labels_url":"https://api.github.com/repos/yiisoft/yii2/milestones/50/labels","id":5003263,"node_id":"MDk6TWlsZXN0b25lNTAwMzI2Mw==","number":50,"title":"2.0.33","description":"","creator":{"login":"samdark","id":47294,"node_id":"MDQ6VXNlcjQ3Mjk0","avatar_url":"https://avatars.githubusercontent.com/u/47294?v=4","gravatar_id":"","url":"https://api.github.com/users/samdark","html_url":"https://github.com/samdark","followers_url":"https://api.github.com/users/samdark/followers","following_url":"https://api.github.com/users/samdark/following{/other_user}","gists_url":"https://api.github.com/users/samdark/gists{/gist_id}","starred_url":"https://api.github.com/users/samdark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samdark/subscriptions","organizations_url":"https://api.github.com/users/samdark/orgs","repos_url":"https://api.github.com/users/samdark/repos","events_url":"https://api.github.com/users/samdark/events{/privacy}","received_events_url":"https://api.github.com/users/samdark/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":53,"state":"closed","created_at":"2020-01-14T10:54:09Z","updated_at":"2020-03-24T20:06:00Z","due_on":null,"closed_at":"2020-03-24T20:06:00Z"},"comments":2,"created_at":"2018-04-12T22:45:04Z","updated_at":"2020-03-04T14:57:27Z","closed_at":"2020-03-04T14:57:12Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Have the following relations defined (some obvious things ommitted for brevity):\r\n\r\n```php\r\n/** @property int $bar_id */\r\nclass Foo extends ActiveRecord {\r\n    public function getBar() {\r\n        return $this->hasOne(Bar::class, ['id' => 'bar_id']);\r\n    }\r\n}\r\n\r\n/**\r\n * @property int $id\r\n * @property int $baz_id\r\n */\r\nclass Bar extends ActiveRecord {\r\n    public function getBaz() {\r\n        return $this->hasOne(Baz::class, ['id' => 'baz_id']);\r\n    }\r\n}\r\n\r\n/** @property int $id */\r\nclass Baz extends ActiveRecord {}\r\n```\r\nExecute a query like this:\r\n\r\n```php\r\nFoo::find()\r\n    ->innerJoinWith('bar')\r\n    ->joinWith('bar.baz')\r\n    ->all();\r\n```\r\n\r\n### What is the expected result?\r\n\r\n```php\r\nSELECT foo.*\r\nFROM foo\r\nINNER JOIN bar ON bar.id = foo.bar_id\r\nLEFT JOIN baz ON baz.id = bar.baz_id\r\n```\r\n\r\n### What do you get instead?\r\n\r\n```php\r\nSELECT foo.*\r\nFROM foo\r\nINNER JOIN bar ON bar.id = foo.bar_id\r\nLEFT JOIN bar ON bar.id = foo.bar_id <----- the problem\r\nLEFT JOIN baz ON baz.id = bar.baz_id\r\n```\r\n\r\nI did not find a solution for this in the docs, nor did I find existing bugs that describe this. Perhaps this is already solved in some way that is simply not documented, but if so, then it is still an issue as this seemingly intuitive code just doesn't work.\r\n\r\n\r\n### Additional info\r\n\r\n| Q                | A\r\n| ---------------- | ---\r\n| Yii version      | 2.0.15.1\r\n| PHP version      | 7.0.28\r\n| Operating system | Windows 7 Enterprise\r\n","closed_by":{"login":"samdark","id":47294,"node_id":"MDQ6VXNlcjQ3Mjk0","avatar_url":"https://avatars.githubusercontent.com/u/47294?v=4","gravatar_id":"","url":"https://api.github.com/users/samdark","html_url":"https://github.com/samdark","followers_url":"https://api.github.com/users/samdark/followers","following_url":"https://api.github.com/users/samdark/following{/other_user}","gists_url":"https://api.github.com/users/samdark/gists{/gist_id}","starred_url":"https://api.github.com/users/samdark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samdark/subscriptions","organizations_url":"https://api.github.com/users/samdark/orgs","repos_url":"https://api.github.com/users/samdark/repos","events_url":"https://api.github.com/users/samdark/events{/privacy}","received_events_url":"https://api.github.com/users/samdark/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/yiisoft/yii2/issues/16092/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/yiisoft/yii2/issues/16092/timeline","performed_via_github_app":null,"state_reason":"completed"}