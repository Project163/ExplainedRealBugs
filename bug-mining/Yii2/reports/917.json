{"url":"https://api.github.com/repos/yiisoft/yii2/issues/20437","repository_url":"https://api.github.com/repos/yiisoft/yii2","labels_url":"https://api.github.com/repos/yiisoft/yii2/issues/20437/labels{/name}","comments_url":"https://api.github.com/repos/yiisoft/yii2/issues/20437/comments","events_url":"https://api.github.com/repos/yiisoft/yii2/issues/20437/events","html_url":"https://github.com/yiisoft/yii2/issues/20437","id":3201799506,"node_id":"I_kwDOADRbGc6-15VS","number":20437,"title":"PHPStan/Psalm annotations for ArrayHelper::merge wrong","user":{"login":"EvilKarter","id":3779278,"node_id":"MDQ6VXNlcjM3NzkyNzg=","avatar_url":"https://avatars.githubusercontent.com/u/3779278?v=4","gravatar_id":"","url":"https://api.github.com/users/EvilKarter","html_url":"https://github.com/EvilKarter","followers_url":"https://api.github.com/users/EvilKarter/followers","following_url":"https://api.github.com/users/EvilKarter/following{/other_user}","gists_url":"https://api.github.com/users/EvilKarter/gists{/gist_id}","starred_url":"https://api.github.com/users/EvilKarter/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/EvilKarter/subscriptions","organizations_url":"https://api.github.com/users/EvilKarter/orgs","repos_url":"https://api.github.com/users/EvilKarter/repos","events_url":"https://api.github.com/users/EvilKarter/events{/privacy}","received_events_url":"https://api.github.com/users/EvilKarter/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2025-07-04T08:27:59Z","updated_at":"2025-07-08T08:36:08Z","closed_at":"2025-07-08T08:36:08Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I believe that the Psalm annotations for ArrayHelper::merge are wrong. \n\nI have the following example code: \n```php\n$array1 = [\n    'id'    => '1',\n    'class' => [\n        'a',\n        'b',\n        'c',\n    ],\n];\n$array2 = [\n    'id'    => '2',\n    'class' => [\n        'd',\n    ],\n];\n$result= ArrayHelper::merge($array1, $array2);\n``` \nHowever, this always causes the following psalm error: \n\n```shell\nERROR: InvalidArgument\nArgument 2 of yii\\helpers\\ArrayHelper::merge expects array<array-key, array<mixed, mixed>>, but array{class: list{'d'}, id: '2'} provided (see https://psalm.dev/004)\n``` \n\nI think the Problem is the following: \n```php\n@psalm-param array<array<TKeyB, TValueB>> ...$b\n``` \nThis implies that each element in the variadic $b is itself an array of arrays. In other words, Psalm would expect something like:\n```php\nArrayHelper::merge($a, [['x' => 1], ['y' => 2]]);\n``` \nBut in your actual usage, you're calling it like:\n```php\nArrayHelper::merge(['a' => 1], ['b' => 2], ['c' => 3]);\n``` \nEach argument after $a is a single array â€” not an array of arrays. So this annotation would be too strict and incorrect for the actual usage.\n\nSorry I'm no Psalm expert, but shouldn't the annotation look more like this?\n\n```php\n     * @phpstan-param array<TKeyA, TValueA> $a\n     * @phpstan-param array<TKeyB, TValueB> ...$b\n     * @psalm-param array<TKeyA, TValueA> $a\n     * @psalm-param array<TKeyB, TValueB> ...$b\n``` ","closed_by":{"login":"samdark","id":47294,"node_id":"MDQ6VXNlcjQ3Mjk0","avatar_url":"https://avatars.githubusercontent.com/u/47294?v=4","gravatar_id":"","url":"https://api.github.com/users/samdark","html_url":"https://github.com/samdark","followers_url":"https://api.github.com/users/samdark/followers","following_url":"https://api.github.com/users/samdark/following{/other_user}","gists_url":"https://api.github.com/users/samdark/gists{/gist_id}","starred_url":"https://api.github.com/users/samdark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samdark/subscriptions","organizations_url":"https://api.github.com/users/samdark/orgs","repos_url":"https://api.github.com/users/samdark/repos","events_url":"https://api.github.com/users/samdark/events{/privacy}","received_events_url":"https://api.github.com/users/samdark/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/yiisoft/yii2/issues/20437/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/yiisoft/yii2/issues/20437/timeline","performed_via_github_app":null,"state_reason":"completed"}