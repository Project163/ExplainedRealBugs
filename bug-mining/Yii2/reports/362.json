{"url":"https://api.github.com/repos/yiisoft/yii2/issues/14134","repository_url":"https://api.github.com/repos/yiisoft/yii2","labels_url":"https://api.github.com/repos/yiisoft/yii2/issues/14134/labels{/name}","comments_url":"https://api.github.com/repos/yiisoft/yii2/issues/14134/comments","events_url":"https://api.github.com/repos/yiisoft/yii2/issues/14134/events","html_url":"https://github.com/yiisoft/yii2/issues/14134","id":227730325,"node_id":"MDU6SXNzdWUyMjc3MzAzMjU=","number":14134,"title":"Multiple validateAttribute() calls when scenarios() returns duplicate attributes","user":{"login":"krukru","id":10072630,"node_id":"MDQ6VXNlcjEwMDcyNjMw","avatar_url":"https://avatars.githubusercontent.com/u/10072630?v=4","gravatar_id":"","url":"https://api.github.com/users/krukru","html_url":"https://github.com/krukru","followers_url":"https://api.github.com/users/krukru/followers","following_url":"https://api.github.com/users/krukru/following{/other_user}","gists_url":"https://api.github.com/users/krukru/gists{/gist_id}","starred_url":"https://api.github.com/users/krukru/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/krukru/subscriptions","organizations_url":"https://api.github.com/users/krukru/orgs","repos_url":"https://api.github.com/users/krukru/repos","events_url":"https://api.github.com/users/krukru/events{/privacy}","received_events_url":"https://api.github.com/users/krukru/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":33208443,"node_id":"MDU6TGFiZWwzMzIwODQ0Mw==","url":"https://api.github.com/repos/yiisoft/yii2/labels/type:bug","name":"type:bug","color":"e102d8","default":false,"description":"Bug"}],"state":"closed","locked":false,"assignee":{"login":"samdark","id":47294,"node_id":"MDQ6VXNlcjQ3Mjk0","avatar_url":"https://avatars.githubusercontent.com/u/47294?v=4","gravatar_id":"","url":"https://api.github.com/users/samdark","html_url":"https://github.com/samdark","followers_url":"https://api.github.com/users/samdark/followers","following_url":"https://api.github.com/users/samdark/following{/other_user}","gists_url":"https://api.github.com/users/samdark/gists{/gist_id}","starred_url":"https://api.github.com/users/samdark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samdark/subscriptions","organizations_url":"https://api.github.com/users/samdark/orgs","repos_url":"https://api.github.com/users/samdark/repos","events_url":"https://api.github.com/users/samdark/events{/privacy}","received_events_url":"https://api.github.com/users/samdark/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"samdark","id":47294,"node_id":"MDQ6VXNlcjQ3Mjk0","avatar_url":"https://avatars.githubusercontent.com/u/47294?v=4","gravatar_id":"","url":"https://api.github.com/users/samdark","html_url":"https://github.com/samdark","followers_url":"https://api.github.com/users/samdark/followers","following_url":"https://api.github.com/users/samdark/following{/other_user}","gists_url":"https://api.github.com/users/samdark/gists{/gist_id}","starred_url":"https://api.github.com/users/samdark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samdark/subscriptions","organizations_url":"https://api.github.com/users/samdark/orgs","repos_url":"https://api.github.com/users/samdark/repos","events_url":"https://api.github.com/users/samdark/events{/privacy}","received_events_url":"https://api.github.com/users/samdark/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/yiisoft/yii2/milestones/23","html_url":"https://github.com/yiisoft/yii2/milestone/23","labels_url":"https://api.github.com/repos/yiisoft/yii2/milestones/23/labels","id":2082378,"node_id":"MDk6TWlsZXN0b25lMjA4MjM3OA==","number":23,"title":"2.0.13","description":"","creator":{"login":"cebe","id":189796,"node_id":"MDQ6VXNlcjE4OTc5Ng==","avatar_url":"https://avatars.githubusercontent.com/u/189796?v=4","gravatar_id":"","url":"https://api.github.com/users/cebe","html_url":"https://github.com/cebe","followers_url":"https://api.github.com/users/cebe/followers","following_url":"https://api.github.com/users/cebe/following{/other_user}","gists_url":"https://api.github.com/users/cebe/gists{/gist_id}","starred_url":"https://api.github.com/users/cebe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cebe/subscriptions","organizations_url":"https://api.github.com/users/cebe/orgs","repos_url":"https://api.github.com/users/cebe/repos","events_url":"https://api.github.com/users/cebe/events{/privacy}","received_events_url":"https://api.github.com/users/cebe/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":342,"state":"closed","created_at":"2016-10-20T12:05:24Z","updated_at":"2018-03-21T16:57:33Z","due_on":"2017-07-09T07:00:00Z","closed_at":"2017-11-02T22:18:20Z"},"comments":10,"created_at":"2017-05-10T16:01:07Z","updated_at":"2017-10-07T17:40:28Z","closed_at":"2017-10-07T17:40:28Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Consider the following snippet\r\n```php\r\n    // some model class\r\n    public function scenarios()\r\n    {\r\n        return [\r\n            Model::SCENARIO_DEFAULT => [\r\n                'foo',\r\n                'foo',\r\n            ],\r\n        ];\r\n    }\r\n\r\n    public function rules()\r\n    {\r\n        return [\r\n            ['foo', 'required'],\r\n            ['foo', 'customFunction'],\r\n            ['foo', 'filter', 'filter' => 'boolval'],\r\n        ];\r\n    }\r\n```\r\n\r\nThen when performing validation, all of the validation rules will be triggered twice, since the same attribute has been returned twice from ```scenarios()```. This does not have to be the default scenario, it could be your custom defined scenario.\r\n\r\nOf course this is an obvious client mistake, you should not return foo twice, but when you have a more complex case, for example when merging with ```parent::scenarios()```, you could end up with the same mistake. \r\n\r\nI think that the framework should simply ignore attributes that have already been validated. If some attribute passed a validator once, it should obviously pass it twice as well and the second validation is not needed. Other then the minor performance waste, there is no real issue when the validator is idempotent.\r\nHowever filters, custom functions and probably other things need not be idempotent, so calling them multiple times might produce an unwanted result.\r\n\r\nOne example is if you have a filter that converts a unix timestamp to a datetime string.","closed_by":{"login":"samdark","id":47294,"node_id":"MDQ6VXNlcjQ3Mjk0","avatar_url":"https://avatars.githubusercontent.com/u/47294?v=4","gravatar_id":"","url":"https://api.github.com/users/samdark","html_url":"https://github.com/samdark","followers_url":"https://api.github.com/users/samdark/followers","following_url":"https://api.github.com/users/samdark/following{/other_user}","gists_url":"https://api.github.com/users/samdark/gists{/gist_id}","starred_url":"https://api.github.com/users/samdark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samdark/subscriptions","organizations_url":"https://api.github.com/users/samdark/orgs","repos_url":"https://api.github.com/users/samdark/repos","events_url":"https://api.github.com/users/samdark/events{/privacy}","received_events_url":"https://api.github.com/users/samdark/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/yiisoft/yii2/issues/14134/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/yiisoft/yii2/issues/14134/timeline","performed_via_github_app":null,"state_reason":"completed"}