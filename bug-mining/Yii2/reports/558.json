{"url":"https://api.github.com/repos/yiisoft/yii2/issues/17093","repository_url":"https://api.github.com/repos/yiisoft/yii2","labels_url":"https://api.github.com/repos/yiisoft/yii2/issues/17093/labels{/name}","comments_url":"https://api.github.com/repos/yiisoft/yii2/issues/17093/comments","events_url":"https://api.github.com/repos/yiisoft/yii2/issues/17093/events","html_url":"https://github.com/yiisoft/yii2/issues/17093","id":405820869,"node_id":"MDU6SXNzdWU0MDU4MjA4Njk=","number":17093,"title":"Wrong DataProvider->totalCount","user":{"login":"anditza","id":3636841,"node_id":"MDQ6VXNlcjM2MzY4NDE=","avatar_url":"https://avatars.githubusercontent.com/u/3636841?v=4","gravatar_id":"","url":"https://api.github.com/users/anditza","html_url":"https://github.com/anditza","followers_url":"https://api.github.com/users/anditza/followers","following_url":"https://api.github.com/users/anditza/following{/other_user}","gists_url":"https://api.github.com/users/anditza/gists{/gist_id}","starred_url":"https://api.github.com/users/anditza/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/anditza/subscriptions","organizations_url":"https://api.github.com/users/anditza/orgs","repos_url":"https://api.github.com/users/anditza/repos","events_url":"https://api.github.com/users/anditza/events{/privacy}","received_events_url":"https://api.github.com/users/anditza/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":33208443,"node_id":"MDU6TGFiZWwzMzIwODQ0Mw==","url":"https://api.github.com/repos/yiisoft/yii2/labels/type:bug","name":"type:bug","color":"e102d8","default":false,"description":"Bug"},{"id":92646963,"node_id":"MDU6TGFiZWw5MjY0Njk2Mw==","url":"https://api.github.com/repos/yiisoft/yii2/labels/severity:important","name":"severity:important","color":"eb6420","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/yiisoft/yii2/milestones/35","html_url":"https://github.com/yiisoft/yii2/milestone/35","labels_url":"https://api.github.com/repos/yiisoft/yii2/milestones/35/labels","id":4018731,"node_id":"MDk6TWlsZXN0b25lNDAxODczMQ==","number":35,"title":"2.0.16.1","description":"","creator":{"login":"samdark","id":47294,"node_id":"MDQ6VXNlcjQ3Mjk0","avatar_url":"https://avatars.githubusercontent.com/u/47294?v=4","gravatar_id":"","url":"https://api.github.com/users/samdark","html_url":"https://github.com/samdark","followers_url":"https://api.github.com/users/samdark/followers","following_url":"https://api.github.com/users/samdark/following{/other_user}","gists_url":"https://api.github.com/users/samdark/gists{/gist_id}","starred_url":"https://api.github.com/users/samdark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samdark/subscriptions","organizations_url":"https://api.github.com/users/samdark/orgs","repos_url":"https://api.github.com/users/samdark/repos","events_url":"https://api.github.com/users/samdark/events{/privacy}","received_events_url":"https://api.github.com/users/samdark/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":15,"state":"closed","created_at":"2019-01-31T16:24:20Z","updated_at":"2019-03-20T17:43:25Z","due_on":null,"closed_at":"2019-02-28T07:12:08Z"},"comments":11,"created_at":"2019-02-01T18:29:20Z","updated_at":"2019-02-22T21:29:29Z","closed_at":"2019-02-22T21:29:29Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\nPlease use this issue tracker for bugs and feature requests only. In case you need support please use one of\r\nYii communities listed at https://github.com/yiisoft/yii2/wiki/communities\r\n-->\r\n\r\nWrong DataProvider->totalCount \r\n\r\n### What steps will reproduce the problem?\r\n```php\r\n$query = MyModel::find();\r\n$dataProvider = new ActiveDataProvider(['query' => $query);\r\n$dataProvider->pagination->pageSize = 30;\r\n//    Now $dataProvider->totalCount is set because of BaseDataProvider::getPagination()\r\n$query->andFilterWhere(['number' => $this->number]);\r\n//    From now on totalCount is NOT updated to consider this condition and any other conditions added before feeding it to a GridView and rendering.\r\n```\r\n\r\n### What is the expected result?\r\ntotalCount should be set only when DataProvider gets to be used to fetch and render data.\r\nUp to version 12.0.15 DataProvider pagination could be invoked and set before setting all its query conditions and afterwards totalCount was calculated correctly as expected.\r\n\r\n### What do you get instead?\r\nDataProvider totalCount is wrong - total number of rows in the table!! - doesn't care about query conditions added after invoking $dataProvider->pagination.\r\n\r\n### Additional info\r\nRelated issue: https://github.com/yiisoft/yii2/issues/16891\r\n\r\n| Q                | A\r\n| ---------------- | ---\r\n| Yii version      | 2.0.16\r\n| PHP version      | 7.*\r\n| Operating system |Windows/Linux\r\n","closed_by":{"login":"samdark","id":47294,"node_id":"MDQ6VXNlcjQ3Mjk0","avatar_url":"https://avatars.githubusercontent.com/u/47294?v=4","gravatar_id":"","url":"https://api.github.com/users/samdark","html_url":"https://github.com/samdark","followers_url":"https://api.github.com/users/samdark/followers","following_url":"https://api.github.com/users/samdark/following{/other_user}","gists_url":"https://api.github.com/users/samdark/gists{/gist_id}","starred_url":"https://api.github.com/users/samdark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samdark/subscriptions","organizations_url":"https://api.github.com/users/samdark/orgs","repos_url":"https://api.github.com/users/samdark/repos","events_url":"https://api.github.com/users/samdark/events{/privacy}","received_events_url":"https://api.github.com/users/samdark/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/yiisoft/yii2/issues/17093/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/yiisoft/yii2/issues/17093/timeline","performed_via_github_app":null,"state_reason":"completed"}