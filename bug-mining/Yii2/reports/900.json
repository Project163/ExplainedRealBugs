{"url":"https://api.github.com/repos/yiisoft/yii2/issues/20191","repository_url":"https://api.github.com/repos/yiisoft/yii2","labels_url":"https://api.github.com/repos/yiisoft/yii2/issues/20191/labels{/name}","comments_url":"https://api.github.com/repos/yiisoft/yii2/issues/20191/comments","events_url":"https://api.github.com/repos/yiisoft/yii2/issues/20191/events","html_url":"https://github.com/yiisoft/yii2/issues/20191","id":2339134212,"node_id":"I_kwDOADRbGc6LbFsE","number":20191,"title":"ActiveRecord::getDirtyAttributes() not working for JSON columns with multi-dimensional arrays","user":{"login":"brandonkelly","id":47792,"node_id":"MDQ6VXNlcjQ3Nzky","avatar_url":"https://avatars.githubusercontent.com/u/47792?v=4","gravatar_id":"","url":"https://api.github.com/users/brandonkelly","html_url":"https://github.com/brandonkelly","followers_url":"https://api.github.com/users/brandonkelly/followers","following_url":"https://api.github.com/users/brandonkelly/following{/other_user}","gists_url":"https://api.github.com/users/brandonkelly/gists{/gist_id}","starred_url":"https://api.github.com/users/brandonkelly/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brandonkelly/subscriptions","organizations_url":"https://api.github.com/users/brandonkelly/orgs","repos_url":"https://api.github.com/users/brandonkelly/repos","events_url":"https://api.github.com/users/brandonkelly/events{/privacy}","received_events_url":"https://api.github.com/users/brandonkelly/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/yiisoft/yii2/milestones/76","html_url":"https://github.com/yiisoft/yii2/milestone/76","labels_url":"https://api.github.com/repos/yiisoft/yii2/milestones/76/labels","id":11122084,"node_id":"MI_kwDOADRbGc4AqbWk","number":76,"title":"2.0.51","description":"","creator":{"login":"samdark","id":47294,"node_id":"MDQ6VXNlcjQ3Mjk0","avatar_url":"https://avatars.githubusercontent.com/u/47294?v=4","gravatar_id":"","url":"https://api.github.com/users/samdark","html_url":"https://github.com/samdark","followers_url":"https://api.github.com/users/samdark/followers","following_url":"https://api.github.com/users/samdark/following{/other_user}","gists_url":"https://api.github.com/users/samdark/gists{/gist_id}","starred_url":"https://api.github.com/users/samdark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samdark/subscriptions","organizations_url":"https://api.github.com/users/samdark/orgs","repos_url":"https://api.github.com/users/samdark/repos","events_url":"https://api.github.com/users/samdark/events{/privacy}","received_events_url":"https://api.github.com/users/samdark/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":29,"state":"closed","created_at":"2024-05-31T07:16:21Z","updated_at":"2024-07-18T19:51:03Z","due_on":null,"closed_at":"2024-07-18T19:51:03Z"},"comments":1,"created_at":"2024-06-06T20:51:39Z","updated_at":"2024-06-08T07:31:28Z","closed_at":"2024-06-08T07:31:27Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\nPlease use this issue tracker for bugs and feature requests only. In case you need support please use one of\r\nYii communities listed at https://github.com/yiisoft/yii2/wiki/communities\r\n-->\r\n\r\n### What steps will reproduce the problem?\r\n\r\n1. Create a DB table with a JSON column, and an ActiveRecord class for it.\r\n2. Create a row and set the JSON column to the value:\r\n   ```json\r\n   {\"foo\": [\"c\", \"b\", \"a\"]}\r\n   ```\r\n3. Run the following code:\r\n   ```php\r\n   $record = MyActiveRecord::findOne();\r\n   $record->jsonColumnName = [\r\n       'foo' => ['b', 'c', 'a'],\r\n   ];\r\n   $record->save();\r\n\r\n### What is the expected result?\r\n\r\nThe new value will save.\r\n\r\n### What do you get instead?\r\n\r\nThe new value isnâ€™t saved, because `ActiveRecord::isValueDifferent()` will return `false` for `jsonColumnName`.\r\n\r\nThis happens because `isValueDifferent()` normalizes each value with `ArrayHelper::recursiveSort()`, which sorts the array and all nested arrays using either `sort()` (if indexed) or `ksort` (if associative).\r\n\r\nThe intent seems to be to only do this for associative arrays, which probably makes sense since the order of values is generally not important for associative arrays. But it should definitely not be happening for non-associative arrays.\r\n\r\nhttps://github.com/yiisoft/yii2/blob/d9d168b036158ba2b3f139bf5155c0bb4b093d20/framework/db/BaseActiveRecord.php#L1784-L1787\r\n\r\n### Additional info\r\n\r\n| Q                | A\r\n| ---------------- | ---\r\n| Yii version      | 2.0.45, 2.0.50\r\n| PHP version      | n/a\r\n| Operating system | n/a\r\n","closed_by":{"login":"samdark","id":47294,"node_id":"MDQ6VXNlcjQ3Mjk0","avatar_url":"https://avatars.githubusercontent.com/u/47294?v=4","gravatar_id":"","url":"https://api.github.com/users/samdark","html_url":"https://github.com/samdark","followers_url":"https://api.github.com/users/samdark/followers","following_url":"https://api.github.com/users/samdark/following{/other_user}","gists_url":"https://api.github.com/users/samdark/gists{/gist_id}","starred_url":"https://api.github.com/users/samdark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samdark/subscriptions","organizations_url":"https://api.github.com/users/samdark/orgs","repos_url":"https://api.github.com/users/samdark/repos","events_url":"https://api.github.com/users/samdark/events{/privacy}","received_events_url":"https://api.github.com/users/samdark/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/yiisoft/yii2/issues/20191/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/yiisoft/yii2/issues/20191/timeline","performed_via_github_app":null,"state_reason":"completed"}