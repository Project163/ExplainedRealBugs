{"url":"https://api.github.com/repos/yiisoft/yii2/issues/11870","repository_url":"https://api.github.com/repos/yiisoft/yii2","labels_url":"https://api.github.com/repos/yiisoft/yii2/issues/11870/labels{/name}","comments_url":"https://api.github.com/repos/yiisoft/yii2/issues/11870/comments","events_url":"https://api.github.com/repos/yiisoft/yii2/issues/11870/events","html_url":"https://github.com/yiisoft/yii2/issues/11870","id":163528747,"node_id":"MDU6SXNzdWUxNjM1Mjg3NDc=","number":11870,"title":"Docs Guide (input-multiple-models.md) - Example assumes PK id's are in sync","user":{"login":"CyberPunkCodes","id":9557392,"node_id":"MDQ6VXNlcjk1NTczOTI=","avatar_url":"https://avatars.githubusercontent.com/u/9557392?v=4","gravatar_id":"","url":"https://api.github.com/users/CyberPunkCodes","html_url":"https://github.com/CyberPunkCodes","followers_url":"https://api.github.com/users/CyberPunkCodes/followers","following_url":"https://api.github.com/users/CyberPunkCodes/following{/other_user}","gists_url":"https://api.github.com/users/CyberPunkCodes/gists{/gist_id}","starred_url":"https://api.github.com/users/CyberPunkCodes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/CyberPunkCodes/subscriptions","organizations_url":"https://api.github.com/users/CyberPunkCodes/orgs","repos_url":"https://api.github.com/users/CyberPunkCodes/repos","events_url":"https://api.github.com/users/CyberPunkCodes/events{/privacy}","received_events_url":"https://api.github.com/users/CyberPunkCodes/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":33208865,"node_id":"MDU6TGFiZWwzMzIwODg2NQ==","url":"https://api.github.com/repos/yiisoft/yii2/labels/type:docs","name":"type:docs","color":"207de5","default":false,"description":"Documentation"}],"state":"closed","locked":false,"assignee":{"login":"samdark","id":47294,"node_id":"MDQ6VXNlcjQ3Mjk0","avatar_url":"https://avatars.githubusercontent.com/u/47294?v=4","gravatar_id":"","url":"https://api.github.com/users/samdark","html_url":"https://github.com/samdark","followers_url":"https://api.github.com/users/samdark/followers","following_url":"https://api.github.com/users/samdark/following{/other_user}","gists_url":"https://api.github.com/users/samdark/gists{/gist_id}","starred_url":"https://api.github.com/users/samdark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samdark/subscriptions","organizations_url":"https://api.github.com/users/samdark/orgs","repos_url":"https://api.github.com/users/samdark/repos","events_url":"https://api.github.com/users/samdark/events{/privacy}","received_events_url":"https://api.github.com/users/samdark/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"samdark","id":47294,"node_id":"MDQ6VXNlcjQ3Mjk0","avatar_url":"https://avatars.githubusercontent.com/u/47294?v=4","gravatar_id":"","url":"https://api.github.com/users/samdark","html_url":"https://github.com/samdark","followers_url":"https://api.github.com/users/samdark/followers","following_url":"https://api.github.com/users/samdark/following{/other_user}","gists_url":"https://api.github.com/users/samdark/gists{/gist_id}","starred_url":"https://api.github.com/users/samdark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samdark/subscriptions","organizations_url":"https://api.github.com/users/samdark/orgs","repos_url":"https://api.github.com/users/samdark/repos","events_url":"https://api.github.com/users/samdark/events{/privacy}","received_events_url":"https://api.github.com/users/samdark/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":3,"created_at":"2016-07-02T17:42:03Z","updated_at":"2016-07-02T21:27:21Z","closed_at":"2016-07-02T18:10:22Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I noticed that in the example on this page: [https://github.com/yiisoft/yii2/blob/master/docs/guide/input-multiple-models.md](https://github.com/yiisoft/yii2/blob/master/docs/guide/input-multiple-models.md)\n\nThe `UserController`'s `actionUpdate` function assumes that the `user` table's primary key and the `user_profile` table's primary key are in sync. This may not always be the case, and is likely to cause issues for users down the road (and during development).\n\nIt would be better to use the relation's foreign key which maps back to the user table. Example in \"solution\" below.\n\nMy `user` table is stock from advanced migration example. So the `id` is auto-incrementing primary key.\n\nIn my `user_profile` table, I have:\n\n```\nid (auto incrementing primary key), user_id (foreign key to user table's id column), nicename, phone, address, etc, etc.\n```\n\nIn the example, using `findOne($id)`, it is grabbing the current model/user id and trying to find that same id in the user_profile table. This would generally work. However, say you manually create a `user_profile`, the incremental value of the id would now be 1 higher than the user table. Until you manually go into your database and fix the incremental value, it will always be 1 off. **If it is off, it will grab the wrong profile!!!**\n### Solution\n\nClip of what the docs should show:\n\n`https://github.com/yiisoft/yii2/blob/master/docs/guide/input-multiple-models.md`\n\n```\nclass UserController extends Controller\n{\n    public function actionUpdate($id)\n    {\n        $user = User::findOne($id);\n        $profile = Profile::findOne(['user_id' => $id]);  // <-- fix\n        // -- truncated\n    }\n}\n```\n\nI understand that not everyone may have `user_id` column, they may name it something else. So I am not sure how to \"officially\" doc this. I am just pointing out the possible issue.\n### Alternative Solution\n\nSince not everyone will use the same column names, maybe in their `Profile` model, they can make their own `findProfile()` function.\n\n```\npublic static function findProfile($userId)\n{\n    return self::findOne(['user_id' => $userId]);  // replace 'user_id' with your column name\n}\n```\n\nThen call it in `UserController`:\n\n```\n$profile = Profile::findProfile($id);\n```\n","closed_by":{"login":"samdark","id":47294,"node_id":"MDQ6VXNlcjQ3Mjk0","avatar_url":"https://avatars.githubusercontent.com/u/47294?v=4","gravatar_id":"","url":"https://api.github.com/users/samdark","html_url":"https://github.com/samdark","followers_url":"https://api.github.com/users/samdark/followers","following_url":"https://api.github.com/users/samdark/following{/other_user}","gists_url":"https://api.github.com/users/samdark/gists{/gist_id}","starred_url":"https://api.github.com/users/samdark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samdark/subscriptions","organizations_url":"https://api.github.com/users/samdark/orgs","repos_url":"https://api.github.com/users/samdark/repos","events_url":"https://api.github.com/users/samdark/events{/privacy}","received_events_url":"https://api.github.com/users/samdark/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/yiisoft/yii2/issues/11870/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/yiisoft/yii2/issues/11870/timeline","performed_via_github_app":null,"state_reason":"completed"}