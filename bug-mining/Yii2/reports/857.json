{"url":"https://api.github.com/repos/yiisoft/yii2/issues/19520","repository_url":"https://api.github.com/repos/yiisoft/yii2","labels_url":"https://api.github.com/repos/yiisoft/yii2/issues/19520/labels{/name}","comments_url":"https://api.github.com/repos/yiisoft/yii2/issues/19520/comments","events_url":"https://api.github.com/repos/yiisoft/yii2/issues/19520/events","html_url":"https://github.com/yiisoft/yii2/issues/19520","id":1348201388,"node_id":"I_kwDOADRbGc5QW-us","number":19520,"title":"Model Save Fails with Azure Table with RowVersion","user":{"login":"DPineault","id":20864806,"node_id":"MDQ6VXNlcjIwODY0ODA2","avatar_url":"https://avatars.githubusercontent.com/u/20864806?v=4","gravatar_id":"","url":"https://api.github.com/users/DPineault","html_url":"https://github.com/DPineault","followers_url":"https://api.github.com/users/DPineault/followers","following_url":"https://api.github.com/users/DPineault/following{/other_user}","gists_url":"https://api.github.com/users/DPineault/gists{/gist_id}","starred_url":"https://api.github.com/users/DPineault/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DPineault/subscriptions","organizations_url":"https://api.github.com/users/DPineault/orgs","repos_url":"https://api.github.com/users/DPineault/repos","events_url":"https://api.github.com/users/DPineault/events{/privacy}","received_events_url":"https://api.github.com/users/DPineault/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":247756568,"node_id":"MDU6TGFiZWwyNDc3NTY1Njg=","url":"https://api.github.com/repos/yiisoft/yii2/labels/MSSQL","name":"MSSQL","color":"006b75","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/yiisoft/yii2/milestones/69","html_url":"https://github.com/yiisoft/yii2/milestone/69","labels_url":"https://api.github.com/repos/yiisoft/yii2/milestones/69/labels","id":8306238,"node_id":"MI_kwDOADRbGc4Afr4-","number":69,"title":"2.0.47","description":"","creator":{"login":"samdark","id":47294,"node_id":"MDQ6VXNlcjQ3Mjk0","avatar_url":"https://avatars.githubusercontent.com/u/47294?v=4","gravatar_id":"","url":"https://api.github.com/users/samdark","html_url":"https://github.com/samdark","followers_url":"https://api.github.com/users/samdark/followers","following_url":"https://api.github.com/users/samdark/following{/other_user}","gists_url":"https://api.github.com/users/samdark/gists{/gist_id}","starred_url":"https://api.github.com/users/samdark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samdark/subscriptions","organizations_url":"https://api.github.com/users/samdark/orgs","repos_url":"https://api.github.com/users/samdark/repos","events_url":"https://api.github.com/users/samdark/events{/privacy}","received_events_url":"https://api.github.com/users/samdark/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":57,"state":"closed","created_at":"2022-08-15T10:51:50Z","updated_at":"2022-11-18T16:26:42Z","due_on":null,"closed_at":"2022-11-18T16:26:42Z"},"comments":8,"created_at":"2022-08-23T16:15:33Z","updated_at":"2022-11-13T18:27:06Z","closed_at":"2022-11-13T18:27:01Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I originally posted: https://forum.yiiframework.com/t/support-for-sql-server-rowversion/134283 and was directed here.\r\n\r\nI have a longstanding yii2 app that I recently added a RowVersion column to a table and now the Create action fails.\r\n\r\n```\r\n{“name”:“Integrity constraint violation”,“message”:“SQLSTATE[23000]: [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Cannot insert an explicit value into a timestamp column. Use INSERT with a column list to exclude the timestamp column, or insert a DEFAULT into the timestamp column.\\nThe SQL being executed was: SET NOCOUNT ON;DECLARE @temporary_inserted TABLE ([EmpId] int , [EmpNo] int NULL, [FirstName] nvarchar(255) , [LastName] nvarchar(255) NULL, [Company] nvarchar(255) NULL, [TitleId] int NULL, [Address1] nvarchar(255) NULL, [Address2] nvarchar(255) NULL, [CityId] int NULL, [ProvId] int NULL, [CountryId] int NULL, [PostalCode] nvarchar(255) NULL, [BusinessTel] nvarchar(50) NULL, [BusinessTelExt] nvarchar(50) NULL, [HomeTel] nvarchar(50) NULL, [CellularTel] nvarchar(50) NULL, [Fax] nvarchar(50) NULL, [Email] nvarchar(255) NULL, [URL] nvarchar(255) NULL, [Notes] nvarchar(500) NULL, [SpecialNotes] nvarchar(255) NULL, [DL] date NULL, [Ins] date NULL, [CurrencyCode] nvarchar(3) NULL, [TaxRateId] int , [ContractorAgreement] smallint , [ContractorAgreementDt] date NULL, [Active] smallint NULL, [XeroContactId] nchar(36) NULL, [dtCreation] datetime2 NULL, [dtModification] datetime2 NULL, [OldEmployeeId] int NULL, [RV] timestamp );INSERT INTO [employees] ([FirstName], [LastName], [Company], [TitleId], [Address1], [Address2], [CountryId], [ProvId], [CityId], [PostalCode], [BusinessTel], [BusinessTelExt], [HomeTel], [CellularTel], [Fax], [Email], [URL], [Notes], [SpecialNotes], [CurrencyCode], [TaxRateId], [ContractorAgreement], [ContractorAgreementDt], [Active], [EmpNo], [dtCreation], [RV], [OldEmployeeId], [dtModification]) OUTPUT INSERTED.[EmpId],INSERTED.[EmpNo],INSERTED.[FirstName],INSERTED.[LastName],INSERTED.[Company],INSERTED.[TitleId],INSERTED.[Address1],INSERTED.[Address2],INSERTED.[CityId],INSERTED.[ProvId],INSERTED.[CountryId],INSERTED.[PostalCode],INSERTED.[BusinessTel],INSERTED.[BusinessTelExt],INSERTED.[HomeTel],INSERTED.[CellularTel],INSERTED.[Fax],INSERTED.[Email],INSERTED.[URL],INSERTED.[Notes],INSERTED.[SpecialNotes],INSERTED.[DL],INSERTED.[Ins],INSERTED.[CurrencyCode],INSERTED.[TaxRateId],INSERTED.[ContractorAgreement],INSERTED.[ContractorAgreementDt],INSERTED.[Active],INSERTED.[XeroContactId],INSERTED.[dtCreation],INSERTED.[dtModification],INSERTED.[OldEmployeeId],INSERTED.[RV] INTO @temporary_inserted VALUES (‘j’, ‘tiemmens’, ‘jt’, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, ‘USD’, 21, 0, NULL, 1, 2182, ‘2022-08-18 19:21:55’, DEFAULT, NULL, NULL);SELECT * FROM @temporary_inserted”,“code”:“23000”,“type”:“yii\\db\\IntegrityException”,“file”:“D:\\home\\site\\vendor\\yiisoft\\yii2\\db\\Schema.php”,“line”:676,“stack-trace”:[\"#0 D:\\home\\site\\vendor\\yiisoft\\yii2\\db\\Command.php(1307): yii\\db\\Schema->convertException()\",\"#1 D:\\home\\site\\vendor\\yiisoft\\yii2\\db\\Command.php(1102): yii\\db\\Command->internalExecute()\",\"#2 D:\\home\\site\\vendor\\yiisoft\\yii2\\db\\mssql\\Schema.php(782): yii\\db\\Command->execute()\",\"#3 D:\\home\\site\\vendor\\yiisoft\\yii2\\db\\ActiveRecord.php(604): yii\\db\\mssql\\Schema->insert()\",\"#4 D:\\home\\site\\vendor\\yiisoft\\yii2\\db\\ActiveRecord.php(570): yii\\db\\ActiveRecord->insertInternal()\",\"#5 D:\\home\\site\\vendor\\yiisoft\\yii2\\db\\BaseActiveRecord.php(676): yii\\db\\ActiveRecord->insert()\",\"#6 D:\\home\\site\\backend\\controllers\\EmployeesController.php(545): yii\\db\\BaseActiveRecord->save()\",\"#7 D:\\home\\site\\backend\\controllers\\EmployeesController.php(192): backend\\controllers\\EmployeesController->saveEmployee()\",\"#8 [internal function]: backend\\controllers\\EmployeesController->actionCreate()\",\"#9 D:\\home\\site\\vendor\\yiisoft\\yii2\\base\\InlineAction.php(57): call_user_func_array()\",\"#10 D:\\home\\site\\vendor\\yiisoft\\yii2\\base\\Controller.php(178): yii\\base\\InlineAction->runWithParams()\",\"#11 D:\\home\\site\\vendor\\yiisoft\\yii2\\base\\Module.php(552): yii\\base\\Controller->runAction()\",\"#12 D:\\home\\site\\vendor\\yiisoft\\yii2\\web\\Application.php(103): yii\\base\\Module->runAction()\",\"#13 D:\\home\\site\\vendor\\yiisoft\\yii2\\base\\Application.php(384): yii\\web\\Application->handleRequest()\",\"#14 D:\\home\\site\\wwwroot\\admin\\index.php(17): yii\\base\\Application->run()\",\"#15 {main}\"],“error-info”:[“23000”,273,\"[Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Cannot insert an explicit value into a timestamp column. Use INSERT with a column list to exclude the timestamp column, or insert a DEFAULT into the timestamp column.\"],“previous”:{“name”:“Exception”,“message”:“SQLSTATE[23000]: [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Cannot insert an explicit value into a timestamp column. Use INSERT with a column list to exclude the timestamp column, or insert a DEFAULT into the timestamp column.”,“code”:“23000”,“type”:“PDOException”,“file”:“D:\\home\\site\\vendor\\yiisoft\\yii2\\db\\Command.php”,“line”:1302,“stack-trace”:[\"#0 D:\\home\\site\\vendor\\yiisoft\\yii2\\db\\Command.php(1302): PDOStatement->execute()\",\"#1 D:\\home\\site\\vendor\\yiisoft\\yii2\\db\\Command.php(1102): yii\\db\\Command->internalExecute()\",\"#2 D:\\home\\site\\vendor\\yiisoft\\yii2\\db\\mssql\\Schema.php(782): yii\\db\\Command->execute()\",\"#3 D:\\home\\site\\vendor\\yiisoft\\yii2\\db\\ActiveRecord.php(604): yii\\db\\mssql\\Schema->insert()\",\"#4 D:\\home\\site\\vendor\\yiisoft\\yii2\\db\\ActiveRecord.php(570): yii\\db\\ActiveRecord->insertInternal()\",\"#5 D:\\home\\site\\vendor\\yiisoft\\yii2\\db\\BaseActiveRecord.php(676): yii\\db\\ActiveRecord->insert()\",\"#6 D:\\home\\site\\backend\\controllers\\EmployeesController.php(545): yii\\db\\BaseActiveRecord->save()\",\"#7 D:\\home\\site\\backend\\controllers\\EmployeesController.php(192): backend\\controllers\\EmployeesController->saveEmployee()\",\"#8 [internal function]: backend\\controllers\\EmployeesController->actionCreate()\",\"#9 D:\\home\\site\\vendor\\yiisoft\\yii2\\base\\InlineAction.php(57): call_user_func_array()\",\"#10 D:\\home\\site\\vendor\\yiisoft\\yii2\\base\\Controller.php(178): yii\\base\\InlineAction->runWithParams()\",\"#11 D:\\home\\site\\vendor\\yiisoft\\yii2\\base\\Module.php(552): yii\\base\\Controller->runAction()\",\"#12 D:\\home\\site\\vendor\\yiisoft\\yii2\\web\\Application.php(103): yii\\base\\Module->runAction()\",\"#13 D:\\home\\site\\vendor\\yiisoft\\yii2\\base\\Application.php(384): yii\\web\\Application->handleRequest()\",\"#14 D:\\home\\site\\wwwroot\\admin\\index.php(17): yii\\base\\Application->run()\",\"#15 {main}\"]}}\r\n```\r\n\r\nbased on help provided in the original thread, I tried listing the column to include in the save so as to exclude the RowVersion column\r\n\r\n```\r\n$model->save(false, [\r\n                'EmpId', 'EmpNo', 'FirstName', 'LastName', 'Company', 'TitleId', 'Address1', 'Address2', 'CountryId', 'ProvId', 'CityId', 'PostalCode',\r\n                'BusinessTel', 'BusinessTelExt', 'HomeTel', 'CellularTel', 'Fax', 'Email', 'URL', 'Notes', 'SpecialNotes', 'CurrencyCode', 'TaxRateId', 'ContractorAgreement',\r\n                'ContractorAgreementDt', 'Active', 'XeroContactId', 'dtCreation', 'dtModification', 'OldEmployeeId'\r\n            ])\r\n```\r\n\r\nEven with no validation and excluding the column in question (RV) it still results in the exact same error.\r\n\r\n\r\nI also created a trigger in the server to omit any RV value being passed.  I tested in SSMS and it work, but yii still errs before actually sending the info to the server.\r\n\r\n\r\nSince this has broken my app, I am going to hard code the INSERT (save) to get it back operational, but would love to know if this is a bug or something I am doing wrong.","closed_by":{"login":"samdark","id":47294,"node_id":"MDQ6VXNlcjQ3Mjk0","avatar_url":"https://avatars.githubusercontent.com/u/47294?v=4","gravatar_id":"","url":"https://api.github.com/users/samdark","html_url":"https://github.com/samdark","followers_url":"https://api.github.com/users/samdark/followers","following_url":"https://api.github.com/users/samdark/following{/other_user}","gists_url":"https://api.github.com/users/samdark/gists{/gist_id}","starred_url":"https://api.github.com/users/samdark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samdark/subscriptions","organizations_url":"https://api.github.com/users/samdark/orgs","repos_url":"https://api.github.com/users/samdark/repos","events_url":"https://api.github.com/users/samdark/events{/privacy}","received_events_url":"https://api.github.com/users/samdark/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/yiisoft/yii2/issues/19520/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/yiisoft/yii2/issues/19520/timeline","performed_via_github_app":null,"state_reason":"completed"}