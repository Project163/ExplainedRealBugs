{"url":"https://api.github.com/repos/yiisoft/yii2/issues/17878","repository_url":"https://api.github.com/repos/yiisoft/yii2","labels_url":"https://api.github.com/repos/yiisoft/yii2/issues/17878/labels{/name}","comments_url":"https://api.github.com/repos/yiisoft/yii2/issues/17878/comments","events_url":"https://api.github.com/repos/yiisoft/yii2/issues/17878/events","html_url":"https://github.com/yiisoft/yii2/issues/17878","id":567793863,"node_id":"MDU6SXNzdWU1Njc3OTM4NjM=","number":17878,"title":"\\yii\\web\\Request does not detect cross-origin Ajax requests","user":{"login":"dicrtarasov","id":35159934,"node_id":"MDQ6VXNlcjM1MTU5OTM0","avatar_url":"https://avatars.githubusercontent.com/u/35159934?v=4","gravatar_id":"","url":"https://api.github.com/users/dicrtarasov","html_url":"https://github.com/dicrtarasov","followers_url":"https://api.github.com/users/dicrtarasov/followers","following_url":"https://api.github.com/users/dicrtarasov/following{/other_user}","gists_url":"https://api.github.com/users/dicrtarasov/gists{/gist_id}","starred_url":"https://api.github.com/users/dicrtarasov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dicrtarasov/subscriptions","organizations_url":"https://api.github.com/users/dicrtarasov/orgs","repos_url":"https://api.github.com/users/dicrtarasov/repos","events_url":"https://api.github.com/users/dicrtarasov/events{/privacy}","received_events_url":"https://api.github.com/users/dicrtarasov/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":33208443,"node_id":"MDU6TGFiZWwzMzIwODQ0Mw==","url":"https://api.github.com/repos/yiisoft/yii2/labels/type:bug","name":"type:bug","color":"e102d8","default":false,"description":"Bug"},{"id":33330247,"node_id":"MDU6TGFiZWwzMzMzMDI0Nw==","url":"https://api.github.com/repos/yiisoft/yii2/labels/status:ready%20for%20adoption","name":"status:ready for adoption","color":"02e10c","default":false,"description":"Feel free to implement this issue."}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/yiisoft/yii2/milestones/50","html_url":"https://github.com/yiisoft/yii2/milestone/50","labels_url":"https://api.github.com/repos/yiisoft/yii2/milestones/50/labels","id":5003263,"node_id":"MDk6TWlsZXN0b25lNTAwMzI2Mw==","number":50,"title":"2.0.33","description":"","creator":{"login":"samdark","id":47294,"node_id":"MDQ6VXNlcjQ3Mjk0","avatar_url":"https://avatars.githubusercontent.com/u/47294?v=4","gravatar_id":"","url":"https://api.github.com/users/samdark","html_url":"https://github.com/samdark","followers_url":"https://api.github.com/users/samdark/followers","following_url":"https://api.github.com/users/samdark/following{/other_user}","gists_url":"https://api.github.com/users/samdark/gists{/gist_id}","starred_url":"https://api.github.com/users/samdark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samdark/subscriptions","organizations_url":"https://api.github.com/users/samdark/orgs","repos_url":"https://api.github.com/users/samdark/repos","events_url":"https://api.github.com/users/samdark/events{/privacy}","received_events_url":"https://api.github.com/users/samdark/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":53,"state":"closed","created_at":"2020-01-14T10:54:09Z","updated_at":"2020-03-24T20:06:00Z","due_on":null,"closed_at":"2020-03-24T20:06:00Z"},"comments":10,"created_at":"2020-02-19T19:30:52Z","updated_at":"2020-03-26T09:31:20Z","closed_at":"2020-02-19T22:11:15Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"\\yii\\web\\Request:getIsAjax()\r\n```php\r\npublic function getIsAjax()\r\n{\r\n    return $this->headers->get('X-Requested-With') === 'XMLHttpRequest';\r\n}\r\n```\r\n\r\nBut, for the cross-origin ajax requests, send by browser `XMLHttpRequest` (or modern `fetch API`)  dows not contains `XMLHttpRequest` headers.  \r\n\r\nHow to reproduce:\r\n1) configure Cors filter to allow accepting cross-origin requests.\r\nFor Apache:\r\n```\r\nHeader setifempty Access-Control-Allow-Origin \"*\"\r\nHeader setifempty Access-Control-Allow-Methods \"GET\"\r\n```\r\nFor Yii:\r\n```php\r\npublic function behaviors()\r\n{\r\n    return ['cors' => \\yii\\filters\\Cors::class];\r\n}\r\n```\r\n\r\n2) send cross-origin request from browser console to different your site:\r\n```\r\nfetch('http://mysite.ru')\r\n```\r\nRequest headers:\r\n```\r\nGET / HTTP/1.1\r\nHost: mysite.ru\r\nConnection: keep-alive\r\nPragma: no-cache\r\nCache-Control: no-cache\r\nSec-Fetch-Dest: empty\r\nUser-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.106 Safari/537.36\r\nDNT: 1\r\nAccept: */*\r\nOrigin: http://localhost:3000\r\nSec-Fetch-Site: cross-site\r\nSec-Fetch-Mode: cors\r\nReferer: http://localhost:3000\r\nAccept-Encoding: gzip, deflate, br\r\nAccept-Language: ru,en;q=0.9,uk;q=0.8,und;q=0.7\r\n```\r\n\r\nThere is no longer the usual `XMLHttpRequest` header, but, there are 2 new headers:\r\n`Sec-Fetch-Mode: cors` and \r\n`Sec-Fetch-Site: cross-site`\r\n\r\n`Yii::$app->request->isAjax` give `false`..... I propose to add `Sec-Fetch-Mode` header in `getIsAjax`.\r\n","closed_by":{"login":"samdark","id":47294,"node_id":"MDQ6VXNlcjQ3Mjk0","avatar_url":"https://avatars.githubusercontent.com/u/47294?v=4","gravatar_id":"","url":"https://api.github.com/users/samdark","html_url":"https://github.com/samdark","followers_url":"https://api.github.com/users/samdark/followers","following_url":"https://api.github.com/users/samdark/following{/other_user}","gists_url":"https://api.github.com/users/samdark/gists{/gist_id}","starred_url":"https://api.github.com/users/samdark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samdark/subscriptions","organizations_url":"https://api.github.com/users/samdark/orgs","repos_url":"https://api.github.com/users/samdark/repos","events_url":"https://api.github.com/users/samdark/events{/privacy}","received_events_url":"https://api.github.com/users/samdark/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/yiisoft/yii2/issues/17878/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/yiisoft/yii2/issues/17878/timeline","performed_via_github_app":null,"state_reason":"completed"}