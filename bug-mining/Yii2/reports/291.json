{"url":"https://api.github.com/repos/yiisoft/yii2/issues/14211","repository_url":"https://api.github.com/repos/yiisoft/yii2","labels_url":"https://api.github.com/repos/yiisoft/yii2/issues/14211/labels{/name}","comments_url":"https://api.github.com/repos/yiisoft/yii2/issues/14211/comments","events_url":"https://api.github.com/repos/yiisoft/yii2/issues/14211/events","html_url":"https://github.com/yiisoft/yii2/issues/14211","id":231393311,"node_id":"MDU6SXNzdWUyMzEzOTMzMTE=","number":14211,"title":"Possible bug in UniqueValidator.php line 288 for table aliases","user":{"login":"afeique","id":766889,"node_id":"MDQ6VXNlcjc2Njg4OQ==","avatar_url":"https://avatars.githubusercontent.com/u/766889?v=4","gravatar_id":"","url":"https://api.github.com/users/afeique","html_url":"https://github.com/afeique","followers_url":"https://api.github.com/users/afeique/followers","following_url":"https://api.github.com/users/afeique/following{/other_user}","gists_url":"https://api.github.com/users/afeique/gists{/gist_id}","starred_url":"https://api.github.com/users/afeique/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/afeique/subscriptions","organizations_url":"https://api.github.com/users/afeique/orgs","repos_url":"https://api.github.com/users/afeique/repos","events_url":"https://api.github.com/users/afeique/events{/privacy}","received_events_url":"https://api.github.com/users/afeique/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":33208443,"node_id":"MDU6TGFiZWwzMzIwODQ0Mw==","url":"https://api.github.com/repos/yiisoft/yii2/labels/type:bug","name":"type:bug","color":"e102d8","default":false,"description":"Bug"}],"state":"closed","locked":false,"assignee":{"login":"samdark","id":47294,"node_id":"MDQ6VXNlcjQ3Mjk0","avatar_url":"https://avatars.githubusercontent.com/u/47294?v=4","gravatar_id":"","url":"https://api.github.com/users/samdark","html_url":"https://github.com/samdark","followers_url":"https://api.github.com/users/samdark/followers","following_url":"https://api.github.com/users/samdark/following{/other_user}","gists_url":"https://api.github.com/users/samdark/gists{/gist_id}","starred_url":"https://api.github.com/users/samdark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samdark/subscriptions","organizations_url":"https://api.github.com/users/samdark/orgs","repos_url":"https://api.github.com/users/samdark/repos","events_url":"https://api.github.com/users/samdark/events{/privacy}","received_events_url":"https://api.github.com/users/samdark/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"samdark","id":47294,"node_id":"MDQ6VXNlcjQ3Mjk0","avatar_url":"https://avatars.githubusercontent.com/u/47294?v=4","gravatar_id":"","url":"https://api.github.com/users/samdark","html_url":"https://github.com/samdark","followers_url":"https://api.github.com/users/samdark/followers","following_url":"https://api.github.com/users/samdark/following{/other_user}","gists_url":"https://api.github.com/users/samdark/gists{/gist_id}","starred_url":"https://api.github.com/users/samdark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samdark/subscriptions","organizations_url":"https://api.github.com/users/samdark/orgs","repos_url":"https://api.github.com/users/samdark/repos","events_url":"https://api.github.com/users/samdark/events{/privacy}","received_events_url":"https://api.github.com/users/samdark/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/yiisoft/yii2/milestones/21","html_url":"https://github.com/yiisoft/yii2/milestone/21","labels_url":"https://api.github.com/repos/yiisoft/yii2/milestones/21/labels","id":1875845,"node_id":"MDk6TWlsZXN0b25lMTg3NTg0NQ==","number":21,"title":"2.0.12","description":"","creator":{"login":"cebe","id":189796,"node_id":"MDQ6VXNlcjE4OTc5Ng==","avatar_url":"https://avatars.githubusercontent.com/u/189796?v=4","gravatar_id":"","url":"https://api.github.com/users/cebe","html_url":"https://github.com/cebe","followers_url":"https://api.github.com/users/cebe/followers","following_url":"https://api.github.com/users/cebe/following{/other_user}","gists_url":"https://api.github.com/users/cebe/gists{/gist_id}","starred_url":"https://api.github.com/users/cebe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cebe/subscriptions","organizations_url":"https://api.github.com/users/cebe/orgs","repos_url":"https://api.github.com/users/cebe/repos","events_url":"https://api.github.com/users/cebe/events{/privacy}","received_events_url":"https://api.github.com/users/cebe/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":288,"state":"closed","created_at":"2016-07-11T13:42:09Z","updated_at":"2017-06-05T18:03:24Z","due_on":"2017-03-26T07:00:00Z","closed_at":"2017-06-05T18:03:24Z"},"comments":7,"created_at":"2017-05-25T16:42:14Z","updated_at":"2017-05-27T22:41:55Z","closed_at":"2017-05-25T21:32:33Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### What steps will reproduce the problem?\r\nWindows 7 32-bit\r\n\r\nUniform Server Zero XIII 13.3.2\r\nhttps://sourceforge.net/projects/miniserver/files/Uniform%20Server%20ZeroXIII/13_3_2_ZeroXIII/13_3_2_ZeroXIII.exe/download\r\n\r\nPHP 5.6.30 Module for Uniform Server\r\nhttps://sourceforge.net/projects/miniserver/files/Uniform%20Server%20ZeroXIII/ZeroXIIImodules/ZeroXIII_php_5_6_30_j.exe/download\r\n\r\nMySQL 5.6.35 database with this table:\r\n\r\n    CREATE TABLE `workflows` (\r\n      `workflow_id` int(11) NOT NULL,\r\n      `name` varchar(255) NOT NULL\r\n    ) ENGINE=InnoDB DEFAULT CHARSET=utf8;\r\n\r\n    ALTER TABLE `workflows`\r\n      ADD PRIMARY KEY (`workflow_id`),\r\n      ADD UNIQUE KEY `name_UNIQUE` (`name`);\r\n\r\ncomposer.json:\r\n\r\n    {\r\n        \"name\": \"yiisoft/yii2-app-advanced\",\r\n        \"description\": \"Yii 2 Advanced Project Template\",\r\n        \"keywords\": [\"yii2\", \"framework\", \"advanced\", \"project template\"],\r\n        \"homepage\": \"http://www.yiiframework.com/\",\r\n        \"type\": \"project\",\r\n        \"license\": \"BSD-3-Clause\",\r\n        \"support\": {\r\n            \"issues\": \"https://github.com/yiisoft/yii2/issues?state=open\",\r\n            \"forum\": \"http://www.yiiframework.com/forum/\",\r\n            \"wiki\": \"http://www.yiiframework.com/wiki/\",\r\n            \"irc\": \"irc://irc.freenode.net/yii\",\r\n            \"source\": \"https://github.com/yiisoft/yii2\"\r\n        },\r\n        \"minimum-stability\": \"dev\",\r\n        \"require\": {\r\n            \"php\": \">=5.4.0\",\r\n            \"yiisoft/yii2\": \"~2.0.6\",\r\n            \"yiisoft/yii2-bootstrap\": \"~2.0.0\",\r\n            \"yiisoft/yii2-swiftmailer\": \"~2.0.0\",\r\n            \"miloschuman/yii2-highcharts-widget\": \"dev-master\",\r\n            \"tinymce/tinymce\": \">  4\",\r\n            \"mdmsoft/yii2-admin\": \"~2.0\",\r\n            \"edvlerblog/yii2-adldap-module\": \"^3.0.0\",\r\n            \"codemix/yii2-excelexport\": \"*\"\r\n        },\r\n        \"require-dev\": {\r\n            \"yiisoft/yii2-debug\": \"~2.0.0\",\r\n            \"yiisoft/yii2-gii\": \"~2.0.0\",\r\n            \"yiisoft/yii2-faker\": \"~2.0.0\",\r\n\r\n            \"codeception/base\": \"^2.2.3\",\r\n            \"codeception/verify\": \"~0.3.1\"\r\n        },\r\n        \"config\": {\r\n            \"process-timeout\": 1800,\r\n            \"fxp-asset\":{\r\n                \"installer-paths\": {\r\n                    \"npm-asset-library\": \"vendor/npm\",\r\n                    \"bower-asset-library\": \"vendor/bower\"\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\nCreate `workflow` model using gii.\r\n\r\nCreate CRUD for `workflow` model using gii.\r\n\r\nNote that in the Yii configuration, the default MySQL host and database DSN is:\r\n\r\n`common/config/main-local.php`:\r\n\r\n    <?php\r\n    return [\r\n        'components' => [\r\n            'db' => [\r\n                'class' => 'yii\\db\\Connection',\r\n                'dsn' => 'mysql:host=localhost;dbname=blink',\r\n                'username' => 'root',\r\n                'password' => 'a',\r\n                'charset' => 'utf8',\r\n            ],\r\n            'mailer' => [\r\n                'class' => 'yii\\swiftmailer\\Mailer',\r\n                'viewPath' => '@common/mail',\r\n                // send all mails to a file by default. You have to set\r\n                // 'useFileTransport' to false and configure a transport\r\n                // for the mailer to send real emails.\r\n                'useFileTransport' => true,\r\n            ],\r\n        ],\r\n    ];\r\n\r\nHowever, the `workflows` table is located under a different database called `tickets` in localhost:\r\n\r\n`frontend/models/Workflow.php` (generated by gii):\r\n\r\n    public static function tableName()\r\n    {\r\n        return 'tickets.workflows';\r\n    }\r\n\r\nAttempting to create a new workflow causes a MySQL PDO Exception owing to a bad alias where \"0.\" gets prefixed to the table name as described below.\r\n\r\n### What is the expected result?\r\nA new workflow row is added to the workflows table.\r\n\r\n### What do you get instead?\r\n    Database Exception â€“ yii\\db\\Exception\r\n\r\n    SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '`name`='a'))' at line 1\r\n    The SQL being executed was: SELECT EXISTS(SELECT * FROM `tickets`.`workflows` WHERE (0.`name`='a'))\r\n    Error Info: Array\r\n    (\r\n        [0] => 42000\r\n        [1] => 1064\r\n        [2] => You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '`name`='a'))' at line 1\r\n    )\r\n\r\n    Caused by: PDOException\r\n\r\n    SQLSTATE[42000]: Syntax error or access violation: 1064 You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '`name`='a'))' at line 1\r\n\r\n    in C:\\uniz\\www\\sheikha\\vendor\\yiisoft\\yii2\\db\\Command.php at line 915\r\n\r\n### Additional info\r\nCommenting out the following rule in the generated `Workflow` model (`frontend/models/Workflow.php`) `rules()` method fixes this issue:\r\n    \r\n    [['name'], 'unique']\r\n\r\nAlternatively, in `vendor/yiisoft/yii2/validators/UniqueValidator.php` on `line 288`:\r\n\r\n    $alias = array_keys($query->getTablesUsedInFrom())[0];\r\n\r\nmay be erroneous and perhaps what was intended is:\r\n\r\n    $alias = array_values($query->getTablesUsedInFrom())[0];\r\n\r\nBut I do not know for sure.\r\n\r\n\r\n| Q                | A\r\n| ---------------- | ---\r\n| Yii version      | 2.0.12-dev\r\n| PHP version      |  5.6.30\r\n| Operating system |  Windows 7 32-bit\r\n","closed_by":{"login":"samdark","id":47294,"node_id":"MDQ6VXNlcjQ3Mjk0","avatar_url":"https://avatars.githubusercontent.com/u/47294?v=4","gravatar_id":"","url":"https://api.github.com/users/samdark","html_url":"https://github.com/samdark","followers_url":"https://api.github.com/users/samdark/followers","following_url":"https://api.github.com/users/samdark/following{/other_user}","gists_url":"https://api.github.com/users/samdark/gists{/gist_id}","starred_url":"https://api.github.com/users/samdark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samdark/subscriptions","organizations_url":"https://api.github.com/users/samdark/orgs","repos_url":"https://api.github.com/users/samdark/repos","events_url":"https://api.github.com/users/samdark/events{/privacy}","received_events_url":"https://api.github.com/users/samdark/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/yiisoft/yii2/issues/14211/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/yiisoft/yii2/issues/14211/timeline","performed_via_github_app":null,"state_reason":"completed"}