{"url":"https://api.github.com/repos/yiisoft/yii2/issues/18287","repository_url":"https://api.github.com/repos/yiisoft/yii2","labels_url":"https://api.github.com/repos/yiisoft/yii2/issues/18287/labels{/name}","comments_url":"https://api.github.com/repos/yiisoft/yii2/issues/18287/comments","events_url":"https://api.github.com/repos/yiisoft/yii2/issues/18287/events","html_url":"https://github.com/yiisoft/yii2/issues/18287","id":703439004,"node_id":"MDU6SXNzdWU3MDM0MzkwMDQ=","number":18287,"title":"Issue with computed columns and SQL Server 2005 or later","user":{"login":"webber2k6","id":13884828,"node_id":"MDQ6VXNlcjEzODg0ODI4","avatar_url":"https://avatars.githubusercontent.com/u/13884828?v=4","gravatar_id":"","url":"https://api.github.com/users/webber2k6","html_url":"https://github.com/webber2k6","followers_url":"https://api.github.com/users/webber2k6/followers","following_url":"https://api.github.com/users/webber2k6/following{/other_user}","gists_url":"https://api.github.com/users/webber2k6/gists{/gist_id}","starred_url":"https://api.github.com/users/webber2k6/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/webber2k6/subscriptions","organizations_url":"https://api.github.com/users/webber2k6/orgs","repos_url":"https://api.github.com/users/webber2k6/repos","events_url":"https://api.github.com/users/webber2k6/events{/privacy}","received_events_url":"https://api.github.com/users/webber2k6/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":33208443,"node_id":"MDU6TGFiZWwzMzIwODQ0Mw==","url":"https://api.github.com/repos/yiisoft/yii2/labels/type:bug","name":"type:bug","color":"e102d8","default":false,"description":"Bug"},{"id":33330247,"node_id":"MDU6TGFiZWwzMzMzMDI0Nw==","url":"https://api.github.com/repos/yiisoft/yii2/labels/status:ready%20for%20adoption","name":"status:ready for adoption","color":"02e10c","default":false,"description":"Feel free to implement this issue."},{"id":247756568,"node_id":"MDU6TGFiZWwyNDc3NTY1Njg=","url":"https://api.github.com/repos/yiisoft/yii2/labels/MSSQL","name":"MSSQL","color":"006b75","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"darkdef","id":8342004,"node_id":"MDQ6VXNlcjgzNDIwMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/8342004?v=4","gravatar_id":"","url":"https://api.github.com/users/darkdef","html_url":"https://github.com/darkdef","followers_url":"https://api.github.com/users/darkdef/followers","following_url":"https://api.github.com/users/darkdef/following{/other_user}","gists_url":"https://api.github.com/users/darkdef/gists{/gist_id}","starred_url":"https://api.github.com/users/darkdef/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/darkdef/subscriptions","organizations_url":"https://api.github.com/users/darkdef/orgs","repos_url":"https://api.github.com/users/darkdef/repos","events_url":"https://api.github.com/users/darkdef/events{/privacy}","received_events_url":"https://api.github.com/users/darkdef/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"darkdef","id":8342004,"node_id":"MDQ6VXNlcjgzNDIwMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/8342004?v=4","gravatar_id":"","url":"https://api.github.com/users/darkdef","html_url":"https://github.com/darkdef","followers_url":"https://api.github.com/users/darkdef/followers","following_url":"https://api.github.com/users/darkdef/following{/other_user}","gists_url":"https://api.github.com/users/darkdef/gists{/gist_id}","starred_url":"https://api.github.com/users/darkdef/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/darkdef/subscriptions","organizations_url":"https://api.github.com/users/darkdef/orgs","repos_url":"https://api.github.com/users/darkdef/repos","events_url":"https://api.github.com/users/darkdef/events{/privacy}","received_events_url":"https://api.github.com/users/darkdef/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/yiisoft/yii2/milestones/56","html_url":"https://github.com/yiisoft/yii2/milestone/56","labels_url":"https://api.github.com/repos/yiisoft/yii2/milestones/56/labels","id":5852329,"node_id":"MDk6TWlsZXN0b25lNTg1MjMyOQ==","number":56,"title":"2.0.39","description":"","creator":{"login":"samdark","id":47294,"node_id":"MDQ6VXNlcjQ3Mjk0","avatar_url":"https://avatars.githubusercontent.com/u/47294?v=4","gravatar_id":"","url":"https://api.github.com/users/samdark","html_url":"https://github.com/samdark","followers_url":"https://api.github.com/users/samdark/followers","following_url":"https://api.github.com/users/samdark/following{/other_user}","gists_url":"https://api.github.com/users/samdark/gists{/gist_id}","starred_url":"https://api.github.com/users/samdark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samdark/subscriptions","organizations_url":"https://api.github.com/users/samdark/orgs","repos_url":"https://api.github.com/users/samdark/repos","events_url":"https://api.github.com/users/samdark/events{/privacy}","received_events_url":"https://api.github.com/users/samdark/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":42,"state":"closed","created_at":"2020-09-07T21:38:43Z","updated_at":"2020-11-10T12:20:41Z","due_on":null,"closed_at":"2020-11-10T11:33:58Z"},"comments":7,"created_at":"2020-09-17T09:53:13Z","updated_at":"2020-12-07T18:30:38Z","closed_at":"2020-10-04T18:44:30Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### What steps will reproduce the problem?\r\nI have a table in SQL Server 2014 that has one column that is computed by a function call.\r\n```\r\ncreate table [user]\r\n(\r\n    ...\r\n    computed_column AS [getValue]([id])\r\n    ...\r\n)\r\n```\r\n\r\nWith Yii version 2.0.36  (Issues: #13828, #17474) the inserted date is returned by the insert statement using a temporary table and an OUTPUT clause.\r\n\r\n\r\n### What is the expected result?\r\nThe result should not be returned when the table has computed columns with function calls. This was the default behavior before version 2.0.36.\r\nOnly the insert statement should be triggered without temporary table.\r\n\r\n`INSERT INTO [user] (...) VALUES (...);`\r\n\r\n### What do you get instead?\r\n> Database Exception – yii\\db\\Exception\r\n> Error message: SQLSTATE[42000]: [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Column 'inserted.computed_column' cannot be referenced in the OUTPUT clause because the column definition contains a subquery or references a function that performs user or system data access. A function is assumed by default to perform data access if it is not schemabound. Consider removing the subquery or function from the column definition or removing the column from the OUTPUT clause.\r\n\r\nThe executed query was something like this:\r\n```\r\nSET NOCOUNT ON;\r\nDECLARE @temporary_inserted TABLE (..., [computed_column] varchar(2) NULL, ...);\r\nINSERT INTO [user] (...) OUTPUT INSERTED.* INTO @temporary_inserted VALUES (...);\r\nSELECT * FROM @temporary_inserted\r\n```\r\n\r\nStack Trace:\r\n1. in /var/www/html/vendor/yiisoft/yii2/db/Schema.phpat line 677\r\n2. in /var/www/html/vendor/yiisoft/yii2/db/Command.php at line 1298– yii\\db\\Schema::convertException(PDOException, 'SET NOCOUNT ON;DECLARE @temporar...')\r\n3. in /var/www/html/vendor/yiisoft/yii2/db/Command.php at line 1093– yii\\db\\Command::internalExecute('SET NOCOUNT ON;DECLARE @temporar...')\r\n4. in /var/www/html/vendor/yiisoft/yii2/db/mssql/Schema.php at line 768– yii\\db\\Command::execute()\r\n5. in /var/www/html/vendor/yiisoft/yii2/db/ActiveRecord.php at line 600– yii\\db\\mssql\\Schema::insert('user', [...])\r\n6. in /var/www/html/vendor/yiisoft/yii2/db/ActiveRecord.php at line 566– yii\\db\\ActiveRecord::insertInternal(null)\r\n7. in /var/www/html/vendor/yiisoft/yii2/db/BaseActiveRecord.php at line 678– yii\\db\\ActiveRecord::insert(true, null)\r\n8. yii\\db\\BaseActiveRecord::save()\r\n\r\n### Additional info\r\n\r\n| Q                | A\r\n| ---------------- | ---\r\n| Yii version      | 2.0.37\r\n| PHP version      | 7.0.*, 7.2.*\r\n| Operating system | Windows, Linux\r\n","closed_by":{"login":"samdark","id":47294,"node_id":"MDQ6VXNlcjQ3Mjk0","avatar_url":"https://avatars.githubusercontent.com/u/47294?v=4","gravatar_id":"","url":"https://api.github.com/users/samdark","html_url":"https://github.com/samdark","followers_url":"https://api.github.com/users/samdark/followers","following_url":"https://api.github.com/users/samdark/following{/other_user}","gists_url":"https://api.github.com/users/samdark/gists{/gist_id}","starred_url":"https://api.github.com/users/samdark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samdark/subscriptions","organizations_url":"https://api.github.com/users/samdark/orgs","repos_url":"https://api.github.com/users/samdark/repos","events_url":"https://api.github.com/users/samdark/events{/privacy}","received_events_url":"https://api.github.com/users/samdark/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/yiisoft/yii2/issues/18287/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/yiisoft/yii2/issues/18287/timeline","performed_via_github_app":null,"state_reason":"completed"}