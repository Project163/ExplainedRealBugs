{"url":"https://api.github.com/repos/yiisoft/yii2/issues/18414","repository_url":"https://api.github.com/repos/yiisoft/yii2","labels_url":"https://api.github.com/repos/yiisoft/yii2/issues/18414/labels{/name}","comments_url":"https://api.github.com/repos/yiisoft/yii2/issues/18414/comments","events_url":"https://api.github.com/repos/yiisoft/yii2/issues/18414/events","html_url":"https://github.com/yiisoft/yii2/issues/18414","id":753604650,"node_id":"MDU6SXNzdWU3NTM2MDQ2NTA=","number":18414,"title":"AssetManager appendTimestamp not working","user":{"login":"Isitar","id":16210003,"node_id":"MDQ6VXNlcjE2MjEwMDAz","avatar_url":"https://avatars.githubusercontent.com/u/16210003?v=4","gravatar_id":"","url":"https://api.github.com/users/Isitar","html_url":"https://github.com/Isitar","followers_url":"https://api.github.com/users/Isitar/followers","following_url":"https://api.github.com/users/Isitar/following{/other_user}","gists_url":"https://api.github.com/users/Isitar/gists{/gist_id}","starred_url":"https://api.github.com/users/Isitar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Isitar/subscriptions","organizations_url":"https://api.github.com/users/Isitar/orgs","repos_url":"https://api.github.com/users/Isitar/repos","events_url":"https://api.github.com/users/Isitar/events{/privacy}","received_events_url":"https://api.github.com/users/Isitar/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":33208443,"node_id":"MDU6TGFiZWwzMzIwODQ0Mw==","url":"https://api.github.com/repos/yiisoft/yii2/labels/type:bug","name":"type:bug","color":"e102d8","default":false,"description":"Bug"},{"id":33330247,"node_id":"MDU6TGFiZWwzMzMzMDI0Nw==","url":"https://api.github.com/repos/yiisoft/yii2/labels/status:ready%20for%20adoption","name":"status:ready for adoption","color":"02e10c","default":false,"description":"Feel free to implement this issue."}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/yiisoft/yii2/milestones/57","html_url":"https://github.com/yiisoft/yii2/milestone/57","labels_url":"https://api.github.com/repos/yiisoft/yii2/milestones/57/labels","id":6026053,"node_id":"MDk6TWlsZXN0b25lNjAyNjA1Mw==","number":57,"title":"2.0.40","description":"","creator":{"login":"samdark","id":47294,"node_id":"MDQ6VXNlcjQ3Mjk0","avatar_url":"https://avatars.githubusercontent.com/u/47294?v=4","gravatar_id":"","url":"https://api.github.com/users/samdark","html_url":"https://github.com/samdark","followers_url":"https://api.github.com/users/samdark/followers","following_url":"https://api.github.com/users/samdark/following{/other_user}","gists_url":"https://api.github.com/users/samdark/gists{/gist_id}","starred_url":"https://api.github.com/users/samdark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samdark/subscriptions","organizations_url":"https://api.github.com/users/samdark/orgs","repos_url":"https://api.github.com/users/samdark/repos","events_url":"https://api.github.com/users/samdark/events{/privacy}","received_events_url":"https://api.github.com/users/samdark/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":40,"state":"closed","created_at":"2020-10-23T19:37:14Z","updated_at":"2020-12-23T15:45:55Z","due_on":null,"closed_at":"2020-12-23T15:45:55Z"},"comments":10,"created_at":"2020-11-30T16:07:08Z","updated_at":"2021-01-29T17:49:39Z","closed_at":"2020-12-23T09:57:33Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\nPlease use this issue tracker for bugs and feature requests only. In case you need support please use one of\r\nYii communities listed at https://github.com/yiisoft/yii2/wiki/communities\r\n-->\r\n\r\n### What steps will reproduce the problem?\r\nasset-config:\r\n\r\n\t'app\\assets\\BootstrapAsset' => [\r\n\t\t'basePath' => '@webroot',\r\n\t\t'baseUrl' => '@web',\r\n\t\t'css' => ['css/site.min.css'],\r\n\t],\r\n\r\nweb.php\r\n\r\n    'components' => [\r\n    ...\r\n\t\t'assetManager' => [\r\n\t\t\t'appendTimestamp' => true,\r\n\t\t\t'bundles' => require(__DIR__ . '/asset-bundles.php'),\r\n\t\t],\r\n\r\n\r\n### What is the expected result?\r\nthe site.min.css with the query parameter `v=time()`\r\n`<link href=\"/my-project/web/css/site.min.css?v=123\" rel=\"stylesheet\">`\r\n\r\n### What do you get instead?\r\nno timestamp:\r\n\r\n`<link href=\"/my-project/web/css/site.min.css\" rel=\"stylesheet\">`\r\n\r\n### Additional info\r\n\r\nthis happens because of Line 495 in View.php (https://github.com/yiisoft/yii2/blob/master/framework/web/View.php#L495) it adds `@webroot` to the url. But the Url comes from the AssetManager (newly introduced `getActualAssetUrl` method (https://github.com/yiisoft/yii2/blob/c46d209b56fda9aca05a9cc7fc858ce2fe25477d/framework/web/AssetManager.php#L643))\r\nwhich already includes the `@webroot` (or other baseUrl) in the url.\r\n\r\nThe error occours now because the AssetBundle calls this new Method which is the url without the timestamp. In earlier versions the timestamp was alredy included in the $url and no errors occoured.\r\n\r\nPossible fixes:\r\n- Either call the old `getAssetUrl` method in the AssetBundle\r\n- Or do not append `@webroot` in front of the url.\r\n\r\nBtw: is there a unit test checking the appendTimestamp behavior?\r\n\r\n| Q                | A\r\n| ---------------- | ---\r\n| Yii version      | 2.0.39\r\n| PHP version      | 7.4\r\n| Operating system | Windows / Linux, happens on both\r\n","closed_by":{"login":"samdark","id":47294,"node_id":"MDQ6VXNlcjQ3Mjk0","avatar_url":"https://avatars.githubusercontent.com/u/47294?v=4","gravatar_id":"","url":"https://api.github.com/users/samdark","html_url":"https://github.com/samdark","followers_url":"https://api.github.com/users/samdark/followers","following_url":"https://api.github.com/users/samdark/following{/other_user}","gists_url":"https://api.github.com/users/samdark/gists{/gist_id}","starred_url":"https://api.github.com/users/samdark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samdark/subscriptions","organizations_url":"https://api.github.com/users/samdark/orgs","repos_url":"https://api.github.com/users/samdark/repos","events_url":"https://api.github.com/users/samdark/events{/privacy}","received_events_url":"https://api.github.com/users/samdark/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/yiisoft/yii2/issues/18414/reactions","total_count":4,"+1":4,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/yiisoft/yii2/issues/18414/timeline","performed_via_github_app":null,"state_reason":"completed"}