diff --git a/framework/CHANGELOG.md b/framework/CHANGELOG.md
index 2207de364..b28380cc5 100644
--- a/framework/CHANGELOG.md
+++ b/framework/CHANGELOG.md
@@ -33,6 +33,7 @@ Yii Framework 2 Change Log
 - Bug #13128: Fixed incorrect position of {pos} string in ColumnSchemaBuilder `__toString` (df2)
 - Bug #13105: Fixed `validate()` method in `yii.activeForm.js` to prevent unexpected form submit when `forceValidate` set to `true` (silverfire)
 - Bug #13198: Fixed order of checks in `yii\validators\IpValidator` that sometimes caused wrong error message (silverfire)
+- Bug #12213: Fixed `yii\db\ActiveRecord::unlinkAll()` to respect `onCondition()` of the relational query (silverfire)
 - Enh #475: Added Bash and Zsh completion support for the `./yii` command (cebe, silverfire)
 - Enh #6242: Access to validator in inline validation (arogachev)
 - Enh #6373: Introduce `yii\db\Query::emulateExecution()` to force returning an empty result for a query (klimov-paul)
diff --git a/framework/db/BaseActiveRecord.php b/framework/db/BaseActiveRecord.php
index 7c18f1447..b914cad55 100644
--- a/framework/db/BaseActiveRecord.php
+++ b/framework/db/BaseActiveRecord.php
@@ -1443,6 +1443,9 @@ abstract class BaseActiveRecord extends Model implements ActiveRecordInterface
             if (!empty($viaRelation->where)) {
                 $condition = ['and', $condition, $viaRelation->where];
             }
+            if (!empty($viaRelation->on)) {
+                $condition = ['and', $condition, $viaRelation->on];
+            }
             if (is_array($relation->via)) {
                 /* @var $viaClass ActiveRecordInterface */
                 if ($delete) {
@@ -1477,6 +1480,9 @@ abstract class BaseActiveRecord extends Model implements ActiveRecordInterface
                 if (!empty($relation->where)) {
                     $condition = ['and', $condition, $relation->where];
                 }
+                if (!empty($relation->on)) {
+                    $condition = ['and', $condition, $relation->on];
+                }
                 if ($delete) {
                     $relatedModel::deleteAll($condition);
                 } else {
diff --git a/tests/data/ar/Order.php b/tests/data/ar/Order.php
index 12cc6e59f..61e8b03d7 100644
--- a/tests/data/ar/Order.php
+++ b/tests/data/ar/Order.php
@@ -178,6 +178,13 @@ class Order extends ActiveRecord
             ->viaTable('order_item', ['order_id' => 'id']);
     }
 
+    public function getLimitedItems()
+    {
+        return $this->hasMany(Item::className(), ['id' => 'item_id'])
+            ->onCondition(['item.id' => [3, 5]])
+            ->via('orderItems');
+    }
+
     public function beforeSave($insert)
     {
         if (parent::beforeSave($insert)) {
diff --git a/tests/framework/db/ActiveRecordTest.php b/tests/framework/db/ActiveRecordTest.php
index 6b01e834c..304bfb673 100644
--- a/tests/framework/db/ActiveRecordTest.php
+++ b/tests/framework/db/ActiveRecordTest.php
@@ -3,6 +3,7 @@
 namespace yiiunit\framework\db;
 
 use yii\db\ActiveQuery;
+use yii\db\ActiveRecordInterface;
 use yiiunit\data\ar\ActiveRecord;
 use yiiunit\data\ar\BitValues;
 use yiiunit\data\ar\Category;
@@ -52,6 +53,11 @@ abstract class ActiveRecordTest extends DatabaseTestCase
         return OrderItem::className();
     }
 
+    public function getCategoryClass()
+    {
+        return Category::className();
+    }
+
     public function getOrderWithNullFKClass()
     {
         return OrderWithNullFK::className();
@@ -1350,4 +1356,65 @@ abstract class ActiveRecordTest extends DatabaseTestCase
             ->column();
         $this->assertSame([], $column);
     }
+
+    /**
+     * https://github.com/yiisoft/yii2/issues/12213
+     */
+    public function testUnlinkAllOnCondition()
+    {
+        /** @var Category $categoryClass */
+        $categoryClass = $this->getCategoryClass();
+        /** @var Item $itemClass */
+        $itemClass = $this->getItemClass();
+
+        // Ensure there are three items with category_id = 2 in the Items table
+        $itemsCount = $itemClass::find()->where(['category_id' => 2])->count();
+        $this->assertEquals(3, $itemsCount);
+
+        $categoryQuery = $categoryClass::find()->with('limitedItems')->where(['id' => 2]);
+        // Ensure that limitedItems relation returns only one item
+        // (category_id = 2 and id in (1,2,3))
+        $category = $categoryQuery->one();
+        $this->assertCount(1, $category->limitedItems);
+
+        // Unlink all items in the limitedItems relation
+        $category->unlinkAll('limitedItems', true);
+
+        // Make sure that only one item was unlinked
+        $itemsCount = $itemClass::find()->where(['category_id' => 2])->count();
+        $this->assertEquals(2, $itemsCount);
+
+        // Call $categoryQuery again to ensure no items were found
+        $this->assertCount(0, $categoryQuery->one()->limitedItems);
+    }
+
+    /**
+     * https://github.com/yiisoft/yii2/issues/12213
+     */
+    public function testUnlinkAllOnConditionViaTable()
+    {
+        /** @var Order $orderClass */
+        $orderClass = $this->getOrderClass();
+        /** @var Item $itemClass */
+        $itemClass = $this->getItemClass();
+
+        // Ensure there are three items with category_id = 2 in the Items table
+        $itemsCount = $itemClass::find()->where(['category_id' => 2])->count();
+        $this->assertEquals(3, $itemsCount);
+
+        $orderQuery = $orderClass::find()->with('limitedItems')->where(['id' => 2]);
+        // Ensure that limitedItems relation returns only one item
+        // (category_id = 2 and id in (4, 5))
+        $category = $orderQuery->one();
+        $this->assertCount(2, $category->limitedItems);
+
+        // Unlink all items in the limitedItems relation
+        $category->unlinkAll('limitedItems', true);
+
+        // Call $orderQuery again to ensure that links are removed
+        $this->assertCount(0, $orderQuery->one()->limitedItems);
+
+        // Make sure that only links were removed, the items were not removed
+        $this->assertEquals(3, $itemClass::find()->where(['category_id' => 2])->count());
+    }
 }
