diff --git a/framework/CHANGELOG.md b/framework/CHANGELOG.md
index aa93ce9d9..67e0dc4d9 100644
--- a/framework/CHANGELOG.md
+++ b/framework/CHANGELOG.md
@@ -11,6 +11,7 @@ Yii Framework 2 Change Log
 - Bug #18199: Fix content body response on 304 HTTP status code, according to RFC 7232 (rad8329)
 - Enh #18394: Add support for setting `yii\web\Response::$stream` to a callable (brandonkelly)
 - Bug #18406: Fix PDO exception when committing or rolling back an autocommitted transaction in PHP 8 (brandonkelly)
+- Bug #18339: Fix migrate controller actions to return exit codes (haohetao, bizley)
 - Bug #18287: Fix the OUTPUT got SQL syntax error if the column name is MSSQL keyword e.g key (darkdef)
 - Bug #18426: Fix check for route's leading slash in `yii\widgets\Menu` (stevekr)
 
diff --git a/framework/console/controllers/BaseMigrateController.php b/framework/console/controllers/BaseMigrateController.php
index 561d6bd44..dc94497cc 100644
--- a/framework/console/controllers/BaseMigrateController.php
+++ b/framework/console/controllers/BaseMigrateController.php
@@ -211,6 +211,8 @@ abstract class BaseMigrateController extends Controller
             $this->stdout("\n$n " . ($n === 1 ? 'migration was' : 'migrations were') . " applied.\n", Console::FG_GREEN);
             $this->stdout("\nMigrated up successfully.\n", Console::FG_GREEN);
         }
+
+        return ExitCode::OK;
     }
 
     /**
@@ -272,6 +274,8 @@ abstract class BaseMigrateController extends Controller
             $this->stdout("\n$n " . ($n === 1 ? 'migration was' : 'migrations were') . " reverted.\n", Console::FG_GREEN);
             $this->stdout("\nMigrated down successfully.\n", Console::FG_GREEN);
         }
+
+        return ExitCode::OK;
     }
 
     /**
@@ -338,6 +342,8 @@ abstract class BaseMigrateController extends Controller
             $this->stdout("\n$n " . ($n === 1 ? 'migration was' : 'migrations were') . " redone.\n", Console::FG_GREEN);
             $this->stdout("\nMigration redone successfully.\n", Console::FG_GREEN);
         }
+
+        return ExitCode::OK;
     }
 
     /**
@@ -367,13 +373,13 @@ abstract class BaseMigrateController extends Controller
     public function actionTo($version)
     {
         if (($namespaceVersion = $this->extractNamespaceMigrationVersion($version)) !== false) {
-            $this->migrateToVersion($namespaceVersion);
+            return $this->migrateToVersion($namespaceVersion);
         } elseif (($migrationName = $this->extractMigrationVersion($version)) !== false) {
-            $this->migrateToVersion($migrationName);
+            return $this->migrateToVersion($migrationName);
         } elseif ((string) (int) $version == $version) {
-            $this->migrateToTime($version);
+            return $this->migrateToTime($version);
         } elseif (($time = strtotime($version)) !== false) {
-            $this->migrateToTime($time);
+            return $this->migrateToTime($time);
         } else {
             throw new Exception("The version argument must be either a timestamp (e.g. 101129_185401),\n the full name of a migration (e.g. m101129_185401_create_user_table),\n the full namespaced name of a migration (e.g. app\\migrations\\M101129185401CreateUserTable),\n a UNIX timestamp (e.g. 1392853000), or a datetime string parseable\nby the strtotime() function (e.g. 2014-02-15 13:00:50).");
         }
@@ -431,13 +437,11 @@ abstract class BaseMigrateController extends Controller
             if (strpos($migration, $version) === 0) {
                 if ($i === 0) {
                     $this->stdout("Already at '$originalVersion'. Nothing needs to be done.\n", Console::FG_YELLOW);
-                } else {
-                    if ($this->confirm("Set migration history at $originalVersion?")) {
-                        for ($j = 0; $j < $i; ++$j) {
-                            $this->removeMigrationHistory($migrations[$j]);
-                        }
-                        $this->stdout("The migration history is set at $originalVersion.\nNo actual migration was performed.\n", Console::FG_GREEN);
+                } elseif ($this->confirm("Set migration history at $originalVersion?")) {
+                    for ($j = 0; $j < $i; ++$j) {
+                        $this->removeMigrationHistory($migrations[$j]);
                     }
+                    $this->stdout("The migration history is set at $originalVersion.\nNo actual migration was performed.\n", Console::FG_GREEN);
                 }
 
                 return ExitCode::OK;
@@ -460,16 +464,18 @@ abstract class BaseMigrateController extends Controller
     {
         if (YII_ENV_PROD) {
             $this->stdout("YII_ENV is set to 'prod'.\nRefreshing migrations is not possible on production systems.\n");
+
             return ExitCode::OK;
         }
 
-        if ($this->confirm(
-            "Are you sure you want to drop all tables and related constraints and start the migration from the beginning?\nAll data will be lost irreversibly!")) {
+        if ($this->confirm("Are you sure you want to drop all tables and related constraints and start the migration from the beginning?\nAll data will be lost irreversibly!")) {
             $this->truncateDatabase();
+
             return $this->actionUp();
         }
 
         $this->stdout('Action was cancelled by user. Nothing has been performed.');
+
         return ExitCode::OK;
     }
 
@@ -545,6 +551,8 @@ abstract class BaseMigrateController extends Controller
                 $this->stdout("\t(" . date('Y-m-d H:i:s', $time) . ') ' . $version . "\n");
             }
         }
+
+        return ExitCode::OK;
     }
 
     /**
@@ -591,6 +599,8 @@ abstract class BaseMigrateController extends Controller
                 $this->stdout("\t" . $migration . "\n");
             }
         }
+
+        return ExitCode::OK;
     }
 
     /**
@@ -647,9 +657,16 @@ abstract class BaseMigrateController extends Controller
                 'namespace' => $namespace,
             ]);
             FileHelper::createDirectory($migrationPath);
-            file_put_contents($file, $content, LOCK_EX);
+            if (file_put_contents($file, $content, LOCK_EX) === false) {
+                $this->stdout("Failed to create new migration.\n", Console::FG_RED);
+
+                return ExitCode::IOERR;
+            }
+
             $this->stdout("New migration created successfully.\n", Console::FG_GREEN);
         }
+
+        return ExitCode::OK;
     }
 
     /**
@@ -826,8 +843,10 @@ abstract class BaseMigrateController extends Controller
         if ($count === 0) {
             $this->stdout("Nothing needs to be done.\n", Console::FG_GREEN);
         } else {
-            $this->actionDown($count);
+            return $this->actionDown($count);
         }
+
+        return ExitCode::OK;
     }
 
     /**
@@ -844,9 +863,7 @@ abstract class BaseMigrateController extends Controller
         $migrations = $this->getNewMigrations();
         foreach ($migrations as $i => $migration) {
             if (strpos($migration, $version) === 0) {
-                $this->actionUp($i + 1);
-
-                return ExitCode::OK;
+                return $this->actionUp($i + 1);
             }
         }
 
@@ -857,7 +874,7 @@ abstract class BaseMigrateController extends Controller
                 if ($i === 0) {
                     $this->stdout("Already at '$originalVersion'. Nothing needs to be done.\n", Console::FG_YELLOW);
                 } else {
-                    $this->actionDown($i);
+                    return $this->actionDown($i);
                 }
 
                 return ExitCode::OK;
diff --git a/tests/framework/console/controllers/MigrateControllerTest.php b/tests/framework/console/controllers/MigrateControllerTest.php
index 76ba005df..e93e2a280 100644
--- a/tests/framework/console/controllers/MigrateControllerTest.php
+++ b/tests/framework/console/controllers/MigrateControllerTest.php
@@ -9,6 +9,7 @@ namespace yiiunit\framework\console\controllers;
 
 use Yii;
 use yii\console\controllers\MigrateController;
+use yii\console\ExitCode;
 use yii\db\Migration;
 use yii\db\Query;
 use yii\helpers\Inflector;
@@ -96,6 +97,7 @@ class MigrateControllerTest extends TestCase
         list($config, $namespace, $class) = $this->prepareMigrationNameData($migrationName);
 
         $this->runMigrateControllerAction('create', [$migrationName], $config);
+        $this->assertSame(ExitCode::OK, $this->getExitCode());
         $this->assertFileContentJunction($expectedFile, $class, $junctionTable, $firstTable, $secondTable, $namespace);
     }
 
@@ -212,7 +214,7 @@ class MigrateControllerTest extends TestCase
         return [
             ['default', 'DefaultTest', 'default', []],
 
-            // underscore + table name = case keeped
+            // underscore + table name = case kept
             ['create_test', 'create_test_table', 'test', []],
             ['create_test', 'create_test__table', 'test_', []],
             ['create_test', 'create_TEST_table', 'TEST', []],
@@ -370,6 +372,7 @@ class MigrateControllerTest extends TestCase
         $this->createMigration(str_repeat('a', 180));
 
         $result = $this->runMigrateControllerAction('up');
+        $this->assertSame(ExitCode::UNSPECIFIED_ERROR, $this->getExitCode());
 
         $this->assertContains('The migration name', $result);
         $this->assertContains('is too long. Its not possible to apply this migration.', $result);
@@ -385,6 +388,7 @@ class MigrateControllerTest extends TestCase
         $this->createMigration(str_repeat('a', 180));
 
         $result = $this->runMigrateControllerAction('up');
+        $this->assertSame(ExitCode::OK, $this->getExitCode());
 
         $this->assertContains('1 migration was applied.', $result);
         $this->assertContains('Migrated up successfully.', $result);
@@ -418,18 +422,15 @@ class MigrateControllerTest extends TestCase
             $this->switchDbConnection($db);
         }
 
-        Yii::$app->db->createCommand('create table hall_of_fame(id int, string varchar(255))')
-            ->execute();
+        Yii::$app->db->createCommand('create table hall_of_fame(id int, string varchar(255))')->execute();
 
-        Yii::$app->db->createCommand("insert into hall_of_fame values(1, 'Qiang Xue');")
-            ->execute();
-        Yii::$app->db->createCommand("insert into hall_of_fame values(2, 'Alexander Makarov');")
-            ->execute();
+        Yii::$app->db->createCommand("insert into hall_of_fame values(1, 'Qiang Xue');")->execute();
+        Yii::$app->db->createCommand("insert into hall_of_fame values(2, 'Alexander Makarov');")->execute();
 
-        Yii::$app->db->createCommand('create view view_hall_of_fame as select * from hall_of_fame')
-            ->execute();
+        Yii::$app->db->createCommand('create view view_hall_of_fame as select * from hall_of_fame')->execute();
 
         $result = $this->runMigrateControllerAction('fresh');
+        $this->assertSame(ExitCode::OK, $this->getExitCode());
 
         // Drop worked
         $this->assertContains('Table hall_of_fame dropped.', $result);
diff --git a/tests/framework/console/controllers/MigrateControllerTestTrait.php b/tests/framework/console/controllers/MigrateControllerTestTrait.php
index c9e32bd31..7b8cd1647 100644
--- a/tests/framework/console/controllers/MigrateControllerTestTrait.php
+++ b/tests/framework/console/controllers/MigrateControllerTestTrait.php
@@ -9,6 +9,7 @@ namespace yiiunit\framework\console\controllers;
 
 use Yii;
 use yii\console\controllers\BaseMigrateController;
+use yii\console\ExitCode;
 use yii\helpers\FileHelper;
 use yii\helpers\StringHelper;
 use yiiunit\TestCase;
@@ -37,7 +38,16 @@ trait MigrateControllerTestTrait
      * @var string test migration namespace
      */
     protected $migrationNamespace;
+    /**
+     * @var int|null migration controller exit code
+     */
+    protected $migrationExitCode;
+
 
+    public function getExitCode()
+    {
+        return $this->migrationExitCode;
+    }
 
     public function setUpMigrationPath()
     {
@@ -91,7 +101,7 @@ trait MigrateControllerTestTrait
         $controller = $this->createMigrateController($config);
         ob_start();
         ob_implicit_flush(false);
-        $controller->run($actionID, $args);
+        $this->migrationExitCode = $controller->run($actionID, $args);
 
         return ob_get_clean();
     }
@@ -215,6 +225,7 @@ CODE;
     {
         $migrationName = 'test_migration';
         $this->runMigrateControllerAction('create', [$migrationName]);
+        $this->assertSame(ExitCode::OK, $this->getExitCode());
         $files = FileHelper::findFiles($this->migrationPath);
         $this->assertCount(1, $files, 'Unable to create new migration!');
         $this->assertContains($migrationName, basename($files[0]), 'Wrong migration name!');
@@ -226,6 +237,7 @@ CODE;
         $this->createMigration('test_up2');
 
         $this->runMigrateControllerAction('up');
+        $this->assertSame(ExitCode::OK, $this->getExitCode());
 
         $this->assertMigrationHistory(['m*_base', 'm*_test_up1', 'm*_test_up2']);
     }
@@ -239,6 +251,7 @@ CODE;
         $this->createMigration('test_down2');
 
         $this->runMigrateControllerAction('up', [1]);
+        $this->assertSame(ExitCode::OK, $this->getExitCode());
 
         $this->assertMigrationHistory(['m*_base', 'm*_test_down1']);
     }
@@ -252,7 +265,9 @@ CODE;
         $this->createMigration('test_down_count2');
 
         $this->runMigrateControllerAction('up');
+        $this->assertSame(ExitCode::OK, $this->getExitCode());
         $this->runMigrateControllerAction('down', [1]);
+        $this->assertSame(ExitCode::OK, $this->getExitCode());
 
         $this->assertMigrationHistory(['m*_base', 'm*_test_down_count1']);
     }
@@ -266,7 +281,9 @@ CODE;
         $this->createMigration('test_down_all2');
 
         $this->runMigrateControllerAction('up');
+        $this->assertSame(ExitCode::OK, $this->getExitCode());
         $this->runMigrateControllerAction('down', ['all']);
+        $this->assertSame(ExitCode::OK, $this->getExitCode());
 
         $this->assertMigrationHistory(['m*_base']);
     }
@@ -282,8 +299,10 @@ CODE;
         $this->createMigration('test_history1');
         $this->createMigration('test_history2');
         $this->runMigrateControllerAction('up');
+        $this->assertSame(ExitCode::OK, $this->getExitCode());
 
         $output = $this->runMigrateControllerAction('history');
+        $this->assertSame(ExitCode::OK, $this->getExitCode());
         $this->assertContains('_test_history1', $output);
         $this->assertContains('_test_history2', $output);
     }
@@ -296,11 +315,14 @@ CODE;
         $this->createMigration('test_new1');
 
         $output = $this->runMigrateControllerAction('new');
+        $this->assertSame(ExitCode::OK, $this->getExitCode());
         $this->assertContains('_test_new1', $output);
 
         $this->runMigrateControllerAction('up');
+        $this->assertSame(ExitCode::OK, $this->getExitCode());
 
         $output = $this->runMigrateControllerAction('new');
+        $this->assertSame(ExitCode::OK, $this->getExitCode());
         $this->assertNotContains('_test_new1', $output);
     }
 
@@ -310,6 +332,7 @@ CODE;
         $this->createMigration('test_mark1', $version);
 
         $this->runMigrateControllerAction('mark', [$version]);
+        $this->assertSame(ExitCode::OK, $this->getExitCode());
 
         $this->assertMigrationHistory(['m*_base', 'm*_test_mark1']);
     }
@@ -320,9 +343,11 @@ CODE;
         $this->createMigration('test_mark1', $version);
 
         $this->runMigrateControllerAction('up');
+        $this->assertSame(ExitCode::OK, $this->getExitCode());
         $this->assertMigrationHistory(['m*_base', 'm*_test_mark1']);
 
         $this->runMigrateControllerAction('mark', [BaseMigrateController::BASE_MIGRATION]);
+        $this->assertSame(ExitCode::OK, $this->getExitCode());
         $this->assertMigrationHistory(['m*_base']);
     }
 
@@ -332,6 +357,7 @@ CODE;
         $this->createMigration('to1', $version);
 
         $this->runMigrateControllerAction('to', [$version]);
+        $this->assertSame(ExitCode::OK, $this->getExitCode());
 
         $this->assertMigrationHistory(['m*_base', 'm*_to1']);
     }
@@ -343,8 +369,10 @@ CODE;
     {
         $this->createMigration('test_redo1');
         $this->runMigrateControllerAction('up');
+        $this->assertSame(ExitCode::OK, $this->getExitCode());
 
         $this->runMigrateControllerAction('redo');
+        $this->assertSame(ExitCode::OK, $this->getExitCode());
 
         $this->assertMigrationHistory(['m*_base', 'm*_test_redo1']);
     }
@@ -362,6 +390,7 @@ CODE;
             'migrationPath' => null,
             'migrationNamespaces' => [$this->migrationNamespace],
         ]);
+        $this->assertSame(ExitCode::OK, $this->getExitCode());
         $files = FileHelper::findFiles($this->migrationPath);
         $fileContent = file_get_contents($files[0]);
         $this->assertContains("namespace {$this->migrationNamespace};", $fileContent);
@@ -374,6 +403,7 @@ CODE;
             'migrationPath' => $this->migrationPath,
             'migrationNamespaces' => [$this->migrationNamespace],
         ]);
+        $this->assertSame(ExitCode::OK, $this->getExitCode());
         $files = FileHelper::findFiles($this->migrationPath);
         $fileContent = file_get_contents($files[0]);
         $this->assertContains("namespace {$this->migrationNamespace};", $fileContent);
@@ -385,6 +415,7 @@ CODE;
             'migrationPath' => $this->migrationPath,
             'migrationNamespaces' => [$this->migrationNamespace],
         ]);
+        $this->assertSame(ExitCode::OK, $this->getExitCode());
         $files = FileHelper::findFiles($this->migrationPath);
         $fileContent = file_get_contents($files[0]);
         $this->assertNotContains("namespace {$this->migrationNamespace};", $fileContent);
@@ -402,6 +433,7 @@ CODE;
             'migrationPath' => null,
             'migrationNamespaces' => [$this->migrationNamespace],
         ]);
+        $this->assertSame(ExitCode::OK, $this->getExitCode());
 
         $this->assertMigrationHistory([
             'm*_*_base',
@@ -424,7 +456,9 @@ CODE;
             'migrationNamespaces' => [$this->migrationNamespace],
         ];
         $this->runMigrateControllerAction('up', [], $controllerConfig);
+        $this->assertSame(ExitCode::OK, $this->getExitCode());
         $this->runMigrateControllerAction('down', [1], $controllerConfig);
+        $this->assertSame(ExitCode::OK, $this->getExitCode());
 
         $this->assertMigrationHistory([
             'm*_*_base',
@@ -449,8 +483,10 @@ CODE;
         $this->createNamespaceMigration('history1');
         $this->createNamespaceMigration('history2');
         $this->runMigrateControllerAction('up', [], $controllerConfig);
+        $this->assertSame(ExitCode::OK, $this->getExitCode());
 
         $output = $this->runMigrateControllerAction('history', [], $controllerConfig);
+        $this->assertSame(ExitCode::OK, $this->getExitCode());
         $this->assertRegExp('/' . preg_quote($this->migrationNamespace) . '.*History1/s', $output);
         $this->assertRegExp('/' . preg_quote($this->migrationNamespace) . '.*History2/s', $output);
     }
@@ -469,6 +505,7 @@ CODE;
         $this->createNamespaceMigration('mark1', $version);
 
         $this->runMigrateControllerAction('mark', [$this->migrationNamespace . '\\M' . $version], $controllerConfig);
+        $this->assertSame(ExitCode::OK, $this->getExitCode());
 
         $this->assertMigrationHistory(['m*_base', $this->migrationNamespace . '\\M*Mark1']);
     }
@@ -487,6 +524,7 @@ CODE;
         $this->createNamespaceMigration('to1', $version);
 
         $this->runMigrateControllerAction('to', [$this->migrationNamespace . '\\M' . $version], $controllerConfig);
+        $this->assertSame(ExitCode::OK, $this->getExitCode());
 
         $this->assertMigrationHistory(['m*_base', $this->migrationNamespace . '\\M*To1']);
     }
@@ -510,10 +548,12 @@ CODE;
 
         // yii migrate/up 1
         $this->runMigrateControllerAction('up', [1], $controllerConfig);
+        $this->assertSame(ExitCode::OK, $this->getExitCode());
         $this->assertMigrationHistory(['m*_base', 'm010101_000001_app_migration1']);
 
         // yii migrate/up
         $this->runMigrateControllerAction('up', [], $controllerConfig);
+        $this->assertSame(ExitCode::OK, $this->getExitCode());
         $this->assertMigrationHistory([
             'm*_base',
             'm010101_000001_app_migration1',
@@ -524,6 +564,7 @@ CODE;
 
         // yii migrate/to m010101_000002_ext_migration1
         $this->runMigrateControllerAction('to', ['m010101_000002_ext_migration1'], $controllerConfig);
+        $this->assertSame(ExitCode::OK, $this->getExitCode());
         $this->assertMigrationHistory([
             'm*_base',
             'm010101_000001_app_migration1',
@@ -531,6 +572,7 @@ CODE;
 
         // yii migrate/mark M010101000004NsMigration
         $this->runMigrateControllerAction('mark', ['m010101_000003_app_migration2'], $controllerConfig);
+        $this->assertSame(ExitCode::OK, $this->getExitCode());
         $this->assertMigrationHistory([
             'm*_base',
             'm010101_000001_app_migration1',
@@ -540,6 +582,7 @@ CODE;
 
         // yii migrate/up
         $this->runMigrateControllerAction('up', [], $controllerConfig);
+        $this->assertSame(ExitCode::OK, $this->getExitCode());
         $this->assertMigrationHistory([
             'm*_base',
             'm010101_000001_app_migration1',
@@ -550,6 +593,7 @@ CODE;
 
         // yii migrate/redo 2
         $this->runMigrateControllerAction('redo', [2], $controllerConfig);
+        $this->assertSame(ExitCode::OK, $this->getExitCode());
         $this->assertMigrationHistory([
             'm*_base',
             'm010101_000001_app_migration1',
@@ -560,6 +604,7 @@ CODE;
 
         // yii migrate/down
         $this->runMigrateControllerAction('down', [], $controllerConfig);
+        $this->assertSame(ExitCode::OK, $this->getExitCode());
         $this->assertMigrationHistory([
             'm*_base',
             'm010101_000001_app_migration1',
@@ -569,6 +614,7 @@ CODE;
 
         // yii migrate/redo
         $this->runMigrateControllerAction('redo', [], $controllerConfig);
+        $this->assertSame(ExitCode::OK, $this->getExitCode());
         $this->assertMigrationHistory([
             'm*_base',
             'm010101_000001_app_migration1',
@@ -578,6 +624,7 @@ CODE;
 
         // yii migrate/down 2
         $this->runMigrateControllerAction('down', [2], $controllerConfig);
+        $this->assertSame(ExitCode::OK, $this->getExitCode());
         $this->assertMigrationHistory([
             'm*_base',
             'm010101_000001_app_migration1',
@@ -585,6 +632,7 @@ CODE;
 
         // yii migrate/create app_migration3
         $this->runMigrateControllerAction('create', ['app_migration3'], $controllerConfig);
+        $this->assertSame(ExitCode::OK, $this->getExitCode());
         $this->assertMigrationHistory([
             'm*_base',
             'm010101_000001_app_migration1',
@@ -592,6 +640,7 @@ CODE;
 
         // yii migrate/up
         $this->runMigrateControllerAction('up', [], $controllerConfig);
+        $this->assertSame(ExitCode::OK, $this->getExitCode());
         $this->assertMigrationHistory([
             'm*_base',
             'm010101_000001_app_migration1',
