diff --git a/framework/db/Query.php b/framework/db/Query.php
index 2c7a530be..0d28e4881 100644
--- a/framework/db/Query.php
+++ b/framework/db/Query.php
@@ -658,22 +658,31 @@ PATTERN;
      */
     protected function getUniqueColumns($columns)
     {
-        $columns = array_unique($columns);
         $unaliasedColumns = $this->getUnaliasedColumnsFromSelect();
 
+        $result = [];
         foreach ($columns as $columnAlias => $columnDefinition) {
             if ($columnDefinition instanceof Query) {
                 continue;
             }
 
-            if (
-                (is_string($columnAlias) && isset($this->select[$columnAlias]) && $this->select[$columnAlias] === $columnDefinition)
-                || (is_integer($columnAlias) && in_array($columnDefinition, $unaliasedColumns))
-            ) {
-                unset($columns[$columnAlias]);
+            if (is_string($columnAlias)) {
+                $existsInSelect = isset($this->select[$columnAlias]) && $this->select[$columnAlias] === $columnDefinition;
+                if ($existsInSelect) {
+                    continue;
+                }
+            } elseif (is_integer($columnAlias)) {
+                $existsInSelect = in_array($columnDefinition, $unaliasedColumns, true);
+                $existsInResultSet = in_array($columnDefinition, $result, true);
+                if ($existsInSelect || $existsInResultSet) {
+                    continue;
+                }
             }
+
+            $result[$columnAlias] = $columnDefinition;
+
         }
-        return $columns;
+        return $result;
     }
 
     /**
diff --git a/tests/framework/db/QueryTest.php b/tests/framework/db/QueryTest.php
index 41e1e778c..58abd62f2 100644
--- a/tests/framework/db/QueryTest.php
+++ b/tests/framework/db/QueryTest.php
@@ -62,6 +62,22 @@ abstract class QueryTest extends DatabaseTestCase
         $query = new Query();
         $query->select('name, name, name as X, name as X');
         $this->assertEquals(['name', 'name as X'], array_values($query->select));
+
+        /** @see https://github.com/yiisoft/yii2/issues/15676 */
+        $query = (new Query())->select('id');
+        $this->assertSame(['id'], $query->select);
+        $query->select(['id', 'brand_id']);
+        $this->assertSame(['id', 'brand_id'], $query->select);
+
+        /** @see https://github.com/yiisoft/yii2/issues/15676 */
+        $query = (new Query())->select(['prefix' => 'LEFT(name, 7)', 'prefix_key' => 'LEFT(name, 7)']);
+        $this->assertSame(['prefix' => 'LEFT(name, 7)', 'prefix_key' => 'LEFT(name, 7)'], $query->select);
+        $query->addSelect(['LEFT(name,7) as test']);
+        $this->assertSame(['prefix' => 'LEFT(name, 7)', 'prefix_key' => 'LEFT(name, 7)', 'LEFT(name,7) as test'], $query->select);
+        $query->addSelect(['LEFT(name,7) as test']);
+        $this->assertSame(['prefix' => 'LEFT(name, 7)', 'prefix_key' => 'LEFT(name, 7)', 'LEFT(name,7) as test'], $query->select);
+        $query->addSelect(['test' => 'LEFT(name,7)']);
+        $this->assertSame(['prefix' => 'LEFT(name, 7)', 'prefix_key' => 'LEFT(name, 7)', 'LEFT(name,7) as test', 'test' => 'LEFT(name,7)'], $query->select);
     }
 
     public function testFrom()
@@ -675,18 +691,4 @@ abstract class QueryTest extends DatabaseTestCase
             $this->assertEquals('user11', $query->cache()->where(['id' => 1])->scalar($db));
         }, 10);
     }
-
-    /**
-     * @see https://github.com/yiisoft/yii2/issues/15676
-     */
-    public function testIssue15676()
-    {
-        $query = (new Query())
-            ->select('id')
-            ->from('place');
-        $this->assertSame(['id'], $query->select);
-
-        $query->select(['id', 'brand_id']);
-        $this->assertSame(['id', 'brand_id'], $query->select);
-    }
 }
