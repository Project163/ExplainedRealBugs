diff --git a/framework/CHANGELOG.md b/framework/CHANGELOG.md
index ea1064082..9607926cb 100644
--- a/framework/CHANGELOG.md
+++ b/framework/CHANGELOG.md
@@ -22,6 +22,7 @@ Yii Framework 2 Change Log
 - Bug #18505: Fixed `yii\helpers\ArrayHelper::getValue()` for ArrayAccess objects with explicitly defined properties (samdark)
 - Bug #18508: Fix Postgres SQL query for load table indexes with correct column order (insolita)
 - Enh #18518: Add support for ngrokâ€™s `X-Original-Host` header (brandonkelly)
+- Bug #18529: Fix asset files path with `appendTimestamp` option for non-root-relative base URLs (bizley)
 
 
 2.0.40 December 23, 2020
diff --git a/framework/web/AssetBundle.php b/framework/web/AssetBundle.php
index 60ada80ef..d04ad40eb 100644
--- a/framework/web/AssetBundle.php
+++ b/framework/web/AssetBundle.php
@@ -153,22 +153,18 @@ class AssetBundle extends BaseObject
             if (is_array($js)) {
                 $file = array_shift($js);
                 $options = ArrayHelper::merge($this->jsOptions, $js);
-                $view->registerJsFile($manager->getActualAssetUrl($this, $file), $options);
-            } else {
-                if ($js !== null) {
-                    $view->registerJsFile($manager->getActualAssetUrl($this, $js), $this->jsOptions);
-                }
+                $view->registerJsFile($manager->getAssetUrl($this, $file, ArrayHelper::getValue($options, 'appendTimestamp')), $options);
+            } elseif ($js !== null) {
+                $view->registerJsFile($manager->getAssetUrl($this, $js), $this->jsOptions);
             }
         }
         foreach ($this->css as $css) {
             if (is_array($css)) {
                 $file = array_shift($css);
                 $options = ArrayHelper::merge($this->cssOptions, $css);
-                $view->registerCssFile($manager->getActualAssetUrl($this, $file), $options);
-            } else {
-                if ($css !== null) {
-                    $view->registerCssFile($manager->getActualAssetUrl($this, $css), $this->cssOptions);
-                }
+                $view->registerCssFile($manager->getAssetUrl($this, $file, ArrayHelper::getValue($options, 'appendTimestamp')), $options);
+            } elseif ($css !== null) {
+                $view->registerCssFile($manager->getAssetUrl($this, $css), $this->cssOptions);
             }
         }
     }
diff --git a/framework/web/AssetManager.php b/framework/web/AssetManager.php
index 996e021ac..ebaeffc5b 100644
--- a/framework/web/AssetManager.php
+++ b/framework/web/AssetManager.php
@@ -231,7 +231,7 @@ class AssetManager extends Component
         if (!is_dir($this->basePath)) {
             throw new InvalidConfigException("The directory does not exist: {$this->basePath}");
         }
-        
+
         if (!is_writable($this->basePath)) {
             throw new InvalidConfigException("The directory is not writable by the Web process: {$this->basePath}");
         }
@@ -316,14 +316,20 @@ class AssetManager extends Component
      * The actual URL is obtained by prepending either [[AssetBundle::$baseUrl]] or [[AssetManager::$baseUrl]] to the given asset path.
      * @param AssetBundle $bundle the asset bundle which the asset file belongs to
      * @param string $asset the asset path. This should be one of the assets listed in [[AssetBundle::$js]] or [[AssetBundle::$css]].
+     * @param bool|null $appendTimestamp Whether to append timestamp to the URL.
      * @return string the actual URL for the specified asset.
      */
-    public function getAssetUrl($bundle, $asset)
+    public function getAssetUrl($bundle, $asset, $appendTimestamp = null)
     {
         $assetUrl = $this->getActualAssetUrl($bundle, $asset);
         $assetPath = $this->getAssetPath($bundle, $asset);
 
-        if ($this->appendTimestamp && $assetPath && ($timestamp = @filemtime($assetPath)) > 0) {
+        $withTimestamp = $this->appendTimestamp;
+        if ($appendTimestamp !== null) {
+            $withTimestamp = $appendTimestamp;
+        }
+
+        if ($withTimestamp && $assetPath && ($timestamp = @filemtime($assetPath)) > 0) {
             return "$assetUrl?v=$timestamp";
         }
 
diff --git a/tests/framework/web/AssetBundleTest.php b/tests/framework/web/AssetBundleTest.php
index 935761b0f..e1a023429 100644
--- a/tests/framework/web/AssetBundleTest.php
+++ b/tests/framework/web/AssetBundleTest.php
@@ -527,7 +527,6 @@ EOF;
         }
         Yii::setAlias('@web', $webAlias);
 
-
         $view = $this->getView(['appendTimestamp' => $appendTimestamp]);
         $method = 'register' . ucfirst($type) . 'File';
         $view->$method($path);
@@ -542,7 +541,7 @@ EOF;
 
         $view = $this->getView();
         $am = $view->assetManager;
-        // publising without timestamp
+        // publishing without timestamp
         $result = $am->publish($path . '/data.txt');
         $this->assertRegExp('/.*data.txt$/i', $result[1]);
         unset($view, $am, $result);
@@ -554,6 +553,21 @@ EOF;
         $result = $am->publish($path . '/data.txt');
         $this->assertRegExp('/.*data.txt\?v=\d+$/i', $result[1]);
     }
+
+    /**
+     * @see https://github.com/yiisoft/yii2/issues/18529
+     */
+    public function testNonRelativeAssetWebPathWithTimestamp()
+    {
+        Yii::setAlias('@webroot', '@yiiunit/data/web/assetSources/');
+
+        $view = $this->getView(['appendTimestamp' => true]);
+        TestNonRelativeAsset::register($view);
+        $this->assertRegExp(
+            '~123<script src="http:\/\/example\.com\/js\/jquery\.js\?v=\d+"><\/script>4~',
+            $view->renderFile('@yiiunit/data/views/rawlayout.php')
+        );
+    }
 }
 
 class TestSimpleAsset extends AssetBundle
@@ -649,3 +663,12 @@ class TestAssetPerFileOptions extends AssetBundle
     public $cssOptions = ['media' => 'screen', 'hreflang' => 'en'];
     public $jsOptions = ['charset' => 'utf-8'];
 }
+
+class TestNonRelativeAsset extends AssetBundle
+{
+    public $basePath = '@webroot/js';
+    public $baseUrl = 'http://example.com/js/';
+    public $js = [
+        'jquery.js',
+    ];
+}
