diff --git a/.appveyor.yml b/.appveyor.yml
index 4c7c815c4..ee07f29ea 100644
--- a/.appveyor.yml
+++ b/.appveyor.yml
@@ -7,10 +7,6 @@ environment:
     matrix:
       - php_ver: 7.2.4
 
-matrix:
-  allow_failures:
-    - php_ver: 7.2.4
-
 cache:
     - '%APPDATA%\Composer'
     - '%LOCALAPPDATA%\Composer'
diff --git a/framework/console/controllers/MessageController.php b/framework/console/controllers/MessageController.php
index 1f859efd1..0aa90bee2 100644
--- a/framework/console/controllers/MessageController.php
+++ b/framework/console/controllers/MessageController.php
@@ -903,6 +903,7 @@ EOD;
             $categoryFileName = str_replace($dirName, '', $messageFile);
             $categoryFileName = ltrim($categoryFileName, DIRECTORY_SEPARATOR);
             $category = preg_replace('#\.php$#', '', $categoryFileName);
+            $category = str_replace(DIRECTORY_SEPARATOR, '/', $category);
 
             if (!in_array($category, $existingCategories, true)) {
                 unlink($messageFile);
diff --git a/tests/TestCase.php b/tests/TestCase.php
index bffb71369..4dbe1504a 100644
--- a/tests/TestCase.php
+++ b/tests/TestCase.php
@@ -122,6 +122,21 @@ abstract class TestCase extends \PHPUnit\Framework\TestCase
         $this->assertEquals($expected, $actual, $message);
     }
 
+    /**
+     * Asserts that a haystack contains a needle ignoring line endings.
+     *
+     * @param mixed $needle
+     * @param mixed $haystack
+     * @param string $message
+     */
+    protected function assertContainsWithoutLE($needle, $haystack, $message = '')
+    {
+        $needle = str_replace("\r\n", "\n", $needle);
+        $haystack = str_replace("\r\n", "\n", $haystack);
+
+        $this->assertContains($needle, $haystack, $message);
+    }
+
     /**
      * Invokes a inaccessible method.
      * @param $object
diff --git a/tests/framework/helpers/ConsoleTest.php b/tests/framework/helpers/ConsoleTest.php
index 88cac6d20..7db7af585 100644
--- a/tests/framework/helpers/ConsoleTest.php
+++ b/tests/framework/helpers/ConsoleTest.php
@@ -214,7 +214,7 @@ class ConsoleTest extends TestCase
         $model->validate(null, false);
         $options = ['showAllErrors' => true];
         $expectedHtml =  "Error message. Here are some chars: < >\nError message. Here are even more chars: \"\"";
-        $this->assertEquals($expectedHtml, Console::errorSummary($model, $options));
+        $this->assertEqualsWithoutLE($expectedHtml, Console::errorSummary($model, $options));
     }
 }
 
diff --git a/tests/framework/web/ViewTest.php b/tests/framework/web/ViewTest.php
index 2b493b80b..a57c717ff 100644
--- a/tests/framework/web/ViewTest.php
+++ b/tests/framework/web/ViewTest.php
@@ -65,7 +65,7 @@ class ViewTest extends TestCase
         $view = new View();
         $view->registerJsFile('@web/js/somefile.js', ['position' => View::POS_BEGIN]);
         $html = $view->render('@yiiunit/data/views/layout.php', ['content' => 'content']);
-        $this->assertContains('<body>' . PHP_EOL . '<script src="/baseUrl/js/somefile.js"></script>', $html);
+        $this->assertContainsWithoutLE('<body>' . PHP_EOL . '<script src="/baseUrl/js/somefile.js"></script>', $html);
 
         $view = new View();
         $view->registerJsFile('@web/js/somefile.js', ['position' => View::POS_END]);
