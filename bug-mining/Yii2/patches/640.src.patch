diff --git a/framework/CHANGELOG.md b/framework/CHANGELOG.md
index 4a46e2329..7660e643a 100644
--- a/framework/CHANGELOG.md
+++ b/framework/CHANGELOG.md
@@ -4,6 +4,7 @@ Yii Framework 2 Change Log
 2.0.31 under development
 ------------------------
 
+- Bug #17661: Fix query builder incorrect IN/NOT IN condition handling for null values (strychu)
 - Enh #17665: Implement RFC 7239 `Forwarded` header parsing in Request (mikk150)
 - Bug #17687: `Query::indexBy` can now include a table alias (brandonkelly)
 - Bug #17685: Fix invalid db component in `m180523_151638_rbac_updates_indexes_without_prefix` (rvkulikov)
diff --git a/framework/db/conditions/InConditionBuilder.php b/framework/db/conditions/InConditionBuilder.php
index 0424e039a..684ec0db7 100644
--- a/framework/db/conditions/InConditionBuilder.php
+++ b/framework/db/conditions/InConditionBuilder.php
@@ -68,21 +68,36 @@ class InConditionBuilder implements ExpressionBuilderInterface
             }
         }
 
+        if (is_array($values)) {
+            $rawValues = $values;
+        } elseif ($values instanceof \Traversable) {
+            $rawValues = $this->getRawValuesFromTraversableObject($values);
+        }
+
+        if (isset($rawValues) && in_array(null, $rawValues, true)) {
+            $nullCondition = $this->getNullCondition($operator, $column);
+            $nullConditionOperator = $operator === 'IN' ? 'OR' : 'AND';
+        }
+
         $sqlValues = $this->buildValues($expression, $values, $params);
         if (empty($sqlValues)) {
-            return $operator === 'IN' ? '0=1' : '';
+            if (!isset($nullCondition)) {
+                return $operator === 'IN' ? '0=1' : '';
+            }
+            return $nullCondition;
         }
 
         if (strpos($column, '(') === false) {
             $column = $this->queryBuilder->db->quoteColumnName($column);
         }
         if (count($sqlValues) > 1) {
-            return "$column $operator (" . implode(', ', $sqlValues) . ')';
+            $sql = "$column $operator (" . implode(', ', $sqlValues) . ')';
+        } else {
+            $operator = $operator === 'IN' ? '=' : '<>';
+            $sql = $column . $operator . reset($sqlValues);
         }
 
-        $operator = $operator === 'IN' ? '=' : '<>';
-
-        return $column . $operator . reset($sqlValues);
+        return isset($nullCondition) ? sprintf('%s %s %s', $sql, $nullConditionOperator, $nullCondition) : $sql;
     }
 
     /**
@@ -112,7 +127,7 @@ class InConditionBuilder implements ExpressionBuilderInterface
                 $value = isset($value[$column]) ? $value[$column] : null;
             }
             if ($value === null) {
-                $sqlValues[$i] = 'NULL';
+                continue;
             } elseif ($value instanceof ExpressionInterface) {
                 $sqlValues[$i] = $this->queryBuilder->buildExpression($value, $params);
             } else {
@@ -188,4 +203,39 @@ class InConditionBuilder implements ExpressionBuilderInterface
 
         return '(' . implode(', ', $sqlColumns) . ") $operator (" . implode(', ', $vss) . ')';
     }
+
+    /**
+     * Builds is null/is not null condition for column based on operator
+     *
+     * @param string $operator
+     * @param string $column
+     * @return string is null or is not null condition
+     * @since 2.0.31
+     */
+    protected function getNullCondition($operator, $column) {
+        $column = $this->queryBuilder->db->quoteColumnName($column);
+        if ($operator === 'IN') {
+            return sprintf('%s IS NULL', $column);
+        }
+        return sprintf('%s IS NOT NULL', $column);
+    }
+
+    /**
+     * @param \Traversable $traversableObject
+     * @return array raw values
+     * @since 2.0.31
+     */
+    protected function getRawValuesFromTraversableObject(\Traversable $traversableObject)
+    {
+        $rawValues = [];
+        foreach ($traversableObject as $value) {
+            if (is_array($value)) {
+                $values = array_values($value);
+                $rawValues = array_merge($rawValues, $values);
+            } else {
+                $rawValues[] = $value;
+            }
+        }
+        return $rawValues;
+    }
 }
diff --git a/tests/framework/db/QueryBuilderTest.php b/tests/framework/db/QueryBuilderTest.php
index c970505b1..3d3a1af70 100644
--- a/tests/framework/db/QueryBuilderTest.php
+++ b/tests/framework/db/QueryBuilderTest.php
@@ -1178,6 +1178,18 @@ abstract class QueryBuilderTest extends DatabaseTestCase
 
             [['in', 'id', new TraversableObject([1, 2, 3])], '[[id]] IN (:qp0, :qp1, :qp2)', [':qp0' => 1, ':qp1' => 2, ':qp2' => 3]],
 
+            //in using array objects containing null value
+            [['in', 'id', new TraversableObject([1, null])], '[[id]]=:qp0 OR [[id]] IS NULL', [':qp0' => 1]],
+            [['in', 'id', new TraversableObject([1, 2, null])], '[[id]] IN (:qp0, :qp1) OR [[id]] IS NULL', [':qp0' => 1, ':qp1' => 2]],
+
+            //not in using array object containing null value
+            [['not in', 'id', new TraversableObject([1, null])], '[[id]]<>:qp0 AND [[id]] IS NOT NULL', [':qp0' => 1]],
+            [['not in', 'id', new TraversableObject([1, 2, null])], '[[id]] NOT IN (:qp0, :qp1) AND [[id]] IS NOT NULL', [':qp0' => 1, ':qp1' => 2]],
+
+            //in using array object containing only null value
+            [['in', 'id', new TraversableObject([null])], '[[id]] IS NULL', []],
+            [['not in', 'id', new TraversableObject([null])], '[[id]] IS NOT NULL', []],
+
             'composite in using array objects' => [
                 ['in', new TraversableObject(['id', 'name']), new TraversableObject([
                     ['id' => 1, 'name' => 'oy'],
