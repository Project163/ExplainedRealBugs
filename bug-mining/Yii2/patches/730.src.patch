diff --git a/framework/CHANGELOG.md b/framework/CHANGELOG.md
index c840a7d1c..2bb283854 100644
--- a/framework/CHANGELOG.md
+++ b/framework/CHANGELOG.md
@@ -4,6 +4,7 @@ Yii Framework 2 Change Log
 2.0.38 under development
 ------------------------
 
+- Bug #18066: Fixed `yii\db\Query::create()` wasn't using all info from `withQuery()` (maximkou)
 - Bug #18269: Fix integer safe attribute to work properly in `yii\base\Model` (Ladone)
 - Enh #18236: Allow `yii\filters\RateLimiter` to accept a closure function for the `$user` property in order to assign values on runtime (nadar)
 - Bug #18248: Render only one stack trace on console for chained exceptions (mikehaertl)
diff --git a/framework/db/Query.php b/framework/db/Query.php
index 6ce769b5a..471f22f9f 100644
--- a/framework/db/Query.php
+++ b/framework/db/Query.php
@@ -1383,6 +1383,7 @@ PATTERN;
             'having' => $from->having,
             'union' => $from->union,
             'params' => $from->params,
+            'withQueries' => $from->withQueries,
         ]);
     }
 
diff --git a/tests/framework/db/QueryTest.php b/tests/framework/db/QueryTest.php
index ecd7c4b92..a983f26a5 100644
--- a/tests/framework/db/QueryTest.php
+++ b/tests/framework/db/QueryTest.php
@@ -724,4 +724,71 @@ abstract class QueryTest extends DatabaseTestCase
             $this->assertEquals('user11', $query->cache()->where(['id' => 1])->scalar($db));
         }, 10);
     }
+
+
+    /**
+     * checks that all needed properties copied from source to new query
+     */
+    public function testQueryCreation()
+    {
+        $where = 'id > :min_user_id';
+        $limit = 50;
+        $offset = 2;
+        $orderBy = ['name' => SORT_ASC];
+        $indexBy = 'id';
+        $select = ['id' => 'id', 'name' => 'name', 'articles_count' => 'count(*)'];
+        $selectOption = 'SQL_NO_CACHE';
+        $from = 'recent_users';
+        $groupBy = 'id';
+        $having = ['>', 'articles_count', 0];
+        $params = [':min_user_id' => 100];
+        list($joinType, $joinTable, $joinOn) = $join =  ['INNER', 'articles', 'articles.author_id=users.id'];
+
+        $unionQuery = (new Query())
+            ->select('id, name, 1000 as articles_count')
+            ->from('admins');
+
+        $withQuery = (new Query())
+            ->select('id, name')
+            ->from('users')
+            ->where('DATE(registered_at) > "2020-01-01"');
+
+        // build target query
+        $sourceQuery = (new Query())
+            ->where($where)
+            ->limit($limit)
+            ->offset($offset)
+            ->orderBy($orderBy)
+            ->indexBy($indexBy)
+            ->select($select, $selectOption)
+            ->distinct()
+            ->from($from)
+            ->groupBy($groupBy)
+            ->having($having)
+            ->addParams($params)
+            ->join($joinType, $joinTable, $joinOn)
+            ->union($unionQuery)
+            ->withQuery($withQuery, $from);
+
+        $newQuery = Query::create($sourceQuery);
+
+        $this->assertEquals($where, $newQuery->where);
+        $this->assertEquals($limit, $newQuery->limit);
+        $this->assertEquals($offset, $newQuery->offset);
+        $this->assertEquals($orderBy, $newQuery->orderBy);
+        $this->assertEquals($indexBy, $newQuery->indexBy);
+        $this->assertEquals($select, $newQuery->select);
+        $this->assertEquals($selectOption, $newQuery->selectOption);
+        $this->assertTrue($newQuery->distinct);
+        $this->assertEquals([$from], $newQuery->from);
+        $this->assertEquals([$groupBy], $newQuery->groupBy);
+        $this->assertEquals($having, $newQuery->having);
+        $this->assertEquals($params, $newQuery->params);
+        $this->assertEquals([$join], $newQuery->join);
+        $this->assertEquals([['query' => $unionQuery, 'all' => false]], $newQuery->union);
+        $this->assertEquals(
+            [['query' => $withQuery, 'alias' => $from, 'recursive' => false]],
+            $newQuery->withQueries
+        );
+    }
 }
