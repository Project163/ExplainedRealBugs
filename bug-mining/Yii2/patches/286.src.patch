diff --git a/framework/db/Command.php b/framework/db/Command.php
index e8fb11d70..dc360e37f 100644
--- a/framework/db/Command.php
+++ b/framework/db/Command.php
@@ -828,13 +828,7 @@ class Command extends Component
     public function execute()
     {
         $sql = $this->getSql();
-
-        $log = $this->db->enableQueryLog;
-        if ($log) {
-            $rawSql = $this->getRawSql();
-            Yii::info($rawSql, __METHOD__);
-            $token = $rawSql;
-        }
+        list($profile, $rawSql) = $this->logQuery(__METHOD__);
 
         if ($sql == '') {
             return 0;
@@ -843,19 +837,39 @@ class Command extends Component
         $this->prepare(false);
 
         try {
-            $log && Yii::beginProfile($token, __METHOD__);
+            $profile and Yii::beginProfile($rawSql, __METHOD__);
 
             $this->pdoStatement->execute();
             $n = $this->pdoStatement->rowCount();
 
-            $log && Yii::endProfile($token, __METHOD__);
+            $profile and Yii::endProfile($rawSql, __METHOD__);
 
             $this->refreshTableSchema();
 
             return $n;
         } catch (\Exception $e) {
-            $log && Yii::endProfile($token, __METHOD__);
-            throw $this->db->getSchema()->convertException($e, $rawSql);
+            $profile and Yii::endProfile($rawSql, __METHOD__);
+            throw $this->db->getSchema()->convertException($e, $rawSql ?: $this->getRawSql());
+        }
+    }
+
+    /**
+     * Logs the current database query if query logging is enabled and returns
+     * the profiling token if profiling is enabled.
+     * @param string $category the log category.
+     * @return array array of two elements, the first is boolean of whether profiling is enabled or not.
+     * The second is the rawSql if it has been created.
+     */
+    private function logQuery($category)
+    {
+        if ($this->db->enableLogging) {
+            $rawSql = $this->getRawSql();
+            Yii::info($rawSql, $category);
+        }
+        if (!$this->db->enableProfiling) {
+            return [false, isset($rawSql) ? $rawSql : null];
+        } else {
+            return [true, isset($rawSql) ? $rawSql : $this->getRawSql()];
         }
     }
 
@@ -870,12 +884,7 @@ class Command extends Component
      */
     protected function queryInternal($method, $fetchMode = null)
     {
-        $log = $this->db->enableQueryLog;
-        if ($log) {
-            $rawSql = $this->getRawSql();
-            Yii::info($rawSql, 'yii\db\Command::query');
-            $token = $rawSql;
-        }
+        list($profile, $rawSql) = $this->logQuery('yii\db\Command::query');
 
         if ($method !== '') {
             $info = $this->db->getQueryCacheInfo($this->queryCacheDuration, $this->queryCacheDependency);
@@ -888,7 +897,7 @@ class Command extends Component
                     $fetchMode,
                     $this->db->dsn,
                     $this->db->username,
-                    isset($rawSql) ? $rawSql : $this->getRawSql(),
+                    $rawSql ?: $rawSql = $this->getRawSql(),
                 ];
                 $result = $cache->get($cacheKey);
                 if (is_array($result) && isset($result[0])) {
@@ -901,7 +910,7 @@ class Command extends Component
         $this->prepare(true);
 
         try {
-            $log && Yii::beginProfile($token, 'yii\db\Command::query');
+            $profile and Yii::beginProfile($rawSql, 'yii\db\Command::query');
 
             $this->pdoStatement->execute();
 
@@ -915,10 +924,10 @@ class Command extends Component
                 $this->pdoStatement->closeCursor();
             }
 
-            $log && Yii::endProfile($token, 'yii\db\Command::query');
+            $profile and Yii::endProfile($rawSql, 'yii\db\Command::query');
         } catch (\Exception $e) {
-            $log && Yii::endProfile($token, 'yii\db\Command::query');
-            throw $this->db->getSchema()->convertException($e, isset($rawSql) ? $rawSql : $this->getRawSql());
+            $profile and Yii::endProfile($rawSql, 'yii\db\Command::query');
+            throw $this->db->getSchema()->convertException($e, $rawSql ?: $this->getRawSql());
         }
 
         if (isset($cache, $cacheKey, $info)) {
diff --git a/framework/db/Connection.php b/framework/db/Connection.php
index e12b02d98..ceebcc93f 100644
--- a/framework/db/Connection.php
+++ b/framework/db/Connection.php
@@ -374,13 +374,21 @@ class Connection extends Component
      */
     public $shuffleMasters = true;
     /**
-     * @var bool whether to enable logging and profiling of database queries. Defaults to true.
+     * @var bool whether to enable logging of database queries. Defaults to true.
      * You may want to disable this option in a production environment to gain performance
      * if you do not need the information being logged.
      * @since 2.0.12
+     * @see enableProfiling
      */
-    public $enableQueryLog = true;
-
+    public $enableLogging = true;
+    /**
+     * @var bool whether to enable profiling of database queries. Defaults to true.
+     * You may want to disable this option in a production environment to gain performance
+     * if you do not need the information being logged.
+     * @since 2.0.12
+     * @see enableLogging
+     */
+    public $enableProfiling = true;
     /**
      * @var Transaction the currently active transaction
      */
diff --git a/tests/framework/db/ConnectionTest.php b/tests/framework/db/ConnectionTest.php
index 46b0c3dfe..df694f7e4 100644
--- a/tests/framework/db/ConnectionTest.php
+++ b/tests/framework/db/ConnectionTest.php
@@ -221,15 +221,15 @@ abstract class ConnectionTest extends DatabaseTestCase
     public function testEnableQueryLog()
     {
         $connection = $this->getConnection();
-        if ($connection->getTableSchema('qlog1', true) !== null) {
-            $connection->createCommand()->dropTable('qlog1')->execute();
-        }
-        if ($connection->getTableSchema('qlog2', true) !== null) {
-            $connection->createCommand()->dropTable('qlog2')->execute();
+        foreach(['qlog1', 'qlog2', 'qlog3', 'qlog4'] as $table) {
+            if ($connection->getTableSchema($table, true) !== null) {
+                $connection->createCommand()->dropTable($table)->execute();
+            }
         }
 
-        // enabled
-        $connection->enableQueryLog = true;
+        // profiling and logging
+        $connection->enableLogging = true;
+        $connection->enableProfiling = true;
 
         \Yii::getLogger()->messages = [];
         $connection->createCommand()->createTable('qlog1', ['id' => 'pk'])->execute();
@@ -240,17 +240,95 @@ abstract class ConnectionTest extends DatabaseTestCase
         $connection->createCommand('SELECT * FROM qlog1')->queryAll();
         $this->assertCount(3, \Yii::getLogger()->messages);
 
-        // disabled
-        $connection->enableQueryLog = false;
+        // profiling only
+        $connection->enableLogging = false;
+        $connection->enableProfiling = true;
 
         \Yii::getLogger()->messages = [];
         $connection->createCommand()->createTable('qlog2', ['id' => 'pk'])->execute();
+        $this->assertCount(2, \Yii::getLogger()->messages);
         $this->assertNotNull($connection->getTableSchema('qlog2', true));
-        $this->assertCount(0, \Yii::getLogger()->messages);
+
+        \Yii::getLogger()->messages = [];
         $connection->createCommand('SELECT * FROM qlog2')->queryAll();
+        $this->assertCount(2, \Yii::getLogger()->messages);
+
+        // logging only
+        $connection->enableLogging = true;
+        $connection->enableProfiling = false;
+
+        \Yii::getLogger()->messages = [];
+        $connection->createCommand()->createTable('qlog3', ['id' => 'pk'])->execute();
+        $this->assertCount(1, \Yii::getLogger()->messages);
+        $this->assertNotNull($connection->getTableSchema('qlog3', true));
+
+        \Yii::getLogger()->messages = [];
+        $connection->createCommand('SELECT * FROM qlog3')->queryAll();
+        $this->assertCount(1, \Yii::getLogger()->messages);
+
+        // disabled
+        $connection->enableLogging = false;
+        $connection->enableProfiling = false;
+
+        \Yii::getLogger()->messages = [];
+        $connection->createCommand()->createTable('qlog4', ['id' => 'pk'])->execute();
+        $this->assertNotNull($connection->getTableSchema('qlog4', true));
+        $this->assertCount(0, \Yii::getLogger()->messages);
+        $connection->createCommand('SELECT * FROM qlog4')->queryAll();
         $this->assertCount(0, \Yii::getLogger()->messages);
+    }
+
+    public function testExceptionContainsRawQuery()
+    {
+        $connection = $this->getConnection();
+        if ($connection->getTableSchema('qlog1', true) === null) {
+            $connection->createCommand()->createTable('qlog1', ['id' => 'pk'])->execute();
+        }
+        $connection->emulatePrepare = true;
+
+        // profiling and logging
+        $connection->enableLogging = true;
+        $connection->enableProfiling = true;
+        $this->runExceptionTest($connection);
 
 
+        // profiling only
+        $connection->enableLogging = false;
+        $connection->enableProfiling = true;
+        $this->runExceptionTest($connection);
 
+        // logging only
+        $connection->enableLogging = true;
+        $connection->enableProfiling = false;
+        $this->runExceptionTest($connection);
+
+        // disabled
+        $connection->enableLogging = false;
+        $connection->enableProfiling = false;
+        $this->runExceptionTest($connection);
+    }
+
+    /**
+     * @param Connection $connection
+     */
+    private function runExceptionTest($connection)
+    {
+        $thrown = false;
+        try {
+            $connection->createCommand('INSERT INTO qlog1(a) VALUES(:a);', [':a' => 1])->execute();
+        } catch(\yii\db\Exception $e) {
+            $this->assertContains('INSERT INTO qlog1(a) VALUES(1);', $e->getMessage(), 'Exception message should contain raw SQL query: ' . (string)$e);
+            $thrown = true;
+        }
+        $this->assertTrue($thrown, 'An exception should have been thrown by the command.');
+
+        $thrown = false;
+        try {
+            $connection->createCommand('SELECT * FROM qlog1 WHERE id=:a ORDER BY nonexistingcolumn;', [':a' => 1])->queryAll();
+        } catch(\yii\db\Exception $e) {
+            $this->assertContains('SELECT * FROM qlog1 WHERE id=1 ORDER BY nonexistingcolumn;', $e->getMessage(), 'Exception message should contain raw SQL query: ' . (string)$e);
+            $thrown = true;
+        }
+        $this->assertTrue($thrown, 'An exception should have been thrown by the command.');
     }
 }
diff --git a/tests/framework/db/sqlite/ConnectionTest.php b/tests/framework/db/sqlite/ConnectionTest.php
index fbbc97a77..2f869bdad 100644
--- a/tests/framework/db/sqlite/ConnectionTest.php
+++ b/tests/framework/db/sqlite/ConnectionTest.php
@@ -202,4 +202,10 @@ class ConnectionTest extends \yiiunit\framework\db\ConnectionTest
 
         $connection->close();
     }
+
+    public function testExceptionContainsRawQuery()
+    {
+        // This test does not work on sqlite because preparing the failing query fails
+    }
+
 }
