diff --git a/framework/web/View.php b/framework/web/View.php
index 7035b6057..3d5c22e48 100644
--- a/framework/web/View.php
+++ b/framework/web/View.php
@@ -401,7 +401,11 @@ class View extends \yii\base\View
 
         $depends = ArrayHelper::remove($options, 'depends', []);
 
-        $url = str_replace(Yii::getAlias('@web'), '', $url);
+        $webAlias = Yii::getAlias('@web');
+        if ($webAlias !== '' && strpos($url, $webAlias) === 0) {
+            $url = str_replace($webAlias, '', $url);
+        }
+
         $url = strncmp($url, '//', 2) === 0 ? $url : ltrim($url, '/');
 
         /** @var AssetBundle $bundle */
@@ -476,7 +480,11 @@ class View extends \yii\base\View
 
         $depends = ArrayHelper::remove($options, 'depends', []);
 
-        $url = str_replace(Yii::getAlias('@web'), '', $url);
+        $webAlias = Yii::getAlias('@web');
+        if ($webAlias !== '' && strpos($url, $webAlias) === 0) {
+            $url = str_replace($webAlias, '', $url);
+        }
+
         $url = strncmp($url, '//', 2) === 0 ? $url : ltrim($url, '/');
 
         /** @var AssetBundle $bundle */
diff --git a/tests/framework/web/AssetBundleTest.php b/tests/framework/web/AssetBundleTest.php
index 267cdb951..eb84408ab 100644
--- a/tests/framework/web/AssetBundleTest.php
+++ b/tests/framework/web/AssetBundleTest.php
@@ -407,14 +407,24 @@ EOF;
             ],
 
             // Custom `@web` aliases
+            [
+                'js', '@web/assetSources/js/missing-file1.js', true,
+                '123<script src="/backend/assetSources/js/missing-file1.js"></script>4',
+                '/backend'
+            ],
             [
                 'js', '@web/assetSources/js/jquery.js', true,
                 '123<script src="/backend/assetSources/js/jquery.js\?v=\d{10}"></script>4',
                 '/backend'
             ],
             [
-                'js', '@web/assetSources/js/missing-file.js', true,
-                '123<script src="/backend/assetSources/js/missing-file.js"></script>4',
+                'js', 'http://full-url.example.com/backend/assetSources/js/missing-file.js', true,
+                '123<script src="http://full-url.example.com/backend/assetSources/js/missing-file.js"></script>4',
+                '/backend'
+            ],
+            [
+                'css', '//backend/backend/assetSources/js/missing-file.js', true,
+                '1<link href="//backend/backend/assetSources/js/missing-file.js" rel="stylesheet">234',
                 '/backend'
             ],
             [
