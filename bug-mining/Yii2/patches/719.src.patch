diff --git a/framework/CHANGELOG.md b/framework/CHANGELOG.md
index 87ad7609a..03af91e6d 100644
--- a/framework/CHANGELOG.md
+++ b/framework/CHANGELOG.md
@@ -11,6 +11,7 @@ Yii Framework 2 Change Log
 - Bug #18189: Fix "Invalid parameter number" in `yii\rbac\DbManager::removeItem()` (samdark)
 - Bug #18204: Fix 2.0.36 regression in inline validator and JS validation (samdark)
 - Enh #18205: Add `.phpstorm.meta.php` file for better auto-completion in PhpStorm (vjik)
+- Bug #18198: Fix saving tables with trigger by outputting inserted data from insert query with usage of temporary table (darkdef)
 
 
 2.0.36 July 07, 2020
diff --git a/framework/db/mssql/QueryBuilder.php b/framework/db/mssql/QueryBuilder.php
index a48d1f9d1..76a87277d 100644
--- a/framework/db/mssql/QueryBuilder.php
+++ b/framework/db/mssql/QueryBuilder.php
@@ -448,10 +448,25 @@ class QueryBuilder extends \yii\db\QueryBuilder
         $version2005orLater = version_compare($this->db->getSchema()->getServerVersion(), '9', '>=');
 
         list($names, $placeholders, $values, $params) = $this->prepareInsertValues($table, $columns, $params);
-        return 'INSERT INTO ' . $this->db->quoteTableName($table)
+
+        $sql = 'INSERT INTO ' . $this->db->quoteTableName($table)
             . (!empty($names) ? ' (' . implode(', ', $names) . ')' : '')
-            . ($version2005orLater ? ' OUTPUT INSERTED.*' : '')
+            . ($version2005orLater ? ' OUTPUT INSERTED.* INTO @temporary_inserted' : '')
             . (!empty($placeholders) ? ' VALUES (' . implode(', ', $placeholders) . ')' : $values);
+
+        if ($version2005orLater) {
+            $schema = $this->db->getTableSchema($table);
+            $cols = [];
+            foreach ($schema->columns as $column) {
+                $cols[] = $this->db->quoteColumnName($column->name) . ' '
+                    . $column->dbType
+                    . (in_array($column->dbType, ['char', 'varchar', 'nchar', 'nvarchar', 'binary', 'varbinary']) ? "(MAX)" : "")
+                    . ' ' . ($column->allowNull ? "NULL" : "");
+            }
+            $sql = "SET NOCOUNT ON;DECLARE @temporary_inserted TABLE (" . implode(", ", $cols) . ");" . $sql . ";SELECT * FROM @temporary_inserted";
+        }
+
+        return $sql;
     }
 
     /**
diff --git a/tests/data/ar/TestTrigger.php b/tests/data/ar/TestTrigger.php
new file mode 100644
index 000000000..134074498
--- /dev/null
+++ b/tests/data/ar/TestTrigger.php
@@ -0,0 +1,22 @@
+<?php
+/**
+ * @link http://www.yiiframework.com/
+ * @copyright Copyright (c) 2008 Yii Software LLC
+ * @license http://www.yiiframework.com/license/
+ */
+
+namespace yiiunit\data\ar;
+
+/**
+ * Class TestTrigger.
+ *
+ * @property int $id
+ * @property string $stringcol
+ */
+class TestTrigger extends ActiveRecord
+{
+    public static function tableName()
+    {
+        return 'test_trigger';
+    }
+}
diff --git a/tests/data/ar/TestTriggerAlert.php b/tests/data/ar/TestTriggerAlert.php
new file mode 100644
index 000000000..ca08e25f0
--- /dev/null
+++ b/tests/data/ar/TestTriggerAlert.php
@@ -0,0 +1,22 @@
+<?php
+/**
+ * @link http://www.yiiframework.com/
+ * @copyright Copyright (c) 2008 Yii Software LLC
+ * @license http://www.yiiframework.com/license/
+ */
+
+namespace yiiunit\data\ar;
+
+/**
+ * Class TestTriggerAlert.
+ *
+ * @property int $id
+ * @property string $stringcol
+ */
+class TestTriggerAlert extends ActiveRecord
+{
+    public static function tableName()
+    {
+        return 'test_trigger_alert';
+    }
+}
diff --git a/tests/data/mssql.sql b/tests/data/mssql.sql
index 7207c18b4..bb41edfd5 100644
--- a/tests/data/mssql.sql
+++ b/tests/data/mssql.sql
@@ -9,6 +9,8 @@ IF OBJECT_ID('[dbo].[customer]', 'U') IS NOT NULL DROP TABLE [dbo].[customer];
 IF OBJECT_ID('[dbo].[profile]', 'U') IS NOT NULL DROP TABLE [dbo].[profile];
 IF OBJECT_ID('[dbo].[type]', 'U') IS NOT NULL DROP TABLE [dbo].[type];
 IF OBJECT_ID('[dbo].[null_values]', 'U') IS NOT NULL DROP TABLE [dbo].[null_values];
+IF OBJECT_ID('[dbo].[test_trigger]', 'U') IS NOT NULL DROP TABLE [dbo].[test_trigger];
+IF OBJECT_ID('[dbo].[test_trigger_alert]', 'U') IS NOT NULL DROP TABLE [dbo].[test_trigger_alert];
 IF OBJECT_ID('[dbo].[negative_default_values]', 'U') IS NOT NULL DROP TABLE [dbo].[negative_default_values];
 IF OBJECT_ID('[dbo].[animal]', 'U') IS NOT NULL DROP TABLE [dbo].[animal];
 IF OBJECT_ID('[dbo].[default_pk]', 'U') IS NOT NULL DROP TABLE [dbo].[default_pk];
@@ -375,3 +377,16 @@ CREATE TABLE [dbo].[stranger 'table] (
     [id] [int],
     [stranger 'field] [varchar] (32)
 );
+
+CREATE TABLE [dbo].[test_trigger] (
+  [id] [int] IDENTITY NOT NULL,
+  [stringcol] [varchar](32) DEFAULT NULL,
+  PRIMARY KEY (id)
+);
+
+CREATE TABLE [dbo].[test_trigger_alert] (
+  [id] [int] IDENTITY NOT NULL,
+  [stringcol] [varchar](32) DEFAULT NULL,
+  PRIMARY KEY (id)
+);
+
diff --git a/tests/framework/db/mssql/ActiveRecordTest.php b/tests/framework/db/mssql/ActiveRecordTest.php
index 79c6f0e65..086938807 100644
--- a/tests/framework/db/mssql/ActiveRecordTest.php
+++ b/tests/framework/db/mssql/ActiveRecordTest.php
@@ -7,6 +7,9 @@
 
 namespace yiiunit\framework\db\mssql;
 
+use yiiunit\data\ar\TestTrigger;
+use yiiunit\data\ar\TestTriggerAlert;
+
 /**
  * @group db
  * @group mssql
@@ -19,4 +22,38 @@ class ActiveRecordTest extends \yiiunit\framework\db\ActiveRecordTest
     {
         $this->markTestSkipped('MSSQL does not support explicit value for an IDENTITY column.');
     }
+
+    /**
+     * @throws \yii\db\Exception
+     */
+    public function testSaveWithTrigger()
+    {
+        $db = $this->getConnection();
+
+        // drop trigger if exist
+        $sql = 'IF (OBJECT_ID(N\'[dbo].[test_alert]\') IS NOT NULL)
+BEGIN
+      DROP TRIGGER [dbo].[test_alert];
+END';
+        $db->createCommand($sql)->execute();
+
+        // create trigger
+        $sql = 'CREATE TRIGGER [dbo].[test_alert] ON [dbo].[test_trigger]
+AFTER INSERT
+AS
+BEGIN
+    INSERT INTO [dbo].[test_trigger_alert] ( [stringcol] )
+    SELECT [stringcol]
+    FROM [inserted]
+END';
+        $db->createCommand($sql)->execute();
+
+        $record = new TestTrigger();
+        $record->stringcol = 'test';
+        $this->assertTrue($record->save(false));
+        $this->assertEquals(1, $record->id);
+
+        $testRecord = TestTriggerAlert::findOne(1);
+        $this->assertEquals('test', $testRecord->stringcol);
+    }
 }
diff --git a/tests/framework/db/mssql/QueryBuilderTest.php b/tests/framework/db/mssql/QueryBuilderTest.php
index c61642239..e6fa6f923 100644
--- a/tests/framework/db/mssql/QueryBuilderTest.php
+++ b/tests/framework/db/mssql/QueryBuilderTest.php
@@ -276,7 +276,9 @@ class QueryBuilderTest extends \yiiunit\framework\db\QueryBuilderTest
                     'related_id' => null,
                 ],
                 [],
-                $this->replaceQuotes('INSERT INTO [[customer]] ([[email]], [[name]], [[address]], [[is_active]], [[related_id]]) OUTPUT INSERTED.* VALUES (:qp0, :qp1, :qp2, :qp3, :qp4)'),
+                $this->replaceQuotes('SET NOCOUNT ON;DECLARE @temporary_inserted TABLE ([id] int , [email] varchar(128) , [name] varchar(128) NULL, [address] text NULL, [status] int NULL, [profile_id] int NULL);' .
+                    'INSERT INTO [[customer]] ([[email]], [[name]], [[address]], [[is_active]], [[related_id]]) OUTPUT INSERTED.* INTO @temporary_inserted VALUES (:qp0, :qp1, :qp2, :qp3, :qp4);' .
+                    'SELECT * FROM @temporary_inserted'),
                 [
                     ':qp0' => 'test@example.com',
                     ':qp1' => 'silverfire',
@@ -292,7 +294,9 @@ class QueryBuilderTest extends \yiiunit\framework\db\QueryBuilderTest
                     '[[time]]' => new Expression('now()'),
                 ],
                 [],
-                'INSERT INTO {{%type}} ({{%type}}.[[related_id]], [[time]]) OUTPUT INSERTED.* VALUES (:qp0, now())',
+                'SET NOCOUNT ON;DECLARE @temporary_inserted TABLE ([int_col] int , [int_col2] int NULL, [tinyint_col] tinyint NULL, [smallint_col] smallint NULL, [char_col] char(100) , [char_col2] varchar(100) NULL, [char_col3] text NULL, [float_col] decimal , [float_col2] float NULL, [blob_col] varbinary(MAX) NULL, [numeric_col] decimal NULL, [time] datetime , [bool_col] tinyint , [bool_col2] tinyint NULL);' .
+                'INSERT INTO {{%type}} ({{%type}}.[[related_id]], [[time]]) OUTPUT INSERTED.* INTO @temporary_inserted VALUES (:qp0, now());' .
+                'SELECT * FROM @temporary_inserted',
                 [
                     ':qp0' => null,
                 ],
@@ -308,7 +312,9 @@ class QueryBuilderTest extends \yiiunit\framework\db\QueryBuilderTest
                     'col' => new Expression('CONCAT(:phFoo, :phBar)', [':phFoo' => 'foo']),
                 ],
                 [':phBar' => 'bar'],
-                $this->replaceQuotes('INSERT INTO [[customer]] ([[email]], [[name]], [[address]], [[is_active]], [[related_id]], [[col]]) OUTPUT INSERTED.* VALUES (:qp1, :qp2, :qp3, :qp4, :qp5, CONCAT(:phFoo, :phBar))'),
+                $this->replaceQuotes('SET NOCOUNT ON;DECLARE @temporary_inserted TABLE ([id] int , [email] varchar(128) , [name] varchar(128) NULL, [address] text NULL, [status] int NULL, [profile_id] int NULL);' .
+                    'INSERT INTO [[customer]] ([[email]], [[name]], [[address]], [[is_active]], [[related_id]], [[col]]) OUTPUT INSERTED.* INTO @temporary_inserted VALUES (:qp1, :qp2, :qp3, :qp4, :qp5, CONCAT(:phFoo, :phBar));' .
+                    'SELECT * FROM @temporary_inserted'),
                 [
                     ':phBar' => 'bar',
                     ':qp1' => 'test@example.com',
@@ -339,7 +345,9 @@ class QueryBuilderTest extends \yiiunit\framework\db\QueryBuilderTest
                         'col' => new Expression('CONCAT(:phFoo, :phBar)', [':phFoo' => 'foo']),
                     ]),
                 [':phBar' => 'bar'],
-                $this->replaceQuotes('INSERT INTO [[customer]] ([[email]], [[name]], [[address]], [[is_active]], [[related_id]]) OUTPUT INSERTED.* SELECT [[email]], [[name]], [[address]], [[is_active]], [[related_id]] FROM [[customer]] WHERE ([[email]]=:qp1) AND ([[name]]=:qp2) AND ([[address]]=:qp3) AND ([[is_active]]=:qp4) AND ([[related_id]] IS NULL) AND ([[col]]=CONCAT(:phFoo, :phBar))'),
+                $this->replaceQuotes('SET NOCOUNT ON;DECLARE @temporary_inserted TABLE ([id] int , [email] varchar(128) , [name] varchar(128) NULL, [address] text NULL, [status] int NULL, [profile_id] int NULL);' .
+                    'INSERT INTO [[customer]] ([[email]], [[name]], [[address]], [[is_active]], [[related_id]]) OUTPUT INSERTED.* INTO @temporary_inserted SELECT [[email]], [[name]], [[address]], [[is_active]], [[related_id]] FROM [[customer]] WHERE ([[email]]=:qp1) AND ([[name]]=:qp2) AND ([[address]]=:qp3) AND ([[is_active]]=:qp4) AND ([[related_id]] IS NULL) AND ([[col]]=CONCAT(:phFoo, :phBar));' .
+                    'SELECT * FROM @temporary_inserted'),
                 [
                     ':phBar' => 'bar',
                     ':qp1' => 'test@example.com',
@@ -387,13 +395,19 @@ class QueryBuilderTest extends \yiiunit\framework\db\QueryBuilderTest
                 3 => 'MERGE [T_upsert] WITH (HOLDLOCK) USING (SELECT [email], 2 AS [status] FROM [customer] WHERE [name]=:qp0 ORDER BY (SELECT NULL) OFFSET 0 ROWS FETCH NEXT 1 ROWS ONLY) AS [EXCLUDED] ([email], [status]) ON ([T_upsert].[email]=[EXCLUDED].[email]) WHEN NOT MATCHED THEN INSERT ([email], [status]) VALUES ([EXCLUDED].[email], [EXCLUDED].[status]);',
             ],
             'values and expressions' => [
-                3 => 'INSERT INTO {{%T_upsert}} ({{%T_upsert}}.[[email]], [[ts]]) OUTPUT INSERTED.* VALUES (:qp0, now())',
+                3 => 'SET NOCOUNT ON;DECLARE @temporary_inserted TABLE ([id] int , [ts] int NULL, [email] varchar(128) , [recovery_email] varchar(128) NULL, [address] text NULL, [status] tinyint , [orders] int , [profile_id] int NULL);' .
+                    'INSERT INTO {{%T_upsert}} ({{%T_upsert}}.[[email]], [[ts]]) OUTPUT INSERTED.* INTO @temporary_inserted VALUES (:qp0, now());' .
+                    'SELECT * FROM @temporary_inserted',
             ],
             'values and expressions with update part' => [
-                3 => 'INSERT INTO {{%T_upsert}} ({{%T_upsert}}.[[email]], [[ts]]) OUTPUT INSERTED.* VALUES (:qp0, now())',
+                3 => 'SET NOCOUNT ON;DECLARE @temporary_inserted TABLE ([id] int , [ts] int NULL, [email] varchar(128) , [recovery_email] varchar(128) NULL, [address] text NULL, [status] tinyint , [orders] int , [profile_id] int NULL);' .
+                    'INSERT INTO {{%T_upsert}} ({{%T_upsert}}.[[email]], [[ts]]) OUTPUT INSERTED.* INTO @temporary_inserted VALUES (:qp0, now());' .
+                    'SELECT * FROM @temporary_inserted',
             ],
             'values and expressions without update part' => [
-                3 => 'INSERT INTO {{%T_upsert}} ({{%T_upsert}}.[[email]], [[ts]]) OUTPUT INSERTED.* VALUES (:qp0, now())',
+                3 => 'SET NOCOUNT ON;DECLARE @temporary_inserted TABLE ([id] int , [ts] int NULL, [email] varchar(128) , [recovery_email] varchar(128) NULL, [address] text NULL, [status] tinyint , [orders] int , [profile_id] int NULL);' .
+                    'INSERT INTO {{%T_upsert}} ({{%T_upsert}}.[[email]], [[ts]]) OUTPUT INSERTED.* INTO @temporary_inserted VALUES (:qp0, now());' .
+                    'SELECT * FROM @temporary_inserted',
             ],
             'query, values and expressions with update part' => [
                 3 => 'MERGE {{%T_upsert}} WITH (HOLDLOCK) USING (SELECT :phEmail AS [email], now() AS [[time]]) AS [EXCLUDED] ([email], [[time]]) ON ({{%T_upsert}}.[email]=[EXCLUDED].[email]) WHEN MATCHED THEN UPDATE SET [ts]=:qp1, [[orders]]=T_upsert.orders + 1 WHEN NOT MATCHED THEN INSERT ([email], [[time]]) VALUES ([EXCLUDED].[email], [EXCLUDED].[[time]]);',
