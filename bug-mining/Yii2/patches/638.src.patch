diff --git a/framework/CHANGELOG.md b/framework/CHANGELOG.md
index 76cfadc40..4a46e2329 100644
--- a/framework/CHANGELOG.md
+++ b/framework/CHANGELOG.md
@@ -4,6 +4,7 @@ Yii Framework 2 Change Log
 2.0.31 under development
 ------------------------
 
+- Enh #17665: Implement RFC 7239 `Forwarded` header parsing in Request (mikk150)
 - Bug #17687: `Query::indexBy` can now include a table alias (brandonkelly)
 - Bug #17685: Fix invalid db component in `m180523_151638_rbac_updates_indexes_without_prefix` (rvkulikov)
 - Bug #17694: Fixed Error Handler to clear registered view tags, scripts, and files when rendering error view through action view (bizley)
diff --git a/framework/web/Request.php b/framework/web/Request.php
index 9d1215d3d..320c94b21 100644
--- a/framework/web/Request.php
+++ b/framework/web/Request.php
@@ -226,6 +226,9 @@ class Request extends \yii\base\Request
         // Microsoft:
         'Front-End-Https',
         'X-Rewrite-Url',
+
+        // RFC 7239:
+        'Forwarded',
     ];
     /**
      * @var string[] List of headers where proxies store the real client IP.
@@ -725,7 +728,9 @@ class Request extends \yii\base\Request
             $secure = $this->getIsSecureConnection();
             $http = $secure ? 'https' : 'http';
 
-            if ($this->headers->has('X-Forwarded-Host')) {
+            if ($this->getSecureForwardedHeaderTrustedPart('host')) {
+                $this->_hostInfo = $http . '://' . $this->getSecureForwardedHeaderTrustedPart('host');
+            } elseif ($this->headers->has('X-Forwarded-Host')) {
                 $this->_hostInfo = $http . '://' . trim(explode(',', $this->headers->get('X-Forwarded-Host'))[0]);
             } elseif ($this->headers->has('Host')) {
                 $this->_hostInfo = $http . '://' . $this->headers->get('Host');
@@ -1066,6 +1071,11 @@ class Request extends \yii\base\Request
         if (isset($_SERVER['HTTPS']) && (strcasecmp($_SERVER['HTTPS'], 'on') === 0 || $_SERVER['HTTPS'] == 1)) {
             return true;
         }
+
+        if (($proto = $this->getSecureForwardedHeaderTrustedPart('proto')) !== null) {
+            return strcasecmp($proto, 'https') === 0;
+        }
+
         foreach ($this->secureProtocolHeaders as $header => $values) {
             if (($headerValue = $this->headers->get($header, null)) !== null) {
                 foreach ($values as $value) {
@@ -1141,8 +1151,22 @@ class Request extends \yii\base\Request
      * @see $ipHeaders
      * @since 2.0.28
      */
-    protected function getUserIpFromIpHeaders() {
-        foreach($this->ipHeaders as $ipHeader) {
+    protected function getUserIpFromIpHeaders()
+    {
+        $ip = $this->getSecureForwardedHeaderTrustedPart('for');
+        if ($ip !== null && preg_match(
+            '/^\[?(?P<ip>(?:(?:(?:[0-9a-f]{1,4}:){1,6}(?:[0-9a-f]{1,4})?(?:(?::[0-9a-f]{1,4}){1,6}))|(?:[\d]{1,3}\.){3}[\d]{1,3}))\]?(?::(?P<port>[\d]+))?$/',
+            $ip,
+            $matches
+        )) {
+            $ip = $this->getUserIpFromIpHeader($matches['ip']);
+            if ($ip !== null) {
+                return $ip;
+            }
+        }
+
+
+        foreach ($this->ipHeaders as $ipHeader) {
             if ($this->headers->has($ipHeader)) {
                 $ip = $this->getUserIpFromIpHeader($this->headers->get($ipHeader));
                 if ($ip !== null) {
@@ -1809,4 +1833,83 @@ class Request extends \yii\base\Request
 
         return $security->compareString($security->unmaskToken($clientSuppliedToken), $security->unmaskToken($trueToken));
     }
+
+    /**
+     * Gets first `Forwarded` header value for token
+     *
+     * @param string $token Header token
+     *
+     * @return string
+     *
+     * @since 2.0.31
+     */
+    protected function getSecureForwardedHeaderTrustedPart($token)
+    {
+        $token = strtolower($token);
+
+        if ($parts = $this->getSecureForwardedHeaderTrustedParts()) {
+            $lastElement = array_pop($parts);
+            if ($lastElement && isset($lastElement[$token])) {
+                return $lastElement[$token];
+            }
+        }
+    }
+
+    /**
+     * Gets only trusted `Forwarded` header parts
+     *
+     * @return array
+     *
+     * @since 2.0.31
+     */
+    protected function getSecureForwardedHeaderTrustedParts()
+    {
+        $validator = $this->getIpValidator();
+
+        $validator->setRanges($this->trustedHosts);
+        return array_filter($this->getSecureForwardedHeaderParts(), function ($headerPart) use ($validator) {
+            return isset($headerPart['for']) ? !$validator->validate($headerPart['for']) : true;
+        });
+    }
+
+    private $_secureForwardedHeaderParts;
+
+    /**
+     * Returns decoded forwarded header
+     *
+     * @return array
+     *
+     * @since 2.0.31
+     */
+    protected function getSecureForwardedHeaderParts()
+    {
+        if (!in_array('Forwarded', $this->secureHeaders, true)) {
+            return [];
+        }
+        if ($this->_secureForwardedHeaderParts === null) {
+            $this->_secureForwardedHeaderParts = [];
+            /*
+             * First one is always correct, because proxy CAN add headers
+             * after last one found.
+             * Keep in mind that it is NOT enforced, therefore we cannot be
+             * sure, that this is really first one
+             *
+             * FPM keeps last header sent which is a bug, you need to merge
+             * headers together on your web server before letting FPM handle it
+             * @see https://bugs.php.net/bug.php?id=78844
+             */
+            $forwarded = $this->headers->get('Forwarded', '');
+
+            preg_match_all('/(?:[^",]++|"[^"]++")+/', $forwarded, $forwardedElements);
+
+            foreach ($forwardedElements[0] as $forwardedPairs) {
+                preg_match_all('/(?P<key>\w+)\s*=\s*(?|(?P<value>[^",;]*[^",;\s])|"(?P<value>[^"]+)")/', $forwardedPairs, $matches, PREG_SET_ORDER);
+                $this->_secureForwardedHeaderParts[] = array_reduce($matches, function ($carry, $item) {
+                    $carry[strtolower($item['key'])] = $item['value'];
+                    return $carry;
+                }, []);
+            }
+        }
+        return $this->_secureForwardedHeaderParts;
+    }
 }
diff --git a/tests/framework/web/RequestTest.php b/tests/framework/web/RequestTest.php
index b2ab8c6df..31c2be6a6 100644
--- a/tests/framework/web/RequestTest.php
+++ b/tests/framework/web/RequestTest.php
@@ -333,6 +333,42 @@ class RequestTest extends TestCase
                     'example3.com',
                 ]
             ],
+            // RFC 7239 forwarded from untrusted server
+            [
+                [
+                    'HTTP_FORWARDED' => 'host=example3.com',
+                    'HTTP_HOST' => 'example1.com',
+                    'SERVER_NAME' => 'example2.com',
+                ],
+                [
+                    'http://example1.com',
+                    'example1.com',
+                ]
+            ],
+            // RFC 7239 forwarded from trusted proxy
+            [
+                [
+                    'HTTP_FORWARDED' => 'host=example3.com',
+                    'HTTP_HOST' => 'example1.com',
+                    'REMOTE_ADDR' => '192.168.0.1',
+                ],
+                [
+                    'http://example3.com',
+                    'example3.com',
+                ]
+            ],
+            // RFC 7239 forwarded from trusted proxy
+            [
+                [
+                    'HTTP_FORWARDED' => 'host=example3.com,host=example2.com',
+                    'HTTP_HOST' => 'example1.com',
+                    'REMOTE_ADDR' => '192.168.0.1',
+                ],
+                [
+                    'http://example2.com',
+                    'example2.com',
+                ]
+            ],
         ];
     }
 
@@ -458,6 +494,44 @@ class RequestTest extends TestCase
                 'HTTP_FRONT_END_HTTPS' => 'on',
                 'REMOTE_ADDR' => '192.169.0.1',
             ], false],
+            // RFC 7239 forwarded from untrusted proxy
+            [[
+                'HTTP_FORWARDED' => 'proto=https',
+            ], false],
+            // RFC 7239 forwarded from two untrusted proxies
+            [[
+                'HTTP_FORWARDED' => 'proto=https,proto=http',
+            ], false],
+            // RFC 7239 forwarded from trusted proxy
+            [[
+                'HTTP_FORWARDED' => 'proto=https',
+                'REMOTE_ADDR' => '192.168.0.1',
+            ], true],
+            // RFC 7239 forwarded from trusted proxy, second proxy not encrypted
+            [[
+                'HTTP_FORWARDED' => 'proto=https,proto=http',
+                'REMOTE_ADDR' => '192.168.0.1',
+            ], false],
+            // RFC 7239 forwarded from trusted proxy, second proxy encrypted, while client request not encrypted
+            [[
+                'HTTP_FORWARDED' => 'proto=http,proto=https',
+                'REMOTE_ADDR' => '192.168.0.1',
+            ], true],
+            // RFC 7239 forwarded from untrusted proxy
+            [[
+                'HTTP_FORWARDED' => 'proto=https',
+                'REMOTE_ADDR' => '192.169.0.1',
+            ], false],
+            // RFC 7239 forwarded from untrusted proxy, second proxy not encrypted
+            [[
+                'HTTP_FORWARDED' => 'proto=https,proto=http',
+                'REMOTE_ADDR' => '192.169.0.1',
+            ], false],
+            // RFC 7239 forwarded from untrusted proxy, second proxy encrypted, while client request not encrypted
+            [[
+                'HTTP_FORWARDED' => 'proto=http,proto=https',
+                'REMOTE_ADDR' => '192.169.0.1',
+            ], false],
         ];
     }
 
@@ -517,6 +591,102 @@ class RequestTest extends TestCase
                 ],
                 '192.169.1.1',
             ],
+            // RFC 7239 forwarded from trusted proxy
+            [
+                [
+                    'HTTP_FORWARDED' => 'for=123.123.123.123',
+                    'REMOTE_ADDR' => '192.168.0.1',
+                ],
+                '123.123.123.123',
+            ],
+            // RFC 7239 forwarded from trusted proxy with optinal port
+            [
+                [
+                    'HTTP_FORWARDED' => 'for=123.123.123.123:2222',
+                    'REMOTE_ADDR' => '192.168.0.1',
+                ],
+                '123.123.123.123',
+            ],
+            // RFC 7239 forwarded from trusted proxy, through another proxy
+            [
+                [
+                    'HTTP_FORWARDED' => 'for=123.123.123.123,for=122.122.122.122',
+                    'REMOTE_ADDR' => '192.168.0.1',
+                ],
+                '122.122.122.122',
+            ],
+            // RFC 7239 forwarded from trusted proxy, through another proxy, client IP with optional port
+            [
+                [
+                    'HTTP_FORWARDED' => 'for=123.123.123.123:2222,for=122.122.122.122:2222',
+                    'REMOTE_ADDR' => '192.168.0.1',
+                ],
+                '122.122.122.122',
+            ],
+            // RFC 7239 forwarded from untrusted proxy
+            [
+                [
+                    'HTTP_FORWARDED' => 'for=123.123.123.123',
+                    'REMOTE_ADDR' => '192.169.1.1',
+                ],
+                '192.169.1.1',
+            ],
+            // RFC 7239 forwarded from trusted proxy with optional port
+            [
+                [
+                    'HTTP_FORWARDED' => 'for=123.123.123.123:2222',
+                    'REMOTE_ADDR' => '192.169.1.1',
+                ],
+                '192.169.1.1',
+            ],
+            // RFC 7239 forwarded from trusted proxy with client IPv6
+            [
+                [
+                    'HTTP_FORWARDED' => 'for="2001:0db8:85a3:0000:0000:8a2e:0370:7334"',
+                    'REMOTE_ADDR' => '192.168.0.1',
+                ],
+                '2001:0db8:85a3:0000:0000:8a2e:0370:7334',
+            ],
+            // RFC 7239 forwarded from trusted proxy with client IPv6 and optional port
+            [
+                [
+                    'HTTP_FORWARDED' => 'for="[2001:0db8:85a3:0000:0000:8a2e:0370:7334]:2222"',
+                    'REMOTE_ADDR' => '192.168.0.1',
+                ],
+                '2001:0db8:85a3:0000:0000:8a2e:0370:7334',
+            ],
+            // RFC 7239 forwarded from trusted proxy, through another proxy with client IPv6
+            [
+                [
+                    'HTTP_FORWARDED' => 'for=122.122.122.122,for="2001:0db8:85a3:0000:0000:8a2e:0370:7334"',
+                    'REMOTE_ADDR' => '192.168.0.1',
+                ],
+                '2001:0db8:85a3:0000:0000:8a2e:0370:7334',
+            ],
+            // RFC 7239 forwarded from trusted proxy, through another proxy with client IPv6 and optional port
+            [
+                [
+                    'HTTP_FORWARDED' => 'for=122.122.122.122:2222,for="[2001:0db8:85a3:0000:0000:8a2e:0370:7334]:2222"',
+                    'REMOTE_ADDR' => '192.168.0.1',
+                ],
+                '2001:0db8:85a3:0000:0000:8a2e:0370:7334',
+            ],
+            // RFC 7239 forwarded from untrusted proxy with client IPv6
+            [
+                [
+                    'HTTP_FORWARDED' => 'for"=2001:0db8:85a3:0000:0000:8a2e:0370:7334"',
+                    'REMOTE_ADDR' => '192.169.1.1',
+                ],
+                '192.169.1.1',
+            ],
+            // RFC 7239 forwarded from untrusted proxy, through another proxy with client IPv6 and optional port
+            [
+                [
+                    'HTTP_FORWARDED' => 'for="[2001:0db8:85a3:0000:0000:8a2e:0370:7334]:2222"',
+                    'REMOTE_ADDR' => '192.169.1.1',
+                ],
+                '192.169.1.1',
+            ],
         ];
     }
 
@@ -819,4 +989,97 @@ class RequestTest extends TestCase
         $this->assertSame($expectedUserIp, $request->userIP, 'User IP fail!');
         $this->assertSame($expectedIsSecureConnection, $request->isSecureConnection, 'Secure connection fail!');
     }
+
+    public function parseForwardedHeaderDataProvider()
+    {
+        return [
+            [
+                '192.168.10.10',
+                'for=10.0.0.2;host=yiiframework.com;proto=https',
+                'https://yiiframework.com',
+                '10.0.0.2'
+            ],
+            [
+                '192.168.10.10',
+                'for=10.0.0.2;proto=https',
+                'https://example.com',
+                '10.0.0.2'
+            ],
+            [
+                '192.168.10.10',
+                'host=yiiframework.com;proto=https',
+                'https://yiiframework.com',
+                '192.168.10.10'
+            ],
+            [
+                '192.168.10.10',
+                'host=yiiframework.com;for=10.0.0.2',
+                'http://yiiframework.com',
+                '10.0.0.2'
+            ],
+            [
+                '192.168.20.10',
+                'host=yiiframework.com;for=10.0.0.2;proto=https',
+                'https://yiiframework.com',
+                '10.0.0.2'
+            ],
+            [
+                '192.168.10.10',
+                'for=10.0.0.1;host=yiiframework.com;proto=https, for=192.168.20.20;host=awesome.proxy.com;proto=http',
+                'https://yiiframework.com',
+                '10.0.0.1'
+            ],
+            [
+                '192.168.10.10',
+                'for=8.8.8.8;host=spoofed.host;proto=https, for=10.0.0.1;host=yiiframework.com;proto=https, for=192.168.20.20;host=trusted.proxy;proto=http',
+                'https://yiiframework.com',
+                '10.0.0.1'
+            ]
+        ];
+    }
+
+    /**
+     * @dataProvider parseForwardedHeaderDataProvider
+     */
+    public function testParseForwardedHeaderParts($remoteAddress, $forwardedHeader, $expectedHostInfo, $expectedUserIp)
+    {
+        $_SERVER['REMOTE_ADDR'] = $remoteAddress;
+        $_SERVER['HTTP_HOST'] = 'example.com';
+        $_SERVER['HTTP_FORWARDED'] = $forwardedHeader;
+
+        $request = new Request([
+            'trustedHosts' => [
+                '192.168.10.0/24',
+                '192.168.20.0/24'
+            ],
+        ]);
+
+        $this->assertSame($expectedUserIp, $request->userIP, 'User IP fail!');
+        $this->assertSame($expectedHostInfo, $request->hostInfo, 'Host info fail!');
+    }
+
+    public function testForwardedNotTrusted()
+    {
+        $_SERVER['REMOTE_ADDR'] = '192.168.10.10';
+        $_SERVER['HTTP_HOST'] = 'example.com';
+        $_SERVER['HTTP_FORWARDED'] = 'for=8.8.8.8;host=spoofed.host;proto=https';
+        $_SERVER['HTTP_X_FORWARDED_FOR'] = '10.0.0.1';
+        $_SERVER['HTTP_X_FORWARDED_HOST'] = 'yiiframework.com';
+        $_SERVER['HTTP_X_FORWARDED_PROTO'] = 'http';
+
+        $request = new Request([
+            'trustedHosts' => [
+                '192.168.10.0/24',
+                '192.168.20.0/24'
+            ],
+            'secureHeaders' => [
+                'X-Forwarded-For',
+                'X-Forwarded-Host',
+                'X-Forwarded-Proto',
+            ]
+        ]);
+
+        $this->assertSame('10.0.0.1', $request->userIP, 'User IP fail!');
+        $this->assertSame('http://yiiframework.com', $request->hostInfo, 'Host info fail!');
+    }
 }
