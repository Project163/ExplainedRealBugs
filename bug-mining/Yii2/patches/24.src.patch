diff --git a/framework/rbac/DbManager.php b/framework/rbac/DbManager.php
index 2b1c5c859..5d35ed516 100644
--- a/framework/rbac/DbManager.php
+++ b/framework/rbac/DbManager.php
@@ -900,7 +900,7 @@ class DbManager extends BaseManager
     {
         if (!$this->supportsCascadeUpdate()) {
             $this->db->createCommand()
-                ->update($this->itemTable, ['ruleName' => null])
+                ->update($this->itemTable, ['rule_name' => null])
                 ->execute();
         }
 
diff --git a/framework/rbac/PhpManager.php b/framework/rbac/PhpManager.php
index e3242f7ec..2ec3412b0 100644
--- a/framework/rbac/PhpManager.php
+++ b/framework/rbac/PhpManager.php
@@ -540,9 +540,11 @@ class PhpManager extends BaseManager
             return;
         }
 
-        foreach ($this->assignments as $i => $assignment) {
-            if (isset($names[$assignment->roleName])) {
-                unset($this->assignments[$i]);
+        foreach ($this->assignments as $i => $assignments) {
+            foreach ($assignments as $n => $assignment) {
+                if (isset($names[$assignment->roleName])) {
+                    unset($this->assignments[$i][$n]);
+                }
             }
         }
         foreach ($this->children as $name => $children) {
diff --git a/tests/framework/rbac/ManagerTestCase.php b/tests/framework/rbac/ManagerTestCase.php
index 4ccc5ae32..24b9a2305 100644
--- a/tests/framework/rbac/ManagerTestCase.php
+++ b/tests/framework/rbac/ManagerTestCase.php
@@ -4,7 +4,6 @@ namespace yiiunit\framework\rbac;
 
 use yii\rbac\Item;
 use yii\rbac\Permission;
-use yii\rbac\PhpManager;
 use yii\rbac\Role;
 use yiiunit\TestCase;
 
@@ -113,6 +112,16 @@ abstract class ManagerTestCase extends TestCase
 
         $rule = $this->auth->getRule('newName');
         $this->assertEquals(true, $rule->reallyReally);
+
+        $item = $this->auth->getPermission('createPost');
+        $item->name = 'new createPost';
+        $this->auth->update('createPost', $item);
+
+        $item = $this->auth->getPermission('createPost');
+        $this->assertEquals(null, $item);
+
+        $item = $this->auth->getPermission('new createPost');
+        $this->assertEquals('new createPost', $item->name);
     }
 
     public function testGetRules()
@@ -141,6 +150,10 @@ abstract class ManagerTestCase extends TestCase
         $rules = $this->auth->getRules();
 
         $this->assertEmpty($rules);
+
+        $this->auth->remove($this->auth->getPermission('createPost'));
+        $item = $this->auth->getPermission('createPost');
+        $this->assertNull($item);
     }
 
     public function testCheckAccess()
@@ -166,6 +179,8 @@ abstract class ManagerTestCase extends TestCase
                 'readPost' => true,
                 'updatePost' => false,
                 'updateAnyPost' => true,
+                'blablabla' => false,
+                null => false,
             ],
         ];
 
@@ -324,4 +339,40 @@ abstract class ManagerTestCase extends TestCase
         $this->assertFalse($this->auth->canAddChild($reader, $author));
     }
 
+
+    public function testRemoveAllRules()
+    {
+        $this->prepareData();
+
+        $this->auth->removeAllRules();
+
+        $this->assertEmpty($this->auth->getRules());
+
+        $this->assertNotEmpty($this->auth->getRoles());
+        $this->assertNotEmpty($this->auth->getPermissions());
+    }
+
+    public function testRemoveAllRoles()
+    {
+        $this->prepareData();
+
+        $this->auth->removeAllRoles();
+
+        $this->assertEmpty($this->auth->getRoles());
+
+        $this->assertNotEmpty($this->auth->getRules());
+        $this->assertNotEmpty($this->auth->getPermissions());
+    }
+
+    public function testRemoveAllPermissions()
+    {
+        $this->prepareData();
+
+        $this->auth->removeAllPermissions();
+
+        $this->assertEmpty($this->auth->getPermissions());
+
+        $this->assertNotEmpty($this->auth->getRules());
+        $this->assertNotEmpty($this->auth->getRoles());
+    }
 }
