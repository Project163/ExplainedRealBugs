diff --git a/framework/CHANGELOG.md b/framework/CHANGELOG.md
index 68d556325..afebb344c 100644
--- a/framework/CHANGELOG.md
+++ b/framework/CHANGELOG.md
@@ -1,10 +1,10 @@
 Yii Framework 2 Change Log
 ==========================
 
-2.0.40 under development
+2.0.39.2 under development
 ------------------------
 
-- no changes in this release.
+- Bug #18378: Fix not taking default value when unable to resolve abstract class via DI container (vjik)
 
 
 2.0.39.1 November 10, 2020
diff --git a/framework/di/Container.php b/framework/di/Container.php
index d6b396b6e..1c8c9aad6 100644
--- a/framework/di/Container.php
+++ b/framework/di/Container.php
@@ -528,10 +528,8 @@ class Container extends Component
                 }
                 $className = $isClass ? $c->getName() : null;
 
-                if ($className !== null &&
-                    ($this->has($className) || class_exists($className))
-                ) {
-                    $dependencies[$param->getName()] = Instance::of($className);
+                if ($className !== null) {
+                    $dependencies[$param->getName()] = Instance::of($className, true);
                 } else {
                     $dependencies[$param->getName()] = $param->isDefaultValueAvailable()
                         ? $param->getDefaultValue()
@@ -558,7 +556,7 @@ class Container extends Component
         foreach ($dependencies as $index => $dependency) {
             if ($dependency instanceof Instance) {
                 if ($dependency->id !== null) {
-                    $dependencies[$index] = $this->get($dependency->id);
+                    $dependencies[$index] = $dependency->get($this);
                 } elseif ($reflection !== null) {
                     $name = $reflection->getConstructor()->getParameters()[$index]->getName();
                     $class = $reflection->getName();
diff --git a/framework/di/Instance.php b/framework/di/Instance.php
index af0044ce4..503fbb9fc 100644
--- a/framework/di/Instance.php
+++ b/framework/di/Instance.php
@@ -7,6 +7,7 @@
 
 namespace yii\di;
 
+use Exception;
 use Yii;
 use yii\base\InvalidConfigException;
 
@@ -60,24 +61,31 @@ class Instance
      */
     public $id;
 
+    /**
+     * @var bool if null should be returned instead of throwing an exception
+     */
+    public $optional;
 
     /**
      * Constructor.
      * @param string $id the component ID
+     * @param bool $optional if null should be returned instead of throwing an exception
      */
-    protected function __construct($id)
+    protected function __construct($id, $optional = false)
     {
         $this->id = $id;
+        $this->optional = $optional;
     }
 
     /**
      * Creates a new Instance object.
      * @param string $id the component ID
+     * @param bool $optional if null should be returned instead of throwing an exception
      * @return Instance the new Instance object.
      */
-    public static function of($id)
+    public static function of($id, $optional = false)
     {
-        return new static($id);
+        return new static($id, $optional);
     }
 
     /**
@@ -157,14 +165,21 @@ class Instance
      */
     public function get($container = null)
     {
-        if ($container) {
-            return $container->get($this->id);
-        }
-        if (Yii::$app && Yii::$app->has($this->id)) {
-            return Yii::$app->get($this->id);
-        }
+        try {
+            if ($container) {
+                return $container->get($this->id);
+            }
+            if (Yii::$app && Yii::$app->has($this->id)) {
+                return Yii::$app->get($this->id);
+            }
 
-        return Yii::$container->get($this->id);
+            return Yii::$container->get($this->id);
+        } catch (Exception $e) {
+            if ($this->optional) {
+                return null;
+            }
+            throw $e;
+        }
     }
 
     /**
diff --git a/tests/framework/di/ContainerTest.php b/tests/framework/di/ContainerTest.php
index f3f832e78..1ba991e84 100644
--- a/tests/framework/di/ContainerTest.php
+++ b/tests/framework/di/ContainerTest.php
@@ -547,6 +547,12 @@ class ContainerTest extends TestCase
         $this->assertInstanceOf(Beta::className(), $alpha->beta);
         $this->assertInstanceOf($QuxInterface, $alpha->omega);
         $this->assertNull($alpha->unknown);
+        $this->assertNull($alpha->color);
+
+        $container = new Container();
+        $container->set(__NAMESPACE__ . '\stubs\AbstractColor', __NAMESPACE__ . '\stubs\Color');
+        $alpha = $container->get(Alpha::className());
+        $this->assertInstanceOf(__NAMESPACE__ . '\stubs\Color', $alpha->color);
     }
 
     /**
diff --git a/tests/framework/di/InstanceTest.php b/tests/framework/di/InstanceTest.php
index 040c759d5..a5b23c5fd 100644
--- a/tests/framework/di/InstanceTest.php
+++ b/tests/framework/di/InstanceTest.php
@@ -171,7 +171,7 @@ class InstanceTest extends TestCase
         $instance = Instance::of('something');
         $export = var_export($instance, true);
 
-        $this->assertRegExp('~yii\\\\di\\\\Instance::__set_state\(array\(\s+\'id\' => \'something\',\s+\)\)~', $export);
+        $this->assertRegExp('~yii\\\\di\\\\Instance::__set_state\(array\(\s+\'id\' => \'something\',\s+\'optional\' => false,\s+\)\)~', $export);
 
         $this->assertEquals($instance, Instance::__set_state([
             'id' => 'something',
diff --git a/tests/framework/di/stubs/AbstractColor.php b/tests/framework/di/stubs/AbstractColor.php
new file mode 100644
index 000000000..f3d03a44e
--- /dev/null
+++ b/tests/framework/di/stubs/AbstractColor.php
@@ -0,0 +1,9 @@
+<?php
+
+namespace yiiunit\framework\di\stubs;
+
+use yii\base\BaseObject;
+
+abstract class AbstractColor extends BaseObject
+{
+}
diff --git a/tests/framework/di/stubs/Alpha.php b/tests/framework/di/stubs/Alpha.php
index 83023f5eb..151d2f109 100644
--- a/tests/framework/di/stubs/Alpha.php
+++ b/tests/framework/di/stubs/Alpha.php
@@ -9,11 +9,17 @@ class Alpha extends BaseObject
     public $beta;
     public $omega;
     public $unknown = true;
+    public $color = true;
 
-    public function __construct(Beta $beta = null, QuxInterface $omega = null, Unknown $unknown = null)
-    {
+    public function __construct(
+        Beta $beta = null,
+        QuxInterface $omega = null,
+        Unknown $unknown = null,
+        AbstractColor $color = null
+    ) {
         $this->beta = $beta;
         $this->omega = $omega;
         $this->unknown = $unknown;
+        $this->color = $color;
     }
 }
diff --git a/tests/framework/di/stubs/Color.php b/tests/framework/di/stubs/Color.php
new file mode 100644
index 000000000..b9bd0f991
--- /dev/null
+++ b/tests/framework/di/stubs/Color.php
@@ -0,0 +1,7 @@
+<?php
+
+namespace yiiunit\framework\di\stubs;
+
+final class Color extends AbstractColor
+{
+}
