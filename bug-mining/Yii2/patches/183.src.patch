diff --git a/framework/db/ActiveQuery.php b/framework/db/ActiveQuery.php
index 9ad09c183..c25ea8d1d 100644
--- a/framework/db/ActiveQuery.php
+++ b/framework/db/ActiveQuery.php
@@ -155,7 +155,7 @@ class ActiveQuery extends Query implements ActiveQueryInterface
         }
 
         if (empty($this->select) && !empty($this->join)) {
-            list(, $alias) = $this->getQueryTableName($this);
+            list(, $alias) = $this->getTableNameAndAlias();
             $this->select = ["$alias.*"];
         }
 
@@ -551,18 +551,18 @@ class ActiveQuery extends Query implements ActiveQueryInterface
 
     /**
      * Returns the table name and the table alias for [[modelClass]].
-     * @param ActiveQuery $query
      * @return array the table name and the table alias.
+     * @internal
      */
-    private function getQueryTableName($query)
+    private function getTableNameAndAlias()
     {
-        if (empty($query->from)) {
+        if (empty($this->from)) {
             /* @var $modelClass ActiveRecord */
-            $modelClass = $query->modelClass;
+            $modelClass = $this->modelClass;
             $tableName = $modelClass::tableName();
         } else {
             $tableName = '';
-            foreach ($query->from as $alias => $tableName) {
+            foreach ($this->from as $alias => $tableName) {
                 if (is_string($alias)) {
                     return [$tableName, $alias];
                 } else {
@@ -603,8 +603,8 @@ class ActiveQuery extends Query implements ActiveQueryInterface
             return;
         }
 
-        list ($parentTable, $parentAlias) = $this->getQueryTableName($parent);
-        list ($childTable, $childAlias) = $this->getQueryTableName($child);
+        list ($parentTable, $parentAlias) = $parent->getTableNameAndAlias();
+        list ($childTable, $childAlias) = $child->getTableNameAndAlias();
 
         if (!empty($child->link)) {
 
@@ -778,7 +778,7 @@ class ActiveQuery extends Query implements ActiveQueryInterface
     public function alias($alias)
     {
         if (empty($this->from) || count($this->from) < 2) {
-            list($tableName, ) = $this->getQueryTableName($this);
+            list($tableName, ) = $this->getTableNameAndAlias();
             $this->from = [$alias => $tableName];
         } else {
             /* @var $modelClass ActiveRecord */
diff --git a/tests/framework/db/ActiveQueryTest.php b/tests/framework/db/ActiveQueryTest.php
index 7e0f6f717..6825aa776 100644
--- a/tests/framework/db/ActiveQueryTest.php
+++ b/tests/framework/db/ActiveQueryTest.php
@@ -118,7 +118,7 @@ abstract class ActiveQueryTest extends DatabaseTestCase
     }
 
     /**
-     * @todo: tests for internal logic of joinWith()
+     * @todo: tests for internal logic of innerJoinWith()
      */
     public function testInnerJoinWith()
     {
@@ -129,6 +129,24 @@ abstract class ActiveQueryTest extends DatabaseTestCase
         ], $result->joinWith);
     }
 
+    /**
+     * @todo: tests for the regex inside getQueryTableName
+     */
+    public function testGetQueryTableName_from_not_set()
+    {
+        $query = new ActiveQuery(Customer::className());
+        $result = $this->invokeMethod($query,'getTableNameAndAlias');
+        $this->assertEquals(['customer','customer'], $result);
+    }
+
+    public function testGetQueryTableName_from_set()
+    {
+        $options = ['from' => ['alias'=>'customer']];
+        $query = new ActiveQuery(Customer::className(),$options);
+        $result = $this->invokeMethod($query,'getTableNameAndAlias');
+        $this->assertEquals(['customer','alias'], $result);
+    }
+
     public function testOnCondition()
     {
         $query = new ActiveQuery(Customer::className());
@@ -139,7 +157,7 @@ abstract class ActiveQueryTest extends DatabaseTestCase
         $this->assertEquals($params, $result->params);
     }
 
-    public function testAndOnCondition_OnIsNull()
+    public function testAndOnCondition_on_not_set()
     {
         $query = new ActiveQuery(Customer::className());
         $on = ['active' => true];
@@ -149,7 +167,7 @@ abstract class ActiveQueryTest extends DatabaseTestCase
         $this->assertEquals($params, $result->params);
     }
 
-    public function testAndOnCondition_OnIsNotNull()
+    public function testAndOnCondition_on_set()
     {
         $onOld = ['active' => true];
         $query = new ActiveQuery(Customer::className());
@@ -162,7 +180,7 @@ abstract class ActiveQueryTest extends DatabaseTestCase
         $this->assertEquals($params, $result->params);
     }
 
-    public function testOrOnCondition_OnIsNull()
+    public function testOrOnCondition_on_not_set()
     {
         $query = new ActiveQuery(Customer::className());
         $on = ['active' => true];
@@ -172,7 +190,7 @@ abstract class ActiveQueryTest extends DatabaseTestCase
         $this->assertEquals($params, $result->params);
     }
 
-    public function testOrOnCondition_OnIsNotNull()
+    public function testOrOnCondition_on_set()
     {
         $onOld = ['active' => true];
         $query = new ActiveQuery(Customer::className());
