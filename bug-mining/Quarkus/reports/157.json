{"url":"https://api.github.com/repos/quarkusio/quarkus/issues/45308","repository_url":"https://api.github.com/repos/quarkusio/quarkus","labels_url":"https://api.github.com/repos/quarkusio/quarkus/issues/45308/labels{/name}","comments_url":"https://api.github.com/repos/quarkusio/quarkus/issues/45308/comments","events_url":"https://api.github.com/repos/quarkusio/quarkus/issues/45308/events","html_url":"https://github.com/quarkusio/quarkus/issues/45308","id":2762183330,"node_id":"I_kwDOCFbutM6ko5Ki","number":45308,"title":"IfBuildProfile does not work on scheduler classes","user":{"login":"gbourant","id":9791051,"node_id":"MDQ6VXNlcjk3OTEwNTE=","avatar_url":"https://avatars.githubusercontent.com/u/9791051?v=4","gravatar_id":"","url":"https://api.github.com/users/gbourant","html_url":"https://github.com/gbourant","followers_url":"https://api.github.com/users/gbourant/followers","following_url":"https://api.github.com/users/gbourant/following{/other_user}","gists_url":"https://api.github.com/users/gbourant/gists{/gist_id}","starred_url":"https://api.github.com/users/gbourant/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gbourant/subscriptions","organizations_url":"https://api.github.com/users/gbourant/orgs","repos_url":"https://api.github.com/users/gbourant/repos","events_url":"https://api.github.com/users/gbourant/events{/privacy}","received_events_url":"https://api.github.com/users/gbourant/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":985346620,"node_id":"MDU6TGFiZWw5ODUzNDY2MjA=","url":"https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug","name":"kind/bug","color":"d73a4a","default":false,"description":"Something isn't working"},{"id":1282102389,"node_id":"MDU6TGFiZWwxMjgyMTAyMzg5","url":"https://api.github.com/repos/quarkusio/quarkus/labels/area/arc","name":"area/arc","color":"0366d6","default":false,"description":"Issue related to ARC (dependency injection)"},{"id":1375177076,"node_id":"MDU6TGFiZWwxMzc1MTc3MDc2","url":"https://api.github.com/repos/quarkusio/quarkus/labels/area/testing","name":"area/testing","color":"0366d6","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/quarkusio/quarkus/milestones/361","html_url":"https://github.com/quarkusio/quarkus/milestone/361","labels_url":"https://api.github.com/repos/quarkusio/quarkus/milestones/361/labels","id":11887234,"node_id":"MI_kwDOCFbutM4AtWKC","number":361,"title":"3.18.0.CR1","description":"","creator":{"login":"quarkusbot","id":61254497,"node_id":"MDQ6VXNlcjYxMjU0NDk3","avatar_url":"https://avatars.githubusercontent.com/u/61254497?v=4","gravatar_id":"","url":"https://api.github.com/users/quarkusbot","html_url":"https://github.com/quarkusbot","followers_url":"https://api.github.com/users/quarkusbot/followers","following_url":"https://api.github.com/users/quarkusbot/following{/other_user}","gists_url":"https://api.github.com/users/quarkusbot/gists{/gist_id}","starred_url":"https://api.github.com/users/quarkusbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/quarkusbot/subscriptions","organizations_url":"https://api.github.com/users/quarkusbot/orgs","repos_url":"https://api.github.com/users/quarkusbot/repos","events_url":"https://api.github.com/users/quarkusbot/events{/privacy}","received_events_url":"https://api.github.com/users/quarkusbot/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":1,"closed_issues":462,"state":"closed","created_at":"2024-11-13T09:13:02Z","updated_at":"2025-06-18T13:20:45Z","due_on":null,"closed_at":"2025-01-15T13:20:03Z"},"comments":4,"created_at":"2024-12-29T09:59:14Z","updated_at":"2025-01-03T14:01:00Z","closed_at":"2025-01-03T14:00:56Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I have the following class\n\n```java\n@IfBuildProfile(anyOf = {\"dev\", \"prod\", \"RateLimitSchedulerProfile\"})\npublic class RateLimitScheduler {\n\n    @Scheduled(every = \"1s\")\n    public void schedule() {\n        System.out.println(\"hello \" + System.currentTimeMillis());\n    }\n}\n```\n\nAnd the following test\n\n```java\npublic class RateLimitSchedulerProfile implements QuarkusTestProfile {\n    @Override\n    public String getConfigProfile() {\n        return \"test,RateLimitSchedulerProfile\";\n    }\n}\n\n@QuarkusTest\n@TestProfile(RateLimitSchedulerProfile.class)\nclass RateLimitSchedulerTest {\n\n    @Inject\n    RateLimitScheduler rateLimitScheduler;\n\n    @Test\n    void test() {\n        System.out.println(\"RateLimitSchedulerTest:\");\n        rateLimitScheduler.schedule();\n    }\n\n}\n```\n\nThis test fails with \n\n```text\n[ERROR] Errors: \n[ERROR]   HelloResourceTest.testHelloEndpoint Â» Runtime java.lang.RuntimeException: io.quarkus.builder.BuildException: Build failure: Build failed due to errors\n\t[error]: Build step io.quarkus.arc.deployment.ArcProcessor#validate threw an exception: jakarta.enterprise.inject.spi.DeploymentException: jakarta.enterprise.inject.UnsatisfiedResolutionException: Unsatisfied dependency for type gr.RateLimitScheduler and qualifiers [@Default]\n\t- injection target: gr.RateLimitSchedulerTest#rateLimitScheduler\n\t- declared on CLASS bean [types=[gr.RateLimitSchedulerTest, java.lang.Object], qualifiers=[@Default, @Any], target=gr.RateLimitSchedulerTest]\n\tThe following classes match by type, but have been skipped during discovery:\n\t- gr.RateLimitScheduler was annotated with @Vetoed\n\n\n\tat io.quarkus.arc.processor.BeanDeployment.processErrors(BeanDeployment.java:1576)\n\tat io.quarkus.arc.processor.BeanDeployment.init(BeanDeployment.java:338)\n\tat io.quarkus.arc.processor.BeanProcessor.initialize(BeanProcessor.java:178)\n\tat io.quarkus.arc.deployment.ArcProcessor.validate(ArcProcessor.java:492)\n\tat java.base/java.lang.invoke.MethodHandle.invokeWithArguments(MethodHandle.java:733)\n\tat io.quarkus.deployment.ExtensionLoader$3.execute(ExtensionLoader.java:856)\n\tat io.quarkus.builder.BuildContext.run(BuildContext.java:256)\n\tat org.jboss.threads.ContextHandler$1.runWith(ContextHandler.java:18)\n\tat org.jboss.threads.EnhancedQueueExecutor$Task.doRunWith(EnhancedQueueExecutor.java:2675)\n\tat org.jboss.threads.EnhancedQueueExecutor$Task.run(EnhancedQueueExecutor.java:2654)\n\tat org.jboss.threads.EnhancedQueueExecutor.runThreadBody(EnhancedQueueExecutor.java:1627)\n\tat org.jboss.threads.EnhancedQueueExecutor$ThreadBody.run(EnhancedQueueExecutor.java:1594)\n\tat java.base/java.lang.Thread.run(Thread.java:1583)\n\tat org.jboss.threads.JBossThread.run(JBossThread.java:499)\nCaused by: jakarta.enterprise.inject.UnsatisfiedResolutionException: Unsatisfied dependency for type gr.RateLimitScheduler and qualifiers [@Default]\n\t- injection target: gr.RateLimitSchedulerTest#rateLimitScheduler\n\t- declared on CLASS bean [types=[gr.RateLimitSchedulerTest, java.lang.Object], qualifiers=[@Default, @Any], target=gr.RateLimitSchedulerTest]\n\tThe following classes match by type, but have been skipped during discovery:\n\t- gr.RateLimitScheduler was annotated with @Vetoed\n\n\n\tat io.quarkus.arc.processor.Beans.resolveInjectionPoint(Beans.java:547)\n\tat io.quarkus.arc.processor.BeanInfo.init(BeanInfo.java:697)\n\tat io.quarkus.arc.processor.BeanDeployment.init(BeanDeployment.java:323)\n\t... 12 more\n```\n\nIn order to \"fix\" it i would have to use the `%test.quarkus.scheduler.enabled=false` and delete the `@IfBuildProfile` from RateLimitSchedulerProfile class.\n\nNote: The test which fails is not the RateLimitSchedulerTest but the HelloResourceTest. If i disable the HelloResourceTest it works.\n\n[Reproducer](https://github.com/gbourant/quarkus-scheduler-bug)","closed_by":{"login":"mkouba","id":913004,"node_id":"MDQ6VXNlcjkxMzAwNA==","avatar_url":"https://avatars.githubusercontent.com/u/913004?v=4","gravatar_id":"","url":"https://api.github.com/users/mkouba","html_url":"https://github.com/mkouba","followers_url":"https://api.github.com/users/mkouba/followers","following_url":"https://api.github.com/users/mkouba/following{/other_user}","gists_url":"https://api.github.com/users/mkouba/gists{/gist_id}","starred_url":"https://api.github.com/users/mkouba/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mkouba/subscriptions","organizations_url":"https://api.github.com/users/mkouba/orgs","repos_url":"https://api.github.com/users/mkouba/repos","events_url":"https://api.github.com/users/mkouba/events{/privacy}","received_events_url":"https://api.github.com/users/mkouba/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/quarkusio/quarkus/issues/45308/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/quarkusio/quarkus/issues/45308/timeline","performed_via_github_app":null,"state_reason":"completed"}