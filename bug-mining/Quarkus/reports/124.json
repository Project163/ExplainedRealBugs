{"url":"https://api.github.com/repos/quarkusio/quarkus/issues/43990","repository_url":"https://api.github.com/repos/quarkusio/quarkus","labels_url":"https://api.github.com/repos/quarkusio/quarkus/issues/43990/labels{/name}","comments_url":"https://api.github.com/repos/quarkusio/quarkus/issues/43990/comments","events_url":"https://api.github.com/repos/quarkusio/quarkus/issues/43990/events","html_url":"https://github.com/quarkusio/quarkus/issues/43990","id":2602386199,"node_id":"I_kwDOCFbutM6bHUMX","number":43990,"title":"Healthcheck results in NPE when no JDBC datasources are defined after breaking changes in 3.17","user":{"login":"michalvavrik","id":43821672,"node_id":"MDQ6VXNlcjQzODIxNjcy","avatar_url":"https://avatars.githubusercontent.com/u/43821672?v=4","gravatar_id":"","url":"https://api.github.com/users/michalvavrik","html_url":"https://github.com/michalvavrik","followers_url":"https://api.github.com/users/michalvavrik/followers","following_url":"https://api.github.com/users/michalvavrik/following{/other_user}","gists_url":"https://api.github.com/users/michalvavrik/gists{/gist_id}","starred_url":"https://api.github.com/users/michalvavrik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/michalvavrik/subscriptions","organizations_url":"https://api.github.com/users/michalvavrik/orgs","repos_url":"https://api.github.com/users/michalvavrik/repos","events_url":"https://api.github.com/users/michalvavrik/events{/privacy}","received_events_url":"https://api.github.com/users/michalvavrik/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":985346620,"node_id":"MDU6TGFiZWw5ODUzNDY2MjA=","url":"https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug","name":"kind/bug","color":"d73a4a","default":false,"description":"Something isn't working"},{"id":1282102389,"node_id":"MDU6TGFiZWwxMjgyMTAyMzg5","url":"https://api.github.com/repos/quarkusio/quarkus/labels/area/arc","name":"area/arc","color":"0366d6","default":false,"description":"Issue related to ARC (dependency injection)"},{"id":1283619446,"node_id":"MDU6TGFiZWwxMjgzNjE5NDQ2","url":"https://api.github.com/repos/quarkusio/quarkus/labels/area/smallrye","name":"area/smallrye","color":"0366d6","default":false,"description":""},{"id":2236032169,"node_id":"MDU6TGFiZWwyMjM2MDMyMTY5","url":"https://api.github.com/repos/quarkusio/quarkus/labels/area/health","name":"area/health","color":"0366d6","default":false,"description":""},{"id":7319823129,"node_id":"LA_kwDOCFbutM8AAAABtEujGQ","url":"https://api.github.com/repos/quarkusio/quarkus/labels/area/jdbc","name":"area/jdbc","color":"0366d6","default":false,"description":"Issues related to the JDBC extensions"}],"state":"closed","locked":false,"assignee":{"login":"gsmet","id":1279749,"node_id":"MDQ6VXNlcjEyNzk3NDk=","avatar_url":"https://avatars.githubusercontent.com/u/1279749?v=4","gravatar_id":"","url":"https://api.github.com/users/gsmet","html_url":"https://github.com/gsmet","followers_url":"https://api.github.com/users/gsmet/followers","following_url":"https://api.github.com/users/gsmet/following{/other_user}","gists_url":"https://api.github.com/users/gsmet/gists{/gist_id}","starred_url":"https://api.github.com/users/gsmet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gsmet/subscriptions","organizations_url":"https://api.github.com/users/gsmet/orgs","repos_url":"https://api.github.com/users/gsmet/repos","events_url":"https://api.github.com/users/gsmet/events{/privacy}","received_events_url":"https://api.github.com/users/gsmet/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"gsmet","id":1279749,"node_id":"MDQ6VXNlcjEyNzk3NDk=","avatar_url":"https://avatars.githubusercontent.com/u/1279749?v=4","gravatar_id":"","url":"https://api.github.com/users/gsmet","html_url":"https://github.com/gsmet","followers_url":"https://api.github.com/users/gsmet/followers","following_url":"https://api.github.com/users/gsmet/following{/other_user}","gists_url":"https://api.github.com/users/gsmet/gists{/gist_id}","starred_url":"https://api.github.com/users/gsmet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gsmet/subscriptions","organizations_url":"https://api.github.com/users/gsmet/orgs","repos_url":"https://api.github.com/users/gsmet/repos","events_url":"https://api.github.com/users/gsmet/events{/privacy}","received_events_url":"https://api.github.com/users/gsmet/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/quarkusio/quarkus/milestones/355","html_url":"https://github.com/quarkusio/quarkus/milestone/355","labels_url":"https://api.github.com/repos/quarkusio/quarkus/milestones/355/labels","id":11737849,"node_id":"MI_kwDOCFbutM4Asxr5","number":355,"title":"3.17.0.CR1","description":"","creator":{"login":"quarkusbot","id":61254497,"node_id":"MDQ6VXNlcjYxMjU0NDk3","avatar_url":"https://avatars.githubusercontent.com/u/61254497?v=4","gravatar_id":"","url":"https://api.github.com/users/quarkusbot","html_url":"https://github.com/quarkusbot","followers_url":"https://api.github.com/users/quarkusbot/followers","following_url":"https://api.github.com/users/quarkusbot/following{/other_user}","gists_url":"https://api.github.com/users/quarkusbot/gists{/gist_id}","starred_url":"https://api.github.com/users/quarkusbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/quarkusbot/subscriptions","organizations_url":"https://api.github.com/users/quarkusbot/orgs","repos_url":"https://api.github.com/users/quarkusbot/repos","events_url":"https://api.github.com/users/quarkusbot/events{/privacy}","received_events_url":"https://api.github.com/users/quarkusbot/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":203,"state":"closed","created_at":"2024-10-16T08:44:30Z","updated_at":"2025-06-17T08:11:10Z","due_on":null,"closed_at":"2024-11-13T12:54:57Z"},"comments":1,"created_at":"2024-10-21T12:22:42Z","updated_at":"2024-10-21T15:25:37Z","closed_at":"2024-10-21T15:25:32Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\n\nHere https://github.com/quarkusio/quarkus/wiki/Migration-Guide-3.17#datasources-without-a-url-no-longer-contribute-a-health-check is described that datasources no longer contribute to a health check when they are deactivated. However I am getting NPE for a code that previously worked and I am not sure what to do.\n\n### Expected behavior\n\nDocument what to do or fix the NPE.\n\n### Actual behavior\n\nException is raised:\n\n```\n14:09:17,604 INFO  [app] 14:09:15,903 SRHCK01000: Error processing Health Checks: java.lang.NullPointerException: Cannot read field \"entries\" because \"agroalSupport\" is null\n14:09:17,605 INFO  [app] \tat io.quarkus.agroal.runtime.health.DataSourceHealthCheck.init(DataSourceHealthCheck.java:47)\n14:09:17,605 INFO  [app] \tat io.quarkus.agroal.runtime.health.DataSourceHealthCheck_Bean.doCreate(Unknown Source)\n14:09:17,605 INFO  [app] \tat io.quarkus.agroal.runtime.health.DataSourceHealthCheck_Bean.create(Unknown Source)\n14:09:17,606 INFO  [app] \tat io.quarkus.agroal.runtime.health.DataSourceHealthCheck_Bean.create(Unknown Source)\n14:09:17,606 INFO  [app] \tat io.quarkus.arc.impl.AbstractSharedContext.createInstanceHandle(AbstractSharedContext.java:119)\n14:09:17,606 INFO  [app] \tat io.quarkus.arc.impl.AbstractSharedContext$1.get(AbstractSharedContext.java:38)\n14:09:17,607 INFO  [app] \tat io.quarkus.arc.impl.AbstractSharedContext$1.get(AbstractSharedContext.java:35)\n14:09:17,607 INFO  [app] \tat io.quarkus.arc.generator.Default_jakarta_enterprise_context_ApplicationScoped_ContextInstances.c11(Unknown Source)\n14:09:17,607 INFO  [app] \tat io.quarkus.arc.generator.Default_jakarta_enterprise_context_ApplicationScoped_ContextInstances.computeIfAbsent(Unknown Source)\n14:09:17,608 INFO  [app] \tat io.quarkus.arc.impl.AbstractSharedContext.get(AbstractSharedContext.java:35)\n14:09:17,608 INFO  [app] \tat io.quarkus.arc.impl.ClientProxies.getApplicationScopedDelegate(ClientProxies.java:21)\n14:09:17,608 INFO  [app] \tat io.quarkus.agroal.runtime.health.DataSourceHealthCheck_ClientProxy.arc$delegate(Unknown Source)\n14:09:17,608 INFO  [app] \tat io.quarkus.agroal.runtime.health.DataSourceHealthCheck_ClientProxy.call(Unknown Source)\n14:09:17,609 INFO  [app] \tat io.smallrye.context.impl.wrappers.SlowContextualSupplier.get(SlowContextualSupplier.java:21)\n14:09:17,609 INFO  [app] \tat io.smallrye.mutiny.operators.uni.builders.UniCreateFromItemSupplier.subscribe(UniCreateFromItemSupplier.java:28)\n14:09:17,609 INFO  [app] \tat io.smallrye.mutiny.operators.AbstractUni.subscribe(AbstractUni.java:36)\n14:09:17,609 INFO  [app] \tat io.smallrye.mutiny.operators.uni.UniOnFailureFlatMap.subscribe(UniOnFailureFlatMap.java:31)\n14:09:17,610 INFO  [app] \tat io.smallrye.mutiny.operators.AbstractUni.subscribe(AbstractUni.java:36)\n14:09:17,610 INFO  [app] \tat io.smallrye.mutiny.operators.uni.UniOnItemTransform.subscribe(UniOnItemTransform.java:22)\n14:09:17,610 INFO  [app] \tat io.smallrye.mutiny.operators.AbstractUni.subscribe(AbstractUni.java:36)\n14:09:17,610 INFO  [app] \tat io.smallrye.mutiny.operators.uni.UniRunSubscribeOn.lambda$subscribe$0(UniRunSubscribeOn.java:27)\n14:09:17,611 INFO  [app] \tat io.quarkus.smallrye.health.runtime.QuarkusAsyncHealthCheckFactory$1$1.call(QuarkusAsyncHealthCheckFactory.java:42)\n14:09:17,611 INFO  [app] \tat io.quarkus.smallrye.health.runtime.QuarkusAsyncHealthCheckFactory$1$1.call(QuarkusAsyncHealthCheckFactory.java:39)\n14:09:17,611 INFO  [app] \tat io.vertx.core.impl.ContextImpl.lambda$executeBlocking$0(ContextImpl.java:178)\n14:09:17,611 INFO  [app] \tat io.vertx.core.impl.ContextInternal.dispatch(ContextInternal.java:270)\n14:09:17,611 INFO  [app] \tat io.vertx.core.impl.ContextImpl.lambda$internalExecuteBlocking$2(ContextImpl.java:210)\n14:09:17,612 INFO  [app] \tat io.quarkus.vertx.core.runtime.VertxCoreRecorder$14.runWith(VertxCoreRecorder.java:627)\n14:09:17,612 INFO  [app] \tat org.jboss.threads.EnhancedQueueExecutor$Task.doRunWith(EnhancedQueueExecutor.java:2675)\n14:09:17,612 INFO  [app] \tat org.jboss.threads.EnhancedQueueExecutor$Task.run(EnhancedQueueExecutor.java:2654)\n14:09:17,612 INFO  [app] \tat org.jboss.threads.EnhancedQueueExecutor$ThreadBody.run(EnhancedQueueExecutor.java:1591)\n14:09:17,613 INFO  [app] \tat org.jboss.threads.DelegatingRunnable.run(DelegatingRunnable.java:11)\n14:09:17,613 INFO  [app] \tat org.jboss.threads.ThreadLocalResettingRunnable.run(ThreadLocalResettingRunnable.java:11)\n14:09:17,613 INFO  [app] \tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n14:09:17,613 INFO  [app] \tat java.base/java.lang.Thread.run(Thread.java:1583)\n14:09:17,613 INFO  [app] 14:09:15,912 SRHCK01001: Reporting health down status: {\"status\":\"DOWN\",\"checks\":[{\"name\":\"liveness\",\"status\":\"UP\"},{\"name\":\"readiness\",\"status\":\"UP\"},{\"name\":\"io.quarkus.agroal.runtime.health.DataSourceHealthCheck_ClientProxy\",\"status\":\"DOWN\",\"data\":{\"exceptionClass\":\"java.lang.NullPointerException\",\"exceptionMessage\":\"Cannot read field \\\"entries\\\" because \\\"agroalSupport\\\" is null\",\"rootCause\":\"Cannot read field \\\"entries\\\" because \\\"agroalSupport\\\" is null\"}},{\"name\":\"greeting\",\"status\":\"UP\"}]}\n14:09:17,614 INFO  [app] 14:09:16,596 SRHCK01000: Error processing Health Checks: java.lang.NullPointerException: Cannot read field \"entries\" because \"agroalSupport\" is null\n14:09:17,614 INFO  [app] \tat io.quarkus.agroal.runtime.health.DataSourceHealthCheck.init(DataSourceHealthCheck.java:47)\n14:09:17,614 INFO  [app] \tat io.quarkus.agroal.runtime.health.DataSourceHealthCheck_Bean.doCreate(Unknown Source)\n14:09:17,614 INFO  [app] \tat io.quarkus.agroal.runtime.health.DataSourceHealthCheck_Bean.create(Unknown Source)\n14:09:17,614 INFO  [app] \tat io.quarkus.agroal.runtime.health.DataSourceHealthCheck_Bean.create(Unknown Source)\n14:09:17,615 INFO  [app] \tat io.quarkus.arc.impl.AbstractSharedContext.createInstanceHandle(AbstractSharedContext.java:119)\n14:09:17,615 INFO  [app] \tat io.quarkus.arc.impl.AbstractSharedContext$1.get(AbstractSharedContext.java:38)\n14:09:17,615 INFO  [app] \tat io.quarkus.arc.impl.AbstractSharedContext$1.get(AbstractSharedContext.java:35)\n14:09:17,615 INFO  [app] \tat io.quarkus.arc.generator.Default_jakarta_enterprise_context_ApplicationScoped_ContextInstances.c11(Unknown Source)\n14:09:17,615 INFO  [app] \tat io.quarkus.arc.generator.Default_jakarta_enterprise_context_ApplicationScoped_ContextInstances.computeIfAbsent(Unknown Source)\n14:09:17,616 INFO  [app] \tat io.quarkus.arc.impl.AbstractSharedContext.get(AbstractSharedContext.java:35)\n14:09:17,616 INFO  [app] \tat io.quarkus.arc.impl.ClientProxies.getApplicationScopedDelegate(ClientProxies.java:21)\n14:09:17,616 INFO  [app] \tat io.quarkus.agroal.runtime.health.DataSourceHealthCheck_ClientProxy.arc$delegate(Unknown Source)\n14:09:17,616 INFO  [app] \tat io.quarkus.agroal.runtime.health.DataSourceHealthCheck_ClientProxy.call(Unknown Source)\n14:09:17,617 INFO  [app] \tat io.smallrye.context.impl.wrappers.SlowContextualSupplier.get(SlowContextualSupplier.java:21)\n14:09:17,617 INFO  [app] \tat io.smallrye.mutiny.operators.uni.builders.UniCreateFromItemSupplier.subscribe(UniCreateFromItemSupplier.java:28)\n14:09:17,617 INFO  [app] \tat io.smallrye.mutiny.operators.AbstractUni.subscribe(AbstractUni.java:36)\n14:09:17,617 INFO  [app] \tat io.smallrye.mutiny.operators.uni.UniOnFailureFlatMap.subscribe(UniOnFailureFlatMap.java:31)\n14:09:17,617 INFO  [app] \tat io.smallrye.mutiny.operators.AbstractUni.subscribe(AbstractUni.java:36)\n14:09:17,617 INFO  [app] \tat io.smallrye.mutiny.operators.uni.UniOnItemTransform.subscribe(UniOnItemTransform.java:22)\n14:09:17,618 INFO  [app] \tat io.smallrye.mutiny.operators.AbstractUni.subscribe(AbstractUni.java:36)\n14:09:17,618 INFO  [app] \tat io.smallrye.mutiny.operators.uni.UniRunSubscribeOn.lambda$subscribe$0(UniRunSubscribeOn.java:27)\n14:09:17,618 INFO  [app] \tat io.quarkus.smallrye.health.runtime.QuarkusAsyncHealthCheckFactory$1$1.call(QuarkusAsyncHealthCheckFactory.java:42)\n14:09:17,618 INFO  [app] \tat io.quarkus.smallrye.health.runtime.QuarkusAsyncHealthCheckFactory$1$1.call(QuarkusAsyncHealthCheckFactory.java:39)\n14:09:17,618 INFO  [app] \tat io.vertx.core.impl.ContextImpl.lambda$executeBlocking$0(ContextImpl.java:178)\n14:09:17,618 INFO  [app] \tat io.vertx.core.impl.ContextInternal.dispatch(ContextInternal.java:270)\n14:09:17,618 INFO  [app] \tat io.vertx.core.impl.ContextImpl.lambda$internalExecuteBlocking$2(ContextImpl.java:210)\n14:09:17,619 INFO  [app] \tat io.quarkus.vertx.core.runtime.VertxCoreRecorder$14.runWith(VertxCoreRecorder.java:627)\n14:09:17,619 INFO  [app] \tat org.jboss.threads.EnhancedQueueExecutor$Task.doRunWith(EnhancedQueueExecutor.java:2675)\n14:09:17,619 INFO  [app] \tat org.jboss.threads.EnhancedQueueExecutor$Task.run(EnhancedQueueExecutor.java:2654)\n14:09:17,619 INFO  [app] \tat org.jboss.threads.EnhancedQueueExecutor.runThreadBody(EnhancedQueueExecutor.java:1627)\n14:09:17,619 INFO  [app] \tat org.jboss.threads.EnhancedQueueExecutor$ThreadBody.run(EnhancedQueueExecutor.java:1594)\n14:09:17,619 INFO  [app] \tat org.jboss.threads.DelegatingRunnable.run(DelegatingRunnable.java:11)\n14:09:17,619 INFO  [app] \tat org.jboss.threads.ThreadLocalResettingRunnable.run(ThreadLocalResettingRunnable.java:11)\n14:09:17,620 INFO  [app] \tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n14:09:17,620 INFO  [app] \tat java.base/java.lang.Thread.run(Thread.java:1583)\n14:09:17,620 INFO  [app] 14:09:16,597 SRHCK01001: Reporting health down status: {\"status\":\"DOWN\",\"checks\":[{\"name\":\"readiness\",\"status\":\"UP\"},{\"name\":\"io.quarkus.agroal.runtime.health.DataSourceHealthCheck_ClientProxy\",\"status\":\"DOWN\",\"data\":{\"exceptionClass\":\"java.lang.NullPointerException\",\"exceptionMessage\":\"Cannot read field \\\"entries\\\" because \\\"agroalSupport\\\" is null\",\"rootCause\":\"Cannot read field \\\"entries\\\" because \\\"agroalSupport\\\" is null\"}},{\"name\":\"greeting\",\"status\":\"UP\"}]}\n```\n\n### How to Reproduce?\n\nSteps to reproduce the behavior:\n\n1. `git clone git@github.com:michalvavrik/quarkus-test-suite.git -b feature/health-check-npe-reproducer`\n2. `quarkus-test-suite/javaee-like-getting-started`\n3. `mvn clean verify -Dit.test=JavaEELikeHealthCheckIT`\n\n### Output of `uname -a` or `ver`\n\nFedora\n\n### Output of `java -version`\n\nTemurin 21\n\n### Quarkus version or git rev\n\n999-SNAPSHOT\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\n3.9.4\n\n### Additional information\n\n_No response_","closed_by":{"login":"yrodiere","id":412878,"node_id":"MDQ6VXNlcjQxMjg3OA==","avatar_url":"https://avatars.githubusercontent.com/u/412878?v=4","gravatar_id":"","url":"https://api.github.com/users/yrodiere","html_url":"https://github.com/yrodiere","followers_url":"https://api.github.com/users/yrodiere/followers","following_url":"https://api.github.com/users/yrodiere/following{/other_user}","gists_url":"https://api.github.com/users/yrodiere/gists{/gist_id}","starred_url":"https://api.github.com/users/yrodiere/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yrodiere/subscriptions","organizations_url":"https://api.github.com/users/yrodiere/orgs","repos_url":"https://api.github.com/users/yrodiere/repos","events_url":"https://api.github.com/users/yrodiere/events{/privacy}","received_events_url":"https://api.github.com/users/yrodiere/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/quarkusio/quarkus/issues/43990/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/quarkusio/quarkus/issues/43990/timeline","performed_via_github_app":null,"state_reason":"completed"}