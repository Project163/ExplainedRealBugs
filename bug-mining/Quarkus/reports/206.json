{"url":"https://api.github.com/repos/quarkusio/quarkus/issues/47033","repository_url":"https://api.github.com/repos/quarkusio/quarkus","labels_url":"https://api.github.com/repos/quarkusio/quarkus/issues/47033/labels{/name}","comments_url":"https://api.github.com/repos/quarkusio/quarkus/issues/47033/comments","events_url":"https://api.github.com/repos/quarkusio/quarkus/issues/47033/events","html_url":"https://github.com/quarkusio/quarkus/issues/47033","id":2952920589,"node_id":"I_kwDOCFbutM6wAf4N","number":47033,"title":"Native compilation failure using some extensions and bean validation","user":{"login":"s4iko","id":72751023,"node_id":"MDQ6VXNlcjcyNzUxMDIz","avatar_url":"https://avatars.githubusercontent.com/u/72751023?v=4","gravatar_id":"","url":"https://api.github.com/users/s4iko","html_url":"https://github.com/s4iko","followers_url":"https://api.github.com/users/s4iko/followers","following_url":"https://api.github.com/users/s4iko/following{/other_user}","gists_url":"https://api.github.com/users/s4iko/gists{/gist_id}","starred_url":"https://api.github.com/users/s4iko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s4iko/subscriptions","organizations_url":"https://api.github.com/users/s4iko/orgs","repos_url":"https://api.github.com/users/s4iko/repos","events_url":"https://api.github.com/users/s4iko/events{/privacy}","received_events_url":"https://api.github.com/users/s4iko/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":985346620,"node_id":"MDU6TGFiZWw5ODUzNDY2MjA=","url":"https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug","name":"kind/bug","color":"d73a4a","default":false,"description":"Something isn't working"},{"id":2497075451,"node_id":"MDU6TGFiZWwyNDk3MDc1NDUx","url":"https://api.github.com/repos/quarkusio/quarkus/labels/area/native-image","name":"area/native-image","color":"0366d6","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/quarkusio/quarkus/milestones/391","html_url":"https://github.com/quarkusio/quarkus/milestone/391","labels_url":"https://api.github.com/repos/quarkusio/quarkus/milestones/391/labels","id":12621495,"node_id":"MI_kwDOCFbutM4AwJa3","number":391,"title":"3.20.1","description":"","creator":{"login":"gsmet","id":1279749,"node_id":"MDQ6VXNlcjEyNzk3NDk=","avatar_url":"https://avatars.githubusercontent.com/u/1279749?v=4","gravatar_id":"","url":"https://api.github.com/users/gsmet","html_url":"https://github.com/gsmet","followers_url":"https://api.github.com/users/gsmet/followers","following_url":"https://api.github.com/users/gsmet/following{/other_user}","gists_url":"https://api.github.com/users/gsmet/gists{/gist_id}","starred_url":"https://api.github.com/users/gsmet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gsmet/subscriptions","organizations_url":"https://api.github.com/users/gsmet/orgs","repos_url":"https://api.github.com/users/gsmet/repos","events_url":"https://api.github.com/users/gsmet/events{/privacy}","received_events_url":"https://api.github.com/users/gsmet/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":143,"state":"closed","created_at":"2025-03-27T12:46:47Z","updated_at":"2025-09-26T06:28:23Z","due_on":null,"closed_at":"2025-06-18T13:30:56Z"},"comments":10,"created_at":"2025-03-27T13:04:08Z","updated_at":"2025-04-30T12:00:29Z","closed_at":"2025-04-08T16:33:47Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\n\nHi,\n\nI try to build a native executable of a project with those 3 extensions:\n- quarkus-cxf\n- quarkus-mongodb-client\n- quarkus-hibernate-validator\n\nBut the build fails.\nIt seems that the failure appears only when `@Valid` is set on a property of type List (I didn't try other collection classes), such as:\n```\n    @NotNull\n    @Size(min = 0)\n    @Valid // commenting this made the build succeed\n    private List<TestData2> fields;\n```\n\nRemoving one of the 3 extensions or commenting `@valid` result to a build success.\n\nNote that a `@Valid` on an Object (not a collection) does not fails the build.\n\nI build the native executable using Docker:\n```\nmvn clean package -Dnative -Dmaven.test.skip=true -Dquarkus.native.container-build=true\n```\n\nThanks.\n\n### Expected behavior\n\nThe native build passes using the 3 extensions and `@Valid` on List properties.\n\n### Actual behavior\n\nThe native build fails using the 3 extensions and `@Valid` on List properties with the following stacktrace:\n\n```\nProduced artifacts:\n /project/build-artifacts.json (build_info)\n /project/svm_err_b_20250327T124443.290_pid60.md (build_info)\n========================================================================================================================\nFailed generating 'code-with-quarkus-1.0.0-SNAPSHOT-runner' after 2m 18s.\n\nThe build process encountered an unexpected error:\n\ncom.oracle.svm.core.util.VMError$HostedError: com.oracle.svm.core.util.UserError$UserException: Image heap writing found a class not seen during static analysis. Did a static field or an object referenced from a static field change during native image generation? For example, a lazily initialized cache could have been initialized during image generation, in which case you need to force eager initialization of the cache before static analysis or reset the cache using a field value recomputation.\n    class: org.eclipse.angus.activation.nativeimage.AngusActivationFeature\n  reachable through:\n    object: [Ljava.lang.Class;@15756b0c  of class: java.lang.Class[]\n    object: com.oracle.svm.core.code.ImageCodeInfo@33f24d15  of class: com.oracle.svm.core.code.ImageCodeInfo\n    root: com.oracle.svm.core.code.ImageCodeInfo.prepareCodeInfo()\n\n        at org.graalvm.nativeimage.builder/com.oracle.svm.core.util.VMError.shouldNotReachHere(VMError.java:82)\n        at org.graalvm.nativeimage.builder/com.oracle.svm.hosted.NativeImageGenerator.doRun(NativeImageGenerator.java:720)\n        at org.graalvm.nativeimage.builder/com.oracle.svm.hosted.NativeImageGenerator.run(NativeImageGenerator.java:550)\n        at org.graalvm.nativeimage.builder/com.oracle.svm.hosted.NativeImageGeneratorRunner.buildImage(NativeImageGeneratorRunner.java:539)\n        at org.graalvm.nativeimage.builder/com.oracle.svm.hosted.NativeImageGeneratorRunner.build(NativeImageGeneratorRunner.java:721)\n        at org.graalvm.nativeimage.builder/com.oracle.svm.hosted.NativeImageGeneratorRunner.start(NativeImageGeneratorRunner.java:143)\n        at org.graalvm.nativeimage.builder/com.oracle.svm.hosted.NativeImageGeneratorRunner.main(NativeImageGeneratorRunner.java:98)\nCaused by: com.oracle.svm.core.util.UserError$UserException: Image heap writing found a class not seen during static analysis. Did a static field or an object referenced from a static field change during native image generation? For example, a lazily initialized cache could have been initialized during image generation, in which case you need to force eager initialization of the cache before static analysis or reset the cache using a field value recomputation.\n    class: org.eclipse.angus.activation.nativeimage.AngusActivationFeature\n  reachable through:\n    object: [Ljava.lang.Class;@15756b0c  of class: java.lang.Class[]\n    object: com.oracle.svm.core.code.ImageCodeInfo@33f24d15  of class: com.oracle.svm.core.code.ImageCodeInfo\n    root: com.oracle.svm.core.code.ImageCodeInfo.prepareCodeInfo()\n\n        at org.graalvm.nativeimage.builder/com.oracle.svm.core.util.UserError.abort(UserError.java:73)\n        at org.graalvm.nativeimage.builder/com.oracle.svm.hosted.image.NativeImageHeap.reportIllegalType(NativeImageHeap.java:592)\n        at org.graalvm.nativeimage.builder/com.oracle.svm.hosted.image.NativeImageHeap.addObjectToImageHeap(NativeImageHeap.java:556)\n        at org.graalvm.nativeimage.builder/com.oracle.svm.hosted.image.NativeImageHeap.addConstant(NativeImageHeap.java:327)\n        at org.graalvm.nativeimage.builder/com.oracle.svm.hosted.image.NativeImageHeap.processAddObjectWorklist(NativeImageHeap.java:705)\n        at org.graalvm.nativeimage.builder/com.oracle.svm.hosted.image.NativeImageHeap.addTrailingObjects(NativeImageHeap.java:202)\n        at org.graalvm.nativeimage.builder/com.oracle.svm.hosted.NativeImageGenerator.buildNativeImageHeap(NativeImageGenerator.java:760)\n        at org.graalvm.nativeimage.builder/com.oracle.svm.hosted.NativeImageGenerator.doRun(NativeImageGenerator.java:697)\n        ... 5 more\n\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time:  03:28 min\n[INFO] Finished at: 2025-03-27T13:44:43+01:00\n[INFO] ------------------------------------------------------------------------\n[ERROR] Failed to execute goal io.quarkus.platform:quarkus-maven-plugin:3.19.4:build (default) on project code-with-quarkus: Failed to build quarkus application: io.quarkus.builder.BuildException: Build failure: Build failed due to errors\n[ERROR]         [error]: Build step io.quarkus.deployment.pkg.steps.NativeImageBuildStep#build threw an exception: io.quarkus.deployment.pkg.steps.NativeImageBuildStep$ImageGenerationFailureException: Image generation failed. Exit code: 1\n[ERROR]         at io.quarkus.deployment.pkg.steps.NativeImageBuildStep.imageGenerationFailed(NativeImageBuildStep.java:496)\n[ERROR]         at io.quarkus.deployment.pkg.steps.NativeImageBuildStep.build(NativeImageBuildStep.java:287)\n[ERROR]         at java.base/java.lang.invoke.MethodHandle.invokeWithArguments(MethodHandle.java:733)\n[ERROR]         at io.quarkus.deployment.ExtensionLoader$3.execute(ExtensionLoader.java:856)\n[ERROR]         at io.quarkus.builder.BuildContext.run(BuildContext.java:255)\n[ERROR]         at org.jboss.threads.ContextHandler$1.runWith(ContextHandler.java:18)\n[ERROR]         at org.jboss.threads.EnhancedQueueExecutor$Task.doRunWith(EnhancedQueueExecutor.java:2675)\n[ERROR]         at org.jboss.threads.EnhancedQueueExecutor$Task.run(EnhancedQueueExecutor.java:2654)\n[ERROR]         at org.jboss.threads.EnhancedQueueExecutor.runThreadBody(EnhancedQueueExecutor.java:1627)\n[ERROR]         at org.jboss.threads.EnhancedQueueExecutor$ThreadBody.run(EnhancedQueueExecutor.java:1594)\n[ERROR]         at java.base/java.lang.Thread.run(Thread.java:1583)\n[ERROR]         at org.jboss.threads.JBossThread.run(JBossThread.java:499)\n[ERROR] -> [Help 1]\n[ERROR]\n[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.\n[ERROR] Re-run Maven using the -X switch to enable full debug logging.\n[ERROR]\n[ERROR] For more information about the errors and possible solutions, please read the following articles:\n[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException\n```\n\n### How to Reproduce?\n\n_No response_\n\n### Output of `uname -a` or `ver`\n\nUbuntu 24.04.2 LTS\n\n### Output of `java -version`\n\nopenjdk version \"21.0.6\" 2025-01-21\n\n### Mandrel or GraalVM version (if different from Java)\n\n_No response_\n\n### Quarkus version or git rev\n\n3.19.4\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\nApache Maven 3.8.7\n\n### Additional information\n\nReproducer:\n[code-with-quarkus-cxf-mongo.zip](https://github.com/user-attachments/files/19486804/code-with-quarkus-cxf-mongo.zip)\n\nor generate a fresh project with the 3 extensions + a class with a `@Valid` on a List property.","closed_by":{"login":"gsmet","id":1279749,"node_id":"MDQ6VXNlcjEyNzk3NDk=","avatar_url":"https://avatars.githubusercontent.com/u/1279749?v=4","gravatar_id":"","url":"https://api.github.com/users/gsmet","html_url":"https://github.com/gsmet","followers_url":"https://api.github.com/users/gsmet/followers","following_url":"https://api.github.com/users/gsmet/following{/other_user}","gists_url":"https://api.github.com/users/gsmet/gists{/gist_id}","starred_url":"https://api.github.com/users/gsmet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gsmet/subscriptions","organizations_url":"https://api.github.com/users/gsmet/orgs","repos_url":"https://api.github.com/users/gsmet/repos","events_url":"https://api.github.com/users/gsmet/events{/privacy}","received_events_url":"https://api.github.com/users/gsmet/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/quarkusio/quarkus/issues/47033/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/quarkusio/quarkus/issues/47033/timeline","performed_via_github_app":null,"state_reason":"completed"}