{"url":"https://api.github.com/repos/quarkusio/quarkus/issues/43676","repository_url":"https://api.github.com/repos/quarkusio/quarkus","labels_url":"https://api.github.com/repos/quarkusio/quarkus/issues/43676/labels{/name}","comments_url":"https://api.github.com/repos/quarkusio/quarkus/issues/43676/comments","events_url":"https://api.github.com/repos/quarkusio/quarkus/issues/43676/events","html_url":"https://github.com/quarkusio/quarkus/issues/43676","id":2563629647,"node_id":"I_kwDOCFbutM6YzeJP","number":43676,"title":"Undertow CacheResourceManager can cause frequent GC","user":{"login":"prateeksharma2988","id":119657818,"node_id":"U_kgDOByHVWg","avatar_url":"https://avatars.githubusercontent.com/u/119657818?v=4","gravatar_id":"","url":"https://api.github.com/users/prateeksharma2988","html_url":"https://github.com/prateeksharma2988","followers_url":"https://api.github.com/users/prateeksharma2988/followers","following_url":"https://api.github.com/users/prateeksharma2988/following{/other_user}","gists_url":"https://api.github.com/users/prateeksharma2988/gists{/gist_id}","starred_url":"https://api.github.com/users/prateeksharma2988/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/prateeksharma2988/subscriptions","organizations_url":"https://api.github.com/users/prateeksharma2988/orgs","repos_url":"https://api.github.com/users/prateeksharma2988/repos","events_url":"https://api.github.com/users/prateeksharma2988/events{/privacy}","received_events_url":"https://api.github.com/users/prateeksharma2988/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":985346626,"node_id":"MDU6TGFiZWw5ODUzNDY2MjY=","url":"https://api.github.com/repos/quarkusio/quarkus/labels/kind/question","name":"kind/question","color":"d876e3","default":false,"description":"Further information is requested"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/quarkusio/quarkus/milestones/368","html_url":"https://github.com/quarkusio/quarkus/milestone/368","labels_url":"https://api.github.com/repos/quarkusio/quarkus/milestones/368/labels","id":12016510,"node_id":"MI_kwDOCFbutM4At1t-","number":368,"title":"3.15.3","description":"","creator":{"login":"gsmet","id":1279749,"node_id":"MDQ6VXNlcjEyNzk3NDk=","avatar_url":"https://avatars.githubusercontent.com/u/1279749?v=4","gravatar_id":"","url":"https://api.github.com/users/gsmet","html_url":"https://github.com/gsmet","followers_url":"https://api.github.com/users/gsmet/followers","following_url":"https://api.github.com/users/gsmet/following{/other_user}","gists_url":"https://api.github.com/users/gsmet/gists{/gist_id}","starred_url":"https://api.github.com/users/gsmet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gsmet/subscriptions","organizations_url":"https://api.github.com/users/gsmet/orgs","repos_url":"https://api.github.com/users/gsmet/repos","events_url":"https://api.github.com/users/gsmet/events{/privacy}","received_events_url":"https://api.github.com/users/gsmet/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":53,"state":"closed","created_at":"2024-12-09T10:38:07Z","updated_at":"2025-01-14T19:11:31Z","due_on":null,"closed_at":"2025-01-14T11:17:44Z"},"comments":13,"created_at":"2024-10-03T10:03:47Z","updated_at":"2024-12-12T08:12:51Z","closed_at":"2024-10-14T17:44:49Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"We have recently migrated to Quarkus 3.11.2 and are facing increased heap issue.\n\n**Below is the sample code for re-producing the issue.** \n\n- We have an API call for which every call with path param and all calls are saved in cache as CHM and as we receive more and more hit on this url heap started to increase.\n\n```\n-  Class Name                                                                                                                                  | Shallow Heap | Retained Heap\n---------------------------------------------------------------------------------------------------------------------------------------------------------------------------\n[79024] java.util.concurrent.ConcurrentHashMap$Node @ 0xf82048e0                                                                            |           32 |            32\n|- <class> class java.util.concurrent.ConcurrentHashMap$Node @ 0xfab56f60 System Class                                                      |            0 |             0\n|- key java.lang.String @ 0xf82048a8  META-INF/resources/v1/se/{p1}/sd/{p2}/key/1|           24 |           144\n'- val java.util.Collections$EmptyList @ 0xfab845c0                                                                                         |           16 |            16\n---------------------------------------------------------------------------------------------------------------------------------------------------------------------------\n```\n\n- Is there anything which could stop this internal caching by JVM in Quarkus\n\n```java\nimport java.util.Collection;\nimport java.util.List;\nimport java.util.Scanner;\nimport java.util.concurrent.atomic.AtomicLong;\nimport java.util.stream.Stream;\n\npublic class MainTest {\n\n    static final AtomicLong sleep = new AtomicLong(1);\n\n    static final AtomicLong counter = new AtomicLong(1000000000);\n\n    static void loop() {\n        while (true) {\n            MainTest.class.getClassLoader().getResource(\"META-INF/resources/my-resource/id/\" + counter.get());\n//            System.out.println(\".\");\n            counter.incrementAndGet();\n            try {\n                Thread.sleep(sleep.get());\n            } catch (InterruptedException e) {\n                throw new RuntimeException(e);\n            }\n        }\n    }\n\n    public static void main(String[] args) {\n        new Thread(() -> loop()).start();\n\n        Scanner scanner = new Scanner(System.in);\n        while (true) {\n            String cmd = scanner.nextLine();\n            System.out.println(\"delay \" + sleep.get() + \" /// \" + counter);\n            if (cmd.contains(\"u\")) {\n                sleep.set(sleep.get() / 2);\n            }\n            if (cmd.contains(\"d\")) {\n                sleep.set(1 + sleep.get() * 2);\n            }\n\n            printMem();\n        }\n    }\n\n    private static void printMem() {\n        Runtime rt = Runtime.getRuntime();\n        long total_mem = rt.totalMemory() / (1024*1024);\n        long free_mem = rt.freeMemory() / (1024*1024);\n        long used_mem = (total_mem - free_mem)  / (1024*1024);\n        System.out.println(\"Amount of used memory: \" + used_mem + \" / \" + total_mem);\n\n    }\n\n}\n```","closed_by":{"login":"gsmet","id":1279749,"node_id":"MDQ6VXNlcjEyNzk3NDk=","avatar_url":"https://avatars.githubusercontent.com/u/1279749?v=4","gravatar_id":"","url":"https://api.github.com/users/gsmet","html_url":"https://github.com/gsmet","followers_url":"https://api.github.com/users/gsmet/followers","following_url":"https://api.github.com/users/gsmet/following{/other_user}","gists_url":"https://api.github.com/users/gsmet/gists{/gist_id}","starred_url":"https://api.github.com/users/gsmet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gsmet/subscriptions","organizations_url":"https://api.github.com/users/gsmet/orgs","repos_url":"https://api.github.com/users/gsmet/repos","events_url":"https://api.github.com/users/gsmet/events{/privacy}","received_events_url":"https://api.github.com/users/gsmet/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/quarkusio/quarkus/issues/43676/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/quarkusio/quarkus/issues/43676/timeline","performed_via_github_app":null,"state_reason":"completed"}