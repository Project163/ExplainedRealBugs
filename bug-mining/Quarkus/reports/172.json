{"url":"https://api.github.com/repos/quarkusio/quarkus/issues/44661","repository_url":"https://api.github.com/repos/quarkusio/quarkus","labels_url":"https://api.github.com/repos/quarkusio/quarkus/issues/44661/labels{/name}","comments_url":"https://api.github.com/repos/quarkusio/quarkus/issues/44661/comments","events_url":"https://api.github.com/repos/quarkusio/quarkus/issues/44661/events","html_url":"https://github.com/quarkusio/quarkus/issues/44661","id":2683842043,"node_id":"I_kwDOCFbutM6f-C37","number":44661,"title":"All but first test in a class fail if class is annotated @WithFunction","user":{"login":"devopsix","id":58369032,"node_id":"MDQ6VXNlcjU4MzY5MDMy","avatar_url":"https://avatars.githubusercontent.com/u/58369032?v=4","gravatar_id":"","url":"https://api.github.com/users/devopsix","html_url":"https://github.com/devopsix","followers_url":"https://api.github.com/users/devopsix/followers","following_url":"https://api.github.com/users/devopsix/following{/other_user}","gists_url":"https://api.github.com/users/devopsix/gists{/gist_id}","starred_url":"https://api.github.com/users/devopsix/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/devopsix/subscriptions","organizations_url":"https://api.github.com/users/devopsix/orgs","repos_url":"https://api.github.com/users/devopsix/repos","events_url":"https://api.github.com/users/devopsix/events{/privacy}","received_events_url":"https://api.github.com/users/devopsix/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":985346620,"node_id":"MDU6TGFiZWw5ODUzNDY2MjA=","url":"https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug","name":"kind/bug","color":"d73a4a","default":false,"description":"Something isn't working"},{"id":2243658033,"node_id":"MDU6TGFiZWwyMjQzNjU4MDMz","url":"https://api.github.com/repos/quarkusio/quarkus/labels/area/google-cloud-functions","name":"area/google-cloud-functions","color":"0366d6","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"loicmathieu","id":1819009,"node_id":"MDQ6VXNlcjE4MTkwMDk=","avatar_url":"https://avatars.githubusercontent.com/u/1819009?v=4","gravatar_id":"","url":"https://api.github.com/users/loicmathieu","html_url":"https://github.com/loicmathieu","followers_url":"https://api.github.com/users/loicmathieu/followers","following_url":"https://api.github.com/users/loicmathieu/following{/other_user}","gists_url":"https://api.github.com/users/loicmathieu/gists{/gist_id}","starred_url":"https://api.github.com/users/loicmathieu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/loicmathieu/subscriptions","organizations_url":"https://api.github.com/users/loicmathieu/orgs","repos_url":"https://api.github.com/users/loicmathieu/repos","events_url":"https://api.github.com/users/loicmathieu/events{/privacy}","received_events_url":"https://api.github.com/users/loicmathieu/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"loicmathieu","id":1819009,"node_id":"MDQ6VXNlcjE4MTkwMDk=","avatar_url":"https://avatars.githubusercontent.com/u/1819009?v=4","gravatar_id":"","url":"https://api.github.com/users/loicmathieu","html_url":"https://github.com/loicmathieu","followers_url":"https://api.github.com/users/loicmathieu/followers","following_url":"https://api.github.com/users/loicmathieu/following{/other_user}","gists_url":"https://api.github.com/users/loicmathieu/gists{/gist_id}","starred_url":"https://api.github.com/users/loicmathieu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/loicmathieu/subscriptions","organizations_url":"https://api.github.com/users/loicmathieu/orgs","repos_url":"https://api.github.com/users/loicmathieu/repos","events_url":"https://api.github.com/users/loicmathieu/events{/privacy}","received_events_url":"https://api.github.com/users/loicmathieu/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/quarkusio/quarkus/milestones/379","html_url":"https://github.com/quarkusio/quarkus/milestone/379","labels_url":"https://api.github.com/repos/quarkusio/quarkus/milestones/379/labels","id":12316625,"node_id":"MI_kwDOCFbutM4Au-_R","number":379,"title":"3.19.0","description":"","creator":{"login":"gsmet","id":1279749,"node_id":"MDQ6VXNlcjEyNzk3NDk=","avatar_url":"https://avatars.githubusercontent.com/u/1279749?v=4","gravatar_id":"","url":"https://api.github.com/users/gsmet","html_url":"https://github.com/gsmet","followers_url":"https://api.github.com/users/gsmet/followers","following_url":"https://api.github.com/users/gsmet/following{/other_user}","gists_url":"https://api.github.com/users/gsmet/gists{/gist_id}","starred_url":"https://api.github.com/users/gsmet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gsmet/subscriptions","organizations_url":"https://api.github.com/users/gsmet/orgs","repos_url":"https://api.github.com/users/gsmet/repos","events_url":"https://api.github.com/users/gsmet/events{/privacy}","received_events_url":"https://api.github.com/users/gsmet/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":31,"state":"closed","created_at":"2025-02-14T16:34:02Z","updated_at":"2025-05-08T09:31:41Z","due_on":null,"closed_at":"2025-02-19T13:08:41Z"},"comments":2,"created_at":"2024-11-22T16:46:31Z","updated_at":"2025-02-14T16:35:08Z","closed_at":"2025-02-14T14:00:27Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\n\nGiven a project which contains an implementation of a Google Cloud Run Function (`CloudEventsFunction` variant) which was created as shown in the [Google Cloud Functions (Serverless) guide](https://quarkus.io/guides/gcp-functions#creating-the-maven-deployment-project),\n\nAdd a test class to this project as shown in the [Testing your function section](https://quarkus.io/guides/gcp-functions#the-cloudeventsfunction-4) and add a second identical test is added to this test class,\n\nWhen running tests, the second test in this class cannot be instantiated.\n\n\n### Expected behavior\n\nBoth tests pass.\n\n### Actual behavior\n\nThe first test passes, the second test fails.\n\n```\norg.junit.jupiter.api.extension.TestInstantiationException: Failed to create test instance\n        at io.quarkus.test.junit.QuarkusTestExtension.initTestState(QuarkusTestExtension.java:773)\n        at io.quarkus.test.junit.QuarkusTestExtension.interceptTestClassConstructor(QuarkusTestExtension.java:739)\n        at java.base/java.util.Optional.orElseGet(Optional.java:364)\n        at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)\n        at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)\nCaused by: java.lang.RuntimeException: java.io.IOException: Failed to bind to 0.0.0.0/0.0.0.0:8081\n        at io.quarkus.google.cloud.functions.test.CloudFunctionTestResource.inject(CloudFunctionTestResource.java:40)\n        at io.quarkus.test.common.TestResourceManager.inject(TestResourceManager.java:201)\n        at java.base/java.lang.reflect.Method.invoke(Method.java:580)\n        at io.quarkus.test.junit.QuarkusTestExtension.createActualTestInstance(QuarkusTestExtension.java:784)\n        at io.quarkus.test.junit.QuarkusTestExtension.initTestState(QuarkusTestExtension.java:767)\n        ... 4 more\nCaused by: java.io.IOException: Failed to bind to 0.0.0.0/0.0.0.0:8081\n        at org.eclipse.jetty.server.ServerConnector.openAcceptChannel(ServerConnector.java:349)\n        at org.eclipse.jetty.server.ServerConnector.open(ServerConnector.java:310)\n        at org.eclipse.jetty.server.AbstractNetworkConnector.doStart(AbstractNetworkConnector.java:80)\n        at org.eclipse.jetty.server.ServerConnector.doStart(ServerConnector.java:234)\n        at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:73)\n        at org.eclipse.jetty.server.Server.doStart(Server.java:401)\n        at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:73)\n        at com.google.cloud.functions.invoker.runner.Invoker.startServer(Invoker.java:324)\n        at com.google.cloud.functions.invoker.runner.Invoker.startTestServer(Invoker.java:276)\n        at io.quarkus.google.cloud.functions.test.CloudFunctionsInvoker.start(CloudFunctionsInvoker.java:26)\n        at io.quarkus.google.cloud.functions.test.CloudFunctionTestResource.inject(CloudFunctionTestResource.java:38)\n        ... 8 more\nCaused by: java.net.BindException: Address already in use: bind\n        at java.base/sun.nio.ch.Net.bind0(Native Method)\n        at java.base/sun.nio.ch.Net.bind(Net.java:565)\n        at java.base/sun.nio.ch.ServerSocketChannelImpl.netBind(ServerSocketChannelImpl.java:344)\n        at java.base/sun.nio.ch.ServerSocketChannelImpl.bind(ServerSocketChannelImpl.java:301)\n        at java.base/sun.nio.ch.ServerSocketAdaptor.bind(ServerSocketAdaptor.java:89)\n        at org.eclipse.jetty.server.ServerConnector.openAcceptChannel(ServerConnector.java:344)\n        ... 18 more\n```\n\n\n### How to Reproduce?\n\nhttps://github.com/devopsix/quarkus-google-cloud-functions-issue\n\n### Output of `uname -a` or `ver`\n\nn/a\n\n### Output of `java -version`\n\nopenjdk version \"21.0.5\" 2024-10-15 LTS OpenJDK Runtime Environment Temurin-21.0.5+11 (build 21.0.5+11-LTS) OpenJDK 64-Bit Server VM Temurin-21.0.5+11 (build 21.0.5+11-LTS, mixed mode, sharing)\n\n### Quarkus version or git rev\n\n3.16.4\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\nApache Maven 3.9.9 (8e8579a9e76f7d015ee5ec7bfcdc97d260186937)\n\n### Additional information\n\nSuspected cause: In [`CloudFunctionTestResource.inject(TestInjector)`](https://github.com/quarkusio/quarkus/blob/8df922d7f8a07ef97a73ba066f2496486140eb67/test-framework/google-cloud-functions/src/main/java/io/quarkus/google/cloud/functions/test/CloudFunctionTestResource.java#L32) a new invoker is started for each test without stopping an invoker created previously.\n\nPotential remedy: Invokers should either be reused between tests or stopped after each test.\n","closed_by":{"login":"gsmet","id":1279749,"node_id":"MDQ6VXNlcjEyNzk3NDk=","avatar_url":"https://avatars.githubusercontent.com/u/1279749?v=4","gravatar_id":"","url":"https://api.github.com/users/gsmet","html_url":"https://github.com/gsmet","followers_url":"https://api.github.com/users/gsmet/followers","following_url":"https://api.github.com/users/gsmet/following{/other_user}","gists_url":"https://api.github.com/users/gsmet/gists{/gist_id}","starred_url":"https://api.github.com/users/gsmet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gsmet/subscriptions","organizations_url":"https://api.github.com/users/gsmet/orgs","repos_url":"https://api.github.com/users/gsmet/repos","events_url":"https://api.github.com/users/gsmet/events{/privacy}","received_events_url":"https://api.github.com/users/gsmet/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/quarkusio/quarkus/issues/44661/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/quarkusio/quarkus/issues/44661/timeline","performed_via_github_app":null,"state_reason":"completed"}