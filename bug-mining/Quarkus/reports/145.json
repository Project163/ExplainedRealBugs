{"url":"https://api.github.com/repos/quarkusio/quarkus/issues/44674","repository_url":"https://api.github.com/repos/quarkusio/quarkus","labels_url":"https://api.github.com/repos/quarkusio/quarkus/issues/44674/labels{/name}","comments_url":"https://api.github.com/repos/quarkusio/quarkus/issues/44674/comments","events_url":"https://api.github.com/repos/quarkusio/quarkus/issues/44674/events","html_url":"https://github.com/quarkusio/quarkus/issues/44674","id":2688484867,"node_id":"I_kwDOCFbutM6gPwYD","number":44674,"title":"Qute: Rendering Timeout Instead of Throwing TemplateException for Missing Keys in {#let} and {#set} Constructs","user":{"login":"YassinHajaj","id":18174180,"node_id":"MDQ6VXNlcjE4MTc0MTgw","avatar_url":"https://avatars.githubusercontent.com/u/18174180?v=4","gravatar_id":"","url":"https://api.github.com/users/YassinHajaj","html_url":"https://github.com/YassinHajaj","followers_url":"https://api.github.com/users/YassinHajaj/followers","following_url":"https://api.github.com/users/YassinHajaj/following{/other_user}","gists_url":"https://api.github.com/users/YassinHajaj/gists{/gist_id}","starred_url":"https://api.github.com/users/YassinHajaj/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/YassinHajaj/subscriptions","organizations_url":"https://api.github.com/users/YassinHajaj/orgs","repos_url":"https://api.github.com/users/YassinHajaj/repos","events_url":"https://api.github.com/users/YassinHajaj/events{/privacy}","received_events_url":"https://api.github.com/users/YassinHajaj/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":985346620,"node_id":"MDU6TGFiZWw5ODUzNDY2MjA=","url":"https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug","name":"kind/bug","color":"d73a4a","default":false,"description":"Something isn't working"},{"id":1714005220,"node_id":"MDU6TGFiZWwxNzE0MDA1MjIw","url":"https://api.github.com/repos/quarkusio/quarkus/labels/area/qute","name":"area/qute","color":"0366d6","default":false,"description":"The template engine"}],"state":"closed","locked":false,"assignee":{"login":"mkouba","id":913004,"node_id":"MDQ6VXNlcjkxMzAwNA==","avatar_url":"https://avatars.githubusercontent.com/u/913004?v=4","gravatar_id":"","url":"https://api.github.com/users/mkouba","html_url":"https://github.com/mkouba","followers_url":"https://api.github.com/users/mkouba/followers","following_url":"https://api.github.com/users/mkouba/following{/other_user}","gists_url":"https://api.github.com/users/mkouba/gists{/gist_id}","starred_url":"https://api.github.com/users/mkouba/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mkouba/subscriptions","organizations_url":"https://api.github.com/users/mkouba/orgs","repos_url":"https://api.github.com/users/mkouba/repos","events_url":"https://api.github.com/users/mkouba/events{/privacy}","received_events_url":"https://api.github.com/users/mkouba/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"mkouba","id":913004,"node_id":"MDQ6VXNlcjkxMzAwNA==","avatar_url":"https://avatars.githubusercontent.com/u/913004?v=4","gravatar_id":"","url":"https://api.github.com/users/mkouba","html_url":"https://github.com/mkouba","followers_url":"https://api.github.com/users/mkouba/followers","following_url":"https://api.github.com/users/mkouba/following{/other_user}","gists_url":"https://api.github.com/users/mkouba/gists{/gist_id}","starred_url":"https://api.github.com/users/mkouba/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mkouba/subscriptions","organizations_url":"https://api.github.com/users/mkouba/orgs","repos_url":"https://api.github.com/users/mkouba/repos","events_url":"https://api.github.com/users/mkouba/events{/privacy}","received_events_url":"https://api.github.com/users/mkouba/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/quarkusio/quarkus/milestones/372","html_url":"https://github.com/quarkusio/quarkus/milestone/372","labels_url":"https://api.github.com/repos/quarkusio/quarkus/milestones/372/labels","id":12181460,"node_id":"MI_kwDOCFbutM4Aud_U","number":372,"title":"3.15.4","description":"","creator":{"login":"gsmet","id":1279749,"node_id":"MDQ6VXNlcjEyNzk3NDk=","avatar_url":"https://avatars.githubusercontent.com/u/1279749?v=4","gravatar_id":"","url":"https://api.github.com/users/gsmet","html_url":"https://github.com/gsmet","followers_url":"https://api.github.com/users/gsmet/followers","following_url":"https://api.github.com/users/gsmet/following{/other_user}","gists_url":"https://api.github.com/users/gsmet/gists{/gist_id}","starred_url":"https://api.github.com/users/gsmet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gsmet/subscriptions","organizations_url":"https://api.github.com/users/gsmet/orgs","repos_url":"https://api.github.com/users/gsmet/repos","events_url":"https://api.github.com/users/gsmet/events{/privacy}","received_events_url":"https://api.github.com/users/gsmet/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":105,"state":"closed","created_at":"2025-01-17T08:42:44Z","updated_at":"2025-07-09T16:36:56Z","due_on":null,"closed_at":"2025-03-11T14:00:10Z"},"comments":4,"created_at":"2024-11-24T22:19:39Z","updated_at":"2025-02-20T12:06:59Z","closed_at":"2024-11-25T16:58:52Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\n\nThe rendering of a Qute template with specific {#let} or {#set} constructs results in a timeout instead of the expected exception when certain data is missing. The issue occurs when using TemplateInstance combined with data() method calls to pass data to the template.\n\nI attempted to use the data() method to provide the required context for the template, but when the template tried to access a non-existent key, the operation timed out instead of immediately throwing a TemplateException. The issue is particularly evident with nested structures and the use of {#let} and {#set} constructs in Qute templates.\n\n### Expected behavior\n\nWhen rendering a Qute template and a key referenced within the template is missing, the engine should throw a TemplateException with an appropriate message indicating that the key was not found.\n\nFor example:\n- Rendering error: Key \"c\" not found in the map with keys [a] in expression {c}\n\n### Actual behavior\n\nInstead of throwing a TemplateException, the rendering operation times out with the message:\n- rendering timeout [10000ms] occurred.\n\nThis happens when using TemplateInstance in combination with either one of those:\n\n- The {#let} construct.\n- The {#set} construct.\n- A missing {/let} closing tag.\n\nWhen debugging internally, I can see the exception being thrown in TemplateImpl#renderAsyncNoTimeout\n\n![Image](https://github.com/user-attachments/assets/5281656e-751a-4dc5-8c9d-811fa4a503bc)\n\nBut still, the final exception is the timeout.\n\n### How to Reproduce?\n\nEnsure you are using the Quarkus version 3.15.1.\n\nRun the following test class\n\n```\n@QuarkusTest\nclass QuteTest {\n\n    @Inject\n    Engine templateEngine;\n\n    private static final Map<String, Object> DATA = Map.of(\n            \"a\", Map.of(\"b\", Map.of())\n    );\n\n    @Test\n    void withDataFactoryMethod() {\n        TemplateInstance instance = templateEngine.parse(\"\"\"\n                {#let b = a.b}\n                    {c}\n                {/let}\n                \"\"\").data(DATA);\n\n        assertThatThrownBy(instance::render)\n                .isInstanceOf(TemplateException.class)\n                .hasRootCauseMessage(\"Rendering error: Key \\\"c\\\" not found in the map with keys [a] in expression {c}\");\n    }\n\n    @Test\n    void withInstanceThenDataForEachEntry() {\n        TemplateInstance instance = templateEngine.parse(\"\"\"\n                {#let b = a.b}\n                    {c}\n                {/let}\n                \"\"\").instance();\n        for (var e : DATA.entrySet()) {\n            instance.data(e.getKey(), e.getValue());\n        }\n        assertThatThrownBy(instance::render)\n                .isInstanceOf(TemplateException.class)\n                .hasMessageContaining(\"rendering timeout [10000ms] occured\");\n    }\n\n    @Test\n    void withSet_withInstanceThenDataForEachEntry() {\n        TemplateInstance instance = templateEngine.parse(\"\"\"\n                {#set b = a.b}\n                    {c}\n                {/set}\n                \"\"\").instance();\n        for (var e : DATA.entrySet()) {\n            instance.data(e.getKey(), e.getValue());\n        }\n        assertThatThrownBy(instance::render)\n                .isInstanceOf(TemplateException.class)\n                .hasMessageContaining(\"rendering timeout [10000ms] occured\");\n    }\n\n    @Test\n    void withLetWithoutEndTagwithInstanceThenDataForEachEntry() {\n        TemplateInstance instance = templateEngine.parse(\"\"\"\n                {#let b = a.b}\n                    {c}\n                \"\"\").instance();\n        for (var e : DATA.entrySet()) {\n            instance.data(e.getKey(), e.getValue());\n        }\n        assertThatThrownBy(instance::render)\n                .isInstanceOf(TemplateException.class)\n                .hasMessageContaining(\"rendering timeout [10000ms] occured\");\n    }\n}\n```\n\n### Output of `uname -a` or `ver`\n\nDarwin\n\n### Output of `java -version`\n\n21.0.1\n\n### Quarkus version or git rev\n\n3.15.1\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\nApache Maven 3.9.1\n\n### Additional information\n\nAs you can imagine, this will lead to people investigating timeout issues and exploring timeout solutions instead of focusing on their actual issue.","closed_by":{"login":"gsmet","id":1279749,"node_id":"MDQ6VXNlcjEyNzk3NDk=","avatar_url":"https://avatars.githubusercontent.com/u/1279749?v=4","gravatar_id":"","url":"https://api.github.com/users/gsmet","html_url":"https://github.com/gsmet","followers_url":"https://api.github.com/users/gsmet/followers","following_url":"https://api.github.com/users/gsmet/following{/other_user}","gists_url":"https://api.github.com/users/gsmet/gists{/gist_id}","starred_url":"https://api.github.com/users/gsmet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gsmet/subscriptions","organizations_url":"https://api.github.com/users/gsmet/orgs","repos_url":"https://api.github.com/users/gsmet/repos","events_url":"https://api.github.com/users/gsmet/events{/privacy}","received_events_url":"https://api.github.com/users/gsmet/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/quarkusio/quarkus/issues/44674/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/quarkusio/quarkus/issues/44674/timeline","performed_via_github_app":null,"state_reason":"completed"}