{"url":"https://api.github.com/repos/quarkusio/quarkus/issues/50769","repository_url":"https://api.github.com/repos/quarkusio/quarkus","labels_url":"https://api.github.com/repos/quarkusio/quarkus/issues/50769/labels{/name}","comments_url":"https://api.github.com/repos/quarkusio/quarkus/issues/50769/comments","events_url":"https://api.github.com/repos/quarkusio/quarkus/issues/50769/events","html_url":"https://github.com/quarkusio/quarkus/issues/50769","id":3566648132,"node_id":"I_kwDOCFbutM7UlrtE","number":50769,"title":"Docker runtime not detected for Compose dev services","user":{"login":"LarsSven","id":60571459,"node_id":"MDQ6VXNlcjYwNTcxNDU5","avatar_url":"https://avatars.githubusercontent.com/u/60571459?v=4","gravatar_id":"","url":"https://api.github.com/users/LarsSven","html_url":"https://github.com/LarsSven","followers_url":"https://api.github.com/users/LarsSven/followers","following_url":"https://api.github.com/users/LarsSven/following{/other_user}","gists_url":"https://api.github.com/users/LarsSven/gists{/gist_id}","starred_url":"https://api.github.com/users/LarsSven/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/LarsSven/subscriptions","organizations_url":"https://api.github.com/users/LarsSven/orgs","repos_url":"https://api.github.com/users/LarsSven/repos","events_url":"https://api.github.com/users/LarsSven/events{/privacy}","received_events_url":"https://api.github.com/users/LarsSven/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":985346620,"node_id":"MDU6TGFiZWw5ODUzNDY2MjA=","url":"https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug","name":"kind/bug","color":"d73a4a","default":false,"description":"Something isn't working"},{"id":1891982257,"node_id":"MDU6TGFiZWwxODkxOTgyMjU3","url":"https://api.github.com/repos/quarkusio/quarkus/labels/area/container-image","name":"area/container-image","color":"0366d6","default":false,"description":""},{"id":2955097667,"node_id":"MDU6TGFiZWwyOTU1MDk3NjY3","url":"https://api.github.com/repos/quarkusio/quarkus/labels/area/devservices","name":"area/devservices","color":"0366d6","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/quarkusio/quarkus/milestones/450","html_url":"https://github.com/quarkusio/quarkus/milestone/450","labels_url":"https://api.github.com/repos/quarkusio/quarkus/milestones/450/labels","id":14054530,"node_id":"MI_kwDOCFbutM4A1nSC","number":450,"title":"3.29.1","description":"","creator":{"login":"gsmet","id":1279749,"node_id":"MDQ6VXNlcjEyNzk3NDk=","avatar_url":"https://avatars.githubusercontent.com/u/1279749?v=4","gravatar_id":"","url":"https://api.github.com/users/gsmet","html_url":"https://github.com/gsmet","followers_url":"https://api.github.com/users/gsmet/followers","following_url":"https://api.github.com/users/gsmet/following{/other_user}","gists_url":"https://api.github.com/users/gsmet/gists{/gist_id}","starred_url":"https://api.github.com/users/gsmet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gsmet/subscriptions","organizations_url":"https://api.github.com/users/gsmet/orgs","repos_url":"https://api.github.com/users/gsmet/repos","events_url":"https://api.github.com/users/gsmet/events{/privacy}","received_events_url":"https://api.github.com/users/gsmet/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":42,"state":"closed","created_at":"2025-11-05T08:40:00Z","updated_at":"2025-11-05T16:20:24Z","due_on":null,"closed_at":"2025-11-05T16:20:24Z"},"comments":13,"created_at":"2025-10-29T15:38:41Z","updated_at":"2025-11-05T08:46:23Z","closed_at":"2025-10-30T12:48:01Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\n\nWe are running into a bit of a weird bug in Quarkus. I admit that I don't fully understand why this bug is happening yet, but I'm a bit stuck so I thought I'd open a bug report and maybe the Quarkus team and my team can try to understand it together.\n\nWe recently started to use the Quarkus docker compose dev service to run some integration tests (basically our whole internal system is spun up as a docker compose setup).  This works locally, but when I then try to run it in the CI, where we know our docker setup works because normal Quarkus dev services that use testcontainers work perfectly fine, I get:\n> Build step io.quarkus.devservices.deployment.compose.ComposeDevServicesProcessor#config threw an exception: java.lang.IllegalStateException: No container runtime was found. Make sure you have either Docker or Podman installed in your environment.\n\nNow if you actually grab a few lines in the log, it becomes quite interesting:\n```\n    2025-10-29 15:08:26,877 INFO  [org.tes.doc.DockerClientProviderStrategy] (build-3) Found Docker environment with local Unix socket (unix:///var/run/docker.sock)\n    2025-10-29 15:08:26,912 INFO  [org.tes.DockerClientFactory] (build-3) Docker host IP address is 172.17.0.1\n    2025-10-29 15:08:26,950 INFO  [org.tes.DockerClientFactory] (build-3) Connected to docker: \n      Server Version: 27.3.1\n      API Version: 1.47\n      Operating System: Flatcar Container Linux by Kinvolk 4230.2.4 (Oklo)\n      Total Memory: 7941 MB\n    2025-10-29 15:08:26,969 INFO  [org.tes.ima.PullPolicy] (build-3) Image pull policy will be performed by: DefaultPullPolicy()\n    2025-10-29 15:08:26,972 INFO  [org.tes.uti.ImageNameSubstitutor] (build-3) Image name substitution will be performed by: DefaultImageNameSubstitutor (composite of 'ConfigurationFileImageNameSubstitutor' and 'PrefixingImageNameSubstitutor')\n    2025-10-29 15:08:26,980 INFO  [org.tes.DockerClientFactory] (build-3) Checking the system...\n    2025-10-29 15:08:26,981 INFO  [org.tes.DockerClientFactory] (build-3) ✔︎ Docker server version should be at least 1.6.0\nGradle Test Executor 8 STANDARD_ERROR\n    java.lang.RuntimeException: io.quarkus.builder.BuildException: Build failure: Build failed due to errors\n    \t[error]: Build step io.quarkus.devservices.deployment.compose.ComposeDevServicesProcessor#config threw an exception: java.lang.IllegalStateException: No container runtime was found. Make sure you have either Docker or Podman installed in your environment.\n```\n\nClearly Quarkus can find a working docker environment, because a few log lines earlier it literally says `Found Docker environment with local Unix socket (unix:///var/run/docker.sock)`, but the Docker compose docker detection seems  to be failing. And I am really struggling to understand why, because this locally works, and our CI docker setup is not that different from locally running this (it even mounts /var/lib/docker.sock rather than using a TCP endpoint).\n\nQuarkus Docker Compose works fine locally, and other Quarkus docker stuff works fine in our CI, it is purely the Quarkus docker compose that fails in the CI specifically.\n\n### Expected behavior\n\nQuarkus docker compose should be able to detect Docker in the same scenarios as othe Quarkus docker-dependent subsystems\n\n### Actual behavior\n\nThe docker runtime is specifically not found in our CI by the Quarkus Docker compose dev services, even though other dev services can find our docker runtime perfectly fine.\n\n### How to Reproduce?\n\nCI Job that fails: https://gitlab.com/rug-digitallab/products/themis/themis-core/-/jobs/11896925277\n\nHow to reproduce:\n1. Fork https://gitlab.com/rug-digitallab/products/themis/themis-core\n2. Look at `ls/256-integration-tests-for-quarkus-devs`, which is a modified version of the problem branch `ls/256-integration-tests` such that you can run the CI in a fork on the GitLab shared runners, since the integration tests would normally run on a private runner of ours.\n3. The CI job is expected to fail on GitLab shared runners (there's a reason we have it on our private runners), but it should fail longer after the spin-up of docker compose, so you should still be able to use it to debug.\n4. The unit-test job will contain the failures. Note that this job actually also tests other microservices that use normal dev services rather than the compose dev service, and they work perfectly fine in the same job, reinforcing the fact that it's something specific to the compose dev service.\n\n### Output of `uname -a` or `ver`\n\nContainer image of the CI: registry.access.redhat.com/ubi9/openjdk-21:1.23-6.1761164967\n\n### Output of `java -version`\n\nOpenJDK 21.0.8\n\n### Quarkus version or git rev\n\nQuarkus 3.28.4\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\nGradle 9.1\n\n### Additional information\n\n_No response_","closed_by":{"login":"gsmet","id":1279749,"node_id":"MDQ6VXNlcjEyNzk3NDk=","avatar_url":"https://avatars.githubusercontent.com/u/1279749?v=4","gravatar_id":"","url":"https://api.github.com/users/gsmet","html_url":"https://github.com/gsmet","followers_url":"https://api.github.com/users/gsmet/followers","following_url":"https://api.github.com/users/gsmet/following{/other_user}","gists_url":"https://api.github.com/users/gsmet/gists{/gist_id}","starred_url":"https://api.github.com/users/gsmet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gsmet/subscriptions","organizations_url":"https://api.github.com/users/gsmet/orgs","repos_url":"https://api.github.com/users/gsmet/repos","events_url":"https://api.github.com/users/gsmet/events{/privacy}","received_events_url":"https://api.github.com/users/gsmet/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/quarkusio/quarkus/issues/50769/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/quarkusio/quarkus/issues/50769/timeline","performed_via_github_app":null,"state_reason":"completed"}