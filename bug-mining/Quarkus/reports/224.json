{"url":"https://api.github.com/repos/quarkusio/quarkus/issues/47670","repository_url":"https://api.github.com/repos/quarkusio/quarkus","labels_url":"https://api.github.com/repos/quarkusio/quarkus/issues/47670/labels{/name}","comments_url":"https://api.github.com/repos/quarkusio/quarkus/issues/47670/comments","events_url":"https://api.github.com/repos/quarkusio/quarkus/issues/47670/events","html_url":"https://github.com/quarkusio/quarkus/issues/47670","id":3036968000,"node_id":"I_kwDOCFbutM61BHRA","number":47670,"title":"[SmallRye Messaging] - Backpressure support via @OnOverflow broken after upgrading to Quarkus 3.22.x","user":{"login":"ricardozanini","id":1538000,"node_id":"MDQ6VXNlcjE1MzgwMDA=","avatar_url":"https://avatars.githubusercontent.com/u/1538000?v=4","gravatar_id":"","url":"https://api.github.com/users/ricardozanini","html_url":"https://github.com/ricardozanini","followers_url":"https://api.github.com/users/ricardozanini/followers","following_url":"https://api.github.com/users/ricardozanini/following{/other_user}","gists_url":"https://api.github.com/users/ricardozanini/gists{/gist_id}","starred_url":"https://api.github.com/users/ricardozanini/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ricardozanini/subscriptions","organizations_url":"https://api.github.com/users/ricardozanini/orgs","repos_url":"https://api.github.com/users/ricardozanini/repos","events_url":"https://api.github.com/users/ricardozanini/events{/privacy}","received_events_url":"https://api.github.com/users/ricardozanini/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":985346620,"node_id":"MDU6TGFiZWw5ODUzNDY2MjA=","url":"https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug","name":"kind/bug","color":"d73a4a","default":false,"description":"Something isn't working"},{"id":1283619446,"node_id":"MDU6TGFiZWwxMjgzNjE5NDQ2","url":"https://api.github.com/repos/quarkusio/quarkus/labels/area/smallrye","name":"area/smallrye","color":"0366d6","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/quarkusio/quarkus/milestones/401","html_url":"https://github.com/quarkusio/quarkus/milestone/401","labels_url":"https://api.github.com/repos/quarkusio/quarkus/milestones/401/labels","id":12889431,"node_id":"MI_kwDOCFbutM4AxK1X","number":401,"title":"3.22.3","description":"","creator":{"login":"gsmet","id":1279749,"node_id":"MDQ6VXNlcjEyNzk3NDk=","avatar_url":"https://avatars.githubusercontent.com/u/1279749?v=4","gravatar_id":"","url":"https://api.github.com/users/gsmet","html_url":"https://github.com/gsmet","followers_url":"https://api.github.com/users/gsmet/followers","following_url":"https://api.github.com/users/gsmet/following{/other_user}","gists_url":"https://api.github.com/users/gsmet/gists{/gist_id}","starred_url":"https://api.github.com/users/gsmet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gsmet/subscriptions","organizations_url":"https://api.github.com/users/gsmet/orgs","repos_url":"https://api.github.com/users/gsmet/repos","events_url":"https://api.github.com/users/gsmet/events{/privacy}","received_events_url":"https://api.github.com/users/gsmet/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":43,"state":"closed","created_at":"2025-05-13T21:34:37Z","updated_at":"2025-08-13T11:32:49Z","due_on":null,"closed_at":"2025-05-14T12:05:20Z"},"comments":4,"created_at":"2025-05-02T23:15:40Z","updated_at":"2025-05-13T21:40:49Z","closed_at":"2025-05-13T16:59:46Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\n\nHi!\n\nAfter bumping the Quarkus Reactive Messaging HTTP extension (https://github.com/quarkiverse/quarkus-reactive-messaging-http) from Quarkus 3.21.x → 3.22.1, all of the sink backpressure tests annotated with `@OnOverflow` are failing. In particular, in:\n\nhttps://github.com/quarkiverse/quarkus-reactive-messaging-http/blob/2.5.0/deployment/src/test/java/io/quarkus/reactivemessaging/http/sink/HttpSinkBackpressureTest.java#L43\n\nand\n\nhttps://github.com/quarkiverse/quarkus-reactive-messaging-http/blob/2.5.0/deployment/src/test/java/io/quarkus/reactivemessaging/http/sink/HttpSinkBackpressureTest.java#L58\n\nThe configured buffer sizes and `THROW_EXCEPTION` strategies are simply ignored, so emissions either block forever or succeed unbounded instead of triggering overflow.\n\n\n\n### Expected behavior\n\nAn emitter declared as\n\n```java\n@Channel(\"my-http-sink\")\n@OnOverflow(Strategy.THROW_EXCEPTION)\nEmitter<Object> emitterThrowingOnOverflow;\n```\n\nshould immediately fail the second `send()`, and an emitter declared with\n\n```java\n@Channel(\"my-http-sink2\")\n@OnOverflow(value = Strategy.BUFFER, bufferSize = 10)\nEmitter<Object> emitterBufferingOnOverflow;\n```\n\nshould buffer exactly 10 in-flight messages (1 in progress + 10 queued), then reject the 12th.\n\n\n### Actual behavior\n\n- The “throw on overflow” emitter does not throw on the second send.\n- The “buffer up to 10” emitter accepts all 12 sends, draining only as the test releases the endpoint.\n- Inspection shows the `buffer-size` annotation isn’t being picked up from MicroProfile config (it always falls back to the default).\n\n### How to Reproduce?\n\n1. Clone the [v2.5.0 tag of the extension](https://github.com/quarkiverse/quarkus-reactive-messaging-http/tree/2.5.0).\n2. In the root `pom.xml`, set Quarkus BOM to 3.22.1.\n3. Run the failing tests in `deployment/src/test/java/.../HttpSinkBackpressureTest.java`.\n\n\n\n### Output of `uname -a` or `ver`\n\nDarwin 24.4.0 Darwin Kernel Version 24.4.0: Fri Apr 11 18:33:47 PDT 2025; root:xnu-11417.101.15~117/RELEASE_ARM64_T6030 arm64\n\n### Output of `java -version`\n\nopenjdk version \"17.0.9\" 2023-10-17 OpenJDK Runtime Environment GraalVM CE 17.0.9+9.1 (build 17.0.9+9-jvmci-23.0-b22) OpenJDK 64-Bit Server VM GraalVM CE 17.0.9+9.1 (build 17.0.9+9-jvmci-23.0-b22, mixed mode, sharing)\n\n### Quarkus version or git rev\n\n3.22.1\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\nApache Maven 3.9.9 (8e8579a9e76f7d015ee5ec7bfcdc97d260186937) Maven home: /opt/homebrew/Cellar/maven/3.9.9/libexec Java version: 17.0.9, vendor: GraalVM Community, runtime: /Users/ricferna/.sdkman/candidates/java/17.0.9-graalce Default locale: en_CA, platform encoding: UTF-8 OS name: \"mac os x\", version: \"15.4.1\", arch: \"aarch64\", family: \"mac\"\n\n### Additional information\n\nI verified that everything works normally on Quarkus 3.21.x but fails immediately after upgrading to 3.22.1. My investigation pointed at the shared-context rewrite in https://github.com/quarkusio/quarkus/pull/46174. I’m happy to supply a minimal reproducer or pair on a fix.\n\n","closed_by":{"login":"gsmet","id":1279749,"node_id":"MDQ6VXNlcjEyNzk3NDk=","avatar_url":"https://avatars.githubusercontent.com/u/1279749?v=4","gravatar_id":"","url":"https://api.github.com/users/gsmet","html_url":"https://github.com/gsmet","followers_url":"https://api.github.com/users/gsmet/followers","following_url":"https://api.github.com/users/gsmet/following{/other_user}","gists_url":"https://api.github.com/users/gsmet/gists{/gist_id}","starred_url":"https://api.github.com/users/gsmet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gsmet/subscriptions","organizations_url":"https://api.github.com/users/gsmet/orgs","repos_url":"https://api.github.com/users/gsmet/repos","events_url":"https://api.github.com/users/gsmet/events{/privacy}","received_events_url":"https://api.github.com/users/gsmet/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/quarkusio/quarkus/issues/47670/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/quarkusio/quarkus/issues/47670/timeline","performed_via_github_app":null,"state_reason":"completed"}