{"url":"https://api.github.com/repos/quarkusio/quarkus/issues/47275","repository_url":"https://api.github.com/repos/quarkusio/quarkus","labels_url":"https://api.github.com/repos/quarkusio/quarkus/issues/47275/labels{/name}","comments_url":"https://api.github.com/repos/quarkusio/quarkus/issues/47275/comments","events_url":"https://api.github.com/repos/quarkusio/quarkus/issues/47275/events","html_url":"https://github.com/quarkusio/quarkus/issues/47275","id":2983548639,"node_id":"I_kwDOCFbutM6x1Vbf","number":47275,"title":"@Nested of Junit5 not working with @QuarkusComponentTest: Bean CDI is removed in compilation time","user":{"login":"RayanArgolo03","id":113947677,"node_id":"U_kgDOBsq0HQ","avatar_url":"https://avatars.githubusercontent.com/u/113947677?v=4","gravatar_id":"","url":"https://api.github.com/users/RayanArgolo03","html_url":"https://github.com/RayanArgolo03","followers_url":"https://api.github.com/users/RayanArgolo03/followers","following_url":"https://api.github.com/users/RayanArgolo03/following{/other_user}","gists_url":"https://api.github.com/users/RayanArgolo03/gists{/gist_id}","starred_url":"https://api.github.com/users/RayanArgolo03/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RayanArgolo03/subscriptions","organizations_url":"https://api.github.com/users/RayanArgolo03/orgs","repos_url":"https://api.github.com/users/RayanArgolo03/repos","events_url":"https://api.github.com/users/RayanArgolo03/events{/privacy}","received_events_url":"https://api.github.com/users/RayanArgolo03/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":985346620,"node_id":"MDU6TGFiZWw5ODUzNDY2MjA=","url":"https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug","name":"kind/bug","color":"d73a4a","default":false,"description":"Something isn't working"},{"id":1282102389,"node_id":"MDU6TGFiZWwxMjgyMTAyMzg5","url":"https://api.github.com/repos/quarkusio/quarkus/labels/area/arc","name":"area/arc","color":"0366d6","default":false,"description":"Issue related to ARC (dependency injection)"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/quarkusio/quarkus/milestones/394","html_url":"https://github.com/quarkusio/quarkus/milestone/394","labels_url":"https://api.github.com/repos/quarkusio/quarkus/milestones/394/labels","id":12736625,"node_id":"MI_kwDOCFbutM4Awlhx","number":394,"title":"3.21.3","description":"","creator":{"login":"gsmet","id":1279749,"node_id":"MDQ6VXNlcjEyNzk3NDk=","avatar_url":"https://avatars.githubusercontent.com/u/1279749?v=4","gravatar_id":"","url":"https://api.github.com/users/gsmet","html_url":"https://github.com/gsmet","followers_url":"https://api.github.com/users/gsmet/followers","following_url":"https://api.github.com/users/gsmet/following{/other_user}","gists_url":"https://api.github.com/users/gsmet/gists{/gist_id}","starred_url":"https://api.github.com/users/gsmet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gsmet/subscriptions","organizations_url":"https://api.github.com/users/gsmet/orgs","repos_url":"https://api.github.com/users/gsmet/repos","events_url":"https://api.github.com/users/gsmet/events{/privacy}","received_events_url":"https://api.github.com/users/gsmet/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":25,"state":"closed","created_at":"2025-04-15T15:38:22Z","updated_at":"2025-08-13T11:26:47Z","due_on":null,"closed_at":"2025-04-16T11:08:12Z"},"comments":1,"created_at":"2025-04-09T18:18:20Z","updated_at":"2025-04-15T15:40:12Z","closed_at":"2025-04-10T09:55:47Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\n\n**When performing tests in IntelliJIdea with @Nested classes and @QuarkusComponentTest annotation then @Inject Bean CDI is removed of the context even being used in methods**\n\n_MY CODE:_\n \n```\n@QuarkusComponentTest\n@DisplayName(\"--- Authentication service tests ---\")\npublic class AuthenticationServiceTest {\n\n    @Inject\n    AuthenticationService service;\n\n    @InjectMock\n    CredentialRepository credentialRepository;\n\n    @InjectMock\n    ForgotPasswordRepository forgotPasswordRepository;\n\n    @InjectMock\n    CredentialMapper credentialMapper = Mappers.getMapper(CredentialMapper.class);\n\n    @InjectMock\n    ForgotPasswordMapper forgotPasswordMapper = Mappers.getMapper(ForgotPasswordMapper.class);\n\n    Validator hibernateValidator = Validation.buildDefaultValidatorFactory().getValidator();\n\n    @Nested\n    @DisplayName(\"--- CredentialRequest tests \")\n    class CredentialRequestTests {\n\n        @Test\n        @DisplayName(\"Must have one violation when email is null\")\n        void givenPersistCredential_whenEmailIsNull_thenThrowConstraintViolationException() {\n\n            final String password = \"#Rayan12\";\n            final CredentialRequest request = new CredentialRequest(new EmailRequest(null), password);\n\n            final Set<ConstraintViolation<CredentialRequest>> violations = hibernateValidator.validate(request);\n\n            final String message = violations.iterator().next().getMessage(),\n                    expectedMessage = \"Email required!\";\n\n            final int size = violations.size(),\n                    expectedSize = 1;\n\n            assertEquals(expectedSize, violations.size());\n            assertEquals(expectedMessage, message);\n\n        }\n\n        @ParameterizedTest\n        @ValueSource(strings = {\n                \"\", \" \", \"plainaddress\", \"@missingusername.com\", \"username@.com\", \"username@.com.\", \"username@domain..com\",\n                \"username@domain.c\", \"username@domain.toolong\", \"username@domain,com\", \"username@domain@domain.com\",\n                \"username@domain..com\", \"username@domain.com (Joe Smith)\", \"username@domain.com.\", \"username@domain.com-\",\n                \"username@domain.com_\", \"username@domain.com+\", \"username@domain.com%\", \"username@domain.com#\",\n                \"username@domain.com$\", \"username@domain.com!\", \"username@domain.com^\", \"username@domain.com&\",\n                \"username@domain.com*\", \"username@domain.com(\", \"username@domain.com)\", \"username@domain.com=\",\n                \"username@domain.com{\", \"username@domain.com}\", \"username@domain.com[\", \"username@domain.com]\"\n        })\n        @DisplayName(\"Must have one violation when email is invalid in pattern xxx@domain.com\")\n        void givenPersistCredential_whenEmailIsInvalid_thenThrowConstraintViolationException(@SkipInject final String email) {\n\n            final String password = \"#Rayan12\";\n            final CredentialRequest request = new CredentialRequest(new EmailRequest(email), password);\n\n            final Set<ConstraintViolation<CredentialRequest>> violations = hibernateValidator.validate(request);\n\n            final String message = violations.iterator().next().getMessage(),\n                    expectedMessage = \"Invalid email! Pattern required: xxx@domain.com\";\n\n            final int size = violations.size(),\n                    expectedSize = 1;\n\n            assertEquals(expectedSize, size);\n            assertEquals(expectedMessage, message);\n\n        }\n\n        @Test\n        @DisplayName(\"Must have one violation when password is null\")\n        void givenPersistCredential_whenPasswordIsNull_thenThrowConstraintViolationException() {\n\n            final String email = \"admin@gmail.com\";\n            final CredentialRequest request = new CredentialRequest(new EmailRequest(email), null);\n\n            final Set<ConstraintViolation<CredentialRequest>> violations = hibernateValidator.validate(request);\n\n            final String message = violations.iterator().next().getMessage(),\n                    expectedMessage = \"Password required!\";\n\n            final int size = violations.size(),\n                    expectedSize = 1;\n\n            assertEquals(expectedSize, size);\n            assertEquals(expectedMessage, message);\n        }\n\n        @ParameterizedTest\n        @ValueSource(strings = {\n                \"abcde\", \"ABCDE\", \"12345\", \"abc123\", \"ABC123\", \"abc!@#\", \"123!@#\", \"abcABC\", \"abcABC123\",\n                \"abcABC!@#\", \"123ABC!@#\", \"abc123!@#\", \"abcABC123!@#\", \"abcdE\", \"abcdE1\",\n                \"abcdE1!@#\", \"abcdE1!@#2\", \"abcdE1!@#23\", \"abcdE1!@#234\", \"abcdE1!@#2345\", \"abcdE1!@#23456\", \"abcdE1!@#234567\",\n                \"abcdE1!@#2345678\", \"abcdE1!@#23456789\", \"abcdE1!@#234567890\", \"abcdE1!@#2345678901\"\n        })\n        @DisplayName(\"Must have one violation when password is invalid in pattern '5 and 8 characters, at least 1 special character and a capital letter'\")\n        void givenPersistCredential_whenPasswordIsInvalid_thenThrowConstraintViolationException(@SkipInject final String password) {\n\n            final String email = \"admin@gmail.com\";\n            final CredentialRequest request = new CredentialRequest(new EmailRequest(email), password);\n\n            final Set<ConstraintViolation<CredentialRequest>> violations = hibernateValidator.validate(request);\n\n            final String message = violations.iterator().next().getMessage(),\n                    expectedMessage = \"Invalid password! Between 5 and 8 characters, at least 1 special character and a capital letter!\";\n\n            final int size = violations.size(),\n                    expectedSize = 1;\n\n            assertEquals(expectedSize, size);\n            assertEquals(expectedMessage, message);\n\n        }\n    }\n\n\n    @Nested\n    @DisplayName(\"---- Persist credential tests ----\")\n    class PersistCredentialTests {\n\n        CredentialRequest request;\n\n        @BeforeEach\n        void setUp() {\n            request = new CredentialRequest(new EmailRequest(\"admin@gmail.com\"), \"#Admin12\");\n        }\n\n        @Test\n        @DisplayName(\"Should be throw WebApplicationException with status code 409 Conflict when email already exists\")\n        void givenPersistCredential_whenRequestEmailIsPresent_thenThrowWebApplicationException() {\n\n            final Credential credential = new Credential();\n\n            when(credentialRepository.findCredentialByEmail(request.emailRequest().email()))\n                    .thenReturn(Optional.of(credential));\n\n            final WebApplicationException e = assertThrows(WebApplicationException.class,\n                    () -> service.persistCredential(request));\n\n            final String expectedMessage = format(\"Client with email %s already exists!\", request.emailRequest().email());\n            final Response.Status expectedStatusCode = CONFLICT;\n\n            assertEquals(expectedMessage, e.getMessage());\n            assertEquals(expectedStatusCode, e.getResponse().getStatusInfo().toEnum());\n\n            verify(credentialRepository, times(1)).findCredentialByEmail(request.emailRequest().email());\n        }\n\n        @Test\n        @DisplayName(\"Should persist and return CredentialResponse when request is valid\")\n        void givenPersistCredential_whenRequestIsValid_thenPersistAndReturnCredentialResponse() {\n\n            final Credential credential = Credential.builder()\n                    .id(UUID.randomUUID())\n                    .email(request.emailRequest().email())\n                    .password(CryptographyUtils.encrypt(request.password()))\n                    .build();\n\n            final CredentialResponse expectedResponse = CredentialResponse.builder()\n                    .id(credential.getId())\n                    .email(credential.getEmail())\n                    .password(credential.getPassword())\n                    .createdAt(credential.getCreatedAt())\n                    .keycloakUserId(null)\n                    .build();\n\n            when(credentialRepository.findCredentialByEmail(request.emailRequest().email()))\n                    .thenReturn(Optional.empty());\n\n            when(credentialMapper.requestToCredential(request)).thenReturn(credential);\n            doNothing().when(credentialRepository).persist(credential);\n            when(credentialMapper.credentialToResponse(credential)).thenReturn(expectedResponse);\n\n            final CredentialResponse response = service.persistCredential(request);\n\n            assertEquals(response, expectedResponse);\n\n            verify(credentialRepository).findCredentialByEmail(request.emailRequest().email());\n            verify(credentialMapper).requestToCredential(request);\n            verify(credentialRepository).persist(credential);\n            verify(credentialMapper).credentialToResponse(credential);\n        }\n    }\n\n```\n\n_EXCEPTION TRACE_\n```\njava.lang.IllegalStateException: The injected field [dev.rayan.services.AuthenticationService dev.rayan.services.AuthenticationServiceTest.service] expects a real component; but no matching component was registered\n\n\tat io.quarkus.test.component.QuarkusComponentTestExtension$FieldInjector.<init>(QuarkusComponentTestExtension.java:1169)\n\tat io.quarkus.test.component.QuarkusComponentTestExtension.injectFields(QuarkusComponentTestExtension.java:1055)\n\tat io.quarkus.test.component.QuarkusComponentTestExtension.startContainer(QuarkusComponentTestExtension.java:501)\n\tat io.quarkus.test.component.QuarkusComponentTestExtension.beforeEach(QuarkusComponentTestExtension.java:237)\n\tat java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:183)\n\tat java.base/java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:197)\n\tat java.base/java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:179)\n\tat java.base/java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:197)\n\tat java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:183)\n\tat java.base/java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:197)\n\tat java.base/java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:197)\n\tat java.base/java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:197)\n\tat java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:183)\n\tat java.base/java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:197)\n\tat java.base/java.util.Spliterators$ArraySpliterator.forEachRemaining(Spliterators.java:992)\n\tat java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:509)\n\tat java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)\n\tat java.base/java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:150)\n\tat java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:173)\n\tat java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)\n\tat java.base/java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:596)\n\tat java.base/java.util.stream.ReferencePipeline$7$1.accept(ReferencePipeline.java:276)\n\tat java.base/java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:197)\n\tat java.base/java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:197)\n\tat java.base/java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:197)\n\tat java.base/java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1625)\n\tat java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:509)\n\tat java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)\n\tat java.base/java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:150)\n\tat java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:173)\n\tat java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)\n\tat java.base/java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:596)\n\tat java.base/java.util.stream.ReferencePipeline$7$1.accept(ReferencePipeline.java:276)\n\tat java.base/java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1625)\n\tat java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:509)\n\tat java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)\n\tat java.base/java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:150)\n\tat java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:173)\n\tat java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)\n\tat java.base/java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:596)\n\tat java.base/java.util.ArrayList.forEach(ArrayList.java:1511)\n\tat java.base/java.util.ArrayList.forEach(ArrayList.java:1511)\n\tat java.base/java.util.ArrayList.forEach(ArrayList.java:1511)\n```\n\n_THE WARNING_\n\n![Image](https://github.com/user-attachments/assets/85c00e99-1a73-49c0-b5fc-1979c7be82e5)\n\n\n### Expected behavior\n\nMethods correctly executed with @Nested Junit5 classes\n\n### Actual behavior\n\nException throwning. @Unremoavable in beans is necessary: https://pt.quarkus.io/blog/unused-beans/\n\n### How to Reproduce?\n\n_No response_\n\n### Output of `uname -a` or `ver`\n\n_No response_\n\n### Output of `java -version`\n\nQuarkus 22\n\n### Quarkus version or git rev\n\n_No response_\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\nMaven 3.13\n\n### Additional information\n\n_No response_","closed_by":{"login":"mkouba","id":913004,"node_id":"MDQ6VXNlcjkxMzAwNA==","avatar_url":"https://avatars.githubusercontent.com/u/913004?v=4","gravatar_id":"","url":"https://api.github.com/users/mkouba","html_url":"https://github.com/mkouba","followers_url":"https://api.github.com/users/mkouba/followers","following_url":"https://api.github.com/users/mkouba/following{/other_user}","gists_url":"https://api.github.com/users/mkouba/gists{/gist_id}","starred_url":"https://api.github.com/users/mkouba/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mkouba/subscriptions","organizations_url":"https://api.github.com/users/mkouba/orgs","repos_url":"https://api.github.com/users/mkouba/repos","events_url":"https://api.github.com/users/mkouba/events{/privacy}","received_events_url":"https://api.github.com/users/mkouba/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/quarkusio/quarkus/issues/47275/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/quarkusio/quarkus/issues/47275/timeline","performed_via_github_app":null,"state_reason":"completed"}