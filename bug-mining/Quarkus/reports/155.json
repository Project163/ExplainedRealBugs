{"url":"https://api.github.com/repos/quarkusio/quarkus/issues/45173","repository_url":"https://api.github.com/repos/quarkusio/quarkus","labels_url":"https://api.github.com/repos/quarkusio/quarkus/issues/45173/labels{/name}","comments_url":"https://api.github.com/repos/quarkusio/quarkus/issues/45173/comments","events_url":"https://api.github.com/repos/quarkusio/quarkus/issues/45173/events","html_url":"https://github.com/quarkusio/quarkus/issues/45173","id":2745034661,"node_id":"I_kwDOCFbutM6jneel","number":45173,"title":"Unable to use custom handlers for HTTP OPTIONS method in subresources","user":{"login":"mabartos","id":38039883,"node_id":"MDQ6VXNlcjM4MDM5ODgz","avatar_url":"https://avatars.githubusercontent.com/u/38039883?v=4","gravatar_id":"","url":"https://api.github.com/users/mabartos","html_url":"https://github.com/mabartos","followers_url":"https://api.github.com/users/mabartos/followers","following_url":"https://api.github.com/users/mabartos/following{/other_user}","gists_url":"https://api.github.com/users/mabartos/gists{/gist_id}","starred_url":"https://api.github.com/users/mabartos/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mabartos/subscriptions","organizations_url":"https://api.github.com/users/mabartos/orgs","repos_url":"https://api.github.com/users/mabartos/repos","events_url":"https://api.github.com/users/mabartos/events{/privacy}","received_events_url":"https://api.github.com/users/mabartos/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":985346620,"node_id":"MDU6TGFiZWw5ODUzNDY2MjA=","url":"https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug","name":"kind/bug","color":"d73a4a","default":false,"description":"Something isn't working"},{"id":2552031458,"node_id":"MDU6TGFiZWwyNTUyMDMxNDU4","url":"https://api.github.com/repos/quarkusio/quarkus/labels/area/rest","name":"area/rest","color":"0366d6","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/quarkusio/quarkus/milestones/372","html_url":"https://github.com/quarkusio/quarkus/milestone/372","labels_url":"https://api.github.com/repos/quarkusio/quarkus/milestones/372/labels","id":12181460,"node_id":"MI_kwDOCFbutM4Aud_U","number":372,"title":"3.15.4","description":"","creator":{"login":"gsmet","id":1279749,"node_id":"MDQ6VXNlcjEyNzk3NDk=","avatar_url":"https://avatars.githubusercontent.com/u/1279749?v=4","gravatar_id":"","url":"https://api.github.com/users/gsmet","html_url":"https://github.com/gsmet","followers_url":"https://api.github.com/users/gsmet/followers","following_url":"https://api.github.com/users/gsmet/following{/other_user}","gists_url":"https://api.github.com/users/gsmet/gists{/gist_id}","starred_url":"https://api.github.com/users/gsmet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gsmet/subscriptions","organizations_url":"https://api.github.com/users/gsmet/orgs","repos_url":"https://api.github.com/users/gsmet/repos","events_url":"https://api.github.com/users/gsmet/events{/privacy}","received_events_url":"https://api.github.com/users/gsmet/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":105,"state":"closed","created_at":"2025-01-17T08:42:44Z","updated_at":"2025-07-09T16:36:56Z","due_on":null,"closed_at":"2025-03-11T14:00:10Z"},"comments":6,"created_at":"2024-12-17T14:05:03Z","updated_at":"2025-02-20T12:20:47Z","closed_at":"2024-12-18T12:01:11Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\n\n[**Breaking change in 3.15.2 minor release**]\n\nAfter merging https://github.com/quarkusio/quarkus/pull/43440, we (Keycloak) are not able to use our custom logic for handling the HTTP OPTIONS method in Quarkus REST subresources. When there's an HTTP request with the OPTIONS method made for a subresource that does not explicitly contain a handler annotated with `@OPTIONS`, [default values](https://github.com/quarkusio/quarkus/blob/main/independent-projects/resteasy-reactive/server/runtime/src/main/java/org/jboss/resteasy/reactive/server/handlers/ResourceLocatorHandler.java#L69) are immediately returned. However, when some specific handlers are nested deeper in subresources, they are not taken into account. \n\nPreviously, all subresources were traversed and checked whether they contain the handler for `@HEAD`, and `@OPTIONS` HTTP methods.\n\n\n\n\n\n### Expected behavior\n\nUse custom nested handlers for `@OPTIONS` and `@HEAD` HTTP methods. \n\n### Actual behavior\n\nNOT POSSIBLE to use custom nested handlers for `@OPTIONS` and `@HEAD` HTTP methods. \n\n### How to Reproduce?\n\n1. Have custom handlers for `OPTIONS` and `HEAD` methods in sub-resources\n2. Make an OPTIONS/HEAD HTTP request for them, or leverage preflight logic\n3. See the custom handler is not executed, but some default response is returned\n\n### Output of `uname -a` or `ver`\n\nLinux mabartos 6.11.9-100.fc39.x86_64 #1 SMP PREEMPT_DYNAMIC Sun Nov 17 18:52:19 UTC 2024 x86_64 GNU/Linux\n\n### Output of `java -version`\n\nopenjdk 21.0.3 2024-04-16 LTS OpenJDK Runtime Environment Temurin-21.0.3+9 (build 21.0.3+9-LTS) OpenJDK 64-Bit Server VM Temurin-21.0.3+9 (build 21.0.3+9-LTS, mixed mode, sharing)\n\n### Quarkus version or git rev\n\n3.15.2\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\nMaven 3.9.8\n\n### Additional information\n\nI'll provide a PR for this. \n\n_Maybe it would be good to go through the same case in the `ClassRoutingHandler` containing also the default mechanisms for OPTIONS/HEAD. But it's out of scope of this issue._","closed_by":{"login":"geoand","id":4374975,"node_id":"MDQ6VXNlcjQzNzQ5NzU=","avatar_url":"https://avatars.githubusercontent.com/u/4374975?v=4","gravatar_id":"","url":"https://api.github.com/users/geoand","html_url":"https://github.com/geoand","followers_url":"https://api.github.com/users/geoand/followers","following_url":"https://api.github.com/users/geoand/following{/other_user}","gists_url":"https://api.github.com/users/geoand/gists{/gist_id}","starred_url":"https://api.github.com/users/geoand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/geoand/subscriptions","organizations_url":"https://api.github.com/users/geoand/orgs","repos_url":"https://api.github.com/users/geoand/repos","events_url":"https://api.github.com/users/geoand/events{/privacy}","received_events_url":"https://api.github.com/users/geoand/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/quarkusio/quarkus/issues/45173/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/quarkusio/quarkus/issues/45173/timeline","performed_via_github_app":null,"state_reason":"completed"}