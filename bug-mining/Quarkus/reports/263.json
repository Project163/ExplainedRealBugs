{"url":"https://api.github.com/repos/quarkusio/quarkus/issues/50144","repository_url":"https://api.github.com/repos/quarkusio/quarkus","labels_url":"https://api.github.com/repos/quarkusio/quarkus/issues/50144/labels{/name}","comments_url":"https://api.github.com/repos/quarkusio/quarkus/issues/50144/comments","events_url":"https://api.github.com/repos/quarkusio/quarkus/issues/50144/events","html_url":"https://github.com/quarkusio/quarkus/issues/50144","id":3430554335,"node_id":"I_kwDOCFbutM7Mehrf","number":50144,"title":"Panache repository breaks when narrowing the generic of a subclass","user":{"login":"LarsSven","id":60571459,"node_id":"MDQ6VXNlcjYwNTcxNDU5","avatar_url":"https://avatars.githubusercontent.com/u/60571459?v=4","gravatar_id":"","url":"https://api.github.com/users/LarsSven","html_url":"https://github.com/LarsSven","followers_url":"https://api.github.com/users/LarsSven/followers","following_url":"https://api.github.com/users/LarsSven/following{/other_user}","gists_url":"https://api.github.com/users/LarsSven/gists{/gist_id}","starred_url":"https://api.github.com/users/LarsSven/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/LarsSven/subscriptions","organizations_url":"https://api.github.com/users/LarsSven/orgs","repos_url":"https://api.github.com/users/LarsSven/repos","events_url":"https://api.github.com/users/LarsSven/events{/privacy}","received_events_url":"https://api.github.com/users/LarsSven/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":985346620,"node_id":"MDU6TGFiZWw5ODUzNDY2MjA=","url":"https://api.github.com/repos/quarkusio/quarkus/labels/kind/bug","name":"kind/bug","color":"d73a4a","default":false,"description":"Something isn't working"},{"id":1273026134,"node_id":"MDU6TGFiZWwxMjczMDI2MTM0","url":"https://api.github.com/repos/quarkusio/quarkus/labels/area/panache","name":"area/panache","color":"0366d6","default":false,"description":""},{"id":1287515315,"node_id":"MDU6TGFiZWwxMjg3NTE1MzE1","url":"https://api.github.com/repos/quarkusio/quarkus/labels/area/kotlin","name":"area/kotlin","color":"0366d6","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/quarkusio/quarkus/milestones/437","html_url":"https://github.com/quarkusio/quarkus/milestone/437","labels_url":"https://api.github.com/repos/quarkusio/quarkus/milestones/437/labels","id":13650346,"node_id":"MI_kwDOCFbutM4A0Emq","number":437,"title":"3.29.0.CR1","description":"","creator":{"login":"quarkusbot","id":61254497,"node_id":"MDQ6VXNlcjYxMjU0NDk3","avatar_url":"https://avatars.githubusercontent.com/u/61254497?v=4","gravatar_id":"","url":"https://api.github.com/users/quarkusbot","html_url":"https://github.com/quarkusbot","followers_url":"https://api.github.com/users/quarkusbot/followers","following_url":"https://api.github.com/users/quarkusbot/following{/other_user}","gists_url":"https://api.github.com/users/quarkusbot/gists{/gist_id}","starred_url":"https://api.github.com/users/quarkusbot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/quarkusbot/subscriptions","organizations_url":"https://api.github.com/users/quarkusbot/orgs","repos_url":"https://api.github.com/users/quarkusbot/repos","events_url":"https://api.github.com/users/quarkusbot/events{/privacy}","received_events_url":"https://api.github.com/users/quarkusbot/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":164,"state":"closed","created_at":"2025-09-10T05:16:40Z","updated_at":"2025-10-21T21:28:26Z","due_on":null,"closed_at":"2025-10-15T20:45:14Z"},"comments":15,"created_at":"2025-09-18T14:07:42Z","updated_at":"2025-10-02T07:30:46Z","closed_at":"2025-10-02T07:30:43Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\n\nI am not 100% sure what is going on here. I suspect it is a bug in Quarkus but I can't be 100% sure (the error message is definitely not correct though).\n\nWe use a setup where we have our own generic panache base repository, which inherits/extends the Quarkus provided panache base repository, and is then implemented by concrete repositories. A logical implementation of the intermediate layer is:\n```kotlin\nabstract class BaseRepository<EntityT : Any, IdT: Any> : PanacheRepositoryBase<EntityT, IdT>\n```\n\nWhich indeed works perfectly fine. However, we now need something like this:\n```kotlin\nabstract class BaseRepository<EntityT : Any, IdT: UUIDWrapper> : PanacheRepositoryBase<EntityT, UUID>\n```\n\nAnd this suddenly breaks, with:\n```\nCaused by: java.lang.IllegalStateException: This method is normally automatically overridden in subclasses: did you forget to annotate your entity with @Entity?\n\tat io.quarkus.hibernate.orm.panache.common.runtime.AbstractJpaOperations.implementationInjectionMissing(AbstractJpaOperations.java:452)\n\tat io.quarkus.hibernate.orm.panache.kotlin.PanacheRepositoryBase.findById(PanacheRepositoryBase.kt:95)\n\tat nl.rug.digitallab.BrokenBaseRepository.findById(Reproducer.kt:36)\n\tat nl.rug.digitallab.BrokenBaseRepository.findById(Reproducer.kt:36)\n\tat nl.rug.digitallab.BrokenBaseRepository.findByIdOrThrow(Reproducer.kt:40)\n\tat nl.rug.digitallab.BrokenAssignmentRepository.findByIdOrThrow(Reproducer.kt:46)\n\tat nl.rug.digitallab.BrokenAssignmentRepository_ClientProxy.findByIdOrThrow(Unknown Source)\n\tat Reproducer.This breaks for some reason(Reproducer.kt:32)\n```\n\nEven though we did not change the entity at all.\n\nI tried to make a toy reproducer that has the minimal number of changes with the two to see where it breaks, and taking the exact same implementation, but changing\n```kotlin\nabstract class BaseRepository<EntityT : Any, IdT: Any> : PanacheRepositoryBase<EntityT, IdT>\n```\n\nby this (with making no other changes):\n\n```kotlin\nabstract class BaseRepository<EntityT : Any, IdT: UUID> : PanacheRepositoryBase<EntityT, IdT>\n```\n\nSuddenly makes this issue appear.\n\n### Expected behavior\n\nI should be able to narrow down the generic from Any to UUID without causing an issue with the generated entity method\n\n### Actual behavior\n\nAn error is thrown when I narrow down the generic of my own base class\n\n### How to Reproduce?\n\nI have created a minimal reproducer. The steps are:\n1. Clone https://gitlab.com/l.s.andringa1/quarkus-panache-reproducer.git\n2. Run `gradle test`. I have added a test using a working repository, and a test for the broken issue (where the only difference is the narrowed generic).\n\n### Output of `uname -a` or `ver`\n\nUbuntu 25.04\n\n### Output of `java -version`\n\nJava 21.0.8\n\n### Quarkus version or git rev\n\n3.26.4\n\n### Build tool (ie. output of `mvnw --version` or `gradlew --version`)\n\nGradle 9.0.0\n\n### Additional information\n\n_No response_","closed_by":{"login":"FroMage","id":179265,"node_id":"MDQ6VXNlcjE3OTI2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/179265?v=4","gravatar_id":"","url":"https://api.github.com/users/FroMage","html_url":"https://github.com/FroMage","followers_url":"https://api.github.com/users/FroMage/followers","following_url":"https://api.github.com/users/FroMage/following{/other_user}","gists_url":"https://api.github.com/users/FroMage/gists{/gist_id}","starred_url":"https://api.github.com/users/FroMage/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/FroMage/subscriptions","organizations_url":"https://api.github.com/users/FroMage/orgs","repos_url":"https://api.github.com/users/FroMage/repos","events_url":"https://api.github.com/users/FroMage/events{/privacy}","received_events_url":"https://api.github.com/users/FroMage/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/quarkusio/quarkus/issues/50144/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/quarkusio/quarkus/issues/50144/timeline","performed_via_github_app":null,"state_reason":"completed"}