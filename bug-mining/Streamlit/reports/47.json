{"url":"https://api.github.com/repos/streamlit/streamlit/issues/4877","repository_url":"https://api.github.com/repos/streamlit/streamlit","labels_url":"https://api.github.com/repos/streamlit/streamlit/issues/4877/labels{/name}","comments_url":"https://api.github.com/repos/streamlit/streamlit/issues/4877/comments","events_url":"https://api.github.com/repos/streamlit/streamlit/issues/4877/events","html_url":"https://github.com/streamlit/streamlit/issues/4877","id":1276388499,"node_id":"I_kwDODCoeTs5MFCST","number":4877,"title":"`st.file_uploader` callback is called twice on each upload, after the first upload","user":{"login":"snehankekre","id":20672874,"node_id":"MDQ6VXNlcjIwNjcyODc0","avatar_url":"https://avatars.githubusercontent.com/u/20672874?v=4","gravatar_id":"","url":"https://api.github.com/users/snehankekre","html_url":"https://github.com/snehankekre","followers_url":"https://api.github.com/users/snehankekre/followers","following_url":"https://api.github.com/users/snehankekre/following{/other_user}","gists_url":"https://api.github.com/users/snehankekre/gists{/gist_id}","starred_url":"https://api.github.com/users/snehankekre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/snehankekre/subscriptions","organizations_url":"https://api.github.com/users/snehankekre/orgs","repos_url":"https://api.github.com/users/snehankekre/repos","events_url":"https://api.github.com/users/snehankekre/events{/privacy}","received_events_url":"https://api.github.com/users/snehankekre/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1516285324,"node_id":"MDU6TGFiZWwxNTE2Mjg1MzI0","url":"https://api.github.com/repos/streamlit/streamlit/labels/type:bug","name":"type:bug","color":"D93F0B","default":false,"description":"Something isn't working"},{"id":1848183387,"node_id":"MDU6TGFiZWwxODQ4MTgzMzg3","url":"https://api.github.com/repos/streamlit/streamlit/labels/feature:st.file_uploader","name":"feature:st.file_uploader","color":"C5DEF5","default":false,"description":""},{"id":3022365121,"node_id":"MDU6TGFiZWwzMDIyMzY1MTIx","url":"https://api.github.com/repos/streamlit/streamlit/labels/status:confirmed","name":"status:confirmed","color":"FEF2C0","default":false,"description":"Bug has been confirmed by the Streamlit team"},{"id":3230105890,"node_id":"MDU6TGFiZWwzMjMwMTA1ODkw","url":"https://api.github.com/repos/streamlit/streamlit/labels/priority:P2","name":"priority:P2","color":"ff4b4b","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2022-06-20T05:32:36Z","updated_at":"2024-07-25T02:07:16Z","closed_at":"2024-04-13T21:42:23Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Summary\r\n\r\nThe file uploader's `on_change` callback works as intended on the first upload. Each subsequent upload triggers the callback twice.\r\n\r\n### Steps to reproduce\r\n\r\n- Run the below app and keep open the browser window and terminal window side-by-side\r\n- Upload a file to `st.file_uploader`\r\n- In the terminal, observe the callback result `Uploaded file #1`\r\n- Upload a second file\r\n- In the terminal, observe the callback executed twice and prints `Uploaded file #2 \\n Uploaded file #3` instead of just `Uploaded file #2`\r\n\r\nCode snippet:\r\n\r\n[![Open in Streamlit Cloud](https://static.streamlit.io/badges/streamlit_badge_black_white.svg)](https://issues.streamlitapp.com/?issue=gh-4877)\r\n\r\n```\r\nimport streamlit as st\r\n\r\nif 'ctr' not in st.session_state:\r\n    st.session_state['ctr'] = 0\r\n\r\ndef uploader_callback():\r\n    st.session_state['ctr'] += 1\r\n    print('Uploaded file #%d' % st.session_state['ctr'])\r\n\r\nst.file_uploader(label=\"File uploader\", on_change=uploader_callback, key=\"file_uploader\")\r\n```\r\n\r\n**Expected behavior:**\r\n\r\nOn each upload to `st.file_uploader`, the callback passed to `on_change` should execute just once.\r\n\r\n**Actual behavior:**\r\n\r\nOn each subsequent upload after the first upload, the `on_change` callback is called twice. My understanding is that uploading a new file also clears the existing file, triggering another callback execution. In that sense, this behavior might be a feature, not a bug. Nonetheless, this behavior can be confusing and unintuitive.\r\n\r\n![fileuploader-callback-bug](https://user-images.githubusercontent.com/20672874/174531185-a22a59eb-3fc0-47e1-9caf-b6ae0ad69d7b.gif)\r\n\r\n### Is this a regression?\r\n\r\nNo. This bug was [reported on the forum](https://discuss.streamlit.io/t/st-file-uploader-keeps-calling-the-callback-function-passed-into-the-on-change-parameter-on-every-other-widget-change/20293) as far back as Streamlit v1.3.0\r\n\r\n### Debug info\r\n\r\n- Streamlit version: 1.10.0\r\n- Python version: 3.9.12\r\n- Using pipenv\r\n- OS version: macOS Darwin 21.5.0\r\n- Browser version: Chrome Version 102.0.5005.115 (Official Build) (x86_64)\r\n\r\n### Additional information\r\n\r\n- https://discuss.streamlit.io/t/st-file-uploader-keeps-calling-the-callback-function-passed-into-the-on-change-parameter-on-every-other-widget-change/20293 \r\n- https://discuss.streamlit.io/t/st-file-uploader-on-change-callback/26719\r\n","closed_by":{"login":"vdonato","id":3144420,"node_id":"MDQ6VXNlcjMxNDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/3144420?v=4","gravatar_id":"","url":"https://api.github.com/users/vdonato","html_url":"https://github.com/vdonato","followers_url":"https://api.github.com/users/vdonato/followers","following_url":"https://api.github.com/users/vdonato/following{/other_user}","gists_url":"https://api.github.com/users/vdonato/gists{/gist_id}","starred_url":"https://api.github.com/users/vdonato/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vdonato/subscriptions","organizations_url":"https://api.github.com/users/vdonato/orgs","repos_url":"https://api.github.com/users/vdonato/repos","events_url":"https://api.github.com/users/vdonato/events{/privacy}","received_events_url":"https://api.github.com/users/vdonato/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/streamlit/streamlit/issues/4877/reactions","total_count":12,"+1":12,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/streamlit/streamlit/issues/4877/timeline","performed_via_github_app":null,"state_reason":"completed"}