{"url":"https://api.github.com/repos/streamlit/streamlit/issues/6310","repository_url":"https://api.github.com/repos/streamlit/streamlit","labels_url":"https://api.github.com/repos/streamlit/streamlit/issues/6310/labels{/name}","comments_url":"https://api.github.com/repos/streamlit/streamlit/issues/6310/comments","events_url":"https://api.github.com/repos/streamlit/streamlit/issues/6310/events","html_url":"https://github.com/streamlit/streamlit/issues/6310","id":1623745474,"node_id":"I_kwDODCoeTs5gyGPC","number":6310,"title":"Bug in clearing cache of cached function via .clear() in streamlit==1.20.0","user":{"login":"a-slice-of-py","id":58488022,"node_id":"MDQ6VXNlcjU4NDg4MDIy","avatar_url":"https://avatars.githubusercontent.com/u/58488022?v=4","gravatar_id":"","url":"https://api.github.com/users/a-slice-of-py","html_url":"https://github.com/a-slice-of-py","followers_url":"https://api.github.com/users/a-slice-of-py/followers","following_url":"https://api.github.com/users/a-slice-of-py/following{/other_user}","gists_url":"https://api.github.com/users/a-slice-of-py/gists{/gist_id}","starred_url":"https://api.github.com/users/a-slice-of-py/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/a-slice-of-py/subscriptions","organizations_url":"https://api.github.com/users/a-slice-of-py/orgs","repos_url":"https://api.github.com/users/a-slice-of-py/repos","events_url":"https://api.github.com/users/a-slice-of-py/events{/privacy}","received_events_url":"https://api.github.com/users/a-slice-of-py/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1516285324,"node_id":"MDU6TGFiZWwxNTE2Mjg1MzI0","url":"https://api.github.com/repos/streamlit/streamlit/labels/type:bug","name":"type:bug","color":"D93F0B","default":false,"description":"Something isn't working"},{"id":3230105890,"node_id":"MDU6TGFiZWwzMjMwMTA1ODkw","url":"https://api.github.com/repos/streamlit/streamlit/labels/priority:P2","name":"priority:P2","color":"ff4b4b","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2023-03-14T15:41:15Z","updated_at":"2024-04-12T15:28:51Z","closed_at":"2023-03-16T13:55:38Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Checklist\n\n- [X] I have searched the [existing issues](https://github.com/streamlit/streamlit/issues) for similar issues.\n- [X] I added a very descriptive title to this issue.\n- [X] I have provided sufficient information below to help reproduce this issue.\n\n### Summary\n\nIn streamlit==1.20.0 I am unable to clear cache of a cached functions via `.clear()` (this was possible in streamlit 1.19.0).\r\n\r\nI suspect this is due to changes made in latest streamlit version to `streamlit\\runtime\\caching\\`, and in particular to `storage` module: now, indeed, even if `st.cache_data` is used without any custom argument - and, then, with `persist=None` - streamlit try to clear also local cache, and searching for the local cache folder eventually raise the error `FileNotFoundError: [Errno 2] No such file or directory` / `FileNotFoundError: [WinError 3] The system cannot find the path specified`\n\n### Reproducible Code Example\n\n```Python\nimport streamlit as st\r\nimport time\r\n\r\n@st.cache_data\r\ndef dummy():\r\n    st.write('Hello from dummy function! I will wait for 5 seconds...')\r\n    time.sleep(5)\r\n    st.write('Done!')\r\n\r\nleft, right = st.columns(2)\r\nwith left:\r\n    if st.button('Run dummy function'):\r\n        dummy()\r\nwith right:\r\n    if st.button('Clear cache'):\r\n        dummy.clear()\n```\n\n\n### Steps To Reproduce\n\n1. `pip install streamlit==1.20.0`\r\n2. Copy above snippet to `app.py`\r\n3. `streamlit run app.py`\r\n4. Click a first time on \"Run dummy function\" button (-> see cache spinner)\r\n5. Click a second time on \"Run dummy function\" (-> confirm that function has been cached)\r\n6. Click on \"Clear cache\" button (-> `FileNotFoundError` should be raised)\n\n### Expected Behavior\n\nAs in previous streamlit 1.19.0 version, cache can be cleared without searching for local cache if `persist = None | False`\n\n### Current Behavior\n\nCannot properly clear cache due to `FileNotFoundError: [WinError 3] The system cannot find the path specified: 'C:\\\\Users\\\\XXXXXXXXX\\\\.streamlit\\\\cache'` (on local Windows machine) or `FileNotFoundError: [Errno 2] No such file or directory: '/root/.streamlit/cache'` (on remote containerized execution)\r\n\r\nFull traceback:\r\n\r\n```\r\nFileNotFoundError: [WinError 3] The system cannot find the path specified: 'C:\\\\Users\\\\XXXXXXXXX\\\\.streamlit\\\\cache'\r\n\r\nFile \"C:\\Users\\XXXXXXXXX\\Miniconda3\\envs\\hc\\lib\\site-packages\\streamlit\\runtime\\scriptrunner\\script_runner.py\", line 565, in _run_script\r\n    exec(code, module.__dict__)\r\nFile \"XXXXXXXXX\\app.py\", line 16, in <module>\r\n    dummy.clear()\r\nFile \"C:\\Users\\XXXXXXXXX\\Miniconda3\\envs\\hc\\lib\\site-packages\\streamlit\\runtime\\caching\\cache_utils.py\", line 331, in clear\r\n    cache.clear()\r\nFile \"C:\\Users\\XXXXXXXXX\\Miniconda3\\envs\\hc\\lib\\site-packages\\streamlit\\runtime\\caching\\cache_utils.py\", line 137, in clear\r\n    self._clear()\r\nFile \"C:\\Users\\XXXXXXXXX\\Miniconda3\\envs\\hc\\lib\\site-packages\\streamlit\\runtime\\caching\\cache_data_api.py\", line 659, in _clear\r\n    self.storage.clear()\r\nFile \"C:\\Users\\XXXXXXXXX\\Miniconda3\\envs\\hc\\lib\\site-packages\\streamlit\\runtime\\caching\\storage\\in_memory_cache_storage_wrapper.py\", line 107, in clear\r\n    self._persist_storage.clear()\r\nFile \"C:\\Users\\XXXXXXXXX\\Miniconda3\\envs\\hc\\lib\\site-packages\\streamlit\\runtime\\caching\\storage\\local_disk_cache_storage.py\", line 174, in clear\r\n    for file_name in os.listdir(cache_dir):\r\n```\n\n### Is this a regression?\n\n- [X] Yes, this used to work in a previous version.\n\n### Debug info\n\n- Streamlit version: 1.20.0\r\n- Python version: 3.10.8\r\n- Operating System: Windows 10 Enterprise v22H2 build 19045.2604\r\n- Browser: Brave\r\n- Virtual environment: miniconda environment\r\n\n\n### Additional Information\n\n_No response_\n\n### Are you willing to submit a PR?\n\n- [ ] Yes, I am willing to submit a PR!","closed_by":{"login":"kajarenc","id":6664805,"node_id":"MDQ6VXNlcjY2NjQ4MDU=","avatar_url":"https://avatars.githubusercontent.com/u/6664805?v=4","gravatar_id":"","url":"https://api.github.com/users/kajarenc","html_url":"https://github.com/kajarenc","followers_url":"https://api.github.com/users/kajarenc/followers","following_url":"https://api.github.com/users/kajarenc/following{/other_user}","gists_url":"https://api.github.com/users/kajarenc/gists{/gist_id}","starred_url":"https://api.github.com/users/kajarenc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kajarenc/subscriptions","organizations_url":"https://api.github.com/users/kajarenc/orgs","repos_url":"https://api.github.com/users/kajarenc/repos","events_url":"https://api.github.com/users/kajarenc/events{/privacy}","received_events_url":"https://api.github.com/users/kajarenc/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/streamlit/streamlit/issues/6310/reactions","total_count":3,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":1},"timeline_url":"https://api.github.com/repos/streamlit/streamlit/issues/6310/timeline","performed_via_github_app":null,"state_reason":"completed"}