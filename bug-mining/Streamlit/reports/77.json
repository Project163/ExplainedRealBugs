{"url":"https://api.github.com/repos/streamlit/streamlit/issues/9415","repository_url":"https://api.github.com/repos/streamlit/streamlit","labels_url":"https://api.github.com/repos/streamlit/streamlit/issues/9415/labels{/name}","comments_url":"https://api.github.com/repos/streamlit/streamlit/issues/9415/comments","events_url":"https://api.github.com/repos/streamlit/streamlit/issues/9415/events","html_url":"https://github.com/streamlit/streamlit/issues/9415","id":2510578825,"node_id":"I_kwDODCoeTs6VpGSJ","number":9415,"title":"Exponential slowdown in Streamlit as the number of widgets increases (starting in v1.34)","user":{"login":"ianlcassidy","id":6929405,"node_id":"MDQ6VXNlcjY5Mjk0MDU=","avatar_url":"https://avatars.githubusercontent.com/u/6929405?v=4","gravatar_id":"","url":"https://api.github.com/users/ianlcassidy","html_url":"https://github.com/ianlcassidy","followers_url":"https://api.github.com/users/ianlcassidy/followers","following_url":"https://api.github.com/users/ianlcassidy/following{/other_user}","gists_url":"https://api.github.com/users/ianlcassidy/gists{/gist_id}","starred_url":"https://api.github.com/users/ianlcassidy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ianlcassidy/subscriptions","organizations_url":"https://api.github.com/users/ianlcassidy/orgs","repos_url":"https://api.github.com/users/ianlcassidy/repos","events_url":"https://api.github.com/users/ianlcassidy/events{/privacy}","received_events_url":"https://api.github.com/users/ianlcassidy/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1516285324,"node_id":"MDU6TGFiZWwxNTE2Mjg1MzI0","url":"https://api.github.com/repos/streamlit/streamlit/labels/type:bug","name":"type:bug","color":"D93F0B","default":false,"description":"Something isn't working"},{"id":3022365121,"node_id":"MDU6TGFiZWwzMDIyMzY1MTIx","url":"https://api.github.com/repos/streamlit/streamlit/labels/status:confirmed","name":"status:confirmed","color":"FEF2C0","default":false,"description":"Bug has been confirmed by the Streamlit team"},{"id":3230105890,"node_id":"MDU6TGFiZWwzMjMwMTA1ODkw","url":"https://api.github.com/repos/streamlit/streamlit/labels/priority:P2","name":"priority:P2","color":"ff4b4b","default":false,"description":""},{"id":4070169954,"node_id":"LA_kwDODCoeTs7ymd1i","url":"https://api.github.com/repos/streamlit/streamlit/labels/feature:st.session_state","name":"feature:st.session_state","color":"C5DEF5","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2024-09-06T14:31:47Z","updated_at":"2024-09-17T22:20:22Z","closed_at":"2024-09-17T22:20:22Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Checklist\r\n\r\n- [X] I have searched the [existing issues](https://github.com/streamlit/streamlit/issues) for similar issues.\r\n- [X] I added a very descriptive title to this issue.\r\n- [X] I have provided sufficient information below to help reproduce this issue.\r\n\r\n### Summary\r\n\r\nThere is an exponential slowdown in Streamlit as the number of input widgets is increases. This started happening with the 1.34 release and is tied to PR #8529. Calling [`get_session_state()`](https://github.com/streamlit/streamlit/blob/develop/lib/streamlit/elements/widgets/number_input.py#L390) in the widgets is triggering this [dict comp method](https://github.com/streamlit/streamlit/blob/develop/lib/streamlit/runtime/state/session_state.py#L370) exponentially more times than previously. For a simple app containing 200 number inputs, there is a 50x increase in calls to `_reverse_key_wid_map` which causes the app to take over 1s to re-load locally (vs ~0.2s with release 1.33). Here is a plot of the number of calls vs the number of inputs:\r\n\r\n![image](https://github.com/user-attachments/assets/4b0ef9c9-49c4-482b-85d9-9684e41f523d)\r\n\r\n### Reproducible Code Example\r\n\r\n```Python\r\nimport streamlit as st\r\nimport time\r\nimport random\r\n\r\nNUM_TABS = 10\r\nNUM_INPUTS = 20\r\n\r\n\r\ndef create_inputs(t):\r\n    for i in range(NUM_INPUTS):\r\n        key = f\"tab_{t + 1}_input_{i + 1}_value\"\r\n        if key in st.session_state:\r\n            value = st.session_state[key]\r\n        else:\r\n            value = random.randint(0, 100000)\r\n        st.number_input(\r\n            label=f\"Number Input {i + 1}\",\r\n            value=value,\r\n            min_value=0,\r\n            step=1,\r\n            format=\"%d\",\r\n            key=key,\r\n        )\r\n\r\n\r\ndef main():\r\n    st.title(\"My dummy app\")\r\n    with st.container(border=True, height=500):\r\n        tabs = st.tabs([f\"Tab {i + 1}\" for i in range(NUM_TABS)])\r\n        for t, tab in enumerate(tabs):\r\n            with tab:\r\n                create_inputs(t)\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    import cProfile\r\n    from pstats import Stats\r\n\r\n    pr = cProfile.Profile()\r\n    pr.enable()\r\n\r\n    start_time = time.time()\r\n    main()\r\n    st.info(f\"run time: {time.time() - start_time:.3f} seconds\")\r\n\r\n    pr.disable()\r\n    stats = Stats(pr)\r\n    stats.sort_stats(\"tottime\").print_stats(10)\r\n```\r\n\r\n### Steps To Reproduce\r\n\r\n1. Run the app using Streamlit version 1.33\r\n2. Adjust `NUM_TABS` value from 1 to 10 and monitor the `cProfile` output\r\n3. Switch to Streamlit version 1.34 or above\r\n4. Repeat step 2\r\n\r\nhere is a screenshot of the cProfile output with Streamlit 1.33 using 200 widgets:\r\n![image](https://github.com/user-attachments/assets/2c39e939-5cc9-407a-99f1-e1c9de0257b2)\r\n\r\nand here's a screenshot using Streamlit 1.34:\r\n![image](https://github.com/user-attachments/assets/3da40e2d-025c-4752-9a96-6b10b233a0bd)\r\n\r\n### Expected Behavior\r\n\r\n_No response_\r\n\r\n### Current Behavior\r\n\r\n_No response_\r\n\r\n### Is this a regression?\r\n\r\n- [x] Yes, this used to work in a previous version.\r\n\r\n### Debug info\r\n\r\n- Streamlit version: 1.33 vs 1.34+\r\n- Python version: 3.11\r\n- Operating System: Windows 10\r\n- Browser: Chrome\r\n\r\n\r\n### Additional Information\r\n\r\n_No response_","closed_by":{"login":"raethlein","id":3775781,"node_id":"MDQ6VXNlcjM3NzU3ODE=","avatar_url":"https://avatars.githubusercontent.com/u/3775781?v=4","gravatar_id":"","url":"https://api.github.com/users/raethlein","html_url":"https://github.com/raethlein","followers_url":"https://api.github.com/users/raethlein/followers","following_url":"https://api.github.com/users/raethlein/following{/other_user}","gists_url":"https://api.github.com/users/raethlein/gists{/gist_id}","starred_url":"https://api.github.com/users/raethlein/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/raethlein/subscriptions","organizations_url":"https://api.github.com/users/raethlein/orgs","repos_url":"https://api.github.com/users/raethlein/repos","events_url":"https://api.github.com/users/raethlein/events{/privacy}","received_events_url":"https://api.github.com/users/raethlein/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/streamlit/streamlit/issues/9415/reactions","total_count":7,"+1":5,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":2,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/streamlit/streamlit/issues/9415/timeline","performed_via_github_app":null,"state_reason":"completed"}