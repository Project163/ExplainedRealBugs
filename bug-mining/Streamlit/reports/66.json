{"url":"https://api.github.com/repos/streamlit/streamlit/issues/9171","repository_url":"https://api.github.com/repos/streamlit/streamlit","labels_url":"https://api.github.com/repos/streamlit/streamlit/issues/9171/labels{/name}","comments_url":"https://api.github.com/repos/streamlit/streamlit/issues/9171/comments","events_url":"https://api.github.com/repos/streamlit/streamlit/issues/9171/events","html_url":"https://github.com/streamlit/streamlit/issues/9171","id":2437150732,"node_id":"I_kwDODCoeTs6RQ_gM","number":9171,"title":"st.rerun reruns the entire page instead of just escaping the fragment resulting in other widgets loosing their state (since v.1.37)","user":{"login":"flucas96","id":59033065,"node_id":"MDQ6VXNlcjU5MDMzMDY1","avatar_url":"https://avatars.githubusercontent.com/u/59033065?v=4","gravatar_id":"","url":"https://api.github.com/users/flucas96","html_url":"https://github.com/flucas96","followers_url":"https://api.github.com/users/flucas96/followers","following_url":"https://api.github.com/users/flucas96/following{/other_user}","gists_url":"https://api.github.com/users/flucas96/gists{/gist_id}","starred_url":"https://api.github.com/users/flucas96/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flucas96/subscriptions","organizations_url":"https://api.github.com/users/flucas96/orgs","repos_url":"https://api.github.com/users/flucas96/repos","events_url":"https://api.github.com/users/flucas96/events{/privacy}","received_events_url":"https://api.github.com/users/flucas96/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1516285324,"node_id":"MDU6TGFiZWwxNTE2Mjg1MzI0","url":"https://api.github.com/repos/streamlit/streamlit/labels/type:bug","name":"type:bug","color":"D93F0B","default":false,"description":"Something isn't working"},{"id":3022365121,"node_id":"MDU6TGFiZWwzMDIyMzY1MTIx","url":"https://api.github.com/repos/streamlit/streamlit/labels/status:confirmed","name":"status:confirmed","color":"FEF2C0","default":false,"description":"Bug has been confirmed by the Streamlit team"},{"id":3230104487,"node_id":"MDU6TGFiZWwzMjMwMTA0NDg3","url":"https://api.github.com/repos/streamlit/streamlit/labels/priority:P1","name":"priority:P1","color":"ff4b4b","default":false,"description":""},{"id":4369205014,"node_id":"LA_kwDODCoeTs8AAAABBGzHFg","url":"https://api.github.com/repos/streamlit/streamlit/labels/feature:st.rerun","name":"feature:st.rerun","color":"C5DEF5","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"vdonato","id":3144420,"node_id":"MDQ6VXNlcjMxNDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/3144420?v=4","gravatar_id":"","url":"https://api.github.com/users/vdonato","html_url":"https://github.com/vdonato","followers_url":"https://api.github.com/users/vdonato/followers","following_url":"https://api.github.com/users/vdonato/following{/other_user}","gists_url":"https://api.github.com/users/vdonato/gists{/gist_id}","starred_url":"https://api.github.com/users/vdonato/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vdonato/subscriptions","organizations_url":"https://api.github.com/users/vdonato/orgs","repos_url":"https://api.github.com/users/vdonato/repos","events_url":"https://api.github.com/users/vdonato/events{/privacy}","received_events_url":"https://api.github.com/users/vdonato/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"vdonato","id":3144420,"node_id":"MDQ6VXNlcjMxNDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/3144420?v=4","gravatar_id":"","url":"https://api.github.com/users/vdonato","html_url":"https://github.com/vdonato","followers_url":"https://api.github.com/users/vdonato/followers","following_url":"https://api.github.com/users/vdonato/following{/other_user}","gists_url":"https://api.github.com/users/vdonato/gists{/gist_id}","starred_url":"https://api.github.com/users/vdonato/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vdonato/subscriptions","organizations_url":"https://api.github.com/users/vdonato/orgs","repos_url":"https://api.github.com/users/vdonato/repos","events_url":"https://api.github.com/users/vdonato/events{/privacy}","received_events_url":"https://api.github.com/users/vdonato/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":6,"created_at":"2024-07-30T07:48:44Z","updated_at":"2024-08-01T07:38:21Z","closed_at":"2024-08-01T07:38:21Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Checklist\r\n\r\n- [X] I have searched the [existing issues](https://github.com/streamlit/streamlit/issues) for similar issues.\r\n- [X] I added a very descriptive title to this issue.\r\n- [X] I have provided sufficient information below to help reproduce this issue.\r\n\r\n### Summary\r\n\r\n**Following scenario:**\r\n\r\nI have a widget that takes user input. Depending on that user input, different content is shown to the user. One option, for instance, is a dynamic form using `st.fragment`.\r\n\r\nBefore the last update, I would save the user input in the `st.session_state` and call `st.rerun` when the user submits the dynamic form. In the next run of the app , I would check if there was anything in the session state and access the data.\r\n\r\nThis worked fine in version 1.36. However, now in version 1.37, the widget that controls what content is shown (e.g., the dynamic form) loses its state as well when `st.rerun` is called.\r\n\r\nIn the example code below I have created a widget to choose between two forms:\r\n1) A static form (using `st.forms`)\r\n2) A dynamic form.\r\n\r\nUsing the dynamic form works fine with version 1.36 but not with 1.37. \r\nThe submitted data should be display under the form.\r\n\r\n### Reproducible Code Example\r\n\r\n```Python\r\nimport pandas as pd\r\n\r\nimport streamlit as st\r\nfrom st_ant_menu import st_ant_menu\r\n\r\n\r\n@st.experimental_fragment\r\ndef simple_dynamic_form():\r\n    with st.container(border=True):\r\n        st.write(\"**Simple dynamic form using fragments**\")\r\n\r\n        countries = ['USA', 'France', 'Japan']\r\n\r\n        selected_country = st.selectbox('Choose your country', countries)\r\n\r\n        if selected_country == 'USA':\r\n            city_options = ['New York', 'Los Angeles', 'Chicago']\r\n        elif selected_country == 'France':\r\n            city_options = ['Paris', 'Lyon', 'Marseille']\r\n        else:  # Japan\r\n            city_options = ['Tokyo', 'Kyoto', 'Osaka']\r\n\r\n        selected_city = st.selectbox('Choose your city', city_options)\r\n\r\n        if selected_city == 'New York':\r\n            landmark_options = ['Statue of Liberty', 'Central Park', 'Times Square']\r\n        elif selected_city == 'Los Angeles':\r\n            landmark_options = ['Hollywood Sign', 'Griffith Observatory', 'Santa Monica Pier']\r\n        elif selected_city == 'Chicago':\r\n            landmark_options = ['Millennium Park', 'Willis Tower', 'Navy Pier']\r\n        elif selected_city == 'Paris':\r\n            landmark_options = ['Eiffel Tower', 'Louvre Museum', 'Notre-Dame Cathedral']\r\n        elif selected_city == 'Lyon':\r\n            landmark_options = ['Basilica of Notre-Dame de Fourvière', 'Parc de la Tête d\\'Or', 'Vieux Lyon']\r\n        elif selected_city == 'Marseille':\r\n            landmark_options = ['Old Port of Marseille', 'Basilica of Notre-Dame de la Garde', 'Calanques National Park']\r\n        elif selected_city == 'Tokyo':\r\n            landmark_options = ['Tokyo Tower', 'Shinjuku Gyoen', 'Meiji Shrine']\r\n        elif selected_city == 'Kyoto':\r\n            landmark_options = ['Fushimi Inari Shrine', 'Kinkaku-ji', 'Arashiyama Bamboo Grove']\r\n        else:  # Osaka\r\n            landmark_options = ['Osaka Castle', 'Universal Studios Japan', 'Dotonbori']\r\n\r\n        selected_landmark = st.selectbox('Choose a landmark', landmark_options)\r\n        \r\n        \r\n        if st.button(\"**Submit**\"):\r\n            st.session_state.form_values = {\"country\": selected_country, \"city\": selected_city, \"landmark\": selected_landmark}\r\n            \r\n            st.rerun()\r\n\r\n\r\ndef static_form():\r\n    with st.form(border=True, key=\"static_form\"):\r\n        st.write(\"**Static form**\")\r\n        selected_country = st.selectbox('Choose your country', ['USA', 'France', 'Japan'])\r\n        selected_city = st.selectbox('Choose your city', ['New York', 'Los Angeles', 'Chicago'])\r\n        selected_landmark = st.selectbox('Choose a landmark', ['Statue of Liberty', 'Central Park', 'Times Square'])\r\n        if st.form_submit_button('Submit'):\r\n            st.session_state.form_values = {\"country\": selected_country, \"city\": selected_city, \"landmark\": selected_landmark}\r\n            \r\nst.write(\"**Streamlit Version:** \", st.__version__)\r\n\r\nmenu_data = [\r\n{\r\n    \"key\": \"1\",\r\n    \"label\": \"<b>Form 1 Static</b>\",\r\n    \"icon\": \"UserOutlined\",\r\n},\r\n{\r\n    \"key\": \"2\",\r\n    \"label\": \"<b>Form 2 Dynamic</b>\",\r\n    \"icon\": \"VideoCameraOutlined\",\r\n},\r\n]\r\n\r\nselected_form = st_ant_menu(menu_data,)\r\n\r\n\r\nif selected_form:\r\n    if selected_form == \"2\":\r\n        simple_dynamic_form()\r\n    elif selected_form == \"1\":\r\n        static_form()\r\n\r\n    if \"form_values\" in st.session_state:\r\n        st.write(\"**Submitted data**\")\r\n        st.write(\"**Country:** \", st.session_state.form_values[\"country\"])\r\n        st.write(\"**City:** \", st.session_state.form_values[\"city\"])\r\n        st.write(\"**Landmark:** \", st.session_state.form_values[\"landmark\"])\r\n    else:\r\n        st.write(\"**No data submitted yet**\")\r\n        \r\nelse:\r\n    st.write(\"**Choose a form**\")\r\n```\r\n\r\n\r\n### Steps To Reproduce\r\n\r\nDo this once for Streamlit V.1.36 and then for V.1.37\r\n\r\n1. Select \"Form 1 Static\"\r\n2. Put some values in the form and submit the data\r\n3. You should see your input below form \r\n\r\n4. Select \"Form 2 Dynamic\"\r\n5. Put some values in the form and submit the data\r\n6. If you are on version 1.36 you will see the data below the form. If you are on version 1.37 the site will be resetted. \r\n\r\n### Expected Behavior\r\n\r\nI would expect the behavior of V.1.36 where other widgets keep its state. \r\n\r\n\r\n### Current Behavior\r\n\r\n_No response_\r\n\r\n### Is this a regression?\r\n\r\n- [X] Yes, this used to work in a previous version.\r\n\r\n### Debug info\r\n\r\n- Streamlit version: 1.36 & 1.37\r\n- Python version: 3.11.3 64bit\r\n- Operating System: Linux / Windows\r\n- Browser: Edge\r\n\r\n\r\n### Additional Information\r\n\r\n_No response_","closed_by":{"login":"vdonato","id":3144420,"node_id":"MDQ6VXNlcjMxNDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/3144420?v=4","gravatar_id":"","url":"https://api.github.com/users/vdonato","html_url":"https://github.com/vdonato","followers_url":"https://api.github.com/users/vdonato/followers","following_url":"https://api.github.com/users/vdonato/following{/other_user}","gists_url":"https://api.github.com/users/vdonato/gists{/gist_id}","starred_url":"https://api.github.com/users/vdonato/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vdonato/subscriptions","organizations_url":"https://api.github.com/users/vdonato/orgs","repos_url":"https://api.github.com/users/vdonato/repos","events_url":"https://api.github.com/users/vdonato/events{/privacy}","received_events_url":"https://api.github.com/users/vdonato/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/streamlit/streamlit/issues/9171/reactions","total_count":7,"+1":7,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/streamlit/streamlit/issues/9171/timeline","performed_via_github_app":null,"state_reason":"completed"}