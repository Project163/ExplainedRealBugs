{"url":"https://api.github.com/repos/streamlit/streamlit/issues/10356","repository_url":"https://api.github.com/repos/streamlit/streamlit","labels_url":"https://api.github.com/repos/streamlit/streamlit/issues/10356/labels{/name}","comments_url":"https://api.github.com/repos/streamlit/streamlit/issues/10356/comments","events_url":"https://api.github.com/repos/streamlit/streamlit/issues/10356/events","html_url":"https://github.com/streamlit/streamlit/issues/10356","id":2837271627,"node_id":"I_kwDODCoeTs6pHVRL","number":10356,"title":"st.login() when using Google - state parsing appears to be incorrect","user":{"login":"daileykluck","id":62618670,"node_id":"MDQ6VXNlcjYyNjE4Njcw","avatar_url":"https://avatars.githubusercontent.com/u/62618670?v=4","gravatar_id":"","url":"https://api.github.com/users/daileykluck","html_url":"https://github.com/daileykluck","followers_url":"https://api.github.com/users/daileykluck/followers","following_url":"https://api.github.com/users/daileykluck/following{/other_user}","gists_url":"https://api.github.com/users/daileykluck/gists{/gist_id}","starred_url":"https://api.github.com/users/daileykluck/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/daileykluck/subscriptions","organizations_url":"https://api.github.com/users/daileykluck/orgs","repos_url":"https://api.github.com/users/daileykluck/repos","events_url":"https://api.github.com/users/daileykluck/events{/privacy}","received_events_url":"https://api.github.com/users/daileykluck/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1516285324,"node_id":"MDU6TGFiZWwxNTE2Mjg1MzI0","url":"https://api.github.com/repos/streamlit/streamlit/labels/type:bug","name":"type:bug","color":"D93F0B","default":false,"description":"Something isn't working"},{"id":3022365121,"node_id":"MDU6TGFiZWwzMDIyMzY1MTIx","url":"https://api.github.com/repos/streamlit/streamlit/labels/status:confirmed","name":"status:confirmed","color":"FEF2C0","default":false,"description":"Bug has been confirmed by the Streamlit team"},{"id":3230107623,"node_id":"MDU6TGFiZWwzMjMwMTA3NjIz","url":"https://api.github.com/repos/streamlit/streamlit/labels/priority:P3","name":"priority:P3","color":"ff4b4b","default":false,"description":""},{"id":8044525656,"node_id":"LA_kwDODCoeTs8AAAAB3324WA","url":"https://api.github.com/repos/streamlit/streamlit/labels/feature:authentication","name":"feature:authentication","color":"C5DEF5","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2025-02-07T05:29:02Z","updated_at":"2025-02-07T18:29:23Z","closed_at":"2025-02-07T18:29:23Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Checklist\n\n- [x] I have searched the [existing issues](https://github.com/streamlit/streamlit/issues) for similar issues.\n- [x] I added a very descriptive title to this issue.\n- [x] I have provided sufficient information below to help reproduce this issue.\n\n### Summary\n\nWhen attempting to configure st.login() with our application, we are getting an error that indicates that the `state` might not be properly set according to the code that attempts to parse it.\n\nWe have confirmed that the received state is the same as the outgoing state, but upon redirect it looks like it doesn't parse as expected.\n\n### Reproducible Code Example\n\n```Python\n# streamlit.py\n\nimport streamlit as st\n\nif st.button(\"Log in with Google\"):\n            st.login(provider='google_dev')\n\n\n# secrets.toml\n[auth]\nredirect_uri = \"http://localhost:8501/oauth2callback\"\ncookie_secret = \"somesecret\"\n\n[auth.google_dev]\nclient_id = \"something-something.apps.googleusercontent.com\"\nclient_secret = \"some-secret\"\nserver_metadata_url = \"https://accounts.google.com/.well-known/openid-configuration\"\n```\n\n### Steps To Reproduce\n\n1. Click on the button\n2. Select your profile\n3. Check server logs\n\n### Expected Behavior\n\nI would have expected what looked to be an incredibly easy way to replace our current homegrown implementation of OAuth in Streamlit! Really pumped for this, just hitting a minor snag that I *think* looks like a bug.\n\n### Current Behavior\n\n```\nTraceback (most recent call last):\n...\nvenv/lib/python3.11/site-packages/streamlit/web/server/oauth_authlib_routes.py\", line 128, in get\n    provider = self._get_provider_by_state()\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \".../.venv/lib/python3.11/site-packages/streamlit/web/server/oauth_authlib_routes.py\", line 157, in _get_provider_by_state\n    _, _, recorded_provider, code = key.split(\"_\")\n    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nValueError: too many values to unpack (expected 4)\n```\n\n### Is this a regression?\n\n- [ ] Yes, this used to work in a previous version.\n\n### Debug info\n\n- Streamlit version: 1.42.0\n- Authlib version: 1.4.1\n- Python version: 3.11\n- Operating System: MacOS 15.2 (24C101)\n- Browser: Version 132.0.6834.160 (Official Build) (arm64)\n\n### Additional Information\n\n_No response_","closed_by":{"login":"kajarenc","id":6664805,"node_id":"MDQ6VXNlcjY2NjQ4MDU=","avatar_url":"https://avatars.githubusercontent.com/u/6664805?v=4","gravatar_id":"","url":"https://api.github.com/users/kajarenc","html_url":"https://github.com/kajarenc","followers_url":"https://api.github.com/users/kajarenc/followers","following_url":"https://api.github.com/users/kajarenc/following{/other_user}","gists_url":"https://api.github.com/users/kajarenc/gists{/gist_id}","starred_url":"https://api.github.com/users/kajarenc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kajarenc/subscriptions","organizations_url":"https://api.github.com/users/kajarenc/orgs","repos_url":"https://api.github.com/users/kajarenc/repos","events_url":"https://api.github.com/users/kajarenc/events{/privacy}","received_events_url":"https://api.github.com/users/kajarenc/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/streamlit/streamlit/issues/10356/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/streamlit/streamlit/issues/10356/timeline","performed_via_github_app":null,"state_reason":"completed"}