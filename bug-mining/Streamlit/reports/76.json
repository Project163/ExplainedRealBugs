{"url":"https://api.github.com/repos/streamlit/streamlit/issues/9100","repository_url":"https://api.github.com/repos/streamlit/streamlit","labels_url":"https://api.github.com/repos/streamlit/streamlit/issues/9100/labels{/name}","comments_url":"https://api.github.com/repos/streamlit/streamlit/issues/9100/comments","events_url":"https://api.github.com/repos/streamlit/streamlit/issues/9100/events","html_url":"https://github.com/streamlit/streamlit/issues/9100","id":2416643445,"node_id":"I_kwDODCoeTs6QCw11","number":9100,"title":"All widgets in st.Navigation app reset when a widget is changed before previous execution finishes","user":{"login":"connortann","id":71127464,"node_id":"MDQ6VXNlcjcxMTI3NDY0","avatar_url":"https://avatars.githubusercontent.com/u/71127464?v=4","gravatar_id":"","url":"https://api.github.com/users/connortann","html_url":"https://github.com/connortann","followers_url":"https://api.github.com/users/connortann/followers","following_url":"https://api.github.com/users/connortann/following{/other_user}","gists_url":"https://api.github.com/users/connortann/gists{/gist_id}","starred_url":"https://api.github.com/users/connortann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/connortann/subscriptions","organizations_url":"https://api.github.com/users/connortann/orgs","repos_url":"https://api.github.com/users/connortann/repos","events_url":"https://api.github.com/users/connortann/events{/privacy}","received_events_url":"https://api.github.com/users/connortann/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1516285324,"node_id":"MDU6TGFiZWwxNTE2Mjg1MzI0","url":"https://api.github.com/repos/streamlit/streamlit/labels/type:bug","name":"type:bug","color":"D93F0B","default":false,"description":"Something isn't working"},{"id":3022365121,"node_id":"MDU6TGFiZWwzMDIyMzY1MTIx","url":"https://api.github.com/repos/streamlit/streamlit/labels/status:confirmed","name":"status:confirmed","color":"FEF2C0","default":false,"description":"Bug has been confirmed by the Streamlit team"},{"id":3230107623,"node_id":"MDU6TGFiZWwzMjMwMTA3NjIz","url":"https://api.github.com/repos/streamlit/streamlit/labels/priority:P3","name":"priority:P3","color":"ff4b4b","default":false,"description":""},{"id":4288309131,"node_id":"LA_kwDODCoeTs7_mmeL","url":"https://api.github.com/repos/streamlit/streamlit/labels/feature:multipage-apps","name":"feature:multipage-apps","color":"C5DEF5","default":false,"description":""},{"id":7047460070,"node_id":"LA_kwDODCoeTs8AAAABpA-05g","url":"https://api.github.com/repos/streamlit/streamlit/labels/feature:st.navigation","name":"feature:st.navigation","color":"C5DEF5","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":12,"created_at":"2024-07-18T14:51:24Z","updated_at":"2024-09-17T04:36:01Z","closed_at":"2024-09-17T04:36:01Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Checklist\r\n\r\n- [X] I have searched the [existing issues](https://github.com/streamlit/streamlit/issues) for similar issues.\r\n- [X] I added a very descriptive title to this issue.\r\n- [X] I have provided sufficient information below to help reproduce this issue.\r\n\r\n### Summary\r\n\r\nIn a multipage app with `st.navigation`, if a widget is changed twice in quick succession the whole page refreshes and the state of all widgets resets.\r\n\r\nThis is rather catastrophic for pages with large numbers of input widgets, as all values entered by the user are suddenly lost!\r\n\r\n### Reproducible Code Example\r\n\r\n```Python\r\nimport time\r\nimport streamlit as st\r\n\r\ndef my_func():\r\n    time.sleep(0.5)\r\n    st.number_input(\"mynum\", value=None)\r\n\r\npages = [st.Page(my_func)]\r\npg = st.navigation(pages=pages)\r\npg.run()\r\n```\r\n\r\n\r\n### Steps To Reproduce\r\n\r\n1. The number input widget is initially blank\r\n1. Enter a value e.g. `1` into the number input widget\r\n2. Press the \"+\" button a few times in rapid succession\r\n3. The page will refresh and the number widget is blank again\r\n\r\nScreencast:\r\n\r\n[streamlit-bug.webm](https://github.com/user-attachments/assets/ea7ecd64-f0e5-43b7-8616-0df6cf51d7f4)\r\n\r\n### Expected Behavior\r\n\r\nThe state of the widget should remain as entered. Any other widgets on the page should not change.\r\n\r\n### Current Behavior\r\n\r\nThe page refreshes and all widget states are lost. This is particularly problematic for complex apps where users may have spent a lot of time filling out various widgets!\r\n\r\n### Is this a regression?\r\n\r\n- [ ] Yes, this used to work in a previous version.\r\n\r\n### Debug info\r\n\r\n- Streamlit version: 1.36.0\r\n- Python version: 3.11.9\r\n- Operating System: Linnux\r\n- Browser: Edge\r\n\r\n### Possible fix?\r\n\r\nFrom my attempts at debugging so far, I have found that the issue is seemingly fixed by commenting out this line:\r\n\r\nhttps://github.com/streamlit/streamlit/blob/a2ae47a6a1bbc0fd2a035af3dadd5cbeb4ee5a79/lib/streamlit/runtime/pages_manager.py#L317\r\n\r\n### Further info\r\n\r\nThis bug only occurs if the page is run via with the `st.navigation` and `st.Page` context.\r\n\r\nIt seems that when the widget is updated twice, before the app has finished updating from the initial interaction, a `ScriptRequestType.STOP` request is sent and this seems to lead to the page refreshing and all widget states being lost.\r\n\r\nIn the example above, `time.sleep(0.5)` is used to represent arbitrary functions which take a short while to complete. In a real-life example, these might be imports of large packages.\r\n\r\nThis bug doesn't only occur with the `+` button on numeric widgets, it also happens with other widget types. For example with buttons:\r\n\r\n```python\r\nimport time\r\nimport streamlit as st\r\n\r\ndef my_func_2():\r\n    time.sleep(0.5)\r\n    num = st.number_input(\"mynum\", value=None)\r\n    if st.button(\"Click me\"):\r\n        st.write(num)\r\n\r\npages = [st.Page(my_func_2)]\r\npg = st.navigation(pages=pages)\r\npg.run()\r\n```\r\n\r\nIn this example, the bug occurs if a number is typed in and then then button is clicked _before_ clicking away from the numeric input widget (i.e. so the number_input interaction is submitted immediately before the button click)","closed_by":{"login":"kmcgrady","id":69432,"node_id":"MDQ6VXNlcjY5NDMy","avatar_url":"https://avatars.githubusercontent.com/u/69432?v=4","gravatar_id":"","url":"https://api.github.com/users/kmcgrady","html_url":"https://github.com/kmcgrady","followers_url":"https://api.github.com/users/kmcgrady/followers","following_url":"https://api.github.com/users/kmcgrady/following{/other_user}","gists_url":"https://api.github.com/users/kmcgrady/gists{/gist_id}","starred_url":"https://api.github.com/users/kmcgrady/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kmcgrady/subscriptions","organizations_url":"https://api.github.com/users/kmcgrady/orgs","repos_url":"https://api.github.com/users/kmcgrady/repos","events_url":"https://api.github.com/users/kmcgrady/events{/privacy}","received_events_url":"https://api.github.com/users/kmcgrady/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/streamlit/streamlit/issues/9100/reactions","total_count":8,"+1":8,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/streamlit/streamlit/issues/9100/timeline","performed_via_github_app":null,"state_reason":"completed"}