{"url":"https://api.github.com/repos/streamlit/streamlit/issues/3709","repository_url":"https://api.github.com/repos/streamlit/streamlit","labels_url":"https://api.github.com/repos/streamlit/streamlit/issues/3709/labels{/name}","comments_url":"https://api.github.com/repos/streamlit/streamlit/issues/3709/comments","events_url":"https://api.github.com/repos/streamlit/streamlit/issues/3709/events","html_url":"https://github.com/streamlit/streamlit/issues/3709","id":972164135,"node_id":"MDU6SXNzdWU5NzIxNjQxMzU=","number":3709,"title":"df.dtypes fails with Arrow","user":{"login":"tvst","id":690814,"node_id":"MDQ6VXNlcjY5MDgxNA==","avatar_url":"https://avatars.githubusercontent.com/u/690814?v=4","gravatar_id":"","url":"https://api.github.com/users/tvst","html_url":"https://github.com/tvst","followers_url":"https://api.github.com/users/tvst/followers","following_url":"https://api.github.com/users/tvst/following{/other_user}","gists_url":"https://api.github.com/users/tvst/gists{/gist_id}","starred_url":"https://api.github.com/users/tvst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvst/subscriptions","organizations_url":"https://api.github.com/users/tvst/orgs","repos_url":"https://api.github.com/users/tvst/repos","events_url":"https://api.github.com/users/tvst/events{/privacy}","received_events_url":"https://api.github.com/users/tvst/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1516285324,"node_id":"MDU6TGFiZWwxNTE2Mjg1MzI0","url":"https://api.github.com/repos/streamlit/streamlit/labels/type:bug","name":"type:bug","color":"D93F0B","default":false,"description":"Something isn't working"},{"id":1846291968,"node_id":"MDU6TGFiZWwxODQ2MjkxOTY4","url":"https://api.github.com/repos/streamlit/streamlit/labels/area:arrow","name":"area:arrow","color":"C2E0C6","default":false,"description":"Related to Arrow"}],"state":"closed","locked":false,"assignee":{"login":"kantuni","id":6151409,"node_id":"MDQ6VXNlcjYxNTE0MDk=","avatar_url":"https://avatars.githubusercontent.com/u/6151409?v=4","gravatar_id":"","url":"https://api.github.com/users/kantuni","html_url":"https://github.com/kantuni","followers_url":"https://api.github.com/users/kantuni/followers","following_url":"https://api.github.com/users/kantuni/following{/other_user}","gists_url":"https://api.github.com/users/kantuni/gists{/gist_id}","starred_url":"https://api.github.com/users/kantuni/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kantuni/subscriptions","organizations_url":"https://api.github.com/users/kantuni/orgs","repos_url":"https://api.github.com/users/kantuni/repos","events_url":"https://api.github.com/users/kantuni/events{/privacy}","received_events_url":"https://api.github.com/users/kantuni/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"kantuni","id":6151409,"node_id":"MDQ6VXNlcjYxNTE0MDk=","avatar_url":"https://avatars.githubusercontent.com/u/6151409?v=4","gravatar_id":"","url":"https://api.github.com/users/kantuni","html_url":"https://github.com/kantuni","followers_url":"https://api.github.com/users/kantuni/followers","following_url":"https://api.github.com/users/kantuni/following{/other_user}","gists_url":"https://api.github.com/users/kantuni/gists{/gist_id}","starred_url":"https://api.github.com/users/kantuni/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kantuni/subscriptions","organizations_url":"https://api.github.com/users/kantuni/orgs","repos_url":"https://api.github.com/users/kantuni/repos","events_url":"https://api.github.com/users/kantuni/events{/privacy}","received_events_url":"https://api.github.com/users/kantuni/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":1,"created_at":"2021-08-16T23:08:33Z","updated_at":"2021-09-24T04:09:29Z","closed_at":"2021-09-24T04:09:29Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Summary\r\n\r\nUsing `df.dtypes` to show the datatypes for a dataframe fails when you're using the Arrow codepath.\r\n\r\n### Steps to reproduce\r\n\r\nCode snippet:\r\n\r\n```\r\nimport streamlit as st\r\nimport pandas as pd\r\n\r\ndf = pd.read_json(\"https://cdn.jsdelivr.net/npm/vega-datasets@2/data/penguins.json\")\r\n\r\nst.write(df.dtypes)\r\n```\r\n\r\n**Expected behavior:**\r\n\r\nThe app should show a table with datatypes for the given dataframe\r\n\r\n**Actual behavior:**\r\n\r\nThe app shows this exception:\r\n\r\n![image](https://user-images.githubusercontent.com/690814/129639941-0cb162f2-5d85-4e0a-ab90-7ba20c083b8e.png)\r\n\r\nException text\r\n```\r\nArrowInvalid: (\"Could not convert dtype('O') with type numpy.dtype[object_]: did not recognize Python value type when inferring an Arrow data type\", 'Conversion failed for column 0 with type object')\r\nTraceback:\r\nFile \"/home/tvst/.local/share/virtualenvs/streamlit-vega-lite-demo-Se5mEOd4/lib/python3.9/site-packages/streamlit/script_runner.py\", line 350, in _run_script\r\n    exec(code, module.__dict__)\r\nFile \"/media/storage/Projects/streamlit/streamlit-vega-lite-demo/demo.py\", line 15, in <module>\r\n    df.dtypes\r\nFile \"/home/tvst/.local/share/virtualenvs/streamlit-vega-lite-demo-Se5mEOd4/lib/python3.9/site-packages/streamlit/__init__.py\", line 478, in _transparent_write\r\n    write(*args)\r\nFile \"/home/tvst/.local/share/virtualenvs/streamlit-vega-lite-demo-Se5mEOd4/lib/python3.9/site-packages/streamlit/elements/write.py\", line 182, in write\r\n    self.dg.dataframe(arg)\r\nFile \"/home/tvst/.local/share/virtualenvs/streamlit-vega-lite-demo-Se5mEOd4/lib/python3.9/site-packages/streamlit/elements/dataframe_selector.py\", line 85, in dataframe\r\n    return self.dg._arrow_dataframe(data, width, height)\r\nFile \"/home/tvst/.local/share/virtualenvs/streamlit-vega-lite-demo-Se5mEOd4/lib/python3.9/site-packages/streamlit/elements/arrow.py\", line 82, in _arrow_dataframe\r\n    marshall(proto, data, default_uuid)\r\nFile \"/home/tvst/.local/share/virtualenvs/streamlit-vega-lite-demo-Se5mEOd4/lib/python3.9/site-packages/streamlit/elements/arrow.py\", line 160, in marshall\r\n    proto.data = type_util.data_frame_to_bytes(df)\r\nFile \"/home/tvst/.local/share/virtualenvs/streamlit-vega-lite-demo-Se5mEOd4/lib/python3.9/site-packages/streamlit/type_util.py\", line 371, in data_frame_to_bytes\r\n    table = pa.Table.from_pandas(df)\r\nFile \"pyarrow/table.pxi\", line 1561, in pyarrow.lib.Table.from_pandas\r\nFile \"/home/tvst/.local/share/virtualenvs/streamlit-vega-lite-demo-Se5mEOd4/lib64/python3.9/site-packages/pyarrow/pandas_compat.py\", line 594, in dataframe_to_arrays\r\n    arrays = [convert_column(c, f)\r\nFile \"/home/tvst/.local/share/virtualenvs/streamlit-vega-lite-demo-Se5mEOd4/lib64/python3.9/site-packages/pyarrow/pandas_compat.py\", line 594, in <listcomp>\r\n    arrays = [convert_column(c, f)\r\nFile \"/home/tvst/.local/share/virtualenvs/streamlit-vega-lite-demo-Se5mEOd4/lib64/python3.9/site-packages/pyarrow/pandas_compat.py\", line 581, in convert_column\r\n    raise e\r\nFile \"/home/tvst/.local/share/virtualenvs/streamlit-vega-lite-demo-Se5mEOd4/lib64/python3.9/site-packages/pyarrow/pandas_compat.py\", line 575, in convert_column\r\n    result = pa.array(col, type=type_, from_pandas=True, safe=safe)\r\nFile \"pyarrow/array.pxi\", line 302, in pyarrow.lib.array\r\nFile \"pyarrow/array.pxi\", line 83, in pyarrow.lib._ndarray_to_array\r\nFile \"pyarrow/error.pxi\", line 99, in pyarrow.lib.check_status\r\n```\r\n\r\n### Is this a regression?\r\n\r\nyes (arrow vs legacy)\r\n\r\n### Debug info\r\n\r\n- Streamlit version: 0.86.0","closed_by":{"login":"kantuni","id":6151409,"node_id":"MDQ6VXNlcjYxNTE0MDk=","avatar_url":"https://avatars.githubusercontent.com/u/6151409?v=4","gravatar_id":"","url":"https://api.github.com/users/kantuni","html_url":"https://github.com/kantuni","followers_url":"https://api.github.com/users/kantuni/followers","following_url":"https://api.github.com/users/kantuni/following{/other_user}","gists_url":"https://api.github.com/users/kantuni/gists{/gist_id}","starred_url":"https://api.github.com/users/kantuni/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kantuni/subscriptions","organizations_url":"https://api.github.com/users/kantuni/orgs","repos_url":"https://api.github.com/users/kantuni/repos","events_url":"https://api.github.com/users/kantuni/events{/privacy}","received_events_url":"https://api.github.com/users/kantuni/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/streamlit/streamlit/issues/3709/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/streamlit/streamlit/issues/3709/timeline","performed_via_github_app":null,"state_reason":"completed"}