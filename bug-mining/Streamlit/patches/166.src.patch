diff --git a/lib/streamlit/runtime/credentials.py b/lib/streamlit/runtime/credentials.py
index c835e85a1..ff44089f9 100644
--- a/lib/streamlit/runtime/credentials.py
+++ b/lib/streamlit/runtime/credentials.py
@@ -247,8 +247,6 @@ class Credentials:
                     "`streamlit activate reset` then `streamlit activate`"
                 )
         else:
-            if not config.get_option("server.showEmailPrompt"):
-                return
             activated = False
 
             while not activated:
@@ -345,9 +343,11 @@ def check_credentials() -> None:
     check, since credential would be automatically set to an empty string.
 
     """
-    from streamlit import config
 
-    if not _check_credential_file_exists() and config.get_option("server.headless"):
+    if not _check_credential_file_exists() and (
+        config.get_option("server.headless")
+        or not config.get_option("server.showEmailPrompt")
+    ):
         if not config.is_manually_set("browser.gatherUsageStats"):
             # If not manually defined, show short message about usage stats gathering.
             cli_util.print_to_cli(_TELEMETRY_HEADLESS_TEXT)
diff --git a/lib/tests/streamlit/web/cli_test.py b/lib/tests/streamlit/web/cli_test.py
index 8736f705c..8b7e2c6fe 100644
--- a/lib/tests/streamlit/web/cli_test.py
+++ b/lib/tests/streamlit/web/cli_test.py
@@ -410,7 +410,7 @@ class CliTest(unittest.TestCase):
 
             # Assert that makedirs was never called to create ~/.streamlit directory
             mock_makedirs.assert_not_called()
-            assert result.exit_code != 0
+            assert result.exit_code == 0
 
     def test_streamlit_folder_created_when_show_email_prompt_true(self):
         """Test that ~/.streamlit directory is created when server.showEmailPrompt=True."""
