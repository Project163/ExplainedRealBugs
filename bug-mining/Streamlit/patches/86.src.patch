diff --git a/NOTICES b/NOTICES
index 985a5f8f2..99626afd5 100644
--- a/NOTICES
+++ b/NOTICES
@@ -19423,6 +19423,30 @@ CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 
 -----
 
+The following software may be included in this product: urlpattern-polyfill. A copy of the source code may be downloaded from https://github.com/kenchris/urlpattern-polyfill. This software contains the following license and notice below:
+
+Copyright 2020 Intel Corporation
+
+Permission is hereby granted, free of charge, to any person obtaining a copy
+of this software and associated documentation files (the "Software"), to deal
+in the Software without restriction, including without limitation the rights
+to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
+copies of the Software, and to permit persons to whom the Software is
+furnished to do so, subject to the following conditions:
+
+The above copyright notice and this permission notice shall be included in
+all copies or substantial portions of the Software.
+
+THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
+AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
+LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
+OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
+THE SOFTWARE.
+
+-----
+
 The following software may be included in this product: use-isomorphic-layout-effect. A copy of the source code may be downloaded from git+https://github.com/Andarist/use-isomorphic-layout-effect.git. This software contains the following license and notice below:
 
 MIT License
diff --git a/frontend/lib/package.json b/frontend/lib/package.json
index 2f38b191b..e706e264a 100644
--- a/frontend/lib/package.json
+++ b/frontend/lib/package.json
@@ -79,6 +79,7 @@
     "native-file-system-adapter": "^3.0.1",
     "node-emoji": "^1.11.0",
     "numbro": "^2.5.0",
+    "urlpattern-polyfill": "^10.0.0",
     "plotly.js": "^2.34.0",
     "protobufjs": "^7.2.5",
     "query-string": "^8.1.0",
diff --git a/frontend/lib/src/util/UriUtil.test.ts b/frontend/lib/src/util/UriUtil.test.ts
index 7455a92ea..c3791aa98 100644
--- a/frontend/lib/src/util/UriUtil.test.ts
+++ b/frontend/lib/src/util/UriUtil.test.ts
@@ -162,24 +162,24 @@ describe("isValidOrigin", () => {
     // allowedOrigin doesn't have a protocol
     expect(
       isValidOrigin("devel.streamlit.io", "http://devel.streamlit.io")
-    ).toBeFalsy()
+    ).toBe(false)
   })
 
   it("returns false if testOrigin is invalid", () => {
     // testOrigin doesn't have a protocol
     expect(
       isValidOrigin("http://devel.streamlit.io", "devel.streamlit.io")
-    ).toBeFalsy()
+    ).toBe(false)
   })
 
   it("returns true if testUrl's hostname is localhost w/ various ports", () => {
     expect(
       isValidOrigin(
-        "http:localhost",
+        "http://localhost",
         // Example of localhost url used for manual testing
         "http://localhost:8000"
       )
-    ).toBeTruthy()
+    ).toBe(true)
 
     expect(
       isValidOrigin(
@@ -187,13 +187,37 @@ describe("isValidOrigin", () => {
         // Example of localhost url used by e2e test
         "http://localhost:35475"
       )
-    ).toBeTruthy()
+    ).toBe(true)
+  })
+
+  it("returns false if testUrl's hostname is localhost but protocol doesn't match", () => {
+    expect(isValidOrigin("http://localhost", "https://localhost")).toBe(false)
+
+    expect(
+      isValidOrigin("https://localhost:8000", "http://localhost:8000")
+    ).toBe(false)
+
+    expect(
+      isValidOrigin(
+        "https:localhost",
+        // Example of localhost url used for manual testing
+        "http://localhost:8000"
+      )
+    ).toBe(false)
+
+    expect(
+      isValidOrigin(
+        "http://localhost",
+        // Example of localhost url used by e2e test
+        "https://localhost:35475"
+      )
+    ).toBe(false)
   })
 
   it("returns false if protocols don't match", () => {
     expect(
       isValidOrigin("https://devel.streamlit.io", "http://devel.streamlit.io")
-    ).toBeFalsy()
+    ).toBe(false)
   })
 
   it("returns false if ports don't match", () => {
@@ -202,32 +226,236 @@ describe("isValidOrigin", () => {
         "https://devel.streamlit.io:8080",
         "https://devel.streamlit.io"
       )
-    ).toBeFalsy()
+    ).toBe(false)
   })
 
   it("returns true when the pattern and url are the same", () => {
     expect(
       isValidOrigin("http://devel.streamlit.io", "http://devel.streamlit.io")
-    ).toBeTruthy()
+    ).toBe(true)
   })
 
-  it("returns false if it has different form", () => {
-    expect(isValidOrigin("https://*.com", "https://test.test.com")).toBeFalsy()
+  it("returns true when the pattern and url are the same for localhost", () => {
+    expect(
+      isValidOrigin("http://localhost:3000", "http://localhost:3000")
+    ).toBe(true)
   })
 
-  it("returns true if it matches the pattern", () => {
-    expect(isValidOrigin("https://*.com", "https://a.com")).toBeTruthy()
-    expect(isValidOrigin("https://*.a.com", "https://asd.a.com")).toBeTruthy()
-    expect(
-      isValidOrigin("https://www.*.a.com", "https://www.asd.a.com")
-    ).toBeTruthy()
-    expect(
-      isValidOrigin("https://abc.*.*.a.com", "https://abc.def.xyz.a.com")
-    ).toBeTruthy()
+  it("should recognize wildcards in Firefox", () => {
+    // In Firefox, the URL constructor crashes on URLs containing `*`,
+    // for example `new URL("https://*.streamlit.app"). This used to not
+    // allow to receive messages from Cloud Community apps. Make sure this
+    // issue is fixed.
+    const OrigURL = globalThis.URL
+    try {
+      globalThis.URL = function (url: string, ...rest: any[]) {
+        if (url.includes("*")) {
+          throw new Error("Invalid URL")
+        }
+        return new OrigURL(url, ...rest)
+      } as any
+      expect(
+        isValidOrigin(
+          "https://*.streamlit.app",
+          "https://example.streamlit.app"
+        )
+      ).toBe(true)
+    } finally {
+      globalThis.URL = OrigURL
+    }
   })
 
-  it("returns false if it doesn't match the pattern", () => {
-    expect(isValidOrigin("https://*.b.com", "https://www.c.com")).toBeFalsy()
+  describe("pattern matching", () => {
+    it("handles the '*.' pattern", () => {
+      expect(isValidOrigin("https://*.com", "https://a.com")).toBe(true)
+      expect(isValidOrigin("https://*.a.com", "https://asd.a.com")).toBe(true)
+      expect(
+        isValidOrigin("https://www.*.a.com", "https://www.asd.a.com")
+      ).toBe(true)
+      expect(
+        isValidOrigin("https://abc.*.*.a.com", "https://abc.def.xyz.a.com")
+      ).toBe(true)
+      expect(
+        isValidOrigin("https://*.com", "https://example.example.com")
+      ).toBe(true)
+
+      expect(isValidOrigin("https://*.b.com", "https://www.c.com")).toBe(false)
+    })
+
+    it("handles the '{*.}?' pattern", () => {
+      expect(
+        isValidOrigin("https://{*.}?example.com", "https://cdn.example.com")
+      ).toBe(true)
+      expect(
+        isValidOrigin("https://{*.}?example.com", "https://example.com")
+      ).toBe(true)
+
+      expect(
+        isValidOrigin("https://{*.}?example.com", "https://www-example.com")
+      ).toBe(false)
+    })
+
+    it("handles the '{cdn.}?' pattern", () => {
+      expect(
+        isValidOrigin("https://{cdn.}?example.com", "https://cdn.example.com")
+      ).toBe(true)
+      expect(
+        isValidOrigin("https://{cdn.}?example.com", "https://example.com")
+      ).toBe(true)
+
+      expect(
+        isValidOrigin("https://{cdn.}?example.com", "https://www.example.com")
+      ).toBe(false)
+      expect(
+        isValidOrigin("https://{cdn.}?example.com", "https://cdn-example.com")
+      ).toBe(false)
+    })
+
+    it("handles the '{www.cdn.}?' pattern", () => {
+      expect(
+        isValidOrigin(
+          "https://{www.cdn.}?example.com",
+          "https://www.cdn.example.com"
+        )
+      ).toBe(true)
+      expect(
+        isValidOrigin("https://{www.cdn.}?example.com", "https://example.com")
+      ).toBe(true)
+
+      expect(
+        isValidOrigin(
+          "https://{www.cdn.}?example.com",
+          "https://cdn.example.com"
+        )
+      ).toBe(false)
+      expect(
+        isValidOrigin(
+          "https://{www.cdn.}?example.com",
+          "https://www.example.com"
+        )
+      ).toBe(false)
+      expect(
+        isValidOrigin(
+          "https://{www.cdn.}?example.com",
+          "https://www.cdn-example.com"
+        )
+      ).toBe(false)
+    })
+
+    it("handles the 'cdn-*' pattern", () => {
+      expect(
+        isValidOrigin(
+          "https://cdn-*.example.com",
+          "https://cdn-123.example.com"
+        )
+      ).toBe(true)
+      expect(
+        isValidOrigin("https://cdn-*.example.com", "https://cdn-.example.com")
+      ).toBe(true)
+
+      expect(
+        isValidOrigin(
+          "https://cdn-*.example.com",
+          "https://cdn.123.example.com"
+        )
+      ).toBe(false)
+      expect(
+        isValidOrigin("https://cdn-*.example.com", "https://cdn.example.com")
+      ).toBe(false)
+    })
+
+    it("handles the ':id' pattern", () => {
+      expect(
+        isValidOrigin(
+          "https://cdn-:id.example.com",
+          "https://cdn-123.example.com"
+        )
+      ).toBe(true)
+
+      expect(
+        isValidOrigin(
+          "https://cdn-:id.example.com",
+          "https://cdn-.example.com"
+        )
+      ).toBe(false)
+      expect(
+        isValidOrigin(
+          "https://cdn-:id.example.com",
+          "https://cdn.123.example.com"
+        )
+      ).toBe(false)
+      expect(
+        isValidOrigin("https://cdn-:id.example.com", "https://cdn.example.com")
+      ).toBe(false)
+    })
+
+    it("handles regex patterns", () => {
+      expect(
+        isValidOrigin(
+          "https://(cdn|www).example.com",
+          "https://cdn.example.com"
+        )
+      ).toBe(true)
+      expect(
+        isValidOrigin(
+          "https://(cdn|www).example.com",
+          "https://www.example.com"
+        )
+      ).toBe(true)
+      expect(isValidOrigin("https://(\\w+).com", "https://example.com")).toBe(
+        true
+      )
+
+      expect(
+        isValidOrigin(
+          "https://(cdn|www).example.com",
+          "https://dev.example.com"
+        )
+      ).toBe(false)
+      expect(
+        isValidOrigin(
+          "https://(cdn|www).example.com",
+          "https://ww.example.com"
+        )
+      ).toBe(false)
+      expect(
+        isValidOrigin(
+          "https://(cdn|www).example.com",
+          "https://cdn.123.example.com"
+        )
+      ).toBe(false)
+      expect(
+        isValidOrigin("https://(\\w+).com", "https://example.example.com")
+      ).toBe(false)
+    })
+
+    it("handles patterns in the protocol part", () => {
+      expect(
+        isValidOrigin("https://example.com:*", "https://example.com")
+      ).toBe(true)
+      expect(
+        isValidOrigin("https://example.com:*", "https://example.com:8080")
+      ).toBe(true)
+      expect(
+        isValidOrigin("https://example.com:80*", "https://example.com:8080")
+      ).toBe(true)
+      expect(
+        isValidOrigin("https://example.com:80*", "https://example.com:8091")
+      ).toBe(true)
+      expect(
+        isValidOrigin("https://example.com:80*", "https://example.com:80")
+      ).toBe(true)
+
+      expect(
+        isValidOrigin("https://example.com:*", "https://example.www.com:8080")
+      ).toBe(false)
+      expect(
+        isValidOrigin("https://example.com:80*", "https://example.com:3000")
+      ).toBe(false)
+      expect(
+        isValidOrigin("https://example.com:80*", "https://example.com:91")
+      ).toBe(false)
+    })
   })
 })
 
diff --git a/frontend/lib/src/util/UriUtil.ts b/frontend/lib/src/util/UriUtil.ts
index bf15e9065..ea910bf19 100644
--- a/frontend/lib/src/util/UriUtil.ts
+++ b/frontend/lib/src/util/UriUtil.ts
@@ -14,6 +14,10 @@
  * limitations under the License.
  */
 
+// Remove once support for URLPattern is added to all major browsers
+// https://caniuse.com/mdn-api_urlpattern
+import "urlpattern-polyfill"
+
 import take from "lodash/take"
 
 import { IS_DEV_ENV, WEBSOCKET_PORT_DEV } from "@streamlit/lib/src/baseconsts"
@@ -147,14 +151,19 @@ function isHttps(): boolean {
  * ignored.
  */
 export function isValidOrigin(
-  allowedOrigin: string,
+  allowedOriginPattern: string,
   testOrigin: string
 ): boolean {
-  let allowedUrl: URL
+  let allowedUrlPattern: URLPattern
+  let allowedPortLessPattern: URLPattern
   let testUrl: URL
 
   try {
-    allowedUrl = new URL(allowedOrigin)
+    allowedUrlPattern = new URLPattern(allowedOriginPattern)
+    allowedPortLessPattern = new URLPattern({
+      protocol: allowedUrlPattern.protocol,
+      hostname: allowedUrlPattern.hostname,
+    })
     testUrl = new URL(testOrigin)
   } catch {
     return false
@@ -163,32 +172,11 @@ export function isValidOrigin(
   // Allow localhost w/ any port for testing of host <-> guest communication
   // using hostframe.html (facilitates manual & e2e testing)
   if (
-    allowedUrl.protocol !== testUrl.protocol ||
-    (allowedUrl.port !== testUrl.port && testUrl.hostname !== "localhost")
+    testUrl.hostname === "localhost" &&
+    allowedPortLessPattern.test(testUrl)
   ) {
-    return false
+    return true
   }
 
-  const { hostname: pattern } = allowedUrl
-  const { hostname } = testUrl
-
-  if (pattern === hostname) return true
-
-  // Web browsers will encode the wildcard character in the pattern being
-  // tested into %2A when parsing allowedOrigin into a URL, so we either have
-  // to convert it back here or test against "%2A" below. There's unfortunately
-  // no great way to write a unit test for this because the behavior differs
-  // between nodejs test environments and a real browser :(
-  const splitPattern = pattern.replace(/%2A/g, "*").split(".")
-  const splitHostname = hostname.split(".")
-
-  if (splitPattern.length !== splitHostname.length) return false
-
-  return splitPattern.every((el, index) => {
-    if (el === "*") {
-      return true
-    }
-
-    return el === splitHostname[index]
-  })
+  return allowedUrlPattern.test(testUrl)
 }
diff --git a/frontend/yarn.lock b/frontend/yarn.lock
index 542f0302f..89a4a6f85 100644
--- a/frontend/yarn.lock
+++ b/frontend/yarn.lock
@@ -11296,6 +11296,11 @@ url-parse@^1.5.3:
     querystringify "^2.1.1"
     requires-port "^1.0.0"
 
+urlpattern-polyfill@^10.0.0:
+  version "10.0.0"
+  resolved "https://registry.yarnpkg.com/urlpattern-polyfill/-/urlpattern-polyfill-10.0.0.tgz#f0a03a97bfb03cdf33553e5e79a2aadd22cac8ec"
+  integrity sha512-H/A06tKD7sS1O1X2SshBVeA5FLycRpjqiBeqGKmBwBDBy28EnRjORxTNe269KSSr5un5qyWi1iL61wLxpd+ZOg==
+
 use-callback-ref@^1.3.2:
   version "1.3.2"
   resolved "https://registry.yarnpkg.com/use-callback-ref/-/use-callback-ref-1.3.2.tgz#6134c7f6ff76e2be0b56c809b17a650c942b1693"
