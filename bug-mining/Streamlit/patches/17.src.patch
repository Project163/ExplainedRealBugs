diff --git a/lib/streamlit/state/session_state.py b/lib/streamlit/state/session_state.py
index 5edc532b2..161cf14a2 100644
--- a/lib/streamlit/state/session_state.py
+++ b/lib/streamlit/state/session_state.py
@@ -308,13 +308,18 @@ class SessionState(MutableMapping[str, Any]):
         wid_key_map = self.reverse_key_wid_map
 
         state: Dict[str, Any] = {}
-        for k, v in self.items():
+
+        # We can't write `for k, v in self.items()` here because doing so will
+        # run into a `KeyError` if widget metadata has been cleared (which
+        # happens when the streamlit server restarted or the cache was cleared),
+        # then we receive a widget's state from a browser.
+        for k in self.keys():
             if not is_widget_id(k) and not is_internal_key(k):
-                state[k] = v
+                state[k] = self[k]
             elif is_keyed_widget_id(k):
                 try:
                     key = wid_key_map[k]
-                    state[key] = v
+                    state[key] = self[k]
                 except KeyError:
                     # Widget id no longer maps to a key, it is a not yet
                     # cleared value in old state for a reset widget
diff --git a/lib/tests/streamlit/state/session_state_test.py b/lib/tests/streamlit/state/session_state_test.py
index 9cd1b105f..16c46a786 100644
--- a/lib/tests/streamlit/state/session_state_test.py
+++ b/lib/tests/streamlit/state/session_state_test.py
@@ -497,6 +497,21 @@ class SessionStateMethodTests(unittest.TestCase):
             "corge": "grault",
         }
 
+    def test_filtered_state_resilient_to_missing_metadata(self):
+        old_state = {"foo": "bar", "corge": "grault"}
+        new_session_state = {}
+        new_widget_state = WStates(
+            {f"{GENERATED_WIDGET_KEY_PREFIX}-baz": Serialized(None)},
+        )
+        self.session_state = SessionState(
+            old_state, new_session_state, new_widget_state
+        )
+
+        assert self.session_state.filtered_state == {
+            "foo": "bar",
+            "corge": "grault",
+        }
+
     def is_new_state_value(self):
         assert self.session_state.is_new_state_value("foo")
         assert not self.session_state.is_new_state_value("corge")
