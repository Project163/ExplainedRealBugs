diff --git a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-height-long-code[dark_theme-chromium].png b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-height-long-code[dark_theme-chromium].png
index d9c8d8860..5c0d7f5f3 100644
Binary files a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-height-long-code[dark_theme-chromium].png and b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-height-long-code[dark_theme-chromium].png differ
diff --git a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-height-long-code[dark_theme-firefox].png b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-height-long-code[dark_theme-firefox].png
index 2c5a973ea..62c852fce 100644
Binary files a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-height-long-code[dark_theme-firefox].png and b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-height-long-code[dark_theme-firefox].png differ
diff --git a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-height-long-code[light_theme-chromium].png b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-height-long-code[light_theme-chromium].png
index d8032b984..1476af334 100644
Binary files a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-height-long-code[light_theme-chromium].png and b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-height-long-code[light_theme-chromium].png differ
diff --git a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-height-long-code[light_theme-firefox].png b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-height-long-code[light_theme-firefox].png
index f3aee6043..c222a3aab 100644
Binary files a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-height-long-code[light_theme-firefox].png and b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-height-long-code[light_theme-firefox].png differ
diff --git a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-no_wrap[dark_theme-chromium].png b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-no_wrap[dark_theme-chromium].png
index bf6c31f18..6792852b2 100644
Binary files a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-no_wrap[dark_theme-chromium].png and b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-no_wrap[dark_theme-chromium].png differ
diff --git a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-no_wrap[dark_theme-firefox].png b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-no_wrap[dark_theme-firefox].png
index 558921f29..768ed6be0 100644
Binary files a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-no_wrap[dark_theme-firefox].png and b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-no_wrap[dark_theme-firefox].png differ
diff --git a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-no_wrap[light_theme-chromium].png b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-no_wrap[light_theme-chromium].png
index eab8f84e0..8f8cd4831 100644
Binary files a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-no_wrap[light_theme-chromium].png and b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-no_wrap[light_theme-chromium].png differ
diff --git a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-no_wrap[light_theme-firefox].png b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-no_wrap[light_theme-firefox].png
index 2585e7d58..5322ff088 100644
Binary files a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-no_wrap[light_theme-firefox].png and b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-no_wrap[light_theme-firefox].png differ
diff --git a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-numbers-no_wrap[dark_theme-chromium].png b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-numbers-no_wrap[dark_theme-chromium].png
index e3cc42743..fa0976104 100644
Binary files a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-numbers-no_wrap[dark_theme-chromium].png and b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-numbers-no_wrap[dark_theme-chromium].png differ
diff --git a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-numbers-no_wrap[light_theme-chromium].png b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-numbers-no_wrap[light_theme-chromium].png
index 8b11cc79d..c3daf0d94 100644
Binary files a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-numbers-no_wrap[light_theme-chromium].png and b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-numbers-no_wrap[light_theme-chromium].png differ
diff --git a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-numbers-no_wrap[light_theme-firefox].png b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-numbers-no_wrap[light_theme-firefox].png
index c443c427d..4a54cb57a 100644
Binary files a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-numbers-no_wrap[light_theme-firefox].png and b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-numbers-no_wrap[light_theme-firefox].png differ
diff --git a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-numbers-wrap[dark_theme-chromium].png b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-numbers-wrap[dark_theme-chromium].png
index 932352cba..8cb14a449 100644
Binary files a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-numbers-wrap[dark_theme-chromium].png and b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-numbers-wrap[dark_theme-chromium].png differ
diff --git a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-numbers-wrap[dark_theme-firefox].png b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-numbers-wrap[dark_theme-firefox].png
index 702d2b190..1a5834be0 100644
Binary files a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-numbers-wrap[dark_theme-firefox].png and b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-numbers-wrap[dark_theme-firefox].png differ
diff --git a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-numbers-wrap[light_theme-chromium].png b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-numbers-wrap[light_theme-chromium].png
index a731d1b9e..20890cf01 100644
Binary files a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-numbers-wrap[light_theme-chromium].png and b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-numbers-wrap[light_theme-chromium].png differ
diff --git a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-numbers-wrap[light_theme-firefox].png b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-numbers-wrap[light_theme-firefox].png
index a908fca10..2cf165da3 100644
Binary files a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-numbers-wrap[light_theme-firefox].png and b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-numbers-wrap[light_theme-firefox].png differ
diff --git a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-wrap[dark_theme-chromium].png b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-wrap[dark_theme-chromium].png
index fbd44970e..fee606638 100644
Binary files a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-wrap[dark_theme-chromium].png and b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-wrap[dark_theme-chromium].png differ
diff --git a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-wrap[dark_theme-firefox].png b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-wrap[dark_theme-firefox].png
index 0bc8848e9..b647c6f62 100644
Binary files a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-wrap[dark_theme-firefox].png and b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-wrap[dark_theme-firefox].png differ
diff --git a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-wrap[light_theme-chromium].png b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-wrap[light_theme-chromium].png
index bbdf4ca7e..3c594d70e 100644
Binary files a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-wrap[light_theme-chromium].png and b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-wrap[light_theme-chromium].png differ
diff --git a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-wrap[light_theme-firefox].png b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-wrap[light_theme-firefox].png
index aa5dfe707..567f1c757 100644
Binary files a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-wrap[light_theme-firefox].png and b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-long-wrap[light_theme-firefox].png differ
diff --git a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-width_pixels[chromium].png b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-width_pixels[chromium].png
index 9e7e101bf..bdad63f71 100644
Binary files a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-width_pixels[chromium].png and b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-width_pixels[chromium].png differ
diff --git a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-width_pixels[firefox].png b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-width_pixels[firefox].png
index 1db8c0edb..cedf9acba 100644
Binary files a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-width_pixels[firefox].png and b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-width_pixels[firefox].png differ
diff --git a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-width_stretch[chromium].png b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-width_stretch[chromium].png
index aa4d4c42e..4d3dc6cce 100644
Binary files a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-width_stretch[chromium].png and b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-width_stretch[chromium].png differ
diff --git a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-width_stretch[firefox].png b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-width_stretch[firefox].png
index a31d00313..f4b660d7e 100644
Binary files a/e2e_playwright/__snapshots__/linux/st_code_test/st_code-width_stretch[firefox].png and b/e2e_playwright/__snapshots__/linux/st_code_test/st_code-width_stretch[firefox].png differ
diff --git a/e2e_playwright/st_code.py b/e2e_playwright/st_code.py
index fa0d10c8c..40d58fa5c 100644
--- a/e2e_playwright/st_code.py
+++ b/e2e_playwright/st_code.py
@@ -46,6 +46,19 @@ st.code(
     language="diff",
 )
 
+code_with_leading_whitespace = """
+    def hello():
+        print("Hello, Streamlit!")
+"""
+
+st.code(code_with_leading_whitespace, language="python")
+
+st.markdown("```python\n" + code_with_leading_whitespace + "\n```")
+
+st.code("\n" + code_with_leading_whitespace + "\n", language="python")
+
+st.markdown("```python\n\n" + code_with_leading_whitespace + "\n\n```")
+
 with st.expander("`st.code` usage", expanded=True):
     st.code(code, language="python")
     st.code(code, language="python")
diff --git a/e2e_playwright/st_code_test.py b/e2e_playwright/st_code_test.py
index 2cb47e779..bda73e25e 100644
--- a/e2e_playwright/st_code_test.py
+++ b/e2e_playwright/st_code_test.py
@@ -12,6 +12,9 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
+import re
+import textwrap
+
 from playwright.sync_api import Page, expect
 
 from e2e_playwright.conftest import ImageCompareFunction
@@ -20,8 +23,42 @@ from e2e_playwright.shared.app_utils import check_top_level_class
 
 def test_code_display(app: Page):
     """Test that st.code displays a code block."""
-    code_element = app.get_by_test_id("stCode").first
-    expect(code_element).to_contain_text("This code is awesome!")
+    # The code blocks might require a bit more time for rendering, so wait until
+    # the text is truly visible. Otherwise we might get blank code blocks in the
+    # screenshots.
+    foo_func_count = 5
+    app.wait_for_function(
+        f"()=>document.body.textContent.split('def foo()').length === {foo_func_count}"
+    )
+
+    code = textwrap.dedent(
+        """
+        def hello():
+            print("Hello, Streamlit!")
+        """
+    ).strip()
+    code_with_whitespace = textwrap.indent(code, "    ")
+    code_pattern = re.escape(code)
+    code_with_whitespace_pattern = re.escape(code_with_whitespace)
+
+    code_blocks = app.get_by_test_id("stCode")
+    # `to_contain_text` does not support pattern /\A\Z/, use /^$/ instead.
+    expect(code_blocks.nth(0)).to_contain_text(re.compile(r"^# This code is awesome!$"))
+    expect(code_blocks.nth(1)).to_contain_text(re.compile(r"^$"))
+    expect(code_blocks.nth(2)).to_contain_text(re.compile(rf"^{code_pattern}$"))
+    expect(code_blocks.nth(5)).to_contain_text(re.compile(rf"^{code_pattern}\n$"))
+    expect(code_blocks.nth(7)).to_contain_text(
+        re.compile(rf"^{code_with_whitespace_pattern}$")
+    )
+    expect(code_blocks.nth(8)).to_contain_text(
+        re.compile(rf"^{code_with_whitespace_pattern}\n$")
+    )
+    expect(code_blocks.nth(9)).to_contain_text(
+        re.compile(rf"^\n{code_with_whitespace_pattern}\n$")
+    )
+    expect(code_blocks.nth(10)).to_contain_text(
+        re.compile(rf"^\n{code_with_whitespace_pattern}\n\n$")
+    )
 
 
 def test_syntax_highlighting(themed_app: Page, assert_snapshot: ImageCompareFunction):
@@ -36,7 +73,7 @@ def test_code_blocks_render_correctly(
 ):
     """Test that the code blocks render as expected via screenshot matching."""
     code_blocks = themed_app.get_by_test_id("stCode")
-    expect(code_blocks).to_have_count(19)
+    expect(code_blocks).to_have_count(23)
     # The code blocks might require a bit more time for rendering, so wait until
     # the text is truly visible. Otherwise we might get blank code blocks in the
     # screenshots.
@@ -45,7 +82,7 @@ def test_code_blocks_render_correctly(
         f"()=>document.body.textContent.split('def foo()').length === {foo_func_count}"
     )
     # Check that there are 15 code blocks with the class "language-python"
-    expect(themed_app.locator("code.language-python")).to_have_count(17)
+    expect(themed_app.locator("code.language-python")).to_have_count(21)
 
     assert_snapshot(code_blocks.nth(0), name="st_code-auto_lang")
     assert_snapshot(code_blocks.nth(1), name="st_code-empty")
@@ -58,15 +95,15 @@ def test_code_blocks_render_correctly(
     # Test long lines draw as expected.
     # The screenshot for long-no_wrap seems to be a bit flaky, scrolling
     # it into view seems to help fix this (but not sure why).
-    code_blocks.nth(11).scroll_into_view_if_needed()
-    assert_snapshot(code_blocks.nth(11), name="st_code-long-no_wrap")
-    assert_snapshot(code_blocks.nth(12), name="st_code-long-numbers-no_wrap")
-    assert_snapshot(code_blocks.nth(13), name="st_code-long-wrap")
-    assert_snapshot(code_blocks.nth(14), name="st_code-long-numbers-wrap")
+    code_blocks.nth(15).scroll_into_view_if_needed()
+    assert_snapshot(code_blocks.nth(15), name="st_code-long-no_wrap")
+    assert_snapshot(code_blocks.nth(16), name="st_code-long-numbers-no_wrap")
+    assert_snapshot(code_blocks.nth(17), name="st_code-long-wrap")
+    assert_snapshot(code_blocks.nth(18), name="st_code-long-numbers-wrap")
 
     # Test height prop
-    assert_snapshot(code_blocks.nth(15), name="st_code-height-long-code")
-    assert_snapshot(code_blocks.nth(16), name="st_code-height-short-code")
+    assert_snapshot(code_blocks.nth(19), name="st_code-height-long-code")
+    assert_snapshot(code_blocks.nth(20), name="st_code-height-short-code")
 
 
 def test_correct_bottom_spacing_for_code_blocks(app: Page):
@@ -94,21 +131,21 @@ def test_line_wrap(app: Page):
 
     # When line-wrap is off, the "EOL" token should not be visible.
 
-    curr_block = code_blocks.nth(11)
+    curr_block = code_blocks.nth(15)
     curr_block.scroll_into_view_if_needed()
     expect(curr_block.get_by_text("EOL")).not_to_be_in_viewport()
 
-    curr_block = code_blocks.nth(12)
+    curr_block = code_blocks.nth(16)
     curr_block.scroll_into_view_if_needed()
     expect(curr_block.get_by_text("EOL")).not_to_be_in_viewport()
 
     # When line-wrap is on, the "EOL" token should be visible.
 
-    curr_block = code_blocks.nth(13)
+    curr_block = code_blocks.nth(17)
     curr_block.scroll_into_view_if_needed()
     expect(curr_block.get_by_text("EOL")).to_be_in_viewport()
 
-    curr_block = code_blocks.nth(14)
+    curr_block = code_blocks.nth(18)
     curr_block.scroll_into_view_if_needed()
     expect(curr_block.get_by_text("EOL")).to_be_in_viewport()
 
@@ -118,14 +155,14 @@ def test_height_parameter(app: Page):
     code_blocks = app.get_by_test_id("stCode")
 
     # Test long code with fixed height
-    curr_block = code_blocks.nth(15)
+    curr_block = code_blocks.nth(19)
     curr_block.scroll_into_view_if_needed()
     expect(curr_block.locator("pre")).to_have_css("height", "200px")
     # The "EOL" token at the end of the code block should not be visible.
     expect(curr_block.get_by_text("EOL")).not_to_be_in_viewport()
 
     # Test short code with fixed height
-    curr_block = code_blocks.nth(16)
+    curr_block = code_blocks.nth(20)
     curr_block.scroll_into_view_if_needed()
     expect(curr_block.locator("pre")).to_have_css("height", "200px")
 
@@ -136,5 +173,5 @@ def test_width_configurations(app: Page, assert_snapshot: ImageCompareFunction):
     code_elements = app.get_by_test_id("stCode")
 
     # Test longer code blocks with different widths
-    assert_snapshot(code_elements.nth(17), name="st_code-width_pixels")
-    assert_snapshot(code_elements.nth(18), name="st_code-width_stretch")
+    assert_snapshot(code_elements.nth(21), name="st_code-width_pixels")
+    assert_snapshot(code_elements.nth(22), name="st_code-width_stretch")
diff --git a/frontend/lib/src/components/shared/StreamlitMarkdown/Heading.test.tsx b/frontend/lib/src/components/shared/StreamlitMarkdown/Heading.test.tsx
index 6251c1178..09c456679 100644
--- a/frontend/lib/src/components/shared/StreamlitMarkdown/Heading.test.tsx
+++ b/frontend/lib/src/components/shared/StreamlitMarkdown/Heading.test.tsx
@@ -172,7 +172,7 @@ describe("Heading", () => {
     render(<Heading {...props} />)
 
     expect(screen.getByTestId("stMarkdownContainer")).toHaveTextContent(
-      "| Syntax | Description || ----------- | ----------- | | Header | Title | | Paragraph | Text |"
+      "| Syntax | Description | | ----------- | ----------- | | Header | Title | | Paragraph | Text |"
     )
     expect(screen.getByRole("heading")).toHaveTextContent(
       `| Syntax | Description |`
diff --git a/frontend/lib/src/components/shared/StreamlitMarkdown/StreamlitMarkdown.test.tsx b/frontend/lib/src/components/shared/StreamlitMarkdown/StreamlitMarkdown.test.tsx
index 68971ec6e..8bcca474b 100644
--- a/frontend/lib/src/components/shared/StreamlitMarkdown/StreamlitMarkdown.test.tsx
+++ b/frontend/lib/src/components/shared/StreamlitMarkdown/StreamlitMarkdown.test.tsx
@@ -574,6 +574,19 @@ describe("CustomCodeTag Element", () => {
         "</code></div>"
     )
   })
+
+  it("should trim leading and final newlines", () => {
+    const props = getCustomCodeTagProps({
+      children: [
+        `
+      def hello():
+          print("Hello, Streamlit!")
+`,
+      ],
+    })
+    const { baseElement } = render(<CustomCodeTag {...props} />)
+    expect(baseElement).toMatchSnapshot()
+  })
 })
 
 describe("CustomPreTag", () => {
diff --git a/frontend/lib/src/components/shared/StreamlitMarkdown/StreamlitMarkdown.tsx b/frontend/lib/src/components/shared/StreamlitMarkdown/StreamlitMarkdown.tsx
index ed365d3ea..8cb17e8c3 100644
--- a/frontend/lib/src/components/shared/StreamlitMarkdown/StreamlitMarkdown.tsx
+++ b/frontend/lib/src/components/shared/StreamlitMarkdown/StreamlitMarkdown.tsx
@@ -339,7 +339,7 @@ export const CustomCodeTag: FunctionComponent<
 > = ({ inline, className, children, ...props }) => {
   const match = /language-(\w+)/.exec(className || "")
   // eslint-disable-next-line @typescript-eslint/no-base-to-string
-  const codeText = String(children).trim().replace(/\n$/, "")
+  const codeText = String(children).replace(/^\n/, "").replace(/\n$/, "")
 
   const language = (match && match[1]) || ""
   return !inline ? (
diff --git a/frontend/lib/src/components/shared/StreamlitMarkdown/__snapshots__/StreamlitMarkdown.test.tsx.snap b/frontend/lib/src/components/shared/StreamlitMarkdown/__snapshots__/StreamlitMarkdown.test.tsx.snap
new file mode 100644
index 000000000..7e899e72b
--- /dev/null
+++ b/frontend/lib/src/components/shared/StreamlitMarkdown/__snapshots__/StreamlitMarkdown.test.tsx.snap
@@ -0,0 +1,66 @@
+// Vitest Snapshot v1, https://vitest.dev/guide/snapshot.html
+
+exports[`CustomCodeTag Element > should trim leading and final newlines 1`] = `
+<body>
+  <div>
+    <div
+      class="stCode css-p1ioam eptj1qr4"
+      data-testid="stCode"
+    >
+      <pre
+        class="css-ltpfi7 eptj1qr2"
+      >
+        <div
+          style="background-color: transparent;"
+        >
+          <code
+            style="white-space: pre;"
+          >
+            <span>
+                    def hello():
+
+            </span>
+                      print("Hello, Streamlit!")
+          </code>
+        </div>
+      </pre>
+      <div
+        class="css-chk1w8 eptj1qr3"
+      >
+        <button
+          class="css-rann4k eptj1qr5"
+          data-clipboard-text="      def hello():
+          print("Hello, Streamlit!")"
+          data-testid="stCodeCopyButton"
+          style="top: 0px; right: 0px;"
+          title="Copy to clipboard"
+        >
+          <svg
+            fill="none"
+            height="16"
+            stroke="currentColor"
+            stroke-linecap="round"
+            stroke-linejoin="round"
+            stroke-width="2"
+            viewBox="0 0 24 24"
+            width="16"
+            xmlns="http://www.w3.org/2000/svg"
+          >
+            <rect
+              height="13"
+              rx="2"
+              ry="2"
+              width="13"
+              x="9"
+              y="9"
+            />
+            <path
+              d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"
+            />
+          </svg>
+        </button>
+      </div>
+    </div>
+  </div>
+</body>
+`;
diff --git a/lib/streamlit/elements/code.py b/lib/streamlit/elements/code.py
index 04bfb6b37..e4118540c 100644
--- a/lib/streamlit/elements/code.py
+++ b/lib/streamlit/elements/code.py
@@ -14,6 +14,7 @@
 
 from __future__ import annotations
 
+import re
 from typing import TYPE_CHECKING, cast
 
 from streamlit.elements.lib.layout_utils import (
@@ -25,7 +26,6 @@ from streamlit.elements.lib.layout_utils import (
 )
 from streamlit.proto.Code_pb2 import Code as CodeProto
 from streamlit.runtime.metrics_util import gather_metrics
-from streamlit.string_util import clean_text
 
 if TYPE_CHECKING:
     from streamlit.delta_generator import DeltaGenerator
@@ -113,7 +113,7 @@ class CodeMixin:
             height: 380px
         """
         code_proto = CodeProto()
-        code_proto.code_text = clean_text(body)
+        code_proto.code_text = re.sub(r"\n\Z", "", re.sub(r"\A\n", "", str(body)))
         code_proto.language = language or "plaintext"
         code_proto.show_line_numbers = line_numbers
         code_proto.wrap_lines = wrap_lines
diff --git a/lib/tests/streamlit/elements/code_test.py b/lib/tests/streamlit/elements/code_test.py
index ee6e48dda..a52a58f52 100644
--- a/lib/tests/streamlit/elements/code_test.py
+++ b/lib/tests/streamlit/elements/code_test.py
@@ -241,3 +241,18 @@ class CodeElement(DeltaGeneratorTestCase):
         with pytest.raises(StreamlitInvalidHeightError) as e:
             st.code(code, height=height)
         assert "Invalid height" in str(e.value)
+
+    def test_st_code_with_leading_whitespace(self):
+        """Test st.code with code containing leading whitespace."""
+        code = """
+            def hello():
+                print("Hello, Streamlit!")
+"""
+        st.code(code)
+
+        element = self.get_delta_from_queue().new_element
+        assert (
+            element.code.code_text
+            == """            def hello():
+                print("Hello, Streamlit!")"""
+        )
