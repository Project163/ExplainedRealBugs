<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 07:38:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SVN-1722] svn diff may missreport a revision as the working copy</title>
                <link>https://issues.apache.org/jira/browse/SVN-1722</link>
                <project id="12318828" key="SVN">Subversion</project>
                    <description>&lt;p&gt;&lt;pre&gt;It appears that the &apos;svn diff&apos; command can result in output in which the file 
headers within the diff are incorrect; the unified diff itself appears to be as 
expected.  Specifically under some circumstances a diff header will indicate 
one revision as the working copy when it is not.

In this example revision 0 (BASE) is an empty repository and revision 1 (HEAD) 
contains a single file containing the word test (the full recipe to reproduce 
and the full output from all the possible diffs are included at the end of this 
email).  The working copy from which the diffs are requested is a checkout of 
revision 0.

If we examine the svn diff -r BASE:HEAD and HEAD:BASE outputs it is clear that 
the diffs cannot both be against the working copy (if either is) despite the 
fact that it is clearly labeled as such indeed they are the diff we would 
expect between the requested versions, the diff (further below) of the real 
working copy against BASE and HEAD support this.  It seems to me that BASE is 
being incorrectly reported as working copy.

+ svn diff -r BASE:HEAD
Index: file
===================================================================
--- file        (revision 0)
+++ file        (working copy)
@@ -0,0 +1 @@
+test
+ svn diff -r HEAD:BASE
Index: file
===================================================================
--- file        (revision 1)
+++ file        (working copy)
@@ -1 +0,0 @@
-test

Does this come under an existing issuse or should I file one.  Feel free to 
say &apos;stupid&apos; that&apos;s because of &apos;foo&apos; and expected behaviour.

Cheers.

-apw


[apw@kuckoo test2]$ cat T
rm -rf repo test test2
svnadmin create repo
svn checkout file:///`pwd`/repo test
svn checkout file:///`pwd`/repo test2
cd test
echo &quot;test&quot; &amp;gt;file
svn add file
svn -m test commit
cd ../test2
svn diff -r BASE:HEAD
svn diff -r HEAD:BASE
svn diff -r BASE
svn diff -r HEAD
svn diff -r 0:BASE
svn diff -r 0:HEAD
svn diff -r 0:1
svn diff -r 1:0
svn diff -r 0
svn diff -r 1
[apw@kuckoo test2]$ sh -x T
+ rm -rf repo test test2
+ svnadmin create repo
++ pwd
+ svn checkout file:////home/apw/test2/repo test
Checked out revision 0.
++ pwd
+ svn checkout file:////home/apw/test2/repo test2
Checked out revision 0.
+ cd test
+ echo test
+ svn add file
A         file
+ svn -m test commit
Adding         file
Transmitting file data .
Committed revision 1.
+ cd ../test2
+ svn diff -r BASE:HEAD
Index: file
===================================================================
--- file        (revision 0)
+++ file        (working copy)
@@ -0,0 +1 @@
+test
+ svn diff -r HEAD:BASE
Index: file
===================================================================
--- file        (revision 1)
+++ file        (working copy)
@@ -1 +0,0 @@
-test
+ svn diff -r BASE
+ svn diff -r HEAD
Index: file
===================================================================
--- file        (revision 1)
+++ file        (working copy)
@@ -1 +0,0 @@
-test
+ svn diff -r 0:BASE
+ svn diff -r 0:HEAD
Index: file
===================================================================
--- file        (revision 0)
+++ file        (revision 1)
@@ -0,0 +1 @@
+test
+ svn diff -r 0:1
Index: file
===================================================================
--- file        (revision 0)
+++ file        (revision 1)
@@ -0,0 +1 @@
+test
+ svn diff -r 1:0
Index: file
===================================================================
--- file        (revision 1)
+++ file        (revision 0)
@@ -1 +0,0 @@
-test
+ svn diff -r 0
+ svn diff -r 1
Index: file
===================================================================
--- file        (revision 1)
+++ file        (working copy)
@@ -1 +0,0 @@
-test
[apw@kuckoo test2]$
&lt;/pre&gt;&lt;/p&gt;


&lt;p&gt;Original issue reported by &lt;b&gt;awhitcroft&lt;/b&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12898105">SVN-1722</key>
            <summary>svn diff may missreport a revision as the working copy</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="5" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Trivial</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="subversion-importer">Subversion Importer</reporter>
                        <labels>
                            <label>bite-sized</label>
                            <label>patch</label>
                    </labels>
                <created>Tue, 27 Jan 2004 23:01:15 +0000</created>
                <updated>Thu, 17 Oct 2019 20:08:28 +0000</updated>
                            <resolved>Thu, 17 Oct 2019 20:08:28 +0000</resolved>
                                    <version>all</version>
                                    <fixVersion>1.10-consider</fixVersion>
                                    <component>cmdline client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14918887" author="kfogel" created="Tue, 3 Feb 2004 23:11:40 +0000"  >&lt;p&gt;&lt;pre&gt;Putting this in Post-1.0, based on the severity of the bug (not very) and the
complexity of a fix (unknown).  If we come up with an easy fix, then I&apos;d be for
moving this to 1.1.
&lt;/pre&gt;&lt;/p&gt;</comment>
                            <comment id="14918888" author="breser" created="Sat, 28 Feb 2004 18:57:47 +0000"  >&lt;p&gt;&lt;pre&gt;*** Issue 1761 has been marked as a duplicate of this issue. ***
&lt;/pre&gt;&lt;/p&gt;</comment>
                            <comment id="14918889" author="subversion-importer" created="Fri, 24 Dec 2004 20:40:24 +0000"  >&lt;p&gt;&lt;pre&gt;A patch was provided by Alexey Dobriyan (adobriyan_at_mail.ru).  It received no
responses on the dev list.

The patch is archived here:
http://svn.haxx.se/dev/archive-2004-12/0155.shtml
&lt;/pre&gt;&lt;/p&gt;


&lt;p&gt;Original comment by &lt;b&gt;mthelen&lt;/b&gt;&lt;/p&gt;</comment>
                            <comment id="14918890" author="cmpilato" created="Thu, 4 Nov 2010 21:24:20 +0000"  >&lt;p&gt;&lt;pre&gt;Using the current trunk code (and the provided scripts):

+ svn diff -r BASE:HEAD
Index: file
===================================================================
--- file        (revision 0)
+++ file        (revision 1)
@@ -0,0 +1 @@
+test
+ svn diff -r HEAD:BASE
Index: file
===================================================================
--- file        (revision 1)
+++ file        (working copy)
@@ -1 +0,0 @@
-test

So, one of the broken form is fixed, but not the other.
&lt;/pre&gt;&lt;/p&gt;</comment>
                            <comment id="14918891" author="julianfoad" created="Thu, 19 Feb 2015 14:52:57 +0000"  >&lt;p&gt;&lt;pre&gt;Bump all open 1.7-consider issues to 1.10-consider, now that they have missed
the boat for 1.7 (and 1.8 and 1.9).
&lt;/pre&gt;&lt;/p&gt;</comment>
                            <comment id="16953899" author="hartmannathan" created="Thu, 17 Oct 2019 16:33:40 +0000"  >&lt;p&gt;This issue was fixed somewhere between 1.8.19 and 1.12.2, probably during the implementation of new features, repair of other bug(s), or other refactoring.&lt;/p&gt;

&lt;p&gt;In 2004, when this issue was opened, it was reported that the problem manifest when svn diff was run with the following arguments in the reproduction script:&lt;/p&gt;

&lt;p&gt;+ svn diff -r BASE:HEAD&lt;br/&gt;
+ svn diff -r HEAD:BASE&lt;br/&gt;
+ svn diff -r HEAD&lt;br/&gt;
+ svn diff -r 0:HEAD&lt;br/&gt;
+ svn diff -r 1&lt;/p&gt;

&lt;p&gt;In 2010 it was partly fixed / still partly broken.&lt;/p&gt;

&lt;p&gt;I ran the reproduction script against 1.8.19 and against 1.12.2 (respectively the oldest and newest installed versions I have available).&lt;/p&gt;

&lt;p&gt;When run against 1.8.19, the following forms produce the broken output:&lt;/p&gt;

&lt;p&gt;+ svn diff -r HEAD:BASE&lt;br/&gt;
+ svn diff -r HEAD&lt;br/&gt;
+ svn diff -r 1&lt;/p&gt;

&lt;p&gt;When run against 1.12.2, all of the forms appear correct.&lt;/p&gt;

&lt;p&gt;I did not setup and run a bisect to find the exact commit where the issue gets fixed, but I think it happened at r1570053. Other revisions of interest:&#160;r1619452,&#160;r1570266.&lt;/p&gt;

&lt;p&gt;See mailing list thread &quot;Issue tracker housecleaning: &lt;a href=&quot;https://issues.apache.org/jira/browse/SVN-1722&quot; title=&quot;svn diff may missreport a revision as the working copy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SVN-1722&quot;&gt;&lt;del&gt;SVN-1722&lt;/del&gt;&lt;/a&gt;&quot; Oct 2019:&#160;&lt;a href=&quot;https://svn.haxx.se/dev/archive-2019-10/0083.shtml&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.haxx.se/dev/archive-2019-10/0083.shtml&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Regression test added in r1868561.&lt;/p&gt;

&lt;p&gt;Closing this issue.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12898144">SVN-1761</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12311024" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>External issue ID</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1722</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 4 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313020" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Mailing List</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2luun:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>