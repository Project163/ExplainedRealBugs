diff --git a/src/Symfony/Component/Console/Formatter/OutputFormatter.php b/src/Symfony/Component/Console/Formatter/OutputFormatter.php
index 52d8316200..15c14b6d86 100644
--- a/src/Symfony/Component/Console/Formatter/OutputFormatter.php
+++ b/src/Symfony/Component/Console/Formatter/OutputFormatter.php
@@ -12,6 +12,7 @@
 namespace Symfony\Component\Console\Formatter;
 
 use Symfony\Component\Console\Exception\InvalidArgumentException;
+use Symfony\Component\Console\Helper\Helper;
 
 use function Symfony\Component\String\b;
 
@@ -146,9 +147,11 @@ class OutputFormatter implements WrappableOutputFormatterInterface
                 continue;
             }
 
+            // convert byte position to character position.
+            $pos = Helper::length(substr($message, 0, $pos));
             // add the text up to the next tag
-            $output .= $this->applyCurrentStyle(substr($message, $offset, $pos - $offset), $output, $width, $currentLineLength);
-            $offset = $pos + \strlen($text);
+            $output .= $this->applyCurrentStyle(Helper::substr($message, $offset, $pos - $offset), $output, $width, $currentLineLength);
+            $offset = $pos + Helper::length($text);
 
             // opening tag?
             if ($open = '/' !== $text[1]) {
@@ -169,7 +172,7 @@ class OutputFormatter implements WrappableOutputFormatterInterface
             }
         }
 
-        $output .= $this->applyCurrentStyle(substr($message, $offset), $output, $width, $currentLineLength);
+        $output .= $this->applyCurrentStyle(Helper::substr($message, $offset), $output, $width, $currentLineLength);
 
         return strtr($output, ["\0" => '\\', '\\<' => '<', '\\>' => '>']);
     }
@@ -236,8 +239,8 @@ class OutputFormatter implements WrappableOutputFormatterInterface
         }
 
         if ($currentLineLength) {
-            $prefix = substr($text, 0, $i = $width - $currentLineLength)."\n";
-            $text = substr($text, $i);
+            $prefix = Helper::substr($text, 0, $i = $width - $currentLineLength)."\n";
+            $text = Helper::substr($text, $i);
         } else {
             $prefix = '';
         }
@@ -253,7 +256,7 @@ class OutputFormatter implements WrappableOutputFormatterInterface
         $lines = explode("\n", $text);
 
         foreach ($lines as $line) {
-            $currentLineLength += \strlen($line);
+            $currentLineLength += Helper::length($line);
             if ($width <= $currentLineLength) {
                 $currentLineLength = 0;
             }
diff --git a/src/Symfony/Component/Console/Helper/Helper.php b/src/Symfony/Component/Console/Helper/Helper.php
index eec3284988..468d06689e 100644
--- a/src/Symfony/Component/Console/Helper/Helper.php
+++ b/src/Symfony/Component/Console/Helper/Helper.php
@@ -86,6 +86,10 @@ abstract class Helper implements HelperInterface
     {
         $string ??= '';
 
+        if (preg_match('//u', $string)) {
+            return (new UnicodeString($string))->slice($from, $length);
+        }
+
         if (false === $encoding = mb_detect_encoding($string, null, true)) {
             return substr($string, $from, $length);
         }
diff --git a/src/Symfony/Component/Console/Tests/Formatter/OutputFormatterTest.php b/src/Symfony/Component/Console/Tests/Formatter/OutputFormatterTest.php
index eb8e483f30..4dbeb702d0 100644
--- a/src/Symfony/Component/Console/Tests/Formatter/OutputFormatterTest.php
+++ b/src/Symfony/Component/Console/Tests/Formatter/OutputFormatterTest.php
@@ -365,6 +365,8 @@ EOF
         $this->assertSame("Lore\nm \e[37;41mip\e[39;49m\n\e[37;41msum\e[39;49m \ndolo\nr \e[32msi\e[39m\n\e[32mt\e[39m am\net", $formatter->formatAndWrap('Lorem <error>ipsum</error> dolor <info>sit</info> amet', 4));
         $this->assertSame("Lorem \e[37;41mip\e[39;49m\n\e[37;41msum\e[39;49m dolo\nr \e[32msit\e[39m am\net", $formatter->formatAndWrap('Lorem <error>ipsum</error> dolor <info>sit</info> amet', 8));
         $this->assertSame("Lorem \e[37;41mipsum\e[39;49m dolor \e[32m\e[39m\n\e[32msit\e[39m, \e[37;41mamet\e[39;49m et \e[32mlauda\e[39m\n\e[32mntium\e[39m architecto", $formatter->formatAndWrap('Lorem <error>ipsum</error> dolor <info>sit</info>, <error>amet</error> et <info>laudantium</info> architecto', 18));
+        $this->assertSame("\e[37;41mnon-empty-array\e[39;49m\e[37;41m<mixed, mixed>\e[39;49m given.\nü™™\n  argument.type", $formatter->formatAndWrap("<error>non-empty-array<mixed, mixed></error> given.\nü™™  argument.type", 38));
+        $this->assertSame("Usu√°rio <strong>{{user_name}}</strong> n√£o √© v√°lid\no.", $formatter->formatAndWrap('Usu√°rio <strong>{{user_name}}</strong> n√£o √© v√°lido.', 50));
 
         $formatter = new OutputFormatter();
 
@@ -376,6 +378,8 @@ EOF
         $this->assertSame("√Ç r√®√§lly\nl√∂ng t√Ætl√®\nth√§t c√∂√ºld\nn√®√™d\nm√∫lt√Æpl√™\nl√≠n√®s", $formatter->formatAndWrap('√Ç r√®√§lly l√∂ng t√Ætl√® th√§t c√∂√ºld n√®√™d m√∫lt√Æpl√™ l√≠n√®s', 10));
         $this->assertSame("√Ç r√®√§lly\nl√∂ng t√Ætl√®\nth√§t c√∂√ºld\nn√®√™d\nm√∫lt√Æpl√™\n l√≠n√®s", $formatter->formatAndWrap("√Ç r√®√§lly l√∂ng t√Ætl√® th√§t c√∂√ºld n√®√™d m√∫lt√Æpl√™\n l√≠n√®s", 10));
         $this->assertSame('', $formatter->formatAndWrap(null, 5));
+        $this->assertSame("non-empty-array<mixed, mixed> given.\nü™™\n  argument.type", $formatter->formatAndWrap("<error>non-empty-array<mixed, mixed></error> given.\nü™™  argument.type", 38));
+        $this->assertSame("Usu√°rio <strong>{{user_name}}</strong> n√£o √© v√°lid\no.", $formatter->formatAndWrap('Usu√°rio <strong>{{user_name}}</strong> n√£o √© v√°lido.', 50));
     }
 }
 
