diff --git a/src/Symfony/Component/JsonStreamer/DataModel/Write/CollectionNode.php b/src/Symfony/Component/JsonStreamer/DataModel/Write/CollectionNode.php
index 2f324fb404..309c6026ae 100644
--- a/src/Symfony/Component/JsonStreamer/DataModel/Write/CollectionNode.php
+++ b/src/Symfony/Component/JsonStreamer/DataModel/Write/CollectionNode.php
@@ -27,12 +27,13 @@ final class CollectionNode implements DataModelNodeInterface
         private DataAccessorInterface $accessor,
         private CollectionType $type,
         private DataModelNodeInterface $item,
+        private DataModelNodeInterface $key,
     ) {
     }
 
     public function withAccessor(DataAccessorInterface $accessor): self
     {
-        return new self($accessor, $this->type, $this->item);
+        return new self($accessor, $this->type, $this->item, $this->key);
     }
 
     public function getIdentifier(): string
@@ -54,4 +55,9 @@ final class CollectionNode implements DataModelNodeInterface
     {
         return $this->item;
     }
+
+    public function getKeyNode(): DataModelNodeInterface
+    {
+        return $this->key;
+    }
 }
diff --git a/src/Symfony/Component/JsonStreamer/Tests/DataModel/Write/CompositeNodeTest.php b/src/Symfony/Component/JsonStreamer/Tests/DataModel/Write/CompositeNodeTest.php
index a7ef7df343..65a16c9653 100644
--- a/src/Symfony/Component/JsonStreamer/Tests/DataModel/Write/CompositeNodeTest.php
+++ b/src/Symfony/Component/JsonStreamer/Tests/DataModel/Write/CompositeNodeTest.php
@@ -49,7 +49,7 @@ class CompositeNodeTest extends TestCase
         $composite = new CompositeNode(new VariableDataAccessor('data'), [
             $scalar = new ScalarNode(new VariableDataAccessor('data'), Type::int()),
             $object = new ObjectNode(new VariableDataAccessor('data'), Type::object(self::class), []),
-            $collection = new CollectionNode(new VariableDataAccessor('data'), Type::list(), new ScalarNode(new VariableDataAccessor('data'), Type::int())),
+            $collection = new CollectionNode(new VariableDataAccessor('data'), Type::list(), new ScalarNode(new VariableDataAccessor('data'), Type::int()), new ScalarNode(new VariableDataAccessor('key'), Type::string())),
         ]);
 
         $this->assertSame([$collection, $object, $scalar], $composite->getNodes());
diff --git a/src/Symfony/Component/JsonStreamer/Tests/Fixtures/Model/DummyWithArray.php b/src/Symfony/Component/JsonStreamer/Tests/Fixtures/Model/DummyWithArray.php
new file mode 100644
index 0000000000..e47f057fd7
--- /dev/null
+++ b/src/Symfony/Component/JsonStreamer/Tests/Fixtures/Model/DummyWithArray.php
@@ -0,0 +1,11 @@
+<?php
+
+namespace Symfony\Component\JsonStreamer\Tests\Fixtures\Model;
+
+class DummyWithArray
+{
+    /** @var ClassicDummy[] */
+    public array $dummies;
+
+    public string $customProperty;
+}
diff --git a/src/Symfony/Component/JsonStreamer/Tests/Fixtures/Model/DummyWithNestedArray.php b/src/Symfony/Component/JsonStreamer/Tests/Fixtures/Model/DummyWithNestedArray.php
new file mode 100644
index 0000000000..19422d48e8
--- /dev/null
+++ b/src/Symfony/Component/JsonStreamer/Tests/Fixtures/Model/DummyWithNestedArray.php
@@ -0,0 +1,11 @@
+<?php
+
+namespace Symfony\Component\JsonStreamer\Tests\Fixtures\Model;
+
+class DummyWithNestedArray
+{
+    /** @var DummyWithArray[] */
+    public array $dummies;
+
+    public string $stringProperty;
+}
diff --git a/src/Symfony/Component/JsonStreamer/Tests/Fixtures/stream_writer/double_nested_list.php b/src/Symfony/Component/JsonStreamer/Tests/Fixtures/stream_writer/double_nested_list.php
new file mode 100644
index 0000000000..2f54396451
--- /dev/null
+++ b/src/Symfony/Component/JsonStreamer/Tests/Fixtures/stream_writer/double_nested_list.php
@@ -0,0 +1,38 @@
+<?php
+
+return static function (mixed $data, \Psr\Container\ContainerInterface $valueTransformers, array $options): \Traversable {
+    try {
+        yield '[';
+        $prefix = '';
+        foreach ($data as $value1) {
+            yield $prefix;
+            yield '{"dummies":[';
+            $prefix = '';
+            foreach ($value1->dummies as $value2) {
+                yield $prefix;
+                yield '{"dummies":[';
+                $prefix = '';
+                foreach ($value2->dummies as $value3) {
+                    yield $prefix;
+                    yield '{"id":';
+                    yield \json_encode($value3->id, \JSON_THROW_ON_ERROR, 506);
+                    yield ',"name":';
+                    yield \json_encode($value3->name, \JSON_THROW_ON_ERROR, 506);
+                    yield '}';
+                    $prefix = ',';
+                }
+                yield '],"customProperty":';
+                yield \json_encode($value2->customProperty, \JSON_THROW_ON_ERROR, 508);
+                yield '}';
+                $prefix = ',';
+            }
+            yield '],"stringProperty":';
+            yield \json_encode($value1->stringProperty, \JSON_THROW_ON_ERROR, 510);
+            yield '}';
+            $prefix = ',';
+        }
+        yield ']';
+    } catch (\JsonException $e) {
+        throw new \Symfony\Component\JsonStreamer\Exception\NotEncodableValueException($e->getMessage(), 0, $e);
+    }
+};
diff --git a/src/Symfony/Component/JsonStreamer/Tests/Fixtures/stream_writer/nested_list.php b/src/Symfony/Component/JsonStreamer/Tests/Fixtures/stream_writer/nested_list.php
new file mode 100644
index 0000000000..c723ed246e
--- /dev/null
+++ b/src/Symfony/Component/JsonStreamer/Tests/Fixtures/stream_writer/nested_list.php
@@ -0,0 +1,29 @@
+<?php
+
+return static function (mixed $data, \Psr\Container\ContainerInterface $valueTransformers, array $options): \Traversable {
+    try {
+        yield '[';
+        $prefix = '';
+        foreach ($data as $value1) {
+            yield $prefix;
+            yield '{"dummies":[';
+            $prefix = '';
+            foreach ($value1->dummies as $value2) {
+                yield $prefix;
+                yield '{"id":';
+                yield \json_encode($value2->id, \JSON_THROW_ON_ERROR, 508);
+                yield ',"name":';
+                yield \json_encode($value2->name, \JSON_THROW_ON_ERROR, 508);
+                yield '}';
+                $prefix = ',';
+            }
+            yield '],"customProperty":';
+            yield \json_encode($value1->customProperty, \JSON_THROW_ON_ERROR, 510);
+            yield '}';
+            $prefix = ',';
+        }
+        yield ']';
+    } catch (\JsonException $e) {
+        throw new \Symfony\Component\JsonStreamer\Exception\NotEncodableValueException($e->getMessage(), 0, $e);
+    }
+};
diff --git a/src/Symfony/Component/JsonStreamer/Tests/Fixtures/stream_writer/nullable_object_dict.php b/src/Symfony/Component/JsonStreamer/Tests/Fixtures/stream_writer/nullable_object_dict.php
index b466dd89c9..3be4246218 100644
--- a/src/Symfony/Component/JsonStreamer/Tests/Fixtures/stream_writer/nullable_object_dict.php
+++ b/src/Symfony/Component/JsonStreamer/Tests/Fixtures/stream_writer/nullable_object_dict.php
@@ -5,13 +5,13 @@ return static function (mixed $data, \Psr\Container\ContainerInterface $valueTra
         if (\is_array($data)) {
             yield '{';
             $prefix = '';
-            foreach ($data as $key => $value) {
-                $key = \substr(\json_encode($key), 1, -1);
-                yield "{$prefix}\"{$key}\":";
+            foreach ($data as $key1 => $value1) {
+                $key1 = \substr(\json_encode($key1), 1, -1);
+                yield "{$prefix}\"{$key1}\":";
                 yield '{"@id":';
-                yield \json_encode($value->id, \JSON_THROW_ON_ERROR, 510);
+                yield \json_encode($value1->id, \JSON_THROW_ON_ERROR, 510);
                 yield ',"name":';
-                yield \json_encode($value->name, \JSON_THROW_ON_ERROR, 510);
+                yield \json_encode($value1->name, \JSON_THROW_ON_ERROR, 510);
                 yield '}';
                 $prefix = ',';
             }
diff --git a/src/Symfony/Component/JsonStreamer/Tests/Fixtures/stream_writer/nullable_object_list.php b/src/Symfony/Component/JsonStreamer/Tests/Fixtures/stream_writer/nullable_object_list.php
index f891ae0a64..20bfe43025 100644
--- a/src/Symfony/Component/JsonStreamer/Tests/Fixtures/stream_writer/nullable_object_list.php
+++ b/src/Symfony/Component/JsonStreamer/Tests/Fixtures/stream_writer/nullable_object_list.php
@@ -5,12 +5,12 @@ return static function (mixed $data, \Psr\Container\ContainerInterface $valueTra
         if (\is_array($data)) {
             yield '[';
             $prefix = '';
-            foreach ($data as $value) {
+            foreach ($data as $value1) {
                 yield $prefix;
                 yield '{"@id":';
-                yield \json_encode($value->id, \JSON_THROW_ON_ERROR, 510);
+                yield \json_encode($value1->id, \JSON_THROW_ON_ERROR, 510);
                 yield ',"name":';
-                yield \json_encode($value->name, \JSON_THROW_ON_ERROR, 510);
+                yield \json_encode($value1->name, \JSON_THROW_ON_ERROR, 510);
                 yield '}';
                 $prefix = ',';
             }
diff --git a/src/Symfony/Component/JsonStreamer/Tests/Fixtures/stream_writer/object_dict.php b/src/Symfony/Component/JsonStreamer/Tests/Fixtures/stream_writer/object_dict.php
index 9959ab8211..8059928244 100644
--- a/src/Symfony/Component/JsonStreamer/Tests/Fixtures/stream_writer/object_dict.php
+++ b/src/Symfony/Component/JsonStreamer/Tests/Fixtures/stream_writer/object_dict.php
@@ -4,13 +4,13 @@ return static function (mixed $data, \Psr\Container\ContainerInterface $valueTra
     try {
         yield '{';
         $prefix = '';
-        foreach ($data as $key => $value) {
-            $key = \substr(\json_encode($key), 1, -1);
-            yield "{$prefix}\"{$key}\":";
+        foreach ($data as $key1 => $value1) {
+            $key1 = \substr(\json_encode($key1), 1, -1);
+            yield "{$prefix}\"{$key1}\":";
             yield '{"@id":';
-            yield \json_encode($value->id, \JSON_THROW_ON_ERROR, 510);
+            yield \json_encode($value1->id, \JSON_THROW_ON_ERROR, 510);
             yield ',"name":';
-            yield \json_encode($value->name, \JSON_THROW_ON_ERROR, 510);
+            yield \json_encode($value1->name, \JSON_THROW_ON_ERROR, 510);
             yield '}';
             $prefix = ',';
         }
diff --git a/src/Symfony/Component/JsonStreamer/Tests/Fixtures/stream_writer/object_iterable.php b/src/Symfony/Component/JsonStreamer/Tests/Fixtures/stream_writer/object_iterable.php
index 5eff34f5e5..732e56b889 100644
--- a/src/Symfony/Component/JsonStreamer/Tests/Fixtures/stream_writer/object_iterable.php
+++ b/src/Symfony/Component/JsonStreamer/Tests/Fixtures/stream_writer/object_iterable.php
@@ -4,13 +4,13 @@ return static function (mixed $data, \Psr\Container\ContainerInterface $valueTra
     try {
         yield '{';
         $prefix = '';
-        foreach ($data as $key => $value) {
-            $key = is_int($key) ? $key : \substr(\json_encode($key), 1, -1);
-            yield "{$prefix}\"{$key}\":";
+        foreach ($data as $key1 => $value1) {
+            $key1 = is_int($key1) ? $key1 : \substr(\json_encode($key1), 1, -1);
+            yield "{$prefix}\"{$key1}\":";
             yield '{"id":';
-            yield \json_encode($value->id, \JSON_THROW_ON_ERROR, 510);
+            yield \json_encode($value1->id, \JSON_THROW_ON_ERROR, 510);
             yield ',"name":';
-            yield \json_encode($value->name, \JSON_THROW_ON_ERROR, 510);
+            yield \json_encode($value1->name, \JSON_THROW_ON_ERROR, 510);
             yield '}';
             $prefix = ',';
         }
diff --git a/src/Symfony/Component/JsonStreamer/Tests/Fixtures/stream_writer/object_list.php b/src/Symfony/Component/JsonStreamer/Tests/Fixtures/stream_writer/object_list.php
index bb4a6a45d0..37ef84a40a 100644
--- a/src/Symfony/Component/JsonStreamer/Tests/Fixtures/stream_writer/object_list.php
+++ b/src/Symfony/Component/JsonStreamer/Tests/Fixtures/stream_writer/object_list.php
@@ -4,12 +4,12 @@ return static function (mixed $data, \Psr\Container\ContainerInterface $valueTra
     try {
         yield '[';
         $prefix = '';
-        foreach ($data as $value) {
+        foreach ($data as $value1) {
             yield $prefix;
             yield '{"@id":';
-            yield \json_encode($value->id, \JSON_THROW_ON_ERROR, 510);
+            yield \json_encode($value1->id, \JSON_THROW_ON_ERROR, 510);
             yield ',"name":';
-            yield \json_encode($value->name, \JSON_THROW_ON_ERROR, 510);
+            yield \json_encode($value1->name, \JSON_THROW_ON_ERROR, 510);
             yield '}';
             $prefix = ',';
         }
diff --git a/src/Symfony/Component/JsonStreamer/Tests/Fixtures/stream_writer/union.php b/src/Symfony/Component/JsonStreamer/Tests/Fixtures/stream_writer/union.php
index edb5e5c46f..6e2c0566f5 100644
--- a/src/Symfony/Component/JsonStreamer/Tests/Fixtures/stream_writer/union.php
+++ b/src/Symfony/Component/JsonStreamer/Tests/Fixtures/stream_writer/union.php
@@ -5,9 +5,9 @@ return static function (mixed $data, \Psr\Container\ContainerInterface $valueTra
         if (\is_array($data)) {
             yield '[';
             $prefix = '';
-            foreach ($data as $value) {
+            foreach ($data as $value1) {
                 yield $prefix;
-                yield \json_encode($value->value, \JSON_THROW_ON_ERROR, 511);
+                yield \json_encode($value1->value, \JSON_THROW_ON_ERROR, 511);
                 $prefix = ',';
             }
             yield ']';
diff --git a/src/Symfony/Component/JsonStreamer/Tests/JsonStreamWriterTest.php b/src/Symfony/Component/JsonStreamer/Tests/JsonStreamWriterTest.php
index 14cc50881d..1b2d58f838 100644
--- a/src/Symfony/Component/JsonStreamer/Tests/JsonStreamWriterTest.php
+++ b/src/Symfony/Component/JsonStreamer/Tests/JsonStreamWriterTest.php
@@ -16,13 +16,16 @@ use Symfony\Component\JsonStreamer\Exception\NotEncodableValueException;
 use Symfony\Component\JsonStreamer\JsonStreamWriter;
 use Symfony\Component\JsonStreamer\Tests\Fixtures\Enum\DummyBackedEnum;
 use Symfony\Component\JsonStreamer\Tests\Fixtures\Model\ClassicDummy;
+use Symfony\Component\JsonStreamer\Tests\Fixtures\Model\DummyWithArray;
 use Symfony\Component\JsonStreamer\Tests\Fixtures\Model\DummyWithDateTimes;
 use Symfony\Component\JsonStreamer\Tests\Fixtures\Model\DummyWithGenerics;
 use Symfony\Component\JsonStreamer\Tests\Fixtures\Model\DummyWithNameAttributes;
+use Symfony\Component\JsonStreamer\Tests\Fixtures\Model\DummyWithNestedArray;
 use Symfony\Component\JsonStreamer\Tests\Fixtures\Model\DummyWithNullableProperties;
 use Symfony\Component\JsonStreamer\Tests\Fixtures\Model\DummyWithPhpDoc;
 use Symfony\Component\JsonStreamer\Tests\Fixtures\Model\DummyWithUnionProperties;
 use Symfony\Component\JsonStreamer\Tests\Fixtures\Model\DummyWithValueTransformerAttributes;
+use Symfony\Component\JsonStreamer\Tests\Fixtures\Model\JsonStreamableDummy;
 use Symfony\Component\JsonStreamer\Tests\Fixtures\Model\SelfReferencingDummy;
 use Symfony\Component\JsonStreamer\Tests\Fixtures\ValueTransformer\BooleanToStringValueTransformer;
 use Symfony\Component\JsonStreamer\Tests\Fixtures\ValueTransformer\DoubleIntAndCastToStringValueTransformer;
@@ -107,6 +110,34 @@ class JsonStreamWriterTest extends TestCase
             new \ArrayObject([new ClassicDummy(), new ClassicDummy()]),
             Type::iterable(Type::object(ClassicDummy::class), Type::int()),
         );
+
+        $dummyWithArray1 = new DummyWithArray();
+        $dummyWithArray1->dummies = [new ClassicDummy()];
+        $dummyWithArray1->customProperty = 'customProperty1';
+
+        $dummyWithArray2 = new DummyWithArray();
+        $dummyWithArray2->dummies = [new ClassicDummy()];
+        $dummyWithArray2->customProperty = 'customProperty2';
+
+        $this->assertWritten(
+            '[{"dummies":[{"id":1,"name":"dummy"}],"customProperty":"customProperty1"},{"dummies":[{"id":1,"name":"dummy"}],"customProperty":"customProperty2"}]',
+            [$dummyWithArray1, $dummyWithArray2],
+            Type::list(Type::object(DummyWithArray::class)),
+        );
+
+        $dummyWithNestedArray1 = new DummyWithNestedArray();
+        $dummyWithNestedArray1->dummies = [$dummyWithArray1];
+        $dummyWithNestedArray1->stringProperty = 'stringProperty1';
+
+        $dummyWithNestedArray2 = new DummyWithNestedArray();
+        $dummyWithNestedArray2->dummies = [$dummyWithArray2];
+        $dummyWithNestedArray2->stringProperty = 'stringProperty2';
+
+        $this->assertWritten(
+            '[{"dummies":[{"dummies":[{"id":1,"name":"dummy"}],"customProperty":"customProperty1"}],"stringProperty":"stringProperty1"},{"dummies":[{"dummies":[{"id":1,"name":"dummy"}],"customProperty":"customProperty2"}],"stringProperty":"stringProperty2"}]',
+            [$dummyWithNestedArray1, $dummyWithNestedArray2],
+            Type::list(Type::object(DummyWithNestedArray::class)),
+        );
     }
 
     public function testWriteObject()
diff --git a/src/Symfony/Component/JsonStreamer/Tests/Write/StreamWriterGeneratorTest.php b/src/Symfony/Component/JsonStreamer/Tests/Write/StreamWriterGeneratorTest.php
index 8ddbef67d9..6f1024303a 100644
--- a/src/Symfony/Component/JsonStreamer/Tests/Write/StreamWriterGeneratorTest.php
+++ b/src/Symfony/Component/JsonStreamer/Tests/Write/StreamWriterGeneratorTest.php
@@ -21,7 +21,9 @@ use Symfony\Component\JsonStreamer\Mapping\Write\DateTimeTypePropertyMetadataLoa
 use Symfony\Component\JsonStreamer\Tests\Fixtures\Enum\DummyBackedEnum;
 use Symfony\Component\JsonStreamer\Tests\Fixtures\Enum\DummyEnum;
 use Symfony\Component\JsonStreamer\Tests\Fixtures\Model\ClassicDummy;
+use Symfony\Component\JsonStreamer\Tests\Fixtures\Model\DummyWithArray;
 use Symfony\Component\JsonStreamer\Tests\Fixtures\Model\DummyWithNameAttributes;
+use Symfony\Component\JsonStreamer\Tests\Fixtures\Model\DummyWithNestedArray;
 use Symfony\Component\JsonStreamer\Tests\Fixtures\Model\DummyWithOtherDummies;
 use Symfony\Component\JsonStreamer\Tests\Fixtures\Model\DummyWithUnionProperties;
 use Symfony\Component\JsonStreamer\Tests\Fixtures\Model\DummyWithValueTransformerAttributes;
@@ -93,6 +95,8 @@ class StreamWriterGeneratorTest extends TestCase
         yield ['null_list', Type::list(Type::null())];
         yield ['object_list', Type::list(Type::object(DummyWithNameAttributes::class))];
         yield ['nullable_object_list', Type::nullable(Type::list(Type::object(DummyWithNameAttributes::class)))];
+        yield ['nested_list', Type::list(Type::object(DummyWithArray::class))];
+        yield ['double_nested_list', Type::list(Type::object(DummyWithNestedArray::class))];
 
         yield ['dict', Type::dict()];
         yield ['object_dict', Type::dict(Type::object(DummyWithNameAttributes::class))];
@@ -141,6 +145,7 @@ class StreamWriterGeneratorTest extends TestCase
             ->with(self::class, [], [
                 'original_type' => $type,
                 'generated_classes' => [self::class => true],
+                'depth' => 0,
             ])
             ->willReturn([]);
 
diff --git a/src/Symfony/Component/JsonStreamer/Write/PhpAstBuilder.php b/src/Symfony/Component/JsonStreamer/Write/PhpAstBuilder.php
index f0b429b42c..d33ba3a9a5 100644
--- a/src/Symfony/Component/JsonStreamer/Write/PhpAstBuilder.php
+++ b/src/Symfony/Component/JsonStreamer/Write/PhpAstBuilder.php
@@ -309,21 +309,23 @@ final class PhpAstBuilder
                 ];
             }
 
+            $keyVar = $dataModelNode->getKeyNode()->getAccessor()->toPhpExpr();
+
             $escapedKey = $dataModelNode->getType()->getCollectionKeyType()->isIdentifiedBy(TypeIdentifier::INT)
-                ? new Ternary($this->builder->funcCall('is_int', [$this->builder->var('key')]), $this->builder->var('key'), $this->escapeString($this->builder->var('key')))
-                : $this->escapeString($this->builder->var('key'));
+                ? new Ternary($this->builder->funcCall('is_int', [$keyVar]), $keyVar, $this->escapeString($keyVar))
+                : $this->escapeString($keyVar);
 
             return [
                 new Expression(new Yield_($this->builder->val('{'))),
                 new Expression(new Assign($this->builder->var('prefix'), $this->builder->val(''))),
                 new Foreach_($accessor, $dataModelNode->getItemNode()->getAccessor()->toPhpExpr(), [
-                    'keyVar' => $this->builder->var('key'),
+                    'keyVar' => $keyVar,
                     'stmts' => [
-                        new Expression(new Assign($this->builder->var('key'), $escapedKey)),
+                        new Expression(new Assign($keyVar, $escapedKey)),
                         new Expression(new Yield_(new Encapsed([
                             $this->builder->var('prefix'),
                             new EncapsedStringPart('"'),
-                            $this->builder->var('key'),
+                            $keyVar,
                             new EncapsedStringPart('":'),
                         ]))),
                         ...$this->buildYieldStatements($dataModelNode->getItemNode(), $options, $context),
diff --git a/src/Symfony/Component/JsonStreamer/Write/StreamWriterGenerator.php b/src/Symfony/Component/JsonStreamer/Write/StreamWriterGenerator.php
index c437ca0d17..4c80870091 100644
--- a/src/Symfony/Component/JsonStreamer/Write/StreamWriterGenerator.php
+++ b/src/Symfony/Component/JsonStreamer/Write/StreamWriterGenerator.php
@@ -76,7 +76,7 @@ final class StreamWriterGenerator
         $this->phpPrinter ??= new Standard(['phpVersion' => PhpVersion::fromComponents(8, 2)]);
         $this->fs ??= new Filesystem();
 
-        $dataModel = $this->createDataModel($type, new VariableDataAccessor('data'), $options);
+        $dataModel = $this->createDataModel($type, new VariableDataAccessor('data'), $options, ['depth' => 0]);
 
         $nodes = $this->phpAstBuilder->build($dataModel, $options);
         $nodes = $this->phpOptimizer->optimize($nodes);
@@ -180,10 +180,13 @@ final class StreamWriterGenerator
         }
 
         if ($type instanceof CollectionType) {
+            ++$context['depth'];
+
             return new CollectionNode(
                 $accessor,
                 $type,
-                $this->createDataModel($type->getCollectionValueType(), new VariableDataAccessor('value'), $options, $context),
+                $this->createDataModel($type->getCollectionValueType(), new VariableDataAccessor('value' . $context['depth']), $options, $context),
+                $this->createDataModel($type->getCollectionKeyType(), new VariableDataAccessor('key' . $context['depth']), $options, $context),
             );
         }
 
