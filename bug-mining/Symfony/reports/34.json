{"url":"https://api.github.com/repos/symfony/symfony/issues/61806","repository_url":"https://api.github.com/repos/symfony/symfony","labels_url":"https://api.github.com/repos/symfony/symfony/issues/61806/labels{/name}","comments_url":"https://api.github.com/repos/symfony/symfony/issues/61806/comments","events_url":"https://api.github.com/repos/symfony/symfony/issues/61806/events","html_url":"https://github.com/symfony/symfony/issues/61806","id":3440562651,"node_id":"I_kwDOAAb9Ss7NEtHb","number":61806,"title":"[Config] ResourceCheckerConfigCache produces PHP unserialization warning for longer class/property names","user":{"login":"aboks","id":815524,"node_id":"MDQ6VXNlcjgxNTUyNA==","avatar_url":"https://avatars.githubusercontent.com/u/815524?v=4","gravatar_id":"","url":"https://api.github.com/users/aboks","html_url":"https://github.com/aboks","followers_url":"https://api.github.com/users/aboks/followers","following_url":"https://api.github.com/users/aboks/following{/other_user}","gists_url":"https://api.github.com/users/aboks/gists{/gist_id}","starred_url":"https://api.github.com/users/aboks/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aboks/subscriptions","organizations_url":"https://api.github.com/users/aboks/orgs","repos_url":"https://api.github.com/users/aboks/repos","events_url":"https://api.github.com/users/aboks/events{/privacy}","received_events_url":"https://api.github.com/users/aboks/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":100079,"node_id":"MDU6TGFiZWwxMDAwNzk=","url":"https://api.github.com/repos/symfony/symfony/labels/Bug","name":"Bug","color":"e10c02","default":false,"description":null},{"id":125406,"node_id":"MDU6TGFiZWwxMjU0MDY=","url":"https://api.github.com/repos/symfony/symfony/labels/Config","name":"Config","color":"DDDDDD","default":false,"description":null},{"id":237003792,"node_id":"MDU6TGFiZWwyMzcwMDM3OTI=","url":"https://api.github.com/repos/symfony/symfony/labels/Status:%20Needs%20Review","name":"Status: Needs Review","color":"ededed","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2025-09-22T11:47:36Z","updated_at":"2025-09-22T13:06:49Z","closed_at":"2025-09-22T13:06:49Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Symfony version(s) affected\n\n7.2.0 and up\n\n### Description\n\nThe logic for generating the JSON metadata file in ResourceCheckerConfigCache generates a PHP unserialization warning if `$metadata` contains an object that has a property where the class name plus property name combined are more than around 100 characters in length. \n\nThis is due to incorrect mangling of the serialized representation in https://github.com/symfony/symfony/blob/b8eaa4be31f2159918e79e5694bc9ff241e0d692/src/Symfony/Component/Config/ResourceCheckerConfigCache.php#L129 This line aims to remove the class name (and surrounding nullbytes) from the serialized representation of a property. The magic constant `6` is probably some ugly micro-optimization to prevent capturing the matched class name. It seems that the 6 is based on an assumption of 6 'non-removed' characters in the matched string: the `s`, `:`, two characters for the serialized string length, another `:` and a `\"`. However, when the length of the serialized property id (class name surrounded with nullbytes plus property name) exceeds 100, the assumption of two characters for the serialized string length does not hold anymore.\n\nThis causes the logic to generate an invalid serialized representation like `s:3:\"prop\"`, where the indicated string length does not match the actual length of the property name string, and thus causes `unserialize()` to fail.\n\n### How to reproduce\n\nThe following script suffices in a project where `symfony/config` is installed via composer:\n\n```php\n<?php\ndeclare(strict_types=1);\n\nrequire_once \"vendor/autoload.php\";\n\nclass MyResourceWithAVeryVeryVeryVeryVeryVeryVeryVeryVeryVeryVeryVeryVeryVeryVeryVeryVeryVeryLongName implements \\Symfony\\Component\\Config\\Resource\\ResourceInterface {\n\tpublic function __construct(\n\t\tprivate readonly string $prop,\n\t) {}\n\n\tpublic function __toString(): string {\n\t\treturn \"myresource\";\n\t}\n}\n\n\n$file = __DIR__ . \"/my_cache.php\";\n$configCache = new \\Symfony\\Component\\Config\\ResourceCheckerConfigCache($file);\n\n$metadata = [\n\tnew MyResourceWithAVeryVeryVeryVeryVeryVeryVeryVeryVeryVeryVeryVeryVeryVeryVeryVeryVeryVeryLongName(\"bar\"),\n];\n$configCache->write(\"foo\", $metadata);\n```\n\nNote that the issue disappears when you remove one 'Very' from the class name, bringing the total length back under 100.\n\n### Possible Solution\n\nReplace the `+ 6` by `+ 4 + \\strlen($m[1])`, or just capture the removed classname and use its length for the adjustment.\n\n### Additional Context\n\n_No response_","closed_by":{"login":"nicolas-grekas","id":243674,"node_id":"MDQ6VXNlcjI0MzY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/243674?v=4","gravatar_id":"","url":"https://api.github.com/users/nicolas-grekas","html_url":"https://github.com/nicolas-grekas","followers_url":"https://api.github.com/users/nicolas-grekas/followers","following_url":"https://api.github.com/users/nicolas-grekas/following{/other_user}","gists_url":"https://api.github.com/users/nicolas-grekas/gists{/gist_id}","starred_url":"https://api.github.com/users/nicolas-grekas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicolas-grekas/subscriptions","organizations_url":"https://api.github.com/users/nicolas-grekas/orgs","repos_url":"https://api.github.com/users/nicolas-grekas/repos","events_url":"https://api.github.com/users/nicolas-grekas/events{/privacy}","received_events_url":"https://api.github.com/users/nicolas-grekas/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/symfony/symfony/issues/61806/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/symfony/symfony/issues/61806/timeline","performed_via_github_app":null,"state_reason":"completed"}