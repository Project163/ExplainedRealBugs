{"url":"https://api.github.com/repos/symfony/symfony/issues/60984","repository_url":"https://api.github.com/repos/symfony/symfony","labels_url":"https://api.github.com/repos/symfony/symfony/issues/60984/labels{/name}","comments_url":"https://api.github.com/repos/symfony/symfony/issues/60984/comments","events_url":"https://api.github.com/repos/symfony/symfony/issues/60984/events","html_url":"https://github.com/symfony/symfony/issues/60984","id":3189136748,"node_id":"I_kwDOAAb9Ss6-Fl1s","number":60984,"title":"[JsonStreamer] Selialization brokes on multilevel collections","user":{"login":"p-golovin","id":7702213,"node_id":"MDQ6VXNlcjc3MDIyMTM=","avatar_url":"https://avatars.githubusercontent.com/u/7702213?v=4","gravatar_id":"","url":"https://api.github.com/users/p-golovin","html_url":"https://github.com/p-golovin","followers_url":"https://api.github.com/users/p-golovin/followers","following_url":"https://api.github.com/users/p-golovin/following{/other_user}","gists_url":"https://api.github.com/users/p-golovin/gists{/gist_id}","starred_url":"https://api.github.com/users/p-golovin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/p-golovin/subscriptions","organizations_url":"https://api.github.com/users/p-golovin/orgs","repos_url":"https://api.github.com/users/p-golovin/repos","events_url":"https://api.github.com/users/p-golovin/events{/privacy}","received_events_url":"https://api.github.com/users/p-golovin/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":100079,"node_id":"MDU6TGFiZWwxMDAwNzk=","url":"https://api.github.com/repos/symfony/symfony/labels/Bug","name":"Bug","color":"e10c02","default":false,"description":null},{"id":237003792,"node_id":"MDU6TGFiZWwyMzcwMDM3OTI=","url":"https://api.github.com/repos/symfony/symfony/labels/Status:%20Needs%20Review","name":"Status: Needs Review","color":"ededed","default":false,"description":null},{"id":7869582353,"node_id":"LA_kwDOAAb9Ss8AAAAB1RBMEQ","url":"https://api.github.com/repos/symfony/symfony/labels/JsonStreamer","name":"JsonStreamer","color":"dddddd","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2025-06-30T16:33:20Z","updated_at":"2025-07-07T07:43:58Z","closed_at":"2025-07-07T07:43:58Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Symfony version(s) affected\n\n7.3.1\n\n### Description\n\nIf I try to serialize collection of objects which have embedded collection, I get `Undefined property` error. \nThe problem is in vendor/symfony/json-streamer/Write/StreamWriterGenerator.php:186, which generate code like\n```\nforeach ($value->events as $value)\n```\nand redefine $value with embedded object.\n\n### How to reproduce\n\n```\nnamespace App\\Dto;\n\nuse Symfony\\Component\\JsonStreamer\\Attribute\\JsonStreamable;\n\n#[JsonStreamable]\nclass User\n{\n    public array $names;\n}\n```\n\n```\nnamespace App\\Controller;\n\nuse App\\Dto\\User;\nuse App\\Repository\\UserRepository;\nuse Symfony\\Component\\HttpFoundation\\StreamedResponse;\nuse Symfony\\Component\\JsonStreamer\\StreamWriterInterface;\nuse Symfony\\Component\\TypeInfo\\Type;\n\nclass UserController\n{\n    public function retrieveUsers(StreamWriterInterface $jsonStreamWriter): StreamedResponse\n    {\n        $user1 = new User();\n        $user1->names = ['John', 'Alex'];\n\n        $user2 = new User();\n        $user1->names = ['Mark', 'Andre'];\n\n        $users = [$user1, $user2];\n\n        $type = Type::list(Type::object(User::class));\n\n        $json = $jsonStreamWriter->write($users, $type);\n\n        return new StreamedResponse($json);\n    }\n}\n```\n\n### Possible Solution\n\nReplace in vendor/symfony/json-streamer/Write/StreamWriterGenerator.php:186\n```\n                $this->createDataModel($type->getCollectionValueType(), new VariableDataAccessor('value'), $options, $context),\n\n```\nto\n```\n                $this->createDataModel($type->getCollectionValueType(), new VariableDataAccessor('value' . rand()), $options, $context),\n\n```\n\n### Additional Context\n\n_No response_","closed_by":{"login":"nicolas-grekas","id":243674,"node_id":"MDQ6VXNlcjI0MzY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/243674?v=4","gravatar_id":"","url":"https://api.github.com/users/nicolas-grekas","html_url":"https://github.com/nicolas-grekas","followers_url":"https://api.github.com/users/nicolas-grekas/followers","following_url":"https://api.github.com/users/nicolas-grekas/following{/other_user}","gists_url":"https://api.github.com/users/nicolas-grekas/gists{/gist_id}","starred_url":"https://api.github.com/users/nicolas-grekas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicolas-grekas/subscriptions","organizations_url":"https://api.github.com/users/nicolas-grekas/orgs","repos_url":"https://api.github.com/users/nicolas-grekas/repos","events_url":"https://api.github.com/users/nicolas-grekas/events{/privacy}","received_events_url":"https://api.github.com/users/nicolas-grekas/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/symfony/symfony/issues/60984/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/symfony/symfony/issues/60984/timeline","performed_via_github_app":null,"state_reason":"completed"}