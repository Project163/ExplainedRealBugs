{"url":"https://api.github.com/repos/symfony/symfony/issues/59495","repository_url":"https://api.github.com/repos/symfony/symfony","labels_url":"https://api.github.com/repos/symfony/symfony/issues/59495/labels{/name}","comments_url":"https://api.github.com/repos/symfony/symfony/issues/59495/comments","events_url":"https://api.github.com/repos/symfony/symfony/issues/59495/events","html_url":"https://github.com/symfony/symfony/issues/59495","id":2784771547,"node_id":"I_kwDOAAb9Ss6l_D3b","number":59495,"title":"[Serializer] Discrepancy between NormalizerInterface and it's implementation","user":{"login":"Kefisu","id":32323573,"node_id":"MDQ6VXNlcjMyMzIzNTcz","avatar_url":"https://avatars.githubusercontent.com/u/32323573?v=4","gravatar_id":"","url":"https://api.github.com/users/Kefisu","html_url":"https://github.com/Kefisu","followers_url":"https://api.github.com/users/Kefisu/followers","following_url":"https://api.github.com/users/Kefisu/following{/other_user}","gists_url":"https://api.github.com/users/Kefisu/gists{/gist_id}","starred_url":"https://api.github.com/users/Kefisu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Kefisu/subscriptions","organizations_url":"https://api.github.com/users/Kefisu/orgs","repos_url":"https://api.github.com/users/Kefisu/repos","events_url":"https://api.github.com/users/Kefisu/events{/privacy}","received_events_url":"https://api.github.com/users/Kefisu/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":99939,"node_id":"MDU6TGFiZWw5OTkzOQ==","url":"https://api.github.com/repos/symfony/symfony/labels/Serializer","name":"Serializer","color":"DDDDDD","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2025-01-13T17:47:55Z","updated_at":"2025-02-07T08:06:24Z","closed_at":"2025-02-07T08:06:23Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description\n\n### The \"Problem\"\r\nRight now there is a discrepancy between the `Symfony\\Component\\Serializer\\Normalizer\\NormalizerInterface` and it's implementations within the Symfony codebase.\r\n\r\nIf you look at the signature of the NormalizerInterface.normalize method it looks as follows:\r\n`public function normalize(mixed $data, ?string $format = null, array $context = []): array|string|int|float|bool|\\ArrayObject|null;`\r\n\r\nWhereas most implementing classes are implemented like this:\r\n\r\n**AbstractObjectNormalizer:**\r\n`public function normalize(mixed $object, ?string $format = null, array $context = []): array|string|int|float|bool|\\ArrayObject|null`\r\n\r\n**DateIntervalNormalizer:**\r\n`public function normalize(mixed $object, ?string $format = null, array $context = []): string`\r\n\r\nAnd the list goes on..\r\n\r\nWhilst PHP allows this behavior to exists and doesn't raise any errors for it, with the introduction of named parameters in PHP 8.0 this discrepancy now has the possibility to throw PHP errors such as:\r\n`Error: Unknown named parameter $data`.\r\n\r\n### Acknowledgement\r\nWhilst reading through the existing issues I came upon https://github.com/symfony/symfony/pull/54880 where it was discussed that the BC does not cover this change or would increase the risk of merging changes back into branches. \r\n\r\nHowever, in it's current implementation it is simply impossible to use named parameters when type hinting the `NormalizerInterface` and not running the risk of unexpected PHP errors.\r\n\r\n### Conclusion\r\nTherefore I would like to submit this as a feature (\"not a bug\") type of change to the 7.3/7.4 branch to solve this discrepancy and reducing the risk of unintentional errors for developers using Symfony.\r\n\r\nLinked to this issue is a PR that changes all instances where the NormalizerInterface is implemented but does not follow the Interfaces' signature. \n\n### Example\n\nThe following is a change to the ObjectNormalizerTest that shows that using named parameters on the interface with an implementation of the ObjectNormalizer PHP will throw an error\r\n\r\n```php\r\n<?php\r\n\r\nnamespace Symfony\\Component\\Serializer\\Tests\\Normalizer;\r\n\r\nclass ObjectNormalizerTest extends TestCase\r\n{\r\n    private ObjectNormalizer $normalizer;\r\n    private NormalizerInterface $normalizerInterface;\r\n    private SerializerInterface&NormalizerInterface&MockObject $serializer;\r\n\r\n    protected function setUp(): void\r\n    {\r\n        $this->createNormalizer();\r\n\r\n        $this->normalizerInterface = $this->normalizer;\r\n    }\r\n\r\n    private function createNormalizer(array $defaultContext = [], ?ClassMetadataFactoryInterface $classMetadataFactory = null): void\r\n    {\r\n        $this->serializer = $this->createMock(ObjectSerializerNormalizer::class);\r\n        $this->normalizer = new ObjectNormalizer($classMetadataFactory, null, null, null, null, null, $defaultContext);\r\n        $this->normalizer->setSerializer($this->serializer);\r\n    }\r\n\r\n    // In the current releases this throws an error\r\n    public function testNamedArgumentsOnInterfaceWillThrowError(): void\r\n    {\r\n        $this->normalizerInterface->normalize(\r\n            data: new ObjectDummy(),\r\n            format: 'json',\r\n            context: []\r\n        );\r\n    }\r\n}\r\n```\r\n\r\n\r\n```bash\r\nphp ./phpunit src/Symfony/Component/Serializer\r\n...\r\nTime: 00:00.302, Memory: 39.02 MB\r\n\r\nThere was 1 error:\r\n\r\n1) Symfony\\Component\\Serializer\\Tests\\Normalizer\\ObjectNormalizerTest::testNamedArgumentsOnInterfaceWillThrowError\r\nError: Unknown named parameter $data\r\n```\r\n\r\nAnd after changing all implementations:\r\n\r\n```bash\r\nphp ./phpunit src/Symfony/Component/Serializer\r\n\r\n............................................................. 1098 / 1167 ( 94%)\r\n............................................................. 1159 / 1167 ( 99%)\r\n........                                                      1167 / 1167 (100%)\r\n\r\nTime: 00:00.365, Memory: 39.02 MB\r\n\r\nOK, but incomplete, skipped, or risky tests!\r\nTests: 1167, Assertions: 2258, Skipped: 11.\r\n\r\nLegacy deprecation notices (2)\r\n```","closed_by":{"login":"fabpot","id":47313,"node_id":"MDQ6VXNlcjQ3MzEz","avatar_url":"https://avatars.githubusercontent.com/u/47313?v=4","gravatar_id":"","url":"https://api.github.com/users/fabpot","html_url":"https://github.com/fabpot","followers_url":"https://api.github.com/users/fabpot/followers","following_url":"https://api.github.com/users/fabpot/following{/other_user}","gists_url":"https://api.github.com/users/fabpot/gists{/gist_id}","starred_url":"https://api.github.com/users/fabpot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fabpot/subscriptions","organizations_url":"https://api.github.com/users/fabpot/orgs","repos_url":"https://api.github.com/users/fabpot/repos","events_url":"https://api.github.com/users/fabpot/events{/privacy}","received_events_url":"https://api.github.com/users/fabpot/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/symfony/symfony/issues/59495/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/symfony/symfony/issues/59495/timeline","performed_via_github_app":null,"state_reason":"completed"}