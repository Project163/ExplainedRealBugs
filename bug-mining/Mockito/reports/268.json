{"url":"https://api.github.com/repos/mockito/mockito/issues/2921","repository_url":"https://api.github.com/repos/mockito/mockito","labels_url":"https://api.github.com/repos/mockito/mockito/issues/2921/labels{/name}","comments_url":"https://api.github.com/repos/mockito/mockito/issues/2921/comments","events_url":"https://api.github.com/repos/mockito/mockito/issues/2921/events","html_url":"https://github.com/mockito/mockito/issues/2921","id":1593834998,"node_id":"I_kwDOAF62v85e__32","number":2921,"title":"Use generic type information in TypeBasedCandidateFilter to circumvent type erasure","user":{"login":"jfrantzius","id":1823661,"node_id":"MDQ6VXNlcjE4MjM2NjE=","avatar_url":"https://avatars.githubusercontent.com/u/1823661?v=4","gravatar_id":"","url":"https://api.github.com/users/jfrantzius","html_url":"https://github.com/jfrantzius","followers_url":"https://api.github.com/users/jfrantzius/followers","following_url":"https://api.github.com/users/jfrantzius/following{/other_user}","gists_url":"https://api.github.com/users/jfrantzius/gists{/gist_id}","starred_url":"https://api.github.com/users/jfrantzius/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jfrantzius/subscriptions","organizations_url":"https://api.github.com/users/jfrantzius/orgs","repos_url":"https://api.github.com/users/jfrantzius/repos","events_url":"https://api.github.com/users/jfrantzius/events{/privacy}","received_events_url":"https://api.github.com/users/jfrantzius/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":10,"created_at":"2023-02-21T17:13:28Z","updated_at":"2023-02-27T21:59:10Z","closed_at":"2023-02-21T20:20:16Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hi,\r\nwhen using `@InjectMocks` in combination with multiple `@Mock` fields that have the same generic type (after type erasure), this fails unless the field names in injectee and test class are equal. \r\n\r\nI stumbled over this when I added a second `Provider<T>` field to both test and injectee class, and I guess most other people doing the same will also fail here as miserably as I did (also because googling for `@InjectMock` doesn't show the relevant [InjectMocks documentation](https://javadoc.io/doc/org.mockito/mockito-core/latest/org/mockito/InjectMocks.html) in the first result page ...)\r\n\r\nE.g. this test will fail because I named the test class `@Mock` fields with the suffix `mock`. When deleting that name suffix, the test succeeds.\r\n```java\r\nimport static org.junit.jupiter.api.Assertions.assertNotNull;\r\n\r\nimport javax.inject.Provider;\r\n\r\nimport org.junit.jupiter.api.Test;\r\nimport org.junit.jupiter.api.extension.ExtendWith;\r\nimport org.mockito.InjectMocks;\r\nimport org.mockito.Mock;\r\nimport org.mockito.junit.jupiter.MockitoExtension;\r\n\r\n@ExtendWith(MockitoExtension.class)\r\npublic class InjectMockTest {\r\n    \r\n    public static class UnderTest {\r\n        Provider<String> stringProvider;\r\n        Provider<Integer> intProvider;\r\n    }\r\n\r\n    @Mock\r\n    private Provider<String> stringProviderMock;\r\n\r\n    @Mock\r\n    private Provider<Integer> intProviderMock;\r\n\r\n    @InjectMocks\r\n    private UnderTest underTest;\r\n\r\n    @Test\r\n    public void testInjectMock() {\r\n        assertNotNull(underTest.stringProvider);\r\n        assertNotNull(underTest.intProvider);\r\n    }\r\n\r\n}\r\n```\r\nI saw in the debugger that in `TypeBasedCandidateFilter.filterCandidate()` , `candidateFieldToBeInjected.getGenericType().getTypeName()` yields e.g. `\"javax.inject.Provider<java.lang.Integer>\"`. So if Mockito would maintain the `@Mock` field's `java.lang.reflect.Field` along with the mock object, the generic type names could be compared. \r\n\r\nThis would effectively solve the problem of type erasure for this usecase, which I'd guess is quite common ...","closed_by":{"login":"TimvdLippe","id":5948271,"node_id":"MDQ6VXNlcjU5NDgyNzE=","avatar_url":"https://avatars.githubusercontent.com/u/5948271?v=4","gravatar_id":"","url":"https://api.github.com/users/TimvdLippe","html_url":"https://github.com/TimvdLippe","followers_url":"https://api.github.com/users/TimvdLippe/followers","following_url":"https://api.github.com/users/TimvdLippe/following{/other_user}","gists_url":"https://api.github.com/users/TimvdLippe/gists{/gist_id}","starred_url":"https://api.github.com/users/TimvdLippe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TimvdLippe/subscriptions","organizations_url":"https://api.github.com/users/TimvdLippe/orgs","repos_url":"https://api.github.com/users/TimvdLippe/repos","events_url":"https://api.github.com/users/TimvdLippe/events{/privacy}","received_events_url":"https://api.github.com/users/TimvdLippe/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mockito/mockito/issues/2921/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mockito/mockito/issues/2921/timeline","performed_via_github_app":null,"state_reason":"completed"}