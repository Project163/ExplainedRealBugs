{"url":"https://api.github.com/repos/mockito/mockito/issues/1314","repository_url":"https://api.github.com/repos/mockito/mockito","labels_url":"https://api.github.com/repos/mockito/mockito/issues/1314/labels{/name}","comments_url":"https://api.github.com/repos/mockito/mockito/issues/1314/comments","events_url":"https://api.github.com/repos/mockito/mockito/issues/1314/events","html_url":"https://github.com/mockito/mockito/issues/1314","id":297704841,"node_id":"MDU6SXNzdWUyOTc3MDQ4NDE=","number":1314,"title":"Undesired invocation message improvements","user":{"login":"arturdryomov","id":200401,"node_id":"MDQ6VXNlcjIwMDQwMQ==","avatar_url":"https://avatars.githubusercontent.com/u/200401?v=4","gravatar_id":"","url":"https://api.github.com/users/arturdryomov","html_url":"https://github.com/arturdryomov","followers_url":"https://api.github.com/users/arturdryomov/followers","following_url":"https://api.github.com/users/arturdryomov/following{/other_user}","gists_url":"https://api.github.com/users/arturdryomov/gists{/gist_id}","starred_url":"https://api.github.com/users/arturdryomov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/arturdryomov/subscriptions","organizations_url":"https://api.github.com/users/arturdryomov/orgs","repos_url":"https://api.github.com/users/arturdryomov/repos","events_url":"https://api.github.com/users/arturdryomov/events{/privacy}","received_events_url":"https://api.github.com/users/arturdryomov/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":532126464,"node_id":"MDU6TGFiZWw1MzIxMjY0NjQ=","url":"https://api.github.com/repos/mockito/mockito/labels/please%20contribute","name":"please contribute","color":"0e8a16","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2018-02-16T07:53:37Z","updated_at":"2018-03-25T12:42:19Z","closed_at":"2018-03-25T12:42:19Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Let’s take a look at the following code.\r\n\r\n```kotlin\r\npackage whatever\r\n\r\nimport org.junit.Test\r\nimport org.mockito.Mockito\r\n\r\nclass MultipleUndesiredInvocations {\r\n\r\n    interface Inner {\r\n        fun call()\r\n    }\r\n\r\n    interface SideEffect {\r\n        fun call()\r\n\r\n        class Impl(private val inner: Inner) : SideEffect {\r\n            override fun call() = inner.call()\r\n        }\r\n    }\r\n\r\n    interface Outer {\r\n        fun call()\r\n\r\n        class Impl(private val inner: Inner, sideEffect: SideEffect) : Outer {\r\n\r\n            init {\r\n                sideEffect.call()\r\n            }\r\n\r\n            override fun call() {\r\n                inner.call()\r\n            }\r\n        }\r\n    }\r\n\r\n    @Test\r\n    fun test() {\r\n        val inner = Mockito.mock(Inner::class.java)\r\n        val sideEffect = SideEffect.Impl(inner)\r\n        val outer = Outer.Impl(inner, sideEffect)\r\n\r\n        outer.call()\r\n\r\n        Mockito.verify(inner).call()\r\n    }\r\n}\r\n```\r\nThe `test` will fail, of course. The following message will be shown.\r\n```\r\norg.mockito.exceptions.verification.TooManyActualInvocations: \r\ninner.call();\r\nWanted 1 time:\r\n-> at whatever.MultipleUndesiredInvocations.test(MultipleUndesiredInvocations.kt:43)\r\nBut was 2 times. Undesired invocation:\r\n-> at whatever.MultipleUndesiredInvocations$Outer$Impl.call(MultipleUndesiredInvocations.kt:30)\r\n```\r\nIt is kind of fine, but the undesired call (for me) is actually inside the `SideEffect` class.\r\n\r\nIs it possible to extend the message to show all undesired invocations somehow? It would be extremely helpful when debugging failed tests similar to the sample above — i. e. when a side-effect calls the target object. ","closed_by":{"login":"TimvdLippe","id":5948271,"node_id":"MDQ6VXNlcjU5NDgyNzE=","avatar_url":"https://avatars.githubusercontent.com/u/5948271?v=4","gravatar_id":"","url":"https://api.github.com/users/TimvdLippe","html_url":"https://github.com/TimvdLippe","followers_url":"https://api.github.com/users/TimvdLippe/followers","following_url":"https://api.github.com/users/TimvdLippe/following{/other_user}","gists_url":"https://api.github.com/users/TimvdLippe/gists{/gist_id}","starred_url":"https://api.github.com/users/TimvdLippe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TimvdLippe/subscriptions","organizations_url":"https://api.github.com/users/TimvdLippe/orgs","repos_url":"https://api.github.com/users/TimvdLippe/repos","events_url":"https://api.github.com/users/TimvdLippe/events{/privacy}","received_events_url":"https://api.github.com/users/TimvdLippe/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mockito/mockito/issues/1314/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mockito/mockito/issues/1314/timeline","performed_via_github_app":null,"state_reason":"completed"}