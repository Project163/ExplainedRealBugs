{"url":"https://api.github.com/repos/mockito/mockito/issues/2692","repository_url":"https://api.github.com/repos/mockito/mockito","labels_url":"https://api.github.com/repos/mockito/mockito/issues/2692/labels{/name}","comments_url":"https://api.github.com/repos/mockito/mockito/issues/2692/comments","events_url":"https://api.github.com/repos/mockito/mockito/issues/2692/events","html_url":"https://github.com/mockito/mockito/issues/2692","id":1283745514,"node_id":"I_kwDOAF62v85MhGbq","number":2692,"title":"Misleading error message when mocking and a class (of a parameter) is not found","user":{"login":"dstango","id":13139522,"node_id":"MDQ6VXNlcjEzMTM5NTIy","avatar_url":"https://avatars.githubusercontent.com/u/13139522?v=4","gravatar_id":"","url":"https://api.github.com/users/dstango","html_url":"https://github.com/dstango","followers_url":"https://api.github.com/users/dstango/followers","following_url":"https://api.github.com/users/dstango/following{/other_user}","gists_url":"https://api.github.com/users/dstango/gists{/gist_id}","starred_url":"https://api.github.com/users/dstango/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dstango/subscriptions","organizations_url":"https://api.github.com/users/dstango/orgs","repos_url":"https://api.github.com/users/dstango/repos","events_url":"https://api.github.com/users/dstango/events{/privacy}","received_events_url":"https://api.github.com/users/dstango/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":532126464,"node_id":"MDU6TGFiZWw1MzIxMjY0NjQ=","url":"https://api.github.com/repos/mockito/mockito/labels/please%20contribute","name":"please contribute","color":"0e8a16","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2022-06-24T13:20:11Z","updated_at":"2022-06-25T21:48:56Z","closed_at":"2022-06-25T21:35:54Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Situation:\r\nwe're using a dependency that contains the following code (abbreviated):\r\n\r\n```\r\nimport javax.ws.rs.core.MultivaluedMap;\r\n\r\npublic interface RestClient {\r\n\tRestResponse getRequest(String path, String body, MultivaluedMap<String, String> queryParams);\r\n}\r\n```\r\n\r\nWhen trying to mock this interface like this:\r\n```\r\n\t\tMockito.mock(RestClient.class);\r\n```\r\n\r\nthe following misleading error message is created:\r\n\r\n```\r\norg.mockito.exceptions.base.MockitoException: \r\nMockito cannot mock this class: interface de.persona.dstools.network.rest.RestClient.\r\n\r\nMockito can only mock non-private & non-final classes.\r\nIf you're not sure why you're getting this error, please report to the mailing list.\r\n\r\n\r\nJava               : 11\r\nJVM vendor name    : Azul Systems, Inc.\r\nJVM vendor version : 11.0.14.1+1-LTS\r\nJVM name           : OpenJDK 64-Bit Server VM\r\nJVM version        : 11.0.14.1+1-LTS\r\nJVM info           : mixed mode\r\nOS name            : Windows 10\r\nOS version         : 10.0\r\n\r\n\r\nUnderlying exception : java.lang.IllegalArgumentException: Could not create type\r\n\tat de.persona.salesforce.fetcher.SalesforceToAzureTransferTest.setUp(SalesforceToAzureTransferTest.java:41)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:566)\r\n\tat org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:725)\r\n\tat org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)\r\n\tat org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131)\r\n\tat org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:149)\r\n\tat org.junit.jupiter.engine.extension.TimeoutExtension.interceptLifecycleMethod(TimeoutExtension.java:126)\r\n\tat org.junit.jupiter.engine.extension.TimeoutExtension.interceptBeforeEachMethod(TimeoutExtension.java:76)\r\n\tat org.junit.jupiter.engine.execution.ExecutableInvoker$ReflectiveInterceptorCall.lambda$ofVoidMethod$0(ExecutableInvoker.java:115)\r\n\tat org.junit.jupiter.engine.execution.ExecutableInvoker.lambda$invoke$0(ExecutableInvoker.java:105)\r\n\tat org.junit.jupiter.engine.execution.InvocationInterceptorChain$InterceptedInvocation.proceed(InvocationInterceptorChain.java:106)\r\n\tat org.junit.jupiter.engine.execution.InvocationInterceptorChain.proceed(InvocationInterceptorChain.java:64)\r\n\tat org.junit.jupiter.engine.execution.InvocationInterceptorChain.chainAndInvoke(InvocationInterceptorChain.java:45)\r\n\tat org.junit.jupiter.engine.execution.InvocationInterceptorChain.invoke(InvocationInterceptorChain.java:37)\r\n\tat org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:104)\r\n\tat org.junit.jupiter.engine.execution.ExecutableInvoker.invoke(ExecutableInvoker.java:98)\r\n\tat org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.invokeMethodInExtensionContext(ClassBasedTestDescriptor.java:506)\r\n\tat org.junit.jupiter.engine.descriptor.ClassBasedTestDescriptor.lambda$synthesizeBeforeEachMethodAdapter$21(ClassBasedTestDescriptor.java:491)\r\n\tat org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$invokeBeforeEachMethods$3(TestMethodTestDescriptor.java:171)\r\n\tat org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$invokeBeforeMethodsOrCallbacksUntilExceptionOccurs$6(TestMethodTestDescriptor.java:199)\r\n\tat org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)\r\n\tat org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.invokeBeforeMethodsOrCallbacksUntilExceptionOccurs(TestMethodTestDescriptor.java:199)\r\n\tat org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.invokeBeforeEachMethods(TestMethodTestDescriptor.java:168)\r\n\tat org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:131)\r\n\tat org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:66)\r\n\tat org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:151)\r\n\tat org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)\r\n\tat org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)\r\n\tat org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)\r\n\tat org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)\r\n\tat org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)\r\n\tat org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)\r\n\tat org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)\r\n\tat java.base/java.util.ArrayList.forEach(ArrayList.java:1541)\r\n\tat org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)\r\n\tat org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)\r\n\tat org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)\r\n\tat org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)\r\n\tat org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)\r\n\tat org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)\r\n\tat org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)\r\n\tat org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)\r\n\tat org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)\r\n\tat java.base/java.util.ArrayList.forEach(ArrayList.java:1541)\r\n\tat org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)\r\n\tat org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)\r\n\tat org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)\r\n\tat org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)\r\n\tat org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)\r\n\tat org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)\r\n\tat org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)\r\n\tat org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)\r\n\tat org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)\r\n\tat org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:35)\r\n\tat org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57)\r\n\tat org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:54)\r\n\tat org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:107)\r\n\tat org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:88)\r\n\tat org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$execute$0(EngineExecutionOrchestrator.java:54)\r\n\tat org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInterceptedStreams(EngineExecutionOrchestrator.java:67)\r\n\tat org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:52)\r\n\tat org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:114)\r\n\tat org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:95)\r\n\tat org.junit.platform.launcher.core.DefaultLauncherSession$DelegatingLauncher.execute(DefaultLauncherSession.java:91)\r\n\tat org.junit.platform.launcher.core.SessionPerRequestLauncher.execute(SessionPerRequestLauncher.java:60)\r\n\tat org.eclipse.jdt.internal.junit5.runner.JUnit5TestReference.run(JUnit5TestReference.java:98)\r\n\tat org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:40)\r\n\tat org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:529)\r\n\tat org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:756)\r\n\tat org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:452)\r\n\tat org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:210)\r\nCaused by: java.lang.IllegalArgumentException: Could not create type\r\n\tat net.bytebuddy.TypeCache.findOrInsert(TypeCache.java:170)\r\n\tat net.bytebuddy.TypeCache$WithInlineExpunction.findOrInsert(TypeCache.java:399)\r\n\tat net.bytebuddy.TypeCache.findOrInsert(TypeCache.java:190)\r\n\tat net.bytebuddy.TypeCache$WithInlineExpunction.findOrInsert(TypeCache.java:410)\r\n\tat org.mockito.internal.creation.bytebuddy.TypeCachingBytecodeGenerator.mockClass(TypeCachingBytecodeGenerator.java:40)\r\n\tat org.mockito.internal.creation.bytebuddy.SubclassByteBuddyMockMaker.createMockType(SubclassByteBuddyMockMaker.java:77)\r\n\tat org.mockito.internal.creation.bytebuddy.SubclassByteBuddyMockMaker.createMock(SubclassByteBuddyMockMaker.java:43)\r\n\tat org.mockito.internal.creation.bytebuddy.ByteBuddyMockMaker.createMock(ByteBuddyMockMaker.java:42)\r\n\tat org.mockito.internal.util.MockUtil.createMock(MockUtil.java:53)\r\n\tat org.mockito.internal.MockitoCore.mock(MockitoCore.java:96)\r\n\tat org.mockito.Mockito.mock(Mockito.java:1981)\r\n\tat org.mockito.Mockito.mock(Mockito.java:1896)\r\n\t... 74 more\r\nCaused by: java.lang.NoClassDefFoundError: javax/ws/rs/core/MultivaluedMap\r\n\tat java.base/java.lang.Class.getDeclaredMethods0(Native Method)\r\n\tat java.base/java.lang.Class.privateGetDeclaredMethods(Class.java:3166)\r\n\tat java.base/java.lang.Class.privateGetPublicMethods(Class.java:3191)\r\n\tat java.base/java.lang.Class.getMethods(Class.java:1904)\r\n\tat org.mockito.internal.creation.bytebuddy.SubclassBytecodeGenerator.hasNonPublicTypeReference(SubclassBytecodeGenerator.java:112)\r\n\tat org.mockito.internal.creation.bytebuddy.SubclassBytecodeGenerator.needsSamePackageClassLoader(SubclassBytecodeGenerator.java:96)\r\n\tat org.mockito.internal.creation.bytebuddy.SubclassBytecodeGenerator.mockClass(SubclassBytecodeGenerator.java:139)\r\n\tat org.mockito.internal.creation.bytebuddy.TypeCachingBytecodeGenerator.lambda$mockClass$0(TypeCachingBytecodeGenerator.java:47)\r\n\tat net.bytebuddy.TypeCache.findOrInsert(TypeCache.java:168)\r\n\t... 85 more\r\nCaused by: java.lang.ClassNotFoundException: javax.ws.rs.core.MultivaluedMap\r\n\tat java.base/jdk.internal.loader.BuiltinClassLoader.loadClass(BuiltinClassLoader.java:581)\r\n\tat java.base/jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass(ClassLoaders.java:178)\r\n\tat java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:522)\r\n\t... 94 more\r\n```\r\n\r\nThe misleading message on top states\r\n```\r\nMockito can only mock non-private & non-final classes.\r\n```\r\n\r\nThis is not related to a final or private class, but to a *missing* class (due to a problem within our dependencies), as the last chained exception states.\r\n\r\nBefore checking all the chained exceptions it lead us into a totally wrong direction, and had us puzzled for quite a while: in our case it's because of the parameter `MultivaluedMap` which used to live in `javax.ws`, but has been moved to `jakarta.ws` ...\r\n\r\nIt would be great if Mockito could \r\n* have a more differentiated response if a class/interface is not found, or\r\n* (as a courtesy) present the message of the last chained exception on top, or\r\n* have a less distinct wording like \"Mockito can only mock non-private & non-final classes (yet this error might occur for other reasons, too -- check the stackt trace).\"\r\n\r\nThanks for considering!","closed_by":{"login":"dstango","id":13139522,"node_id":"MDQ6VXNlcjEzMTM5NTIy","avatar_url":"https://avatars.githubusercontent.com/u/13139522?v=4","gravatar_id":"","url":"https://api.github.com/users/dstango","html_url":"https://github.com/dstango","followers_url":"https://api.github.com/users/dstango/followers","following_url":"https://api.github.com/users/dstango/following{/other_user}","gists_url":"https://api.github.com/users/dstango/gists{/gist_id}","starred_url":"https://api.github.com/users/dstango/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dstango/subscriptions","organizations_url":"https://api.github.com/users/dstango/orgs","repos_url":"https://api.github.com/users/dstango/repos","events_url":"https://api.github.com/users/dstango/events{/privacy}","received_events_url":"https://api.github.com/users/dstango/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mockito/mockito/issues/2692/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mockito/mockito/issues/2692/timeline","performed_via_github_app":null,"state_reason":"completed"}