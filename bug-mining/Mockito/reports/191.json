{"url":"https://api.github.com/repos/mockito/mockito/issues/1853","repository_url":"https://api.github.com/repos/mockito/mockito","labels_url":"https://api.github.com/repos/mockito/mockito/issues/1853/labels{/name}","comments_url":"https://api.github.com/repos/mockito/mockito/issues/1853/comments","events_url":"https://api.github.com/repos/mockito/mockito/issues/1853/events","html_url":"https://github.com/mockito/mockito/issues/1853","id":544660065,"node_id":"MDU6SXNzdWU1NDQ2NjAwNjU=","number":1853,"title":"Allow @MockitoSettings to be inherited","user":{"login":"fabianMendez","id":32204060,"node_id":"MDQ6VXNlcjMyMjA0MDYw","avatar_url":"https://avatars.githubusercontent.com/u/32204060?v=4","gravatar_id":"","url":"https://api.github.com/users/fabianMendez","html_url":"https://github.com/fabianMendez","followers_url":"https://api.github.com/users/fabianMendez/followers","following_url":"https://api.github.com/users/fabianMendez/following{/other_user}","gists_url":"https://api.github.com/users/fabianMendez/gists{/gist_id}","starred_url":"https://api.github.com/users/fabianMendez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fabianMendez/subscriptions","organizations_url":"https://api.github.com/users/fabianMendez/orgs","repos_url":"https://api.github.com/users/fabianMendez/repos","events_url":"https://api.github.com/users/fabianMendez/events{/privacy}","received_events_url":"https://api.github.com/users/fabianMendez/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2020-01-02T16:57:11Z","updated_at":"2020-02-21T21:22:23Z","closed_at":"2020-01-02T22:43:48Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":" - [X] The mockito message in the stacktrace have useful information, but it didn't help\r\n - [X] The problematic code (if that's possible) is copied here;\r\n       Note that some configuration are impossible to mock via Mockito\r\n - [X] Provide versions (mockito / jdk / os / any other relevant information)\r\n - [X] Provide a [Short, Self Contained, Correct (Compilable), Example](http://sscce.org) of the issue\r\n       (same as any question on stackoverflow.com)\r\n - [X] Read the [contributing guide](https://github.com/mockito/mockito/blob/release/3.x/.github/CONTRIBUTING.md)\r\n\r\nI have a base test class which among other things mocks a \"serviceLocator\" and a very common class used by many other services:\r\n\r\n```java\r\n@ExtendWith(MockitoExtension.class)\r\npublic abstract class DomainServiceTests<T> {\r\n\t@Mock\r\n\tprotected ServiceLocator sl;\r\n\r\n\t@Spy\r\n\tprotected UserEnvironmentService userEnvironment;\r\n\r\n\t@BeforeEach\r\n\tpublic void setup() throws Exception {\r\n\t\tMockito.when(sl.get(UserEnvironmentService.class)).thenReturn(userEnvironment);\r\n\t}\r\n}\r\n```\r\n\r\nBut whenever any test try to mock the get method of this serviceLocator with a different class I get an UnnecessaryStubbingException:\r\n\r\n```\r\norg.mockito.exceptions.misusing.UnnecessaryStubbingException:\r\n    Unnecessary stubbings detected.\r\n    Clean & maintainable test code requires zero unnecessary code.\r\n    Following stubbings are unnecessary (click to navigate to relevant line of code):\r\n      1. -> at *.DomainServiceTests.setup(DomainServiceTests.java:24)\r\n    Please remove unnecessary stubbings or use 'lenient' strictness. More info: javadoc for UnnecessaryStubbingException class.\r\n```\r\n\r\nThen I specify the strictness in the base test class \r\n\r\n```java\r\n@MockitoSettings(strictness = Strictness.WARN)\r\npublic abstract class DomainServiceTests<T> {\r\n```\r\nBut even though the strictness is not seen by mockito.\r\n\r\nI have debugged the code and found that the strictness is retrieved by searching the annotation on the method and the class of the test\r\n\r\nhttps://github.com/mockito/mockito/blob/b2b66f430a5bf890135c0c25872bf9869eb09aec/subprojects/junit-jupiter/src/main/java/org/mockito/junit/jupiter/MockitoExtension.java#L143-L145\r\n\r\nThis eventually calls \r\n\r\nhttps://github.com/junit-team/junit5/blob/5e41ebe612fd67e905f96f1dd3184a071b65be17/junit-platform-commons/src/main/java/org/junit/platform/commons/util/AnnotationUtils.java#L108-L112\r\n```java\r\npublic static <A extends Annotation> Optional<A> findAnnotation(AnnotatedElement element, Class<A> annotationType) {\r\n\tPreconditions.notNull(annotationType, \"annotationType must not be null\");\r\n\tboolean inherited = annotationType.isAnnotationPresent(Inherited.class);\r\n\treturn findAnnotation(element, annotationType, inherited, new HashSet<>());\r\n}\r\n```\r\n\r\nSo if you annotate `MockitoSettings` with `java.lang.annotation.Inherited` it will work (I turned the inherited variable to true using the debugger to confirm).\r\n\r\n\r\nFor now I will have to annotate every test class with\r\n```java\r\n@MockitoSettings(strictness = Strictness.WARN)\r\n```\r\n\r\nI am using  Gradle 7.0 with JUnit 5.5.2\r\n\r\nThanks","closed_by":{"login":"TimvdLippe","id":5948271,"node_id":"MDQ6VXNlcjU5NDgyNzE=","avatar_url":"https://avatars.githubusercontent.com/u/5948271?v=4","gravatar_id":"","url":"https://api.github.com/users/TimvdLippe","html_url":"https://github.com/TimvdLippe","followers_url":"https://api.github.com/users/TimvdLippe/followers","following_url":"https://api.github.com/users/TimvdLippe/following{/other_user}","gists_url":"https://api.github.com/users/TimvdLippe/gists{/gist_id}","starred_url":"https://api.github.com/users/TimvdLippe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TimvdLippe/subscriptions","organizations_url":"https://api.github.com/users/TimvdLippe/orgs","repos_url":"https://api.github.com/users/TimvdLippe/repos","events_url":"https://api.github.com/users/TimvdLippe/events{/privacy}","received_events_url":"https://api.github.com/users/TimvdLippe/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mockito/mockito/issues/1853/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mockito/mockito/issues/1853/timeline","performed_via_github_app":null,"state_reason":"completed"}