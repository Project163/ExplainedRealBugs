{"url":"https://api.github.com/repos/mockito/mockito/issues/2798","repository_url":"https://api.github.com/repos/mockito/mockito","labels_url":"https://api.github.com/repos/mockito/mockito/issues/2798/labels{/name}","comments_url":"https://api.github.com/repos/mockito/mockito/issues/2798/comments","events_url":"https://api.github.com/repos/mockito/mockito/issues/2798/events","html_url":"https://github.com/mockito/mockito/issues/2798","id":1462007782,"node_id":"I_kwDOAF62v85XJHfm","number":2798,"title":"Update minimum support Java version from 8 to 11","user":{"login":"reta","id":509855,"node_id":"MDQ6VXNlcjUwOTg1NQ==","avatar_url":"https://avatars.githubusercontent.com/u/509855?v=4","gravatar_id":"","url":"https://api.github.com/users/reta","html_url":"https://github.com/reta","followers_url":"https://api.github.com/users/reta/followers","following_url":"https://api.github.com/users/reta/following{/other_user}","gists_url":"https://api.github.com/users/reta/gists{/gist_id}","starred_url":"https://api.github.com/users/reta/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/reta/subscriptions","organizations_url":"https://api.github.com/users/reta/orgs","repos_url":"https://api.github.com/users/reta/repos","events_url":"https://api.github.com/users/reta/events{/privacy}","received_events_url":"https://api.github.com/users/reta/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":532126464,"node_id":"MDU6TGFiZWw1MzIxMjY0NjQ=","url":"https://api.github.com/repos/mockito/mockito/labels/please%20contribute","name":"please contribute","color":"0e8a16","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2022-11-23T15:57:06Z","updated_at":"2022-12-18T19:52:30Z","closed_at":"2022-12-18T19:52:30Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hello!\r\n\r\nWe [1] have been using Mockito with JDK's `SecurityManager` (for historical reasons), the things worked fine for us till Mockito `4.8.0` release (and later versions). The culprit is `Java9PlusLocationImpl` (see please stack trace below):\r\n\r\n```\r\nCaused by: java.security.AccessControlException: access denied (\"java.lang.RuntimePermission\" \"accessDeclaredMembers\")\r\n\tat java.base/java.security.AccessControlContext.checkPermission(AccessControlContext.java:472)\r\n\tat java.base/java.security.AccessController.checkPermission(AccessController.java:897)\r\n\tat java.base/java.lang.SecurityManager.checkPermission(SecurityManager.java:322)\r\n\tat java.base/java.lang.Class.checkMemberAccess(Class.java:2847)\r\n\tat java.base/java.lang.Class.getDeclaredMethod(Class.java:2471)\r\n\tat org.mockito.internal.debugging.Java9PlusLocationImpl.stackWalker(Java9PlusLocationImpl.java:191)\r\n\tat org.mockito.internal.debugging.Java9PlusLocationImpl.<clinit>(Java9PlusLocationImpl.java:50)\r\n\t... 47 more\r\n\r\n```\r\n\r\nBy all means, `Mockito` should know nothing about `SecurityManager` and the way we implemented mocking under `SecurityManager`  is by using `Mockito`'s extensibility model - plugins (primary, `MockMaker`). Sadly for `LocationFactory` / `Location` there is no such plugin available so we are stuck on 4.7.x release line. If such plugin would have been available, we could provide privileged implementation for reflection calls. Alternatively, wrapping up Java 9 implementation into multi-release JAR (and getting rid of reflection), would have helped.\r\n\r\nWe are happy to submit the pull request with either solution, but it would be helpful to know if there is an interest addressing this issue in general, and preferred approach in particular:\r\n   - plugin for `LocationFactory` / `Location`\r\n   - multi-release JAR for Java 9\r\n\r\nThank you.\r\n\r\n - [X] The mockito message in the stacktrace have useful information, but it didn't help\r\n - [X] The problematic code (if that's possible) is copied here;\r\n       Note that some configuration are impossible to mock via Mockito\r\n - [X] Provide versions (mockito / jdk / os / any other relevant information)\r\n - [ ] Provide a [Short, Self Contained, Correct (Compilable), Example](http://sscce.org) of the issue\r\n       (same as any question on stackoverflow.com)\r\n - [X] Read the [contributing guide](https://github.com/mockito/mockito/blob/main/.github/CONTRIBUTING.md)\r\n\r\n[1] https://github.com/opensearch-project/OpenSearch\r\n","closed_by":{"login":"TimvdLippe","id":5948271,"node_id":"MDQ6VXNlcjU5NDgyNzE=","avatar_url":"https://avatars.githubusercontent.com/u/5948271?v=4","gravatar_id":"","url":"https://api.github.com/users/TimvdLippe","html_url":"https://github.com/TimvdLippe","followers_url":"https://api.github.com/users/TimvdLippe/followers","following_url":"https://api.github.com/users/TimvdLippe/following{/other_user}","gists_url":"https://api.github.com/users/TimvdLippe/gists{/gist_id}","starred_url":"https://api.github.com/users/TimvdLippe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TimvdLippe/subscriptions","organizations_url":"https://api.github.com/users/TimvdLippe/orgs","repos_url":"https://api.github.com/users/TimvdLippe/repos","events_url":"https://api.github.com/users/TimvdLippe/events{/privacy}","received_events_url":"https://api.github.com/users/TimvdLippe/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mockito/mockito/issues/2798/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mockito/mockito/issues/2798/timeline","performed_via_github_app":null,"state_reason":"completed"}