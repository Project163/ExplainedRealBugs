{"url":"https://api.github.com/repos/mockito/mockito/issues/1621","repository_url":"https://api.github.com/repos/mockito/mockito","labels_url":"https://api.github.com/repos/mockito/mockito/issues/1621/labels{/name}","comments_url":"https://api.github.com/repos/mockito/mockito/issues/1621/comments","events_url":"https://api.github.com/repos/mockito/mockito/issues/1621/events","html_url":"https://github.com/mockito/mockito/issues/1621","id":410057880,"node_id":"MDU6SXNzdWU0MTAwNTc4ODA=","number":1621,"title":"RETURNS_DEEP_STUBS causes \"Raw extraction not supported for : 'null'\" in some cases","user":{"login":"zman0900","id":428589,"node_id":"MDQ6VXNlcjQyODU4OQ==","avatar_url":"https://avatars.githubusercontent.com/u/428589?v=4","gravatar_id":"","url":"https://api.github.com/users/zman0900","html_url":"https://github.com/zman0900","followers_url":"https://api.github.com/users/zman0900/followers","following_url":"https://api.github.com/users/zman0900/following{/other_user}","gists_url":"https://api.github.com/users/zman0900/gists{/gist_id}","starred_url":"https://api.github.com/users/zman0900/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zman0900/subscriptions","organizations_url":"https://api.github.com/users/zman0900/orgs","repos_url":"https://api.github.com/users/zman0900/repos","events_url":"https://api.github.com/users/zman0900/events{/privacy}","received_events_url":"https://api.github.com/users/zman0900/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":16375483,"node_id":"MDU6TGFiZWwxNjM3NTQ4Mw==","url":"https://api.github.com/repos/mockito/mockito/labels/bug","name":"bug","color":"fc2929","default":true,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-02-13T23:49:49Z","updated_at":"2019-03-04T15:20:44Z","closed_at":"2019-03-04T15:20:44Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"When trying to mock the [Hadoop Mapper.Context](https://github.com/apache/hadoop/blob/release-2.6.0/hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-core/src/main/java/org/apache/hadoop/mapreduce/Mapper.java#L105) class with Mockito 2.24.0, exception `org.mockito.exceptions.base.MockitoException: Raw extraction not supported for : 'null'` is thrown when calling one of the methods that returns a generic type.  \r\n\r\nActual mocking is taking place inside the [MRUnit library](https://mrunit.apache.org/), as seen in [MockMapContextWrapper](https://github.com/apache/attic-mrunit/blob/release-1.1.0/src/main/java/org/apache/hadoop/mrunit/internal/mapreduce/MockMapContextWrapper.java#L75): \r\n\r\n    final Mapper<KEYIN, VALUEIN, KEYOUT, VALUEOUT>.Context context = mock(org.apache.hadoop.mapreduce.Mapper.Context.class, Mockito.RETURNS_DEEP_STUBS);\r\n\r\nContext is an abstract inner class of Mapper, and implements the [MapContext](https://github.com/apache/hadoop/blob/release-2.6.0/hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-core/src/main/java/org/apache/hadoop/mapreduce/MapContext.java) interface, which extends the [TaskInputOutputContext](https://github.com/apache/hadoop/blob/release-2.6.0/hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-core/src/main/java/org/apache/hadoop/mapreduce/TaskInputOutputContext.java) interface, which extends several other non-generic interfaces. \r\n\r\nException is thrown later when calling the [`context.getCurrentKey()`](https://github.com/apache/hadoop/blob/release-2.6.0/hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-core/src/main/java/org/apache/hadoop/mapreduce/TaskInputOutputContext.java#L51) method on the mock, which returns generic type `KEYIN`.\r\n\r\nThis works fine with Mockito 1.\r\n\r\nMRUnit project is abandoned, so it is not possible to change the mock.  It by default uses old Mockito 1.9.5, and works with 1.10.19.  I am attempting to exclude its dependencies on old Mockito and Powermock, and instead provide latest Mockito 2.24.0 and Powermock 2.0.0 so that my project using MRUnit and Mockito will not be permanently stuck on Mockito 1. \r\n\r\nThe only time these problem methods appear to be [called within MRUnit is to set up stubbing](https://github.com/apache/attic-mrunit/blob/release-1.1.0/src/main/java/org/apache/hadoop/mrunit/internal/mapreduce/MockMapContextWrapper.java#L96), so it doesn't really matter what the return value is in this case.  Should this even work with Mockito, or was this just a bug in Mockito 1 that MRUnit exploited? \r\n\r\n----\r\n\r\nHere is a minimal example that reproduces the issue:\r\n\r\n```Java\r\npackage example;\r\n\r\nimport org.junit.Before;\r\nimport org.junit.Test;\r\n\r\nimport static org.mockito.Mockito.RETURNS_DEEP_STUBS;\r\nimport static org.mockito.Mockito.mock;\r\n\r\npublic class Example {\r\n\r\n    public interface FirstInterface<T> {\r\n        boolean normal();\r\n        T generic();\r\n    }\r\n\r\n    public interface SecondInterface<T> extends FirstInterface<T> { }\r\n\r\n    public class TestClass<T> {\r\n        public abstract class AbstractInner implements SecondInterface<T> { }\r\n    }\r\n\r\n    private TestClass.AbstractInner testMock;\r\n\r\n    @Before\r\n    public void setup() {\r\n        testMock = mock(TestClass.AbstractInner.class, RETURNS_DEEP_STUBS);\r\n    }\r\n\r\n    @Test\r\n    public void works() {\r\n        testMock.normal();\r\n    }\r\n\r\n    @Test\r\n    public void fails() {\r\n        testMock.generic();\r\n    }\r\n}\r\n```\r\n\r\nhttps://github.com/zman0900/mockito-example has this code with a gradle build.\r\n\r\nBoth tests pass with Mockito 1.10.19, but one fails with 2.24.0.  Changing TestClass.AbstractInner to implement FirstInterface instead of SecondInterface causes the same failure with both Mockito 1 and 2.","closed_by":{"login":"TimvdLippe","id":5948271,"node_id":"MDQ6VXNlcjU5NDgyNzE=","avatar_url":"https://avatars.githubusercontent.com/u/5948271?v=4","gravatar_id":"","url":"https://api.github.com/users/TimvdLippe","html_url":"https://github.com/TimvdLippe","followers_url":"https://api.github.com/users/TimvdLippe/followers","following_url":"https://api.github.com/users/TimvdLippe/following{/other_user}","gists_url":"https://api.github.com/users/TimvdLippe/gists{/gist_id}","starred_url":"https://api.github.com/users/TimvdLippe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TimvdLippe/subscriptions","organizations_url":"https://api.github.com/users/TimvdLippe/orgs","repos_url":"https://api.github.com/users/TimvdLippe/repos","events_url":"https://api.github.com/users/TimvdLippe/events{/privacy}","received_events_url":"https://api.github.com/users/TimvdLippe/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mockito/mockito/issues/1621/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mockito/mockito/issues/1621/timeline","performed_via_github_app":null,"state_reason":"completed"}