{"url":"https://api.github.com/repos/mockito/mockito/issues/1364","repository_url":"https://api.github.com/repos/mockito/mockito","labels_url":"https://api.github.com/repos/mockito/mockito/issues/1364/labels{/name}","comments_url":"https://api.github.com/repos/mockito/mockito/issues/1364/comments","events_url":"https://api.github.com/repos/mockito/mockito/issues/1364/events","html_url":"https://github.com/mockito/mockito/issues/1364","id":312366165,"node_id":"MDU6SXNzdWUzMTIzNjYxNjU=","number":1364,"title":"Unable to mock interfaces in Android instrumentation tests","user":{"login":"ZOlbrys","id":2875924,"node_id":"MDQ6VXNlcjI4NzU5MjQ=","avatar_url":"https://avatars.githubusercontent.com/u/2875924?v=4","gravatar_id":"","url":"https://api.github.com/users/ZOlbrys","html_url":"https://github.com/ZOlbrys","followers_url":"https://api.github.com/users/ZOlbrys/followers","following_url":"https://api.github.com/users/ZOlbrys/following{/other_user}","gists_url":"https://api.github.com/users/ZOlbrys/gists{/gist_id}","starred_url":"https://api.github.com/users/ZOlbrys/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ZOlbrys/subscriptions","organizations_url":"https://api.github.com/users/ZOlbrys/orgs","repos_url":"https://api.github.com/users/ZOlbrys/repos","events_url":"https://api.github.com/users/ZOlbrys/events{/privacy}","received_events_url":"https://api.github.com/users/ZOlbrys/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":16375483,"node_id":"MDU6TGFiZWwxNjM3NTQ4Mw==","url":"https://api.github.com/repos/mockito/mockito/labels/bug","name":"bug","color":"fc2929","default":true,"description":null},{"id":305646380,"node_id":"MDU6TGFiZWwzMDU2NDYzODA=","url":"https://api.github.com/repos/mockito/mockito/labels/android","name":"android","color":"009800","default":false,"description":null},{"id":873781054,"node_id":"MDU6TGFiZWw4NzM3ODEwNTQ=","url":"https://api.github.com/repos/mockito/mockito/labels/byte-buddy-1.8.0","name":"byte-buddy-1.8.0","color":"2672a5","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"raphw","id":4489328,"node_id":"MDQ6VXNlcjQ0ODkzMjg=","avatar_url":"https://avatars.githubusercontent.com/u/4489328?v=4","gravatar_id":"","url":"https://api.github.com/users/raphw","html_url":"https://github.com/raphw","followers_url":"https://api.github.com/users/raphw/followers","following_url":"https://api.github.com/users/raphw/following{/other_user}","gists_url":"https://api.github.com/users/raphw/gists{/gist_id}","starred_url":"https://api.github.com/users/raphw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/raphw/subscriptions","organizations_url":"https://api.github.com/users/raphw/orgs","repos_url":"https://api.github.com/users/raphw/repos","events_url":"https://api.github.com/users/raphw/events{/privacy}","received_events_url":"https://api.github.com/users/raphw/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"raphw","id":4489328,"node_id":"MDQ6VXNlcjQ0ODkzMjg=","avatar_url":"https://avatars.githubusercontent.com/u/4489328?v=4","gravatar_id":"","url":"https://api.github.com/users/raphw","html_url":"https://github.com/raphw","followers_url":"https://api.github.com/users/raphw/followers","following_url":"https://api.github.com/users/raphw/following{/other_user}","gists_url":"https://api.github.com/users/raphw/gists{/gist_id}","starred_url":"https://api.github.com/users/raphw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/raphw/subscriptions","organizations_url":"https://api.github.com/users/raphw/orgs","repos_url":"https://api.github.com/users/raphw/repos","events_url":"https://api.github.com/users/raphw/events{/privacy}","received_events_url":"https://api.github.com/users/raphw/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":10,"created_at":"2018-04-09T01:57:37Z","updated_at":"2019-03-04T10:08:19Z","closed_at":"2018-04-15T20:50:43Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Consider the following Android instrumentation test:\r\n\r\n```\r\n@Test\r\npublic void testMockito() {\r\n    final Collection mockCollection = Mockito.mock(Collection.class);\r\n\r\n    Assert.assertTrue(true);\r\n}\r\n```\r\n\r\nWhen run, I see the following output:\r\n\r\n```\r\nTesting started at 21:54 ...\r\n\r\n04/08 21:54:01: Launching testMockito()\r\nNo apk changes detected since last installation, skipping installation of D:\\Code\\TestApp\\app\\build\\outputs\\apk\\debug\\app-debug.apk\r\n$ adb push D:\\Code\\TestApp\\app\\build\\outputs\\apk\\androidTest\\debug\\app-debug-androidTest.apk /data/local/tmp/com.example.zolbr.testapp.test\r\n$ adb shell pm install -t -r \"/data/local/tmp/com.example.zolbr.testapp.test\"\r\nSuccess\r\n\r\n\r\nRunning tests\r\n\r\n$ adb shell am instrument -w -r   -e debug false -e class 'com.example.zolbr.testapp.ExampleInstrumentedTest#testMockito' com.example.zolbr.testapp.test/android.support.test.runner.AndroidJUnitRunner\r\nClient not ready yet..\r\nStarted running tests\r\n\r\norg.mockito.exceptions.base.MockitoException:\r\nMockito cannot mock this class: interface java.util.Collection.\r\n\r\nMockito can only mock non-private & non-final classes.\r\nIf you're not sure why you're getting this error, please report to the mailing list.\r\n\r\n\r\n\r\nIMPORTANT INFORMATION FOR ANDROID USERS:\r\n\r\nThe regular Byte Buddy mock makers cannot generate code on an Android VM!\r\nTo resolve this, please use the 'mockito-android' dependency for your application:\r\nhttp://search.maven.org/#search%7Cga%7C1%7Ca%3A%22mockito-android%22%20g%3A%22org.mockito%22\r\n\r\nJava               : 0.9\r\nJVM vendor name    : The Android Project\r\nJVM vendor version : 2.1.0\r\nJVM name           : Dalvik\r\nJVM version        : 0.9\r\nJVM info           : null\r\nOS name            : Linux\r\nOS version         : 3.18.56+\r\n\r\n\r\nUnderlying exception : java.lang.IllegalArgumentException: Could not create type\r\nat com.example.zolbr.testapp.ExampleInstrumentedTest.testMockito(ExampleInstrumentedTest.java:40)\r\nat java.lang.reflect.Method.invoke(Native Method)\r\nat org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)\r\nat org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)\r\nat org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)\r\nat org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)\r\nat org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)\r\nat org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)\r\nat org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)\r\nat org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)\r\nat org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)\r\nat org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)\r\nat org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)\r\nat org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)\r\nat org.junit.runners.ParentRunner.run(ParentRunner.java:363)\r\nat org.junit.runners.Suite.runChild(Suite.java:128)\r\nat org.junit.runners.Suite.runChild(Suite.java:27)\r\nat org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)\r\nat org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)\r\nat org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)\r\nat org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)\r\nat org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)\r\nat org.junit.runners.ParentRunner.run(ParentRunner.java:363)\r\nat org.junit.runner.JUnitCore.run(JUnitCore.java:137)\r\nat org.junit.runner.JUnitCore.run(JUnitCore.java:115)\r\nat android.support.test.internal.runner.TestExecutor.execute(TestExecutor.java:58)\r\nat android.support.test.runner.AndroidJUnitRunner.onStart(AndroidJUnitRunner.java:375)\r\nat android.app.Instrumentation$InstrumentationThread.run(Instrumentation.java:2074)\r\nCaused by: java.lang.IllegalArgumentException: Could not create type\r\nat net.bytebuddy.TypeCache.findOrInsert(TypeCache.java:139)\r\nat net.bytebuddy.TypeCache$WithInlineExpunction.findOrInsert(TypeCache.java:345)\r\nat net.bytebuddy.TypeCache.findOrInsert(TypeCache.java:160)\r\nat net.bytebuddy.TypeCache$WithInlineExpunction.findOrInsert(TypeCache.java:354)\r\nat org.mockito.internal.creation.bytebuddy.TypeCachingBytecodeGenerator.mockClass(TypeCachingBytecodeGenerator.java:32)\r\nat org.mockito.internal.creation.bytebuddy.SubclassByteBuddyMockMaker.createMockType(SubclassByteBuddyMockMaker.java:71)\r\nat org.mockito.internal.creation.bytebuddy.SubclassByteBuddyMockMaker.createMock(SubclassByteBuddyMockMaker.java:42)\r\nat org.mockito.android.internal.creation.AndroidByteBuddyMockMaker.createMock(AndroidByteBuddyMockMaker.java:39)\r\nat org.mockito.internal.util.MockUtil.createMock(MockUtil.java:35)\r\nat org.mockito.internal.MockitoCore.mock(MockitoCore.java:65)\r\nat org.mockito.Mockito.mock(Mockito.java:1875)\r\nat org.mockito.Mockito.mock(Mockito.java:1784)\r\n... 28 more\r\nCaused by: java.lang.IncompatibleClassChangeError: The method 'int java.lang.Object.hashCode()' was expected to be of type interface but instead was found to be of type virtual (declaration of 'net.bytebuddy.dynamic.scaffold.MethodRegistry$Handler$ForImplementation' appears in /data/app/com.example.zolbr.testapp.test-OVcvUgjejP8CYF6lGYt9Pg==/base.apk)\r\nat net.bytebuddy.dynamic.scaffold.MethodRegistry$Handler$ForImplementation.hashCode(Unknown Source:2)\r\nat java.util.HashMap.hash(HashMap.java:338)\r\nat java.util.HashMap.put(HashMap.java:611)\r\nat java.util.HashSet.add(HashSet.java:219)\r\nat net.bytebuddy.dynamic.scaffold.MethodRegistry$Default.prepare(MethodRegistry.java:409)\r\nat net.bytebuddy.dynamic.scaffold.subclass.SubclassDynamicTypeBuilder.make(SubclassDynamicTypeBuilder.java:162)\r\nat net.bytebuddy.dynamic.scaffold.subclass.SubclassDynamicTypeBuilder.make(SubclassDynamicTypeBuilder.java:155)\r\nat net.bytebuddy.dynamic.DynamicType$Builder$AbstractBase.make(DynamicType.java:2669)\r\nat org.mockito.internal.creation.bytebuddy.SubclassBytecodeGenerator.mockClass(SubclassBytecodeGenerator.java:123)\r\nat org.mockito.internal.creation.bytebuddy.TypeCachingBytecodeGenerator$1.call(TypeCachingBytecodeGenerator.java:37)\r\nat org.mockito.internal.creation.bytebuddy.TypeCachingBytecodeGenerator$1.call(TypeCachingBytecodeGenerator.java:34)\r\nat net.bytebuddy.TypeCache.findOrInsert(TypeCache.java:137)\r\n... 39 more\r\n```\r\n\r\nThis only occurs when using mockito-android 2.18.0:\r\n\r\n```\r\nandroidTestImplementation 'org.mockito:mockito-android:2.18.0'\r\n```\r\n\r\nDowngrading to 2.17.0 fixes this issue.\r\n\r\nThis occurs on a Windows 10 dev machine running Android Studio 3.1.","closed_by":{"login":"szpak","id":148013,"node_id":"MDQ6VXNlcjE0ODAxMw==","avatar_url":"https://avatars.githubusercontent.com/u/148013?v=4","gravatar_id":"","url":"https://api.github.com/users/szpak","html_url":"https://github.com/szpak","followers_url":"https://api.github.com/users/szpak/followers","following_url":"https://api.github.com/users/szpak/following{/other_user}","gists_url":"https://api.github.com/users/szpak/gists{/gist_id}","starred_url":"https://api.github.com/users/szpak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szpak/subscriptions","organizations_url":"https://api.github.com/users/szpak/orgs","repos_url":"https://api.github.com/users/szpak/repos","events_url":"https://api.github.com/users/szpak/events{/privacy}","received_events_url":"https://api.github.com/users/szpak/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mockito/mockito/issues/1364/reactions","total_count":4,"+1":4,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mockito/mockito/issues/1364/timeline","performed_via_github_app":null,"state_reason":"completed"}