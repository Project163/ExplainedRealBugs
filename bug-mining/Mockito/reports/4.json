{"url":"https://api.github.com/repos/mockito/mockito/issues/112","repository_url":"https://api.github.com/repos/mockito/mockito","labels_url":"https://api.github.com/repos/mockito/mockito/issues/112/labels{/name}","comments_url":"https://api.github.com/repos/mockito/mockito/issues/112/comments","events_url":"https://api.github.com/repos/mockito/mockito/issues/112/events","html_url":"https://github.com/mockito/mockito/issues/112","id":46812481,"node_id":"MDU6SXNzdWU0NjgxMjQ4MQ==","number":112,"title":"Allow instances of other classes in AdditionalAnswers.delegatesTo","user":{"login":"dmac100","id":3151621,"node_id":"MDQ6VXNlcjMxNTE2MjE=","avatar_url":"https://avatars.githubusercontent.com/u/3151621?v=4","gravatar_id":"","url":"https://api.github.com/users/dmac100","html_url":"https://github.com/dmac100","followers_url":"https://api.github.com/users/dmac100/followers","following_url":"https://api.github.com/users/dmac100/following{/other_user}","gists_url":"https://api.github.com/users/dmac100/gists{/gist_id}","starred_url":"https://api.github.com/users/dmac100/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dmac100/subscriptions","organizations_url":"https://api.github.com/users/dmac100/orgs","repos_url":"https://api.github.com/users/dmac100/repos","events_url":"https://api.github.com/users/dmac100/events{/privacy}","received_events_url":"https://api.github.com/users/dmac100/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":16375485,"node_id":"MDU6TGFiZWwxNjM3NTQ4NQ==","url":"https://api.github.com/repos/mockito/mockito/labels/enhancement","name":"enhancement","color":"207de5","default":true,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2014-10-25T13:51:08Z","updated_at":"2014-11-15T18:09:24Z","closed_at":"2014-11-15T17:41:22Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"We have `AdditionalAnswers.delegatesTo`, but if an object of the wrong type is passed we get a RuntimeException:\n\n```\njava.lang.IllegalArgumentException: object is not an instance of declaring class\n```\n\nIf we allow any type as long as it has the needed methods of the same signature, then we can create fake objects like:\n\n```\nclass FakeSession {\n    Map<String, Object> map = new HashMap<>();\n\n    public Object getAttribute(String key) {\n        return map.get(key);\n    }\n\n    public void setAttribute(String key, Object value) {\n        map.put(key, value);\n    }\n}\n\n@Test\npublic void test() {\n    HttpSession session = mock(HttpSession.class,\n        AdditionalAnswers.delegatesTo(new FakeSession()));\n\n    session.setAttribute(\"key\", \"value\");\n\n    assertEquals(\"value\", session.getAttribute(\"key\"));\n}\n```\n\nThis saves on implementing many methods that are not used in the test, and can be easier to write than adding separate Answers for each call. This can be used to create fakes for objects like SWT's StyledText which has a huge number of methods. Using a separate object instead of a subclass prevents code from accidentely calling the real object or requiring the real constructor to be called.\n\nThis is not type-safe but it doesn't seem any worse than the casting required in Answers, and the user will find out quickly if a required method doesn't exist by running the tests.\n\nI propose to modify the implementation of ForwardsInvocations with something like:\n\n```\npublic Object answer(InvocationOnMock invocation) throws Throwable {\n    Method mockMethod = invocation.getMethod();\n\n    if(mockMethod.getDeclaringClass().isAssignableFrom(delegatedObject.getClass())) {\n        return mockMethod.invoke(delegatedObject, invocation.getArguments());\n    } else {\n        Method delegateMethod = delegatedObject.getClass().getMethod(\n            mockMethod.getName(), mockMethod.getParameterTypes());\n        return delegateMethod.invoke(delegatedObject, invocation.getArguments());\n    }\n}\n```\n","closed_by":{"login":"mockitoguy","id":24743,"node_id":"MDQ6VXNlcjI0NzQz","avatar_url":"https://avatars.githubusercontent.com/u/24743?v=4","gravatar_id":"","url":"https://api.github.com/users/mockitoguy","html_url":"https://github.com/mockitoguy","followers_url":"https://api.github.com/users/mockitoguy/followers","following_url":"https://api.github.com/users/mockitoguy/following{/other_user}","gists_url":"https://api.github.com/users/mockitoguy/gists{/gist_id}","starred_url":"https://api.github.com/users/mockitoguy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mockitoguy/subscriptions","organizations_url":"https://api.github.com/users/mockitoguy/orgs","repos_url":"https://api.github.com/users/mockitoguy/repos","events_url":"https://api.github.com/users/mockitoguy/events{/privacy}","received_events_url":"https://api.github.com/users/mockitoguy/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mockito/mockito/issues/112/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mockito/mockito/issues/112/timeline","performed_via_github_app":null,"state_reason":"completed"}