{"url":"https://api.github.com/repos/mockito/mockito/issues/2201","repository_url":"https://api.github.com/repos/mockito/mockito","labels_url":"https://api.github.com/repos/mockito/mockito/issues/2201/labels{/name}","comments_url":"https://api.github.com/repos/mockito/mockito/issues/2201/comments","events_url":"https://api.github.com/repos/mockito/mockito/issues/2201/events","html_url":"https://github.com/mockito/mockito/issues/2201","id":806617205,"node_id":"MDU6SXNzdWU4MDY2MTcyMDU=","number":2201,"title":"Calling getExceptionTypes() on concrete object that is used as interface doesn't return exception types from interface","user":{"login":"henrykuijpers","id":6546957,"node_id":"MDQ6VXNlcjY1NDY5NTc=","avatar_url":"https://avatars.githubusercontent.com/u/6546957?v=4","gravatar_id":"","url":"https://api.github.com/users/henrykuijpers","html_url":"https://github.com/henrykuijpers","followers_url":"https://api.github.com/users/henrykuijpers/followers","following_url":"https://api.github.com/users/henrykuijpers/following{/other_user}","gists_url":"https://api.github.com/users/henrykuijpers/gists{/gist_id}","starred_url":"https://api.github.com/users/henrykuijpers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/henrykuijpers/subscriptions","organizations_url":"https://api.github.com/users/henrykuijpers/orgs","repos_url":"https://api.github.com/users/henrykuijpers/repos","events_url":"https://api.github.com/users/henrykuijpers/events{/privacy}","received_events_url":"https://api.github.com/users/henrykuijpers/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":532126464,"node_id":"MDU6TGFiZWw1MzIxMjY0NjQ=","url":"https://api.github.com/repos/mockito/mockito/labels/please%20contribute","name":"please contribute","color":"0e8a16","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2021-02-11T17:59:10Z","updated_at":"2022-01-26T22:24:20Z","closed_at":"2022-01-26T22:24:20Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"org.mockito.internal.stubbing.answers.InvocationInfo#isValidException is doing validation on the exception types that can be thrown from this method.\r\n\r\nIn my codebase, I'm programming against an interface, but in fact, a spy is created from an instance that is implementing the interface, that drops the exception types that that implementation does not throw. However, the code that is calling the interface is of course unaware of that fact. Also, that implementation is a mock implementation (a real mock implementation, not a Mockito mock()/spy() instance). \r\n\r\nA testcase here:\r\n```\r\nimport org.junit.jupiter.api.Test;\r\nimport org.junit.jupiter.api.extension.ExtendWith;\r\nimport org.mockito.exceptions.base.MockitoException;\r\nimport org.mockito.junit.jupiter.MockitoExtension;\r\n\r\nimport java.io.IOException;\r\n\r\nimport static org.junit.jupiter.api.Assertions.assertEquals;\r\nimport static org.junit.jupiter.api.Assertions.assertThrows;\r\nimport static org.mockito.Mockito.doThrow;\r\nimport static org.mockito.Mockito.spy;\r\n\r\n@ExtendWith(MockitoExtension.class)\r\npublic class MockitoExceptionTypesIssue {\r\n    @Test\r\n    void exceptionTypeIoExceptionShouldBeMockableForObjectBeingSpyedOn() {\r\n        final I x = spy(new C());\r\n        final IOException ioException = new IOException(\"Oh my god!\");\r\n        final MockitoException e = assertThrows(\r\n                MockitoException.class,\r\n                () -> doThrow(ioException)\r\n                        .when(x)\r\n                        .m());\r\n        assertEquals(\"\\n\" +\r\n                \"Checked exception is invalid for this method!\\n\" +\r\n                \"Invalid: \" + ioException,\r\n                e.getMessage()\r\n        );\r\n    }\r\n\r\n    interface I {\r\n        void m() throws IOException;\r\n    }\r\n\r\n    static class C implements I {\r\n        public void m() {\r\n            // no-op\r\n        }\r\n    }\r\n}\r\n```","closed_by":{"login":"TimvdLippe","id":5948271,"node_id":"MDQ6VXNlcjU5NDgyNzE=","avatar_url":"https://avatars.githubusercontent.com/u/5948271?v=4","gravatar_id":"","url":"https://api.github.com/users/TimvdLippe","html_url":"https://github.com/TimvdLippe","followers_url":"https://api.github.com/users/TimvdLippe/followers","following_url":"https://api.github.com/users/TimvdLippe/following{/other_user}","gists_url":"https://api.github.com/users/TimvdLippe/gists{/gist_id}","starred_url":"https://api.github.com/users/TimvdLippe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TimvdLippe/subscriptions","organizations_url":"https://api.github.com/users/TimvdLippe/orgs","repos_url":"https://api.github.com/users/TimvdLippe/repos","events_url":"https://api.github.com/users/TimvdLippe/events{/privacy}","received_events_url":"https://api.github.com/users/TimvdLippe/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mockito/mockito/issues/2201/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mockito/mockito/issues/2201/timeline","performed_via_github_app":null,"state_reason":"completed"}