{"url":"https://api.github.com/repos/mockito/mockito/issues/1767","repository_url":"https://api.github.com/repos/mockito/mockito","labels_url":"https://api.github.com/repos/mockito/mockito/issues/1767/labels{/name}","comments_url":"https://api.github.com/repos/mockito/mockito/issues/1767/comments","events_url":"https://api.github.com/repos/mockito/mockito/issues/1767/events","html_url":"https://github.com/mockito/mockito/issues/1767","id":485767839,"node_id":"MDU6SXNzdWU0ODU3Njc4Mzk=","number":1767,"title":"'MismatchReportingTestListener' has already been added and not removed using MockitoJUnitRunner","user":{"login":"torakiki","id":3884479,"node_id":"MDQ6VXNlcjM4ODQ0Nzk=","avatar_url":"https://avatars.githubusercontent.com/u/3884479?v=4","gravatar_id":"","url":"https://api.github.com/users/torakiki","html_url":"https://github.com/torakiki","followers_url":"https://api.github.com/users/torakiki/followers","following_url":"https://api.github.com/users/torakiki/following{/other_user}","gists_url":"https://api.github.com/users/torakiki/gists{/gist_id}","starred_url":"https://api.github.com/users/torakiki/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/torakiki/subscriptions","organizations_url":"https://api.github.com/users/torakiki/orgs","repos_url":"https://api.github.com/users/torakiki/repos","events_url":"https://api.github.com/users/torakiki/events{/privacy}","received_events_url":"https://api.github.com/users/torakiki/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":22,"created_at":"2019-08-27T12:03:57Z","updated_at":"2024-05-08T08:59:07Z","closed_at":"2019-11-10T20:02:27Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":" - [x] The mockito message in the stacktrace have useful information, but it didn't help\r\n - [x] The problematic code (if that's possible) is copied here;\r\n```\r\nimport static org.hamcrest.Matchers.equalTo;\r\nimport static org.hamcrest.Matchers.hasProperty;\r\nimport static org.mockito.ArgumentMatchers.any;\r\nimport static org.mockito.ArgumentMatchers.anyString;\r\nimport static org.mockito.Mockito.never;\r\nimport static org.mockito.Mockito.verify;\r\nimport static org.mockito.hamcrest.MockitoHamcrest.argThat;\r\n\r\nimport java.io.File;\r\nimport java.io.IOException;\r\nimport java.util.function.Consumer;\r\n\r\nimport org.junit.Rule;\r\nimport org.junit.Test;\r\nimport org.junit.rules.TemporaryFolder;\r\nimport org.junit.runner.RunWith;\r\nimport org.mockito.Mock;\r\nimport org.mockito.junit.MockitoJUnitRunner;\r\nimport org.pdfsam.support.params.SingleOutputTaskParametersBuilder;\r\nimport org.pdfsam.test.InitializeAndApplyJavaFxThreadRule;\r\n\r\n@RunWith(MockitoJUnitRunner.class)\r\npublic class BrowsablePdfOutputFieldTest {\r\n    @Rule\r\n    public TemporaryFolder folder = new TemporaryFolder();\r\n    @Rule\r\n    public InitializeAndApplyJavaFxThreadRule fxThread = new InitializeAndApplyJavaFxThreadRule();\r\n    @Mock\r\n    private SingleOutputTaskParametersBuilder<?> builder;\r\n    @Mock\r\n    private Consumer<String> onError;\r\n\r\n    @Test\r\n    public void valid() throws IOException {\r\n        BrowsablePdfOutputField victim = new BrowsablePdfOutputField();\r\n        File value = folder.newFile(\"test.pdf\");\r\n        victim.getTextField().setText(value.getAbsolutePath());\r\n        victim.apply(builder, onError);\r\n        verify(builder).output(argThat(hasProperty(\"destination\", equalTo(value))));\r\n        verify(onError, never()).accept(anyString());\r\n    }\r\n\r\n    @Test\r\n    public void invalid() {\r\n        BrowsablePdfOutputField victim = new BrowsablePdfOutputField();\r\n        victim.enforceValidation(true, true);\r\n        victim.getTextField().setText(\"ChuckNorris\");\r\n        victim.apply(builder, onError);\r\n        verify(builder, never()).output(any());\r\n        verify(onError).accept(anyString());\r\n    }\r\n}\r\n```\r\n - [x] Provide versions (mockito / jdk / os / any other relevant information)\r\nMockito 3.0.0, AdoptOpenJDK 11.0.4, Linux Mint\r\n - [ ] Provide a [Short, Self Contained, Correct (Compilable), Example](http://sscce.org) of the issue\r\n       (same as any question on stackoverflow.com)\r\n - [x] Read the [contributing guide](https://github.com/mockito/mockito/blob/release/3.x/.github/CONTRIBUTING.md)\r\n\r\nI migrated from 1.10.19 to the 3.0.0 version and I have few tests using the MockitoJUnitRunner which are failing with the following stacktrace:\r\n\r\n```\r\norg.mockito.exceptions.misusing.RedundantListenerException: \r\nProblems adding Mockito listener.\r\nListener of type 'MismatchReportingTestListener' has already been added and not removed.\r\nIt indicates that previous listener was not removed according to the API.\r\nWhen you add a listener, don't forget to remove the listener afterwards:\r\n  Mockito.framework().removeListener(myListener);\r\nFor more information, see the javadoc for RedundantListenerException class.\r\n\tat org.mockito.internal.runners.DefaultInternalRunner$1$1.evaluate(DefaultInternalRunner.java:41)\r\n\tat org.junit.rules.ExternalResource$1.evaluate(ExternalResource.java:48)\r\n\tat org.pdfsam.test.JavaFXThreadRule$1.lambda$evaluate$0(JavaFXThreadRule.java:48)\r\n\tat com.sun.javafx.application.PlatformImpl.lambda$runLater$10(PlatformImpl.java:428)\r\n\tat java.base/java.security.AccessController.doPrivileged(AccessController.java:389)\r\n\tat com.sun.javafx.application.PlatformImpl.lambda$runLater$11(PlatformImpl.java:427)\r\n\tat com.sun.glass.ui.InvokeLaterDispatcher$Future.run(InvokeLaterDispatcher.java:96)\r\n\tat com.sun.glass.ui.gtk.GtkApplication._runLoop(Native Method)\r\n\tat com.sun.glass.ui.gtk.GtkApplication.lambda$runLoop$11(GtkApplication.java:277)\r\n\tat java.base/java.lang.Thread.run(Thread.java:835)\r\n```\r\nIt seems something internal, I didn't add or remove any `MismatchReportingTestListener` and moreover the same code was working with the 1.10.19 and is working if I remove the `MockitoJUnitRunner` and replace the `@Mock` annotation with a `Mockito.mock` in a `@Before` method.\r\n\r\n\r\n\r\n","closed_by":{"login":"TimvdLippe","id":5948271,"node_id":"MDQ6VXNlcjU5NDgyNzE=","avatar_url":"https://avatars.githubusercontent.com/u/5948271?v=4","gravatar_id":"","url":"https://api.github.com/users/TimvdLippe","html_url":"https://github.com/TimvdLippe","followers_url":"https://api.github.com/users/TimvdLippe/followers","following_url":"https://api.github.com/users/TimvdLippe/following{/other_user}","gists_url":"https://api.github.com/users/TimvdLippe/gists{/gist_id}","starred_url":"https://api.github.com/users/TimvdLippe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TimvdLippe/subscriptions","organizations_url":"https://api.github.com/users/TimvdLippe/orgs","repos_url":"https://api.github.com/users/TimvdLippe/repos","events_url":"https://api.github.com/users/TimvdLippe/events{/privacy}","received_events_url":"https://api.github.com/users/TimvdLippe/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mockito/mockito/issues/1767/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mockito/mockito/issues/1767/timeline","performed_via_github_app":null,"state_reason":"completed"}