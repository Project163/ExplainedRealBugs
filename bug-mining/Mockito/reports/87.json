{"url":"https://api.github.com/repos/mockito/mockito/issues/757","repository_url":"https://api.github.com/repos/mockito/mockito","labels_url":"https://api.github.com/repos/mockito/mockito/issues/757/labels{/name}","comments_url":"https://api.github.com/repos/mockito/mockito/issues/757/comments","events_url":"https://api.github.com/repos/mockito/mockito/issues/757/events","html_url":"https://github.com/mockito/mockito/issues/757","id":189389883,"node_id":"MDU6SXNzdWUxODkzODk4ODM=","number":757,"title":"\"mock-maker-inline\" prevents collection of code coverage for spys","user":{"login":"Godin","id":138671,"node_id":"MDQ6VXNlcjEzODY3MQ==","avatar_url":"https://avatars.githubusercontent.com/u/138671?v=4","gravatar_id":"","url":"https://api.github.com/users/Godin","html_url":"https://github.com/Godin","followers_url":"https://api.github.com/users/Godin/followers","following_url":"https://api.github.com/users/Godin/following{/other_user}","gists_url":"https://api.github.com/users/Godin/gists{/gist_id}","starred_url":"https://api.github.com/users/Godin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Godin/subscriptions","organizations_url":"https://api.github.com/users/Godin/orgs","repos_url":"https://api.github.com/users/Godin/repos","events_url":"https://api.github.com/users/Godin/events{/privacy}","received_events_url":"https://api.github.com/users/Godin/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":16375485,"node_id":"MDU6TGFiZWwxNjM3NTQ4NQ==","url":"https://api.github.com/repos/mockito/mockito/labels/enhancement","name":"enhancement","color":"207de5","default":true,"description":null}],"state":"closed","locked":false,"assignee":{"login":"raphw","id":4489328,"node_id":"MDQ6VXNlcjQ0ODkzMjg=","avatar_url":"https://avatars.githubusercontent.com/u/4489328?v=4","gravatar_id":"","url":"https://api.github.com/users/raphw","html_url":"https://github.com/raphw","followers_url":"https://api.github.com/users/raphw/followers","following_url":"https://api.github.com/users/raphw/following{/other_user}","gists_url":"https://api.github.com/users/raphw/gists{/gist_id}","starred_url":"https://api.github.com/users/raphw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/raphw/subscriptions","organizations_url":"https://api.github.com/users/raphw/orgs","repos_url":"https://api.github.com/users/raphw/repos","events_url":"https://api.github.com/users/raphw/events{/privacy}","received_events_url":"https://api.github.com/users/raphw/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"raphw","id":4489328,"node_id":"MDQ6VXNlcjQ0ODkzMjg=","avatar_url":"https://avatars.githubusercontent.com/u/4489328?v=4","gravatar_id":"","url":"https://api.github.com/users/raphw","html_url":"https://github.com/raphw","followers_url":"https://api.github.com/users/raphw/followers","following_url":"https://api.github.com/users/raphw/following{/other_user}","gists_url":"https://api.github.com/users/raphw/gists{/gist_id}","starred_url":"https://api.github.com/users/raphw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/raphw/subscriptions","organizations_url":"https://api.github.com/users/raphw/orgs","repos_url":"https://api.github.com/users/raphw/repos","events_url":"https://api.github.com/users/raphw/events{/privacy}","received_events_url":"https://api.github.com/users/raphw/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":23,"created_at":"2016-11-15T13:20:41Z","updated_at":"2016-11-16T09:53:41Z","closed_at":"2016-11-15T18:26:23Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hi,\r\n\r\nBeing one of [JaCoCo (Java Code Coverage Library)](http://www.jacoco.org/jacoco/index.html) developers, I was curious about interoperability of Mockito 2.2.x and JaCoCo on-the-fly instrumentation (using agent), so did some tests and came across following behavior:\r\n\r\nwith `mock-maker-inline`:\r\n![mock-maker-inline](https://cloud.githubusercontent.com/assets/138671/20305994/94290260-ab38-11e6-96ed-5d274d06cdda.png)\r\nwithout:\r\n![normal](https://cloud.githubusercontent.com/assets/138671/20305987/8c27b174-ab38-11e6-9230-6fccaee64541.png)\r\n\r\n\r\nHere is small example that reproduces this behavior - [example.zip](https://github.com/mockito/mockito/files/592003/example.zip) , `mvn clean verify` to run tests and generate JaCoCo report.\r\n\r\n* Mockito 2.2.16\r\n* JaCoCo 0.7.7\r\n* JDK 8u102\r\n\r\nAs a workaround possible to use JaCoCo offline instrumentation (`mvn clean verify -Djacoco-offline` on the given example), but we don't recommend this mode and it is not available nor in EclEmma (plugin for Eclipse based on JaCoCo), nor when using JaCoCo in IntellIJ IDEA.\r\n\r\nAlso should be noted that the same happens for IntelliJ IDEA's own built-in coverage engine:\r\n\r\n![intellij-mock-maker-inline](https://cloud.githubusercontent.com/assets/138671/20306440/8d6f6eb2-ab3a-11e6-9d07-e9a0108f8794.png)\r\nvs\r\n![intellij-normal](https://cloud.githubusercontent.com/assets/138671/20306446/93948e44-ab3a-11e6-9b73-ee4d78d3d55f.png)\r\n\r\nUnfortunately, I didn't had time (yet) to dig deeper into code of Mockito to understand why this happens. Best guess based on investigation of similar issue with PowerMock: Mockito's agent bypasses other agents by reading class files from disk.\r\n","closed_by":{"login":"raphw","id":4489328,"node_id":"MDQ6VXNlcjQ0ODkzMjg=","avatar_url":"https://avatars.githubusercontent.com/u/4489328?v=4","gravatar_id":"","url":"https://api.github.com/users/raphw","html_url":"https://github.com/raphw","followers_url":"https://api.github.com/users/raphw/followers","following_url":"https://api.github.com/users/raphw/following{/other_user}","gists_url":"https://api.github.com/users/raphw/gists{/gist_id}","starred_url":"https://api.github.com/users/raphw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/raphw/subscriptions","organizations_url":"https://api.github.com/users/raphw/orgs","repos_url":"https://api.github.com/users/raphw/repos","events_url":"https://api.github.com/users/raphw/events{/privacy}","received_events_url":"https://api.github.com/users/raphw/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mockito/mockito/issues/757/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mockito/mockito/issues/757/timeline","performed_via_github_app":null,"state_reason":"completed"}