{"url":"https://api.github.com/repos/mockito/mockito/issues/685","repository_url":"https://api.github.com/repos/mockito/mockito","labels_url":"https://api.github.com/repos/mockito/mockito/issues/685/labels{/name}","comments_url":"https://api.github.com/repos/mockito/mockito/issues/685/comments","events_url":"https://api.github.com/repos/mockito/mockito/issues/685/events","html_url":"https://github.com/mockito/mockito/issues/685","id":181917130,"node_id":"MDU6SXNzdWUxODE5MTcxMzA=","number":685,"title":"Support constructor parameters for spying on abstract classes","user":{"login":"mockitoguy","id":24743,"node_id":"MDQ6VXNlcjI0NzQz","avatar_url":"https://avatars.githubusercontent.com/u/24743?v=4","gravatar_id":"","url":"https://api.github.com/users/mockitoguy","html_url":"https://github.com/mockitoguy","followers_url":"https://api.github.com/users/mockitoguy/followers","following_url":"https://api.github.com/users/mockitoguy/following{/other_user}","gists_url":"https://api.github.com/users/mockitoguy/gists{/gist_id}","starred_url":"https://api.github.com/users/mockitoguy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mockitoguy/subscriptions","organizations_url":"https://api.github.com/users/mockitoguy/orgs","repos_url":"https://api.github.com/users/mockitoguy/repos","events_url":"https://api.github.com/users/mockitoguy/events{/privacy}","received_events_url":"https://api.github.com/users/mockitoguy/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":16375485,"node_id":"MDU6TGFiZWwxNjM3NTQ4NQ==","url":"https://api.github.com/repos/mockito/mockito/labels/enhancement","name":"enhancement","color":"207de5","default":true,"description":null},{"id":140917181,"node_id":"MDU6TGFiZWwxNDA5MTcxODE=","url":"https://api.github.com/repos/mockito/mockito/labels/new%20feature","name":"new feature","color":"009800","default":false,"description":null},{"id":532126464,"node_id":"MDU6TGFiZWw1MzIxMjY0NjQ=","url":"https://api.github.com/repos/mockito/mockito/labels/please%20contribute","name":"please contribute","color":"0e8a16","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2016-10-09T22:47:05Z","updated_at":"2017-03-05T23:21:59Z","closed_at":"2017-03-05T23:21:11Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Nice, self-contained enhancement that makes Mockito API more robust. The implementation does not require proficiency with Mockito codebase.\r\n\r\n### Feature\r\n\r\nWe already support spying on abstract classes by allowing parameterless constructor. However, there is no support for constructor parameters. This has been asked about long time ago. Mockito API is not robust enough if it supports mocking with constructor **but** not when one has any constructor parameters.\r\n\r\n``` java\r\n//current api:\r\nFoo spy = mock(Foo.class, withSettings() .useConstructor().defaultAnswer(CALLS_REAL_METHODS));\r\n//existing method (will remain):\r\nMockSettings useConstructor();\r\n\r\n//new api (change existing method):\r\nFoo spy = mock(Foo.class, withSettings() .useConstructor(\"someArg\").defaultAnswer(CALLS_REAL_METHODS));\r\n//changed method:\r\nMockSettings useConstructorArgs(Object ... args);\r\n```\r\n\r\n### Open questions\r\n\r\n- in case we find multiple matching constructors, do we just use the 1st matching (option 1) or throw an exception (option 2)?\r\n\r\nI'd say we go for option 1 because it's simpler to implement and seems more convenient (works out of the box for certain use cases). If we go for option 2 we need to inform the user what to do to resolve the problem (for example document and suggest @fluentfuture idea of creating an inner implementation)\r\n\r\n- do we add new method or add vararg to existing useConstructor() method?\r\n\r\nWe decided that using existing method is simpler, keeps the API small and is easy to discover.\r\n\r\n### Implementation notes\r\n\r\n- the main complexity is to identify and detect the right constructor to use based on types of parameters supplied by the user\r\n- we already deal with detecting constructors for the @InjectMocks functionality - there should be code to reuse\r\n\r\n### Test coverage\r\n\r\n- see existing tests that cover \"useConstructor\" method for\r\n- ensure decent, informative exception messages\r\n  - if user supplies wrong constructor args (wrong types, we cannot find matching constructor)\r\n  - if the constructor throws some exception (constructors of some types have code that can fail)\r\n  - when one uses existing parameter-less \"useConstructor\" method but the mocked class requires constructor args, the exception message should tell the user about new \"useConstructorArgs\" method.\r\n- what if arguments supplied by the user match more than 1 constructor - either we fail gracefully with decent message or we pick one of the constructors.\r\n- update documentation to describe new feature. Update documentation for existing parameter-less \"useConstructor\" method. Update documentation in main Mockito class if it references “useConstructor”.\r\n- other use cases?","closed_by":{"login":"mockitoguy","id":24743,"node_id":"MDQ6VXNlcjI0NzQz","avatar_url":"https://avatars.githubusercontent.com/u/24743?v=4","gravatar_id":"","url":"https://api.github.com/users/mockitoguy","html_url":"https://github.com/mockitoguy","followers_url":"https://api.github.com/users/mockitoguy/followers","following_url":"https://api.github.com/users/mockitoguy/following{/other_user}","gists_url":"https://api.github.com/users/mockitoguy/gists{/gist_id}","starred_url":"https://api.github.com/users/mockitoguy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mockitoguy/subscriptions","organizations_url":"https://api.github.com/users/mockitoguy/orgs","repos_url":"https://api.github.com/users/mockitoguy/repos","events_url":"https://api.github.com/users/mockitoguy/events{/privacy}","received_events_url":"https://api.github.com/users/mockitoguy/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mockito/mockito/issues/685/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mockito/mockito/issues/685/timeline","performed_via_github_app":null,"state_reason":"completed"}