{"url":"https://api.github.com/repos/mockito/mockito/issues/1553","repository_url":"https://api.github.com/repos/mockito/mockito","labels_url":"https://api.github.com/repos/mockito/mockito/issues/1553/labels{/name}","comments_url":"https://api.github.com/repos/mockito/mockito/issues/1553/comments","events_url":"https://api.github.com/repos/mockito/mockito/issues/1553/events","html_url":"https://github.com/mockito/mockito/issues/1553","id":385493728,"node_id":"MDU6SXNzdWUzODU0OTM3Mjg=","number":1553,"title":"VerifyError thrown when JUnit 3 is in the classpath","user":{"login":"tjni","id":3806110,"node_id":"MDQ6VXNlcjM4MDYxMTA=","avatar_url":"https://avatars.githubusercontent.com/u/3806110?v=4","gravatar_id":"","url":"https://api.github.com/users/tjni","html_url":"https://github.com/tjni","followers_url":"https://api.github.com/users/tjni/followers","following_url":"https://api.github.com/users/tjni/following{/other_user}","gists_url":"https://api.github.com/users/tjni/gists{/gist_id}","starred_url":"https://api.github.com/users/tjni/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tjni/subscriptions","organizations_url":"https://api.github.com/users/tjni/orgs","repos_url":"https://api.github.com/users/tjni/repos","events_url":"https://api.github.com/users/tjni/events{/privacy}","received_events_url":"https://api.github.com/users/tjni/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1135962494,"node_id":"MDU6TGFiZWwxMTM1OTYyNDk0","url":"https://api.github.com/repos/mockito/mockito/labels/build","name":"build","color":"c90294","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2018-11-28T22:58:55Z","updated_at":"2019-03-04T10:29:38Z","closed_at":"2018-11-29T15:44:45Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"With JUnit 3 in the classpath, VerifyError will be thrown during JUnit detection in ExceptionFactory. This is because JUnit's ComparisonFailure class only starts extending AssertionError in JUnit 4.\r\n\r\n**Expected Behavior**\r\n\r\nWhen JUnit 3 is in the classpath, Mockito should behave as if JUnit was not there at all.\r\n\r\nA real example where handling this here instead of updating JUnit in the consumer would be beneficial is related to my company's usage of ZooKeeper. ZooKeeper 3.4 leaks a JUnit 3.8.1 dependency that is fixed in 3.5, but 3.5 is still in beta and has been in the works for several years. Projects that use TestNG (most of ours) but which use ZooKeeper (usually transitively) run into this issue.\r\n\r\n**Example**\r\n\r\nsrc/test/java/com/example/ExampleTest.java\r\n```\r\npackage com.example;\r\n\r\nimport org.testng.annotations.Test;\r\nimport static org.mockito.Mockito.*;\r\n\r\n@Test\r\npublic class ExampleTest {\r\n  public void testMockitoWithJUnit3() {\r\n    Client mockClient = mock(Client.class);\r\n    mockClient.call(\"one\");\r\n    verify(mockClient).call(\"two\");\r\n  }\r\n\r\n  public interface Client {\r\n    void call(String argument);\r\n  }\r\n}\r\n```\r\nbuild.gradle\r\n```\r\nplugins {\r\n  id 'java'\r\n  id 'idea'\r\n}\r\n\r\nrepositories {\r\n  mavenCentral()\r\n}\r\n\r\ndependencies {\r\n  testImplementation group: 'junit', name: 'junit', version: '3.8.2'\r\n  testImplementation group: 'org.mockito', name: 'mockito-core', version: '2.23.4'\r\n  testImplementation group: 'org.testng', name: 'testng', version: '6.14.3'\r\n}\r\n\r\ntest {\r\n  useTestNG()\r\n}\r\n```\r\n\r\n**Error**\r\n```\r\njava.lang.VerifyError: Bad return type\r\nException Details:\r\n  Location:\r\n    org/mockito/internal/junit/ExceptionFactory$JUnitArgsAreDifferent.create(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)Ljava/lang/AssertionError; @10: areturn\r\n  Reason:\r\n    Type 'org/mockito/exceptions/verification/junit/ArgumentsAreDifferent' (current frame, stack[0]) is not assignable to 'java/lang/AssertionError' (from method signature)\r\n  Current Frame:\r\n    bci: @10\r\n    flags: { }\r\n    locals: { 'java/lang/String', 'java/lang/String', 'java/lang/String' }\r\n    stack: { 'org/mockito/exceptions/verification/junit/ArgumentsAreDifferent' }\r\n  Bytecode:\r\n    0000000: bb00 0259 2a2b 2cb7 0003 b0            \r\n\r\n\tat org.mockito.internal.junit.ExceptionFactory.canLoadJunitClass(ExceptionFactory.java:33)\r\n\tat org.mockito.internal.junit.ExceptionFactory.<clinit>(ExceptionFactory.java:12)\r\n\tat org.mockito.internal.exceptions.Reporter.argumentsAreDifferent(Reporter.java:313)\r\n        ...\r\n```","closed_by":{"login":"mockitoguy","id":24743,"node_id":"MDQ6VXNlcjI0NzQz","avatar_url":"https://avatars.githubusercontent.com/u/24743?v=4","gravatar_id":"","url":"https://api.github.com/users/mockitoguy","html_url":"https://github.com/mockitoguy","followers_url":"https://api.github.com/users/mockitoguy/followers","following_url":"https://api.github.com/users/mockitoguy/following{/other_user}","gists_url":"https://api.github.com/users/mockitoguy/gists{/gist_id}","starred_url":"https://api.github.com/users/mockitoguy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mockitoguy/subscriptions","organizations_url":"https://api.github.com/users/mockitoguy/orgs","repos_url":"https://api.github.com/users/mockitoguy/repos","events_url":"https://api.github.com/users/mockitoguy/events{/privacy}","received_events_url":"https://api.github.com/users/mockitoguy/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mockito/mockito/issues/1553/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mockito/mockito/issues/1553/timeline","performed_via_github_app":null,"state_reason":"completed"}