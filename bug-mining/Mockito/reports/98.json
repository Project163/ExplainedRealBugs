{"url":"https://api.github.com/repos/mockito/mockito/issues/820","repository_url":"https://api.github.com/repos/mockito/mockito","labels_url":"https://api.github.com/repos/mockito/mockito/issues/820/labels{/name}","comments_url":"https://api.github.com/repos/mockito/mockito/issues/820/comments","events_url":"https://api.github.com/repos/mockito/mockito/issues/820/events","html_url":"https://github.com/mockito/mockito/issues/820","id":195547911,"node_id":"MDU6SXNzdWUxOTU1NDc5MTE=","number":820,"title":"[VarArgs] unexpected behaviour of returnsArgAt(int)","user":{"login":"ChristianSchwarz","id":1437411,"node_id":"MDQ6VXNlcjE0Mzc0MTE=","avatar_url":"https://avatars.githubusercontent.com/u/1437411?v=4","gravatar_id":"","url":"https://api.github.com/users/ChristianSchwarz","html_url":"https://github.com/ChristianSchwarz","followers_url":"https://api.github.com/users/ChristianSchwarz/followers","following_url":"https://api.github.com/users/ChristianSchwarz/following{/other_user}","gists_url":"https://api.github.com/users/ChristianSchwarz/gists{/gist_id}","starred_url":"https://api.github.com/users/ChristianSchwarz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ChristianSchwarz/subscriptions","organizations_url":"https://api.github.com/users/ChristianSchwarz/orgs","repos_url":"https://api.github.com/users/ChristianSchwarz/repos","events_url":"https://api.github.com/users/ChristianSchwarz/events{/privacy}","received_events_url":"https://api.github.com/users/ChristianSchwarz/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":16375483,"node_id":"MDU6TGFiZWwxNjM3NTQ4Mw==","url":"https://api.github.com/repos/mockito/mockito/labels/bug","name":"bug","color":"fc2929","default":true,"description":null}],"state":"closed","locked":false,"assignee":{"login":"bric3","id":803621,"node_id":"MDQ6VXNlcjgwMzYyMQ==","avatar_url":"https://avatars.githubusercontent.com/u/803621?v=4","gravatar_id":"","url":"https://api.github.com/users/bric3","html_url":"https://github.com/bric3","followers_url":"https://api.github.com/users/bric3/followers","following_url":"https://api.github.com/users/bric3/following{/other_user}","gists_url":"https://api.github.com/users/bric3/gists{/gist_id}","starred_url":"https://api.github.com/users/bric3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bric3/subscriptions","organizations_url":"https://api.github.com/users/bric3/orgs","repos_url":"https://api.github.com/users/bric3/repos","events_url":"https://api.github.com/users/bric3/events{/privacy}","received_events_url":"https://api.github.com/users/bric3/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"bric3","id":803621,"node_id":"MDQ6VXNlcjgwMzYyMQ==","avatar_url":"https://avatars.githubusercontent.com/u/803621?v=4","gravatar_id":"","url":"https://api.github.com/users/bric3","html_url":"https://github.com/bric3","followers_url":"https://api.github.com/users/bric3/followers","following_url":"https://api.github.com/users/bric3/following{/other_user}","gists_url":"https://api.github.com/users/bric3/gists{/gist_id}","starred_url":"https://api.github.com/users/bric3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bric3/subscriptions","organizations_url":"https://api.github.com/users/bric3/orgs","repos_url":"https://api.github.com/users/bric3/repos","events_url":"https://api.github.com/users/bric3/events{/privacy}","received_events_url":"https://api.github.com/users/bric3/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":6,"created_at":"2016-12-14T14:40:38Z","updated_at":"2017-01-06T11:14:51Z","closed_at":"2017-01-06T11:14:51Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I stumble about a test that failed after refactoring an array parameter to an varargs.\r\n\r\nThe following test succeed:\r\n```java\r\ninterface Foo{\r\n        int[] getOdd(int[] input);\r\n}\r\n\r\n@Test\r\npublic void test() throws Exception {\r\n    when(foo.getOdd(any())).then(returnsArgAt(0));\r\n        \r\n    int[] odd = mock.getOdd(new int[]{1,3,5});\r\n    assertThat(odd).contains(1,3,5);\r\n}\r\n```\r\nNow lets change the parameter _input_ to an varargs.\r\n```java\r\ninterface Foo{\r\n        int[] getOdd(int... input);\r\n}\r\n```\r\nThe test fails now with:\r\n\r\n```\r\norg.mockito.exceptions.misusing.WrongTypeOfReturnValue: \r\nThe argument of type 'int' cannot be returned because the following \r\nmethod should return the type 'int[]'\r\n -> foo.getOdd()\r\n```\r\n\r\nThis is not expected cause the change is source and binary(?) compatible, an varargs-parameter is still an array. ReturnsArgumentAt interprets the vararg array items as real parameters. In other words it tries to return an element type where the array type is required.\r\n\r\nCan the behaviour of interpreting vararg elements like parameters be changed so an vararg is treated as an array? E.g. in Mockito 3? There are several other cases were the current vararg handling leads to unexpected behaviour.","closed_by":{"login":"bric3","id":803621,"node_id":"MDQ6VXNlcjgwMzYyMQ==","avatar_url":"https://avatars.githubusercontent.com/u/803621?v=4","gravatar_id":"","url":"https://api.github.com/users/bric3","html_url":"https://github.com/bric3","followers_url":"https://api.github.com/users/bric3/followers","following_url":"https://api.github.com/users/bric3/following{/other_user}","gists_url":"https://api.github.com/users/bric3/gists{/gist_id}","starred_url":"https://api.github.com/users/bric3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bric3/subscriptions","organizations_url":"https://api.github.com/users/bric3/orgs","repos_url":"https://api.github.com/users/bric3/repos","events_url":"https://api.github.com/users/bric3/events{/privacy}","received_events_url":"https://api.github.com/users/bric3/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mockito/mockito/issues/820/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mockito/mockito/issues/820/timeline","performed_via_github_app":null,"state_reason":"completed"}