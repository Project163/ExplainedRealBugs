{"url":"https://api.github.com/repos/mockito/mockito/issues/2589","repository_url":"https://api.github.com/repos/mockito/mockito","labels_url":"https://api.github.com/repos/mockito/mockito/issues/2589/labels{/name}","comments_url":"https://api.github.com/repos/mockito/mockito/issues/2589/comments","events_url":"https://api.github.com/repos/mockito/mockito/issues/2589/events","html_url":"https://github.com/mockito/mockito/issues/2589","id":1162797637,"node_id":"I_kwDOAF62v85FTuJF","number":2589,"title":"Switch the default mockmaker to the inline mockmaker on JDK 17+","user":{"login":"TimvdLippe","id":5948271,"node_id":"MDQ6VXNlcjU5NDgyNzE=","avatar_url":"https://avatars.githubusercontent.com/u/5948271?v=4","gravatar_id":"","url":"https://api.github.com/users/TimvdLippe","html_url":"https://github.com/TimvdLippe","followers_url":"https://api.github.com/users/TimvdLippe/followers","following_url":"https://api.github.com/users/TimvdLippe/following{/other_user}","gists_url":"https://api.github.com/users/TimvdLippe/gists{/gist_id}","starred_url":"https://api.github.com/users/TimvdLippe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TimvdLippe/subscriptions","organizations_url":"https://api.github.com/users/TimvdLippe/orgs","repos_url":"https://api.github.com/users/TimvdLippe/repos","events_url":"https://api.github.com/users/TimvdLippe/events{/privacy}","received_events_url":"https://api.github.com/users/TimvdLippe/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":532126464,"node_id":"MDU6TGFiZWw1MzIxMjY0NjQ=","url":"https://api.github.com/repos/mockito/mockito/labels/please%20contribute","name":"please contribute","color":"0e8a16","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"reta","id":509855,"node_id":"MDQ6VXNlcjUwOTg1NQ==","avatar_url":"https://avatars.githubusercontent.com/u/509855?v=4","gravatar_id":"","url":"https://api.github.com/users/reta","html_url":"https://github.com/reta","followers_url":"https://api.github.com/users/reta/followers","following_url":"https://api.github.com/users/reta/following{/other_user}","gists_url":"https://api.github.com/users/reta/gists{/gist_id}","starred_url":"https://api.github.com/users/reta/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/reta/subscriptions","organizations_url":"https://api.github.com/users/reta/orgs","repos_url":"https://api.github.com/users/reta/repos","events_url":"https://api.github.com/users/reta/events{/privacy}","received_events_url":"https://api.github.com/users/reta/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"reta","id":509855,"node_id":"MDQ6VXNlcjUwOTg1NQ==","avatar_url":"https://avatars.githubusercontent.com/u/509855?v=4","gravatar_id":"","url":"https://api.github.com/users/reta","html_url":"https://github.com/reta","followers_url":"https://api.github.com/users/reta/followers","following_url":"https://api.github.com/users/reta/following{/other_user}","gists_url":"https://api.github.com/users/reta/gists{/gist_id}","starred_url":"https://api.github.com/users/reta/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/reta/subscriptions","organizations_url":"https://api.github.com/users/reta/orgs","repos_url":"https://api.github.com/users/reta/repos","events_url":"https://api.github.com/users/reta/events{/privacy}","received_events_url":"https://api.github.com/users/reta/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":25,"created_at":"2022-03-08T15:30:10Z","updated_at":"2023-01-08T20:45:56Z","closed_at":"2023-01-08T20:45:56Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"All right, we have been talking about this for a while so let's consolidate discussions. TLDR: more and more use cases are broken (by default) with Mockito and JDK 17. That's because the subclass mockmaker runs into fundamental limitations on JDK 17, but the inline mockmaker works as expected.\r\n\r\nThere are a lot of issues related to this:\r\n- https://github.com/mockito/mockito/issues/2587\r\n- https://github.com/mockito/mockito/issues/2560\r\n- https://github.com/mockito/mockito/issues/2573\r\n- https://github.com/mockito/mockito/issues/2561 (suspected)\r\n- https://github.com/mockito/mockito/issues/2521 (suspected)\r\n- https://github.com/mockito/mockito/issues/2449 (suspected)\r\n\r\nAt this point, the rate of issues created is increasing, as more and more of our users are adopting JDK 17+\r\n\r\nWe have historically talked about this as well: https://github.com/mockito/mockito/issues/1728\r\n\r\nWhen chatting with @raphw about this issue, there were a couple of options that we have available:\r\n1. Keep on using the subclass mockmaker by default on all JDK's and suggest users to use `mockito-inline` whenever appropriate\r\n2. Switch the default to the inline mockmaker for all JDK's and put the subclass mockmaker in an artifact such as `mockito-subclass` (legacy)\r\n3. Detect the current JDK version and make the inline mockmaker the default on JDK 17+, but keep the subclass mockmaker the default for older JDK versions\r\n\r\nIn my opinion, we should opt for least amount of surprise. E.g. Mockito should \"just\" work out-of-the-box for the majority of use cases. Therefore, if Mockito (by default) does not work nicely with JDK 17 in more and more cases, I consider that a bug.\r\n\r\nThat said, I don't think it is a good choice to force all existing users that are on JDK 16 and below to update their codebase wholesale to the new mockmaker. Inheritently, the new mockmaker works slightly different and forcing the update onto users doesn't feel like a nice solution. In the end, it works just fine on JDK 16 on below, so why change it?\r\n\r\nTherefore, my proposed way forward is:\r\n1. We publish Mockito 5 which switches the default mockmaker to the inline mockmaker on JDK 17+\r\n2. We update the JavaDoc of the subclass mockmaker to make users aware it is only intended to be used for specific use cases\r\n\r\nIn terms of timeline, I think we should collective user feedback from the community first. This issue seems like the best place to do so. Once we are confident that we would be able to switch the default, we could publish Mockito 5. For now, what if we take June 2022 as a temporary date to make such a change, unless we receive strong/valid user feedback that should block such a change?\r\n\r\nCC @mockito/developers ","closed_by":{"login":"TimvdLippe","id":5948271,"node_id":"MDQ6VXNlcjU5NDgyNzE=","avatar_url":"https://avatars.githubusercontent.com/u/5948271?v=4","gravatar_id":"","url":"https://api.github.com/users/TimvdLippe","html_url":"https://github.com/TimvdLippe","followers_url":"https://api.github.com/users/TimvdLippe/followers","following_url":"https://api.github.com/users/TimvdLippe/following{/other_user}","gists_url":"https://api.github.com/users/TimvdLippe/gists{/gist_id}","starred_url":"https://api.github.com/users/TimvdLippe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TimvdLippe/subscriptions","organizations_url":"https://api.github.com/users/TimvdLippe/orgs","repos_url":"https://api.github.com/users/TimvdLippe/repos","events_url":"https://api.github.com/users/TimvdLippe/events{/privacy}","received_events_url":"https://api.github.com/users/TimvdLippe/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mockito/mockito/issues/2589/reactions","total_count":9,"+1":8,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":1,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mockito/mockito/issues/2589/timeline","performed_via_github_app":null,"state_reason":"completed"}