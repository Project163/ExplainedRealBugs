{"url":"https://api.github.com/repos/mockito/mockito/issues/2108","repository_url":"https://api.github.com/repos/mockito/mockito","labels_url":"https://api.github.com/repos/mockito/mockito/issues/2108/labels{/name}","comments_url":"https://api.github.com/repos/mockito/mockito/issues/2108/comments","events_url":"https://api.github.com/repos/mockito/mockito/issues/2108/events","html_url":"https://github.com/mockito/mockito/issues/2108","id":749146221,"node_id":"MDU6SXNzdWU3NDkxNDYyMjE=","number":2108,"title":"JarInputStream fails to get Manifest from published mockito-core","user":{"login":"hdecarne","id":2044567,"node_id":"MDQ6VXNlcjIwNDQ1Njc=","avatar_url":"https://avatars.githubusercontent.com/u/2044567?v=4","gravatar_id":"","url":"https://api.github.com/users/hdecarne","html_url":"https://github.com/hdecarne","followers_url":"https://api.github.com/users/hdecarne/followers","following_url":"https://api.github.com/users/hdecarne/following{/other_user}","gists_url":"https://api.github.com/users/hdecarne/gists{/gist_id}","starred_url":"https://api.github.com/users/hdecarne/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hdecarne/subscriptions","organizations_url":"https://api.github.com/users/hdecarne/orgs","repos_url":"https://api.github.com/users/hdecarne/repos","events_url":"https://api.github.com/users/hdecarne/events{/privacy}","received_events_url":"https://api.github.com/users/hdecarne/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":532126464,"node_id":"MDU6TGFiZWw1MzIxMjY0NjQ=","url":"https://api.github.com/repos/mockito/mockito/labels/please%20contribute","name":"please contribute","color":"0e8a16","default":false,"description":null},{"id":1135962494,"node_id":"MDU6TGFiZWwxMTM1OTYyNDk0","url":"https://api.github.com/repos/mockito/mockito/labels/build","name":"build","color":"c90294","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2020-11-23T21:37:49Z","updated_at":"2020-11-24T16:26:25Z","closed_at":"2020-11-24T11:43:28Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Using mockito-core in a JPMS based gradle build fails due to a known but odd behaviour of JarInputStream. The latter only provides access to the Jar's manifest if it is the 1st or 2nd entry in the Jar. As discussed in:\r\n\r\n* https://bugs.openjdk.java.net/browse/JDK-8031748\r\n* https://bugs.openjdk.java.net/browse/JDK-8211917\r\n\r\nAs gradle uses the JarInputStream to get the manifest and to determine whether the Automatic-Module-Name attribute is set, it fails to add mockito-core to the module path (see GRADLE [#15270](https://github.com/gradle/gradle/issues/15270). Same issue was observed for Quarkus [#5399](https://github.com/quarkusio/quarkus/issues/5399). The attached example code [example.zip](https://github.com/mockito/mockito/files/5585881/example.zip) shows this issue.\r\n\r\nAn optimal solution would be to make sure the manifest file is kept at the Jar's beginning during the publication process.\r\n\r\nUsed versions:\r\n* mockito-core-3.6.0.jar\r\n* java version \"11.0.6\" 2020-01-14 LTS \r\nJava(TM) SE Runtime Environment 18.9 (build 11.0.6+8-LTS)\r\nJava HotSpot(TM) 64-Bit Server VM 18.9 (build 11.0.6+8-LTS, mixed mode)\r\n","closed_by":{"login":"TimvdLippe","id":5948271,"node_id":"MDQ6VXNlcjU5NDgyNzE=","avatar_url":"https://avatars.githubusercontent.com/u/5948271?v=4","gravatar_id":"","url":"https://api.github.com/users/TimvdLippe","html_url":"https://github.com/TimvdLippe","followers_url":"https://api.github.com/users/TimvdLippe/followers","following_url":"https://api.github.com/users/TimvdLippe/following{/other_user}","gists_url":"https://api.github.com/users/TimvdLippe/gists{/gist_id}","starred_url":"https://api.github.com/users/TimvdLippe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TimvdLippe/subscriptions","organizations_url":"https://api.github.com/users/TimvdLippe/orgs","repos_url":"https://api.github.com/users/TimvdLippe/repos","events_url":"https://api.github.com/users/TimvdLippe/events{/privacy}","received_events_url":"https://api.github.com/users/TimvdLippe/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mockito/mockito/issues/2108/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mockito/mockito/issues/2108/timeline","performed_via_github_app":null,"state_reason":"completed"}