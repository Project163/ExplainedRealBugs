diff --git a/mockito-core/build.gradle.kts b/mockito-core/build.gradle.kts
index 5b4318cac..415ce8990 100644
--- a/mockito-core/build.gradle.kts
+++ b/mockito-core/build.gradle.kts
@@ -11,7 +11,6 @@ base.archivesName = "mockito-core"
 
 apply {
     from(rootProject.file("gradle/coverage.gradle"))
-    from("testing.gradle")
 }
 
 val testUtil: Configuration by configurations.creating //TODO move to separate project
@@ -103,4 +102,71 @@ tasks {
             """.trimIndent())
         }
     }
+
+    test {
+        val java11 = providers.environmentVariable("SIMULATE_JAVA11")
+        if (java11.isPresent) {
+            logger.info("$path - use Java11 simulation: $java11")
+            systemProperty("org.mockito.internal.noUnsafeInjection", java11.get())
+        }
+    }
+
+    // This task is used to generate Mockito extensions for testing see ci.yml build matrix.
+    val createTestResources by registering {
+        val mockitoExtConfigFiles = listOf(
+            mockitoExtensionConfigFile(project, "org.mockito.plugins.MockMaker"),
+            mockitoExtensionConfigFile(project, "org.mockito.plugins.MemberAccessor"),
+        )
+        outputs.files(mockitoExtConfigFiles)
+        doLast {
+            // Configure MockMaker from environment (if specified), otherwise use default
+            configureMockitoExtensionFromCi(project, "org.mockito.plugins.MockMaker", "MOCK_MAKER")
+
+            // Configure MemberAccessor from environment (if specified), otherwise use default
+            configureMockitoExtensionFromCi(project, "org.mockito.plugins.MemberAccessor", "MEMBER_ACCESSOR")
+        }
+    }
+    processTestResources {
+        dependsOn(createTestResources)
+    }
+
+    val removeTestResources by registering {
+        val mockitoExtConfigFiles = listOf(
+            mockitoExtensionConfigFile(project, "org.mockito.plugins.MockMaker"),
+            mockitoExtensionConfigFile(project, "org.mockito.plugins.MemberAccessor"),
+        )
+        outputs.files(mockitoExtConfigFiles)
+        doLast {
+            mockitoExtConfigFiles.forEach {
+                if (it.exists()) {
+                    it.delete()
+                }
+            }
+        }
+    }
+    test {
+        finalizedBy(removeTestResources)
+    }
 }
+
+fun Task.configureMockitoExtensionFromCi(
+    project: Project,
+    mockitoExtension: String,
+    ciMockitoExtensionEnvVarName: String,
+) {
+    val mockitoExtConfigFile = mockitoExtensionConfigFile(project, mockitoExtension)
+    val mockMaker = project.providers.environmentVariable(ciMockitoExtensionEnvVarName)
+    if (mockMaker.isPresent && !mockMaker.get().endsWith("default")) {
+        logger.info("Using $mockitoExtension ${mockMaker.get()}")
+        mockitoExtConfigFile.run {
+            parentFile.mkdirs()
+            createNewFile()
+            writeText(mockMaker.get())
+        }
+    } else {
+        logger.info("Using default $mockitoExtension")
+    }
+}
+
+fun mockitoExtensionConfigFile(project: Project, mockitoExtension: String) =
+    file("${project.sourceSets.test.get().output.resourcesDir}/mockito-extensions/$mockitoExtension")
diff --git a/mockito-core/testing.gradle b/mockito-core/testing.gradle
deleted file mode 100644
index 949b0f2cf..000000000
--- a/mockito-core/testing.gradle
+++ /dev/null
@@ -1,54 +0,0 @@
-def java11 = System.env.SIMULATE_JAVA11
-if (java11 != null) {
-    tasks.named("test", Test) {
-        logger.info("$it.path - use Java11 simluation: ${java11}")
-        systemProperty "org.mockito.internal.noUnsafeInjection", java11
-    }
-}
-
-tasks.register("createTestResources") {
-    doLast {
-        // Configure MockMaker from environment (if specified), otherwise use default
-        def mockMakerFile = new File("$sourceSets.test.output.resourcesDir/mockito-extensions/org.mockito.plugins.MockMaker")
-        if (System.env.MOCK_MAKER != null && !System.env.MOCK_MAKER.endsWith("default")) {
-            logger.info("Using MockMaker ${System.env.MOCK_MAKER}")
-            mockMakerFile.parentFile.mkdirs()
-            mockMakerFile.createNewFile()
-            mockMakerFile.write(System.env.MOCK_MAKER)
-        } else {
-            logger.info("Using default MockMaker")
-        }
-
-        // Configure MemberAccessor from environment (if specified), otherwise use default
-        def memberAccessorFile = new File("$sourceSets.test.output.resourcesDir/mockito-extensions/org.mockito.plugins.MemberAccessor")
-        if (System.env.MEMBER_ACCESSOR != null  && !System.env.MEMBER_ACCESSOR.endsWith("default")) {
-            logger.info("Using MemberAccessor ${System.env.MEMBER_ACCESSOR}")
-            memberAccessorFile.parentFile.mkdirs()
-            memberAccessorFile.createNewFile()
-            memberAccessorFile.write(System.env.MEMBER_ACCESSOR)
-        } else {
-            logger.info("Using default MemberAccessor")
-        }
-    }
-}
-
-tasks.register("removeTestResources"){
-    doLast {
-        def mockMakerFile = new File("$sourceSets.test.output.resourcesDir/mockito-extensions/org.mockito.plugins.MockMaker")
-        if (mockMakerFile.exists()) {
-            mockMakerFile.delete()
-        }
-
-        def memberAccessorFile = new File("$sourceSets.test.output.resourcesDir/mockito-extensions/org.mockito.plugins.MemberAccessor")
-        if (memberAccessorFile.exists()) {
-            memberAccessorFile.delete()
-        }
-    }
-}
-
-tasks.named("processTestResources") {
-    finalizedBy(createTestResources)
-}
-tasks.named("test") {
-    finalizedBy(removeTestResources)
-}
