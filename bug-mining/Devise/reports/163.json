{"url":"https://api.github.com/repos/heartcombo/devise/issues/5247","repository_url":"https://api.github.com/repos/heartcombo/devise","labels_url":"https://api.github.com/repos/heartcombo/devise/issues/5247/labels{/name}","comments_url":"https://api.github.com/repos/heartcombo/devise/issues/5247/comments","events_url":"https://api.github.com/repos/heartcombo/devise/issues/5247/events","html_url":"https://github.com/heartcombo/devise/issues/5247","id":624997339,"node_id":"MDU6SXNzdWU2MjQ5OTczMzk=","number":5247,"title":"Devise uses the wrong locale for some flash messages","user":{"login":"collimarco","id":90962,"node_id":"MDQ6VXNlcjkwOTYy","avatar_url":"https://avatars.githubusercontent.com/u/90962?v=4","gravatar_id":"","url":"https://api.github.com/users/collimarco","html_url":"https://github.com/collimarco","followers_url":"https://api.github.com/users/collimarco/followers","following_url":"https://api.github.com/users/collimarco/following{/other_user}","gists_url":"https://api.github.com/users/collimarco/gists{/gist_id}","starred_url":"https://api.github.com/users/collimarco/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/collimarco/subscriptions","organizations_url":"https://api.github.com/users/collimarco/orgs","repos_url":"https://api.github.com/users/collimarco/repos","events_url":"https://api.github.com/users/collimarco/events{/privacy}","received_events_url":"https://api.github.com/users/collimarco/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":21,"created_at":"2020-05-26T15:59:38Z","updated_at":"2024-08-15T08:53:04Z","closed_at":"2023-10-13T14:20:39Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Environment\r\n\r\n- Ruby 2.6\r\n- Rails 6.0\r\n- Devise 4.7\r\n\r\n## Current behavior\r\n\r\nCurrently I use this code as suggested by the Rails guide:\r\n\r\n```\r\n  # application_controller.rb\r\n\r\n  around_action :switch_locale\r\n\r\n  def switch_locale(&action)\r\n    locale = params[:locale] || I18n.default_locale\r\n    I18n.with_locale(locale, &action)\r\n  end\r\n```\r\n\r\nThis works perfectly for the application... but not for all Devise messages! Some are translated, others are not. Devise keeps using the default language for some messages (even if the translated YML files are present).\r\n\r\nPossibly related:\r\n#145\r\nhttps://github.com/heartcombo/devise/issues/5246\r\n\r\nIn order to reproduce the issue:\r\n\r\n1. try login with an invalid password\r\n2. you get an error message (flash) in the wrong language (i.e. Devise seems to use the `default_locale` set in the environment files, not the current one set in application controller)\r\n\r\nIf you log in successfully, instead, the flash message is in the correct language (the language set in application controller).\r\n\r\nI have also tried to copy the official YML file from Devise and translate it, but I have the same issue: some translations appear, other do not.\r\n\r\n## Expected behavior\r\n\r\nDevise should always use the current locale. ","closed_by":{"login":"carlosantoniodasilva","id":26328,"node_id":"MDQ6VXNlcjI2MzI4","avatar_url":"https://avatars.githubusercontent.com/u/26328?v=4","gravatar_id":"","url":"https://api.github.com/users/carlosantoniodasilva","html_url":"https://github.com/carlosantoniodasilva","followers_url":"https://api.github.com/users/carlosantoniodasilva/followers","following_url":"https://api.github.com/users/carlosantoniodasilva/following{/other_user}","gists_url":"https://api.github.com/users/carlosantoniodasilva/gists{/gist_id}","starred_url":"https://api.github.com/users/carlosantoniodasilva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/carlosantoniodasilva/subscriptions","organizations_url":"https://api.github.com/users/carlosantoniodasilva/orgs","repos_url":"https://api.github.com/users/carlosantoniodasilva/repos","events_url":"https://api.github.com/users/carlosantoniodasilva/events{/privacy}","received_events_url":"https://api.github.com/users/carlosantoniodasilva/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/heartcombo/devise/issues/5247/reactions","total_count":11,"+1":11,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/heartcombo/devise/issues/5247/timeline","performed_via_github_app":null,"state_reason":"completed"}