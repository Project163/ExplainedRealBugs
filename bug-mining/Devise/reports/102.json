{"url":"https://api.github.com/repos/heartcombo/devise/issues/2130","repository_url":"https://api.github.com/repos/heartcombo/devise","labels_url":"https://api.github.com/repos/heartcombo/devise/issues/2130/labels{/name}","comments_url":"https://api.github.com/repos/heartcombo/devise/issues/2130/comments","events_url":"https://api.github.com/repos/heartcombo/devise/issues/2130/events","html_url":"https://github.com/heartcombo/devise/issues/2130","id":8126736,"node_id":"MDU6SXNzdWU4MTI2NzM2","number":2130,"title":"update_with_password updates encrypted_password even in failure","user":{"login":"borski","id":207674,"node_id":"MDQ6VXNlcjIwNzY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/207674?v=4","gravatar_id":"","url":"https://api.github.com/users/borski","html_url":"https://github.com/borski","followers_url":"https://api.github.com/users/borski/followers","following_url":"https://api.github.com/users/borski/following{/other_user}","gists_url":"https://api.github.com/users/borski/gists{/gist_id}","starred_url":"https://api.github.com/users/borski/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/borski/subscriptions","organizations_url":"https://api.github.com/users/borski/orgs","repos_url":"https://api.github.com/users/borski/repos","events_url":"https://api.github.com/users/borski/events{/privacy}","received_events_url":"https://api.github.com/users/borski/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2012-11-06T02:22:27Z","updated_at":"2014-08-29T08:22:07Z","closed_at":"2012-11-06T21:13:54Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"When calling `update_with_password`, line 64 calls `valid_password?`, which then calls `password = ::BCrypt::Engine.hash_secret(\"#{password}#{self.class.pepper}\", bcrypt.salt)` on line 44.\n\nAs a result, the `password=` method gets called, which  then calls `self.encrypted_password = password_digest(@password) if @password.present?`\n\nWhat that means is that even in the case of the current password being invalid, the user's encrypted password is already set to the new password. If you were to save this user, say because of some other side effect (last seen, or something like that), it would automatically set the wrong password.\n\nThe solution is to change the var name on line 44 to something else so the `password=` method doesn't get called.\n","closed_by":{"login":"josevalim","id":9582,"node_id":"MDQ6VXNlcjk1ODI=","avatar_url":"https://avatars.githubusercontent.com/u/9582?v=4","gravatar_id":"","url":"https://api.github.com/users/josevalim","html_url":"https://github.com/josevalim","followers_url":"https://api.github.com/users/josevalim/followers","following_url":"https://api.github.com/users/josevalim/following{/other_user}","gists_url":"https://api.github.com/users/josevalim/gists{/gist_id}","starred_url":"https://api.github.com/users/josevalim/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/josevalim/subscriptions","organizations_url":"https://api.github.com/users/josevalim/orgs","repos_url":"https://api.github.com/users/josevalim/repos","events_url":"https://api.github.com/users/josevalim/events{/privacy}","received_events_url":"https://api.github.com/users/josevalim/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/heartcombo/devise/issues/2130/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/heartcombo/devise/issues/2130/timeline","performed_via_github_app":null,"state_reason":"completed"}