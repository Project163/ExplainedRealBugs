{"url":"https://api.github.com/repos/heartcombo/devise/issues/776","repository_url":"https://api.github.com/repos/heartcombo/devise","labels_url":"https://api.github.com/repos/heartcombo/devise/issues/776/labels{/name}","comments_url":"https://api.github.com/repos/heartcombo/devise/issues/776/comments","events_url":"https://api.github.com/repos/heartcombo/devise/issues/776/events","html_url":"https://github.com/heartcombo/devise/issues/776","id":520903,"node_id":"MDU6SXNzdWU1MjA5MDM=","number":776,"title":"remember_me! not working with omniauth","user":{"login":"onsails","id":107261,"node_id":"MDQ6VXNlcjEwNzI2MQ==","avatar_url":"https://avatars.githubusercontent.com/u/107261?v=4","gravatar_id":"","url":"https://api.github.com/users/onsails","html_url":"https://github.com/onsails","followers_url":"https://api.github.com/users/onsails/followers","following_url":"https://api.github.com/users/onsails/following{/other_user}","gists_url":"https://api.github.com/users/onsails/gists{/gist_id}","starred_url":"https://api.github.com/users/onsails/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/onsails/subscriptions","organizations_url":"https://api.github.com/users/onsails/orgs","repos_url":"https://api.github.com/users/onsails/repos","events_url":"https://api.github.com/users/onsails/events{/privacy}","received_events_url":"https://api.github.com/users/onsails/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":40645,"node_id":"MDU6TGFiZWw0MDY0NQ==","url":"https://api.github.com/repos/heartcombo/devise/labels/Bug","name":"Bug","color":"ededed","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2011-01-12T00:29:04Z","updated_at":"2014-12-14T17:21:19Z","closed_at":"2011-02-24T21:24:28Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I integrated devise with omniauth accorting ti the wiki page. openid, oauth authorization types works fine but remember_me does not work.\n\nHere is a part of my User::Omniauth::CallbacksController:\n\n<pre>\n  # ...\n\n  def open_id\n    if @user.blank? and valid_auth?\n      @user = User.new\n      @user.name  = @auth[\"user_info\"][\"name\"]\n      # @user.email = @auth[\"user_info\"][\"email\"]\n      @user.password  = Devise.friendly_token[0..20]\n      @user.save(:validate => false)\n      \n      @profile = @user.social_profiles.build(@auth)\n      @profile.save!\n    end\n\n    @user.remember_me = true\n    @user.remember_me!\n    sign_in(:user, @user)\n    reload_parent_window\n  end\n\n  private\n  \n  def load_profile\n    if @auth = env[\"omniauth.auth\"]\n      @profile = SocialProfile.where(:provider => @auth[\"provider\"], :uid => @auth[\"uid\"]).first\n      @user = @profile.user if @profile\n    end\n  end\n  \n  def reload_parent_window\n    render :text => <<-EOS\n    <script type=\"text/javascript\">\n      if(window.opener) {\n        window.opener.location.reload(true);\n        window.close()\n      }\n    </script>\n    EOS\n  end\n  \n  def valid_auth?\n    !(@auth.blank? or @auth[\"provider\"].blank? or @auth[\"uid\"].blank? or @auth[\"user_info\"].blank?)\n  end</pre>\n\n<pre>\nclass User\n  devise :database_authenticatable, :registerable, :omniauthable,\n  :trackable, :validatable, # :openid_authenticatable, \n  :recoverable, :rememberable\n</pre>\n","closed_by":null,"reactions":{"url":"https://api.github.com/repos/heartcombo/devise/issues/776/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/heartcombo/devise/issues/776/timeline","performed_via_github_app":null,"state_reason":"completed"}