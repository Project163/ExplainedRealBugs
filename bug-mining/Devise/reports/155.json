{"url":"https://api.github.com/repos/heartcombo/devise/issues/4127","repository_url":"https://api.github.com/repos/heartcombo/devise","labels_url":"https://api.github.com/repos/heartcombo/devise/issues/4127/labels{/name}","comments_url":"https://api.github.com/repos/heartcombo/devise/issues/4127/comments","events_url":"https://api.github.com/repos/heartcombo/devise/issues/4127/events","html_url":"https://github.com/heartcombo/devise/issues/4127","id":156133810,"node_id":"MDU6SXNzdWUxNTYxMzM4MTA=","number":4127,"title":"Routes issue when devise engine is mounted in another engine","user":{"login":"bilby91","id":2201079,"node_id":"MDQ6VXNlcjIyMDEwNzk=","avatar_url":"https://avatars.githubusercontent.com/u/2201079?v=4","gravatar_id":"","url":"https://api.github.com/users/bilby91","html_url":"https://github.com/bilby91","followers_url":"https://api.github.com/users/bilby91/followers","following_url":"https://api.github.com/users/bilby91/following{/other_user}","gists_url":"https://api.github.com/users/bilby91/gists{/gist_id}","starred_url":"https://api.github.com/users/bilby91/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bilby91/subscriptions","organizations_url":"https://api.github.com/users/bilby91/orgs","repos_url":"https://api.github.com/users/bilby91/repos","events_url":"https://api.github.com/users/bilby91/events{/privacy}","received_events_url":"https://api.github.com/users/bilby91/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":399339231,"node_id":"MDU6TGFiZWwzOTkzMzkyMzE=","url":"https://api.github.com/repos/heartcombo/devise/labels/PR%20attached","name":"PR attached","color":"d93f0b","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":16,"created_at":"2016-05-22T04:11:40Z","updated_at":"2019-01-23T17:32:39Z","closed_at":"2019-01-23T17:32:39Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I'm building an engine that uses devise inside for user authentication. I have followed the instructions in the wiki (https://github.com/plataformatec/devise/wiki/How-To:-Use-devise-inside-a-mountable-engine) but I couldn't make it work as expected. It seems that `router_name` is being ignored. Maybe I'm miss understanding something.\n\nI have created a simple engine with a dummy app that reproduces my issue. You can find it here: https://github.com/bilby91/devise_mountable_engine_issue. In the `spec/dummy` app there is a authenticated route under `/` path. When user is redirected to the sign_in path, the route doesn't build correctly and ignores the `router_name`.\n\nI could make it work by providing a custom FailureApp to warden that handles the redirect.\n\n```\nmodule MyEngine\n\n  class FailureApp < Devise::FailureApp\n\n    def redirect_url\n      engine_route = Rails\n        .application\n        .routes\n        .routes\n        .select { |r| r.app.app == MyEngine::Engine }\n        .first\n\n      \"#{engine_route.path.spec.to_s}/users/sign_in\"\n    end\n     #\n    #  # You need to override respond to eliminate recall\n    def respond\n      if http_auth?\n        http_auth\n      else\n        redirect\n      end\n    end\n\n   end\n\nend\n```\n\nI really don't like this solution :(. Any help is more than welcome!\n\nThanks!\n","closed_by":{"login":"feliperenan","id":27698968,"node_id":"MDQ6VXNlcjI3Njk4OTY4","avatar_url":"https://avatars.githubusercontent.com/u/27698968?v=4","gravatar_id":"","url":"https://api.github.com/users/feliperenan","html_url":"https://github.com/feliperenan","followers_url":"https://api.github.com/users/feliperenan/followers","following_url":"https://api.github.com/users/feliperenan/following{/other_user}","gists_url":"https://api.github.com/users/feliperenan/gists{/gist_id}","starred_url":"https://api.github.com/users/feliperenan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/feliperenan/subscriptions","organizations_url":"https://api.github.com/users/feliperenan/orgs","repos_url":"https://api.github.com/users/feliperenan/repos","events_url":"https://api.github.com/users/feliperenan/events{/privacy}","received_events_url":"https://api.github.com/users/feliperenan/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/heartcombo/devise/issues/4127/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/heartcombo/devise/issues/4127/timeline","performed_via_github_app":null,"state_reason":"completed"}