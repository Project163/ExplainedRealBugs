diff --git a/src/common/XmlTestExecutionVisitor.cs b/src/common/XmlTestExecutionVisitor.cs
index d310ebc6..da8b3a9b 100644
--- a/src/common/XmlTestExecutionVisitor.cs
+++ b/src/common/XmlTestExecutionVisitor.cs
@@ -11,7 +11,7 @@ public class XmlTestExecutionVisitor : TestMessageVisitor<ITestAssemblyFinished>
     {
         readonly XElement assemblyElement;
         readonly XElement errorsElement;
-        readonly ConcurrentDictionary<ITestCollection, XElement> testCollectionElements = new ConcurrentDictionary<ITestCollection, XElement>();
+        readonly ConcurrentDictionary<Guid, XElement> testCollectionElements = new ConcurrentDictionary<Guid, XElement>();
 
         public XmlTestExecutionVisitor(XElement assemblyElement, Func<bool> cancelThunk)
         {
@@ -81,7 +81,7 @@ XElement CreateTestResultElement(ITestResultMessage testResult, string resultTex
 
         XElement GetTestCollectionElement(ITestCollection testCollection)
         {
-            return testCollectionElements.GetOrAdd(testCollection, tc => new XElement("collection"));
+            return testCollectionElements.GetOrAdd(testCollection.UniqueID, tc => new XElement("collection"));
         }
 
         public override bool OnMessage(IMessageSinkMessage message)
