diff --git a/src/common/DictionaryExtensions.cs b/src/common/DictionaryExtensions.cs
index 7854dfa6..7729937c 100644
--- a/src/common/DictionaryExtensions.cs
+++ b/src/common/DictionaryExtensions.cs
@@ -37,4 +37,19 @@ static class DictionaryExtensions
 
         return result;
     }
+
+    // Uses the indexer instead of add, in case there are duplicate keys.
+    public static Dictionary<TKey, TValue> ToDictionaryIgnoringDuplicateKeys<TKey, TValue>(this IEnumerable<TValue> values, Func<TValue, TKey> keySelector)
+    {
+        var result = new Dictionary<TKey, TValue>();
+
+        foreach (var value in values)
+        {
+            var key = keySelector(value);
+            if (!result.ContainsKey(key))
+                result.Add(key, value);
+        }
+
+        return result;
+    }
 }
diff --git a/src/xunit.runner.utility/Utility/DiaSessionWrapperHelper.cs b/src/xunit.runner.utility/Utility/DiaSessionWrapperHelper.cs
index d33aa486..e843d26c 100644
--- a/src/xunit.runner.utility/Utility/DiaSessionWrapperHelper.cs
+++ b/src/xunit.runner.utility/Utility/DiaSessionWrapperHelper.cs
@@ -70,7 +70,7 @@ public DiaSessionWrapperHelper(string assemblyFileName)
 
                 if (types != null)
                     typeNameMap = types.Where(t => t != null && !string.IsNullOrEmpty(t.FullName))
-                                       .ToDictionary(k => k.FullName);
+                                       .ToDictionaryIgnoringDuplicateKeys(k => k.FullName);
                 else
                     typeNameMap = new Dictionary<string, Type>();
             }
diff --git a/src/xunit.runner.utility/Utility/DiaSessionWrapperHelper_DotNet.cs b/src/xunit.runner.utility/Utility/DiaSessionWrapperHelper_DotNet.cs
index 16b31c29..adb0d83b 100644
--- a/src/xunit.runner.utility/Utility/DiaSessionWrapperHelper_DotNet.cs
+++ b/src/xunit.runner.utility/Utility/DiaSessionWrapperHelper_DotNet.cs
@@ -38,12 +38,11 @@ public DiaSessionWrapperHelper(string assemblyFileName)
 
                 if (types != null)
                     typeNameMap = types.Where(t => t != null && !string.IsNullOrEmpty(t.FullName))
-                                       .ToDictionary(k => k.FullName);
+                                       .ToDictionaryIgnoringDuplicateKeys(k => k.FullName);
                 else
                     typeNameMap = new Dictionary<string, Type>();
             }
         }
-      
 
         public void Normalize(ref string typeName, ref string methodName, ref string assemblyPath)
         {
@@ -63,7 +62,7 @@ public void Normalize(ref string typeName, ref string methodName, ref string ass
                         assemblyPath = method.DeclaringType.GetAssembly().Location;
 
                         var stateMachineType = method.GetCustomAttribute<AsyncStateMachineAttribute>()?.StateMachineType;
-                        
+
                         if (stateMachineType != null)
                         {
                             typeName = stateMachineType.FullName;
