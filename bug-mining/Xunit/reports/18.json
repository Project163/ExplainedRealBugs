{"url":"https://api.github.com/repos/xunit/xunit/issues/95","repository_url":"https://api.github.com/repos/xunit/xunit","labels_url":"https://api.github.com/repos/xunit/xunit/issues/95/labels{/name}","comments_url":"https://api.github.com/repos/xunit/xunit/issues/95/comments","events_url":"https://api.github.com/repos/xunit/xunit/issues/95/events","html_url":"https://github.com/xunit/xunit/issues/95","id":34069740,"node_id":"MDU6SXNzdWUzNDA2OTc0MA==","number":95,"title":"VS test runner fails when trying to report a wrapped AssertException","user":{"login":"adamjasinski","id":1610975,"node_id":"MDQ6VXNlcjE2MTA5NzU=","avatar_url":"https://avatars.githubusercontent.com/u/1610975?v=4","gravatar_id":"","url":"https://api.github.com/users/adamjasinski","html_url":"https://github.com/adamjasinski","followers_url":"https://api.github.com/users/adamjasinski/followers","following_url":"https://api.github.com/users/adamjasinski/following{/other_user}","gists_url":"https://api.github.com/users/adamjasinski/gists{/gist_id}","starred_url":"https://api.github.com/users/adamjasinski/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adamjasinski/subscriptions","organizations_url":"https://api.github.com/users/adamjasinski/orgs","repos_url":"https://api.github.com/users/adamjasinski/repos","events_url":"https://api.github.com/users/adamjasinski/events{/privacy}","received_events_url":"https://api.github.com/users/adamjasinski/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":75574707,"node_id":"MDU6TGFiZWw3NTU3NDcwNw==","url":"https://api.github.com/repos/xunit/xunit/labels/Bug","name":"Bug","color":"FEF2C0","default":false,"description":"A fault in an existing feature"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/xunit/xunit/milestones/5","html_url":"https://github.com/xunit/xunit/milestone/5","labels_url":"https://api.github.com/repos/xunit/xunit/milestones/5/labels","id":641416,"node_id":"MDk6TWlsZXN0b25lNjQxNDE2","number":5,"title":"2.0-beta-3","description":"","creator":{"login":"bradwilson","id":16944,"node_id":"MDQ6VXNlcjE2OTQ0","avatar_url":"https://avatars.githubusercontent.com/u/16944?v=4","gravatar_id":"","url":"https://api.github.com/users/bradwilson","html_url":"https://github.com/bradwilson","followers_url":"https://api.github.com/users/bradwilson/followers","following_url":"https://api.github.com/users/bradwilson/following{/other_user}","gists_url":"https://api.github.com/users/bradwilson/gists{/gist_id}","starred_url":"https://api.github.com/users/bradwilson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bradwilson/subscriptions","organizations_url":"https://api.github.com/users/bradwilson/orgs","repos_url":"https://api.github.com/users/bradwilson/repos","events_url":"https://api.github.com/users/bradwilson/events{/privacy}","received_events_url":"https://api.github.com/users/bradwilson/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":8,"state":"closed","created_at":"2014-04-27T01:50:30Z","updated_at":"2014-07-19T19:05:39Z","due_on":null,"closed_at":"2014-07-19T19:05:39Z"},"comments":4,"created_at":"2014-05-22T10:40:13Z","updated_at":"2014-06-14T00:08:19Z","closed_at":"2014-05-24T23:00:11Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I'm using\n\n<pre>\nVisual Studio 2013 Update 1\nxunit 1.9.2\nxUnit.net runner for Visual Studio 2012 and 2013 0.99.6\n</pre>\n\nWhen I try to run a test that performs an assertion, and the resulting `AssertException`-derived exception is subsequently wrapped in some other exception, the test runner fails with `IndexOutOfRangeException`.\nRepro test case is pasted below.\nThe full test output is pasted below.\n\nOne of practical impacts of this bug is that now I can't use the VS test runner when working with [TickSpec](http://tickspec.codeplex.com/) tests, as all assert exceptions reported from there are wrapped in TargetInvocationException.\n\nVS test runner 0.99.5 seem to run those tests and report exceptions properly.\n(also, tests are working properly with xunit GUI runner (v.1.9.0)).\n\nI saw a related pull request [#71](https://github.com/xunit/xunit/pull/71) (Xunit1 exception handling...), but I believe that 0.99.6 should already contain those changes.\n\nRepro:\n\n<pre>\n        [Fact]\n        //xunit VS test runner 0.99.6 fails with IndexOutOfRangeException\n        static void WrappedAssertExceptionShouldBeReported()\n        {\n            try\n            {\n                Assert.True( false );\n            }\n            catch ( Exception ex )\n            {\n                throw new Exception( \"failure\", ex );\n            }\n        }\n\n</pre>\n\n\nThis one works fine, though:\n\n<pre>\n        [Fact]\n        //works fine with xunit VS test runner 0.99.6\n        static void WrappedExceptionOfOtherTypesShouldBeReported()\n        {\n            try\n            {\n                throw new Exception( \"error\" );\n            }\n            catch ( Exception ex )\n            {\n                throw new Exception( \"failure\", ex );\n            }\n        }\n</pre>\n\n\nTest output from VS test runner 0.99.6:\n\n<pre>\n------ Discover test started ------\n========== Discover test finished: 2 found (0:00:00.669735) ==========\n------ Run test started ------\nSystem.Reflection.TargetInvocationException: Exception has been thrown by the target of an invocation. ---> System.IndexOutOfRangeException: Index was outside the bounds of the array.\n   at Xunit.ExceptionUtility.GetMessage(IFailureInformation failureInfo, Int32 index, Int32 level)\n   at Xunit.ExceptionUtility.GetMessage(IFailureInformation failureInfo, Int32 index, Int32 level)\n   at Xunit.Runner.VisualStudio.TestAdapter.VsExecutionVisitor.Visit(ITestFailed testFailed)\n   at Xunit.TestMessageVisitor.DoVisit[TMessage](IMessageSinkMessage message, Func`2 callback)\n   at Xunit.TestMessageVisitor.OnMessage(IMessageSinkMessage message)\n   at Xunit.TestMessageVisitor`1.OnMessage(IMessageSinkMessage message)\n   at Xunit.TestClassCallbackHandler.OnTest(XmlNode xml)\n   at Xunit.TestClassCallbackHandler.OnXmlNode(XmlNode xml)\n   at Xunit.XmlNodeCallbackHandler.System.Web.UI.ICallbackEventHandler.RaiseCallbackEvent(String eventArgument)\n   at System.Web.UI.ICallbackEventHandler.RaiseCallbackEvent(String eventArgument)\n[...]\n</pre>\n","closed_by":{"login":"bradwilson","id":16944,"node_id":"MDQ6VXNlcjE2OTQ0","avatar_url":"https://avatars.githubusercontent.com/u/16944?v=4","gravatar_id":"","url":"https://api.github.com/users/bradwilson","html_url":"https://github.com/bradwilson","followers_url":"https://api.github.com/users/bradwilson/followers","following_url":"https://api.github.com/users/bradwilson/following{/other_user}","gists_url":"https://api.github.com/users/bradwilson/gists{/gist_id}","starred_url":"https://api.github.com/users/bradwilson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bradwilson/subscriptions","organizations_url":"https://api.github.com/users/bradwilson/orgs","repos_url":"https://api.github.com/users/bradwilson/repos","events_url":"https://api.github.com/users/bradwilson/events{/privacy}","received_events_url":"https://api.github.com/users/bradwilson/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/xunit/xunit/issues/95/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/xunit/xunit/issues/95/timeline","performed_via_github_app":null,"state_reason":"completed"}