{"url":"https://api.github.com/repos/xunit/xunit/issues/2008","repository_url":"https://api.github.com/repos/xunit/xunit","labels_url":"https://api.github.com/repos/xunit/xunit/issues/2008/labels{/name}","comments_url":"https://api.github.com/repos/xunit/xunit/issues/2008/comments","events_url":"https://api.github.com/repos/xunit/xunit/issues/2008/events","html_url":"https://github.com/xunit/xunit/issues/2008","id":492956464,"node_id":"MDU6SXNzdWU0OTI5NTY0NjQ=","number":2008,"title":"Dispose method on test class not being called if test is cancelled","user":{"login":"lizalc","id":1335644,"node_id":"MDQ6VXNlcjEzMzU2NDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1335644?v=4","gravatar_id":"","url":"https://api.github.com/users/lizalc","html_url":"https://github.com/lizalc","followers_url":"https://api.github.com/users/lizalc/followers","following_url":"https://api.github.com/users/lizalc/following{/other_user}","gists_url":"https://api.github.com/users/lizalc/gists{/gist_id}","starred_url":"https://api.github.com/users/lizalc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lizalc/subscriptions","organizations_url":"https://api.github.com/users/lizalc/orgs","repos_url":"https://api.github.com/users/lizalc/repos","events_url":"https://api.github.com/users/lizalc/events{/privacy}","received_events_url":"https://api.github.com/users/lizalc/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":16,"created_at":"2019-09-12T18:17:25Z","updated_at":"2025-06-06T17:15:23Z","closed_at":"2020-09-02T07:04:35Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I'm using .NET 4.7.2 and the xUnit console runner (v2.4.1).\r\n\r\nI'm using xUnit to run some integration tests on an external device. My test class constructor performs some device setup, then I use the Dispose method to do some cleanup on the device. Overall it has been working well but I've noticed that sometimes if I cancel a test while it is running - after the constructor has been called and device setup complete - the Dispose method isn't called so the device cleanup code never runs. Cancelling meaning I press `Ctrl+C` once on the console while the test is running.\r\n\r\nHere are some example tests I wrote which I have used to reproduce the issue: https://github.com/shvr/xUnitDisposeNotCalled\r\n\r\nThese tests simply wait for 10 seconds (some using Thread.Sleep and some using Task.Delay). One of the test classes, `ThrowingDispose`, simply throws an exception when called, while the other test class, `SleepyDispose` sleeps for 5 seconds. When running tests in the `ThrowingDispose` class, if I cancel a test the exception is never thrown, and for `SleepyDispose` the 5 second delay never seems to occur.\r\n\r\nI've also passed the `-debug` option to the console runner and set a breakpoint in the Dispose methods. If I cancel the tests the breakpoint is never hit.\r\n\r\nHere's some console output from a test in the `ThrowingDispose` that I cancelled while it was running:\r\n```\r\nPS C:\\Users\\lando\\source\\repos\\DisposeNotCalled\\DisposeNotCalled\\bin\\Debug\\net472> & 'C:\\Users\\lando\\.nuget\\packages\\xunit.runner.console\\2.4.1\\tools\\net472\\xunit.console.exe' .\\DisposeNotCalled.dll -diagnostics -internaldiagnostics -verbose -method DisposeNotCalled.ThrowingDispose.DisposeNotCalled\r\nxUnit.net Console Runner v2.4.1 (64-bit Desktop .NET 4.7.2, runtime: 4.0.30319.42000)\r\n   [AssemblyHelper_Desktop.LoadAssembly] Resolution for 'Microsoft.VisualStudio.TestPlatform.ObjectModel' failed, passed down to next resolver\r\n   DisposeNotCalled: [AssemblyHelper_Desktop.LoadAssembly] Resolution for 'Microsoft.VisualStudio.TestPlatform.ObjectModel' failed, passed down to next resolver\r\n  Discovering: DisposeNotCalled (app domain = on [shadow copy], method display = ClassAndMethod, method display options = None)\r\n  Discovered:  DisposeNotCalled (found 1 of 8 test case)\r\n  Starting:    DisposeNotCalled (parallel test collections = on, max threads = 4)\r\n   [AssemblyHelper_Desktop.LoadAssembly] Resolution for 'xunit.execution.desktop' failed, passed down to next resolver\r\n   DisposeNotCalled: [AssemblyHelper_Desktop.LoadAssembly] Resolved 'xunit.execution.desktop' to 'C:\\Users\\lando\\source\\repos\\DisposeNotCalled\\DisposeNotCalled\\bin\\Debug\\net472\\xunit.execution.desktop.dll'\r\n    DisposeNotCalled.ThrowingDispose.DisposeNotCalled [STARTING]\r\nCanceling... (Press Ctrl+C again to terminate)\r\n    DisposeNotCalled.ThrowingDispose.DisposeNotCalled [FINISHED] Time: 10.008432s\r\n  Finished:    DisposeNotCalled\r\n=== TEST EXECUTION SUMMARY ===\r\n   DisposeNotCalled  Total: 1, Errors: 0, Failed: 0, Skipped: 0, Time: 10.112s\r\n```","closed_by":{"login":"bradwilson","id":16944,"node_id":"MDQ6VXNlcjE2OTQ0","avatar_url":"https://avatars.githubusercontent.com/u/16944?v=4","gravatar_id":"","url":"https://api.github.com/users/bradwilson","html_url":"https://github.com/bradwilson","followers_url":"https://api.github.com/users/bradwilson/followers","following_url":"https://api.github.com/users/bradwilson/following{/other_user}","gists_url":"https://api.github.com/users/bradwilson/gists{/gist_id}","starred_url":"https://api.github.com/users/bradwilson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bradwilson/subscriptions","organizations_url":"https://api.github.com/users/bradwilson/orgs","repos_url":"https://api.github.com/users/bradwilson/repos","events_url":"https://api.github.com/users/bradwilson/events{/privacy}","received_events_url":"https://api.github.com/users/bradwilson/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/xunit/xunit/issues/2008/reactions","total_count":4,"+1":4,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/xunit/xunit/issues/2008/timeline","performed_via_github_app":null,"state_reason":"completed"}