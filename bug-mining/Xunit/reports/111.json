{"url":"https://api.github.com/repos/xunit/xunit/issues/1233","repository_url":"https://api.github.com/repos/xunit/xunit","labels_url":"https://api.github.com/repos/xunit/xunit/issues/1233/labels{/name}","comments_url":"https://api.github.com/repos/xunit/xunit/issues/1233/comments","events_url":"https://api.github.com/repos/xunit/xunit/issues/1233/events","html_url":"https://github.com/xunit/xunit/issues/1233","id":225122170,"node_id":"MDU6SXNzdWUyMjUxMjIxNzA=","number":1233,"title":"Types with duplicate names cause fatal exception","user":{"login":"philn5d","id":4197796,"node_id":"MDQ6VXNlcjQxOTc3OTY=","avatar_url":"https://avatars.githubusercontent.com/u/4197796?v=4","gravatar_id":"","url":"https://api.github.com/users/philn5d","html_url":"https://github.com/philn5d","followers_url":"https://api.github.com/users/philn5d/followers","following_url":"https://api.github.com/users/philn5d/following{/other_user}","gists_url":"https://api.github.com/users/philn5d/gists{/gist_id}","starred_url":"https://api.github.com/users/philn5d/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/philn5d/subscriptions","organizations_url":"https://api.github.com/users/philn5d/orgs","repos_url":"https://api.github.com/users/philn5d/repos","events_url":"https://api.github.com/users/philn5d/events{/privacy}","received_events_url":"https://api.github.com/users/philn5d/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":75574707,"node_id":"MDU6TGFiZWw3NTU3NDcwNw==","url":"https://api.github.com/repos/xunit/xunit/labels/Bug","name":"Bug","color":"FEF2C0","default":false,"description":"A fault in an existing feature"},{"id":241290899,"node_id":"MDU6TGFiZWwyNDEyOTA4OTk=","url":"https://api.github.com/repos/xunit/xunit/labels/Core%20framework","name":"Core framework","color":"BFD4F2","default":false,"description":"xunit.v3.core"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/xunit/xunit/milestones/30","html_url":"https://github.com/xunit/xunit/milestone/30","labels_url":"https://api.github.com/repos/xunit/xunit/milestones/30/labels","id":2473947,"node_id":"MDk6TWlsZXN0b25lMjQ3Mzk0Nw==","number":30,"title":"2.3-beta2","description":"","creator":{"login":"bradwilson","id":16944,"node_id":"MDQ6VXNlcjE2OTQ0","avatar_url":"https://avatars.githubusercontent.com/u/16944?v=4","gravatar_id":"","url":"https://api.github.com/users/bradwilson","html_url":"https://github.com/bradwilson","followers_url":"https://api.github.com/users/bradwilson/followers","following_url":"https://api.github.com/users/bradwilson/following{/other_user}","gists_url":"https://api.github.com/users/bradwilson/gists{/gist_id}","starred_url":"https://api.github.com/users/bradwilson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bradwilson/subscriptions","organizations_url":"https://api.github.com/users/bradwilson/orgs","repos_url":"https://api.github.com/users/bradwilson/repos","events_url":"https://api.github.com/users/bradwilson/events{/privacy}","received_events_url":"https://api.github.com/users/bradwilson/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":13,"state":"closed","created_at":"2017-04-22T15:19:26Z","updated_at":"2017-05-09T06:26:55Z","due_on":null,"closed_at":"2017-05-09T06:26:55Z"},"comments":1,"created_at":"2017-04-28T15:53:50Z","updated_at":"2017-05-08T20:56:31Z","closed_at":"2017-05-08T20:56:31Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"XUnit 2.02 and VS 14 using test runner. No ReSharper.\r\n\r\nvstest.discoveryengine.x86.exe keeps running after this exception:\r\n\r\n```\r\n------ Discover test started ------\r\n[xUnit.net 00:00:00.0695166] Exception discovering tests from Emmis.TagStation.Tests: System.ArgumentException: An item with the same key has already been added.\r\n   at System.ThrowHelper.ThrowArgumentException(ExceptionResource resource)\r\n   at System.Collections.Generic.Dictionary`2.Insert(TKey key, TValue value, Boolean add)\r\n   at System.Linq.Enumerable.ToDictionary[TSource,TKey,TElement](IEnumerable`1 source, Func`2 keySelector, Func`2 elementSelector, IEqualityComparer`1 comparer)\r\n   at Xunit.DiaSessionWrapperHelper..ctor(String assemblyFileName)$$RethrowMarker$$   at ExceptionExtensions.RethrowWithNoStackTraceLoss(Exception ex)\r\n   at Xunit.AppDomainManager_AppDomain.CreateObject[TObject](AssemblyName assemblyName, String typeName, Object[] args)\r\n   at Xunit.DiaSessionWrapper..ctor(String assemblyFilename)\r\n   at Xunit.VisualStudioSourceInformationProvider..ctor(String assemblyFileName)\r\n   at Xunit.XunitFrontController..ctor(AppDomainSupport appDomainSupport, String assemblyFileName, String configFileName, Boolean shadowCopy, String shadowCopyFolder, ISourceInformationProvider sourceInformationProvider, IMessageSink diagnosticMessageSink)\r\n   at Xunit.Runner.VisualStudio.TestAdapter.VsTestRunner.DiscoverTests[TVisitor](IEnumerable`1 sources, LoggerHelper logger, Func`4 visitorFactory, Action`4 visitComplete)\r\n========== Discover test finished: 0 found (0:00:00.11) ==========\r\n```\r\n\r\nwhich causes no tests to be found in the entire project.\r\nand build failures on subsequent ReBuilds.\r\n\r\n(obfuscated)\r\n```\r\nSeverity\tCode\tDescription\tProject\tFile\tLine\tSuppression State\r\nError\t\tUnable to copy file \"....dll\" to \"....dll\". The process cannot access the file '....dll' because it is being used by another process.\t...\tC:\\Program Files (x86)\\MSBuild\\14.0\\bin\\Microsoft.Common.CurrentVersion.targets\t3963\t\r\nError\t\tCould not copy \"....dll\" to \"...dll\". Exceeded retry count of 10. Failed.\t...\tC:\\Program Files (x86)\\MSBuild\\14.0\\bin\\Microsoft.Common.CurrentVersion.targets\t3963\t\r\n```\r\n\r\nin which case I have to manually kill vstest.discoveryengine.x86.exe to rebuild the sln or otherwise proceed.\r\n\r\nThe code that is causing the exception in the first place:\r\n\r\n```C#\r\nusing System;\r\nusing System.Collections.Generic;\r\nusing Xunit;\r\n\r\nnamespace Tests\r\n{\r\n    public class MyTests\r\n    {\r\n        List<dynamic> _list = new List<dynamic>();\r\n        \r\n        //seems to be the catalyst, has to be dynamic\r\n        Action<dynamic> someOtherAction = o => { };\r\n\r\n        //but only in conjunction with this\r\n        Action<dynamic, List<dynamic>> seemsToCauseTheProblem = (o, l) => l.Add(o);\r\n\r\n        public MyTests()\r\n        {\r\n            //when I do this, it hurts\r\n            someOtherAction = o => { _list.Add(o); };\r\n        }\r\n\r\n        [Fact]\r\n        public void ThatsSomeTest()\r\n        {\r\n            //nothing necessary here to cause the problem\r\n        }\r\n    }\r\n}\r\n```","closed_by":{"login":"bradwilson","id":16944,"node_id":"MDQ6VXNlcjE2OTQ0","avatar_url":"https://avatars.githubusercontent.com/u/16944?v=4","gravatar_id":"","url":"https://api.github.com/users/bradwilson","html_url":"https://github.com/bradwilson","followers_url":"https://api.github.com/users/bradwilson/followers","following_url":"https://api.github.com/users/bradwilson/following{/other_user}","gists_url":"https://api.github.com/users/bradwilson/gists{/gist_id}","starred_url":"https://api.github.com/users/bradwilson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bradwilson/subscriptions","organizations_url":"https://api.github.com/users/bradwilson/orgs","repos_url":"https://api.github.com/users/bradwilson/repos","events_url":"https://api.github.com/users/bradwilson/events{/privacy}","received_events_url":"https://api.github.com/users/bradwilson/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/xunit/xunit/issues/1233/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/xunit/xunit/issues/1233/timeline","performed_via_github_app":null,"state_reason":"completed"}