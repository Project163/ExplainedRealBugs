{"url":"https://api.github.com/repos/xunit/xunit/issues/534","repository_url":"https://api.github.com/repos/xunit/xunit","labels_url":"https://api.github.com/repos/xunit/xunit/issues/534/labels{/name}","comments_url":"https://api.github.com/repos/xunit/xunit/issues/534/comments","events_url":"https://api.github.com/repos/xunit/xunit/issues/534/events","html_url":"https://github.com/xunit/xunit/issues/534","id":100424743,"node_id":"MDU6SXNzdWUxMDA0MjQ3NDM=","number":534,"title":"Test execution hangs when item in data row for theory contains public Task property","user":{"login":"vlaci","id":1771332,"node_id":"MDQ6VXNlcjE3NzEzMzI=","avatar_url":"https://avatars.githubusercontent.com/u/1771332?v=4","gravatar_id":"","url":"https://api.github.com/users/vlaci","html_url":"https://github.com/vlaci","followers_url":"https://api.github.com/users/vlaci/followers","following_url":"https://api.github.com/users/vlaci/following{/other_user}","gists_url":"https://api.github.com/users/vlaci/gists{/gist_id}","starred_url":"https://api.github.com/users/vlaci/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vlaci/subscriptions","organizations_url":"https://api.github.com/users/vlaci/orgs","repos_url":"https://api.github.com/users/vlaci/repos","events_url":"https://api.github.com/users/vlaci/events{/privacy}","received_events_url":"https://api.github.com/users/vlaci/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":75574707,"node_id":"MDU6TGFiZWw3NTU3NDcwNw==","url":"https://api.github.com/repos/xunit/xunit/labels/Bug","name":"Bug","color":"FEF2C0","default":false,"description":"A fault in an existing feature"},{"id":241290899,"node_id":"MDU6TGFiZWwyNDEyOTA4OTk=","url":"https://api.github.com/repos/xunit/xunit/labels/Core%20framework","name":"Core framework","color":"BFD4F2","default":false,"description":"xunit.v3.core"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/xunit/xunit/milestones/18","html_url":"https://github.com/xunit/xunit/milestone/18","labels_url":"https://api.github.com/repos/xunit/xunit/milestones/18/labels","id":1247405,"node_id":"MDk6TWlsZXN0b25lMTI0NzQwNQ==","number":18,"title":"2.1-rc1","description":"","creator":{"login":"bradwilson","id":16944,"node_id":"MDQ6VXNlcjE2OTQ0","avatar_url":"https://avatars.githubusercontent.com/u/16944?v=4","gravatar_id":"","url":"https://api.github.com/users/bradwilson","html_url":"https://github.com/bradwilson","followers_url":"https://api.github.com/users/bradwilson/followers","following_url":"https://api.github.com/users/bradwilson/following{/other_user}","gists_url":"https://api.github.com/users/bradwilson/gists{/gist_id}","starred_url":"https://api.github.com/users/bradwilson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bradwilson/subscriptions","organizations_url":"https://api.github.com/users/bradwilson/orgs","repos_url":"https://api.github.com/users/bradwilson/repos","events_url":"https://api.github.com/users/bradwilson/events{/privacy}","received_events_url":"https://api.github.com/users/bradwilson/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":14,"state":"closed","created_at":"2015-08-10T01:07:54Z","updated_at":"2015-09-06T22:40:49Z","due_on":null,"closed_at":"2015-09-06T22:40:49Z"},"comments":2,"created_at":"2015-08-11T22:25:43Z","updated_at":"2015-08-16T19:38:50Z","closed_at":"2015-08-16T00:53:30Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"After upgrading to 2.0, my test running attempts hanged.\nDebugging pointed to `XunitTheoryTestCaseRunner.AfterTestCaseStartingAsync`\nHere we try to generate a display name for tests:\n\n``` cs\nvar theoryDisplayName = TestCase.TestMethod.Method.GetDisplayNameWithArguments(DisplayName, convertedDataRow, resolvedTypes);\n```\n\nSuppose we have a theory argument holding a property (or filed) of `Task` that never finishes. That `Task` has a `Result` property that blocks on getting its value. It is a problem, because\ndeep down the call chain we enumerate the fields and properties of theory arguments:\n\n``` cs\nvar fields = type.GetRuntimeFields()\n                 .Where(f => f.IsPublic && !f.IsStatic)\n                 .Select(f => new { name = f.Name, value = WrapAndGetFormattedValue(() => f.GetValue(value), depth) });\nvar properties = type.GetRuntimeProperties()\n                     .Where(p => p.GetMethod != null && p.GetMethod.IsPublic && !p.GetMethod.IsStatic)\n                     .Select(p => new { name = p.Name, value = WrapAndGetFormattedValue(() => p.GetValue(value), depth) });\n//                                                                                            ^ this call can block\nvar parameters = fields.Concat(properties)\n                       .OrderBy(p => p.name)\n                       .Take(MAX_OBJECT_PARAMETER_COUNT + 1)\n                       .ToList();\n//                      ^ Here we enumerate the properties and the blocking method is invoked\n\n```\n\nI don't think that it is generally a good idea to enumerate all fields and properties of theory arguments because of possible side effects of not well-behaving code. The most common example could be `Task` itself\n","closed_by":{"login":"bradwilson","id":16944,"node_id":"MDQ6VXNlcjE2OTQ0","avatar_url":"https://avatars.githubusercontent.com/u/16944?v=4","gravatar_id":"","url":"https://api.github.com/users/bradwilson","html_url":"https://github.com/bradwilson","followers_url":"https://api.github.com/users/bradwilson/followers","following_url":"https://api.github.com/users/bradwilson/following{/other_user}","gists_url":"https://api.github.com/users/bradwilson/gists{/gist_id}","starred_url":"https://api.github.com/users/bradwilson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bradwilson/subscriptions","organizations_url":"https://api.github.com/users/bradwilson/orgs","repos_url":"https://api.github.com/users/bradwilson/repos","events_url":"https://api.github.com/users/bradwilson/events{/privacy}","received_events_url":"https://api.github.com/users/bradwilson/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/xunit/xunit/issues/534/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/xunit/xunit/issues/534/timeline","performed_via_github_app":null,"state_reason":"completed"}