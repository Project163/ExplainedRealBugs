{"url":"https://api.github.com/repos/xunit/xunit/issues/2332","repository_url":"https://api.github.com/repos/xunit/xunit","labels_url":"https://api.github.com/repos/xunit/xunit/issues/2332/labels{/name}","comments_url":"https://api.github.com/repos/xunit/xunit/issues/2332/comments","events_url":"https://api.github.com/repos/xunit/xunit/issues/2332/events","html_url":"https://github.com/xunit/xunit/issues/2332","id":934155470,"node_id":"MDU6SXNzdWU5MzQxNTU0NzA=","number":2332,"title":"Support dynamic assemblies","user":{"login":"bradwilson","id":16944,"node_id":"MDQ6VXNlcjE2OTQ0","avatar_url":"https://avatars.githubusercontent.com/u/16944?v=4","gravatar_id":"","url":"https://api.github.com/users/bradwilson","html_url":"https://github.com/bradwilson","followers_url":"https://api.github.com/users/bradwilson/followers","following_url":"https://api.github.com/users/bradwilson/following{/other_user}","gists_url":"https://api.github.com/users/bradwilson/gists{/gist_id}","starred_url":"https://api.github.com/users/bradwilson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bradwilson/subscriptions","organizations_url":"https://api.github.com/users/bradwilson/orgs","repos_url":"https://api.github.com/users/bradwilson/repos","events_url":"https://api.github.com/users/bradwilson/events{/privacy}","received_events_url":"https://api.github.com/users/bradwilson/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":75574830,"node_id":"MDU6TGFiZWw3NTU3NDgzMA==","url":"https://api.github.com/repos/xunit/xunit/labels/Feature","name":"Feature","color":"FEF2C0","default":false,"description":"A request for a new feature"},{"id":241290899,"node_id":"MDU6TGFiZWwyNDEyOTA4OTk=","url":"https://api.github.com/repos/xunit/xunit/labels/Core%20framework","name":"Core framework","color":"BFD4F2","default":false,"description":"xunit.v3.core"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2021-06-30T21:53:47Z","updated_at":"2021-11-17T09:08:31Z","closed_at":"2021-11-17T09:08:31Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"_(This item describes designs that are still not completed, and may change before RTW.)_\r\n\r\nGiven the architecture of v1 and v2, supporting dynamic assemblies (that is, assemblies that are created at runtime via code generation) wasn't really possible. The runner APIs (and thus all the runners) require files on disk to load.\r\n\r\nThe architecture of v3 (specifically that test projects are stand alone executables) now makes it much simpler to support dynamic assemblies. The entry point for console-based tests (.NET Framework and .NET Core) currently looks like this:\r\n\r\nhttps://github.com/xunit/xunit/blob/4ad93274b31fa3e523ff9f14ef4a0ad19fcac8d7/src/common.tests/Program.cs#L8-L10\r\n\r\nThis entry point is simple by design, and will be made easy to override (this part isn't done yet, but we have hand-validated that the design does work with dynamic assemblies). What was needed was the ability to optionally pass the test assembly to the `ConsoleRunner`:\r\n\r\nhttps://github.com/xunit/xunit/blob/4ad93274b31fa3e523ff9f14ef4a0ad19fcac8d7/src/xunit.v3.runner.inproc.console/ConsoleRunner.cs#L309-L322\r\n\r\nThis will allow the developer to launch the `ConsoleRunner` with any assembly from any source, including purely dynamic assemblies.\r\n\r\nIn essence, the entry point now acts as a \"front end\" for the dynamic compilation. It does whatever it needs to do to generate the test assembly, and then creates the `ConsoleRunner` to run it. Achieving this previously would've required some significant investment into creating a custom implementation of `ITestFramework` and friends so you could override the default assembly scanning behavior to discover tests, or creating your own runner which bypassed the existing runner APIs to instead directly call into `XunitTestFramework`, passing along the reference to the dynamic assembly.\r\n\r\n_Several changes were required to enable this behavior, so check out 4ad93274b31fa3e523ff9f14ef4a0ad19fcac8d7 and 540bcc14b9aae0deac7f19ad1708ec5d4816f5f1 to review them all._\r\n\r\n-----\r\n\r\nA couple notes on this change:\r\n1. If you don't pass an assembly, we continue to use the entry assembly (i.e., your unit test assembly).\r\n1. We've also added the ability to pass the list of available runner reporters, since the traditional mechanism of scanning the `*.dll` files in the same folder as the test assembly won't work when the test assembly is dynamic.","closed_by":{"login":"bradwilson","id":16944,"node_id":"MDQ6VXNlcjE2OTQ0","avatar_url":"https://avatars.githubusercontent.com/u/16944?v=4","gravatar_id":"","url":"https://api.github.com/users/bradwilson","html_url":"https://github.com/bradwilson","followers_url":"https://api.github.com/users/bradwilson/followers","following_url":"https://api.github.com/users/bradwilson/following{/other_user}","gists_url":"https://api.github.com/users/bradwilson/gists{/gist_id}","starred_url":"https://api.github.com/users/bradwilson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bradwilson/subscriptions","organizations_url":"https://api.github.com/users/bradwilson/orgs","repos_url":"https://api.github.com/users/bradwilson/repos","events_url":"https://api.github.com/users/bradwilson/events{/privacy}","received_events_url":"https://api.github.com/users/bradwilson/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/xunit/xunit/issues/2332/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/xunit/xunit/issues/2332/timeline","performed_via_github_app":null,"state_reason":"completed"}