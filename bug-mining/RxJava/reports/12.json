{"url":"https://api.github.com/repos/ReactiveX/RxJava/issues/4650","repository_url":"https://api.github.com/repos/ReactiveX/RxJava","labels_url":"https://api.github.com/repos/ReactiveX/RxJava/issues/4650/labels{/name}","comments_url":"https://api.github.com/repos/ReactiveX/RxJava/issues/4650/comments","events_url":"https://api.github.com/repos/ReactiveX/RxJava/issues/4650/events","html_url":"https://github.com/ReactiveX/RxJava/issues/4650","id":180443795,"node_id":"MDU6SXNzdWUxODA0NDM3OTU=","number":4650,"title":"2.x: Should Maybe and Single have a corresponding Transformers?","user":{"login":"ZacSweers","id":1361086,"node_id":"MDQ6VXNlcjEzNjEwODY=","avatar_url":"https://avatars.githubusercontent.com/u/1361086?v=4","gravatar_id":"","url":"https://api.github.com/users/ZacSweers","html_url":"https://github.com/ZacSweers","followers_url":"https://api.github.com/users/ZacSweers/followers","following_url":"https://api.github.com/users/ZacSweers/following{/other_user}","gists_url":"https://api.github.com/users/ZacSweers/gists{/gist_id}","starred_url":"https://api.github.com/users/ZacSweers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ZacSweers/subscriptions","organizations_url":"https://api.github.com/users/ZacSweers/orgs","repos_url":"https://api.github.com/users/ZacSweers/repos","events_url":"https://api.github.com/users/ZacSweers/events{/privacy}","received_events_url":"https://api.github.com/users/ZacSweers/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":341461319,"node_id":"MDU6TGFiZWwzNDE0NjEzMTk=","url":"https://api.github.com/repos/ReactiveX/RxJava/labels/PR%20welcome","name":"PR welcome","color":"e0e000","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2016-10-01T07:33:02Z","updated_at":"2016-10-01T08:08:53Z","closed_at":"2016-10-01T08:08:53Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Currently, `Maybe.compose()` requires a `Function<? super Maybe<T>, ? extends MaybeSource<R>>` and `Single.compose()` requires something similar\n\nWhile other types have `FlowableTransformer` and `CompletableTransformer`. Would it make sense to bring them into the same pattern? Aside from consistency, early testing for me shows that the generics gymnastics involved in `Maybe` and `Single`'s `Function` approaches is a major headache, as any parameterized stream type gets lost and requires manual specification, forfeiting the ability to  reuse APIs.\n\nConsider RxLifecycle, which historically has just returned an implementation of the required Transformer.\n\n``` java\nsomeSingle\n    .compose(RxLifecycle.bind(this).forSingle())\n    .subscribe();\n```\n\nThis works for simple unparameterized types, but breaks down when parameterized types come in.\n\n![screenshot 2016-10-01 02 21 10](https://cloud.githubusercontent.com/assets/1361086/19012563/3ac09300-877f-11e6-8886-940e45ca4572.png)\n\n``` java\n// Same result with both Single and Maybe. Screenshot is Maybe, example below is Single.\n// The type is now a List<T> of some type T\nsomeListSingle\n    .compose(Confine.to(this).forSingle())  // Compiler error because R type instance not found\n    .subscribe();\n```\n\nWhere `Confine.to` returns a bridging helper like this:\n\n``` java\npublic static class LifecycleTransformer2<T> implements FlowableTransformer<T, T> {\n\n  // Delegate transformer, what's currently returned by RxLifecycle.bind()\n  private LifecycleTransformer<T> delegate;\n\n  public static <T> LifecycleTransformer2<T> create(@NonNull LifecycleTransformer<T> delegate) {\n    return new LifecycleTransformer2<>(delegate);\n  }\n\n  private LifecycleTransformer2(@NonNull LifecycleTransformer<T> delegate) {\n    this.delegate = delegate;\n  }\n\n  public Function<Maybe<T>, MaybeSource<T>> forMaybe() {\n    return source -> {\n      Observable<T> o = toV1Observable(source.toFlowable());\n      o = delegate.call(o);\n      return RxJavaInterop.toV2Flowable(o).singleElement();\n    };\n  }\n\n  public Function<? super io.reactivex.Single<T>, ? extends SingleSource<T>> forSingle() {\n    return new Function<io.reactivex.Single<T>, SingleSource<T>>() {\n      @Override\n      public SingleSource<T> apply(io.reactivex.Single<T> source) throws Exception {\n        Single<T> o = toV1Single(source);\n        o = (Single<T>) delegate.forSingle().call((Single<Object>) o);\n        return RxJavaInterop.toV2Single(o);\n      }\n    };\n  }\n\n  public CompletableTransformer forCompletable() {\n    return source -> {\n      Completable o = toV1Completable(source);\n      o = delegate.forCompletable().call(o);\n      return RxJavaInterop.toV2Completable(o);\n    };\n  }\n\n  @Override\n  public Publisher<? extends T> apply(Flowable<T> source) throws Exception {\n    Observable<T> o = toV1Observable(source);\n    o = delegate.call(o);\n    return RxJavaInterop.toV2Flowable(o);\n  }\n}\n```\n\n`FlowableTransformer` and `CompletableTransformer` work fine, but the other two have been really tricky to nail down.\n","closed_by":{"login":"akarnokd","id":1269832,"node_id":"MDQ6VXNlcjEyNjk4MzI=","avatar_url":"https://avatars.githubusercontent.com/u/1269832?v=4","gravatar_id":"","url":"https://api.github.com/users/akarnokd","html_url":"https://github.com/akarnokd","followers_url":"https://api.github.com/users/akarnokd/followers","following_url":"https://api.github.com/users/akarnokd/following{/other_user}","gists_url":"https://api.github.com/users/akarnokd/gists{/gist_id}","starred_url":"https://api.github.com/users/akarnokd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/akarnokd/subscriptions","organizations_url":"https://api.github.com/users/akarnokd/orgs","repos_url":"https://api.github.com/users/akarnokd/repos","events_url":"https://api.github.com/users/akarnokd/events{/privacy}","received_events_url":"https://api.github.com/users/akarnokd/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/ReactiveX/RxJava/issues/4650/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/ReactiveX/RxJava/issues/4650/timeline","performed_via_github_app":null,"state_reason":"completed"}