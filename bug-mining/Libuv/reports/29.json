{"url":"https://api.github.com/repos/libuv/libuv/issues/425","repository_url":"https://api.github.com/repos/libuv/libuv","labels_url":"https://api.github.com/repos/libuv/libuv/issues/425/labels{/name}","comments_url":"https://api.github.com/repos/libuv/libuv/issues/425/comments","events_url":"https://api.github.com/repos/libuv/libuv/issues/425/events","html_url":"https://github.com/libuv/libuv/issues/425","id":93334972,"node_id":"MDU6SXNzdWU5MzMzNDk3Mg==","number":425,"title":"Sporadic SIGSEGV  in src/unix/stream.c","user":{"login":"tstellanova","id":1440229,"node_id":"MDQ6VXNlcjE0NDAyMjk=","avatar_url":"https://avatars.githubusercontent.com/u/1440229?v=4","gravatar_id":"","url":"https://api.github.com/users/tstellanova","html_url":"https://github.com/tstellanova","followers_url":"https://api.github.com/users/tstellanova/followers","following_url":"https://api.github.com/users/tstellanova/following{/other_user}","gists_url":"https://api.github.com/users/tstellanova/gists{/gist_id}","starred_url":"https://api.github.com/users/tstellanova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tstellanova/subscriptions","organizations_url":"https://api.github.com/users/tstellanova/orgs","repos_url":"https://api.github.com/users/tstellanova/repos","events_url":"https://api.github.com/users/tstellanova/events{/privacy}","received_events_url":"https://api.github.com/users/tstellanova/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":18,"created_at":"2015-07-06T17:42:29Z","updated_at":"2016-06-25T06:51:32Z","closed_at":"2015-07-07T16:15:29Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I can't provide a consistent repro case for this, but I've noticed that after some thousands of reads and writes to a TCP socket stream using libuv, I encounter a segmentation fault.  Here's the backtrace from gdb:\n\n```\nProgram received signal SIGSEGV, Segmentation fault.\n[Switching to Thread 0x7fffc67fc700 (LWP 19000)]\nuv__write (stream=0x7fffb0000a90) at src/unix/stream.c:841\n841       size_t len = buf->len;\n(gdb) bt\n#0  uv__write (stream=0x7fffb0000a90) at src/unix/stream.c:841\n#1  0x00007ffff79ae239 in uv__stream_io (loop=<optimized out>, w=0x7fffb0000b18, events=<optimized out>)\n    at src/unix/stream.c:1242\n#2  0x00007ffff79a604b in uv__run_pending (loop=0x852f28) at src/unix/core.c:710\n#3  uv_run (loop=0x852f28, mode=UV_RUN_DEFAULT) at src/unix/core.c:316\n#4  0x0000000000535a75 in ReliablePipe::run (this=0x852f20) at Pipe/ReliablePipe.cpp:231\n#5  0x000000000051b99e in BasePipe::loopInit (this=0x852f20) at Pipe/BasePipe.cpp:34\n#6  0x000000000051b831 in BasePipe::WorkerThread::run (this=0x855280) at Pipe/BasePipe.cpp:116\n#7  0x0000000000561bae in Thread::startThread (data=0x855280) at Threads/Thread.cpp:8\n#8  0x00007ffff7bc4e9a in start_thread () from /lib/x86_64-linux-gnu/libpthread.so.0\n#9  0x00007ffff58d238d in clone () from /lib/x86_64-linux-gnu/libc.so.6\n#10 0x0000000000000000 in ?? ()\n```\n\nFrom what I can, the problem is in this line:\n      uv_buf_t\\* buf = &(req->bufs[req->write_index]);\n\nIt looks like bufs is already null:\n(gdb) p req-> bufs\n$34 = (uv_buf_t *) 0x0\n\nLooking through the code, it looks like req->bufs is cleared or not cleared depending on whether write succeeds.  Is it possible I'm unintentionally ignoring some error status and causing this?\n\nThanks for any suggestions. \n","closed_by":{"login":"tstellanova","id":1440229,"node_id":"MDQ6VXNlcjE0NDAyMjk=","avatar_url":"https://avatars.githubusercontent.com/u/1440229?v=4","gravatar_id":"","url":"https://api.github.com/users/tstellanova","html_url":"https://github.com/tstellanova","followers_url":"https://api.github.com/users/tstellanova/followers","following_url":"https://api.github.com/users/tstellanova/following{/other_user}","gists_url":"https://api.github.com/users/tstellanova/gists{/gist_id}","starred_url":"https://api.github.com/users/tstellanova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tstellanova/subscriptions","organizations_url":"https://api.github.com/users/tstellanova/orgs","repos_url":"https://api.github.com/users/tstellanova/repos","events_url":"https://api.github.com/users/tstellanova/events{/privacy}","received_events_url":"https://api.github.com/users/tstellanova/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/libuv/libuv/issues/425/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/libuv/libuv/issues/425/timeline","performed_via_github_app":null,"state_reason":"completed"}