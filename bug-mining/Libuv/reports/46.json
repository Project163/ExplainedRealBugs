{"url":"https://api.github.com/repos/libuv/libuv/issues/754","repository_url":"https://api.github.com/repos/libuv/libuv","labels_url":"https://api.github.com/repos/libuv/libuv/issues/754/labels{/name}","comments_url":"https://api.github.com/repos/libuv/libuv/issues/754/comments","events_url":"https://api.github.com/repos/libuv/libuv/issues/754/events","html_url":"https://github.com/libuv/libuv/issues/754","id":139205712,"node_id":"MDU6SXNzdWUxMzkyMDU3MTI=","number":754,"title":"after QUEUE_ADD(h, n) , then call QUEUE_FOREACH will infinitely loop ","user":{"login":"paulran","id":3230950,"node_id":"MDQ6VXNlcjMyMzA5NTA=","avatar_url":"https://avatars.githubusercontent.com/u/3230950?v=4","gravatar_id":"","url":"https://api.github.com/users/paulran","html_url":"https://github.com/paulran","followers_url":"https://api.github.com/users/paulran/followers","following_url":"https://api.github.com/users/paulran/following{/other_user}","gists_url":"https://api.github.com/users/paulran/gists{/gist_id}","starred_url":"https://api.github.com/users/paulran/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/paulran/subscriptions","organizations_url":"https://api.github.com/users/paulran/orgs","repos_url":"https://api.github.com/users/paulran/repos","events_url":"https://api.github.com/users/paulran/events{/privacy}","received_events_url":"https://api.github.com/users/paulran/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2016-03-08T07:46:38Z","updated_at":"2016-03-08T08:24:29Z","closed_at":"2016-03-08T08:24:29Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## wq_test.c\n\n```\n#include \"queue.h\"\n#include <stdio.h>\n\nstruct uv__work {\n  int id;\n  void* wq[2];\n};\n\n#define QUEUE_DATA(ptr, type, field) \\\n  ((type *) ((char *) (ptr) - offsetof(type, field)))\n\n\nstatic QUEUE wq;\n\nint main()\n{\n    struct uv__work *pw;\n    QUEUE* q;\n\n    QUEUE_INIT(&wq);\n\n    struct uv__work  w1;\n    w1.id = 1;\n    QUEUE_INSERT_TAIL(&wq, &w1.wq);\n\n    struct uv__work w2;\n    w2.id = 2;\n    QUEUE_INSERT_TAIL(&wq, &w2.wq);\n\n    struct uv__work w3;\n    w3.id = 3;\n    QUEUE_INSERT_TAIL(&wq, &w3.wq);\n\n\n    QUEUE_FOREACH(q, &wq)\n    {\n        pw = QUEUE_DATA(q, uv__work, wq);\n        printf(\"queue wq data is %d.\\n\", pw->id);\n    }\n    printf(\"-----------------------------\\n\");\n\n    QUEUE wq2;\n    QUEUE_INIT(&wq2);\n\n    struct uv__work w4;\n    w4.id = 4;\n    QUEUE_INSERT_TAIL(&wq2, &w4.wq);\n\n    QUEUE_FOREACH(q, &wq2)\n    {\n        pw = QUEUE_DATA(q, uv__work, wq);\n        printf(\"queue wq2 data is %d.\\n\", pw->id);\n    }\n    printf(\"-----------------------------\\n\");\n\n\n    QUEUE_ADD(&wq, &wq2); // add\n\n    QUEUE_FOREACH(q, &wq)\n    {\n        pw = QUEUE_DATA(q, uv__work, wq);\n        printf(\"queue wq data is %d.\\n\", pw->id);\n    }\n    printf(\"-----------------------------\\n\");\n\n    QUEUE_FOREACH(q, &wq2)\n    {\n        pw = QUEUE_DATA(q, uv__work, wq);\n        printf(\"queue wq2 data is %d.\\n\", pw->id);\n    }\n    printf(\"-----------------------------\\n\");\n\n    return 0;\n}\n```\n\nThe program output:\n\n```\nqueue wq data is 1.\nqueue wq data is 2.\nqueue wq data is 3.\n-----------------------------\nqueue wq2 data is 4.\n-----------------------------\nqueue wq data is 1.\nqueue wq data is 2.\nqueue wq data is 3.\nqueue wq data is 4.\n-----------------------------\nqueue wq2 data is 4.\nqueue wq2 data is 0.\nqueue wq2 data is 1.\nqueue wq2 data is 2.\nqueue wq2 data is 3.\nqueue wq2 data is 4.\nqueue wq2 data is 0.\nqueue wq2 data is 1.\nqueue wq2 data is 2.\n........\n```\n","closed_by":{"login":"saghul","id":317464,"node_id":"MDQ6VXNlcjMxNzQ2NA==","avatar_url":"https://avatars.githubusercontent.com/u/317464?v=4","gravatar_id":"","url":"https://api.github.com/users/saghul","html_url":"https://github.com/saghul","followers_url":"https://api.github.com/users/saghul/followers","following_url":"https://api.github.com/users/saghul/following{/other_user}","gists_url":"https://api.github.com/users/saghul/gists{/gist_id}","starred_url":"https://api.github.com/users/saghul/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/saghul/subscriptions","organizations_url":"https://api.github.com/users/saghul/orgs","repos_url":"https://api.github.com/users/saghul/repos","events_url":"https://api.github.com/users/saghul/events{/privacy}","received_events_url":"https://api.github.com/users/saghul/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/libuv/libuv/issues/754/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/libuv/libuv/issues/754/timeline","performed_via_github_app":null,"state_reason":"completed"}