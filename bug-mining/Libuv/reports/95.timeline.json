[{"url":"https://api.github.com/repos/libuv/libuv/issues/comments/1037122995","html_url":"https://github.com/libuv/libuv/issues/3469#issuecomment-1037122995","issue_url":"https://api.github.com/repos/libuv/libuv/issues/3469","id":1037122995,"node_id":"IC_kwDOAOIGQ8490T2z","user":{"login":"bnoordhuis","id":275871,"node_id":"MDQ6VXNlcjI3NTg3MQ==","avatar_url":"https://avatars.githubusercontent.com/u/275871?v=4","gravatar_id":"","url":"https://api.github.com/users/bnoordhuis","html_url":"https://github.com/bnoordhuis","followers_url":"https://api.github.com/users/bnoordhuis/followers","following_url":"https://api.github.com/users/bnoordhuis/following{/other_user}","gists_url":"https://api.github.com/users/bnoordhuis/gists{/gist_id}","starred_url":"https://api.github.com/users/bnoordhuis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bnoordhuis/subscriptions","organizations_url":"https://api.github.com/users/bnoordhuis/orgs","repos_url":"https://api.github.com/users/bnoordhuis/repos","events_url":"https://api.github.com/users/bnoordhuis/events{/privacy}","received_events_url":"https://api.github.com/users/bnoordhuis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-12T10:39:45Z","updated_at":"2022-02-12T10:39:45Z","body":"Your analysis sounds right. Does this diff fix the flakiness?\r\n```diff\r\ndiff --git a/test/test-ipc-send-recv.c b/test/test-ipc-send-recv.c\r\nindex 12d4e332..18e8d2e2 100644\r\n--- a/test/test-ipc-send-recv.c\r\n+++ b/test/test-ipc-send-recv.c\r\n@@ -309,7 +309,9 @@ static void read_cb(uv_stream_t* handle,\r\n   }\r\n \r\n   pipe = (uv_pipe_t*) handle;\r\n-  do {\r\n+  ASSERT_EQ(pipe, &ctx2.channel);\r\n+\r\n+  while (uv_pipe_pending_count(pipe) > 0) {\r\n     if (++read_cb_count == 2) {\r\n       recv = &ctx2.recv;\r\n       write_req = &ctx2.write_req;\r\n@@ -318,10 +320,6 @@ static void read_cb(uv_stream_t* handle,\r\n       write_req = &ctx2.write_req2;\r\n     }\r\n \r\n-    ASSERT(pipe == &ctx2.channel);\r\n-    ASSERT(nread >= 0);\r\n-    ASSERT(uv_pipe_pending_count(pipe) > 0);\r\n-\r\n     pending = uv_pipe_pending_type(pipe);\r\n     ASSERT(pending == UV_NAMED_PIPE || pending == UV_TCP);\r\n \r\n@@ -344,7 +342,7 @@ static void read_cb(uv_stream_t* handle,\r\n                   &recv->stream,\r\n                   write2_cb);\r\n     ASSERT(r == 0);\r\n-  } while (uv_pipe_pending_count(pipe) > 0);\r\n+  }\r\n }\r\n \r\n static void send_recv_start(void) {\r\n```\r\nThere are probably more places in the test suite where we don't anticipate `nread == 0`.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/libuv/libuv/issues/comments/1037122995/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"bnoordhuis","id":275871,"node_id":"MDQ6VXNlcjI3NTg3MQ==","avatar_url":"https://avatars.githubusercontent.com/u/275871?v=4","gravatar_id":"","url":"https://api.github.com/users/bnoordhuis","html_url":"https://github.com/bnoordhuis","followers_url":"https://api.github.com/users/bnoordhuis/followers","following_url":"https://api.github.com/users/bnoordhuis/following{/other_user}","gists_url":"https://api.github.com/users/bnoordhuis/gists{/gist_id}","starred_url":"https://api.github.com/users/bnoordhuis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bnoordhuis/subscriptions","organizations_url":"https://api.github.com/users/bnoordhuis/orgs","repos_url":"https://api.github.com/users/bnoordhuis/repos","events_url":"https://api.github.com/users/bnoordhuis/events{/privacy}","received_events_url":"https://api.github.com/users/bnoordhuis/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/libuv/libuv/issues/comments/1039346098","html_url":"https://github.com/libuv/libuv/issues/3469#issuecomment-1039346098","issue_url":"https://api.github.com/repos/libuv/libuv/issues/3469","id":1039346098,"node_id":"IC_kwDOAOIGQ8498ymy","user":{"login":"alls0rts","id":3480847,"node_id":"MDQ6VXNlcjM0ODA4NDc=","avatar_url":"https://avatars.githubusercontent.com/u/3480847?v=4","gravatar_id":"","url":"https://api.github.com/users/alls0rts","html_url":"https://github.com/alls0rts","followers_url":"https://api.github.com/users/alls0rts/followers","following_url":"https://api.github.com/users/alls0rts/following{/other_user}","gists_url":"https://api.github.com/users/alls0rts/gists{/gist_id}","starred_url":"https://api.github.com/users/alls0rts/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alls0rts/subscriptions","organizations_url":"https://api.github.com/users/alls0rts/orgs","repos_url":"https://api.github.com/users/alls0rts/repos","events_url":"https://api.github.com/users/alls0rts/events{/privacy}","received_events_url":"https://api.github.com/users/alls0rts/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-14T17:18:39Z","updated_at":"2022-02-14T17:18:39Z","body":"Thanks for confirmation.  I applied your patch and confirm it does \naddress the issue.\n\nRan the test through a couple of thousand times and no errors seen.\n\n```$ rm -f log;e=0;for ((i=1; i<2000; i++)) do;  ./run-tests \nipc_send_recv_pipe 2>&1 >> log || (( e++ )); done; print $e\n0\n$\n```\n\n--\nStace\n\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/libuv/libuv/issues/comments/1039346098/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"alls0rts","id":3480847,"node_id":"MDQ6VXNlcjM0ODA4NDc=","avatar_url":"https://avatars.githubusercontent.com/u/3480847?v=4","gravatar_id":"","url":"https://api.github.com/users/alls0rts","html_url":"https://github.com/alls0rts","followers_url":"https://api.github.com/users/alls0rts/followers","following_url":"https://api.github.com/users/alls0rts/following{/other_user}","gists_url":"https://api.github.com/users/alls0rts/gists{/gist_id}","starred_url":"https://api.github.com/users/alls0rts/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alls0rts/subscriptions","organizations_url":"https://api.github.com/users/alls0rts/orgs","repos_url":"https://api.github.com/users/alls0rts/repos","events_url":"https://api.github.com/users/alls0rts/events{/privacy}","received_events_url":"https://api.github.com/users/alls0rts/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":6073860830,"node_id":"REFE_lADOAOIGQ85DYgUpzwAAAAFqB8Le","url":"https://api.github.com/repos/libuv/libuv/issues/events/6073860830","actor":{"login":"bnoordhuis","id":275871,"node_id":"MDQ6VXNlcjI3NTg3MQ==","avatar_url":"https://avatars.githubusercontent.com/u/275871?v=4","gravatar_id":"","url":"https://api.github.com/users/bnoordhuis","html_url":"https://github.com/bnoordhuis","followers_url":"https://api.github.com/users/bnoordhuis/followers","following_url":"https://api.github.com/users/bnoordhuis/following{/other_user}","gists_url":"https://api.github.com/users/bnoordhuis/gists{/gist_id}","starred_url":"https://api.github.com/users/bnoordhuis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bnoordhuis/subscriptions","organizations_url":"https://api.github.com/users/bnoordhuis/orgs","repos_url":"https://api.github.com/users/bnoordhuis/repos","events_url":"https://api.github.com/users/bnoordhuis/events{/privacy}","received_events_url":"https://api.github.com/users/bnoordhuis/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"3bf1bf77caf0ca6486451d59be9a45702521d700","commit_url":"https://api.github.com/repos/bnoordhuis/libuv/commits/3bf1bf77caf0ca6486451d59be9a45702521d700","created_at":"2022-02-15T10:41:34Z","performed_via_github_app":null},{"actor":{"login":"bnoordhuis","id":275871,"node_id":"MDQ6VXNlcjI3NTg3MQ==","avatar_url":"https://avatars.githubusercontent.com/u/275871?v=4","gravatar_id":"","url":"https://api.github.com/users/bnoordhuis","html_url":"https://github.com/bnoordhuis","followers_url":"https://api.github.com/users/bnoordhuis/followers","following_url":"https://api.github.com/users/bnoordhuis/following{/other_user}","gists_url":"https://api.github.com/users/bnoordhuis/gists{/gist_id}","starred_url":"https://api.github.com/users/bnoordhuis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bnoordhuis/subscriptions","organizations_url":"https://api.github.com/users/bnoordhuis/orgs","repos_url":"https://api.github.com/users/bnoordhuis/repos","events_url":"https://api.github.com/users/bnoordhuis/events{/privacy}","received_events_url":"https://api.github.com/users/bnoordhuis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-15T10:41:49Z","updated_at":"2022-02-15T10:41:49Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/libuv/libuv/issues/3478","repository_url":"https://api.github.com/repos/libuv/libuv","labels_url":"https://api.github.com/repos/libuv/libuv/issues/3478/labels{/name}","comments_url":"https://api.github.com/repos/libuv/libuv/issues/3478/comments","events_url":"https://api.github.com/repos/libuv/libuv/issues/3478/events","html_url":"https://github.com/libuv/libuv/pull/3478","id":1138503895,"node_id":"PR_kwDOAOIGQ84y2Upw","number":3478,"title":"test: fix ipc_send_recv_pipe flakiness","user":{"login":"bnoordhuis","id":275871,"node_id":"MDQ6VXNlcjI3NTg3MQ==","avatar_url":"https://avatars.githubusercontent.com/u/275871?v=4","gravatar_id":"","url":"https://api.github.com/users/bnoordhuis","html_url":"https://github.com/bnoordhuis","followers_url":"https://api.github.com/users/bnoordhuis/followers","following_url":"https://api.github.com/users/bnoordhuis/following{/other_user}","gists_url":"https://api.github.com/users/bnoordhuis/gists{/gist_id}","starred_url":"https://api.github.com/users/bnoordhuis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bnoordhuis/subscriptions","organizations_url":"https://api.github.com/users/bnoordhuis/orgs","repos_url":"https://api.github.com/users/bnoordhuis/repos","events_url":"https://api.github.com/users/bnoordhuis/events{/privacy}","received_events_url":"https://api.github.com/users/bnoordhuis/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-02-15T10:41:49Z","updated_at":"2022-02-20T11:17:16Z","closed_at":"2022-02-20T11:17:14Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":14812739,"node_id":"MDEwOlJlcG9zaXRvcnkxNDgxMjczOQ==","name":"libuv","full_name":"libuv/libuv","private":false,"owner":{"login":"libuv","id":4030929,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQwMzA5Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/4030929?v=4","gravatar_id":"","url":"https://api.github.com/users/libuv","html_url":"https://github.com/libuv","followers_url":"https://api.github.com/users/libuv/followers","following_url":"https://api.github.com/users/libuv/following{/other_user}","gists_url":"https://api.github.com/users/libuv/gists{/gist_id}","starred_url":"https://api.github.com/users/libuv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/libuv/subscriptions","organizations_url":"https://api.github.com/users/libuv/orgs","repos_url":"https://api.github.com/users/libuv/repos","events_url":"https://api.github.com/users/libuv/events{/privacy}","received_events_url":"https://api.github.com/users/libuv/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/libuv/libuv","description":"Cross-platform asynchronous I/O","fork":false,"url":"https://api.github.com/repos/libuv/libuv","forks_url":"https://api.github.com/repos/libuv/libuv/forks","keys_url":"https://api.github.com/repos/libuv/libuv/keys{/key_id}","collaborators_url":"https://api.github.com/repos/libuv/libuv/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/libuv/libuv/teams","hooks_url":"https://api.github.com/repos/libuv/libuv/hooks","issue_events_url":"https://api.github.com/repos/libuv/libuv/issues/events{/number}","events_url":"https://api.github.com/repos/libuv/libuv/events","assignees_url":"https://api.github.com/repos/libuv/libuv/assignees{/user}","branches_url":"https://api.github.com/repos/libuv/libuv/branches{/branch}","tags_url":"https://api.github.com/repos/libuv/libuv/tags","blobs_url":"https://api.github.com/repos/libuv/libuv/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/libuv/libuv/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/libuv/libuv/git/refs{/sha}","trees_url":"https://api.github.com/repos/libuv/libuv/git/trees{/sha}","statuses_url":"https://api.github.com/repos/libuv/libuv/statuses/{sha}","languages_url":"https://api.github.com/repos/libuv/libuv/languages","stargazers_url":"https://api.github.com/repos/libuv/libuv/stargazers","contributors_url":"https://api.github.com/repos/libuv/libuv/contributors","subscribers_url":"https://api.github.com/repos/libuv/libuv/subscribers","subscription_url":"https://api.github.com/repos/libuv/libuv/subscription","commits_url":"https://api.github.com/repos/libuv/libuv/commits{/sha}","git_commits_url":"https://api.github.com/repos/libuv/libuv/git/commits{/sha}","comments_url":"https://api.github.com/repos/libuv/libuv/comments{/number}","issue_comment_url":"https://api.github.com/repos/libuv/libuv/issues/comments{/number}","contents_url":"https://api.github.com/repos/libuv/libuv/contents/{+path}","compare_url":"https://api.github.com/repos/libuv/libuv/compare/{base}...{head}","merges_url":"https://api.github.com/repos/libuv/libuv/merges","archive_url":"https://api.github.com/repos/libuv/libuv/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/libuv/libuv/downloads","issues_url":"https://api.github.com/repos/libuv/libuv/issues{/number}","pulls_url":"https://api.github.com/repos/libuv/libuv/pulls{/number}","milestones_url":"https://api.github.com/repos/libuv/libuv/milestones{/number}","notifications_url":"https://api.github.com/repos/libuv/libuv/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/libuv/libuv/labels{/name}","releases_url":"https://api.github.com/repos/libuv/libuv/releases{/id}","deployments_url":"https://api.github.com/repos/libuv/libuv/deployments","created_at":"2013-11-30T00:29:56Z","updated_at":"2025-11-10T12:47:39Z","pushed_at":"2025-11-06T21:34:45Z","git_url":"git://github.com/libuv/libuv.git","ssh_url":"git@github.com:libuv/libuv.git","clone_url":"https://github.com/libuv/libuv.git","svn_url":"https://github.com/libuv/libuv","homepage":"https://libuv.org/","size":16928,"stargazers_count":26166,"watchers_count":26166,"language":"C","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":3784,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":205,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["asynchronous","deep-io","io","networking","unicorns","unix","velociraptors","windows"],"visibility":"public","forks":3784,"open_issues":205,"watchers":26166,"default_branch":"v1.x","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/libuv/libuv/pulls/3478","html_url":"https://github.com/libuv/libuv/pull/3478","diff_url":"https://github.com/libuv/libuv/pull/3478.diff","patch_url":"https://github.com/libuv/libuv/pull/3478.patch","merged_at":"2022-02-20T11:17:13Z"},"body":"The read callback failed to handle the `nread == 0` case, which is rare\r\nto non-existent on the systems we test on but apparently happens often\r\nenough on Solaris on SPARC to draw attention.\r\n\r\nFixes #3469.","reactions":{"url":"https://api.github.com/repos/libuv/libuv/issues/3478/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/libuv/libuv/issues/3478/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":6107057462,"node_id":"REFE_lADOAOIGQ85DYgUpzwAAAAFsAk02","url":"https://api.github.com/repos/libuv/libuv/issues/events/6107057462","actor":{"login":"bnoordhuis","id":275871,"node_id":"MDQ6VXNlcjI3NTg3MQ==","avatar_url":"https://avatars.githubusercontent.com/u/275871?v=4","gravatar_id":"","url":"https://api.github.com/users/bnoordhuis","html_url":"https://github.com/bnoordhuis","followers_url":"https://api.github.com/users/bnoordhuis/followers","following_url":"https://api.github.com/users/bnoordhuis/following{/other_user}","gists_url":"https://api.github.com/users/bnoordhuis/gists{/gist_id}","starred_url":"https://api.github.com/users/bnoordhuis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bnoordhuis/subscriptions","organizations_url":"https://api.github.com/users/bnoordhuis/orgs","repos_url":"https://api.github.com/users/bnoordhuis/repos","events_url":"https://api.github.com/users/bnoordhuis/events{/privacy}","received_events_url":"https://api.github.com/users/bnoordhuis/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"bf3b7bf68c10cf2f29cbe216a1e99ec7b0f79b00","commit_url":"https://api.github.com/repos/bnoordhuis/libuv/commits/bf3b7bf68c10cf2f29cbe216a1e99ec7b0f79b00","created_at":"2022-02-20T10:38:31Z","performed_via_github_app":null},{"id":6107098736,"node_id":"CE_lADOAOIGQ85DYgUpzwAAAAFsAu5w","url":"https://api.github.com/repos/libuv/libuv/issues/events/6107098736","actor":{"login":"bnoordhuis","id":275871,"node_id":"MDQ6VXNlcjI3NTg3MQ==","avatar_url":"https://avatars.githubusercontent.com/u/275871?v=4","gravatar_id":"","url":"https://api.github.com/users/bnoordhuis","html_url":"https://github.com/bnoordhuis","followers_url":"https://api.github.com/users/bnoordhuis/followers","following_url":"https://api.github.com/users/bnoordhuis/following{/other_user}","gists_url":"https://api.github.com/users/bnoordhuis/gists{/gist_id}","starred_url":"https://api.github.com/users/bnoordhuis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bnoordhuis/subscriptions","organizations_url":"https://api.github.com/users/bnoordhuis/orgs","repos_url":"https://api.github.com/users/bnoordhuis/repos","events_url":"https://api.github.com/users/bnoordhuis/events{/privacy}","received_events_url":"https://api.github.com/users/bnoordhuis/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2022-02-20T11:17:14Z","state_reason":null,"performed_via_github_app":null},{"id":6107098815,"node_id":"REFE_lADOAOIGQ85DYgUpzwAAAAFsAu6_","url":"https://api.github.com/repos/libuv/libuv/issues/events/6107098815","actor":{"login":"bnoordhuis","id":275871,"node_id":"MDQ6VXNlcjI3NTg3MQ==","avatar_url":"https://avatars.githubusercontent.com/u/275871?v=4","gravatar_id":"","url":"https://api.github.com/users/bnoordhuis","html_url":"https://github.com/bnoordhuis","followers_url":"https://api.github.com/users/bnoordhuis/followers","following_url":"https://api.github.com/users/bnoordhuis/following{/other_user}","gists_url":"https://api.github.com/users/bnoordhuis/gists{/gist_id}","starred_url":"https://api.github.com/users/bnoordhuis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bnoordhuis/subscriptions","organizations_url":"https://api.github.com/users/bnoordhuis/orgs","repos_url":"https://api.github.com/users/bnoordhuis/repos","events_url":"https://api.github.com/users/bnoordhuis/events{/privacy}","received_events_url":"https://api.github.com/users/bnoordhuis/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"e0a5f58d2cb698f5fa2a7a3bff4fb55c4e1f3449","commit_url":"https://api.github.com/repos/libuv/libuv/commits/e0a5f58d2cb698f5fa2a7a3bff4fb55c4e1f3449","created_at":"2022-02-20T11:17:18Z","performed_via_github_app":null},{"id":6615474886,"node_id":"REFE_lADOAOIGQ85DYgUpzwAAAAGKUCLG","url":"https://api.github.com/repos/libuv/libuv/issues/events/6615474886","actor":{"login":"JeffroMF","id":62365188,"node_id":"MDQ6VXNlcjYyMzY1MTg4","avatar_url":"https://avatars.githubusercontent.com/u/62365188?v=4","gravatar_id":"","url":"https://api.github.com/users/JeffroMF","html_url":"https://github.com/JeffroMF","followers_url":"https://api.github.com/users/JeffroMF/followers","following_url":"https://api.github.com/users/JeffroMF/following{/other_user}","gists_url":"https://api.github.com/users/JeffroMF/gists{/gist_id}","starred_url":"https://api.github.com/users/JeffroMF/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JeffroMF/subscriptions","organizations_url":"https://api.github.com/users/JeffroMF/orgs","repos_url":"https://api.github.com/users/JeffroMF/repos","events_url":"https://api.github.com/users/JeffroMF/events{/privacy}","received_events_url":"https://api.github.com/users/JeffroMF/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"80343679ef74eebb6d58cfca1e906ff800f13102","commit_url":"https://api.github.com/repos/JeffroMF/libuv/commits/80343679ef74eebb6d58cfca1e906ff800f13102","created_at":"2022-05-16T11:56:03Z","performed_via_github_app":null}]