{"url":"https://api.github.com/repos/libuv/libuv/issues/1252","repository_url":"https://api.github.com/repos/libuv/libuv","labels_url":"https://api.github.com/repos/libuv/libuv/issues/1252/labels{/name}","comments_url":"https://api.github.com/repos/libuv/libuv/issues/1252/comments","events_url":"https://api.github.com/repos/libuv/libuv/issues/1252/events","html_url":"https://github.com/libuv/libuv/issues/1252","id":214537590,"node_id":"MDU6SXNzdWUyMTQ1Mzc1OTA=","number":1252,"title":"uv__loops_init allocates memory which cannot be freed","user":{"login":"gaspardpetit","id":9883156,"node_id":"MDQ6VXNlcjk4ODMxNTY=","avatar_url":"https://avatars.githubusercontent.com/u/9883156?v=4","gravatar_id":"","url":"https://api.github.com/users/gaspardpetit","html_url":"https://github.com/gaspardpetit","followers_url":"https://api.github.com/users/gaspardpetit/followers","following_url":"https://api.github.com/users/gaspardpetit/following{/other_user}","gists_url":"https://api.github.com/users/gaspardpetit/gists{/gist_id}","starred_url":"https://api.github.com/users/gaspardpetit/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gaspardpetit/subscriptions","organizations_url":"https://api.github.com/users/gaspardpetit/orgs","repos_url":"https://api.github.com/users/gaspardpetit/repos","events_url":"https://api.github.com/users/gaspardpetit/events{/privacy}","received_events_url":"https://api.github.com/users/gaspardpetit/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":158970478,"node_id":"MDU6TGFiZWwxNTg5NzA0Nzg=","url":"https://api.github.com/repos/libuv/libuv/labels/windows","name":"windows","color":"ab378b","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2017-03-15T21:52:47Z","updated_at":"2017-03-21T14:31:58Z","closed_at":"2017-03-21T14:31:58Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"On Windows, changelist https://github.com/libuv/libuv/commit/6fa3524ea7ad8d54ce733a6e7da283701c9c06fc introduced a dynamic allocation to keep track of uv_loops.  Unfortunately, libuv provides no mechanism to free this memory and it causes my unit tests to fail because they detect a memory leak.  \r\n\r\nI would like to provide a pull request where either: \r\n\r\n - uv__loops_remove deallocates the uv__loops structure when the last loop is closed.  Then, of course, when a new loop is created, uv_loop_init should check if the structure is allocated and allocates it if necessary.  There would be a little bit of extra overhead, but considering that creating/closing loops is no something that gets done very often, I don't think it's a concern;\r\n - alternatively, I would add a uv_loops_cleanup which frees the memory and resets the global variables in such a way that the uv_once will be executed again.  The client application could then explicitly call this function to cleanup libuv.\r\n\r\nI believe the first option is more sensible.  Let me know if such pull request would make it to the master branch.","closed_by":{"login":"cjihrig","id":2512748,"node_id":"MDQ6VXNlcjI1MTI3NDg=","avatar_url":"https://avatars.githubusercontent.com/u/2512748?v=4","gravatar_id":"","url":"https://api.github.com/users/cjihrig","html_url":"https://github.com/cjihrig","followers_url":"https://api.github.com/users/cjihrig/followers","following_url":"https://api.github.com/users/cjihrig/following{/other_user}","gists_url":"https://api.github.com/users/cjihrig/gists{/gist_id}","starred_url":"https://api.github.com/users/cjihrig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cjihrig/subscriptions","organizations_url":"https://api.github.com/users/cjihrig/orgs","repos_url":"https://api.github.com/users/cjihrig/repos","events_url":"https://api.github.com/users/cjihrig/events{/privacy}","received_events_url":"https://api.github.com/users/cjihrig/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/libuv/libuv/issues/1252/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/libuv/libuv/issues/1252/timeline","performed_via_github_app":null,"state_reason":"completed"}