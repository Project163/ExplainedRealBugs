{"url":"https://api.github.com/repos/libuv/libuv/issues/1507","repository_url":"https://api.github.com/repos/libuv/libuv","labels_url":"https://api.github.com/repos/libuv/libuv/issues/1507/labels{/name}","comments_url":"https://api.github.com/repos/libuv/libuv/issues/1507/comments","events_url":"https://api.github.com/repos/libuv/libuv/issues/1507/events","html_url":"https://github.com/libuv/libuv/issues/1507","id":252190145,"node_id":"MDU6SXNzdWUyNTIxOTAxNDU=","number":1507,"title":"Increase thread stack size on musl systems","user":{"login":"santigimeno","id":1084056,"node_id":"MDQ6VXNlcjEwODQwNTY=","avatar_url":"https://avatars.githubusercontent.com/u/1084056?v=4","gravatar_id":"","url":"https://api.github.com/users/santigimeno","html_url":"https://github.com/santigimeno","followers_url":"https://api.github.com/users/santigimeno/followers","following_url":"https://api.github.com/users/santigimeno/following{/other_user}","gists_url":"https://api.github.com/users/santigimeno/gists{/gist_id}","starred_url":"https://api.github.com/users/santigimeno/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/santigimeno/subscriptions","organizations_url":"https://api.github.com/users/santigimeno/orgs","repos_url":"https://api.github.com/users/santigimeno/repos","events_url":"https://api.github.com/users/santigimeno/events{/privacy}","received_events_url":"https://api.github.com/users/santigimeno/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2017-08-23T07:46:23Z","updated_at":"2021-01-21T09:42:03Z","closed_at":"2017-09-25T20:24:13Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Reported on IRC:\r\n\r\n```\r\n<timotimo> greetings\r\n<timotimo> we're having a trouble with alpine linux drastically reducing the stack size of additional threads created\r\n<timotimo> (we the perl6 devs)\r\n<timotimo> there's already a piece of code in libuv that makes sure threads get the RLIMIT_STACK on mac osx, but i don't see any way to ask libuv to build a bigger stack for newly created threads\r\n```\r\n\r\nAccording to [this](http://wiki.musl-libc.org/wiki/Functional_differences_from_glibc#Thread_stack_size):\r\n\r\n> musl provides a default stack size of 80k. This does not include the guard page, nor does it include the space used for TLS unless total TLS size is very small. So the actual map size may appear closer to 90k, with around 80k usable by the application. This size was determined empirically with the goals of not gratuitously breaking applications but also not causing large amounts of memory and virtual address space to be committed in programs with large numbers of threads. Programs needing larger stacks, or which explicitly want a smaller stack, should make this explicit with pthread_attr_setstacksize. For largely unrestrained use of the standard library, a minimum of 12k is recommended, but stack sizes down to 2k are allowed. \r\n\r\nSo probably it's a good idea to increase the thread stack size to `RLIMIT_STACK`  as we do for `OS X`.","closed_by":{"login":"bnoordhuis","id":275871,"node_id":"MDQ6VXNlcjI3NTg3MQ==","avatar_url":"https://avatars.githubusercontent.com/u/275871?v=4","gravatar_id":"","url":"https://api.github.com/users/bnoordhuis","html_url":"https://github.com/bnoordhuis","followers_url":"https://api.github.com/users/bnoordhuis/followers","following_url":"https://api.github.com/users/bnoordhuis/following{/other_user}","gists_url":"https://api.github.com/users/bnoordhuis/gists{/gist_id}","starred_url":"https://api.github.com/users/bnoordhuis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bnoordhuis/subscriptions","organizations_url":"https://api.github.com/users/bnoordhuis/orgs","repos_url":"https://api.github.com/users/bnoordhuis/repos","events_url":"https://api.github.com/users/bnoordhuis/events{/privacy}","received_events_url":"https://api.github.com/users/bnoordhuis/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/libuv/libuv/issues/1507/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/libuv/libuv/issues/1507/timeline","performed_via_github_app":null,"state_reason":"completed"}