{"url":"https://api.github.com/repos/libuv/libuv/issues/131","repository_url":"https://api.github.com/repos/libuv/libuv","labels_url":"https://api.github.com/repos/libuv/libuv/issues/131/labels{/name}","comments_url":"https://api.github.com/repos/libuv/libuv/issues/131/comments","events_url":"https://api.github.com/repos/libuv/libuv/issues/131/events","html_url":"https://github.com/libuv/libuv/issues/131","id":54045302,"node_id":"MDU6SXNzdWU1NDA0NTMwMg==","number":131,"title":"uv_tty_set_mode regression (v1.2.0, unix)","user":{"login":"TomCrypto","id":1861870,"node_id":"MDQ6VXNlcjE4NjE4NzA=","avatar_url":"https://avatars.githubusercontent.com/u/1861870?v=4","gravatar_id":"","url":"https://api.github.com/users/TomCrypto","html_url":"https://github.com/TomCrypto","followers_url":"https://api.github.com/users/TomCrypto/followers","following_url":"https://api.github.com/users/TomCrypto/following{/other_user}","gists_url":"https://api.github.com/users/TomCrypto/gists{/gist_id}","starred_url":"https://api.github.com/users/TomCrypto/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TomCrypto/subscriptions","organizations_url":"https://api.github.com/users/TomCrypto/orgs","repos_url":"https://api.github.com/users/TomCrypto/repos","events_url":"https://api.github.com/users/TomCrypto/events{/privacy}","received_events_url":"https://api.github.com/users/TomCrypto/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2015-01-12T11:52:35Z","updated_at":"2015-01-13T08:31:00Z","closed_at":"2015-01-13T08:31:00Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"In v1.1.0 we are able to create a readable `uv_tty` to stdin using:\n\n```\nuv_tty_init(loop, &tty, 0, 1);\n```\n\nAnd then set its mode to 0 (aka \"normal\") via:\n\n```\nuv_tty_set_mode(&tty, 0);\n```\n\nWhich in v1.1.0 with a clean terminal state is a no-op, as expected. In v1.2.0, this no longer works:\n\n```\nuv_tty_init(loop, &tty, 0, 1);\nuv_tty_set_mode(&tty, UV_TTY_MODE_NORMAL);\n```\n\nThis causes the terminal state to become corrupt on Linux. It seems to occur because in that particular case the tty's `orig_termios` member is not initialized by a previous call to `uv_tty_set_mode` with a non-normal mode, yet a `tcsetattr` call is performed with it at the end, happily corrupting the terminal state and then returning success. The logic of v1.1.0's `uv_tty_set_mode` implementation at `src/unix/tty.c` avoided this.\n\nNow I realise setting the tty mode to normal is kind of redundant in this case (or is it? it's not clear to me whether a mode _must_ be set before use or if normal is the implied default mode) but I think it is reasonable to expect `uv_tty_set_mode` to behave consistently especially in such a simple use case, and it certainly should never trash the terminal state given sensible parameters.\n\nThe commit which introduced the regression is [025602da138ec9ca908f9303427903ea1dc06494](https://github.com/libuv/libuv/commit/025602da138ec9ca908f9303427903ea1dc06494).\n","closed_by":{"login":"saghul","id":317464,"node_id":"MDQ6VXNlcjMxNzQ2NA==","avatar_url":"https://avatars.githubusercontent.com/u/317464?v=4","gravatar_id":"","url":"https://api.github.com/users/saghul","html_url":"https://github.com/saghul","followers_url":"https://api.github.com/users/saghul/followers","following_url":"https://api.github.com/users/saghul/following{/other_user}","gists_url":"https://api.github.com/users/saghul/gists{/gist_id}","starred_url":"https://api.github.com/users/saghul/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/saghul/subscriptions","organizations_url":"https://api.github.com/users/saghul/orgs","repos_url":"https://api.github.com/users/saghul/repos","events_url":"https://api.github.com/users/saghul/events{/privacy}","received_events_url":"https://api.github.com/users/saghul/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/libuv/libuv/issues/131/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/libuv/libuv/issues/131/timeline","performed_via_github_app":null,"state_reason":"completed"}