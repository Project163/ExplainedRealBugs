{"url":"https://api.github.com/repos/go-gitea/gitea/issues/31884","repository_url":"https://api.github.com/repos/go-gitea/gitea","labels_url":"https://api.github.com/repos/go-gitea/gitea/issues/31884/labels{/name}","comments_url":"https://api.github.com/repos/go-gitea/gitea/issues/31884/comments","events_url":"https://api.github.com/repos/go-gitea/gitea/issues/31884/events","html_url":"https://github.com/go-gitea/gitea/issues/31884","id":2475215361,"node_id":"I_kwDOBFIx286TiMoB","number":31884,"title":"Repeated Queue \"code_indexer\" failed to handle batch of 1 items error logs","user":{"login":"MattSG","id":20724659,"node_id":"MDQ6VXNlcjIwNzI0NjU5","avatar_url":"https://avatars.githubusercontent.com/u/20724659?v=4","gravatar_id":"","url":"https://api.github.com/users/MattSG","html_url":"https://github.com/MattSG","followers_url":"https://api.github.com/users/MattSG/followers","following_url":"https://api.github.com/users/MattSG/following{/other_user}","gists_url":"https://api.github.com/users/MattSG/gists{/gist_id}","starred_url":"https://api.github.com/users/MattSG/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MattSG/subscriptions","organizations_url":"https://api.github.com/users/MattSG/orgs","repos_url":"https://api.github.com/users/MattSG/repos","events_url":"https://api.github.com/users/MattSG/events{/privacy}","received_events_url":"https://api.github.com/users/MattSG/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":472744938,"node_id":"MDU6TGFiZWw0NzI3NDQ5Mzg=","url":"https://api.github.com/repos/go-gitea/gitea/labels/type/bug","name":"type/bug","color":"ee0701","default":false,"description":""}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2024-08-20T09:52:02Z","updated_at":"2024-12-01T02:14:59Z","closed_at":"2024-09-01T05:57:32Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description\r\n\r\nError logs appear every couple seconds constantly as app is running, appears to come with a memory leak\r\n\r\nSetting `REPO_INDEXER_ENABLED = false` stops the errors\r\n\r\n~~Unaware of RAM usage at the time on the machine but after thousands of these logs, the service appeared to stop itself without reason. The shutdown may not be related to this~~\r\n\r\nEdit: Found these logs in the event viewer that align with the time gitea stopped\r\n\r\n```\r\nWindows successfully diagnosed a low virtual memory condition. The following programs consumed the most virtual memory: gitea.exe (8476) consumed 11716718592 bytes, MsMpEng.exe (8008) consumed 459538432 bytes, and MsSense.exe (3024) consumed 256311296 bytes.\r\n```\r\n\r\n```\r\nThe gitea service terminated unexpectedly.  It has done this 1 time(s).\r\n```\r\nMaybe this is related to https://github.com/go-gitea/gitea/issues/31565?\r\n\r\n```\r\n2024/08/20 10:52:43 cmd/web.go:355:listen() [I] HTTP Listener: 0.0.0.0:3000 Closed\r\n2024/08/20 10:52:43 .../graceful/manager.go:168:doHammerTime() [W] Setting Hammer condition\r\n2024/08/20 10:52:44 .../graceful/manager.go:184:doTerminate() [W] Terminating\r\n2024/08/20 10:52:44 ...er/issues/indexer.go:120:2() [I] PID: 8940 Issue Indexer closed\r\n2024/08/20 10:52:44 ...exer/code/indexer.go:112:func1() [I] PID: 8940 Repository Indexer closed\r\n2024/08/20 10:52:44 cmd/web.go:214:serveInstalled() [I] PID: 8940 Gitea Web Finished\r\n```\r\n\r\nIndexer config\r\n```\r\n[indexer]\r\n; ...\r\nREPO_INDEXER_ENABLED = true\r\nREPO_INDEXER_PATH = indexers/repos.bleve\r\nMAX_FILE_SIZE = 1048576\r\nREPO_INDEXER_INCLUDE = \r\nREPO_INDEXER_EXCLUDE = resources/bin/**\r\n```\r\n\r\nError log:\r\n```\r\n2024/08/20 00:00:01 ...s/actions/cleanup.go:60:cleanNeedDeleteArtifacts() [I] Found 0 artifacts pending deletion\r\n2024/08/20 00:00:03 ...eb/routing/logger.go:102:func1() [I] router: completed POST /api/actions/runner.v1.RunnerService/FetchTask for 127.0.0.1:51052, 200 OK in 75.8ms @ <autogenerated>:1(http.Handler.ServeHTTP-fm)\r\n2024/08/20 00:00:03 ...exer/code/indexer.go:128:func2() [E] Codes indexer handler: index error for repo 78: fork/exec C:\\Program Files\\Git\\cmd\\git.exe: The filename or extension is too long.\r\n2024/08/20 00:00:03 ...queue/workergroup.go:107:doWorkerHandle() [E] Queue \"code_indexer\" failed to handle batch of 1 items, backoff for a few seconds\r\n2024/08/20 00:00:05 ...eb/routing/logger.go:102:func1() [I] router: completed POST /api/actions/runner.v1.RunnerService/FetchTask for 127.0.0.1:51052, 200 OK in 30.1ms @ <autogenerated>:1(http.Handler.ServeHTTP-fm)\r\n2024/08/20 00:00:07 ...eb/routing/logger.go:102:func1() [I] router: completed POST /api/actions/runner.v1.RunnerService/FetchTask for 127.0.0.1:51052, 200 OK in 28.4ms @ <autogenerated>:1(http.Handler.ServeHTTP-fm)\r\n2024/08/20 00:00:09 ...eb/routing/logger.go:102:func1() [I] router: completed POST /api/actions/runner.v1.RunnerService/FetchTask for 127.0.0.1:51052, 200 OK in 28.8ms @ <autogenerated>:1(http.Handler.ServeHTTP-fm)\r\n2024/08/20 00:00:10 ...exer/code/indexer.go:128:func2() [E] Codes indexer handler: index error for repo 78: fork/exec C:\\Program Files\\Git\\cmd\\git.exe: The filename or extension is too long.\r\n2024/08/20 00:00:10 ...queue/workergroup.go:107:doWorkerHandle() [E] Queue \"code_indexer\" failed to handle batch of 1 items, backoff for a few seconds\r\n2024/08/20 00:00:11 ...eb/routing/logger.go:102:func1() [I] router: completed POST /api/actions/runner.v1.RunnerService/FetchTask for 127.0.0.1:51052, 200 OK in 36.6ms @ <autogenerated>:1(http.Handler.ServeHTTP-fm)\r\n2024/08/20 00:00:13 ...eb/routing/logger.go:102:func1() [I] router: completed POST /api/actions/runner.v1.RunnerService/FetchTask for 127.0.0.1:51052, 200 OK in 62.5ms @ <autogenerated>:1(http.Handler.ServeHTTP-fm)\r\n2024/08/20 00:00:15 ...eb/routing/logger.go:102:func1() [I] router: completed POST /api/actions/runner.v1.RunnerService/FetchTask for 127.0.0.1:51052, 200 OK in 84.1ms @ <autogenerated>:1(http.Handler.ServeHTTP-fm)\r\n2024/08/20 00:00:17 ...eb/routing/logger.go:102:func1() [I] router: completed POST /api/actions/runner.v1.RunnerService/FetchTask for 127.0.0.1:51052, 200 OK in 58.0ms @ <autogenerated>:1(http.Handler.ServeHTTP-fm)\r\n2024/08/20 00:00:17 ...exer/code/indexer.go:128:func2() [E] Codes indexer handler: index error for repo 78: fork/exec C:\\Program Files\\Git\\cmd\\git.exe: The filename or extension is too long.\r\n2024/08/20 00:00:17 ...queue/workergroup.go:107:doWorkerHandle() [E] Queue \"code_indexer\" failed to handle batch of 1 items, backoff for a few seconds\r\n2024/08/20 00:00:19 ...eb/routing/logger.go:102:func1() [I] router: completed POST /api/actions/runner.v1.RunnerService/FetchTask for 127.0.0.1:51052, 200 OK in 312.0ms @ <autogenerated>:1(http.Handler.ServeHTTP-fm)\r\n2024/08/20 00:00:21 ...eb/routing/logger.go:102:func1() [I] router: completed POST /api/actions/runner.v1.RunnerService/FetchTask for 127.0.0.1:51052, 200 OK in 85.3ms @ <autogenerated>:1(http.Handler.ServeHTTP-fm)\r\n2024/08/20 00:00:23 ...eb/routing/logger.go:102:func1() [I] router: completed POST /api/actions/runner.v1.RunnerService/FetchTask for 127.0.0.1:51052, 200 OK in 72.6ms @ <autogenerated>:1(http.Handler.ServeHTTP-fm)\r\n2024/08/20 00:00:25 ...exer/code/indexer.go:128:func2() [E] Codes indexer handler: index error for repo 78: fork/exec C:\\Program Files\\Git\\cmd\\git.exe: The filename or extension is too long.\r\n2024/08/20 00:00:25 ...queue/workergroup.go:107:doWorkerHandle() [E] Queue \"code_indexer\" failed to handle batch of 1 items, backoff for a few seconds\r\n2024/08/20 00:00:25 ...eb/routing/logger.go:102:func1() [I] router: completed POST /api/actions/runner.v1.RunnerService/FetchTask for 127.0.0.1:51052, 200 OK in 299.5ms @ <autogenerated>:1(http.Handler.ServeHTTP-fm)\r\n2024/08/20 00:00:27 ...eb/routing/logger.go:102:func1() [I] router: completed POST /api/actions/runner.v1.RunnerService/FetchTask for 127.0.0.1:51052, 200 OK in 60.5ms @ <autogenerated>:1(http.Handler.ServeHTTP-fm)\r\n2024/08/20 00:00:30 ...eb/routing/logger.go:102:func1() [I] router: completed POST /api/actions/runner.v1.RunnerService/FetchTask for 127.0.0.1:51052, 200 OK in 1177.9ms @ <autogenerated>:1(http.Handler.ServeHTTP-fm)\r\n2024/08/20 00:00:31 ...eb/routing/logger.go:102:func1() [I] router: completed POST /api/actions/runner.v1.RunnerService/FetchTask for 127.0.0.1:51052, 200 OK in 122.9ms @ <autogenerated>:1(http.Handler.ServeHTTP-fm)\r\n2024/08/20 00:00:32 ...exer/code/indexer.go:128:func2() [E] Codes indexer handler: index error for repo 78: fork/exec C:\\Program Files\\Git\\cmd\\git.exe: The filename or extension is too long.\r\n2024/08/20 00:00:32 ...queue/workergroup.go:107:doWorkerHandle() [E] Queue \"code_indexer\" failed to handle batch of 1 items, backoff for a few seconds\r\n2024/08/20 00:00:33 ...eb/routing/logger.go:102:func1() [I] router: completed POST /api/actions/runner.v1.RunnerService/FetchTask for 127.0.0.1:51052, 200 OK in 110.7ms @ <autogenerated>:1(http.Handler.ServeHTTP-fm)\r\n2024/08/20 00:00:35 ...eb/routing/logger.go:102:func1() [I] router: completed POST /api/actions/runner.v1.RunnerService/FetchTask for 127.0.0.1:51052, 200 OK in 639.7ms @ <autogenerated>:1(http.Handler.ServeHTTP-fm)\r\n2024/08/20 00:00:37 ...eb/routing/logger.go:102:func1() [I] router: completed POST /api/actions/runner.v1.RunnerService/FetchTask for 127.0.0.1:51052, 200 OK in 364.4ms @ <autogenerated>:1(http.Handler.ServeHTTP-fm)\r\n2024/08/20 00:00:39 ...eb/routing/logger.go:102:func1() [I] router: completed POST /api/actions/runner.v1.RunnerService/FetchTask for 127.0.0.1:51052, 200 OK in 277.2ms @ <autogenerated>:1(http.Handler.ServeHTTP-fm)\r\n2024/08/20 00:00:39 ...exer/code/indexer.go:128:func2() [E] Codes indexer handler: index error for repo 78: fork/exec C:\\Program Files\\Git\\cmd\\git.exe: The filename or extension is too long.\r\n```\r\n\r\n### Gitea Version\r\n\r\n1.22.1 go-git\r\n\r\n### Can you reproduce the bug on the Gitea demo site?\r\n\r\nNo\r\n\r\n### Log Gist\r\n\r\n_No response_\r\n\r\n### Screenshots\r\n\r\n_No response_\r\n\r\n### Git Version\r\n\r\n2.45.2.windows.1\r\n\r\n### Operating System\r\n\r\nWindows Server 2016\r\n\r\n### How are you running Gitea?\r\n\r\nWindows gogit exe on prem running a service\r\n\r\n### Database\r\n\r\nSQLite","closed_by":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/31884/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/go-gitea/gitea/issues/31884/timeline","performed_via_github_app":null,"state_reason":"completed"}