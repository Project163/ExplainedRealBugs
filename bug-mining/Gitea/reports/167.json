{"url":"https://api.github.com/repos/go-gitea/gitea/issues/27157","repository_url":"https://api.github.com/repos/go-gitea/gitea","labels_url":"https://api.github.com/repos/go-gitea/gitea/issues/27157/labels{/name}","comments_url":"https://api.github.com/repos/go-gitea/gitea/issues/27157/comments","events_url":"https://api.github.com/repos/go-gitea/gitea/issues/27157/events","html_url":"https://github.com/go-gitea/gitea/issues/27157","id":1905796534,"node_id":"I_kwDOBFIx285xmCW2","number":27157,"title":"Gitea sends discord webhook for edited release draft","user":{"login":"Andre601","id":11576465,"node_id":"MDQ6VXNlcjExNTc2NDY1","avatar_url":"https://avatars.githubusercontent.com/u/11576465?v=4","gravatar_id":"","url":"https://api.github.com/users/Andre601","html_url":"https://github.com/Andre601","followers_url":"https://api.github.com/users/Andre601/followers","following_url":"https://api.github.com/users/Andre601/following{/other_user}","gists_url":"https://api.github.com/users/Andre601/gists{/gist_id}","starred_url":"https://api.github.com/users/Andre601/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Andre601/subscriptions","organizations_url":"https://api.github.com/users/Andre601/orgs","repos_url":"https://api.github.com/users/Andre601/repos","events_url":"https://api.github.com/users/Andre601/events{/privacy}","received_events_url":"https://api.github.com/users/Andre601/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":472744938,"node_id":"MDU6TGFiZWw0NzI3NDQ5Mzg=","url":"https://api.github.com/repos/go-gitea/gitea/labels/type/bug","name":"type/bug","color":"ee0701","default":false,"description":""}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/go-gitea/gitea/milestones/156","html_url":"https://github.com/go-gitea/gitea/milestone/156","labels_url":"https://api.github.com/repos/go-gitea/gitea/milestones/156/labels","id":10504095,"node_id":"MI_kwDOBFIx284AoEef","number":156,"title":"1.21.6","description":"","creator":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":73,"state":"closed","created_at":"2024-02-02T03:47:16Z","updated_at":"2024-02-22T22:42:49Z","due_on":"2024-02-19T08:00:00Z","closed_at":"2024-02-22T22:42:49Z"},"comments":1,"created_at":"2023-09-20T22:24:47Z","updated_at":"2024-02-28T00:03:37Z","closed_at":"2024-02-02T04:18:13Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description\r\n\r\nWhen you set up a discord-type webhook where you chose your events and selected `Release` will Gitea not send a Webhook when you save a new release as draft. This is fine and something I would expect as you may not want to publish new info too early to everyone.\r\n\r\nHowever, if you edit said draft and again save it as such, therefore editing the draft, will Gitea send a webhook with the edit notification, which isn't really an optimal thing to do here.\r\n\r\nNote that I have encountered this behaviour on a forgejo instance and I cannot test it within try.gitea.io due to it not allowing to make release drafts... So testing it yourself if you have the permission - or granting me the permission (Username is Andre601) to make drafts - is recommended.\r\n\r\nSteps for possible reproduction:\r\n\r\n1. Create a Discord Webhook and copy URL\r\n2. Create a new Webhook on your Repository by selecting \"Discord\" as the webhook type\r\n3. Paste the URL into the URL field\r\n4. Select \"Custom Events\" followed by \"Release\"\r\n5. Go to releases tab\r\n6. Draft a new release and save it as a draft\r\n7. Edit the draft and save it as draft again\r\n8. Notice the webhook sending despite the edited release still being a draft\r\n\r\n----\r\n\r\nI would like to take the oportunity to also propose changes to the webhook system.\r\nThe way it is right now is flexible, yet rigit.\r\nFlexible, because you can define your own selection of events to send a webhook for, but rigit because the selectable events group common types together, without any way of filtering them out...\r\n\r\nAs an example \"Release\" includes creation, deletion and edits of releases, without having any option to only have creation and edits f.e.\r\n\r\nIt should be considered to allow more fine-grained selections. Maybe by having the types as sub-lists of the event itself to select, where selecting the main/parent event would auto-select all the sub-list items...\r\n\r\nA quick mockup using GitHub checkbox lists:\r\n\r\n- [ ] Release\r\n  - [x] Create\r\n  - [ ] Edit\r\n  - [x] Delete\r\n\r\nI can create a separate issue for this as a feature request if that is wanted.\r\n\r\n### Gitea Version\r\n\r\n1.20.3+0-38-g0e33ecb13\r\n\r\n### Can you reproduce the bug on the Gitea demo site?\r\n\r\nNo (Not possible to test on that instance)\r\n\r\n### Log Gist\r\n\r\n_No response_\r\n\r\n### Screenshots\r\n\r\nWebhook message of the edited release draft:\r\n![grafik](https://github.com/go-gitea/gitea/assets/11576465/f6e08f24-b343-49d5-82b0-ba649551679d)\r\n\r\nThe release in question, clearly marked as Draft:\r\n![grafik](https://github.com/go-gitea/gitea/assets/11576465/56da068d-1974-4efe-86ea-77e06c50b71a)\r\n\r\n\r\n### Git Version\r\n\r\n-\r\n\r\n### Operating System\r\n\r\n-\r\n\r\n### How are you running Gitea?\r\n\r\nI do not self-host/run it, but use codeberg.org for this.\r\nAs mentioned is the instance actually using forgejo, but given its soft-fork nature and currently not having any major differences from Gitea, I have strong beliefs that this bug exists within Gitea itself.\r\n\r\n### Database\r\n\r\nNone","closed_by":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/27157/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/go-gitea/gitea/issues/27157/timeline","performed_via_github_app":null,"state_reason":"completed"}