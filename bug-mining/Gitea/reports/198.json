{"url":"https://api.github.com/repos/go-gitea/gitea/issues/26691","repository_url":"https://api.github.com/repos/go-gitea/gitea","labels_url":"https://api.github.com/repos/go-gitea/gitea/issues/26691/labels{/name}","comments_url":"https://api.github.com/repos/go-gitea/gitea/issues/26691/comments","events_url":"https://api.github.com/repos/go-gitea/gitea/issues/26691/events","html_url":"https://github.com/go-gitea/gitea/issues/26691","id":1863188025,"node_id":"I_kwDOBFIx285vDf45","number":26691,"title":"Alpine Package Registry: Handling of 'noarch' packages","user":{"login":"joniw","id":5174700,"node_id":"MDQ6VXNlcjUxNzQ3MDA=","avatar_url":"https://avatars.githubusercontent.com/u/5174700?v=4","gravatar_id":"","url":"https://api.github.com/users/joniw","html_url":"https://github.com/joniw","followers_url":"https://api.github.com/users/joniw/followers","following_url":"https://api.github.com/users/joniw/following{/other_user}","gists_url":"https://api.github.com/users/joniw/gists{/gist_id}","starred_url":"https://api.github.com/users/joniw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joniw/subscriptions","organizations_url":"https://api.github.com/users/joniw/orgs","repos_url":"https://api.github.com/users/joniw/repos","events_url":"https://api.github.com/users/joniw/events{/privacy}","received_events_url":"https://api.github.com/users/joniw/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":472744938,"node_id":"MDU6TGFiZWw0NzI3NDQ5Mzg=","url":"https://api.github.com/repos/go-gitea/gitea/labels/type/bug","name":"type/bug","color":"ee0701","default":false,"description":""},{"id":4102834064,"node_id":"LA_kwDOBFIx2870jEeQ","url":"https://api.github.com/repos/go-gitea/gitea/labels/topic/packages","name":"topic/packages","color":"AFE667","default":false,"description":""}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2023-08-23T11:58:45Z","updated_at":"2024-03-08T00:01:25Z","closed_at":"2024-02-25T15:10:57Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description\n\nHello,\r\n\r\nthank you for integrating the possibility to use gitea as an alpine package registry.\r\n\r\nWhen adding a package with the architecture 'noarch' (like the [salt package](https://dl-cdn.alpinelinux.org/alpine/edge/community/x86_64/salt-3006.1-r0.apk)) it can not be installed via apk.\r\n\r\nThe reason is the architecture ist automatically detected from the package in the source-code and the uploaded package is then only available under the 'noarch' archtitecture and not under the other architectures like 'x86_64'.\r\n\r\nA short test with the salt package from edge to my gitea instance:\r\n\r\n```\r\nroot@alpine-dev ~/test # wget https://dl-cdn.alpinelinux.org/alpine/edge/community/x86_64/salt-3006.2-r0.apk\r\nConnecting to dl-cdn.alpinelinux.org ([2a04:4e42:6f::644]:443)\r\nsaving to 'salt-3006.2-r0.apk'\r\nsalt-3006.2-r0.apk   100% |**************************************************************************************************************************| 5625k  0:00:00 ETA\r\n'salt-3006.2-r0.apk' saved\r\nroot@alpine-dev ~/test # curl --user testuser:password --upload-file salt-3006.2-r0.apk https://[***REDACTED***]/api/packages/alpine-packages/alpine/edge/\r\nroot@alpine-dev ~/test # apk update\r\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.18/main/x86_64/APKINDEX.tar.gz\r\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.18/community/x86_64/APKINDEX.tar.gz\r\nfetch https://[***REDACTED***]/api/packages/alpine-packages/alpine/edge/salt/x86_64/APKINDEX.tar.gz\r\nWARNING: updating and opening https://[***REDACTED***]/api/packages/alpine-packages/alpine/edge/salt: No such file or directory\r\nv3.18.3-55-g2ee93b9273a [https://dl-cdn.alpinelinux.org/alpine/v3.18/main]\r\nv3.18.3-63-g5d6ac0a2673 [https://dl-cdn.alpinelinux.org/alpine/v3.18/community]\r\n2 unavailable, 0 stale; 20063 distinct packages available\r\nroot@alpine-dev ~/test # wget https://[***REDACTED***]/api/packages/alpine-packages/alpine/edge/salt/x86_64/APKINDEX.tar.gz\r\nConnecting to [***REDACTED***] ([***REDACTED***]:443)\r\nwget: server returned error: HTTP/1.1 404 Not Found\r\nroot@alpine-dev ~/test # wget https://[***REDACTED***]/api/packages/alpine-packages/alpine/edge/salt/noarch/APKINDEX.tar.gz\r\nConnecting to [***REDACTED***] ([***REDACTED***]:443)\r\nsaving to 'APKINDEX.tar.gz'\r\nAPKINDEX.tar.gz      100% |**************************************************************************************************************************|  1170  0:00:00 ETA\r\n'APKINDEX.tar.gz' saved\r\n```\r\n\r\nPossible solutions to this problem from my point of view are:\r\n- add 'noarch' packages to all architectures\r\n- allow to set the architecture on upload\r\n\r\nWith regards\r\nJoniw\n\n### Gitea Version\n\n1.20.3\n\n### Can you reproduce the bug on the Gitea demo site?\n\nNo\n\n### Log Gist\n\n_No response_\n\n### Screenshots\n\n_No response_\n\n### Git Version\n\n_No response_\n\n### Operating System\n\n_No response_\n\n### How are you running Gitea?\n\nTest instance in Kubernetes\n\n### Database\n\nPostgreSQL","closed_by":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/26691/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/go-gitea/gitea/issues/26691/timeline","performed_via_github_app":null,"state_reason":"completed"}