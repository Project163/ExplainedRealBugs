{"url":"https://api.github.com/repos/go-gitea/gitea/issues/28705","repository_url":"https://api.github.com/repos/go-gitea/gitea","labels_url":"https://api.github.com/repos/go-gitea/gitea/issues/28705/labels{/name}","comments_url":"https://api.github.com/repos/go-gitea/gitea/issues/28705/comments","events_url":"https://api.github.com/repos/go-gitea/gitea/issues/28705/events","html_url":"https://github.com/go-gitea/gitea/issues/28705","id":2068001297,"node_id":"I_kwDOBFIx2857QzIR","number":28705,"title":"web.go PANIC on upgrade from 1.20.6 to 1.21","user":{"login":"sysnux","id":6288570,"node_id":"MDQ6VXNlcjYyODg1NzA=","avatar_url":"https://avatars.githubusercontent.com/u/6288570?v=4","gravatar_id":"","url":"https://api.github.com/users/sysnux","html_url":"https://github.com/sysnux","followers_url":"https://api.github.com/users/sysnux/followers","following_url":"https://api.github.com/users/sysnux/following{/other_user}","gists_url":"https://api.github.com/users/sysnux/gists{/gist_id}","starred_url":"https://api.github.com/users/sysnux/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sysnux/subscriptions","organizations_url":"https://api.github.com/users/sysnux/orgs","repos_url":"https://api.github.com/users/sysnux/repos","events_url":"https://api.github.com/users/sysnux/events{/privacy}","received_events_url":"https://api.github.com/users/sysnux/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":472744938,"node_id":"MDU6TGFiZWw0NzI3NDQ5Mzg=","url":"https://api.github.com/repos/go-gitea/gitea/labels/type/bug","name":"type/bug","color":"ee0701","default":false,"description":""},{"id":3995080816,"node_id":"LA_kwDOBFIx287uIBhw","url":"https://api.github.com/repos/go-gitea/gitea/labels/issue/workaround","name":"issue/workaround","color":"006B75","default":false,"description":"it is or has a workaround"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/go-gitea/gitea/milestones/154","html_url":"https://github.com/go-gitea/gitea/milestone/154","labels_url":"https://api.github.com/repos/go-gitea/gitea/milestones/154/labels","id":10337390,"node_id":"MI_kwDOBFIx284Anbxu","number":154,"title":"1.21.4","description":"","creator":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":65,"state":"closed","created_at":"2023-12-21T08:32:13Z","updated_at":"2024-01-17T02:49:27Z","due_on":"2024-01-05T08:00:00Z","closed_at":"2024-01-17T02:49:27Z"},"comments":3,"created_at":"2024-01-05T20:34:50Z","updated_at":"2024-02-21T00:01:07Z","closed_at":"2024-01-06T09:30:04Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description\n\nTrying to upgrade from 1.20.6 to 1.21.3 or 1.21.0, service won't start:\r\n\r\nsystemd[1]: Started gitea.service - Gitea.\r\ngitea[62328]: 2024/01/05 09:51:31 cmd/web.go:242:runWeb() [I] Starting Gitea on PID: 62328\r\ngitea[62328]: 2024/01/05 09:51:31 cmd/web.go:111:showWebStartupMessage() [I] Gitea version: 1.21.0 built with GNU Make 4.3, go1.21.4 : bindata, sqlite, sqlite_unlock_notify\r\ngitea[62328]: 2024/01/05 09:51:31 cmd/web.go:112:showWebStartupMessage() [I] * RunMode: prod\r\ngitea[62328]: 2024/01/05 09:51:31 cmd/web.go:113:showWebStartupMessage() [I] * AppPath: /usr/local/bin/gitea\r\ngitea[62328]: 2024/01/05 09:51:31 cmd/web.go:114:showWebStartupMessage() [I] * WorkPath: /var/lib/gitea\r\ngitea[62328]: 2024/01/05 09:51:31 cmd/web.go:115:showWebStartupMessage() [I] * CustomPath: /var/lib/gitea/custom\r\ngitea[62328]: 2024/01/05 09:51:31 cmd/web.go:116:showWebStartupMessage() [I] * ConfigFile: /etc/gitea/app.ini\r\ngitea[62328]: 2024/01/05 09:51:31 cmd/web.go:117:showWebStartupMessage() [I] Prepare to run web server\r\ngitea[62328]: 2024/01/05 09:51:31 routers/init.go:112:InitWebInstalled() [I] Git version: 2.43.0, Wire Protocol Version 2 Enabled (home: /var/lib/gitea/data/home)\r\ngitea[62328]: 2024/01/05 09:51:31 ...les/setting/cache.go:75:loadCacheFrom() [I] Cache Service Enabled\r\ngitea[62328]: 2024/01/05 09:51:31 ...les/setting/cache.go:90:loadCacheFrom() [I] Last Commit Cache Service Enabled\r\ngitea[62328]: 2024/01/05 09:51:31 ...s/setting/session.go:74:loadSessionFrom() [I] Session Service Enabled\r\ngitea[62328]: 2024/01/05 09:51:31 ...es/setting/mailer.go:237:loadMailerFrom() [I] Mail Service Enabled\r\ngitea[62328]: 2024/01/05 09:51:31 ...es/setting/mailer.go:259:loadNotifyMailFrom() [I] Notify Mail Service Enabled\r\ngitea[62328]: 2024/01/05 09:51:31 ...s/storage/storage.go:176:initAttachments() [I] Initialising Attachment storage with type: local\r\ngitea[62328]: 2024/01/05 09:51:31 ...les/storage/local.go:33:NewLocalStorage() [I] Creating new Local Storage at /var/lib/gitea/data/attachments\r\ngitea[62328]: 2024/01/05 09:51:31 ...s/storage/storage.go:166:initAvatars() [I] Initialising Avatar storage with type: local\r\ngitea[62328]: 2024/01/05 09:51:31 ...les/storage/local.go:33:NewLocalStorage() [I] Creating new Local Storage at /var/lib/gitea/data/avatars\r\ngitea[62328]: 2024/01/05 09:51:31 ...s/storage/storage.go:192:initRepoAvatars() [I] Initialising Repository Avatar storage with type: local\r\ngitea[62328]: 2024/01/05 09:51:31 ...les/storage/local.go:33:NewLocalStorage() [I] Creating new Local Storage at /var/lib/gitea/data/repo-avatars\r\ngitea[62328]: 2024/01/05 09:51:31 ...s/storage/storage.go:198:initRepoArchives() [I] Initialising Repository Archive storage with type: local\r\ngitea[62328]: 2024/01/05 09:51:31 ...les/storage/local.go:33:NewLocalStorage() [I] Creating new Local Storage at /var/lib/gitea/data/repo-archive\r\ngitea[62328]: 2024/01/05 09:51:31 ...s/storage/storage.go:208:initPackages() [I] Initialising Packages storage with type: local\r\ngitea[62328]: 2024/01/05 09:51:31 ...les/storage/local.go:33:NewLocalStorage() [I] Creating new Local Storage at /var/lib/gitea/data/packages\r\ngitea[62328]: 2024/01/05 09:51:31 ...s/storage/storage.go:219:initActions() [I] Initialising Actions storage with type: local\r\ngitea[62328]: 2024/01/05 09:51:31 ...les/storage/local.go:33:NewLocalStorage() [I] Creating new Local Storage at /var/lib/gitea/data/actions_log\r\ngitea[62328]: 2024/01/05 09:51:31 ...s/storage/storage.go:223:initActions() [I] Initialising ActionsArtifacts storage with type: local\r\ngitea[62328]: 2024/01/05 09:51:31 ...les/storage/local.go:33:NewLocalStorage() [I] Creating new Local Storage at /var/lib/gitea/data/actions_artifacts\r\ngitea[62328]: 2024/01/05 09:51:31 ...queue/workergroup.go:255:doRun() [D] Queue \"notification-service\" starts running\r\ngitea[62328]: 2024/01/05 09:51:31 ...queue/workergroup.go:255:doRun() [D] Queue \"mail\" starts running\r\ngitea[62328]: 2024/01/05 09:51:31 ...queue/workergroup.go:255:doRun() [D] Queue \"repo-archive\" starts running\r\ngitea[62328]: 2024/01/05 09:51:31 routers/init.go:131:InitWebInstalled() [I] SQLite3 support is enabled\r\ngitea[62328]: 2024/01/05 09:51:31 routers/common/db.go:23:InitDBEngine() [I] Beginning ORM engine initialization.\r\ngitea[62328]: 2024/01/05 09:51:31 routers/common/db.go:30:InitDBEngine() [I] ORM engine initialization attempt #1/10...\r\ngitea[62328]: 2024/01/05 09:51:31 ...queue/workergroup.go:333:doRun() [D] Queue \"notification-service\" is shutting down\r\ngitea[62328]: 2024/01/05 09:51:31 ...queue/workergroup.go:333:doRun() [D] Queue \"mail\" is shutting down\r\ngitea[62328]: 2024/01/05 09:51:31 ...queue/workergroup.go:334:doRun() [D] Queue \"notification-service\" stops running\r\ngitea[62328]: 2024/01/05 09:51:31 ...queue/workergroup.go:333:doRun() [D] Queue \"repo-archive\" is shutting down\r\ngitea[62328]: 2024/01/05 09:51:31 ...queue/workergroup.go:334:doRun() [D] Queue \"mail\" stops running\r\ngitea[62328]: 2024/01/05 09:51:31 ...queue/workergroup.go:334:doRun() [D] Queue \"repo-archive\" stops running\r\ngitea[62328]: 2024/01/05 09:51:31 ...eful/manager_unix.go:208:handleSignals() [W] PID: 62328. Background context for manager closed - context canceled - Shutting down...\r\ngitea[62328]: 2024/01/05 09:51:31 cmd/web.go:231:func1() [F] PANIC: runtime error: index out of range [0] with length 0\r\ngitea[62328]: /usr/local/go/src/runtime/panic.go:114 (0x43b09b)\r\ngitea[62328]: /source/modules/setting/database.go:171 (0xa59e37)\r\ngitea[62328]: /source/modules/setting/database.go:112 (0xa5982b)\r\ngitea[62328]: /source/models/db/engine.go:97 (0xfc7a36)\r\ngitea[62328]: /source/models/db/engine.go:134 (0xfc7ce8)\r\ngitea[62328]: /source/models/db/engine.go:180 (0xfc81a5)\r\ngitea[62328]: /source/routers/common/db.go:31 (0x24109e4)\r\ngitea[62328]: /source/routers/init.go:65 (0x272a80e)\r\ngitea[62328]: /source/routers/init.go:136 (0x272aed8)\r\ngitea[62328]: /source/cmd/web.go:194 (0x282b038)\r\ngitea[62328]: /source/cmd/web.go:262 (0x282b5fc)\r\ngitea[62328]: /source/cmd/main.go:117 (0x28220cb)\r\ngitea[62328]: /go/pkg/mod/github.com/urfave/cli/v2@v2.25.7/command.go:274 (0x13440d7)\r\ngitea[62328]: /go/pkg/mod/github.com/urfave/cli/v2@v2.25.7/command.go:267 (0x1344324)\r\ngitea[62328]: /go/pkg/mod/github.com/urfave/cli/v2@v2.25.7/app.go:332 (0x1340a56)\r\ngitea[62328]: /go/pkg/mod/github.com/urfave/cli/v2@v2.25.7/app.go:309 (0x2822cd8)\r\ngitea[62328]: /source/cmd/main.go:176 (0x2822cbc)\r\ngitea[62328]: /source/main.go:46 (0x2868d58)\r\ngitea[62328]: /usr/local/go/src/runtime/proc.go:267 (0x4400ba)\r\ngitea[62328]: /usr/local/go/src/runtime/asm_amd64.s:1650 (0x473ca0)\r\nsystemd[1]: gitea.service: Main process exited, code=exited, status=1/FAILURE\r\nsystemd[1]: gitea.service: Failed with result 'exit-code'.\r\n\r\nReverting to 1.20.6 afterwards works fine.\n\n### Gitea Version\n\n1.21.0\n\n### Can you reproduce the bug on the Gitea demo site?\n\nNo\n\n### Log Gist\n\n_No response_\n\n### Screenshots\n\n_No response_\n\n### Git Version\n\n2.43.0\n\n### Operating System\n\nLinux Fedora 38\n\n### How are you running Gitea?\n\nRunning the binary (gitea-1.21.0-linux-amd64 or gitea-1.21.3-linux-amd64), with PostgreSQL (14.10) database.\n\n### Database\n\nPostgreSQL","closed_by":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/28705/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/go-gitea/gitea/issues/28705/timeline","performed_via_github_app":null,"state_reason":"completed"}