{"url":"https://api.github.com/repos/go-gitea/gitea/issues/31101","repository_url":"https://api.github.com/repos/go-gitea/gitea","labels_url":"https://api.github.com/repos/go-gitea/gitea/issues/31101/labels{/name}","comments_url":"https://api.github.com/repos/go-gitea/gitea/issues/31101/comments","events_url":"https://api.github.com/repos/go-gitea/gitea/issues/31101/events","html_url":"https://github.com/go-gitea/gitea/issues/31101","id":2318832459,"node_id":"I_kwDOBFIx286KNpNL","number":31101,"title":"Installing Jupyter in 1.22-rootless","user":{"login":"graelo","id":84066822,"node_id":"MDQ6VXNlcjg0MDY2ODIy","avatar_url":"https://avatars.githubusercontent.com/u/84066822?v=4","gravatar_id":"","url":"https://api.github.com/users/graelo","html_url":"https://github.com/graelo","followers_url":"https://api.github.com/users/graelo/followers","following_url":"https://api.github.com/users/graelo/following{/other_user}","gists_url":"https://api.github.com/users/graelo/gists{/gist_id}","starred_url":"https://api.github.com/users/graelo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/graelo/subscriptions","organizations_url":"https://api.github.com/users/graelo/orgs","repos_url":"https://api.github.com/users/graelo/repos","events_url":"https://api.github.com/users/graelo/events{/privacy}","received_events_url":"https://api.github.com/users/graelo/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":472744938,"node_id":"MDU6TGFiZWw0NzI3NDQ5Mzg=","url":"https://api.github.com/repos/go-gitea/gitea/labels/type/bug","name":"type/bug","color":"ee0701","default":false,"description":""}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2024-05-27T10:35:29Z","updated_at":"2024-08-25T17:18:21Z","closed_at":"2024-05-27T13:12:15Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description\r\n\r\nHi, amazing release, thanks!\r\n\r\nI used to add Jupyter inside a custom rootless image following the instructions in https://github.com/go-gitea/gitea/blob/98751108b11dc748cc99230ca0fc1acfdf2c8929/docs/content/administration/external-renderers.en-us.md?plain=1#L44-L46\r\n\r\nHowever starting with 1.22.0 this is not possible anymore because of some permissions issues during the docker build process. It used to work flawlessly in 1.21 and previous versions. See error below.\r\n\r\nWhen appropriate, can you please update the instructions or fix the permissions issue in the 1.22-rootless image?\r\n\r\nThanks!\r\n\r\n<details>\r\nerror returned during docker build process (used to work with <1.22):\r\n\r\n```\r\n  => ERROR [3/5] RUN pip3 install --upgrade pip                                                                                                         1.1s\r\n------\r\n > [3/5] RUN pip3 install --upgrade pip:\r\n0.888 WARNING: The directory '/var/lib/gitea/git/.cache/pip' or its parent directory is not owned or is not writable by the current user. The cache has been disabled. Check the permissions and owner of that directory. If executing pip with sudo, you should use sudo's -H flag.\r\n0.893 error: externally-managed-environment\r\n0.893\r\n0.893 × This environment is externally managed\r\n0.893 ╰─>\r\n0.893     The system-wide python installation should be maintained using the system\r\n0.893     package manager (apk) only.\r\n0.893\r\n0.893     If the package in question is not packaged already (and hence installable via\r\n0.893     \"apk add py3-somepackage\"), please consider installing it inside a virtual\r\n0.893     environment, e.g.:\r\n0.893\r\n0.893     python3 -m venv /path/to/venv\r\n0.893     . /path/to/venv/bin/activate\r\n0.893     pip install mypackage\r\n0.893\r\n0.893     To exit the virtual environment, run:\r\n0.893\r\n0.893     deactivate\r\n0.893\r\n0.893     The virtual environment is not deleted, and can be re-entered by re-sourcing\r\n0.893     the activate file.\r\n0.893\r\n0.893     To automatically manage virtual environments, consider using pipx (from the\r\n0.893     pipx package).\r\n0.893\r\n0.893 note: If you believe this is a mistake, please contact your Python installation or OS distribution provider. You can override this, at the risk of breaking your Python installation or OS, by passing --break-system-packages.\r\n0.893 hint: See PEP 668 for the detailed specification.\r\n------\r\nDockerfile:8\r\n--------------------\r\n   6 |     # install any other package you need for your external renderers\r\n   7 |\r\n   8 | >>> RUN pip3 install --upgrade pip\r\n   9 |     RUN pip3 install -U setuptools\r\n  10 |     RUN pip3 install jupyter docutils\r\n--------------------\r\nERROR: failed to solve: process \"/bin/sh -c pip3 install --upgrade pip\" did not complete successfully: exit code: 1\r\n```\r\n</details>\r\n\r\n### Gitea Version\r\n\r\n1.22\r\n\r\n### Can you reproduce the bug on the Gitea demo site?\r\n\r\nYes\r\n\r\n### Log Gist\r\n\r\n_No response_\r\n\r\n### Screenshots\r\n\r\n_No response_\r\n\r\n### Git Version\r\n\r\n_No response_\r\n\r\n### Operating System\r\n\r\nLinux x86-64\r\n\r\n### How are you running Gitea?\r\n\r\nHere is my `Dockerfile`\r\n\r\n```\r\nFROM gitea/gitea:1.22.0-rootless\r\n\r\nUSER 0:0\r\n\r\nRUN apk --no-cache add asciidoctor freetype freetype-dev gcc g++ libpng libffi-dev pandoc py-pip python3-dev py3-pip py3-pyzmq\r\n# install any other package you need for your external renderers\r\n\r\nRUN pip3 install --upgrade pip\r\nRUN pip3 install -U setuptools\r\nRUN pip3 install jupyter docutils\r\n\r\nUSER 1000:1000\r\n```\r\n\r\n### Database\r\n\r\nNone","closed_by":{"login":"graelo","id":84066822,"node_id":"MDQ6VXNlcjg0MDY2ODIy","avatar_url":"https://avatars.githubusercontent.com/u/84066822?v=4","gravatar_id":"","url":"https://api.github.com/users/graelo","html_url":"https://github.com/graelo","followers_url":"https://api.github.com/users/graelo/followers","following_url":"https://api.github.com/users/graelo/following{/other_user}","gists_url":"https://api.github.com/users/graelo/gists{/gist_id}","starred_url":"https://api.github.com/users/graelo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/graelo/subscriptions","organizations_url":"https://api.github.com/users/graelo/orgs","repos_url":"https://api.github.com/users/graelo/repos","events_url":"https://api.github.com/users/graelo/events{/privacy}","received_events_url":"https://api.github.com/users/graelo/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/31101/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/go-gitea/gitea/issues/31101/timeline","performed_via_github_app":null,"state_reason":"completed"}