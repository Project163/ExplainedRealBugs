{"url":"https://api.github.com/repos/go-gitea/gitea/issues/33839","repository_url":"https://api.github.com/repos/go-gitea/gitea","labels_url":"https://api.github.com/repos/go-gitea/gitea/issues/33839/labels{/name}","comments_url":"https://api.github.com/repos/go-gitea/gitea/issues/33839/comments","events_url":"https://api.github.com/repos/go-gitea/gitea/issues/33839/events","html_url":"https://github.com/go-gitea/gitea/issues/33839","id":2905674136,"node_id":"I_kwDOBFIx286tMRGY","number":33839,"title":"LFS Pure SSH implementation uses ROOT_URL instead of LOCAL_ROOT_URL","user":{"login":"florolf","id":1835,"node_id":"MDQ6VXNlcjE4MzU=","avatar_url":"https://avatars.githubusercontent.com/u/1835?v=4","gravatar_id":"","url":"https://api.github.com/users/florolf","html_url":"https://github.com/florolf","followers_url":"https://api.github.com/users/florolf/followers","following_url":"https://api.github.com/users/florolf/following{/other_user}","gists_url":"https://api.github.com/users/florolf/gists{/gist_id}","starred_url":"https://api.github.com/users/florolf/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/florolf/subscriptions","organizations_url":"https://api.github.com/users/florolf/orgs","repos_url":"https://api.github.com/users/florolf/repos","events_url":"https://api.github.com/users/florolf/events{/privacy}","received_events_url":"https://api.github.com/users/florolf/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":472744938,"node_id":"MDU6TGFiZWw0NzI3NDQ5Mzg=","url":"https://api.github.com/repos/go-gitea/gitea/labels/type/bug","name":"type/bug","color":"ee0701","default":false,"description":""}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/go-gitea/gitea/milestones/176","html_url":"https://github.com/go-gitea/gitea/milestone/176","labels_url":"https://api.github.com/repos/go-gitea/gitea/milestones/176/labels","id":12439719,"node_id":"MI_kwDOBFIx284AvdCn","number":176,"title":"1.23.6","description":"","creator":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":26,"state":"closed","created_at":"2025-03-05T00:22:07Z","updated_at":"2025-03-24T20:10:02Z","due_on":"2025-03-18T07:00:00Z","closed_at":"2025-03-24T20:10:02Z"},"comments":8,"created_at":"2025-03-09T21:04:17Z","updated_at":"2025-06-08T16:16:26Z","closed_at":"2025-03-10T09:36:04Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description\n\nWhen using the LFS Pure SSH protocol, the `\"download\"` links in the `batch` responses are generated using `setting.AppURL` (aka `ROOT_URL`). While this makes sense for the classic hybrid transport mode where the LFS client needs to connect to the externally facing API URLs to download objects, in the SSH protocol case, subsequent LFS `download` requests are being originated from the SSH server node.\n\nThis causes a number of problems:\n\n- One major reason to use the SSH protocol in the first place is to avoid having to publicly expose the HTTP LFS endpoints in the first place. However, as implemented, the server side SSH protocol implementation will still try to access the public endpoints (unlike other code which needs to talk to the main Gitea service, which will use `LOCAL_ROOT_URL`, which can bypass a reverse proxy in front if Gitea.\n- `ROOT_URL` might not be even accessible from the SSH server node, which will cause obscure failures when cloning a repository (`LFS: got status 500 when fetching OID`)\n\n### Gitea Version\n\n1.23.5\n\n### Can you reproduce the bug on the Gitea demo site?\n\nNo\n\n### Log Gist\n\n_No response_\n\n### Screenshots\n\n_No response_\n\n### Git Version\n\n_No response_\n\n### Operating System\n\n_No response_\n\n### How are you running Gitea?\n\nSelf-hosted setup running behind a HTTPS reverse proxy and using OpenSSH for SSH. Both SSH, the reverse proxy and Gitea are running on the same machine, but because of some unrelated peculiar network configuration, the external URL (`ROOT_URL`) is not accessible locally.\n\n### Database\n\nSQLite","closed_by":{"login":"wxiaoguang","id":2114189,"node_id":"MDQ6VXNlcjIxMTQxODk=","avatar_url":"https://avatars.githubusercontent.com/u/2114189?v=4","gravatar_id":"","url":"https://api.github.com/users/wxiaoguang","html_url":"https://github.com/wxiaoguang","followers_url":"https://api.github.com/users/wxiaoguang/followers","following_url":"https://api.github.com/users/wxiaoguang/following{/other_user}","gists_url":"https://api.github.com/users/wxiaoguang/gists{/gist_id}","starred_url":"https://api.github.com/users/wxiaoguang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wxiaoguang/subscriptions","organizations_url":"https://api.github.com/users/wxiaoguang/orgs","repos_url":"https://api.github.com/users/wxiaoguang/repos","events_url":"https://api.github.com/users/wxiaoguang/events{/privacy}","received_events_url":"https://api.github.com/users/wxiaoguang/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/33839/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/go-gitea/gitea/issues/33839/timeline","performed_via_github_app":null,"state_reason":"completed"}