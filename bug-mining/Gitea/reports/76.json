{"url":"https://api.github.com/repos/go-gitea/gitea/issues/27049","repository_url":"https://api.github.com/repos/go-gitea/gitea","labels_url":"https://api.github.com/repos/go-gitea/gitea/issues/27049/labels{/name}","comments_url":"https://api.github.com/repos/go-gitea/gitea/issues/27049/comments","events_url":"https://api.github.com/repos/go-gitea/gitea/issues/27049/events","html_url":"https://github.com/go-gitea/gitea/issues/27049","id":1893619204,"node_id":"I_kwDOBFIx285w3lYE","number":27049,"title":"LDAP admin updata bug","user":{"login":"CaiCandong","id":50507092,"node_id":"MDQ6VXNlcjUwNTA3MDky","avatar_url":"https://avatars.githubusercontent.com/u/50507092?v=4","gravatar_id":"","url":"https://api.github.com/users/CaiCandong","html_url":"https://github.com/CaiCandong","followers_url":"https://api.github.com/users/CaiCandong/followers","following_url":"https://api.github.com/users/CaiCandong/following{/other_user}","gists_url":"https://api.github.com/users/CaiCandong/gists{/gist_id}","starred_url":"https://api.github.com/users/CaiCandong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/CaiCandong/subscriptions","organizations_url":"https://api.github.com/users/CaiCandong/orgs","repos_url":"https://api.github.com/users/CaiCandong/repos","events_url":"https://api.github.com/users/CaiCandong/events{/privacy}","received_events_url":"https://api.github.com/users/CaiCandong/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":472744938,"node_id":"MDU6TGFiZWw0NzI3NDQ5Mzg=","url":"https://api.github.com/repos/go-gitea/gitea/labels/type/bug","name":"type/bug","color":"ee0701","default":false,"description":""},{"id":2575787454,"node_id":"MDU6TGFiZWwyNTc1Nzg3NDU0","url":"https://api.github.com/repos/go-gitea/gitea/labels/topic/authentication","name":"topic/authentication","color":"f4b6ab","default":false,"description":""}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2023-09-13T02:38:09Z","updated_at":"2023-11-22T00:01:25Z","closed_at":"2023-10-01T11:32:13Z","author_association":"MEMBER","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description\r\n\r\nWhen you have set administrator privileges for a user through LDAP settings, and after some time, you cancel the administrator privileges for that user in LDAP. You will find that the administrator privileges cannot be canceled.\r\n\r\nThe problem comes from the LDAP settings, if the Gitea instance does not specify a username query rule, for `user_model.IsUserExist(db.DefaultContext, 0, sr.Username)`, `sr.Username` is an empty string `\"\"`,  `isExist` always be `false`, so can't update the user.\r\n\r\n![image](https://github.com/go-gitea/gitea/assets/50507092/403f5a7e-4346-4ccf-ba75-417f66f26d38)\r\n\r\n\r\nhttps://github.com/go-gitea/gitea/blob/a55ff0dd99439eb96151e64be38e0f14f6e723b7/services/auth/source/ldap/source_authenticate.go#L27-L36\r\n\r\n### Gitea Version\r\n\r\na55ff0dd99439eb96151e64be38e0f14f6e723b7\r\n\r\n### Can you reproduce the bug on the Gitea demo site?\r\n\r\nYes\r\n\r\n### Log Gist\r\n\r\n_No response_\r\n\r\n### Screenshots\r\n\r\n_No response_\r\n\r\n### Git Version\r\n\r\n_No response_\r\n\r\n### Operating System\r\n\r\n_No response_\r\n\r\n### How are you running Gitea?\r\n\r\nsource code\r\n\r\n### Database\r\n\r\nNone","closed_by":{"login":"6543","id":24977596,"node_id":"MDQ6VXNlcjI0OTc3NTk2","avatar_url":"https://avatars.githubusercontent.com/u/24977596?v=4","gravatar_id":"","url":"https://api.github.com/users/6543","html_url":"https://github.com/6543","followers_url":"https://api.github.com/users/6543/followers","following_url":"https://api.github.com/users/6543/following{/other_user}","gists_url":"https://api.github.com/users/6543/gists{/gist_id}","starred_url":"https://api.github.com/users/6543/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/6543/subscriptions","organizations_url":"https://api.github.com/users/6543/orgs","repos_url":"https://api.github.com/users/6543/repos","events_url":"https://api.github.com/users/6543/events{/privacy}","received_events_url":"https://api.github.com/users/6543/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/27049/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/go-gitea/gitea/issues/27049/timeline","performed_via_github_app":null,"state_reason":"completed"}