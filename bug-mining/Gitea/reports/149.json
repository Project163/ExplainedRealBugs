{"url":"https://api.github.com/repos/go-gitea/gitea/issues/28157","repository_url":"https://api.github.com/repos/go-gitea/gitea","labels_url":"https://api.github.com/repos/go-gitea/gitea/issues/28157/labels{/name}","comments_url":"https://api.github.com/repos/go-gitea/gitea/issues/28157/comments","events_url":"https://api.github.com/repos/go-gitea/gitea/issues/28157/events","html_url":"https://github.com/go-gitea/gitea/issues/28157","id":2004391161,"node_id":"I_kwDOBFIx2853eJT5","number":28157,"title":"Scheduled Gitea Actions sometimes run on non-default merged branches","user":{"login":"andrewimeson","id":6353225,"node_id":"MDQ6VXNlcjYzNTMyMjU=","avatar_url":"https://avatars.githubusercontent.com/u/6353225?v=4","gravatar_id":"","url":"https://api.github.com/users/andrewimeson","html_url":"https://github.com/andrewimeson","followers_url":"https://api.github.com/users/andrewimeson/followers","following_url":"https://api.github.com/users/andrewimeson/following{/other_user}","gists_url":"https://api.github.com/users/andrewimeson/gists{/gist_id}","starred_url":"https://api.github.com/users/andrewimeson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andrewimeson/subscriptions","organizations_url":"https://api.github.com/users/andrewimeson/orgs","repos_url":"https://api.github.com/users/andrewimeson/repos","events_url":"https://api.github.com/users/andrewimeson/events{/privacy}","received_events_url":"https://api.github.com/users/andrewimeson/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":472744938,"node_id":"MDU6TGFiZWw0NzI3NDQ5Mzg=","url":"https://api.github.com/repos/go-gitea/gitea/labels/type/bug","name":"type/bug","color":"ee0701","default":false,"description":""},{"id":4808833534,"node_id":"LA_kwDOBFIx288AAAABHqD5_g","url":"https://api.github.com/repos/go-gitea/gitea/labels/topic/gitea-actions","name":"topic/gitea-actions","color":"007ED2","default":false,"description":"related to the actions of Gitea"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/go-gitea/gitea/milestones/154","html_url":"https://github.com/go-gitea/gitea/milestone/154","labels_url":"https://api.github.com/repos/go-gitea/gitea/milestones/154/labels","id":10337390,"node_id":"MI_kwDOBFIx284Anbxu","number":154,"title":"1.21.4","description":"","creator":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":65,"state":"closed","created_at":"2023-12-21T08:32:13Z","updated_at":"2024-01-17T02:49:27Z","due_on":"2024-01-05T08:00:00Z","closed_at":"2024-01-17T02:49:27Z"},"comments":8,"created_at":"2023-11-21T14:19:08Z","updated_at":"2024-02-27T00:01:06Z","closed_at":"2024-01-12T21:50:40Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description\r\n\r\nScheduled Gitea Actions are supposed to run on the default branch of the containing repository, but sometimes they run on branches that aren't the default. I haven't done enough testing to narrow down the circumstances, but it has so far always been a merged-and-deleted branch.\r\n\r\nGiven a workflow file like this:\r\n\r\n```yaml\r\n---\r\non:  # yamllint disable-line rule:truthy\r\n  schedule:\r\n    - cron: '*/15 * * * *'\r\njobs:\r\n  backup:\r\n    name: Backup DNS Zones\r\n    runs-on: ubuntu-latest\r\n    container: catthehacker/ubuntu:act-latest\r\n    steps:\r\n      - name: Checkout\r\n        uses: actions/checkout@v4\r\n\r\n      - name: Debug git status\r\n        run: |\r\n          git status\r\n\r\n      - name: Debug Gitea Actions variables\r\n        run: |-\r\n          echo \"GITHUB_HEAD_REF: $GITHUB_HEAD_REF\"\r\n          echo \"GITHUB_REF: $GITHUB_HEAD_REF\"\r\n          echo \"GITHUB_EVENT_NAME: $GITHUB_EVENT_NAME\"\r\n          echo \"â€¦and a change to the workflow file to see if that is part of it\"\r\n```\r\n\r\nIf you create that in the default branch, it will run in the default branch as scheduled. However, once you create a PR and merge it (with branch auto-deletion turned on) it will start running the schedule on the deleted branch instead.\r\n\r\nI've created a [repository on try.gitea.io](https://try.gitea.io/andrewimeson/actions_schedule/actions), but the screenshots are from my own instance.\r\n\r\n### Gitea Version\r\n\r\n1.21.0\r\n\r\n### Can you reproduce the bug on the Gitea demo site?\r\n\r\nYes\r\n\r\n### Log Gist\r\n\r\n_No response_\r\n\r\n### Screenshots\r\n\r\n<img width=\"940\" alt=\"image\" src=\"https://github.com/go-gitea/gitea/assets/6353225/65f88fcc-dd08-4915-84f9-7c471e283e3a\">\r\n<img width=\"1213\" alt=\"image\" src=\"https://github.com/go-gitea/gitea/assets/6353225/3c10f44e-7a46-4ed2-842a-e2d6d2e9badd\">\r\n\r\n\r\n### Git Version\r\n\r\n_No response_\r\n\r\n### Operating System\r\n\r\n_No response_\r\n\r\n### How are you running Gitea?\r\n\r\nOfficial Helm chart v9.5.1\r\n\r\n### Database\r\n\r\nPostgreSQL","closed_by":{"login":"lafriks","id":165205,"node_id":"MDQ6VXNlcjE2NTIwNQ==","avatar_url":"https://avatars.githubusercontent.com/u/165205?v=4","gravatar_id":"","url":"https://api.github.com/users/lafriks","html_url":"https://github.com/lafriks","followers_url":"https://api.github.com/users/lafriks/followers","following_url":"https://api.github.com/users/lafriks/following{/other_user}","gists_url":"https://api.github.com/users/lafriks/gists{/gist_id}","starred_url":"https://api.github.com/users/lafriks/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lafriks/subscriptions","organizations_url":"https://api.github.com/users/lafriks/orgs","repos_url":"https://api.github.com/users/lafriks/repos","events_url":"https://api.github.com/users/lafriks/events{/privacy}","received_events_url":"https://api.github.com/users/lafriks/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/28157/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/go-gitea/gitea/issues/28157/timeline","performed_via_github_app":null,"state_reason":"completed"}