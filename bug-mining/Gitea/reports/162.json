{"url":"https://api.github.com/repos/go-gitea/gitea/issues/28846","repository_url":"https://api.github.com/repos/go-gitea/gitea","labels_url":"https://api.github.com/repos/go-gitea/gitea/issues/28846/labels{/name}","comments_url":"https://api.github.com/repos/go-gitea/gitea/issues/28846/comments","events_url":"https://api.github.com/repos/go-gitea/gitea/issues/28846/events","html_url":"https://github.com/go-gitea/gitea/issues/28846","id":2089197840,"node_id":"I_kwDOBFIx2858hqEQ","number":28846,"title":"GitHub issue names can be too long and make migrations fail (Postgres/MySQL)","user":{"login":"TristanWasTaken","id":43283797,"node_id":"MDQ6VXNlcjQzMjgzNzk3","avatar_url":"https://avatars.githubusercontent.com/u/43283797?v=4","gravatar_id":"","url":"https://api.github.com/users/TristanWasTaken","html_url":"https://github.com/TristanWasTaken","followers_url":"https://api.github.com/users/TristanWasTaken/followers","following_url":"https://api.github.com/users/TristanWasTaken/following{/other_user}","gists_url":"https://api.github.com/users/TristanWasTaken/gists{/gist_id}","starred_url":"https://api.github.com/users/TristanWasTaken/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TristanWasTaken/subscriptions","organizations_url":"https://api.github.com/users/TristanWasTaken/orgs","repos_url":"https://api.github.com/users/TristanWasTaken/repos","events_url":"https://api.github.com/users/TristanWasTaken/events{/privacy}","received_events_url":"https://api.github.com/users/TristanWasTaken/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":472744938,"node_id":"MDU6TGFiZWw0NzI3NDQ5Mzg=","url":"https://api.github.com/repos/go-gitea/gitea/labels/type/bug","name":"type/bug","color":"ee0701","default":false,"description":""}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2024-01-18T22:50:19Z","updated_at":"2024-02-29T00:03:12Z","closed_at":"2024-01-24T02:09:09Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description\r\n\r\nI tried to migrate the repository https://github.com/tachiyomiorg/tachiyomi with all migration options\r\nThe migration always failed at one of the issues with one of these errors:\r\n- Postgres: `pq: value too long for type character varying(255)`\r\n- MySQL (MariaDB): `Error 1406 (22001): Data too long for column 'name' at row 1`\r\n\r\nLogs from console:\r\n```\r\npostgres-test  | 2024-01-14 11:57:36.882 UTC [88] ERROR:  value too long for type character varying(255)\r\npostgres-test  | 2024-01-14 11:57:36.882 UTC [88] STATEMENT:  INSERT INTO \"issue\" (\"repo_id\",\"index\",\"poster_id\",\"original_author\",\"original_author_id\",\"name\",\"content\",\"milestone_id\",\"priority\",\"is_closed\",\"is_pull\",\"num_comments\",\"ref\",\"pin_order\",\"deadline_unix\",\"created_unix\",\"updated_unix\",\"closed_unix\",\"is_locked\") VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11,$12,$13,$14,$15,$16,$17,$18,$19) RETURNING \"id\"\r\ngitea-test     | 2024/01/14 11:57:36 ...ices/task/migrate.go:61:func1() [E] runMigrateTask[1] by DoerID[1] to RepoID[1] for OwnerID[1] failed: pq: value too long for type character varying(255)\r\ngitea-test     | 2024/01/14 11:57:36 ...ervices/task/task.go:53:handler() [E] Run task failed: pq: value too long for type character varying(255)\r\n```\r\n\r\nAfter changing the `name` field type from `character varying(250) NULL` to `character varying(1200) NULL`, the migration succeeded.\r\n\r\nHere is a dump of the `issue` table with the query `SELECT * FROM issue WHERE LENGTH(name) > 250;`\r\nhttps://gist.github.com/TristanWasTaken/7cb2c9b2a5c537822796ccb4fc25f513\r\nIssues: tachiyomiorg/tachiyomi#3495, tachiyomiorg/tachiyomi#2337, tachiyomiorg/tachiyomi#4321, tachiyomiorg/tachiyomi#4379, tachiyomiorg/tachiyomi#3897, tachiyomiorg/tachiyomi#4898, tachiyomiorg/tachiyomi#4978, tachiyomiorg/tachiyomi#5066\r\n\r\nThe migration is still ongoing on the Gitea demo site: https://try.gitea.io/TristanWasTaken/tachiyomi\r\nIt'll take ~8h to do a full migration. Or at least that's how long it took on my instance.\r\n\r\n### Gitea Version\r\n\r\n1.21.3\r\n\r\n### Can you reproduce the bug on the Gitea demo site?\r\n\r\nNo\r\n\r\n### Log Gist\r\n\r\n_No response_\r\n\r\n### Screenshots\r\n\r\n![gitea_issue_mysql](https://github.com/go-gitea/gitea/assets/43283797/683df40c-b37e-4339-b667-ce6c6f71ec5b)\r\n\r\n\r\n### Git Version\r\n\r\n_No response_\r\n\r\n### Operating System\r\n\r\n_No response_\r\n\r\n### How are you running Gitea?\r\n\r\ndocker `gitea/gitea:1.21.3` image, with `postgres` and `redis`\r\nPlease note that I also tried with `memory` instead of redis, `mysql` (MariaDB) as database and pretty much every variation except sqlite\r\n\r\n### Database\r\n\r\nPostgreSQL","closed_by":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/28846/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/go-gitea/gitea/issues/28846/timeline","performed_via_github_app":null,"state_reason":"completed"}