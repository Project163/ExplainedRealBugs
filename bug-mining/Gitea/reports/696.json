{"url":"https://api.github.com/repos/go-gitea/gitea/issues/35603","repository_url":"https://api.github.com/repos/go-gitea/gitea","labels_url":"https://api.github.com/repos/go-gitea/gitea/issues/35603/labels{/name}","comments_url":"https://api.github.com/repos/go-gitea/gitea/issues/35603/comments","events_url":"https://api.github.com/repos/go-gitea/gitea/issues/35603/events","html_url":"https://github.com/go-gitea/gitea/issues/35603","id":3495379207,"node_id":"I_kwDOBFIx287QV0EH","number":35603,"title":"Cannot merge pull request","user":{"login":"badhezi","id":25709443,"node_id":"MDQ6VXNlcjI1NzA5NDQz","avatar_url":"https://avatars.githubusercontent.com/u/25709443?v=4","gravatar_id":"","url":"https://api.github.com/users/badhezi","html_url":"https://github.com/badhezi","followers_url":"https://api.github.com/users/badhezi/followers","following_url":"https://api.github.com/users/badhezi/following{/other_user}","gists_url":"https://api.github.com/users/badhezi/gists{/gist_id}","starred_url":"https://api.github.com/users/badhezi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/badhezi/subscriptions","organizations_url":"https://api.github.com/users/badhezi/orgs","repos_url":"https://api.github.com/users/badhezi/repos","events_url":"https://api.github.com/users/badhezi/events{/privacy}","received_events_url":"https://api.github.com/users/badhezi/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":472744938,"node_id":"MDU6TGFiZWw0NzI3NDQ5Mzg=","url":"https://api.github.com/repos/go-gitea/gitea/labels/type/bug","name":"type/bug","color":"ee0701","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":1,"created_at":"2025-10-08T13:08:32Z","updated_at":"2025-10-12T02:24:01Z","closed_at":"2025-10-12T02:24:01Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description\n\nNeeds feedback\nCan't seem to merge a pull request\n\nWhen creating a simple pull request from the UI and then trying to \"create merge commit\"\ngitea server errors out with below log\n\nPossibly introduced by this commit https://github.com/go-gitea/gitea/commit/69f5ee970c2f288d0749cab4289b46765d9e3470\n\nhttps://github.com/go-gitea/gitea/blob/03fce8f3d0cf3c180f06470257dc09a6c09ec5b0/modules/git/gitcmd/command.go#L473\n\npanics because `c.opts.Stdout` and `c.opts.Stderr` and not nil\nhttps://github.com/go-gitea/gitea/blob/03fce8f3d0cf3c180f06470257dc09a6c09ec5b0/modules/git/gitcmd/command.go#L471\n\nDebugger shows `c.opts.Stdout` and `c.opts.Stderr` are not nil and are initialized to\nio.Writer(*strings.Builder) *{addr: *strings.Builder nil, buf: []uint8 len: 0, cap: 0, nil}\n\n<img width=\"863\" height=\"268\" alt=\"Image\" src=\"https://github.com/user-attachments/assets/551c6c2f-c26d-438a-be06-f7f0efa1bb09\" />\n\n### Gitea Version\n\nmain 03fce8f3d0cf3c180f06470257dc09a6c09ec5b0\n\n### Can you reproduce the bug on the Gitea demo site?\n\nNo\n\n### Log Gist\n\n_No response_\n\n### Screenshots\n\n<img width=\"1959\" height=\"857\" alt=\"Image\" src=\"https://github.com/user-attachments/assets/e261c1f9-5fee-40e6-9e5c-70bfb30ccd65\" />\n\nlogs:\n```\n2025/10/08 15:42:56 HTTPRequest [W] router: failed    POST /gitea_admin/merge-me/pulls/1/merge for [::1]:57214, panic in 212.7ms @ repo/pull.go:1014(repo.MergePullRequest), err=stdout and stderr field must be nil when using RunStdBytes\n2025/10/08 15:42:56 routers/common/errpage.go:25:RenderPanicErrorPage() [E] PANIC: stdout and stderr field must be nil when using RunStdBytes\n/usr/local/go/src/runtime/panic.go:783 (0x10090eaff)\n        gopanic: fn()\n/Users/heziaharon/Documents/repos/gitea/modules/web/routing/logger_manager.go:116 (0x1019792cb)\n        (*requestRecordsManager).handler-fm.(*requestRecordsManager).handler.func1.1: panic(localPanicErr)\n/usr/local/go/src/runtime/panic.go:783 (0x10090eaff)\n        gopanic: fn()\n/Users/heziaharon/Documents/repos/gitea/modules/git/gitcmd/command.go:473 (0x101139cf3)\n        (*Command).runStdBytes: panic(\"stdout and stderr field must be nil when using RunStdBytes\")\n/Users/heziaharon/Documents/repos/gitea/modules/git/gitcmd/command.go:461 (0x1011399cb)\n        (*Command).RunStdString: stdoutBytes, stderrBytes, runErr := c.WithParentCallerInfo().runStdBytes(ctx)\n/Users/heziaharon/Documents/repos/gitea/services/pull/merge_prepare.go:76 (0x102048387)\n        createTemporaryRepoForMerge: trackingCommitID, _, err := mergeCtx.PrepareGitCmd(gitcmd.NewCommand(\"show-ref\", \"--hash\").AddDynamicArguments(git.BranchPrefix + trackingBranch)).RunStdString(ctx)\n/Users/heziaharon/Documents/repos/gitea/services/pull/merge.go:331 (0x102044047)\n        doMergeAndPush: mergeCtx, cancel, err := createTemporaryRepoForMerge(ctx, pr, doer, expectedHeadCommitID)\n/Users/heziaharon/Documents/repos/gitea/services/pull/merge.go:262 (0x102043853)\n        Merge: _, err = doMergeAndPush(ctx, pr, doer, mergeStyle, expectedHeadCommitID, message, repo_module.PushTriggerPRMergeToBase)\n/Users/heziaharon/Documents/repos/gitea/routers/web/repo/pull.go:1115 (0x1029938c3)\n        MergePullRequest: if err := pull_service.Merge(ctx, pr, ctx.Doer, ctx.Repo.GitRepo, repo_model.MergeStyle(form.Do), form.HeadCommitID, message, false); err != nil {\n/usr/local/go/src/reflect/value.go:581 (0x10099508f)\n        Value.call: call(frametype, fn, stackArgs, uint32(frametype.Size()), uint32(abid.retOffset), uint32(frameSize), &regArgs)\n/usr/local/go/src/reflect/value.go:365 (0x100994563)\n        Value.Call: return v.call(\"Call\", in)\n/Users/heziaharon/Documents/repos/gitea/modules/web/handler.go:161 (0x101981467)\n        toHandlerProvider.func1.1: ret := fn.Call(argsIn)\n/usr/local/go/src/net/http/server.go:2322 (0x100d72017)\n        HandlerFunc.ServeHTTP: f(w, r)\n/usr/local/go/src/net/http/server.go:2322 (0x100d72017)\n        HandlerFunc.ServeHTTP: f(w, r)\n/Users/heziaharon/Documents/repos/gitea/modules/web/handler.go:168 (0x1019814bb)\n        toHandlerProvider.func1.1: next.ServeHTTP(resp, req)\n/usr/local/go/src/net/http/server.go:2322 (0x100d72017)\n        HandlerFunc.ServeHTTP: f(w, r)\n/Users/heziaharon/Documents/repos/gitea/modules/web/handler.go:168 (0x1019814bb)\n        toHandlerProvider.func1.1: next.ServeHTTP(resp, req)\n/usr/local/go/src/net/http/server.go:2322 (0x100d72017)\n        HandlerFunc.ServeHTTP: f(w, r)\n/Users/heziaharon/Documents/repos/gitea/modules/web/handler.go:168 (0x1019814bb)\n        toHandlerProvider.func1.1: next.ServeHTTP(resp, req)\n/usr/local/go/src/net/http/server.go:2322 (0x100d72017)\n        HandlerFunc.ServeHTTP: f(w, r)\n/Users/heziaharon/Documents/repos/gitea/modules/web/handler.go:168 (0x1019814bb)\n        toHandlerProvider.func1.1: next.ServeHTTP(resp, req)\n/usr/local/go/src/net/http/server.go:2322 (0x100d72017)\n        HandlerFunc.ServeHTTP: f(w, r)\n/Users/heziaharon/Documents/repos/gitea/modules/web/handler.go:168 (0x1019814bb)\n        toHandlerProvider.func1.1: next.ServeHTTP(resp, req)\n/usr/local/go/src/net/http/server.go:2322 (0x100d72017)\n        HandlerFunc.ServeHTTP: f(w, r)\n/Users/heziaharon/Documents/repos/gitea/modules/web/handler.go:168 (0x1019814bb)\n        toHandlerProvider.func1.1: next.ServeHTTP(resp, req)\n/usr/local/go/src/net/http/server.go:2322 (0x100d72017)\n        HandlerFunc.ServeHTTP: f(w, r)\n/Users/heziaharon/go/pkg/mod/github.com/go-chi/chi/v5@v5.2.3/chain.go:31 (0x101979b8b)\n        (*ChainHandler).ServeHTTP: c.chain.ServeHTTP(w, r)\n/Users/heziaharon/go/pkg/mod/github.com/go-chi/chi/v5@v5.2.3/mux.go:477 (0x10197c66b)\n        (*Mux).routeHTTP: h.ServeHTTP(w, r)\n/usr/local/go/src/net/http/server.go:2322 (0x100d72017)\n        HandlerFunc.ServeHTTP: f(w, r)\n/Users/heziaharon/Documents/repos/gitea/modules/web/handler.go:168 (0x1019814bb)\n        toHandlerProvider.func1.1: next.ServeHTTP(resp, req)\n/usr/local/go/src/net/http/server.go:2322 (0x100d72017)\n        HandlerFunc.ServeHTTP: f(w, r)\n/Users/heziaharon/Documents/repos/gitea/modules/web/handler.go:168 (0x1019814bb)\n        toHandlerProvider.func1.1: next.ServeHTTP(resp, req)\n/usr/local/go/src/net/http/server.go:2322 (0x100d72017)\n        HandlerFunc.ServeHTTP: f(w, r)\n/Users/heziaharon/go/pkg/mod/github.com/go-chi/chi/v5@v5.2.3/middleware/get_head.go:37 (0x1029176a7)\n        GetHead.func1: next.ServeHTTP(w, r)\n/usr/local/go/src/net/http/server.go:2322 (0x100d72017)\n        HandlerFunc.ServeHTTP: f(w, r)\n/Users/heziaharon/Documents/repos/gitea/modules/web/handler.go:125 (0x101981883)\n        toHandlerProvider.wrapHandlerProvider[...].func2.1: h.ServeHTTP(resp, req)\n/usr/local/go/src/net/http/server.go:2322 (0x100d72017)\n        HandlerFunc.ServeHTTP: f(w, r)\n/Users/heziaharon/Documents/repos/gitea/modules/web/handler.go:168 (0x1019814bb)\n        toHandlerProvider.func1.1: next.ServeHTTP(resp, req)\n/usr/local/go/src/net/http/server.go:2322 (0x100d72017)\n        HandlerFunc.ServeHTTP: f(w, r)\n/Users/heziaharon/Documents/repos/gitea/services/context/context.go:210 (0x101ed05b3)\n        Contexter.func1.1: next.ServeHTTP(ctx.Resp, ctx.Req)\n/usr/local/go/src/net/http/server.go:2322 (0x100d72017)\n        HandlerFunc.ServeHTTP: f(w, r)\n/Users/heziaharon/Documents/repos/gitea/modules/web/handler.go:125 (0x101981883)\n        toHandlerProvider.wrapHandlerProvider[...].func2.1: h.ServeHTTP(resp, req)\n/usr/local/go/src/net/http/server.go:2322 (0x100d72017)\n        HandlerFunc.ServeHTTP: f(w, r)\n/Users/heziaharon/go/pkg/mod/gitea.com/go-chi/session@v0.0.0-20250926004215-636cadd82e15/session.go:257 (0x10192bc0b)\n        Sessioner.func1.1: next.ServeHTTP(w, req)\n/usr/local/go/src/net/http/server.go:2322 (0x100d72017)\n        HandlerFunc.ServeHTTP: f(w, r)\n/Users/heziaharon/Documents/repos/gitea/modules/web/handler.go:125 (0x101981883)\n        toHandlerProvider.wrapHandlerProvider[...].func2.1: h.ServeHTTP(resp, req)\n/usr/local/go/src/net/http/server.go:2322 (0x100d72017)\n        HandlerFunc.ServeHTTP: f(w, r)\n/Users/heziaharon/go/pkg/mod/github.com/go-chi/chi/v5@v5.2.3/mux.go:73 (0x10197a663)\n        (*Mux).ServeHTTP: mx.handler.ServeHTTP(w, r)\n/Users/heziaharon/go/pkg/mod/github.com/go-chi/chi/v5@v5.2.3/mux.go:321 (0x10197bc53)\n        (*Mux).Mount.func1: handler.ServeHTTP(w, r)\n/usr/local/go/src/net/http/server.go:2322 (0x100d72017)\n        HandlerFunc.ServeHTTP: f(w, r)\n/Users/heziaharon/go/pkg/mod/github.com/go-chi/chi/v5@v5.2.3/mux.go:477 (0x10197c66b)\n        (*Mux).routeHTTP: h.ServeHTTP(w, r)\n/usr/local/go/src/net/http/server.go:2322 (0x100d72017)\n        HandlerFunc.ServeHTTP: f(w, r)\n/Users/heziaharon/go/pkg/mod/github.com/go-chi/chi/v5@v5.2.3/mux.go:73 (0x10197a663)\n        (*Mux).ServeHTTP: mx.handler.ServeHTTP(w, r)\n/Users/heziaharon/go/pkg/mod/github.com/go-chi/chi/v5@v5.2.3/mux.go:321 (0x10197bc53)\n        (*Mux).Mount.func1: handler.ServeHTTP(w, r)\n/usr/local/go/src/net/http/server.go:2322 (0x100d72017)\n        HandlerFunc.ServeHTTP: f(w, r)\n/Users/heziaharon/go/pkg/mod/github.com/go-chi/chi/v5@v5.2.3/mux.go:477 (0x10197c66b)\n        (*Mux).routeHTTP: h.ServeHTTP(w, r)\n/usr/local/go/src/net/http/server.go:2322 (0x100d72017)\n        HandlerFunc.ServeHTTP: f(w, r)\n/Users/heziaharon/Documents/repos/gitea/modules/web/routing/logger_manager.go:122 (0x101979187)\n        (*requestRecordsManager).handler-fm.(*requestRecordsManager).handler.func1: next.ServeHTTP(w, req)\n/usr/local/go/src/net/http/server.go:2322 (0x100d72017)\n        HandlerFunc.ServeHTTP: f(w, r)\n/Users/heziaharon/Documents/repos/gitea/modules/web/handler.go:125 (0x101981883)\n        toHandlerProvider.wrapHandlerProvider[...].func2.1: h.ServeHTTP(resp, req)\n/usr/local/go/src/net/http/server.go:2322 (0x100d72017)\n        HandlerFunc.ServeHTTP: f(w, r)\n/Users/heziaharon/go/pkg/mod/github.com/chi-middleware/proxy@v1.1.1/middleware.go:37 (0x10287523b)\n        ForwardedHeadersHandler.ForwardedHeaders.func1.1: h.ServeHTTP(w, r)\n/usr/local/go/src/net/http/server.go:2322 (0x100d72017)\n        HandlerFunc.ServeHTTP: f(w, r)\n/Users/heziaharon/Documents/repos/gitea/modules/web/handler.go:125 (0x101981883)\n        toHandlerProvider.wrapHandlerProvider[...].func2.1: h.ServeHTTP(resp, req)\n/usr/local/go/src/net/http/server.go:2322 (0x100d72017)\n        HandlerFunc.ServeHTTP: f(w, r)\n/Users/heziaharon/Documents/repos/gitea/routers/common/middleware.go:78 (0x1028774df)\n        ProtocolMiddlewares.RequestContextHandler.func2.1: next.ServeHTTP(respWriter, req)\n/usr/local/go/src/net/http/server.go:2322 (0x100d72017)\n        HandlerFunc.ServeHTTP: f(w, r)\n/Users/heziaharon/Documents/repos/gitea/modules/web/handler.go:125 (0x101981883)\n        toHandlerProvider.wrapHandlerProvider[...].func2.1: h.ServeHTTP(resp, req)\n/usr/local/go/src/net/http/server.go:2322 (0x100d72017)\n        HandlerFunc.ServeHTTP: f(w, r)\n/Users/heziaharon/Documents/repos/gitea/routers/common/middleware.go:93 (0x10287713b)\n        ProtocolMiddlewares.ChiRoutePathHandler.func1.1: next.ServeHTTP(resp, req)\n/usr/local/go/src/net/http/server.go:2322 (0x100d72017)\n        HandlerFunc.ServeHTTP: f(w, r)\n/Users/heziaharon/Documents/repos/gitea/modules/web/handler.go:125 (0x101981883)\n        toHandlerProvider.wrapHandlerProvider[...].func2.1: h.ServeHTTP(resp, req)\n/usr/local/go/src/net/http/server.go:2322 (0x100d72017)\n        HandlerFunc.ServeHTTP: f(w, r)\n/Users/heziaharon/go/pkg/mod/github.com/go-chi/chi/v5@v5.2.3/mux.go:90 (0x10197a623)\n        (*Mux).ServeHTTP: mx.handler.ServeHTTP(w, r)\n/Users/heziaharon/Documents/repos/gitea/modules/web/router.go:243 (0x10198306b)\n        (*Router).normalizeRequestPath: next.ServeHTTP(resp, req)\n/Users/heziaharon/Documents/repos/gitea/modules/web/router.go:181 (0x101982b6f)\n        (*Router).ServeHTTP: r.normalizeRequestPath(w, req, r.chiRouter)\n/usr/local/go/src/net/http/server.go:3340 (0x100d8f1ff)\n        serverHandler.ServeHTTP: handler.ServeHTTP(rw, req)\n/usr/local/go/src/net/http/server.go:2109 (0x100d70407)\n        (*conn).serve: serverHandler{c.server}.ServeHTTP(w, w.req)\n/usr/local/go/src/runtime/asm_arm64.s:1268 (0x100917503)\n        goexit: MOVD    R0, R0  // NOP\n```\n\n### Git Version\n\n 2.39.5\n\n### Operating System\n\nmacos\n\n### How are you running Gitea?\n\nLocal setup `make watch`\n\n### Database\n\nPostgreSQL","closed_by":{"login":"techknowlogick","id":164197,"node_id":"MDQ6VXNlcjE2NDE5Nw==","avatar_url":"https://avatars.githubusercontent.com/u/164197?v=4","gravatar_id":"","url":"https://api.github.com/users/techknowlogick","html_url":"https://github.com/techknowlogick","followers_url":"https://api.github.com/users/techknowlogick/followers","following_url":"https://api.github.com/users/techknowlogick/following{/other_user}","gists_url":"https://api.github.com/users/techknowlogick/gists{/gist_id}","starred_url":"https://api.github.com/users/techknowlogick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/techknowlogick/subscriptions","organizations_url":"https://api.github.com/users/techknowlogick/orgs","repos_url":"https://api.github.com/users/techknowlogick/repos","events_url":"https://api.github.com/users/techknowlogick/events{/privacy}","received_events_url":"https://api.github.com/users/techknowlogick/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/35603/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/go-gitea/gitea/issues/35603/timeline","performed_via_github_app":null,"state_reason":"completed"}