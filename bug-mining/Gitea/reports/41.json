{"url":"https://api.github.com/repos/go-gitea/gitea/issues/26684","repository_url":"https://api.github.com/repos/go-gitea/gitea","labels_url":"https://api.github.com/repos/go-gitea/gitea/issues/26684/labels{/name}","comments_url":"https://api.github.com/repos/go-gitea/gitea/issues/26684/comments","events_url":"https://api.github.com/repos/go-gitea/gitea/issues/26684/events","html_url":"https://github.com/go-gitea/gitea/issues/26684","id":1862856575,"node_id":"I_kwDOBFIx285vCO9_","number":26684,"title":"Hang with 1.20.2/1.20.3","user":{"login":"elburb","id":28685953,"node_id":"MDQ6VXNlcjI4Njg1OTUz","avatar_url":"https://avatars.githubusercontent.com/u/28685953?v=4","gravatar_id":"","url":"https://api.github.com/users/elburb","html_url":"https://github.com/elburb","followers_url":"https://api.github.com/users/elburb/followers","following_url":"https://api.github.com/users/elburb/following{/other_user}","gists_url":"https://api.github.com/users/elburb/gists{/gist_id}","starred_url":"https://api.github.com/users/elburb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elburb/subscriptions","organizations_url":"https://api.github.com/users/elburb/orgs","repos_url":"https://api.github.com/users/elburb/repos","events_url":"https://api.github.com/users/elburb/events{/privacy}","received_events_url":"https://api.github.com/users/elburb/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":472744938,"node_id":"MDU6TGFiZWw0NzI3NDQ5Mzg=","url":"https://api.github.com/repos/go-gitea/gitea/labels/type/bug","name":"type/bug","color":"ee0701","default":false,"description":""}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/go-gitea/gitea/milestones/147","html_url":"https://github.com/go-gitea/gitea/milestone/147","labels_url":"https://api.github.com/repos/go-gitea/gitea/milestones/147/labels","id":9753317,"node_id":"MI_kwDOBFIx284AlNLl","number":147,"title":"1.20.4","description":"","creator":{"login":"delvh","id":51889757,"node_id":"MDQ6VXNlcjUxODg5NzU3","avatar_url":"https://avatars.githubusercontent.com/u/51889757?v=4","gravatar_id":"","url":"https://api.github.com/users/delvh","html_url":"https://github.com/delvh","followers_url":"https://api.github.com/users/delvh/followers","following_url":"https://api.github.com/users/delvh/following{/other_user}","gists_url":"https://api.github.com/users/delvh/gists{/gist_id}","starred_url":"https://api.github.com/users/delvh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/delvh/subscriptions","organizations_url":"https://api.github.com/users/delvh/orgs","repos_url":"https://api.github.com/users/delvh/repos","events_url":"https://api.github.com/users/delvh/events{/privacy}","received_events_url":"https://api.github.com/users/delvh/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":41,"state":"closed","created_at":"2023-08-07T13:18:41Z","updated_at":"2023-09-08T16:06:06Z","due_on":"2023-08-31T07:00:00Z","closed_at":"2023-09-08T16:06:06Z"},"comments":18,"created_at":"2023-08-23T08:42:32Z","updated_at":"2023-10-13T00:01:28Z","closed_at":"2023-08-28T04:06:49Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description\r\n\r\nI run a medium sized, public gitea instance, we have approx 2.5k users with 1k repositories (about 6GB in total).\r\n\r\nStarting with 1.20.2 we started experiencing an issue where, after some seemingly random period, trying to access repositories appears to hang or deadlock, both via the web interface or via SSH. We've got nothing to correlate when the issue occurs, sometimes it happens within a few minutes of restarting, sometimes hours. When it does occur we still seem able to access the web interface for non repository things (i.e. admin admin pages). \r\nI've confirmed the issue still happens in 1.20.3 but it no longer occurs after rolling back to 1.20.1. \r\n\r\nSo far, I've not been able to properly narrow down what is causing the hang.\r\nI see some 'slow' requests in the router logs which just seem indicative of the hanging, but nothing else that seems unusual:\r\n\r\n```\r\n2023/08/23 02:25:04 ...eb/routing/logger.go:68:func1() [W] router: slow      POST /api/internal/ssh/1985/update/3 for <redacted>:0, elapsed 3354.7ms @ private/key.go:16(private.UpdatePublicKeyInRepo)\r\n2023/08/23 02:25:06 ...eb/routing/logger.go:68:func1() [W] router: slow      POST /api/internal/ssh/1985/update/3 for <redacted>:0, elapsed 3269.4ms @ private/key.go:16(private.UpdatePublicKeyInRepo)\r\n```\r\n\r\nOn the host, I see a bunch of waiting processes, but I think that is also just showing normal activity that is hung ?\r\n\r\n```\r\ngit      1251330 1251329  0 Aug22 ?        00:00:00 -bash\r\ngit      1405726       1  0 06:58 ?        00:01:58 /home/git/gitea web\r\ngit      1417492 1405726  0 07:44 ?        00:00:00 /usr/bin/git -c protocol.version=2 -c credential.helper= -c filter.lfs.required= -c filter.lfs.smudge= -c filter.lfs.clean= cat-file --batch\r\ngit      1417493 1405726  0 07:44 ?        00:00:00 /usr/bin/git -c protocol.version=2 -c credential.helper= -c filter.lfs.required= -c filter.lfs.smudge= -c filter.lfs.clean= cat-file --batch-check\r\ngit      1417628 1405726  0 07:44 ?        00:00:00 /usr/bin/git -c protocol.version=2 -c credential.helper= -c filter.lfs.required= -c filter.lfs.smudge= -c filter.lfs.clean= cat-file --batch-check\r\ngit      1417629 1405726  0 07:44 ?        00:00:01 /usr/bin/git -c protocol.version=2 -c credential.helper= -c filter.lfs.required= -c filter.lfs.smudge= -c filter.lfs.clean= cat-file --batch\r\ngit      1420047       1  0 07:58 ?        00:00:00 /usr/lib/git-core/git remote-https origin https://oauth2:<redacted>@git.dn42.dev/dn42/registry.git\r\ngit      1420048 1420047  0 07:58 ?        00:00:02 /usr/lib/git-core/git-remote-https origin https://oauth2:<redacted>@git.dn42.dev/dn42/registry.git\r\ngit      1421921       1  0 08:08 ?        00:00:00 /usr/lib/git-core/git remote-https origin https://oauth2:<redacted>@git.dn42.dev/dn42/registry.git\r\ngit      1421922 1421921  0 08:08 ?        00:00:01 /usr/lib/git-core/git-remote-https origin https://oauth2:<redacted>@git.dn42.dev/dn42/registry.git\r\ngit      1422176       1  0 08:10 ?        00:00:00 /lib/systemd/systemd --user\r\ngit      1422177 1422176  0 08:10 ?        00:00:00 (sd-pam)\r\ngit      1423695       1  0 08:18 ?        00:00:00 /usr/lib/git-core/git remote-https origin https://oauth2:<redacted>@git.dn42.dev/dn42/registry.git\r\ngit      1423696 1423695  0 08:18 ?        00:00:01 /usr/lib/git-core/git-remote-https origin https://oauth2:<redacted>@git.dn42.dev/dn42/registry.git\r\ngit      1425427       1  0 08:28 ?        00:00:00 /usr/lib/git-core/git remote-https origin https://oauth2:<redacted>@git.dn42.dev/dn42/registry.git\r\ngit      1425428 1425427  0 08:28 ?        00:00:00 /usr/lib/git-core/git-remote-https origin https://oauth2:<redacted>@git.dn42.dev/dn42/registry.git\r\ngit      1428317 1405726  0 08:44 ?        00:00:00 /usr/bin/git -c protocol.version=2 -c credential.helper= -c filter.lfs.required= -c filter.lfs.smudge= -c filter.lfs.clean= cat-file --batch\r\ngit      1428318 1405726  0 08:44 ?        00:00:00 /usr/bin/git -c protocol.version=2 -c credential.helper= -c filter.lfs.required= -c filter.lfs.smudge= -c filter.lfs.clean= cat-file --batch-check\r\ngit      1428442       1  0 08:44 ?        00:00:00 /home/git/gitea --config=/home/git/custom/conf/app.ini serv key-1478\r\ngit      1428470 1428455  0 08:45 ?        00:00:00 sshd: git@notty\r\ngit      1428471 1428470  0 08:45 ?        00:00:00 /home/git/gitea --config=/home/git/custom/conf/app.ini serv key-1985\r\ngit      1428498 1428457  0 08:45 ?        00:00:00 sshd: git@notty\r\ngit      1428499 1428498  0 08:45 ?        00:00:00 /home/git/gitea --config=/home/git/custom/conf/app.ini serv key-358\r\ngit      1428521 1428485  0 08:45 ?        00:00:00 sshd: git@notty\r\ngit      1428531 1428487  0 08:45 ?        00:00:00 sshd: git@notty\r\ngit      1428532 1428521  0 08:45 ?        00:00:00 /home/git/gitea --config=/home/git/custom/conf/app.ini serv key-237\r\ngit      1428546 1428531  0 08:45 ?        00:00:00 /home/git/gitea --config=/home/git/custom/conf/app.ini serv key-586\r\ngit      1428571 1428557  0 08:45 ?        00:00:00 sshd: git@notty\r\ngit      1428572 1428571  0 08:45 ?        00:00:00 /home/git/gitea --config=/home/git/custom/conf/app.ini serv key-1985\r\ngit      1428599 1428588  0 08:45 ?        00:00:00 sshd: git@notty\r\ngit      1428600 1428599  0 08:45 ?        00:00:00 /home/git/gitea --config=/home/git/custom/conf/app.ini serv key-357\r\n```\r\n\r\n`gitea doctor check --all` came back clean and I've also run `gitea doctor recreate-table` without any obvious impact.\r\n\r\nWithout seeing a specific error, I'm at a loss as to what else to look for so would appreciate some initial advice or guide on what I can do to get some additional information and narrow down what the root cause would be ?\r\n\r\n\r\n### Gitea Version\r\n\r\n1.20.2 & 1.20.3\r\n\r\n### Can you reproduce the bug on the Gitea demo site?\r\n\r\nNo\r\n\r\n### Log Gist\r\n\r\n_No response_\r\n\r\n### Screenshots\r\n\r\n_No response_\r\n\r\n### Git Version\r\n\r\n2.34.1\r\n\r\n### Operating System\r\n\r\n_No response_\r\n\r\n### How are you running Gitea?\r\n\r\nWe are running gitea downloaded as a binary from https://github.com/go-gitea/gitea/releases as a systemd service under ubuntu 22.04.3. Gitea is proxied by traefik for web connections.\r\n\r\n### Database\r\n\r\nSQLite","closed_by":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/26684/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/go-gitea/gitea/issues/26684/timeline","performed_via_github_app":null,"state_reason":"completed"}