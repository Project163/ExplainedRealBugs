{"url":"https://api.github.com/repos/go-gitea/gitea/issues/34254","repository_url":"https://api.github.com/repos/go-gitea/gitea","labels_url":"https://api.github.com/repos/go-gitea/gitea/issues/34254/labels{/name}","comments_url":"https://api.github.com/repos/go-gitea/gitea/issues/34254/comments","events_url":"https://api.github.com/repos/go-gitea/gitea/issues/34254/events","html_url":"https://github.com/go-gitea/gitea/issues/34254","id":3008578365,"node_id":"I_kwDOBFIx286zU0M9","number":34254,"title":"Gitea v1.23.7 crashes on force-push to existing PR","user":{"login":"andrewimeson","id":6353225,"node_id":"MDQ6VXNlcjYzNTMyMjU=","avatar_url":"https://avatars.githubusercontent.com/u/6353225?v=4","gravatar_id":"","url":"https://api.github.com/users/andrewimeson","html_url":"https://github.com/andrewimeson","followers_url":"https://api.github.com/users/andrewimeson/followers","following_url":"https://api.github.com/users/andrewimeson/following{/other_user}","gists_url":"https://api.github.com/users/andrewimeson/gists{/gist_id}","starred_url":"https://api.github.com/users/andrewimeson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andrewimeson/subscriptions","organizations_url":"https://api.github.com/users/andrewimeson/orgs","repos_url":"https://api.github.com/users/andrewimeson/repos","events_url":"https://api.github.com/users/andrewimeson/events{/privacy}","received_events_url":"https://api.github.com/users/andrewimeson/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":472744938,"node_id":"MDU6TGFiZWw0NzI3NDQ5Mzg=","url":"https://api.github.com/repos/go-gitea/gitea/labels/type/bug","name":"type/bug","color":"ee0701","default":false,"description":""}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/go-gitea/gitea/milestones/178","html_url":"https://github.com/go-gitea/gitea/milestone/178","labels_url":"https://api.github.com/repos/go-gitea/gitea/milestones/178/labels","id":12689621,"node_id":"MI_kwDOBFIx284AwaDV","number":178,"title":"1.23.8","description":"","creator":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":32,"state":"closed","created_at":"2025-04-07T18:31:43Z","updated_at":"2025-05-13T02:11:30Z","due_on":null,"closed_at":"2025-05-12T22:08:10Z"},"comments":1,"created_at":"2025-04-21T14:44:16Z","updated_at":"2025-07-23T06:17:08Z","closed_at":"2025-04-24T01:58:01Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description\n\nSince upgrading to Gitea 1.23.7 (previously on 1.22.6) last week we have had two Gitea application crashes after I force pushed to an existing branch with a PR. The first time I had to delete a corrupted Bleve index to get Gitea started again.\n\nI captured the last logs from the pod crash on the second crash\n\n```\n2025/04/21 14:08:44 .../graceful/manager.go:86:func1() [E] PANIC during RunWithShutdownContext: runtime error: invalid memory address or nil pointer dereference\nStacktrace: /usr/local/go/src/runtime/panic.go:262 (0x47bad8)\n/usr/local/go/src/runtime/signal_unix.go:917 (0x47baa8)\n/go/src/code.gitea.io/gitea/models/issues/comment.go:347 (0x20fa62a)\n/go/src/code.gitea.io/gitea/services/issue/assignee.go:256 (0x20fa636)\n/go/src/code.gitea.io/gitea/services/issue/assignee.go:246 (0x20fa478)\n/go/src/code.gitea.io/gitea/services/pull/pull.go:453 (0x2128a34)\n/go/src/code.gitea.io/gitea/modules/graceful/manager.go:92 (0xc97f9a)\n/go/src/code.gitea.io/gitea/services/pull/pull.go:366 (0x2127baf)\n/usr/local/go/src/runtime/asm_amd64.s:1700 (0x482060)\n2025/04/21 14:08:44 ...eful/server_hooks.go:46:doShutdown() [I] PID: 7 Listener ([::]:2222) closed.\n2025/04/21 14:08:44 ...eb/routing/logger.go:102:func1() [I] router: completed GET /user/events for 172.22.1.132:52768, 200 OK in 1795381.0ms @ events/events.go:18(events.Events)\n2025/04/21 14:08:44 ...eb/routing/logger.go:102:func1() [I] router: completed GET /user/events for 172.22.1.132:49918, 200 OK in 362813.7ms @ events/events.go:18(events.Events)\n2025/04/21 14:08:44 ...eb/routing/logger.go:102:func1() [I] router: completed GET /user/events for 172.22.1.132:57122, 200 OK in 651246.4ms @ events/events.go:18(events.Events)\n2025/04/21 14:08:44 ...eb/routing/logger.go:102:func1() [I] router: completed GET /user/events for 172.22.1.132:60322, 200 OK in 241506.3ms @ events/events.go:18(events.Events)\n2025/04/21 14:08:44 ...eb/routing/logger.go:102:func1() [I] router: completed GET /user/events for 172.22.1.132:60608, 200 OK in 595014.4ms @ events/events.go:18(events.Events)\n2025/04/21 14:08:44 ...eb/routing/logger.go:102:func1() [I] router: completed GET /user/events for 172.22.1.132:37466, 200 OK in 1788841.8ms @ events/events.go:18(events.Events)\n2025/04/21 14:08:44 cmd/web.go:366:listen() [I] HTTP Listener: 0.0.0.0:3000 Closed\n2025/04/21 14:08:44 ...eful/server_hooks.go:46:doShutdown() [I] PID: 7 Listener ([::]:3000) closed.\n2025/04/21 14:09:44 .../graceful/manager.go:168:doHammerTime() [W] Setting Hammer condition\n2025/04/21 14:09:44 ...eful/server_hooks.go:63:doHammer() [W] Forcefully shutting down parent\n2025/04/21 14:09:44 .../ssh/ssh_graceful.go:28:listen() [I] SSH Listener: :2222 Closed\n2025/04/21 14:09:45 .../graceful/manager.go:184:doTerminate() [W] Terminating\n2025/04/21 14:09:45 ...er/issues/indexer.go:120:2() [I] PID: 7 Issue Indexer closed\n2025/04/21 14:09:45 ...exer/code/indexer.go:112:func1() [I] PID: 7 Repository Indexer closed\n2025/04/21 14:09:45 ...eful/manager_unix.go:154:handleSignals() [W] PID: 7. Background context for manager closed - context canceled - Shutting down...\n2025/04/21 14:09:45 cmd/web.go:225:serveInstalled() [I] PID: 7 Gitea Web Finished\n```\n\n### Gitea Version\n\n1.23.7\n\n### Can you reproduce the bug on the Gitea demo site?\n\nNo\n\n### Log Gist\n\n_No response_\n\n### Screenshots\n\n_No response_\n\n### Git Version\n\n2.47.2\n\n### Operating System\n\nAlpine Linux v3.21\n\n### How are you running Gitea?\n\nGitea Helm chart v9.5.1 with non-HA Postgres on Kubernetes.\n\n### Database\n\nPostgreSQL","closed_by":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/34254/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/go-gitea/gitea/issues/34254/timeline","performed_via_github_app":null,"state_reason":"completed"}