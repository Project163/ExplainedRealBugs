{"url":"https://api.github.com/repos/go-gitea/gitea/issues/30119","repository_url":"https://api.github.com/repos/go-gitea/gitea","labels_url":"https://api.github.com/repos/go-gitea/gitea/issues/30119/labels{/name}","comments_url":"https://api.github.com/repos/go-gitea/gitea/issues/30119/comments","events_url":"https://api.github.com/repos/go-gitea/gitea/issues/30119/events","html_url":"https://github.com/go-gitea/gitea/issues/30119","id":2209535289,"node_id":"I_kwDOBFIx286DstU5","number":30119,"title":"Commits which include `encoding` header fail to verify when otherwise valid","user":{"login":"logancollins","id":714246,"node_id":"MDQ6VXNlcjcxNDI0Ng==","avatar_url":"https://avatars.githubusercontent.com/u/714246?v=4","gravatar_id":"","url":"https://api.github.com/users/logancollins","html_url":"https://github.com/logancollins","followers_url":"https://api.github.com/users/logancollins/followers","following_url":"https://api.github.com/users/logancollins/following{/other_user}","gists_url":"https://api.github.com/users/logancollins/gists{/gist_id}","starred_url":"https://api.github.com/users/logancollins/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/logancollins/subscriptions","organizations_url":"https://api.github.com/users/logancollins/orgs","repos_url":"https://api.github.com/users/logancollins/repos","events_url":"https://api.github.com/users/logancollins/events{/privacy}","received_events_url":"https://api.github.com/users/logancollins/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":472744938,"node_id":"MDU6TGFiZWw0NzI3NDQ5Mzg=","url":"https://api.github.com/repos/go-gitea/gitea/labels/type/bug","name":"type/bug","color":"ee0701","default":false,"description":""}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/go-gitea/gitea/milestones/162","html_url":"https://github.com/go-gitea/gitea/milestone/162","labels_url":"https://api.github.com/repos/go-gitea/gitea/milestones/162/labels","id":10731551,"node_id":"MI_kwDOBFIx284Ao8Af","number":162,"title":"1.21.11","description":"","creator":{"login":"6543","id":24977596,"node_id":"MDQ6VXNlcjI0OTc3NTk2","avatar_url":"https://avatars.githubusercontent.com/u/24977596?v=4","gravatar_id":"","url":"https://api.github.com/users/6543","html_url":"https://github.com/6543","followers_url":"https://api.github.com/users/6543/followers","following_url":"https://api.github.com/users/6543/following{/other_user}","gists_url":"https://api.github.com/users/6543/gists{/gist_id}","starred_url":"https://api.github.com/users/6543/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/6543/subscriptions","organizations_url":"https://api.github.com/users/6543/orgs","repos_url":"https://api.github.com/users/6543/repos","events_url":"https://api.github.com/users/6543/events{/privacy}","received_events_url":"https://api.github.com/users/6543/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":44,"state":"closed","created_at":"2024-03-25T23:50:26Z","updated_at":"2024-04-16T03:32:56Z","due_on":null,"closed_at":"2024-04-16T03:32:42Z"},"comments":1,"created_at":"2024-03-26T23:42:37Z","updated_at":"2024-06-28T05:59:24Z","closed_at":"2024-03-29T21:55:12Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description\r\n\r\nHello! I'm an engineer on the [Nova](https://nova.app) project, an IDE for the Mac. As a tiny bit of context that becomes important later, we use [libgit2](http://libgit2.org) for our Git integration.\r\n\r\nWe received a report that a user who utilizes SSH keys for commit signing was seeing those made in Nova as invalid in Gitea. After some diagnosis, we found that the Git CLI was showing them as valid, but not once pushed to Gitea. We were then able to replicate this same behavior in our testing instance of Gitea 1.21.8.\r\n\r\nAfter looking deeper, it seems that the only difference between commits made with the Git CLI and Nova is that those from Nova/libgit2 include an `encoding` header in the commit object, set to `UTF-8`. As far as I've been able to determine, this is the default value from Git's spec, and presumably the Git CLI just never includes it for succinctness. libgit2, however, is including it always.\r\n\r\nIf we disable inclusion of that header, Gitea will validate the commits just fine, the same as those from the Git CLI.\r\n\r\nI am _not versed_ in Go code at all (so please forgive me!) but I think I've traced the issue to somewhere around [this chunk of code](https://github.com/go-gitea/gitea/blob/f47e00d9d3c3bd58b5944a29c4ff5cec0357520a/modules/git/commit_reader.go#L72). I'm guessing that either it's not considering any header name which it doesn't already handle (and thus is dropping them from the payload that is used for validation) or something similar.\r\n\r\nIf I've glossed over anything important, just let me know, and thank you to the maintainers for your time!\r\n\r\n### Gitea Version\r\n\r\n1.21.8\r\n\r\n### Can you reproduce the bug on the Gitea demo site?\r\n\r\nYes\r\n\r\n### Log Gist\r\n\r\n_No response_\r\n\r\n### Screenshots\r\n\r\n<img width=\"1326\" alt=\"Screenshot 2024-03-26 at 4 39 59â€¯PM\" src=\"https://github.com/go-gitea/gitea/assets/714246/d3737118-c309-4934-9732-73cfc1686db4\">\r\n\r\n\r\n### Git Version\r\n\r\n2.44.0\r\n\r\n### Operating System\r\n\r\nLinux / Ubuntu in Docker\r\n\r\n### How are you running Gitea?\r\n\r\nWe are running the self-installable Gitea instance running in Docker for testing purposes. I am not sure what our reporting user's instance was running in, or whether it was a self-instance or a Cloud / Enterprise instance. If you need, I can have our support team reach out and ask.\r\n\r\n### Database\r\n\r\nSQLite","closed_by":{"login":"KN4CK3R","id":1666336,"node_id":"MDQ6VXNlcjE2NjYzMzY=","avatar_url":"https://avatars.githubusercontent.com/u/1666336?v=4","gravatar_id":"","url":"https://api.github.com/users/KN4CK3R","html_url":"https://github.com/KN4CK3R","followers_url":"https://api.github.com/users/KN4CK3R/followers","following_url":"https://api.github.com/users/KN4CK3R/following{/other_user}","gists_url":"https://api.github.com/users/KN4CK3R/gists{/gist_id}","starred_url":"https://api.github.com/users/KN4CK3R/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/KN4CK3R/subscriptions","organizations_url":"https://api.github.com/users/KN4CK3R/orgs","repos_url":"https://api.github.com/users/KN4CK3R/repos","events_url":"https://api.github.com/users/KN4CK3R/events{/privacy}","received_events_url":"https://api.github.com/users/KN4CK3R/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/30119/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/go-gitea/gitea/issues/30119/timeline","performed_via_github_app":null,"state_reason":"completed"}