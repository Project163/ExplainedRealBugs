{"url":"https://api.github.com/repos/go-gitea/gitea/issues/35221","repository_url":"https://api.github.com/repos/go-gitea/gitea","labels_url":"https://api.github.com/repos/go-gitea/gitea/issues/35221/labels{/name}","comments_url":"https://api.github.com/repos/go-gitea/gitea/issues/35221/comments","events_url":"https://api.github.com/repos/go-gitea/gitea/issues/35221/events","html_url":"https://github.com/go-gitea/gitea/issues/35221","id":3296687028,"node_id":"I_kwDOBFIx287Ef3O0","number":35221,"title":"Tags API returns incomplete array if any tag's commit message is too long","user":{"login":"meyfa-lawo","id":224951904,"node_id":"U_kgDODWh-YA","avatar_url":"https://avatars.githubusercontent.com/u/224951904?v=4","gravatar_id":"","url":"https://api.github.com/users/meyfa-lawo","html_url":"https://github.com/meyfa-lawo","followers_url":"https://api.github.com/users/meyfa-lawo/followers","following_url":"https://api.github.com/users/meyfa-lawo/following{/other_user}","gists_url":"https://api.github.com/users/meyfa-lawo/gists{/gist_id}","starred_url":"https://api.github.com/users/meyfa-lawo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/meyfa-lawo/subscriptions","organizations_url":"https://api.github.com/users/meyfa-lawo/orgs","repos_url":"https://api.github.com/users/meyfa-lawo/repos","events_url":"https://api.github.com/users/meyfa-lawo/events{/privacy}","received_events_url":"https://api.github.com/users/meyfa-lawo/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":472744938,"node_id":"MDU6TGFiZWw0NzI3NDQ5Mzg=","url":"https://api.github.com/repos/go-gitea/gitea/labels/type/bug","name":"type/bug","color":"ee0701","default":false,"description":""},{"id":6630259220,"node_id":"LA_kwDOBFIx288AAAABizG6FA","url":"https://api.github.com/repos/go-gitea/gitea/labels/topic/api","name":"topic/api","color":"A20C87","default":false,"description":"Concerns mainly the API"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/go-gitea/gitea/milestones/185","html_url":"https://github.com/go-gitea/gitea/milestone/185","labels_url":"https://api.github.com/repos/go-gitea/gitea/milestones/185/labels","id":13483819,"node_id":"MI_kwDOBFIx284Azb8r","number":185,"title":"1.24.6","description":"","creator":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":27,"state":"closed","created_at":"2025-08-13T16:00:25Z","updated_at":"2025-09-11T03:57:23Z","due_on":"2025-08-25T07:00:00Z","closed_at":"2025-09-11T03:57:23Z"},"comments":0,"created_at":"2025-08-06T13:18:15Z","updated_at":"2025-08-28T17:22:20Z","closed_at":"2025-08-28T10:18:56Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description\n\nWe have a repository with a total of 43 tags, which is also reflected correctly in Gitea's UI, both on the repo's main page header, as well as the Releases tab. However, performing an HTTP GET to `/api/v1/repos/org-name/repo-name/tags` yields an array containing only 29 entries, and the `X-Total-Count` header also has a value of 29.\n\nI tracked the relevant Gitea code down to the function `GetTagInfos`: https://github.com/go-gitea/gitea/blob/de4ab417287e27ebeef999bc06ac220a8da0ca47/modules/git/repo_tag.go#L108\n\nFrom that, we can construct the Git command and write its output to a file (gitrefs.txt):\n\n```\ngit for-each-ref --format=\"objecttype %(objecttype)%00refname:lstrip=2 %(refname:lstrip=2)%00object %(object)%00objectname %(objectname)%00creator %(creator)%00contents %(contents)%00contents:signature %(contents:signature)%00%00\" --sort '-*creatordate' refs/tags >gitrefs.txt\n```\n\nLooking at gitrefs.txt I could see that the 29 tags returned are exactly the first 29 entries in gitrefs.txt. The 30th tag and beyond are not included in Gitea's API response. The 30th commit has a very long commit message >100 kiB, which is an unfortunate result of our release process, but we are unable to change this retroactively.\n\nI tracked the source of the problem further to this line: https://github.com/go-gitea/gitea/blob/de4ab417287e27ebeef999bc06ac220a8da0ca47/modules/git/foreachref/parser.go#L72\n\nWhen `p.scanner.Scan()` returns false, `p.scanner.Err()` should be checked, which is not currently done. I patched it locally, ran it on gitrefs.txt, and voil√°, it prints \"bufio.Scanner: token too long\" due to the default 64 kiB internal buffer in `bufio.Scanner`, which is too small for the offending tag's commit message.\n\nDemo:\n\n- UI shows 3 tags: https://demo.gitea.com/meyfa-lawo/tags-foreachref/tags\n- API shows just the first tag: https://demo.gitea.com/api/v1/repos/meyfa-lawo/tags-foreachref/tags\n\n### Gitea Version\n\n1.24.3\n\n### Can you reproduce the bug on the Gitea demo site?\n\nYes\n\n### Log Gist\n\n_No response_\n\n### Screenshots\n\nLog of the GET request, which returns 200 OK because the error is never checked:\n\n```\nJul 25 15:51:20 REDACTED docker[REDACTED]: 2025/07/25 13:51:20 HTTPRequest [I] router: completed GET /api/v1/repos/REDACTED/REDACTED/tags for 172.17.0.1:33324, 200 OK in 11.9ms @ repo/tag.go:25(repo.ListTags)\n```\n\n### Git Version\n\n2.49.1\n\n### Operating System\n\nLinux (amd64)\n\n### How are you running Gitea?\n\nPrebuilt official OCI image\n\n### Database\n\nSQLite","closed_by":{"login":"wxiaoguang","id":2114189,"node_id":"MDQ6VXNlcjIxMTQxODk=","avatar_url":"https://avatars.githubusercontent.com/u/2114189?v=4","gravatar_id":"","url":"https://api.github.com/users/wxiaoguang","html_url":"https://github.com/wxiaoguang","followers_url":"https://api.github.com/users/wxiaoguang/followers","following_url":"https://api.github.com/users/wxiaoguang/following{/other_user}","gists_url":"https://api.github.com/users/wxiaoguang/gists{/gist_id}","starred_url":"https://api.github.com/users/wxiaoguang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wxiaoguang/subscriptions","organizations_url":"https://api.github.com/users/wxiaoguang/orgs","repos_url":"https://api.github.com/users/wxiaoguang/repos","events_url":"https://api.github.com/users/wxiaoguang/events{/privacy}","received_events_url":"https://api.github.com/users/wxiaoguang/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/35221/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/go-gitea/gitea/issues/35221/timeline","performed_via_github_app":null,"state_reason":"completed"}