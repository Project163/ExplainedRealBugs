{"url":"https://api.github.com/repos/go-gitea/gitea/issues/35895","repository_url":"https://api.github.com/repos/go-gitea/gitea","labels_url":"https://api.github.com/repos/go-gitea/gitea/issues/35895/labels{/name}","comments_url":"https://api.github.com/repos/go-gitea/gitea/issues/35895/comments","events_url":"https://api.github.com/repos/go-gitea/gitea/issues/35895/events","html_url":"https://github.com/go-gitea/gitea/issues/35895","id":3600257119,"node_id":"I_kwDOBFIx287Wl5Bf","number":35895,"title":"Conda package registry invalid when package's dependency is empty","user":{"login":"Luohaothu","id":11592910,"node_id":"MDQ6VXNlcjExNTkyOTEw","avatar_url":"https://avatars.githubusercontent.com/u/11592910?v=4","gravatar_id":"","url":"https://api.github.com/users/Luohaothu","html_url":"https://github.com/Luohaothu","followers_url":"https://api.github.com/users/Luohaothu/followers","following_url":"https://api.github.com/users/Luohaothu/following{/other_user}","gists_url":"https://api.github.com/users/Luohaothu/gists{/gist_id}","starred_url":"https://api.github.com/users/Luohaothu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Luohaothu/subscriptions","organizations_url":"https://api.github.com/users/Luohaothu/orgs","repos_url":"https://api.github.com/users/Luohaothu/repos","events_url":"https://api.github.com/users/Luohaothu/events{/privacy}","received_events_url":"https://api.github.com/users/Luohaothu/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":472744938,"node_id":"MDU6TGFiZWw0NzI3NDQ5Mzg=","url":"https://api.github.com/repos/go-gitea/gitea/labels/type/bug","name":"type/bug","color":"ee0701","default":false,"description":""},{"id":4102834064,"node_id":"LA_kwDOBFIx2870jEeQ","url":"https://api.github.com/repos/go-gitea/gitea/labels/topic/packages","name":"topic/packages","color":"AFE667","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2025-11-07T13:04:20Z","updated_at":"2025-11-08T15:29:19Z","closed_at":"2025-11-08T15:29:19Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description\n\nFor uploading a conda package with 0 dependency, the conda client will report an error on later `conda search`. For example:\n\n```\nLoading channels: failed\n\n# >>>>>>>>>>>>>>>>>>>>>> ERROR REPORT <<<<<<<<<<<<<<<<<<<<<<\n\n    Traceback (most recent call last):\n      File \"/opt/homebrew/Caskroom/miniconda/base/lib/python3.13/site-packages/conda/exception_handler.py\", line 28, in __call__\n        return func(*args, **kwargs)\n      File \"/opt/homebrew/Caskroom/miniconda/base/lib/python3.13/site-packages/conda/cli/main.py\", line 61, in main_subshell\n        exit_code = do_call(args, parser)\n      File \"/opt/homebrew/Caskroom/miniconda/base/lib/python3.13/site-packages/conda/cli/conda_argparse.py\", line 205, in do_call\n        result = getattr(module, func_name)(args, parser)\n      File \"/opt/homebrew/Caskroom/miniconda/base/lib/python3.13/site-packages/conda/cli/main_search.py\", line 237, in execute\n        SubdirData.query_all(spec, channel_urls, subdirs),\n        ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n      File \"/opt/homebrew/Caskroom/miniconda/base/lib/python3.13/site-packages/conda/core/subdir_data.py\", line 207, in query_all\n        result = tuple(\n            chain.from_iterable(executor.map(subdir_query, channel_urls))\n        )\n      File \"/opt/homebrew/Caskroom/miniconda/base/lib/python3.13/concurrent/futures/_base.py\", line 619, in result_iterator\n        yield _result_or_cancel(fs.pop())\n              ~~~~~~~~~~~~~~~~~^^^^^^^^^^\n      File \"/opt/homebrew/Caskroom/miniconda/base/lib/python3.13/concurrent/futures/_base.py\", line 317, in _result_or_cancel\n        return fut.result(timeout)\n               ~~~~~~~~~~^^^^^^^^^\n      File \"/opt/homebrew/Caskroom/miniconda/base/lib/python3.13/concurrent/futures/_base.py\", line 456, in result\n        return self.__get_result()\n               ~~~~~~~~~~~~~~~~~^^\n      File \"/opt/homebrew/Caskroom/miniconda/base/lib/python3.13/concurrent/futures/_base.py\", line 401, in __get_result\n        raise self._exception\n      File \"/opt/homebrew/Caskroom/miniconda/base/lib/python3.13/concurrent/futures/thread.py\", line 59, in run\n        result = self.fn(*self.args, **self.kwargs)\n      File \"/opt/homebrew/Caskroom/miniconda/base/lib/python3.13/site-packages/conda/core/subdir_data.py\", line 192, in subdir_query\n        return tuple(\n            SubdirData(Channel(url), repodata_fn=repodata_fn).query(\n                package_ref_or_match_spec\n            )\n        )\n      File \"/opt/homebrew/Caskroom/miniconda/base/lib/python3.13/site-packages/conda/core/subdir_data.py\", line 229, in query\n        for prec in self._iter_records_by_name(package_name):\n                    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^\n      File \"/opt/homebrew/Caskroom/miniconda/base/lib/python3.13/site-packages/conda/core/subdir_data.py\", line 423, in _iter_records_by_name\n        yield self._package_records[i]\n              ~~~~~~~~~~~~~~~~~~~~~^^^\n      File \"/opt/homebrew/Caskroom/miniconda/base/lib/python3.13/site-packages/conda/core/subdir_data.py\", line 111, in __getitem__\n        record = PackageRecord(**record)\n      File \"/opt/homebrew/Caskroom/miniconda/base/lib/python3.13/site-packages/conda/auxlib/entity.py\", line 754, in __call__\n        instance = super().__call__(*args, **kwargs)\n      File \"/opt/homebrew/Caskroom/miniconda/base/lib/python3.13/site-packages/conda/models/records.py\", line 499, in __init__\n        super().__init__(*args, **kwargs)\n        ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^\n      File \"/opt/homebrew/Caskroom/miniconda/base/lib/python3.13/site-packages/conda/auxlib/entity.py\", line 770, in __init__\n        setattr(self, key, kwargs[key])\n        ~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^\n      File \"/opt/homebrew/Caskroom/miniconda/base/lib/python3.13/site-packages/conda/auxlib/entity.py\", line 437, in __set__\n        instance.__dict__[self.name] = self.validate(\n                                       ~~~~~~~~~~~~~^\n            instance,\n            ^^^^^^^^^\n            self.box(instance, instance.__class__, val),\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        )\n        ^\n      File \"/opt/homebrew/Caskroom/miniconda/base/lib/python3.13/site-packages/conda/auxlib/entity.py\", line 625, in validate\n        val = super().validate(instance, val)\n      File \"/opt/homebrew/Caskroom/miniconda/base/lib/python3.13/site-packages/conda/auxlib/entity.py\", line 482, in validate\n        raise ValidationError(getattr(self, 'name', 'undefined name'), val)\n    conda.auxlib.exceptions.ValidationError: Value for depends cannot be None.\n\n`$ /opt/homebrew/Caskroom/miniconda/base/bin/conda search none -c http://10.10.10.15:3000/api/packages/leo/conda`\n\n  environment variables:\n                 CIO_TEST=<not set>\n    CONDA_ALLOW_SOFTLINKS=false\n        CONDA_DEFAULT_ENV=base\n                CONDA_EXE=/opt/homebrew/Caskroom/miniconda/base/bin/conda\n             CONDA_PREFIX=/opt/homebrew/Caskroom/miniconda/base\n    CONDA_PROMPT_MODIFIER=(base)\n         CONDA_PYTHON_EXE=/opt/homebrew/Caskroom/miniconda/base/bin/python\n               CONDA_ROOT=/opt/homebrew/Caskroom/miniconda/base\n              CONDA_SHLVL=1\n           CURL_CA_BUNDLE=<not set>\n                 INFOPATH=/opt/homebrew/share/info:\n               LD_PRELOAD=<not set>\n                     PATH=/opt/homebrew/Caskroom/miniconda/base/bin:/opt/homebrew/Caskroom/minic\n                          onda/base/condabin:/opt/homebrew/opt/sphinx-doc/bin:/Users/luohao/bin:\n                          /Users/luohao/projects/llvm-10-\n                          install/bin:/opt/homebrew/opt/llvm@11/bin:/opt/homebrew/opt/bison/bin:\n                          /opt/homebrew/opt/sphinx-doc/bin:/opt/homebrew/opt/llvm/bin:/Users/luo\n                          hao/Library/Python/3.9/bin:/opt/homebrew/bin:/usr/local/opt/node@12/bi\n                          n:/usr/local/opt/make/libexec/gnubin:/opt/homebrew/bin:/opt/homebrew/s\n                          bin:/Users/luohao/.cargo/bin:/usr/local/bin:/System/Cryptexes/App/usr/\n                          bin:/usr/bin:/bin:/usr/sbin:/sbin:/var/run/com.apple.security.cryptexd\n                          /codex.system/bootstrap/usr/local/bin:/var/run/com.apple.security.cryp\n                          texd/codex.system/bootstrap/usr/bin:/var/run/com.apple.security.crypte\n                          xd/codex.system/bootstrap/usr/appleinternal/bin:/opt/X11/bin:/Library/\n                          Apple/usr/bin:/Library/TeX/texbin:/Applications/iTerm.app/Contents/Res\n                          ources/utilities:/Users/luohao/.orbstack/bin:/Applications/极空间.app/Con\n                          tents/Resources/app.asar.unpacked/bin/platform-tools\n       REQUESTS_CA_BUNDLE=<not set>\n       SCRCPY_SERVER_PATH=/Applications/极空间.app/Contents/Resources/app.asar.unpacked/bin/platfor\n                          m-tools/scrcpy-server\n            SSL_CERT_FILE=<not set>\n\n     active environment : base\n    active env location : /opt/homebrew/Caskroom/miniconda/base\n            shell level : 1\n       user config file : /Users/luohao/.condarc\n populated config files : /opt/homebrew/Caskroom/miniconda/base/.condarc\n                          /Users/luohao/.condarc\n          conda version : 25.9.1\n    conda-build version : 25.9.0\n         python version : 3.13.9.final.0\n                 solver : libmamba (default)\n       virtual packages : __archspec=1=m1\n                          __conda=25.9.1=0\n                          __osx=26.0.1=0\n                          __unix=0=0\n       base environment : /opt/homebrew/Caskroom/miniconda/base  (writable)\n      conda av data dir : /opt/homebrew/Caskroom/miniconda/base/etc/conda\n  conda av metadata url : None\n           channel URLs : http://10.10.10.15:3000/api/packages/leo/conda/osx-arm64\n                          http://10.10.10.15:3000/api/packages/leo/conda/noarch\n                          https://conda.anaconda.org/conda-forge/osx-arm64\n                          https://conda.anaconda.org/conda-forge/noarch\n                          https://repo.anaconda.com/pkgs/main/osx-arm64\n                          https://repo.anaconda.com/pkgs/main/noarch\n                          https://repo.anaconda.com/pkgs/r/osx-arm64\n                          https://repo.anaconda.com/pkgs/r/noarch\n          package cache : /opt/homebrew/Caskroom/miniconda/base/pkgs\n                          /Users/luohao/.conda/pkgs\n       envs directories : /opt/homebrew/Caskroom/miniconda/base/envs\n                          /Users/luohao/.conda/envs\n               platform : osx-arm64\n             user-agent : conda/25.9.1 requests/2.32.5 CPython/3.13.9 Darwin/25.0.0 OSX/26.0.1 solver/libmamba conda-libmamba-solver/25.4.0 libmambapy/2.3.2 aau/0.7.3 c/. s/. e/.\n                UID:GID : 501:20\n             netrc file : None\n           offline mode : False\n\n\nAn unexpected error has occurred. Conda has prepared the above report.\nIf you suspect this error is being caused by a malfunctioning plugin,\nconsider using the --no-plugins option to turn off plugins.\n\nExample: conda --no-plugins install <package>\n\nAlternatively, you can set the CONDA_NO_PLUGINS environment variable on\nthe command line to run the command without plugins enabled.\n\nExample: CONDA_NO_PLUGINS=true conda install <package>\n\nIf submitted, this report will be used by core maintainers to improve\nfuture releases of conda.\nWould you like conda to send this report to the core maintainers? [y/N]:\n\nNo report sent. To permanently opt-out, use\n\n    $ conda config --set report_errors false\n\n```\n\nA valid `repodata.json` for this package should be:\n```json\n{\"info\":{\"subdir\":\"noarch\"},\"packages\":{},\"packages.conda\":{\"none-15.2.0-1.conda\":{\"build\":\"1\",\"build_number\":1,\"depends\":[],\"license\":\"GPL-3.0-only WITH GCC-exception-3.1\",\"license_family\":\"GPL\",\"md5\":\"a01910513678232b1bc4af53318c76c5\",\"name\":\"none\",\"sha256\":\"12c627677e089bddc5f710414f39c0f0fb14f59dfb9ed532bf61090ce96b3cc4\",\"size\":3658,\"subdir\":\"osx-arm64\",\"timestamp\":1762519733030,\"version\":\"15.2.0\"}},\"removed\":[],\"repodata_version\":1}\n```\n\n### Gitea Version\n\n1.24.6\n\n### Can you reproduce the bug on the Gitea demo site?\n\nYes\n\n### Log Gist\n\n_No response_\n\n### Screenshots\n\n_No response_\n\n### Git Version\n\n_No response_\n\n### Operating System\n\n_No response_\n\n### How are you running Gitea?\n\nVia docker\n\n### Database\n\nMySQL/MariaDB","closed_by":{"login":"wxiaoguang","id":2114189,"node_id":"MDQ6VXNlcjIxMTQxODk=","avatar_url":"https://avatars.githubusercontent.com/u/2114189?v=4","gravatar_id":"","url":"https://api.github.com/users/wxiaoguang","html_url":"https://github.com/wxiaoguang","followers_url":"https://api.github.com/users/wxiaoguang/followers","following_url":"https://api.github.com/users/wxiaoguang/following{/other_user}","gists_url":"https://api.github.com/users/wxiaoguang/gists{/gist_id}","starred_url":"https://api.github.com/users/wxiaoguang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wxiaoguang/subscriptions","organizations_url":"https://api.github.com/users/wxiaoguang/orgs","repos_url":"https://api.github.com/users/wxiaoguang/repos","events_url":"https://api.github.com/users/wxiaoguang/events{/privacy}","received_events_url":"https://api.github.com/users/wxiaoguang/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/35895/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/go-gitea/gitea/issues/35895/timeline","performed_via_github_app":null,"state_reason":"completed"}