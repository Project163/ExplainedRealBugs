{"url":"https://api.github.com/repos/go-gitea/gitea/issues/29582","repository_url":"https://api.github.com/repos/go-gitea/gitea","labels_url":"https://api.github.com/repos/go-gitea/gitea/issues/29582/labels{/name}","comments_url":"https://api.github.com/repos/go-gitea/gitea/issues/29582/comments","events_url":"https://api.github.com/repos/go-gitea/gitea/issues/29582/events","html_url":"https://github.com/go-gitea/gitea/issues/29582","id":2166525733,"node_id":"I_kwDOBFIx286BIo8l","number":29582,"title":"Login page does not redirect if already authenticated","user":{"login":"Abyss777","id":5688080,"node_id":"MDQ6VXNlcjU2ODgwODA=","avatar_url":"https://avatars.githubusercontent.com/u/5688080?v=4","gravatar_id":"","url":"https://api.github.com/users/Abyss777","html_url":"https://github.com/Abyss777","followers_url":"https://api.github.com/users/Abyss777/followers","following_url":"https://api.github.com/users/Abyss777/following{/other_user}","gists_url":"https://api.github.com/users/Abyss777/gists{/gist_id}","starred_url":"https://api.github.com/users/Abyss777/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Abyss777/subscriptions","organizations_url":"https://api.github.com/users/Abyss777/orgs","repos_url":"https://api.github.com/users/Abyss777/repos","events_url":"https://api.github.com/users/Abyss777/events{/privacy}","received_events_url":"https://api.github.com/users/Abyss777/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":472744938,"node_id":"MDU6TGFiZWw0NzI3NDQ5Mzg=","url":"https://api.github.com/repos/go-gitea/gitea/labels/type/bug","name":"type/bug","color":"ee0701","default":false,"description":""}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2024-03-04T10:43:15Z","updated_at":"2024-03-16T00:01:08Z","closed_at":"2024-03-05T02:12:04Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description\n\nIn some major release, behavior after successful login was changed.\r\n\r\nI have kerberos authorization in apache reverse proxy\r\n\r\n```\r\n    <Location /user/login>\r\n        AuthType Kerberos\r\n        AuthName \"Kerberos Login\"\r\n        KrbAuthRealms AD.LOCAL\r\n        KrbMethodNegotiate on\r\n        KrbServiceName Any\r\n        KrbLocalUserMapping On\r\n        Krb5Keytab /etc/apache2/keytabs/gitea.keytab\r\n        Require valid-user\r\n\r\n        RewriteEngine On\r\n        RewriteCond %{LA-U:REMOTE_USER} (.+)\r\n        RewriteRule . - [E=RU:%1]\r\n        RequestHeader set X-WEBAUTH-USER %{RU}e\r\n        RequestHeader unset Authorization\r\n    </Location>\r\n```\r\nThat sets `X-WEBAUTH-USER` header only for `/user/login` location because I need unauthorized access to some gitea pages.\r\n\r\nAnd proxy authorization enabled\r\n\r\n```\r\nENABLE_REVERSE_PROXY_AUTHENTICATION = true\r\n```\r\n\r\nI'm not sure, but before 1.21 or even 1.20 after user click on Login button in right upper corner, he will be redirected to login page, get successful authentication via proxy header and then just redirected to default `/` page.\r\n\r\nBut in the latest releases redirect does not happen, user gets authenticated (sees his avatar in right upper corner) but still on the login page.\r\n\r\nUser usually doesn't understand that he is authenticated and complains that SSO don't works.\r\n\r\nCould you please revert behavior and redirect from login page if proxy authentication was successful. \n\n### Gitea Version\n\n 1.21.7\n\n### Can you reproduce the bug on the Gitea demo site?\n\nNo\n\n### Log Gist\n\n_No response_\n\n### Screenshots\n\n_No response_\n\n### Git Version\n\n_No response_\n\n### Operating System\n\n_No response_\n\n### How are you running Gitea?\n\nOfficial docker image \n\n### Database\n\nMySQL/MariaDB","closed_by":{"login":"wxiaoguang","id":2114189,"node_id":"MDQ6VXNlcjIxMTQxODk=","avatar_url":"https://avatars.githubusercontent.com/u/2114189?v=4","gravatar_id":"","url":"https://api.github.com/users/wxiaoguang","html_url":"https://github.com/wxiaoguang","followers_url":"https://api.github.com/users/wxiaoguang/followers","following_url":"https://api.github.com/users/wxiaoguang/following{/other_user}","gists_url":"https://api.github.com/users/wxiaoguang/gists{/gist_id}","starred_url":"https://api.github.com/users/wxiaoguang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wxiaoguang/subscriptions","organizations_url":"https://api.github.com/users/wxiaoguang/orgs","repos_url":"https://api.github.com/users/wxiaoguang/repos","events_url":"https://api.github.com/users/wxiaoguang/events{/privacy}","received_events_url":"https://api.github.com/users/wxiaoguang/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/29582/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/go-gitea/gitea/issues/29582/timeline","performed_via_github_app":null,"state_reason":"completed"}