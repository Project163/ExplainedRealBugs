{"url":"https://api.github.com/repos/go-gitea/gitea/issues/29074","repository_url":"https://api.github.com/repos/go-gitea/gitea","labels_url":"https://api.github.com/repos/go-gitea/gitea/issues/29074/labels{/name}","comments_url":"https://api.github.com/repos/go-gitea/gitea/issues/29074/comments","events_url":"https://api.github.com/repos/go-gitea/gitea/issues/29074/events","html_url":"https://github.com/go-gitea/gitea/issues/29074","id":2122376586,"node_id":"I_kwDOBFIx285-gOWK","number":29074,"title":"Cannot disable pre-registered OAuth2 applications","user":{"login":"Adrian-Hirt","id":13788379,"node_id":"MDQ6VXNlcjEzNzg4Mzc5","avatar_url":"https://avatars.githubusercontent.com/u/13788379?v=4","gravatar_id":"","url":"https://api.github.com/users/Adrian-Hirt","html_url":"https://github.com/Adrian-Hirt","followers_url":"https://api.github.com/users/Adrian-Hirt/followers","following_url":"https://api.github.com/users/Adrian-Hirt/following{/other_user}","gists_url":"https://api.github.com/users/Adrian-Hirt/gists{/gist_id}","starred_url":"https://api.github.com/users/Adrian-Hirt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Adrian-Hirt/subscriptions","organizations_url":"https://api.github.com/users/Adrian-Hirt/orgs","repos_url":"https://api.github.com/users/Adrian-Hirt/repos","events_url":"https://api.github.com/users/Adrian-Hirt/events{/privacy}","received_events_url":"https://api.github.com/users/Adrian-Hirt/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":474393850,"node_id":"MDU6TGFiZWw0NzQzOTM4NTA=","url":"https://api.github.com/repos/go-gitea/gitea/labels/type/proposal","name":"type/proposal","color":"5319e7","default":false,"description":"The new feature has not been accepted yet but needs to be discussed first."}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/go-gitea/gitea/milestones/148","html_url":"https://github.com/go-gitea/gitea/milestone/148","labels_url":"https://api.github.com/repos/go-gitea/gitea/milestones/148/labels","id":9871524,"node_id":"MI_kwDOBFIx284AlqCk","number":148,"title":"1.22.0","description":"","creator":{"login":"6543","id":24977596,"node_id":"MDQ6VXNlcjI0OTc3NTk2","avatar_url":"https://avatars.githubusercontent.com/u/24977596?v=4","gravatar_id":"","url":"https://api.github.com/users/6543","html_url":"https://github.com/6543","followers_url":"https://api.github.com/users/6543/followers","following_url":"https://api.github.com/users/6543/following{/other_user}","gists_url":"https://api.github.com/users/6543/gists{/gist_id}","starred_url":"https://api.github.com/users/6543/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/6543/subscriptions","organizations_url":"https://api.github.com/users/6543/orgs","repos_url":"https://api.github.com/users/6543/repos","events_url":"https://api.github.com/users/6543/events{/privacy}","received_events_url":"https://api.github.com/users/6543/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":1530,"state":"closed","created_at":"2023-09-02T01:25:31Z","updated_at":"2024-05-28T09:31:23Z","due_on":"2024-03-14T07:00:00Z","closed_at":"2024-05-27T12:24:20Z"},"comments":1,"created_at":"2024-02-07T07:37:50Z","updated_at":"2024-07-07T15:32:33Z","closed_at":"2024-04-08T04:13:35Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description\n\nIn #26291, pre-registered OAuth applications were added to gitea.\r\n\r\nIn my case, we would like to disable them (or rather OAuth2 capabilities in general), but this does not seem to be possible.\r\n\r\nA) If I set `DEFAULT_APPLICATIONS` to an empty value, it will be ignored and both of the pre-configured applications will be enabled. Setting the config value to any other option will raise an error on startup, as there is no pre-configured application with that name. Am I missing something here? Setting this setting to an empty value probably should disable all the pre-configured applications, right?\r\n\r\nB) In addition, setting `ENABLE = false` in the `[oauth2]` section in app.ini has no effect. It's not possible to view OAuth2 applications, but it's still possible to use the pre-defined applications to log-in, e.g. when using `git-credential-manager`. I'd expect the OAuth2 login endpoint to be completely disabled if the setting `ENABLE` is set to `false`, i.e. if this is set to `false`, logging-in with OAuth2 should be completely disabled, also for the predefined applications.\r\n\r\n---\r\n\r\nHow to reproduce:\r\n\r\nFor A):\r\n\r\n* Set `DEFAULT_APPLICATIONS = ` in `[oauth2]` section in `app.ini`\r\n* Set `ENABLE = true` in `[oauth2]` section in `app.ini`\r\n* Start webserver\r\n* Navigate to Admin Settings > Applications\r\n\r\nExpected behaviour:\r\n\r\n* No pre-configured applications are listed\r\n\r\nObserved behaviour:\r\n\r\n* Both `git-credential-manager` as well as `git-credential-oauth` applications are present\r\n\r\nFor B):\r\n\r\n* Set `ENABLE = false` in `[oauth2]` section in `app.ini`\r\n* Start webserver\r\n* Start an OAuth request from `git-credential-manager`, e.g.  by cloning a repo via HTTPS\r\n\r\nExpected behaviour:\r\n\r\n* The Authorization request should be rejected by gitea, as OAuth2 is disabled\r\n\r\nObserved behaviour:\r\n\r\n* The Authorization request works equal to the case where `ENABLE` is set to `true`\r\n\r\n---\r\n\r\nPlease let me know if you need any other info. I greatly appreciate the work done here, and I can just block these requests on the reverse proxy, but I still wanted to bring this issue to attention. Have a nice day!\n\n### Gitea Version\n\nv1.21.5\n\n### Can you reproduce the bug on the Gitea demo site?\n\nNo\n\n### Log Gist\n\nhttps://gist.github.com/Adrian-Hirt/0f1c5a26892018ac90a04f6aa1f5a4c0\n\n### Screenshots\n\n_No response_\n\n### Git Version\n\n_No response_\n\n### Operating System\n\nFedora 37\n\n### How are you running Gitea?\n\nI'm running the binary from the download page.\n\n### Database\n\nMySQL/MariaDB","closed_by":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/29074/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/go-gitea/gitea/issues/29074/timeline","performed_via_github_app":null,"state_reason":"completed"}