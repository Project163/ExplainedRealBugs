{"url":"https://api.github.com/repos/go-gitea/gitea/issues/32807","repository_url":"https://api.github.com/repos/go-gitea/gitea","labels_url":"https://api.github.com/repos/go-gitea/gitea/issues/32807/labels{/name}","comments_url":"https://api.github.com/repos/go-gitea/gitea/issues/32807/comments","events_url":"https://api.github.com/repos/go-gitea/gitea/issues/32807/events","html_url":"https://github.com/go-gitea/gitea/issues/32807","id":2735231308,"node_id":"I_kwDOBFIx286jCFFM","number":32807,"title":"500 Error when activating user account with uppercase character in mail address","user":{"login":"DrMaxNix","id":38893656,"node_id":"MDQ6VXNlcjM4ODkzNjU2","avatar_url":"https://avatars.githubusercontent.com/u/38893656?v=4","gravatar_id":"","url":"https://api.github.com/users/DrMaxNix","html_url":"https://github.com/DrMaxNix","followers_url":"https://api.github.com/users/DrMaxNix/followers","following_url":"https://api.github.com/users/DrMaxNix/following{/other_user}","gists_url":"https://api.github.com/users/DrMaxNix/gists{/gist_id}","starred_url":"https://api.github.com/users/DrMaxNix/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DrMaxNix/subscriptions","organizations_url":"https://api.github.com/users/DrMaxNix/orgs","repos_url":"https://api.github.com/users/DrMaxNix/repos","events_url":"https://api.github.com/users/DrMaxNix/events{/privacy}","received_events_url":"https://api.github.com/users/DrMaxNix/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":472744938,"node_id":"MDU6TGFiZWw0NzI3NDQ5Mzg=","url":"https://api.github.com/repos/go-gitea/gitea/labels/type/bug","name":"type/bug","color":"ee0701","default":false,"description":""}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/go-gitea/gitea/milestones/159","html_url":"https://github.com/go-gitea/gitea/milestone/159","labels_url":"https://api.github.com/repos/go-gitea/gitea/milestones/159/labels","id":10634467,"node_id":"MI_kwDOBFIx284AokTj","number":159,"title":"1.23.0","description":"","creator":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":951,"state":"closed","created_at":"2024-03-04T05:56:49Z","updated_at":"2025-03-12T17:52:57Z","due_on":"2024-12-18T08:00:00Z","closed_at":"2025-01-09T17:59:34Z"},"comments":1,"created_at":"2024-12-12T08:40:24Z","updated_at":"2025-03-27T13:16:20Z","closed_at":"2024-12-27T11:16:24Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Steps to Reproduce\r\n1. Log out\r\n2. Go to \"Register\" (/user/sign_up)\r\n3. Enter any Username\r\n4. Enter Mail Address `Uppercase@example.com` or anything else really, as long as the user part contains an uppercase character\r\n5. Enter any Password twice\r\n6. Solve captcha and Submit\r\n7. Click on the link sent by mail\r\n8. \"Activate Your Account\" will open and ask for your password\r\n9. Enter your password and click \"Confirm Password\"\r\n10. You should now see a `500 Internal Server Error` page on the `/user/activate` route\r\n\r\n\r\n\r\n### Log\r\nThe log shows following lines:\r\n```\r\n2024/12/12 09:15:08 ...eb/routing/logger.go:102:func1() [I] router: completed POST /user/sign_up for 127.0.0.1:36906, 200 OK in 60.2ms @ auth/auth.go:453(auth.SignUpPost)\r\n2024/12/12 09:15:16 ...eb/routing/logger.go:102:func1() [I] router: completed GET /user/activate?code=2024121209150001806edc018960b6c1042efef74ee3c2b120d9f791287570706572636173653939 for 127.0.0.1:36906, 200 OK in 6.6ms @ auth/auth.go:685(auth.Activate)\r\n2024/12/12 09:15:21 ...ers/web/auth/auth.go:793:handleAccountActivation() [E] Unable to activate email for user: <User 20:Uppercase99> with email: uppercase99@n.drmaxnix.de: no user with ID: 20 and Email: uppercase99@n.drmaxnix.de\r\n2024/12/12 09:15:21 ...ers/web/auth/auth.go:794:handleAccountActivation() [E] ActivateUserEmail: no user with ID: 20 and Email: uppercase99@n.drmaxnix.de\r\n2024/12/12 09:15:21 ...eb/routing/logger.go:102:func1() [I] router: completed POST /user/activate for 127.0.0.1:36906, 500 Internal Server Error in 62.3ms @ auth/auth.go:724(auth.ActivatePost)\r\n```\r\nThe mail address used for registering was `Uppercase99@n.drmaxnix.de`, whereas the log shows it as its all-lowercase version `uppercase99@n.drmaxnix.de`. There is probably a lowercase translation at some point, which is not consistent across the full codebase.\r\n\r\n(Also I know that mail should be case insensitive and thus can be entered all-lowercase, but there are some meikro$oft fans out there who _love_ to capitalize the first letters of the first and last name in their mail address like this: `Bill.Gates@autluk.com`.)\r\n\r\n### Gitea Version\r\n\r\n1.22.5\r\n\r\n### Can you reproduce the bug on the Gitea demo site?\r\n\r\nNo (registration disabled)\r\n\r\n### Operating System\r\n\r\nLinux\r\n\r\n### How are you running Gitea?\r\n\r\nself-built binary run from command line (test environment), but also tested on our production instance at https://git.tjdev.de (still running 1.22.4 at the point of writing)\r\n\r\n### Database\r\n\r\nMySQL/MariaDB","closed_by":{"login":"wxiaoguang","id":2114189,"node_id":"MDQ6VXNlcjIxMTQxODk=","avatar_url":"https://avatars.githubusercontent.com/u/2114189?v=4","gravatar_id":"","url":"https://api.github.com/users/wxiaoguang","html_url":"https://github.com/wxiaoguang","followers_url":"https://api.github.com/users/wxiaoguang/followers","following_url":"https://api.github.com/users/wxiaoguang/following{/other_user}","gists_url":"https://api.github.com/users/wxiaoguang/gists{/gist_id}","starred_url":"https://api.github.com/users/wxiaoguang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wxiaoguang/subscriptions","organizations_url":"https://api.github.com/users/wxiaoguang/orgs","repos_url":"https://api.github.com/users/wxiaoguang/repos","events_url":"https://api.github.com/users/wxiaoguang/events{/privacy}","received_events_url":"https://api.github.com/users/wxiaoguang/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/32807/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/go-gitea/gitea/issues/32807/timeline","performed_via_github_app":null,"state_reason":"completed"}