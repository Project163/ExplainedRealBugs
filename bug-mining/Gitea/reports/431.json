{"url":"https://api.github.com/repos/go-gitea/gitea/issues/29654","repository_url":"https://api.github.com/repos/go-gitea/gitea","labels_url":"https://api.github.com/repos/go-gitea/gitea/issues/29654/labels{/name}","comments_url":"https://api.github.com/repos/go-gitea/gitea/issues/29654/comments","events_url":"https://api.github.com/repos/go-gitea/gitea/issues/29654/events","html_url":"https://github.com/go-gitea/gitea/issues/29654","id":2175238906,"node_id":"I_kwDOBFIx286Bp4L6","number":29654,"title":"actions/checkout fails to retrieve default branch name","user":{"login":"nyanotech","id":33802077,"node_id":"MDQ6VXNlcjMzODAyMDc3","avatar_url":"https://avatars.githubusercontent.com/u/33802077?v=4","gravatar_id":"","url":"https://api.github.com/users/nyanotech","html_url":"https://github.com/nyanotech","followers_url":"https://api.github.com/users/nyanotech/followers","following_url":"https://api.github.com/users/nyanotech/following{/other_user}","gists_url":"https://api.github.com/users/nyanotech/gists{/gist_id}","starred_url":"https://api.github.com/users/nyanotech/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nyanotech/subscriptions","organizations_url":"https://api.github.com/users/nyanotech/orgs","repos_url":"https://api.github.com/users/nyanotech/repos","events_url":"https://api.github.com/users/nyanotech/events{/privacy}","received_events_url":"https://api.github.com/users/nyanotech/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":3995080816,"node_id":"LA_kwDOBFIx287uIBhw","url":"https://api.github.com/repos/go-gitea/gitea/labels/issue/workaround","name":"issue/workaround","color":"006B75","default":false,"description":"it is or has a workaround"},{"id":4808833534,"node_id":"LA_kwDOBFIx288AAAABHqD5_g","url":"https://api.github.com/repos/go-gitea/gitea/labels/topic/gitea-actions","name":"topic/gitea-actions","color":"007ED2","default":false,"description":"related to the actions of Gitea"},{"id":6630259220,"node_id":"LA_kwDOBFIx288AAAABizG6FA","url":"https://api.github.com/repos/go-gitea/gitea/labels/topic/api","name":"topic/api","color":"A20C87","default":false,"description":"Concerns mainly the API"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2024-03-08T04:07:42Z","updated_at":"2025-02-24T02:11:32Z","closed_at":"2024-11-25T19:35:51Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description\n\nI have a private repo, with an actions workflow that uses `actions/checkout` (I've tried v3 and v4, both have this issue) to check out first itself, and then a different private repo, like [this](https://gitea.com/actions/checkout#checkout-multiple-repos-private).\r\n\r\nWhen I run this, the action fails with this error:\r\n```\r\n::group::Determining the default branch\r\nRetrieving the default branch name\r\nNot found.\r\n```\r\nLooking through the logs on the gitea side, I find:\r\n```\r\n2024/03/06 02:48:38 ...eb/routing/logger.go:102:func1() [I] router: completed GET /api/v3/repos/[user]/[repo] for 10.89.0.2:0, 404 Not Found in 20.3ms @ web/goget.go:20(web.goGet)\r\n```\r\nLooking in the swagger ui, it looks like the base url is at `/api/v1`, so I assume that a v3 version of the route is just nonexistent.\r\n\r\nIn the end, I was able to work around this issue by manually specifying a `ref: master` to check out in the action's config, and that let the rest of the checkout succeed.\r\n\r\nI'm having some trouble signing up on try.gitea.io at the moment, but I'll set up a repro on there when I get a chance.\n\n### Gitea Version\n\n1.21.7\n\n### Can you reproduce the bug on the Gitea demo site?\n\nNo\n\n### Log Gist\n\n_No response_\n\n### Screenshots\n\n_No response_\n\n### Git Version\n\n2.43.1\n\n### Operating System\n\nlinux (nixos unstable)\n\n### How are you running Gitea?\n\ngitea via nixos's package (runs under systemd, no containers), behind a nginx reverse proxy.\r\n\r\ngitea instance is under its own subdomain, no extra subdir that it lives under.\r\n\r\nthe actions runner is also installed via nixos's package manager, running under systemd, on the same box\n\n### Database\n\nPostgreSQL","closed_by":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/29654/reactions","total_count":3,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":1},"timeline_url":"https://api.github.com/repos/go-gitea/gitea/issues/29654/timeline","performed_via_github_app":null,"state_reason":"completed"}