{"url":"https://api.github.com/repos/go-gitea/gitea/issues/35083","repository_url":"https://api.github.com/repos/go-gitea/gitea","labels_url":"https://api.github.com/repos/go-gitea/gitea/issues/35083/labels{/name}","comments_url":"https://api.github.com/repos/go-gitea/gitea/issues/35083/comments","events_url":"https://api.github.com/repos/go-gitea/gitea/issues/35083/events","html_url":"https://github.com/go-gitea/gitea/issues/35083","id":3232756608,"node_id":"I_kwDOBFIx287Ar_OA","number":35083,"title":"Basic authentication doesn't work for archive downloads","user":{"login":"pvgoran","id":12595801,"node_id":"MDQ6VXNlcjEyNTk1ODAx","avatar_url":"https://avatars.githubusercontent.com/u/12595801?v=4","gravatar_id":"","url":"https://api.github.com/users/pvgoran","html_url":"https://github.com/pvgoran","followers_url":"https://api.github.com/users/pvgoran/followers","following_url":"https://api.github.com/users/pvgoran/following{/other_user}","gists_url":"https://api.github.com/users/pvgoran/gists{/gist_id}","starred_url":"https://api.github.com/users/pvgoran/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pvgoran/subscriptions","organizations_url":"https://api.github.com/users/pvgoran/orgs","repos_url":"https://api.github.com/users/pvgoran/repos","events_url":"https://api.github.com/users/pvgoran/events{/privacy}","received_events_url":"https://api.github.com/users/pvgoran/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":472744938,"node_id":"MDU6TGFiZWw0NzI3NDQ5Mzg=","url":"https://api.github.com/repos/go-gitea/gitea/labels/type/bug","name":"type/bug","color":"ee0701","default":false,"description":""}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2025-07-15T15:33:33Z","updated_at":"2025-10-14T18:28:10Z","closed_at":"2025-07-16T17:53:58Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description\n\nI have a private repository, and I need to download its archives (URLs like https://my.gitea.site/owner/repo/archive/<commit-id>.tar.gz) non-interactively using Basic Authentication. (Specifically, I need to download with the `builtins.fetchTarball` function of [Nix package manager](https://nixos.org/).) It doesn't work out of the box:\n\n```\n> > curl --dump-header - -u :REDACTED -o /dev/null https://REDACTED/REDACTED/REDACTED/archive/REDACTED.tar.gz\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0HTTP/2 303 \nserver: nginx\ndate: Tue, 15 Jul 2025 15:13:01 GMT\ncontent-type: text/html; charset=utf-8\ncontent-length: 38\ncache-control: max-age=0, private, must-revalidate, no-transform\nlocation: /user/login\nset-cookie: session=e685bd6a270841fa; Path=/; HttpOnly; Secure; SameSite=Lax\nset-cookie: _csrf=YObR-Ve7B-AnJXJtfpjTtk5YrUA6MTc1MjU5MjM4MTk0ODAwNDg1Ng; Path=/; Max-Age=86400; HttpOnly; Secure; SameSite=Lax\nset-cookie: redirect_to=%2FREDACTED.tar.gz; Path=/; HttpOnly; Secure; SameSite=Lax\nx-frame-options: SAMEORIGIN\n\n100    38  100    38    0     0    608      0 --:--:-- --:--:-- --:--:--   612\n\n```\n\n(The password specified in curl's `-u` option is an Access Token with the `read:repository` permission of a user that is allowed to access the repository.)\n\nI use a patched version of Gitea to make it work.\n\n### Gitea Version\n\n1.24.2\n\n### Can you reproduce the bug on the Gitea demo site?\n\nNo\n\n### Log Gist\n\n2025/07/15 15:19:55 ...eb/routing/logger.go:102:func1() [I] router: completed GET /REDACTED/REDACTED/archive/REDACTED.tar.gz for 127.0.0.1:34664, 303 See Other in 0.5ms @ web/web.go:139(web.registerWebRoutes.verifyAuthWithOptions)\n\n### Screenshots\n\n_No response_\n\n### Git Version\n\n2.49.0\n\n### Operating System\n\nNixOS\n\n### How are you running Gitea?\n\nNixOS' `gitea` module with the standard Nixpkgs' `gitea` package, behind Nginx reverse proxy.\n\n### Database\n\nPostgreSQL","closed_by":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/35083/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/go-gitea/gitea/issues/35083/timeline","performed_via_github_app":null,"state_reason":"completed"}