{"url":"https://api.github.com/repos/go-gitea/gitea/issues/30011","repository_url":"https://api.github.com/repos/go-gitea/gitea","labels_url":"https://api.github.com/repos/go-gitea/gitea/issues/30011/labels{/name}","comments_url":"https://api.github.com/repos/go-gitea/gitea/issues/30011/comments","events_url":"https://api.github.com/repos/go-gitea/gitea/issues/30011/events","html_url":"https://github.com/go-gitea/gitea/issues/30011","id":2203410752,"node_id":"I_kwDOBFIx286DVWFA","number":30011,"title":"UI preventing org repo creation as well if user org limit is reached","user":{"login":"DrMaxNix","id":38893656,"node_id":"MDQ6VXNlcjM4ODkzNjU2","avatar_url":"https://avatars.githubusercontent.com/u/38893656?v=4","gravatar_id":"","url":"https://api.github.com/users/DrMaxNix","html_url":"https://github.com/DrMaxNix","followers_url":"https://api.github.com/users/DrMaxNix/followers","following_url":"https://api.github.com/users/DrMaxNix/following{/other_user}","gists_url":"https://api.github.com/users/DrMaxNix/gists{/gist_id}","starred_url":"https://api.github.com/users/DrMaxNix/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DrMaxNix/subscriptions","organizations_url":"https://api.github.com/users/DrMaxNix/orgs","repos_url":"https://api.github.com/users/DrMaxNix/repos","events_url":"https://api.github.com/users/DrMaxNix/events{/privacy}","received_events_url":"https://api.github.com/users/DrMaxNix/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":474393850,"node_id":"MDU6TGFiZWw0NzQzOTM4NTA=","url":"https://api.github.com/repos/go-gitea/gitea/labels/type/proposal","name":"type/proposal","color":"5319e7","default":false,"description":"The new feature has not been accepted yet but needs to be discussed first."}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/go-gitea/gitea/milestones/167","html_url":"https://github.com/go-gitea/gitea/milestone/167","labels_url":"https://api.github.com/repos/go-gitea/gitea/milestones/167/labels","id":11552307,"node_id":"MI_kwDOBFIx284AsEYz","number":167,"title":"1.24.0","description":"","creator":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":1,"closed_issues":674,"state":"closed","created_at":"2024-09-07T22:02:43Z","updated_at":"2025-06-12T01:52:19Z","due_on":"2025-04-25T07:00:00Z","closed_at":"2025-06-10T07:09:50Z"},"comments":4,"created_at":"2024-03-22T22:22:47Z","updated_at":"2025-07-07T10:44:01Z","closed_at":"2025-04-08T06:45:32Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Scenario\r\n- On our instance we have `MAX_CREATION_LIMIT = 0` to prevent random new users from spamming our instance\r\n- There is an org which has a few members, which is being used for a collaborative project. These members should only be able to create repos inside this org, but not under their user account.\r\n- Users have been put into a team `Dev` which has `Create repositories` enabled\r\n\r\n## Problem\r\n- On the repo create page, the submit button `Create Repository` is disabled in case `CanCreateRepo == false`: https://github.com/go-gitea/gitea/blob/5c91d7920f4aff08768e274269e211e926aa3d36/templates/repo/create.tmpl#L212\r\n- `CanCreateRepo` checks whether the user already has too many personal repos: https://github.com/go-gitea/gitea/blob/5c91d7920f4aff08768e274269e211e926aa3d36/models/user/user.go#L240-L251\r\n- But the submit button will be disabled for all available repo owners; **Personal and also Orgs!**\r\n- This means the **UI will not allow users to create org repos** even though they have the `Create repositories` permission in their org!\r\n- EDIT: This problem also affects repos which are created from migrations (this however is a backend issue!)\r\n\r\n## Solutions\r\n- This is only a UI bug, the backend validation works as expected (I have tested this by removing the previously mentioned disable check from the template to force the button to be always enabled)\r\n- The `CanCreateRepo` value should only influence creation of a personal repo\r\n- Repo limit of the org is only checked after the form is submitted, this would be a good quick-fix for this issue (removing the disabled button check and the error banner from the template)\r\n- For a long term solution we could hide the personal user account in the owners list the same way orgs are hidden when their limit is reached. This would make the disabled submit button and the banner completely obsolete, as the user is forced to select an owner that is allowed to have more repos created\r\n\r\nNote that I was not able to reproduce the issue on the demo instance, because there is no repo count limit and also it seems like you can't create orgs there..\r\n\r\n## Screenshots\r\nTrying to create a new repo `testrepo45` under `testorg` organization, note the banner telling me there is a limit:\r\n![Screenshot from 2024-03-22 23-19-41](https://github.com/go-gitea/gitea/assets/38893656/30d1b1fd-565c-4eeb-aa67-83bc1ce6bec0)\r\n\r\nSubmit button is disabled:\r\n![Screenshot from 2024-03-22 23-19-29](https://github.com/go-gitea/gitea/assets/38893656/5b5f4720-56e5-4d39-ba57-fe71a62df2fe)\r\n\r\nRepo create works anyway when enabling the submit button by hand:\r\n![Screenshot from 2024-03-22 23-19-56](https://github.com/go-gitea/gitea/assets/38893656/b93eebfe-5c23-4874-a2f8-3af3d55d0bb7)\r\n\r\n## Gitea Version\r\nv1.21.9","closed_by":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/30011/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":1},"timeline_url":"https://api.github.com/repos/go-gitea/gitea/issues/30011/timeline","performed_via_github_app":null,"state_reason":"completed"}