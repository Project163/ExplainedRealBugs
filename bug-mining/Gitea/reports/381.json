{"url":"https://api.github.com/repos/go-gitea/gitea/issues/32021","repository_url":"https://api.github.com/repos/go-gitea/gitea","labels_url":"https://api.github.com/repos/go-gitea/gitea/issues/32021/labels{/name}","comments_url":"https://api.github.com/repos/go-gitea/gitea/issues/32021/comments","events_url":"https://api.github.com/repos/go-gitea/gitea/issues/32021/events","html_url":"https://github.com/go-gitea/gitea/issues/32021","id":2516666869,"node_id":"I_kwDOBFIx286WAUn1","number":32021,"title":"RPM Registry: primary.xml <location> should not url encode caret (^) characters","user":{"login":"nephatrine","id":1461334,"node_id":"MDQ6VXNlcjE0NjEzMzQ=","avatar_url":"https://avatars.githubusercontent.com/u/1461334?v=4","gravatar_id":"","url":"https://api.github.com/users/nephatrine","html_url":"https://github.com/nephatrine","followers_url":"https://api.github.com/users/nephatrine/followers","following_url":"https://api.github.com/users/nephatrine/following{/other_user}","gists_url":"https://api.github.com/users/nephatrine/gists{/gist_id}","starred_url":"https://api.github.com/users/nephatrine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nephatrine/subscriptions","organizations_url":"https://api.github.com/users/nephatrine/orgs","repos_url":"https://api.github.com/users/nephatrine/repos","events_url":"https://api.github.com/users/nephatrine/events{/privacy}","received_events_url":"https://api.github.com/users/nephatrine/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":472744938,"node_id":"MDU6TGFiZWw0NzI3NDQ5Mzg=","url":"https://api.github.com/repos/go-gitea/gitea/labels/type/bug","name":"type/bug","color":"ee0701","default":false,"description":""},{"id":4102834064,"node_id":"LA_kwDOBFIx2870jEeQ","url":"https://api.github.com/repos/go-gitea/gitea/labels/topic/packages","name":"topic/packages","color":"AFE667","default":false,"description":""}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/go-gitea/gitea/milestones/166","html_url":"https://github.com/go-gitea/gitea/milestone/166","labels_url":"https://api.github.com/repos/go-gitea/gitea/milestones/166/labels","id":11527055,"node_id":"MI_kwDOBFIx284Ar-OP","number":166,"title":"1.22.3","description":"","creator":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":53,"state":"closed","created_at":"2024-09-02T07:19:44Z","updated_at":"2024-10-09T03:25:31Z","due_on":"2024-09-20T07:00:00Z","closed_at":"2024-10-09T03:25:31Z"},"comments":4,"created_at":"2024-09-10T14:39:06Z","updated_at":"2024-12-15T21:38:42Z","closed_at":"2024-09-16T21:10:35Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description\n\nWhen uploading a file with a name like `hello-test-0.0.1^15.git7166d1f2-1.el9.x86_64.rpm` to the RPM registry, I am able to see the file correctly in the Gitea packages UI and can manually download the RPM from there, but DNF cannot download it on an actual system. DNF does see that the package exists and tries to download it, but gets 404 errors:\r\n\r\n```\r\nDownloading Packages:\r\n[MIRROR] hello-test-0.0.1%5E15.git7166d1f2-1.el9.x86_64.rpm: Status code: 404 for https://example.com/api/packages/testuser/rpm/almalinux/el9/package/hello-test/0.0.1%255E15.git7166d1f2-1.el9/x86_64/hello-test-0.0.1%255E15.git7166d1f2-1.el9.x86_64.rpm (IP: 136.56.234.199)\r\n[MIRROR] hello-test-0.0.1%5E15.git7166d1f2-1.el9.x86_64.rpm: Status code: 404 for https://example.com/api/packages/testuser/rpm/almalinux/el9/package/hello-test/0.0.1%255E15.git7166d1f2-1.el9/x86_64/hello-test-0.0.1%255E15.git7166d1f2-1.el9.x86_64.rpm (IP: 136.56.234.199)\r\n[FAILED] hello-test-0.0.1%5E15.git7166d1f2-1.el9.x86_64.rpm: No more mirrors to try - All mirrors were already tried without success\r\n```\r\n\r\nIn my gitea logs, I can see those 404 attempts.\r\n\r\n```\r\n172.17.0.1 - - [10/Sep/2024:09:40:55 -0400] \"GET /api/packages/testuser/rpm/almalinux/el9/repodata/repomd.xml HTTP/1.0\" 200 1244 \"\" \"libdnf (AlmaLinux 9.4; generic; Linux.x86_64)\"\r\n172.17.0.1 - - [10/Sep/2024:09:40:57 -0400] \"GET /api/packages/testuser/rpm/almalinux/el9/package/hello-test/0.0.1%255E15.git7166d1f2-1.el9/x86_64/hello-test-0.0.1%255E15.git7166d1f2-1.el9.x86_64.rpm HTTP/1.0\" 404 22 \"\" \"libdnf (AlmaLinux 9.4; generic; Linux.x86_64)\"\r\n172.17.0.1 - - [10/Sep/2024:09:40:57 -0400] \"GET /api/packages/testuser/rpm/almalinux/el9/package/hello-test/0.0.1%255E15.git7166d1f2-1.el9/x86_64/hello-test-0.0.1%255E15.git7166d1f2-1.el9.x86_64.rpm HTTP/1.0\" 404 22 \"\" \"libdnf (AlmaLinux 9.4; generic; Linux.x86_64)\"\r\n```\r\n\r\nIf I try to put one of those URLs into my web browser like `https://example.com/api/packages/testuser/rpm/almalinux/el9/package/hello-test/0.0.1%255E15.git7166d1f2-1.el9/x86_64/hello-test-0.0.1%255E15.git7166d1f2-1.el9.x86_64.rpm`, I indeed get a message `package does not exist`.\r\n\r\nIf, however, I change those instances of `%255E` in the URL to `%5E`, the URL _does_ work so it seems the caret is being url encoded twice. Looking in the `repodata/primary.xml.gz` that gitea produces, I see that the `location` field it produces has the caret already encoded to `%5E`, but in major RPM repositories like EPEL (https://dl.fedoraproject.org/pub/epel/9/Everything/x86_64/repodata/) this is not the case and the `location` does not have carets already url encoded. In my own testing producing a version of the gitea repository files that does not have the caret pre-urlencoded in the <location> field works and allows packages to be downloaded by the package manager and seems to match the behaviour of other RPM repositories.\r\n\r\n**I have reproduced the issue on the demo site here:** https://demo.gitea.com/nephatrine/-/packages/rpm/hello-test/0.0.1%5E15.git7166d1f2-1.el9\n\n### Gitea Version\n\n1.22.2\n\n### Can you reproduce the bug on the Gitea demo site?\n\nYes\n\n### Log Gist\n\n_No response_\n\n### Screenshots\n\n_No response_\n\n### Git Version\n\n2.45.2\n\n### Operating System\n\nAlpine 3.20\n\n### How are you running Gitea?\n\nI build Gitea myself and run it from my own docker container.\n\n### Database\n\nSQLite","closed_by":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/32021/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/go-gitea/gitea/issues/32021/timeline","performed_via_github_app":null,"state_reason":"completed"}