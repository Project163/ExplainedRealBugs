[{"id":14573414102,"node_id":"LE_lADOBFIx286ZirHnzwAAAANkpKbW","url":"https://api.github.com/repos/go-gitea/gitea/issues/events/14573414102","actor":{"login":"SoulSeekkor","id":16005426,"node_id":"MDQ6VXNlcjE2MDA1NDI2","avatar_url":"https://avatars.githubusercontent.com/u/16005426?v=4","gravatar_id":"","url":"https://api.github.com/users/SoulSeekkor","html_url":"https://github.com/SoulSeekkor","followers_url":"https://api.github.com/users/SoulSeekkor/followers","following_url":"https://api.github.com/users/SoulSeekkor/following{/other_user}","gists_url":"https://api.github.com/users/SoulSeekkor/gists{/gist_id}","starred_url":"https://api.github.com/users/SoulSeekkor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SoulSeekkor/subscriptions","organizations_url":"https://api.github.com/users/SoulSeekkor/orgs","repos_url":"https://api.github.com/users/SoulSeekkor/repos","events_url":"https://api.github.com/users/SoulSeekkor/events{/privacy}","received_events_url":"https://api.github.com/users/SoulSeekkor/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2024-10-09T13:49:15Z","label":{"name":"type/bug","color":"ee0701"},"performed_via_github_app":null},{"id":14581201631,"node_id":"LE_lADOBFIx286ZirHnzwAAAANlG3rf","url":"https://api.github.com/repos/go-gitea/gitea/issues/events/14581201631","actor":{"login":"yp05327","id":18380374,"node_id":"MDQ6VXNlcjE4MzgwMzc0","avatar_url":"https://avatars.githubusercontent.com/u/18380374?v=4","gravatar_id":"","url":"https://api.github.com/users/yp05327","html_url":"https://github.com/yp05327","followers_url":"https://api.github.com/users/yp05327/followers","following_url":"https://api.github.com/users/yp05327/following{/other_user}","gists_url":"https://api.github.com/users/yp05327/gists{/gist_id}","starred_url":"https://api.github.com/users/yp05327/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yp05327/subscriptions","organizations_url":"https://api.github.com/users/yp05327/orgs","repos_url":"https://api.github.com/users/yp05327/repos","events_url":"https://api.github.com/users/yp05327/events{/privacy}","received_events_url":"https://api.github.com/users/yp05327/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2024-10-10T00:22:47Z","label":{"name":"performance/speed","color":"db78d3"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/go-gitea/gitea/issues/comments/2403661130","html_url":"https://github.com/go-gitea/gitea/issues/32224#issuecomment-2403661130","issue_url":"https://api.github.com/repos/go-gitea/gitea/issues/32224","id":2403661130,"node_id":"IC_kwDOBFIx286PRPVK","user":{"login":"yp05327","id":18380374,"node_id":"MDQ6VXNlcjE4MzgwMzc0","avatar_url":"https://avatars.githubusercontent.com/u/18380374?v=4","gravatar_id":"","url":"https://api.github.com/users/yp05327","html_url":"https://github.com/yp05327","followers_url":"https://api.github.com/users/yp05327/followers","following_url":"https://api.github.com/users/yp05327/following{/other_user}","gists_url":"https://api.github.com/users/yp05327/gists{/gist_id}","starred_url":"https://api.github.com/users/yp05327/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yp05327/subscriptions","organizations_url":"https://api.github.com/users/yp05327/orgs","repos_url":"https://api.github.com/users/yp05327/repos","events_url":"https://api.github.com/users/yp05327/events{/privacy}","received_events_url":"https://api.github.com/users/yp05327/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-10-10T00:22:56Z","updated_at":"2024-10-10T00:22:56Z","body":"@lunny ","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/comments/2403661130/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"yp05327","id":18380374,"node_id":"MDQ6VXNlcjE4MzgwMzc0","avatar_url":"https://avatars.githubusercontent.com/u/18380374?v=4","gravatar_id":"","url":"https://api.github.com/users/yp05327","html_url":"https://github.com/yp05327","followers_url":"https://api.github.com/users/yp05327/followers","following_url":"https://api.github.com/users/yp05327/following{/other_user}","gists_url":"https://api.github.com/users/yp05327/gists{/gist_id}","starred_url":"https://api.github.com/users/yp05327/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yp05327/subscriptions","organizations_url":"https://api.github.com/users/yp05327/orgs","repos_url":"https://api.github.com/users/yp05327/repos","events_url":"https://api.github.com/users/yp05327/events{/privacy}","received_events_url":"https://api.github.com/users/yp05327/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":14581202560,"node_id":"MEE_lADOBFIx286ZirHnzwAAAANlG36A","url":"https://api.github.com/repos/go-gitea/gitea/issues/events/14581202560","actor":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2024-10-10T00:22:57Z","performed_via_github_app":null},{"id":14581202564,"node_id":"SE_lADOBFIx286ZirHnzwAAAANlG36E","url":"https://api.github.com/repos/go-gitea/gitea/issues/events/14581202564","actor":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2024-10-10T00:22:57Z","performed_via_github_app":null},{"actor":{"login":"yp05327","id":18380374,"node_id":"MDQ6VXNlcjE4MzgwMzc0","avatar_url":"https://avatars.githubusercontent.com/u/18380374?v=4","gravatar_id":"","url":"https://api.github.com/users/yp05327","html_url":"https://github.com/yp05327","followers_url":"https://api.github.com/users/yp05327/followers","following_url":"https://api.github.com/users/yp05327/following{/other_user}","gists_url":"https://api.github.com/users/yp05327/gists{/gist_id}","starred_url":"https://api.github.com/users/yp05327/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yp05327/subscriptions","organizations_url":"https://api.github.com/users/yp05327/orgs","repos_url":"https://api.github.com/users/yp05327/repos","events_url":"https://api.github.com/users/yp05327/events{/privacy}","received_events_url":"https://api.github.com/users/yp05327/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-10-10T00:23:37Z","updated_at":"2024-10-10T00:23:37Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/31698","repository_url":"https://api.github.com/repos/go-gitea/gitea","labels_url":"https://api.github.com/repos/go-gitea/gitea/issues/31698/labels{/name}","comments_url":"https://api.github.com/repos/go-gitea/gitea/issues/31698/comments","events_url":"https://api.github.com/repos/go-gitea/gitea/issues/31698/events","html_url":"https://github.com/go-gitea/gitea/issues/31698","id":2428694303,"node_id":"I_kwDOBFIx286Qwu8f","number":31698,"title":"[Summary] Loading user dashboard too slow","user":{"login":"yp05327","id":18380374,"node_id":"MDQ6VXNlcjE4MzgwMzc0","avatar_url":"https://avatars.githubusercontent.com/u/18380374?v=4","gravatar_id":"","url":"https://api.github.com/users/yp05327","html_url":"https://github.com/yp05327","followers_url":"https://api.github.com/users/yp05327/followers","following_url":"https://api.github.com/users/yp05327/following{/other_user}","gists_url":"https://api.github.com/users/yp05327/gists{/gist_id}","starred_url":"https://api.github.com/users/yp05327/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yp05327/subscriptions","organizations_url":"https://api.github.com/users/yp05327/orgs","repos_url":"https://api.github.com/users/yp05327/repos","events_url":"https://api.github.com/users/yp05327/events{/privacy}","received_events_url":"https://api.github.com/users/yp05327/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1743290619,"node_id":"MDU6TGFiZWwxNzQzMjkwNjE5","url":"https://api.github.com/repos/go-gitea/gitea/labels/performance/speed","name":"performance/speed","color":"db78d3","default":false,"description":"performance issues with slow downs"},{"id":2342262186,"node_id":"MDU6TGFiZWwyMzQyMjYyMTg2","url":"https://api.github.com/repos/go-gitea/gitea/labels/type/summary","name":"type/summary","color":"efb57f","default":false,"description":"This issue aggregates a bunch of other issues"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":10,"created_at":"2024-07-25T00:23:35Z","updated_at":"2025-05-26T00:37:57Z","closed_at":"2025-02-24T19:29:34Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":72495579,"node_id":"MDEwOlJlcG9zaXRvcnk3MjQ5NTU3OQ==","name":"gitea","full_name":"go-gitea/gitea","private":false,"owner":{"login":"go-gitea","id":12724356,"node_id":"MDEyOk9yZ2FuaXphdGlvbjEyNzI0MzU2","avatar_url":"https://avatars.githubusercontent.com/u/12724356?v=4","gravatar_id":"","url":"https://api.github.com/users/go-gitea","html_url":"https://github.com/go-gitea","followers_url":"https://api.github.com/users/go-gitea/followers","following_url":"https://api.github.com/users/go-gitea/following{/other_user}","gists_url":"https://api.github.com/users/go-gitea/gists{/gist_id}","starred_url":"https://api.github.com/users/go-gitea/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/go-gitea/subscriptions","organizations_url":"https://api.github.com/users/go-gitea/orgs","repos_url":"https://api.github.com/users/go-gitea/repos","events_url":"https://api.github.com/users/go-gitea/events{/privacy}","received_events_url":"https://api.github.com/users/go-gitea/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/go-gitea/gitea","description":"Git with a cup of tea! Painless self-hosted all-in-one software development service, including Git hosting, code review, team collaboration, package registry and CI/CD","fork":false,"url":"https://api.github.com/repos/go-gitea/gitea","forks_url":"https://api.github.com/repos/go-gitea/gitea/forks","keys_url":"https://api.github.com/repos/go-gitea/gitea/keys{/key_id}","collaborators_url":"https://api.github.com/repos/go-gitea/gitea/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/go-gitea/gitea/teams","hooks_url":"https://api.github.com/repos/go-gitea/gitea/hooks","issue_events_url":"https://api.github.com/repos/go-gitea/gitea/issues/events{/number}","events_url":"https://api.github.com/repos/go-gitea/gitea/events","assignees_url":"https://api.github.com/repos/go-gitea/gitea/assignees{/user}","branches_url":"https://api.github.com/repos/go-gitea/gitea/branches{/branch}","tags_url":"https://api.github.com/repos/go-gitea/gitea/tags","blobs_url":"https://api.github.com/repos/go-gitea/gitea/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/go-gitea/gitea/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/go-gitea/gitea/git/refs{/sha}","trees_url":"https://api.github.com/repos/go-gitea/gitea/git/trees{/sha}","statuses_url":"https://api.github.com/repos/go-gitea/gitea/statuses/{sha}","languages_url":"https://api.github.com/repos/go-gitea/gitea/languages","stargazers_url":"https://api.github.com/repos/go-gitea/gitea/stargazers","contributors_url":"https://api.github.com/repos/go-gitea/gitea/contributors","subscribers_url":"https://api.github.com/repos/go-gitea/gitea/subscribers","subscription_url":"https://api.github.com/repos/go-gitea/gitea/subscription","commits_url":"https://api.github.com/repos/go-gitea/gitea/commits{/sha}","git_commits_url":"https://api.github.com/repos/go-gitea/gitea/git/commits{/sha}","comments_url":"https://api.github.com/repos/go-gitea/gitea/comments{/number}","issue_comment_url":"https://api.github.com/repos/go-gitea/gitea/issues/comments{/number}","contents_url":"https://api.github.com/repos/go-gitea/gitea/contents/{+path}","compare_url":"https://api.github.com/repos/go-gitea/gitea/compare/{base}...{head}","merges_url":"https://api.github.com/repos/go-gitea/gitea/merges","archive_url":"https://api.github.com/repos/go-gitea/gitea/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/go-gitea/gitea/downloads","issues_url":"https://api.github.com/repos/go-gitea/gitea/issues{/number}","pulls_url":"https://api.github.com/repos/go-gitea/gitea/pulls{/number}","milestones_url":"https://api.github.com/repos/go-gitea/gitea/milestones{/number}","notifications_url":"https://api.github.com/repos/go-gitea/gitea/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/go-gitea/gitea/labels{/name}","releases_url":"https://api.github.com/repos/go-gitea/gitea/releases{/id}","deployments_url":"https://api.github.com/repos/go-gitea/gitea/deployments","created_at":"2016-11-01T02:13:26Z","updated_at":"2025-11-09T22:07:00Z","pushed_at":"2025-11-09T21:54:34Z","git_url":"git://github.com/go-gitea/gitea.git","ssh_url":"git@github.com:go-gitea/gitea.git","clone_url":"https://github.com/go-gitea/gitea.git","svn_url":"https://github.com/go-gitea/gitea","homepage":"https://gitea.com","size":317853,"stargazers_count":51900,"watchers_count":51900,"language":"Go","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":false,"forks_count":6199,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":2849,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":true,"topics":["bitbucket","cicd","devops","docker-registry-v2","git","git-gui","git-server","gitea","github","github-actions","gitlab","go","golang","hacktoberfest","maven-server","npm-registry","vue"],"visibility":"public","forks":6199,"open_issues":2849,"watchers":51900,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"### Feature Description\r\n\r\nWe have received may reports about loading user dashboard too slow.\r\nPlease discuss/report related/similar issues (only the user dashboard, other pages are fine) in this summary, and avoid creating more and more.\r\nAlthough these reports maybe caused by different reasons, I think it is better to have a summary about this issue.\r\n@lunny\r\nCan you pin this issue on the top?\r\n\r\nOpening:\r\n- #29769\r\n- #32858\r\n\r\nClosed:\r\n- #16665\r\n- #21045\r\n- #21611\r\n- #23101\r\n- #31582\r\n- #31646\r\n- #32112\r\n- #32224\r\n\r\n### Screenshots\r\n\r\n_No response_","reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/31698/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/go-gitea/gitea/issues/31698/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/go-gitea/gitea/issues/comments/2403662982","html_url":"https://github.com/go-gitea/gitea/issues/32224#issuecomment-2403662982","issue_url":"https://api.github.com/repos/go-gitea/gitea/issues/32224","id":2403662982,"node_id":"IC_kwDOBFIx286PRPyG","user":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-10-10T00:25:06Z","updated_at":"2024-10-10T00:25:06Z","body":"> @lunny \n\nI will investigate it. How many records in the table action.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/comments/2403662982/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":14581213825,"node_id":"MEE_lADOBFIx286ZirHnzwAAAANlG6qB","url":"https://api.github.com/repos/go-gitea/gitea/issues/events/14581213825","actor":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2024-10-10T00:25:07Z","performed_via_github_app":null},{"id":14581213831,"node_id":"SE_lADOBFIx286ZirHnzwAAAANlG6qH","url":"https://api.github.com/repos/go-gitea/gitea/issues/events/14581213831","actor":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2024-10-10T00:25:07Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/go-gitea/gitea/issues/comments/2406169280","html_url":"https://github.com/go-gitea/gitea/issues/32224#issuecomment-2406169280","issue_url":"https://api.github.com/repos/go-gitea/gitea/issues/32224","id":2406169280,"node_id":"IC_kwDOBFIx286PazrA","user":{"login":"bsofiato","id":5076967,"node_id":"MDQ6VXNlcjUwNzY5Njc=","avatar_url":"https://avatars.githubusercontent.com/u/5076967?v=4","gravatar_id":"","url":"https://api.github.com/users/bsofiato","html_url":"https://github.com/bsofiato","followers_url":"https://api.github.com/users/bsofiato/followers","following_url":"https://api.github.com/users/bsofiato/following{/other_user}","gists_url":"https://api.github.com/users/bsofiato/gists{/gist_id}","starred_url":"https://api.github.com/users/bsofiato/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bsofiato/subscriptions","organizations_url":"https://api.github.com/users/bsofiato/orgs","repos_url":"https://api.github.com/users/bsofiato/repos","events_url":"https://api.github.com/users/bsofiato/events{/privacy}","received_events_url":"https://api.github.com/users/bsofiato/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-10-10T22:47:30Z","updated_at":"2024-10-10T22:47:30Z","body":"Hey @lunny, I have a somewhat large instance of Gitea running on my machine (at least I think it is large -- its actions table has almost 13 million rows).\r\n\r\nI've created an index based on the action's user_id and is_deleted columns and the cost of the queries has dropped from 61923.66 to about 8). The database is Postgres.\r\n\r\nI don't know if such an index would have other implications that I'm unaware of. But if you think that adding the index would be a sensible approach, I would gladly submit a PR for it.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/comments/2406169280/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"bsofiato","id":5076967,"node_id":"MDQ6VXNlcjUwNzY5Njc=","avatar_url":"https://avatars.githubusercontent.com/u/5076967?v=4","gravatar_id":"","url":"https://api.github.com/users/bsofiato","html_url":"https://github.com/bsofiato","followers_url":"https://api.github.com/users/bsofiato/followers","following_url":"https://api.github.com/users/bsofiato/following{/other_user}","gists_url":"https://api.github.com/users/bsofiato/gists{/gist_id}","starred_url":"https://api.github.com/users/bsofiato/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bsofiato/subscriptions","organizations_url":"https://api.github.com/users/bsofiato/orgs","repos_url":"https://api.github.com/users/bsofiato/repos","events_url":"https://api.github.com/users/bsofiato/events{/privacy}","received_events_url":"https://api.github.com/users/bsofiato/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":14598099050,"node_id":"MEE_lADOBFIx286ZirHnzwAAAANmHVBq","url":"https://api.github.com/repos/go-gitea/gitea/issues/events/14598099050","actor":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2024-10-10T22:47:31Z","performed_via_github_app":null},{"id":14598099057,"node_id":"SE_lADOBFIx286ZirHnzwAAAANmHVBx","url":"https://api.github.com/repos/go-gitea/gitea/issues/events/14598099057","actor":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2024-10-10T22:47:31Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/go-gitea/gitea/issues/comments/2406182906","html_url":"https://github.com/go-gitea/gitea/issues/32224#issuecomment-2406182906","issue_url":"https://api.github.com/repos/go-gitea/gitea/issues/32224","id":2406182906,"node_id":"IC_kwDOBFIx286Pa2_6","user":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-10-10T22:58:44Z","updated_at":"2024-10-10T22:58:44Z","body":"According to the current index function, I think maybe you are right, we need that index. Please send a PR to fix this.\r\n\r\n```go\r\n// TableIndices implements xorm's TableIndices interface\r\nfunc (a *Action) TableIndices() []*schemas.Index {\r\n\trepoIndex := schemas.NewIndex(\"r_u_d\", schemas.IndexType)\r\n\trepoIndex.AddColumn(\"repo_id\", \"user_id\", \"is_deleted\")\r\n\r\n\tactUserIndex := schemas.NewIndex(\"au_r_c_u_d\", schemas.IndexType)\r\n\tactUserIndex.AddColumn(\"act_user_id\", \"repo_id\", \"created_unix\", \"user_id\", \"is_deleted\")\r\n\r\n\tcudIndex := schemas.NewIndex(\"c_u_d\", schemas.IndexType)\r\n\tcudIndex.AddColumn(\"created_unix\", \"user_id\", \"is_deleted\")\r\n\r\n\tindices := []*schemas.Index{actUserIndex, repoIndex, cudIndex}\r\n\r\n\treturn indices\r\n}\r\n```","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/comments/2406182906/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/go-gitea/gitea/issues/comments/2406185089","html_url":"https://github.com/go-gitea/gitea/issues/32224#issuecomment-2406185089","issue_url":"https://api.github.com/repos/go-gitea/gitea/issues/32224","id":2406185089,"node_id":"IC_kwDOBFIx286Pa3iB","user":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-10-10T23:00:50Z","updated_at":"2024-10-10T23:00:50Z","body":"I think the `61923.66 to about 8` means ms?","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/comments/2406185089/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/go-gitea/gitea/issues/comments/2406191908","html_url":"https://github.com/go-gitea/gitea/issues/32224#issuecomment-2406191908","issue_url":"https://api.github.com/repos/go-gitea/gitea/issues/32224","id":2406191908,"node_id":"IC_kwDOBFIx286Pa5Mk","user":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-10-10T23:07:38Z","updated_at":"2024-10-10T23:07:38Z","body":"Looks like we already have the index definition. `cudIndex.AddColumn(\"created_unix\", \"user_id\", \"is_deleted\")` which will be used in find function, but for counting , the `Desc(\"`action`.created_unix\")` will be ignored. @bsofiato Can you post your two SQL's execution time. One is for counting, and the other one is for finding.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/comments/2406191908/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":14598316114,"node_id":"MEE_lADOBFIx286ZirHnzwAAAANmIKBS","url":"https://api.github.com/repos/go-gitea/gitea/issues/events/14598316114","actor":{"login":"bsofiato","id":5076967,"node_id":"MDQ6VXNlcjUwNzY5Njc=","avatar_url":"https://avatars.githubusercontent.com/u/5076967?v=4","gravatar_id":"","url":"https://api.github.com/users/bsofiato","html_url":"https://github.com/bsofiato","followers_url":"https://api.github.com/users/bsofiato/followers","following_url":"https://api.github.com/users/bsofiato/following{/other_user}","gists_url":"https://api.github.com/users/bsofiato/gists{/gist_id}","starred_url":"https://api.github.com/users/bsofiato/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bsofiato/subscriptions","organizations_url":"https://api.github.com/users/bsofiato/orgs","repos_url":"https://api.github.com/users/bsofiato/repos","events_url":"https://api.github.com/users/bsofiato/events{/privacy}","received_events_url":"https://api.github.com/users/bsofiato/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2024-10-10T23:07:39Z","performed_via_github_app":null},{"id":14598316120,"node_id":"SE_lADOBFIx286ZirHnzwAAAANmIKBY","url":"https://api.github.com/repos/go-gitea/gitea/issues/events/14598316120","actor":{"login":"bsofiato","id":5076967,"node_id":"MDQ6VXNlcjUwNzY5Njc=","avatar_url":"https://avatars.githubusercontent.com/u/5076967?v=4","gravatar_id":"","url":"https://api.github.com/users/bsofiato","html_url":"https://github.com/bsofiato","followers_url":"https://api.github.com/users/bsofiato/followers","following_url":"https://api.github.com/users/bsofiato/following{/other_user}","gists_url":"https://api.github.com/users/bsofiato/gists{/gist_id}","starred_url":"https://api.github.com/users/bsofiato/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bsofiato/subscriptions","organizations_url":"https://api.github.com/users/bsofiato/orgs","repos_url":"https://api.github.com/users/bsofiato/repos","events_url":"https://api.github.com/users/bsofiato/events{/privacy}","received_events_url":"https://api.github.com/users/bsofiato/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2024-10-10T23:07:39Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/go-gitea/gitea/issues/comments/2406332294","html_url":"https://github.com/go-gitea/gitea/issues/32224#issuecomment-2406332294","issue_url":"https://api.github.com/repos/go-gitea/gitea/issues/32224","id":2406332294,"node_id":"IC_kwDOBFIx286PbbeG","user":{"login":"bsofiato","id":5076967,"node_id":"MDQ6VXNlcjUwNzY5Njc=","avatar_url":"https://avatars.githubusercontent.com/u/5076967?v=4","gravatar_id":"","url":"https://api.github.com/users/bsofiato","html_url":"https://github.com/bsofiato","followers_url":"https://api.github.com/users/bsofiato/followers","following_url":"https://api.github.com/users/bsofiato/following{/other_user}","gists_url":"https://api.github.com/users/bsofiato/gists{/gist_id}","starred_url":"https://api.github.com/users/bsofiato/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bsofiato/subscriptions","organizations_url":"https://api.github.com/users/bsofiato/orgs","repos_url":"https://api.github.com/users/bsofiato/repos","events_url":"https://api.github.com/users/bsofiato/events{/privacy}","received_events_url":"https://api.github.com/users/bsofiato/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-10-11T01:07:36Z","updated_at":"2024-10-11T01:07:36Z","body":"> I think the `61923.66 to about 8` means ms?\r\n\r\nNope, it is more like an arbitrary unit of costs. This [article](https://scalegrid.io/blog/postgres-explain-cost/) does a great job of explaining the concept.\r\n\r\n> Looks like we already have the index definition. `cudIndex.AddColumn(\"created_unix\", \"user_id\", \"is_deleted\")` which will be used in find function, but for counting , the `Desc(\"`action`.created_unix\")` will be ignored. @bsofiato Can you post your two SQL's execution time. One is for counting, and the other one is for finding.\r\n\r\nFor sure. The first screen shot shows the cost when using the indexes that are already in place. See that it uses the `IDX_action_user_id` index and it performs a scan filtering it by the is_deleted column.\r\n\r\n![image](https://github.com/user-attachments/assets/b1d9c958-8ce3-4fc1-8d4a-89daaa7d3b90)\r\n\r\nFor fetching whe get the results below.\r\n\r\n![image](https://github.com/user-attachments/assets/bb1463f7-3ddd-40a4-944c-8bf32a06aae9)\r\n\r\nIf I apply the command `CREATE INDEX action_user_id_idx ON public.\"action\" (user_id,is_deleted);` and rerun the query I get the results below.\r\n\r\n![image](https://github.com/user-attachments/assets/03bd4db3-735d-42ce-bb64-8b217e8a2627)\r\n\r\nThe results below show the fetching results.\r\n\r\n![image](https://github.com/user-attachments/assets/c13d8a4d-ffe3-4d96-9129-75fbda29cecb)\r\n\r\nAs of what is happening with the `cudIndex.AddColumn(\"created_unix\", \"user_id\", \"is_deleted\")` index. AFAIK, a composite index can only be used if the criterion spans its leftmost columns. To check if this hypothesis is correct, I've created another index on on which the `created_unix` is placed last. The query cost were similar to the 2nd scenario. \r\n\r\n![image](https://github.com/user-attachments/assets/c695ede5-89dd-4e0d-a136-bd1fb1d567ae)\r\n\r\nFetching results:\r\n\r\n![image](https://github.com/user-attachments/assets/dd7af820-7969-4481-8c3f-b5a008002b61)\r\n\r\nIf the `created_unix` is not used in any criteria (i.e., only used to order results), I think we could safely reorder the index columns to make it more selective. Otherwise, I think the solution would be to create another index.\r\n\r\n\r\n\r\n\r\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/comments/2406332294/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"bsofiato","id":5076967,"node_id":"MDQ6VXNlcjUwNzY5Njc=","avatar_url":"https://avatars.githubusercontent.com/u/5076967?v=4","gravatar_id":"","url":"https://api.github.com/users/bsofiato","html_url":"https://github.com/bsofiato","followers_url":"https://api.github.com/users/bsofiato/followers","following_url":"https://api.github.com/users/bsofiato/following{/other_user}","gists_url":"https://api.github.com/users/bsofiato/gists{/gist_id}","starred_url":"https://api.github.com/users/bsofiato/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bsofiato/subscriptions","organizations_url":"https://api.github.com/users/bsofiato/orgs","repos_url":"https://api.github.com/users/bsofiato/repos","events_url":"https://api.github.com/users/bsofiato/events{/privacy}","received_events_url":"https://api.github.com/users/bsofiato/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":14599955173,"node_id":"MEE_lADOBFIx286ZirHnzwAAAANmOaLl","url":"https://api.github.com/repos/go-gitea/gitea/issues/events/14599955173","actor":{"login":"bsofiato","id":5076967,"node_id":"MDQ6VXNlcjUwNzY5Njc=","avatar_url":"https://avatars.githubusercontent.com/u/5076967?v=4","gravatar_id":"","url":"https://api.github.com/users/bsofiato","html_url":"https://github.com/bsofiato","followers_url":"https://api.github.com/users/bsofiato/followers","following_url":"https://api.github.com/users/bsofiato/following{/other_user}","gists_url":"https://api.github.com/users/bsofiato/gists{/gist_id}","starred_url":"https://api.github.com/users/bsofiato/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bsofiato/subscriptions","organizations_url":"https://api.github.com/users/bsofiato/orgs","repos_url":"https://api.github.com/users/bsofiato/repos","events_url":"https://api.github.com/users/bsofiato/events{/privacy}","received_events_url":"https://api.github.com/users/bsofiato/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2024-10-11T01:07:37Z","performed_via_github_app":null},{"id":14599955183,"node_id":"SE_lADOBFIx286ZirHnzwAAAANmOaLv","url":"https://api.github.com/repos/go-gitea/gitea/issues/events/14599955183","actor":{"login":"bsofiato","id":5076967,"node_id":"MDQ6VXNlcjUwNzY5Njc=","avatar_url":"https://avatars.githubusercontent.com/u/5076967?v=4","gravatar_id":"","url":"https://api.github.com/users/bsofiato","html_url":"https://github.com/bsofiato","followers_url":"https://api.github.com/users/bsofiato/followers","following_url":"https://api.github.com/users/bsofiato/following{/other_user}","gists_url":"https://api.github.com/users/bsofiato/gists{/gist_id}","starred_url":"https://api.github.com/users/bsofiato/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bsofiato/subscriptions","organizations_url":"https://api.github.com/users/bsofiato/orgs","repos_url":"https://api.github.com/users/bsofiato/repos","events_url":"https://api.github.com/users/bsofiato/events{/privacy}","received_events_url":"https://api.github.com/users/bsofiato/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2024-10-11T01:07:37Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/go-gitea/gitea/issues/comments/2406474159","html_url":"https://github.com/go-gitea/gitea/issues/32224#issuecomment-2406474159","issue_url":"https://api.github.com/repos/go-gitea/gitea/issues/32224","id":2406474159,"node_id":"IC_kwDOBFIx286Pb-Gv","user":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-10-11T03:09:52Z","updated_at":"2024-10-11T03:09:52Z","body":"Can you try `select * from action where user_id=? and is_deleted=? order by created_unix desc`? This should be the SQL Gitea used in the dashboard.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/comments/2406474159/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-10-11T07:09:57Z","updated_at":"2024-10-11T07:09:57Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/31752","repository_url":"https://api.github.com/repos/go-gitea/gitea","labels_url":"https://api.github.com/repos/go-gitea/gitea/issues/31752/labels{/name}","comments_url":"https://api.github.com/repos/go-gitea/gitea/issues/31752/comments","events_url":"https://api.github.com/repos/go-gitea/gitea/issues/31752/events","html_url":"https://github.com/go-gitea/gitea/issues/31752","id":2443073612,"node_id":"I_kwDOBFIx286RnlhM","number":31752,"title":"Feature Request for better performance on paging and lees memory usage on database","user":{"login":"somera","id":8334250,"node_id":"MDQ6VXNlcjgzMzQyNTA=","avatar_url":"https://avatars.githubusercontent.com/u/8334250?v=4","gravatar_id":"","url":"https://api.github.com/users/somera","html_url":"https://github.com/somera","followers_url":"https://api.github.com/users/somera/followers","following_url":"https://api.github.com/users/somera/following{/other_user}","gists_url":"https://api.github.com/users/somera/gists{/gist_id}","starred_url":"https://api.github.com/users/somera/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/somera/subscriptions","organizations_url":"https://api.github.com/users/somera/orgs","repos_url":"https://api.github.com/users/somera/repos","events_url":"https://api.github.com/users/somera/events{/privacy}","received_events_url":"https://api.github.com/users/somera/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":474393850,"node_id":"MDU6TGFiZWw0NzQzOTM4NTA=","url":"https://api.github.com/repos/go-gitea/gitea/labels/type/proposal","name":"type/proposal","color":"5319e7","default":false,"description":"The new feature has not been accepted yet but needs to be discussed first."},{"id":1743290619,"node_id":"MDU6TGFiZWwxNzQzMjkwNjE5","url":"https://api.github.com/repos/go-gitea/gitea/labels/performance/speed","name":"performance/speed","color":"db78d3","default":false,"description":"performance issues with slow downs"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":26,"created_at":"2024-08-01T18:07:28Z","updated_at":"2024-12-02T01:41:36Z","closed_at":"2024-09-02T19:05:10Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":72495579,"node_id":"MDEwOlJlcG9zaXRvcnk3MjQ5NTU3OQ==","name":"gitea","full_name":"go-gitea/gitea","private":false,"owner":{"login":"go-gitea","id":12724356,"node_id":"MDEyOk9yZ2FuaXphdGlvbjEyNzI0MzU2","avatar_url":"https://avatars.githubusercontent.com/u/12724356?v=4","gravatar_id":"","url":"https://api.github.com/users/go-gitea","html_url":"https://github.com/go-gitea","followers_url":"https://api.github.com/users/go-gitea/followers","following_url":"https://api.github.com/users/go-gitea/following{/other_user}","gists_url":"https://api.github.com/users/go-gitea/gists{/gist_id}","starred_url":"https://api.github.com/users/go-gitea/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/go-gitea/subscriptions","organizations_url":"https://api.github.com/users/go-gitea/orgs","repos_url":"https://api.github.com/users/go-gitea/repos","events_url":"https://api.github.com/users/go-gitea/events{/privacy}","received_events_url":"https://api.github.com/users/go-gitea/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/go-gitea/gitea","description":"Git with a cup of tea! Painless self-hosted all-in-one software development service, including Git hosting, code review, team collaboration, package registry and CI/CD","fork":false,"url":"https://api.github.com/repos/go-gitea/gitea","forks_url":"https://api.github.com/repos/go-gitea/gitea/forks","keys_url":"https://api.github.com/repos/go-gitea/gitea/keys{/key_id}","collaborators_url":"https://api.github.com/repos/go-gitea/gitea/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/go-gitea/gitea/teams","hooks_url":"https://api.github.com/repos/go-gitea/gitea/hooks","issue_events_url":"https://api.github.com/repos/go-gitea/gitea/issues/events{/number}","events_url":"https://api.github.com/repos/go-gitea/gitea/events","assignees_url":"https://api.github.com/repos/go-gitea/gitea/assignees{/user}","branches_url":"https://api.github.com/repos/go-gitea/gitea/branches{/branch}","tags_url":"https://api.github.com/repos/go-gitea/gitea/tags","blobs_url":"https://api.github.com/repos/go-gitea/gitea/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/go-gitea/gitea/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/go-gitea/gitea/git/refs{/sha}","trees_url":"https://api.github.com/repos/go-gitea/gitea/git/trees{/sha}","statuses_url":"https://api.github.com/repos/go-gitea/gitea/statuses/{sha}","languages_url":"https://api.github.com/repos/go-gitea/gitea/languages","stargazers_url":"https://api.github.com/repos/go-gitea/gitea/stargazers","contributors_url":"https://api.github.com/repos/go-gitea/gitea/contributors","subscribers_url":"https://api.github.com/repos/go-gitea/gitea/subscribers","subscription_url":"https://api.github.com/repos/go-gitea/gitea/subscription","commits_url":"https://api.github.com/repos/go-gitea/gitea/commits{/sha}","git_commits_url":"https://api.github.com/repos/go-gitea/gitea/git/commits{/sha}","comments_url":"https://api.github.com/repos/go-gitea/gitea/comments{/number}","issue_comment_url":"https://api.github.com/repos/go-gitea/gitea/issues/comments{/number}","contents_url":"https://api.github.com/repos/go-gitea/gitea/contents/{+path}","compare_url":"https://api.github.com/repos/go-gitea/gitea/compare/{base}...{head}","merges_url":"https://api.github.com/repos/go-gitea/gitea/merges","archive_url":"https://api.github.com/repos/go-gitea/gitea/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/go-gitea/gitea/downloads","issues_url":"https://api.github.com/repos/go-gitea/gitea/issues{/number}","pulls_url":"https://api.github.com/repos/go-gitea/gitea/pulls{/number}","milestones_url":"https://api.github.com/repos/go-gitea/gitea/milestones{/number}","notifications_url":"https://api.github.com/repos/go-gitea/gitea/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/go-gitea/gitea/labels{/name}","releases_url":"https://api.github.com/repos/go-gitea/gitea/releases{/id}","deployments_url":"https://api.github.com/repos/go-gitea/gitea/deployments","created_at":"2016-11-01T02:13:26Z","updated_at":"2025-11-09T22:07:00Z","pushed_at":"2025-11-09T21:54:34Z","git_url":"git://github.com/go-gitea/gitea.git","ssh_url":"git@github.com:go-gitea/gitea.git","clone_url":"https://github.com/go-gitea/gitea.git","svn_url":"https://github.com/go-gitea/gitea","homepage":"https://gitea.com","size":317853,"stargazers_count":51900,"watchers_count":51900,"language":"Go","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":false,"forks_count":6199,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":2849,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":true,"topics":["bitbucket","cicd","devops","docker-registry-v2","git","git-gui","git-server","gitea","github","github-actions","gitlab","go","golang","hacktoberfest","maven-server","npm-registry","vue"],"visibility":"public","forks":6199,"open_issues":2849,"watchers":51900,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"### Feature Description\r\n\r\nI'm again. The gitea user with 3655 organisations and 22573 repos.\r\n\r\nI wondered that my paging is slow. Not on the first pages.\r\n\r\nFirst page need 1-3 seconds. 1 second if the data is precached.\r\n\r\n![image](https://github.com/user-attachments/assets/bf6b89fb-ae81-4ff3-819e-d2f2a2aa7fae)\r\n\r\nOn the last pages ...\r\n\r\n![image](https://github.com/user-attachments/assets/210c9434-f106-4d2f-b80f-2dc613afe36f)\r\n\r\nBut this is after my 1st optimisation.\r\n\r\nYou made this queries\r\n\r\n1. SELECT count(*) FROM \"action\" INNER JOIN \"repository\" ON \"repository\".id = \"action\".repo_id WHERE user_id=$1 AND is_deleted=$2\r\n2. SELECT action.* FROM action INNER JOIN repository ON repository.id = action.repo_id WHERE user_id='1' AND is_deleted='f' ORDER BY action.created_unix DESC LIMIT 20 OFFSET 2043740\r\n\r\non pagging.\r\n\r\nExplain for the count query is\r\n\r\n![image](https://github.com/user-attachments/assets/65b6cbb4-ebf3-4a1b-ac40-11a4a0868c58)\r\n\r\nAnd than I changed the query to\r\n\r\nSELECT count(action.id) FROM \"action\" INNER JOIN \"repository\" ON \"repository\".id = \"action\".repo_id WHERE user_id=$1 AND is_deleted=$2\r\n\r\nand ...\r\n\r\n![image](https://github.com/user-attachments/assets/d64de64e-d109-4327-ae93-5b971af6f402)\r\n\r\nit's faster.\r\n\r\n\r\nExplain for the SELECT query is\r\n\r\n![image](https://github.com/user-attachments/assets/f11ccb17-de32-44d9-8fb6-e1795a8275f5)\r\n\r\nvery bad. I increased work_mem to 6GB and it's better now\r\n\r\n![image](https://github.com/user-attachments/assets/88c5bc6f-8bfa-47ce-a826-36766447d0b2)\r\n\r\nAfter this fix it need ~11 seconds.\r\n\r\nBut it can be better. Cause the problem is this\r\n\r\nSELECT action.* FROM action INNER JOIN repository ON repository.id = action.repo_id WHERE user_id='1' AND is_deleted='f' ORDER BY action.created_unix DESC LIMIT 20 OFFSET 2043740\r\n\r\nquery. When you change it to\r\n\r\nSELECT action.id FROM action INNER JOIN repository ON repository.id = action.repo_id WHERE user_id='1' AND is_deleted='f' ORDER BY action.created_unix DESC LIMIT 20 OFFSET 2043740\r\n\r\n-> you will get 20 action.id's than explain is\r\n\r\n![image](https://github.com/user-attachments/assets/fef9d0b1-ea10-4ae4-b968-768732474543)\r\n\r\nand need ~5 seconds and a very less memory on the database.\r\n\r\nThan gitea should get the action.* infos only for the 20 id's in the new query.\r\n\r\nThis optimisation will be good for all gitea users.\r\n\r\n\r\n### Screenshots\r\n\r\n_No response_","reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/31752/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/go-gitea/gitea/issues/31752/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/go-gitea/gitea/issues/comments/2406963600","html_url":"https://github.com/go-gitea/gitea/issues/32224#issuecomment-2406963600","issue_url":"https://api.github.com/repos/go-gitea/gitea/issues/32224","id":2406963600,"node_id":"IC_kwDOBFIx286Pd1mQ","user":{"login":"somera","id":8334250,"node_id":"MDQ6VXNlcjgzMzQyNTA=","avatar_url":"https://avatars.githubusercontent.com/u/8334250?v=4","gravatar_id":"","url":"https://api.github.com/users/somera","html_url":"https://github.com/somera","followers_url":"https://api.github.com/users/somera/followers","following_url":"https://api.github.com/users/somera/following{/other_user}","gists_url":"https://api.github.com/users/somera/gists{/gist_id}","starred_url":"https://api.github.com/users/somera/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/somera/subscriptions","organizations_url":"https://api.github.com/users/somera/orgs","repos_url":"https://api.github.com/users/somera/repos","events_url":"https://api.github.com/users/somera/events{/privacy}","received_events_url":"https://api.github.com/users/somera/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-10-11T09:02:38Z","updated_at":"2024-10-11T09:02:38Z","body":"In my case I see improvements which was made in #31752. In my action table are 3977694 entries. And this\r\n```Dauer: 1471.509 ms  Ausfhren <unnamed>: SELECT count(*) FROM \"action\" WHERE user_id=$1 AND is_deleted=$2```\r\nquery needs ~1,5 seconds, if the data is cached. First call after reboot need ~8 seconds. But this is ok. My Gitea and PostgreSQL 16 run on an 4 core NUC with 32 GB RAM.\r\n\r\n\r\n**Idea: The count query could by cached and invalidated when there are changes in the action table? this would speedup this. Depends how often something changes in the action table.**\r\n\r\nI missing only some improvements on the higher pages on pagging. Cause there sorting is consuming too much RAM.\r\n\r\nI mean this query\r\n\r\n```\r\nSELECT\r\n\t\"id\", \"user_id\", \"op_type\", \"act_user_id\", \"repo_id\", \"comment_id\", \"is_deleted\", \"ref_name\", \"is_private\", \"content\", \"created_unix\"\r\nFROM\r\n\t\"action\"\r\nWHERE\r\n\tuser_id=1 AND is_deleted='f'\r\nORDER BY \"action\".\"created_unix\" DESC LIMIT 20 OFFSET 1976620\r\n```\r\n![image](https://github.com/user-attachments/assets/baeca099-9ca1-4bf2-bb49-453d1c17eb59)\r\n\r\nAnd the optimizes query need less RAM\r\n\r\n![image](https://github.com/user-attachments/assets/d463296c-c2a0-48a9-8c25-1dfad39ad620)","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/comments/2406963600/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"somera","id":8334250,"node_id":"MDQ6VXNlcjgzMzQyNTA=","avatar_url":"https://avatars.githubusercontent.com/u/8334250?v=4","gravatar_id":"","url":"https://api.github.com/users/somera","html_url":"https://github.com/somera","followers_url":"https://api.github.com/users/somera/followers","following_url":"https://api.github.com/users/somera/following{/other_user}","gists_url":"https://api.github.com/users/somera/gists{/gist_id}","starred_url":"https://api.github.com/users/somera/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/somera/subscriptions","organizations_url":"https://api.github.com/users/somera/orgs","repos_url":"https://api.github.com/users/somera/repos","events_url":"https://api.github.com/users/somera/events{/privacy}","received_events_url":"https://api.github.com/users/somera/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/go-gitea/gitea/issues/comments/2407017973","html_url":"https://github.com/go-gitea/gitea/issues/32224#issuecomment-2407017973","issue_url":"https://api.github.com/repos/go-gitea/gitea/issues/32224","id":2407017973,"node_id":"IC_kwDOBFIx286PeC31","user":{"login":"somera","id":8334250,"node_id":"MDQ6VXNlcjgzMzQyNTA=","avatar_url":"https://avatars.githubusercontent.com/u/8334250?v=4","gravatar_id":"","url":"https://api.github.com/users/somera","html_url":"https://github.com/somera","followers_url":"https://api.github.com/users/somera/followers","following_url":"https://api.github.com/users/somera/following{/other_user}","gists_url":"https://api.github.com/users/somera/gists{/gist_id}","starred_url":"https://api.github.com/users/somera/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/somera/subscriptions","organizations_url":"https://api.github.com/users/somera/orgs","repos_url":"https://api.github.com/users/somera/repos","events_url":"https://api.github.com/users/somera/events{/privacy}","received_events_url":"https://api.github.com/users/somera/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-10-11T09:31:01Z","updated_at":"2024-10-11T09:31:01Z","body":"> I've created an index based on the action's user_id and is_deleted columns and the cost of the queries has dropped from 61923.66 to about 8). The database is Postgres.\r\n\r\nHow is your Postgres RAM configuration? In my case I saw a lot of tmp-files and I increased some parameters.\r\n```\r\nshared_buffers = 8GB\r\ntemp_buffers = 2GB\r\nwork_mem = 6GB\r\nmax_wal_size = 2GB\r\nmin_wal_size = 512MB\r\neffective_cache_size = 4GB\r\n```\r\nThis was an improvement.\r\n\r\nAnd this https://explain.depesz.com/ make the explain result more readable.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/comments/2407017973/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"somera","id":8334250,"node_id":"MDQ6VXNlcjgzMzQyNTA=","avatar_url":"https://avatars.githubusercontent.com/u/8334250?v=4","gravatar_id":"","url":"https://api.github.com/users/somera","html_url":"https://github.com/somera","followers_url":"https://api.github.com/users/somera/followers","following_url":"https://api.github.com/users/somera/following{/other_user}","gists_url":"https://api.github.com/users/somera/gists{/gist_id}","starred_url":"https://api.github.com/users/somera/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/somera/subscriptions","organizations_url":"https://api.github.com/users/somera/orgs","repos_url":"https://api.github.com/users/somera/repos","events_url":"https://api.github.com/users/somera/events{/privacy}","received_events_url":"https://api.github.com/users/somera/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/go-gitea/gitea/issues/comments/2407971468","html_url":"https://github.com/go-gitea/gitea/issues/32224#issuecomment-2407971468","issue_url":"https://api.github.com/repos/go-gitea/gitea/issues/32224","id":2407971468,"node_id":"IC_kwDOBFIx286PhrqM","user":{"login":"bsofiato","id":5076967,"node_id":"MDQ6VXNlcjUwNzY5Njc=","avatar_url":"https://avatars.githubusercontent.com/u/5076967?v=4","gravatar_id":"","url":"https://api.github.com/users/bsofiato","html_url":"https://github.com/bsofiato","followers_url":"https://api.github.com/users/bsofiato/followers","following_url":"https://api.github.com/users/bsofiato/following{/other_user}","gists_url":"https://api.github.com/users/bsofiato/gists{/gist_id}","starred_url":"https://api.github.com/users/bsofiato/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bsofiato/subscriptions","organizations_url":"https://api.github.com/users/bsofiato/orgs","repos_url":"https://api.github.com/users/bsofiato/repos","events_url":"https://api.github.com/users/bsofiato/events{/privacy}","received_events_url":"https://api.github.com/users/bsofiato/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-10-11T18:59:35Z","updated_at":"2024-10-11T18:59:35Z","body":"> Can you try `select * from action where user_id=? and is_deleted=? order by created_unix desc`? This should be the SQL Gitea used in the dashboard.\r\n\r\nFor sure. I just added limit to the end of the query (since the dashboard is paged, I assume it is)\r\n\r\nThe original index yields the results below:\r\n\r\n![image](https://github.com/user-attachments/assets/2f1c0250-bf4d-41c9-895c-f41d349931f6)\r\n\r\nIn the other hand, we get the following results when using the (user_id, is_deleted) index. Notice that postgre still uses the same index.\r\n\r\n![image](https://github.com/user-attachments/assets/6403219d-05b1-4379-a824-94f23bf574fe)\r\n\r\nAfter that, I've added created the (user_id, is_deleted, created_unix) index.  Which resulted in:\r\n\r\n![image](https://github.com/user-attachments/assets/d15d0c57-b037-49f5-87b3-d33e3f4f2ffe)\r\n\r\nLastly, I've tried to create the index as (is_deleted, user_id, created_unix) index. The results was:\r\n\r\n![image](https://github.com/user-attachments/assets/1bc08068-fe50-43b7-ac7c-548ba05db222)\r\n\r\nTha last two index are pratically equal in terms of performance (the actual cost of the 4th being marginally lower).\r\n\r\n\r\n> > I've created an index based on the action's user_id and is_deleted columns and the cost of the queries has dropped from 61923.66 to about 8). The database is Postgres.\r\n> \r\n> How is your Postgres RAM configuration? In my case I saw a lot of tmp-files and I increased some parameters.\r\n> \r\n> ```\r\n> shared_buffers = 8GB\r\n> temp_buffers = 2GB\r\n> work_mem = 6GB\r\n> max_wal_size = 2GB\r\n> min_wal_size = 512MB\r\n> effective_cache_size = 4GB\r\n> ```\r\n> \r\n> This was an improvement.\r\n> \r\n> And this https://explain.depesz.com/ make the explain result more readable.\r\n\r\nI'll have to check it out. But I'm pretty sure no tuning was made to this particular database since it used mainly for development. \r\n\r\nBTW, nice tool :)","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/comments/2407971468/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"bsofiato","id":5076967,"node_id":"MDQ6VXNlcjUwNzY5Njc=","avatar_url":"https://avatars.githubusercontent.com/u/5076967?v=4","gravatar_id":"","url":"https://api.github.com/users/bsofiato","html_url":"https://github.com/bsofiato","followers_url":"https://api.github.com/users/bsofiato/followers","following_url":"https://api.github.com/users/bsofiato/following{/other_user}","gists_url":"https://api.github.com/users/bsofiato/gists{/gist_id}","starred_url":"https://api.github.com/users/bsofiato/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bsofiato/subscriptions","organizations_url":"https://api.github.com/users/bsofiato/orgs","repos_url":"https://api.github.com/users/bsofiato/repos","events_url":"https://api.github.com/users/bsofiato/events{/privacy}","received_events_url":"https://api.github.com/users/bsofiato/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/go-gitea/gitea/issues/comments/2407977042","html_url":"https://github.com/go-gitea/gitea/issues/32224#issuecomment-2407977042","issue_url":"https://api.github.com/repos/go-gitea/gitea/issues/32224","id":2407977042,"node_id":"IC_kwDOBFIx286PhtBS","user":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-10-11T19:03:51Z","updated_at":"2024-10-11T19:03:51Z","body":"The index sequence maybe affect the final performance result. I guess index `(user_id, is_deleted, created_unix)` maybe different from `(created_unix, user_id, is_deleted)` which is the index in the current version of Gitea.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/comments/2407977042/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/go-gitea/gitea/issues/comments/2407996106","html_url":"https://github.com/go-gitea/gitea/issues/32224#issuecomment-2407996106","issue_url":"https://api.github.com/repos/go-gitea/gitea/issues/32224","id":2407996106,"node_id":"IC_kwDOBFIx286PhxrK","user":{"login":"bsofiato","id":5076967,"node_id":"MDQ6VXNlcjUwNzY5Njc=","avatar_url":"https://avatars.githubusercontent.com/u/5076967?v=4","gravatar_id":"","url":"https://api.github.com/users/bsofiato","html_url":"https://github.com/bsofiato","followers_url":"https://api.github.com/users/bsofiato/followers","following_url":"https://api.github.com/users/bsofiato/following{/other_user}","gists_url":"https://api.github.com/users/bsofiato/gists{/gist_id}","starred_url":"https://api.github.com/users/bsofiato/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bsofiato/subscriptions","organizations_url":"https://api.github.com/users/bsofiato/orgs","repos_url":"https://api.github.com/users/bsofiato/repos","events_url":"https://api.github.com/users/bsofiato/events{/privacy}","received_events_url":"https://api.github.com/users/bsofiato/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-10-11T19:19:04Z","updated_at":"2024-10-11T19:19:04Z","body":"> The index sequence maybe affect the final performance result. I guess index `(user_id, is_deleted, created_unix)` maybe different from `(created_unix, user_id, is_deleted)` which is the index in the current version of Gitea.\r\n\r\nYeap. I think the main culprit is indeed the order of the columns in the index. If you guys are okay with it. I think I can supply a PR for that during the weekend. ","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/comments/2407996106/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"bsofiato","id":5076967,"node_id":"MDQ6VXNlcjUwNzY5Njc=","avatar_url":"https://avatars.githubusercontent.com/u/5076967?v=4","gravatar_id":"","url":"https://api.github.com/users/bsofiato","html_url":"https://github.com/bsofiato","followers_url":"https://api.github.com/users/bsofiato/followers","following_url":"https://api.github.com/users/bsofiato/following{/other_user}","gists_url":"https://api.github.com/users/bsofiato/gists{/gist_id}","starred_url":"https://api.github.com/users/bsofiato/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bsofiato/subscriptions","organizations_url":"https://api.github.com/users/bsofiato/orgs","repos_url":"https://api.github.com/users/bsofiato/repos","events_url":"https://api.github.com/users/bsofiato/events{/privacy}","received_events_url":"https://api.github.com/users/bsofiato/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/go-gitea/gitea/issues/comments/2408003737","html_url":"https://github.com/go-gitea/gitea/issues/32224#issuecomment-2408003737","issue_url":"https://api.github.com/repos/go-gitea/gitea/issues/32224","id":2408003737,"node_id":"IC_kwDOBFIx286PhziZ","user":{"login":"somera","id":8334250,"node_id":"MDQ6VXNlcjgzMzQyNTA=","avatar_url":"https://avatars.githubusercontent.com/u/8334250?v=4","gravatar_id":"","url":"https://api.github.com/users/somera","html_url":"https://github.com/somera","followers_url":"https://api.github.com/users/somera/followers","following_url":"https://api.github.com/users/somera/following{/other_user}","gists_url":"https://api.github.com/users/somera/gists{/gist_id}","starred_url":"https://api.github.com/users/somera/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/somera/subscriptions","organizations_url":"https://api.github.com/users/somera/orgs","repos_url":"https://api.github.com/users/somera/repos","events_url":"https://api.github.com/users/somera/events{/privacy}","received_events_url":"https://api.github.com/users/somera/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-10-11T19:25:04Z","updated_at":"2024-10-11T19:25:04Z","body":"I added this\r\n\r\n```\r\nCREATE INDEX IF NOT EXISTS \"IDX_action_u_d_c\"\r\n    ON public.action USING btree\r\n    (user_id ASC NULLS LAST, is_deleted ASC NULLS LAST, created_unix ASC NULLS LAST)\r\n    TABLESPACE pg_default;\r\n\r\nCREATE INDEX IF NOT EXISTS \"IDX_action_u_d\"\r\n    ON public.action USING btree\r\n    (user_id ASC NULLS LAST, is_deleted ASC NULLS LAST)\r\n    TABLESPACE pg_default;\r\n```\r\n\r\nBut I can't see, that this will be used.\r\n\r\nSELECT count(*) FROM \"action\" WHERE user_id=1 AND is_deleted='f' :\r\n\r\n![image](https://github.com/user-attachments/assets/cc29626b-aa18-499b-b91b-efa01ed1c34a)\r\n\r\nand\r\n\r\nSELECT\r\n\t\"id\"\r\nFROM\r\n\t\"action\"\r\nWHERE\r\n\tuser_id=1 AND is_deleted='f'\r\nORDER BY \"action\".\"created_unix\" DESC LIMIT 20 OFFSET 1976620:\r\n\r\n![image](https://github.com/user-attachments/assets/fa6092de-227f-406b-af58-d74db8746111)\r\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/comments/2408003737/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"somera","id":8334250,"node_id":"MDQ6VXNlcjgzMzQyNTA=","avatar_url":"https://avatars.githubusercontent.com/u/8334250?v=4","gravatar_id":"","url":"https://api.github.com/users/somera","html_url":"https://github.com/somera","followers_url":"https://api.github.com/users/somera/followers","following_url":"https://api.github.com/users/somera/following{/other_user}","gists_url":"https://api.github.com/users/somera/gists{/gist_id}","starred_url":"https://api.github.com/users/somera/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/somera/subscriptions","organizations_url":"https://api.github.com/users/somera/orgs","repos_url":"https://api.github.com/users/somera/repos","events_url":"https://api.github.com/users/somera/events{/privacy}","received_events_url":"https://api.github.com/users/somera/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/go-gitea/gitea/issues/comments/2408033729","html_url":"https://github.com/go-gitea/gitea/issues/32224#issuecomment-2408033729","issue_url":"https://api.github.com/repos/go-gitea/gitea/issues/32224","id":2408033729,"node_id":"IC_kwDOBFIx286Ph63B","user":{"login":"SoulSeekkor","id":16005426,"node_id":"MDQ6VXNlcjE2MDA1NDI2","avatar_url":"https://avatars.githubusercontent.com/u/16005426?v=4","gravatar_id":"","url":"https://api.github.com/users/SoulSeekkor","html_url":"https://github.com/SoulSeekkor","followers_url":"https://api.github.com/users/SoulSeekkor/followers","following_url":"https://api.github.com/users/SoulSeekkor/following{/other_user}","gists_url":"https://api.github.com/users/SoulSeekkor/gists{/gist_id}","starred_url":"https://api.github.com/users/SoulSeekkor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SoulSeekkor/subscriptions","organizations_url":"https://api.github.com/users/SoulSeekkor/orgs","repos_url":"https://api.github.com/users/SoulSeekkor/repos","events_url":"https://api.github.com/users/SoulSeekkor/events{/privacy}","received_events_url":"https://api.github.com/users/SoulSeekkor/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-10-11T19:49:28Z","updated_at":"2024-10-11T19:49:28Z","body":"> > @lunny\r\n> \r\n> I will investigate it. How many records in the table action.\r\n\r\nThere are 847525 records in the action table.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/comments/2408033729/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"SoulSeekkor","id":16005426,"node_id":"MDQ6VXNlcjE2MDA1NDI2","avatar_url":"https://avatars.githubusercontent.com/u/16005426?v=4","gravatar_id":"","url":"https://api.github.com/users/SoulSeekkor","html_url":"https://github.com/SoulSeekkor","followers_url":"https://api.github.com/users/SoulSeekkor/followers","following_url":"https://api.github.com/users/SoulSeekkor/following{/other_user}","gists_url":"https://api.github.com/users/SoulSeekkor/gists{/gist_id}","starred_url":"https://api.github.com/users/SoulSeekkor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SoulSeekkor/subscriptions","organizations_url":"https://api.github.com/users/SoulSeekkor/orgs","repos_url":"https://api.github.com/users/SoulSeekkor/repos","events_url":"https://api.github.com/users/SoulSeekkor/events{/privacy}","received_events_url":"https://api.github.com/users/SoulSeekkor/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":14613520625,"node_id":"MEE_lADOBFIx286ZirHnzwAAAANnCKDx","url":"https://api.github.com/repos/go-gitea/gitea/issues/events/14613520625","actor":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2024-10-11T19:49:29Z","performed_via_github_app":null}]