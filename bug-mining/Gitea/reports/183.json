{"url":"https://api.github.com/repos/go-gitea/gitea/issues/29218","repository_url":"https://api.github.com/repos/go-gitea/gitea","labels_url":"https://api.github.com/repos/go-gitea/gitea/issues/29218/labels{/name}","comments_url":"https://api.github.com/repos/go-gitea/gitea/issues/29218/comments","events_url":"https://api.github.com/repos/go-gitea/gitea/issues/29218/events","html_url":"https://github.com/go-gitea/gitea/issues/29218","id":2140124094,"node_id":"I_kwDOBFIx285_j7O-","number":29218,"title":"500 while creating users","user":{"login":"Infinoid","id":50254,"node_id":"MDQ6VXNlcjUwMjU0","avatar_url":"https://avatars.githubusercontent.com/u/50254?v=4","gravatar_id":"","url":"https://api.github.com/users/Infinoid","html_url":"https://github.com/Infinoid","followers_url":"https://api.github.com/users/Infinoid/followers","following_url":"https://api.github.com/users/Infinoid/following{/other_user}","gists_url":"https://api.github.com/users/Infinoid/gists{/gist_id}","starred_url":"https://api.github.com/users/Infinoid/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Infinoid/subscriptions","organizations_url":"https://api.github.com/users/Infinoid/orgs","repos_url":"https://api.github.com/users/Infinoid/repos","events_url":"https://api.github.com/users/Infinoid/events{/privacy}","received_events_url":"https://api.github.com/users/Infinoid/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":472744938,"node_id":"MDU6TGFiZWw0NzI3NDQ5Mzg=","url":"https://api.github.com/repos/go-gitea/gitea/labels/type/bug","name":"type/bug","color":"ee0701","default":false,"description":""}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/go-gitea/gitea/milestones/156","html_url":"https://github.com/go-gitea/gitea/milestone/156","labels_url":"https://api.github.com/repos/go-gitea/gitea/milestones/156/labels","id":10504095,"node_id":"MI_kwDOBFIx284AoEef","number":156,"title":"1.21.6","description":"","creator":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":73,"state":"closed","created_at":"2024-02-02T03:47:16Z","updated_at":"2024-02-22T22:42:49Z","due_on":"2024-02-19T08:00:00Z","closed_at":"2024-02-22T22:42:49Z"},"comments":3,"created_at":"2024-02-17T14:10:05Z","updated_at":"2024-03-01T00:01:27Z","closed_at":"2024-02-18T11:47:51Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description\n\nWhen an admin of a limited/private server goes to create a new user, the `User visibility` field of the \"Create User Account\" page has a bug.  Specifically, after the form submission validation is rejected, the `User visibility` dropdown seems to be mapping the wrong values.\r\n\r\nThis looks very similar to #25951, but it happens in gitea 1.21.5, and only happens after a form submission error.\r\n\r\nGitea configuration:\r\n```ini\r\n[service]\r\nDISABLE_REGISTRATION              = true\r\nDEFAULT_USER_VISIBILITY           = limited\r\nALLOWED_USER_VISIBILITY_MODES     = limited,private\r\n```\r\n\r\nSteps to reproduce:\r\n\r\n1. Have a gitea instance configured as described above\r\n2. Log in as an admin user\r\n3. Attempt to create a new user through the `/admin/users/new` page, but fail the form validation\r\n4. Correct the form fields and submit again\r\n5. 500 internal server error\r\n\r\n\r\nI compared the DOM trees before and after the validation failure, and the dropdown box selection no longer has the classes `active` and `selected`.\r\n\r\nBefore validation failure:\r\n```html\r\n<div class=\"item active selected\" data-tooltip-content=\"Visible only to authenticated users\" data-value=\"1\" id=\"_aria_auto_id_16\" role=\"option\" tabindex=\"-1\" aria-label=\"Visible only to authenticated users\">Limited</div>\r\n```\r\n\r\nAfter validation failure:\r\n```html\r\n<div class=\"item\" data-tooltip-content=\"Visible only to authenticated users\" data-value=\"1\" id=\"_aria_auto_id_16\" role=\"option\" tabindex=\"-1\" aria-label=\"Visible only to authenticated users\">Limited</div>\r\n```\r\n\r\nThat might be the problem?  I'm not completely sure, but it looks likely to me.\n\n### Gitea Version\n\n1.21.5\n\n### Can you reproduce the bug on the Gitea demo site?\n\nNo\n\n### Log Gist\n\n_No response_\n\n### Screenshots\n\n![image](https://github.com/go-gitea/gitea/assets/50254/332e8af9-43fe-4c55-af21-f421a24adee9)\r\n![image](https://github.com/go-gitea/gitea/assets/50254/12ed90a5-fd0f-43c9-a6a4-9d4c6cb29bf9)\r\n![image](https://github.com/go-gitea/gitea/assets/50254/51b57dc0-9c94-4685-af5c-365dca81d577)\r\n\n\n### Git Version\n\n_No response_\n\n### Operating System\n\n_No response_\n\n### How are you running Gitea?\n\nofficial docker image, GOARCH=arm64\n\n### Database\n\nPostgreSQL","closed_by":{"login":"silverwind","id":115237,"node_id":"MDQ6VXNlcjExNTIzNw==","avatar_url":"https://avatars.githubusercontent.com/u/115237?v=4","gravatar_id":"","url":"https://api.github.com/users/silverwind","html_url":"https://github.com/silverwind","followers_url":"https://api.github.com/users/silverwind/followers","following_url":"https://api.github.com/users/silverwind/following{/other_user}","gists_url":"https://api.github.com/users/silverwind/gists{/gist_id}","starred_url":"https://api.github.com/users/silverwind/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/silverwind/subscriptions","organizations_url":"https://api.github.com/users/silverwind/orgs","repos_url":"https://api.github.com/users/silverwind/repos","events_url":"https://api.github.com/users/silverwind/events{/privacy}","received_events_url":"https://api.github.com/users/silverwind/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/29218/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/go-gitea/gitea/issues/29218/timeline","performed_via_github_app":null,"state_reason":"completed"}