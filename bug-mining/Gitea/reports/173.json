{"url":"https://api.github.com/repos/go-gitea/gitea/issues/29094","repository_url":"https://api.github.com/repos/go-gitea/gitea","labels_url":"https://api.github.com/repos/go-gitea/gitea/issues/29094/labels{/name}","comments_url":"https://api.github.com/repos/go-gitea/gitea/issues/29094/comments","events_url":"https://api.github.com/repos/go-gitea/gitea/issues/29094/events","html_url":"https://github.com/go-gitea/gitea/issues/29094","id":2124400412,"node_id":"I_kwDOBFIx285-n8cc","number":29094,"title":"Swift fails to resolve from package registry","user":{"login":"cennis91","id":1178816,"node_id":"MDQ6VXNlcjExNzg4MTY=","avatar_url":"https://avatars.githubusercontent.com/u/1178816?v=4","gravatar_id":"","url":"https://api.github.com/users/cennis91","html_url":"https://github.com/cennis91","followers_url":"https://api.github.com/users/cennis91/followers","following_url":"https://api.github.com/users/cennis91/following{/other_user}","gists_url":"https://api.github.com/users/cennis91/gists{/gist_id}","starred_url":"https://api.github.com/users/cennis91/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cennis91/subscriptions","organizations_url":"https://api.github.com/users/cennis91/orgs","repos_url":"https://api.github.com/users/cennis91/repos","events_url":"https://api.github.com/users/cennis91/events{/privacy}","received_events_url":"https://api.github.com/users/cennis91/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":472744938,"node_id":"MDU6TGFiZWw0NzI3NDQ5Mzg=","url":"https://api.github.com/repos/go-gitea/gitea/labels/type/bug","name":"type/bug","color":"ee0701","default":false,"description":""},{"id":4102834064,"node_id":"LA_kwDOBFIx2870jEeQ","url":"https://api.github.com/repos/go-gitea/gitea/labels/topic/packages","name":"topic/packages","color":"AFE667","default":false,"description":""}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/go-gitea/gitea/milestones/156","html_url":"https://github.com/go-gitea/gitea/milestone/156","labels_url":"https://api.github.com/repos/go-gitea/gitea/milestones/156/labels","id":10504095,"node_id":"MI_kwDOBFIx284AoEef","number":156,"title":"1.21.6","description":"","creator":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":73,"state":"closed","created_at":"2024-02-02T03:47:16Z","updated_at":"2024-02-22T22:42:49Z","due_on":"2024-02-19T08:00:00Z","closed_at":"2024-02-22T22:42:49Z"},"comments":1,"created_at":"2024-02-08T05:42:57Z","updated_at":"2024-02-28T00:02:34Z","closed_at":"2024-02-08T06:45:45Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description\n\nResolving swift packages (`swift package resolve`) against the Gitea package registry fails:\r\n\r\n> error: 'scope.name': Failed fetching release checksum from registry: keyNotFound(CodingKeys(stringValue: \"name\", intValue: nil), Swift.DecodingError.Context(codingPath: [CodingKeys(stringValue: \"resources\", intValue: nil), _JSONKey(stringValue: \"Index 0\", intValue: 0)], debugDescription: \"No value associated with key CodingKeys(stringValue: \\\"name\\\", intValue: nil) (\\\"name\\\").\", underlyingError: nil))\r\n\r\nThe issue comes from the `Resource` struct found [here](https://github.com/go-gitea/gitea/blob/37191dcfbdbd007266a4d15a3c85cdf94cec1a7a/routers/api/packages/swift/swift.go#L159-L163) sending `id` in place of `name`.\r\n```go\r\ntype Resource struct {\r\n\tName     string `json:\"id\"`\r\n\tType     string `json:\"type\"`\r\n\tChecksum string `json:\"checksum\"`\r\n}\r\n```\r\n\r\nI double checked to see if the specification changed or if this was just a typo. As far as I can tell, this was *always* meant to be `name` and not `id` (it seems to have been established [here](https://github.com/apple/swift-package-manager/commit/7e53f24b1c9550c69367182f313e050522d153a1)), so it's probably just a typo and **not** a breaking change.\r\n\r\n---\r\n\r\nFor completeness:\r\n\r\n`.swiftpm/configuration/registries.json`:\r\n```jsonc\r\n{\r\n  \"authentication\" : {\r\n    \"gitea.example.com\" : {\r\n      \"type\" : \"token\"\r\n    }\r\n  },\r\n  \"registries\" : {\r\n    \"[default]\" : {\r\n      \"url\" : \"https://gitea.example.com/api/packages/user/swift\"\r\n    }\r\n  },\r\n  \"version\" : 1\r\n}\r\n```\r\n\r\n`Package.swift`:\r\n```swift\r\n// swift-tools-version:5.8.1\r\n\r\nimport PackageDescription\r\n\r\nlet package = Package(\r\n    name: \"ExamplePackage\",\r\n    dependencies: [\r\n        .package(id: \"scope.name\", from: \"1.0.0\")\r\n    ]\r\n)\r\n```\n\n### Gitea Version\n\n1.21.4\n\n### Can you reproduce the bug on the Gitea demo site?\n\nNo\n\n### Log Gist\n\n_No response_\n\n### Screenshots\n\n_No response_\n\n### Git Version\n\n_No response_\n\n### Operating System\n\n_No response_\n\n### How are you running Gitea?\n\ndocker and command line\n\n### Database\n\nNone","closed_by":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/29094/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/go-gitea/gitea/issues/29094/timeline","performed_via_github_app":null,"state_reason":"completed"}