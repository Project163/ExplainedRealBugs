{"url":"https://api.github.com/repos/go-gitea/gitea/issues/29000","repository_url":"https://api.github.com/repos/go-gitea/gitea","labels_url":"https://api.github.com/repos/go-gitea/gitea/issues/29000/labels{/name}","comments_url":"https://api.github.com/repos/go-gitea/gitea/issues/29000/comments","events_url":"https://api.github.com/repos/go-gitea/gitea/issues/29000/events","html_url":"https://github.com/go-gitea/gitea/issues/29000","id":2110447308,"node_id":"I_kwDOBFIx2859yt7M","number":29000,"title":"Wiki migration from self-hosted GitLab fails if GitLab does not use master as default branch name","user":{"login":"heapifyman","id":274236,"node_id":"MDQ6VXNlcjI3NDIzNg==","avatar_url":"https://avatars.githubusercontent.com/u/274236?v=4","gravatar_id":"","url":"https://api.github.com/users/heapifyman","html_url":"https://github.com/heapifyman","followers_url":"https://api.github.com/users/heapifyman/followers","following_url":"https://api.github.com/users/heapifyman/following{/other_user}","gists_url":"https://api.github.com/users/heapifyman/gists{/gist_id}","starred_url":"https://api.github.com/users/heapifyman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/heapifyman/subscriptions","organizations_url":"https://api.github.com/users/heapifyman/orgs","repos_url":"https://api.github.com/users/heapifyman/repos","events_url":"https://api.github.com/users/heapifyman/events{/privacy}","received_events_url":"https://api.github.com/users/heapifyman/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":472744938,"node_id":"MDU6TGFiZWw0NzI3NDQ5Mzg=","url":"https://api.github.com/repos/go-gitea/gitea/labels/type/bug","name":"type/bug","color":"ee0701","default":false,"description":""}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":10,"created_at":"2024-01-31T16:06:46Z","updated_at":"2024-03-17T00:01:17Z","closed_at":"2024-03-06T06:26:33Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description\n\nWhen migrating a project including Wiki from a self-hosted GitLab instance the Wiki does not get migrated if GitLab does **not** use `master` as the default branch name.\r\n\r\nProject code will be migrated but Wiki will be empty.\r\n\r\nThe log shows the following error message:\r\n\r\n> gitea  | 2024/01/31 15:54:13 ...s/repository/repo.go:104:MigrateRepositoryGitData() [W] Clone wiki: exit status 128 - fatal: Remote branch master not found in upstream origin\r\n\r\nThis is probably caused by hard-coded `Branch:        \"master\",` in `MigrateRepositoryGitData`, line 102 - see https://github.com/go-gitea/gitea/blob/0b1a42ce0f7f8e22d7905bde803d60444c9a9f0b/modules/repository/repo.go#L102\r\n\r\n**Steps to reproduce**\r\n\r\n1. Change default branch name of GitLab instance to `main` - this will result in both project repository and wiki repository to use `main` as default branch name\r\n2. In gitea, start a migration from GitLab\r\n3. Select \"Wiki\"\r\n4. Click \"Migrate repository\"\r\n\r\n**Result**\r\n\r\n- Code repository is migrated\r\n- Wiki repository is not migrated\r\n\r\n**Expected Result**\r\n\r\nboth code repository and wiki repository should be migrated\r\n\n\n### Gitea Version\n\ngitea:latest and gitea:nightly\n\n### Can you reproduce the bug on the Gitea demo site?\n\nYes\n\n### Log Gist\n\n_No response_\n\n### Screenshots\n\n![swappy-20240131_160917](https://github.com/go-gitea/gitea/assets/274236/fa142ed7-d99e-425d-b798-06bbaa4f22fa)\r\n\r\n![swappy-20240131_163251](https://github.com/go-gitea/gitea/assets/274236/98696923-67e8-4cbb-8d05-a5558a107b56)\r\n\n\n### Git Version\n\n2.43.0\n\n### Operating System\n\nLinux\n\n### How are you running Gitea?\n\ndocker compose, following instructions here: https://docs.gitea.com/next/installation/install-with-docker#basics\r\n\n\n### Database\n\nNone","closed_by":{"login":"wxiaoguang","id":2114189,"node_id":"MDQ6VXNlcjIxMTQxODk=","avatar_url":"https://avatars.githubusercontent.com/u/2114189?v=4","gravatar_id":"","url":"https://api.github.com/users/wxiaoguang","html_url":"https://github.com/wxiaoguang","followers_url":"https://api.github.com/users/wxiaoguang/followers","following_url":"https://api.github.com/users/wxiaoguang/following{/other_user}","gists_url":"https://api.github.com/users/wxiaoguang/gists{/gist_id}","starred_url":"https://api.github.com/users/wxiaoguang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wxiaoguang/subscriptions","organizations_url":"https://api.github.com/users/wxiaoguang/orgs","repos_url":"https://api.github.com/users/wxiaoguang/repos","events_url":"https://api.github.com/users/wxiaoguang/events{/privacy}","received_events_url":"https://api.github.com/users/wxiaoguang/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/29000/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/go-gitea/gitea/issues/29000/timeline","performed_via_github_app":null,"state_reason":"completed"}