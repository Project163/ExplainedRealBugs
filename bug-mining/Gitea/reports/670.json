{"url":"https://api.github.com/repos/go-gitea/gitea/issues/31113","repository_url":"https://api.github.com/repos/go-gitea/gitea","labels_url":"https://api.github.com/repos/go-gitea/gitea/issues/31113/labels{/name}","comments_url":"https://api.github.com/repos/go-gitea/gitea/issues/31113/comments","events_url":"https://api.github.com/repos/go-gitea/gitea/issues/31113/events","html_url":"https://github.com/go-gitea/gitea/issues/31113","id":2319285263,"node_id":"I_kwDOBFIx286KPXwP","number":31113,"title":"The cron job to garbage collect LFS pointers is not active","user":{"login":"TimThaler","id":15087474,"node_id":"MDQ6VXNlcjE1MDg3NDc0","avatar_url":"https://avatars.githubusercontent.com/u/15087474?v=4","gravatar_id":"","url":"https://api.github.com/users/TimThaler","html_url":"https://github.com/TimThaler","followers_url":"https://api.github.com/users/TimThaler/followers","following_url":"https://api.github.com/users/TimThaler/following{/other_user}","gists_url":"https://api.github.com/users/TimThaler/gists{/gist_id}","starred_url":"https://api.github.com/users/TimThaler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TimThaler/subscriptions","organizations_url":"https://api.github.com/users/TimThaler/orgs","repos_url":"https://api.github.com/users/TimThaler/repos","events_url":"https://api.github.com/users/TimThaler/events{/privacy}","received_events_url":"https://api.github.com/users/TimThaler/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":472744938,"node_id":"MDU6TGFiZWw0NzI3NDQ5Mzg=","url":"https://api.github.com/repos/go-gitea/gitea/labels/type/bug","name":"type/bug","color":"ee0701","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/go-gitea/gitea/milestones/184","html_url":"https://github.com/go-gitea/gitea/milestone/184","labels_url":"https://api.github.com/repos/go-gitea/gitea/milestones/184/labels","id":13424307,"node_id":"MI_kwDOBFIx284AzNaz","number":184,"title":"1.24.5","description":"","creator":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":10,"state":"closed","created_at":"2025-08-04T18:16:06Z","updated_at":"2025-08-13T16:00:52Z","due_on":"2025-08-11T07:00:00Z","closed_at":"2025-08-13T16:00:52Z"},"comments":12,"created_at":"2024-05-27T14:23:48Z","updated_at":"2025-08-12T05:38:19Z","closed_at":"2025-08-12T05:38:19Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description\r\n\r\nMy first post in this repo, so thank all you maintainers for your time spent working on this - much apprecheated!!\r\n\r\nWe are using gitea within a docker environment. In general we configure gitea through the docker-compose.yaml file. \r\nEnabling [LFS with gitea ](https://docs.gitea.com/administration/git-lfs-setup) was not a problem and so far its working. LFS-attributed file move to our specified directory (/lfs) and our git clients recognise the LFS-attributed files.\r\n\r\nWe have a problem with setting up the cronjob for GC  not needed LFS-files.\r\nIn docker-compose we add these lines:\r\n\r\n```\r\n    environment:\r\n         - GITEA__CRON.GIT_GC_REPOS__ENABLED=true\r\n         - GITEA__CRON.GIT_GC_REPOS__RUN_AT_START=true\r\n         - GITEA__CRON.GIT_GC_REPOS__SCHEDULE=@weekly\r\n```\r\n\r\nThese translate to the following in /etc/gitea/app.ini in the container: \r\n\r\n```[cron.gc_lfs]\r\nSCHEDULE = @weekly\r\nENABLED = true\r\nRUN_AT_START = true\r\nOLDER_THAN = 240h\r\n```\r\n\r\nBut after restarting gitea the cronjob should run, which is not the case: \r\n\r\n<img width=\"810\" alt=\"Capture\" src=\"https://github.com/go-gitea/gitea/assets/15087474/e937a45b-179a-4fbb-ad9e-2bc1f53b8b8d\">\r\n\r\nAfter starting it manually it seems to have run - but no action was taken, since no LFS files have been deleted from `/lfs`.\r\nWe setup some test repos with LFS files which we deleted before running the cron job.\r\n\r\nThe last line from the log file seems to be related. But nothing is written to log during the cron job. I try to change the log level and report more detailed information later on.\r\n\r\n```\r\n2024/05/27 13:42:05 cmd/web.go:242:runWeb() [I] Starting Gitea on PID: 8\r\n2024/05/27 13:42:05 cmd/web.go:111:showWebStartupMessage() [I] Gitea version: 1.21.11 built with GNU Make 4.4.1, go1.21.9 : bindata, timetzdata, sqlite, sqlite_unlock_notify\r\n2024/05/27 13:42:05 cmd/web.go:112:showWebStartupMessage() [I] * RunMode: prod\r\n2024/05/27 13:42:05 cmd/web.go:113:showWebStartupMessage() [I] * AppPath: /usr/local/bin/gitea\r\n2024/05/27 13:42:05 cmd/web.go:114:showWebStartupMessage() [I] * WorkPath: /var/lib/gitea\r\n2024/05/27 13:42:05 cmd/web.go:115:showWebStartupMessage() [I] * CustomPath: /var/lib/gitea/custom\r\n2024/05/27 13:42:05 cmd/web.go:116:showWebStartupMessage() [I] * ConfigFile: /etc/gitea/app.ini\r\n2024/05/27 13:42:05 cmd/web.go:117:showWebStartupMessage() [I] Prepare to run web server\r\n2024/05/27 13:42:05 routers/init.go:112:InitWebInstalled() [I] Git version: 2.40.1, Wire Protocol Version 2 Enabled (home: /var/lib/gitea/home)\r\n2024/05/27 13:42:06 cmd/web.go:194:serveInstalled() [W] Table system_setting Column version db default is , struct default is 1\r\n2024/05/27 13:42:06 cmd/web.go:194:serveInstalled() [W] Table gpg_key Column content db nullable is true, struct nullable is false\r\n2024/05/27 13:42:06 cmd/web.go:194:serveInstalled() [W] Table gpg_key_import Column content db nullable is true, struct nullable is false\r\n2024/05/27 13:42:06 cmd/web.go:194:serveInstalled() [W] Table public_key Column content db nullable is true, struct nullable is false\r\n2024/05/27 13:42:06 cmd/web.go:194:serveInstalled() [W] Table project column board_type db type is INT(10) UNSIGNED, struct type is INT UNSIGNED\r\n2024/05/27 13:42:06 cmd/web.go:194:serveInstalled() [W] Table project column card_type db type is INT(11), struct type is INT UNSIGNED\r\n2024/05/27 13:42:06 cmd/web.go:194:serveInstalled() [W] Table project Column card_type db default is 0, struct default is\r\n2024/05/27 13:42:06 cmd/web.go:194:serveInstalled() [W] Table project Column card_type db nullable is false, struct nullable is true\r\n2024/05/27 13:42:06 cmd/web.go:194:serveInstalled() [W] Table project column type db type is INT(10) UNSIGNED, struct type is INT UNSIGNED\r\n2024/05/27 13:42:06 cmd/web.go:194:serveInstalled() [W] Table hook_task has column repo_id but struct has not related field\r\n2024/05/27 13:42:06 cmd/web.go:194:serveInstalled() [W] Table label Column archived_unix db default is , struct default is NULL\r\n2024/05/27 13:56:56 ...rvices/lfs/server.go:544:authenticate() [W] Authentication failure for provided token with Error: no token\r\n```\r\n\r\n\r\n\r\n\r\n### Gitea Version\r\n\r\n1.21.11 built with GNU Make 4.4.1, go1.21.9\r\n\r\n### Can you reproduce the bug on the Gitea demo site?\r\n\r\nNo\r\n\r\n### Log Gist\r\n\r\n_No response_\r\n\r\n### Screenshots\r\n\r\n_No response_\r\n\r\n### Git Version\r\n\r\n2.40.1, Wire Protocol Version 2 Enabled\r\n\r\n### Operating System\r\n\r\nUbuntu 22.04.4 LTS\r\n\r\n### How are you running Gitea?\r\n\r\nDocker 26.0.0 with compose file behind a reverse nginxX proxy\r\n\r\n#### Nginx Config\r\n\r\n```\r\nserver{\r\n  listen 80;\r\n  server_name mylocaldomain.local;\r\n  location / {\r\n    return 301 https://$host$request_uri;\r\n  }\r\n}\r\n\r\n\r\nupstream gitea_backend{\r\n    \r\n    server gitea:3000;\r\n    keepalive 32;\r\n\r\n}\r\nserver {\r\n    listen 443 ssl;\r\n    server_name mylocaldomain.local;\r\n\r\n    add_header Strict-Transport-Security \"max-age=31536000; includeSubDomains\" always;\r\n\r\n    ssl_session_timeout 1d;\r\n    ssl_ciphers 'ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256';\r\n\r\n    ssl_certificate      /etc/ssl/certs/*.crt;\r\n    ssl_certificate_key  /etc/ssl/private/*.key;\r\n\r\n    location / {\r\n\r\n        client_max_body_size 9000m;\r\n        proxy_set_header   Host $host;\r\n        proxy_set_header   X-Real-IP $remote_addr;\r\n        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;\r\n        proxy_set_header   X-Forwarded-Host $server_name;\r\n        proxy_pass         http://gitea_backend;\r\n    }\r\n}\r\n\r\n```\r\n\r\n\r\n### Database\r\n\r\nMySQL/MariaDB","closed_by":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/31113/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":1},"timeline_url":"https://api.github.com/repos/go-gitea/gitea/issues/31113/timeline","performed_via_github_app":null,"state_reason":"completed"}