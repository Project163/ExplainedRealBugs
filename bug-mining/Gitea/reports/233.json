{"url":"https://api.github.com/repos/go-gitea/gitea/issues/29936","repository_url":"https://api.github.com/repos/go-gitea/gitea","labels_url":"https://api.github.com/repos/go-gitea/gitea/issues/29936/labels{/name}","comments_url":"https://api.github.com/repos/go-gitea/gitea/issues/29936/comments","events_url":"https://api.github.com/repos/go-gitea/gitea/issues/29936/events","html_url":"https://github.com/go-gitea/gitea/issues/29936","id":2197537300,"node_id":"I_kwDOBFIx286C-8IU","number":29936,"title":"Error 500 when accessing branches in repo","user":{"login":"davama","id":5359152,"node_id":"MDQ6VXNlcjUzNTkxNTI=","avatar_url":"https://avatars.githubusercontent.com/u/5359152?v=4","gravatar_id":"","url":"https://api.github.com/users/davama","html_url":"https://github.com/davama","followers_url":"https://api.github.com/users/davama/followers","following_url":"https://api.github.com/users/davama/following{/other_user}","gists_url":"https://api.github.com/users/davama/gists{/gist_id}","starred_url":"https://api.github.com/users/davama/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davama/subscriptions","organizations_url":"https://api.github.com/users/davama/orgs","repos_url":"https://api.github.com/users/davama/repos","events_url":"https://api.github.com/users/davama/events{/privacy}","received_events_url":"https://api.github.com/users/davama/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":472744938,"node_id":"MDU6TGFiZWw0NzI3NDQ5Mzg=","url":"https://api.github.com/repos/go-gitea/gitea/labels/type/bug","name":"type/bug","color":"ee0701","default":false,"description":""},{"id":474799001,"node_id":"MDU6TGFiZWw0NzQ3OTkwMDE=","url":"https://api.github.com/repos/go-gitea/gitea/labels/topic/ui","name":"topic/ui","color":"fef2c0","default":false,"description":"Change the appearance of the Gitea UI"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2024-03-20T13:28:28Z","updated_at":"2024-06-18T22:32:47Z","closed_at":"2024-03-20T15:38:23Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description\r\n\r\nGood Day,\r\n\r\nHope I've posted all relevant info.\r\n\r\nWe have a repo inside an org, which does not allow us to view its branches via the UI. We had several branches that were automatically created with our pipeline via the API. We've been doing this for several months now. Only yesterday we noticed that we could not see the branches in the UI (this was never the case before). We were under version `1.21.7` and were hoping updating to `1.21.8` would help, but nothing.\r\n\r\nSince we could see all the branches via the API, we decided to delete all the branches via API except for `main`. Now only `main` shows via the API. Interestingly under the UI, it still shows that `2 Branches` exists. (see screenshots)\r\n\r\nWhen i click on the `tto-device-discovery` branch, i get a `404` not found code page, which should be correct (see screenshot)\r\n\r\nLooking at other tickets, i check permissions on the filesystem, but nothing interesting\r\n\r\n```\r\ngit-1:/data/git/repositories/sot/netbox-sot.git$ pwd\r\n/data/git/repositories/sot/netbox-sot.git\r\ngit-1:/data/git/repositories/sot/netbox-sot.git$ ls -al\r\ntotal 196\r\ndrwxr-xr-x    8 git      git            150 Mar 20 13:22 .\r\ndrwxr-xr-x   14 git      git           4096 Mar  6 23:04 ..\r\n-rw-r--r--    1 git      git             21 May  9  2023 HEAD\r\ndrwxr-xr-x    2 git      git              6 May  9  2023 branches\r\n-rw-r--r--    1 git      git             66 Mar 20 13:22 config\r\n-rw-r--r--    1 git      git             73 May  9  2023 description\r\ndrwxr-xr-x    6 git      git           4096 Mar 17 02:07 hooks\r\ndrwxr-xr-x    2 git      git             33 Mar 20 13:24 info\r\ndrwxr-xr-x    3 git      git             30 Mar 19 11:26 logs\r\ndrwxr-xr-x  260 git      git           8192 Mar 20 13:24 objects\r\n-rw-r--r--    1 git      git         164524 Mar 20 13:22 packed-refs\r\ndrwxr-xr-x    5 git      git             43 Jul 17  2023 refs\r\n```\r\n\r\nAnything I can do to resolve this?\r\n\r\nBelow are the logs\r\n\r\n```\r\n2024/03/20 12:56:57 ...repository/branch.go:141:loadOneBranch() [E] CountDivergingCommits: exit status 128 - fatal: ambiguous argument 'main...refs/heads/tto-device-discovery': unknown revision or path not in the working tree.\r\nUse '--' to separate paths from revisions, like this:\r\n'git <command> [<revision>...] -- [<file>...]'\r\n - fatal: ambiguous argument 'main...refs/heads/tto-device-discovery': unknown revision or path not in the working tree.\r\nUse '--' to separate paths from revisions, like this:\r\n'git <command> [<revision>...] -- [<file>...]'\r\n2024/03/20 12:56:57 ...eb/routing/logger.go:78:func1() [W] router: failed    GET /sot/netbox-sot/branches for [<redacted>]:0, panic in 65.6ms @ repo/branch.go:37(repo.Branches), err=runtime error: invalid memory address or nil pointer dereference\r\n2024/03/20 12:56:57 ...rs/common/errpage.go:26:RenderPanicErrorPage() [E] PANIC: runtime error: invalid memory address or nil pointer dereference\r\n/usr/local/go/src/runtime/panic.go:914 (0x43eefe)\r\n/go/src/code.gitea.io/gitea/modules/web/routing/logger_manager.go:116 (0x1ab40e8)\r\n/usr/local/go/src/runtime/panic.go:914 (0x43eefe)\r\n/usr/local/go/src/runtime/panic.go:261 (0x4566b7)\r\n/usr/local/go/src/runtime/signal_unix.go:861 (0x456685)\r\n/go/src/code.gitea.io/gitea/services/repository/branch.go:187 (0x1e3c44e)\r\n/go/src/code.gitea.io/gitea/services/repository/branch.go:103 (0x1e3b88e)\r\n/go/src/code.gitea.io/gitea/routers/web/repo/branch.go:56 (0x251de6f)\r\n/usr/local/go/src/reflect/value.go:596 (0x4f23a6)\r\n/usr/local/go/src/reflect/value.go:380 (0x4f1478)\r\n/go/src/code.gitea.io/gitea/modules/web/handler.go:166 (0x1abd75b)\r\n/usr/local/go/src/net/http/server.go:2136 (0x9a42a8)\r\n/usr/local/go/src/net/http/server.go:2136 (0x9a42a8)\r\n/go/src/code.gitea.io/gitea/modules/web/handler.go:176 (0x1abd7f7)\r\n/usr/local/go/src/net/http/server.go:2136 (0x9a42a8)\r\n/go/src/code.gitea.io/gitea/modules/web/handler.go:176 (0x1abd7f7)\r\n/usr/local/go/src/net/http/server.go:2136 (0x9a42a8)\r\n/go/src/code.gitea.io/gitea/modules/web/handler.go:176 (0x1abd7f7)\r\n/usr/local/go/src/net/http/server.go:2136 (0x9a42a8)\r\n/go/src/code.gitea.io/gitea/modules/web/handler.go:176 (0x1abd7f7)\r\n/usr/local/go/src/net/http/server.go:2136 (0x9a42a8)\r\n/go/src/code.gitea.io/gitea/modules/web/handler.go:176 (0x1abd7f7)\r\n/usr/local/go/src/net/http/server.go:2136 (0x9a42a8)\r\n/go/src/code.gitea.io/gitea/modules/web/handler.go:176 (0x1abd7f7)\r\n/usr/local/go/src/net/http/server.go:2136 (0x9a42a8)\r\n/go/pkg/mod/github.com/go-chi/chi/v5@v5.0.10/chain.go:31 (0x1ab4745)\r\n/go/pkg/mod/github.com/go-chi/chi/v5@v5.0.10/mux.go:444 (0x1ab7693)\r\n/usr/local/go/src/net/http/server.go:2136 (0x9a42a8)\r\n/go/src/code.gitea.io/gitea/modules/web/handler.go:176 (0x1abd7f7)\r\n/usr/local/go/src/net/http/server.go:2136 (0x9a42a8)\r\n/go/src/code.gitea.io/gitea/modules/web/handler.go:176 (0x1abd7f7)\r\n/usr/local/go/src/net/http/server.go:2136 (0x9a42a8)\r\n/go/src/code.gitea.io/gitea/modules/web/handler.go:176 (0x1abd7f7)\r\n/usr/local/go/src/net/http/server.go:2136 (0x9a42a8)\r\n/go/pkg/mod/github.com/go-chi/chi/v5@v5.0.10/middleware/get_head.go:37 (0x24e917b)\r\n/usr/local/go/src/net/http/server.go:2136 (0x9a42a8)\r\n/go/src/code.gitea.io/gitea/modules/web/handler.go:145 (0x1abda03)\r\n/usr/local/go/src/net/http/server.go:2136 (0x9a42a8)\r\n/go/src/code.gitea.io/gitea/modules/web/handler.go:176 (0x1abd7f7)\r\n/usr/local/go/src/net/http/server.go:2136 (0x9a42a8)\r\n/go/src/code.gitea.io/gitea/modules/context/context.go:223 (0x1bd1d0e)\r\n/usr/local/go/src/net/http/server.go:2136 (0x9a42a8)\r\n/go/src/code.gitea.io/gitea/modules/web/handler.go:145 (0x1abda03)\r\n/usr/local/go/src/net/http/server.go:2136 (0x9a42a8)\r\n/go/pkg/mod/gitea.com/go-chi/session@v0.0.0-20230613035928-39541325faa3/session.go:257 (0x1b2a755)\r\n/usr/local/go/src/net/http/server.go:2136 (0x9a42a8)\r\n/go/src/code.gitea.io/gitea/modules/web/handler.go:145 (0x1abda03)\r\n/usr/local/go/src/net/http/server.go:2136 (0x9a42a8)\r\n/go/pkg/mod/github.com/go-chi/chi/v5@v5.0.10/mux.go:73 (0x1ab5335)\r\n/go/pkg/mod/github.com/go-chi/chi/v5@v5.0.10/mux.go:316 (0x1ab6c1a)\r\n/usr/local/go/src/net/http/server.go:2136 (0x9a42a8)\r\n/go/pkg/mod/github.com/go-chi/chi/v5@v5.0.10/mux.go:444 (0x1ab7693)\r\n/usr/local/go/src/net/http/server.go:2136 (0x9a42a8)\r\n/go/pkg/mod/github.com/go-chi/chi/v5@v5.0.10/mux.go:73 (0x1ab5335)\r\n/go/pkg/mod/github.com/go-chi/chi/v5@v5.0.10/mux.go:316 (0x1ab6c1a)\r\n/usr/local/go/src/net/http/server.go:2136 (0x9a42a8)\r\n/go/pkg/mod/github.com/go-chi/chi/v5@v5.0.10/mux.go:444 (0x1ab7693)\r\n/usr/local/go/src/net/http/server.go:2136 (0x9a42a8)\r\n/go/src/code.gitea.io/gitea/modules/web/routing/logger_manager.go:122 (0x1ab3f78)\r\n/usr/local/go/src/net/http/server.go:2136 (0x9a42a8)\r\n/go/src/code.gitea.io/gitea/modules/web/handler.go:145 (0x1abda03)\r\n/usr/local/go/src/net/http/server.go:2136 (0x9a42a8)\r\n/go/pkg/mod/github.com/chi-middleware/proxy@v1.1.1/middleware.go:37 (0x2433fd3)\r\n/usr/local/go/src/net/http/server.go:2136 (0x9a42a8)\r\n/go/src/code.gitea.io/gitea/modules/web/handler.go:145 (0x1abda03)\r\n/usr/local/go/src/net/http/server.go:2136 (0x9a42a8)\r\n/go/src/code.gitea.io/gitea/routers/common/middleware.go:46 (0x24351f2)\r\n/usr/local/go/src/net/http/server.go:2136 (0x9a42a8)\r\n/go/src/code.gitea.io/gitea/modules/web/handler.go:145 (0x1abda03)\r\n/usr/local/go/src/net/http/server.go:2136 (0x9a42a8)\r\n/go/src/code.gitea.io/gitea/routers/common/middleware.go:37 (0x2434d75)\r\n/usr/local/go/src/net/http/server.go:2136 (0x9a42a8)\r\n/go/src/code.gitea.io/gitea/modules/web/handler.go:145 (0x1abda03)\r\n/usr/local/go/src/net/http/server.go:2136 (0x9a42a8)\r\n/go/src/code.gitea.io/gitea/routers/common/middleware.go:100 (0x2434335)\r\n/usr/local/go/src/net/http/server.go:2136 (0x9a42a8)\r\n/go/src/code.gitea.io/gitea/modules/web/handler.go:145 (0x1abda03)\r\n/usr/local/go/src/net/http/server.go:2136 (0x9a42a8)\r\n/go/pkg/mod/github.com/go-chi/chi/v5@v5.0.10/mux.go:90 (0x1ab52f4)\r\n/go/src/code.gitea.io/gitea/modules/web/route.go:163 (0x1abee27)\r\n/usr/local/go/src/net/http/server.go:2938 (0x9a6f8d)\r\n/usr/local/go/src/net/http/server.go:2009 (0x9a2e73)\r\n/usr/local/go/src/runtime/asm_amd64.s:1650 (0x475b00)\r\n```\r\n\r\n### Screenshots\r\n\r\n![2024-03-20_09-12](https://github.com/go-gitea/gitea/assets/5359152/c271f768-8941-42fb-9cbd-92290b796fd9)\r\n![2024-03-20_09-16](https://github.com/go-gitea/gitea/assets/5359152/5d6afdb1-0c2a-4818-85c6-a6d1eda59902)\r\n![2024-03-20_09-20](https://github.com/go-gitea/gitea/assets/5359152/ef4e9afa-53b1-41c4-b360-5e1ae702a351)\r\n\r\n\r\n### Gitea Version\r\n\r\n1.21.8\r\n\r\n### Can you reproduce the bug on the Gitea demo site?\r\n\r\nNo\r\n\r\n### Operating System\r\n\r\nRocky Linux 9 (gitea inside docker)\r\n\r\n### Browser Version\r\n\r\nGoogle Chrome Version 120.0.6099.224 (Official Build) (64-bit)","closed_by":{"login":"lafriks","id":165205,"node_id":"MDQ6VXNlcjE2NTIwNQ==","avatar_url":"https://avatars.githubusercontent.com/u/165205?v=4","gravatar_id":"","url":"https://api.github.com/users/lafriks","html_url":"https://github.com/lafriks","followers_url":"https://api.github.com/users/lafriks/followers","following_url":"https://api.github.com/users/lafriks/following{/other_user}","gists_url":"https://api.github.com/users/lafriks/gists{/gist_id}","starred_url":"https://api.github.com/users/lafriks/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lafriks/subscriptions","organizations_url":"https://api.github.com/users/lafriks/orgs","repos_url":"https://api.github.com/users/lafriks/repos","events_url":"https://api.github.com/users/lafriks/events{/privacy}","received_events_url":"https://api.github.com/users/lafriks/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/29936/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/go-gitea/gitea/issues/29936/timeline","performed_via_github_app":null,"state_reason":"completed"}