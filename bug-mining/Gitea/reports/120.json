{"url":"https://api.github.com/repos/go-gitea/gitea/issues/28178","repository_url":"https://api.github.com/repos/go-gitea/gitea","labels_url":"https://api.github.com/repos/go-gitea/gitea/issues/28178/labels{/name}","comments_url":"https://api.github.com/repos/go-gitea/gitea/issues/28178/comments","events_url":"https://api.github.com/repos/go-gitea/gitea/issues/28178/events","html_url":"https://github.com/go-gitea/gitea/issues/28178","id":2007411858,"node_id":"I_kwDOBFIx2853pqyS","number":28178,"title":"Synchronizing repository branches fails","user":{"login":"inbjo","id":11854149,"node_id":"MDQ6VXNlcjExODU0MTQ5","avatar_url":"https://avatars.githubusercontent.com/u/11854149?v=4","gravatar_id":"","url":"https://api.github.com/users/inbjo","html_url":"https://github.com/inbjo","followers_url":"https://api.github.com/users/inbjo/followers","following_url":"https://api.github.com/users/inbjo/following{/other_user}","gists_url":"https://api.github.com/users/inbjo/gists{/gist_id}","starred_url":"https://api.github.com/users/inbjo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/inbjo/subscriptions","organizations_url":"https://api.github.com/users/inbjo/orgs","repos_url":"https://api.github.com/users/inbjo/repos","events_url":"https://api.github.com/users/inbjo/events{/privacy}","received_events_url":"https://api.github.com/users/inbjo/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":472744938,"node_id":"MDU6TGFiZWw0NzI3NDQ5Mzg=","url":"https://api.github.com/repos/go-gitea/gitea/labels/type/bug","name":"type/bug","color":"ee0701","default":false,"description":""}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2023-11-23T03:07:53Z","updated_at":"2024-01-20T00:01:22Z","closed_at":"2023-12-05T06:34:26Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description\r\n\r\nUpgraded to version 1.21.0 I get an error accessing the repository page.\r\n> SyncRepoBranches, Error 1366 (HY000): Incorrect string value: '\\xBD\\xE2\\xBE\\xF673...' for column 'commit_message' at row 1\r\n\r\nI converted all database tables to utf8mb4 via gitea cli command doctor convent. but the problem remains. I have checked the database and configuration files to make sure they are OK.\r\n\r\n> 2023/11/22 15:05:34 ...repository/branch.go:25:SyncRepoBranches() [D] SyncRepoBranches: in Repo[84:ASM-Server/asm_03_regist]\r\n2023/11/22 15:05:34 ...repository/branch.go:44:SyncRepoBranchesWithRepo() [T] SyncRepoBranches[.....]\r\n2023/11/22 15:05:34 ...ules/context/repo.go:681:RepoAssignment() [E] SyncRepoBranches: Error 1366 (HY000): Incorrect string value: '\\xBD\\xE2\\xBE\\xF673...' for column 'commit_message' at row 1\r\n\r\nLooking through the logs I found that writing the branch information to the database fails because the commit message contains garbled code. I downloaded the repository to check the information of the last commit message, and found that the last commit message of one branch was garbled, which was the Chinese content committed by a colleague on a Chinese-encoded linux with GBK encoding, and it was garbled when I checked it with the git gui tool.\r\n\r\nMaybe replacing or removing non-utf8 character content would be a good idea.\r\n\r\n\r\n\r\n### Gitea Version\r\n\r\n1.21.0\r\n\r\n### Git Version\r\n\r\n2.38.1\r\n\r\n### Operating System\r\n\r\nCentos 7.9\r\n\r\n### How are you running Gitea?\r\n\r\nRunning the official release version through systemd\r\n\r\n### Database\r\n\r\nMySQL/MariaDB","closed_by":{"login":"lunny","id":81045,"node_id":"MDQ6VXNlcjgxMDQ1","avatar_url":"https://avatars.githubusercontent.com/u/81045?v=4","gravatar_id":"","url":"https://api.github.com/users/lunny","html_url":"https://github.com/lunny","followers_url":"https://api.github.com/users/lunny/followers","following_url":"https://api.github.com/users/lunny/following{/other_user}","gists_url":"https://api.github.com/users/lunny/gists{/gist_id}","starred_url":"https://api.github.com/users/lunny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lunny/subscriptions","organizations_url":"https://api.github.com/users/lunny/orgs","repos_url":"https://api.github.com/users/lunny/repos","events_url":"https://api.github.com/users/lunny/events{/privacy}","received_events_url":"https://api.github.com/users/lunny/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/go-gitea/gitea/issues/28178/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/go-gitea/gitea/issues/28178/timeline","performed_via_github_app":null,"state_reason":"completed"}