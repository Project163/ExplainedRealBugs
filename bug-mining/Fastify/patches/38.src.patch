diff --git a/fastify.js b/fastify.js
index 932c2c4b..30cf012e 100644
--- a/fastify.js
+++ b/fastify.js
@@ -415,6 +415,11 @@ function build (options) {
 
     validateBodyLimitOption(opts.bodyLimit)
 
+    if (opts.preHandler == null && opts.beforeHandler != null) {
+      beforeHandlerWarning()
+      opts.preHandler = opts.beforeHandler
+    }
+
     const prefix = this[kRoutePrefix]
 
     this.after((notHandledErr, done) => {
@@ -498,11 +503,6 @@ function build (options) {
         }
       }
 
-      if (opts.preHandler == null && opts.beforeHandler != null) {
-        beforeHandlerWarning()
-        opts.preHandler = opts.beforeHandler
-      }
-
       const hooks = ['preParsing', 'preValidation', 'onRequest', 'preHandler', 'preSerialization']
 
       for (let hook of hooks) {
diff --git a/test/route-hooks.test.js b/test/route-hooks.test.js
index df62dd22..0afbf401 100644
--- a/test/route-hooks.test.js
+++ b/test/route-hooks.test.js
@@ -288,7 +288,7 @@ testHook('preValidation')
 testHook('preParsing')
 
 test('preHandler backwards compatibility with beforeHandler option (should emit a warning)', t => {
-  t.plan(3)
+  t.plan(4)
   const fastify = Fastify()
 
   process.on('warning', warn => {
@@ -296,6 +296,7 @@ test('preHandler backwards compatibility with beforeHandler option (should emit
       warn.message,
       'The route option `beforeHandler` has been deprecated, use `preHandler` instead'
     )
+    t.ok(warn.stack.indexOf(__filename) >= 0)
   })
 
   fastify.post('/', {
