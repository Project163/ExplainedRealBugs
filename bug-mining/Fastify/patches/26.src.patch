diff --git a/lib/schemas.js b/lib/schemas.js
index f5967881..02ea4586 100644
--- a/lib/schemas.js
+++ b/lib/schemas.js
@@ -34,6 +34,7 @@ Schemas.prototype.resolveRefs = function (routeSchemas) {
     // this will work only for standard json schemas
     // other compilers such as Joi will fail
     this.traverse(routeSchemas)
+    this.cleanId(routeSchemas)
   } catch (err) {
     // if we have failed because `resolve has thrown
     // let's rethrow the error and let avvio handle it
@@ -68,7 +69,17 @@ Schemas.prototype.traverse = function (schema) {
   }
 }
 
+Schemas.prototype.cleanId = function (schema) {
+  for (var key in schema) {
+    if (key === '$id') delete schema[key]
+    if (schema[key] !== null && typeof schema[key] === 'object') {
+      this.cleanId(schema[key])
+    }
+  }
+}
+
 Schemas.prototype.getSchemaAnyway = function (schema) {
+  if (schema.oneOf || schema.allOf || schema.anyOf) return schema
   if (!schema.type || !schema.properties) {
     return {
       type: 'object',
diff --git a/test/shared-schemas.test.js b/test/shared-schemas.test.js
index 1d1fc8f8..d1da7146 100644
--- a/test/shared-schemas.test.js
+++ b/test/shared-schemas.test.js
@@ -377,3 +377,184 @@ test('Use the same schema id in diferent places', t => {
     t.error(err)
   })
 })
+
+// https://github.com/fastify/fastify/issues/1043
+test('The schema resolver should clean the $id key before passing it to the compiler', t => {
+  t.plan(1)
+  const fastify = Fastify()
+
+  fastify.addSchema({
+    $id: 'first',
+    type: 'object',
+    properties: {
+      first: {
+        type: 'number'
+      }
+    }
+  })
+
+  fastify.addSchema({
+    $id: 'second',
+    type: 'object',
+    allOf: [
+      {
+        type: 'object',
+        properties: {
+          second: {
+            type: 'number'
+          }
+        }
+      },
+      'first#'
+    ]
+  })
+
+  fastify.route({
+    url: '/',
+    method: 'GET',
+    schema: {
+      description: `get`,
+      body: 'second#',
+      response: {
+        200: 'second#'
+      }
+    },
+    handler: (request, reply) => {
+      reply.send({ hello: 'world' })
+    }
+  })
+
+  fastify.route({
+    url: '/',
+    method: 'PATCH',
+    schema: {
+      description: `patch`,
+      body: 'first#',
+      response: {
+        200: 'first#'
+      }
+    },
+    handler: (request, reply) => {
+      reply.send({ hello: 'world' })
+    }
+  })
+
+  fastify.ready(t.error)
+})
+
+test('Get schema anyway should not add `properties` if allOf is present', t => {
+  t.plan(1)
+  const fastify = Fastify()
+
+  fastify.addSchema({
+    $id: 'first',
+    type: 'object',
+    properties: {
+      first: { type: 'number' }
+    }
+  })
+
+  fastify.addSchema({
+    $id: 'second',
+    type: 'object',
+    allOf: [
+      {
+        type: 'object',
+        properties: {
+          second: { type: 'number' }
+        }
+      },
+      'first#'
+    ]
+  })
+
+  fastify.route({
+    url: '/',
+    method: 'GET',
+    schema: {
+      querystring: 'second#',
+      response: { 200: 'second#' }
+    },
+    handler: () => {}
+  })
+
+  fastify.ready(t.error)
+})
+
+test('Get schema anyway should not add `properties` if oneOf is present', t => {
+  t.plan(1)
+  const fastify = Fastify()
+
+  fastify.addSchema({
+    $id: 'first',
+    type: 'object',
+    properties: {
+      first: { type: 'number' }
+    }
+  })
+
+  fastify.addSchema({
+    $id: 'second',
+    type: 'object',
+    oneOf: [
+      {
+        type: 'object',
+        properties: {
+          second: { type: 'number' }
+        }
+      },
+      'first#'
+    ]
+  })
+
+  fastify.route({
+    url: '/',
+    method: 'GET',
+    schema: {
+      querystring: 'second#',
+      response: { 200: 'second#' }
+    },
+    handler: () => {}
+  })
+
+  fastify.ready(t.error)
+})
+
+test('Get schema anyway should not add `properties` if anyOf is present', t => {
+  t.plan(1)
+  const fastify = Fastify()
+
+  fastify.addSchema({
+    $id: 'first',
+    type: 'object',
+    properties: {
+      first: { type: 'number' }
+    }
+  })
+
+  fastify.addSchema({
+    $id: 'second',
+    type: 'object',
+    anyOf: [
+      {
+        type: 'object',
+        properties: {
+          second: { type: 'number' }
+        }
+      },
+      'first#'
+    ]
+  })
+
+  fastify.route({
+    url: '/',
+    method: 'GET',
+    schema: {
+      querystring: 'second#',
+      response: { 200: 'second#' }
+    },
+    handler: () => {}
+  })
+
+  fastify.ready(t.error)
+})
