diff --git a/fastify.js b/fastify.js
index fa8eacbe..918c096a 100644
--- a/fastify.js
+++ b/fastify.js
@@ -573,8 +573,9 @@ function build (options) {
   }
 
   function setNotFoundHandler (opts, handler) {
-    this.after(() => {
+    this.after((notHandledErr, done) => {
       _setNotFoundHandler.call(this, opts, handler)
+      done(notHandledErr)
     })
   }
 
diff --git a/test/404s.test.js b/test/404s.test.js
index 5314c692..e8b4d833 100644
--- a/test/404s.test.js
+++ b/test/404s.test.js
@@ -421,3 +421,25 @@ test('hooks check 404', t => {
     })
   })
 })
+
+test('setNotFoundHandler should not suppress duplicated routes checking', t => {
+  t.plan(1)
+
+  const fastify = Fastify()
+
+  fastify.get('/', function (req, reply) {
+    reply.send({ hello: 'world' })
+  })
+
+  fastify.get('/', function (req, reply) {
+    reply.send({ hello: 'world' })
+  })
+
+  fastify.setNotFoundHandler(function (req, reply) {
+    reply.code(404).send('this was not found')
+  })
+
+  fastify.listen(0, err => {
+    t.ok(err)
+  })
+})
