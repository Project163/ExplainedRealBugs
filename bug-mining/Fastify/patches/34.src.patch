diff --git a/fastify.js b/fastify.js
index ac8cee64..fca0918c 100644
--- a/fastify.js
+++ b/fastify.js
@@ -800,10 +800,10 @@ function build (options) {
     instance[kChildren].forEach(child => _addHook(child, name, fn))
   }
 
-  function addSchema (name, schema) {
+  function addSchema (schema) {
     throwIfAlreadyStarted('Cannot call "addSchema" when fastify instance is already started!')
-    this[kSchemas].add(name, schema)
-    this[kChildren].forEach(child => child.addSchema(name, schema))
+    this[kSchemas].add(schema)
+    this[kChildren].forEach(child => child.addSchema(schema))
     return this
   }
 
diff --git a/lib/schemas.js b/lib/schemas.js
index 3d9838e7..b4c1939b 100644
--- a/lib/schemas.js
+++ b/lib/schemas.js
@@ -8,6 +8,8 @@ const {
   }
 } = require('./errors')
 
+const URI_NAME_FRAGMENT = /^#[A-Za-z]{1}[\w-:.]{0,}$/
+
 function Schemas () {
   this.store = {}
 }
@@ -80,7 +82,9 @@ Schemas.prototype.traverse = function (schema) {
 
 Schemas.prototype.cleanId = function (schema) {
   for (var key in schema) {
-    if (key === '$id') delete schema[key]
+    if (key === '$id' && !URI_NAME_FRAGMENT.test(schema[key])) {
+      delete schema[key]
+    }
     if (schema[key] !== null && typeof schema[key] === 'object') {
       this.cleanId(schema[key])
     }
diff --git a/test/shared-schemas.test.js b/test/shared-schemas.test.js
index bf774c82..166e87c3 100644
--- a/test/shared-schemas.test.js
+++ b/test/shared-schemas.test.js
@@ -441,6 +441,65 @@ test('Use the same schema id in diferent places', t => {
   })
 })
 
+test('Use shared schema and $ref with $id', t => {
+  t.plan(2)
+  const fastify = Fastify()
+
+  fastify.addSchema({
+    $id: 'test',
+    type: 'object',
+    properties: {
+      id: { type: 'number' }
+    }
+  })
+
+  const body = {
+    $schema: 'http://json-schema.org/draft-07/schema#',
+    $id: 'http://foo/user',
+    type: 'object',
+    definitions: {
+      address: {
+        $id: '#address',
+        type: 'object',
+        properties: {
+          city: { 'type': 'string' }
+        }
+      }
+    },
+    properties: {
+      test: 'test#',
+      address: { $ref: '#address' }
+    }
+  }
+
+  fastify.route({
+    method: 'POST',
+    url: '/',
+    schema: {
+      body,
+      response: {
+        200: 'test#'
+      }
+    },
+    handler: (req, reply) => {
+      reply.send(req.body.test)
+    }
+  })
+
+  const id = Date.now()
+  fastify.inject({
+    method: 'POST',
+    url: '/',
+    payload: {
+      address: { city: 'New Node' },
+      test: { id }
+    }
+  }, (err, res) => {
+    t.error(err)
+    t.deepEqual(JSON.parse(res.payload), { id })
+  })
+})
+
 // https://github.com/fastify/fastify/issues/1043
 test('The schema resolver should clean the $id key before passing it to the compiler', t => {
   t.plan(1)
