{"url":"https://api.github.com/repos/fastify/fastify/issues/936","repository_url":"https://api.github.com/repos/fastify/fastify","labels_url":"https://api.github.com/repos/fastify/fastify/issues/936/labels{/name}","comments_url":"https://api.github.com/repos/fastify/fastify/issues/936/comments","events_url":"https://api.github.com/repos/fastify/fastify/issues/936/events","html_url":"https://github.com/fastify/fastify/issues/936","id":322680784,"node_id":"MDU6SXNzdWUzMjI2ODA3ODQ=","number":936,"title":"add content-length check when method is delete","user":{"login":"finefun55","id":6128731,"node_id":"MDQ6VXNlcjYxMjg3MzE=","avatar_url":"https://avatars.githubusercontent.com/u/6128731?v=4","gravatar_id":"","url":"https://api.github.com/users/finefun55","html_url":"https://github.com/finefun55","followers_url":"https://api.github.com/users/finefun55/followers","following_url":"https://api.github.com/users/finefun55/following{/other_user}","gists_url":"https://api.github.com/users/finefun55/gists{/gist_id}","starred_url":"https://api.github.com/users/finefun55/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/finefun55/subscriptions","organizations_url":"https://api.github.com/users/finefun55/orgs","repos_url":"https://api.github.com/users/finefun55/repos","events_url":"https://api.github.com/users/finefun55/events{/privacy}","received_events_url":"https://api.github.com/users/finefun55/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":451588686,"node_id":"MDU6TGFiZWw0NTE1ODg2ODY=","url":"https://api.github.com/repos/fastify/fastify/labels/bug","name":"bug","color":"ee0701","default":true,"description":"Confirmed bug"},{"id":451588689,"node_id":"MDU6TGFiZWw0NTE1ODg2ODk=","url":"https://api.github.com/repos/fastify/fastify/labels/help%20wanted","name":"help wanted","color":"ff6ba1","default":true,"description":"Help the community by contributing to this issue"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2018-05-14T05:52:38Z","updated_at":"2018-07-23T12:36:49Z","closed_at":"2018-07-23T12:36:49Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### better compatibility \r\nMy service user added ```content-type=application/json``` for each request, even if the method is DELETE without body, of course, they got 400 error. \r\nI have added some codes to avoid the problem\r\n```javascript\r\napp.addHook(\"onRequest\", (req, res, next) => {\r\n  if (toLower(req.method) === \"delete\") {\r\n    if (\r\n      req.headers[\"content-type\"] &&\r\n      (req.headers[\"content-length\"] === undefined || req.headers[\"content-length\"] === \"0\")\r\n    ) {\r\n      delete req.headers[\"content-type\"];\r\n    }\r\n  }\r\n  next();\r\n});\r\n```\r\nworks fine, but i think that will be much better to  ignore content-type when content-length is undefined\r\n\r\n```javascript\r\nif (method === 'OPTIONS' || method === 'DELETE') {\r\n    if (contentType === undefined || headers['content-length'] === undefined || headers['content-length'] === '0') {\r\n      handler(reply)\r\n    } else {\r\n      context.contentTypeParser.run(contentType, handler, request, reply)\r\n    }\r\n    return\r\n  }\r\n```","closed_by":{"login":"delvedor","id":4865608,"node_id":"MDQ6VXNlcjQ4NjU2MDg=","avatar_url":"https://avatars.githubusercontent.com/u/4865608?v=4","gravatar_id":"","url":"https://api.github.com/users/delvedor","html_url":"https://github.com/delvedor","followers_url":"https://api.github.com/users/delvedor/followers","following_url":"https://api.github.com/users/delvedor/following{/other_user}","gists_url":"https://api.github.com/users/delvedor/gists{/gist_id}","starred_url":"https://api.github.com/users/delvedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/delvedor/subscriptions","organizations_url":"https://api.github.com/users/delvedor/orgs","repos_url":"https://api.github.com/users/delvedor/repos","events_url":"https://api.github.com/users/delvedor/events{/privacy}","received_events_url":"https://api.github.com/users/delvedor/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/fastify/fastify/issues/936/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/fastify/fastify/issues/936/timeline","performed_via_github_app":null,"state_reason":"completed"}