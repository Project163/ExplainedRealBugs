{"url":"https://api.github.com/repos/fastify/fastify/issues/2788","repository_url":"https://api.github.com/repos/fastify/fastify","labels_url":"https://api.github.com/repos/fastify/fastify/issues/2788/labels{/name}","comments_url":"https://api.github.com/repos/fastify/fastify/issues/2788/comments","events_url":"https://api.github.com/repos/fastify/fastify/issues/2788/events","html_url":"https://github.com/fastify/fastify/issues/2788","id":783959878,"node_id":"MDU6SXNzdWU3ODM5NTk4Nzg=","number":2788,"title":"Creates incorrect HEAD route when using exposeHeadRoute","user":{"login":"salmanm","id":2510597,"node_id":"MDQ6VXNlcjI1MTA1OTc=","avatar_url":"https://avatars.githubusercontent.com/u/2510597?v=4","gravatar_id":"","url":"https://api.github.com/users/salmanm","html_url":"https://github.com/salmanm","followers_url":"https://api.github.com/users/salmanm/followers","following_url":"https://api.github.com/users/salmanm/following{/other_user}","gists_url":"https://api.github.com/users/salmanm/gists{/gist_id}","starred_url":"https://api.github.com/users/salmanm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/salmanm/subscriptions","organizations_url":"https://api.github.com/users/salmanm/orgs","repos_url":"https://api.github.com/users/salmanm/repos","events_url":"https://api.github.com/users/salmanm/events{/privacy}","received_events_url":"https://api.github.com/users/salmanm/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":451588686,"node_id":"MDU6TGFiZWw0NTE1ODg2ODY=","url":"https://api.github.com/repos/fastify/fastify/labels/bug","name":"bug","color":"ee0701","default":true,"description":"Confirmed bug"},{"id":771259949,"node_id":"MDU6TGFiZWw3NzEyNTk5NDk=","url":"https://api.github.com/repos/fastify/fastify/labels/good%20first%20issue","name":"good first issue","color":"168700","default":true,"description":"Good for newcomers"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2021-01-12T06:41:47Z","updated_at":"2021-01-25T09:49:46Z","closed_at":"2021-01-25T09:49:46Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\nBefore you submit an issue we recommend you visit [Fastify Help](https://github.com/fastify/help) and ask any questions you have or mention any problems you've had getting started with Fastify.\r\n\r\n**Please read this entire template before posting any issue. If you ignore these instructions\r\nand post an issue here that does not follow the instructions, your issue might be closed,\r\nlocked, and assigned the `missing discussion` label.**\r\n-->\r\n\r\n## ðŸ› Bug Report\r\n\r\nAs discovered in https://github.com/fastify/fastify/pull/2782#discussion_r554836505, when a route is set up with `exposeHeadRoute: true` with `prefix` and `prefixTrailingSlash`, a mysterious `HEAD` route is created.\r\n\r\nNeeds more investigation.\r\n\r\n## To Reproduce\r\n\r\nSteps to reproduce the behavior:\r\n\r\n```js\r\n  fastify.register(function routes (f, opts, next) {\r\n    f.route({\r\n      method: 'GET',\r\n      url: '/',\r\n      exposeHeadRoute: true,\r\n      prefixTrailingSlash: 'no-slash',\r\n      handler: (req, reply) => {\r\n        reply.send({ hello: 'world' })\r\n      }\r\n    })\r\n\r\n    next()\r\n  }, { prefix: '/prefix' })\r\n```\r\n\r\nCreates following routes\r\n\r\n- `GET /prefix`\r\n- `HEAD /prefix/prefix` (incorrect)\r\n\r\nWhen `prefixTrailingSlash` is set to `\"both\"`, it creates an **extra** route.\r\n\r\n- `GET /prefix`\r\n- `HEAD /prefix/prefix`\r\n- `GET /prefix/`\r\n- `HEAD /prefix`\r\n- `HEAD /prefix/`\r\n\r\n## Expected behavior\r\n\r\nShould not create extra or incorrect routes.\r\n","closed_by":{"login":"mcollina","id":52195,"node_id":"MDQ6VXNlcjUyMTk1","avatar_url":"https://avatars.githubusercontent.com/u/52195?v=4","gravatar_id":"","url":"https://api.github.com/users/mcollina","html_url":"https://github.com/mcollina","followers_url":"https://api.github.com/users/mcollina/followers","following_url":"https://api.github.com/users/mcollina/following{/other_user}","gists_url":"https://api.github.com/users/mcollina/gists{/gist_id}","starred_url":"https://api.github.com/users/mcollina/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mcollina/subscriptions","organizations_url":"https://api.github.com/users/mcollina/orgs","repos_url":"https://api.github.com/users/mcollina/repos","events_url":"https://api.github.com/users/mcollina/events{/privacy}","received_events_url":"https://api.github.com/users/mcollina/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/fastify/fastify/issues/2788/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/fastify/fastify/issues/2788/timeline","performed_via_github_app":null,"state_reason":"completed"}