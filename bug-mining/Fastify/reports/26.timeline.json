[{"id":1734266651,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTczNDI2NjY1MQ==","url":"https://api.github.com/repos/fastify/fastify/issues/events/1734266651","actor":{"login":"delvedor","id":4865608,"node_id":"MDQ6VXNlcjQ4NjU2MDg=","avatar_url":"https://avatars.githubusercontent.com/u/4865608?v=4","gravatar_id":"","url":"https://api.github.com/users/delvedor","html_url":"https://github.com/delvedor","followers_url":"https://api.github.com/users/delvedor/followers","following_url":"https://api.github.com/users/delvedor/following{/other_user}","gists_url":"https://api.github.com/users/delvedor/gists{/gist_id}","starred_url":"https://api.github.com/users/delvedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/delvedor/subscriptions","organizations_url":"https://api.github.com/users/delvedor/orgs","repos_url":"https://api.github.com/users/delvedor/repos","events_url":"https://api.github.com/users/delvedor/events{/privacy}","received_events_url":"https://api.github.com/users/delvedor/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2018-07-15T16:31:35Z","performed_via_github_app":null},{"id":1734266652,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDE3MzQyNjY2NTI=","url":"https://api.github.com/repos/fastify/fastify/issues/events/1734266652","actor":{"login":"delvedor","id":4865608,"node_id":"MDQ6VXNlcjQ4NjU2MDg=","avatar_url":"https://avatars.githubusercontent.com/u/4865608?v=4","gravatar_id":"","url":"https://api.github.com/users/delvedor","html_url":"https://github.com/delvedor","followers_url":"https://api.github.com/users/delvedor/followers","following_url":"https://api.github.com/users/delvedor/following{/other_user}","gists_url":"https://api.github.com/users/delvedor/gists{/gist_id}","starred_url":"https://api.github.com/users/delvedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/delvedor/subscriptions","organizations_url":"https://api.github.com/users/delvedor/orgs","repos_url":"https://api.github.com/users/delvedor/repos","events_url":"https://api.github.com/users/delvedor/events{/privacy}","received_events_url":"https://api.github.com/users/delvedor/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2018-07-15T16:31:35Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/fastify/fastify/issues/comments/405103961","html_url":"https://github.com/fastify/fastify/issues/1043#issuecomment-405103961","issue_url":"https://api.github.com/repos/fastify/fastify/issues/1043","id":405103961,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNTEwMzk2MQ==","user":{"login":"mcollina","id":52195,"node_id":"MDQ6VXNlcjUyMTk1","avatar_url":"https://avatars.githubusercontent.com/u/52195?v=4","gravatar_id":"","url":"https://api.github.com/users/mcollina","html_url":"https://github.com/mcollina","followers_url":"https://api.github.com/users/mcollina/followers","following_url":"https://api.github.com/users/mcollina/following{/other_user}","gists_url":"https://api.github.com/users/mcollina/gists{/gist_id}","starred_url":"https://api.github.com/users/mcollina/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mcollina/subscriptions","organizations_url":"https://api.github.com/users/mcollina/orgs","repos_url":"https://api.github.com/users/mcollina/repos","events_url":"https://api.github.com/users/mcollina/events{/privacy}","received_events_url":"https://api.github.com/users/mcollina/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-07-15T16:56:53Z","updated_at":"2018-07-15T16:56:53Z","body":"Can you please include a full stacktrace? Would you like to try sending a\nPull Request to fix this?\nIl giorno dom 15 lug 2018 alle 17:31 Alexander Kureniov <\nnotifications@github.com> ha scritto:\n\n> Related issue #922 <https://github.com/fastify/fastify/issues/922>.\n> @delvedor <https://github.com/delvedor>.\n>\n> I don't know if it's a bug. Or may be it's just a limitation of schemas.\n> Seems the root cause is quiet similar. If there are 2 or more schemas that\n> depend on each other are defined using allOf, e.g.:\n>\n> app.addSchema({\n>   $id: 'first',\n>   type: 'object',\n>   properties: {\n>     first: {\n>       type: 'number',\n>     },\n>   },\n> });app.addSchema({\n>   $id: 'second',\n>   type: 'object',\n>   allOf: [\n>     {\n>       type: 'object',\n>       properties: {\n>         second: {\n>           type: 'number',\n>         },\n>       },\n>     },\n>     'first#',\n>   ],\n> });\n>\n> then if first schema will be used after second fastify will throw\n> exception:\n>\n> Error: schema with key or id \"first\" already exists\n>\n> If schema \"usages\" will go in sequential order, then app will start\n> without any exceptions. See full example below:\n> What are you trying to achieve or the steps to reproduce?\n>\n> const fastify = require('fastify');const app = fastify({\n>   logger: {\n>     level: 'info',\n>     prettyPrint: true,\n>   },\n>   ignoreTrailingSlash: true,\n> });app.addSchema({\n>   $id: 'first',\n>   type: 'object',\n>   properties: {\n>     first: {\n>       type: 'number',\n>     },\n>   },\n> });\n> app.addSchema({\n>   $id: 'second',\n>   type: 'object',\n>   allOf: [\n>     {\n>       type: 'object',\n>       properties: {\n>         second: {\n>           type: 'number',\n>         },\n>       },\n>     },\n>     'first#',\n>   ],\n> });\n> app.get(\n>   '/',\n>   {\n>     schema: {\n>       description: `get`,\n>       body: 'second#',\n>       response: {\n>         200: 'second#',\n>       },\n>     },\n>   },\n>   async function(request, reply) {\n>     return {ok: 'ok'};\n>   }\n> );\n> app.patch(\n>   '/',\n>   {\n>     schema: {\n>       description: `patch`,\n>       body: 'first#',\n>       response: {\n>         200: 'first#',\n>       },\n>     },\n>   },\n>   async function(request, reply) {\n>     return {ok: 'ok'};\n>   }\n> );\n>\n> (async () => {\n>   try {\n>     await Promise.all([\n>       app.listen(3333),\n>       app.ready(),\n>     ]);\n>   } catch (ex) {\n>     console.log(ex);\n>     process.exit(1);\n>   }\n> })();\n>\n> What was the result you received?\n>\n> App schema validation fails. App doesn't start.\n>\n> Error: schema with key or id \"first\" already exists\n>\n> Swapping get and patch methods will \"solves\" issue.\n> What did you expect?\n>\n> Order of using schemas that depend on each other should not affect app.\n> Context\n>\n>    - *node version*: 9\n>    - *fastify version*: 1.8.0\n>\n> â€”\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/fastify/fastify/issues/1043>, or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/AADL41GgSXTLYS2052Zji1YQQu5cDUZvks5uG25ogaJpZM4VQTq8>\n> .\n>\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/fastify/fastify/issues/comments/405103961/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mcollina","id":52195,"node_id":"MDQ6VXNlcjUyMTk1","avatar_url":"https://avatars.githubusercontent.com/u/52195?v=4","gravatar_id":"","url":"https://api.github.com/users/mcollina","html_url":"https://github.com/mcollina","followers_url":"https://api.github.com/users/mcollina/followers","following_url":"https://api.github.com/users/mcollina/following{/other_user}","gists_url":"https://api.github.com/users/mcollina/gists{/gist_id}","starred_url":"https://api.github.com/users/mcollina/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mcollina/subscriptions","organizations_url":"https://api.github.com/users/mcollina/orgs","repos_url":"https://api.github.com/users/mcollina/repos","events_url":"https://api.github.com/users/mcollina/events{/privacy}","received_events_url":"https://api.github.com/users/mcollina/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":1734272839,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTczNDI3MjgzOQ==","url":"https://api.github.com/repos/fastify/fastify/issues/events/1734272839","actor":{"login":"delvedor","id":4865608,"node_id":"MDQ6VXNlcjQ4NjU2MDg=","avatar_url":"https://avatars.githubusercontent.com/u/4865608?v=4","gravatar_id":"","url":"https://api.github.com/users/delvedor","html_url":"https://github.com/delvedor","followers_url":"https://api.github.com/users/delvedor/followers","following_url":"https://api.github.com/users/delvedor/following{/other_user}","gists_url":"https://api.github.com/users/delvedor/gists{/gist_id}","starred_url":"https://api.github.com/users/delvedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/delvedor/subscriptions","organizations_url":"https://api.github.com/users/delvedor/orgs","repos_url":"https://api.github.com/users/delvedor/repos","events_url":"https://api.github.com/users/delvedor/events{/privacy}","received_events_url":"https://api.github.com/users/delvedor/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2018-07-15T16:56:54Z","performed_via_github_app":null},{"id":1734272840,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDE3MzQyNzI4NDA=","url":"https://api.github.com/repos/fastify/fastify/issues/events/1734272840","actor":{"login":"delvedor","id":4865608,"node_id":"MDQ6VXNlcjQ4NjU2MDg=","avatar_url":"https://avatars.githubusercontent.com/u/4865608?v=4","gravatar_id":"","url":"https://api.github.com/users/delvedor","html_url":"https://github.com/delvedor","followers_url":"https://api.github.com/users/delvedor/followers","following_url":"https://api.github.com/users/delvedor/following{/other_user}","gists_url":"https://api.github.com/users/delvedor/gists{/gist_id}","starred_url":"https://api.github.com/users/delvedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/delvedor/subscriptions","organizations_url":"https://api.github.com/users/delvedor/orgs","repos_url":"https://api.github.com/users/delvedor/repos","events_url":"https://api.github.com/users/delvedor/events{/privacy}","received_events_url":"https://api.github.com/users/delvedor/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2018-07-15T16:56:54Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/fastify/fastify/issues/comments/405105206","html_url":"https://github.com/fastify/fastify/issues/1043#issuecomment-405105206","issue_url":"https://api.github.com/repos/fastify/fastify/issues/1043","id":405105206,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNTEwNTIwNg==","user":{"login":"SkeLLLa","id":2273103,"node_id":"MDQ6VXNlcjIyNzMxMDM=","avatar_url":"https://avatars.githubusercontent.com/u/2273103?v=4","gravatar_id":"","url":"https://api.github.com/users/SkeLLLa","html_url":"https://github.com/SkeLLLa","followers_url":"https://api.github.com/users/SkeLLLa/followers","following_url":"https://api.github.com/users/SkeLLLa/following{/other_user}","gists_url":"https://api.github.com/users/SkeLLLa/gists{/gist_id}","starred_url":"https://api.github.com/users/SkeLLLa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SkeLLLa/subscriptions","organizations_url":"https://api.github.com/users/SkeLLLa/orgs","repos_url":"https://api.github.com/users/SkeLLLa/repos","events_url":"https://api.github.com/users/SkeLLLa/events{/privacy}","received_events_url":"https://api.github.com/users/SkeLLLa/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-07-15T17:20:58Z","updated_at":"2018-07-15T17:20:58Z","body":"```\r\nError: schema with key or id \"first\" already exists\r\n    at checkUnique (/app/node_modules/ajv/lib/ajv.js:478:11)\r\n    at Ajv._addSchema (/app/node_modules/ajv/lib/ajv.js:307:30)\r\n    at Ajv.compile (/app/node_modules/ajv/lib/ajv.js:112:24)\r\n    at build (/app/node_modules/fastify/lib/validation.js:58:27)\r\n    at afterRouteAdded (/app/node_modules/fastify/fastify.js:565:9)\r\n    at Object._encapsulateThreeParam (/app/node_modules/avvio/boot.js:360:7)\r\n    at Boot.callWithCbOrNextTick (/app/node_modules/avvio/boot.js:308:5)\r\n    at Boot._after (/app/node_modules/avvio/boot.js:212:26)\r\n    at Plugin.exec (/app/node_modules/avvio/plugin.js:45:17)\r\n    at Boot.loadPlugin (/app/node_modules/avvio/plugin.js:125:10)\r\n```\r\n\r\nI think, let's wait for @delvedor and hear what he thinks about this, because he's already fixed very similar issue. Probably he'll have some good ideas about the way of fixing this.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/fastify/fastify/issues/comments/405105206/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"SkeLLLa","id":2273103,"node_id":"MDQ6VXNlcjIyNzMxMDM=","avatar_url":"https://avatars.githubusercontent.com/u/2273103?v=4","gravatar_id":"","url":"https://api.github.com/users/SkeLLLa","html_url":"https://github.com/SkeLLLa","followers_url":"https://api.github.com/users/SkeLLLa/followers","following_url":"https://api.github.com/users/SkeLLLa/following{/other_user}","gists_url":"https://api.github.com/users/SkeLLLa/gists{/gist_id}","starred_url":"https://api.github.com/users/SkeLLLa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SkeLLLa/subscriptions","organizations_url":"https://api.github.com/users/SkeLLLa/orgs","repos_url":"https://api.github.com/users/SkeLLLa/repos","events_url":"https://api.github.com/users/SkeLLLa/events{/privacy}","received_events_url":"https://api.github.com/users/SkeLLLa/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":1734279144,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTczNDI3OTE0NA==","url":"https://api.github.com/repos/fastify/fastify/issues/events/1734279144","actor":{"login":"delvedor","id":4865608,"node_id":"MDQ6VXNlcjQ4NjU2MDg=","avatar_url":"https://avatars.githubusercontent.com/u/4865608?v=4","gravatar_id":"","url":"https://api.github.com/users/delvedor","html_url":"https://github.com/delvedor","followers_url":"https://api.github.com/users/delvedor/followers","following_url":"https://api.github.com/users/delvedor/following{/other_user}","gists_url":"https://api.github.com/users/delvedor/gists{/gist_id}","starred_url":"https://api.github.com/users/delvedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/delvedor/subscriptions","organizations_url":"https://api.github.com/users/delvedor/orgs","repos_url":"https://api.github.com/users/delvedor/repos","events_url":"https://api.github.com/users/delvedor/events{/privacy}","received_events_url":"https://api.github.com/users/delvedor/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2018-07-15T17:20:58Z","performed_via_github_app":null},{"id":1734279145,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDE3MzQyNzkxNDU=","url":"https://api.github.com/repos/fastify/fastify/issues/events/1734279145","actor":{"login":"delvedor","id":4865608,"node_id":"MDQ6VXNlcjQ4NjU2MDg=","avatar_url":"https://avatars.githubusercontent.com/u/4865608?v=4","gravatar_id":"","url":"https://api.github.com/users/delvedor","html_url":"https://github.com/delvedor","followers_url":"https://api.github.com/users/delvedor/followers","following_url":"https://api.github.com/users/delvedor/following{/other_user}","gists_url":"https://api.github.com/users/delvedor/gists{/gist_id}","starred_url":"https://api.github.com/users/delvedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/delvedor/subscriptions","organizations_url":"https://api.github.com/users/delvedor/orgs","repos_url":"https://api.github.com/users/delvedor/repos","events_url":"https://api.github.com/users/delvedor/events{/privacy}","received_events_url":"https://api.github.com/users/delvedor/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2018-07-15T17:20:58Z","performed_via_github_app":null},{"id":1735082757,"node_id":"MDEyOkxhYmVsZWRFdmVudDE3MzUwODI3NTc=","url":"https://api.github.com/repos/fastify/fastify/issues/events/1735082757","actor":{"login":"mcollina","id":52195,"node_id":"MDQ6VXNlcjUyMTk1","avatar_url":"https://avatars.githubusercontent.com/u/52195?v=4","gravatar_id":"","url":"https://api.github.com/users/mcollina","html_url":"https://github.com/mcollina","followers_url":"https://api.github.com/users/mcollina/followers","following_url":"https://api.github.com/users/mcollina/following{/other_user}","gists_url":"https://api.github.com/users/mcollina/gists{/gist_id}","starred_url":"https://api.github.com/users/mcollina/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mcollina/subscriptions","organizations_url":"https://api.github.com/users/mcollina/orgs","repos_url":"https://api.github.com/users/mcollina/repos","events_url":"https://api.github.com/users/mcollina/events{/privacy}","received_events_url":"https://api.github.com/users/mcollina/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2018-07-16T11:30:45Z","label":{"name":"bug","color":"ee0701"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/fastify/fastify/issues/comments/405218491","html_url":"https://github.com/fastify/fastify/issues/1043#issuecomment-405218491","issue_url":"https://api.github.com/repos/fastify/fastify/issues/1043","id":405218491,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNTIxODQ5MQ==","user":{"login":"mcollina","id":52195,"node_id":"MDQ6VXNlcjUyMTk1","avatar_url":"https://avatars.githubusercontent.com/u/52195?v=4","gravatar_id":"","url":"https://api.github.com/users/mcollina","html_url":"https://github.com/mcollina","followers_url":"https://api.github.com/users/mcollina/followers","following_url":"https://api.github.com/users/mcollina/following{/other_user}","gists_url":"https://api.github.com/users/mcollina/gists{/gist_id}","starred_url":"https://api.github.com/users/mcollina/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mcollina/subscriptions","organizations_url":"https://api.github.com/users/mcollina/orgs","repos_url":"https://api.github.com/users/mcollina/repos","events_url":"https://api.github.com/users/mcollina/events{/privacy}","received_events_url":"https://api.github.com/users/mcollina/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-07-16T11:31:33Z","updated_at":"2018-07-16T11:31:33Z","body":"Would you like to send a PR with the fix?","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/fastify/fastify/issues/comments/405218491/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mcollina","id":52195,"node_id":"MDQ6VXNlcjUyMTk1","avatar_url":"https://avatars.githubusercontent.com/u/52195?v=4","gravatar_id":"","url":"https://api.github.com/users/mcollina","html_url":"https://github.com/mcollina","followers_url":"https://api.github.com/users/mcollina/followers","following_url":"https://api.github.com/users/mcollina/following{/other_user}","gists_url":"https://api.github.com/users/mcollina/gists{/gist_id}","starred_url":"https://api.github.com/users/mcollina/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mcollina/subscriptions","organizations_url":"https://api.github.com/users/mcollina/orgs","repos_url":"https://api.github.com/users/mcollina/repos","events_url":"https://api.github.com/users/mcollina/events{/privacy}","received_events_url":"https://api.github.com/users/mcollina/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/fastify/fastify/issues/comments/405221845","html_url":"https://github.com/fastify/fastify/issues/1043#issuecomment-405221845","issue_url":"https://api.github.com/repos/fastify/fastify/issues/1043","id":405221845,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNTIyMTg0NQ==","user":{"login":"SkeLLLa","id":2273103,"node_id":"MDQ6VXNlcjIyNzMxMDM=","avatar_url":"https://avatars.githubusercontent.com/u/2273103?v=4","gravatar_id":"","url":"https://api.github.com/users/SkeLLLa","html_url":"https://github.com/SkeLLLa","followers_url":"https://api.github.com/users/SkeLLLa/followers","following_url":"https://api.github.com/users/SkeLLLa/following{/other_user}","gists_url":"https://api.github.com/users/SkeLLLa/gists{/gist_id}","starred_url":"https://api.github.com/users/SkeLLLa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SkeLLLa/subscriptions","organizations_url":"https://api.github.com/users/SkeLLLa/orgs","repos_url":"https://api.github.com/users/SkeLLLa/repos","events_url":"https://api.github.com/users/SkeLLLa/events{/privacy}","received_events_url":"https://api.github.com/users/SkeLLLa/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-07-16T11:47:50Z","updated_at":"2018-07-16T11:47:50Z","body":"@mcollina now I'm working on fastify-swagger adding support for OAS-3. So for now I don't have enough time.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/fastify/fastify/issues/comments/405221845/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"SkeLLLa","id":2273103,"node_id":"MDQ6VXNlcjIyNzMxMDM=","avatar_url":"https://avatars.githubusercontent.com/u/2273103?v=4","gravatar_id":"","url":"https://api.github.com/users/SkeLLLa","html_url":"https://github.com/SkeLLLa","followers_url":"https://api.github.com/users/SkeLLLa/followers","following_url":"https://api.github.com/users/SkeLLLa/following{/other_user}","gists_url":"https://api.github.com/users/SkeLLLa/gists{/gist_id}","starred_url":"https://api.github.com/users/SkeLLLa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SkeLLLa/subscriptions","organizations_url":"https://api.github.com/users/SkeLLLa/orgs","repos_url":"https://api.github.com/users/SkeLLLa/repos","events_url":"https://api.github.com/users/SkeLLLa/events{/privacy}","received_events_url":"https://api.github.com/users/SkeLLLa/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":1735109069,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTczNTEwOTA2OQ==","url":"https://api.github.com/repos/fastify/fastify/issues/events/1735109069","actor":{"login":"mcollina","id":52195,"node_id":"MDQ6VXNlcjUyMTk1","avatar_url":"https://avatars.githubusercontent.com/u/52195?v=4","gravatar_id":"","url":"https://api.github.com/users/mcollina","html_url":"https://github.com/mcollina","followers_url":"https://api.github.com/users/mcollina/followers","following_url":"https://api.github.com/users/mcollina/following{/other_user}","gists_url":"https://api.github.com/users/mcollina/gists{/gist_id}","starred_url":"https://api.github.com/users/mcollina/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mcollina/subscriptions","organizations_url":"https://api.github.com/users/mcollina/orgs","repos_url":"https://api.github.com/users/mcollina/repos","events_url":"https://api.github.com/users/mcollina/events{/privacy}","received_events_url":"https://api.github.com/users/mcollina/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2018-07-16T11:47:50Z","performed_via_github_app":null},{"id":1735109070,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDE3MzUxMDkwNzA=","url":"https://api.github.com/repos/fastify/fastify/issues/events/1735109070","actor":{"login":"mcollina","id":52195,"node_id":"MDQ6VXNlcjUyMTk1","avatar_url":"https://avatars.githubusercontent.com/u/52195?v=4","gravatar_id":"","url":"https://api.github.com/users/mcollina","html_url":"https://github.com/mcollina","followers_url":"https://api.github.com/users/mcollina/followers","following_url":"https://api.github.com/users/mcollina/following{/other_user}","gists_url":"https://api.github.com/users/mcollina/gists{/gist_id}","starred_url":"https://api.github.com/users/mcollina/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mcollina/subscriptions","organizations_url":"https://api.github.com/users/mcollina/orgs","repos_url":"https://api.github.com/users/mcollina/repos","events_url":"https://api.github.com/users/mcollina/events{/privacy}","received_events_url":"https://api.github.com/users/mcollina/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2018-07-16T11:47:50Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/fastify/fastify/issues/comments/406880895","html_url":"https://github.com/fastify/fastify/issues/1043#issuecomment-406880895","issue_url":"https://api.github.com/repos/fastify/fastify/issues/1043","id":406880895,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNjg4MDg5NQ==","user":{"login":"delvedor","id":4865608,"node_id":"MDQ6VXNlcjQ4NjU2MDg=","avatar_url":"https://avatars.githubusercontent.com/u/4865608?v=4","gravatar_id":"","url":"https://api.github.com/users/delvedor","html_url":"https://github.com/delvedor","followers_url":"https://api.github.com/users/delvedor/followers","following_url":"https://api.github.com/users/delvedor/following{/other_user}","gists_url":"https://api.github.com/users/delvedor/gists{/gist_id}","starred_url":"https://api.github.com/users/delvedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/delvedor/subscriptions","organizations_url":"https://api.github.com/users/delvedor/orgs","repos_url":"https://api.github.com/users/delvedor/repos","events_url":"https://api.github.com/users/delvedor/events{/privacy}","received_events_url":"https://api.github.com/users/delvedor/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-07-22T16:50:12Z","updated_at":"2018-07-22T16:50:12Z","body":"Confirmed, I'm working on this.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/fastify/fastify/issues/comments/406880895/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"delvedor","id":4865608,"node_id":"MDQ6VXNlcjQ4NjU2MDg=","avatar_url":"https://avatars.githubusercontent.com/u/4865608?v=4","gravatar_id":"","url":"https://api.github.com/users/delvedor","html_url":"https://github.com/delvedor","followers_url":"https://api.github.com/users/delvedor/followers","following_url":"https://api.github.com/users/delvedor/following{/other_user}","gists_url":"https://api.github.com/users/delvedor/gists{/gist_id}","starred_url":"https://api.github.com/users/delvedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/delvedor/subscriptions","organizations_url":"https://api.github.com/users/delvedor/orgs","repos_url":"https://api.github.com/users/delvedor/repos","events_url":"https://api.github.com/users/delvedor/events{/privacy}","received_events_url":"https://api.github.com/users/delvedor/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":1746497467,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDE3NDY0OTc0Njc=","url":"https://api.github.com/repos/fastify/fastify/issues/events/1746497467","actor":{"login":"delvedor","id":4865608,"node_id":"MDQ6VXNlcjQ4NjU2MDg=","avatar_url":"https://avatars.githubusercontent.com/u/4865608?v=4","gravatar_id":"","url":"https://api.github.com/users/delvedor","html_url":"https://github.com/delvedor","followers_url":"https://api.github.com/users/delvedor/followers","following_url":"https://api.github.com/users/delvedor/following{/other_user}","gists_url":"https://api.github.com/users/delvedor/gists{/gist_id}","starred_url":"https://api.github.com/users/delvedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/delvedor/subscriptions","organizations_url":"https://api.github.com/users/delvedor/orgs","repos_url":"https://api.github.com/users/delvedor/repos","events_url":"https://api.github.com/users/delvedor/events{/privacy}","received_events_url":"https://api.github.com/users/delvedor/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"fdb640b9855a7473b5e8e1b06db1151b7776bb36","commit_url":"https://api.github.com/repos/fastify/fastify/commits/fdb640b9855a7473b5e8e1b06db1151b7776bb36","created_at":"2018-07-22T16:57:55Z","performed_via_github_app":null},{"id":1747593966,"node_id":"MDExOkNsb3NlZEV2ZW50MTc0NzU5Mzk2Ng==","url":"https://api.github.com/repos/fastify/fastify/issues/events/1747593966","actor":{"login":"delvedor","id":4865608,"node_id":"MDQ6VXNlcjQ4NjU2MDg=","avatar_url":"https://avatars.githubusercontent.com/u/4865608?v=4","gravatar_id":"","url":"https://api.github.com/users/delvedor","html_url":"https://github.com/delvedor","followers_url":"https://api.github.com/users/delvedor/followers","following_url":"https://api.github.com/users/delvedor/following{/other_user}","gists_url":"https://api.github.com/users/delvedor/gists{/gist_id}","starred_url":"https://api.github.com/users/delvedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/delvedor/subscriptions","organizations_url":"https://api.github.com/users/delvedor/orgs","repos_url":"https://api.github.com/users/delvedor/repos","events_url":"https://api.github.com/users/delvedor/events{/privacy}","received_events_url":"https://api.github.com/users/delvedor/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"5ffb131e40b97fe1d391fe55bba6dd9842faffdb","commit_url":"https://api.github.com/repos/fastify/fastify/commits/5ffb131e40b97fe1d391fe55bba6dd9842faffdb","created_at":"2018-07-23T12:35:43Z","state_reason":null,"performed_via_github_app":null},{"actor":{"login":"Eomm","id":11404065,"node_id":"MDQ6VXNlcjExNDA0MDY1","avatar_url":"https://avatars.githubusercontent.com/u/11404065?v=4","gravatar_id":"","url":"https://api.github.com/users/Eomm","html_url":"https://github.com/Eomm","followers_url":"https://api.github.com/users/Eomm/followers","following_url":"https://api.github.com/users/Eomm/following{/other_user}","gists_url":"https://api.github.com/users/Eomm/gists{/gist_id}","starred_url":"https://api.github.com/users/Eomm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Eomm/subscriptions","organizations_url":"https://api.github.com/users/Eomm/orgs","repos_url":"https://api.github.com/users/Eomm/repos","events_url":"https://api.github.com/users/Eomm/events{/privacy}","received_events_url":"https://api.github.com/users/Eomm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-30T20:36:13Z","updated_at":"2019-01-30T20:36:13Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/fastify/fastify/issues/1419","repository_url":"https://api.github.com/repos/fastify/fastify","labels_url":"https://api.github.com/repos/fastify/fastify/issues/1419/labels{/name}","comments_url":"https://api.github.com/repos/fastify/fastify/issues/1419/comments","events_url":"https://api.github.com/repos/fastify/fastify/issues/1419/events","html_url":"https://github.com/fastify/fastify/issues/1419","id":404953061,"node_id":"MDU6SXNzdWU0MDQ5NTMwNjE=","number":1419,"title":"Json schema $ref id","user":{"login":"Eomm","id":11404065,"node_id":"MDQ6VXNlcjExNDA0MDY1","avatar_url":"https://avatars.githubusercontent.com/u/11404065?v=4","gravatar_id":"","url":"https://api.github.com/users/Eomm","html_url":"https://github.com/Eomm","followers_url":"https://api.github.com/users/Eomm/followers","following_url":"https://api.github.com/users/Eomm/following{/other_user}","gists_url":"https://api.github.com/users/Eomm/gists{/gist_id}","starred_url":"https://api.github.com/users/Eomm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Eomm/subscriptions","organizations_url":"https://api.github.com/users/Eomm/orgs","repos_url":"https://api.github.com/users/Eomm/repos","events_url":"https://api.github.com/users/Eomm/events{/privacy}","received_events_url":"https://api.github.com/users/Eomm/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2019-01-30T20:36:13Z","updated_at":"2019-02-03T08:38:12Z","closed_at":"2019-02-02T15:40:02Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":69495170,"node_id":"MDEwOlJlcG9zaXRvcnk2OTQ5NTE3MA==","name":"fastify","full_name":"fastify/fastify","private":false,"owner":{"login":"fastify","id":24939410,"node_id":"MDEyOk9yZ2FuaXphdGlvbjI0OTM5NDEw","avatar_url":"https://avatars.githubusercontent.com/u/24939410?v=4","gravatar_id":"","url":"https://api.github.com/users/fastify","html_url":"https://github.com/fastify","followers_url":"https://api.github.com/users/fastify/followers","following_url":"https://api.github.com/users/fastify/following{/other_user}","gists_url":"https://api.github.com/users/fastify/gists{/gist_id}","starred_url":"https://api.github.com/users/fastify/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fastify/subscriptions","organizations_url":"https://api.github.com/users/fastify/orgs","repos_url":"https://api.github.com/users/fastify/repos","events_url":"https://api.github.com/users/fastify/events{/privacy}","received_events_url":"https://api.github.com/users/fastify/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/fastify/fastify","description":"Fast and low overhead web framework, for Node.js","fork":false,"url":"https://api.github.com/repos/fastify/fastify","forks_url":"https://api.github.com/repos/fastify/fastify/forks","keys_url":"https://api.github.com/repos/fastify/fastify/keys{/key_id}","collaborators_url":"https://api.github.com/repos/fastify/fastify/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/fastify/fastify/teams","hooks_url":"https://api.github.com/repos/fastify/fastify/hooks","issue_events_url":"https://api.github.com/repos/fastify/fastify/issues/events{/number}","events_url":"https://api.github.com/repos/fastify/fastify/events","assignees_url":"https://api.github.com/repos/fastify/fastify/assignees{/user}","branches_url":"https://api.github.com/repos/fastify/fastify/branches{/branch}","tags_url":"https://api.github.com/repos/fastify/fastify/tags","blobs_url":"https://api.github.com/repos/fastify/fastify/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/fastify/fastify/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/fastify/fastify/git/refs{/sha}","trees_url":"https://api.github.com/repos/fastify/fastify/git/trees{/sha}","statuses_url":"https://api.github.com/repos/fastify/fastify/statuses/{sha}","languages_url":"https://api.github.com/repos/fastify/fastify/languages","stargazers_url":"https://api.github.com/repos/fastify/fastify/stargazers","contributors_url":"https://api.github.com/repos/fastify/fastify/contributors","subscribers_url":"https://api.github.com/repos/fastify/fastify/subscribers","subscription_url":"https://api.github.com/repos/fastify/fastify/subscription","commits_url":"https://api.github.com/repos/fastify/fastify/commits{/sha}","git_commits_url":"https://api.github.com/repos/fastify/fastify/git/commits{/sha}","comments_url":"https://api.github.com/repos/fastify/fastify/comments{/number}","issue_comment_url":"https://api.github.com/repos/fastify/fastify/issues/comments{/number}","contents_url":"https://api.github.com/repos/fastify/fastify/contents/{+path}","compare_url":"https://api.github.com/repos/fastify/fastify/compare/{base}...{head}","merges_url":"https://api.github.com/repos/fastify/fastify/merges","archive_url":"https://api.github.com/repos/fastify/fastify/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/fastify/fastify/downloads","issues_url":"https://api.github.com/repos/fastify/fastify/issues{/number}","pulls_url":"https://api.github.com/repos/fastify/fastify/pulls{/number}","milestones_url":"https://api.github.com/repos/fastify/fastify/milestones{/number}","notifications_url":"https://api.github.com/repos/fastify/fastify/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/fastify/fastify/labels{/name}","releases_url":"https://api.github.com/repos/fastify/fastify/releases{/id}","deployments_url":"https://api.github.com/repos/fastify/fastify/deployments","created_at":"2016-09-28T19:10:14Z","updated_at":"2025-11-09T19:27:27Z","pushed_at":"2025-11-09T20:20:24Z","git_url":"git://github.com/fastify/fastify.git","ssh_url":"git@github.com:fastify/fastify.git","clone_url":"https://github.com/fastify/fastify.git","svn_url":"https://github.com/fastify/fastify","homepage":"https://www.fastify.dev","size":9357,"stargazers_count":34974,"watchers_count":34974,"language":"JavaScript","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":2510,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":100,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":true,"topics":["hacktoberfest","nodejs","performance","speed","webframework"],"visibility":"public","forks":2510,"open_issues":100,"watchers":34974,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"## ðŸ› Bug Report\r\n\r\nHi, testing the (fluent) json-schema I found that the [id-with-ref](https://json-schema.org/understanding-json-schema/structuring.html#using-id-with-ref) function is broken and return on start:\r\n\r\n> { [Error: can't resolve reference #address from id #]\r\n  message: 'can\\'t resolve reference #address from id #',\r\n  missingRef: '#address',\r\n  missingSchema: '' }\r\n\r\n## To Reproduce\r\n\r\n```js\r\nconst fastify = require('./fastify')({ logger: { level: 'debug' } })\r\n\r\nconst body = {\r\n  '$schema': 'http://json-schema.org/draft-07/schema#',\r\n  'definitions': {\r\n    '#address': {\r\n      'type': 'object',\r\n      '$id': '#address',\r\n      'properties': {\r\n        'city': {\r\n          'type': 'string'\r\n        },\r\n        'zipcode': {\r\n          'type': 'string'\r\n        }\r\n      }\r\n    }\r\n  },\r\n  'type': 'object',\r\n  '$id': 'http://foo/user',\r\n  'title': 'My First Fluent JSON Schema',\r\n  'description': 'A simple user',\r\n  'properties': {\r\n    'email': {\r\n      'type': 'string',\r\n      'format': 'email'\r\n    },\r\n    'address': {\r\n      '$ref': '#address'\r\n    }\r\n  },\r\n  'required': [\r\n    'email'\r\n  ]\r\n}\r\n\r\nfastify.post('/', { schema: { body } }, (request, reply) => { reply.send('good') })\r\nfastify.listen(3000).catch(console.log)\r\n```\r\n\r\n## Expected behavior\r\n\r\nThe JSON schema is a valid one and use the `$ref: '#id'` function so the error doen't have to be thrown and the `#address` should be resolved.\r\n\r\n## Your Environment\r\n\r\n- *node version*: 10\r\n- *fastify version*: >= 2.0.0-rc.4 `master branch`\r\n- *os*: Windows\r\n\r\nI would like to work on it ðŸ˜ƒ\r\nI found that the problem is due to this line for the issue #1043  https://github.com/fastify/fastify/blob/310cb60b439fb363b28d42eb2e0f351447c7f11b/lib/schemas.js#L83\r\n-if I comment it the example works fine, but the test fails- \r\n","reactions":{"url":"https://api.github.com/repos/fastify/fastify/issues/1419/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/fastify/fastify/issues/1419/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/fastify/fastify/issues/comments/781837259","html_url":"https://github.com/fastify/fastify/issues/1043#issuecomment-781837259","issue_url":"https://api.github.com/repos/fastify/fastify/issues/1043","id":781837259,"node_id":"MDEyOklzc3VlQ29tbWVudDc4MTgzNzI1OQ==","user":{"login":"harveyconnor","id":10123441,"node_id":"MDQ6VXNlcjEwMTIzNDQx","avatar_url":"https://avatars.githubusercontent.com/u/10123441?v=4","gravatar_id":"","url":"https://api.github.com/users/harveyconnor","html_url":"https://github.com/harveyconnor","followers_url":"https://api.github.com/users/harveyconnor/followers","following_url":"https://api.github.com/users/harveyconnor/following{/other_user}","gists_url":"https://api.github.com/users/harveyconnor/gists{/gist_id}","starred_url":"https://api.github.com/users/harveyconnor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harveyconnor/subscriptions","organizations_url":"https://api.github.com/users/harveyconnor/orgs","repos_url":"https://api.github.com/users/harveyconnor/repos","events_url":"https://api.github.com/users/harveyconnor/events{/privacy}","received_events_url":"https://api.github.com/users/harveyconnor/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-19T05:38:40Z","updated_at":"2021-02-19T05:39:01Z","body":"Still getting this in the latest version\r\n```java\r\nError: schema with key or id \"Role\" already exists\r\n    at checkUnique (/Users/harveyconnor/Development/nura-api/node_modules/ajv/lib/ajv.js:481:11)\r\n    at Ajv.addSchema (/Users/harveyconnor/Development/nura-api/node_modules/ajv/lib/ajv.js:136:3)\r\n    at ValidatorCompiler (/Users/harveyconnor/Development/nura-api/node_modules/fastify/lib/schema-compilers.js:48:9)\r\n    at Object.buildCompilerFromPool [as buildValidator] (/Users/harveyconnor/Development/nura-api/node_modules/fastify/lib/schema-compilers.js:20:22)\r\n    at SchemaController.setupValidator (/Users/harveyconnor/Development/nura-api/node_modules/fastify/lib/schema-controller.js:88:52)\r\n    at Boot.<anonymous> (/Users/harveyconnor/Development/nura-api/node_modules/fastify/lib/route.js:297:30)\r\n    at Object.onceWrapper (events.js:421:28)\r\n    at Boot.emit (events.js:327:22)\r\n    at /Users/harveyconnor/Development/nura-api/node_modules/avvio/boot.js:153:12\r\n    at /Users/harveyconnor/Development/nura-api/node_modules/avvio/plugin.js:269:7\r\n    at done (/Users/harveyconnor/Development/nura-api/node_modules/avvio/plugin.js:201:5)\r\n    at check (/Users/harveyconnor/Development/nura-api/node_modules/avvio/plugin.js:225:9)\r\n    at internal/process/task_queues.js:149:7\r\n    at AsyncResource.runInAsyncScope (async_hooks.js:197:9)\r\n    at AsyncResource.runMicrotask (internal/process/task_queues.js:146:8)\r\n    at processTicksAndRejections (internal/process/task_queues.js:93:5)\r\n[ERROR] 15:34:11 Error: schema with key or id \"Role\" already exists\r\n```","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/fastify/fastify/issues/comments/781837259/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"harveyconnor","id":10123441,"node_id":"MDQ6VXNlcjEwMTIzNDQx","avatar_url":"https://avatars.githubusercontent.com/u/10123441?v=4","gravatar_id":"","url":"https://api.github.com/users/harveyconnor","html_url":"https://github.com/harveyconnor","followers_url":"https://api.github.com/users/harveyconnor/followers","following_url":"https://api.github.com/users/harveyconnor/following{/other_user}","gists_url":"https://api.github.com/users/harveyconnor/gists{/gist_id}","starred_url":"https://api.github.com/users/harveyconnor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harveyconnor/subscriptions","organizations_url":"https://api.github.com/users/harveyconnor/orgs","repos_url":"https://api.github.com/users/harveyconnor/repos","events_url":"https://api.github.com/users/harveyconnor/events{/privacy}","received_events_url":"https://api.github.com/users/harveyconnor/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/fastify/fastify/issues/comments/781919068","html_url":"https://github.com/fastify/fastify/issues/1043#issuecomment-781919068","issue_url":"https://api.github.com/repos/fastify/fastify/issues/1043","id":781919068,"node_id":"MDEyOklzc3VlQ29tbWVudDc4MTkxOTA2OA==","user":{"login":"Eomm","id":11404065,"node_id":"MDQ6VXNlcjExNDA0MDY1","avatar_url":"https://avatars.githubusercontent.com/u/11404065?v=4","gravatar_id":"","url":"https://api.github.com/users/Eomm","html_url":"https://github.com/Eomm","followers_url":"https://api.github.com/users/Eomm/followers","following_url":"https://api.github.com/users/Eomm/following{/other_user}","gists_url":"https://api.github.com/users/Eomm/gists{/gist_id}","starred_url":"https://api.github.com/users/Eomm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Eomm/subscriptions","organizations_url":"https://api.github.com/users/Eomm/orgs","repos_url":"https://api.github.com/users/Eomm/repos","events_url":"https://api.github.com/users/Eomm/events{/privacy}","received_events_url":"https://api.github.com/users/Eomm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-19T08:28:32Z","updated_at":"2021-02-19T08:28:32Z","body":"Could you add a [Minimal, Reproducible Example](https://stackoverflow.com/help/minimal-reproducible-example)?\r\n\r\nWithout it, we are unable to help you.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/fastify/fastify/issues/comments/781919068/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Eomm","id":11404065,"node_id":"MDQ6VXNlcjExNDA0MDY1","avatar_url":"https://avatars.githubusercontent.com/u/11404065?v=4","gravatar_id":"","url":"https://api.github.com/users/Eomm","html_url":"https://github.com/Eomm","followers_url":"https://api.github.com/users/Eomm/followers","following_url":"https://api.github.com/users/Eomm/following{/other_user}","gists_url":"https://api.github.com/users/Eomm/gists{/gist_id}","starred_url":"https://api.github.com/users/Eomm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Eomm/subscriptions","organizations_url":"https://api.github.com/users/Eomm/orgs","repos_url":"https://api.github.com/users/Eomm/repos","events_url":"https://api.github.com/users/Eomm/events{/privacy}","received_events_url":"https://api.github.com/users/Eomm/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/fastify/fastify/issues/comments/798816276","html_url":"https://github.com/fastify/fastify/issues/1043#issuecomment-798816276","issue_url":"https://api.github.com/repos/fastify/fastify/issues/1043","id":798816276,"node_id":"MDEyOklzc3VlQ29tbWVudDc5ODgxNjI3Ng==","user":{"login":"JakeGinnivan","id":453152,"node_id":"MDQ6VXNlcjQ1MzE1Mg==","avatar_url":"https://avatars.githubusercontent.com/u/453152?v=4","gravatar_id":"","url":"https://api.github.com/users/JakeGinnivan","html_url":"https://github.com/JakeGinnivan","followers_url":"https://api.github.com/users/JakeGinnivan/followers","following_url":"https://api.github.com/users/JakeGinnivan/following{/other_user}","gists_url":"https://api.github.com/users/JakeGinnivan/gists{/gist_id}","starred_url":"https://api.github.com/users/JakeGinnivan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JakeGinnivan/subscriptions","organizations_url":"https://api.github.com/users/JakeGinnivan/orgs","repos_url":"https://api.github.com/users/JakeGinnivan/repos","events_url":"https://api.github.com/users/JakeGinnivan/events{/privacy}","received_events_url":"https://api.github.com/users/JakeGinnivan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-14T01:57:35Z","updated_at":"2021-03-14T01:57:35Z","body":"I just hit this. My problem was a setup like this:\r\n\r\n``` js\r\napp.addSchema({ '$id': 'one', type: 'object', properties: { thing: { '$ref': 'two#' } })\r\napp.addSchema({ '$id': 'two', type: 'object', properties: { })\r\n\r\napp.get('/path', {\r\n    schema: {\r\n       response: { 200: { 'type': 'object', properties: { thing: { '$ref': 'two#' } } } }\r\n    }\r\n}, (req, reply) => { .. })\r\n```\r\n\r\nMy guess, somehow when adding `two` when it's already been referred to in an earlier `addSchema` it gets added twice.\r\n\r\nThe fix was to switch the adding of the schemas around\r\n\r\n``` js\r\napp.addSchema({ '$id': 'two', type: 'object', properties: { })\r\napp.addSchema({ '$id': 'one', type: 'object', properties: { thing: { '$ref': 'two#' } })\r\n```\r\n\r\nHope this helps someone","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/fastify/fastify/issues/comments/798816276/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":1,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"JakeGinnivan","id":453152,"node_id":"MDQ6VXNlcjQ1MzE1Mg==","avatar_url":"https://avatars.githubusercontent.com/u/453152?v=4","gravatar_id":"","url":"https://api.github.com/users/JakeGinnivan","html_url":"https://github.com/JakeGinnivan","followers_url":"https://api.github.com/users/JakeGinnivan/followers","following_url":"https://api.github.com/users/JakeGinnivan/following{/other_user}","gists_url":"https://api.github.com/users/JakeGinnivan/gists{/gist_id}","starred_url":"https://api.github.com/users/JakeGinnivan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JakeGinnivan/subscriptions","organizations_url":"https://api.github.com/users/JakeGinnivan/orgs","repos_url":"https://api.github.com/users/JakeGinnivan/repos","events_url":"https://api.github.com/users/JakeGinnivan/events{/privacy}","received_events_url":"https://api.github.com/users/JakeGinnivan/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/fastify/fastify/issues/comments/798866850","html_url":"https://github.com/fastify/fastify/issues/1043#issuecomment-798866850","issue_url":"https://api.github.com/repos/fastify/fastify/issues/1043","id":798866850,"node_id":"MDEyOklzc3VlQ29tbWVudDc5ODg2Njg1MA==","user":{"login":"Eomm","id":11404065,"node_id":"MDQ6VXNlcjExNDA0MDY1","avatar_url":"https://avatars.githubusercontent.com/u/11404065?v=4","gravatar_id":"","url":"https://api.github.com/users/Eomm","html_url":"https://github.com/Eomm","followers_url":"https://api.github.com/users/Eomm/followers","following_url":"https://api.github.com/users/Eomm/following{/other_user}","gists_url":"https://api.github.com/users/Eomm/gists{/gist_id}","starred_url":"https://api.github.com/users/Eomm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Eomm/subscriptions","organizations_url":"https://api.github.com/users/Eomm/orgs","repos_url":"https://api.github.com/users/Eomm/repos","events_url":"https://api.github.com/users/Eomm/events{/privacy}","received_events_url":"https://api.github.com/users/Eomm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-14T08:18:24Z","updated_at":"2021-03-14T08:18:24Z","body":"That code works actually: https://runkit.com/embed/u0jziy02t8lu\r\n\r\nPlease open a new issue with a [Minimal, Reproducible Example](https://stackoverflow.com/help/minimal-reproducible-example) in order to improve our test suite with your use case and avoid regressions","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/fastify/fastify/issues/comments/798866850/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Eomm","id":11404065,"node_id":"MDQ6VXNlcjExNDA0MDY1","avatar_url":"https://avatars.githubusercontent.com/u/11404065?v=4","gravatar_id":"","url":"https://api.github.com/users/Eomm","html_url":"https://github.com/Eomm","followers_url":"https://api.github.com/users/Eomm/followers","following_url":"https://api.github.com/users/Eomm/following{/other_user}","gists_url":"https://api.github.com/users/Eomm/gists{/gist_id}","starred_url":"https://api.github.com/users/Eomm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Eomm/subscriptions","organizations_url":"https://api.github.com/users/Eomm/orgs","repos_url":"https://api.github.com/users/Eomm/repos","events_url":"https://api.github.com/users/Eomm/events{/privacy}","received_events_url":"https://api.github.com/users/Eomm/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/fastify/fastify/issues/comments/798992445","html_url":"https://github.com/fastify/fastify/issues/1043#issuecomment-798992445","issue_url":"https://api.github.com/repos/fastify/fastify/issues/1043","id":798992445,"node_id":"MDEyOklzc3VlQ29tbWVudDc5ODk5MjQ0NQ==","user":{"login":"harveyconnor","id":10123441,"node_id":"MDQ6VXNlcjEwMTIzNDQx","avatar_url":"https://avatars.githubusercontent.com/u/10123441?v=4","gravatar_id":"","url":"https://api.github.com/users/harveyconnor","html_url":"https://github.com/harveyconnor","followers_url":"https://api.github.com/users/harveyconnor/followers","following_url":"https://api.github.com/users/harveyconnor/following{/other_user}","gists_url":"https://api.github.com/users/harveyconnor/gists{/gist_id}","starred_url":"https://api.github.com/users/harveyconnor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harveyconnor/subscriptions","organizations_url":"https://api.github.com/users/harveyconnor/orgs","repos_url":"https://api.github.com/users/harveyconnor/repos","events_url":"https://api.github.com/users/harveyconnor/events{/privacy}","received_events_url":"https://api.github.com/users/harveyconnor/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-14T22:32:54Z","updated_at":"2021-03-14T22:32:54Z","body":"@JakeGinnivan yep that works for a simple scenario. In my case we have multiple files depending on each other in such a circular dependency, so it does not work.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/fastify/fastify/issues/comments/798992445/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"harveyconnor","id":10123441,"node_id":"MDQ6VXNlcjEwMTIzNDQx","avatar_url":"https://avatars.githubusercontent.com/u/10123441?v=4","gravatar_id":"","url":"https://api.github.com/users/harveyconnor","html_url":"https://github.com/harveyconnor","followers_url":"https://api.github.com/users/harveyconnor/followers","following_url":"https://api.github.com/users/harveyconnor/following{/other_user}","gists_url":"https://api.github.com/users/harveyconnor/gists{/gist_id}","starred_url":"https://api.github.com/users/harveyconnor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/harveyconnor/subscriptions","organizations_url":"https://api.github.com/users/harveyconnor/orgs","repos_url":"https://api.github.com/users/harveyconnor/repos","events_url":"https://api.github.com/users/harveyconnor/events{/privacy}","received_events_url":"https://api.github.com/users/harveyconnor/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":4455806620,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDQ1NTgwNjYyMA==","url":"https://api.github.com/repos/fastify/fastify/issues/events/4455806620","actor":{"login":"JakeGinnivan","id":453152,"node_id":"MDQ6VXNlcjQ1MzE1Mg==","avatar_url":"https://avatars.githubusercontent.com/u/453152?v=4","gravatar_id":"","url":"https://api.github.com/users/JakeGinnivan","html_url":"https://github.com/JakeGinnivan","followers_url":"https://api.github.com/users/JakeGinnivan/followers","following_url":"https://api.github.com/users/JakeGinnivan/following{/other_user}","gists_url":"https://api.github.com/users/JakeGinnivan/gists{/gist_id}","starred_url":"https://api.github.com/users/JakeGinnivan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JakeGinnivan/subscriptions","organizations_url":"https://api.github.com/users/JakeGinnivan/orgs","repos_url":"https://api.github.com/users/JakeGinnivan/repos","events_url":"https://api.github.com/users/JakeGinnivan/events{/privacy}","received_events_url":"https://api.github.com/users/JakeGinnivan/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-03-14T22:32:54Z","performed_via_github_app":null},{"id":4455806622,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQ0NTU4MDY2MjI=","url":"https://api.github.com/repos/fastify/fastify/issues/events/4455806622","actor":{"login":"JakeGinnivan","id":453152,"node_id":"MDQ6VXNlcjQ1MzE1Mg==","avatar_url":"https://avatars.githubusercontent.com/u/453152?v=4","gravatar_id":"","url":"https://api.github.com/users/JakeGinnivan","html_url":"https://github.com/JakeGinnivan","followers_url":"https://api.github.com/users/JakeGinnivan/followers","following_url":"https://api.github.com/users/JakeGinnivan/following{/other_user}","gists_url":"https://api.github.com/users/JakeGinnivan/gists{/gist_id}","starred_url":"https://api.github.com/users/JakeGinnivan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JakeGinnivan/subscriptions","organizations_url":"https://api.github.com/users/JakeGinnivan/orgs","repos_url":"https://api.github.com/users/JakeGinnivan/repos","events_url":"https://api.github.com/users/JakeGinnivan/events{/privacy}","received_events_url":"https://api.github.com/users/JakeGinnivan/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-03-14T22:32:54Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/fastify/fastify/issues/comments/974475465","html_url":"https://github.com/fastify/fastify/issues/1043#issuecomment-974475465","issue_url":"https://api.github.com/repos/fastify/fastify/issues/1043","id":974475465,"node_id":"IC_kwDOBCRpgs46FVDJ","user":{"login":"meerkat999","id":13388738,"node_id":"MDQ6VXNlcjEzMzg4NzM4","avatar_url":"https://avatars.githubusercontent.com/u/13388738?v=4","gravatar_id":"","url":"https://api.github.com/users/meerkat999","html_url":"https://github.com/meerkat999","followers_url":"https://api.github.com/users/meerkat999/followers","following_url":"https://api.github.com/users/meerkat999/following{/other_user}","gists_url":"https://api.github.com/users/meerkat999/gists{/gist_id}","starred_url":"https://api.github.com/users/meerkat999/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/meerkat999/subscriptions","organizations_url":"https://api.github.com/users/meerkat999/orgs","repos_url":"https://api.github.com/users/meerkat999/repos","events_url":"https://api.github.com/users/meerkat999/events{/privacy}","received_events_url":"https://api.github.com/users/meerkat999/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-11-19T21:11:52Z","updated_at":"2021-11-19T21:11:52Z","body":"Any solution for this?","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/fastify/fastify/issues/comments/974475465/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"meerkat999","id":13388738,"node_id":"MDQ6VXNlcjEzMzg4NzM4","avatar_url":"https://avatars.githubusercontent.com/u/13388738?v=4","gravatar_id":"","url":"https://api.github.com/users/meerkat999","html_url":"https://github.com/meerkat999","followers_url":"https://api.github.com/users/meerkat999/followers","following_url":"https://api.github.com/users/meerkat999/following{/other_user}","gists_url":"https://api.github.com/users/meerkat999/gists{/gist_id}","starred_url":"https://api.github.com/users/meerkat999/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/meerkat999/subscriptions","organizations_url":"https://api.github.com/users/meerkat999/orgs","repos_url":"https://api.github.com/users/meerkat999/repos","events_url":"https://api.github.com/users/meerkat999/events{/privacy}","received_events_url":"https://api.github.com/users/meerkat999/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/fastify/fastify/issues/comments/974611630","html_url":"https://github.com/fastify/fastify/issues/1043#issuecomment-974611630","issue_url":"https://api.github.com/repos/fastify/fastify/issues/1043","id":974611630,"node_id":"IC_kwDOBCRpgs46F2Su","user":{"login":"Eomm","id":11404065,"node_id":"MDQ6VXNlcjExNDA0MDY1","avatar_url":"https://avatars.githubusercontent.com/u/11404065?v=4","gravatar_id":"","url":"https://api.github.com/users/Eomm","html_url":"https://github.com/Eomm","followers_url":"https://api.github.com/users/Eomm/followers","following_url":"https://api.github.com/users/Eomm/following{/other_user}","gists_url":"https://api.github.com/users/Eomm/gists{/gist_id}","starred_url":"https://api.github.com/users/Eomm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Eomm/subscriptions","organizations_url":"https://api.github.com/users/Eomm/orgs","repos_url":"https://api.github.com/users/Eomm/repos","events_url":"https://api.github.com/users/Eomm/events{/privacy}","received_events_url":"https://api.github.com/users/Eomm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-11-20T07:51:13Z","updated_at":"2021-11-20T07:51:13Z","body":"This is my 3rd message in a row:\r\n\r\nCould you add a [Minimal, Reproducible Example](https://stackoverflow.com/help/minimal-reproducible-example)?\r\n\r\n**Without it, we are unable to help you.**","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/fastify/fastify/issues/comments/974611630/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Eomm","id":11404065,"node_id":"MDQ6VXNlcjExNDA0MDY1","avatar_url":"https://avatars.githubusercontent.com/u/11404065?v=4","gravatar_id":"","url":"https://api.github.com/users/Eomm","html_url":"https://github.com/Eomm","followers_url":"https://api.github.com/users/Eomm/followers","following_url":"https://api.github.com/users/Eomm/following{/other_user}","gists_url":"https://api.github.com/users/Eomm/gists{/gist_id}","starred_url":"https://api.github.com/users/Eomm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Eomm/subscriptions","organizations_url":"https://api.github.com/users/Eomm/orgs","repos_url":"https://api.github.com/users/Eomm/repos","events_url":"https://api.github.com/users/Eomm/events{/privacy}","received_events_url":"https://api.github.com/users/Eomm/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":5649022397,"node_id":"LOE_lADOBCRpgs4UWFnWzwAAAAFQtT29","url":"https://api.github.com/repos/fastify/fastify/issues/events/5649022397","actor":{"login":"fastify","id":24939410,"node_id":"MDEyOk9yZ2FuaXphdGlvbjI0OTM5NDEw","avatar_url":"https://avatars.githubusercontent.com/u/24939410?v=4","gravatar_id":"","url":"https://api.github.com/users/fastify","html_url":"https://github.com/fastify","followers_url":"https://api.github.com/users/fastify/followers","following_url":"https://api.github.com/users/fastify/following{/other_user}","gists_url":"https://api.github.com/users/fastify/gists{/gist_id}","starred_url":"https://api.github.com/users/fastify/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fastify/subscriptions","organizations_url":"https://api.github.com/users/fastify/orgs","repos_url":"https://api.github.com/users/fastify/repos","events_url":"https://api.github.com/users/fastify/events{/privacy}","received_events_url":"https://api.github.com/users/fastify/received_events","type":"Organization","user_view_type":"public","site_admin":false},"event":"locked","commit_id":null,"commit_url":null,"created_at":"2021-11-20T15:01:50Z","lock_reason":"resolved","performed_via_github_app":null}]