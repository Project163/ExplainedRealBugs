{"url":"https://api.github.com/repos/fastify/fastify/issues/1358","repository_url":"https://api.github.com/repos/fastify/fastify","labels_url":"https://api.github.com/repos/fastify/fastify/issues/1358/labels{/name}","comments_url":"https://api.github.com/repos/fastify/fastify/issues/1358/comments","events_url":"https://api.github.com/repos/fastify/fastify/issues/1358/events","html_url":"https://github.com/fastify/fastify/issues/1358","id":394745849,"node_id":"MDU6SXNzdWUzOTQ3NDU4NDk=","number":1358,"title":"Response cookies are not being parsed correctly on browser.","user":{"login":"digrich","id":9439420,"node_id":"MDQ6VXNlcjk0Mzk0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9439420?v=4","gravatar_id":"","url":"https://api.github.com/users/digrich","html_url":"https://github.com/digrich","followers_url":"https://api.github.com/users/digrich/followers","following_url":"https://api.github.com/users/digrich/following{/other_user}","gists_url":"https://api.github.com/users/digrich/gists{/gist_id}","starred_url":"https://api.github.com/users/digrich/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/digrich/subscriptions","organizations_url":"https://api.github.com/users/digrich/orgs","repos_url":"https://api.github.com/users/digrich/repos","events_url":"https://api.github.com/users/digrich/events{/privacy}","received_events_url":"https://api.github.com/users/digrich/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":451588686,"node_id":"MDU6TGFiZWw0NTE1ODg2ODY=","url":"https://api.github.com/repos/fastify/fastify/labels/bug","name":"bug","color":"ee0701","default":true,"description":"Confirmed bug"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2018-12-29T01:00:29Z","updated_at":"2019-01-03T09:22:49Z","closed_at":"2019-01-02T18:42:38Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## ðŸ› Bug Report\r\n\r\nIn my case, the browser is not able to parse response cookies correctly.  When I set multiple cookies, following line of 'Reply.header' function is combining the cookies into one header ('set-cookie') with comma separated cookies. \r\n\r\n```\r\nthis._headers[_key] = [this._headers[_key]].concat(value)\r\n````\r\nChrome browser is not able to parse all cookies except the first one. \r\n\r\n## To Reproduce\r\n\r\nI am using fastify-http-proxy and in beforeHandler, trying to set multiple cookies on reply like \r\n\r\n```\r\nreply.setCookie(\"cookie1\", \"\", {httpOnly: true})\r\nreply.setCookie(\"cookie2\", \"\", {httpOnly: true})\r\nreply.setCookie(\"cookie3\", \"\", {httpOnly: true})\r\nreply.setCookie(\"cookie4\", \"\", {httpOnly: true})\r\n\r\n```\r\n\r\n## Expected behavior\r\n\r\nNot sure if it's a bug but it seems we should have multiple header entries for each cookie if we are calling Reply.header multiple times for setting the cookies.\r\n\r\nMore details are given in this link.\r\nhttps://stackoverflow.com/questions/11533867/set-cookie-header-with-multiple-cookies\r\n\r\nThis may fix the issue.\r\n\r\n```\r\nthis._headers[_key] = this._headers[_key].concat(value)\r\n````\r\n\r\n## Your Environment\r\n\r\n- *node version*: 8.9.1\r\n- *fastify version*: >=1.13.0\r\n- *os*: Mac\r\n- *browser*: Chrome: 71.0.3578.98\r\n\r\ncc @jsumners  as he submitted the PR and made changes to this area.\r\nhttps://github.com/fastify/fastify/issues/834\r\n","closed_by":{"login":"mcollina","id":52195,"node_id":"MDQ6VXNlcjUyMTk1","avatar_url":"https://avatars.githubusercontent.com/u/52195?v=4","gravatar_id":"","url":"https://api.github.com/users/mcollina","html_url":"https://github.com/mcollina","followers_url":"https://api.github.com/users/mcollina/followers","following_url":"https://api.github.com/users/mcollina/following{/other_user}","gists_url":"https://api.github.com/users/mcollina/gists{/gist_id}","starred_url":"https://api.github.com/users/mcollina/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mcollina/subscriptions","organizations_url":"https://api.github.com/users/mcollina/orgs","repos_url":"https://api.github.com/users/mcollina/repos","events_url":"https://api.github.com/users/mcollina/events{/privacy}","received_events_url":"https://api.github.com/users/mcollina/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/fastify/fastify/issues/1358/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/fastify/fastify/issues/1358/timeline","performed_via_github_app":null,"state_reason":"completed"}