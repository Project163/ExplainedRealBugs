diff --git a/src/test/java/org/apache/hadoop/mrunit/TestMapReduceDriver.java b/src/test/java/org/apache/hadoop/mrunit/TestMapReduceDriver.java
index f3b3ec9..c35711f 100644
--- a/src/test/java/org/apache/hadoop/mrunit/TestMapReduceDriver.java
+++ b/src/test/java/org/apache/hadoop/mrunit/TestMapReduceDriver.java
@@ -395,6 +395,20 @@ public class TestMapReduceDriver {
       .runTest();
   }
 
+  public static final RawComparator<Integer> INTEGER_COMPARATOR = new RawComparator<Integer>() {
+
+    @Override
+    public int compare(Integer o1, Integer o2) {
+      return o1.compareTo(o2);
+    }
+
+    @Override
+    public int compare(byte[] b1, int s1, int l1, byte[] b2, int s2, int l2) {
+      throw new UnsupportedOperationException();
+    }
+
+  };
+
   @Test
   public void testJavaSerialization() {
     final Configuration conf = new Configuration();
@@ -404,8 +418,9 @@ public class TestMapReduceDriver {
         .newMapReduceDriver(new IdentityMapper<Integer, IntWritable>(),
             new IdentityReducer<Integer, IntWritable>())
         .withConfiguration(conf);
-    driver.addInput(1, new IntWritable(2));
-    driver.addOutput(1, new IntWritable(2));
+    driver.withKeyGroupingComparator(INTEGER_COMPARATOR);
+    driver.withInput(1, new IntWritable(2)).withInput(2, new IntWritable(3));
+    driver.withOutput(1, new IntWritable(2)).withOutput(2, new IntWritable(3));
     driver.runTest();
   }
 
diff --git a/src/test/java/org/apache/hadoop/mrunit/TestPipelineMapReduceDriver.java b/src/test/java/org/apache/hadoop/mrunit/TestPipelineMapReduceDriver.java
index a1e5a2a..41f04a7 100644
--- a/src/test/java/org/apache/hadoop/mrunit/TestPipelineMapReduceDriver.java
+++ b/src/test/java/org/apache/hadoop/mrunit/TestPipelineMapReduceDriver.java
@@ -21,10 +21,10 @@ import java.io.IOException;
 import java.util.ArrayList;
 import java.util.List;
 
-import org.apache.hadoop.conf.Configuration;
 import org.apache.hadoop.io.IntWritable;
 import org.apache.hadoop.io.LongWritable;
 import org.apache.hadoop.io.Text;
+import org.apache.hadoop.mapred.JobConf;
 import org.apache.hadoop.mapred.Mapper;
 import org.apache.hadoop.mapred.Reducer;
 import org.apache.hadoop.mapred.lib.IdentityMapper;
@@ -191,9 +191,11 @@ public class TestPipelineMapReduceDriver {
 
   @Test
   public void testJavaSerialization() {
-    final Configuration conf = new Configuration();
+    final JobConf conf = new JobConf();
     conf.setStrings("io.serializations", conf.get("io.serializations"),
         "org.apache.hadoop.io.serializer.JavaSerialization");
+    conf.setOutputValueGroupingComparator(TestMapReduceDriver.INTEGER_COMPARATOR
+        .getClass());
     final PipelineMapReduceDriver<Integer, IntWritable, Integer, IntWritable> driver = PipelineMapReduceDriver
         .newPipelineMapReduceDriver();
     driver.addMapReduce(new IdentityMapper<Integer, IntWritable>(),
@@ -202,8 +204,8 @@ public class TestPipelineMapReduceDriver {
         new IdentityReducer<Integer, IntWritable>());
     driver.withConfiguration(conf);
 
-    driver.addInput(1, new IntWritable(2));
-    driver.addOutput(1, new IntWritable(2));
+    driver.withInput(1, new IntWritable(2)).withInput(2, new IntWritable(3));
+    driver.withOutput(1, new IntWritable(2)).withOutput(2, new IntWritable(3));
     driver.runTest();
   }
 
diff --git a/src/test/java/org/apache/hadoop/mrunit/mapreduce/TestMapReduceDriver.java b/src/test/java/org/apache/hadoop/mrunit/mapreduce/TestMapReduceDriver.java
index f4b810e..7de675a 100644
--- a/src/test/java/org/apache/hadoop/mrunit/mapreduce/TestMapReduceDriver.java
+++ b/src/test/java/org/apache/hadoop/mrunit/mapreduce/TestMapReduceDriver.java
@@ -403,7 +403,10 @@ public class TestMapReduceDriver {
     final MapReduceDriver<IntWritable, Integer, Integer, IntWritable, Integer, IntWritable> driver = MapReduceDriver
         .newMapReduceDriver(new InverseMapper<IntWritable, Integer>(),
             new IntSumReducer<Integer>()).withConfiguration(conf);
-    driver.withInput(new IntWritable(1), 2).withOutput(2, new IntWritable(1))
+    driver
+        .setKeyGroupingComparator(org.apache.hadoop.mrunit.TestMapReduceDriver.INTEGER_COMPARATOR);
+    driver.withInput(new IntWritable(1), 2).withInput(new IntWritable(2), 3);
+    driver.withOutput(2, new IntWritable(1)).withOutput(3, new IntWritable(2))
         .runTest();
   }
 }
