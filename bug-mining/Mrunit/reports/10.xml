<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:41:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[MRUNIT-70] copy(orig, conf) in Serialization shouldn&apos;t require objects to have a no-args constructor, and copy(orig, copy, conf) seems to violate contract for deserializer.deserialize()</title>
                <link>https://issues.apache.org/jira/browse/MRUNIT-70</link>
                <project id="12311292" key="MRUNIT">MRUnit</project>
                    <description>&lt;p&gt;The copy(orig, conf) method requires objects to have a no-args constructor, which is non-ideal, since it passes on to Deserializer.deserialize, which can create a new object if passed in null. Additionally, the contract for deserialize only &lt;em&gt;can&lt;/em&gt; fill in the object passed in, so the copy method will not perform as expected if it does not.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://hadoop.apache.org/common/docs/current/api/org/apache/hadoop/io/serializer/Deserializer.html#deserialize%28T%29&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hadoop.apache.org/common/docs/current/api/org/apache/hadoop/io/serializer/Deserializer.html#deserialize%28T%29&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12544443">MRUNIT-70</key>
            <summary>copy(orig, conf) in Serialization shouldn&apos;t require objects to have a no-args constructor, and copy(orig, copy, conf) seems to violate contract for deserializer.deserialize()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jdonofrio">Jim Donofrio</assignee>
                                    <reporter username="meloss2k">Meloss Xeloss</reporter>
                        <labels>
                    </labels>
                <created>Tue, 28 Feb 2012 15:53:33 +0000</created>
                <updated>Tue, 7 Aug 2012 06:55:09 +0000</updated>
                            <resolved>Sat, 10 Mar 2012 05:22:53 +0000</resolved>
                                    <version>0.8.0</version>
                                    <fixVersion>0.9.0</fixVersion>
                                        <due></due>
                            <votes>2</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13218302" author="brocknoland" created="Tue, 28 Feb 2012 16:10:40 +0000"  >&lt;p&gt;Writables must have a default constructor because they are created via reflection. WritableSerialization, the class, does the same thing we do via ReflectionUtils. Are you not using Writables?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://svn.apache.org/repos/asf/hadoop/common/branches/branch-1/src/core/org/apache/hadoop/io/serializer/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/repos/asf/hadoop/common/branches/branch-1/src/core/org/apache/hadoop/io/serializer/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13218305" author="brocknoland" created="Tue, 28 Feb 2012 16:14:33 +0000"  >&lt;p&gt;Yes I do think this is a bug. I am guessing you are using JavaSerialization?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://svn.apache.org/repos/asf/hadoop/common/branches/branch-1/src/core/org/apache/hadoop/io/serializer/JavaSerialization.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/repos/asf/hadoop/common/branches/branch-1/src/core/org/apache/hadoop/io/serializer/JavaSerialization.java&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13218308" author="meloss2k" created="Tue, 28 Feb 2012 16:15:59 +0000"  >&lt;p&gt;Implemented a Serialization and passing it it via &quot;io.serializations&quot; in a Configuration, and as you correctly inferred, I&apos;m not using a Writable.&lt;/p&gt;</comment>
                            <comment id="13218314" author="brocknoland" created="Tue, 28 Feb 2012 16:21:47 +0000"  >&lt;p&gt;OK, looks like a fairly easy fix. We basically shouldn&apos;t be calling ReflectionUtils and should return whatever deserialize returns. If anyone creates a patch, please post it. Otherwise I should have time tomorrow.&lt;/p&gt;</comment>
                            <comment id="13226044" author="goir" created="Fri, 9 Mar 2012 12:45:02 +0000"  >&lt;p&gt;We&apos;re using Hadoop with Cassandra. &lt;br/&gt;
This requires to use ByteBuffer objects for the key as return values from the Reducer. The ByteBuffer doesnt have a empty Constructor so we get the following exception.&lt;/p&gt;

&lt;p&gt;java.lang.RuntimeException: java.lang.NoSuchMethodException: java.nio.HeapByteBuffer.&amp;lt;init&amp;gt;()&lt;br/&gt;
        at org.apache.hadoop.util.ReflectionUtils.newInstance(ReflectionUtils.java:115)&lt;br/&gt;
        at org.apache.hadoop.mrunit.mock.MockOutputCollector.getInstance(MockOutputCollector.java:62)&lt;br/&gt;
        at org.apache.hadoop.mrunit.mock.MockOutputCollector.deepCopy(MockOutputCollector.java:73)&lt;br/&gt;
        at org.apache.hadoop.mrunit.mock.MockOutputCollector.collect(MockOutputCollector.java:110)&lt;br/&gt;
        at org.apache.hadoop.mrunit.mapreduce.mock.MockReduceContextWrapper$MockReduceContext.write(MockReduceContextWrapper.java:204)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;is there any patch yet ?&lt;/p&gt;</comment>
                            <comment id="13226088" author="jdonofrio" created="Fri, 9 Mar 2012 14:19:19 +0000"  >&lt;p&gt;I uploaded a patch, is this what you had in mind Brock?&lt;/p&gt;

&lt;p&gt;If so I will commit this later&lt;/p&gt;</comment>
                            <comment id="13226111" author="goir" created="Fri, 9 Mar 2012 14:45:06 +0000"  >&lt;p&gt;I&apos;m getting&lt;br/&gt;
12/03/09 15:39:57 INFO junit.TestRunner: java.lang.NullPointerException&lt;br/&gt;
        at org.apache.hadoop.io.serializer.SerializationFactory.getSerializer(SerializationFactory.java:73)&lt;br/&gt;
        at org.apache.hadoop.mrunit.Serialization.copy(Serialization.java:42)&lt;br/&gt;
        at org.apache.hadoop.mrunit.Serialization.copy(Serialization.java:61)&lt;br/&gt;
        at org.apache.hadoop.mrunit.mapreduce.mock.MockContextWrapper$4.answer(MockContextWrapper.java:74)&lt;br/&gt;
        at org.mockito.internal.stubbing.StubbedInvocationMatcher.answer(StubbedInvocationMatcher.java:29)&lt;br/&gt;
        at org.mockito.internal.MockHandler.handle(MockHandler.java:95)&lt;br/&gt;
        at org.mockito.internal.creation.MethodInterceptorFilter.intercept(MethodInterceptorFilter.java:47)&lt;br/&gt;
        at org.apache.hadoop.mapreduce.Reducer$Context$$EnhancerByMockitoWithCGLIB$$2bef43d9.write(&amp;lt;generated&amp;gt;)&lt;/p&gt;

&lt;p&gt;since copy is still &quot;null&quot; on line 51 in Serialization.java ?!&lt;br/&gt;
But i have no idea how to fix it.&lt;/p&gt;</comment>
                            <comment id="13226127" author="goir" created="Fri, 9 Mar 2012 15:20:11 +0000"  >&lt;p&gt;I&apos;ve changes you test to use a ByteBuffer. Which throws the NullPointerException.&lt;/p&gt;

&lt;p&gt;public void testClassWithoutNoArgConstructor() &lt;/p&gt;
{
    Configuration conf = new Configuration();
    conf.setStrings(&quot;io.serializations&quot;, &quot;org.apache.hadoop.io.serializer.JavaSerialization&quot;);
    ByteBuffer bb1 = ByteBuffer.allocate(1);
    bb1.put((byte)0xFF);
    ByteBuffer bb2 = ByteBuffer.allocate(1);
    bb2.put((byte)0xFF);
    assertEquals(bb1, Serialization.copy(bb2, conf));
  }</comment>
                            <comment id="13226621" author="jdonofrio" created="Sat, 10 Mar 2012 00:13:32 +0000"  >&lt;p&gt;I am not familiar with Cassandra at all but you need to specify a different serialization since ByteBuffer does not implement Serializable. I think the patch is correct but I dont understand the other comment &quot;the contract for deserialize only &lt;em&gt;can&lt;/em&gt; fill in the object passed in, so the copy method will not perform as expected if it does not&quot;&lt;/p&gt;</comment>
                            <comment id="13226756" author="jdonofrio" created="Sat, 10 Mar 2012 04:49:50 +0000"  >&lt;p&gt;Ok I get it now, the contract for deserialize states that &quot;If the object t is non-null then this deserializer may set its internal state to the next object read from the input stream. &quot; So the deserialize method may still return a new object instead of changing the state if the object passed in. WritableSerialization changes the state of the non null object passed in. JavaSerialization ignores the object passed in and always return a new object. &lt;/p&gt;

&lt;p&gt;    public T deserialize(T object) throws IOException {&lt;br/&gt;
      try &lt;/p&gt;
{
        // ignore passed-in object
        return (T) ois.readObject();
      }
&lt;p&gt; catch (ClassNotFoundException e) &lt;/p&gt;
{
        throw new IOException(e.toString());
      }
&lt;p&gt;    }&lt;/p&gt;</comment>
                            <comment id="13226757" author="jdonofrio" created="Sat, 10 Mar 2012 05:22:54 +0000"  >&lt;p&gt;added javadoc on Serialization class methods&lt;br/&gt;
change copy(orig, copy, conf) to allow null for copy which means to create a new object&lt;br/&gt;
change copy(orig, conf) to not use ReflectionUtils but to pass in null to copy(orig, copy, conf)&lt;br/&gt;
acknowledge in javadoc that depending on the serialization class, copy may or may not copy orig into copy&lt;br/&gt;
return the result of deserialize since depending on serialization class, copy may or may not copy orig into copy&lt;/p&gt;

&lt;p&gt;committed in 1299150&lt;/p&gt;</comment>
                            <comment id="13226759" author="jdonofrio" created="Sat, 10 Mar 2012 05:24:13 +0000"  >&lt;p&gt;I dont consider the failure of ByteBuffer to be mrunit&apos;s problem, there should be a serialization class that you can set in io.serializations to get ByteBuffer to work&lt;/p&gt;</comment>
                            <comment id="13226774" author="brocknoland" created="Sat, 10 Mar 2012 06:08:49 +0000"  >&lt;p&gt;LGTM!  Thank you Jim!&lt;/p&gt;

&lt;p&gt;Also, yes I agree, I think to serialize a BB you&apos;d need to set  io.serializations.&lt;/p&gt;</comment>
                            <comment id="13429948" author="tarunadiwal" created="Tue, 7 Aug 2012 05:51:23 +0000"  >&lt;p&gt;Hi Jim,&lt;/p&gt;

&lt;p&gt;I have just upgrade from mrunit-0.8.0 to mrunit 0.9.0. I have following code in my reducer:&lt;/p&gt;

&lt;p&gt;context.write( null, new Text( key.toString().trim() +&quot;_&quot; + value.toString() ) );&lt;/p&gt;

&lt;p&gt;when I run my test the above code throws NullPointerException. The full stacktrace is given below :&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
	at org.apache.hadoop.mrunit.Serialization.copy(Serialization.java:52)&lt;br/&gt;
	at org.apache.hadoop.mrunit.Serialization.copy(Serialization.java:81)&lt;br/&gt;
	at org.apache.hadoop.mrunit.mapreduce.mock.MockContextWrapper$4.answer(MockContextWrapper.java:78)&lt;br/&gt;
	at org.mockito.internal.stubbing.StubbedInvocationMatcher.answer(StubbedInvocationMatcher.java:31)&lt;br/&gt;
	at org.mockito.internal.MockHandler.handle(MockHandler.java:97)&lt;br/&gt;
	at org.mockito.internal.creation.MethodInterceptorFilter.intercept(MethodInterceptorFilter.java:47)&lt;br/&gt;
	at org.apache.hadoop.mapreduce.Reducer$Context$$EnhancerByMockitoWithCGLIB$$fd46c1a7.write(&amp;lt;generated&amp;gt;)&lt;/p&gt;

&lt;p&gt;As you said &amp;#8211;&lt;br/&gt;
change copy(orig, copy, conf) to allow null for copy which means to create a new object&lt;br/&gt;
But I think when I am passing null to the context.write() method it is not creating a new object but giving NullPointerException at org.apache.hadoop.mrunit.Serialization.copy(Serialization.java:52).&lt;br/&gt;
Can you please suggest.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Tarun&lt;/p&gt;</comment>
                            <comment id="13429975" author="jdonofrio" created="Tue, 7 Aug 2012 06:55:09 +0000"  >&lt;p&gt;Yes this is a bug, I did not think about the case where you want to pass null as a key or value which some output formats such as TextOutputFormat allow. Please open a JIRA for this problem, thanks for reporting this&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12517719" name="MRUNIT-70-1.patch" size="3698" author="jdonofrio" created="Fri, 9 Mar 2012 14:19:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>229680</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 15 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0y7xj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>197754</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>