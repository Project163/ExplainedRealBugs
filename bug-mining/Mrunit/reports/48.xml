<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:41:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[MRUNIT-197] Problems using Avro with MRUnit</title>
                <link>https://issues.apache.org/jira/browse/MRUNIT-197</link>
                <project id="12311292" key="MRUNIT">MRUnit</project>
                    <description>&lt;p&gt;I&apos;m not able to use MRUnit with Avro in a particular use case.  See the exception below.  I&apos;ve attached a sample test that demonstrates the problem.&lt;/p&gt;

&lt;p&gt;When the input is just a plain integer it works fine.  However if the input is a record that contains an integer it doesn&apos;t work.  I stepped through the code with a debugger to try understanding what is going on.  In the Serialization class&apos;s copy method, the serializer it gets on this line is wrong:&lt;/p&gt;

&lt;p&gt;serializer = (Serializer&amp;lt;Object&amp;gt;) serializationFactory&lt;br/&gt;
          .getSerializer(clazz);&lt;/p&gt;

&lt;p&gt;When I look at the schema within this object is is &quot;int&quot; instead of the record&apos;s schema.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.ClassCastException: org.apache.avro.generic.GenericData$Record cannot be cast to java.lang.Number
	at org.apache.avro.generic.GenericDatumWriter.write(GenericDatumWriter.java:78)
	at org.apache.avro.reflect.ReflectDatumWriter.write(ReflectDatumWriter.java:104)
	at org.apache.avro.generic.GenericDatumWriter.write(GenericDatumWriter.java:58)
	at org.apache.avro.hadoop.io.AvroSerializer.serialize(AvroSerializer.java:104)
	at org.apache.avro.hadoop.io.AvroSerializer.serialize(AvroSerializer.java:46)
	at org.apache.hadoop.mrunit.internal.io.Serialization.copy(Serialization.java:74)
	at org.apache.hadoop.mrunit.internal.io.Serialization.copy(Serialization.java:91)
	at org.apache.hadoop.mrunit.internal.io.Serialization.copyWithConf(Serialization.java:104)
	at org.apache.hadoop.mrunit.TestDriver.copy(TestDriver.java:608)
	at org.apache.hadoop.mrunit.TestDriver.copyPair(TestDriver.java:612)
	at org.apache.hadoop.mrunit.MapDriverBase.addInput(MapDriverBase.java:118)
	at org.apache.hadoop.mrunit.MapDriverBase.withInput(MapDriverBase.java:207)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12688369">MRUNIT-197</key>
            <summary>Problems using Avro with MRUnit</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ndalsass">Nicolas Dalsass</assignee>
                                    <reporter username="mhayes">Matthew Hayes</reporter>
                        <labels>
                    </labels>
                <created>Sat, 11 Jan 2014 01:16:31 +0000</created>
                <updated>Mon, 15 Dec 2014 22:30:31 +0000</updated>
                            <resolved>Mon, 15 Dec 2014 22:21:18 +0000</resolved>
                                    <version>1.0.0</version>
                                    <fixVersion>1.2.0</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14138722" author="ndalsass" created="Thu, 18 Sep 2014 09:31:26 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;There&apos;s currently another bug when using Avro objects with MrUnit, which prevents them to be used at all. The problem is in Serialization : Avro internally uses a proxy before the outputBuffer (an encoder), and only writes to the buffer when the encoder is closed.&lt;/p&gt;

&lt;p&gt;This patch for the serializer closing before reading the outputBuffer again, which fixes the problem for Avro, without I think affecting other serializations. (I checked with classic Hadoop Serialization)&lt;/p&gt;</comment>
                            <comment id="14247326" author="brocknoland" created="Mon, 15 Dec 2014 22:18:35 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14247352" author="hudson" created="Mon, 15 Dec 2014 22:30:31 +0000"  >&lt;p&gt;FAILURE: Integrated in mrunit-trunk #1125 (See &lt;a href=&quot;https://builds.apache.org/job/mrunit-trunk/1125/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/mrunit-trunk/1125/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/MRUNIT-197&quot; title=&quot;Problems using Avro with MRUnit&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MRUNIT-197&quot;&gt;&lt;del&gt;MRUNIT-197&lt;/del&gt;&lt;/a&gt; - Problems using Avro with MRUnit (Nicolas Dalsass via Brock) (brock: rev daab87917264a1c4092aa960cd86abe90593694e)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;src/main/java/org/apache/hadoop/mrunit/internal/io/Serialization.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12622477" name="MemberEventCountUnitTest.java" size="3890" author="mhayes" created="Sat, 11 Jan 2014 01:18:41 +0000"/>
                            <attachment id="12669684" name="fix_avro_serialization.patch" size="1152" author="ndalsass" created="Thu, 18 Sep 2014 09:31:26 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>367388</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 48 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1rbrr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>367697</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>