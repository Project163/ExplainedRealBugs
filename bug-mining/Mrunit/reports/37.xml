<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:41:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[MRUNIT-129] Key object re-use in Reducer is inconsistent with MapReduce behaviour (new API)</title>
                <link>https://issues.apache.org/jira/browse/MRUNIT-129</link>
                <project id="12311292" key="MRUNIT">MRUnit</project>
                    <description>&lt;p&gt;Follow on issue from &lt;a href=&quot;https://issues.apache.org/jira/browse/MRUNIT-127&quot; title=&quot;Key grouping with GroupingComparators is not consistent with MapReduce behaviour&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MRUNIT-127&quot;&gt;&lt;del&gt;MRUNIT-127&lt;/del&gt;&lt;/a&gt;, also relating to grouping comparators. &lt;/p&gt;

&lt;p&gt;In the new MapReduce API Reducer&apos;s reduce method, you are passed a reference to a key and an Iterable for the values. What&apos;s not particularly clear is that as you iterate through the values, the value of the key is also changing silently. This is not usually noticeable, since the keys that were grouped often have the same value anyway, but with a custom grouping comparator this isn&apos;t necessarily the case. &lt;/p&gt;

&lt;p&gt;This is different to the old API, where you would get the first key in the group and this wouldn&apos;t change as you iterate over the values. &lt;/p&gt;

&lt;p&gt;MRUnit uses the &quot;old API&quot; style behaviour for both old and new APIs, so some unit tests may not give a consistent result to an actual mapreduce job. &lt;/p&gt;
</description>
                <environment></environment>
        <key id="12601368">MRUNIT-129</key>
            <summary>Key object re-use in Reducer is inconsistent with MapReduce behaviour (new API)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paulin sanselme">Paulin Sanselme</assignee>
                                    <reporter username="dbeech">Dave Beech</reporter>
                        <labels>
                    </labels>
                <created>Fri, 3 Aug 2012 13:00:44 +0000</created>
                <updated>Tue, 4 Jun 2013 06:41:39 +0000</updated>
                            <resolved>Tue, 4 Jun 2013 02:48:34 +0000</resolved>
                                    <version>0.9.0</version>
                                    <fixVersion>1.1.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13428689" author="dbeech" created="Sat, 4 Aug 2012 22:19:32 +0000"  >&lt;p&gt;Uploaded a patch with a failing unit test which demonstrates this problem. &lt;/p&gt;</comment>
                            <comment id="13619997" author="paulin sanselme" created="Tue, 2 Apr 2013 16:58:41 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
I&apos;ve done a patch to fix this issue.&lt;/p&gt;

&lt;p&gt;I&apos;ve generated the patch from trunk-hadoop1 branch.&lt;/p&gt;

&lt;p&gt;To summarize :&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;The reducer inputs are now List&amp;lt;KeyValueReuseList&amp;lt;K,V&amp;gt;&amp;gt;.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;KeyValueReuseList&amp;lt;K,V&amp;gt; is a List&amp;lt;Pair&amp;lt;K,V&amp;gt;&amp;gt; which provide an Iterator&amp;lt;V&amp;gt; with the right behaviour (instance reuse + silent key update).&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I&apos;ve add a ReduceFeeder class mainly used to do the sorting and grouping of entries (map outputs).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Paulin&lt;/p&gt;</comment>
                            <comment id="13620990" author="brocknoland" created="Wed, 3 Apr 2013 15:17:24 +0000"  >&lt;p&gt;It&apos;s odd your patch is not showing up... I just made you a contributor, can you try again?&lt;/p&gt;</comment>
                            <comment id="13621035" author="paulin sanselme" created="Wed, 3 Apr 2013 16:40:51 +0000"  >&lt;p&gt;I&apos;ve updated it with some javadoc and more UT. It should be ok now.&lt;/p&gt;</comment>
                            <comment id="13622387" author="brocknoland" created="Thu, 4 Apr 2013 14:52:00 +0000"  >&lt;p&gt;Ok, it&apos;s a big patch but most of it looks like tests. Unless someone else has time to review, I&apos;ll give it a try next week.&lt;/p&gt;</comment>
                            <comment id="13638898" author="paulin sanselme" created="Tue, 23 Apr 2013 09:14:09 +0000"  >&lt;p&gt;Did you have some time to review this patch ? Does it need some changes ?&lt;/p&gt;</comment>
                            <comment id="13662938" author="paulin sanselme" created="Tue, 21 May 2013 12:37:56 +0000"  >&lt;p&gt;It seems not many people are interested in this wrong behavior of mrunit.&lt;/p&gt;</comment>
                            <comment id="13662947" author="brocknoland" created="Tue, 21 May 2013 12:50:10 +0000"  >&lt;p&gt;Hey,&lt;/p&gt;

&lt;p&gt;In the ReduceDriver should the methods updateInput and sortAndGroup be public?&lt;/p&gt;</comment>
                            <comment id="13662975" author="paulin sanselme" created="Tue, 21 May 2013 13:45:33 +0000"  >&lt;p&gt;updateInput ans sortAndGroup are methods of ReduceFeeder.&lt;/p&gt;

&lt;p&gt;ReduceFeeder provides methods for producing easily some reducer inputs in the new format.&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;updateInput is used internally to keep compatibility with the old way of using mrunit. It is public to provide an easy way to update tests where we have only one key and multiple values.&lt;/li&gt;
	&lt;li&gt;sortAndGroup is used internally in MapReduceDriver to sort and group the map outputs before giving them to the reducer. It is public to provide an easy way of testing a Reducer alone with more complex inputs.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13662986" author="brocknoland" created="Tue, 21 May 2013 13:59:24 +0000"  >&lt;p&gt;OK I see. It looks good to me! I&apos;ll wait a day or so to see if anyone else has feedback.&lt;/p&gt;</comment>
                            <comment id="13673973" author="brocknoland" created="Tue, 4 Jun 2013 02:48:34 +0000"  >&lt;p&gt;Thanks for the patch Paul! I commited this to trunk and trunk-hadoop1.&lt;/p&gt;</comment>
                            <comment id="13674113" author="hudson" created="Tue, 4 Jun 2013 06:41:39 +0000"  >&lt;p&gt;Integrated in mrunit-trunk #881 (See &lt;a href=&quot;https://builds.apache.org/job/mrunit-trunk/881/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/mrunit-trunk/881/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/MRUNIT-129&quot; title=&quot;Key object re-use in Reducer is inconsistent with MapReduce behaviour (new API)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MRUNIT-129&quot;&gt;&lt;del&gt;MRUNIT-129&lt;/del&gt;&lt;/a&gt;: Key object re-use in Reducer is inconsistent with MapReduce behaviour (new API) (Revision 08bbdfd5295e617f956f31937976f7b75ed60378)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
brock : &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=mrunit.git&amp;amp;a=commit&amp;amp;h=08bbdfd5295e617f956f31937976f7b75ed60378&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=mrunit.git&amp;amp;a=commit&amp;amp;h=08bbdfd5295e617f956f31937976f7b75ed60378&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;src/main/java/org/apache/hadoop/mrunit/mapreduce/ReduceDriver.java&lt;/li&gt;
	&lt;li&gt;src/test/java/org/apache/hadoop/mrunit/mapreduce/TestReducerInputValueReuse.java&lt;/li&gt;
	&lt;li&gt;src/test/java/org/apache/hadoop/mrunit/mapreduce/TestReduceDriver.java&lt;/li&gt;
	&lt;li&gt;src/test/java/org/apache/hadoop/mrunit/mapreduce/TestReduceFeeder.java&lt;/li&gt;
	&lt;li&gt;src/test/java/org/apache/hadoop/mrunit/mapreduce/TestMapReduceDriver.java&lt;/li&gt;
	&lt;li&gt;src/main/java/org/apache/hadoop/mrunit/types/KeyValueReuseList.java&lt;/li&gt;
	&lt;li&gt;src/main/java/org/apache/hadoop/mrunit/mapreduce/ReduceFeeder.java&lt;/li&gt;
	&lt;li&gt;src/main/java/org/apache/hadoop/mrunit/mapreduce/MapReduceDriver.java&lt;/li&gt;
	&lt;li&gt;src/main/java/org/apache/hadoop/mrunit/TestDriver.java&lt;/li&gt;
	&lt;li&gt;src/test/java/org/apache/hadoop/mrunit/internal/util/TestStringUtils.java&lt;/li&gt;
	&lt;li&gt;src/main/java/org/apache/hadoop/mrunit/internal/mapreduce/MockReduceContextWrapper.java&lt;/li&gt;
	&lt;li&gt;src/test/java/org/apache/hadoop/mrunit/types/TestKeyValueReuseList.java&lt;/li&gt;
	&lt;li&gt;src/main/java/org/apache/hadoop/mrunit/internal/util/StringUtils.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12576805" name="JIRA_129.patch" size="56511" author="paulin sanselme" created="Wed, 3 Apr 2013 16:36:58 +0000"/>
                            <attachment id="12539163" name="MRUNIT-129.unittest.patch" size="3597" author="dbeech" created="Sat, 4 Aug 2012 22:19:32 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>308749</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 24 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1cry7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>282659</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>