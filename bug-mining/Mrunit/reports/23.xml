<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:41:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[MRUNIT-126] Counter tests are ignored if test is executed using run() rather than runTest()</title>
                <link>https://issues.apache.org/jira/browse/MRUNIT-126</link>
                <project id="12311292" key="MRUNIT">MRUnit</project>
                    <description>&lt;p&gt;An alternative way of running an mrunit test is to call run(), which returns the output list to you for manual validation, rather than runTest() which validates everything automatically. &lt;/p&gt;

&lt;p&gt;If you run a test using the run() method, any counter tests you have specified via withCounter(..) etc are silently ignored, which may falsely give the impression that these tests have passed. &lt;/p&gt;

&lt;p&gt;At the very least we should give a warning that this is happening. Otherwise, we should make sure the counter validation is triggered in all cases. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12600640">MRUNIT-126</key>
            <summary>Counter tests are ignored if test is executed using run() rather than runTest()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dbeech">Dave Beech</assignee>
                                    <reporter username="dbeech">Dave Beech</reporter>
                        <labels>
                    </labels>
                <created>Mon, 30 Jul 2012 11:06:25 +0000</created>
                <updated>Tue, 31 Jul 2012 21:07:36 +0000</updated>
                            <resolved>Tue, 31 Jul 2012 21:07:36 +0000</resolved>
                                    <version>0.9.0</version>
                                    <fixVersion>1.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13424810" author="bdechoux" created="Mon, 30 Jul 2012 12:11:15 +0000"  >&lt;p&gt;My understanding of run() is that, when using it, all assertions/tests should be done by the user. If we mix the behaviour with runTest() the usage would be less coherent.&lt;/p&gt;

&lt;p&gt;A warning is a good idea but for me it should be an exception for an illegal use of the API. A warning is something that won&apos;t be necessary impact the user.&lt;br/&gt;
It is nice to put a warning when something is migrating : &quot;warning this method will be removed&quot; but that&apos;s not the case here.&lt;/p&gt;

&lt;p&gt;Of course it means that existent tests may break when the users of mrunit will migrate to the newer versions.&lt;br/&gt;
But this is actually a good thing because it means that they would know which test were &apos;nice but useless&apos;.&lt;/p&gt;</comment>
                            <comment id="13424815" author="dbeech" created="Mon, 30 Jul 2012 12:22:29 +0000"  >&lt;p&gt;Thanks Bertrand. You are right, and I see your point, but for me the difference is that when you call run(), you are given the outputs as the return value which in effect says &quot;here, now do something with this&quot;. So it&apos;s more obvious to the user what to do with the outputs than with the counters.  &lt;/p&gt;

&lt;p&gt;A possible (but incompatible) change would be to wrap the outputs and counters together into an object called &quot;TestResult&quot; or &quot;TestOutcome&quot; which exposes the outputs and counters through getter methods. &lt;/p&gt;

&lt;p&gt;e.g. TestResult result = driver.withInput(...).withOutput(...).run();&lt;br/&gt;
List&amp;lt;Pair&amp;lt;K,V&amp;gt;&amp;gt; outputs = result.getOutputs();&lt;br/&gt;
Counters counters = result.getCounters();&lt;/p&gt;

&lt;p&gt;Any thoughts?&lt;/p&gt;
</comment>
                            <comment id="13424821" author="dbeech" created="Mon, 30 Jul 2012 12:38:45 +0000"  >&lt;p&gt;A &quot;TestResult&quot; object approach might also be useful for &lt;a href=&quot;https://issues.apache.org/jira/browse/MRUNIT-13&quot; title=&quot;Add support for MultipleOutputs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MRUNIT-13&quot;&gt;&lt;del&gt;MRUNIT-13&lt;/del&gt;&lt;/a&gt; (MultipleOutputs), since the result object can expose the named outputs in a similar way:&lt;/p&gt;

&lt;p&gt;List&amp;lt;Pair&amp;lt;K,V&amp;gt;&amp;gt; outputs = result.getOutputs(); &lt;br/&gt;
List&amp;lt;Pair&amp;lt;K,V&amp;gt;&amp;gt; outputs = result.getNamedOutputs(&quot;my_multiple_outputter&quot;); &lt;/p&gt;</comment>
                            <comment id="13424926" author="jarcec" created="Mon, 30 Jul 2012 15:44:11 +0000"  >&lt;p&gt;Having TestResult class make complete sense to me and it might be even beneficial for the future additions (if there will be any of course).&lt;/p&gt;

&lt;p&gt;My only concerns is backward compatibility. I see the point of breaking the API (as user is actually missing the counters entirely), but even thought, I&apos;m not sure that it&apos;s completely good idea :-/ Are we still planning to do big changes in near future (that will break a lot of the API?)&lt;/p&gt;

&lt;p&gt;Jarcec&lt;/p&gt;</comment>
                            <comment id="13424930" author="brocknoland" created="Mon, 30 Jul 2012 15:46:27 +0000"  >&lt;p&gt;I think the plan is to introduce a new API in &lt;a href=&quot;https://issues.apache.org/jira/browse/MRUNIT-69&quot; title=&quot;new mrunit api&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MRUNIT-69&quot;&gt;MRUNIT-69&lt;/a&gt; which is easier to use and more modern while keeping this API stable.&lt;/p&gt;</comment>
                            <comment id="13424934" author="dbeech" created="Mon, 30 Jul 2012 15:49:02 +0000"  >&lt;p&gt;I think so. &lt;a href=&quot;https://issues.apache.org/jira/browse/MRUNIT-69&quot; title=&quot;new mrunit api&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MRUNIT-69&quot;&gt;MRUNIT-69&lt;/a&gt; is still open, that&apos;s the umbrella task for a new API. I haven&apos;t been involved in that work to date - maybe Brock or Jim can update on progress?&lt;/p&gt;</comment>
                            <comment id="13424935" author="dbeech" created="Mon, 30 Jul 2012 15:49:50 +0000"  >&lt;p&gt;Brock was too quick for me &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13424936" author="jarcec" created="Mon, 30 Jul 2012 15:53:18 +0000"  >&lt;p&gt;Does it make sense to do this change only in new API?&lt;/p&gt;

&lt;p&gt;Jarcec&lt;/p&gt;
</comment>
                            <comment id="13425251" author="dbeech" created="Mon, 30 Jul 2012 21:20:09 +0000"  >&lt;p&gt;I guess so, if the plan is to keep the current API stable. It would be quite a large change. &lt;/p&gt;</comment>
                            <comment id="13425726" author="jdonofrio" created="Tue, 31 Jul 2012 12:44:23 +0000"  >&lt;p&gt;There hasnt been much progress on &lt;a href=&quot;https://issues.apache.org/jira/browse/MRUNIT-69&quot; title=&quot;new mrunit api&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MRUNIT-69&quot;&gt;MRUNIT-69&lt;/a&gt;. I think we should continue to add features to the old API and once we are happy with that we can design a cleaner API vs trying to squeeze these features in later. I am interested to hear others thoguhts but I think we should get to a point where we can accept just a jobconf or job and read all the configuration values out of there as hadoop does instead of having specific methods to add mapper classes or comparators, etc. We should not allow users to create the mapper or comparator, they should simply tell us the class and we will create them as hadoop does. If we just accept a jobconf or job we can easily support users passing in a tool class so that we can fully test driver code. We will still need the typical methods to add inputs, outputs, counters&lt;/p&gt;</comment>
                            <comment id="13425728" author="jdonofrio" created="Tue, 31 Jul 2012 12:47:49 +0000"  >&lt;p&gt;I have always tought of run() as being the manual assert method. Users can use getCounters to then manually verfiy counters&lt;/p&gt;</comment>
                            <comment id="13425735" author="dbeech" created="Tue, 31 Jul 2012 12:58:31 +0000"  >&lt;p&gt;What if you want to just do some manual assertions on your outputs but don&apos;t want the hassle of duplicating counter verification code? &lt;/p&gt;

&lt;p&gt;After all, the counter assertions are quite simple - I can&apos;t think of many cases where the default counter verification wouldn&apos;t be good enough. But I do use the run() method fairly frequently when I have custom writables but don&apos;t want to do full object equality checks for my tests to pass/fail. &lt;/p&gt;</comment>
                            <comment id="13425740" author="jdonofrio" created="Tue, 31 Jul 2012 13:08:46 +0000"  >&lt;p&gt;That true that the default counter verification should be god enough but sometimes you dont care about counters, verifying the output is good enough. I guess you could add an another run method called runWithCounters or something that would be the same as run but also check counters&lt;/p&gt;</comment>
                            <comment id="13425744" author="dbeech" created="Tue, 31 Jul 2012 13:15:30 +0000"  >&lt;p&gt;Well, true, but if you don&apos;t care about the counters I&apos;d expect you not to have specified any counter conditions using withCounter etc. &lt;/p&gt;

&lt;p&gt;How about this for a solution?&lt;br/&gt;
Instead of adding a new method, we could add a boolean parameter verifyCounters to the current run method, which you will set to say whether or not you want the automatic counter verification code to run. &lt;/p&gt;

&lt;p&gt;The no-arg run method would delegate to run(false) to preserve current behaviour. &lt;/p&gt;
</comment>
                            <comment id="13425836" author="jarcec" created="Tue, 31 Jul 2012 15:12:02 +0000"  >&lt;p&gt;@Dave: I like your suggestion. It&apos;s solving this JIRA without breaking compatibility. I&apos;m +1 on this one.&lt;/p&gt;

&lt;p&gt;Jarcec&lt;/p&gt;</comment>
                            <comment id="13425902" author="dbeech" created="Tue, 31 Jul 2012 16:30:07 +0000"  >&lt;p&gt;I&apos;ve knocked up a quick patch for this. &lt;/p&gt;

&lt;p&gt;I&apos;d like your opinion on an unrelated change I&apos;ve made at the same time. I realised the runTest() methods are being duplicated in all the *DriverBase methods, differing only by the debug logging at the top. &lt;/p&gt;

&lt;p&gt;So, I&apos;ve moved the actual runTest code into TestDriver and made a protected method which gets overridden and does the debug logging in each individual subclass. &lt;/p&gt;

&lt;p&gt;If there are good reasons not to do this, I can revert and still make the necessary change to resolve this JIRA without it. &lt;/p&gt;</comment>
                            <comment id="13426128" author="dbeech" created="Tue, 31 Jul 2012 21:07:36 +0000"  >&lt;p&gt;I&apos;ve committed the patch in 1367781. Let me know if there are any issues. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12508486">MRUNIT-13</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12538570" name="MRUNIT-126.patch" size="7267" author="dbeech" created="Tue, 31 Jul 2012 16:30:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>294556</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 16 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0y6gf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>197515</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>