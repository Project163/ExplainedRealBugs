{"url":"https://api.github.com/repos/Homebrew/brew/issues/12293","repository_url":"https://api.github.com/repos/Homebrew/brew","labels_url":"https://api.github.com/repos/Homebrew/brew/issues/12293/labels{/name}","comments_url":"https://api.github.com/repos/Homebrew/brew/issues/12293/comments","events_url":"https://api.github.com/repos/Homebrew/brew/issues/12293/events","html_url":"https://github.com/Homebrew/brew/issues/12293","id":1032953864,"node_id":"I_kwDOAyxcHc49kaAI","number":12293,"title":"Using Homebrew on linux overwrites /dev/null with a file (from curl wrapper)","user":{"login":"brphelps","id":10023676,"node_id":"MDQ6VXNlcjEwMDIzNjc2","avatar_url":"https://avatars.githubusercontent.com/u/10023676?v=4","gravatar_id":"","url":"https://api.github.com/users/brphelps","html_url":"https://github.com/brphelps","followers_url":"https://api.github.com/users/brphelps/followers","following_url":"https://api.github.com/users/brphelps/following{/other_user}","gists_url":"https://api.github.com/users/brphelps/gists{/gist_id}","starred_url":"https://api.github.com/users/brphelps/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brphelps/subscriptions","organizations_url":"https://api.github.com/users/brphelps/orgs","repos_url":"https://api.github.com/users/brphelps/repos","events_url":"https://api.github.com/users/brphelps/events{/privacy}","received_events_url":"https://api.github.com/users/brphelps/received_events","type":"User","user_view_type":"public","site_admin":true},"labels":[{"id":922544989,"node_id":"MDU6TGFiZWw5MjI1NDQ5ODk=","url":"https://api.github.com/repos/Homebrew/brew/labels/outdated","name":"outdated","color":"d93f0b","default":false,"description":"PR was locked due to age"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2021-10-21T21:23:35Z","updated_at":"2021-11-21T00:04:06Z","closed_at":"2021-10-21T23:49:25Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### `brew config` output\r\n\r\n```shell\r\nHOMEBREW_VERSION: 3.2.17-dirty\r\nORIGIN: https://github.com/Homebrew/brew\r\nHEAD: 556b8f16c6f8518404330780d153fd245b801325\r\nLast commit: 3 days ago\r\nCore tap ORIGIN: https://github.com/Homebrew/homebrew-core\r\nCore tap HEAD: 8360bd47399323eebc9bb12b66cc764ecc0dd475\r\nCore tap last commit: 69 minutes ago\r\nCore tap branch: master\r\nHOMEBREW_PREFIX: /home/linuxbrew/.linuxbrew\r\nHOMEBREW_BROWSER: /vscode/bin/linux-x64/c13f1abb110fc756f9b3a6f16670df9cd9d4cf63/bin/helpers/browser.sh\r\nHOMEBREW_CASK_OPTS: []\r\nHOMEBREW_MAKE_JOBS: 16\r\nHomebrew Ruby: 2.6.3 => /home/linuxbrew/.linuxbrew/Homebrew/Library/Homebrew/vendor/portable-ruby/2.6.3_2/bin/ruby\r\nCPU: 16-core 64-bit skylake\r\nClang: N/A\r\nGit: 2.30.2 => /usr/bin/git\r\nCurl: 7.74.0 => LIBRARY AND CURL\r\n/home/linuxbrew/.linuxbrew/Homebrew/Library\r\ncurl\r\n/usr/bin/curl\r\nKernel: Linux 5.4.0-1059-azure x86_64 GNU/Linux\r\nOS: Debian GNU/Linux 11 (bullseye) (bullseye)\r\nHost glibc: 2.31\r\n/usr/bin/gcc: 10.2.1\r\n/usr/bin/ruby: 2.7.4\r\nglibc: N/A\r\ngcc@5: N/A\r\nxorg: N/A\r\n```\r\n\r\n\r\n### `brew doctor` output\r\n\r\n```shell\r\nYour system is ready to brew.\r\n```\r\n\r\n\r\n### \r\n\r\n- [X] I ran `brew update` and am still able to reproduce my issue.\r\n- [X] I have resolved all warnings from `brew doctor` and that did not fix my problem.\r\n\r\n### What were you trying to do (and why)?\r\n\r\nIf you run `brew info wget` you will see /dev/null get overwritten with a file. \r\n\r\n### What happened (include all command output)?\r\n\r\n`brew info wget`\r\n\r\nBefore: \r\n`0 crw-rw-rw-  1 root root      1,   3 Oct 21 21:20 null`\r\n\r\nAfter:\r\n`0 -rw-r--r--  1 root root           0 Oct 21 21:20 null`\r\n\r\n/dev/null getting overwritten affects other scripts in insidious ways. For instance, tmux stops working after this happens. \r\n\r\n### What did you expect to happen?\r\n\r\n/dev/null not to be affected at all. \r\n\r\n### Step-by-step reproduction instructions (by running `brew` commands)\r\n\r\n```shell\r\nbrew info wget\r\nls -sal /dev | grep null \r\n```\r\nor \r\n```shell\r\nHOMEBREW_LIBRARY=/home/linuxbrew/.linuxbrew/Homebrew/Library /home/linuxbrew/.linuxbrew/Homebrew/Library/Homebrew/shims/shared/curl --disable --cookie-jar /dev/null --globoff --show-error --user-agent \"Linuxbrew/3.2.17-dirty (Linux; x86_64 Debian GNU/Linux 11 (bullseye)) curl/7.74.0\" --header \"Accept-Language: en\" --max-time 5 --retry 3 --fail https://formulae.brew.sh/api/formula-linux/wget.json\r\nls -sal /dev | grep null\r\n```\r\nI root caused this specifically to the part of Homebrew that is invoking their custom curl version. I set up a file watcher on /dev/null, ex:\r\n```shell\r\ninotifywait -m /dev -e create -e moved_to |\r\n    while read dir action file; do\r\n        echo \"The file '$file' appeared in directory '$dir' via '$action'\"\r\n        cat $dir$file\r\n    done\r\n```\r\n\r\nWith that watcher active, running `brew info wget` will report a \"move_to\" operation that replaces /dev/null with the output of the curl command, basically the cookie output of the call. \r\n","closed_by":{"login":"Bo98","id":1190754,"node_id":"MDQ6VXNlcjExOTA3NTQ=","avatar_url":"https://avatars.githubusercontent.com/u/1190754?v=4","gravatar_id":"","url":"https://api.github.com/users/Bo98","html_url":"https://github.com/Bo98","followers_url":"https://api.github.com/users/Bo98/followers","following_url":"https://api.github.com/users/Bo98/following{/other_user}","gists_url":"https://api.github.com/users/Bo98/gists{/gist_id}","starred_url":"https://api.github.com/users/Bo98/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Bo98/subscriptions","organizations_url":"https://api.github.com/users/Bo98/orgs","repos_url":"https://api.github.com/users/Bo98/repos","events_url":"https://api.github.com/users/Bo98/events{/privacy}","received_events_url":"https://api.github.com/users/Bo98/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/Homebrew/brew/issues/12293/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/Homebrew/brew/issues/12293/timeline","performed_via_github_app":null,"state_reason":"completed"}