{"url":"https://api.github.com/repos/Homebrew/brew/issues/15802","repository_url":"https://api.github.com/repos/Homebrew/brew","labels_url":"https://api.github.com/repos/Homebrew/brew/issues/15802/labels{/name}","comments_url":"https://api.github.com/repos/Homebrew/brew/issues/15802/comments","events_url":"https://api.github.com/repos/Homebrew/brew/issues/15802/events","html_url":"https://github.com/Homebrew/brew/issues/15802","id":1831957987,"node_id":"I_kwDOAyxcHc5tMXXj","number":15802,"title":"macOS .pkg installer fails to detect Xcode if it's on another volume","user":{"login":"misterfifths","id":1193940,"node_id":"MDQ6VXNlcjExOTM5NDA=","avatar_url":"https://avatars.githubusercontent.com/u/1193940?v=4","gravatar_id":"","url":"https://api.github.com/users/misterfifths","html_url":"https://github.com/misterfifths","followers_url":"https://api.github.com/users/misterfifths/followers","following_url":"https://api.github.com/users/misterfifths/following{/other_user}","gists_url":"https://api.github.com/users/misterfifths/gists{/gist_id}","starred_url":"https://api.github.com/users/misterfifths/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/misterfifths/subscriptions","organizations_url":"https://api.github.com/users/misterfifths/orgs","repos_url":"https://api.github.com/users/misterfifths/repos","events_url":"https://api.github.com/users/misterfifths/events{/privacy}","received_events_url":"https://api.github.com/users/misterfifths/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":922544989,"node_id":"MDU6TGFiZWw5MjI1NDQ5ODk=","url":"https://api.github.com/repos/Homebrew/brew/labels/outdated","name":"outdated","color":"d93f0b","default":false,"description":"PR was locked due to age"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":13,"created_at":"2023-08-01T20:09:04Z","updated_at":"2023-09-03T00:06:23Z","closed_at":"2023-08-03T11:21:22Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### `brew doctor` output\r\n\r\n```shell\r\nN/A, this issue is with the new .pkg installer.\r\n```\r\n\r\n\r\n### Verification\r\n\r\n- [X] My \"`brew doctor` output\" above says `Your system is ready to brew.` and am still able to reproduce my issue.\r\n- [X] I ran `brew update` twice and am still able to reproduce my issue.\r\n- [X] This issue's title and/or description do not reference a single formula e.g. `brew install wget`. If they do, open an issue at https://github.com/Homebrew/homebrew-core/issues/new/choose instead.\r\n\r\n### `brew config` output\r\n\r\n```shell\r\nN/A\r\n```\r\n\r\n\r\n### What were you trying to do (and why)?\r\n\r\nInstall Homebrew on macOS using the .pkg installer. This seems to reproduce on the latest versions of Monterey and Ventura, as well as beta 4 of Sonoma.\r\n\r\n### What happened (include all command output)?\r\n\r\nThe `fileExistsAtPath` call in [`installation-check` script in Distribution.xml](https://github.com/Homebrew/brew/blob/799417343a5176d710f7330d46ca0732e4b75637/package/Distribution.xml#L35) fails if the path is on another volume. In my case, /Applications/Xcode.app was a symlink to another volume (and I didn't have the CLTs installed), so the installer was convinced that it couldn't proceed.\r\n\r\nThis output is generated in /private/var/log/install.log:\r\n\r\n```\r\nInstaller[63009]: IFJS: Package Authoring Error: access to path \"/Applications/Xcode.app/Contents/Developer/usr/bin/git\" requires <options allow-external-scripts='true'>\r\n```\r\n\r\nAdding that option to the Distribution.xml file does indeed fix the issue, but it results in this ominous warning from `productbuild`:\r\n\r\n```\r\nproductbuild: [WARNING]: Specifying [allow-external-scripts='true'] is deprecated.\r\n           Having this in your distribution will break the installability\r\n           of this product in an upcoming release of macOS.\r\n           Apple reserves the right to reject notarization of any product with this option.\r\n```\r\n\r\nI believe that this is an Apple bug. `allow-external-scripts` [as documented](https://developer.apple.com/library/archive/documentation/DeveloperTools/Reference/DistributionDefinitionRef/Chapters/Distribution_XML_Ref.html#//apple_ref/doc/uid/TP40005370-CH100-SW41) has nothing to do with checking file existence, only running arbitrary executables through the JS interface. I filed FB12823044 with Apple.\r\n\r\nIn the meantime, perhaps adding `allow-external-scripts` is an option? I'm not sure if Apple is actually rejecting such packages at notarization time. On the other hand, maybe this is too niche of a circumstance to worry about.\r\n\r\n### What did you expect to happen?\r\n\r\nThe installer should detect an Xcode or CLT install even if it's a symlink to another volume.\r\n\r\n### Step-by-step reproduction instructions (by running `brew` commands)\r\n\r\n1. Make sure you do not have the CLTs installed, or the installation-check script will detect them first and not encounter this error.\r\n2. Symlink /Applications/Xcode.app to an app on another volume.\r\n3. Open the .pkg installer and immediately see a dialog for the fatal error (and the \"Package Authoring Error\" in install.log).\r\n\r\n(Alternatively you could symlink /Library/Developer/CommandLineTools to another volume instead of Xcode.app. Or just the `git` file that the script is checking. Any path that winds up on another volume seems to trigger this error.)\r\n","closed_by":{"login":"MikeMcQuaid","id":125011,"node_id":"MDQ6VXNlcjEyNTAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/125011?v=4","gravatar_id":"","url":"https://api.github.com/users/MikeMcQuaid","html_url":"https://github.com/MikeMcQuaid","followers_url":"https://api.github.com/users/MikeMcQuaid/followers","following_url":"https://api.github.com/users/MikeMcQuaid/following{/other_user}","gists_url":"https://api.github.com/users/MikeMcQuaid/gists{/gist_id}","starred_url":"https://api.github.com/users/MikeMcQuaid/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MikeMcQuaid/subscriptions","organizations_url":"https://api.github.com/users/MikeMcQuaid/orgs","repos_url":"https://api.github.com/users/MikeMcQuaid/repos","events_url":"https://api.github.com/users/MikeMcQuaid/events{/privacy}","received_events_url":"https://api.github.com/users/MikeMcQuaid/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/Homebrew/brew/issues/15802/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/Homebrew/brew/issues/15802/timeline","performed_via_github_app":null,"state_reason":"completed"}