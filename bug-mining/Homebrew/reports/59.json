{"url":"https://api.github.com/repos/Homebrew/brew/issues/15302","repository_url":"https://api.github.com/repos/Homebrew/brew","labels_url":"https://api.github.com/repos/Homebrew/brew/issues/15302/labels{/name}","comments_url":"https://api.github.com/repos/Homebrew/brew/issues/15302/comments","events_url":"https://api.github.com/repos/Homebrew/brew/issues/15302/events","html_url":"https://github.com/Homebrew/brew/issues/15302","id":1681830777,"node_id":"I_kwDOAyxcHc5kPrN5","number":15302,"title":"Installing cached bottles now requires an Internet connection after #15117","user":{"login":"boblail","id":151907,"node_id":"MDQ6VXNlcjE1MTkwNw==","avatar_url":"https://avatars.githubusercontent.com/u/151907?v=4","gravatar_id":"","url":"https://api.github.com/users/boblail","html_url":"https://github.com/boblail","followers_url":"https://api.github.com/users/boblail/followers","following_url":"https://api.github.com/users/boblail/following{/other_user}","gists_url":"https://api.github.com/users/boblail/gists{/gist_id}","starred_url":"https://api.github.com/users/boblail/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/boblail/subscriptions","organizations_url":"https://api.github.com/users/boblail/orgs","repos_url":"https://api.github.com/users/boblail/repos","events_url":"https://api.github.com/users/boblail/events{/privacy}","received_events_url":"https://api.github.com/users/boblail/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":922544989,"node_id":"MDU6TGFiZWw5MjI1NDQ5ODk=","url":"https://api.github.com/repos/Homebrew/brew/labels/outdated","name":"outdated","color":"d93f0b","default":false,"description":"PR was locked due to age"}],"state":"closed","locked":true,"assignee":{"login":"boblail","id":151907,"node_id":"MDQ6VXNlcjE1MTkwNw==","avatar_url":"https://avatars.githubusercontent.com/u/151907?v=4","gravatar_id":"","url":"https://api.github.com/users/boblail","html_url":"https://github.com/boblail","followers_url":"https://api.github.com/users/boblail/followers","following_url":"https://api.github.com/users/boblail/following{/other_user}","gists_url":"https://api.github.com/users/boblail/gists{/gist_id}","starred_url":"https://api.github.com/users/boblail/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/boblail/subscriptions","organizations_url":"https://api.github.com/users/boblail/orgs","repos_url":"https://api.github.com/users/boblail/repos","events_url":"https://api.github.com/users/boblail/events{/privacy}","received_events_url":"https://api.github.com/users/boblail/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"boblail","id":151907,"node_id":"MDQ6VXNlcjE1MTkwNw==","avatar_url":"https://avatars.githubusercontent.com/u/151907?v=4","gravatar_id":"","url":"https://api.github.com/users/boblail","html_url":"https://github.com/boblail","followers_url":"https://api.github.com/users/boblail/followers","following_url":"https://api.github.com/users/boblail/following{/other_user}","gists_url":"https://api.github.com/users/boblail/gists{/gist_id}","starred_url":"https://api.github.com/users/boblail/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/boblail/subscriptions","organizations_url":"https://api.github.com/users/boblail/orgs","repos_url":"https://api.github.com/users/boblail/repos","events_url":"https://api.github.com/users/boblail/events{/privacy}","received_events_url":"https://api.github.com/users/boblail/received_events","type":"User","user_view_type":"public","site_admin":false},{"login":"reitermarkus","id":1309829,"node_id":"MDQ6VXNlcjEzMDk4Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/1309829?v=4","gravatar_id":"","url":"https://api.github.com/users/reitermarkus","html_url":"https://github.com/reitermarkus","followers_url":"https://api.github.com/users/reitermarkus/followers","following_url":"https://api.github.com/users/reitermarkus/following{/other_user}","gists_url":"https://api.github.com/users/reitermarkus/gists{/gist_id}","starred_url":"https://api.github.com/users/reitermarkus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/reitermarkus/subscriptions","organizations_url":"https://api.github.com/users/reitermarkus/orgs","repos_url":"https://api.github.com/users/reitermarkus/repos","events_url":"https://api.github.com/users/reitermarkus/events{/privacy}","received_events_url":"https://api.github.com/users/reitermarkus/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":3,"created_at":"2023-04-24T18:45:43Z","updated_at":"2023-05-26T00:06:24Z","closed_at":"2023-04-25T14:49:56Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### `brew doctor` output\r\n\r\n**NOTE:** This is the `brew doctor` output on my laptop (where I can reproduce the issue) but the `brew doctor` output on the CI machine is clear.\r\n\r\n```shell\r\nPlease note that these warnings are just used to help the Homebrew maintainers\r\nwith debugging if you file an issue. If everything you use Homebrew for is\r\nworking fine: please don't worry or file an issue; just ignore this. Thanks!\r\n\r\nWarning: Some installed kegs have no formulae!\r\nThis means they were either deleted or installed manually.\r\nYou should find replacements for the following formulae:\r\n  pycparser\r\n\r\nWarning: You have unlinked kegs in your Cellar.\r\nLeaving kegs unlinked can lead to build-trouble and cause formulae that depend on\r\nthose kegs to fail to run properly once built. Run `brew link` on these:\r\n  tcl-tk\r\n```\r\n\r\n\r\n### Verification\r\n\r\n- [X] My \"`brew doctor` output\" above says `Your system is ready to brew.` and am still able to reproduce my issue.\r\n- [X] I ran `brew update` twice and am still able to reproduce my issue.\r\n- [X] This issue's title and/or description do not reference a single formula e.g. `brew install wget`. If they do, open an issue at https://github.com/Homebrew/homebrew-core/issues/new/choose instead.\r\n\r\n### `brew config` output\r\n\r\n```shell\r\nHOMEBREW_VERSION: 4.0.15-10-g0841d1a\r\nORIGIN: https://github.com/Homebrew/brew\r\nHEAD: 0841d1a25ef06c1c68d2d28ee77979e81a8dccde\r\nLast commit: 2 hours ago\r\nCore tap origin: https://github.com/Homebrew/homebrew-core\r\nCore tap HEAD: deb1fd1f4212dfbfb26cd668d6aa49a17a3f9445\r\nCore tap last commit: 3 months ago\r\nCore tap branch: master\r\nCore tap JSON: 24 Apr 18:12 UTC\r\nHOMEBREW_PREFIX: /opt/homebrew\r\nHOMEBREW_CASK_OPTS: []\r\nHOMEBREW_MAKE_JOBS: 10\r\nHOMEBREW_NO_ANALYTICS: set\r\nHomebrew Ruby: 2.6.10 => /System/Library/Frameworks/Ruby.framework/Versions/2.6/usr/bin/ruby\r\nCPU: 10-core 64-bit arm_firestorm_icestorm\r\nClang: 14.0.3 build 1403\r\nGit: 2.39.1 => /opt/homebrew/bin/git\r\nCurl: 7.87.0 => /usr/bin/curl\r\nmacOS: 13.3.1-arm64\r\nCLT: 14.3.0.0.1.1679647830\r\nXcode: N/A\r\nRosetta 2: false\r\n```\r\n\r\n\r\n### What were you trying to do (and why)?\r\n\r\nWe have CI that tests a tool that installs bottled formulae from a private tap.\r\n\r\nThe CI doesn't have access to the private tap so we set it up with the bottles it should install by seeding the cache:\r\n```\r\ncp bottles/* $(brew --cache)/downloads\r\n```\r\n\r\nThen it just runs `brew install X Y Z`.\r\n\r\n\r\n### What happened (include all command output)?\r\n\r\nThis was working prior to #15117 and has now stopped working (presumably because of the addition of `result.assert_success!`).\r\n\r\nIt fails to use the cached location if `resolve_url_basename_time_file_size` fails.\r\n\r\n### What did you expect to happen?\r\n\r\nI expected it to be able to use the cached file.\r\n\r\nAfter all,\r\n1. [We use the cached bottle regardless of how the URL is resolved](https://github.com/Homebrew/brew/blob/0841d1a25ef06c1c68d2d28ee77979e81a8dccde/Library/Homebrew/download_strategy.rb#L422-L423)\r\n2. [We fail open when attempting to invalidate the cache by comparing the bottle's mtime to the URL's Last-Modified header](https://github.com/Homebrew/brew/blob/0841d1a25ef06c1c68d2d28ee77979e81a8dccde/Library/Homebrew/download_strategy.rb#L418-L419)\r\n\r\n### Step-by-step reproduction instructions (by running `brew` commands)\r\n\r\n```shell\r\nbrew uninstall socat\r\nbrew fetch socat --force-bottle\r\n# turn off Wi-Fi\r\nbrew install socat --force-bottle\r\n```\r\n","closed_by":{"login":"MikeMcQuaid","id":125011,"node_id":"MDQ6VXNlcjEyNTAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/125011?v=4","gravatar_id":"","url":"https://api.github.com/users/MikeMcQuaid","html_url":"https://github.com/MikeMcQuaid","followers_url":"https://api.github.com/users/MikeMcQuaid/followers","following_url":"https://api.github.com/users/MikeMcQuaid/following{/other_user}","gists_url":"https://api.github.com/users/MikeMcQuaid/gists{/gist_id}","starred_url":"https://api.github.com/users/MikeMcQuaid/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MikeMcQuaid/subscriptions","organizations_url":"https://api.github.com/users/MikeMcQuaid/orgs","repos_url":"https://api.github.com/users/MikeMcQuaid/repos","events_url":"https://api.github.com/users/MikeMcQuaid/events{/privacy}","received_events_url":"https://api.github.com/users/MikeMcQuaid/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/Homebrew/brew/issues/15302/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/Homebrew/brew/issues/15302/timeline","performed_via_github_app":null,"state_reason":"completed"}