{"url":"https://api.github.com/repos/Homebrew/brew/issues/13226","repository_url":"https://api.github.com/repos/Homebrew/brew","labels_url":"https://api.github.com/repos/Homebrew/brew/issues/13226/labels{/name}","comments_url":"https://api.github.com/repos/Homebrew/brew/issues/13226/comments","events_url":"https://api.github.com/repos/Homebrew/brew/issues/13226/events","html_url":"https://github.com/Homebrew/brew/issues/13226","id":1223050603,"node_id":"I_kwDOAyxcHc5I5kVr","number":13226,"title":"Support excluding Casks from HOMEBREW_ARTIFACT_DOMAIN coverage","user":{"login":"byjrack","id":26876044,"node_id":"MDQ6VXNlcjI2ODc2MDQ0","avatar_url":"https://avatars.githubusercontent.com/u/26876044?v=4","gravatar_id":"","url":"https://api.github.com/users/byjrack","html_url":"https://github.com/byjrack","followers_url":"https://api.github.com/users/byjrack/followers","following_url":"https://api.github.com/users/byjrack/following{/other_user}","gists_url":"https://api.github.com/users/byjrack/gists{/gist_id}","starred_url":"https://api.github.com/users/byjrack/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/byjrack/subscriptions","organizations_url":"https://api.github.com/users/byjrack/orgs","repos_url":"https://api.github.com/users/byjrack/repos","events_url":"https://api.github.com/users/byjrack/events{/privacy}","received_events_url":"https://api.github.com/users/byjrack/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":922544989,"node_id":"MDU6TGFiZWw5MjI1NDQ5ODk=","url":"https://api.github.com/repos/Homebrew/brew/labels/outdated","name":"outdated","color":"d93f0b","default":false,"description":"PR was locked due to age"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2022-05-02T15:52:18Z","updated_at":"2022-06-23T00:06:24Z","closed_at":"2022-05-23T12:09:48Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Provide a detailed description of the proposed feature\n\nHOMEBREW_ARTIFACT_DOMAIN allows the use of a forward proxy that supports URL prefixing to handle all payload download functionality for brew client as noted in the [manual Envrionment section](https://docs.brew.sh/Manpage#environment).  \r\n\r\nSome organizations use a cache mirror (e.g. JFrog Artifactory Remote) of the Packages attached to homebrew-core instead of a simple forward proxy by restricting to a URL.  This works without issue for Formulae/Bottles that are stored in GitHub Packages as the single source domain is switched out for the envvar content at download time.  Casks though will source the install payload from arbitrary internet sources as defined by the Cask author.  Since the source is not a single domain brew cannot just replace the domain with the ARTIFACT_DOMAIN content and instead prefixes the destination.  This will work if the ARTIFACT_DOMAIN target is a simple forward proxy that supports URL prefixing, but for a mirror it may fail if that mirror is restricted to a specific scope and protocol.\r\n\r\nAdding an additional HOMEBREW_ARTIFACT_DOMAIN_NO_CASK envvar boolean indicating the flow its use is adjusting and follows other \"opt out\" flags in the environment variables.\r\n\r\nhttps://github.com/orgs/Homebrew/discussions/3032 \r\nhttps://github.com/Homebrew/brew/issues/13222 \r\nhttps://github.com/Homebrew/brew/issues/12568 \n\n### What is the motivation for the feature?\n\nDesire to use HOMEBREW_ARTIFACT_DOMAIN to direct users to an internal GitHub Packages cache for homebrew-core which supports our mirror cache solution (JFrog Artifactory) while not influencing the download flow for Cask payloads as that requires supporting arbitrary internet destinations which a cache may not be able to support.\r\n\r\nCurrently users have to do install/updates using the envvar and then unset the var to do an install/update of Casks.\n\n### How will the feature be relevant to at least 90% of Homebrew users?\n\nSo there is a significant number of Homebrew users in organizations that require some registry controls and security checks for applications that are being used in the firm.  I am not 100% sure it would be 90% of users, but it's a reasonable size community.  So gating brew through a system like Artifactory adds some insight, but leaving the arbitrary destinations to standard User Access proxies that are managed by other teams.\n\n### What alternatives to the feature have been considered?\n\nAttempts have been made to leverage Git repo cloning (to localize the Formulae) combined with HOMEBREW_BOTTLE_DOMAIN, but with limited success using them effectively together.  And BOTTLE seemed to be up in the air on if it would be deprecated so wasn't sure if it would be around in the future.","closed_by":{"login":"byjrack","id":26876044,"node_id":"MDQ6VXNlcjI2ODc2MDQ0","avatar_url":"https://avatars.githubusercontent.com/u/26876044?v=4","gravatar_id":"","url":"https://api.github.com/users/byjrack","html_url":"https://github.com/byjrack","followers_url":"https://api.github.com/users/byjrack/followers","following_url":"https://api.github.com/users/byjrack/following{/other_user}","gists_url":"https://api.github.com/users/byjrack/gists{/gist_id}","starred_url":"https://api.github.com/users/byjrack/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/byjrack/subscriptions","organizations_url":"https://api.github.com/users/byjrack/orgs","repos_url":"https://api.github.com/users/byjrack/repos","events_url":"https://api.github.com/users/byjrack/events{/privacy}","received_events_url":"https://api.github.com/users/byjrack/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/Homebrew/brew/issues/13226/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/Homebrew/brew/issues/13226/timeline","performed_via_github_app":null,"state_reason":"completed"}