{"url":"https://api.github.com/repos/Homebrew/brew/issues/14541","repository_url":"https://api.github.com/repos/Homebrew/brew","labels_url":"https://api.github.com/repos/Homebrew/brew/issues/14541/labels{/name}","comments_url":"https://api.github.com/repos/Homebrew/brew/issues/14541/comments","events_url":"https://api.github.com/repos/Homebrew/brew/issues/14541/events","html_url":"https://github.com/Homebrew/brew/issues/14541","id":1574130062,"node_id":"I_kwDOAyxcHc5d01GO","number":14541,"title":"`brew info --json=v2 --cask â€¦` either crashes or prints incorrect output if the cask has preflight/postflight artifacts defined using a \"do\" block","user":{"login":"dpoon","id":260080,"node_id":"MDQ6VXNlcjI2MDA4MA==","avatar_url":"https://avatars.githubusercontent.com/u/260080?v=4","gravatar_id":"","url":"https://api.github.com/users/dpoon","html_url":"https://github.com/dpoon","followers_url":"https://api.github.com/users/dpoon/followers","following_url":"https://api.github.com/users/dpoon/following{/other_user}","gists_url":"https://api.github.com/users/dpoon/gists{/gist_id}","starred_url":"https://api.github.com/users/dpoon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dpoon/subscriptions","organizations_url":"https://api.github.com/users/dpoon/orgs","repos_url":"https://api.github.com/users/dpoon/repos","events_url":"https://api.github.com/users/dpoon/events{/privacy}","received_events_url":"https://api.github.com/users/dpoon/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":922544989,"node_id":"MDU6TGFiZWw5MjI1NDQ5ODk=","url":"https://api.github.com/repos/Homebrew/brew/labels/outdated","name":"outdated","color":"d93f0b","default":false,"description":"PR was locked due to age"}],"state":"closed","locked":true,"assignee":{"login":"MikeMcQuaid","id":125011,"node_id":"MDQ6VXNlcjEyNTAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/125011?v=4","gravatar_id":"","url":"https://api.github.com/users/MikeMcQuaid","html_url":"https://github.com/MikeMcQuaid","followers_url":"https://api.github.com/users/MikeMcQuaid/followers","following_url":"https://api.github.com/users/MikeMcQuaid/following{/other_user}","gists_url":"https://api.github.com/users/MikeMcQuaid/gists{/gist_id}","starred_url":"https://api.github.com/users/MikeMcQuaid/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MikeMcQuaid/subscriptions","organizations_url":"https://api.github.com/users/MikeMcQuaid/orgs","repos_url":"https://api.github.com/users/MikeMcQuaid/repos","events_url":"https://api.github.com/users/MikeMcQuaid/events{/privacy}","received_events_url":"https://api.github.com/users/MikeMcQuaid/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"MikeMcQuaid","id":125011,"node_id":"MDQ6VXNlcjEyNTAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/125011?v=4","gravatar_id":"","url":"https://api.github.com/users/MikeMcQuaid","html_url":"https://github.com/MikeMcQuaid","followers_url":"https://api.github.com/users/MikeMcQuaid/followers","following_url":"https://api.github.com/users/MikeMcQuaid/following{/other_user}","gists_url":"https://api.github.com/users/MikeMcQuaid/gists{/gist_id}","starred_url":"https://api.github.com/users/MikeMcQuaid/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MikeMcQuaid/subscriptions","organizations_url":"https://api.github.com/users/MikeMcQuaid/orgs","repos_url":"https://api.github.com/users/MikeMcQuaid/repos","events_url":"https://api.github.com/users/MikeMcQuaid/events{/privacy}","received_events_url":"https://api.github.com/users/MikeMcQuaid/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":2,"created_at":"2023-02-07T11:08:21Z","updated_at":"2023-03-10T00:07:14Z","closed_at":"2023-02-07T14:32:51Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### `brew doctor` output\n\n```shell\n$ brew doctor\r\nYour system is ready to brew.\n```\n\n\n### Verification\n\n- [X] My \"`brew doctor` output\" above says `Your system is ready to brew.` and am still able to reproduce my issue.\n- [X] I ran `brew update` twice and am still able to reproduce my issue.\n- [X] This issue's title and/or description do not reference a single formula e.g. `brew install wget`. If they do, open an issue at https://github.com/Homebrew/homebrew-core/issues/new/choose instead.\n\n### `brew config` output\n\n```shell\n$ brew config\r\nHOMEBREW_VERSION: 3.6.20-298-g8fdf6ac\r\nORIGIN: https://github.com/Homebrew/brew\r\nHEAD: 8fdf6aca11f685641c9b886c0b48462088d23505\r\nLast commit: 3 hours ago\r\nCore tap origin: https://github.com/Homebrew/homebrew-core\r\nCore tap HEAD: 01c9ef11804758fdbbbb58ff16511b51dde9b34b\r\nCore tap last commit: 9 days ago\r\nCore tap branch: master\r\nCore tap JSON: 07 Feb 09:23 UTC\r\nHOMEBREW_PREFIX: /opt/homebrew\r\nHOMEBREW_CASK_OPTS: [\"--no-quarantine\"]\r\nHOMEBREW_DISPLAY: /private/tmp/com.apple.launchd.ahYI4vQ3nQ/org.xquartz:0\r\nHOMEBREW_EDITOR: vim\r\nHOMEBREW_MAKE_JOBS: 10\r\nHomebrew Ruby: 2.6.8 => /opt/homebrew/Library/Homebrew/vendor/portable-ruby/2.6.8_1/bin/ruby\r\nCPU: 10-core 64-bit arm_firestorm_icestorm\r\nClang: 14.0.0 build 1400\r\nGit: 2.39.1 => /opt/homebrew/bin/git\r\nCurl: 7.79.1 => /usr/bin/curl\r\nmacOS: 12.6-arm64\r\nCLT: 14.0.0.0.1.1661618636\r\nXcode: 14.2\r\nRosetta 2: false\n```\n\n\n### What were you trying to do (and why)?\n\nTrying to run `brew info --json=v2` on some casks.\n\n### What happened (include all command output)?\n\nCrash when querying gimp:\r\n\r\n```console\r\n$ brew info --debug --json=v2 --cask gimp\r\n/opt/homebrew/Library/Homebrew/shims/shared/curl --disable --cookie /dev/null --globoff --user-agent Homebrew/3.6.20-298-g8fdf6ac\\ \\(Macintosh\\;\\ arm64\\ Mac\\ OS\\ X\\ 12.6\\)\\ curl/7.79.1 --header Accept-Language:\\ en --fail --progress-bar --max-time 10 --location --remote-time --output /Users/dpoon/Library/Caches/Homebrew/api/cask.json --time-cond /Users/dpoon/Library/Caches/Homebrew/api/cask.json --compressed --silent https://formulae.brew.sh/api/cask.json\r\n/opt/homebrew/Library/Homebrew/brew.rb (Cask::CaskLoader::FromAPILoader): loading gimp\r\n/opt/homebrew/Library/Homebrew/shims/shared/curl --disable --cookie /dev/null --globoff --show-error --user-agent Homebrew/3.6.20-298-g8fdf6ac\\ \\(Macintosh\\;\\ arm64\\ Mac\\ OS\\ X\\ 12.6\\)\\ curl/7.79.1 --header Accept-Language:\\ en --retry 3 --fail https://raw.githubusercontent.com/Homebrew/homebrew-cask/f24cc51f7b269619df1f8f847477ed63d5bbcaaa/Casks/gimp.rb\r\n/opt/homebrew/Library/Homebrew/brew.rb (Cask::CaskLoader::FromAPILoader): loading gimp\r\n/opt/homebrew/Library/Homebrew/brew.rb (Cask::CaskLoader::FromAPILoader): loading gimp\r\n/opt/homebrew/Library/Homebrew/brew.rb (Cask::CaskLoader::FromAPILoader): loading gimp\r\n/opt/homebrew/Library/Homebrew/brew.rb (Cask::CaskLoader::FromAPILoader): loading gimp\r\n/opt/homebrew/Library/Homebrew/brew.rb (Cask::CaskLoader::FromAPILoader): loading gimp\r\n/opt/homebrew/Library/Homebrew/brew.rb (Cask::CaskLoader::FromAPILoader): loading gimp\r\n/opt/homebrew/Library/Homebrew/brew.rb (Cask::CaskLoader::FromAPILoader): loading gimp\r\n/opt/homebrew/Library/Homebrew/brew.rb (Cask::CaskLoader::FromAPILoader): loading gimp\r\nError: Could not parse source for #<Proc:0x00000001041c4490@/opt/homebrew/Library/Homebrew/cask/cask_loader.rb:66>: (eval):2: syntax error, unexpected end, expecting end-of-input\r\n      end\r\n      ^~~\r\nPlease report this issue:\r\n  https://docs.brew.sh/Troubleshooting\r\n/opt/homebrew/Library/Homebrew/vendor/bundle/ruby/2.6.0/gems/method_source-1.0.0/lib/method_source.rb:29:in `rescue in source_helper'\r\n/opt/homebrew/Library/Homebrew/vendor/bundle/ruby/2.6.0/gems/method_source-1.0.0/lib/method_source.rb:23:in `source_helper'\r\n/opt/homebrew/Library/Homebrew/vendor/bundle/ruby/2.6.0/gems/method_source-1.0.0/lib/method_source.rb:110:in `source'\r\n/opt/homebrew/Library/Homebrew/cask/artifact/abstract_flight_block.rb:42:in `transform_values'\r\n/opt/homebrew/Library/Homebrew/cask/artifact/abstract_flight_block.rb:42:in `to_h'\r\n/opt/homebrew/Library/Homebrew/cask/cask.rb:300:in `block in artifacts_list'\r\n/opt/homebrew/Library/Homebrew/cask/artifact_set.rb:14:in `each'\r\n/opt/homebrew/Library/Homebrew/cask/artifact_set.rb:14:in `each'\r\n/opt/homebrew/Library/Homebrew/cask/cask.rb:297:in `map'\r\n/opt/homebrew/Library/Homebrew/cask/cask.rb:297:in `artifacts_list'\r\n/opt/homebrew/Library/Homebrew/cask/cask.rb:248:in `to_h'\r\n/opt/homebrew/Library/Homebrew/cmd/info.rb:243:in `map'\r\n/opt/homebrew/Library/Homebrew/cmd/info.rb:243:in `print_json'\r\n/opt/homebrew/Library/Homebrew/cmd/info.rb:117:in `info'\r\n/opt/homebrew/Library/Homebrew/brew.rb:93:in `<main>'\r\n```\r\n\r\n---\r\n\r\nIncorrect `preflight` when querying Chromium:\r\n\r\n```console\r\n$ brew info --debug --json=v2 --cask chromium | head -30\r\n/opt/homebrew/Library/Homebrew/shims/shared/curl --disable --cookie /dev/null --globoff --user-agent Homebrew/3.6.20-298-g8fdf6ac\\ \\(Macintosh\\;\\ arm64\\ Mac\\ OS\\ X\\ 12.6\\)\\ curl/7.79.1 --header Accept-Language:\\ en --fail --progress-bar --silent --max-time 10 --location --remote-time --output /Users/dpoon/Library/Caches/Homebrew/api/cask.json --time-cond /Users/dpoon/Library/Caches/Homebrew/api/cask.json --compressed --silent https://formulae.brew.sh/api/cask.json\r\n/opt/homebrew/Library/Homebrew/brew.rb (Cask::CaskLoader::FromAPILoader): loading chromium\r\n/opt/homebrew/Library/Homebrew/shims/shared/curl --disable --cookie /dev/null --globoff --show-error --user-agent Homebrew/3.6.20-298-g8fdf6ac\\ \\(Macintosh\\;\\ arm64\\ Mac\\ OS\\ X\\ 12.6\\)\\ curl/7.79.1 --header Accept-Language:\\ en --retry 3 --fail https://raw.githubusercontent.com/Homebrew/homebrew-cask/f24cc51f7b269619df1f8f847477ed63d5bbcaaa/Casks/chromium.rb\r\n/opt/homebrew/Library/Homebrew/brew.rb (Cask::CaskLoader::FromAPILoader): loading chromium\r\n/opt/homebrew/Library/Homebrew/brew.rb (Cask::CaskLoader::FromAPILoader): loading chromium\r\n/opt/homebrew/Library/Homebrew/brew.rb (Cask::CaskLoader::FromAPILoader): loading chromium\r\n/opt/homebrew/Library/Homebrew/brew.rb (Cask::CaskLoader::FromAPILoader): loading chromium\r\n/opt/homebrew/Library/Homebrew/brew.rb (Cask::CaskLoader::FromAPILoader): loading chromium\r\n/opt/homebrew/Library/Homebrew/brew.rb (Cask::CaskLoader::FromAPILoader): loading chromium\r\n/opt/homebrew/Library/Homebrew/brew.rb (Cask::CaskLoader::FromAPILoader): loading chromium\r\n/opt/homebrew/Library/Homebrew/brew.rb (Cask::CaskLoader::FromAPILoader): loading chromium\r\n{\r\n  \"formulae\": [\r\n\r\n  ],\r\n  \"casks\": [\r\n    {\r\n      \"token\": \"chromium\",\r\n      \"full_token\": \"chromium\",\r\n      \"tap\": null,\r\n      \"name\": [\r\n        \"Chromium\"\r\n      ],\r\n      \"desc\": \"Free and open-source web browser\",\r\n      \"homepage\": \"https://www.chromium.org/Home\",\r\n      \"url\": \"https://download-chromium.appspot.com/dl/Mac_Arm?type=snapshots\",\r\n      \"appcast\": null,\r\n      \"version\": \"latest\",\r\n      \"versions\": {\r\n      },\r\n      \"installed\": \"965870\",\r\n      \"outdated\": false,\r\n      \"sha256\": \"no_check\",\r\n      \"artifacts\": [\r\n        {\r\n          \"preflight\": \"        @token = path.basename(path.extname).to_s\\n\"\r\n        },\r\n        {\r\n          \"app\": [\r\n            \"chrome-mac/Chromium.app\"\r\n          ]\r\n```\n\n### What did you expect to happen?\n\nIt shouldn't crash, and it shouldn't report arbitrary code for preflight/postflight.\n\n### Step-by-step reproduction instructions (by running `brew` commands)\n\n```shell\n$ cd /opt/homebrew/Caskroom\r\n$ for cask in * ; do brew info --json=v2 --cask \"$cask\" >/dev/null 2>&1 || echo \"$cask\" ; done\n```\n","closed_by":{"login":"MikeMcQuaid","id":125011,"node_id":"MDQ6VXNlcjEyNTAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/125011?v=4","gravatar_id":"","url":"https://api.github.com/users/MikeMcQuaid","html_url":"https://github.com/MikeMcQuaid","followers_url":"https://api.github.com/users/MikeMcQuaid/followers","following_url":"https://api.github.com/users/MikeMcQuaid/following{/other_user}","gists_url":"https://api.github.com/users/MikeMcQuaid/gists{/gist_id}","starred_url":"https://api.github.com/users/MikeMcQuaid/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MikeMcQuaid/subscriptions","organizations_url":"https://api.github.com/users/MikeMcQuaid/orgs","repos_url":"https://api.github.com/users/MikeMcQuaid/repos","events_url":"https://api.github.com/users/MikeMcQuaid/events{/privacy}","received_events_url":"https://api.github.com/users/MikeMcQuaid/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/Homebrew/brew/issues/14541/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/Homebrew/brew/issues/14541/timeline","performed_via_github_app":null,"state_reason":"completed"}