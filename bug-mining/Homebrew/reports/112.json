{"url":"https://api.github.com/repos/Homebrew/brew/issues/18736","repository_url":"https://api.github.com/repos/Homebrew/brew","labels_url":"https://api.github.com/repos/Homebrew/brew/issues/18736/labels{/name}","comments_url":"https://api.github.com/repos/Homebrew/brew/issues/18736/comments","events_url":"https://api.github.com/repos/Homebrew/brew/issues/18736/events","html_url":"https://github.com/Homebrew/brew/issues/18736","id":2643779825,"node_id":"I_kwDOAyxcHc6dlODx","number":18736,"title":"Homebrew requires Xcode when sufficient Command Line Tools is installed and selected (and can also fail randomly even if a sufficient Xcode is installed)","user":{"login":"ctaintor","id":113958,"node_id":"MDQ6VXNlcjExMzk1OA==","avatar_url":"https://avatars.githubusercontent.com/u/113958?v=4","gravatar_id":"","url":"https://api.github.com/users/ctaintor","html_url":"https://github.com/ctaintor","followers_url":"https://api.github.com/users/ctaintor/followers","following_url":"https://api.github.com/users/ctaintor/following{/other_user}","gists_url":"https://api.github.com/users/ctaintor/gists{/gist_id}","starred_url":"https://api.github.com/users/ctaintor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ctaintor/subscriptions","organizations_url":"https://api.github.com/users/ctaintor/orgs","repos_url":"https://api.github.com/users/ctaintor/repos","events_url":"https://api.github.com/users/ctaintor/events{/privacy}","received_events_url":"https://api.github.com/users/ctaintor/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"carlocab","id":30379873,"node_id":"MDQ6VXNlcjMwMzc5ODcz","avatar_url":"https://avatars.githubusercontent.com/u/30379873?v=4","gravatar_id":"","url":"https://api.github.com/users/carlocab","html_url":"https://github.com/carlocab","followers_url":"https://api.github.com/users/carlocab/followers","following_url":"https://api.github.com/users/carlocab/following{/other_user}","gists_url":"https://api.github.com/users/carlocab/gists{/gist_id}","starred_url":"https://api.github.com/users/carlocab/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/carlocab/subscriptions","organizations_url":"https://api.github.com/users/carlocab/orgs","repos_url":"https://api.github.com/users/carlocab/repos","events_url":"https://api.github.com/users/carlocab/events{/privacy}","received_events_url":"https://api.github.com/users/carlocab/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"carlocab","id":30379873,"node_id":"MDQ6VXNlcjMwMzc5ODcz","avatar_url":"https://avatars.githubusercontent.com/u/30379873?v=4","gravatar_id":"","url":"https://api.github.com/users/carlocab","html_url":"https://github.com/carlocab","followers_url":"https://api.github.com/users/carlocab/followers","following_url":"https://api.github.com/users/carlocab/following{/other_user}","gists_url":"https://api.github.com/users/carlocab/gists{/gist_id}","starred_url":"https://api.github.com/users/carlocab/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/carlocab/subscriptions","organizations_url":"https://api.github.com/users/carlocab/orgs","repos_url":"https://api.github.com/users/carlocab/repos","events_url":"https://api.github.com/users/carlocab/events{/privacy}","received_events_url":"https://api.github.com/users/carlocab/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":0,"created_at":"2024-11-08T11:34:54Z","updated_at":"2024-11-08T15:13:31Z","closed_at":"2024-11-08T15:13:31Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### `brew doctor` output\r\n\r\n```shell\r\nYour system is ready to brew.\r\n```\r\n\r\n\r\n### Verification\r\n\r\n- [X] My \"`brew doctor` output\" above says `Your system is ready to brew.` and am still able to reproduce my issue.\r\n- [X] I ran `brew update` twice and am still able to reproduce my issue.\r\n- [X] This issue's title and/or description do not reference a single formula e.g. `brew install wget`. If they do, open an issue at https://github.com/Homebrew/homebrew-core/issues/new/choose instead.\r\n\r\n### `brew config` output\r\n\r\n```shell\r\nHOMEBREW_VERSION: 4.4.4\r\nORIGIN: https://github.com/Homebrew/brew\r\nHEAD: 824efa8836dc226aa92dbbf7404c1b4a66707cca\r\nLast commit: 4 days ago\r\nCore tap JSON: 08 Nov 11:00 UTC\r\nCore cask tap JSON: 08 Nov 11:00 UTC\r\nHOMEBREW_PREFIX: /opt/homebrew\r\nHOMEBREW_ARTIFACT_DOMAIN: https://artifactory.klarna.net/artifactory/r-docker-ghcr-io\r\nHOMEBREW_CASK_OPTS: []\r\nHOMEBREW_DOCKER_REGISTRY_BASIC_AUTH_TOKEN: set\r\nHOMEBREW_MAKE_JOBS: 10\r\nHOMEBREW_PIP_INDEX_URL: https://artifactory.klarna.net/artifactory/api/pypi/r-pypi-pypi-org/packages\r\nHomebrew Ruby: 3.3.5 => /opt/homebrew/Library/Homebrew/vendor/portable-ruby/3.3.5/bin/ruby\r\nCPU: 10-core 64-bit arm_blizzard_avalanche\r\nClang: 16.0.0 build 1600\r\nGit: 2.47.0 => /opt/homebrew/bin/git\r\nCurl: 8.7.1 => /usr/bin/curl\r\nmacOS: 14.7.1-arm64\r\nCLT: 16.1.0.0.1.1729049160\r\nXcode: 15.4 => /Applications/Xcode-15.4.0.app/Contents/Developer\r\nRosetta 2: false\r\n```\r\n\r\n\r\n### What were you trying to do (and why)?\r\n\r\nI'm trying to install a formula which does not have a bottle. Sometimes it will succeed and sometimes it will fail.\r\n\r\nMy setup may seem strange but is a pretty common case when upgrading macOS versions. Basically – imagine that I am a user who has installed Xcode 15.4 before upgrading to macOS 16. Rather than download/install the massive Xcode package (which hey – maybe I don't even need anymore), I just install the latest Command Line Tools and xcode-select it. I would expect all build from source to work, since I wouldn't expect Xcode to be used at all. Instead, Homebrew will require the Xcode to be the latest supported version.\r\n\r\n### What happened (include all command output)?\r\n\r\nsometimes I get:\r\n```\r\nError: Your Xcode (14.3.1 => /Applications/Xcode-14.3.1.app/Contents/Developer) at /Applications/Xcode-14.3.1.app is too outdated.\r\nPlease update to Xcode 15.4 (or delete it).\r\nXcode can be updated from the App Store.\r\n\r\nError: Kernel.exit\r\n```\r\nand sometimes I get this warning and it succeeds:\r\n```\r\nWarning: Your Xcode (15.2) is outdated.\r\nPlease update to Xcode 15.4 (or delete it).\r\nXcode can be updated from the App Store.\r\n```\r\nand sometimes I get no warnings and it all succeeds!\r\n\r\n### What did you expect to happen?\r\n\r\nMy first expectation is that if I have a functional Xcode CLT installed and selected via `xcode-select`  _and I don't need Xcode_, then things would \"just work\", regardless of if I have had Xcode installed before or not.\r\n\r\nMy second expectation is that _if_ Homebrew is needing Xcode yet I haven't selected it via `xcode-select`, then Homebrew would use the _latest_ version of Xcode which I have installed. Today it will choose the first result of Spotlight, which is random. (in my case, the `.first` result will be either 14.3.1 or 15.2 or 15.4)\r\n\r\n### Step-by-step reproduction instructions (by running `brew` commands)\r\n\r\n```shell\r\n`xcodes` makes this pretty simple to test:\r\n\r\n* install an outdated version of Xcode. So in my case I'm on macOS 14 so I installed `xcodes install 14.3.1`\r\n* install a recent version of Xcode. So, `xcodes install 15.4` or `xcodes install 16.1` _note that this is only necessary for the \"random failure\" use case_. If you have no other Xcode installed than the outdated one, then it will fail every time.\r\n* install the latest Xcode Command Line Tools\r\n* `sudo xcode-select -s /Library/Developer/CommandLineTools`\r\n* install a formula building from source\r\n\r\nI tracked the randomness down to [app_with_bundle_id](https://github.com/Homebrew/brew/blob/master/Library/Homebrew/os/mac.rb#L197-L202). Ideally this just chooses the latest.\r\n\r\nAs for why Homebrew checks Xcode version _always_, I don't know the answer to that. I would expect that it only cares about the thing-that-is-xcode-selected.\r\n```\r\n","closed_by":{"login":"carlocab","id":30379873,"node_id":"MDQ6VXNlcjMwMzc5ODcz","avatar_url":"https://avatars.githubusercontent.com/u/30379873?v=4","gravatar_id":"","url":"https://api.github.com/users/carlocab","html_url":"https://github.com/carlocab","followers_url":"https://api.github.com/users/carlocab/followers","following_url":"https://api.github.com/users/carlocab/following{/other_user}","gists_url":"https://api.github.com/users/carlocab/gists{/gist_id}","starred_url":"https://api.github.com/users/carlocab/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/carlocab/subscriptions","organizations_url":"https://api.github.com/users/carlocab/orgs","repos_url":"https://api.github.com/users/carlocab/repos","events_url":"https://api.github.com/users/carlocab/events{/privacy}","received_events_url":"https://api.github.com/users/carlocab/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/Homebrew/brew/issues/18736/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/Homebrew/brew/issues/18736/timeline","performed_via_github_app":null,"state_reason":"completed"}