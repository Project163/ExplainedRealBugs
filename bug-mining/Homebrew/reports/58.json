{"url":"https://api.github.com/repos/Homebrew/brew/issues/15153","repository_url":"https://api.github.com/repos/Homebrew/brew","labels_url":"https://api.github.com/repos/Homebrew/brew/issues/15153/labels{/name}","comments_url":"https://api.github.com/repos/Homebrew/brew/issues/15153/comments","events_url":"https://api.github.com/repos/Homebrew/brew/issues/15153/events","html_url":"https://github.com/Homebrew/brew/issues/15153","id":1654843944,"node_id":"I_kwDOAyxcHc5iouoo","number":15153,"title":"`brew search` searches tapped files instead of the API","user":{"login":"llimllib","id":7150,"node_id":"MDQ6VXNlcjcxNTA=","avatar_url":"https://avatars.githubusercontent.com/u/7150?v=4","gravatar_id":"","url":"https://api.github.com/users/llimllib","html_url":"https://github.com/llimllib","followers_url":"https://api.github.com/users/llimllib/followers","following_url":"https://api.github.com/users/llimllib/following{/other_user}","gists_url":"https://api.github.com/users/llimllib/gists{/gist_id}","starred_url":"https://api.github.com/users/llimllib/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/llimllib/subscriptions","organizations_url":"https://api.github.com/users/llimllib/orgs","repos_url":"https://api.github.com/users/llimllib/repos","events_url":"https://api.github.com/users/llimllib/events{/privacy}","received_events_url":"https://api.github.com/users/llimllib/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":351931983,"node_id":"MDU6TGFiZWwzNTE5MzE5ODM=","url":"https://api.github.com/repos/Homebrew/brew/labels/in%20progress","name":"in progress","color":"ededed","default":false,"description":"Maintainers are working on this"},{"id":922544989,"node_id":"MDU6TGFiZWw5MjI1NDQ5ODk=","url":"https://api.github.com/repos/Homebrew/brew/labels/outdated","name":"outdated","color":"d93f0b","default":false,"description":"PR was locked due to age"},{"id":5087850182,"node_id":"LA_kwDOAyxcHc8AAAABL0Juxg","url":"https://api.github.com/repos/Homebrew/brew/labels/install%20from%20api","name":"install from api","color":"31CF7B","default":false,"description":"Relates to API installs"}],"state":"closed","locked":true,"assignee":{"login":"MikeMcQuaid","id":125011,"node_id":"MDQ6VXNlcjEyNTAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/125011?v=4","gravatar_id":"","url":"https://api.github.com/users/MikeMcQuaid","html_url":"https://github.com/MikeMcQuaid","followers_url":"https://api.github.com/users/MikeMcQuaid/followers","following_url":"https://api.github.com/users/MikeMcQuaid/following{/other_user}","gists_url":"https://api.github.com/users/MikeMcQuaid/gists{/gist_id}","starred_url":"https://api.github.com/users/MikeMcQuaid/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MikeMcQuaid/subscriptions","organizations_url":"https://api.github.com/users/MikeMcQuaid/orgs","repos_url":"https://api.github.com/users/MikeMcQuaid/repos","events_url":"https://api.github.com/users/MikeMcQuaid/events{/privacy}","received_events_url":"https://api.github.com/users/MikeMcQuaid/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"MikeMcQuaid","id":125011,"node_id":"MDQ6VXNlcjEyNTAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/125011?v=4","gravatar_id":"","url":"https://api.github.com/users/MikeMcQuaid","html_url":"https://github.com/MikeMcQuaid","followers_url":"https://api.github.com/users/MikeMcQuaid/followers","following_url":"https://api.github.com/users/MikeMcQuaid/following{/other_user}","gists_url":"https://api.github.com/users/MikeMcQuaid/gists{/gist_id}","starred_url":"https://api.github.com/users/MikeMcQuaid/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MikeMcQuaid/subscriptions","organizations_url":"https://api.github.com/users/MikeMcQuaid/orgs","repos_url":"https://api.github.com/users/MikeMcQuaid/repos","events_url":"https://api.github.com/users/MikeMcQuaid/events{/privacy}","received_events_url":"https://api.github.com/users/MikeMcQuaid/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":3,"created_at":"2023-04-05T02:46:47Z","updated_at":"2023-05-06T00:06:01Z","closed_at":"2023-04-05T10:41:13Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### `brew doctor` output\r\n\r\n```shell\r\nPlease note that these warnings are just used to help the Homebrew maintainers\r\nwith debugging if you file an issue. If everything you use Homebrew for is\r\nworking fine: please don't worry or file an issue; just ignore this. Thanks!\r\n\r\nWarning: Some installed kegs have no formulae!\r\nThis means they were either deleted or installed manually.\r\nYou should find replacements for the following formulae:\r\n  pycparser\r\n  erdtree\r\n  trurl\r\n  szip\r\n\r\nWarning: You have unlinked kegs in your Cellar.\r\nLeaving kegs unlinked can lead to build-trouble and cause formulae that depend on\r\nthose kegs to fail to run properly once built. Run `brew link` on these:\r\n  tcl-tk\r\n  python@3.11\r\n```\r\n\r\n\r\n### Verification\r\n\r\n- [X] My \"`brew doctor` output\" above says `Your system is ready to brew.` and am still able to reproduce my issue.\r\n- [X] I ran `brew update` twice and am still able to reproduce my issue.\r\n- [X] This issue's title and/or description do not reference a single formula e.g. `brew install wget`. If they do, open an issue at https://github.com/Homebrew/homebrew-core/issues/new/choose instead.\r\n\r\n### `brew config` output\r\n\r\n```shell\r\nHOMEBREW_VERSION: 4.0.11-52-g97d7a5c\r\nORIGIN: https://github.com/Homebrew/brew\r\nHEAD: 97d7a5c9b4d55f93fa87ccf33526bbd231ba168a\r\nLast commit: 9 hours ago\r\nCore tap origin: https://github.com/Homebrew/homebrew-core\r\nCore tap HEAD: 6150d43818deed257e0121e1fa6bbbeb1a7e5c14\r\nCore tap last commit: 10 weeks ago\r\nCore tap branch: master\r\nCore tap JSON: 05 Apr 01:55 UTC\r\nHOMEBREW_PREFIX: /opt/homebrew\r\nHOMEBREW_CASK_OPTS: []\r\nHOMEBREW_EDITOR: /opt/homebrew/bin/nvim\r\nHOMEBREW_MAKE_JOBS: 10\r\nHomebrew Ruby: 2.6.10 => /System/Library/Frameworks/Ruby.framework/Versions/2.6/usr/bin/ruby\r\nCPU: 10-core 64-bit arm_firestorm_icestorm\r\nClang: 14.0.3 build 1403\r\nGit: 2.39.0 => /opt/homebrew/bin/git\r\nCurl: 7.87.0 => /usr/bin/curl\r\nmacOS: 13.3-arm64\r\nCLT: 14.3.0.0.1.1679647830\r\nXcode: 14.3\r\nRosetta 2: false\r\n```\r\n\r\n\r\n### What were you trying to do (and why)?\r\n\r\nSearch for the `erdtree` package\r\n\r\n### What happened (include all command output)?\r\n\r\n```\r\n$ brew search erdtree\r\nError: No formulae or casks found for \"erdtree\".\r\n```\r\n\r\n### What did you expect to happen?\r\n\r\n`brew search` should find the package from the API json, but instead it searches the formula files which are no longer updated.\r\n\r\nIn [this issue](https://github.com/orgs/Homebrew/discussions/4381) I followed the chain of why this was occurring; I'm not sure how `brew search` is supposed to be using the API instead of the core tap files, but I debugged into it and it's definitely using the core tap files.\r\n\r\n> the search method [here](https://github.com/Homebrew/brew/blob/97d7a5c9b4d55f93fa87ccf33526bbd231ba168a/Library/Homebrew/search.rb#L100) searches all formula names given by Formula.full_names [here](https://github.com/Homebrew/brew/blob/97d7a5c9b4d55f93fa87ccf33526bbd231ba168a/Library/Homebrew/formula.rb#L1832), which in turn calls CoreTap.instance.formula_names [here](https://github.com/Homebrew/brew/blob/97d7a5c9b4d55f93fa87ccf33526bbd231ba168a/Library/Homebrew/tap.rb#L590), which in turn calls formula_files.map(&method(:formula_file_to_name)), which plainly reads the formula files and returns their names.\r\n\r\nThis is also (I presume) why `brew doctor` is telling me that `pycparser`, `erdtree`, `trurl`, and `szip` do not have formulae - it is searching the outdated core tap instead of the API.\r\n\r\n### Step-by-step reproduction instructions (by running `brew` commands)\r\n\r\n```shell\r\n1. tap the core formula and reset your core tap to commit `6150d43`\r\n2. `brew search erdtree`\r\n3. note that it does not show up, though it is available in the API\r\n4. This leads to the confusing situation that `brew info erdtree` tells me that it's installed, but `brew search erdtree` fails and `brew doctor` tells me that the formula is missing\r\n```\r\n","closed_by":{"login":"MikeMcQuaid","id":125011,"node_id":"MDQ6VXNlcjEyNTAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/125011?v=4","gravatar_id":"","url":"https://api.github.com/users/MikeMcQuaid","html_url":"https://github.com/MikeMcQuaid","followers_url":"https://api.github.com/users/MikeMcQuaid/followers","following_url":"https://api.github.com/users/MikeMcQuaid/following{/other_user}","gists_url":"https://api.github.com/users/MikeMcQuaid/gists{/gist_id}","starred_url":"https://api.github.com/users/MikeMcQuaid/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MikeMcQuaid/subscriptions","organizations_url":"https://api.github.com/users/MikeMcQuaid/orgs","repos_url":"https://api.github.com/users/MikeMcQuaid/repos","events_url":"https://api.github.com/users/MikeMcQuaid/events{/privacy}","received_events_url":"https://api.github.com/users/MikeMcQuaid/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/Homebrew/brew/issues/15153/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/Homebrew/brew/issues/15153/timeline","performed_via_github_app":null,"state_reason":"completed"}