{"url":"https://api.github.com/repos/Homebrew/brew/issues/11795","repository_url":"https://api.github.com/repos/Homebrew/brew","labels_url":"https://api.github.com/repos/Homebrew/brew/issues/11795/labels{/name}","comments_url":"https://api.github.com/repos/Homebrew/brew/issues/11795/comments","events_url":"https://api.github.com/repos/Homebrew/brew/issues/11795/events","html_url":"https://github.com/Homebrew/brew/issues/11795","id":956987527,"node_id":"MDU6SXNzdWU5NTY5ODc1Mjc=","number":11795,"title":"`brew test` CompilerSelectionError when using `fails_with` & build-only compiler dependency","user":{"login":"cho-m","id":20700669,"node_id":"MDQ6VXNlcjIwNzAwNjY5","avatar_url":"https://avatars.githubusercontent.com/u/20700669?v=4","gravatar_id":"","url":"https://api.github.com/users/cho-m","html_url":"https://github.com/cho-m","followers_url":"https://api.github.com/users/cho-m/followers","following_url":"https://api.github.com/users/cho-m/following{/other_user}","gists_url":"https://api.github.com/users/cho-m/gists{/gist_id}","starred_url":"https://api.github.com/users/cho-m/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cho-m/subscriptions","organizations_url":"https://api.github.com/users/cho-m/orgs","repos_url":"https://api.github.com/users/cho-m/repos","events_url":"https://api.github.com/users/cho-m/events{/privacy}","received_events_url":"https://api.github.com/users/cho-m/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":922544989,"node_id":"MDU6TGFiZWw5MjI1NDQ5ODk=","url":"https://api.github.com/repos/Homebrew/brew/labels/outdated","name":"outdated","color":"d93f0b","default":false,"description":"PR was locked due to age"}],"state":"closed","locked":true,"assignee":{"login":"carlocab","id":30379873,"node_id":"MDQ6VXNlcjMwMzc5ODcz","avatar_url":"https://avatars.githubusercontent.com/u/30379873?v=4","gravatar_id":"","url":"https://api.github.com/users/carlocab","html_url":"https://github.com/carlocab","followers_url":"https://api.github.com/users/carlocab/followers","following_url":"https://api.github.com/users/carlocab/following{/other_user}","gists_url":"https://api.github.com/users/carlocab/gists{/gist_id}","starred_url":"https://api.github.com/users/carlocab/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/carlocab/subscriptions","organizations_url":"https://api.github.com/users/carlocab/orgs","repos_url":"https://api.github.com/users/carlocab/repos","events_url":"https://api.github.com/users/carlocab/events{/privacy}","received_events_url":"https://api.github.com/users/carlocab/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"carlocab","id":30379873,"node_id":"MDQ6VXNlcjMwMzc5ODcz","avatar_url":"https://avatars.githubusercontent.com/u/30379873?v=4","gravatar_id":"","url":"https://api.github.com/users/carlocab","html_url":"https://github.com/carlocab","followers_url":"https://api.github.com/users/carlocab/followers","following_url":"https://api.github.com/users/carlocab/following{/other_user}","gists_url":"https://api.github.com/users/carlocab/gists{/gist_id}","starred_url":"https://api.github.com/users/carlocab/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/carlocab/subscriptions","organizations_url":"https://api.github.com/users/carlocab/orgs","repos_url":"https://api.github.com/users/carlocab/repos","events_url":"https://api.github.com/users/carlocab/events{/privacy}","received_events_url":"https://api.github.com/users/carlocab/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":3,"created_at":"2021-07-30T18:52:18Z","updated_at":"2022-10-23T00:12:25Z","closed_at":"2022-09-22T15:02:33Z","author_association":"MEMBER","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### `brew config` output\r\n\r\n```shell\r\n==> Running Setup#run!\r\n==> brew install-bundler-gems\r\n==> brew config\r\nHOMEBREW_VERSION: 3.2.5-17-g689c1fd\r\nORIGIN: https://github.com/Homebrew/brew\r\nHEAD: 689c1fdb6ec2637964a004727a4f407861809bbd\r\nLast commit: 6 hours ago\r\nCore tap ORIGIN: https://github.com/Homebrew/homebrew-core\r\nCore tap HEAD: bdbfc4fcbcdef82b3d06c8ecb85c2464c61512bb\r\nCore tap last commit: 6 minutes ago\r\nCore tap branch: master\r\nHOMEBREW_PREFIX: /home/linuxbrew/.linuxbrew\r\nHOMEBREW_BOOTSNAP: set\r\nHOMEBREW_CASK_OPTS: []\r\nHOMEBREW_CLEANUP_PERIODIC_FULL_DAYS: 3650\r\nHOMEBREW_COLOR: set\r\nHOMEBREW_DEVELOPER: set\r\nHOMEBREW_FAIL_LOG_LINES: 150\r\nHOMEBREW_FORCE_HOMEBREW_ON_LINUX: set\r\nHOMEBREW_GITHUB_API_TOKEN: set\r\nHOMEBREW_GIT_EMAIL: 1589480+BrewTestBot@users.noreply.github.com\r\nHOMEBREW_GIT_NAME: BrewTestBot\r\nHOMEBREW_MAKE_JOBS: 2\r\nHOMEBREW_NO_AUTO_UPDATE: set\r\nHOMEBREW_NO_INSTALLED_DEPENDENTS_CHECK: set\r\nHOMEBREW_NO_EMOJI: set\r\nHomebrew Ruby: 2.6.3 => /home/linuxbrew/.linuxbrew/Homebrew/Library/Homebrew/vendor/portable-ruby/2.6.3_2/bin/ruby\r\nCPU: dual-core 64-bit skylake\r\nClang: N/A\r\nGit: 2.32.0 => /usr/bin/git\r\nCurl: 7.47.0 => /usr/bin/curl\r\nKernel: Linux 5.8.0-1039-azure x86_64 GNU/Linux\r\nOS: Ubuntu 16.04.7 LTS (xenial)\r\nHost glibc: 2.23\r\n/usr/bin/gcc: 5.4.0\r\n/usr/bin/ruby: N/A\r\nglibc: N/A\r\ngcc@5: N/A\r\nxorg: N/A\r\n```\r\n\r\n\r\n### `brew doctor` output\r\n\r\n```shell\r\n==> brew doctor\r\nAll steps passed!\r\n```\r\n\r\n\r\n### \r\n\r\n- [X] I ran `brew update` and am still able to reproduce my issue.\r\n- [X] I have resolved all warnings from `brew doctor` and that did not fix my problem.\r\n\r\n### What were you trying to do (and why)?\r\n\r\n~~Linux CI run on `envoy` https://github.com/Homebrew/homebrew-core/pull/82077 with diff to disable default GCC for build (`fails_with gcc: \"5\"`) and only enable working GCC in necessary section, i.e. build (`depends_on \"gcc@9\" => :build`).~~\r\n\r\n**EDIT:** Issue is more for LLVM rather than GCC since GCC-dependency often carries newer runtime library dependency. Specific examples:\r\n- `dotnet` https://github.com/Homebrew/homebrew-core/pull/81945 when trying to only enable `llvm` for build.\r\n- `swift`\r\n- `fibjs`\r\n\r\nIt would also be more accurate to test without extra brewed `gcc`/`llvm` dependency to make sure it truly isn't used by runtime.\r\n\r\n### What happened (include all command output)?\r\n\r\n`brew test` fails during set up due to compiler selection error. The error message complains about being unable to \"build\" the formula, even though it should be testing an already built/installed formula.\r\n\r\nSee https://github.com/Homebrew/homebrew-core/runs/3190458966\r\n```\r\n==> FAILED\r\nError: test failed\r\n==> Testing envoy\r\nError: envoy: failed\r\nAn exception occurred within a child process:\r\n  CompilerSelectionError: envoy cannot be built with any available compilers.\r\nInstall Clang or run `brew install gcc`.\r\n```\r\n\r\n### What did you expect to happen?\r\n\r\n`brew test` should not fail on `CompilerSelectionError`. It should run in the test block as is, without requiring extra/unneeded compiler dependencies.\r\n\r\nSome clarification/changes to `fails_with` is necessary so that there is a way to just disable GCC-5(Linux) or Apple Clang in build, but allow usage during test.\r\n\r\n### Step-by-step reproduction instructions (by running `brew` commands)\r\n\r\n```shell\r\nhttps://github.com/Homebrew/homebrew-core/runs/3190458966\r\n```\r\n","closed_by":{"login":"carlocab","id":30379873,"node_id":"MDQ6VXNlcjMwMzc5ODcz","avatar_url":"https://avatars.githubusercontent.com/u/30379873?v=4","gravatar_id":"","url":"https://api.github.com/users/carlocab","html_url":"https://github.com/carlocab","followers_url":"https://api.github.com/users/carlocab/followers","following_url":"https://api.github.com/users/carlocab/following{/other_user}","gists_url":"https://api.github.com/users/carlocab/gists{/gist_id}","starred_url":"https://api.github.com/users/carlocab/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/carlocab/subscriptions","organizations_url":"https://api.github.com/users/carlocab/orgs","repos_url":"https://api.github.com/users/carlocab/repos","events_url":"https://api.github.com/users/carlocab/events{/privacy}","received_events_url":"https://api.github.com/users/carlocab/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/Homebrew/brew/issues/11795/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/Homebrew/brew/issues/11795/timeline","performed_via_github_app":null,"state_reason":"completed"}