{"url":"https://api.github.com/repos/Homebrew/brew/issues/13592","repository_url":"https://api.github.com/repos/Homebrew/brew","labels_url":"https://api.github.com/repos/Homebrew/brew/issues/13592/labels{/name}","comments_url":"https://api.github.com/repos/Homebrew/brew/issues/13592/comments","events_url":"https://api.github.com/repos/Homebrew/brew/issues/13592/events","html_url":"https://github.com/Homebrew/brew/issues/13592","id":1314041093,"node_id":"I_kwDOAyxcHc5OUq0F","number":13592,"title":"`brew deps` fails with `--formula` and emits a warning without it","user":{"login":"lkrms","id":2563783,"node_id":"MDQ6VXNlcjI1NjM3ODM=","avatar_url":"https://avatars.githubusercontent.com/u/2563783?v=4","gravatar_id":"","url":"https://api.github.com/users/lkrms","html_url":"https://github.com/lkrms","followers_url":"https://api.github.com/users/lkrms/followers","following_url":"https://api.github.com/users/lkrms/following{/other_user}","gists_url":"https://api.github.com/users/lkrms/gists{/gist_id}","starred_url":"https://api.github.com/users/lkrms/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lkrms/subscriptions","organizations_url":"https://api.github.com/users/lkrms/orgs","repos_url":"https://api.github.com/users/lkrms/repos","events_url":"https://api.github.com/users/lkrms/events{/privacy}","received_events_url":"https://api.github.com/users/lkrms/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":922544989,"node_id":"MDU6TGFiZWw5MjI1NDQ5ODk=","url":"https://api.github.com/repos/Homebrew/brew/labels/outdated","name":"outdated","color":"d93f0b","default":false,"description":"PR was locked due to age"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2022-07-22T02:03:00Z","updated_at":"2022-10-02T00:12:16Z","closed_at":"2022-09-01T10:04:59Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### `brew config` output\r\n\r\n```shell\r\nHOMEBREW_VERSION: 3.5.6\r\nORIGIN: https://github.com/Homebrew/brew\r\nHEAD: 0b030b74e2ac518bd0bc4158f96c449198f9957f\r\nLast commit: 17 hours ago\r\nCore tap ORIGIN: https://github.com/Homebrew/homebrew-core\r\nCore tap HEAD: 2b5709c32989ba0d1187b64a9cba039c4426cae0\r\nCore tap last commit: 70 minutes ago\r\nCore tap branch: master\r\nHOMEBREW_PREFIX: /usr/local\r\nHOMEBREW_ARTIFACT_DOMAIN: http://brew.mirror\r\nHOMEBREW_BOOTSNAP: set\r\nHOMEBREW_CASK_OPTS: [\"--no-quarantine\"]\r\nHOMEBREW_EDITOR: vi\r\nHOMEBREW_MAKE_JOBS: 6\r\nHOMEBREW_NO_ANALYTICS: set\r\nHOMEBREW_NO_AUTO_UPDATE: set\r\nHOMEBREW_NO_ENV_HINTS: set\r\nHOMEBREW_NO_INSTALL_CLEANUP: set\r\nHomebrew Ruby: 2.6.8 => /System/Library/Frameworks/Ruby.framework/Versions/2.6/usr/bin/ruby\r\nCPU: hexa-core 64-bit kabylake\r\nClang: 13.1.6 build 1316\r\nGit: 2.37.1 => /usr/local/bin/git\r\nCurl: 7.79.1 => /usr/bin/curl\r\nmacOS: 12.5-x86_64\r\nCLT: 13.4.0.0.1.1651278267\r\nXcode: 13.4.1\r\n```\r\n\r\n\r\n### `brew doctor` output\r\n\r\n```shell\r\n﻿﻿Please note that these warnings are just used to help the Homebrew maintainers\r\nwith debugging if you file an issue. If everything you use Homebrew for is\r\nworking fine: please don't worry or file an issue; just ignore this. Thanks!\r\n\r\nWarning: Some installed formulae are deprecated or disabled.\r\nYou should find replacements for the following formulae:\r\n  php@7.4\r\n\r\nWarning: You have unlinked kegs in your Cellar.\r\nLeaving kegs unlinked can lead to build-trouble and cause formulae that depend on\r\nthose kegs to fail to run properly once built. Run `brew link` on these:\r\n  bash-completion@2\r\n  bash-completion\r\n\r\nWarning: Some installed formulae are missing dependencies.\r\nYou should `brew install` the missing dependencies:\r\n  brew install openssl@3\r\n\r\nRun `brew missing` for more details.\r\n```\r\n\r\n\r\n### Verification\r\n\r\n- [X] I ran `brew update` and am still able to reproduce my issue.\r\n- [X] I have resolved all warnings from `brew doctor` and that did not fix my problem.\r\n\r\n### What were you trying to do (and why)?\r\n\r\nRun `brew deps --union --full-name --formula <formula-names>` to generate a definitive list of dependencies for all of the formulae installed, or being installed, by a provisioning script.\r\n\r\nWhy? To identify orphaned packages. Some formulae may not be installed yet (e.g. if formulae have recently been added to the script), so `brew deps --installed` won't work; and some formulae installed explicitly on a previous run may have been removed from the script, so I can't rely on `brew autoremove` or `brew leaves` to identify orphans -- unless there's a mechanism to mark installed packages \"installed as dependency\", and no such mechanism seems to exist.\r\n\r\n### What happened (include all command output)?\r\n\r\nI received the following output when using the command above:\r\n\r\n```\r\nUsage: brew deps [options] [formula|cask ...]\r\n\r\nShow dependencies for formula. Additional options specific to formula may be\r\nappended to the command. When given multiple formula arguments, show the\r\nintersection of dependencies for each formula.\r\n\r\n  -n                               Sort dependencies in topological order.\r\n      --1                          Only show dependencies one level down,\r\n                                   instead of recursing.\r\n      --union                      Show the union of dependencies for multiple\r\n                                   formula, instead of the intersection.\r\n      --full-name                  List dependencies by their full name.\r\n      --include-build              Include :build dependencies for formula.\r\n      --include-optional           Include :optional dependencies for\r\n                                   formula.\r\n      --include-test               Include :test dependencies for formula\r\n                                   (non-recursive).\r\n      --skip-recommended           Skip :recommended dependencies for\r\n                                   formula.\r\n      --include-requirements       Include requirements in addition to\r\n                                   dependencies for formula.\r\n      --tree                       Show dependencies as a tree. When given\r\n                                   multiple formula arguments, show individual\r\n                                   trees for each formula.\r\n      --graph                      Show dependencies as a directed graph.\r\n      --dot                        Show text-based graph description in DOT\r\n                                   format.\r\n      --annotate                   Mark any build, test, optional, or\r\n                                   recommended dependencies as such in the\r\n                                   output.\r\n      --installed                  List dependencies for formulae that are\r\n                                   currently installed. If formula is\r\n                                   specified, list only its dependencies that\r\n                                   are currently installed.\r\n      --all                        List dependencies for all available formulae.\r\n      --for-each                   Switch into the mode used by the --all\r\n                                   option, but only list dependencies for each\r\n                                   provided formula, one formula per line.\r\n                                   This is used for debugging the\r\n                                   --installed/--all display mode.\r\n      --formula, --formulae        Treat all named arguments as formulae.\r\n      --cask, --casks              Treat all named arguments as casks.\r\n  -d, --debug                      Display any debugging information.\r\n  -q, --quiet                      Make some output more quiet.\r\n  -v, --verbose                    Make some output more verbose.\r\n  -h, --help                       Show this message.\r\n\r\nError: Invalid usage: `--formula` cannot be passed without `--installed`.\r\n```\r\n\r\nAfter removing the `--formula` option (because `--installed` would generate incomplete output, as explained above), I got the following (truncated for brevity; the formula list isn't a concern):\r\n\r\n```\r\nWarning: Treating flock as a formula. For the cask, use homebrew/cask/flock\r\nWarning: Treating unison as a formula. For the cask, use homebrew/cask/unison\r\nWarning: Treating cmake as a formula. For the cask, use homebrew/cask/cmake\r\nadwaita-icon-theme\r\naom\r\napr\r\napr-util\r\nargon2\r\naspell\r\natk\r\naugeas\r\nautoconf\r\nbdw-gc\r\nbrotli\r\nc-ares\r\nca-certificates\r\ncairo\r\ncjson\r\ncmocka\r\ncoreutils\r\ncpio\r\ncunit\r\n...\r\n```\r\n\r\nGiven formula and cask names are both volatile, running the command without `--formula` is problematic regardless, but the fact that it generates a warning for any conflicts is irreconcilable with its refusal to run with `--formula`.\r\n\r\n### What did you expect to happen?\r\n\r\nA list of formulae should have been output, with no warnings.\r\n\r\nMy current workaround (for this long-standing issue) is to recursively process JSON output from `brew info` with `jq`, but this is slow and (very) inefficient. A reliable `brew deps` command would be far better.\r\n\r\n### Step-by-step reproduction instructions (by running `brew` commands)\r\n\r\nI've shortened the formulae list, but it still demonstrates the issue:\r\n\r\n```shell\r\nbrew deps --union --full-name --formula coreutils diffutils findutils gawk gnu-getopt grep inetutils gnu-sed gnu-tar wget bash-completion flock icdiff jc jq newt pv python-yq rsync trash\r\n```\r\n\r\nTry again without --formula:\r\n\r\n```shell\r\nbrew deps --union --full-name coreutils diffutils findutils gawk gnu-getopt grep inetutils gnu-sed gnu-tar wget bash-completion flock icdiff jc jq newt pv python-yq rsync trash\r\n```\r\n","closed_by":{"login":"MikeMcQuaid","id":125011,"node_id":"MDQ6VXNlcjEyNTAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/125011?v=4","gravatar_id":"","url":"https://api.github.com/users/MikeMcQuaid","html_url":"https://github.com/MikeMcQuaid","followers_url":"https://api.github.com/users/MikeMcQuaid/followers","following_url":"https://api.github.com/users/MikeMcQuaid/following{/other_user}","gists_url":"https://api.github.com/users/MikeMcQuaid/gists{/gist_id}","starred_url":"https://api.github.com/users/MikeMcQuaid/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MikeMcQuaid/subscriptions","organizations_url":"https://api.github.com/users/MikeMcQuaid/orgs","repos_url":"https://api.github.com/users/MikeMcQuaid/repos","events_url":"https://api.github.com/users/MikeMcQuaid/events{/privacy}","received_events_url":"https://api.github.com/users/MikeMcQuaid/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/Homebrew/brew/issues/13592/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/Homebrew/brew/issues/13592/timeline","performed_via_github_app":null,"state_reason":"completed"}