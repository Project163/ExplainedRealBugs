{"url":"https://api.github.com/repos/Homebrew/brew/issues/12832","repository_url":"https://api.github.com/repos/Homebrew/brew","labels_url":"https://api.github.com/repos/Homebrew/brew/issues/12832/labels{/name}","comments_url":"https://api.github.com/repos/Homebrew/brew/issues/12832/comments","events_url":"https://api.github.com/repos/Homebrew/brew/issues/12832/events","html_url":"https://github.com/Homebrew/brew/issues/12832","id":1122866253,"node_id":"I_kwDOAyxcHc5C7ZRN","number":12832,"title":"Cannot create bottle for tcl-tk with a newer brew than 3.3.11","user":{"login":"imresteiner","id":15037655,"node_id":"MDQ6VXNlcjE1MDM3NjU1","avatar_url":"https://avatars.githubusercontent.com/u/15037655?v=4","gravatar_id":"","url":"https://api.github.com/users/imresteiner","html_url":"https://github.com/imresteiner","followers_url":"https://api.github.com/users/imresteiner/followers","following_url":"https://api.github.com/users/imresteiner/following{/other_user}","gists_url":"https://api.github.com/users/imresteiner/gists{/gist_id}","starred_url":"https://api.github.com/users/imresteiner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imresteiner/subscriptions","organizations_url":"https://api.github.com/users/imresteiner/orgs","repos_url":"https://api.github.com/users/imresteiner/repos","events_url":"https://api.github.com/users/imresteiner/events{/privacy}","received_events_url":"https://api.github.com/users/imresteiner/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":922544989,"node_id":"MDU6TGFiZWw5MjI1NDQ5ODk=","url":"https://api.github.com/repos/Homebrew/brew/labels/outdated","name":"outdated","color":"d93f0b","default":false,"description":"PR was locked due to age"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":24,"created_at":"2022-02-03T08:52:29Z","updated_at":"2022-03-14T00:05:38Z","closed_at":"2022-02-11T15:43:12Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### `brew config` output\r\n\r\n```shell\r\n> brew config\r\nHOMEBREW_VERSION: 3.3.13-13-g62b82c0\r\nORIGIN: https://git.balabit/macos/homebrew.git\r\nHEAD: 62b82c0792a3ad21584e6b1070214d2b1beaeded\r\nLast commit: 12 seconds ago\r\nCore tap ORIGIN: https://git.balabit/macos/homebrew-repo.git\r\nCore tap HEAD: 88ac7fce91b3f1785d8d51767045ba5d8aa15253\r\nCore tap last commit: 23 hours ago\r\nCore tap branch: upgrade-formulas\r\nHOMEBREW_PREFIX: /opt/bb-brew\r\nHOMEBREW_CACHE: /opt/bb-brew/Caches\r\nHOMEBREW_CASK_OPTS: []\r\nHOMEBREW_MAKE_JOBS: 4\r\nHOMEBREW_NO_ANALYTICS: set\r\nHOMEBREW_NO_AUTO_UPDATE: set\r\nHomebrew Ruby: 2.6.8 => /opt/bb-brew/Homebrew/Library/Homebrew/vendor/portable-ruby/2.6.8/bin/ruby\r\nCPU: quad-core 64-bit kabylake\r\nClang: 11.0.3 build 1103\r\nGit: 2.24.3 => /Applications/Xcode.app/Contents/Developer/usr/bin/git\r\nCurl: 7.64.1 => /usr/bin/curl\r\nmacOS: 10.15.7-x86_64\r\nCLT: 12.0.0.32.29\r\nXcode: 11.7\r\n```\r\n\r\n\r\n### `brew doctor` output\r\n\r\n```shell\r\n> brew doctor \r\nPlease note that these warnings are just used to help the Homebrew maintainers\r\nwith debugging if you file an issue. If everything you use Homebrew for is\r\nworking fine: please don't worry or file an issue; just ignore this. Thanks!\r\n\r\nWarning: Some taps are not on the default git origin branch and may not receive\r\nupdates. If this is a surprise to you, check out the default branch with:\r\n  git -C $(brew --repo homebrew/core) checkout master\r\n\r\nWarning: Your Xcode (11.7) is outdated.\r\nPlease update to Xcode 12.4 (or delete it).\r\nXcode can be updated from the App Store.\r\n```\r\n\r\n\r\n### Verification\r\n\r\n- [X] I ran `brew update` and am still able to reproduce my issue.\r\n- [X] I have resolved all warnings from `brew doctor` and that did not fix my problem.\r\n\r\n### What were you trying to do (and why)?\r\n\r\nI would like to update the formulas we are using to build our product. To release the binaries another git branch was created which is reseted to the homebrew-core repo's master.\r\n\r\n### What happened (include all command output)?\r\n\r\n`brew bottle --json tcl-tk` command failed.\r\n\r\noutput:\r\n```\r\n==> Determining tcl-tk bottle rebuild...\r\n==> Bottling tcl-tk--8.6.12_1.catalina.bottle.tar.gz...\r\nError: new ID must be a String\r\nDo not report this issue until you've run `brew update` and tried again.\r\n/opt/bb-brew/Homebrew/Library/Homebrew/vendor/bundle/ruby/2.6.0/gems/ruby-macho-3.0.0/lib/macho/macho_file.rb:318:in `change_dylib_id'\r\n/opt/bb-brew/Homebrew/Library/Homebrew/vendor/bundle/ruby/2.6.0/gems/ruby-macho-3.0.0/lib/macho/tools.rb:26:in `change_dylib_id'\r\n/opt/bb-brew/Homebrew/Library/Homebrew/os/mac/keg.rb:10:in `change_dylib_id'\r\n/opt/bb-brew/Homebrew/Library/Homebrew/extend/os/mac/keg_relocate.rb:26:in `block (2 levels) in relocate_dynamic_linkage'\r\n/opt/bb-brew/Homebrew/Library/Homebrew/extend/pathname.rb:341:in `ensure_writable'\r\n/opt/bb-brew/Homebrew/Library/Homebrew/extend/os/mac/keg_relocate.rb:23:in `block in relocate_dynamic_linkage'\r\n/opt/bb-brew/Homebrew/Library/Homebrew/extend/os/mac/keg_relocate.rb:22:in `each'\r\n/opt/bb-brew/Homebrew/Library/Homebrew/extend/os/mac/keg_relocate.rb:22:in `relocate_dynamic_linkage'\r\n/opt/bb-brew/Homebrew/Library/Homebrew/keg_relocate.rb:130:in `replace_placeholders_with_locations'\r\n/opt/bb-brew/Homebrew/Library/Homebrew/dev-cmd/bottle.rb:501:in `block (2 levels) in bottle_formula'\r\n/opt/bb-brew/Homebrew/Library/Homebrew/utils.rb:399:in `ignore_interrupts'\r\n/opt/bb-brew/Homebrew/Library/Homebrew/dev-cmd/bottle.rb:499:in `ensure in block in bottle_formula'\r\n/opt/bb-brew/Homebrew/Library/Homebrew/dev-cmd/bottle.rb:499:in `block in bottle_formula'\r\n/opt/bb-brew/Homebrew/Library/Homebrew/keg.rb:334:in `block in lock'\r\n/opt/bb-brew/Homebrew/Library/Homebrew/lock_file.rb:35:in `with_lock'\r\n/opt/bb-brew/Homebrew/Library/Homebrew/keg.rb:330:in `lock'\r\n/opt/bb-brew/Homebrew/Library/Homebrew/dev-cmd/bottle.rb:390:in `bottle_formula'\r\n/opt/bb-brew/Homebrew/Library/Homebrew/dev-cmd/bottle.rb:105:in `block in bottle'\r\n/opt/bb-brew/Homebrew/Library/Homebrew/dev-cmd/bottle.rb:104:in `each'\r\n/opt/bb-brew/Homebrew/Library/Homebrew/dev-cmd/bottle.rb:104:in `bottle'\r\n/opt/bb-brew/Homebrew/Library/Homebrew/brew.rb:110:in `<main>'\r\n```\r\nAfter a short investigation it seems an empty id is generated for the lib at Library/Homebrew/extend/os/mac/keg_relocate.rb:25\r\n==> FILE: /opt/bb-brew/Cellar/tcl-tk/8.6.12_1/lib/tcltls1.7.22/tcltls.dylib\r\n==> FILE.DYLIB_ID shared-tcltls.dylib\r\n==> ID:\r\n\r\nWith version 3.3.11 brew can build the bottle successfully. With a newer version I could reproduce the issue.\r\n\r\n### What did you expect to happen?\r\n\r\nThe json config is generated to create a bottle afterwards.\r\n\r\n### Step-by-step reproduction instructions (by running `brew` commands)\r\n\r\n```shell\r\n> brew install --build-bottle tcl-tk\r\n> brew bottle --json tcl-tk\r\n> brew bottle --merge tcl-tk*.json --write\r\n```\r\n","closed_by":{"login":"carlocab","id":30379873,"node_id":"MDQ6VXNlcjMwMzc5ODcz","avatar_url":"https://avatars.githubusercontent.com/u/30379873?v=4","gravatar_id":"","url":"https://api.github.com/users/carlocab","html_url":"https://github.com/carlocab","followers_url":"https://api.github.com/users/carlocab/followers","following_url":"https://api.github.com/users/carlocab/following{/other_user}","gists_url":"https://api.github.com/users/carlocab/gists{/gist_id}","starred_url":"https://api.github.com/users/carlocab/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/carlocab/subscriptions","organizations_url":"https://api.github.com/users/carlocab/orgs","repos_url":"https://api.github.com/users/carlocab/repos","events_url":"https://api.github.com/users/carlocab/events{/privacy}","received_events_url":"https://api.github.com/users/carlocab/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/Homebrew/brew/issues/12832/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/Homebrew/brew/issues/12832/timeline","performed_via_github_app":null,"state_reason":"completed"}