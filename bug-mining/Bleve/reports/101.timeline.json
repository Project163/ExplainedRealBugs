[{"url":"https://api.github.com/repos/blevesearch/bleve/issues/comments/222359997","html_url":"https://github.com/blevesearch/bleve/issues/378#issuecomment-222359997","issue_url":"https://api.github.com/repos/blevesearch/bleve/issues/378","id":222359997,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMjM1OTk5Nw==","user":{"login":"mschoch","id":298143,"node_id":"MDQ6VXNlcjI5ODE0Mw==","avatar_url":"https://avatars.githubusercontent.com/u/298143?v=4","gravatar_id":"","url":"https://api.github.com/users/mschoch","html_url":"https://github.com/mschoch","followers_url":"https://api.github.com/users/mschoch/followers","following_url":"https://api.github.com/users/mschoch/following{/other_user}","gists_url":"https://api.github.com/users/mschoch/gists{/gist_id}","starred_url":"https://api.github.com/users/mschoch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mschoch/subscriptions","organizations_url":"https://api.github.com/users/mschoch/orgs","repos_url":"https://api.github.com/users/mschoch/repos","events_url":"https://api.github.com/users/mschoch/events{/privacy}","received_events_url":"https://api.github.com/users/mschoch/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-05-29T13:13:41Z","updated_at":"2016-05-29T13:13:41Z","body":"You have not described a bug, you have just pointed to a line of code you think is wrong.  I have reviewed it and it looks correct to me, and we have unit tests for this function that are passing.  Please provide more information.\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/blevesearch/bleve/issues/comments/222359997/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mschoch","id":298143,"node_id":"MDQ6VXNlcjI5ODE0Mw==","avatar_url":"https://avatars.githubusercontent.com/u/298143?v=4","gravatar_id":"","url":"https://api.github.com/users/mschoch","html_url":"https://github.com/mschoch","followers_url":"https://api.github.com/users/mschoch/followers","following_url":"https://api.github.com/users/mschoch/following{/other_user}","gists_url":"https://api.github.com/users/mschoch/gists{/gist_id}","starred_url":"https://api.github.com/users/mschoch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mschoch/subscriptions","organizations_url":"https://api.github.com/users/mschoch/orgs","repos_url":"https://api.github.com/users/mschoch/repos","events_url":"https://api.github.com/users/mschoch/events{/privacy}","received_events_url":"https://api.github.com/users/mschoch/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/blevesearch/bleve/issues/comments/222366528","html_url":"https://github.com/blevesearch/bleve/issues/378#issuecomment-222366528","issue_url":"https://api.github.com/repos/blevesearch/bleve/issues/378","id":222366528,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMjM2NjUyOA==","user":{"login":"yields","id":1661587,"node_id":"MDQ6VXNlcjE2NjE1ODc=","avatar_url":"https://avatars.githubusercontent.com/u/1661587?v=4","gravatar_id":"","url":"https://api.github.com/users/yields","html_url":"https://github.com/yields","followers_url":"https://api.github.com/users/yields/followers","following_url":"https://api.github.com/users/yields/following{/other_user}","gists_url":"https://api.github.com/users/yields/gists{/gist_id}","starred_url":"https://api.github.com/users/yields/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yields/subscriptions","organizations_url":"https://api.github.com/users/yields/orgs","repos_url":"https://api.github.com/users/yields/repos","events_url":"https://api.github.com/users/yields/events{/privacy}","received_events_url":"https://api.github.com/users/yields/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-05-29T15:30:09Z","updated_at":"2016-05-29T15:30:09Z","body":"I see, sorry about that, i should have provided a sample of what i'm talking about:\n\n``` go\npackage main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"os\"\n    \"strconv\"\n\n    \"github.com/blevesearch/bleve\"\n)\n\ntype Tweet struct {\n    Text string\n}\n\nfunc main() {\n    os.RemoveAll(\"test.index\")\n\n    m := bleve.NewIndexMapping()\n    i, err := bleve.New(\"test.index\", m)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    for n := 0; n < 10; n++ {\n        err = i.Index(strconv.Itoa(n), Tweet{\n            Text: fmt.Sprintf(\"doc #%d\", n+1),\n        })\n        if err != nil {\n            log.Fatal(err)\n        }\n    }\n\n    query := bleve.NewMatchAllQuery()\n    req := bleve.NewSearchRequest(query)\n    req.Fields = []string{\"*\"}\n    req.From = 0\n    req.Size = 5\n\n    a, err := i.Search(req)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    req = bleve.NewSearchRequest(query)\n    req.Fields = []string{\"*\"}\n    req.From = 5\n    req.Size = 5\n    b, err := i.Search(req)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Println(\"0-5\", text(a))\n    fmt.Println(\"5-10\", text(b))\n}\n\nfunc text(resp *bleve.SearchResult) (ids []string) {\n    for _, doc := range resp.Hits {\n        ids = append(ids, doc.Fields[\"Text\"].(string))\n    }\n    return\n}\n```\n\n```\n// bleve (master)\n0-5 [doc #6 doc #5 doc #4 doc #3 doc #2]\n5-10 [doc #5 doc #4 doc #3 doc #2 doc #1]\n\n// bleve (v0.2.0)\n0-5 [doc #10 doc #9 doc #8 doc #7 doc #6]\n5-10 [doc #5 doc #4 doc #3 doc #2 doc #1]\n```\n\nAs you can see, the code is the same, the output is completely different, am i doing something wrong?\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/blevesearch/bleve/issues/comments/222366528/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"yields","id":1661587,"node_id":"MDQ6VXNlcjE2NjE1ODc=","avatar_url":"https://avatars.githubusercontent.com/u/1661587?v=4","gravatar_id":"","url":"https://api.github.com/users/yields","html_url":"https://github.com/yields","followers_url":"https://api.github.com/users/yields/followers","following_url":"https://api.github.com/users/yields/following{/other_user}","gists_url":"https://api.github.com/users/yields/gists{/gist_id}","starred_url":"https://api.github.com/users/yields/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yields/subscriptions","organizations_url":"https://api.github.com/users/yields/orgs","repos_url":"https://api.github.com/users/yields/repos","events_url":"https://api.github.com/users/yields/events{/privacy}","received_events_url":"https://api.github.com/users/yields/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/blevesearch/bleve/issues/comments/222372997","html_url":"https://github.com/blevesearch/bleve/issues/378#issuecomment-222372997","issue_url":"https://api.github.com/repos/blevesearch/bleve/issues/378","id":222372997,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMjM3Mjk5Nw==","user":{"login":"mschoch","id":298143,"node_id":"MDQ6VXNlcjI5ODE0Mw==","avatar_url":"https://avatars.githubusercontent.com/u/298143?v=4","gravatar_id":"","url":"https://api.github.com/users/mschoch","html_url":"https://github.com/mschoch","followers_url":"https://api.github.com/users/mschoch/followers","following_url":"https://api.github.com/users/mschoch/following{/other_user}","gists_url":"https://api.github.com/users/mschoch/gists{/gist_id}","starred_url":"https://api.github.com/users/mschoch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mschoch/subscriptions","organizations_url":"https://api.github.com/users/mschoch/orgs","repos_url":"https://api.github.com/users/mschoch/repos","events_url":"https://api.github.com/users/mschoch/events{/privacy}","received_events_url":"https://api.github.com/users/mschoch/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-05-29T17:43:25Z","updated_at":"2016-05-29T17:43:25Z","body":"Yep, so this exposes a larger problem.  If you notice, the difference in behavior is in the first 5 results returned, not the second 5.  Also, in your test case all the documents have the same score.  So the real issue is, if you ask for the top 5 docs first, and 10 docs have the same score, which 5 should you get?\n\nCurrently bleve only sorts the results on score, this means there is really no guarantee as to which 5 you'll get.  Before this optimization:\n\nhttps://github.com/blevesearch/bleve/commit/f2aba116c49ea51b27bc9afd3bf15305ef04883c\n\nwe got behavior that was more suitable for paging.  I'm not 100% sure it is always going to work either, because its still not enforcing any secondary sort beyond the score.  Its more that it behaves more like a stable sort and doesn't disrupt an order that happens to already be there.\n\nSo, the old version clearly works better for pagination, but the new version is faster if you only want to the top N.\n\nProbably the right fix is to roll back the change, and instead move it to a new collector, one that doesn't support skip, and give a name that better describes what it does.  But I'd like to think about it first and run it by a few other people to get their input as well.\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/blevesearch/bleve/issues/comments/222372997/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mschoch","id":298143,"node_id":"MDQ6VXNlcjI5ODE0Mw==","avatar_url":"https://avatars.githubusercontent.com/u/298143?v=4","gravatar_id":"","url":"https://api.github.com/users/mschoch","html_url":"https://github.com/mschoch","followers_url":"https://api.github.com/users/mschoch/followers","following_url":"https://api.github.com/users/mschoch/following{/other_user}","gists_url":"https://api.github.com/users/mschoch/gists{/gist_id}","starred_url":"https://api.github.com/users/mschoch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mschoch/subscriptions","organizations_url":"https://api.github.com/users/mschoch/orgs","repos_url":"https://api.github.com/users/mschoch/repos","events_url":"https://api.github.com/users/mschoch/events{/privacy}","received_events_url":"https://api.github.com/users/mschoch/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/blevesearch/bleve/issues/comments/222375044","html_url":"https://github.com/blevesearch/bleve/issues/378#issuecomment-222375044","issue_url":"https://api.github.com/repos/blevesearch/bleve/issues/378","id":222375044,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMjM3NTA0NA==","user":{"login":"mschoch","id":298143,"node_id":"MDQ6VXNlcjI5ODE0Mw==","avatar_url":"https://avatars.githubusercontent.com/u/298143?v=4","gravatar_id":"","url":"https://api.github.com/users/mschoch","html_url":"https://github.com/mschoch","followers_url":"https://api.github.com/users/mschoch/followers","following_url":"https://api.github.com/users/mschoch/following{/other_user}","gists_url":"https://api.github.com/users/mschoch/gists{/gist_id}","starred_url":"https://api.github.com/users/mschoch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mschoch/subscriptions","organizations_url":"https://api.github.com/users/mschoch/orgs","repos_url":"https://api.github.com/users/mschoch/repos","events_url":"https://api.github.com/users/mschoch/events{/privacy}","received_events_url":"https://api.github.com/users/mschoch/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-05-29T18:24:25Z","updated_at":"2016-05-29T18:24:25Z","body":"Actually, I was thinking about it some more.  I think its possible to keep this optimization without losing the properties we had before.  I think we just have to flip some of the logic around.\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/blevesearch/bleve/issues/comments/222375044/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mschoch","id":298143,"node_id":"MDQ6VXNlcjI5ODE0Mw==","avatar_url":"https://avatars.githubusercontent.com/u/298143?v=4","gravatar_id":"","url":"https://api.github.com/users/mschoch","html_url":"https://github.com/mschoch","followers_url":"https://api.github.com/users/mschoch/followers","following_url":"https://api.github.com/users/mschoch/following{/other_user}","gists_url":"https://api.github.com/users/mschoch/gists{/gist_id}","starred_url":"https://api.github.com/users/mschoch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mschoch/subscriptions","organizations_url":"https://api.github.com/users/mschoch/orgs","repos_url":"https://api.github.com/users/mschoch/repos","events_url":"https://api.github.com/users/mschoch/events{/privacy}","received_events_url":"https://api.github.com/users/mschoch/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":678519881,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDY3ODUxOTg4MQ==","url":"https://api.github.com/repos/blevesearch/bleve/issues/events/678519881","actor":{"login":"mschoch","id":298143,"node_id":"MDQ6VXNlcjI5ODE0Mw==","avatar_url":"https://avatars.githubusercontent.com/u/298143?v=4","gravatar_id":"","url":"https://api.github.com/users/mschoch","html_url":"https://github.com/mschoch","followers_url":"https://api.github.com/users/mschoch/followers","following_url":"https://api.github.com/users/mschoch/following{/other_user}","gists_url":"https://api.github.com/users/mschoch/gists{/gist_id}","starred_url":"https://api.github.com/users/mschoch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mschoch/subscriptions","organizations_url":"https://api.github.com/users/mschoch/orgs","repos_url":"https://api.github.com/users/mschoch/repos","events_url":"https://api.github.com/users/mschoch/events{/privacy}","received_events_url":"https://api.github.com/users/mschoch/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"2f391218b966b4ebfb7a7212e08047ad2f8f68bf","commit_url":"https://api.github.com/repos/mschoch/bleve/commits/2f391218b966b4ebfb7a7212e08047ad2f8f68bf","created_at":"2016-06-01T14:44:59Z","performed_via_github_app":null},{"actor":{"login":"mschoch","id":298143,"node_id":"MDQ6VXNlcjI5ODE0Mw==","avatar_url":"https://avatars.githubusercontent.com/u/298143?v=4","gravatar_id":"","url":"https://api.github.com/users/mschoch","html_url":"https://github.com/mschoch","followers_url":"https://api.github.com/users/mschoch/followers","following_url":"https://api.github.com/users/mschoch/following{/other_user}","gists_url":"https://api.github.com/users/mschoch/gists{/gist_id}","starred_url":"https://api.github.com/users/mschoch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mschoch/subscriptions","organizations_url":"https://api.github.com/users/mschoch/orgs","repos_url":"https://api.github.com/users/mschoch/repos","events_url":"https://api.github.com/users/mschoch/events{/privacy}","received_events_url":"https://api.github.com/users/mschoch/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-06-01T14:45:29Z","updated_at":"2016-06-01T14:45:29Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/blevesearch/bleve/issues/380","repository_url":"https://api.github.com/repos/blevesearch/bleve","labels_url":"https://api.github.com/repos/blevesearch/bleve/issues/380/labels{/name}","comments_url":"https://api.github.com/repos/blevesearch/bleve/issues/380/comments","events_url":"https://api.github.com/repos/blevesearch/bleve/issues/380/events","html_url":"https://github.com/blevesearch/bleve/pull/380","id":157925535,"node_id":"MDExOlB1bGxSZXF1ZXN0NzIxOTM4MDU=","number":380,"title":"fix pagination bug introduced by collector optimization","user":{"login":"mschoch","id":298143,"node_id":"MDQ6VXNlcjI5ODE0Mw==","avatar_url":"https://avatars.githubusercontent.com/u/298143?v=4","gravatar_id":"","url":"https://api.github.com/users/mschoch","html_url":"https://github.com/mschoch","followers_url":"https://api.github.com/users/mschoch/followers","following_url":"https://api.github.com/users/mschoch/following{/other_user}","gists_url":"https://api.github.com/users/mschoch/gists{/gist_id}","starred_url":"https://api.github.com/users/mschoch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mschoch/subscriptions","organizations_url":"https://api.github.com/users/mschoch/orgs","repos_url":"https://api.github.com/users/mschoch/repos","events_url":"https://api.github.com/users/mschoch/events{/privacy}","received_events_url":"https://api.github.com/users/mschoch/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2016-06-01T14:45:28Z","updated_at":"2016-06-01T20:22:09Z","closed_at":"2016-06-01T17:11:41Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":18893367,"node_id":"MDEwOlJlcG9zaXRvcnkxODg5MzM2Nw==","name":"bleve","full_name":"blevesearch/bleve","private":false,"owner":{"login":"blevesearch","id":8562608,"node_id":"MDEyOk9yZ2FuaXphdGlvbjg1NjI2MDg=","avatar_url":"https://avatars.githubusercontent.com/u/8562608?v=4","gravatar_id":"","url":"https://api.github.com/users/blevesearch","html_url":"https://github.com/blevesearch","followers_url":"https://api.github.com/users/blevesearch/followers","following_url":"https://api.github.com/users/blevesearch/following{/other_user}","gists_url":"https://api.github.com/users/blevesearch/gists{/gist_id}","starred_url":"https://api.github.com/users/blevesearch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/blevesearch/subscriptions","organizations_url":"https://api.github.com/users/blevesearch/orgs","repos_url":"https://api.github.com/users/blevesearch/repos","events_url":"https://api.github.com/users/blevesearch/events{/privacy}","received_events_url":"https://api.github.com/users/blevesearch/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/blevesearch/bleve","description":"A modern text/numeric/geo-spatial/vector indexing library for go","fork":false,"url":"https://api.github.com/repos/blevesearch/bleve","forks_url":"https://api.github.com/repos/blevesearch/bleve/forks","keys_url":"https://api.github.com/repos/blevesearch/bleve/keys{/key_id}","collaborators_url":"https://api.github.com/repos/blevesearch/bleve/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/blevesearch/bleve/teams","hooks_url":"https://api.github.com/repos/blevesearch/bleve/hooks","issue_events_url":"https://api.github.com/repos/blevesearch/bleve/issues/events{/number}","events_url":"https://api.github.com/repos/blevesearch/bleve/events","assignees_url":"https://api.github.com/repos/blevesearch/bleve/assignees{/user}","branches_url":"https://api.github.com/repos/blevesearch/bleve/branches{/branch}","tags_url":"https://api.github.com/repos/blevesearch/bleve/tags","blobs_url":"https://api.github.com/repos/blevesearch/bleve/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/blevesearch/bleve/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/blevesearch/bleve/git/refs{/sha}","trees_url":"https://api.github.com/repos/blevesearch/bleve/git/trees{/sha}","statuses_url":"https://api.github.com/repos/blevesearch/bleve/statuses/{sha}","languages_url":"https://api.github.com/repos/blevesearch/bleve/languages","stargazers_url":"https://api.github.com/repos/blevesearch/bleve/stargazers","contributors_url":"https://api.github.com/repos/blevesearch/bleve/contributors","subscribers_url":"https://api.github.com/repos/blevesearch/bleve/subscribers","subscription_url":"https://api.github.com/repos/blevesearch/bleve/subscription","commits_url":"https://api.github.com/repos/blevesearch/bleve/commits{/sha}","git_commits_url":"https://api.github.com/repos/blevesearch/bleve/git/commits{/sha}","comments_url":"https://api.github.com/repos/blevesearch/bleve/comments{/number}","issue_comment_url":"https://api.github.com/repos/blevesearch/bleve/issues/comments{/number}","contents_url":"https://api.github.com/repos/blevesearch/bleve/contents/{+path}","compare_url":"https://api.github.com/repos/blevesearch/bleve/compare/{base}...{head}","merges_url":"https://api.github.com/repos/blevesearch/bleve/merges","archive_url":"https://api.github.com/repos/blevesearch/bleve/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/blevesearch/bleve/downloads","issues_url":"https://api.github.com/repos/blevesearch/bleve/issues{/number}","pulls_url":"https://api.github.com/repos/blevesearch/bleve/pulls{/number}","milestones_url":"https://api.github.com/repos/blevesearch/bleve/milestones{/number}","notifications_url":"https://api.github.com/repos/blevesearch/bleve/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/blevesearch/bleve/labels{/name}","releases_url":"https://api.github.com/repos/blevesearch/bleve/releases{/id}","deployments_url":"https://api.github.com/repos/blevesearch/bleve/deployments","created_at":"2014-04-17T21:02:18Z","updated_at":"2025-11-10T09:34:58Z","pushed_at":"2025-11-07T20:01:43Z","git_url":"git://github.com/blevesearch/bleve.git","ssh_url":"git@github.com:blevesearch/bleve.git","clone_url":"https://github.com/blevesearch/bleve.git","svn_url":"https://github.com/blevesearch/bleve","homepage":"","size":17951,"stargazers_count":10698,"watchers_count":10698,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":true,"forks_count":696,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":297,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":[],"visibility":"public","forks":696,"open_issues":297,"watchers":10698,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/blevesearch/bleve/pulls/380","html_url":"https://github.com/blevesearch/bleve/pull/380","diff_url":"https://github.com/blevesearch/bleve/pull/380.diff","patch_url":"https://github.com/blevesearch/bleve/pull/380.patch","merged_at":"2016-06-01T17:11:41Z"},"body":"fixes #378\n\nthis bug was introduced by:\nhttps://github.com/blevesearch/bleve/commit/f2aba116c49ea51b27bc9afd3bf15305ef04883c\n\ntheory of operation for this collector (top N, skip K)\n- collect the highest scoring N+K results\n- if K > 0, skip K and return the next N\n\ninternal details\n- the top N+K are kept in a list\n- the list is ordered from lowest scoring (first) to highest scoring (last)\n- as a hit comes in, we find where this new hit would fit into this list\n- if this caused the list to get too big, trim off the head (lowest scoring hit)\n\ntheory of the optimization\n- we were not tracking the lowest score in the list\n- so if the score was lower than the lowest score, we would add/remove it\n- by keeping track of the lowest score in the list, we can avoid these ops\n\nproblem with the optimization\n- the optimization worked by returning early\n- by returning early there was a subtle change to documents which had the same score\n- the reason is that which docs end up in the top N+K changed by returning early\n- why was that? docs are coming in, in order by key ascending\n- when finding the correct position to insert a hit into the list, we checked <, not <= the score\n- this has the subtle effect that docs with the same score end up in reverse order\n\nfor example consider the following in progress list:\n\ndoc ids [   c    a    b  ]\nscores  [   1    5    9  ]\n\nif we now see doc d with score 5, we get:\n\ndoc ids [   c    a    d    b  ]\nscores  [   1    5    5    9  ]\n\nWhile that appears in order (a, d) it is actually reverse order, because when we\nproduce the top N we start at the end.\n\ntheory of the fix\n- previous pagination depended on later hits with the same score \"bumping\" earlier\n  hits with the same score off the bottom of the list\n- however, if we change the logic to <= instead of <, now the list in the previous\n  example would look like:\n\ndoc ids [   c    d    a    b  ]\nscores  [   1    5    5    9  ]\n- this small change means that now earlier (lower id) will score higher, and\n  thus we no longer depend on later hits bumping things down, which means returning\n  early is a valid thing to do\n\nNOTE: this does depend on the hits coming back in order by ID.  this is not\nsomething strictly guaranteed, but it was the same assumption that allowed the\noriginal behavior\n\nThis also has the side-effect that 2 hits with the same score come back in\nascending ID order, which is somehow more pleasing to me than reverse order.\n","reactions":{"url":"https://api.github.com/repos/blevesearch/bleve/issues/380/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/blevesearch/bleve/issues/380/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":678598860,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDY3ODU5ODg2MA==","url":"https://api.github.com/repos/blevesearch/bleve/issues/events/678598860","actor":{"login":"mschoch","id":298143,"node_id":"MDQ6VXNlcjI5ODE0Mw==","avatar_url":"https://avatars.githubusercontent.com/u/298143?v=4","gravatar_id":"","url":"https://api.github.com/users/mschoch","html_url":"https://github.com/mschoch","followers_url":"https://api.github.com/users/mschoch/followers","following_url":"https://api.github.com/users/mschoch/following{/other_user}","gists_url":"https://api.github.com/users/mschoch/gists{/gist_id}","starred_url":"https://api.github.com/users/mschoch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mschoch/subscriptions","organizations_url":"https://api.github.com/users/mschoch/orgs","repos_url":"https://api.github.com/users/mschoch/repos","events_url":"https://api.github.com/users/mschoch/events{/privacy}","received_events_url":"https://api.github.com/users/mschoch/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"2043bb4bf8775a88ed377ceca0e5a426790eb86c","commit_url":"https://api.github.com/repos/mschoch/bleve/commits/2043bb4bf8775a88ed377ceca0e5a426790eb86c","created_at":"2016-06-01T15:35:59Z","performed_via_github_app":null},{"id":678729421,"node_id":"MDExOkNsb3NlZEV2ZW50Njc4NzI5NDIx","url":"https://api.github.com/repos/blevesearch/bleve/issues/events/678729421","actor":{"login":"mschoch","id":298143,"node_id":"MDQ6VXNlcjI5ODE0Mw==","avatar_url":"https://avatars.githubusercontent.com/u/298143?v=4","gravatar_id":"","url":"https://api.github.com/users/mschoch","html_url":"https://github.com/mschoch","followers_url":"https://api.github.com/users/mschoch/followers","following_url":"https://api.github.com/users/mschoch/following{/other_user}","gists_url":"https://api.github.com/users/mschoch/gists{/gist_id}","starred_url":"https://api.github.com/users/mschoch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mschoch/subscriptions","organizations_url":"https://api.github.com/users/mschoch/orgs","repos_url":"https://api.github.com/users/mschoch/repos","events_url":"https://api.github.com/users/mschoch/events{/privacy}","received_events_url":"https://api.github.com/users/mschoch/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2016-06-01T17:11:41Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/blevesearch/bleve/issues/comments/223061449","html_url":"https://github.com/blevesearch/bleve/issues/378#issuecomment-223061449","issue_url":"https://api.github.com/repos/blevesearch/bleve/issues/378","id":223061449,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMzA2MTQ0OQ==","user":{"login":"yields","id":1661587,"node_id":"MDQ6VXNlcjE2NjE1ODc=","avatar_url":"https://avatars.githubusercontent.com/u/1661587?v=4","gravatar_id":"","url":"https://api.github.com/users/yields","html_url":"https://github.com/yields","followers_url":"https://api.github.com/users/yields/followers","following_url":"https://api.github.com/users/yields/following{/other_user}","gists_url":"https://api.github.com/users/yields/gists{/gist_id}","starred_url":"https://api.github.com/users/yields/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yields/subscriptions","organizations_url":"https://api.github.com/users/yields/orgs","repos_url":"https://api.github.com/users/yields/repos","events_url":"https://api.github.com/users/yields/events{/privacy}","received_events_url":"https://api.github.com/users/yields/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-06-01T17:13:10Z","updated_at":"2016-06-01T17:13:10Z","body":"thanks!\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/blevesearch/bleve/issues/comments/223061449/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"yields","id":1661587,"node_id":"MDQ6VXNlcjE2NjE1ODc=","avatar_url":"https://avatars.githubusercontent.com/u/1661587?v=4","gravatar_id":"","url":"https://api.github.com/users/yields","html_url":"https://github.com/yields","followers_url":"https://api.github.com/users/yields/followers","following_url":"https://api.github.com/users/yields/following{/other_user}","gists_url":"https://api.github.com/users/yields/gists{/gist_id}","starred_url":"https://api.github.com/users/yields/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yields/subscriptions","organizations_url":"https://api.github.com/users/yields/orgs","repos_url":"https://api.github.com/users/yields/repos","events_url":"https://api.github.com/users/yields/events{/privacy}","received_events_url":"https://api.github.com/users/yields/received_events","type":"User","user_view_type":"public","site_admin":false}}]