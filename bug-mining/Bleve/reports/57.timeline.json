[{"id":238384772,"node_id":"MDEyOkxhYmVsZWRFdmVudDIzODM4NDc3Mg==","url":"https://api.github.com/repos/blevesearch/bleve/issues/events/238384772","actor":{"login":"mschoch","id":298143,"node_id":"MDQ6VXNlcjI5ODE0Mw==","avatar_url":"https://avatars.githubusercontent.com/u/298143?v=4","gravatar_id":"","url":"https://api.github.com/users/mschoch","html_url":"https://github.com/mschoch","followers_url":"https://api.github.com/users/mschoch/followers","following_url":"https://api.github.com/users/mschoch/following{/other_user}","gists_url":"https://api.github.com/users/mschoch/gists{/gist_id}","starred_url":"https://api.github.com/users/mschoch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mschoch/subscriptions","organizations_url":"https://api.github.com/users/mschoch/orgs","repos_url":"https://api.github.com/users/mschoch/repos","events_url":"https://api.github.com/users/mschoch/events{/privacy}","received_events_url":"https://api.github.com/users/mschoch/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2015-02-19T14:00:20Z","label":{"name":"enhancement","color":"84b6eb"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/blevesearch/bleve/issues/comments/75056253","html_url":"https://github.com/blevesearch/bleve/issues/165#issuecomment-75056253","issue_url":"https://api.github.com/repos/blevesearch/bleve/issues/165","id":75056253,"node_id":"MDEyOklzc3VlQ29tbWVudDc1MDU2MjUz","user":{"login":"mschoch","id":298143,"node_id":"MDQ6VXNlcjI5ODE0Mw==","avatar_url":"https://avatars.githubusercontent.com/u/298143?v=4","gravatar_id":"","url":"https://api.github.com/users/mschoch","html_url":"https://github.com/mschoch","followers_url":"https://api.github.com/users/mschoch/followers","following_url":"https://api.github.com/users/mschoch/following{/other_user}","gists_url":"https://api.github.com/users/mschoch/gists{/gist_id}","starred_url":"https://api.github.com/users/mschoch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mschoch/subscriptions","organizations_url":"https://api.github.com/users/mschoch/orgs","repos_url":"https://api.github.com/users/mschoch/repos","events_url":"https://api.github.com/users/mschoch/events{/privacy}","received_events_url":"https://api.github.com/users/mschoch/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-02-19T14:03:54Z","updated_at":"2015-02-19T14:04:04Z","body":"Note: we should only do this when encoding the value, as the constituent parts of the keys depend on fixed length coding to ensure the correct sort order.\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/blevesearch/bleve/issues/comments/75056253/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mschoch","id":298143,"node_id":"MDQ6VXNlcjI5ODE0Mw==","avatar_url":"https://avatars.githubusercontent.com/u/298143?v=4","gravatar_id":"","url":"https://api.github.com/users/mschoch","html_url":"https://github.com/mschoch","followers_url":"https://api.github.com/users/mschoch/followers","following_url":"https://api.github.com/users/mschoch/following{/other_user}","gists_url":"https://api.github.com/users/mschoch/gists{/gist_id}","starred_url":"https://api.github.com/users/mschoch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mschoch/subscriptions","organizations_url":"https://api.github.com/users/mschoch/orgs","repos_url":"https://api.github.com/users/mschoch/repos","events_url":"https://api.github.com/users/mschoch/events{/privacy}","received_events_url":"https://api.github.com/users/mschoch/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/blevesearch/bleve/issues/comments/75061381","html_url":"https://github.com/blevesearch/bleve/issues/165#issuecomment-75061381","issue_url":"https://api.github.com/repos/blevesearch/bleve/issues/165","id":75061381,"node_id":"MDEyOklzc3VlQ29tbWVudDc1MDYxMzgx","user":{"login":"mschoch","id":298143,"node_id":"MDQ6VXNlcjI5ODE0Mw==","avatar_url":"https://avatars.githubusercontent.com/u/298143?v=4","gravatar_id":"","url":"https://api.github.com/users/mschoch","html_url":"https://github.com/mschoch","followers_url":"https://api.github.com/users/mschoch/followers","following_url":"https://api.github.com/users/mschoch/following{/other_user}","gists_url":"https://api.github.com/users/mschoch/gists{/gist_id}","starred_url":"https://api.github.com/users/mschoch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mschoch/subscriptions","organizations_url":"https://api.github.com/users/mschoch/orgs","repos_url":"https://api.github.com/users/mschoch/repos","events_url":"https://api.github.com/users/mschoch/events{/privacy}","received_events_url":"https://api.github.com/users/mschoch/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-02-19T14:36:03Z","updated_at":"2015-02-19T14:36:03Z","body":"Broken test case while implementing shows we save a huge number of bytes when storing term vectors:\n\n```\n    row_test.go:95: Expected value to be [3 0 0 0 0 0 0 0 195 245 72 64] got: [3 195 235 163 130 4]\n    row_test.go:95: Expected value to be [3 0 0 0 0 0 0 0 195 245 72 64] got: [3 195 235 163 130 4]\n    row_test.go:95: Expected value to be [3 0 0 0 0 0 0 0 195 245 72 64 0 0 1 0 0 0 0 0 0 0 3 0 0 0 0 0 0 0 11 0 0 0 0 0 0 0 0 0 2 0 0 0 0 0 0 0 23 0 0 0 0 0 0 0 31 0 0 0 0 0 0 0 0 0 3 0 0 0 0 0 0 0 43 0 0 0 0 0 0 0 51 0 0 0 0 0 0 0] got: [3 195 235 163 130 4 0 1 3 11 0 2 23 31 0 3 43 51]\n```\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/blevesearch/bleve/issues/comments/75061381/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mschoch","id":298143,"node_id":"MDQ6VXNlcjI5ODE0Mw==","avatar_url":"https://avatars.githubusercontent.com/u/298143?v=4","gravatar_id":"","url":"https://api.github.com/users/mschoch","html_url":"https://github.com/mschoch","followers_url":"https://api.github.com/users/mschoch/followers","following_url":"https://api.github.com/users/mschoch/following{/other_user}","gists_url":"https://api.github.com/users/mschoch/gists{/gist_id}","starred_url":"https://api.github.com/users/mschoch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mschoch/subscriptions","organizations_url":"https://api.github.com/users/mschoch/orgs","repos_url":"https://api.github.com/users/mschoch/repos","events_url":"https://api.github.com/users/mschoch/events{/privacy}","received_events_url":"https://api.github.com/users/mschoch/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/blevesearch/bleve/issues/comments/75095993","html_url":"https://github.com/blevesearch/bleve/issues/165#issuecomment-75095993","issue_url":"https://api.github.com/repos/blevesearch/bleve/issues/165","id":75095993,"node_id":"MDEyOklzc3VlQ29tbWVudDc1MDk1OTkz","user":{"login":"mschoch","id":298143,"node_id":"MDQ6VXNlcjI5ODE0Mw==","avatar_url":"https://avatars.githubusercontent.com/u/298143?v=4","gravatar_id":"","url":"https://api.github.com/users/mschoch","html_url":"https://github.com/mschoch","followers_url":"https://api.github.com/users/mschoch/followers","following_url":"https://api.github.com/users/mschoch/following{/other_user}","gists_url":"https://api.github.com/users/mschoch/gists{/gist_id}","starred_url":"https://api.github.com/users/mschoch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mschoch/subscriptions","organizations_url":"https://api.github.com/users/mschoch/orgs","repos_url":"https://api.github.com/users/mschoch/repos","events_url":"https://api.github.com/users/mschoch/events{/privacy}","received_events_url":"https://api.github.com/users/mschoch/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-02-19T17:26:00Z","updated_at":"2015-02-19T17:26:00Z","body":"Strangely, now that i have this implemented, it offers no noticeable gain in indexing or search speed, even though we seem to read/write substantially less data.\n\nPerformance is hard.\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/blevesearch/bleve/issues/comments/75095993/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mschoch","id":298143,"node_id":"MDQ6VXNlcjI5ODE0Mw==","avatar_url":"https://avatars.githubusercontent.com/u/298143?v=4","gravatar_id":"","url":"https://api.github.com/users/mschoch","html_url":"https://github.com/mschoch","followers_url":"https://api.github.com/users/mschoch/followers","following_url":"https://api.github.com/users/mschoch/following{/other_user}","gists_url":"https://api.github.com/users/mschoch/gists{/gist_id}","starred_url":"https://api.github.com/users/mschoch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mschoch/subscriptions","organizations_url":"https://api.github.com/users/mschoch/orgs","repos_url":"https://api.github.com/users/mschoch/repos","events_url":"https://api.github.com/users/mschoch/events{/privacy}","received_events_url":"https://api.github.com/users/mschoch/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/blevesearch/bleve/issues/comments/77599595","html_url":"https://github.com/blevesearch/bleve/issues/165#issuecomment-77599595","issue_url":"https://api.github.com/repos/blevesearch/bleve/issues/165","id":77599595,"node_id":"MDEyOklzc3VlQ29tbWVudDc3NTk5NTk1","user":{"login":"mschoch","id":298143,"node_id":"MDQ6VXNlcjI5ODE0Mw==","avatar_url":"https://avatars.githubusercontent.com/u/298143?v=4","gravatar_id":"","url":"https://api.github.com/users/mschoch","html_url":"https://github.com/mschoch","followers_url":"https://api.github.com/users/mschoch/followers","following_url":"https://api.github.com/users/mschoch/following{/other_user}","gists_url":"https://api.github.com/users/mschoch/gists{/gist_id}","starred_url":"https://api.github.com/users/mschoch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mschoch/subscriptions","organizations_url":"https://api.github.com/users/mschoch/orgs","repos_url":"https://api.github.com/users/mschoch/repos","events_url":"https://api.github.com/users/mschoch/events{/privacy}","received_events_url":"https://api.github.com/users/mschoch/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-03-06T17:31:18Z","updated_at":"2015-03-06T17:31:18Z","body":"OK, it turns out my assessment about there not being an improvement was wrong.  I was looking at bleve-bench which disables term vectors, which is where the biggest savings come from.\n\nHere are the leveldb benchmarks before and after:\n\n$ benchcmp b.txt a.txt\nbenchmark                                     old ns/op     new ns/op     delta\nBenchmarkLevelDBIndexing1Workers              1138292       657901        -42.20%\nBenchmarkLevelDBIndexing2Workers              1619323       647628        -60.01%\nBenchmarkLevelDBIndexing4Workers              1172845       636478        -45.73%\nBenchmarkLevelDBIndexing1Workers10Batch       465556545     448153394     -3.74%\nBenchmarkLevelDBIndexing2Workers10Batch       504203911     449657355     -10.82%\nBenchmarkLevelDBIndexing4Workers10Batch       510766435     439839335     -13.89%\nBenchmarkLevelDBIndexing1Workers100Batch      307657846     268976464     -12.57%\nBenchmarkLevelDBIndexing2Workers100Batch      302257400     269110215     -10.97%\nBenchmarkLevelDBIndexing4Workers100Batch      305320485     259084902     -15.14%\nBenchmarkLevelDBIndexing1Workers1000Batch     301320576     258070231     -14.35%\nBenchmarkLevelDBIndexing2Workers1000Batch     334174454     261175641     -21.84%\nBenchmarkLevelDBIndexing4Workers1000Batch     267732436     261461739     -2.34%\n\nAnd here is the data when I loaded the beer-sample:\n\nBoltDB Before:\n2015/03/06 11:34:45 Indexed 7303 documents, in 39.56s (average 5.42ms/doc)\n$ du -sh beer-search.bleve/\n252M    beer-search.bleve/\n\nBoltDB After:\n2015/03/06 11:36:02 Indexed 7303 documents, in 35.84s (average 4.91ms/doc)\n$ du -sh beer-search.bleve/\n201M    beer-search.bleve/\n\nLevelDB Before:\n2015/03/06 11:41:09 Indexed 7303 documents, in 27.54s (average 3.77ms/doc)\n$ du -sh beer-search.bleve/\n 45M    beer-search.bleve/\n\nLevelDB After:\n2015/03/06 11:42:16 Indexed 7303 documents, in 24.08s (average 3.30ms/doc)\n$ du -sh beer-search.bleve/\n 42M    beer-search.bleve/\n\nSo there are performance gains in both KV stores when working with real world data that includes term vectors.  The space savings are less with LevelDB, and this makes sense as it is also doing Snappy compression, which would probably eat up a lot of the sequences of 0's from non-variable length ints.\n\nBased on this I'll be running a few more tests and proceeding to merge.\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/blevesearch/bleve/issues/comments/77599595/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mschoch","id":298143,"node_id":"MDQ6VXNlcjI5ODE0Mw==","avatar_url":"https://avatars.githubusercontent.com/u/298143?v=4","gravatar_id":"","url":"https://api.github.com/users/mschoch","html_url":"https://github.com/mschoch","followers_url":"https://api.github.com/users/mschoch/followers","following_url":"https://api.github.com/users/mschoch/following{/other_user}","gists_url":"https://api.github.com/users/mschoch/gists{/gist_id}","starred_url":"https://api.github.com/users/mschoch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mschoch/subscriptions","organizations_url":"https://api.github.com/users/mschoch/orgs","repos_url":"https://api.github.com/users/mschoch/repos","events_url":"https://api.github.com/users/mschoch/events{/privacy}","received_events_url":"https://api.github.com/users/mschoch/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":247669825,"node_id":"MDExOkNsb3NlZEV2ZW50MjQ3NjY5ODI1","url":"https://api.github.com/repos/blevesearch/bleve/issues/events/247669825","actor":{"login":"mschoch","id":298143,"node_id":"MDQ6VXNlcjI5ODE0Mw==","avatar_url":"https://avatars.githubusercontent.com/u/298143?v=4","gravatar_id":"","url":"https://api.github.com/users/mschoch","html_url":"https://github.com/mschoch","followers_url":"https://api.github.com/users/mschoch/followers","following_url":"https://api.github.com/users/mschoch/following{/other_user}","gists_url":"https://api.github.com/users/mschoch/gists{/gist_id}","starred_url":"https://api.github.com/users/mschoch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mschoch/subscriptions","organizations_url":"https://api.github.com/users/mschoch/orgs","repos_url":"https://api.github.com/users/mschoch/repos","events_url":"https://api.github.com/users/mschoch/events{/privacy}","received_events_url":"https://api.github.com/users/mschoch/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"a2ad7634f27e19e201ab09b484e4b0f4deab49e0","commit_url":"https://api.github.com/repos/blevesearch/bleve/commits/a2ad7634f27e19e201ab09b484e4b0f4deab49e0","created_at":"2015-03-06T18:01:34Z","state_reason":null,"performed_via_github_app":null}]