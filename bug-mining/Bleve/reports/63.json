{"url":"https://api.github.com/repos/blevesearch/bleve/issues/178","repository_url":"https://api.github.com/repos/blevesearch/bleve","labels_url":"https://api.github.com/repos/blevesearch/bleve/issues/178/labels{/name}","comments_url":"https://api.github.com/repos/blevesearch/bleve/issues/178/comments","events_url":"https://api.github.com/repos/blevesearch/bleve/issues/178/events","html_url":"https://github.com/blevesearch/bleve/issues/178","id":62615369,"node_id":"MDU6SXNzdWU2MjYxNTM2OQ==","number":178,"title":"\"slice bounds out of range error\"  when using cjk analyzer and highlight","user":{"login":"wangbin","id":15247,"node_id":"MDQ6VXNlcjE1MjQ3","avatar_url":"https://avatars.githubusercontent.com/u/15247?v=4","gravatar_id":"","url":"https://api.github.com/users/wangbin","html_url":"https://github.com/wangbin","followers_url":"https://api.github.com/users/wangbin/followers","following_url":"https://api.github.com/users/wangbin/following{/other_user}","gists_url":"https://api.github.com/users/wangbin/gists{/gist_id}","starred_url":"https://api.github.com/users/wangbin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wangbin/subscriptions","organizations_url":"https://api.github.com/users/wangbin/orgs","repos_url":"https://api.github.com/users/wangbin/repos","events_url":"https://api.github.com/users/wangbin/events{/privacy}","received_events_url":"https://api.github.com/users/wangbin/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2015-03-18T07:44:34Z","updated_at":"2015-03-18T18:35:22Z","closed_at":"2015-03-18T18:35:22Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hi, I'm learning bleve, following is a small program modified from wiki:\n\n``` !go\npackage main\n\nimport (\n    \"fmt\"\n\n    \"github.com/blevesearch/bleve\"\n)\n\nfunc main() {\n    // open a new index\n    mapping := bleve.NewIndexMapping()\n    mapping.DefaultAnalyzer = \"cjk\"\n    index, err := bleve.New(\"example.bleve\", mapping)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n\n    data := struct {\n        Name string\n    }{\n        Name: \"交换机\",\n    }\n\n    // index some data\n    index.Index(\"id\", data)\n\n    // search for some text\n    query := bleve.NewMatchQuery(\"交换机\")\n    search := bleve.NewSearchRequest(query)\n    search.Highlight = bleve.NewHighlight()\n    searchResults, err := index.Search(search)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    fmt.Println(searchResults)\n}\n```\n\nWhen run the code I got a panic:\n\n```\npanic: runtime error: slice bounds out of range\n\ngoroutine 1 [running]:\ngithub.com/blevesearch/bleve/search/highlight/fragmenters/simple.(*Fragmenter).Fragment(0xc20800adc0, 0xc022a5, 0x9, 0x7ffffe1f, 0xc20800be50, 0x2, 0x2, 0x0, 0x0, 0x0)\n        /Users/wangbin/mygo/src/github.com/blevesearch/bleve/search/highlight/fragmenters/simple/fragmenter_simple.go:82 +0x8f0\ngithub.com/blevesearch/bleve/search/highlight/highlighters/simple.(*Highlighter).BestFragmentsInField(0xc20803b260, 0xc20802b200, 0xc20802b2c0, 0x4922e0, 0x4, 0x1, 0x0, 0x0, 0x0)\n        /Users/wangbin/mygo/src/github.com/blevesearch/bleve/search/highlight/highlighters/simple/highlighter_simple.go:84 +0x403\ngithub.com/blevesearch/bleve.(*indexImpl).Search(0xc2080116c0, 0xc20802eff0, 0x0, 0x0, 0x0)\n        /Users/wangbin/mygo/src/github.com/blevesearch/bleve/index_impl.go:447 +0x13a0\nmain.main()\n        /Users/wangbin/tmp/bl/bl2.go:32 +0x34a\n\ngoroutine 5 [chan receive]:\ngithub.com/blevesearch/bleve/index/upside_down.AnalysisWorker(0xc208030120)\n        /Users/wangbin/mygo/src/github.com/blevesearch/bleve/index/upside_down/analysis_pool.go:40 +0x73\ncreated by github.com/blevesearch/bleve/index/upside_down.NewAnalysisQueue\n        /Users/wangbin/mygo/src/github.com/blevesearch/bleve/index/upside_down/analysis_pool.go:32 +0x66\n\ngoroutine 6 [chan receive]:\ngithub.com/blevesearch/bleve/index/upside_down.AnalysisWorker(0xc208030120)\n        /Users/wangbin/mygo/src/github.com/blevesearch/bleve/index/upside_down/analysis_pool.go:40 +0x73\ncreated by github.com/blevesearch/bleve/index/upside_down.NewAnalysisQueue\n        /Users/wangbin/mygo/src/github.com/blevesearch/bleve/index/upside_down/analysis_pool.go:32 +0x66\n\ngoroutine 7 [chan receive]:\ngithub.com/blevesearch/bleve/index/upside_down.AnalysisWorker(0xc208030120)\n        /Users/wangbin/mygo/src/github.com/blevesearch/bleve/index/upside_down/analysis_pool.go:40 +0x73\ncreated by github.com/blevesearch/bleve/index/upside_down.NewAnalysisQueue\n        /Users/wangbin/mygo/src/github.com/blevesearch/bleve/index/upside_down/analysis_pool.go:32 +0x66\n\ngoroutine 8 [chan receive]:\ngithub.com/blevesearch/bleve/index/upside_down.AnalysisWorker(0xc208030120)\n        /Users/wangbin/mygo/src/github.com/blevesearch/bleve/index/upside_down/analysis_pool.go:40 +0x73\ncreated by github.com/blevesearch/bleve/index/upside_down.NewAnalysisQueue\n        /Users/wangbin/mygo/src/github.com/blevesearch/bleve/index/upside_down/analysis_pool.go:32 +0x66\nexit status 2\n```\n\nI did some research, in [Fragment](https://github.com/blevesearch/bleve/blob/master/search/highlight/fragmenters/simple/fragmenter_simple.go#L33) function, I got two TermLocations:\n\n```\nTerm: 交换, start: 65, end: 71\nTerm: 换机, start: 68, end: 74\n```\n\nThe first one's End is larger than the second's Start, which cause the problem in [line 82](https://github.com/blevesearch/bleve/blob/master/search/highlight/fragmenters/simple/fragmenter_simple.go#L82), my guess is the code should check maxbegin is bigger than start to avoid this problem?\n","closed_by":{"login":"mschoch","id":298143,"node_id":"MDQ6VXNlcjI5ODE0Mw==","avatar_url":"https://avatars.githubusercontent.com/u/298143?v=4","gravatar_id":"","url":"https://api.github.com/users/mschoch","html_url":"https://github.com/mschoch","followers_url":"https://api.github.com/users/mschoch/followers","following_url":"https://api.github.com/users/mschoch/following{/other_user}","gists_url":"https://api.github.com/users/mschoch/gists{/gist_id}","starred_url":"https://api.github.com/users/mschoch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mschoch/subscriptions","organizations_url":"https://api.github.com/users/mschoch/orgs","repos_url":"https://api.github.com/users/mschoch/repos","events_url":"https://api.github.com/users/mschoch/events{/privacy}","received_events_url":"https://api.github.com/users/mschoch/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/blevesearch/bleve/issues/178/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/blevesearch/bleve/issues/178/timeline","performed_via_github_app":null,"state_reason":"completed"}