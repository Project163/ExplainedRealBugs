{"url":"https://api.github.com/repos/blevesearch/bleve/issues/392","repository_url":"https://api.github.com/repos/blevesearch/bleve","labels_url":"https://api.github.com/repos/blevesearch/bleve/issues/392/labels{/name}","comments_url":"https://api.github.com/repos/blevesearch/bleve/issues/392/comments","events_url":"https://api.github.com/repos/blevesearch/bleve/issues/392/events","html_url":"https://github.com/blevesearch/bleve/issues/392","id":162329271,"node_id":"MDU6SXNzdWUxNjIzMjkyNzE=","number":392,"title":"PROPOSAL: remove byte_array_converters","user":{"login":"mschoch","id":298143,"node_id":"MDQ6VXNlcjI5ODE0Mw==","avatar_url":"https://avatars.githubusercontent.com/u/298143?v=4","gravatar_id":"","url":"https://api.github.com/users/mschoch","html_url":"https://github.com/mschoch","followers_url":"https://api.github.com/users/mschoch/followers","following_url":"https://api.github.com/users/mschoch/following{/other_user}","gists_url":"https://api.github.com/users/mschoch/gists{/gist_id}","starred_url":"https://api.github.com/users/mschoch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mschoch/subscriptions","organizations_url":"https://api.github.com/users/mschoch/orgs","repos_url":"https://api.github.com/users/mschoch/repos","events_url":"https://api.github.com/users/mschoch/events{/privacy}","received_events_url":"https://api.github.com/users/mschoch/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":93294326,"node_id":"MDU6TGFiZWw5MzI5NDMyNg==","url":"https://api.github.com/repos/blevesearch/bleve/labels/enhancement","name":"enhancement","color":"84b6eb","default":true,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/blevesearch/bleve/milestones/1","html_url":"https://github.com/blevesearch/bleve/milestone/1","labels_url":"https://api.github.com/repos/blevesearch/bleve/milestones/1/labels","id":1829370,"node_id":"MDk6TWlsZXN0b25lMTgyOTM3MA==","number":1,"title":"1.0","description":"An issue which must be addressed before the 1.0 release.","creator":{"login":"mschoch","id":298143,"node_id":"MDQ6VXNlcjI5ODE0Mw==","avatar_url":"https://avatars.githubusercontent.com/u/298143?v=4","gravatar_id":"","url":"https://api.github.com/users/mschoch","html_url":"https://github.com/mschoch","followers_url":"https://api.github.com/users/mschoch/followers","following_url":"https://api.github.com/users/mschoch/following{/other_user}","gists_url":"https://api.github.com/users/mschoch/gists{/gist_id}","starred_url":"https://api.github.com/users/mschoch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mschoch/subscriptions","organizations_url":"https://api.github.com/users/mschoch/orgs","repos_url":"https://api.github.com/users/mschoch/repos","events_url":"https://api.github.com/users/mschoch/events{/privacy}","received_events_url":"https://api.github.com/users/mschoch/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":18,"closed_issues":17,"state":"closed","created_at":"2016-06-15T15:21:36Z","updated_at":"2020-10-06T21:23:22Z","due_on":null,"closed_at":"2020-10-06T21:23:22Z"},"comments":2,"created_at":"2016-06-26T14:06:24Z","updated_at":"2016-08-10T20:24:11Z","closed_at":"2016-07-01T14:23:29Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"The bleve index mapping allows you to configure something called a \"byte_array_converter\".  The original idea was to let you pass in a slice of bytes to the top-level Index() method and have bleve make sense of the data.\n\nThe default \"byte_array_converter\" attempts to parse the bytes as JSON, and then index the resulting data structure.  This was intended as a convenience for people building applications that worked with JSON.\n### PROBLEM\n\nIf the bytes fail to parse as JSON, all bleve methods return an error.  This poses 2 real problems for applications:\n1.  Batch operations end up getting aborted because of 1 bad document\n2.  Applications may want to catch this error and handle it themselves (possibly indexing stub document instead)\n\nThe good news is that applications can already do this themselves.  They simply parse the JSON themselves first, detect/handle errors, and then pass the resulting structures on to Bleve.\n\nOur observation has been that real applications are better served doing this themselves.\n### PROPOSAL\n\nRather than try to fix the problems, we propose to remove byte_array_converters completely.\n1.  Initially we envisioned that there would be several more implementations.  In practice this didn't actually materialize.\n2.  By making this change we can remove code from the analyzer sub-package and in one small way simplify the mapping.  Although its a small simplification, the mapping is the most complex part of bleve, so it is a welcome change.\n### UPDATING YOUR APP\n\nIf your application fed raw JSON bytes into bleve as:\n\n```\n    err := bleve.Index(id, jsonbytes)\n```\n\nYou would now need to write:\n\n```\n    var jsondoc interface{}\n    err := json.Unmarshal(jsonbytes, &jsondoc)\n    if err != nil {\n        err = bleve.Index(id, jsondoc)\n    }\n```\n","closed_by":{"login":"mschoch","id":298143,"node_id":"MDQ6VXNlcjI5ODE0Mw==","avatar_url":"https://avatars.githubusercontent.com/u/298143?v=4","gravatar_id":"","url":"https://api.github.com/users/mschoch","html_url":"https://github.com/mschoch","followers_url":"https://api.github.com/users/mschoch/followers","following_url":"https://api.github.com/users/mschoch/following{/other_user}","gists_url":"https://api.github.com/users/mschoch/gists{/gist_id}","starred_url":"https://api.github.com/users/mschoch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mschoch/subscriptions","organizations_url":"https://api.github.com/users/mschoch/orgs","repos_url":"https://api.github.com/users/mschoch/repos","events_url":"https://api.github.com/users/mschoch/events{/privacy}","received_events_url":"https://api.github.com/users/mschoch/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/blevesearch/bleve/issues/392/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/blevesearch/bleve/issues/392/timeline","performed_via_github_app":null,"state_reason":"completed"}