{"url":"https://api.github.com/repos/blevesearch/bleve/issues/281","repository_url":"https://api.github.com/repos/blevesearch/bleve","labels_url":"https://api.github.com/repos/blevesearch/bleve/issues/281/labels{/name}","comments_url":"https://api.github.com/repos/blevesearch/bleve/issues/281/comments","events_url":"https://api.github.com/repos/blevesearch/bleve/issues/281/events","html_url":"https://github.com/blevesearch/bleve/issues/281","id":117519391,"node_id":"MDU6SXNzdWUxMTc1MTkzOTE=","number":281,"title":"Support encoding.TextMarshaler interface when indexing Go types","user":{"login":"mmindenhall","id":1106269,"node_id":"MDQ6VXNlcjExMDYyNjk=","avatar_url":"https://avatars.githubusercontent.com/u/1106269?v=4","gravatar_id":"","url":"https://api.github.com/users/mmindenhall","html_url":"https://github.com/mmindenhall","followers_url":"https://api.github.com/users/mmindenhall/followers","following_url":"https://api.github.com/users/mmindenhall/following{/other_user}","gists_url":"https://api.github.com/users/mmindenhall/gists{/gist_id}","starred_url":"https://api.github.com/users/mmindenhall/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mmindenhall/subscriptions","organizations_url":"https://api.github.com/users/mmindenhall/orgs","repos_url":"https://api.github.com/users/mmindenhall/repos","events_url":"https://api.github.com/users/mmindenhall/events{/privacy}","received_events_url":"https://api.github.com/users/mmindenhall/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":93294326,"node_id":"MDU6TGFiZWw5MzI5NDMyNg==","url":"https://api.github.com/repos/blevesearch/bleve/labels/enhancement","name":"enhancement","color":"84b6eb","default":true,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/blevesearch/bleve/milestones/1","html_url":"https://github.com/blevesearch/bleve/milestone/1","labels_url":"https://api.github.com/repos/blevesearch/bleve/milestones/1/labels","id":1829370,"node_id":"MDk6TWlsZXN0b25lMTgyOTM3MA==","number":1,"title":"1.0","description":"An issue which must be addressed before the 1.0 release.","creator":{"login":"mschoch","id":298143,"node_id":"MDQ6VXNlcjI5ODE0Mw==","avatar_url":"https://avatars.githubusercontent.com/u/298143?v=4","gravatar_id":"","url":"https://api.github.com/users/mschoch","html_url":"https://github.com/mschoch","followers_url":"https://api.github.com/users/mschoch/followers","following_url":"https://api.github.com/users/mschoch/following{/other_user}","gists_url":"https://api.github.com/users/mschoch/gists{/gist_id}","starred_url":"https://api.github.com/users/mschoch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mschoch/subscriptions","organizations_url":"https://api.github.com/users/mschoch/orgs","repos_url":"https://api.github.com/users/mschoch/repos","events_url":"https://api.github.com/users/mschoch/events{/privacy}","received_events_url":"https://api.github.com/users/mschoch/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":18,"closed_issues":17,"state":"closed","created_at":"2016-06-15T15:21:36Z","updated_at":"2020-10-06T21:23:22Z","due_on":null,"closed_at":"2020-10-06T21:23:22Z"},"comments":6,"created_at":"2015-11-18T06:06:33Z","updated_at":"2017-05-19T13:54:10Z","closed_at":"2017-05-19T13:54:09Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"The standard library includes a set of Marshaler/Unmarshaler interfaces that can be implemented by types to convert to/from different data encodings.\n- `json.Marshaler` / `json.Unmarshaler`\n- `xml.Marshaler` / `xml.Unmarshaler`\n- `encoding.TextMarshaler` / `encoding.TextUnmarshaler`\n- etc.\n\nSince bleve is for \"full-text search and indexing\", it makes sense (at least IMHO) for bleve to support the [`encoding.TextMarshaler`](https://golang.org/pkg/encoding/#TextMarshaler) interface when indexing Go types (i.e., structs, fields within structs, map values, slice/array elements, dereferenced pointers).  This provides some flexibility in mapping from an internal representation within a defined type, to a canonical text representation that should be used for indexing.\n\nI have a specific use case where this is needed.  I've been working on creating indexed document types from structs that use [bson.ObjectId](https://godoc.org/gopkg.in/mgo.v2/bson#ObjectId) as an ID.  For example:\n\n``` go\ntype BaseModel struct {\n    Id        bson.ObjectId `json:\"id\"`\n    CreatedAt *time.Time    `json:\"created_at\"`\n    UpdatedAt *time.Time    `json:\"updated_at\"`\n}\n```\n\nI'm having difficulty indexing this as a struct because what gets indexed is the internal 12-byte representation cast as a string rather than the hex-encoded representation that's used when encoding to/from JSON.  I need to query using the hex string representation, but this returns \"No matches\".  There's an outstanding [pull request](https://github.com/go-mgo/mgo/pull/79) for `bson.ObjectId` to implement the `encoding.TextMarshaler` and `encoding.TextUnmarshaler` interfaces to convert the internal 12-byte representation to/from a hex string.  Combining that pull request with `TextMarshaler` support in bleve, it would be possible to correctly index this type.\n\nOf course, I'm able to work around this issue by marshaling my struct to JSON and indexing that representation, but it would be nice to avoid the extra step!\n","closed_by":{"login":"mschoch","id":298143,"node_id":"MDQ6VXNlcjI5ODE0Mw==","avatar_url":"https://avatars.githubusercontent.com/u/298143?v=4","gravatar_id":"","url":"https://api.github.com/users/mschoch","html_url":"https://github.com/mschoch","followers_url":"https://api.github.com/users/mschoch/followers","following_url":"https://api.github.com/users/mschoch/following{/other_user}","gists_url":"https://api.github.com/users/mschoch/gists{/gist_id}","starred_url":"https://api.github.com/users/mschoch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mschoch/subscriptions","organizations_url":"https://api.github.com/users/mschoch/orgs","repos_url":"https://api.github.com/users/mschoch/repos","events_url":"https://api.github.com/users/mschoch/events{/privacy}","received_events_url":"https://api.github.com/users/mschoch/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/blevesearch/bleve/issues/281/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/blevesearch/bleve/issues/281/timeline","performed_via_github_app":null,"state_reason":"completed"}