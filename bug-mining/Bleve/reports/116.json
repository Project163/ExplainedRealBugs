{"url":"https://api.github.com/repos/blevesearch/bleve/issues/449","repository_url":"https://api.github.com/repos/blevesearch/bleve","labels_url":"https://api.github.com/repos/blevesearch/bleve/issues/449/labels{/name}","comments_url":"https://api.github.com/repos/blevesearch/bleve/issues/449/comments","events_url":"https://api.github.com/repos/blevesearch/bleve/issues/449/events","html_url":"https://github.com/blevesearch/bleve/issues/449","id":179111126,"node_id":"MDU6SXNzdWUxNzkxMTExMjY=","number":449,"title":"Wrong search results from BooleanQuery with must-not of DocIDQuery","user":{"login":"slavikm","id":1479247,"node_id":"MDQ6VXNlcjE0NzkyNDc=","avatar_url":"https://avatars.githubusercontent.com/u/1479247?v=4","gravatar_id":"","url":"https://api.github.com/users/slavikm","html_url":"https://github.com/slavikm","followers_url":"https://api.github.com/users/slavikm/followers","following_url":"https://api.github.com/users/slavikm/following{/other_user}","gists_url":"https://api.github.com/users/slavikm/gists{/gist_id}","starred_url":"https://api.github.com/users/slavikm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/slavikm/subscriptions","organizations_url":"https://api.github.com/users/slavikm/orgs","repos_url":"https://api.github.com/users/slavikm/repos","events_url":"https://api.github.com/users/slavikm/events{/privacy}","received_events_url":"https://api.github.com/users/slavikm/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2016-09-25T21:47:19Z","updated_at":"2016-09-26T16:44:09Z","closed_at":"2016-09-26T16:44:09Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"``` go\npackage temp\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n    \"os\"\n    \"testing\"\n\n    \"github.com/blevesearch/bleve\"\n    \"github.com/blevesearch/bleve/analysis/analyzers/keyword_analyzer\"\n    \"github.com/blevesearch/bleve/analysis/analyzers/standard_analyzer\"\n    \"github.com/stretchr/testify/assert\"\n    uuid \"github.com/wayn3h0/go-uuid\"\n)\n\ntype Person struct {\n    ID   string `json:\"id\"`\n    Name string `json:\"name\"`\n}\n\nfunc ToJSONString(in interface{}) string {\n    b, err := json.MarshalIndent(in, \"\", \"  \")\n    if err != nil {\n        return \"\"\n    }\n    return string(b)\n}\n\nfunc TestBleveSearchNotId(t *testing.T) {\n    m := bleve.NewDocumentMapping()\n    m.DefaultAnalyzer = standard_analyzer.Name\n    fm := bleve.NewTextFieldMapping()\n    fm.Analyzer = keyword_analyzer.Name\n    m.AddFieldMappingsAt(\"id\", fm)\n    m.AddFieldMappingsAt(\"name\", fm)\n\n    im := bleve.NewIndexMapping()\n    im.DefaultMapping = m\n    im.DefaultAnalyzer = standard_analyzer.Name\n\n    idx, err := bleve.New(\"/tmp/bleveidx\", im)\n    defer fmt.Println(\"removing \", os.RemoveAll(\"/tmp/bleveidx\"))\n\n    if err != nil {\n        t.Fatal(err)\n    }\n\n    uids := []string{}\n\n    for i := 0; i < 100; i++ {\n        uid, err := uuid.NewRandom()\n        if err != nil {\n            fmt.Println(\"Failed generating uuid\")\n        }\n        uids = append(uids, uid.String())\n        p := &Person{ID: uid.String(), Name: fmt.Sprintf(\"%d\", i)}\n        idx.Index(p.ID, p)\n    }\n\n    query := bleve.NewBooleanQuery(nil, nil, []bleve.Query{bleve.NewDocIDQuery(uids[:50])})\n    sr := bleve.NewSearchRequestOptions(query, 10000, 0, false)\n    sr.Fields = []string{\"name\"}\n    res, err := idx.Search(sr)\n    fmt.Println(ToJSONString(res))\n    assert.EqualValues(t, 50, res.Total)\n}\n```\n\nQuery returns different numbers in Total instead of 50 (99, 90, etc.).\nThis used to work with the version from July 21st (revision 5934a185f373271acd18b10b14875302298e6a1b)\n","closed_by":{"login":"mschoch","id":298143,"node_id":"MDQ6VXNlcjI5ODE0Mw==","avatar_url":"https://avatars.githubusercontent.com/u/298143?v=4","gravatar_id":"","url":"https://api.github.com/users/mschoch","html_url":"https://github.com/mschoch","followers_url":"https://api.github.com/users/mschoch/followers","following_url":"https://api.github.com/users/mschoch/following{/other_user}","gists_url":"https://api.github.com/users/mschoch/gists{/gist_id}","starred_url":"https://api.github.com/users/mschoch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mschoch/subscriptions","organizations_url":"https://api.github.com/users/mschoch/orgs","repos_url":"https://api.github.com/users/mschoch/repos","events_url":"https://api.github.com/users/mschoch/events{/privacy}","received_events_url":"https://api.github.com/users/mschoch/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/blevesearch/bleve/issues/449/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/blevesearch/bleve/issues/449/timeline","performed_via_github_app":null,"state_reason":"completed"}