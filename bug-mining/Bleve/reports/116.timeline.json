[{"url":"https://api.github.com/repos/blevesearch/bleve/issues/comments/249449292","html_url":"https://github.com/blevesearch/bleve/issues/449#issuecomment-249449292","issue_url":"https://api.github.com/repos/blevesearch/bleve/issues/449","id":249449292,"node_id":"MDEyOklzc3VlQ29tbWVudDI0OTQ0OTI5Mg==","user":{"login":"slavikm","id":1479247,"node_id":"MDQ6VXNlcjE0NzkyNDc=","avatar_url":"https://avatars.githubusercontent.com/u/1479247?v=4","gravatar_id":"","url":"https://api.github.com/users/slavikm","html_url":"https://github.com/slavikm","followers_url":"https://api.github.com/users/slavikm/followers","following_url":"https://api.github.com/users/slavikm/following{/other_user}","gists_url":"https://api.github.com/users/slavikm/gists{/gist_id}","starred_url":"https://api.github.com/users/slavikm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/slavikm/subscriptions","organizations_url":"https://api.github.com/users/slavikm/orgs","repos_url":"https://api.github.com/users/slavikm/repos","events_url":"https://api.github.com/users/slavikm/events{/privacy}","received_events_url":"https://api.github.com/users/slavikm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-09-25T21:58:01Z","updated_at":"2016-09-25T21:58:01Z","body":"PS - if you place the DocIDQuery in the must instead of must-not it does work without issues.\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/blevesearch/bleve/issues/comments/249449292/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"slavikm","id":1479247,"node_id":"MDQ6VXNlcjE0NzkyNDc=","avatar_url":"https://avatars.githubusercontent.com/u/1479247?v=4","gravatar_id":"","url":"https://api.github.com/users/slavikm","html_url":"https://github.com/slavikm","followers_url":"https://api.github.com/users/slavikm/followers","following_url":"https://api.github.com/users/slavikm/following{/other_user}","gists_url":"https://api.github.com/users/slavikm/gists{/gist_id}","starred_url":"https://api.github.com/users/slavikm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/slavikm/subscriptions","organizations_url":"https://api.github.com/users/slavikm/orgs","repos_url":"https://api.github.com/users/slavikm/repos","events_url":"https://api.github.com/users/slavikm/events{/privacy}","received_events_url":"https://api.github.com/users/slavikm/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/blevesearch/bleve/issues/comments/249450947","html_url":"https://github.com/blevesearch/bleve/issues/449#issuecomment-249450947","issue_url":"https://api.github.com/repos/blevesearch/bleve/issues/449","id":249450947,"node_id":"MDEyOklzc3VlQ29tbWVudDI0OTQ1MDk0Nw==","user":{"login":"mschoch","id":298143,"node_id":"MDQ6VXNlcjI5ODE0Mw==","avatar_url":"https://avatars.githubusercontent.com/u/298143?v=4","gravatar_id":"","url":"https://api.github.com/users/mschoch","html_url":"https://github.com/mschoch","followers_url":"https://api.github.com/users/mschoch/followers","following_url":"https://api.github.com/users/mschoch/following{/other_user}","gists_url":"https://api.github.com/users/mschoch/gists{/gist_id}","starred_url":"https://api.github.com/users/mschoch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mschoch/subscriptions","organizations_url":"https://api.github.com/users/mschoch/orgs","repos_url":"https://api.github.com/users/mschoch/repos","events_url":"https://api.github.com/users/mschoch/events{/privacy}","received_events_url":"https://api.github.com/users/mschoch/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-09-25T22:33:20Z","updated_at":"2016-09-25T22:33:20Z","body":"Thanks for reporting this, I used git bisect to find the commit that introduced the problem and got this:\n\n```\n$ git bisect good\n5aa9e954687e82541ee37ed70f7fdcd709ca6f69 is the first bad commit\ncommit 5aa9e954687e82541ee37ed70f7fdcd709ca6f69\nAuthor: Marty Schoch <marty.schoch@gmail.com>\nDate:   Sun Jul 31 13:46:18 2016 -0400\n\n    major refactor of index/search API\n\n    index id's are now opaque (until finally returned to top-level user)\n     - the TermFieldDoc's returned by TermFieldReader no longer contain doc id\n     - instead they return an opaque IndexInternalID\n     - items returned are still in the \"natural index order\"\n     - but that is no longer guaranteed to be \"doc id order\"\n     - correct behavior requires that they all follow the same order\n     - but not any particular order\n\n     - new API FinalizeDocID which converts index internal ID's to public string ID\n\n     - APIs used internally which previously took doc id now take IndexInternalID\n         - that is DocumentFieldTerms() and DocumentFieldTermsForFields()\n     - however, APIs that are used externally do not reflect this change\n         - that is Document()\n\n     - DocumentIDReader follows the same changes, but this is less obvious\n         - behavior clarified, used to iterate doc ids, BUT NOT in doc id order\n         - method STILL available to iterate doc ids in range\n         - but again, you won't get them in any meaningful order\n         - new method to iterate actual doc ids from list of possible ids\n             - this was introduced to make the DocIDSearcher continue working\n\n    searchers now work with the new opaque index internal doc ids\n     - they return new DocumentMatchInternal (which does not have string ID)\n    scorerers also work with these opaque index internal doc ids\n     - they return DocumentMatchInternal (which does not have string ID)\n    collectors now also perform a final step of converting the final result\n     - they STILL return traditional DocumentMatch (with string ID)\n     - but they now also require an IndexReader (so that they can do the conversion)\n\n:040000 040000 7930ff57b5e5e344b3cbb9c2949b57124ed2d451 2808b525c607d16f7028494c5191a7ba9db8dab1 M  index\n:100644 100644 f914ec942241154b343c300ec6805ac05ce1bf7d 66c33f8c96effb251f68ffb711bd18a9e180c086 M  index_impl.go\n:040000 040000 c9fa197d26a2ab13129c23545a7f62e8e05b969c cb4ad33518d0c861293126cf0fffe39521a968c4 M  search\n```\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/blevesearch/bleve/issues/comments/249450947/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mschoch","id":298143,"node_id":"MDQ6VXNlcjI5ODE0Mw==","avatar_url":"https://avatars.githubusercontent.com/u/298143?v=4","gravatar_id":"","url":"https://api.github.com/users/mschoch","html_url":"https://github.com/mschoch","followers_url":"https://api.github.com/users/mschoch/followers","following_url":"https://api.github.com/users/mschoch/following{/other_user}","gists_url":"https://api.github.com/users/mschoch/gists{/gist_id}","starred_url":"https://api.github.com/users/mschoch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mschoch/subscriptions","organizations_url":"https://api.github.com/users/mschoch/orgs","repos_url":"https://api.github.com/users/mschoch/repos","events_url":"https://api.github.com/users/mschoch/events{/privacy}","received_events_url":"https://api.github.com/users/mschoch/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/blevesearch/bleve/issues/comments/249456825","html_url":"https://github.com/blevesearch/bleve/issues/449#issuecomment-249456825","issue_url":"https://api.github.com/repos/blevesearch/bleve/issues/449","id":249456825,"node_id":"MDEyOklzc3VlQ29tbWVudDI0OTQ1NjgyNQ==","user":{"login":"mschoch","id":298143,"node_id":"MDQ6VXNlcjI5ODE0Mw==","avatar_url":"https://avatars.githubusercontent.com/u/298143?v=4","gravatar_id":"","url":"https://api.github.com/users/mschoch","html_url":"https://github.com/mschoch","followers_url":"https://api.github.com/users/mschoch/followers","following_url":"https://api.github.com/users/mschoch/following{/other_user}","gists_url":"https://api.github.com/users/mschoch/gists{/gist_id}","starred_url":"https://api.github.com/users/mschoch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mschoch/subscriptions","organizations_url":"https://api.github.com/users/mschoch/orgs","repos_url":"https://api.github.com/users/mschoch/repos","events_url":"https://api.github.com/users/mschoch/events{/privacy}","received_events_url":"https://api.github.com/users/mschoch/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-09-26T00:30:43Z","updated_at":"2016-09-26T00:30:43Z","body":"The problem is in the Advance() method of the UpsideDownCouchDocIDReader.  The DocIDQuery works in the MUST clause because only Next() is called (to enumerate the specified keys).  Whe the DocIDQuery is in the MUST NOT clause, Advance() is sometimes called with IDs from another searcher.  I have a quick fix that addresses this test case, but I think there may be code in Next() that is wrong as well.  I'd like to sleep on it and read this section again in the morning before pushing a fix.\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/blevesearch/bleve/issues/comments/249456825/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mschoch","id":298143,"node_id":"MDQ6VXNlcjI5ODE0Mw==","avatar_url":"https://avatars.githubusercontent.com/u/298143?v=4","gravatar_id":"","url":"https://api.github.com/users/mschoch","html_url":"https://github.com/mschoch","followers_url":"https://api.github.com/users/mschoch/followers","following_url":"https://api.github.com/users/mschoch/following{/other_user}","gists_url":"https://api.github.com/users/mschoch/gists{/gist_id}","starred_url":"https://api.github.com/users/mschoch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mschoch/subscriptions","organizations_url":"https://api.github.com/users/mschoch/orgs","repos_url":"https://api.github.com/users/mschoch/repos","events_url":"https://api.github.com/users/mschoch/events{/privacy}","received_events_url":"https://api.github.com/users/mschoch/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":802563469,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDgwMjU2MzQ2OQ==","url":"https://api.github.com/repos/blevesearch/bleve/issues/events/802563469","actor":{"login":"mschoch","id":298143,"node_id":"MDQ6VXNlcjI5ODE0Mw==","avatar_url":"https://avatars.githubusercontent.com/u/298143?v=4","gravatar_id":"","url":"https://api.github.com/users/mschoch","html_url":"https://github.com/mschoch","followers_url":"https://api.github.com/users/mschoch/followers","following_url":"https://api.github.com/users/mschoch/following{/other_user}","gists_url":"https://api.github.com/users/mschoch/gists{/gist_id}","starred_url":"https://api.github.com/users/mschoch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mschoch/subscriptions","organizations_url":"https://api.github.com/users/mschoch/orgs","repos_url":"https://api.github.com/users/mschoch/repos","events_url":"https://api.github.com/users/mschoch/events{/privacy}","received_events_url":"https://api.github.com/users/mschoch/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"981812ff703ebaf5b0393f7faf81b52cd6f9bc9b","commit_url":"https://api.github.com/repos/mschoch/bleve/commits/981812ff703ebaf5b0393f7faf81b52cd6f9bc9b","created_at":"2016-09-26T16:37:24Z","performed_via_github_app":null},{"actor":{"login":"mschoch","id":298143,"node_id":"MDQ6VXNlcjI5ODE0Mw==","avatar_url":"https://avatars.githubusercontent.com/u/298143?v=4","gravatar_id":"","url":"https://api.github.com/users/mschoch","html_url":"https://github.com/mschoch","followers_url":"https://api.github.com/users/mschoch/followers","following_url":"https://api.github.com/users/mschoch/following{/other_user}","gists_url":"https://api.github.com/users/mschoch/gists{/gist_id}","starred_url":"https://api.github.com/users/mschoch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mschoch/subscriptions","organizations_url":"https://api.github.com/users/mschoch/orgs","repos_url":"https://api.github.com/users/mschoch/repos","events_url":"https://api.github.com/users/mschoch/events{/privacy}","received_events_url":"https://api.github.com/users/mschoch/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-09-26T16:37:41Z","updated_at":"2016-09-26T16:37:41Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/blevesearch/bleve/issues/450","repository_url":"https://api.github.com/repos/blevesearch/bleve","labels_url":"https://api.github.com/repos/blevesearch/bleve/issues/450/labels{/name}","comments_url":"https://api.github.com/repos/blevesearch/bleve/issues/450/comments","events_url":"https://api.github.com/repos/blevesearch/bleve/issues/450/events","html_url":"https://github.com/blevesearch/bleve/pull/450","id":179277700,"node_id":"MDExOlB1bGxSZXF1ZXN0ODY3NzY3MTU=","number":450,"title":"fix logic in Advance() of UpsideDownCouchDocIDReader","user":{"login":"mschoch","id":298143,"node_id":"MDQ6VXNlcjI5ODE0Mw==","avatar_url":"https://avatars.githubusercontent.com/u/298143?v=4","gravatar_id":"","url":"https://api.github.com/users/mschoch","html_url":"https://github.com/mschoch","followers_url":"https://api.github.com/users/mschoch/followers","following_url":"https://api.github.com/users/mschoch/following{/other_user}","gists_url":"https://api.github.com/users/mschoch/gists{/gist_id}","starred_url":"https://api.github.com/users/mschoch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mschoch/subscriptions","organizations_url":"https://api.github.com/users/mschoch/orgs","repos_url":"https://api.github.com/users/mschoch/repos","events_url":"https://api.github.com/users/mschoch/events{/privacy}","received_events_url":"https://api.github.com/users/mschoch/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2016-09-26T16:37:41Z","updated_at":"2016-09-26T16:44:09Z","closed_at":"2016-09-26T16:44:09Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":18893367,"node_id":"MDEwOlJlcG9zaXRvcnkxODg5MzM2Nw==","name":"bleve","full_name":"blevesearch/bleve","private":false,"owner":{"login":"blevesearch","id":8562608,"node_id":"MDEyOk9yZ2FuaXphdGlvbjg1NjI2MDg=","avatar_url":"https://avatars.githubusercontent.com/u/8562608?v=4","gravatar_id":"","url":"https://api.github.com/users/blevesearch","html_url":"https://github.com/blevesearch","followers_url":"https://api.github.com/users/blevesearch/followers","following_url":"https://api.github.com/users/blevesearch/following{/other_user}","gists_url":"https://api.github.com/users/blevesearch/gists{/gist_id}","starred_url":"https://api.github.com/users/blevesearch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/blevesearch/subscriptions","organizations_url":"https://api.github.com/users/blevesearch/orgs","repos_url":"https://api.github.com/users/blevesearch/repos","events_url":"https://api.github.com/users/blevesearch/events{/privacy}","received_events_url":"https://api.github.com/users/blevesearch/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/blevesearch/bleve","description":"A modern text/numeric/geo-spatial/vector indexing library for go","fork":false,"url":"https://api.github.com/repos/blevesearch/bleve","forks_url":"https://api.github.com/repos/blevesearch/bleve/forks","keys_url":"https://api.github.com/repos/blevesearch/bleve/keys{/key_id}","collaborators_url":"https://api.github.com/repos/blevesearch/bleve/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/blevesearch/bleve/teams","hooks_url":"https://api.github.com/repos/blevesearch/bleve/hooks","issue_events_url":"https://api.github.com/repos/blevesearch/bleve/issues/events{/number}","events_url":"https://api.github.com/repos/blevesearch/bleve/events","assignees_url":"https://api.github.com/repos/blevesearch/bleve/assignees{/user}","branches_url":"https://api.github.com/repos/blevesearch/bleve/branches{/branch}","tags_url":"https://api.github.com/repos/blevesearch/bleve/tags","blobs_url":"https://api.github.com/repos/blevesearch/bleve/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/blevesearch/bleve/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/blevesearch/bleve/git/refs{/sha}","trees_url":"https://api.github.com/repos/blevesearch/bleve/git/trees{/sha}","statuses_url":"https://api.github.com/repos/blevesearch/bleve/statuses/{sha}","languages_url":"https://api.github.com/repos/blevesearch/bleve/languages","stargazers_url":"https://api.github.com/repos/blevesearch/bleve/stargazers","contributors_url":"https://api.github.com/repos/blevesearch/bleve/contributors","subscribers_url":"https://api.github.com/repos/blevesearch/bleve/subscribers","subscription_url":"https://api.github.com/repos/blevesearch/bleve/subscription","commits_url":"https://api.github.com/repos/blevesearch/bleve/commits{/sha}","git_commits_url":"https://api.github.com/repos/blevesearch/bleve/git/commits{/sha}","comments_url":"https://api.github.com/repos/blevesearch/bleve/comments{/number}","issue_comment_url":"https://api.github.com/repos/blevesearch/bleve/issues/comments{/number}","contents_url":"https://api.github.com/repos/blevesearch/bleve/contents/{+path}","compare_url":"https://api.github.com/repos/blevesearch/bleve/compare/{base}...{head}","merges_url":"https://api.github.com/repos/blevesearch/bleve/merges","archive_url":"https://api.github.com/repos/blevesearch/bleve/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/blevesearch/bleve/downloads","issues_url":"https://api.github.com/repos/blevesearch/bleve/issues{/number}","pulls_url":"https://api.github.com/repos/blevesearch/bleve/pulls{/number}","milestones_url":"https://api.github.com/repos/blevesearch/bleve/milestones{/number}","notifications_url":"https://api.github.com/repos/blevesearch/bleve/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/blevesearch/bleve/labels{/name}","releases_url":"https://api.github.com/repos/blevesearch/bleve/releases{/id}","deployments_url":"https://api.github.com/repos/blevesearch/bleve/deployments","created_at":"2014-04-17T21:02:18Z","updated_at":"2025-11-10T09:34:58Z","pushed_at":"2025-11-07T20:01:43Z","git_url":"git://github.com/blevesearch/bleve.git","ssh_url":"git@github.com:blevesearch/bleve.git","clone_url":"https://github.com/blevesearch/bleve.git","svn_url":"https://github.com/blevesearch/bleve","homepage":"","size":17951,"stargazers_count":10698,"watchers_count":10698,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":true,"forks_count":696,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":297,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":[],"visibility":"public","forks":696,"open_issues":297,"watchers":10698,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/blevesearch/bleve/pulls/450","html_url":"https://github.com/blevesearch/bleve/pull/450","diff_url":"https://github.com/blevesearch/bleve/pull/450.diff","patch_url":"https://github.com/blevesearch/bleve/pull/450.patch","merged_at":"2016-09-26T16:44:09Z"},"body":"also added unit tests for newUpsideDownCouchDocIDReaderOnly\nuse cases\nfixes #449\n","reactions":{"url":"https://api.github.com/repos/blevesearch/bleve/issues/450/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/blevesearch/bleve/issues/450/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":802572396,"node_id":"MDExOkNsb3NlZEV2ZW50ODAyNTcyMzk2","url":"https://api.github.com/repos/blevesearch/bleve/issues/events/802572396","actor":{"login":"mschoch","id":298143,"node_id":"MDQ6VXNlcjI5ODE0Mw==","avatar_url":"https://avatars.githubusercontent.com/u/298143?v=4","gravatar_id":"","url":"https://api.github.com/users/mschoch","html_url":"https://github.com/mschoch","followers_url":"https://api.github.com/users/mschoch/followers","following_url":"https://api.github.com/users/mschoch/following{/other_user}","gists_url":"https://api.github.com/users/mschoch/gists{/gist_id}","starred_url":"https://api.github.com/users/mschoch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mschoch/subscriptions","organizations_url":"https://api.github.com/users/mschoch/orgs","repos_url":"https://api.github.com/users/mschoch/repos","events_url":"https://api.github.com/users/mschoch/events{/privacy}","received_events_url":"https://api.github.com/users/mschoch/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2016-09-26T16:44:09Z","state_reason":null,"performed_via_github_app":null}]