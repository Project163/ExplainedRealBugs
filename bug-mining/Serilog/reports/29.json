{"url":"https://api.github.com/repos/serilog/serilog/issues/235","repository_url":"https://api.github.com/repos/serilog/serilog","labels_url":"https://api.github.com/repos/serilog/serilog/issues/235/labels{/name}","comments_url":"https://api.github.com/repos/serilog/serilog/issues/235/comments","events_url":"https://api.github.com/repos/serilog/serilog/issues/235/events","html_url":"https://github.com/serilog/serilog/issues/235","id":44711793,"node_id":"MDU6SXNzdWU0NDcxMTc5Mw==","number":235,"title":"Elasticsearch and possibly other sinks create property names enclosed in quotes for nested objects","user":{"login":"konste","id":2653844,"node_id":"MDQ6VXNlcjI2NTM4NDQ=","avatar_url":"https://avatars.githubusercontent.com/u/2653844?v=4","gravatar_id":"","url":"https://api.github.com/users/konste","html_url":"https://github.com/konste","followers_url":"https://api.github.com/users/konste/followers","following_url":"https://api.github.com/users/konste/following{/other_user}","gists_url":"https://api.github.com/users/konste/gists{/gist_id}","starred_url":"https://api.github.com/users/konste/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/konste/subscriptions","organizations_url":"https://api.github.com/users/konste/orgs","repos_url":"https://api.github.com/users/konste/repos","events_url":"https://api.github.com/users/konste/events{/privacy}","received_events_url":"https://api.github.com/users/konste/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2014-10-02T17:07:28Z","updated_at":"2014-10-12T21:29:19Z","closed_at":"2014-10-12T21:29:19Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"We have custom exception enrichment, based on Reflection. Result of its work is simple properties dictionary:\n\nDictionary<string, object> exceptionProperties = …\nExceptions can be nested, so some values in this dictionary also can be dictionaries.\n\nNow in our override for Enrich method we need to push it to logEvent: \n\nLogEventProperty logEventProperty = propertyFactory.CreateProperty(“exception”, exceptionProperties, true);\nlogEvent.AddPropertyIfAbsent(logEventProperty);\n\nResult of that CreateProperty call is the new “exception” property which has the dictionary of subproperties. The problem is that dictionary of subproperties is not Dictionary<string, object> anymore, but rather\nIReadOnlyDictionary<Serilog.Events.ScalarValue, Serilog.Events.LogEventPropertyValue>\n\nProbably it is all good, but now look at Elasticsearch sink (ESPropertyFormatter.cs):\n\nvar dict = value as DictionaryValue;\nif (dict != null)\n{\n    var result = new Dictionary<object, object>();\n    foreach (var element in dict.Elements)\n    {\n        var key = SimplifyScalar(element.Key);\n\n…\n\nstatic object SimplifyScalar(object value)\n{\n    if (value == null) return null;\n\n```\nvar valueType = value.GetType();\nif (ESSpecialScalars.Contains(valueType)) return value;\n\nreturn value.ToString();\n```\n\n}\n\nResult is that SimplifyScalar called on Serilog.Events.ScalarValue generates the key string enclosed in quotes (with quotes being part of the string). This leads to properties with the names in quotes, which causes problems.\n","closed_by":{"login":"nblumhardt","id":342712,"node_id":"MDQ6VXNlcjM0MjcxMg==","avatar_url":"https://avatars.githubusercontent.com/u/342712?v=4","gravatar_id":"","url":"https://api.github.com/users/nblumhardt","html_url":"https://github.com/nblumhardt","followers_url":"https://api.github.com/users/nblumhardt/followers","following_url":"https://api.github.com/users/nblumhardt/following{/other_user}","gists_url":"https://api.github.com/users/nblumhardt/gists{/gist_id}","starred_url":"https://api.github.com/users/nblumhardt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nblumhardt/subscriptions","organizations_url":"https://api.github.com/users/nblumhardt/orgs","repos_url":"https://api.github.com/users/nblumhardt/repos","events_url":"https://api.github.com/users/nblumhardt/events{/privacy}","received_events_url":"https://api.github.com/users/nblumhardt/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/serilog/serilog/issues/235/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/serilog/serilog/issues/235/timeline","performed_via_github_app":null,"state_reason":"completed"}