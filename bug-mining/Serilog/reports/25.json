{"url":"https://api.github.com/repos/serilog/serilog/issues/225","repository_url":"https://api.github.com/repos/serilog/serilog","labels_url":"https://api.github.com/repos/serilog/serilog/issues/225/labels{/name}","comments_url":"https://api.github.com/repos/serilog/serilog/issues/225/comments","events_url":"https://api.github.com/repos/serilog/serilog/issues/225/events","html_url":"https://github.com/serilog/serilog/issues/225","id":43700751,"node_id":"MDU6SXNzdWU0MzcwMDc1MQ==","number":225,"title":"StorageExceptions on the AzureTableStorageSink","user":{"login":"joshka","id":381361,"node_id":"MDQ6VXNlcjM4MTM2MQ==","avatar_url":"https://avatars.githubusercontent.com/u/381361?v=4","gravatar_id":"","url":"https://api.github.com/users/joshka","html_url":"https://github.com/joshka","followers_url":"https://api.github.com/users/joshka/followers","following_url":"https://api.github.com/users/joshka/following{/other_user}","gists_url":"https://api.github.com/users/joshka/gists{/gist_id}","starred_url":"https://api.github.com/users/joshka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joshka/subscriptions","organizations_url":"https://api.github.com/users/joshka/orgs","repos_url":"https://api.github.com/users/joshka/repos","events_url":"https://api.github.com/users/joshka/events{/privacy}","received_events_url":"https://api.github.com/users/joshka/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":28408957,"node_id":"MDU6TGFiZWwyODQwODk1Nw==","url":"https://api.github.com/repos/serilog/serilog/labels/bug","name":"bug","color":"fc2929","default":true,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2014-09-24T00:19:41Z","updated_at":"2014-09-26T20:24:22Z","closed_at":"2014-09-26T20:24:04Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"We're seeing a lot of StorageExceptions due to writing two messages with the same log template right after each other in time. The stored event currently uses the current time ticks value as the partition key, and the message template as the row key. These are not guaranteed to be unique (and in our scenario are almost guaranteed not to be). I'm not sure that I can isolate the exact event which is being duplicated.\n\n```\n2014-09-23T06:44:34,Information,some-azure-app,e16bd5,635470514741295136,0,2344,22,2014-09-23T06:44:34 Caught exception Microsoft.WindowsAzure.Storage.StorageException: The remote server returned an error: (409) Conflict. ---> System.Net.WebException: The remote server returned an error: (409) Conflict.,\n2014-09-23T06:44:34,Information,some-azure-app,e16bd5,635470514741295136,0,2344,22,   at System.Net.HttpWebRequest.GetResponse(),\n2014-09-23T06:44:34,Information,some-azure-app,e16bd5,635470514741295136,0,2344,22,\"   at Microsoft.WindowsAzure.Storage.Core.Executor.Executor.ExecuteSync[T](RESTCommand`1 cmd, IRetryPolicy policy, OperationContext operationContext)\",\n2014-09-23T06:44:34,Information,some-azure-app,e16bd5,635470514741295136,0,2344,22,   --- End of inner exception stack trace ---,\n2014-09-23T06:44:34,Information,some-azure-app,e16bd5,635470514741295136,0,2344,22,\"   at Microsoft.WindowsAzure.Storage.Core.Executor.Executor.ExecuteSync[T](RESTCommand`1 cmd, IRetryPolicy policy, OperationContext operationContext)\",\n2014-09-23T06:44:34,Information,some-azure-app,e16bd5,635470514741295136,0,2344,22,\"   at Microsoft.WindowsAzure.Storage.Table.TableOperation.Execute(CloudTableClient client, CloudTable table, TableRequestOptions requestOptions, OperationContext operationContext)\",\n2014-09-23T06:44:34,Information,some-azure-app,e16bd5,635470514741295136,0,2344,22,\"   at Microsoft.WindowsAzure.Storage.Table.CloudTable.Execute(TableOperation operation, TableRequestOptions requestOptions, OperationContext operationContext)\",\n2014-09-23T06:44:34,Information,some-azure-app,e16bd5,635470514741295136,0,2344,22,   at Serilog.Sinks.AzureTableStorage.AzureTableStorageSink.Emit(LogEvent logEvent),\n2014-09-23T06:44:34,Information,some-azure-app,e16bd5,635470514741295136,0,2344,22,   at Serilog.Core.Sinks.SafeAggregateSink.Emit(LogEvent logEvent),\n2014-09-23T06:44:34,Information,some-azure-app,e16bd5,635470514741295136,0,2344,22,Request Information,\n2014-09-23T06:44:34,Information,some-azure-app,e16bd5,635470514741295136,0,2344,22,RequestID:695859b7-0002-0037-1a9b-198d55000000,\n2014-09-23T06:44:34,Information,some-azure-app,e16bd5,635470514741295136,0,2344,22,\"RequestDate:Tue, 23 Sep 2014 06:44:32 GMT\",\n2014-09-23T06:44:34,Information,some-azure-app,e16bd5,635470514741295136,0,2344,22,StatusMessage:Conflict,\n2014-09-23T06:44:34,Information,some-azure-app,e16bd5,635470514741295136,0,2344,22,ErrorCode:EntityAlreadyExists,\n2014-09-23T06:44:34,Information,some-azure-app,e16bd5,635470514741295136,0,2344,22, while emitting to sink Serilog.Sinks.AzureTableStorage.AzureTableStorageSink.,\n```\n\nI'm not sure what the right approach for fixing this would be. Suggestions welcome!\n","closed_by":{"login":"nblumhardt","id":342712,"node_id":"MDQ6VXNlcjM0MjcxMg==","avatar_url":"https://avatars.githubusercontent.com/u/342712?v=4","gravatar_id":"","url":"https://api.github.com/users/nblumhardt","html_url":"https://github.com/nblumhardt","followers_url":"https://api.github.com/users/nblumhardt/followers","following_url":"https://api.github.com/users/nblumhardt/following{/other_user}","gists_url":"https://api.github.com/users/nblumhardt/gists{/gist_id}","starred_url":"https://api.github.com/users/nblumhardt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nblumhardt/subscriptions","organizations_url":"https://api.github.com/users/nblumhardt/orgs","repos_url":"https://api.github.com/users/nblumhardt/repos","events_url":"https://api.github.com/users/nblumhardt/events{/privacy}","received_events_url":"https://api.github.com/users/nblumhardt/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/serilog/serilog/issues/225/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/serilog/serilog/issues/225/timeline","performed_via_github_app":null,"state_reason":"completed"}