<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:34:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[COMPRESS-599] Memory usage in Pack200Compressor cannot be limited</title>
                <link>https://issues.apache.org/jira/browse/COMPRESS-599</link>
                <project id="12310904" key="COMPRESS">Commons Compress</project>
                    <description>&lt;p&gt;While fuzzing commons-compress, I found the following case where a specific input leads to unbounded memory allocation in the Pack200Compressor.&lt;/p&gt;

&lt;p&gt;It seems there is currently no way to limit memory usage of this compressor and thus this cannot be avoided if you process untrusted data via commons-compress.&lt;/p&gt;

&lt;p&gt;With the following code-snippet:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;public class Crash_0d5a0130ab3cd32f299b2a27aa76f24a0bbabae8 {
    static final String base64Bytes = &quot;yv7QDQeW0ABgfwDuwOn8QwIGAAIBAQAAd9zc3Nzc3Nzc3Nzc3Nzc3NxuZXR3YXJl3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3GluZG93cwAAAwMUAxUDZmVzdA0K&quot;;

    public static void main(String[] args) throws IOException {
        byte[] input = java.util.Base64.getDecoder().decode(base64Bytes);
      new Pack200CompressorInputStream(new ByteArrayInputStream(input), Pack200Strategy.TEMP_FILE);
    }
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The following exception happens:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Exception in thread &quot;main&quot; java.lang.OutOfMemoryError: Java heap space
&#160; &#160; at org.apache.commons.compress.harmony.pack200.Codec.decodeInts(Codec.java:169)
&#160; &#160; at org.apache.commons.compress.harmony.pack200.BHSDCodec.decodeInts(BHSDCodec.java:256)
&#160; &#160; at org.apache.commons.compress.harmony.unpack200.BandSet.decodeBandInt(BandSet.java:100)
&#160; &#160; at org.apache.commons.compress.harmony.unpack200.CpBands.parseCpUtf8(CpBands.java:366)
&#160; &#160; at org.apache.commons.compress.harmony.unpack200.CpBands.read(CpBands.java:111)
&#160; &#160; at org.apache.commons.compress.harmony.unpack200.Segment.readSegment(Segment.java:351)
&#160; &#160; at org.apache.commons.compress.harmony.unpack200.Segment.unpackRead(Segment.java:459)
&#160; &#160; at org.apache.commons.compress.harmony.unpack200.Segment.unpack(Segment.java:436)
&#160; &#160; at org.apache.commons.compress.harmony.unpack200.Archive.unpack(Archive.java:155)
&#160; &#160; at org.apache.commons.compress.harmony.unpack200.Pack200UnpackerAdapter.unpack(Pack200UnpackerAdapter.java:49)
&#160; &#160; at org.apache.commons.compress.compressors.pack200.Pack200CompressorInputStream.&amp;lt;init&amp;gt;(Pack200CompressorInputStream.java:183)
&#160; &#160; at org.apache.commons.compress.compressors.pack200.Pack200CompressorInputStream.&amp;lt;init&amp;gt;(Pack200CompressorInputStream.java:77)
&#160; &#160; at Crash_0d5a0130ab3cd32f299b2a27aa76f24a0bbabae8.main(Crash_0d5a0130ab3cd32f299b2a27aa76f24a0bbabae8.java:13) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13414801">COMPRESS-599</key>
            <summary>Memory usage in Pack200Compressor cannot be limited</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="dominik.stadler@gmx.at">Dominik Stadler</reporter>
                        <labels>
                            <label>fuzzer</label>
                            <label>memory</label>
                    </labels>
                <created>Wed, 1 Dec 2021 13:40:41 +0000</created>
                <updated>Thu, 2 Dec 2021 15:08:14 +0000</updated>
                                            <version>1.21</version>
                                                    <component>Compressors</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17451885" author="garydgregory" created="Wed, 1 Dec 2021 15:12:58 +0000"  >&lt;p&gt;I added a disabled test case class: &lt;tt&gt;Codec_decodeInts_OutOfMemoryErrorTest.&lt;/tt&gt; &lt;br/&gt;
Note:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;the useful class name&lt;/li&gt;
	&lt;li&gt;it&apos;s a unit test&lt;/li&gt;
	&lt;li&gt;it follows standard coding convention by upper-casing constants.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Please follow the above in the future. TY.&lt;/p&gt;

&lt;p&gt;More importantly, I do not get the same error you report, I get:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.OutOfMemoryError: Java heap space
&#160; at org.apache.commons.compress.harmony.unpack200.CpBands.parseCpUtf8(CpBands.java:365)
&#160; at org.apache.commons.compress.harmony.unpack200.CpBands.read(CpBands.java:111)
&#160; at org.apache.commons.compress.harmony.unpack200.Segment.readSegment(Segment.java:351)
&#160; at org.apache.commons.compress.harmony.unpack200.Segment.unpackRead(Segment.java:459)
&#160; at org.apache.commons.compress.harmony.unpack200.Segment.unpack(Segment.java:436)
&#160; at org.apache.commons.compress.harmony.unpack200.Archive.unpack(Archive.java:155)
&#160; at org.apache.commons.compress.harmony.unpack200.Pack200UnpackerAdapter.unpack(Pack200UnpackerAdapter.java:49)
&#160; at org.apache.commons.compress.compressors.pack200.Pack200CompressorInputStream.&amp;lt;init&amp;gt;(Pack200CompressorInputStream.java:183)
&#160; at org.apache.commons.compress.compressors.pack200.Pack200CompressorInputStream.&amp;lt;init&amp;gt;(Pack200CompressorInputStream.java:77)
&#160; at org.apache.commons.compress.harmony.unpack200.tests.Codec_decodeInts_OutOfMemoryErrorTest.test(Codec_decodeInts_OutOfMemoryErrorTest.java:36)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But I am running against git master and I imagine you are running on 1.21.&lt;/p&gt;</comment>
                            <comment id="17451931" author="dominik.stadler@gmx.at" created="Wed, 1 Dec 2021 17:13:19 +0000"  >&lt;p&gt;The test-case just came out of the fuzzer &quot;Jazzer&quot; and was just for making it easy for you to reproduce.&lt;/p&gt;

&lt;p&gt;Different stacktraces are possible depending on how much memory your JavaVM has available and if you limit it via -Xmx. I think I used &quot;1024m&quot;. I expect that multiple large allocations at some point exhaust the available memory here, so your results will vary slightly depending on JVM details/settings.&lt;/p&gt;</comment>
                            <comment id="17451983" author="garydgregory" created="Wed, 1 Dec 2021 19:23:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dominik.stadler%40gmx.at&quot; class=&quot;user-hover&quot; rel=&quot;dominik.stadler@gmx.at&quot;&gt;dominik.stadler@gmx.at&lt;/a&gt;&lt;br/&gt;
Thank you for the clarification. &lt;br/&gt;
Would you mind documenting here more precisely how you generated this result? &lt;/p&gt;</comment>
                            <comment id="17452207" author="dominik.stadler@gmx.at" created="Thu, 2 Dec 2021 07:05:11 +0000"  >&lt;p&gt;See &lt;a href=&quot;https://github.com/centic9/compress-fuzz&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/centic9/compress-fuzz&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The README explains how to set it up and run fuzzing on commons-compress.&lt;/p&gt;

&lt;p&gt;PRs with more covered functionality in Fuzz.java welcome to make the fuzzer even more effective.&lt;/p&gt;</comment>
                            <comment id="17452460" author="garydgregory" created="Thu, 2 Dec 2021 15:08:14 +0000"  >&lt;p&gt;We might want to add and use a class &lt;tt&gt;UnpackingOptions&lt;/tt&gt; just like we have a class &lt;tt&gt;PackingOptions&lt;/tt&gt; which would hold one or more limits to check before allocating arrays and Collections.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 49 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0x94g:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>