<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:35:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[COMPRESS-627] Pack200 causes a &apos;archive.3E&apos; error if it&#8217;s not in the system class loader.</title>
                <link>https://issues.apache.org/jira/browse/COMPRESS-627</link>
                <project id="12310904" key="COMPRESS">Commons Compress</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.compress.java.util.jar.Pack200;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.lang.reflect.Method;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.net.URLClassLoader;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.net.URL;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io.File;

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Main {
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Throwable {
    URLClassLoader ucl = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; URLClassLoader(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; URL[] {
      &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;.&quot;&lt;/span&gt;).toURI().toURL(),
      &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;commons-compress-1.21.jar&quot;&lt;/span&gt;).toURI().toURL(),
    }, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);

    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;=== Unpacker ===&quot;&lt;/span&gt;);
    Method method;
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
      method = ucl.loadClass(&lt;span class=&quot;code-quote&quot;&gt;&quot;InClassLoaderClass&quot;&lt;/span&gt;).getDeclaredMethod(&lt;span class=&quot;code-quote&quot;&gt;&quot;unpacker&quot;&lt;/span&gt;);
      method.setAccessible(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
      method.invoke(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Throwable t) {
      t.printStackTrace();
    }

    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;=== Packer ===&quot;&lt;/span&gt;);
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
      method = ucl.loadClass(&lt;span class=&quot;code-quote&quot;&gt;&quot;InClassLoaderClass&quot;&lt;/span&gt;).getDeclaredMethod(&lt;span class=&quot;code-quote&quot;&gt;&quot;packer&quot;&lt;/span&gt;);
      method.setAccessible(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
      method.invoke(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Throwable t) {
      t.printStackTrace();
    }
  }
}

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;InClassLoaderClass {
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void unpacker() {
    Pack200.newUnpacker();
  }
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void packer() {
    Pack200.newPacker();
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;execute this code (same as attached &lt;tt&gt;Main.java&lt;/tt&gt;) with &lt;tt&gt;ClassLoaderClass.class&lt;/tt&gt; (compiled code of this file) and &lt;tt&gt;commons-compress-1.21.jar&lt;/tt&gt; is on working directory will cause the following error:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
anatawa12@anatawa12-book:~/commons-compress-pack200-test $ javac -cp commons-compress-1.21.jar Main.java &amp;amp;&amp;amp; java Main
=== Unpacker ===
java.lang.reflect.InvocationTargetException
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at Main.main(Main.java:19)
Caused by: java.lang.Error: archive.3E
	at org.apache.commons.compress.java.util.jar.Pack200$2.run(Pack200.java:100)
	at java.security.AccessController.doPrivileged(Native Method)
	at org.apache.commons.compress.java.util.jar.Pack200.newUnpacker(Pack200.java:91)
	at InClassLoaderClass.unpacker(Main.java:37)
	... 5 more
Caused by: java.lang.ClassNotFoundException: org.apache.commons.compress.harmony.unpack200.Pack200UnpackerAdapter
	at java.net.URLClassLoader.findClass(URLClassLoader.java:387)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:419)
	at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:352)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:352)
	at org.apache.commons.compress.java.util.jar.Pack200$2.run(Pack200.java:98)
	... 8 more
=== Packer ===
java.lang.reflect.InvocationTargetException
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at Main.main(Main.java:28)
Caused by: java.lang.Error: archive.3E
	at org.apache.commons.compress.java.util.jar.Pack200$1.run(Pack200.java:72)
	at java.security.AccessController.doPrivileged(Native Method)
	at org.apache.commons.compress.java.util.jar.Pack200.newPacker(Pack200.java:61)
	at InClassLoaderClass.packer(Main.java:40)
	... 5 more
Caused by: java.lang.ClassNotFoundException: org.apache.commons.compress.harmony.pack200.Pack200PackerAdapter
	at java.net.URLClassLoader.findClass(URLClassLoader.java:387)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:419)
	at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:352)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:352)
	at org.apache.commons.compress.java.util.jar.Pack200$1.run(Pack200.java:70)
	... 8 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In &lt;tt&gt;src/main/java/org/apache/commons/compress/java/util/jar/Pack200.java&lt;/tt&gt;, &lt;tt&gt;Packer&lt;/tt&gt;/&lt;tt&gt;Unpacker&lt;/tt&gt; implementaion is loaded from &lt;tt&gt;ClassLoader.getSystemClassLoader()&lt;/tt&gt;.&lt;br/&gt;
However, Apache commons compress may be loaded from other class loaders in many environments (e.g. Gradle).&lt;br/&gt;
&#160;&lt;/p&gt;</description>
                <environment>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
anatawa12@anatawa12-book:~/commons-compress-pack200-test $ neofetch --off --stdout
anatawa12@owlan031072216.sras.sic.shibaura-it.ac.jp
---------------------------------------------------
OS: macOS 12.6 21G115 arm64
Host: MacBookPro18,4
Kernel: 21.6.0
Uptime: 11 days, 8 hours, 58 mins
Packages: 199 (brew)
Shell: zsh 5.8.1
Resolution: 1800x1169
DE: Aqua
WM: Quartz Compositor
WM Theme: Blue (Light)
Terminal: iTerm2
Terminal Font: Monaco 12
CPU: Apple M1 Max
GPU: Apple M1 Max
Memory: 10849MiB / 65536MiB

anatawa12@anatawa12-book:~/commons-compress-pack200-test $ java -version
openjdk version &lt;span class=&quot;code-quote&quot;&gt;&quot;1.8.0_332&quot;&lt;/span&gt;
OpenJDK &lt;span class=&quot;code-object&quot;&gt;Runtime&lt;/span&gt; Environment (Zulu 8.62.0.19-CA-macos-aarch64) (build 1.8.0_332-b09)
OpenJDK 64-Bit Server VM (Zulu 8.62.0.19-CA-macos-aarch64) (build 25.332-b09, mixed mode)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</environment>
        <key id="13484194">COMPRESS-627</key>
            <summary>Pack200 causes a &apos;archive.3E&apos; error if it&#8217;s not in the system class loader.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="anatawa12">anatawa12</reporter>
                        <labels>
                    </labels>
                <created>Mon, 3 Oct 2022 00:34:34 +0000</created>
                <updated>Tue, 4 Oct 2022 13:04:27 +0000</updated>
                            <resolved>Tue, 4 Oct 2022 13:04:27 +0000</resolved>
                                    <version>1.21</version>
                                    <fixVersion>1.22</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17612455" author="garydgregory" created="Mon, 3 Oct 2022 23:01:44 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anatawa12&quot; class=&quot;user-hover&quot; rel=&quot;anatawa12&quot;&gt;anatawa12&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thank you for your report. Do you have a proposal?&#160;&lt;/p&gt;</comment>
                            <comment id="17612463" author="JIRAUSER296432" created="Tue, 4 Oct 2022 00:01:16 +0000"  >&lt;p&gt;Hello&lt;/p&gt;

&lt;p&gt;I think using &lt;tt&gt;ClassLoader&lt;/tt&gt; of &lt;tt&gt;Pack200&lt;/tt&gt; is good.&lt;br/&gt;
In addition, removing system property check and directly instantiating &lt;tt&gt;Pack200(Packer|Unpacker)Adapter&lt;/tt&gt; with &lt;tt&gt;new&lt;/tt&gt; expression without checking system property is also good.&lt;br/&gt;
The &lt;tt&gt;java.util.jar.Pack200.Packer&lt;/tt&gt; system property is used to get name of class implements &lt;tt&gt;java.util.jar.Pack200.Packer&lt;/tt&gt; in JDK so using it to get implementation of commons-compress will cause cast error, I think. That&apos;s why I think removing system property is not too breaking change.&lt;/p&gt;</comment>
                            <comment id="17612612" author="garydgregory" created="Tue, 4 Oct 2022 13:04:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anatawa12&quot; class=&quot;user-hover&quot; rel=&quot;anatawa12&quot;&gt;anatawa12&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thank you for your report.&lt;/p&gt;

&lt;p&gt;The classes in that case are now loaded from the Pack200 class loader.&lt;/p&gt;

&lt;p&gt;Please try git master or a snapshot build from &lt;a href=&quot;https://repository.apache.org/content/repositories/snapshots/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/repositories/snapshots/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13050029" name="Main-1.java" size="1102" author="anatawa12" created="Mon, 3 Oct 2022 00:31:51 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 5 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z190dc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>