<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:32:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[COMPRESS-394] [Zip] Local `Version Needed To Extract` does not match Central Directory</title>
                <link>https://issues.apache.org/jira/browse/COMPRESS-394</link>
                <project id="12310904" key="COMPRESS">Commons Compress</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;This is followup on an issue reported on Plexus Archiver - &lt;a href=&quot;https://github.com/codehaus-plexus/plexus-archiver/issues/57&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/codehaus-plexus/plexus-archiver/issues/57&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Plexus Archiver uses &lt;tt&gt;ZipArchiveOutputStream&lt;/tt&gt; to create zip archives. It constructs the &lt;tt&gt;ZipArchiveOutputStream&lt;/tt&gt; using &lt;tt&gt;BufferedOutputStream&lt;/tt&gt;. As a result the output do not provide random access and additional data descriptor records are added. Unfortunately this leads to different values being set for &lt;tt&gt;version needed to extract&lt;/tt&gt; field in the local file header and in the central directory. It looks like that the root cause is the way the local header &lt;tt&gt;version needed to extract&lt;/tt&gt; field value is calculated:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (phased &amp;amp;&amp;amp;  !isZip64Required(entry.entry, zip64Mode)){
            putShort(INITIAL_VERSION, buf, LFH_VERSION_NEEDED_OFFSET);
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
            putShort(versionNeededToExtract(zipMethod, hasZip64Extra(ze)), buf, LFH_VERSION_NEEDED_OFFSET);
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As you can see the need for data descriptors is not taken into account. On other hand when the central directory is created the following is used to determine the minimum required version&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; versionNeededToExtract(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; zipMethod, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; zip64) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (zip64) {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ZIP64_MIN_VERSION;
        }
        &lt;span class=&quot;code-comment&quot;&gt;// requires version 2 as we are going to store length info
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// in the data descriptor
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; (isDeflatedToOutputStream(zipMethod)) ?
                DATA_DESCRIPTOR_MIN_VERSION :
                INITIAL_VERSION;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As a side note: I&apos;m not a zip expert by any means so I could be wrong, but my understanding is that if Deflate compression is used then the minimum required version should be 2.0 regardless if data descriptors are used or not.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13071786">COMPRESS-394</key>
            <summary>[Zip] Local `Version Needed To Extract` does not match Central Directory</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="plamenttv">Plamen Totev</reporter>
                        <labels>
                            <label>zip</label>
                    </labels>
                <created>Sat, 13 May 2017 21:52:07 +0000</created>
                <updated>Tue, 20 Feb 2018 05:06:37 +0000</updated>
                            <resolved>Mon, 22 May 2017 16:13:22 +0000</resolved>
                                                    <fixVersion>1.15</fixVersion>
                                    <component>Archivers</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16009525" author="garydgregory" created="Sat, 13 May 2017 22:18:47 +0000"  >&lt;p&gt;Hi Plamen,&lt;/p&gt;

&lt;p&gt;We are in the middle of releasing version 1.14 ATM, which should hit the site in a couple of days at the most.&lt;/p&gt;

&lt;p&gt;We welcome patches with unit tests &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;</comment>
                            <comment id="16010701" author="bodewig" created="Mon, 15 May 2017 15:26:52 +0000"  >&lt;p&gt;One could argue the current implementation was right as you don&apos;t need to support data descriptors if you&apos;ve read the central directory. But I must admit I don&apos;t recall whether the current logic is as it is because of something like this or is that way by accident.&lt;/p&gt;

&lt;p&gt;If you look at section 4.4.3.3 in &lt;a href=&quot;https://pkware.cachefly.net/webdocs/casestudies/APPNOTE.TXT&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://pkware.cachefly.net/webdocs/casestudies/APPNOTE.TXT&lt;/a&gt; the last paragraph&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;        When using ZIP64 extensions, the corresponding value in the&lt;br/&gt;
        zip64 end of central directory record MUST also be set.  &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;this implies the values inside the local file header and the central directory can be different. Not sure why infozip compains about it. Anyway, we should probably make things consistent.&lt;/p&gt;

&lt;p&gt;And you are certainly correct, APPNOTE lists &quot;DEFLATE&quot; as version 2.0. I&apos;ve got no idea why we use 1.0, it&apos;s always been that way &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="16010705" author="bodewig" created="Mon, 15 May 2017 15:27:56 +0000"  >&lt;p&gt;forget the part about 4.4.3.3 on second read I see it talks about the &quot;end of central directory record&quot;, not the central directory entry.&lt;/p&gt;</comment>
                            <comment id="16012724" author="bodewig" created="Tue, 16 May 2017 16:57:55 +0000"  >&lt;p&gt;git commit 8a6bb56 &quot;fixes&quot; the problem by using version 2.0 when DEFLATE is used. But this is only an incomplete solution and I&apos;ll tackle the rest together with &lt;a href=&quot;https://issues.apache.org/jira/browse/COMPRESS-395&quot; title=&quot;[Zip] Do not add data descriptor record when CRC and size values are known&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COMPRESS-395&quot;&gt;&lt;del&gt;COMPRESS-395&lt;/del&gt;&lt;/a&gt; (if we don&apos;t write a data descriptor then we need to transport this information in some way).&lt;/p&gt;</comment>
                            <comment id="16012922" author="plamenttv" created="Tue, 16 May 2017 18:52:52 +0000"  >&lt;p&gt;Stefan, thank you for looking into this and &lt;a href=&quot;https://issues.apache.org/jira/browse/COMPRESS-395&quot; title=&quot;[Zip] Do not add data descriptor record when CRC and size values are known&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COMPRESS-395&quot;&gt;&lt;del&gt;COMPRESS-395&lt;/del&gt;&lt;/a&gt;, really appreciate it and the fast reaction. I know that both does not have big impact but still some tools issue warnings about that. &lt;/p&gt;

&lt;p&gt;I really would love to help with patches but I&apos;m in the middle of writing my master thesis, so I afraid I don&apos;t have the time &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16013035" author="bodewig" created="Tue, 16 May 2017 20:09:50 +0000"  >&lt;p&gt;Don&apos;t worry, Plamen. Thank you for your detailed analysis.&lt;/p&gt;</comment>
                            <comment id="16019748" author="bodewig" created="Mon, 22 May 2017 16:13:22 +0000"  >&lt;p&gt;should be fixed in master, would be good if you could double-check.&lt;/p&gt;</comment>
                            <comment id="16020108" author="plamenttv" created="Mon, 22 May 2017 20:12:02 +0000"  >&lt;p&gt;Thanks. I&apos;ve tried it and the version fields are consistent.&lt;/p&gt;</comment>
                            <comment id="16020708" author="bodewig" created="Tue, 23 May 2017 06:43:08 +0000"  >&lt;p&gt;Thanks&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13139531">COMPRESS-444</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 25 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3exwv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>