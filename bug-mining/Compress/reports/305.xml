<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:33:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[COMPRESS-469] java.io.IOException: Error detected parsing the header on un-archiving. Archive untars fine in BSDTar and JTar</title>
                <link>https://issues.apache.org/jira/browse/COMPRESS-469</link>
                <project id="12310904" key="COMPRESS">Commons Compress</project>
                    <description>&lt;p&gt;Using TarArchiveInputStream to parse this tar archive results in a&lt;/p&gt;

&lt;p&gt;`java.io.IOException: Error detected parsing the header`&lt;/p&gt;

&lt;p&gt;`Caused by: java.lang.IllegalArgumentException: Invalid byte 78 at offset 8 in &apos;00000000NaN{NUL}&apos; len=12`&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The `00000000NaN{NUL}` value is indeed found in the tar archive at the point that TarArchiveInputStream finds it and errors, but both BSDTar from a bash shell and JTar from a Java environment handle the archive fine, including the file with the malformed header. My commons-compress code is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; List&amp;lt;File&amp;gt; unTar(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; File inputFile, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; File outputDir) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; FileNotFoundException, IOException, ArchiveException {

  &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.format(&lt;span class=&quot;code-quote&quot;&gt;&quot;Untaring %s to dir %s.&quot;&lt;/span&gt;, inputFile.getAbsolutePath(), outputDir.getAbsolutePath()));

  &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; List&amp;lt;File&amp;gt; untaredFiles = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; LinkedList&amp;lt;File&amp;gt;();
  &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; InputStream is = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileInputStream(inputFile);
  &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; TarArchiveInputStream debInputStream = (TarArchiveInputStream) &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArchiveStreamFactory().createArchiveInputStream(&lt;span class=&quot;code-quote&quot;&gt;&quot;tar&quot;&lt;/span&gt;, is);
  TarArchiveEntry entry = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; ((entry = (TarArchiveEntry) debInputStream.getNextEntry()) != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
      &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; File outputFile = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(outputDir, entry.getName());
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (entry.isDirectory()) {
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.format(&lt;span class=&quot;code-quote&quot;&gt;&quot;Attempting to write output directory %s.&quot;&lt;/span&gt;, outputFile.getAbsolutePath()));
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!outputFile.exists()) {
          &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out
              .println(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.format(&lt;span class=&quot;code-quote&quot;&gt;&quot;Attempting to create output directory %s.&quot;&lt;/span&gt;, outputFile.getAbsolutePath()));
          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!outputFile.mkdirs()) {
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalStateException(
                &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.format(&lt;span class=&quot;code-quote&quot;&gt;&quot;Couldn&apos;t create directory %s.&quot;&lt;/span&gt;, outputFile.getAbsolutePath()));
          }
        }
      }
      &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.format(&lt;span class=&quot;code-quote&quot;&gt;&quot;Creating output file %s.&quot;&lt;/span&gt;, outputFile.getAbsolutePath()));
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; OutputStream outputFileStream = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileOutputStream(outputFile);
        IOUtils.copy(debInputStream, outputFileStream);
        outputFileStream.close();
      }
      untaredFiles.add(outputFile);
    }

  debInputStream.close();

  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; untaredFiles;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12947003/12947003_compress-bug-POC.tar.gz&quot; title=&quot;compress-bug-POC.tar.gz attached to COMPRESS-469&quot;&gt;compress-bug-POC.tar.gz&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ve attached an archive of my proof-of-concept code that un-archives the problem archive using JTar, then attempts to un-archive it using commons-compress. The problem archive is included. Unfortunately I wasn&apos;t involved in the creation of the problem archive, it was downloaded from NPM last year, so I don&apos;t have any details about the archival process that caused the malformed header.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Java version: 1.8.0_192, vendor: Oracle Corporation, runtime: /Library/Java/JavaVirtualMachines/jdk1.8.0_192.jdk/Contents/Home/jre&lt;br/&gt;
 Default locale: en_US, platform encoding: UTF-8&lt;br/&gt;
 OS name: &quot;mac os x&quot;, version: &quot;10.14&quot;, arch: &quot;x86_64&quot;, family: &quot;mac&quot;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;bsdtar 2.8.3 - libarchive 2.8.3&lt;/p&gt;</environment>
        <key id="13196403">COMPRESS-469</key>
            <summary>java.io.IOException: Error detected parsing the header on un-archiving. Archive untars fine in BSDTar and JTar</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="cptkrrk">Kirk Hardy</reporter>
                        <labels>
                            <label>tar</label>
                    </labels>
                <created>Tue, 6 Nov 2018 03:10:47 +0000</created>
                <updated>Fri, 9 Aug 2019 15:41:24 +0000</updated>
                            <resolved>Sat, 10 Nov 2018 20:31:13 +0000</resolved>
                                    <version>1.18</version>
                                    <fixVersion>1.19</fixVersion>
                                    <component>Archivers</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16681827" author="bodewig" created="Fri, 9 Nov 2018 18:50:26 +0000"  >&lt;p&gt;GNU tar says&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ tar tvvf assembly-0.2.12.tar
...
-rw-r--r-- 501/20          193 2012-02-29 18:15 &lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;/test/fixtures/amd/expected.js
tar: Archive contains &#8216;00000000NaN&#8217; where numeric time_t value expected
-rw-r--r-- 501/20           74 1970-01-01 00:59 &lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;/test/fixtures/app.js
...
tar: Exiting with failure status due to previous errors
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Extracting also yields&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
tar: &lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;/test/fixtures/app.js: implausibly old time stamp 1970-01-01 00:59:59
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;so at least we are not alone &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;There is no question the archive is broken but this doesn&apos;t help you.&lt;/p&gt;

&lt;p&gt;The field in question is the timestamp of the entry. I&apos;ll have a look at what bsdtar uses as fallback, GNU tar seems to use -1 as 1970-01-01 00:59:59 would be a second before the Unix epoch translated to my timezone (UTC+1).&lt;/p&gt;

&lt;p&gt;Can you tell us which timestamp bsdtar creates for package/test/fixtures/app.js on your machine?&lt;/p&gt;</comment>
                            <comment id="16681856" author="bodewig" created="Fri, 9 Nov 2018 19:17:01 +0000"  >&lt;p&gt;If I change the parsing code to parse 00000000NaN as -1 I run into two unit test errors so what we have right now is the expected behavior. We might introduce some kind of extra argument for &lt;tt&gt;TarArchiveInputStream&lt;/tt&gt;&apos;s constructor for a more lenient mode that allows you to deal with broken archives but it can&apos;t become the default.&lt;/p&gt;</comment>
                            <comment id="16681865" author="cptkrrk" created="Fri, 9 Nov 2018 19:24:08 +0000"  >&lt;p&gt;Un-archiving with BSDTar on my machine produces the problem file with a timestamp &quot;Dec 31 19:00:00 1969&quot;&lt;/p&gt;</comment>
                            <comment id="16681904" author="bodewig" created="Fri, 9 Nov 2018 20:05:14 +0000"  >&lt;p&gt;I&apos;d guess you are in UTC-5 then, thanks.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/libarchive/libarchive/blob/master/libarchive/archive_read_support_format_tar.c#L2613&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/libarchive/libarchive/blob/master/libarchive/archive_read_support_format_tar.c#L2613&lt;/a&gt; looks as if bsdtar stopped parsing when the first non-digit is reached so it returns 0 in this case.&lt;/p&gt;</comment>
                            <comment id="16681906" author="cptkrrk" created="Fri, 9 Nov 2018 20:08:08 +0000"  >&lt;p&gt;Oh interesting. Yes, I&apos;m in EST so UTC-5.&lt;/p&gt;</comment>
                            <comment id="16682582" author="bodewig" created="Sat, 10 Nov 2018 20:31:13 +0000"  >&lt;p&gt;Added a new &lt;tt&gt;lenient&lt;/tt&gt; flag with commit fd69d8ca which should allow you to get past said entry.&lt;/p&gt;</comment>
                            <comment id="16685278" author="cptkrrk" created="Tue, 13 Nov 2018 14:20:18 +0000"  >&lt;p&gt;Thanks so much&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12947003" name="compress-bug-POC.tar.gz" size="1611412" author="cptkrrk" created="Tue, 6 Nov 2018 03:05:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|s005i0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>