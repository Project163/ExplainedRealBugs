<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:34:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[COMPRESS-569] OutOfMemoryError on a crafted tar file</title>
                <link>https://issues.apache.org/jira/browse/COMPRESS-569</link>
                <project id="12310904" key="COMPRESS">Commons Compress</project>
                    <description>&lt;p&gt;Apache Commons Compress at commit&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/commons-compress/commit/1b7528fbd6295a3958daf1b1114621ee5e40e83c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/commit/1b7528fbd6295a3958daf1b1114621ee5e40e83c&lt;/a&gt; throws an OutOfMemoryError after consuming ~5 minutes of CPU on my&lt;br/&gt;
machine on a crafted tar archive that is less than a KiB in size:&lt;/p&gt;

&lt;p&gt;Exception in thread &quot;main&quot; java.lang.OutOfMemoryError: Java heap space&lt;br/&gt;
at java.base/sun.nio.cs.UTF_8.newDecoder(UTF_8.java:70)&lt;br/&gt;
at org.apache.commons.compress.archivers.zip.NioZipEncoding.newDecoder(NioZipEncoding.java:182)&lt;br/&gt;
at org.apache.commons.compress.archivers.zip.NioZipEncoding.decode(NioZipEncoding.java:135)&lt;br/&gt;
at org.apache.commons.compress.archivers.tar.TarUtils.parseName(TarUtils.java:311)&lt;br/&gt;
at org.apache.commons.compress.archivers.tar.TarUtils.parseName(TarUtils.java:275)&lt;br/&gt;
at org.apache.commons.compress.archivers.tar.TarArchiveEntry.parseTarHeader(TarArchiveEntry.java:1550)&lt;br/&gt;
at org.apache.commons.compress.archivers.tar.TarArchiveEntry.&amp;lt;init&amp;gt;(TarArchiveEntry.java:554)&lt;br/&gt;
at org.apache.commons.compress.archivers.tar.TarArchiveEntry.&amp;lt;init&amp;gt;(TarArchiveEntry.java:570)&lt;br/&gt;
at org.apache.commons.compress.archivers.tar.TarFile.getNextTarEntry(TarFile.java:250)&lt;br/&gt;
at org.apache.commons.compress.archivers.tar.TarFile.&amp;lt;init&amp;gt;(TarFile.java:211)&lt;br/&gt;
at org.apache.commons.compress.archivers.tar.TarFile.&amp;lt;init&amp;gt;(TarFile.java:94)&lt;br/&gt;
at TarFileTimeout.main(TarFileTimeout.java:22)&lt;/p&gt;

&lt;p&gt;I attached both the tar file and a Java reproducer for this issue.&lt;/p&gt;

&lt;p&gt;Citing Stefan Bodewig&apos;s analysis of this issue:&lt;br/&gt;
Your archive contains an entry with a claimed size of -512 bytes. When&lt;br/&gt;
TarFile reads entries it tries to skip the content of th entry as it is&lt;br/&gt;
only interested in meta data on a first scan and does so by positioning&lt;br/&gt;
the input stream right after the data of the current entry. In this case&lt;br/&gt;
it positions it 512 bytes backwards right at the start of the current&lt;br/&gt;
entry&apos;s meta data again. This leads to an infinite loop that reads a new&lt;br/&gt;
entry, stores the meta data, repositions the stream and starts over&lt;br/&gt;
again. Over time the list of collected meta data eats up all available&lt;br/&gt;
memory.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13361575">COMPRESS-569</key>
            <summary>OutOfMemoryError on a crafted tar file</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="Meumertzheim">Fabian Meumertzheim</reporter>
                        <labels>
                    </labels>
                <created>Mon, 1 Mar 2021 10:43:54 +0000</created>
                <updated>Sun, 7 Mar 2021 10:00:22 +0000</updated>
                            <resolved>Sun, 7 Mar 2021 10:00:22 +0000</resolved>
                                    <version>1.21</version>
                                    <fixVersion>1.21</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17296604" author="bodewig" created="Sat, 6 Mar 2021 17:44:01 +0000"  >&lt;p&gt;I see two issues here:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;we should never accept a negative size for a &lt;tt&gt;TarArchiveEntry&lt;/tt&gt; we read. Instead we should throw an exception because of a broken archive. I&apos;ll take the opportunity to verify we do deal with negative sizes (and potentially other numeric values that are supposed to fall into a specific range) for the other archive types as well.&lt;/li&gt;
	&lt;li&gt;we should check we are not moving backwards in &lt;tt&gt;TarFile&lt;/tt&gt; - this one can be fixed quickly.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17296614" author="bodewig" created="Sat, 6 Mar 2021 17:46:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Meumertzheim&quot; class=&quot;user-hover&quot; rel=&quot;Meumertzheim&quot;&gt;Meumertzheim&lt;/a&gt; can I add your tar archive as a test case to our source tree?&lt;/p&gt;</comment>
                            <comment id="17296633" author="bodewig" created="Sat, 6 Mar 2021 19:34:06 +0000"  >&lt;p&gt;your test now quickly throws an &lt;tt&gt;IOException&lt;/tt&gt; with commit 5c5f8a89&lt;/p&gt;

&lt;p&gt;Interestingly for dump archives some of our valid test cases seem to contain negative sizes, I&apos;ll have to look into this more closely.&lt;/p&gt;</comment>
                            <comment id="17296664" author="meumertzheim" created="Sat, 6 Mar 2021 21:29:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bodewig&quot; class=&quot;user-hover&quot; rel=&quot;bodewig&quot;&gt;bodewig&lt;/a&gt; Yes, feel free to use the archive and reproducer under any license you want. I will let the fuzzer run on the fixed version (&lt;a href=&quot;https://github.com/apache/commons-compress/commit/8543b030e93fa71b6093ac7d4cdb8c4e98bfd63d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/commit/8543b030e93fa71b6093ac7d4cdb8c4e98bfd63d&lt;/a&gt;) and report back if I should get any more findings.&lt;/p&gt;</comment>
                            <comment id="17296819" author="bodewig" created="Sun, 7 Mar 2021 09:59:59 +0000"  >&lt;p&gt;Thank you. I&apos;ve added the test in 5aa752ab&lt;/p&gt;</comment>
                            <comment id="17296820" author="bodewig" created="Sun, 7 Mar 2021 10:00:22 +0000"  >&lt;p&gt;this specific issue can be closed now.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13021373" name="TarFileTimeout.java" size="1243" author="Meumertzheim" created="Mon, 1 Mar 2021 10:42:21 +0000"/>
                            <attachment id="13021374" name="timeout.tar" size="513" author="Meumertzheim" created="Mon, 1 Mar 2021 10:42:11 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 35 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0o5z4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>