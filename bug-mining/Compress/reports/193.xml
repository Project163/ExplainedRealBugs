<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:31:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[COMPRESS-331] Some non TAR files are recognized by ArchiveStreamFactory</title>
                <link>https://issues.apache.org/jira/browse/COMPRESS-331</link>
                <project id="12310904" key="COMPRESS">Commons Compress</project>
                    <description>&lt;p&gt;I ran into a case where a PNG file is being recognized as TAR because &lt;tt&gt;TarUtils.verifyCheckSum&lt;/tt&gt; reports it as having a valid checksum (in this case the code thinks the stored checksum is 36936, unsigned is 31155 and signed is 19635). Because the stored checksum value is larger then the unsigned checksum it is treated as a valid TAR.&lt;/p&gt;

&lt;p&gt;I haven&apos;t spent enough time digging into the problem to see if there is a good alternative to the existing check that doesn&apos;t have false positives like this PNG file (which, if anyone is interested comes from an Android download).&lt;/p&gt;

&lt;p&gt;Also, I noticed a minor thing in the code: the comment in &lt;tt&gt;TarUtils.verifyCheckSum&lt;/tt&gt; has the wrong bug number listed (it says 177 instead of 117).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12933625">COMPRESS-331</key>
            <summary>Some non TAR files are recognized by ArchiveStreamFactory</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jgustie">Jeremy Gustie</reporter>
                        <labels>
                    </labels>
                <created>Sat, 23 Jan 2016 20:40:07 +0000</created>
                <updated>Sun, 31 Jan 2016 12:14:50 +0000</updated>
                            <resolved>Sun, 31 Jan 2016 12:14:50 +0000</resolved>
                                    <version>1.10</version>
                                    <fixVersion>1.11</fixVersion>
                                    <component>Archivers</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15113966" author="jgustie" created="Sat, 23 Jan 2016 21:22:40 +0000"  >&lt;p&gt;There are a number of garbage values in the first entry (the one whose &lt;tt&gt;isCheckSumOK&lt;/tt&gt; is called): perhaps in addition to the current &lt;tt&gt;isCheckSumOK&lt;/tt&gt; check the archive stream factory can also sanity check something like the device number.&lt;/p&gt;

&lt;p&gt;From my understanding of the comments, another possibility might be only allowing the &lt;tt&gt;storedSum &amp;gt; unsignedSum&lt;/tt&gt; check if the magic is blank. The magic would need to be captured like stored sum is now for this additional check (it looks like the magic offset is already a constant).&lt;/p&gt;

&lt;p&gt;Here are the values on the entry I am seeing from the &lt;tt&gt;ic_secure.png&lt;/tt&gt; (note that I zapped a bunch of Gremlins in the name to avoid problems) just in case some one has some better ideas for how to quickly identify obviously bad entries:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;tt&gt;checkSumOK&lt;/tt&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;tt&gt;true&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;tt&gt;devMajor&lt;/tt&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;tt&gt;2134088&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;tt&gt;devMinor&lt;/tt&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;tt&gt;2363913&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;tt&gt;file&lt;/tt&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;tt&gt;null&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;tt&gt;groupId&lt;/tt&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;tt&gt;2134088&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;tt&gt;groupName&lt;/tt&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;tt&gt;&quot;01101101101101101101101101101101&quot;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;tt&gt;isExtended&lt;/tt&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;tt&gt;false&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;tt&gt;linkFlag&lt;/tt&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;tt&gt;48&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;tt&gt;linkName&lt;/tt&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;tt&gt;&quot;1101101101101101101101101101101101101101101101101101101101101101101101101101101101101101101101101101&quot;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;tt&gt;magic&lt;/tt&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;tt&gt;&quot;101101&quot;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;tt&gt;mode&lt;/tt&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;tt&gt;2363913&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;tt&gt;modTime&lt;/tt&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;tt&gt;9682587720&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;tt&gt;name&lt;/tt&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;tt&gt;&quot;01101101101101...blah...blah...blah...PNG...blah...blah...blah...110110110110110110110110110110110&quot;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;tt&gt;realSize&lt;/tt&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;tt&gt;0&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;tt&gt;size&lt;/tt&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;tt&gt;9682587720&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;tt&gt;userId&lt;/tt&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;tt&gt;295489&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;tt&gt;userName&lt;/tt&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;tt&gt;&quot;11011011011011011011011011011011&quot;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;tt&gt;version&lt;/tt&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;tt&gt;&quot;10&quot;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15114277" author="tcurdt" created="Sun, 24 Jan 2016 11:11:47 +0000"  >&lt;p&gt;Honestly - that&apos;s not how the factory was intended to be used.&lt;/p&gt;

&lt;p&gt;It was intended to be used to tell apart archives - not let you throw random files at it to see if it&apos;s an archive or not. The latter is a much broader problem and not really in the scope of commons compress.&lt;/p&gt;

&lt;p&gt;So you should pre-filter those files.&lt;br/&gt;
I am not sure this is a valid issue for commons compress.&lt;/p&gt;</comment>
                            <comment id="15114286" author="bodewig" created="Sun, 24 Jan 2016 12:09:20 +0000"  >&lt;p&gt;Unfortunately there are tons of tar dialects that can all be extracted properly by GNU tar - which usually means it would be a bug if Commons Compress failed to extract them. This means we may need to refine our heuristics as we go.&lt;/p&gt;

&lt;p&gt;I&apos;m not convinced device numbers are good candidates, though, the fields may contain binary data in the star case and there is no clear upper bound for them. I don&apos;t see any values that are clear candidates for &quot;garbage&quot; in your case. I&apos;ll take another dive into GNU tar&apos;s code base to see how they verify checksums.&lt;/p&gt;</comment>
                            <comment id="15114377" author="bodewig" created="Sun, 24 Jan 2016 16:44:52 +0000"  >&lt;p&gt;That&apos;s not what I had expected: GNU tar does an exact match on the checksum (unsigned or signed), no special handling and &quot;greater than&quot; checks at all. Maybe our test case for &lt;a href=&quot;https://issues.apache.org/jira/browse/COMPRESS-117&quot; title=&quot;Certain tar files not recognised by ArchiveStreamFactory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COMPRESS-117&quot;&gt;&lt;del&gt;COMPRESS-117&lt;/del&gt;&lt;/a&gt; isn&apos;t good enough, I&apos;ll double-check.&lt;/p&gt;</comment>
                            <comment id="15114382" author="bodewig" created="Sun, 24 Jan 2016 17:07:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sebb%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;sebb@apache.org&quot;&gt;sebb@apache.org&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jukkaz&quot; class=&quot;user-hover&quot; rel=&quot;jukkaz&quot;&gt;jukkaz&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tcurdt&quot; class=&quot;user-hover&quot; rel=&quot;tcurdt&quot;&gt;tcurdt&lt;/a&gt; maybe your memory is better than mine.&lt;/p&gt;

&lt;p&gt;The archive added as testcase for &lt;a href=&quot;https://issues.apache.org/jira/browse/COMPRESS-117&quot; title=&quot;Certain tar files not recognised by ArchiveStreamFactory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COMPRESS-117&quot;&gt;&lt;del&gt;COMPRESS-117&lt;/del&gt;&lt;/a&gt; is not the one attached to the issue itself and this is what GNU tar says:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$ tar tvf src/test/resources/COMPRESS-117.tar 
tar: This does not look like a tar archive
tar: Skipping to next header
-rw-r--r-- tcurdt/tcurdt    82 2007-11-14 11:19 test2.xml
tar: Exiting with failure status due to previous errors
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When I insert the first 512 bytes of the tar attached to &lt;a href=&quot;https://issues.apache.org/jira/browse/COMPRESS-117&quot; title=&quot;Certain tar files not recognised by ArchiveStreamFactory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COMPRESS-117&quot;&gt;&lt;del&gt;COMPRESS-117&lt;/del&gt;&lt;/a&gt; into &lt;tt&gt;TarUtilsTest&lt;/tt&gt; then the checksums match exactly. To me it looks as if the test for &lt;tt&gt;storedSum &amp;gt; unsignedSum&lt;/tt&gt; was unneeded and only added to accommodate for a broken test case. Does anybody remember where the initial test came from?&lt;/p&gt;</comment>
                            <comment id="15114393" author="jgustie" created="Sun, 24 Jan 2016 17:32:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bodewig&quot; class=&quot;user-hover&quot; rel=&quot;bodewig&quot;&gt;bodewig&lt;/a&gt; thanks for digging into this; I had noticed the exact checksum hit on the file attached to &lt;a href=&quot;https://issues.apache.org/jira/browse/COMPRESS-117&quot; title=&quot;Certain tar files not recognised by ArchiveStreamFactory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COMPRESS-117&quot;&gt;&lt;del&gt;COMPRESS-117&lt;/del&gt;&lt;/a&gt;, but wasn&apos;t sure if there were other cases that did in fact necessitate the greater then check (that&apos;s why I initially thought that maybe empty magic could be used to toggle the check).&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tcurdt&quot; class=&quot;user-hover&quot; rel=&quot;tcurdt&quot;&gt;tcurdt&lt;/a&gt; are you suggesting that I pre-filter arbitrary files using something like Tika before passing them on to &lt;tt&gt;ArchiveStreamFactory&lt;/tt&gt;? I guess that would likely catch the obvious non-archive cases like this PNG file. For this particular application I am not worried about catching an &lt;tt&gt;ArchiveException&lt;/tt&gt; (wrapped or not) further into processing if the stream turns out to be a non-archive, but the attached file actually gets treated as a TAR file successfully all the way through. I checked with GNU TAR 1.27.1 and the default TAR implementation on OS X (bsdtar 2.8.3) and they both identify the file as not being a TAR archive.&lt;/p&gt;</comment>
                            <comment id="15114402" author="tcurdt" created="Sun, 24 Jan 2016 17:45:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jgustie&quot; class=&quot;user-hover&quot; rel=&quot;jgustie&quot;&gt;jgustie&lt;/a&gt; yes, that&apos;s what I am suggesting. Maybe even based on the extension (if that&apos;s enough for the use case).&lt;/p&gt;

&lt;p&gt;The idea was to make the factory somewhat smart - but not to replicate Tika (or similar).&lt;/p&gt;</comment>
                            <comment id="15125311" author="bodewig" created="Sun, 31 Jan 2016 12:14:50 +0000"  >&lt;p&gt;To me it really looks as if our checksum validation has been too lenient and I&apos;ve made it more strict with git commit 1fb4298.&lt;/p&gt;

&lt;p&gt;I&apos;ve replaced the archive added as &lt;a href=&quot;https://issues.apache.org/jira/browse/COMPRESS-117&quot; title=&quot;Certain tar files not recognised by ArchiveStreamFactory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COMPRESS-117&quot;&gt;&lt;del&gt;COMPRESS-117&lt;/del&gt;&lt;/a&gt;.tar with the first entry of the original archive appended to said bug report.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12471241">COMPRESS-117</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12784036" name="ic_secure.png" size="1026" author="jgustie" created="Sat, 23 Jan 2016 20:41:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 41 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2rw5b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>