<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:31:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[COMPRESS-351] Defective .zip-archive produces problematic error message</title>
                <link>https://issues.apache.org/jira/browse/COMPRESS-351</link>
                <project id="12310904" key="COMPRESS">Commons Compress</project>
                    <description>&lt;p&gt;A truncated .zip-File produces an java.io.EOFException conatining a hughe amount of byte[]-data in the error-message - leading to beeps and crippeling workload in an potential console-logger.&lt;/p&gt;
</description>
                <environment>&lt;p&gt;Production&lt;/p&gt;</environment>
        <key id="12958882">COMPRESS-351</key>
            <summary>Defective .zip-archive produces problematic error message</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="Sven.Kustos">Sven Kustos</reporter>
                        <labels>
                    </labels>
                <created>Thu, 14 Apr 2016 15:43:47 +0000</created>
                <updated>Tue, 7 Jun 2016 16:47:27 +0000</updated>
                            <resolved>Tue, 7 Jun 2016 16:47:27 +0000</resolved>
                                    <version>1.11</version>
                                    <fixVersion>1.12</fixVersion>
                                    <component>Archivers</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15241386" author="sven.kustos" created="Thu, 14 Apr 2016 15:47:52 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;test.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; getUnzippedFileSize(&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] zippedData){
        &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; byteSize = 0;
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;(ZipArchiveInputStream zipArchiveInputStream = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ZipArchiveInputStream(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ByteArrayInputStream(zippedData))){
            ArchiveEntry zipEntry = zipArchiveInputStream.getNextEntry();
            &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt;(zipEntry != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;){
                byteSize = byteSize + zipEntry.getSize();
                zipEntry = zipArchiveInputStream.getNextEntry();
            }
        }
        &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RuntimeException(e);
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; byteSize;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15244300" author="bodewig" created="Sat, 16 Apr 2016 16:40:14 +0000"  >&lt;p&gt;The output you see is what Compress considers the entry&apos;s file name. It looks as if there was some garbage inside the local file header that results in bigger blob being considered the name. I&apos;ll try to find a way to verify the name consists of printing characters or something like this.&lt;/p&gt;

&lt;p&gt;Is it OK to ship the attached archive as a unit test with Compress?&lt;/p&gt;</comment>
                            <comment id="15244310" author="sebb@apache.org" created="Sat, 16 Apr 2016 17:13:55 +0000"  >&lt;p&gt;Note that names don&apos;t have to consist of printable characters. &lt;br/&gt;
AFAIK Unix allows anything except &apos;/&apos; and null.&lt;/p&gt;

&lt;p&gt;So Compress must allow such names to be processed.&lt;/p&gt;

&lt;p&gt;The most that it can do is to sanitize the IOE message.&lt;br/&gt;
But I&apos;m not sure that&apos;s the best approach, because it will lose information that the app may need.&lt;/p&gt;

&lt;p&gt;An alternative approach would be to change the Javadoc to note that the IOE may contain unprintable characters and let the application sanitize it.&lt;/p&gt;</comment>
                            <comment id="15244527" author="bodewig" created="Sun, 17 Apr 2016 04:00:31 +0000"  >&lt;p&gt;Yes, I&apos;m only thinking about modifying the exception message - of course we&apos;ll accept as names whatever has been accepted before.&lt;/p&gt;</comment>
                            <comment id="15244538" author="bodewig" created="Sun, 17 Apr 2016 05:08:03 +0000"  >&lt;p&gt;should be fixed with git commit ddb8f08 - still it would be good if we could use the attached archive as a test case&lt;/p&gt;</comment>
                            <comment id="15244579" author="sebb@apache.org" created="Sun, 17 Apr 2016 09:04:40 +0000"  >&lt;p&gt;But the name may not be corrupted.&lt;br/&gt;
All we really know is that the archive is truncated.&lt;/p&gt;

&lt;p&gt;If there are any other examples of Exceptions which include the file name these would need to be &apos;protected&apos; too.&lt;br/&gt;
So I&apos;m still inclined to leave it to the app.&lt;/p&gt;

&lt;p&gt;However if it is decided to keep the amended name, I would rather see the message clarified to&lt;br/&gt;
&quot;possibly corrupted name&quot;.&lt;/p&gt;

&lt;p&gt;Or maybe keep the full name but replace non-printable chars with &apos;?&apos; as is done by ls(1).&lt;/p&gt;</comment>
                            <comment id="15244611" author="bodewig" created="Sun, 17 Apr 2016 10:11:56 +0000"  >&lt;p&gt;You are correct, the name may be included in other exceptions as well - like failing to parse extra fields or unsupported zip features being requested - anything of which may well happen if the archive is corrupt.&lt;/p&gt;

&lt;p&gt;Leaving it to the application doesn&apos;t feel right to me. If you log an exception you don&apos;t expect it to contain &quot;garbage&quot; in its message - and as it stands we&apos;d have to add a disclaimer of &quot;any exception may contain garbage if the archive is corrupt&quot; to &lt;tt&gt;ZipArchiveInputStream&lt;/tt&gt;. &lt;tt&gt;ZipFile&lt;/tt&gt; is safe in most cases as it won&apos;t find any &quot;end of central directory&quot; record and fail with a usable message.&lt;/p&gt;

&lt;p&gt;I guess sanitizing all entry names that are leaked via exceptions is the best route.&lt;/p&gt;</comment>
                            <comment id="15244615" author="sebb@apache.org" created="Sun, 17 Apr 2016 10:23:02 +0000"  >&lt;p&gt;The same applies to other archive formats as well since they all may be used on Unix.&lt;/p&gt;

&lt;p&gt;We could either sanitise the names (replace unprintable chars with &apos;?&apos;) or provide a utility method to do so.&lt;/p&gt;

&lt;p&gt;Maybe worth considering providing access to the raw name somehow.&lt;/p&gt;</comment>
                            <comment id="15244618" author="bodewig" created="Sun, 17 Apr 2016 10:29:38 +0000"  >&lt;p&gt;access to the raw name would only be possible if we threw exception types of our own. Some kind of CommonsCompressIOException or something. I&apos;m not sure this would be worth the effort.&lt;/p&gt;

&lt;p&gt;As for the other formats, yes, I&apos;ve realized this myself as well. I&apos;d put the utility method into &lt;tt&gt;ArchiveUtils&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15255946" author="sven.kustos" created="Mon, 25 Apr 2016 06:21:05 +0000"  >&lt;p&gt;Hi Stefan, feel free to add the attached archive as a test case - it&apos;s only conatining generated test data.&lt;/p&gt;</comment>
                            <comment id="15257531" author="bodewig" created="Tue, 26 Apr 2016 04:07:32 +0000"  >&lt;p&gt;Thanks, I have added a testcase.&lt;/p&gt;

&lt;p&gt;By now I&apos;ve modified the code to sanitize the file name by replacing non-printable characters with &apos;?&apos; but need to find the time to use the same approach throughout the codebase - and look into the current Jenkins build which failed after I added the test.&lt;/p&gt;</comment>
                            <comment id="15257675" author="sven.kustos" created="Tue, 26 Apr 2016 07:14:58 +0000"  >&lt;p&gt;Your&apos;re welcome! Beside &quot;unprintable&quot; characters in the output, the sheer size of it was another problem. May I suggest truncating it to 255 characters? This will still provide enough data for the purpose of an error message and probably also address the jenkins-issue.&lt;/p&gt;</comment>
                            <comment id="15318813" author="bodewig" created="Tue, 7 Jun 2016 16:28:58 +0000"  >&lt;p&gt;finally, sorry for the delay.&lt;/p&gt;

&lt;p&gt;commit 11840df restricts the length to 255 chars as you suggested.&lt;/p&gt;</comment>
                            <comment id="15318848" author="bodewig" created="Tue, 7 Jun 2016 16:47:27 +0000"  >&lt;p&gt;Looks as if only CPIO would also include entry names read in exception messages. Fixed with git commit b5071c2&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12798760" name="DefectiveZipFileCausingBeeps.ZIP" size="36996" author="Sven.Kustos" created="Thu, 14 Apr 2016 15:44:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 23 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2w4on:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>