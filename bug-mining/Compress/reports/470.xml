<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:35:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[COMPRESS-661] ArchiveInputStream markSupported should always return false</title>
                <link>https://issues.apache.org/jira/browse/COMPRESS-661</link>
                <project id="12310904" key="COMPRESS">Commons Compress</project>
                    <description>&lt;p&gt;Apache Commons Compress 1.26.0 fixes&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://www.cve.org/CVERecord?id=CVE-2024-25710&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.cve.org/CVERecord?id=CVE-2024-25710&lt;/a&gt; and&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://www.cve.org/CVERecord?id=CVE-2024-26308&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.cve.org/CVERecord?id=CVE-2024-26308&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;We have tried to replace Apache Commons Compress 1.25.0 with 1.26.0 in our deployments in order to fix these security vulnerabilities. But unfortunately now Apache Tika is broken:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  org.apache.tika.exception.TikaException: TIKA-198: Illegal IOException from org.apache.tika.parser.iwork.IWorkPackageParser@41fcb910
    at app//org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:304)
    at app//org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:298)
    at app//org.apache.tika.parser.AutoDetectParser.parse(AutoDetectParser.java:203)
    at app//org.apache.tika.Tika.parseToString(Tika.java:525)
    at app//org.apache.tika.Tika.parseToString(Tika.java:495)
    at ...
  Caused by: java.io.IOException: Resetting to invalid mark
    at java.base/java.io.BufferedInputStream.reset(BufferedInputStream.java:446)
    at org.apache.tika.parser.iwork.IWorkPackageParser.parse(IWorkPackageParser.java:97)
    at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:298)
    ... 42 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13569161">COMPRESS-661</key>
            <summary>ArchiveInputStream markSupported should always return false</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="veita">Alexander Veit</reporter>
                        <labels>
                    </labels>
                <created>Tue, 20 Feb 2024 09:01:18 +0000</created>
                <updated>Thu, 14 Mar 2024 08:19:52 +0000</updated>
                            <resolved>Tue, 5 Mar 2024 13:30:23 +0000</resolved>
                                    <version>1.26.0</version>
                                    <fixVersion>1.26.1</fixVersion>
                                    <component>Compressors</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="17818775" author="tilman" created="Tue, 20 Feb 2024 11:52:46 +0000"  >&lt;p&gt;I&apos;m working on it&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/tika/pull/1605&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/pull/1605&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The bug mentioned here is the &quot;harmless&quot; one, it goes away by increasing the parameter to mark(). However there are more test failures, I&apos;m trying to get around them.&lt;/p&gt;</comment>
                            <comment id="17818792" author="tilman" created="Tue, 20 Feb 2024 12:31:27 +0000"  >&lt;p&gt;I&apos;m wondering if the previous version had mark / reset features that this one doesn&apos;t have? Or didn&apos;t have and has it now?&lt;/p&gt;</comment>
                            <comment id="17818863" author="tilman" created="Tue, 20 Feb 2024 15:27:57 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
ArArchiveInputStream ar = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArArchiveInputStream(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BufferedInputStream(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileInputStream(&lt;span class=&quot;code-quote&quot;&gt;&quot;....../testARofText.ar&quot;&lt;/span&gt;)));
&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;ar.markSupported(): &quot;&lt;/span&gt; + ar.markSupported());

ArArchiveEntry aentry;
&lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; ((aentry = ar.getNextEntry()) != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
{
    ar.mark(10);
    ar.read(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[10]);
    ar.reset();
    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;AR: &quot;&lt;/span&gt; + &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;(ar.readAllBytes()));
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This code will (properly) fail with 1.25.0 because mark/release is not supported and markSupported() is false:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ar.markSupported(): false
Exception in thread &quot;main&quot; java.io.IOException: mark/reset not supported
	at java.base/java.io.InputStream.reset(InputStream.java:655)
	at com.mycompany.maventikaproject.TilmanSevenTest.main(TilmanSevenTest.java:62)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With 1.26.0 it will bring this, while markSupported() is true:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ar.markSupported(): true
AR: Test d&apos;indexation de Txt
http://www.a
Exception in thread &quot;main&quot; java.io.IOException: Truncated ar archive
	at org.apache.commons.compress.archivers.ar.ArArchiveInputStream.getNextArEntry(ArArchiveInputStream.java:281)
	at org.apache.commons.compress.archivers.ar.ArArchiveInputStream.getNextEntry(ArArchiveInputStream.java:351)
	at com.mycompany.maventikaproject.TilmanSevenTest.main(TilmanSevenTest.java:58)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17818875" author="tallison@mitre.org" created="Tue, 20 Feb 2024 15:48:28 +0000"  >&lt;p&gt;This explains the 7z failures (and others?) in Tika. When we wrap an InputStream in a TikaInputStream with get(InputStream...), we test for whether &lt;tt&gt;markSupported()&lt;/tt&gt;. If it isn&apos;t supported, we wrap the stream in a BufferedInputStream. I&apos;m seeing the same change in behavior with &lt;tt&gt;markSupported()&lt;/tt&gt; in 1.25.0 vs 1.26.0.&lt;/p&gt;</comment>
                            <comment id="17818898" author="tilman" created="Tue, 20 Feb 2024 16:34:38 +0000"  >&lt;p&gt;Might be this one:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/commons-compress/commit/92d382e3cd6f1199340121ee8ad3bdf95f2154d0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/commit/92d382e3cd6f1199340121ee8ad3bdf95f2154d0&lt;/a&gt;&lt;br/&gt;
FilterInputStream delegates markSupported(), but InputStream returns false. If I&apos;m right then the solution would be to return false instead of not having markSupported() in ArchiveInputStream.&lt;/p&gt;</comment>
                            <comment id="17823334" author="garydgregory" created="Mon, 4 Mar 2024 20:48:14 +0000"  >&lt;p&gt;Hi All &lt;/p&gt;

&lt;p&gt;I added the attached jar file as a test fixture for &lt;tt&gt;org.apache.commons.compress.archivers.ListerTest&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Can you test git master or a snapshot build from &lt;a href=&quot;https://repository.apache.org/content/repositories/snapshots/org/apache/commons/commons-compress/1.26.1-SNAPSHOT/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/repositories/snapshots/org/apache/commons/commons-compress/1.26.1-SNAPSHOT/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17823501" author="tilman" created="Tue, 5 Mar 2024 08:56:44 +0000"  >&lt;p&gt;I built it locally and the tika build problems still occur if I revert my workaround. They could be fixed by adding this at the end of ArchiveInputStream.java&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    /**
     * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; Always returns &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;.
     */
    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; markSupported() {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
    }

    /**
     * Does nothing.
     */
    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; void reset() {
    }

    /**
     * Does nothing.
     * 
     * @param readlimit
     */
    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; void mark(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; readlimit) {        
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17823575" author="garydgregory" created="Tue, 5 Mar 2024 11:39:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; &lt;br/&gt;
Can you come up with a test case I can use as a unit test?&lt;br/&gt;
TY!&lt;/p&gt;</comment>
                            <comment id="17823588" author="tilman" created="Tue, 5 Mar 2024 12:27:06 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

@Test
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testCompress661() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (InputStream in = newInputStream(&lt;span class=&quot;code-quote&quot;&gt;&quot;org/apache/commons/compress/COMPRESS-661/testARofText.ar&quot;&lt;/span&gt;);
            ArArchiveInputStream archive = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArArchiveInputStream(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BufferedInputStream(in))) {
        assertNotNull(archive.getNextEntry());
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (archive.markSupported()) {
            &lt;span class=&quot;code-comment&quot;&gt;// mark() shouldn&apos;t be supported, but &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; it would be,
&lt;/span&gt;            &lt;span class=&quot;code-comment&quot;&gt;// mark+read+reset should not &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; any harm.
&lt;/span&gt;            archive.mark(10);
            archive.read(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[10]);
            archive.reset();
        }
        &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] ba = IOUtils.toByteArray(archive);
        assertEquals(&lt;span class=&quot;code-quote&quot;&gt;&quot;Test d&apos;indexation de Txt\nhttp:&lt;span class=&quot;code-comment&quot;&gt;//www.apache.org\n&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;(ba));
&lt;/span&gt;        assertEquals(-1, archive.read());
        assertEquals(-1, archive.read());
        assertNull(archive.getNextEntry());
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17823610" author="garydgregory" created="Tue, 5 Mar 2024 13:09:06 +0000"  >&lt;p&gt;TY &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt;&lt;br/&gt;
I&apos;ll check it out later today/tonight.&lt;/p&gt;</comment>
                            <comment id="17823617" author="garydgregory" created="Tue, 5 Mar 2024 13:28:46 +0000"  >&lt;ul&gt;
	&lt;li&gt;Changed title to &quot;ArchiveInputStream markSupported should always return false&quot;.&lt;/li&gt;
	&lt;li&gt;Created &lt;a href=&quot;https://issues.apache.org/jira/browse/COMPRESS-670&quot; title=&quot;Support mark() and reset() in ArchiveInputStream&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COMPRESS-670&quot;&gt;COMPRESS-670&lt;/a&gt; and linked to this ticket.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17823655" author="tilman" created="Tue, 5 Mar 2024 14:54:21 +0000"  >&lt;p&gt;I made a small mistake, I forgot to add &quot;throws Exception&quot; to the reset() method. Could you please add that? The way it is now it makes it impossible to write a delegate like this&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; void reset() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
            in.reset();
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13570837">COMPRESS-670</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13569188">TIKA-4199</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13066911" name="testARofText.ar" size="116" author="tilman" created="Tue, 20 Feb 2024 15:24:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 35 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1ni40:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>