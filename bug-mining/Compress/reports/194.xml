<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:31:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[COMPRESS-330] Tar UnArchive Fails when archive contains directory sizes which are non-zero.</title>
                <link>https://issues.apache.org/jira/browse/COMPRESS-330</link>
                <project id="12310904" key="COMPRESS">Commons Compress</project>
                    <description>&lt;p&gt;Tar UnArchive Fails when archive contains directory sizes which are non-zero. I recently came across a set of files which failed to extract with commons-compress but I was able to successfully extract the files with GNU tar. &lt;/p&gt;

&lt;p&gt;The problem is TarArchiveInputStream.java gets the size of each entry in a tar archive to determine how many bytes to read ahead. Directories are always sized 0 bytes, however its technically possible a tar archive contains a size for a directory. This causes the Input Stream to loose it&apos;s place and eventually results in an exception being thrown.&lt;/p&gt;

&lt;p&gt;I was able to implement a proof-of-concept fix by checking if an entity is a directory and setting the directory size to 0. (A directory with Files in a Tar Archive still has a size of 0 as the directory itself does not have size in the archive.)&lt;/p&gt;</description>
                <environment>&lt;p&gt;Java 1.8&lt;/p&gt;</environment>
        <key id="12932492">COMPRESS-330</key>
            <summary>Tar UnArchive Fails when archive contains directory sizes which are non-zero.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="dye357">Dye357</reporter>
                        <labels>
                    </labels>
                <created>Tue, 19 Jan 2016 18:55:44 +0000</created>
                <updated>Wed, 23 Mar 2016 17:31:20 +0000</updated>
                            <resolved>Sun, 20 Mar 2016 19:44:11 +0000</resolved>
                                    <version>1.10</version>
                                    <fixVersion>1.11</fixVersion>
                                    <component>Archivers</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15107199" author="dye357" created="Tue, 19 Jan 2016 18:58:12 +0000"  >&lt;p&gt;I will attach my proposed patch/fix shortly. &lt;/p&gt;</comment>
                            <comment id="15108021" author="bodewig" created="Wed, 20 Jan 2016 05:07:56 +0000"  >&lt;p&gt;Thanks a lot, it would be good if you could add an example archive we can use for a unit test.&lt;/p&gt;

&lt;p&gt;Out of curiosity: do you know which tool created the tar archives with non-zero directory sizes?&lt;/p&gt;</comment>
                            <comment id="15109730" author="dye357" created="Wed, 20 Jan 2016 23:27:44 +0000"  >&lt;p&gt;Proposed Patch for Compress-330 - feel free to improve &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15109785" author="dye357" created="Thu, 21 Jan 2016 00:09:32 +0000"  >&lt;p&gt;Sure thing! I&apos;m trying to create a synthetic tar with the wrong directory size which mirrors my broken case as well as a unit test, will post it when I have it.&lt;/p&gt;</comment>
                            <comment id="15113760" author="bodewig" created="Sat, 23 Jan 2016 14:08:13 +0000"  >&lt;p&gt;Thanks. Your patch looks backwards (removing your changes), but that&apos;s no problem. But I&apos;m afraid you forgot to add &lt;a href=&quot;https://issues.apache.org/jira/browse/COMPRESS-330&quot; title=&quot;Tar UnArchive Fails when archive contains directory sizes which are non-zero.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COMPRESS-330&quot;&gt;&lt;del&gt;COMPRESS-330&lt;/del&gt;&lt;/a&gt;.tar&lt;/p&gt;</comment>
                            <comment id="15125312" author="bodewig" created="Sun, 31 Jan 2016 12:17:29 +0000"  >&lt;p&gt;without the tar archive itself, there isn&apos;t much we can do.&lt;/p&gt;</comment>
                            <comment id="15125336" author="dye357" created="Sun, 31 Jan 2016 13:44:18 +0000"  >&lt;p&gt;Sorry for the long delay, I can&apos;t upload the tar in question since it contains private information - so I have been trying to synthetically manipulate a dummy tar file but so far I have been unable to reproduce the issue using the dummy tar file. I will try and spend some more time on this later this week. If I&apos;m unable to reliably reproduce the issue I will close the ticket.&lt;/p&gt;</comment>
                            <comment id="15125381" author="bodewig" created="Sun, 31 Jan 2016 15:27:23 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dye357&quot; class=&quot;user-hover&quot; rel=&quot;dye357&quot;&gt;dye357&lt;/a&gt;, please don&apos;t close the issue if there is a real problem. I fully understand the problem of archives containing private information.&lt;/p&gt;

&lt;p&gt;If you knew which tool generated the archive, maybe you could create a new archive with dummy data using that tool. Otherwise it is pretty easy for us to pick an arbitrary tar that contains a directory and manipulate the size (getting the checksum to match is the only minor issue) - we can do so ourselves. It&apos;s just that I&apos;d personally prefer a real world archive.&lt;/p&gt;</comment>
                            <comment id="15132280" author="dye357" created="Thu, 4 Feb 2016 13:13:38 +0000"  >&lt;p&gt;I can confirm the tar archive was created by 7zip, still trying to figure out which version. (The file was sent to me by another party)&lt;/p&gt;

&lt;p&gt;I debugged the tar in question this morning, I discovered the entrySize for the directory which causes the error is coming back as 32768. I thought that was a little suspicious since that is the max negative size of an int in various languages. So I quick wrote a unit test just to understand how the parseOctalOrBinary Method worked:&lt;/p&gt;

&lt;p&gt;    @Test&lt;br/&gt;
    public void testParseOctal() &lt;/p&gt;
{
        byte[] buffer = new byte[12];
        buffer[0] = 32;
        buffer[1] = 32;
        buffer[2] = 32;
        buffer[3] = 32;
        buffer[4] = 32;
        buffer[5] = 49;
        buffer[6] = 48;
        buffer[7] = 48;
        buffer[8] = 48;
        buffer[9] = 48;
        buffer[10] = 48;
        buffer[11] = 32;

        long result = TarUtils.parseOctalOrBinary(buffer, 0, 12);
        assert result == 32768;
    }

&lt;p&gt;The byte array above is an exact copy of the entry size header of the file in question - I tried setting the entry size in my dummy tar to that exact byte array but my unit test still passes. When I use the file in question I get an IllegalArugmentEcxeption: Invalid byte 85 at offset 0 in &apos;&amp;lt;randomBinaryString&amp;gt;&apos; len=12&lt;/p&gt;</comment>
                            <comment id="15134490" author="bodewig" created="Fri, 5 Feb 2016 17:10:39 +0000"  >&lt;p&gt;the parser results in what would be expected, see git commit 9b852f3&lt;/p&gt;

&lt;p&gt;I think I&apos;ve fixed the problem with a slightly different approach (that does what GNU tar does, keep the size information but ignore it) with git commit 51eb0f2 - any chance you could verify it works for you?&lt;/p&gt;</comment>
                            <comment id="15196061" author="bodewig" created="Tue, 15 Mar 2016 19:46:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dyee357&quot; class=&quot;user-hover&quot; rel=&quot;dyee357&quot;&gt;dyee357&lt;/a&gt; - have you had any chance to give a snapshot build a try?&lt;/p&gt;</comment>
                            <comment id="15203485" author="bodewig" created="Sun, 20 Mar 2016 19:44:11 +0000"  >&lt;p&gt;Assuming it is fixed, please reopen the ticket if you encounter any problems.&lt;/p&gt;</comment>
                            <comment id="15208823" author="dye357" created="Wed, 23 Mar 2016 17:31:20 +0000"  >&lt;p&gt;Will do, thanks for looking into this.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12783460" name="Compress-330.patch" size="2249" author="dye357" created="Wed, 20 Jan 2016 23:27:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 34 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2rp6f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>