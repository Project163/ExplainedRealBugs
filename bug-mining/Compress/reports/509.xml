<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:36:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[COMPRESS-708] ZstdCompressorInputStream closes the InputStream held by ZipArchiveInputStream garbage collection</title>
                <link>https://issues.apache.org/jira/browse/COMPRESS-708</link>
                <project id="12310904" key="COMPRESS">Commons Compress</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Test
void testZstdInputStreamErrorCloseWhenGc() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception  {
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; File archive = getFile(&lt;span class=&quot;code-quote&quot;&gt;&quot;COMPRESS-692/compress-692.zip&quot;&lt;/span&gt;);
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i =0; i&amp;lt; 50;i++) {
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (FileInputStream fileInputStream = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileInputStream(archive);
             ZipArchiveInputStream zipArchiveInputStream = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ZipArchiveInputStream(fileInputStream)){
            ArchiveEntry entry;
            &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; ((entry = zipArchiveInputStream.getNextEntry()) != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (entry.isDirectory()) {
                    &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;
                }
                &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.gc();
                IOUtils.toByteArray(zipArchiveInputStream);
            }
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {
            fail(&lt;span class=&quot;code-quote&quot;&gt;&quot;testZstdInputStreamErrorCloseWhenGc error, test error at batch &quot;&lt;/span&gt; + (i+1), e);
        }
    }
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Here is the test method. Without the line&#160;&lt;tt&gt;System.gc();&lt;/tt&gt;, it may take multiple execution rounds to trigger the bug, but with this line added, the bug is almost immediately triggered. Below is the error stack log.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13078214/13078214_image-2025-09-03-22-46-38-243.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;I found that this is caused by the following:&#160;The bug occurred because the ZstdInputStream used in ZstdCompressorInputStream would close the underlying InputStream during GC, which in turn caused errors like &quot;stream closed&quot; for other wrapper streams (such as ZipArchiveInputStream) that depend on this underlying stream.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13628005">COMPRESS-708</key>
            <summary>ZstdCompressorInputStream closes the InputStream held by ZipArchiveInputStream garbage collection</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="yuweiboy">&#36213;&#38064;&#29614;</reporter>
                        <labels>
                    </labels>
                <created>Wed, 3 Sep 2025 14:45:34 +0000</created>
                <updated>Thu, 18 Sep 2025 16:36:36 +0000</updated>
                            <resolved>Wed, 17 Sep 2025 18:36:30 +0000</resolved>
                                                    <fixVersion>1.29.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="18017930" author="JIRAUSER310876" created="Wed, 3 Sep 2025 15:43:32 +0000"  >&lt;p&gt;I&apos;d like to work on this issue&lt;/p&gt;</comment>
                            <comment id="18018860" author="garydgregory" created="Mon, 8 Sep 2025 16:04:42 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yuweiboy&quot; class=&quot;user-hover&quot; rel=&quot;yuweiboy&quot;&gt;yuweiboy&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Feel free to provide a PR on GitHub.&lt;/p&gt;</comment>
                            <comment id="18020711" author="JIRAUSER310876" created="Tue, 16 Sep 2025 16:05:42 +0000"  >&lt;p&gt;&lt;b&gt;Hello&#160; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggregory&quot; class=&quot;user-hover&quot; rel=&quot;ggregory&quot;&gt;ggregory&lt;/a&gt;&lt;/b&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;This is the corresponding Pull Request.&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/commons-compress/pull/703&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;GitHub Pull Request #703&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="18020967" author="garydgregory" created="Wed, 17 Sep 2025 18:36:30 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yuweiboy&quot; class=&quot;user-hover&quot; rel=&quot;yuweiboy&quot;&gt;yuweiboy&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thank you for the PR on GH. There is a simpler fix, which is now in git master and in snapshot builds (&lt;a href=&quot;https://repository.apache.org/content/repositories/snapshots/org/apache/commons/commons-compress/1.29.0-SNAPSHOT/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/repositories/snapshots/org/apache/commons/commons-compress/1.29.0-SNAPSHOT/&lt;/a&gt;). You are credited in &lt;tt&gt;changes.xml&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Please verify your use case and close this ticket if appropriate.&lt;/p&gt;

&lt;p&gt;TY!&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="18021217" author="JIRAUSER310876" created="Thu, 18 Sep 2025 16:35:58 +0000"  >&lt;p&gt;The issue has been resolved. Thank you very much!&lt;/p&gt;

&lt;p&gt;&lt;b&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggregory&quot; class=&quot;user-hover&quot; rel=&quot;ggregory&quot;&gt;ggregory&lt;/a&gt;&lt;/b&gt;&#160;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13078214" name="image-2025-09-03-22-46-38-243.png" size="157580" author="yuweiboy" created="Wed, 3 Sep 2025 14:46:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1xjcw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>