<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:32:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[COMPRESS-382] OutOfMemoryError from CompressorStreamFactory</title>
                <link>https://issues.apache.org/jira/browse/COMPRESS-382</link>
                <project id="12310904" key="COMPRESS">Commons Compress</project>
                    <description>&lt;p&gt;While using Tika-1.14 to detect file types, the attached 1KB file triggered an OOME with 1GB heap. Tika calls CompressorStreamFactory.createCompressorInputStream(in) to detect if the file is a compressor stream, but CompressorStreamFactory erroneously detects it as a LZMACompressorInputStream and when the LZMACompressorInputStream is instanciated the OOME is thrown. This error does not happen with commons-compress versions prior to 1.10, when auto detecting LZMA streams was added. OOME stacktrace below:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Caused by: java.lang.OutOfMemoryError: Java heap space
	at org.tukaani.xz.lz.LZDecoder.&amp;lt;init&amp;gt;(Unknown Source) ~[xz-1.5.jar:1.5]
	at org.tukaani.xz.LZMAInputStream.initialize(Unknown Source) ~[xz-1.5.jar:1.5]
	at org.tukaani.xz.LZMAInputStream.initialize(Unknown Source) ~[xz-1.5.jar:1.5]
	at org.tukaani.xz.LZMAInputStream.&amp;lt;init&amp;gt;(Unknown Source) ~[xz-1.5.jar:1.5]
	at org.tukaani.xz.LZMAInputStream.&amp;lt;init&amp;gt;(Unknown Source) ~[xz-1.5.jar:1.5]
	at org.apache.commons.compress.compressors.lzma.LZMACompressorInputStream.&amp;lt;init&amp;gt;(LZMACompressorInputStream.java:48) ~[commons-compress-1.10.jar:1.10]
	at org.apache.commons.compress.compressors.CompressorStreamFactory.createCompressorInputStream(CompressorStreamFactory.java:251) ~[commons-compress-1.10.jar:1.10]
	at org.apache.tika.parser.pkg.ZipContainerDetector.detectCompressorFormat(ZipContainerDetector.java:109) ~[tika-parsers-1.14.jar:1.14]
	at org.apache.tika.parser.pkg.ZipContainerDetector.detect(ZipContainerDetector.java:95) ~[tika-parsers-1.14.jar:1.14]
	at org.apache.tika.detect.CompositeDetector.detect(CompositeDetector.java:77) ~[tika-core-1.14.jar:1.14]
	at dpf.sp.gpinf.indexer.process.task.SignatureTask.process(SignatureTask.java:50) ~[iped.jar:?]
	at dpf.sp.gpinf.indexer.process.task.AbstractTask.processMonitorTimeout(AbstractTask.java:203) ~[iped.jar:?]
	at dpf.sp.gpinf.indexer.process.task.AbstractTask.processAndSendToNextTask(AbstractTask.java:152) ~[iped.jar:?]
	at dpf.sp.gpinf.indexer.process.task.AbstractTask.sendToNextTask(AbstractTask.java:190) ~[iped.jar:?]
	at dpf.sp.gpinf.indexer.process.task.AbstractTask.processAndSendToNextTask(AbstractTask.java:160) ~[iped.jar:?]
	at dpf.sp.gpinf.indexer.process.task.AbstractTask.sendToNextTask(AbstractTask.java:190) ~[iped.jar:?]
	at dpf.sp.gpinf.indexer.process.task.AbstractTask.processAndSendToNextTask(AbstractTask.java:160) ~[iped.jar:?]
	at dpf.sp.gpinf.indexer.process.task.AbstractTask.sendToNextTask(AbstractTask.java:190) ~[iped.jar:?]
	at dpf.sp.gpinf.indexer.process.task.AbstractTask.processAndSendToNextTask(AbstractTask.java:160) ~[iped.jar:?]
	at dpf.sp.gpinf.indexer.process.Worker.process(Worker.java:174) ~[iped.jar:?]
	... 1 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;Windows7, jre1.8.0_101 x64&lt;/p&gt;</environment>
        <key id="13040268">COMPRESS-382</key>
            <summary>OutOfMemoryError from CompressorStreamFactory</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="lfcnassif">Lu&#237;s Filipe Nassif</reporter>
                        <labels>
                    </labels>
                <created>Fri, 3 Feb 2017 22:38:11 +0000</created>
                <updated>Wed, 26 Apr 2017 15:14:59 +0000</updated>
                            <resolved>Tue, 25 Apr 2017 18:48:36 +0000</resolved>
                                    <version>1.10</version>
                    <version>1.11</version>
                    <version>1.12</version>
                                    <fixVersion>1.14</fixVersion>
                                    <component>Compressors</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="15852241" author="lfcnassif" created="Fri, 3 Feb 2017 22:40:56 +0000"  >&lt;p&gt;oom trigger&lt;/p&gt;</comment>
                            <comment id="15852806" author="bodewig" created="Sat, 4 Feb 2017 14:15:40 +0000"  >&lt;p&gt;LZMA is identified by a three byte header, which is very short and this may lead to quite a few false positives. I&apos;m not sure how to avoid this without removing LZMA autodetection completely.&lt;/p&gt;

&lt;p&gt;What you describe makes me think Tika could benefit from us adding some kind of &quot;does this look like a compressor stream&quot;  or even &quot;what kind of format do you think this is&quot; kind of method in &lt;tt&gt;CompressorStreamFactory&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15852850" author="lfcnassif" created="Sat, 4 Feb 2017 16:54:10 +0000"  >&lt;p&gt;Maybe it is Tika fault to call CompressorStreamFactory with data that is not a compressor stream? What is the api contract of createCompressorInputStream(in)?&lt;/p&gt;</comment>
                            <comment id="15852865" author="bodewig" created="Sat, 4 Feb 2017 17:29:45 +0000"  >&lt;p&gt;Well, the contract is &quot;if I think I know how to read this I&apos;ll give you a stream that will read it. And if I don&apos;t know how to read it, I&apos;ll throw an exception.&quot;. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;So passing in something that&apos;s not a supported stream is certainly valid.&lt;/p&gt;

&lt;p&gt;Some of the stream classes may be doing expensive work inside the constructor, that&apos;s why I was thinking about adding an additional method that only contains the auto-detection logic. If Tika would invoke &lt;tt&gt;createCompressorInputStream&lt;/tt&gt; after a positive outcome this wouldn&apos;t change anything, though.&lt;/p&gt;</comment>
                            <comment id="15969174" author="tallison@mitre.org" created="Fri, 14 Apr 2017 15:45:50 +0000"  >&lt;p&gt;This is pure hackery, but could we allow users to set a threshold in CompressorStreamFactory and pass that value to LZMACompressorInputStream to call &lt;tt&gt;new LZMAInputStream(InputStream is, int threshold)&lt;/tt&gt; instead of the current &lt;tt&gt;new LZMAInputStream(InputStream is)&lt;/tt&gt;...it looks like tukaani has already thought about this?  &lt;/p&gt;

&lt;p&gt;I&apos;m just looking at the decompiled tukaani code, not their actual source &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15969176" author="tallison@mitre.org" created="Fri, 14 Apr 2017 15:47:11 +0000"  >&lt;p&gt;It might be helpful to allow users to set thresholds for some of the compressor input streams to avoid oom on corrupt files.&lt;/p&gt;</comment>
                            <comment id="15969178" author="tallison@mitre.org" created="Fri, 14 Apr 2017 15:48:52 +0000"  >&lt;p&gt;If the above proposal is acceptable, I can submit a PR, esp. if you can offer hints as how to best allow parameterization.&lt;/p&gt;</comment>
                            <comment id="15969201" author="bodewig" created="Fri, 14 Apr 2017 16:02:57 +0000"  >&lt;p&gt;Some of the streams support parametrizations, like the window size for Snappy, the compression level of gzip and so on. So far we pick something as a default and this is what you get when using the factory. The current thinking behind this is that if you know you want certain parameters, then you know which format you want and don&apos;t need to go through the factory anyway.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure whether we can actually enforce thresholds for all of the formats. If we can, then it may make sense to add it as a parameter to the factory. Unfortunately the interface approach of ServiceLoader makes it way more difficult to evolve the factory&apos;s contract.&lt;/p&gt;</comment>
                            <comment id="15969399" author="githubbot" created="Fri, 14 Apr 2017 19:04:56 +0000"  >&lt;p&gt;GitHub user tballison opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-compress/pull/20&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/pull/20&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/COMPRESS-382&quot; title=&quot;OutOfMemoryError from CompressorStreamFactory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COMPRESS-382&quot;&gt;&lt;del&gt;COMPRESS-382&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    first draft of preventing OOM in LZMA&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tballison/commons-compress&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tballison/commons-compress&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/COMPRESS-382&quot; title=&quot;OutOfMemoryError from CompressorStreamFactory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COMPRESS-382&quot;&gt;&lt;del&gt;COMPRESS-382&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-compress/pull/20.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/pull/20.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #20&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 70594bcaff1d553cbd35312bb63a33bcba0680d3&lt;br/&gt;
Author: tballison &amp;lt;tallison@mitre.org&amp;gt;&lt;br/&gt;
Date:   2017-04-14T19:04:20Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/COMPRESS-382&quot; title=&quot;OutOfMemoryError from CompressorStreamFactory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COMPRESS-382&quot;&gt;&lt;del&gt;COMPRESS-382&lt;/del&gt;&lt;/a&gt; first draft of preventing OOM in LZMA&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15969409" author="githubbot" created="Fri, 14 Apr 2017 19:08:19 +0000"  >&lt;p&gt;Github user coveralls commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-compress/pull/20&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/pull/20&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;    [!&lt;span class=&quot;error&quot;&gt;&amp;#91;Coverage Status&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://coveralls.io/builds/11091808/badge)](https://coveralls.io/builds/11091808&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://coveralls.io/builds/11091808/badge)](https://coveralls.io/builds/11091808&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;    Coverage increased (+0.04%) to 84.215% when pulling *&lt;b&gt;70594bcaff1d553cbd35312bb63a33bcba0680d3 on tballison:&lt;a href=&quot;https://issues.apache.org/jira/browse/COMPRESS-382&quot; title=&quot;OutOfMemoryError from CompressorStreamFactory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COMPRESS-382&quot;&gt;&lt;del&gt;COMPRESS-382&lt;/del&gt;&lt;/a&gt;&lt;/b&gt;* into *&lt;b&gt;08113862c5dda6dfb0562d84db8db8f5f41bfa4a on apache:master&lt;/b&gt;*.&lt;/p&gt;
</comment>
                            <comment id="15969413" author="tallison@mitre.org" created="Fri, 14 Apr 2017 19:10:18 +0000"  >&lt;p&gt;This works, but I don&apos;t like breaking the simplicity of CompressorStreamFactory.  So, now we&apos;re going to have a bunch of different settable parameters that require knowledge of the individual child streams?  I don&apos;t like it.&lt;/p&gt;

&lt;p&gt;The other thing I don&apos;t like is wrapping the memory limit exception in a CompressorException.  Perhaps, create a new subclass of CompressorException, say MemoryThresholdHitException, and apply across the streams for this kind of exception?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The current thinking behind this is that if you know you want certain parameters, then you know which format you want and don&apos;t need to go through the factory anyway.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;In Tika land, this isn&apos;t quite right, we know we want to set limits, and we&apos;re willing to figure out that lzma is in kb and Z is in bytes for the data table, etc., but we don&apos;t (currently) know the stream type.  We could (soon) detect() and then call the relevant Compressor, but it would be easier to tell the factory what we want for each file type up front.&lt;/p&gt;

&lt;p&gt;As for service loading...y, that makes parameterization challenging.  &lt;/p&gt;

&lt;p&gt;In short, this PR is a proposal...a way to advance the conversation, not something that I feel strongly about. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Recommendations?&lt;/p&gt;</comment>
                            <comment id="15979566" author="githubbot" created="Fri, 21 Apr 2017 23:24:51 +0000"  >&lt;p&gt;Github user coveralls commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-compress/pull/20&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/pull/20&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;    [!&lt;span class=&quot;error&quot;&gt;&amp;#91;Coverage Status&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://coveralls.io/builds/11191052/badge)](https://coveralls.io/builds/11191052&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://coveralls.io/builds/11191052/badge)](https://coveralls.io/builds/11191052&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;    Coverage increased (+0.2%) to 84.437% when pulling *&lt;b&gt;7d73baf10e435fcaa4927495afc185fb473c416b on tballison:&lt;a href=&quot;https://issues.apache.org/jira/browse/COMPRESS-382&quot; title=&quot;OutOfMemoryError from CompressorStreamFactory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COMPRESS-382&quot;&gt;&lt;del&gt;COMPRESS-382&lt;/del&gt;&lt;/a&gt;&lt;/b&gt;* into *&lt;b&gt;13a039029ca7d7fca9862cfb792f7148c555f05f on apache:master&lt;/b&gt;*.&lt;/p&gt;
</comment>
                            <comment id="15979567" author="githubbot" created="Fri, 21 Apr 2017 23:24:51 +0000"  >&lt;p&gt;Github user coveralls commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-compress/pull/20&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/pull/20&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;    [!&lt;span class=&quot;error&quot;&gt;&amp;#91;Coverage Status&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://coveralls.io/builds/11191052/badge)](https://coveralls.io/builds/11191052&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://coveralls.io/builds/11191052/badge)](https://coveralls.io/builds/11191052&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;    Coverage increased (+0.2%) to 84.437% when pulling *&lt;b&gt;7d73baf10e435fcaa4927495afc185fb473c416b on tballison:&lt;a href=&quot;https://issues.apache.org/jira/browse/COMPRESS-382&quot; title=&quot;OutOfMemoryError from CompressorStreamFactory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COMPRESS-382&quot;&gt;&lt;del&gt;COMPRESS-382&lt;/del&gt;&lt;/a&gt;&lt;/b&gt;* into *&lt;b&gt;13a039029ca7d7fca9862cfb792f7148c555f05f on apache:master&lt;/b&gt;*.&lt;/p&gt;
</comment>
                            <comment id="15979571" author="tallison@mitre.org" created="Fri, 21 Apr 2017 23:29:10 +0000"  >&lt;p&gt;The PR now covers both &lt;a href=&quot;https://issues.apache.org/jira/browse/COMPRESS-382&quot; title=&quot;OutOfMemoryError from CompressorStreamFactory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COMPRESS-382&quot;&gt;&lt;del&gt;COMPRESS-382&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/COMPRESS-386&quot; title=&quot;Consider adding sanity check to maxCodeSize in ZCompressorInputStream&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COMPRESS-386&quot;&gt;&lt;del&gt;COMPRESS-386&lt;/del&gt;&lt;/a&gt;.  I thought it useful to add both to assure some uniformity.&lt;/p&gt;

&lt;p&gt;The one part that I don&apos;t like is the IOException that wraps a memory limit exception in ZCompressorInputStream.  I felt this was necessary so that we didn&apos;t change the exception signature of ZCompressorInputStream.&lt;/p&gt;

&lt;p&gt;Any recommendations?&lt;/p&gt;</comment>
                            <comment id="15979934" author="bodewig" created="Sat, 22 Apr 2017 13:42:41 +0000"  >&lt;p&gt;Many thanks Tim, I like your suggestions and would merge it as is. I can live with not covering all other formats, but would modify &lt;tt&gt;XZCompressorInputStream&lt;/tt&gt; the same way you did to &lt;tt&gt;LZMACompressorInputStream&lt;/tt&gt; (and can certainly do that myself).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The one part that I don&apos;t like is the IOException that wraps a memory limit exception in ZCompressorInputStream.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I understand that, but we can&apos;t add &lt;tt&gt;CompressorException&lt;/tt&gt; to the constructor&apos;s signature either (too bad it is a checked exception). Maybe store the original exception inside the &lt;tt&gt;IOExceptionWrappingMemoryLimitException&lt;/tt&gt; as cause and rethrow the cause from within the factory? Wouldn&apos;t be much better either, I&apos;m afraid.&lt;/p&gt;

</comment>
                            <comment id="15979939" author="githubbot" created="Sat, 22 Apr 2017 13:58:28 +0000"  >&lt;p&gt;Github user kinow commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-compress/pull/20#discussion_r112810239&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/pull/20#discussion_r112810239&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/test/java/org/apache/commons/compress/compressors/DetectCompressorTestCase.java &amp;#8212;&lt;br/&gt;
    @@ -167,6 +171,26 @@ private String detect(String testFileName) throws IOException, CompressorExcepti&lt;br/&gt;
         }&lt;/p&gt;

&lt;p&gt;         @Test&lt;br/&gt;
    +    public void testMemoryLimit() throws Exception &lt;/p&gt;
{
    +        testMemoryLimit(&quot;COMPRESS-382&quot;);
    +        testMemoryLimit(&quot;COMPRESS-386&quot;);
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    private void testMemoryLimit(String fileName) throws IOException, CompressorException {&lt;br/&gt;
    +        CompressorStreamFactory fac = new CompressorStreamFactory(true,&lt;br/&gt;
    +                100);&lt;br/&gt;
    +        try (InputStream is = new BufferedInputStream(&lt;br/&gt;
    +                new FileInputStream(getFile(fileName)))) {&lt;br/&gt;
    +            InputStream compressorInputStream = fac.createCompressorInputStream(is);&lt;br/&gt;
    +            fail(&quot;Should have thrown CompressorMemoryLimitException&quot;);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Maybe instead we could let the CompressorMemoryLimitException happen, and declare in the @Test annotation the expected exception.&lt;/p&gt;</comment>
                            <comment id="15979944" author="lfcnassif" created="Sat, 22 Apr 2017 14:11:17 +0000"  >&lt;p&gt;Good work Tim! I think the wrapping IOException is a good workaround. Making CompressorMemoryLimitException a RuntimeException is worse, making it extend an IOException,  like tukanni MemoryLimitException, makes less sense to me.&lt;/p&gt;

&lt;p&gt;Maybe throwing a normal IOException with the original exception as cause is sufficient? The cause can be checked in CompressorStreamFactory so no need to create a new type of IOException? &lt;/p&gt;</comment>
                            <comment id="15979945" author="githubbot" created="Sat, 22 Apr 2017 14:13:02 +0000"  >&lt;p&gt;Github user bodewig commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-compress/pull/20#discussion_r112810573&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/pull/20#discussion_r112810573&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/test/java/org/apache/commons/compress/compressors/DetectCompressorTestCase.java &amp;#8212;&lt;br/&gt;
    @@ -167,6 +171,26 @@ private String detect(String testFileName) throws IOException, CompressorExcepti&lt;br/&gt;
         }&lt;/p&gt;

&lt;p&gt;         @Test&lt;br/&gt;
    +    public void testMemoryLimit() throws Exception &lt;/p&gt;
{
    +        testMemoryLimit(&quot;COMPRESS-382&quot;);
    +        testMemoryLimit(&quot;COMPRESS-386&quot;);
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    private void testMemoryLimit(String fileName) throws IOException, CompressorException {&lt;br/&gt;
    +        CompressorStreamFactory fac = new CompressorStreamFactory(true,&lt;br/&gt;
    +                100);&lt;br/&gt;
    +        try (InputStream is = new BufferedInputStream(&lt;br/&gt;
    +                new FileInputStream(getFile(fileName)))) {&lt;br/&gt;
    +            InputStream compressorInputStream = fac.createCompressorInputStream(is);&lt;br/&gt;
    +            fail(&quot;Should have thrown CompressorMemoryLimitException&quot;);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    +1 and make it two tests &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15981013" author="githubbot" created="Mon, 24 Apr 2017 11:28:50 +0000"  >&lt;p&gt;Github user tballison commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-compress/pull/20&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/pull/20&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    +1 to both suggestions.  Will do.  Thank you.&lt;/p&gt;</comment>
                            <comment id="15981015" author="tallison@mitre.org" created="Mon, 24 Apr 2017 11:30:28 +0000"  >&lt;blockquote&gt;&lt;p&gt;I can live with not covering all other formats&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m happy to add others, XZ and ???&lt;/p&gt;</comment>
                            <comment id="15981200" author="githubbot" created="Mon, 24 Apr 2017 14:13:22 +0000"  >&lt;p&gt;Github user coveralls commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-compress/pull/20&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/pull/20&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;    [!&lt;span class=&quot;error&quot;&gt;&amp;#91;Coverage Status&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://coveralls.io/builds/11213136/badge)](https://coveralls.io/builds/11213136&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://coveralls.io/builds/11213136/badge)](https://coveralls.io/builds/11213136&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;    Coverage increased (+0.04%) to 84.274% when pulling *&lt;b&gt;b10528a62e51b2c5fdc0c4b7884cc93f03f8ce96 on tballison:&lt;a href=&quot;https://issues.apache.org/jira/browse/COMPRESS-382&quot; title=&quot;OutOfMemoryError from CompressorStreamFactory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COMPRESS-382&quot;&gt;&lt;del&gt;COMPRESS-382&lt;/del&gt;&lt;/a&gt;&lt;/b&gt;* into *&lt;b&gt;13a039029ca7d7fca9862cfb792f7148c555f05f on apache:master&lt;/b&gt;*.&lt;/p&gt;
</comment>
                            <comment id="15981206" author="tallison@mitre.org" created="Mon, 24 Apr 2017 14:17:04 +0000"  >&lt;p&gt;In the most recent commit, I renamed and moved &lt;tt&gt;MemoryLimitException&lt;/tt&gt; up to o.a.c.c.  I also made it extend &lt;tt&gt;IOException&lt;/tt&gt;.  I made these changes because it looks like there are several places in the codebase where we might want to throw this...a search of &lt;tt&gt;new byte[&lt;/tt&gt;...those are all for a later issue, but I didn&apos;t want to create a &lt;tt&gt;CompressorMemoryLimitException&lt;/tt&gt; and then find that we need a more general one. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Question: is this acceptable?  Do we want to rename the class to something like &quot;CommonsCompressMemoryLimitException&quot; so that there will be absolutely no confusion with tukaani&apos;s MemoryLimitException...or is the full class name sufficient?&lt;/p&gt;

&lt;p&gt;I added XZ...note that this memory limit is checked on read(), not during initialization...as far as I can tell.&lt;/p&gt;

&lt;p&gt;I also split out the unit tests for &lt;a href=&quot;https://issues.apache.org/jira/browse/COMPRESS-382&quot; title=&quot;OutOfMemoryError from CompressorStreamFactory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COMPRESS-382&quot;&gt;&lt;del&gt;COMPRESS-382&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/COMPRESS-386&quot; title=&quot;Consider adding sanity check to maxCodeSize in ZCompressorInputStream&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COMPRESS-386&quot;&gt;&lt;del&gt;COMPRESS-386&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;


</comment>
                            <comment id="15981257" author="bodewig" created="Mon, 24 Apr 2017 14:39:50 +0000"  >&lt;p&gt;Many, many thanks, Tim.&lt;/p&gt;

&lt;p&gt;We&apos;ve already got &lt;tt&gt;PasswordRequiredException&lt;/tt&gt; in the root package, I&apos;m comfortable with adding &lt;tt&gt;MemoryLimitException&lt;/tt&gt; there as well - and don&apos;t think we need any special prefix.&lt;/p&gt;

&lt;p&gt;You are certainly correct about XZ, I just looked at the constructor signature but the limit doesn&apos;t get enforced before the stream starts decompressing data.&lt;/p&gt;

&lt;p&gt;As for the other formats I&apos;ll have to look through the code again, I&apos;m afraid. LZ4 might be one case, we currently ignore the &quot;maximum block size&quot; stored inside the framed format (see comment in &lt;tt&gt;FramedLZ4CompressorInputStream#readFrameDescriptor&lt;/tt&gt;) and the memory usage in Snappy and LZ4 is proportional to the window size. We can always evolve this later, even after 1.14. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15981457" author="tallison@mitre.org" created="Mon, 24 Apr 2017 16:27:21 +0000"  >&lt;p&gt;My other thought on this...do we want to set the memory limit via some high level static variable?  With only a quick look through the code base, there appear to be quite a few places where the code relies on reading an &lt;tt&gt;int&lt;/tt&gt; or a &lt;tt&gt;uint&lt;/tt&gt; and then creating a &lt;tt&gt;new byte&lt;span class=&quot;error&quot;&gt;&amp;#91;uint&amp;#93;&lt;/span&gt;&lt;/tt&gt;.  &lt;/p&gt;

&lt;p&gt;If we go with a high-level static variable, we wouldn&apos;t have to add a second parameter constructor for every stream that requires this.  We&apos;d still have to implement it throughout, and I&apos;m happy to help, but we wouldn&apos;t have to add new ctors throughout. &lt;/p&gt;
</comment>
                            <comment id="15981736" author="garydgregory" created="Mon, 24 Apr 2017 19:25:07 +0000"  >&lt;p&gt;Instead of fiddling with constructors we could use Builders.&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;</comment>
                            <comment id="15981812" author="tallison@mitre.org" created="Mon, 24 Apr 2017 20:18:55 +0000"  >&lt;p&gt;If we went with Builders, we&apos;d have to implement even more code, no?  Builder per stream type?&lt;/p&gt;

&lt;p&gt;In general, I like builders, but I&apos;m not sure this makes sense...unless I misunderstand the proposal?&lt;/p&gt;</comment>
                            <comment id="15981904" author="garydgregory" created="Mon, 24 Apr 2017 20:54:17 +0000"  >&lt;p&gt;I propose builders because this avoids creating every combination of constructors and avoids breaking BC (assuming you start with builders). If you need a new parameter, you can just add it to the builder without worrying about how many ctors to create. IMO, this is better even if there is more code initially.&lt;/p&gt;</comment>
                            <comment id="15981908" author="garydgregory" created="Mon, 24 Apr 2017 20:56:55 +0000"  >&lt;p&gt;I should add that over in Log4j-land, we have been migrating from ctors and factory methods to builders and the overall code is much better. The main driver for us in Log4j was to avoid binary compat issues and avoid the proliferation of more and more factory methods every time a parameter needs to be added to a given class.&lt;/p&gt;</comment>
                            <comment id="15981961" author="tallison@mitre.org" created="Mon, 24 Apr 2017 21:41:36 +0000"  >&lt;blockquote&gt;&lt;p&gt;If you need a new parameter, you can just add it to the builder without worrying about how many ctors to create. IMO, this is better even if there is more code initially.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Y, I completely agree.&lt;/p&gt;

&lt;p&gt;Let me try with a static variable for this, and we can see how it looks?&lt;/p&gt;</comment>
                            <comment id="15981971" author="garydgregory" created="Mon, 24 Apr 2017 21:49:24 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;Feel free to start with a static, but global variables are rarely a good idea. It&apos;s fine for a default value of course, but I would only consider this one iteration on the way to the complete solution, but that&apos;s just me. YMMV &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;</comment>
                            <comment id="15982032" author="tallison@mitre.org" created="Mon, 24 Apr 2017 22:44:43 +0000"  >&lt;p&gt;Y, completely agree on both points.  Thank you.&lt;/p&gt;</comment>
                            <comment id="15982054" author="garydgregory" created="Mon, 24 Apr 2017 22:50:45 +0000"  >&lt;p&gt;Glad we see eye to eye &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15982224" author="githubbot" created="Tue, 25 Apr 2017 01:09:08 +0000"  >&lt;p&gt;Github user coveralls commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-compress/pull/20&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/pull/20&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;    [!&lt;span class=&quot;error&quot;&gt;&amp;#91;Coverage Status&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://coveralls.io/builds/11223865/badge)](https://coveralls.io/builds/11223865&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://coveralls.io/builds/11223865/badge)](https://coveralls.io/builds/11223865&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;    Coverage increased (+0.02%) to 84.26% when pulling *&lt;b&gt;0e8ff9c44058afbca9c9126a8feebe41cd682626 on tballison:&lt;a href=&quot;https://issues.apache.org/jira/browse/COMPRESS-382&quot; title=&quot;OutOfMemoryError from CompressorStreamFactory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COMPRESS-382&quot;&gt;&lt;del&gt;COMPRESS-382&lt;/del&gt;&lt;/a&gt;&lt;/b&gt;* into *&lt;b&gt;13a039029ca7d7fca9862cfb792f7148c555f05f on apache:master&lt;/b&gt;*.&lt;/p&gt;
</comment>
                            <comment id="15982233" author="tallison@mitre.org" created="Tue, 25 Apr 2017 01:14:10 +0000"  >&lt;p&gt;In the most recent commit:&lt;/p&gt;

&lt;p&gt;1. Removed new constructors introduced in earlier versions so no new complexity there.&lt;br/&gt;
2. Removed all changes from CompressorStreamFactory...I think...no new complexity there.&lt;br/&gt;
3. Added static MemoryLimit and modified Z, XZ and LZMA to take that into account&lt;/p&gt;

&lt;p&gt;I share &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garydgregory&quot; class=&quot;user-hover&quot; rel=&quot;garydgregory&quot;&gt;garydgregory&lt;/a&gt;&apos;s view of global variables, I agree that builders are an elegant solution to configuration, and I defer to his expertise in this.  If there are other items that we&apos;d want to configure generally across compressors and archivers, we should consider heading towards the builder route asap.  &lt;/p&gt;

&lt;p&gt;As the next iteration to the complete solution, the current proposed PR seems reasonable to me.  I look forward to feedback from those who actually know this codebase, though. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15982283" author="githubbot" created="Tue, 25 Apr 2017 02:13:49 +0000"  >&lt;p&gt;Github user coveralls commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-compress/pull/20&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/pull/20&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;    [!&lt;span class=&quot;error&quot;&gt;&amp;#91;Coverage Status&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://coveralls.io/builds/11224344/badge)](https://coveralls.io/builds/11224344&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://coveralls.io/builds/11224344/badge)](https://coveralls.io/builds/11224344&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;    Coverage increased (+0.03%) to 84.263% when pulling *&lt;b&gt;26eab98e3a0d403587cc915eaa8f7d4b7b894cef on tballison:&lt;a href=&quot;https://issues.apache.org/jira/browse/COMPRESS-382&quot; title=&quot;OutOfMemoryError from CompressorStreamFactory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COMPRESS-382&quot;&gt;&lt;del&gt;COMPRESS-382&lt;/del&gt;&lt;/a&gt;&lt;/b&gt;* into *&lt;b&gt;13a039029ca7d7fca9862cfb792f7148c555f05f on apache:master&lt;/b&gt;*.&lt;/p&gt;
</comment>
                            <comment id="15982562" author="bodewig" created="Tue, 25 Apr 2017 08:31:59 +0000"  >&lt;p&gt;Bad timing going offline on my side or so it seems. Personally I prefer the constructor version over the static configuration - this may be my bad experience with static configuration in XMLUnit 1.x shining through.&lt;/p&gt;

&lt;p&gt;As long as you&apos;ve got a single memory limit you want to enforce for all streams then static configuration is fine, but we are really precluding more dynamic use cases. Or at least make those use cases rather confusing when the limit that is applied is the one that was current when the stream was created rather then the when it is read - by means of the way it is implemented inside of XZ for Java.&lt;/p&gt;

&lt;p&gt;OTOH I don&apos;t see how to evolve into builders without breaking backwards compatibility - in particular after we&apos;ve added &lt;tt&gt;ServiceLoader&lt;/tt&gt;. I understand the proliferation of constructor arguments isn&apos;t pretty, either. I wish I had a better idea.&lt;/p&gt;</comment>
                            <comment id="15982581" author="tcurdt" created="Tue, 25 Apr 2017 08:51:44 +0000"  >&lt;p&gt;There has never ever been a good reason for static configuration. I just look at BCEL and the pain it has caused. &lt;br/&gt;
Static immutable default values are fine - but please don&apos;t introduce static state across instances.&lt;/p&gt;</comment>
                            <comment id="15982593" author="githubbot" created="Tue, 25 Apr 2017 09:02:27 +0000"  >&lt;p&gt;Github user kinow commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-compress/pull/20#discussion_r113141080&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/pull/20#discussion_r113141080&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/main/java/org/apache/commons/compress/compressors/lzma/LZMACompressorInputStream.java &amp;#8212;&lt;br/&gt;
    @@ -56,7 +56,7 @@ public LZMACompressorInputStream(final InputStream inputStream)&lt;br/&gt;
                 in = new LZMAInputStream(inputStream, MemoryLimit.getMemoryLimitInKb());&lt;br/&gt;
             } catch (org.tukaani.xz.MemoryLimitException e) {&lt;br/&gt;
                 //convert to commons-compress exception&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;throw new MemoryLimitException(&quot;exceeded calculated memory limit&quot;, e);&lt;br/&gt;
    +            throw new MemoryLimitException(e.getMemoryNeeded(), e.getMemoryLimit());
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Not looking further into the source code of both MemoryLimitException classes, couldn&apos;t this hide the root cause of the exception? As the original `e` exception is ignored?&lt;/p&gt;</comment>
                            <comment id="15982600" author="githubbot" created="Tue, 25 Apr 2017 09:06:18 +0000"  >&lt;p&gt;Github user garydgregory commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-compress/pull/20#discussion_r113141961&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/pull/20#discussion_r113141961&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/main/java/org/apache/commons/compress/compressors/lzma/LZMACompressorInputStream.java &amp;#8212;&lt;br/&gt;
    @@ -56,7 +56,7 @@ public LZMACompressorInputStream(final InputStream inputStream)&lt;br/&gt;
                 in = new LZMAInputStream(inputStream, MemoryLimit.getMemoryLimitInKb());&lt;br/&gt;
             } catch (org.tukaani.xz.MemoryLimitException e) {&lt;br/&gt;
                 //convert to commons-compress exception&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;throw new MemoryLimitException(&quot;exceeded calculated memory limit&quot;, e);&lt;br/&gt;
    +            throw new MemoryLimitException(e.getMemoryNeeded(), e.getMemoryLimit());
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I always like linking to the cause exception...&lt;/p&gt;</comment>
                            <comment id="15982774" author="githubbot" created="Tue, 25 Apr 2017 12:05:32 +0000"  >&lt;p&gt;Github user tballison commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-compress/pull/20#discussion_r113176495&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/pull/20#discussion_r113176495&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/main/java/org/apache/commons/compress/compressors/lzma/LZMACompressorInputStream.java &amp;#8212;&lt;br/&gt;
    @@ -56,7 +56,7 @@ public LZMACompressorInputStream(final InputStream inputStream)&lt;br/&gt;
                 in = new LZMAInputStream(inputStream, MemoryLimit.getMemoryLimitInKb());&lt;br/&gt;
             } catch (org.tukaani.xz.MemoryLimitException e) {&lt;br/&gt;
                 //convert to commons-compress exception&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;throw new MemoryLimitException(&quot;exceeded calculated memory limit&quot;, e);&lt;br/&gt;
    +            throw new MemoryLimitException(e.getMemoryNeeded(), e.getMemoryLimit());
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Y.  Good point.  I&apos;ll update our MemoryLimitException initializers to both a 2-parameter (needed, limit) and 3-parameter (needed, limit, e)?&lt;/p&gt;</comment>
                            <comment id="15982778" author="tallison@mitre.org" created="Tue, 25 Apr 2017 12:06:33 +0000"  >&lt;blockquote&gt;&lt;p&gt;Bad timing going offline on my side or so it seems. Personally I prefer the constructor version over the static configuration &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No problem at all.  I&apos;ll revert to the initializer option.  Sorry to cause headaches. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;There has never ever been a good reason for static configuration.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Y, I didn&apos;t like it, but wanted to see how it looked.  Back to initializers...&lt;/p&gt;</comment>
                            <comment id="15982784" author="githubbot" created="Tue, 25 Apr 2017 12:13:35 +0000"  >&lt;p&gt;Github user kinow commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-compress/pull/20#discussion_r113178004&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/pull/20#discussion_r113178004&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/main/java/org/apache/commons/compress/compressors/lzma/LZMACompressorInputStream.java &amp;#8212;&lt;br/&gt;
    @@ -56,7 +56,7 @@ public LZMACompressorInputStream(final InputStream inputStream)&lt;br/&gt;
                 in = new LZMAInputStream(inputStream, MemoryLimit.getMemoryLimitInKb());&lt;br/&gt;
             } catch (org.tukaani.xz.MemoryLimitException e) {&lt;br/&gt;
                 //convert to commons-compress exception&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;throw new MemoryLimitException(&quot;exceeded calculated memory limit&quot;, e);&lt;br/&gt;
    +            throw new MemoryLimitException(e.getMemoryNeeded(), e.getMemoryLimit());
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Sounds good. There are a few other places in this pull request where the root exception is discarded too.&lt;/p&gt;</comment>
                            <comment id="15982803" author="githubbot" created="Tue, 25 Apr 2017 12:28:24 +0000"  >&lt;p&gt;Github user tballison commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-compress/pull/20#discussion_r113181027&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/pull/20#discussion_r113181027&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/main/java/org/apache/commons/compress/compressors/lzma/LZMACompressorInputStream.java &amp;#8212;&lt;br/&gt;
    @@ -56,7 +56,7 @@ public LZMACompressorInputStream(final InputStream inputStream)&lt;br/&gt;
                 in = new LZMAInputStream(inputStream, MemoryLimit.getMemoryLimitInKb());&lt;br/&gt;
             } catch (org.tukaani.xz.MemoryLimitException e) {&lt;br/&gt;
                 //convert to commons-compress exception&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;throw new MemoryLimitException(&quot;exceeded calculated memory limit&quot;, e);&lt;br/&gt;
    +            throw new MemoryLimitException(e.getMemoryNeeded(), e.getMemoryLimit());
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Y, any time we&apos;re wrapping tukaani&apos;s.&lt;/p&gt;</comment>
                            <comment id="15982847" author="tallison@mitre.org" created="Tue, 25 Apr 2017 12:58:41 +0000"  >&lt;p&gt;I got rid of the static/global variable.  Apologies for that proposal.&lt;/p&gt;

&lt;p&gt;I can try to squash the PR if desired before you merge it...unless there are other recommendations?&lt;/p&gt;

&lt;p&gt;Thank you, all, and, again, apologies for trying out a remarkably bad idea. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15982856" author="githubbot" created="Tue, 25 Apr 2017 13:05:36 +0000"  >&lt;p&gt;Github user coveralls commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-compress/pull/20&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/pull/20&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;    [!&lt;span class=&quot;error&quot;&gt;&amp;#91;Coverage Status&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://coveralls.io/builds/11230515/badge)](https://coveralls.io/builds/11230515&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://coveralls.io/builds/11230515/badge)](https://coveralls.io/builds/11230515&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;    Coverage increased (+0.06%) to 84.294% when pulling *&lt;b&gt;2247ff9601374845012558ecf5963ebb7e1066c5 on tballison:&lt;a href=&quot;https://issues.apache.org/jira/browse/COMPRESS-382&quot; title=&quot;OutOfMemoryError from CompressorStreamFactory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COMPRESS-382&quot;&gt;&lt;del&gt;COMPRESS-382&lt;/del&gt;&lt;/a&gt;&lt;/b&gt;* into *&lt;b&gt;13a039029ca7d7fca9862cfb792f7148c555f05f on apache:master&lt;/b&gt;*.&lt;/p&gt;
</comment>
                            <comment id="15983426" author="githubbot" created="Tue, 25 Apr 2017 18:46:15 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-compress/pull/20&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/pull/20&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15983430" author="bodewig" created="Tue, 25 Apr 2017 18:48:22 +0000"  >&lt;p&gt;Thanks Tim and sorry for the extra amount of work. &lt;tt&gt;git am&lt;/tt&gt; didn&apos;t work for me so I went for an old fashioned merge, I think I&apos;ve caught everything but it would be good if you could double-check.&lt;/p&gt;</comment>
                            <comment id="15983463" author="garydgregory" created="Tue, 25 Apr 2017 19:09:11 +0000"  >&lt;p&gt;Can someone update the description to add the chosen solution and how to use it SVP?&lt;/p&gt;</comment>
                            <comment id="15984976" author="tallison@mitre.org" created="Wed, 26 Apr 2017 15:14:59 +0000"  >&lt;blockquote&gt;&lt;p&gt;good if you could double-check.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;All looks good.  Thank you!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13064087">COMPRESS-386</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12850912" name="data.mui" size="1024" author="lfcnassif" created="Fri, 3 Feb 2017 22:40:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 29 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i39lpz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>