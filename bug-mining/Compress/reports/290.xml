<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:32:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[COMPRESS-453] Facing block overrun error while building TensorFlow</title>
                <link>https://issues.apache.org/jira/browse/COMPRESS-453</link>
                <project id="12310904" key="COMPRESS">Commons Compress</project>
                    <description>&lt;p&gt;Building TensorFlow master using Bazel v0.12.0.&lt;/p&gt;

&lt;p&gt;Facing build issue immediately with error:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;ERROR: /home/jenkins/tensorflow/tensorflow/tools/pip_package/BUILD:117:1: no such package &apos;@nasm//&apos;: java.io.IOException: block overrun and referenced by &apos;//tensorflow/tools/pip_package:licenses&apos;&lt;/tt&gt;&lt;br/&gt;
{{ ERROR: Analysis of target &apos;//tensorflow/tools/pip_package:build_pip_package&apos; failed; build aborted: no such package &apos;@nasm//&apos;: java.io.IOException: block overrun}}&lt;/p&gt;

&lt;p&gt;This is intermittent. Sometimes the build goes ahead. Also observed this error once:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;ERROR: /home/test/tensorflow/tensorflow/tools/pip_package/BUILD:117:1: no such package &apos;@nasm//&apos;: java.io.IOException: Error detected parsing the header and referenced by &apos;//tensorflow/tools/pip_package:licenses&apos;ERROR: Analysis of target &apos;//tensorflow/tools/pip_package:build_pip_package&apos; failed; build aborted: no such package &apos;@nasm//&apos;: java.io.IOException: Error detected parsing the header&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Can someone please help in resolving this?&lt;/p&gt;

&lt;p&gt;Getting this error with AdoptJDK 8.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Linux Ubuntu 16.04 s390x&lt;/p&gt;</environment>
        <key id="13159401">COMPRESS-453</key>
            <summary>Facing block overrun error while building TensorFlow</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="bhavenamrata">Namrata Bhave</reporter>
                        <labels>
                            <label>bzip2</label>
                    </labels>
                <created>Tue, 15 May 2018 12:29:11 +0000</created>
                <updated>Wed, 30 May 2018 09:58:05 +0000</updated>
                            <resolved>Fri, 25 May 2018 07:45:17 +0000</resolved>
                                    <version>1.9</version>
                    <version>1.16.1</version>
                                    <fixVersion>1.17</fixVersion>
                                    <component>Compressors</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="16475882" author="sebb@apache.org" created="Tue, 15 May 2018 14:06:24 +0000"  >&lt;p&gt;Does not appear to be anything to do with Apache Commons Compress.&lt;/p&gt;

&lt;p&gt;Nor even Apache.&lt;/p&gt;</comment>
                            <comment id="16475892" author="bodewig" created="Tue, 15 May 2018 14:21:56 +0000"  >&lt;p&gt;Actually it is Compress, please see &lt;a href=&quot;https://github.com/tensorflow/tensorflow/issues/16862&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tensorflow/tensorflow/issues/16862&lt;/a&gt; for reference.&lt;/p&gt;

&lt;p&gt;The build process uses Compress to deal with a tar.gz downloaded by the process - and the exception is raised by BZipCompressorInputStream&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bhavenamrata&quot; class=&quot;user-hover&quot; rel=&quot;bhavenamrata&quot;&gt;bhavenamrata&lt;/a&gt; we need the bzip2 file that is causing the exception. Without that we won&apos;t be able to help.&lt;/p&gt;</comment>
                            <comment id="16476827" author="bhavenamrata" created="Wed, 16 May 2018 04:47:35 +0000"  >&lt;p&gt;Sorry about missing these details Stefan.&lt;/p&gt;

&lt;p&gt;The bzip2 files are being downloaded from:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://mirror.bazel.build/www.nasm.us/pub/nasm/releasebuilds/2.12.02/nasm-2.12.02.tar.bz2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://mirror.bazel.build/www.nasm.us/pub/nasm/releasebuilds/2.12.02/nasm-2.12.02.tar.bz2&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.nasm.us/pub/nasm/releasebuilds/2.12.02/nasm-2.12.02.tar.bz2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.nasm.us/pub/nasm/releasebuilds/2.12.02/nasm-2.12.02.tar.bz2&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://pkgs.fedoraproject.org/repo/pkgs/nasm/nasm-2.12.02.tar.bz2/d15843c3fb7db39af80571ee27ec6fad/nasm-2.12.02.tar.bz2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://pkgs.fedoraproject.org/repo/pkgs/nasm/nasm-2.12.02.tar.bz2/d15843c3fb7db39af80571ee27ec6fad/nasm-2.12.02.tar.bz2&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I tried using all 3, but get same error for them.&lt;/p&gt;</comment>
                            <comment id="16476890" author="bodewig" created="Wed, 16 May 2018 05:57:42 +0000"  >&lt;p&gt;Works just fine for me&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ cat Test.java 
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.compress.compressors.bzip2.BZip2CompressorInputStream;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.compress.utils.IOUtils;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io.*;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Test {
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (InputStream f = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileInputStream(&lt;span class=&quot;code-quote&quot;&gt;&quot;nasm-2.12.02.tar.bz2&quot;&lt;/span&gt;);
             InputStream b = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BufferedInputStream(f);
             InputStream c = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BZip2CompressorInputStream(b);
             OutputStream o = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileOutputStream(&lt;span class=&quot;code-quote&quot;&gt;&quot;nasm-2.12.02.tar&quot;&lt;/span&gt;)) {
            IOUtils.copy(c, o);
        }
    }
}
$ javac -cp ~/.m2/repository/org/apache/commons/commons-compress/1.16.1/commons-compress-1.16.1.jar Test.java 
$ java -cp ~/.m2/repository/org/apache/commons/commons-compress/1.16.1/commons-compress-1.16.1.jar:. Test
$ java -fullversion
java full version &lt;span class=&quot;code-quote&quot;&gt;&quot;1.8.0_171-b11&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Can you please run the same test and paste the stack trace you see? Inside of the github issue I see many people who don&apos;t have any problem with the file, so maybe it is your JVM or another local issue.&lt;/p&gt;

&lt;p&gt;For reference I used the second link to obtain nasm-2.12.02.tar.bz2 and I get&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ sha1sum nasm-2.12.02.tar.bz2 
a166e8d0fa567855053ebb8d0ed3ee22f1deb30f  nasm-2.12.02.tar.bz2
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16477039" author="bhavenamrata" created="Wed, 16 May 2018 08:31:15 +0000"  >&lt;p&gt;Hi Stefan,&lt;/p&gt;

&lt;p&gt;Stacktrace of the test :&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ java -cp ~/.m2/repository/org/apache/commons/commons-compress/1.16.1/commons-compress-1.16.1.jar:. Test
Exception in thread &quot;main&quot; java.io.IOException: block overrun
&#160;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.commons.compress.compressors.bzip2.BZip2CompressorInputStream.getAndMoveToFrontDecode(BZip2CompressorInputStream.java:655)
&#160;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.commons.compress.compressors.bzip2.BZip2CompressorInputStream.initBlock(BZip2CompressorInputStream.java:323)
&#160;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.commons.compress.compressors.bzip2.BZip2CompressorInputStream.setupNoRandPartA(BZip2CompressorInputStream.java:809)
&#160;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.commons.compress.compressors.bzip2.BZip2CompressorInputStream.setupNoRandPartB(BZip2CompressorInputStream.java:857)
&#160;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.commons.compress.compressors.bzip2.BZip2CompressorInputStream.read0(BZip2CompressorInputStream.java:220)
&#160;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.commons.compress.compressors.bzip2.BZip2CompressorInputStream.read(BZip2CompressorInputStream.java:176)
&#160;&#160;&#160;&#160;&#160;&#160;&#160; at java.io.InputStream.read(InputStream.java:101)
&#160;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.commons.compress.utils.IOUtils.copy(IOUtils.java:80)
&#160;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.commons.compress.utils.IOUtils.copy(IOUtils.java:60)
&#160;&#160;&#160;&#160;&#160;&#160;&#160; at Test.main(Test.java:11)

$ java -fullversion
openjdk full version &quot;1.8.0_162-b12&quot;

$ sha1sum nasm-2.12.02.tar.bz2
a166e8d0fa567855053ebb8d0ed3ee22f1deb30f&#160; nasm-2.12.02.tar.bz2&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16477055" author="bodewig" created="Wed, 16 May 2018 08:40:21 +0000"  >&lt;p&gt;OK, this means you get an exception on the same file as I do and the only difference is the JDK. This is bad.&lt;/p&gt;

&lt;p&gt;Unfortunately&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ /usr/lib/jvm/java-8-openjdk-amd64/bin/java -fullversion
openjdk full version &lt;span class=&quot;code-quote&quot;&gt;&quot;1.8.0_171-8u171-b11-0ubuntu0.18.04.1-b11&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;works for me as well. So either it is _182 vs _171 or the OS.&lt;/p&gt;</comment>
                            <comment id="16477109" author="bhavenamrata" created="Wed, 16 May 2018 09:02:05 +0000"  >&lt;p&gt;Oh. I tried the same on Ubuntu 18.04 as well.. same error.&lt;/p&gt;

&lt;p&gt;I am working on big endian system, will it matter?&lt;/p&gt;

&lt;p&gt;I feel its more likely JVM error(System has AdoptOpenJDK 8). Any way to confirm it?&lt;/p&gt;</comment>
                            <comment id="16481673" author="bodewig" created="Sat, 19 May 2018 15:39:09 +0000"  >&lt;p&gt;I too am afraid this is a JVM issue. I could provide you with a debug printing version of the class and we could compare outputs but it may be easier if I do it myself. When you say AdoptOpenJDK 8 it is &lt;a href=&quot;https://adoptopenjdk.net/?variant=openjdk8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://adoptopenjdk.net/?variant=openjdk8&lt;/a&gt; for Linux x64? Build 162 doesn&apos;t seem to be available anymore, have you tried build 172?&lt;/p&gt;

&lt;p&gt;Also you could try the openjdk-8-jdk package from Ubuntu universe to verify it is AdoptOpenJDK.&lt;/p&gt;</comment>
                            <comment id="16481674" author="bodewig" created="Sat, 19 May 2018 15:42:32 +0000"  >&lt;p&gt;Test class works fine with AdoptOpenJDK 8 build 172-b11 for Linux x64 for me.&lt;/p&gt;</comment>
                            <comment id="16481939" author="sebb@apache.org" created="Sun, 20 May 2018 11:59:20 +0000"  >&lt;p&gt;Would it help to add the numeric values to the block overrun exception message?&lt;br/&gt;
There are two such; it might be useful to indicate which has occurred.&lt;/p&gt;</comment>
                            <comment id="16482235" author="bhavenamrata" created="Mon, 21 May 2018 06:35:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bodewig&quot; class=&quot;user-hover&quot; rel=&quot;bodewig&quot;&gt;bodewig&lt;/a&gt;, I am working on Linux s390x platform and using this version of AdoptOpenJDK:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://adoptopenjdk.net/releases.html?variant=openjdk8-openj9#s390x_linux&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://adoptopenjdk.net/releases.html?variant=openjdk8-openj9#s390x_linux&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Openjdk-8-jdk package from Ubuntu repository works. But I am interested in using above AdoptOpenJDK variant which has JIT support on s390x which Openjdk-8-jdk doesn&apos;t have.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sebb%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;sebb@apache.org&quot;&gt;sebb@apache.org&lt;/a&gt;, I can make the required changes and check at my end. Please let me know how to proceed.&lt;/p&gt;</comment>
                            <comment id="16484434" author="bodewig" created="Tue, 22 May 2018 19:14:03 +0000"  >&lt;p&gt;I&apos;m afraid I haven&apos;t got access to a s390x machine (and don&apos;t expect anybody else of us to have), so we&apos;d need to provide you with debug enabled builds or something like this.&lt;/p&gt;

&lt;p&gt;At least we know it depends on the JVM and we either have found a bug in AdoptOpenJDK or the later triggers a bug in our code because it forces us to use a different code path.&lt;/p&gt;

&lt;p&gt;Can you checkout Compress from git and build it locally? If so, we could try adding a bunch of debug log statements in a branch and have you run the test code above once with either JVM and compare the output.&lt;/p&gt;</comment>
                            <comment id="16487152" author="bhavenamrata" created="Wed, 23 May 2018 12:16:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bodewig&quot; class=&quot;user-hover&quot; rel=&quot;bodewig&quot;&gt;bodewig&lt;/a&gt;, I tried building Compress 1.16.1 and it built successfully on s390x .&lt;/p&gt;

&lt;p&gt;Also tried above example with both Java Variants.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;tt&gt;&#160; $ java -cp ~/.m2/repository/org/apache/commons/commons-compress/1.16.1/commons-compress-1.16.1.jar:. Test&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;&#160;&#160; $&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;&#160;&#160; $ java -version&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;&#160; openjdk version &quot;1.8.0_171&quot;&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;&#160; OpenJDK Runtime Environment (build 1.8.0_171-8u171-b11-0ubuntu0.16.04.1-b11)&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;&#160; OpenJDK 64-Bit Zero VM (build 25.171-b11, interpreted mode)&lt;/tt&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;whereas:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;tt&gt;$ java -cp ~/.m2/repository/org/apache/commons/commons-compress/1.16.1/commons-compress-1.16.1.jar:. Test&lt;/tt&gt;&lt;br/&gt;
{{ &#160;&#160; Exception in thread &quot;main&quot; java.io.IOException: block overrun}}&lt;br/&gt;
{{ &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.commons.compress.compressors.bzip2.BZip2CompressorInputStream.getAndMoveToFrontDecode(BZip2CompressorInputStream.java:655)}}}}}}&lt;br/&gt;
{{ &#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160; at org.apache.commons.compress.compressors.bzip2.BZip2CompressorInputStream.initBlock(BZip2CompressorInputStream.java:323)}}}}}}&lt;br/&gt;
{{ &#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160; at org.apache.commons.compress.compressors.bzip2.BZip2CompressorInputStream.setupNoRandPartA(BZip2CompressorInputStream.java:809)}}}}}}&lt;br/&gt;
{{ &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.commons.compress.compressors.bzip2.BZip2CompressorInputStream.setupNoRandPartB(BZip2CompressorInputStream.java:857)}}}}}}&lt;br/&gt;
{{ &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.commons.compress.compressors.bzip2.BZip2CompressorInputStream.read0(BZip2CompressorInputStream.java:220)}}}}}}&lt;br/&gt;
{{ &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.commons.compress.compressors.bzip2.BZip2CompressorInputStream.read(BZip2CompressorInputStream.java:176)}}}}}}&lt;br/&gt;
{{ &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; at java.io.InputStream.read(InputStream.java:101)}}&lt;br/&gt;
{{ &#160;&#160;&#160;&#160;&#160;&#160; &#160; &#160; at org.apache.commons.compress.utils.IOUtils.copy(IOUtils.java:80)}}&lt;tt&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.commons.compress.utils.IOUtils.copy(IOUtils.java:60)&lt;/tt&gt;&lt;br/&gt;
{{ &#160;&#160; &#160; &#160;&#160;&#160;&#160; at Test.main(Test.java:11) }}&lt;br/&gt;
{{ &#160; $ java -version&#160; }}&lt;br/&gt;
{{ &#160; openjdk version &quot;1.8.0_162&quot;}}&lt;br/&gt;
{{ &#160; OpenJDK Runtime Environment (build 1.8.0_162-b12)}}&lt;br/&gt;
{{ &#160; Eclipse OpenJ9 VM (build openj9-0.8.0, JRE 1.8.0 Linux s390x-64 Compressed References 20180315_97 (JIT enabled, AOT enabled)}}&lt;br/&gt;
{{ &#160;&#160; OpenJ9&#160;&#160; - e24e8aa9}}&lt;br/&gt;
{{ &#160; OMR&#160;&#160;&#160;&#160;&#160; - 3e8296b4}}&lt;br/&gt;
{{ &#160; JCL&#160;&#160;&#160;&#160;&#160; - ee1e77df1d based on jdk8u162-b12)}}&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16487247" author="bodewig" created="Wed, 23 May 2018 13:28:36 +0000"  >&lt;p&gt;I&apos;m afraid we&apos;ll need a few iterations of printf debugging. I&apos;ve created a branch named &lt;a href=&quot;https://issues.apache.org/jira/browse/COMPRESS-453&quot; title=&quot;Facing block overrun error while building TensorFlow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COMPRESS-453&quot;&gt;&lt;del&gt;COMPRESS-453&lt;/del&gt;&lt;/a&gt;, it would be good if you could build that and run the tests on both JDKs to get an inital idea of where things start to deviate. There are a bunch of bit-level operations inside the &quot;move to front&quot; code that might fail in some way or other.&lt;/p&gt;</comment>
                            <comment id="16488655" author="bhavenamrata" created="Thu, 24 May 2018 08:37:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bodewig&quot; class=&quot;user-hover&quot; rel=&quot;bodewig&quot;&gt;bodewig&lt;/a&gt;, Attaching both the logs below. The error shown now using AdoptJDK is :&lt;/p&gt;


&lt;p&gt;{{New nextSym: 2&lt;br/&gt;
New nextSym: 1&lt;br/&gt;
nextSym in RLE loop: 1&lt;br/&gt;
nextSym in RLE loop: 2&lt;br/&gt;
s: 5&lt;br/&gt;
Exception in thread &quot;main&quot; java.io.IOException: block overrun while expanding RLE in MTF, 900001 exceeds 900000&lt;br/&gt;
&#160;&#160; &#160;at org.apache.commons.compress.compressors.bzip2.BZip2CompressorInputStream.getAndMoveToFrontDecode(BZip2CompressorInputStream.java:668)&lt;br/&gt;
&#160;&#160; &#160;at org.apache.commons.compress.compressors.bzip2.BZip2CompressorInputStream.initBlock(BZip2CompressorInputStream.java:332)&lt;br/&gt;
&#160;&#160; &#160;at org.apache.commons.compress.compressors.bzip2.BZip2CompressorInputStream.setupNoRandPartA(BZip2CompressorInputStream.java:824)&lt;br/&gt;
&#160;&#160; &#160;at org.apache.commons.compress.compressors.bzip2.BZip2CompressorInputStream.setupNoRandPartB(BZip2CompressorInputStream.java:872)&lt;br/&gt;
&#160;&#160; &#160;at org.apache.commons.compress.compressors.bzip2.BZip2CompressorInputStream.read0(BZip2CompressorInputStream.java:229)&lt;br/&gt;
&#160;&#160; &#160;at org.apache.commons.compress.compressors.bzip2.BZip2CompressorInputStream.read(BZip2CompressorInputStream.java:177)&lt;br/&gt;
&#160;&#160; &#160;at java.io.InputStream.read(InputStream.java:101)&lt;br/&gt;
&#160;&#160; &#160;at org.apache.commons.compress.utils.IOUtils.copy(IOUtils.java:85)&lt;br/&gt;
&#160;&#160; &#160;at org.apache.commons.compress.utils.IOUtils.copy(IOUtils.java:60)&lt;br/&gt;
&#160;&#160; &#160;at Test.main(Test.java:11)}}&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12924906/12924906_TestLogOpenJDK.txt&quot; title=&quot;TestLogOpenJDK.txt attached to COMPRESS-453&quot;&gt;TestLogOpenJDK.txt&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12924904/12924904_TestLogAdoptJDK.txt&quot; title=&quot;TestLogAdoptJDK.txt attached to COMPRESS-453&quot;&gt;TestLogAdoptJDK.txt&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="16488756" author="bodewig" created="Thu, 24 May 2018 10:17:34 +0000"  >&lt;p&gt;This is getting even stranger, the logs are identical up until the point where the exception happens, so the reading and parsing of symbols seems fine and increment/decrement operations look strange.&lt;/p&gt;

&lt;p&gt;As indicated I&apos;m afraid this will be an incremental approach, I&apos;ve added one more commit with even more logging to the branch.&lt;/p&gt;</comment>
                            <comment id="16488875" author="bhavenamrata" created="Thu, 24 May 2018 12:10:05 +0000"  >&lt;p&gt;Indeed.. Attaching log files with new commit:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12924929/12924929_testlog_commit2_Adoptjdk.txt&quot; title=&quot;testlog_commit2_Adoptjdk.txt attached to COMPRESS-453&quot;&gt;testlog_commit2_Adoptjdk.txt&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12924930/12924930_testlog_commit2_openjdk_zip.zip&quot; title=&quot;testlog_commit2_openjdk_zip.zip attached to COMPRESS-453&quot;&gt;testlog_commit2_openjdk_zip.zip&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="16488903" author="bodewig" created="Thu, 24 May 2018 12:36:04 +0000"  >&lt;p&gt;Thank you, so here is the snippet you can use in your bug report for AdoptOpenJDK &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
                &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.err.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;before loop s: &quot;&lt;/span&gt; + s + &lt;span class=&quot;code-quote&quot;&gt;&quot;, lastShadow: &quot;&lt;/span&gt; + lastShadow);
                &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (s-- &amp;gt;= 0) {
                    ll8[++lastShadow] = ch;
                }
                &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.err.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;after loop s: &quot;&lt;/span&gt; + s + &lt;span class=&quot;code-quote&quot;&gt;&quot;, lastShadow: &quot;&lt;/span&gt; + lastShadow);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;with &lt;tt&gt;s&lt;/tt&gt; being 5 the loop should be run six times before terminating and &lt;tt&gt;s&lt;/tt&gt; is -2 after the loop as expected. As you can see from the &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
before loop s: 5, lastShadow: 899994
after loop s: -2, lastShadow: 900001
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;log-output &lt;tt&gt;lastShadow&lt;/tt&gt; has been incremented seven times. if you look through the log you can see it first seems to work OK (&lt;tt&gt;lastShadow&lt;/tt&gt; should get incremented by &lt;tt&gt;s + 1&lt;/tt&gt;) but starts to go wrong at one point in time (first error is in line 599184), the 65945th time we hit the log statement), likely a bug in the JIT, &lt;/p&gt;

&lt;p&gt;We can replace the &lt;tt&gt;while&lt;/tt&gt; loop with &lt;tt&gt;Arrays.fill&lt;/tt&gt; in this particular case, I&apos;ll change the code and ask you to re-test soonish. Before making that change in master I&apos;d like to run a few microbenchmarks, though. Also it may fix this particular instance but won&apos;t safe you from other bugs in OpenJDK.&lt;/p&gt;</comment>
                            <comment id="16488941" author="bhavenamrata" created="Thu, 24 May 2018 12:56:48 +0000"  >&lt;p&gt;oh! I&apos;ll surely check with Adopt community.&lt;/p&gt;</comment>
                            <comment id="16488960" author="bodewig" created="Thu, 24 May 2018 13:08:29 +0000"  >&lt;p&gt;just pushed the &lt;tt&gt;Arrays.fill&lt;/tt&gt; version to the &lt;a href=&quot;https://issues.apache.org/jira/browse/COMPRESS-453&quot; title=&quot;Facing block overrun error while building TensorFlow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COMPRESS-453&quot;&gt;&lt;del&gt;COMPRESS-453&lt;/del&gt;&lt;/a&gt; branch.&lt;/p&gt;</comment>
                            <comment id="16489043" author="bodewig" created="Thu, 24 May 2018 13:59:17 +0000"  >&lt;p&gt;Using &lt;a href=&quot;https://github.com/bodewig/commons-compress-benchmarks&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/bodewig/commons-compress-benchmarks&lt;/a&gt; there is no significant difference either way, so i&apos;ll change master to &lt;tt&gt;Arrays.fill&lt;/tt&gt; as it improves readability a bit.&lt;/p&gt;</comment>
                            <comment id="16490276" author="bhavenamrata" created="Fri, 25 May 2018 06:01:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bodewig&quot; class=&quot;user-hover&quot; rel=&quot;bodewig&quot;&gt;bodewig&lt;/a&gt;, Tried multiple times and it always worked &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Next let me try using it in Bazel and check TensorFlow build.&lt;/p&gt;

&lt;p&gt;If everything works fine, will it be possible to tag it so that it can be picked up in Bazel?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16490363" author="bodewig" created="Fri, 25 May 2018 07:44:56 +0000"  >&lt;p&gt;The change is already part of master and there have already been tentative plans for releasing 1.17 soon. Releases at Apache require a bit more ceremony than just a tag, so it will take a few days, maybe even weeks, until the release is out.&lt;/p&gt;</comment>
                            <comment id="16494947" author="bhavenamrata" created="Wed, 30 May 2018 09:50:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bodewig&quot; class=&quot;user-hover&quot; rel=&quot;bodewig&quot;&gt;bodewig&lt;/a&gt;, The change worked for above example but I am afraid it doesn&apos;t work when building TensorFlow : &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://ibmz-ci.osuosl.org/job/TensorFlow_IBMZ_CI/112/consoleFull&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ibmz-ci.osuosl.org/job/TensorFlow_IBMZ_CI/112/consoleFull&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16494956" author="bodewig" created="Wed, 30 May 2018 09:58:05 +0000"  >&lt;p&gt;well, this is a different error. &quot;Error detected parsing the header&quot; not raised by &lt;tt&gt;BZip2CompressorInputStream&lt;/tt&gt;. Honestly there are bugs in your JVM&apos;s JIT and I don&apos;t think it is possible to work around those bugs as they may manifest in strange and unforeseeable ways all over the place. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12924904" name="TestLogAdoptJDK.txt" size="7861759" author="bhavenamrata" created="Thu, 24 May 2018 08:35:34 +0000"/>
                            <attachment id="12924906" name="TestLogOpenJDK.txt" size="41737534" author="bhavenamrata" created="Thu, 24 May 2018 08:40:19 +0000"/>
                            <attachment id="12924929" name="testlog_commit2_Adoptjdk.txt" size="23169329" author="bhavenamrata" created="Thu, 24 May 2018 12:06:12 +0000"/>
                            <attachment id="12924930" name="testlog_commit2_openjdk_zip.zip" size="10517480" author="bhavenamrata" created="Thu, 24 May 2018 12:10:16 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12311024" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>External issue ID</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>16862</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311020" key="com.atlassian.jira.plugin.system.customfieldtypes:url">
                        <customfieldname>External issue URL</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[https://github.com/tensorflow/tensorflow/issues/16862]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 24 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3tq5j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>