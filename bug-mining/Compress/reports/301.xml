<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:33:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[COMPRESS-459] CPIO fails decoding multibyte name entries</title>
                <link>https://issues.apache.org/jira/browse/COMPRESS-459</link>
                <project id="12310904" key="COMPRESS">Commons Compress</project>
                    <description>&lt;p&gt;Having a CPIO archive in (e.g. UTF-8) mode and having a name entry with a name containing multi-byte characters the decoder fails.&lt;/p&gt;

&lt;p&gt;The problem IMHO is the &quot;getHeaderPadCount&quot; method, which assumes a single byte per character:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#160;&#160;&#160; &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; getHeaderPadCount(){
&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.alignmentBoundary == 0) { &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; 0; }
&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; size = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.headerSize + 1;&#160; &lt;span class=&quot;code-comment&quot;&gt;// Name has terminating &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
&lt;/span&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (name != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; size += name.length();
&#160;&#160;&#160;&#160;&#160;&#160;&#160; }
&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; remain = size % &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.alignmentBoundary;
&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (remain &amp;gt; 0){
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.alignmentBoundary - remain;
&#160;&#160;&#160;&#160;&#160;&#160;&#160; }
&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; 0;
&#160;&#160;&#160; }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;However this may (or may not) be true for UTF-8.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Also it wouldn&apos;t be enough to call &quot;String#getBytes(&#8230;)&quot; as this might already transform the underlying bytes.&lt;/p&gt;

&lt;p&gt;The proper solution would be to provide the name size, as read from the CPIO stream, and pass it to the entry.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13170797">COMPRESS-459</key>
            <summary>CPIO fails decoding multibyte name entries</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ctron">Jens Reimann</reporter>
                        <labels>
                            <label>patch-available</label>
                    </labels>
                <created>Mon, 9 Jul 2018 08:06:36 +0000</created>
                <updated>Fri, 13 Jul 2018 06:24:52 +0000</updated>
                            <resolved>Wed, 11 Jul 2018 16:53:32 +0000</resolved>
                                    <version>1.9</version>
                    <version>1.17</version>
                                    <fixVersion>1.18</fixVersion>
                                    <component>Archivers</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16536735" author="githubbot" created="Mon, 9 Jul 2018 09:52:55 +0000"  >&lt;p&gt;GitHub user ctron opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-compress/pull/67&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/pull/67&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/COMPRESS-459&quot; title=&quot;CPIO fails decoding multibyte name entries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COMPRESS-459&quot;&gt;&lt;del&gt;COMPRESS-459&lt;/del&gt;&lt;/a&gt; Fix reading of multibyte name entries&lt;/p&gt;

&lt;p&gt;    This fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/COMPRESS-459&quot; title=&quot;CPIO fails decoding multibyte name entries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COMPRESS-459&quot;&gt;&lt;del&gt;COMPRESS-459&lt;/del&gt;&lt;/a&gt; by using the name number of bytes from the field&lt;br/&gt;
    in the stream instead of relying on the assumption that each character&lt;br/&gt;
    is exactly one byte, which isn&apos;t true for UTF-8, UTF-16 or other&lt;br/&gt;
    multi-byte character encodings.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/ctron/commons-compress&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/ctron/commons-compress&lt;/a&gt; feature/fix_COMPRESS_459_1&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-compress/pull/67.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/pull/67.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #67&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 715352d3343358539a40b9623a9a00beb115ff30&lt;br/&gt;
Author: Jens Reimann &amp;lt;jreimann@...&amp;gt;&lt;br/&gt;
Date:   2018-07-09T09:41:43Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/COMPRESS-459&quot; title=&quot;CPIO fails decoding multibyte name entries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COMPRESS-459&quot;&gt;&lt;del&gt;COMPRESS-459&lt;/del&gt;&lt;/a&gt; Fix reading of multibyte name entries&lt;/p&gt;

&lt;p&gt;    This fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/COMPRESS-459&quot; title=&quot;CPIO fails decoding multibyte name entries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COMPRESS-459&quot;&gt;&lt;del&gt;COMPRESS-459&lt;/del&gt;&lt;/a&gt; by using the name number of bytes from the field&lt;br/&gt;
    in the stream instead of relying on the assumption that each character&lt;br/&gt;
    is exactly one byte, which isn&apos;t true for UTF-8, UTF-16 or other&lt;br/&gt;
    multi-byte character encodings.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16536739" author="githubbot" created="Mon, 9 Jul 2018 09:56:10 +0000"  >&lt;p&gt;Github user coveralls commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-compress/pull/67&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/pull/67&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;    [!&lt;span class=&quot;error&quot;&gt;&amp;#91;Coverage Status&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://coveralls.io/builds/17891202/badge)](https://coveralls.io/builds/17891202&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://coveralls.io/builds/17891202/badge)](https://coveralls.io/builds/17891202&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;    Coverage increased (+0.002%) to 86.355% when pulling *&lt;b&gt;715352d3343358539a40b9623a9a00beb115ff30 on ctron:feature/fix_COMPRESS_459_1&lt;/b&gt;* into *&lt;b&gt;f5330f7e667f5a7245c8a5f3007cda04554c5fe2 on apache:master&lt;/b&gt;*.&lt;/p&gt;
</comment>
                            <comment id="16539618" author="githubbot" created="Wed, 11 Jul 2018 06:20:59 +0000"  >&lt;p&gt;Github user bodewig commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-compress/pull/67&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/pull/67&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks @ctron!&lt;/p&gt;

&lt;p&gt;    Don&apos;t we need to adjust `getHeaderPadCount` in `readOldBinaryEntry` as well?&lt;/p&gt;

&lt;p&gt;    At first I stumbled over the `-1` in the call to `getHeaderPadCount` but I think it is because the method already accounts for the trailing NUL, I guess a comment could help &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;    One more nit, you removed a since tag from one of `CpioArchiveEntry`&apos;s constructors by accident.&lt;/p&gt;

&lt;p&gt;    Also, but this probably is a separate issue: `CpioArchiveOutputStream` seems to have the same problem (even worse, as the length we write into the header may be wrong). It seems we should deprecate the no-arg version of `getHeaderPadCount` as it only works for single bye encodings.&lt;/p&gt;</comment>
                            <comment id="16539652" author="githubbot" created="Wed, 11 Jul 2018 07:22:56 +0000"  >&lt;p&gt;Github user ctron commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-compress/pull/67&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/pull/67&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks @bodewig for reviewing this PR. Yes you are right, with everything :wink: &lt;/p&gt;

&lt;p&gt;    I amended the PR, fixing the issues with the original PR and added the functionality to the output stream as well. The made them two commits for to easier understand what was fixed and what added. It can be squashed later on if required.&lt;/p&gt;</comment>
                            <comment id="16539723" author="githubbot" created="Wed, 11 Jul 2018 08:32:58 +0000"  >&lt;p&gt;Github user bodewig commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-compress/pull/67&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/pull/67&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Many thanks. We are not that squash-happy over here, two commits is fine.&lt;/p&gt;

&lt;p&gt;    I would have gone for `ZipEncoding` rather than `Charset` for consistency, but can change that later myself, I really don&apos;t want to play &quot;fetch me a rock&quot; here. Will merge the PR soonish.&lt;/p&gt;</comment>
                            <comment id="16539852" author="githubbot" created="Wed, 11 Jul 2018 10:19:19 +0000"  >&lt;p&gt;Github user ctron commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-compress/pull/67&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/pull/67&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Yes, that might have been a solution as well. But I was thinking to use something more Java-standard. If you want me to change this, I can do this as well.&lt;/p&gt;</comment>
                            <comment id="16540049" author="githubbot" created="Wed, 11 Jul 2018 12:53:12 +0000"  >&lt;p&gt;Github user bodewig commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-compress/pull/67&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/pull/67&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    `ZipEncoding` is a better choice for our internal use as it is used to encode the name (and deals with &quot;use null as the encoding to use the platform&apos;s default encoding&quot; transparently). You don&apos;t have to make the changes yourself (but if you do, please add spaces around operators &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; ), but I won&apos;t complain if you are faster than me.&lt;/p&gt;</comment>
                            <comment id="16540294" author="githubbot" created="Wed, 11 Jul 2018 16:04:57 +0000"  >&lt;p&gt;Github user bodewig commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-compress/pull/67&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/pull/67&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @ctron I&apos;ve just started merging your changes locally&lt;/p&gt;</comment>
                            <comment id="16540368" author="githubbot" created="Wed, 11 Jul 2018 16:53:05 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-compress/pull/67&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/pull/67&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16540369" author="githubbot" created="Wed, 11 Jul 2018 16:53:07 +0000"  >&lt;p&gt;Github user bodewig commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-compress/pull/67&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/pull/67&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Many thanks!&lt;/p&gt;</comment>
                            <comment id="16540370" author="bodewig" created="Wed, 11 Jul 2018 16:53:32 +0000"  >&lt;p&gt;fixed in master, many thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ctron&quot; class=&quot;user-hover&quot; rel=&quot;ctron&quot;&gt;ctron&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16541742" author="ctron" created="Thu, 12 Jul 2018 14:35:12 +0000"  >&lt;p&gt;Thanks for taking care of this.&lt;/p&gt;

&lt;p&gt;Is there any chance for a soon-ish 1.17.1 version?&lt;/p&gt;</comment>
                            <comment id="16542595" author="bodewig" created="Fri, 13 Jul 2018 06:24:52 +0000"  >&lt;p&gt;Not immediately unless somebody else cuts the release (upcoming vacation for me). I want to add a proper test for &lt;a href=&quot;https://issues.apache.org/jira/browse/COMPRESS-455&quot; title=&quot;Cannot open certain APK file (Unexpected record signature)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COMPRESS-455&quot;&gt;&lt;del&gt;COMPRESS-455&lt;/del&gt;&lt;/a&gt; before cutting a new release which will be 1.18 when I&apos;m back.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 18 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3vnxr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>