<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:32:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[COMPRESS-358] Offset is larger than block size in IWA dialect of FramedSnappyCompressorInputStream</title>
                <link>https://issues.apache.org/jira/browse/COMPRESS-358</link>
                <project id="12310904" key="COMPRESS">Commons Compress</project>
                    <description>&lt;p&gt;I finally was able to run the FramedSnappyCompressorInputStreamon a larger number of .iwa files.  I got the following on two files:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.io.IOException: Offset is larger than block size
	at org.apache.commons.compress.compressors.snappy.SnappyCompressorInputStream.expandCopy(SnappyCompressorInputStream.java:341)
	at org.apache.commons.compress.compressors.snappy.SnappyCompressorInputStream.fill(SnappyCompressorInputStream.java:212)
	at org.apache.commons.compress.compressors.snappy.SnappyCompressorInputStream.read(SnappyCompressorInputStream.java:134)
	at org.apache.commons.compress.compressors.snappy.FramedSnappyCompressorInputStream.readOnce(FramedSnappyCompressorInputStream.java:166)
	at org.apache.commons.compress.compressors.snappy.FramedSnappyCompressorInputStream.read(FramedSnappyCompressorInputStream.java:122)
	at java.io.InputStream.read(InputStream.java:101)
	at java.nio.file.Files.copy(Files.java:2908)
	at java.nio.file.Files.copy(Files.java:3027)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;No good deed goes unpunished... &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  Thank you, again!&lt;/p&gt;</description>
                <environment></environment>
        <key id="12982074">COMPRESS-358</key>
            <summary>Offset is larger than block size in IWA dialect of FramedSnappyCompressorInputStream</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="5" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Trivial</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="tallison">Tim Allison</reporter>
                        <labels>
                    </labels>
                <created>Wed, 22 Jun 2016 19:45:10 +0000</created>
                <updated>Tue, 10 Jan 2017 17:10:24 +0000</updated>
                            <resolved>Tue, 10 Jan 2017 17:10:24 +0000</resolved>
                                    <version>1.12</version>
                                    <fixVersion>1.14</fixVersion>
                                    <component>Compressors</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15345046" author="tallison@mitre.org" created="Wed, 22 Jun 2016 19:47:25 +0000"  >&lt;p&gt;Original file DocumentStylesheet.iwa and the version as uncompressed by Evernote&apos;s &lt;a href=&quot;https://github.com/evernote/iwana/blob/master/iwana-extract/src/main/java/com/evernote/iwana/SnappyNoCRCFramedInputStream.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;iwana&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15359431" author="bodewig" created="Fri, 1 Jul 2016 18:26:21 +0000"  >&lt;p&gt;Hmm, I don&apos;t get the exception you describe but instead the whole file is skipped, when reading the attached DocumentStylesheet.iwa. Is the file correct?&lt;/p&gt;

&lt;p&gt;The very first byte is 0xda (a block type not defined at all) and the three bytes specify a size larger than the file size. It looks as if DocumentStylesheet.iwa would be the first 32k of DocumentStylesheet_uncompressed.iwa&lt;/p&gt;</comment>
                            <comment id="15555531" author="bodewig" created="Fri, 7 Oct 2016 16:24:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tallison%40mitre.org&quot; class=&quot;user-hover&quot; rel=&quot;tallison@mitre.org&quot;&gt;tallison@mitre.org&lt;/a&gt; any update on the files?&lt;/p&gt;</comment>
                            <comment id="15811917" author="bodewig" created="Mon, 9 Jan 2017 14:38:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tallison%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;tallison@apache.org&quot;&gt;tallison@apache.org&lt;/a&gt; while working on &lt;a href=&quot;https://issues.apache.org/jira/browse/COMPRESS-246&quot; title=&quot;Compressor for Snappy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COMPRESS-246&quot;&gt;&lt;del&gt;COMPRESS-246&lt;/del&gt;&lt;/a&gt; I discovered a few bugs in &lt;tt&gt;SnappyCompressorInputStream&lt;/tt&gt; where it was losing data when sliding the window too early or incorrectly counting bytes read when the window needed to slide. Could you give the current master branch a try to see whether it solves your problem?&lt;/p&gt;</comment>
                            <comment id="15811929" author="tallison@mitre.org" created="Mon, 9 Jan 2017 14:42:02 +0000"  >&lt;p&gt;Y, sorry for dropping the ball on this.  Thank you for your help.  Will check today.&lt;/p&gt;</comment>
                            <comment id="15812886" author="tallison@mitre.org" created="Mon, 9 Jan 2017 21:25:00 +0000"  >&lt;p&gt;I&apos;m still getting &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.io.IOException: Offset is larger than block size
	at org.apache.commons.compress.compressors.snappy.SnappyCompressorInputStream.expandCopy(SnappyCompressorInputStream.java:353)
	at org.apache.commons.compress.compressors.snappy.SnappyCompressorInputStream.fill(SnappyCompressorInputStream.java:215)
	at org.apache.commons.compress.compressors.snappy.SnappyCompressorInputStream.read(SnappyCompressorInputStream.java:134)
	at org.apache.commons.compress.compressors.snappy.FramedSnappyCompressorInputStream.readOnce(FramedSnappyCompressorInputStream.java:167)
	at org.apache.commons.compress.compressors.snappy.FramedSnappyCompressorInputStream.read(FramedSnappyCompressorInputStream.java:123)
	at org.apache.commons.compress.compressors.snappy.FramedSnappyCompressorInputStream.read(FramedSnappyCompressorInputStream.java:107)
	at org.apache.commons.compress.compressors.snappy.FramedSnappyCompressorInputStreamTest.readIWAStyleSheet(FramedSnappyCompressorInputStreamTest.java:201)
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15812902" author="tallison@mitre.org" created="Mon, 9 Jan 2017 21:29:44 +0000"  >&lt;p&gt;I&apos;m attaching the DocumentStyleSheet_fromZipStream.iwa that I &lt;tt&gt;IOUtils.copy&lt;/tt&gt; from the ZipEntry for &lt;tt&gt;Index/DocumentStyleSheet.iwa&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;When I run iwana&apos;s &lt;tt&gt;SnappyNoCRCFramedInputStream&lt;/tt&gt;, I get &lt;tt&gt;DocumentStylesheet_iwana_unsnapped.iwa&lt;/tt&gt; with no exceptions.&lt;/p&gt;

&lt;p&gt;When I run an updated version of commons&apos; &lt;tt&gt;FramedSnappyCompressorInputStream&lt;/tt&gt; as &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;                &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; FramedSnappyCompressorInputStream in =
                        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FramedSnappyCompressorInputStream(is, FramedSnappyDialect.IWORK_ARCHIVE);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I get the &lt;tt&gt;Offset is larger than blocksize exception&lt;/tt&gt; at 40 kb in &lt;tt&gt;DocumentStyleSheet_commons_unsnapped.iwa&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15812911" author="tallison@mitre.org" created="Mon, 9 Jan 2017 21:33:10 +0000"  >&lt;p&gt;Again, sorry for my delay!!!&lt;/p&gt;

&lt;p&gt;I think something was wrong with the file I attached &lt;tt&gt;DocumentStyleSheet.iwa&lt;/tt&gt;...I can&apos;t remember if I got that via Winzip or something else.&lt;/p&gt;

&lt;p&gt;That file &lt;em&gt;should&lt;/em&gt; be the same as &lt;tt&gt;DocumentStyleSheet_fromZipStream.iwa&lt;/tt&gt;, and it clearly isn&apos;t.&lt;/p&gt;</comment>
                            <comment id="15812916" author="tallison@mitre.org" created="Mon, 9 Jan 2017 21:35:13 +0000"  >&lt;p&gt;This is the original complete .numbers file.&lt;/p&gt;</comment>
                            <comment id="15814016" author="bodewig" created="Tue, 10 Jan 2017 06:03:33 +0000"  >&lt;p&gt;Thanks, Tim, I&apos;ll try to find some time during the next days.&lt;/p&gt;</comment>
                            <comment id="15814044" author="bodewig" created="Tue, 10 Jan 2017 06:18:02 +0000"  >&lt;p&gt;We use an internal lock size of 32k and this one is only configurable for the raw stream, It seems the IWA files use offsets larger than that. &lt;a href=&quot;https://github.com/evernote/iwana/blob/master/iwana-extract/src/main/java/com/evernote/iwana/SnappyNoCRCFramedInputStream.java#L33&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/evernote/iwana/blob/master/iwana-extract/src/main/java/com/evernote/iwana/SnappyNoCRCFramedInputStream.java#L33&lt;/a&gt; uses 128k which is way bigger than the size the &quot;spec&quot; talks about&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Note that the data portion of the chunk, i.e., the compressed contents,&lt;br/&gt;
can be at most 16777211 bytes (2^24 - 1, minus the checksum).&lt;br/&gt;
However, we place an additional restriction that the uncompressed data&lt;br/&gt;
in a chunk must be no longer than 65536 bytes. This allows consumers to&lt;br/&gt;
easily use small fixed-size buffers.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yet another deviation, I guess.&lt;/p&gt;

&lt;p&gt;I&apos;ll make the block size configurable for the framed streams as well, probably won&apos;t manage to do so today, though.&lt;/p&gt;</comment>
                            <comment id="15814861" author="tallison@mitre.org" created="Tue, 10 Jan 2017 12:35:36 +0000"  >&lt;blockquote&gt;&lt;p&gt;Yet another deviation, I guess.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;No rush on my end.  Thank you, again!&lt;/p&gt;</comment>
                            <comment id="15815136" author="bodewig" created="Tue, 10 Jan 2017 14:42:12 +0000"  >&lt;p&gt;Some initial testing shows a block size of 64k is should be sufficient for your example. Can we include the files as unit test fodder?&lt;/p&gt;</comment>
                            <comment id="15815484" author="bodewig" created="Tue, 10 Jan 2017 16:54:01 +0000"  >&lt;p&gt;Current master uncompresses your example correctly when using a block size of 64k, the change is trivial.&lt;/p&gt;

&lt;p&gt;I&apos;ve got a unit test based on your files sitting in my workspace ready to get committed unless there was something sensitive inside.&lt;/p&gt;</comment>
                            <comment id="15815502" author="tallison@mitre.org" created="Tue, 10 Jan 2017 17:01:28 +0000"  >&lt;p&gt;Woohoo!  Thank you!&lt;/p&gt;

&lt;p&gt;That test file comes from Evernote&apos;s &lt;a href=&quot;https://github.com/evernote/iwana/blob/master/iwana-extract/src/test/resources/test-documents/testNumbers2013.numbers&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;iwana&lt;/a&gt;.  I trust from their license that it is ASL 2.0.&lt;/p&gt;

&lt;p&gt;Again, apologies for my delay, and thank you!&lt;/p&gt;</comment>
                            <comment id="15815530" author="bodewig" created="Tue, 10 Jan 2017 17:10:24 +0000"  >&lt;p&gt;Thanks, I committed the test.&lt;/p&gt;

&lt;p&gt;In retrospect I could have understood the problem when you reported it as the error message was clear enough. But in reality I had to implement write support to really wrap my head around the algorithm and format.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12846414" name="DocumentStyleSheet_commons_unsnapped.iwa" size="40002" author="tallison" created="Mon, 9 Jan 2017 21:29:44 +0000"/>
                            <attachment id="12846415" name="DocumentStyleSheet_fromZipStream.iwa" size="36288" author="tallison" created="Mon, 9 Jan 2017 21:29:44 +0000"/>
                            <attachment id="12812597" name="DocumentStylesheet.iwa" size="32768" author="tallison" created="Wed, 22 Jun 2016 19:47:25 +0000"/>
                            <attachment id="12846416" name="DocumentStylesheet_iwana_unsnapped.iwa" size="219521" author="tallison" created="Mon, 9 Jan 2017 21:29:44 +0000"/>
                            <attachment id="12812596" name="DocumentStylesheet_uncompressed.iwa" size="199496" author="tallison" created="Wed, 22 Jun 2016 19:47:25 +0000"/>
                            <attachment id="12846417" name="testNumbersNew.numbers" size="179147" author="tallison" created="Mon, 9 Jan 2017 21:35:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 44 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2zxg7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>