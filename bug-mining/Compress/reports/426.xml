<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:34:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[COMPRESS-591] Fix decoding of 7z files containing LZMA streams with end marker</title>
                <link>https://issues.apache.org/jira/browse/COMPRESS-591</link>
                <project id="12310904" key="COMPRESS">Commons Compress</project>
                    <description>&lt;p&gt;Some uncommon but valid .7z files contain LZMA streams that use the end of stream marker. Currently Commons Compress together with XZ for Java considers such files to be corrupt.&lt;/p&gt;

&lt;p&gt;XZ for Java 1.9 added a new method&#160;&lt;a href=&quot;https://tukaani.org/xz/xz-javadoc/org/tukaani/xz/LZMAInputStream.html#enableRelaxedEndCondition()&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;LZMAInputStream.enableRelaxedEndCondition()&lt;/a&gt; specifically for this issue. To use this feature in Commons Compress, a change is needed to the &quot;decode&quot; function in src/main/java/org/apache/commons/compress/archivers/sevenz/LZMADecoder.java:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;- return new LZMAInputStream(in, uncompressedLength, propsByte, dictSize);&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;+ final LZMAInputStream lzmaIn = new LZMAInputStream(in, uncompressedLength, propsByte, dictSize);&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;+ lzmaIn.enableRelaxedEndCondition();&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;+ return lzmaIn;&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;A tiny test file is attached (thanks to Simon for providing it). Another test file &quot;sheet.7z&quot; can be found from &amp;lt;&lt;a href=&quot;https://sourceforge.net/p/lzmautils/discussion/708858/thread/822d80d5ea/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://sourceforge.net/p/lzmautils/discussion/708858/thread/822d80d5ea/&lt;/a&gt;&amp;gt;.&lt;/p&gt;

&lt;p&gt;XZ for Java 1.9 is already a few months old, so I apologize for not reporting this earlier.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13400318">COMPRESS-591</key>
            <summary>Fix decoding of 7z files containing LZMA streams with end marker</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="larhzu">Lasse Collin</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Sep 2021 20:21:04 +0000</created>
                <updated>Sat, 30 Oct 2021 01:04:13 +0000</updated>
                            <resolved>Sat, 30 Oct 2021 01:04:13 +0000</resolved>
                                    <version>1.21</version>
                                    <fixVersion>1.22</fixVersion>
                                    <component>Archivers</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="4200">1h 10m</timespent>
                                <comments>
                            <comment id="17414152" author="peterlee" created="Mon, 13 Sep 2021 11:34:41 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=larhzu&quot; class=&quot;user-hover&quot; rel=&quot;larhzu&quot;&gt;larhzu&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thank you for your reporting.&lt;/p&gt;

&lt;p&gt;I noticed that there are some `downsides` to enable this. I would prefer to introduce a new option to enable this, but not to enable this by default.&lt;/p&gt;

&lt;p&gt;BTW, a PR in github is always welcome.&lt;/p&gt;</comment>
                            <comment id="17416947" author="larhzu" created="Fri, 17 Sep 2021 22:11:09 +0000"  >&lt;p&gt;I&apos;m aware of only two downsides. Weaker error detection doesn&apos;t matter because in .7z there is CRC32 anyway. The patch only affects handling of the 7z format so it won&apos;t make error detection worse in other LZMA uses.&lt;/p&gt;

&lt;p&gt;Another downside is that less input might be read than the actual compressed size. Does this matter in the 7z code inside Commons Compress?&lt;/p&gt;

&lt;p&gt;It is true that the code in 7-Zip is more sophisticated. It tries to sniff if the end marker is possibly present and (compared to my patch) it&apos;s more strict about what inputs are accepted. That is, with enableRelaxedEndCondition(), Commons Compress might accept files that 7-Zip would reject. Such files would need to be intentionally created as accidental corruption would likely get caught by CRC32. While this might be a problem in some situations, I think overall the patch is still an improvement as currently Commons Compress can reject valid 7z files.&lt;/p&gt;

&lt;p&gt;Whatever the eventual fix will be, I think it shouldn&apos;t be an option. 7-Zip handles both LZMA stream types silently inside 7z files and so should other 7z implementations.&lt;/p&gt;</comment>
                            <comment id="17418447" author="peterlee" created="Wed, 22 Sep 2021 06:57:38 +0000"  >&lt;p&gt;Sorry about my late replay, and&#160;thank you for your detailed explanization.&lt;/p&gt;

&lt;p&gt;I will create a PR on github for this. Please have a look.&lt;/p&gt;</comment>
                            <comment id="17418470" author="peterlee" created="Wed, 22 Sep 2021 08:19:12 +0000"  >&lt;p&gt;Hi&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=larhzu&quot; class=&quot;user-hover&quot; rel=&quot;larhzu&quot;&gt;larhzu&lt;/a&gt;, please have a look at &lt;a href=&quot;https://github.com/apache/commons-compress/pull/223&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17419354" author="larhzu" created="Thu, 23 Sep 2021 17:32:03 +0000"  >&lt;p&gt;The PR changes also compressors/lzma/LZMACompressorInputStream.java. This is wrong and will cause problems. Only archivers/sevenz/LZMADecoder.java needs the patch as the problem is specific to the 7z container.&lt;/p&gt;

&lt;p&gt;Otherwise it looks good. Thanks!&lt;/p&gt;

&lt;p&gt;I don&apos;t have a Github account so I comment only here, sorry.&lt;/p&gt;</comment>
                            <comment id="17419545" author="peterlee" created="Fri, 24 Sep 2021 03:31:48 +0000"  >&lt;p&gt;&lt;em&gt;The PR changes also compressors/lzma/LZMACompressorInputStream.java. This is wrong and will cause problems.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;I see. I will fix this.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thank you again for your reporting and patch.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13033285" name="lzma-with-eos.7z" size="174" author="larhzu" created="Thu, 9 Sep 2021 20:07:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 7 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0uryg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>