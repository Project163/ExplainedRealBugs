<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:34:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[COMPRESS-571] 7z random access fails on shuffled entry list</title>
                <link>https://issues.apache.org/jira/browse/COMPRESS-571</link>
                <project id="12310904" key="COMPRESS">Commons Compress</project>
                    <description>&lt;p&gt;I noticed a problem on a 7z file and could reproduce the error if the InputStream is retrieved after shuffling the entries.&lt;/p&gt;

&lt;p&gt;This test fails with a checksum verification error&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Test
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void retrieveInputStreamForShuffledEntries() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; SevenZFile sevenZFile = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SevenZFile(getFile(&lt;span class=&quot;code-quote&quot;&gt;&quot;COMPRESS-256.7z&quot;&lt;/span&gt;))) {
        List&amp;lt;SevenZArchiveEntry&amp;gt; entries = (List&amp;lt;SevenZArchiveEntry&amp;gt;) sevenZFile.getEntries();
        Collections.shuffle(entries);
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; SevenZArchiveEntry entry : entries) {
            IOUtils.toByteArray(sevenZFile.getInputStream(entry));
        }
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This is the exception&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.io.IOException: Checksum verification failed
	at org.apache.commons.compress.utils.ChecksumVerifyingInputStream.read(ChecksumVerifyingInputStream.java:94)
	at org.apache.commons.compress.utils.ChecksumVerifyingInputStream.read(ChecksumVerifyingInputStream.java:74)
	at org.apache.commons.compress.utils.IOUtils.copy(IOUtils.java:87)
	at org.apache.commons.compress.utils.IOUtils.copy(IOUtils.java:62)
	at org.apache.commons.compress.utils.IOUtils.toByteArray(IOUtils.java:247)
	at org.apache.commons.compress.archivers.sevenz.SevenZFileTest.retrieveInputStreamForShuffledEntries(SevenZFileTest.java:616)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This also fails on the current master with the same error&lt;/p&gt;</description>
                <environment></environment>
        <key id="13365616">COMPRESS-571</key>
            <summary>7z random access fails on shuffled entry list</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="peterlee">Peter Lee</assignee>
                                    <reporter username="rschimpf">Robin Schimpf</reporter>
                        <labels>
                    </labels>
                <created>Tue, 16 Mar 2021 19:33:17 +0000</created>
                <updated>Mon, 20 Mar 2023 13:17:16 +0000</updated>
                            <resolved>Mon, 20 Mar 2023 13:17:16 +0000</resolved>
                                    <version>1.20</version>
                                    <fixVersion>1.21</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17303018" author="peterlee" created="Wed, 17 Mar 2021 02:02:58 +0000"  >&lt;p&gt;The &lt;em&gt;getEntries()&lt;/em&gt; returns exactly the same list of entries so the shuffle may also affect the same amout of entries.&lt;/p&gt;

&lt;p&gt;Maybe we should return a copy of entries in &lt;em&gt;getEntries()&lt;/em&gt; ?&lt;/p&gt;</comment>
                            <comment id="17303019" author="peterlee" created="Wed, 17 Mar 2021 02:03:54 +0000"  >&lt;p&gt;With returning a copy of the entries, I can successfully finish this test.&lt;/p&gt;</comment>
                            <comment id="17303127" author="rschimpf" created="Wed, 17 Mar 2021 06:05:24 +0000"  >&lt;p&gt;You are correct. Shuffling the list also shuffles the underlying array. This is also documented in the &lt;tt&gt;Arrays.asList&lt;/tt&gt; JavaDoc&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
(Changes to the returned list &lt;span class=&quot;code-quote&quot;&gt;&quot;write through&quot;&lt;/span&gt; to the array.)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So returning a copy seems to be the correct fix for this. The user of the class should not be able to change the internal representation with his actions&lt;/p&gt;</comment>
                            <comment id="17303144" author="bodewig" created="Wed, 17 Mar 2021 06:50:58 +0000"  >&lt;p&gt;+1 to returning a copy. We already do in other places (for example when returning ZIP extra fields). I wonder why findbugs doesn&apos;t complain about the current code - at least it flags cases where you return the array directly.&lt;/p&gt;</comment>
                            <comment id="17303178" author="peterlee" created="Wed, 17 Mar 2021 08:02:20 +0000"  >&lt;p&gt;Fixed with&#160;65a5c75c.&lt;/p&gt;</comment>
                            <comment id="17303383" author="michael-o" created="Wed, 17 Mar 2021 12:54:15 +0000"  >&lt;p&gt;Why a copy and not a unmodifiable list?&lt;/p&gt;</comment>
                            <comment id="17305286" author="peterlee" created="Sat, 20 Mar 2021 02:49:41 +0000"  >&lt;p&gt;I don&apos;t see much difference between a copy and a unmodifiable list.&lt;/p&gt;

&lt;p&gt;To be consistent with other implementions in Compress, I think returning a copy is a reasonable choice here.&lt;/p&gt;</comment>
                            <comment id="17701963" author="garydgregory" created="Fri, 17 Mar 2023 19:26:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=peterlee&quot; class=&quot;user-hover&quot; rel=&quot;peterlee&quot;&gt;peterlee&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Please resolve this issue with the proper version for your commit.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 34 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0ous8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>