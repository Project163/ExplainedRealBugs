<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:35:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[COMPRESS-651] Decompress BZIP2 File Max Output is 900000 chars</title>
                <link>https://issues.apache.org/jira/browse/COMPRESS-651</link>
                <project id="12310904" key="COMPRESS">Commons Compress</project>
                    <description>&lt;p&gt;I tried to uncompress a big file (a few MBs) of bz2 file using&#160;&lt;/p&gt;

&lt;p&gt;BZip2CompressorInputStream, the max output I can get is 900000 in size.&#160;&lt;/p&gt;

&lt;p&gt;The following example&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-rw-r--r-- &#160; 1 ahmadin &#160;staff &#160; 167283773 Nov &#160;9 15:50 test.tar.bz2
-rw-r--r-- &#160; 1 ahmadin &#160;staff &#160; &#160; &#160;900000 Nov &#160;9 15:51 test.tar &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The code I use is the example from &lt;a href=&quot;https://commons.apache.org/proper/commons-compress/examples.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://commons.apache.org/proper/commons-compress/examples.html&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;BZ2Extract {
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; buffersize = 102400;
        InputStream fin = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            fin = Files.newInputStream(Paths.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;/cfm/test.tar.bz2&quot;&lt;/span&gt;));
            BufferedInputStream in = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BufferedInputStream(fin);
            OutputStream out = Files.newOutputStream(Paths.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;/cfm/test.tar&quot;&lt;/span&gt;));
            BZip2CompressorInputStream bzIn = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BZip2CompressorInputStream(in);
            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] buffer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[buffersize];
            &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; n = 0;
            &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (-1 != (n = bzIn.read(buffer))) {
                out.write(buffer, 0, n);
            }
            out.close();
            bzIn.close();
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RuntimeException(e);
        }
    }
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If I use bzip2 on my mac to uncompress, the file size is 1199749120 after uncompressing&lt;/p&gt;</description>
                <environment>&lt;p&gt;Plain Java in IntelliJ&lt;/p&gt;</environment>
        <key id="13557398">COMPRESS-651</key>
            <summary>Decompress BZIP2 File Max Output is 900000 chars</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10008">Information Provided</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ahmadin">Ahmadin Badruddin</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Nov 2023 22:55:52 +0000</created>
                <updated>Wed, 13 Mar 2024 15:35:06 +0000</updated>
                            <resolved>Wed, 13 Mar 2024 15:35:06 +0000</resolved>
                                    <version>1.24.0</version>
                                                    <component>Compressors</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17784620" author="garydgregory" created="Thu, 9 Nov 2023 23:04:12 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ahmadin&quot; class=&quot;user-hover&quot; rel=&quot;ahmadin&quot;&gt;ahmadin&lt;/a&gt;&lt;br/&gt;
Thank you for your report. Please attach your test bzip2 file in case this specific file matters, otherwise, there I can&apos;t reproduce exactly what you see.&lt;/p&gt;</comment>
                            <comment id="17786993" author="JIRAUSER303013" created="Fri, 17 Nov 2023 01:41:40 +0000"  >&lt;p&gt;It seems the problem is caused by generating the bzip2 file using pbzip2. I attached a sample file. The way I generate this file is using the following command&lt;/p&gt;

&lt;p&gt;tar -c 10mbsource.txt |pbzip2 -p4 -m10 &amp;gt; my.tar.bz2&lt;/p&gt;</comment>
                            <comment id="17787487" author="garydgregory" created="Sat, 18 Nov 2023 13:14:26 +0000"  >&lt;p&gt;Can you successfully get back to the source txt file using pbzip2 and tar?&lt;/p&gt;</comment>
                            <comment id="17787505" author="JIRAUSER303013" created="Sat, 18 Nov 2023 16:16:29 +0000"  >&lt;p&gt;Yes, I can.&lt;/p&gt;

&lt;p&gt;(&#9096;|)&#63743; /cfm/ pbzip2 -d my1.tar.bz2&lt;br/&gt;
(&#9096;|)&#63743; /cfm/ ls -altr&lt;/p&gt;

&lt;p&gt;&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;- &#160; 1 ahmadin&#160; staff &#160; &#160;10496000 Nov 18 09:12 my1.tar&lt;/p&gt;

&lt;p&gt;(&#9096;|)&#63743; /cfm/ tar xvf my1.tar&lt;br/&gt;
x 10mbsource.txt&lt;/p&gt;

&lt;p&gt;(&#9096;|)&#63743; /cfm/ ls -altr&lt;/p&gt;

&lt;p&gt;&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-@ &#160;1 ahmadin&#160; staff &#160; &#160;10485760 Jul 26 &#160;2022 10mbsource.txt&lt;/p&gt;</comment>
                            <comment id="17791693" author="JIRAUSER303013" created="Thu, 30 Nov 2023 15:51:14 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggregory&quot; class=&quot;user-hover&quot; rel=&quot;ggregory&quot;&gt;ggregory&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;By any chance, did have a chance to have a look on this issue?&lt;/p&gt;</comment>
                            <comment id="17791766" author="garydgregory" created="Thu, 30 Nov 2023 20:27:17 +0000"  >&lt;p&gt;No but feel free to provide a PR on GitHub if you have anything. &lt;/p&gt;</comment>
                            <comment id="17824952" author="garydgregory" created="Sat, 9 Mar 2024 14:17:14 +0000"  >&lt;p&gt;I added a simpler disabled test in &lt;tt&gt;org.apache.commons.compress.compressors.bzip2.BZip2Compress651Test&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17824955" author="sebb@apache.org" created="Sat, 9 Mar 2024 15:00:02 +0000"  >&lt;p&gt;I tried halving BZip2Constants.BASEBLOCKSIZE to 50_000, and the output file size is 450_000; it looks like the output size is being limited to the block size.&lt;/p&gt;</comment>
                            <comment id="17824977" author="garydgregory" created="Sat, 9 Mar 2024 19:08:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ahmadin&quot; class=&quot;user-hover&quot; rel=&quot;ahmadin&quot;&gt;ahmadin&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;This is how to write this test to correctly decompress this kind of file:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testCompress651() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; buffersize = 102_400;
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Path pathIn = Paths.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;src/test/resources/org/apache/commons/compress/COMPRESS-651/my10m.tar.bz2&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Path pathOut = Paths.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;target/COMPRESS-651/test.tar&quot;&lt;/span&gt;);
        Files.createDirectories(pathOut.getParent());
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (BZip2CompressorInputStream inputStream = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BZip2CompressorInputStream(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BufferedInputStream(Files.newInputStream(pathIn)), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
                OutputStream outputStream = Files.newOutputStream(pathOut)) {
            IOUtils.copy(inputStream, outputStream, buffersize);
        }
        &lt;span class=&quot;code-comment&quot;&gt;// expected size confirmed locally on macOS
&lt;/span&gt;        assertEquals(10_496_000, Files.size(pathOut));
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=peterhull90%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;peterhull90@gmail.com&quot;&gt;peterhull90@gmail.com&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Notice the use of &lt;tt&gt;BZip2CompressorInputStream(InputStream, boolean)&lt;/tt&gt;&lt;/p&gt;
</comment>
                            <comment id="17826081" author="JIRAUSER303013" created="Wed, 13 Mar 2024 14:33:42 +0000"  >&lt;p&gt;Thank you for the help. It works from my tests&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13064471" name="my10m.tar.bz2" size="6271204" author="ahmadin" created="Fri, 17 Nov 2023 01:49:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 34 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1lidc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>