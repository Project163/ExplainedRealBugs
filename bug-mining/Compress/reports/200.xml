<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:31:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[COMPRESS-343] Native Memory Leak in Sevenz-DeflateDecoder</title>
                <link>https://issues.apache.org/jira/browse/COMPRESS-343</link>
                <project id="12310904" key="COMPRESS">Commons Compress</project>
                    <description>&lt;p&gt;The class ...sevenz.Coders.DeflateDecoder does not close (end()) the Deflater and Inflater. This can lead to native memory issues: see &lt;a href=&quot;https://bugs.openjdk.java.net/browse/JDK-8074108&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://bugs.openjdk.java.net/browse/JDK-8074108&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;In our case we create a zip archive with &amp;gt;100000 files. The Java heap is around 300MB (with 2GB max). The native memory is increasing to 8GB and above. Because the Java heap has no pressure - no GC is triggered, therefore the Deflaters are not collected and the native memory is not freed.  &lt;/p&gt;
</description>
                <environment></environment>
        <key id="12950887">COMPRESS-343</key>
            <summary>Native Memory Leak in Sevenz-DeflateDecoder</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rpreissel">Rene Preissel</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 Mar 2016 16:25:56 +0000</created>
                <updated>Thu, 17 Mar 2016 09:35:40 +0000</updated>
                            <resolved>Thu, 17 Mar 2016 09:35:40 +0000</resolved>
                                    <version>1.10</version>
                                    <fixVersion>1.11</fixVersion>
                                    <component>Archivers</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15197624" author="rpreissel" created="Wed, 16 Mar 2016 16:33:26 +0000"  >&lt;p&gt;I provided a patch. See attachment or Github:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/rpreissel/commons-compress/tree/COMPRESS-343&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/rpreissel/commons-compress/tree/COMPRESS-343&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15197663" author="githubbot" created="Wed, 16 Mar 2016 16:48:44 +0000"  >&lt;p&gt;GitHub user rpreissel opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-compress/pull/11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/pull/11&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Bugfix for &lt;a href=&quot;https://issues.apache.org/jira/browse/COMPRESS-343&quot; title=&quot;Native Memory Leak in Sevenz-DeflateDecoder&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COMPRESS-343&quot;&gt;&lt;del&gt;COMPRESS-343&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    The class ...sevenz.Coders.DeflateDecoder does not close (end()) the Deflater and Inflater. This can lead to native memory issues: see &lt;a href=&quot;https://bugs.openjdk.java.net/browse/JDK-8074108&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://bugs.openjdk.java.net/browse/JDK-8074108&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;    This bugfix solves the problem.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/rpreissel/commons-compress&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/rpreissel/commons-compress&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/COMPRESS-343&quot; title=&quot;Native Memory Leak in Sevenz-DeflateDecoder&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COMPRESS-343&quot;&gt;&lt;del&gt;COMPRESS-343&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-compress/pull/11.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/pull/11.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #11&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 2c1e2980c5d5a17be220ae26793e80e9683cc16e&lt;br/&gt;
Author: Rene Preissel &amp;lt;rp@etosquare.de&amp;gt;&lt;br/&gt;
Date:   2016-03-16T16:26:57Z&lt;/p&gt;

&lt;p&gt;    Bugfix for &lt;a href=&quot;https://issues.apache.org/jira/browse/COMPRESS-343&quot; title=&quot;Native Memory Leak in Sevenz-DeflateDecoder&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COMPRESS-343&quot;&gt;&lt;del&gt;COMPRESS-343&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15197677" author="githubbot" created="Wed, 16 Mar 2016 17:00:59 +0000"  >&lt;p&gt;Github user garydgregory commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-compress/pull/11#issuecomment-197425393&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/pull/11#issuecomment-197425393&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Hi,&lt;/p&gt;

&lt;p&gt;    Thank you for the patch.&lt;/p&gt;

&lt;p&gt;    Do you have a unit test that show the problem and it being fixed by the patch?&lt;/p&gt;

&lt;p&gt;    Gary&lt;/p&gt;</comment>
                            <comment id="15197992" author="githubbot" created="Wed, 16 Mar 2016 19:37:19 +0000"  >&lt;p&gt;Github user rpreissel commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-compress/pull/11#issuecomment-197507339&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/pull/11#issuecomment-197507339&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    This is a memory issue and from my point of view there is no simple way to test it with an unit test.&lt;/p&gt;

&lt;p&gt;    I have tried to write an unit test and used ManagementFactory.getMemoryMXBean().getNonHeapMemoryUsage() to check the memory usage before and after creating an archive with many files. But there was no difference with the patch.&lt;/p&gt;

&lt;p&gt;    But if I look at the process with system utils I see that the version without the patch requires many GB and the version with the patch only 100MB. &lt;/p&gt;

&lt;p&gt;    Any ideas?  &lt;/p&gt;
</comment>
                            <comment id="15198034" author="githubbot" created="Wed, 16 Mar 2016 19:57:41 +0000"  >&lt;p&gt;Github user garydgregory commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-compress/pull/11#issuecomment-197518791&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/pull/11#issuecomment-197518791&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Yes, one of:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Use Mockito or Powermock to assert that the end() method has been called (best)&lt;/li&gt;
	&lt;li&gt;add an isClosed method somewhere that sets an ivar once end() is called.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15198199" author="githubbot" created="Wed, 16 Mar 2016 21:21:17 +0000"  >&lt;p&gt;Github user rpreissel commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-compress/pull/11#issuecomment-197554132&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/pull/11#issuecomment-197554132&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I added tests with PowerMock/Mockito. &lt;/p&gt;</comment>
                            <comment id="15199210" author="githubbot" created="Thu, 17 Mar 2016 09:32:39 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-compress/pull/11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/pull/11&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15199214" author="githubbot" created="Thu, 17 Mar 2016 09:34:25 +0000"  >&lt;p&gt;Github user bodewig commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-compress/pull/11#issuecomment-197788653&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/pull/11#issuecomment-197788653&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I had naively assumed `InflaterInputStream#close` would free up the resources. Come to think of it, if we pass in the `Inflater` ourselves it makes sense that we are responsible for cleanup.&lt;/p&gt;

&lt;p&gt;    Many thanks!&lt;/p&gt;

&lt;p&gt;    I&apos;ll grep through the code to ensure the same kind of bug doesn&apos;t hit us anywhere else.&lt;/p&gt;</comment>
                            <comment id="15199217" author="bodewig" created="Thu, 17 Mar 2016 09:35:40 +0000"  >&lt;p&gt;pull request merged, thanks again!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12793775" name="COMPRESS-343.patch" size="2909" author="rpreissel" created="Wed, 16 Mar 2016 16:33:26 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 35 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2uruf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>