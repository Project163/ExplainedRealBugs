<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:30:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[COMPRESS-189] ZipArchiveInputStream may read 0 bytes when reading from a nested Zip file</title>
                <link>https://issues.apache.org/jira/browse/COMPRESS-189</link>
                <project id="12310904" key="COMPRESS">Commons Compress</project>
                    <description>&lt;p&gt;When the following code is run an error &quot;Underlying input stream returned zero bytes&quot; is produced. If the commented line is uncommented it can be seen that the ZipArchiveInputStream returned 0 bytes. This only happens the first time read is called, subsequent calls work as expected i.e. the following code actually works correctly with that line uncommented!&lt;/p&gt;

&lt;p&gt;The zip file used to produce this behavious is available at &lt;a href=&quot;http://wwmm.ch.cam.ac.uk/~dl387/test.ZIP&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://wwmm.ch.cam.ac.uk/~dl387/test.ZIP&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;If this is not the correct way of processing a zip file of zip files please let me know. Also I believe whilst ZipFile can iterate over entries fast due to being able to look at the master table whilst ZipArchiveInputStream cannot. Is there anyway of instantiating a ZipFile from a zip file inside another zip file without first extracting the nested zip file?&lt;/p&gt;

&lt;p&gt;    ZipFile zipFile = new ZipFile(&quot;C:/test.ZIP&quot;);&lt;br/&gt;
    for (Enumeration&amp;lt;ZipArchiveEntry&amp;gt; iterator = zipFile.getEntries(); iterator.hasMoreElements(); ) {&lt;br/&gt;
      ZipArchiveEntry entry = iterator.nextElement();&lt;br/&gt;
      InputStream is = new BufferedInputStream(zipFile.getInputStream(entry));&lt;br/&gt;
      ZipArchiveInputStream zipInput = new ZipArchiveInputStream(is);&lt;br/&gt;
      ZipArchiveEntry innerEntry;&lt;br/&gt;
      while ((innerEntry = zipInput.getNextZipEntry()) != null){&lt;br/&gt;
        if (innerEntry.getName().endsWith(&quot;XML&quot;))&lt;/p&gt;
{
          //zipInput.read();
          System.out.println(IOUtils.toString(zipInput));
        }
&lt;p&gt;      }&lt;br/&gt;
    }&lt;/p&gt;</description>
                <environment>&lt;p&gt;JDK 1.6 64-bit, Windows 7&lt;/p&gt;</environment>
        <key id="12595985">COMPRESS-189</key>
            <summary>ZipArchiveInputStream may read 0 bytes when reading from a nested Zip file</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="dan2097">Daniel Lowe</reporter>
                        <labels>
                    </labels>
                <created>Tue, 26 Jun 2012 21:30:39 +0000</created>
                <updated>Sat, 5 Jan 2013 13:09:13 +0000</updated>
                            <resolved>Fri, 28 Dec 2012 06:55:18 +0000</resolved>
                                    <version>1.4.1</version>
                                    <fixVersion>1.5</fixVersion>
                                    <component>Archivers</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13467058" author="dan2097" created="Mon, 1 Oct 2012 18:29:09 +0000"  >&lt;p&gt;This issue can be worked around by reading while 0 or more bytes are read. Unfortunately Java&apos;s built in InputStreamReader will throw an exception is 0 bytes are read which is the underlying reason why in the example above Commons-IO throws an exception.&lt;/p&gt;

&lt;p&gt;Marking and resetting seems to be a reasonable way to workaround the problem:&lt;br/&gt;
BufferedInputStream archiveBis = new BufferedInputStream(archiveInput);&lt;br/&gt;
archiveBis.mark(1);&lt;br/&gt;
archiveBis.read();//if the bug is encountered nothing will be read&lt;br/&gt;
archiveBis.reset();&lt;/p&gt;

&lt;p&gt;Obviously a proper fix would be better&lt;/p&gt;</comment>
                            <comment id="13473473" author="dan2097" created="Wed, 10 Oct 2012 18:59:10 +0000"  >&lt;p&gt;The bug is due to a bug in the implementation of ZipArchiveInputStream&apos;s readDeflated:&lt;/p&gt;

&lt;p&gt;int read = 0;&lt;br/&gt;
try {&lt;br/&gt;
read = inf.inflate(buffer, start, length);&lt;br/&gt;
} catch (DataFormatException e) {&lt;br/&gt;
throw new ZipException(e.getMessage());&lt;br/&gt;
}&lt;br/&gt;
if (read == 0) {&lt;br/&gt;
if (inf.finished()) {&lt;br/&gt;
return -1;&lt;br/&gt;
} else if (buf.lengthOfLastRead == -1) {&lt;br/&gt;
throw new IOException(&quot;Truncated ZIP file&quot;);&lt;br/&gt;
}&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;can return 0&lt;br/&gt;
&quot;A return value of 0 indicates that needsInput() or needsDictionary() should be called in order to determine if more input data or a preset dictionary is required.&quot;&lt;/p&gt;

&lt;p&gt;The assumedly correct implementation in InflaterInputStream:&lt;/p&gt;

&lt;p&gt;int n;&lt;br/&gt;
while ((n = inf.inflate(b, off, len)) == 0) {&lt;br/&gt;
if (inf.finished() || inf.needsDictionary()) {&lt;br/&gt;
reachEOF = true;&lt;br/&gt;
return -1;&lt;br/&gt;
}&lt;br/&gt;
if (inf.needsInput()) {&lt;br/&gt;
fill();&lt;br/&gt;
}&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;calls the method in a while loop to avoid this problem.&lt;/p&gt;</comment>
                            <comment id="13498834" author="dma_k" created="Fri, 16 Nov 2012 14:24:57 +0000"  >&lt;p&gt;I confirm the problem. I agree that &lt;tt&gt;java.util.zip.Inflater&lt;/tt&gt; is not used according to JavaDocs and that causes the problem in some cases.&lt;/p&gt;</comment>
                            <comment id="13540373" author="bodewig" created="Fri, 28 Dec 2012 06:55:18 +0000"  >&lt;p&gt;Many thanks for the analysis.&lt;/p&gt;

&lt;p&gt;fixed with svn revision 1426417.&lt;/p&gt;

&lt;p&gt;Can we ship the test ZIP as part of Commons Compress&apos; source distribution under the Apache License or does it contain sensitive information?&lt;/p&gt;

&lt;p&gt;Your original code works if you use the stream directly without a BufferedInputStream, BTW.&lt;/p&gt;</comment>
                            <comment id="13541130" author="dan2097" created="Sun, 30 Dec 2012 18:32:01 +0000"  >&lt;p&gt;Yes you can include the test ZIP in Commons Compress. I believe the content is in the public domain as it comes from the USPTO patent database.&lt;br/&gt;
Thanks for fixing this!&lt;/p&gt;

&lt;p&gt;On an unrelated topic, I&apos;ve added the exact changes required to fix &lt;a href=&quot;https://issues.apache.org/jira/browse/COMPRESS-205&quot; title=&quot;Unit tests can fail when path to project is non-trivial (fix in description)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COMPRESS-205&quot;&gt;&lt;del&gt;COMPRESS-205&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13541346" author="bodewig" created="Mon, 31 Dec 2012 11:44:54 +0000"  >&lt;p&gt;Hmm, I&apos;ll look around the website in time before the next release to asses whether it really is suitable to be included.  Maybe there is an easy way to create a similar testcase ourselves.&lt;/p&gt;

&lt;p&gt;As for &lt;a href=&quot;https://issues.apache.org/jira/browse/COMPRESS-205&quot; title=&quot;Unit tests can fail when path to project is non-trivial (fix in description)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COMPRESS-205&quot;&gt;&lt;del&gt;COMPRESS-205&lt;/del&gt;&lt;/a&gt;, I&apos;ve seen it - it will take some time until I get to it.&lt;/p&gt;</comment>
                            <comment id="13544696" author="bodewig" created="Sat, 5 Jan 2013 13:09:13 +0000"  >&lt;blockquote&gt;
&lt;p&gt;The U.S. Patent and Trademark Office (USPTO), a non-commercial federal entity, provides electronic data products as one method of information dissemination.  There are no restrictions on the use of the data in these products, unless otherwise prohibited by law or specific agreement.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;in &lt;a href=&quot;http://www.uspto.gov/products/catalog/termsandconditions.doc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.uspto.gov/products/catalog/termsandconditions.doc&lt;/a&gt; linked from &lt;a href=&quot;http://www.uspto.gov/products/catalog/index.jsp&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.uspto.gov/products/catalog/index.jsp&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ve added the zip as a testcase.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>244848</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 46 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i05u8v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31997</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>