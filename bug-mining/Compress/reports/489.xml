<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:36:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[COMPRESS-686] Compression into BZip2 format has unexpected end of file when using a BufferedOutputStream</title>
                <link>https://issues.apache.org/jira/browse/COMPRESS-686</link>
                <project id="12310904" key="COMPRESS">Commons Compress</project>
                    <description>&lt;h3&gt;&lt;a name=&quot;Problem&quot;&gt;&lt;/a&gt;Problem&lt;/h3&gt;

&lt;p&gt;When a file gets compressed into BZip2 format using class &lt;b&gt;BZip2CompressorOutputStream&lt;/b&gt; then the format of the file is not valid.&lt;/p&gt;

&lt;p&gt;This can be proven trying to decompress the compressed file as it will fail with an error. For example using the &lt;em&gt;bzip2&lt;/em&gt; tool raises &quot;bzip2: Compressed file ends unexpectedly;&quot; while this &lt;em&gt;library&lt;/em&gt; returns error message &quot;IO Stream is not in the BZip2 format&quot;.&lt;/p&gt;

&lt;p&gt;For larger files one can see the last part (block?) of the file doesn&apos;t get written to the compressed output. Small files remain empty.&lt;/p&gt;

&lt;h3&gt;&lt;a name=&quot;Reproduction&quot;&gt;&lt;/a&gt;Reproduction&lt;/h3&gt;

&lt;p&gt;The error can be reproduced by running the following Java test on version 1.27.0. This test does not fail against older versions (e.g. 1.26.2).&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.io.IOException: Stream is not in the BZip2 format

	at org.apache.commons.compress.compressors.bzip2.BZip2CompressorInputStream.init(BZip2CompressorInputStream.java:545)
	at org.apache.commons.compress.compressors.bzip2.BZip2CompressorInputStream.&amp;lt;init&amp;gt;(BZip2CompressorInputStream.java:282)
	at org.apache.commons.compress.compressors.bzip2.BZip2CompressorInputStream.&amp;lt;init&amp;gt;(BZip2CompressorInputStream.java:266)
	at net.ripe.rirstats.service.ArchiveServiceTest.decompressBzip2File(ArchiveServiceTest.java:56)
	at net.ripe.rirstats.service.ArchiveServiceTest.shouldCompressAndDecompressCorrectly(ArchiveServiceTest.java:30)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;import org.apache.commons.compress.compressors.bzip2.BZip2CompressorInputStream;
import org.apache.commons.compress.compressors.bzip2.BZip2CompressorOutputStream;
import org.junit.jupiter.api.Test;

import java.io.BufferedOutputStream;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.nio.file.StandardOpenOption;

import static org.junit.jupiter.api.Assertions.assertEquals;

class ArchiveServiceTest {

    @Test
    void shouldCompressAndDecompressCorrectly() throws Exception {
        Path tmpDir = Files.createTempDirectory(&quot;compressionTest&quot;);
        Path file = Path.of(tmpDir.toString(), &quot;test.txt&quot;);
        var contents = &quot;random contents&quot;;
        Files.writeString(file, contents, StandardOpenOption.CREATE);

        Path compressedFile = compressFile(file);
        Path decompressedFile = decompressBzip2File(compressedFile);

        String actual = Files.readString(decompressedFile);
        assertEquals(contents, actual);
    }

    private static Path compressFile(Path file) throws IOException {
        Path newFile = Paths.get(file.getParent().toString(), file.getFileName().toString() + &quot;.bz2&quot;);
        try (InputStream in = Files.newInputStream(file);
             BZip2CompressorOutputStream bzOut = new BZip2CompressorOutputStream(
                    new BufferedOutputStream(
                            Files.newOutputStream(newFile)))) {

            final byte[] buffer = new byte[4096];
            int n;
            while ((n = in.read(buffer)) != -1) {
                bzOut.write(buffer, 0, n);
            }
        }
        return newFile;
    }

    private static Path decompressBzip2File(Path file) throws IOException {
        Path decompressedFile = Paths.get(file.getParent().toString(), file.getFileName().toString() + &quot;.decompressed&quot;);

        try (InputStream fileInputStream = new FileInputStream(file.toFile());
             BZip2CompressorInputStream bzIn = new BZip2CompressorInputStream(fileInputStream);
             OutputStream fileOutputStream = new FileOutputStream(decompressedFile.toFile())) {

            final byte[] buffer = new byte[4096];
            int n;
            while ((n = bzIn.read(buffer)) != -1) {
                fileOutputStream.write(buffer, 0, n);
            }
        }
        return decompressedFile;
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13588843">COMPRESS-686</key>
            <summary>Compression into BZip2 format has unexpected end of file when using a BufferedOutputStream</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ggregory">Gary D. Gregory</assignee>
                                    <reporter username="richard.blank">Richard Blank</reporter>
                        <labels>
                    </labels>
                <created>Wed, 14 Aug 2024 12:25:35 +0000</created>
                <updated>Fri, 27 Dec 2024 14:35:28 +0000</updated>
                            <resolved>Fri, 27 Dec 2024 14:35:28 +0000</resolved>
                                    <version>1.27.0</version>
                                    <fixVersion>1.28.0</fixVersion>
                                    <component>Compressors</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17873521" author="garydgregory" created="Wed, 14 Aug 2024 13:06:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=richard.blank&quot; class=&quot;user-hover&quot; rel=&quot;richard.blank&quot;&gt;richard.blank&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thank you for you report.&lt;/p&gt;

&lt;p&gt;It looks like we are missing a unit test for this use case. I&apos;ll take a look over the next day or two.&lt;/p&gt;</comment>
                            <comment id="17873551" author="garydgregory" created="Wed, 14 Aug 2024 14:06:38 +0000"  >&lt;p&gt;Hm, if you want a quick fix for now, you can remove the buffering like this:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/commons-compress/blob/master/src/test/java/org/apache/commons/compress/compressors/bzip2/Compress686Test.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/blob/master/src/test/java/org/apache/commons/compress/compressors/bzip2/Compress686Test.java&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="17873959" author="garydgregory" created="Thu, 15 Aug 2024 13:38:29 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=richard.blank&quot; class=&quot;user-hover&quot; rel=&quot;richard.blank&quot;&gt;richard.blank&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;This is now fixed in git master and snapshot builds in &lt;a href=&quot;https://repository.apache.org/content/repositories/snapshots/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/repositories/snapshots/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Please verify and close this ticket if your use case succeeds.&lt;/p&gt;

&lt;p&gt;TY!&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17874216" author="JIRAUSER306566" created="Fri, 16 Aug 2024 12:22:46 +0000"  >&lt;p&gt;Perfect! Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggregory&quot; class=&quot;user-hover&quot; rel=&quot;ggregory&quot;&gt;ggregory&lt;/a&gt; for fixing this swiftly &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17874236" author="garydgregory" created="Fri, 16 Aug 2024 12:37:30 +0000"  >&lt;p&gt;YW &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=richard.blank&quot; class=&quot;user-hover&quot; rel=&quot;richard.blank&quot;&gt;richard.blank&lt;/a&gt;! &#128512;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 12 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1qv1c:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>