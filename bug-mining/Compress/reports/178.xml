<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:31:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[COMPRESS-301] Illegal argument exception when extracting .tgz file </title>
                <link>https://issues.apache.org/jira/browse/COMPRESS-301</link>
                <project id="12310904" key="COMPRESS">Commons Compress</project>
                    <description>&lt;p&gt;When attempting to unpack a .tgz file, I am receiving the illegal argument exception: java.lang.IllegalArgumentException: Invalid byte 0 at offset 5 in &apos;05412&lt;/p&gt;
{NUL}11&apos; len=8. This is causing a java.io.IOException: Error detected parsing the header error. &lt;br/&gt;
&lt;br/&gt;
This is being thrown when the function TarArchiveInputStream.getNextTarEntry() is called. &lt;br/&gt;
&lt;br/&gt;
Here is the code I am using. &lt;br/&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;            TarArchiveInputStream tarIn = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TarArchiveInputStream(
                    &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GZIPInputStream(
                            &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BufferedInputStream(
                                    &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileInputStream(
                                            tempDirPath + fileName))));

            TarArchiveEntry entry = tarIn.getNextTarEntry();

            &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (entry != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                File path = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(tempDirPath, entry.getName());
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (entry.isDirectory()) {
                    path.mkdirs();
                } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {          
                    path.createNewFile();
                    &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] read = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[2048];
                    BufferedOutputStream bout = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BufferedOutputStream(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileOutputStream(path));
                    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; len;
                    &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; ((len = tarIn.read(read)) != -1) {
                        bout.write(read, 0, len);
                        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.print(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;(read, &lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;));
                    }
                    bout.close();
                    read = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
                }
                entry = tarIn.getNextTarEntry();
            }
            tarIn.close();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;br/&gt;
&lt;br/&gt;
Here is the full stack trace: &lt;br/&gt;
&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2015-02-12T23:17:31.944+0000&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;glassfish 4.0&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;SEVERE&amp;#93;&lt;/span&gt; [] [] &lt;span class=&quot;error&quot;&gt;&amp;#91;tid: _ThreadID=123 _ThreadName=Thread-4&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;timeMillis: 1423783051944&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;levelValue: 1000&amp;#93;&lt;/span&gt; [[&lt;br/&gt;
  java.io.IOException: Error detected parsing the header&lt;br/&gt;
        at org.apache.commons.compress.archivers.tar.TarArchiveInputStream.getNextTarEntry(TarArchiveInputStream.java:257)&lt;br/&gt;
        at org.unavco.ws.tilt.ExtractTiltFile.extractFile(ExtractTiltFile.java:125)&lt;br/&gt;
        at org.unavco.ws.tilt.ExtractTiltFile.run(ExtractTiltFile.java:59)&lt;br/&gt;
        at org.unavco.ws.cache.ProcessDataFile.getFileData(ProcessDataFile.java:100)&lt;br/&gt;
        at org.unavco.ws.cache.ProcessDataFile.getResultSet(ProcessDataFile.java:81)&lt;br/&gt;
        at org.unavco.ws.tilt.TiltDsClient.write(TiltDsClient.java:47)&lt;br/&gt;
        at org.glassfish.jersey.message.internal.StreamingOutputProvider.writeTo(StreamingOutputProvider.java:76)&lt;br/&gt;
        at org.glassfish.jersey.message.internal.StreamingOutputProvider.writeTo(StreamingOutputProvider.java:58)&lt;br/&gt;
        at org.glassfish.jersey.message.internal.WriterInterceptorExecutor$TerminalWriterInterceptor.aroundWriteTo(WriterInterceptorExecutor.java:194)&lt;br/&gt;
        at org.glassfish.jersey.message.internal.WriterInterceptorExecutor.proceed(WriterInterceptorExecutor.java:139)&lt;br/&gt;
        at org.glassfish.jersey.server.internal.JsonWithPaddingInterceptor.aroundWriteTo(JsonWithPaddingInterceptor.java:103)&lt;br/&gt;
        at org.glassfish.jersey.message.internal.WriterInterceptorExecutor.proceed(WriterInterceptorExecutor.java:139)&lt;br/&gt;
        at org.glassfish.jersey.server.internal.MappableExceptionWrapperInterceptor.aroundWriteTo(MappableExceptionWrapperInterceptor.java:88)&lt;br/&gt;
        at org.glassfish.jersey.message.internal.WriterInterceptorExecutor.proceed(WriterInterceptorExecutor.java:139)&lt;br/&gt;
        at org.glassfish.jersey.message.internal.MessageBodyFactory.writeTo(MessageBodyFactory.java:1005)&lt;br/&gt;
        at org.glassfish.jersey.server.ServerRuntime$Responder.writeResponse(ServerRuntime.java:471)&lt;br/&gt;
        at org.glassfish.jersey.server.ServerRuntime$Responder.processResponse(ServerRuntime.java:333)&lt;br/&gt;
        at org.glassfish.jersey.server.ServerRuntime$Responder.process(ServerRuntime.java:323)&lt;br/&gt;
        at org.glassfish.jersey.server.ServerRuntime$1.run(ServerRuntime.java:227)&lt;br/&gt;
        at org.glassfish.jersey.internal.Errors$1.call(Errors.java:271)&lt;br/&gt;
        at org.glassfish.jersey.internal.Errors$1.call(Errors.java:267)&lt;br/&gt;
        at org.glassfish.jersey.internal.Errors.process(Errors.java:315)&lt;br/&gt;
        at org.glassfish.jersey.internal.Errors.process(Errors.java:297)&lt;br/&gt;
        at org.glassfish.jersey.internal.Errors.process(Errors.java:267)&lt;br/&gt;
        at org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:317)&lt;br/&gt;
        at org.glassfish.jersey.server.ServerRuntime.process(ServerRuntime.java:198)&lt;br/&gt;
        at org.glassfish.jersey.server.ApplicationHandler.handle(ApplicationHandler.java:946)&lt;br/&gt;
        at org.glassfish.jersey.servlet.WebComponent.service(WebComponent.java:323)&lt;br/&gt;
        at org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:372)&lt;br/&gt;
        at org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:335)&lt;br/&gt;
        at org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:218)&lt;br/&gt;
        at org.apache.catalina.core.StandardWrapper.service(StandardWrapper.java:1682)&lt;br/&gt;
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:344)&lt;br/&gt;
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:214)&lt;br/&gt;
        at com.thetransactioncompany.cors.CORSFilter.doFilter(Unknown Source)&lt;br/&gt;
        at com.thetransactioncompany.cors.CORSFilter.doFilter(Unknown Source)&lt;br/&gt;
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:256)&lt;br/&gt;
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:214)&lt;br/&gt;
        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:316)&lt;br/&gt;
        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:160)&lt;br/&gt;
        at org.apache.catalina.core.StandardPipeline.doInvoke(StandardPipeline.java:734)&lt;br/&gt;
        at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:673)&lt;br/&gt;
        at com.sun.enterprise.web.WebPipeline.invoke(WebPipeline.java:99)&lt;br/&gt;
        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:174)&lt;br/&gt;
        at org.apache.catalina.connector.CoyoteAdapter.doService(CoyoteAdapter.java:357)&lt;br/&gt;
        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:260)&lt;br/&gt;
        at com.sun.enterprise.v3.services.impl.ContainerMapper.service(ContainerMapper.java:188)&lt;br/&gt;
        at org.glassfish.grizzly.http.server.HttpHandler.runService(HttpHandler.java:191)&lt;br/&gt;
        at org.glassfish.grizzly.http.server.HttpHandler.doHandle(HttpHandler.java:168)&lt;br/&gt;
        at org.glassfish.grizzly.http.server.HttpServerFilter.handleRead(HttpServerFilter.java:189)&lt;br/&gt;
        at org.glassfish.grizzly.filterchain.ExecutorResolver$9.execute(ExecutorResolver.java:119)&lt;br/&gt;
        at org.glassfish.grizzly.filterchain.DefaultFilterChain.executeFilter(DefaultFilterChain.java:288)&lt;br/&gt;
        at org.glassfish.grizzly.filterchain.DefaultFilterChain.executeChainPart(DefaultFilterChain.java:206)&lt;br/&gt;
        at org.glassfish.grizzly.filterchain.DefaultFilterChain.execute(DefaultFilterChain.java:136)&lt;br/&gt;
        at org.glassfish.grizzly.filterchain.DefaultFilterChain.process(DefaultFilterChain.java:114)&lt;br/&gt;
        at org.glassfish.grizzly.ProcessorExecutor.execute(ProcessorExecutor.java:77)&lt;br/&gt;
        at org.glassfish.grizzly.nio.transport.TCPNIOTransport.fireIOEvent(TCPNIOTransport.java:838)&lt;br/&gt;
        at org.glassfish.grizzly.strategies.AbstractIOStrategy.fireIOEvent(AbstractIOStrategy.java:113)&lt;br/&gt;
        at org.glassfish.grizzly.strategies.WorkerThreadIOStrategy.run0(WorkerThreadIOStrategy.java:115)&lt;br/&gt;
        at org.glassfish.grizzly.strategies.WorkerThreadIOStrategy.access$100(WorkerThreadIOStrategy.java:55)&lt;br/&gt;
        at org.glassfish.grizzly.strategies.WorkerThreadIOStrategy$WorkerThreadRunnable.run(WorkerThreadIOStrategy.java:135)&lt;br/&gt;
        at org.glassfish.grizzly.threadpool.AbstractThreadPool$Worker.doWork(AbstractThreadPool.java:564)&lt;br/&gt;
        at org.glassfish.grizzly.threadpool.AbstractThreadPool$Worker.run(AbstractThreadPool.java:544)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:745)&lt;br/&gt;
Caused by: java.lang.IllegalArgumentException: Invalid byte 0 at offset 5 in &apos;05412{NUL}
&lt;p&gt;11&apos; len=8&lt;br/&gt;
        at org.apache.commons.compress.archivers.tar.TarUtils.parseOctal(TarUtils.java:138)&lt;br/&gt;
        at org.apache.commons.compress.archivers.tar.TarUtils.parseOctalOrBinary(TarUtils.java:169)&lt;br/&gt;
        at org.apache.commons.compress.archivers.tar.TarArchiveEntry.parseTarHeader(TarArchiveEntry.java:951)&lt;br/&gt;
        at org.apache.commons.compress.archivers.tar.TarArchiveEntry.parseTarHeader(TarArchiveEntry.java:940)&lt;br/&gt;
        at org.apache.commons.compress.archivers.tar.TarArchiveEntry.&amp;lt;init&amp;gt;(TarArchiveEntry.java:324)&lt;br/&gt;
        at org.apache.commons.compress.archivers.tar.TarArchiveInputStream.getNextTarEntry(TarArchiveInputStream.java:255)&lt;br/&gt;
        ... 63 more]]&lt;/p&gt;

</description>
                <environment>&lt;p&gt;Mac OSX 10.10.2&lt;/p&gt;</environment>
        <key id="12774970">COMPRESS-301</key>
            <summary>Illegal argument exception when extracting .tgz file </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Not A Problem</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="molnar">Collin Molnar</reporter>
                        <labels>
                    </labels>
                <created>Fri, 13 Feb 2015 17:47:36 +0000</created>
                <updated>Sun, 15 Feb 2015 14:25:35 +0000</updated>
                            <resolved>Fri, 13 Feb 2015 23:45:33 +0000</resolved>
                                    <version>1.8.1</version>
                    <version>1.9</version>
                                                    <component>Compressors</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14320447" author="molnar" created="Fri, 13 Feb 2015 17:49:42 +0000"  >&lt;p&gt;Example .tgz file with error. &lt;/p&gt;</comment>
                            <comment id="14320448" author="molnar" created="Fri, 13 Feb 2015 17:51:17 +0000"  >&lt;p&gt;Also this .tar file is made using a python script, with the tarfile library.   &lt;/p&gt;</comment>
                            <comment id="14320573" author="bodewig" created="Fri, 13 Feb 2015 19:02:17 +0000"  >&lt;p&gt;Thanks, Collin.  Can we distribute the file as a unit test resource?&lt;/p&gt;

&lt;p&gt;According to  the spec the number fields should be padded with NULs, looks as if the library just inserted a single NUL.  Our current implementations strips NULs starting at the right, which fails here.  It should be easy to fix by breaking out of the loop as soon as a NUL is detected.&lt;/p&gt;</comment>
                            <comment id="14320707" author="sebb@apache.org" created="Fri, 13 Feb 2015 20:31:54 +0000"  >&lt;p&gt;I don&apos;t see the Exception when running the code using current trunk.&lt;/p&gt;

&lt;p&gt;I tried both the code in the description (though I omitted writing any files) and the Lister class.&lt;br/&gt;
Both ran successfully.&lt;/p&gt;

&lt;p&gt;@Colin: Maybe you could try using the 1.10-SNAPSHOT build from the ASF snapshot repo:&lt;br/&gt;
&lt;a href=&quot;https://repository.apache.org/content/repositories/snapshots/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/repositories/snapshots/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Does this fail for your sample program?&lt;/p&gt;</comment>
                            <comment id="14320857" author="molnar" created="Fri, 13 Feb 2015 22:14:33 +0000"  >&lt;p&gt;Thank you Stefan and Sebb. It seems that my issue is when I&apos;m downloading the file using the commons.net.FTPClient, and it seems somehow when I download the file it is being corrupted. &lt;/p&gt;

&lt;p&gt;Frustratingly enough, the corrupted file is still a valid tar file so I assumed the issue with was compress. So I will have to see if I need to change the encoding of the client, or if I need to do something else.  &lt;/p&gt;</comment>
                            <comment id="14320989" author="sebb@apache.org" created="Fri, 13 Feb 2015 23:45:06 +0000"  >&lt;p&gt;Make sure you tell FTPClient to use binary mode when downloading.&lt;br/&gt;
Otherwise the file will be corrupted.&lt;br/&gt;
Also, when writing the file, ensure that you take account of the number of bytes read.&lt;br/&gt;
Your example code did not always do this correctly:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;bout.write(read, 0, len); &lt;span class=&quot;code-comment&quot;&gt;// OK
&lt;/span&gt;&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.print(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;(read, &lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;)); &lt;span class=&quot;code-comment&quot;&gt;// wrong, should be
&lt;/span&gt;&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.print(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;(read, 0, len, &lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14321248" author="bodewig" created="Sat, 14 Feb 2015 05:30:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sebb%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;sebb@apache.org&quot;&gt;sebb@apache.org&lt;/a&gt;, is this trunk after svn revision 1659649?  I&apos;ve already committed a provisional fix for this bug with that revision.&lt;/p&gt;</comment>
                            <comment id="14321250" author="bodewig" created="Sat, 14 Feb 2015 05:31:04 +0000"  >&lt;p&gt;I wouldn&apos;t close the bug as &quot;not a problem&quot; if command line tar can extract the archive but Commons Compress can&apos;t.&lt;/p&gt;</comment>
                            <comment id="14321327" author="bodewig" created="Sat, 14 Feb 2015 10:04:56 +0000"  >&lt;p&gt;The attached tar seem to work with 1.9 as well, I&apos;d really be interested in the corrupted tar if only to see what GNU tar does with it.&lt;/p&gt;</comment>
                            <comment id="14322000" author="sebb@apache.org" created="Sun, 15 Feb 2015 14:25:11 +0000"  >&lt;p&gt;I used 1659645&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12698768" name="P693.201212614Tilt.tgz" size="92909" author="molnar" created="Fri, 13 Feb 2015 17:49:42 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 39 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i25m1j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>