<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:30:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[COMPRESS-264] ZIP reads correctly with commons-compress 1.6, gives NUL bytes in 1.7</title>
                <link>https://issues.apache.org/jira/browse/COMPRESS-264</link>
                <project id="12310904" key="COMPRESS">Commons Compress</project>
                    <description>&lt;p&gt;When running the code below, commons-compress 1.6 writes:&lt;/p&gt;

&lt;p&gt; Content of test.txt:&lt;br/&gt;
 data&lt;/p&gt;

&lt;p&gt;By comparison, commons-compress 1.7 writes&lt;/p&gt;

&lt;p&gt; Content of test.txt:&lt;br/&gt;
 &lt;sup&gt;@&lt;/sup&gt;@&lt;sup&gt;@&lt;/sup&gt;@^@&lt;/p&gt;

&lt;p&gt;package com.example.jrn;&lt;br/&gt;
import org.apache.commons.compress.archivers.zip.ZipArchiveEntry;&lt;br/&gt;
import org.apache.commons.compress.archivers.zip.ZipArchiveInputStream;&lt;br/&gt;
import java.io.ByteArrayInputStream;&lt;br/&gt;
import java.io.IOException;&lt;br/&gt;
import java.lang.System;&lt;br/&gt;
/**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Hello world!&lt;br/&gt;
 *&lt;br/&gt;
 */&lt;br/&gt;
public class App {&lt;br/&gt;
  public static void main(String[] args) {&lt;br/&gt;
    byte[] zip = 
{
       (byte)0x50, (byte)0x4b, (byte)0x03, (byte)0x04, (byte)0x0a, (byte)0x00,
       (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x03, (byte)0x7b,
       (byte)0xd1, (byte)0x42, (byte)0x82, (byte)0xc5, (byte)0xc1, (byte)0xe6,
       (byte)0x05, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x05, (byte)0x00,
       (byte)0x00, (byte)0x00, (byte)0x08, (byte)0x00, (byte)0x1c, (byte)0x00,
       (byte)0x74, (byte)0x65, (byte)0x73, (byte)0x74, (byte)0x2e, (byte)0x74,
       (byte)0x78, (byte)0x74, (byte)0x55, (byte)0x54, (byte)0x09, (byte)0x00,
       (byte)0x03, (byte)0x56, (byte)0x62, (byte)0xbf, (byte)0x51, (byte)0x2a,
       (byte)0x63, (byte)0xbf, (byte)0x51, (byte)0x75, (byte)0x78, (byte)0x0b,
       (byte)0x00, (byte)0x01, (byte)0x04, (byte)0x01, (byte)0xff, (byte)0x01,
       (byte)0x00, (byte)0x04, (byte)0x88, (byte)0x13, (byte)0x00, (byte)0x00,
       (byte)0x64, (byte)0x61, (byte)0x74, (byte)0x61, (byte)0x0a, (byte)0x50,
       (byte)0x4b, (byte)0x01, (byte)0x02, (byte)0x1e, (byte)0x03, (byte)0x0a,
       (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x03,
       (byte)0x7b, (byte)0xd1, (byte)0x42, (byte)0x82, (byte)0xc5, (byte)0xc1,
       (byte)0xe6, (byte)0x05, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x05,
       (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x08, (byte)0x00, (byte)0x18,
       (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x01,
       (byte)0x00, (byte)0x00, (byte)0x00, (byte)0xa0, (byte)0x81, (byte)0x00,
       (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x74, (byte)0x65, (byte)0x73,
       (byte)0x74, (byte)0x2e, (byte)0x74, (byte)0x78, (byte)0x74, (byte)0x55,
       (byte)0x54, (byte)0x05, (byte)0x00, (byte)0x03, (byte)0x56, (byte)0x62,
       (byte)0xbf, (byte)0x51, (byte)0x75, (byte)0x78, (byte)0x0b, (byte)0x00,
       (byte)0x01, (byte)0x04, (byte)0x01, (byte)0xff, (byte)0x01, (byte)0x00,
       (byte)0x04, (byte)0x88, (byte)0x13, (byte)0x00, (byte)0x00, (byte)0x50,
       (byte)0x4b, (byte)0x05, (byte)0x06, (byte)0x00, (byte)0x00, (byte)0x00,
       (byte)0x00, (byte)0x01, (byte)0x00, (byte)0x01, (byte)0x00, (byte)0x4e,
       (byte)0x00, (byte)0x00, (byte)0x00, (byte)0x47, (byte)0x00, (byte)0x00,
       (byte)0x00, (byte)0x00, (byte)00
    }
&lt;p&gt;;&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    ByteArrayInputStream bin = new ByteArrayInputStream(zip);&lt;br/&gt;
    try {&lt;br/&gt;
      ZipArchiveInputStream in = new ZipArchiveInputStream(bin);&lt;br/&gt;
      try {&lt;br/&gt;
        while (true) {&lt;br/&gt;
          ZipArchiveEntry entry = in.getNextZipEntry();&lt;br/&gt;
          if (entry == null) &lt;/p&gt;
{
            break;
          }
&lt;p&gt;          byte[] buf = new byte&lt;span class=&quot;error&quot;&gt;&amp;#91;(int) entry.getSize()&amp;#93;&lt;/span&gt;;&lt;br/&gt;
          in.read(buf);&lt;br/&gt;
          System.out.println(&quot;Content of &quot; + entry.getName() + &quot;:&quot;);&lt;br/&gt;
          System.out.write(buf);&lt;br/&gt;
        }&lt;br/&gt;
      } finally &lt;/p&gt;
{
        in.close();
      }
&lt;p&gt;    } catch (IOException e) &lt;/p&gt;
{
      System.err.println(&quot;IOException: &quot; + e);
    }
&lt;p&gt;  }&lt;br/&gt;
}&lt;/p&gt;</description>
                <environment>&lt;p&gt;Ubuntu precise&lt;/p&gt;</environment>
        <key id="12696139">COMPRESS-264</key>
            <summary>ZIP reads correctly with commons-compress 1.6, gives NUL bytes in 1.7</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jrn">Jonathan Nieder</reporter>
                        <labels>
                    </labels>
                <created>Thu, 20 Feb 2014 01:57:16 +0000</created>
                <updated>Sat, 1 Mar 2014 05:59:13 +0000</updated>
                            <resolved>Fri, 21 Feb 2014 14:22:56 +0000</resolved>
                                    <version>1.7</version>
                                    <fixVersion>1.8</fixVersion>
                                    <component>Archivers</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13906759" author="bodewig" created="Thu, 20 Feb 2014 08:39:30 +0000"  >&lt;p&gt;I haven&apos;t tested whether there actually is a bug - I will do so.&lt;/p&gt;

&lt;p&gt;But from looking at your code you expect &lt;tt&gt;in.read()&lt;/tt&gt; to read the entire content without checking the return code (how many bytes have been read).  If you change the code to repeat reading until read returns -1 - for example using &lt;tt&gt;IOUtils.readFully&lt;/tt&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; - does it then still not read the full contents of your entry?&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;  &lt;a href=&quot;http://commons.apache.org/proper/commons-compress/javadocs/api-1.7/org/apache/commons/compress/utils/IOUtils.html#readFully%28java.io.InputStream,%20byte[]%29&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://commons.apache.org/proper/commons-compress/javadocs/api-1.7/org/apache/commons/compress/utils/IOUtils.html#readFully%28java.io.InputStream,%20byte[]%29&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13907270" author="jrn" created="Thu, 20 Feb 2014 18:19:15 +0000"  >&lt;p&gt;The reading actually reads 5 bytes &amp;#8212; in 1.6, those five bytes are &quot;data\n&quot;, while in 1.7 they are NUL bytes. This happens whether I call read() once or in a loop until read returns -1.&lt;/p&gt;</comment>
                            <comment id="13907978" author="bodewig" created="Fri, 21 Feb 2014 05:34:43 +0000"  >&lt;p&gt;I can confirm I get the same error myself.&lt;/p&gt;</comment>
                            <comment id="13908297" author="bodewig" created="Fri, 21 Feb 2014 13:32:20 +0000"  >&lt;p&gt;I&apos;ve turned your example into a unit test with svn revision 1570567 &lt;/p&gt;

&lt;p&gt;As a workaround it might help you to know that ZipFile works as expected in 1.7.&lt;/p&gt;</comment>
                            <comment id="13908353" author="bodewig" created="Fri, 21 Feb 2014 14:22:56 +0000"  >&lt;p&gt;fixed with svn revision 1570582&lt;/p&gt;

&lt;p&gt;The exact error condition:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;you are reading the very first entry of the archive&lt;/li&gt;
	&lt;li&gt;the entry uses the STORED method&lt;/li&gt;
	&lt;li&gt;the entry knows its size&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;any subsequent entry will work&lt;/p&gt;</comment>
                            <comment id="13908551" author="jrn" created="Fri, 21 Feb 2014 17:29:12 +0000"  >&lt;p&gt;Thanks! Confirmed - the fix works well.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12698041">COMPRESS-268</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>374616</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 39 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1sk1b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>374916</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>