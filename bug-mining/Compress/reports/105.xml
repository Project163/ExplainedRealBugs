<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:30:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[COMPRESS-212] TarArchiveEntry getName() returns wrongly encoded name even when you set encoding to TarArchiveInputStream</title>
                <link>https://issues.apache.org/jira/browse/COMPRESS-212</link>
                <project id="12310904" key="COMPRESS">Commons Compress</project>
                    <description>&lt;p&gt;I have two file systems. One is Red Hat Linux, the other is MS Windows.&lt;br/&gt;
I created a *.tgz file in Red Hat Linux and tried to decompress it in MS Windows using Commons Compress.&lt;br/&gt;
The default system encoding are different. UTF-8 in Red Hat Linux and CP949 in MS Windows.&lt;br/&gt;
It seems that the file name encoding follows the default encoding even though when I use the following to untar it.&lt;/p&gt;

&lt;p&gt;FileInputStream fis = new FileInputStream(new File(*.tgz));&lt;br/&gt;
TarArchiveInputStream zis = new TarArchiveInputStream(new BufferedInputStream(fis),encodingOfRedHatLinux);&lt;/p&gt;

&lt;p&gt;while ((entry = (TarArchiveEntry)zis.getNextEntry()) != null)&lt;br/&gt;
{&lt;br/&gt;
entry.getName(); // filename is not UTF-8 it is encoded in CP949 and so the filename isn&apos;t consistent&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;By referring to this&lt;/p&gt;

&lt;p&gt;    /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Constructor for TarInputStream.&lt;/li&gt;
	&lt;li&gt;@param is the input stream to use&lt;/li&gt;
	&lt;li&gt;@param encoding name of the encoding to use for file names&lt;/li&gt;
	&lt;li&gt;@since Commons Compress 1.4&lt;br/&gt;
     */&lt;br/&gt;
    public TarArchiveInputStream(InputStream is, String encoding) 
{
        this(is, TarBuffer.DEFAULT_BLKSIZE, TarBuffer.DEFAULT_RCDSIZE, encoding);
    }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;encoding should be used for file names.&lt;br/&gt;
But actually this doesn&apos;t seem to work.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Red Hat Enterprise Linux, MS Windows 7&lt;/p&gt;</environment>
        <key id="12625754">COMPRESS-212</key>
            <summary>TarArchiveEntry getName() returns wrongly encoded name even when you set encoding to TarArchiveInputStream</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="wooju.shin">Woo Ju Shin</reporter>
                        <labels>
                    </labels>
                <created>Thu, 3 Jan 2013 00:26:49 +0000</created>
                <updated>Sun, 6 Jan 2013 23:37:16 +0000</updated>
                            <resolved>Fri, 4 Jan 2013 16:00:40 +0000</resolved>
                                    <version>1.4.1</version>
                                    <fixVersion>1.5</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13543039" author="bodewig" created="Thu, 3 Jan 2013 16:33:46 +0000"  >&lt;p&gt;Just a few quick questions:&lt;/p&gt;

&lt;p&gt;How has the original archive been created?  When reading the archive, how do you sepcify the encoding exactly?  &quot;utf-8&quot;?&lt;/p&gt;</comment>
                            <comment id="13543402" author="wooju.shin" created="Thu, 3 Jan 2013 23:15:02 +0000"  >&lt;p&gt;The archive is created on Red Hat Linux using tar command. The files that are included in this archive is created by cat command with an argument for filename which is encoded in &quot;UTF-8&quot;. And also the system default encoding is specified to be &quot;UTF-8&quot;.&lt;/p&gt;</comment>
                            <comment id="13543410" author="wooju.shin" created="Thu, 3 Jan 2013 23:28:14 +0000"  >&lt;p&gt;I have tried a workaround to this.&lt;br/&gt;
Next code is getNextTarEntry() of TarArchiveInputStream.java.&lt;/p&gt;

&lt;p&gt;    /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Get the next entry in this tar archive. This will skip&lt;/li&gt;
	&lt;li&gt;over any remaining data in the current entry, if there&lt;/li&gt;
	&lt;li&gt;is one, and place the input stream at the header of the&lt;/li&gt;
	&lt;li&gt;next entry, and read the header and instantiate a new&lt;/li&gt;
	&lt;li&gt;TarEntry from the header bytes and return that entry.&lt;/li&gt;
	&lt;li&gt;If there are no more entries in the archive, null will&lt;/li&gt;
	&lt;li&gt;be returned to indicate that the end of the archive has&lt;/li&gt;
	&lt;li&gt;been reached.&lt;br/&gt;
     *&lt;/li&gt;
	&lt;li&gt;@return The next TarEntry in the archive, or null.&lt;/li&gt;
	&lt;li&gt;@throws IOException on error&lt;br/&gt;
     */&lt;br/&gt;
    public TarArchiveEntry getNextTarEntry() throws IOException {&lt;br/&gt;
        if (hasHitEOF) 
{
            return null;
        }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;        if (currEntry != null) {&lt;br/&gt;
            long numToSkip = entrySize - entryOffset;&lt;/p&gt;

&lt;p&gt;            while (numToSkip &amp;gt; 0) {&lt;br/&gt;
                long skipped = skip(numToSkip);&lt;br/&gt;
                if (skipped &amp;lt;= 0) &lt;/p&gt;
{
                    throw new RuntimeException(&quot;failed to skip current tar entry&quot;);
                }
&lt;p&gt;                numToSkip -= skipped;&lt;br/&gt;
            }&lt;/p&gt;

&lt;p&gt;            readBuf = null;&lt;br/&gt;
        }&lt;/p&gt;

&lt;p&gt;        byte[] headerBuf = getRecord();&lt;/p&gt;

&lt;p&gt;        if (hasHitEOF) &lt;/p&gt;
{
            currEntry = null;
            return null;
        }

&lt;p&gt;        try &lt;/p&gt;
{
            currEntry = new TarArchiveEntry(headerBuf, encoding);
        }
&lt;p&gt; catch (IllegalArgumentException e) &lt;/p&gt;
{
            IOException ioe = new IOException(&quot;Error detected parsing the header&quot;);
            ioe.initCause(e);
            throw ioe;
        }
&lt;p&gt;        entryOffset = 0;&lt;br/&gt;
        entrySize = currEntry.getSize();&lt;/p&gt;

&lt;p&gt;        if (currEntry.isGNULongNameEntry()) {&lt;br/&gt;
            // read in the name&lt;br/&gt;
            StringBuffer longName = new StringBuffer();&lt;br/&gt;
            byte[] buf = new byte&lt;span class=&quot;error&quot;&gt;&amp;#91;SMALL_BUFFER_SIZE&amp;#93;&lt;/span&gt;;&lt;br/&gt;
            int length = 0;&lt;br/&gt;
            while ((length = read(buf)) &amp;gt;= 0) &lt;/p&gt;
{
                longName.append(new String(buf, 0, length)); // TODO default charset?
            }
&lt;p&gt;            getNextEntry();&lt;br/&gt;
            if (currEntry == null) &lt;/p&gt;
{
                // Bugzilla: 40334
                // Malformed tar file - long entry name not followed by entry
                return null;
            }
&lt;p&gt;            // remove trailing null terminator&lt;br/&gt;
            if (longName.length() &amp;gt; 0&lt;br/&gt;
                &amp;amp;&amp;amp; longName.charAt(longName.length() - 1) == 0) &lt;/p&gt;
{
                longName.deleteCharAt(longName.length() - 1);
            }
&lt;p&gt;            currEntry.setName(longName.toString());&lt;br/&gt;
        }&lt;/p&gt;

&lt;p&gt;        if (currEntry.isPaxHeader())&lt;/p&gt;
{ // Process Pax headers
            paxHeaders();
        }

&lt;p&gt;        if (currEntry.isGNUSparse())&lt;/p&gt;
{ // Process sparse files
            readGNUSparse();
        }

&lt;p&gt;        // If the size of the next element in the archive has changed&lt;br/&gt;
        // due to a new size being reported in the posix header&lt;br/&gt;
        // information, we update entrySize here so that it contains&lt;br/&gt;
        // the correct value.&lt;br/&gt;
        entrySize = currEntry.getSize();&lt;br/&gt;
        return currEntry;&lt;br/&gt;
    }&lt;/p&gt;

&lt;p&gt;There&apos;s a comment &apos;//TODO default charset?&apos;.&lt;br/&gt;
This part seems to neglect the encoding set to TarArchiveInputStream().&lt;br/&gt;
I tried to get the encoding that I first set to TarArchiveInputStream() and constructed the filename in one byte[] variable, and then used the encoding to change the byte[] variable to String so that it could be set to entry by entry.setName().&lt;/p&gt;

&lt;p&gt;This workaround works well for now. But obviously I need more tests to be done.&lt;br/&gt;
I&apos;ll be trying more tests until next week.&lt;/p&gt;</comment>
                            <comment id="13543645" author="bodewig" created="Fri, 4 Jan 2013 06:51:44 +0000"  >&lt;p&gt;OK, so your tar is using GNU long name entries, I see.  I&apos;ll read up on GNU&apos;s spec whether they say anything about encoding for them (it might turn out it always uses UTF8).  Hmm, when we write GNU long name records we use the encoding that has been specified, so we certainly are not consistent.&lt;/p&gt;

&lt;p&gt;Thank you for the analysis.&lt;/p&gt;</comment>
                            <comment id="13543974" author="bodewig" created="Fri, 4 Jan 2013 16:00:40 +0000"  >&lt;p&gt;fixed with svn revision 1428942&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="13545526" author="wooju.shin" created="Sun, 6 Jan 2013 23:37:16 +0000"  >&lt;p&gt;Wow! Brilliant.&lt;br/&gt;
I used your fix to do some tests and it just works fine.&lt;br/&gt;
Thank you very much.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>302303</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 45 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1700n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>248970</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>