<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:29:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[COMPRESS-94] Creating zip files with many entries will ocassionally produce corrupted output</title>
                <link>https://issues.apache.org/jira/browse/COMPRESS-94</link>
                <project id="12310904" key="COMPRESS">Commons Compress</project>
                    <description>&lt;p&gt;Our application produces large numbers of zip files, often with 1000&apos;s of similarly named files contained within the zip. &lt;br/&gt;
When we switched from the standard JDK zip classes to those in commons compress, we would ocassionally produce a zip file that had corrupted index entries and would fail to unzip successfully using 7-zip, winzip, etc.&lt;/p&gt;

&lt;p&gt;Debugging the zip creation showed that the the wrong offsets were being returned from the hashmap in ZipOutputStream for the entries that were being corrupted.  Further analysis revealed that this occurred when the filenames being added had a hash collision with another entry in the same output zip (which appears to happen quite frequently for us).&lt;/p&gt;

&lt;p&gt;The issue appears to stem from the fact that ZipArchiveEntry can store the entry name either in its superclass if passed in on the ctor or in its own member attribute if set later via setName().  Not sure whether this functionality is really required?  Regardless, the root cause of the bug is that the equals() and hashCode() methods in ZipArchiveEntry do not always use the same filename value in their comparisons.  In fact if the filename of the entry is set in the ctor it will always treat two ZipArchiveEntries as equal.  This will break the offset hashmap whenever there is a hash collision as it will overwrite the previous entry, believeing it to be equal.&lt;/p&gt;

&lt;p&gt;Patch to follow.&lt;/p&gt;
</description>
                <environment>&lt;p&gt;Windows 2003 Server 64 bit, Java 6.0&lt;/p&gt;</environment>
        <key id="12444848">COMPRESS-94</key>
            <summary>Creating zip files with many entries will ocassionally produce corrupted output</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bodewig">Stefan Bodewig</assignee>
                                    <reporter username="anon.devs">Anon Devs</reporter>
                        <labels>
                    </labels>
                <created>Wed, 6 Jan 2010 22:33:15 +0000</created>
                <updated>Tue, 26 Jan 2010 05:25:02 +0000</updated>
                            <resolved>Tue, 26 Jan 2010 05:25:02 +0000</resolved>
                                    <version>1.0</version>
                                    <fixVersion>1.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12797367" author="anon.devs" created="Wed, 6 Jan 2010 22:42:40 +0000"  >&lt;p&gt;Patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/COMPRESS-94&quot; title=&quot;Creating zip files with many entries will ocassionally produce corrupted output&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COMPRESS-94&quot;&gt;&lt;del&gt;COMPRESS-94&lt;/del&gt;&lt;/a&gt; to fix the equals() implementation in ZipArchiveEntry.&lt;/p&gt;</comment>
                            <comment id="12797570" author="bodewig" created="Thu, 7 Jan 2010 09:37:08 +0000"  >&lt;p&gt;Good catch! Many thanks.&lt;/p&gt;

&lt;p&gt;svn revision 896818 contains an extended version of your patch (which came in just in time to allow me to merge it into Ant&apos;s codebase before the 1.8.0 release, great).&lt;/p&gt;</comment>
                            <comment id="12797573" author="bodewig" created="Thu, 7 Jan 2010 09:49:54 +0000"  >&lt;p&gt;Ant&apos;s codebase didn&apos;t have the same problem since Ant&apos;s ZipEntry class has a completely different implementation of equals (basically Object#equals).&lt;/p&gt;

&lt;p&gt;I&apos;m not convinced that CC&apos;s equals implementation is a good idea since it only takes an entry&apos;s name into account and nothing else (size, extra fields, compression mode, last modified date and all that).&lt;/p&gt;</comment>
                            <comment id="12804894" author="bodewig" created="Tue, 26 Jan 2010 05:25:02 +0000"  >&lt;p&gt;ZipArchiveEntry#equals should now compare all data.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12429590" name="COMPRESS-94.patch" size="1638" author="anon.devs" created="Wed, 6 Jan 2010 22:42:39 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>110596</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 43 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0b4k7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>62851</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>