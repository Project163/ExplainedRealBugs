<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:34:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[COMPRESS-552] OSGI check broken - try to load class BundleEvent always fails</title>
                <link>https://issues.apache.org/jira/browse/COMPRESS-552</link>
                <project id="12310904" key="COMPRESS">Commons Compress</project>
                    <description>&lt;p&gt;There is a check for running in OSGI env. in &lt;tt&gt;ZstdUtils&lt;/tt&gt;, &lt;tt&gt;BrotliUtils&lt;/tt&gt;, &lt;tt&gt;LZMAUtils&lt;/tt&gt; and &lt;tt&gt;XZUtils&lt;/tt&gt; like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; {
    cachedZstdAvailability = CachedAvailability.DONT_CACHE;
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName(&lt;span class=&quot;code-quote&quot;&gt;&quot;org.osgi.framework.BundleEvent&quot;&lt;/span&gt;);
    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Exception ex) { &lt;span class=&quot;code-comment&quot;&gt;// NOSONAR
&lt;/span&gt;        setCacheZstdAvailablity(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Loading the class &lt;tt&gt;org.osgi.framework.BundleEvent&lt;/tt&gt; always fails because &lt;tt&gt;Import-Package&lt;/tt&gt; directive for &lt;tt&gt;org.osgi.framework&lt;/tt&gt; is missing in &lt;em&gt;MANIFEST.MF&lt;/em&gt;. Or it requires another more sophisticated approaches (&lt;a href=&quot;https://stackoverflow.com/q/5879040/1061929&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://stackoverflow.com/q/5879040/1061929&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;Tested with Eclipse 4.14 (org.eclipse.osgi_3.15.100.v20191114-1701.jar)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13324476">COMPRESS-552</key>
            <summary>OSGI check broken - try to load class BundleEvent always fails</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="mtomcat_daobi">Bj&#246;rn Michael</reporter>
                        <labels>
                    </labels>
                <created>Tue, 25 Aug 2020 13:17:29 +0000</created>
                <updated>Mon, 17 May 2021 10:44:12 +0000</updated>
                            <resolved>Mon, 17 May 2021 10:44:12 +0000</resolved>
                                    <version>1.20</version>
                                    <fixVersion>1.21</fixVersion>
                                    <component>Compressors</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17189186" author="peterlee" created="Wed, 2 Sep 2020 12:02:47 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mtomcat_daobi&quot; class=&quot;user-hover&quot; rel=&quot;mtomcat_daobi&quot;&gt;mtomcat_daobi&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Could you provide some test to reproduce this problem? And a PR in github is welcome. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17296638" author="bodewig" created="Sat, 6 Mar 2021 20:01:57 +0000"  >&lt;p&gt;I&apos;m afraid the accepted answer of the StackOverflow question would suffer from the same problem (&lt;tt&gt;FrameworkUtil&lt;/tt&gt; probably isn&apos;t available either). So the only way out would be a Bundle-Activator?&lt;/p&gt;</comment>
                            <comment id="17296739" author="mtomcat_daobi" created="Sun, 7 Mar 2021 05:40:44 +0000"  >&lt;blockquote&gt;&lt;p&gt;Could you provide some test to reproduce this problem?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I&apos;m afraid that I don&apos;t know how to write a narrow-scoped small osgi env. unit test.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;So the only way out would be a Bundle-Activator?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The easiest way would be to add&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Import-Package: org.osgi.framework;resolution:=optional
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;to &lt;tt&gt;MANIFEST.MF&lt;/tt&gt;.&lt;br/&gt;
 I also like the &quot;classloader implements &lt;tt&gt;org.osgi.framework.BundleReference&quot;&lt;/tt&gt; check (&lt;a href=&quot;https://stackoverflow.com/a/5884211/1061929&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://stackoverflow.com/a/5884211/1061929&lt;/a&gt;).&lt;br/&gt;
 But instead of an &lt;tt&gt;instanceof&lt;/tt&gt; check that requires the class object of &lt;tt&gt;BundleReference&lt;/tt&gt; at compile and runtime, one could compare the classloaders interface (and super interface) names to&#160;&lt;tt&gt;org.osgi.framework.BundleReference&lt;/tt&gt; by&#160;&lt;tt&gt;java.lang.Class.getName()&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17296822" author="bodewig" created="Sun, 7 Mar 2021 10:04:15 +0000"  >&lt;p&gt;I&apos;d prefer a solution that doesn&apos;t require a compile time dependency on OSGi. Checking the classloader looks good, we could iterate the super interfaces and classes until the classname matches without performing an instanceof check.&lt;/p&gt;

&lt;p&gt;We&apos;ve already got a single PAX Exam test which only asserts Compress can be loaded as a bundle (this is easier to break, than I would have thought). I&apos;ll try to figure out whether this can be used to verify a certain check works when run inside of the bundle. We&apos;ll see.&lt;/p&gt;</comment>
                            <comment id="17296837" author="bodewig" created="Sun, 7 Mar 2021 10:57:45 +0000"  >&lt;p&gt;Commits 30a77505 seems to work, it would be good if you could test it with a real OSGi setup. &lt;/p&gt;</comment>
                            <comment id="17344083" author="bodewig" created="Thu, 13 May 2021 19:12:18 +0000"  >&lt;p&gt;assuming it works in a real environment just like inside our tests&lt;/p&gt;</comment>
                            <comment id="17344551" author="mtomcat_daobi" created="Fri, 14 May 2021 12:05:30 +0000"  >&lt;p&gt;Since&#160;&lt;tt&gt;org.osgi.framework.BundleReference&lt;/tt&gt;&#160;is an interface I&apos;d suggest this&#160;version at &lt;tt&gt;OsgiUtils&lt;/tt&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isBundleReference(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;?&amp;gt; clazz) {
    &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;?&amp;gt; c = clazz;
    &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (c != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;?&amp;gt; ifc : c.getInterfaces()) {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (ifc.getName().equals(&lt;span class=&quot;code-quote&quot;&gt;&quot;org.osgi.framework.BundleReference&quot;&lt;/span&gt;)) {
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
            }
        }
        c = c.getSuperclass();
    }
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Because Eclipse classloader (&lt;tt&gt;org.eclipse.osgi.internal.loader.EquinoxClassLoader&lt;/tt&gt;)  has following class hierarchy&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;class ModuleClassLoader extends java.lang.ClassLoader implements BundleReference
class EquinoxClassLoader extends ModuleClassLoader
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;current implementation evaluates to &lt;b&gt;false&lt;/b&gt;.&lt;/p&gt;</comment>
                            <comment id="17344967" author="mtomcat_daobi" created="Sat, 15 May 2021 05:08:56 +0000"  >&lt;p&gt;Revised version if &lt;tt&gt;BundleReference&lt;/tt&gt; is inherited by an intermediate interface&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isBundleReference(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;?&amp;gt; clazz) {
    &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;?&amp;gt; c = clazz;
    &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (c != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;?&amp;gt; ifc : c.getInterfaces()) {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (ifc.getName().equals(&lt;span class=&quot;code-quote&quot;&gt;&quot;org.osgi.framework.BundleReference&quot;&lt;/span&gt;)) {
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
            }
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isBundleReference(ifc)){
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
            }
        }
        c = c.getSuperclass();
    }
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17345664" author="bodewig" created="Sun, 16 May 2021 10:05:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mtomcat_daobi&quot; class=&quot;user-hover&quot; rel=&quot;mtomcat_daobi&quot;&gt;mtomcat_daobi&lt;/a&gt; could you give commit 23b758fb a try please?&lt;/p&gt;</comment>
                            <comment id="17345727" author="mtomcat_daobi" created="Sun, 16 May 2021 14:38:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bodewig&quot; class=&quot;user-hover&quot; rel=&quot;bodewig&quot;&gt;bodewig&lt;/a&gt; Where is the location of the snapshots artifacts? &lt;a href=&quot;https://repository.apache.org/content/groups/snapshots/org/apache/commons/commons-compress/1.21-SNAPSHOT/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/groups/snapshots/org/apache/commons/commons-compress/1.21-SNAPSHOT/&lt;/a&gt; are outdated.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mtomcat_daobi&quot; class=&quot;user-hover&quot; rel=&quot;mtomcat_daobi&quot;&gt;mtomcat_daobi&lt;/a&gt; could you give commit 23b758fb a try please?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&lt;tt&gt;OsgiUtils.isRunningInOsgiEnvironment()&lt;/tt&gt; evaluates to true while running org.eclipse.osgi_3.15.100.v20191114-1701.jar&lt;/p&gt;</comment>
                            <comment id="17345773" author="bodewig" created="Sun, 16 May 2021 18:53:42 +0000"  >&lt;p&gt;TBH I have no idea which job publishes the snapshots and how often it runs - and whether it actually still does (it doesn&apos;t look that way). I was hoping you could build the master branch of Commons Compress yourself. I&apos;ll attach a SNAPSHOT here in a few minutes.&lt;/p&gt;</comment>
                            <comment id="17345924" author="mtomcat_daobi" created="Mon, 17 May 2021 07:21:43 +0000"  >&lt;p&gt;&lt;tt&gt;OsgiUtils.isRunningInOsgiEnvironment()&lt;/tt&gt; returns &lt;tt&gt;true&lt;/tt&gt; with given &lt;tt&gt;commons-compress-1.21-SNAPSHOT.jar&lt;/tt&gt;. Thank you.&lt;/p&gt;</comment>
                            <comment id="17346061" author="bodewig" created="Mon, 17 May 2021 10:44:12 +0000"  >&lt;p&gt;Great, thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mtomcat_daobi&quot; class=&quot;user-hover&quot; rel=&quot;mtomcat_daobi&quot;&gt;mtomcat_daobi&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13025515" name="commons-compress-1.21-SNAPSHOT.jar" size="643906" author="bodewig" created="Sun, 16 May 2021 18:56:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 25 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0i2og:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>