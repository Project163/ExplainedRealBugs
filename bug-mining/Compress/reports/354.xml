<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:33:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[COMPRESS-529] Tar decompression fails with runtime exceptions</title>
                <link>https://issues.apache.org/jira/browse/COMPRESS-529</link>
                <project id="12310904" key="COMPRESS">Commons Compress</project>
                    <description>&lt;p&gt;This Kotlin code fails with exception(NumberFormatException.tar is in the attachment)&lt;/p&gt;

&lt;p&gt;Exception in thread &quot;main&quot; java.lang.NumberFormatException: For input string: &quot;143266&#65533;921.098285006&quot;&lt;br/&gt;
 at java.base/jdk.internal.math.FloatingDecimal.readJavaFormatString(FloatingDecimal.java:2054)&lt;br/&gt;
 at java.base/jdk.internal.math.FloatingDecimal.parseDouble(FloatingDecimal.java:110)&lt;br/&gt;
 at java.base/java.lang.Double.parseDouble(Double.java:543)&lt;br/&gt;
 at org.apache.commons.compress.archivers.tar.TarArchiveEntry.processPaxHeader(TarArchiveEntry.java:1161)&lt;br/&gt;
 at org.apache.commons.compress.archivers.tar.TarArchiveEntry.updateEntryFromPaxHeaders(TarArchiveEntry.java:1093)&lt;br/&gt;
 at org.apache.commons.compress.archivers.tar.TarArchiveInputStream.applyPaxHeadersToCurrentEntry(TarArchiveInputStream.java:757)&lt;br/&gt;
 at org.apache.commons.compress.archivers.tar.TarArchiveInputStream.paxHeaders(TarArchiveInputStream.java:562)&lt;br/&gt;
 at org.apache.commons.compress.archivers.tar.TarArchiveInputStream.getNextTarEntry(TarArchiveInputStream.java:404)&lt;br/&gt;
 at org.apache.commons.compress.archivers.tar.TarArchiveInputStream.getNextEntry(TarArchiveInputStream.java:799)&lt;br/&gt;
 at ru.example.kotlinfuzzer.tests.MainKt.main(main.kt:69)&lt;br/&gt;
 at ru.example.kotlinfuzzer.tests.MainKt.main(main.kt)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.compress.archivers.ArchiveStreamFactory
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io.File

fun main() {
    val tar = File(&lt;span class=&quot;code-quote&quot;&gt;&quot;NumberFormatException.tar&quot;&lt;/span&gt;)
    ArchiveStreamFactory().createArchiveInputStream(&lt;span class=&quot;code-quote&quot;&gt;&quot;tar&quot;&lt;/span&gt;, tar.inputStream()).use { ais -&amp;gt;
        ais.nextEntry
        ais.readAllBytes()
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This Kotlin code fails with exception(LongName.tar is in the attachment)&lt;/p&gt;

&lt;p&gt;Exception in thread &quot;main&quot; java.lang.RuntimeException: file name &apos;asidhuasih a&lt;br/&gt;
 sdjn osdn &lt;br/&gt;
 sdvs ndv&lt;br/&gt;
 asdjbhasdb asb iasbfi basdigf basduio &lt;br/&gt;
 asdkhasjdhasd&lt;br/&gt;
 asdjkhasnjddjasjdas&lt;br/&gt;
 /?ï¿½&apos; is too long ( &amp;gt; 100 bytes)&lt;br/&gt;
 at org.apache.commons.compress.archivers.tar.TarArchiveOutputStream.handleLongName(TarArchiveOutputStream.java:683)&lt;br/&gt;
 at org.apache.commons.compress.archivers.tar.TarArchiveOutputStream.putArchiveEntry(TarArchiveOutputStream.java:358)&lt;br/&gt;
 at ru.example.kotlinfuzzer.tests.MainKt.test(main.kt:20)&lt;br/&gt;
 at ru.example.kotlinfuzzer.tests.MainKt.main(main.kt:8)&lt;br/&gt;
 at ru.example.kotlinfuzzer.tests.MainKt.main(main.kt)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.compress.archivers.ArchiveStreamFactory
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.compress.archivers.tar.TarArchiveEntry
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io.File

fun main() {
    test(File(&lt;span class=&quot;code-quote&quot;&gt;&quot;LongName.tar&quot;&lt;/span&gt;))
}

fun test(tar: File) {
    val (decompressed, name) = ArchiveStreamFactory().createArchiveInputStream(&lt;span class=&quot;code-quote&quot;&gt;&quot;tar&quot;&lt;/span&gt;, tar.inputStream()).use { ais -&amp;gt;
        val entry = ais.nextEntry
        ais.readAllBytes() to entry.name
    }
    File.createTempFile(&lt;span class=&quot;code-quote&quot;&gt;&quot;apache_&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;.tar&quot;&lt;/span&gt;).also {
        ArchiveStreamFactory().createArchiveOutputStream(&lt;span class=&quot;code-quote&quot;&gt;&quot;tar&quot;&lt;/span&gt;, it.outputStream()).use { aos -&amp;gt;
            val entry = TarArchiveEntry(name)
            entry.size = decompressed.size.toLong()
            aos.putArchiveEntry(entry)
            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                aos.write(decompressed)
            } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
                aos.closeArchiveEntry()
            }
        }
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;IOException expected&lt;/p&gt;</description>
                <environment></environment>
        <key id="13307179">COMPRESS-529</key>
            <summary>Tar decompression fails with runtime exceptions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="zuevmaxim">Maksim Zuev</reporter>
                        <labels>
                    </labels>
                <created>Mon, 25 May 2020 08:41:05 +0000</created>
                <updated>Tue, 8 Feb 2022 17:59:30 +0000</updated>
                            <resolved>Mon, 1 Jun 2020 11:17:38 +0000</resolved>
                                    <version>1.20</version>
                                    <fixVersion>1.21</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17116544" author="peterlee" created="Tue, 26 May 2020 08:56:32 +0000"  >&lt;p&gt;Disclaimer : I&apos;m not that familiar with kotlin so feel free to tell if I make any mistakes. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;For the second issue(the LongName.tar issue) :&#160;&lt;/p&gt;

&lt;p&gt;If I understand this issue correctly, you&apos;re creating a tar entry with a name which is longer than 100 byte. Then you got an Runtime Exception which is telling you that the file name is too long. Isn&apos;t it?&lt;/p&gt;

&lt;p&gt;Actually this is expected exception cause you didn&apos;t set the&#160;longFileMode for aos and it&apos;s set as default value :&#160;LONGFILE_ERROR, which means we will throw an exception if the file name is too long.&lt;/p&gt;

&lt;p&gt;Just try something like&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
aos.setLongFileMode(TarArchiveOutputStream.LONGFILE_GNU);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and you would not get this exception any more.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Or maybe you are just talking that we should throw IOException instead of&#160;RuntimeException?&lt;/p&gt;</comment>
                            <comment id="17116574" author="zuevmaxim" created="Tue, 26 May 2020 09:46:52 +0000"  >&lt;p&gt;&lt;cite&gt;Or maybe you are just talking that we should throw IOException instead of RuntimeException&lt;/cite&gt;?&lt;br/&gt;
Yes, I meant exactly that.&lt;/p&gt;</comment>
                            <comment id="17116586" author="bodewig" created="Tue, 26 May 2020 10:05:13 +0000"  >&lt;p&gt;In this particular case I disagree. I think an &lt;tt&gt;IllegalArgumentException&lt;/tt&gt; is fine if you invoke one of the &lt;tt&gt;putArchiveEntry&lt;/tt&gt; variants. We might need to add more documentation, granted, but this is not an I/O error of any kind and the caller is in full control of what it passes in as argument.&lt;/p&gt;</comment>
                            <comment id="17116590" author="bodewig" created="Tue, 26 May 2020 10:08:07 +0000"  >&lt;p&gt;&lt;tt&gt;LONGFILE_ERROR&lt;/tt&gt; is the default, we may need to document more properly what kind of error will be thrown.&lt;/p&gt;</comment>
                            <comment id="17116739" author="peterlee" created="Tue, 26 May 2020 13:19:24 +0000"  >&lt;p&gt;&amp;gt;&#160;&lt;em&gt;In this particular case I disagree. I think an &lt;tt&gt;IllegalArgumentException&lt;/tt&gt; is fine if you invoke one of the &lt;tt&gt;putArchiveEntry&lt;/tt&gt; variants. We might need to add more documentation, granted, but this is not an I/O error of any kind and the caller is in full control of what it passes in as argument.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;+1. I can&apos;t see any help if we change from RuntimeException to IOException - users will still be confused if they do not know there&apos;s such a thing like long file mode. More documentation is what we need here.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;del&gt;And the NumberFormatException.tar problem is fixed in commit b8a0b54c59191cb8338585eab055897737730a9e.&lt;/del&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Edit : the commit has broken the compatibility&lt;/p&gt;</comment>
                            <comment id="17118656" author="peterlee" created="Thu, 28 May 2020 13:29:56 +0000"  >&lt;p&gt;For the first issue :&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.lang.NumberFormatException: For input string: &lt;span class=&quot;code-quote&quot;&gt;&quot;143266&#65533;921.098285006&quot;&lt;/span&gt;
at java.base/jdk.internal.math.FloatingDecimal.readJavaFormatString(FloatingDecimal.java:2054)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Seems we could catch this exception in&#160;TarArchiveInputStream.paxHeaders and rethrow the IOException - this could throw the IOException without breaking the binary&#160;compatibility. But it seems we could not provide enough information if we want to rethrow IOException here - we do not know which is the key with a corrupted value. In that way the IOException would do no good here - users are still confused.&#160;I don&apos;t like this solution.&lt;/p&gt;

&lt;p&gt;Any better ideas? &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zuevmaxim&quot; class=&quot;user-hover&quot; rel=&quot;zuevmaxim&quot;&gt;zuevmaxim&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bodewig&quot; class=&quot;user-hover&quot; rel=&quot;bodewig&quot;&gt;bodewig&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17119333" author="bodewig" created="Fri, 29 May 2020 07:10:20 +0000"  >&lt;p&gt;The point of this bug report is that it happens when you read an archive. The exception occurs in &lt;tt&gt;getNextEntry&lt;/tt&gt; . Here the user expects an&#160;&lt;tt&gt;IOException&lt;/tt&gt; and probably catches it, but will not catch a &lt;tt&gt;NumberFormatException&lt;/tt&gt;. So while wrapping the NFE into an IOE may not provide useful information, it will make the user code hande the exception and use a controlled path of exception. This is a benefit in itself.&lt;/p&gt;</comment>
                            <comment id="17119434" author="peterlee" created="Fri, 29 May 2020 09:20:51 +0000"  >&lt;p&gt;I see. The declared IOException is indeed a better exception than undeclared NumberFormatException.&lt;/p&gt;

&lt;p&gt;For the first issue, we could catch the&#160;NumberFormatException in&#160;TarArchiveInputStream.paxHeaders and rethrow an IOException.&lt;/p&gt;

&lt;p&gt;For the second issue, we could use&#160;&lt;tt&gt;IllegalArgumentException&lt;/tt&gt;&#160;instead of RuntimeException, and we need more documentation to address this.&lt;/p&gt;

&lt;p&gt;Hope I&apos;m not misunderstanding.&lt;/p&gt;</comment>
                            <comment id="17120506" author="bodewig" created="Sun, 31 May 2020 11:11:52 +0000"  >&lt;p&gt;At least the two of us share the same misunderstanding, then &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;If anything is wrong with a stream we read, we should always try to turn this into an &lt;tt&gt;IOException&lt;/tt&gt;. This is something we don&apos;t always do, obviously, as &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zuevmaxim&quot; class=&quot;user-hover&quot; rel=&quot;zuevmaxim&quot;&gt;zuevmaxim&lt;/a&gt; &apos;s issues show. When writing things are a bit different as we can expect the user to only hand us valid inputs IMHO.&lt;/p&gt;

&lt;p&gt;The second issue here must expect errors as this is what &lt;tt&gt;TarArchiveOutputStream&lt;/tt&gt; does for file names that are too long or numbers that are too big unless you tell it otherwise - and this is documented.&lt;/p&gt;

&lt;p&gt;I agree we should turn the exceptions into &lt;tt&gt;IllegalArgumentException}}s - and document them at the public APIs that may throw them. Any client code that catches {{RuntimeException}}s now will automatically catch {{IllegalArgumentException&lt;/tt&gt; as well, so we are on the safe side.&lt;/p&gt;</comment>
                            <comment id="17120889" author="peterlee" created="Mon, 1 Jun 2020 09:34:58 +0000"  >&lt;p&gt;And fixed with commit 36773d948e9a220c1dc3abec3d2028b0879a7766&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13003923" name="LongName.tar" size="512" author="zuevmaxim" created="Mon, 25 May 2020 08:39:32 +0000"/>
                            <attachment id="13003924" name="NumberFormatException.tar" size="1536" author="zuevmaxim" created="Mon, 25 May 2020 08:37:12 +0000"/>
                            <attachment id="13004080" name="japicmp.html" size="97585" author="peterlee" created="Wed, 27 May 2020 01:56:22 +0000"/>
                            <attachment id="13004079" name="japicmp.html" size="97585" author="peterlee" created="Wed, 27 May 2020 01:56:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 23 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0f4fk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>