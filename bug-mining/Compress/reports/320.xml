<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:33:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[COMPRESS-479] Unable to extract Zip with unknown UniCode path extra data version</title>
                <link>https://issues.apache.org/jira/browse/COMPRESS-479</link>
                <project id="12310904" key="COMPRESS">Commons Compress</project>
                    <description>&lt;p&gt;The following exception is thrown when the version of the UniCode path extra data version is not 1. 7-Zip and Windows Explorer will extract the attached file. The version in the file was changed via a Hex editor to provoke the error.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.RuntimeException: Error parsing extra fields &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; entry: %U20AC_for_Dollar.txt - Unsupported version [116] &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; UniCode path extra data.

	at org.apache.commons.compress.archivers.zip.ZipArchiveEntry.setExtra(ZipArchiveEntry.java:626)
	at org.apache.commons.compress.archivers.zip.ZipArchiveInputStream.getNextZipEntry(ZipArchiveInputStream.java:315)
	at org.apache.commons.compress.archivers.zip.ZipArchiveInputStream.getNextEntry(ZipArchiveInputStream.java:408)
	at org.apache.commons.compress.archivers.zip.UTF8ZipFilesTest.testZipFileReadsUnicodeFields(UTF8ZipFilesTest.java:186)
...
Caused by: java.util.zip.ZipException: Unsupported version [116] &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; UniCode path extra data.
	at org.apache.commons.compress.archivers.zip.AbstractUnicodeExtraField.parseFromLocalFileData(AbstractUnicodeExtraField.java:172)
	at org.apache.commons.compress.archivers.zip.ExtraFieldUtils.parse(ExtraFieldUtils.java:180)
	at org.apache.commons.compress.archivers.zip.ZipArchiveEntry.setExtra(ZipArchiveEntry.java:620)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As I understand the specification in Section 4.6.8 and 4.6.9 when the version is unknown the information shoule be ignored.&lt;/p&gt;

&lt;p&gt;Changes MAY NOT be backward compatible so this extra field &lt;b&gt;SHOULD NOT be used if the version is not recognized&lt;/b&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13213038">COMPRESS-479</key>
            <summary>Unable to extract Zip with unknown UniCode path extra data version</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rschimpf">Robin Schimpf</reporter>
                        <labels>
                            <label>zip</label>
                    </labels>
                <created>Thu, 31 Jan 2019 10:26:51 +0000</created>
                <updated>Mon, 19 Aug 2019 05:05:07 +0000</updated>
                            <resolved>Sat, 17 Aug 2019 10:43:07 +0000</resolved>
                                    <version>1.18</version>
                                    <fixVersion>1.19</fixVersion>
                                    <component>Archivers</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="2400">40m</timespent>
                                <comments>
                            <comment id="16792505" author="rschimpf" created="Thu, 14 Mar 2019 09:54:10 +0000"  >&lt;p&gt;I created a pull request on Github. Since I&apos;m not very familiar with the codebase I don&apos;t know if there are any sideeffects.&lt;/p&gt;</comment>
                            <comment id="16818909" author="bodewig" created="Tue, 16 Apr 2019 11:11:04 +0000"  >&lt;p&gt;Thanks Robin, are you seeing this in the wild or is this an artificial archive you&apos;ve created? I&apos;m not asking to dismiss the issue, rather am curious whether there is a version different from 1 that we should learn to support directly.&lt;/p&gt;

&lt;p&gt;Right now I&apos;m pondering a way to generalize the situation where extra field implementations can signal they don&apos;t know how to handle this specific set of data. In a way your PR does and extra fields signal this state by returning &lt;tt&gt;null&lt;/tt&gt; for the extra data. This approach throws away the extra field data and I&apos;d hope to find a way to preserve the original data (by capturing it inside &lt;tt&gt;UnparseableExtraFieldData&lt;/tt&gt; or &lt;tt&gt;UnrecognizedExtraField&lt;/tt&gt;, maybe). &lt;/p&gt;

&lt;p&gt;One way could be to throw a specific exception in &lt;tt&gt;parseFrom*Data}}I which would be caught in {{ExtraFieldUtils.parse&lt;/tt&gt;, but really I haven&apos;t spent enough time thinking about how to achieve my goal without breaking APIs. This might be the point where moving to Java 8 becomes worthwhile as a default method on &lt;tt&gt;ZipExtraField&lt;/tt&gt; would add real value, maybe there is a way without bumping the Java requirement.&lt;/p&gt;</comment>
                            <comment id="16818944" author="rschimpf" created="Tue, 16 Apr 2019 12:16:16 +0000"  >&lt;p&gt;I have seen a simliar file in our production environment. The attached file is artificial but with the same version as the originial problematic file. I also was unable to find out with which archiver the original file was created.&lt;/p&gt;</comment>
                            <comment id="16822029" author="bodewig" created="Fri, 19 Apr 2019 16:27:18 +0000"  >&lt;p&gt;I didn&apos;t realize our code was the one throwing the exception already, sorry. It&apos;s been a while since I last looked at that part of the code base.&lt;/p&gt;

&lt;p&gt;There are two ways to look at this, one is &quot;I want to know if my archive contains extra fields that don&apos;t adhere to the spec&quot; and the other one is &quot;I don&apos;t care for errors in extra fields, give me the data&quot;. So far we&apos;ve been on the first side - see for example the handling for runtime exceptions at &lt;a href=&quot;https://github.com/apache/commons-compress/blob/master/src/main/java/org/apache/commons/compress/archivers/zip/ExtraFieldUtils.java#L184&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/blob/master/src/main/java/org/apache/commons/compress/archivers/zip/ExtraFieldUtils.java#L184&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;I&apos;m currently pondering the idea of making the behavior user controlled much like the &lt;tt&gt;onUnparseableData&lt;/tt&gt; argument to &lt;tt&gt;ExtraFieldUtis#parse&lt;/tt&gt; and am unsure about what should be the default. Making a more lenient parser that catches exceptions and turns the extra fields causing exceptions into &lt;tt&gt;UnrecognizedExtraField&lt;/tt&gt; instances the default would break backwards compatibility in a way, but likely in an acceptable way as the difference will be we can read archives that have failed before.&lt;/p&gt;</comment>
                            <comment id="16824143" author="rschimpf" created="Tue, 23 Apr 2019 13:34:54 +0000"  >&lt;p&gt;Your idea sounds good to me. Seems to be better scalable for future versions than my naive approach.&lt;/p&gt;

&lt;p&gt;How can the parameter in &lt;tt&gt;ExtraFieldUtils#parse&lt;/tt&gt; currently be controlled by the user? All calls from ZipArchiveEntry are passing &lt;tt&gt;UnparseableExtraField.READ&lt;/tt&gt; and all calls in &lt;tt&gt;ExtraFieldUtils&lt;/tt&gt; are using &lt;tt&gt;UnparseableExtraField.THROW&lt;/tt&gt;?&lt;/p&gt;

&lt;p&gt;Would it be an option to introduce a general &quot;strict&quot; and a &quot;lenient&quot; mode instead of just configure the behaviour of a small part of the extraction?&lt;/p&gt;</comment>
                            <comment id="16838037" author="bodewig" created="Sun, 12 May 2019 10:19:03 +0000"  >&lt;p&gt;Actually I haven&apos;t figured out how to do that best myself either. The code for dealing with the parser error is in a branch &lt;a href=&quot;https://issues.apache.org/jira/browse/COMPRESS-479&quot; title=&quot;Unable to extract Zip with unknown UniCode path extra data version&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COMPRESS-479&quot;&gt;&lt;del&gt;COMPRESS-479&lt;/del&gt;&lt;/a&gt; and has been sitting in my work tree for a while. Unfortunately I&apos;m not spending as much time on Compress as would be needed to get to a closure here quickly. &lt;/p&gt;

&lt;p&gt;My current line of thought was heading towards a lenient mode for the stream/ZipFile but I&apos;m not sure whether such a flag wouldn&apos;t somehow imply more changes than &quot;just&quot; the parsing of extra fields. &lt;/p&gt;</comment>
                            <comment id="16906518" author="bodewig" created="Tue, 13 Aug 2019 18:48:50 +0000"  >&lt;p&gt;For now I&apos;ve decided to move the decisions to the API of &lt;tt&gt;ZipArchiveEntry&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;By default extra fields that Compress should support but we fail to parse will be read and converted but if you really want to be strict, you can do so using the new &lt;tt&gt;getExtraFields&lt;/tt&gt; overload.&lt;/p&gt;

&lt;p&gt;The master branch now reads your archive without problems, but certainly doesn&apos;t use the unicode extra field.&lt;/p&gt;

&lt;p&gt;I&apos;ll discuss on the dev list whether this is the way to go or whether people see a better approach.&lt;/p&gt;</comment>
                            <comment id="16909642" author="bodewig" created="Sat, 17 Aug 2019 10:42:57 +0000"  >&lt;p&gt;The discussion has lead to a refactoring of the whole extra field parsing area. In either case, master now properly reds your archive. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16910172" author="rschimpf" created="Mon, 19 Aug 2019 05:05:07 +0000"  >&lt;p&gt;Hi Stefan, thanks for your work! The refactored version looks like a great addition to the ExtraField parsing code.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12957069" name="unicode-test10509149899131946592.zip" size="557" author="rschimpf" created="Thu, 31 Jan 2019 10:21:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 12 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|yi0ir4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>