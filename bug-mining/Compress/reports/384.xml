<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:34:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[COMPRESS-565] Regression - Corrupted headers when using 64 bit ZipArchiveOutputStream</title>
                <link>https://issues.apache.org/jira/browse/COMPRESS-565</link>
                <project id="12310904" key="COMPRESS">Commons Compress</project>
                    <description>&lt;p&gt;We&apos;ve recently updated commons-compress library from version 1.9 to 1.20 and now experiencing the problem that didn&apos;t occur before.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;When using&#160;ZipArchiveOutputStream to archive 5Gb file and setting the following fields&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;output.setUseZip64(Zip64Mode.Always)&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;output.setCreateUnicodeExtraFields(ZipArchiveOutputStream.UnicodeExtraFieldPolicy.ALWAYS)&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;resulting archive contains corrupted headers.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Expand-Archive Powershell utility cannot extract the archive at all with the error about corrupted header. 7zip also complains about it, but can extract the archive.&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The problem didn&apos;t appear when using library version 1.9.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I&apos;ve created a sample project that reproduces the error -&#160;&lt;a href=&quot;https://github.com/missingdays/commons-compress-example&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/missingdays/commons-compress-example&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Issue doesn&apos;t reproduce if you do any of the following:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Downgrade library to version 1.9&lt;/li&gt;
	&lt;li&gt;Remove output.setCreateUnicodeExtraFields(ZipArchiveOutputStream.UnicodeExtraFieldPolicy.ALWAYS)&lt;/li&gt;
	&lt;li&gt;Remove&#160;output.setUseZip64(Zip64Mode.Always) and zip smaller file (e.g. 1Gb)&lt;/li&gt;
&lt;/ol&gt;
</description>
                <environment></environment>
        <key id="13358954">COMPRESS-565</key>
            <summary>Regression - Corrupted headers when using 64 bit ZipArchiveOutputStream</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="peterlee">Peter Lee</assignee>
                                    <reporter username="evgenii.bovykin">Evgenii Bovykin</reporter>
                        <labels>
                    </labels>
                <created>Tue, 16 Feb 2021 22:30:11 +0000</created>
                <updated>Sat, 3 Jul 2021 15:55:34 +0000</updated>
                            <resolved>Sat, 3 Jul 2021 15:55:34 +0000</resolved>
                                    <version>1.20</version>
                                    <fixVersion>1.21</fixVersion>
                                    <component>Archivers</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="16200">4.5h</timespent>
                                <comments>
                            <comment id="17285685" author="peterlee" created="Wed, 17 Feb 2021 07:33:08 +0000"  >&lt;p&gt;Hi,&#160;Evgenii. Thank you for reporting this.&lt;/p&gt;

&lt;p&gt;Could you reproduce this issue using the latest version of Compress?&lt;/p&gt;

&lt;p&gt;And I didn&apos;t find a &apos;archive/input.bin&apos; in your GH project. Is there any way you can share it(if this file doesn&apos;t contain anything important)?&lt;/p&gt;</comment>
                            <comment id="17285732" author="evgenii.bovykin" created="Wed, 17 Feb 2021 09:07:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=peterlee&quot; class=&quot;user-hover&quot; rel=&quot;peterlee&quot;&gt;peterlee&lt;/a&gt;&#160;my bad, I&apos;ve committed version 1.9 to the project instead of the 1.20. The problem reproduced on the 1.20 version and &lt;em&gt;doesn&apos;t reproduce&lt;/em&gt; on the 1.9. I&apos;ve pushed the 1.20 version to the example repo.&lt;/p&gt;

&lt;p&gt;`archive/input.bin` file is generated on the fly when runnig the main.kt file.&lt;/p&gt;</comment>
                            <comment id="17286828" author="peterlee" created="Fri, 19 Feb 2021 02:50:40 +0000"  >&lt;p&gt;Not familiar with gradle and kotlin. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Is the input.bin an empty file with size of 5GB?&lt;/p&gt;

&lt;p&gt;Or could you provide an example with Java using maven?&lt;/p&gt;</comment>
                            <comment id="17286882" author="peterlee" created="Fri, 19 Feb 2021 07:00:28 +0000"  >&lt;p&gt;I&apos;m testing like this:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
RandomAccessFile randomAccessFile = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RandomAccessFile(&lt;span class=&quot;code-quote&quot;&gt;&quot;archive/input.bin&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;rw&quot;&lt;/span&gt;);
randomAccessFile.setLength(1024L * 1024 * 1024 * 5);

File outputFile = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;archive/output.zip&quot;&lt;/span&gt;);
outputFile.createNewFile();
&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;(ZipArchiveOutputStream zipArchiveOutputStream = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ZipArchiveOutputStream(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BufferedOutputStream(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileOutputStream(outputFile)))) {
    zipArchiveOutputStream.setUseZip64(Zip64Mode.Always);
    zipArchiveOutputStream.setCreateUnicodeExtraFields(ZipArchiveOutputStream.UnicodeExtraFieldPolicy.ALWAYS);

    zipArchiveOutputStream.putArchiveEntry(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ZipArchiveEntry(&lt;span class=&quot;code-quote&quot;&gt;&quot;input.bin&quot;&lt;/span&gt;));

    InputStream inputStream = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileInputStream(&lt;span class=&quot;code-quote&quot;&gt;&quot;archive/input.bin&quot;&lt;/span&gt;);
    IOUtils.copy(inputStream, zipArchiveOutputStream);

    zipArchiveOutputStream.closeArchiveEntry();
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;And I think this test is exactly the same as yours.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I&apos;m testing on Ubuntu and I can successfully extract the generated output.zip using &lt;em&gt;unzip&lt;/em&gt; command without reporting any errors.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17286884" author="peterlee" created="Fri, 19 Feb 2021 07:01:26 +0000"  >&lt;p&gt;And I&apos;m testing with UnZip 6.00.&lt;/p&gt;</comment>
                            <comment id="17286905" author="peterlee" created="Fri, 19 Feb 2021 07:39:25 +0000"  >&lt;p&gt;I also tested in windows using 7zip 19.00, and it successfully extracted the &lt;em&gt;output.zip&lt;/em&gt; without reporting any errors.&lt;/p&gt;</comment>
                            <comment id="17286988" author="missingdays" created="Fri, 19 Feb 2021 10:39:40 +0000"  >&lt;p&gt;&lt;cite&gt;Is the input.bin an empty file with size of 5GB&lt;/cite&gt;?&lt;/p&gt;

&lt;p&gt;Yes. Your code seems to be ok.&#160;&lt;/p&gt;

&lt;p&gt;&lt;cite&gt;I&apos;m testing on Ubuntu and I can successfully extract the generated output.zip using&#160;&lt;em&gt;unzip&lt;/em&gt;&#160;command without reporting any errors.&lt;/cite&gt;&lt;/p&gt;

&lt;p&gt;Yes, some tools ignore the incorrect headers and just extract the archive. As I said,&#160;&lt;b&gt;Expand-Archive Powershell utility&lt;/b&gt;&#160;on Windows can&apos;t extract the archive.&#160;&lt;/p&gt;

&lt;p&gt;With 7zip 19.0 you can use &lt;b&gt;7z t archive_name&lt;/b&gt; command, it will report the incorrect headers.&lt;/p&gt;</comment>
                            <comment id="17287572" author="peterlee" created="Sat, 20 Feb 2021 07:05:26 +0000"  >&lt;p&gt;I see. I can reproduce this issue now.&lt;/p&gt;</comment>
                            <comment id="17287589" author="peterlee" created="Sat, 20 Feb 2021 08:03:34 +0000"  >&lt;p&gt;I&apos;m not familiar with&#160;&lt;b&gt;Expand-Archive Powershell utility&lt;/b&gt;. Is it open sourced or not? I can&apos;t find anything on google.&lt;/p&gt;

&lt;p&gt;7zip is open sourced but I&apos;m not familiar with its code.&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;The difference between using&#160;&lt;em&gt;output.setCreateUnicodeExtraFields(ZipArchiveOutputStream.UnicodeExtraFieldPolicy.ALWAYS)&lt;/em&gt; or not using it is:&lt;/p&gt;

&lt;p&gt;whether we are adding the extra field&#160;&lt;em&gt;Info-ZIP Unicode Path Extra Field&lt;/em&gt; in the extra field or not. &#160;And I think the reason why 7z is complaining and&#160;&lt;b&gt;Expand-Archive Powershell utility&lt;/b&gt;&#160;on Windows can&apos;t extract the archive is :&#160;&lt;b&gt;&lt;em&gt;Info-ZIP Unicode Path Extra Field&lt;/em&gt;&#160;is not supported by them&lt;/b&gt;.&lt;/p&gt;

&lt;p&gt;See also: sector 4.6.9 of &lt;a href=&quot;https://pkware.cachefly.net/webdocs/casestudies/APPNOTE.TXT&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;zip APPNOTE&lt;/a&gt; for more detailed information&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;With&#160;&lt;em&gt;ZipArchiveOutputStream.UnicodeExtraFieldPolicy.ALWAYS&lt;/em&gt; being set, we will always add the&#160;&lt;em&gt;Info-ZIP Unicode Path Extra Field&lt;/em&gt;, which can be seen in the generated zip:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13020768/13020768_image-2021-02-20-15-51-21-747.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;I can make some simple explanations :&lt;/p&gt;

&lt;p&gt;First of all, zip format is using little endian.&lt;/p&gt;

&lt;p&gt;The first 2 bytes 0x7075 is the signature of&#160;&lt;em&gt;Info-ZIP Unicode Path Extra Field&lt;/em&gt;.And the 0x000e is the size of this field, which is 14.&lt;/p&gt;

&lt;p&gt;The 0x01 is the version of this extra field, which is always 1 now(according to the &lt;a href=&quot;https://pkware.cachefly.net/webdocs/casestudies/APPNOTE.TXT&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;zip APPNOTE&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;The 4 bytes 0x7df6c07c is the CRC32 checksum of the file name(which can be easily checked with any CRC32 check tools using the name &lt;em&gt;input.bin&lt;/em&gt;).&lt;/p&gt;

&lt;p&gt;The 9 bytes 0x69 6e 70 75 74 2e 62 69 6e is the UTF-8 value of the file name, which is &lt;em&gt;input.bin&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;You can see that 9 + 4 + 1 = 14 is exactly the length of this field I mentioned. So I think we have built a correct&#160;&lt;em&gt;Info-ZIP Unicode Path Extra Field.&lt;/em&gt;&lt;/p&gt;</comment>
                            <comment id="17287676" author="bodewig" created="Sat, 20 Feb 2021 12:48:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=peterlee&quot; class=&quot;user-hover&quot; rel=&quot;peterlee&quot;&gt;peterlee&lt;/a&gt; can you post the warnings 7z emits here, please?&lt;/p&gt;</comment>
                            <comment id="17287682" author="bodewig" created="Sat, 20 Feb 2021 12:57:31 +0000"  >&lt;p&gt;There are known incompatibilities with our Zip64 implementation and what Excel expects, see &lt;a href=&quot;https://issues.apache.org/jira/browse/COMPRESS-474&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/COMPRESS-474&lt;/a&gt; and I wouldn&apos;t be surprised if PowerShell used the same code. But this should only cause problems if the archive contains files smaller than 4GB and not be related to Unicode Extra Fields at all.&lt;/p&gt;

&lt;p&gt;Please include the exact error messages when reporting an interoperability issue not just &quot;error about corrupted headers&quot;. If a tool fails to extract archives created by Commons Compress than it could be the fault of either side - given the spec is vague enough and implementations differ in their interpretation of it.&lt;/p&gt;</comment>
                            <comment id="17287687" author="evgenii.bovykin" created="Sat, 20 Feb 2021 13:08:17 +0000"  >&lt;p&gt;Expand-Archive is open sourced, you can find its implementation here - &lt;a href=&quot;https://github.com/PowerShell/Microsoft.PowerShell.Archive/blob/master/Microsoft.PowerShell.Archive/Microsoft.PowerShell.Archive.psm1#L249&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/PowerShell/Microsoft.PowerShell.Archive/blob/master/Microsoft.PowerShell.Archive/Microsoft.PowerShell.Archive.psm1#L249&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The full error is&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;Exception calling &quot;ExtractToFile&quot; with &quot;3&quot; argument(s): &quot;A local file header is corrupt.&quot;&lt;/tt&gt;&lt;br/&gt;
{{ At}}&lt;br/&gt;
{{ C:\WINDOWS\system32\WindowsPowerShell\v1.0\Modules\Microsoft.PowerShell.Archive\Microsoft.PowerShell.Archive.psm1:1056}}&lt;br/&gt;
{{ char:25}}&lt;br/&gt;
{{ + ... &lt;span class=&quot;error&quot;&gt;&amp;#91;System.IO.Compression.ZipFileExtensions&amp;#93;&lt;/span&gt;::ExtractToFile( ...}}&lt;br/&gt;
{{ + ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~}}&lt;br/&gt;
{{ + CategoryInfo : NotSpecified: (&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&#160;[], MethodInvocationException}}&lt;br/&gt;
{{ + FullyQualifiedErrorId : InvalidDataException}}&lt;/p&gt;</comment>
                            <comment id="17287700" author="bodewig" created="Sat, 20 Feb 2021 14:34:03 +0000"  >&lt;p&gt;Yes, it might be open source (actually it most probably leaves the archive handling to the classes in .NET Framework or Core which may delegate to to Windows native libraries on Windows and zlib on non-Windows platforms), but that doesn&apos;t mean figuring out where the errors is would be easy &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Unfortunately the full error isn&apos;t really helpful, I was hoping it would say what exactly it doesn&apos;t like about the local file header. Sorry for bothering you.&lt;/p&gt;</comment>
                            <comment id="17287701" author="evgenii.bovykin" created="Sat, 20 Feb 2021 14:41:10 +0000"  >&lt;p&gt;I&apos;m happy to provide you with any additional information, as this issue is quite critical for us and stops us from fully upgrading to the new version of the library.&lt;/p&gt;</comment>
                            <comment id="17287705" author="bodewig" created="Sat, 20 Feb 2021 15:04:43 +0000"  >&lt;p&gt;just as a data-point, p7z 16 for Linux (the latest version available as apt package) doesn&apos;t see any problems with the archive.&lt;/p&gt;

&lt;p&gt;I&apos;ve run Peter&apos;s test code in Evgenii&apos;s repo with both 1.20 and 1.9 and the LFHs written for archive/input.bin are identical (except for the timestamps contained within).&lt;/p&gt;</comment>
                            <comment id="17287718" author="bodewig" created="Sat, 20 Feb 2021 15:35:13 +0000"  >&lt;p&gt;Does 7z on Windows provide you with more details? I&apos;m not using Windows normally, so checking would take some time ...&lt;/p&gt;

&lt;p&gt;What we have changed between 1.9 and 1.20 is the handling of the &quot;relative offset of local header&quot; inside the central directory entry - at least this is where I see the created archives differ. This is one of the problems Excel has had with our archives as well. To be honest I believe our implementation is correct and Excel is wrong - this is why I&apos;d really like to know what bothers 7z.&lt;/p&gt;

&lt;p&gt;Finally are any of the consumers of your archive actually using the Unicode extra fields? If not and if leaving this out fixes the problem then I&apos;d just drop it. But I must admit I&apos;m not really sure how/why the unicode extra fields changes the outcome in any way.&lt;/p&gt;</comment>
                            <comment id="17287722" author="evgenii.bovykin" created="Sat, 20 Feb 2021 15:40:11 +0000"  >&lt;p&gt;Unfortunately, the output is not very informative&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;7-Zip 19.00 (x64) : Copyright (c) 1999-2018 Igor Pavlov : 2019-02-21&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;Scanning the drive for archives:&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;1 file, 5096123 bytes (4977 KiB)&lt;/tt&gt;&lt;tt&gt;Testing archive: artifacts_artifacts_3_artifacts.zip&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;WARNINGS:&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;Headers Error&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;--&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;Path = artifacts_artifacts_3_artifacts.zip&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;Type = zip&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;WARNINGS:&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;Headers Error&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;Physical Size = 5096123&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;64-bit = +&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;Characteristics = Zip&lt;/tt&gt;&lt;tt&gt;64&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;Everything is Ok&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;Archives with Warnings: 1&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;Warnings: 1&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;Size: 5242880000&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;Compressed: 5096123&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="17287727" author="bodewig" created="Sat, 20 Feb 2021 15:49:49 +0000"  >&lt;p&gt;If I read the command line options correctly, throwing in -bb3 as switch might provide more extensive information.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;7z t -bb3 ..&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17287737" author="evgenii.bovykin" created="Sat, 20 Feb 2021 17:05:45 +0000"  >&lt;p&gt;With -bb3 it still prints the same.&lt;/p&gt;

&lt;p&gt;{{}}&lt;br/&gt;
&lt;tt&gt;7-Zip 19.00 (x64) : Copyright (c) 1999-2018 Igor Pavlov : 2019-02-21&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;Scanning the drive for archives:&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;1 file, 5096123 bytes (4977 KiB)&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;Testing archive: artifacts_artifacts_3_artifacts.zip&lt;/tt&gt;&lt;tt&gt;WARNINGS:&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;Headers Error&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;--&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;Path = artifacts_artifacts_3_artifacts.zip&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;Type = zip&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;WARNINGS:&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;Headers Error&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;Physical Size = 5096123&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;64-bit = +&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;Characteristics = Zip64&lt;/tt&gt;&lt;tt&gt;T big.txt&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;Everything is Ok&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;Archives with Warnings: 1&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;Warnings: 1&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;Size: 5242880000&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;Compressed: 5096123&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="17287771" author="bodewig" created="Sat, 20 Feb 2021 19:02:47 +0000"  >&lt;p&gt;Too bad, thank you.&lt;/p&gt;</comment>
                            <comment id="17287800" author="bodewig" created="Sat, 20 Feb 2021 21:22:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=evgenii.bovykin&quot; class=&quot;user-hover&quot; rel=&quot;evgenii.bovykin&quot;&gt;evgenii.bovykin&lt;/a&gt; could you please give the jar I&apos;ve attached a try? This is identical to current git master but handles the ZIP64 entry of the central directory in a different way - this wouldn&apos;t be sensitive to the unicode extra field, but I really suspect the lfh offset inside of the central directory to be what causes the problem.&lt;/p&gt;

&lt;p&gt;If you prefer to build the jar yourself, it is the branch compress-565-experiment I&apos;ve just pushed.&lt;/p&gt;</comment>
                            <comment id="17287847" author="peterlee" created="Sun, 21 Feb 2021 04:49:45 +0000"  >&lt;p&gt;&amp;gt;&#160;this wouldn&apos;t be sensitive to the unicode extra field, but I really suspect the lfh offset inside of the central directory to be what causes the problem.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Interesting. I can give it a try tomorrow, and I would port out the result then.&lt;/p&gt;</comment>
                            <comment id="17287865" author="evgenii.bovykin" created="Sun, 21 Feb 2021 07:59:36 +0000"  >&lt;p&gt;Using the attached jar helps my issue. Expand-Archive successfully extracts the archive, 7z doesn&apos;t complain about headers.&lt;/p&gt;</comment>
                            <comment id="17287878" author="bodewig" created="Sun, 21 Feb 2021 09:04:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=peterlee&quot; class=&quot;user-hover&quot; rel=&quot;peterlee&quot;&gt;peterlee&lt;/a&gt;no problem if you want to port it, but I can do so as well.&lt;/p&gt;

&lt;p&gt;What I would do:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;introduce another constant to Zip64Mode that works like ALWAYS for the LFH and AS_NEEDED for CFH. This would be a compromise that would allow Powershell (and likely Excel) to read the archive.&lt;/li&gt;
	&lt;li&gt;ask &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=evgenii.bovykin&quot; class=&quot;user-hover&quot; rel=&quot;evgenii.bovykin&quot;&gt;evgenii.bovykin&lt;/a&gt; to try a new snapshot using that new value rather than ALWAYS.&lt;/li&gt;
	&lt;li&gt;document that at the zip page on the site&lt;/li&gt;
	&lt;li&gt;not change any defaults WRT Zip64Mode&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17288128" author="peterlee" created="Mon, 22 Feb 2021 02:04:20 +0000"  >&lt;p&gt;&amp;gt;&#160;Using the attached jar helps my issue. Expand-Archive successfully extracts the archive, 7z doesn&apos;t complain about headers.&lt;/p&gt;

&lt;p&gt;Great. I didn&apos;t expact that Expand-Archive and 7z are reading CFH.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&amp;gt;&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=peterlee&quot; class=&quot;user-hover&quot; rel=&quot;peterlee&quot;&gt;peterlee&lt;/a&gt;no problem if you want to port it, but I can do so as well.&lt;/p&gt;

&lt;p&gt;I can do this with a GH pull request.&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17289867" author="peterlee" created="Wed, 24 Feb 2021 11:37:42 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=evgenii.bovykin&quot; class=&quot;user-hover&quot; rel=&quot;evgenii.bovykin&quot;&gt;evgenii.bovykin&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Please have a look if my PR works or not :&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/PeterAlfredLee/commons-compress.git&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/PeterAlfredLee/commons-compress.git&lt;/a&gt;&#160;with branch &lt;a href=&quot;https://issues.apache.org/jira/browse/COMPRESS-565&quot; title=&quot;Regression - Corrupted headers when using 64 bit ZipArchiveOutputStream&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COMPRESS-565&quot;&gt;&lt;del&gt;COMPRESS-565&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I tested on my Windows with Expand-Archive/7z and was successfully extracted.&lt;/p&gt;</comment>
                            <comment id="17289908" author="evgenii.bovykin" created="Wed, 24 Feb 2021 13:08:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=peterlee&quot; class=&quot;user-hover&quot; rel=&quot;peterlee&quot;&gt;peterlee&lt;/a&gt;&#160;thanks, did a check with&#160;Zip64Mode.AlwaysWithComestibles, everything seems to be ok.&lt;/p&gt;</comment>
                            <comment id="17291585" author="evgenii.bovykin" created="Fri, 26 Feb 2021 11:27:27 +0000"  >&lt;p&gt;Any estimate on when this fix will be released? It&apos;s a quite important problem to fix for us.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13020799" name="commons-compress-1.21-SNAPSHOT.jar" size="631033" author="bodewig" created="Sat, 20 Feb 2021 21:19:45 +0000"/>
                            <attachment id="13020768" name="image-2021-02-20-15-51-21-747.png" size="35016" author="peterlee" created="Sat, 20 Feb 2021 07:51:23 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 37 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0nqgg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>