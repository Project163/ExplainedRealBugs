<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:31:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[COMPRESS-321] Exception in X7875_NewUnix.parseFromLocalFileData when parsing 0-sized &quot;ux&quot; local entry</title>
                <link>https://issues.apache.org/jira/browse/COMPRESS-321</link>
                <project id="12310904" key="COMPRESS">Commons Compress</project>
                    <description>&lt;p&gt;When trying to detect content type of a zip file with Tika 1.10 (which uses Commons Compress 1.9 internally) in manner like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] content = ... &lt;span class=&quot;code-comment&quot;&gt;// whole zip file.
&lt;/span&gt;        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name = &lt;span class=&quot;code-quote&quot;&gt;&quot;TR_01.ZIP&quot;&lt;/span&gt;;
        Tika tika = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Tika();
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; tika.detect(content, name);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;it throws an exception:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.ArrayIndexOutOfBoundsException: 13
	at org.apache.commons.compress.archivers.zip.X7875_NewUnix.parseFromLocalFileData(X7875_NewUnix.java:199)
	at org.apache.commons.compress.archivers.zip.X7875_NewUnix.parseFromCentralDirectoryData(X7875_NewUnix.java:220)
	at org.apache.commons.compress.archivers.zip.ExtraFieldUtils.parse(ExtraFieldUtils.java:174)
	at org.apache.commons.compress.archivers.zip.ZipArchiveEntry.setCentralDirectoryExtra(ZipArchiveEntry.java:476)
	at org.apache.commons.compress.archivers.zip.ZipFile.readCentralDirectoryEntry(ZipFile.java:575)
	at org.apache.commons.compress.archivers.zip.ZipFile.populateFromCentralDirectory(ZipFile.java:492)
	at org.apache.commons.compress.archivers.zip.ZipFile.&amp;lt;init&amp;gt;(ZipFile.java:216)
	at org.apache.commons.compress.archivers.zip.ZipFile.&amp;lt;init&amp;gt;(ZipFile.java:192)
	at org.apache.commons.compress.archivers.zip.ZipFile.&amp;lt;init&amp;gt;(ZipFile.java:153)
	at org.apache.tika.parser.pkg.ZipContainerDetector.detectZipFormat(ZipContainerDetector.java:141)
	at org.apache.tika.parser.pkg.ZipContainerDetector.detect(ZipContainerDetector.java:88)
	at org.apache.tika.detect.CompositeDetector.detect(CompositeDetector.java:77)
	at org.apache.tika.Tika.detect(Tika.java:155)
	at org.apache.tika.Tika.detect(Tika.java:183)
	at org.apache.tika.Tika.detect(Tika.java:223)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The zip file does contain two .jpg images and is not a &quot;special&quot; (JAR, Openoffice, ... ) zip file.&lt;/p&gt;

&lt;p&gt;Unfortunately, the contents of the zip file is confidential and so I cannot attach it to this ticket as it is, although I can provide the parameters supplied to&lt;br/&gt;
org.apache.commons.compress.archivers.zip.X7875_NewUnix.parseFromLocalFileData(X7875_NewUnix.java:199) as caught by the debugger:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;data = {&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[13]@2103}
 0 = 85
 1 = 84
 2 = 5
 3 = 0
 4 = 7
 5 = -112
 6 = -108
 7 = 51
 8 = 85
 9 = 117
 10 = 120
 11 = 0
 12 = 0
offset = 13
length = 0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This data comes from the local zip entry for the first file, it seems the method tries to read more bytes than is actually available in the buffer.&lt;/p&gt;

&lt;p&gt;It seems that first 9 bytes of the buffer are &apos;UT&apos; extended field with timestamp, followed by 0-sized &apos;ux&apos; field (bytes 9-12) that is supposed to contain UID/GID - according to infozip&apos;s doc the 0-size is common for global dictionary, but the local dictionary should contain complete data. In this case for some reason it does contain 0-sized data.&lt;/p&gt;

&lt;p&gt;Note that 7zip and unzip can unzip the file without even a warning, so Commons Compress should be also able to handle that file correctly without choking on that exception.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12857529">COMPRESS-321</key>
            <summary>Exception in X7875_NewUnix.parseFromLocalFileData when parsing 0-sized &quot;ux&quot; local entry</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bodewig">Stefan Bodewig</assignee>
                                    <reporter username="mpl">Martin Petricek</reporter>
                        <labels>
                    </labels>
                <created>Thu, 20 Aug 2015 13:09:45 +0000</created>
                <updated>Mon, 31 Aug 2015 12:20:19 +0000</updated>
                            <resolved>Mon, 31 Aug 2015 12:20:19 +0000</resolved>
                                    <version>1.9</version>
                    <version>1.10</version>
                                    <fixVersion>1.11</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14705301" author="garydgregory" created="Thu, 20 Aug 2015 17:09:11 +0000"  >&lt;p&gt;Can you try Commons Compress 1.10?&lt;/p&gt;

&lt;p&gt;Thank you.&lt;/p&gt;</comment>
                            <comment id="14705416" author="mpl" created="Thu, 20 Aug 2015 17:52:44 +0000"  >&lt;p&gt;I forced compress to 1.10 in maven, retried the test and the result is the same (just some small differences in line numbers)&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.ArrayIndexOutOfBoundsException: 13
	at org.apache.commons.compress.archivers.zip.X7875_NewUnix.parseFromLocalFileData(X7875_NewUnix.java:199)
	at org.apache.commons.compress.archivers.zip.X7875_NewUnix.parseFromCentralDirectoryData(X7875_NewUnix.java:220)
	at org.apache.commons.compress.archivers.zip.ExtraFieldUtils.parse(ExtraFieldUtils.java:174)
	at org.apache.commons.compress.archivers.zip.ZipArchiveEntry.setCentralDirectoryExtra(ZipArchiveEntry.java:561)
	at org.apache.commons.compress.archivers.zip.ZipFile.readCentralDirectoryEntry(ZipFile.java:616)
	at org.apache.commons.compress.archivers.zip.ZipFile.populateFromCentralDirectory(ZipFile.java:533)
	at org.apache.commons.compress.archivers.zip.ZipFile.&amp;lt;init&amp;gt;(ZipFile.java:216)
	at org.apache.commons.compress.archivers.zip.ZipFile.&amp;lt;init&amp;gt;(ZipFile.java:192)
	at org.apache.commons.compress.archivers.zip.ZipFile.&amp;lt;init&amp;gt;(ZipFile.java:153)
	at org.apache.tika.parser.pkg.ZipContainerDetector.detectZipFormat(ZipContainerDetector.java:141)
	at org.apache.tika.parser.pkg.ZipContainerDetector.detect(ZipContainerDetector.java:88)
	at org.apache.tika.detect.CompositeDetector.detect(CompositeDetector.java:77)
	at org.apache.tika.Tika.detect(Tika.java:155)
	at org.apache.tika.Tika.detect(Tika.java:183)
	at org.apache.tika.Tika.detect(Tika.java:223)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14705444" author="garydgregory" created="Thu, 20 Aug 2015 18:04:01 +0000"  >&lt;p&gt;Martin,&lt;/p&gt;

&lt;p&gt;Thank you for checking.&lt;/p&gt;

&lt;p&gt;Can you attach the problematic file to this ticket? Make sure it does not contain proprietary or personal information!&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;</comment>
                            <comment id="14705892" author="bodewig" created="Thu, 20 Aug 2015 22:25:45 +0000"  >&lt;p&gt;Martin has already said he cannot share it &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Unfortunately I haven&apos;t had the time to read zlib&apos;s spec of the extra field but it looks as if the uid/gid fields would both be optional and the extra field had already old us with a length of 0 (the two 0s following the bytes with values 117 and 120 in the dump are the size of the ux extra field).  This is a bug that may be present in some of the other extra field parsers as well.&lt;/p&gt;</comment>
                            <comment id="14708133" author="bodewig" created="Sat, 22 Aug 2015 19:04:09 +0000"  >&lt;p&gt;I think I&apos;ve fixed this with 1697106  is it possible you can try the next 1.11-SNAPSHOT build from &lt;a href=&quot;https://repository.apache.org/content/groups/snapshots&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/groups/snapshots&lt;/a&gt; ?&lt;/p&gt;</comment>
                            <comment id="14723240" author="mpl" created="Mon, 31 Aug 2015 09:04:14 +0000"  >&lt;p&gt;Tried with the 1.11-SNAPSHOT - the file is now correctly detected by Tika as application/zip, no more crashes inside X7875_NewUnix.parseFromLocalFileData. I guess that fixed this bug.&lt;/p&gt;</comment>
                            <comment id="14723351" author="bodewig" created="Mon, 31 Aug 2015 12:20:19 +0000"  >&lt;p&gt;Thanks, Martin&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 11 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2j5o7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>