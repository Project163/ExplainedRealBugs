<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:29:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[COMPRESS-64] Are the public finish() methods ArchiveOutputStream implementations necessary and safe?</title>
                <link>https://issues.apache.org/jira/browse/COMPRESS-64</link>
                <project id="12310904" key="COMPRESS">Commons Compress</project>
                    <description>&lt;p&gt;Some of the ArchiveOutputStream implementations have public finish() methods. These are currently only called from the close() methods.&lt;/p&gt;

&lt;p&gt;Seems to me that there is no need to allow the finish() methods to be called externally, and the user can corrupt the output if they do.&lt;/p&gt;

&lt;p&gt;Surely the close() method is all that is needed?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12421477">COMPRESS-64</key>
            <summary>Are the public finish() methods ArchiveOutputStream implementations necessary and safe?</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="sebb">Sebb</reporter>
                        <labels>
                    </labels>
                <created>Sat, 28 Mar 2009 14:12:07 +0000</created>
                <updated>Tue, 2 May 2023 17:11:25 +0000</updated>
                            <resolved>Thu, 23 Apr 2009 05:34:24 +0000</resolved>
                                    <version>1.0</version>
                                    <fixVersion>1.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12694029" author="bodewig" created="Tue, 31 Mar 2009 09:22:49 +0000"  >&lt;p&gt;see &lt;a href=&quot;https://issues.apache.org/jira/browse/COMPRESS-42&quot; title=&quot;[compress] bzip2 - implement flush()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COMPRESS-42&quot;&gt;&lt;del&gt;COMPRESS-42&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;flush comes in handy when you are writing to a network stream, for example.&lt;/p&gt;

&lt;p&gt;Whether our implementations are really safe is a totally different question 8-)&lt;/p&gt;</comment>
                            <comment id="12694048" author="sebb@apache.org" created="Tue, 31 Mar 2009 10:15:00 +0000"  >&lt;p&gt;I now think that the finish method may be useful for some archive types which allow arbitrary data to be added at the end of the archive.&lt;/p&gt;

&lt;p&gt;However, I think the method should throw an Exception if the user tries to call it twice.&lt;/p&gt;</comment>
                            <comment id="12697845" author="grobmeier" created="Fri, 10 Apr 2009 15:49:44 +0000"  >&lt;p&gt;Can you explain a bit more please?&lt;/p&gt;

&lt;p&gt;As far as I could see in the code at most times finish() should be called flush().&lt;br/&gt;
In ZipOutputStream finish() additionally writes the central directory end. If one would write after the CD, wouldn&apos;t the Zipfile be corrupted?&lt;/p&gt;

&lt;p&gt;Same goes for the other archives. Wouldn&apos;t writing arbitary data which is not an Entry corrupt the archive?&lt;/p&gt;

&lt;p&gt;However, behaviour of finish() differs from Zip to the other streams. Ar doesn&apos;t have a finish() method. Jar behaves like Zip (of course).&lt;/p&gt;</comment>
                            <comment id="12698997" author="sebb@apache.org" created="Wed, 15 Apr 2009 00:12:02 +0000"  >&lt;p&gt;AIUI, the finish() method is used to ensure that any required trailers etc are written to the output stream, i.e. may add data to the stream.&lt;br/&gt;
This is different from flush() which ensures that the output stream is written to disk (etc.), but does not add any data to the output stream.&lt;/p&gt;

&lt;p&gt;AR - no finish() method&lt;/p&gt;

&lt;p&gt;CPIO - calls closeArchiveEntry() if necessary and writes the trailer record&lt;/p&gt;

&lt;p&gt;TAR - writes the trailer&lt;/p&gt;

&lt;p&gt;ZIP/JAR - calls closeArchiveEntry() if necessary and writes the CFH and CD end.&lt;/p&gt;

&lt;p&gt;This is inconsistent - TAR does not call closeArchiveEntry(), though this may be needed.&lt;/p&gt;

&lt;p&gt;Seems to me that the user should be required to always call closeArchiveEntry() once for each putArchiveEntry(), i.e. finish() should only do whatever processing is needed at the end of an archive.  The finish() method should throw an Exception if the user forgets to close the entry, rather than silently tidying up for the user.&lt;/p&gt;

&lt;p&gt;The normal sequence of calls is:&lt;br/&gt;
+ create AOS class&lt;br/&gt;
+ write SFX header (optional, Zip only)&lt;br/&gt;
+ repeat as needed:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;- putArchiveEntry()&lt;/li&gt;
	&lt;li&gt;- write() entry data&lt;/li&gt;
	&lt;li&gt;- closeArchiveEntry()&lt;br/&gt;
+ finish()&lt;br/&gt;
+ write additional data if format supports it (optional)&lt;br/&gt;
+ close()&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This could be enforced by the ArchiveOutputStream class&lt;/p&gt;</comment>
                            <comment id="12699072" author="grobmeier" created="Wed, 15 Apr 2009 06:04:36 +0000"  >&lt;p&gt;I think this should be done before 1.0.&lt;/p&gt;</comment>
                            <comment id="12699145" author="sebb@apache.org" created="Wed, 15 Apr 2009 10:40:18 +0000"  >&lt;p&gt;Agreed - it may involve API changes.&lt;/p&gt;</comment>
                            <comment id="12701408" author="grobmeier" created="Wed, 22 Apr 2009 06:30:32 +0000"  >&lt;p&gt;The behaviour should now be consistent. &lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;finish() doesn&apos;t call closeArchiveEntry() if necessary&lt;/li&gt;
	&lt;li&gt;close() doesn&apos;t call finish() if necessary.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Everything is done in the subclasses. We may move the &quot;is entry open&quot; check to the super classes as suggested. Additionally a check for &quot;is finished&quot; should be done there. At the moment its easy to close an archive without calling finish(), which leads to corrupt archives. An exception should be thrown like in finish, if an entry is not closed.&lt;/p&gt;
</comment>
                            <comment id="12701813" author="grobmeier" created="Thu, 23 Apr 2009 05:34:24 +0000"  >&lt;p&gt;I don&apos;t see an elegant way to enforce this in the abstract class without increasing complexity. I think subclasses should care themself to implement that function. Since behaviour is consistent, Issue is resolved. If some think that the functionality should go to the abstract classes, please reopen and discuss your proposal on the dev list &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>110574</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 31 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0tftr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>169873</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>