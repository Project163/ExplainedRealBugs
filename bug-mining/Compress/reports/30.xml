<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:29:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[COMPRESS-87] ZipArchiveInputStream doesn&apos;t report the end of a truncated archive</title>
                <link>https://issues.apache.org/jira/browse/COMPRESS-87</link>
                <project id="12310904" key="COMPRESS">Commons Compress</project>
                    <description>&lt;p&gt;If a Zip archive is truncated, (e.g. because it is the first volume in a multi-volume archive) the ZipArchiveInputStream.read() method will not detect that fact. All calls to read() will return 0 bytes read. They will not return -1 (end of stream), nor will they throw any exception (which would seem like a good idea to me because the archive is truncated).&lt;/p&gt;

&lt;p&gt;I have tracked this problem to ZipArchiveInputStream.java, line 239. It contains a check&lt;/p&gt;

&lt;p&gt;if (read == 0 &amp;amp;&amp;amp; inf.finished()) {&lt;br/&gt;
    return -1;&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;For truncated archives the read is always zero but the inf is never finished(). I suggest adding two lines below:&lt;/p&gt;

&lt;p&gt;if (read == 0 &amp;amp;&amp;amp; inf.finished()) {&lt;br/&gt;
    return -1;&lt;br/&gt;
} else if (read == 0 &amp;amp;&amp;amp; lengthOfLastRead == -1) {&lt;br/&gt;
	throw new IOException(&quot;Truncated ZIP file&quot;);&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;This solves the problem in my tests.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12439017">COMPRESS-87</key>
            <summary>ZipArchiveInputStream doesn&apos;t report the end of a truncated archive</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bodewig">Stefan Bodewig</assignee>
                                    <reporter username="antheque">Antoni Mylka</reporter>
                        <labels>
                    </labels>
                <created>Sat, 24 Oct 2009 21:28:02 +0000</created>
                <updated>Wed, 5 May 2010 10:23:35 +0000</updated>
                            <resolved>Fri, 30 Oct 2009 05:30:55 +0000</resolved>
                                    <version>1.0</version>
                    <version>1.1</version>
                                    <fixVersion>1.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12769717" author="antheque" created="Sat, 24 Oct 2009 21:31:35 +0000"  >&lt;p&gt;A patch containing the two lines I talked about in the issue description as well as a unit test.&lt;/p&gt;

&lt;p&gt;The test file is a part of the Maven 2.2.1 distribution so it&apos;s already copyrighted by ASF. It should be placed in src/test/resources folder&lt;/p&gt;</comment>
                            <comment id="12769899" author="bodewig" created="Mon, 26 Oct 2009 05:15:48 +0000"  >&lt;p&gt;I&apos;ll look into this - thanks for the testcase - but let me add that in general ZipFile should be preferred over ZipArchiveInputStream when reading  file since the later may return entries that aren&apos;t supposed to be there at all.  ZipFile should terminate with a reasonable exception for truncated ZIPs OOTB.&lt;/p&gt;</comment>
                            <comment id="12770900" author="antheque" created="Wed, 28 Oct 2009 11:43:09 +0000"  >&lt;p&gt;I know, just that I need to crawl zips that aren&apos;t necessarily files (like zips attached to emails, or zips inside other zips). For this we have to use the stream and our crawler fell into an infinite loop waiting for the &apos;-1&apos; returned from read() method, and kept getting &apos;0&apos; instead. This is bad IMHO.&lt;/p&gt;</comment>
                            <comment id="12771808" author="bodewig" created="Fri, 30 Oct 2009 05:30:55 +0000"  >&lt;p&gt;I had to modify the test a little since the byte-counts for some existing entries were different on my Linux box (so I simply ignored them) and the first read of the last entry succeeded (with a count &amp;gt; 0) for me.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;

&lt;p&gt;svn revision 831204&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12455976">COMPRESS-96</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12423131" name="apache-maven-2.2.1.zip.001" size="65536" author="antheque" created="Sat, 24 Oct 2009 21:31:35 +0000"/>
                            <attachment id="12423130" name="commons-compress-87.patch" size="5579" author="antheque" created="Sat, 24 Oct 2009 21:31:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>110593</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 4 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0b4kf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>62852</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>