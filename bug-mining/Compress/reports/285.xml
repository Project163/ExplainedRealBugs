<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:32:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[COMPRESS-447] ArrayIndexOutOfBoundsException in ZipFile</title>
                <link>https://issues.apache.org/jira/browse/COMPRESS-447</link>
                <project id="12310904" key="COMPRESS">Commons Compress</project>
                    <description>&lt;p&gt;As part of a fuzzing run for a larger software that uses Apache Commons Compress ZipFile with the AFL-based Kelinci fuzzer found at &lt;a href=&quot;https://github.com/isstac/kelinci&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/isstac/kelinci&lt;/a&gt; I found the following ArrayIndexOutOfBoundsException issues:&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.lang.ArrayIndexOutOfBoundsException
&#160;&#160; &#160;at java.lang.&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.arraycopy(Native Method)
&#160;&#160; &#160;at org.apache.commons.compress.archivers.zip.X7875_NewUnix.parseFromLocalFileData(X7875_NewUnix.java:224)
&#160;&#160; &#160;at org.apache.commons.compress.archivers.zip.ExtraFieldUtils.parse(ExtraFieldUtils.java:179)
&#160;&#160; &#160;at org.apache.commons.compress.archivers.zip.ZipArchiveEntry.setExtra(ZipArchiveEntry.java:571)
&#160;&#160; &#160;at org.apache.commons.compress.archivers.zip.ZipFile.resolveLocalFileHeaderData(ZipFile.java:1042)
&#160;&#160; &#160;at org.apache.commons.compress.archivers.zip.ZipFile.&amp;lt;init&amp;gt;(ZipFile.java:291)
&#160;&#160; &#160;at org.apache.commons.compress.archivers.zip.ZipFile.&amp;lt;init&amp;gt;(ZipFile.java:213)
&#160;&#160; &#160;at org.apache.commons.compress.archivers.zip.ZipFile.&amp;lt;init&amp;gt;(ZipFile.java:196)
&#160;&#160; &#160;at org.apache.commons.compress.archivers.zip.ZipFile.&amp;lt;init&amp;gt;(ZipFile.java:157)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The issue can be reproduced with the attached files.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13152972">COMPRESS-447</key>
            <summary>ArrayIndexOutOfBoundsException in ZipFile</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="floyd">floyd</reporter>
                        <labels>
                            <label>zip</label>
                    </labels>
                <created>Tue, 17 Apr 2018 11:46:21 +0000</created>
                <updated>Wed, 30 May 2018 09:41:56 +0000</updated>
                            <resolved>Mon, 23 Apr 2018 10:01:06 +0000</resolved>
                                                    <fixVersion>1.17</fixVersion>
                                    <component>Archivers</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16440813" author="bodewig" created="Tue, 17 Apr 2018 12:45:59 +0000"  >&lt;p&gt;We&apos;ve had some similar discussion at the end of &lt;a href=&quot;https://issues.apache.org/jira/browse/COMPRESS-432&quot; title=&quot;Permanent Hang creating ZipFile(File)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COMPRESS-432&quot;&gt;&lt;del&gt;COMPRESS-432&lt;/del&gt;&lt;/a&gt; - it is unclear to me what the alternative to allowing the AIOBE bubbling up is. The file simply is not a valid ZIP archive when this happens.&lt;/p&gt;

&lt;p&gt;Most likely throwing a &lt;tt&gt;ZipException&lt;/tt&gt; would be more appropriate.&lt;/p&gt;</comment>
                            <comment id="16440817" author="bodewig" created="Tue, 17 Apr 2018 12:47:11 +0000"  >&lt;p&gt;Oh, and many thanks for the pointer to Kelinci.&lt;/p&gt;</comment>
                            <comment id="16440822" author="floyd" created="Tue, 17 Apr 2018 13:00:27 +0000"  >&lt;p&gt;I agree, simply throwing a ZipException would be more appropriate. In the end I think a developer simply can not be required to know that ZipFile could throw a AIOBE, but he could know that a ZipException might occur.&lt;/p&gt;

&lt;p&gt;fyi, Kelinci works best for me so far, but there are several Java fuzzers based on AFL coming up at the moment, I also know of the following:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/rohanpadhye/jqf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/rohanpadhye/jqf&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/Barro/java-afl&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/Barro/java-afl&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16440861" author="garydgregory" created="Tue, 17 Apr 2018 13:37:28 +0000"  >&lt;p&gt;So an explicit bounds check in &lt;tt&gt;X7875_NewUnix&lt;/tt&gt; and a thrown of &lt;tt&gt;ZipException&lt;/tt&gt;? Or catch and rethrow in the method? Or catch and rethrow of Exception further up the call chain?&lt;/p&gt;</comment>
                            <comment id="16440884" author="floyd" created="Tue, 17 Apr 2018 13:58:24 +0000"  >&lt;p&gt;In the end it probably doesn&apos;t matter this much (from my security point of view). Because when you parse an invalid zip file then that will fail anyway at one point and has to be communicated to the original caller. Honestly, I think I&apos;m not the right person to answer that, but an explicit bounds check in X7875_NewUnix sounds like a sane choice.&lt;/p&gt;</comment>
                            <comment id="16440922" author="garydgregory" created="Tue, 17 Apr 2018 14:30:26 +0000"  >&lt;p&gt;We could fix this one instance but if we we start down this road we need a consistent strategy since this component is full of array access and potential &quot;zip bomb&quot; locations (another separate issue.)&lt;/p&gt;

&lt;p&gt;So I&apos;d prefer we step back and reconsider. Since the user will get an exception anyway, maybe we should simplify our approach and add catches of Exception and rethrow an Commons Compress exception in the highest level of public APIs we provide. Or a middle approach, where the whole Zip component is reviewed and we catch Exception and rethrow ZipException for the highest level of our Zip APIs.&lt;/p&gt;

&lt;p&gt;Thoughts?&lt;/p&gt;</comment>
                            <comment id="16443702" author="floyd" created="Thu, 19 Apr 2018 08:07:19 +0000"  >&lt;p&gt;I&apos;ve actually reported these kind of issues at various places and expressed some more thoughts on &lt;a href=&quot;https://github.com/Gagravarr/VorbisJava/issues/27#issuecomment-382401977&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/Gagravarr/VorbisJava/issues/27#issuecomment-382401977&lt;/a&gt; for example.&lt;/p&gt;

&lt;p&gt;My thought is for file parsing, that maybe these kind of issues should be caught when we enter the &quot;use arbitrary indexes from file&quot; land. So maybe catch these kind of issues in that method that will start parsing and blindly trusting the file content? Because that&apos;s also where you can declare a ZipException&#160; and throw that one in any runtime exception case. I think catching runtime exceptions as early as possible is probably a good idea, but as you said this might not be the only place where such an issue exists, it might make sense to catch all these issues one level higher up. There is probably nothing wrong with keeping error details of the original exception in the ZipException.&lt;/p&gt;

&lt;p&gt;I wouldn&apos;t catch Exception in general though, I would start with AIOOB and maybe IllegalArgumentException for a start, which are things likely to occur when using indexes and doing file parsing.&lt;/p&gt;

&lt;p&gt;And again, I&apos;m not the guy who designs software on a daily basis, so maybe somebody else has some other insights &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16447272" author="bodewig" created="Sun, 22 Apr 2018 15:46:42 +0000"  >&lt;p&gt;I&apos;ve put the exception handler into &lt;tt&gt;ExtraFieldUtils#parse&lt;/tt&gt; as all parsing of extra fields is handled here. See &lt;a href=&quot;https://github.com/apache/commons-compress/commit/bd3e6cf204f249c2d60eca2268c8b9f402149f1b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-compress/commit/bd3e6cf204f249c2d60eca2268c8b9f402149f1b&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16447823" author="floyd" created="Mon, 23 Apr 2018 09:21:52 +0000"  >&lt;p&gt;Looks good to me, thanks!&lt;/p&gt;</comment>
                            <comment id="16447877" author="bodewig" created="Mon, 23 Apr 2018 10:01:06 +0000"  >&lt;p&gt;Great, thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12919394" name="7_uncaught_ArrayIndexOutOfBoundsException_1.zip" size="161" author="floyd" created="Tue, 17 Apr 2018 11:45:50 +0000"/>
                            <attachment id="12919393" name="7_uncaught_ArrayIndexOutOfBoundsException_2.zip" size="161" author="floyd" created="Tue, 17 Apr 2018 11:45:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 29 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3sn47:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>