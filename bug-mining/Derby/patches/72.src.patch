diff --git a/java/client/org/apache/derby/client/net/Reply.java b/java/client/org/apache/derby/client/net/Reply.java
index 5816aa367..f94cd3fee 100644
--- a/java/client/org/apache/derby/client/net/Reply.java
+++ b/java/client/org/apache/derby/client/net/Reply.java
@@ -1105,7 +1105,7 @@ public class Reply {
         case 4:
             ensureBLayerDataInBuffer(4);
             ddmScalarLen_ =
-                    ((buffer_[pos_++] & 0xff) << 32) +
+                    ((buffer_[pos_++] & 0xff) << 24) +
                     ((buffer_[pos_++] & 0xff) << 16) +
                     ((buffer_[pos_++] & 0xff) << 8) +
                     ((buffer_[pos_++] & 0xff) << 0);
@@ -1199,7 +1199,7 @@ public class Reply {
             // correctly in parseLengthAndMatchCodePoint(). (since the adjustLengths() method will
             // subtract the length from ddmScalarLen_)
             peekedLength_ =
-                    ((buffer_[pos_ + 4] & 0xff) << 32) +
+                    ((buffer_[pos_ + 4] & 0xff) << 24) +
                     ((buffer_[pos_ + 5] & 0xff) << 16) +
                     ((buffer_[pos_ + 6] & 0xff) << 8) +
                     ((buffer_[pos_ + 7] & 0xff) << 0);
diff --git a/java/drda/org/apache/derby/impl/drda/DDMReader.java b/java/drda/org/apache/derby/impl/drda/DDMReader.java
index da962f23c..da50905c8 100755
--- a/java/drda/org/apache/derby/impl/drda/DDMReader.java
+++ b/java/drda/org/apache/derby/impl/drda/DDMReader.java
@@ -537,11 +537,11 @@ class DDMReader
 			switch (numberOfExtendedLenBytes) {
 			case 8:
 				 ddmScalarLen =
-					((buffer[pos++] & 0xff) << 64) +
 					((buffer[pos++] & 0xff) << 56) +
 					((buffer[pos++] & 0xff) << 48) +
 					((buffer[pos++] & 0xff) << 40) +
 					((buffer[pos++] & 0xff) << 32) +
+					((buffer[pos++] & 0xff) << 24) +
 					((buffer[pos++] & 0xff) << 16) +
 					((buffer[pos++] & 0xff) << 8) +
 					((buffer[pos++] & 0xff) << 0);
@@ -549,9 +549,9 @@ class DDMReader
 				break;
 			case 6:
 				ddmScalarLen =
-					((buffer[pos++] & 0xff) << 48) +
 					((buffer[pos++] & 0xff) << 40) +
 					((buffer[pos++] & 0xff) << 32) +
+					((buffer[pos++] & 0xff) << 24) +
 					((buffer[pos++] & 0xff) << 16) +
 					((buffer[pos++] & 0xff) << 8) +
 					((buffer[pos++] & 0xff) << 0);
@@ -559,7 +559,7 @@ class DDMReader
 				break;
 			case 4:
 				ddmScalarLen =
-					((buffer[pos++] & 0xff) << 32) +
+					((buffer[pos++] & 0xff) << 24) +
 					((buffer[pos++] & 0xff) << 16) +
 					((buffer[pos++] & 0xff) << 8) +
 					((buffer[pos++] & 0xff) << 0);
diff --git a/java/testing/README.htm b/java/testing/README.htm
index 4c00d33e4..1fde65805 100644
--- a/java/testing/README.htm
+++ b/java/testing/README.htm
@@ -452,7 +452,25 @@ in errors. </li>
     </li>
   </ul>
   <ul>
-    <li>tested on a variety of hardware takes from 3.00 - 6.00 hours </li>
+    <li>tested on a variety of hardware takes from 3.00 - 6.00 hours</li>
+  </ul>
+  <li>largeData<br>
+  </li>
+  <ul>
+    <li>Contains tests that deal with large amounts of data and thus
+require more machine resources.&nbsp; This suite is NOT run as part of
+'derbyall' because the tests it contains require either 1) more machine
+resources than what the typical Derby developer might have, and/or 2) a
+significant amount of time to run, and thus shouldn't be run every
+night.<br>
+    </li>
+  </ul>
+  <ul>
+    <li>As tests are added to this quite, it could require more and
+more
+time to run (several minutes to several hours to several days), which
+is why it is NOT included as part of the derbyall suite.<br>
+    </li>
   </ul>
   <li><a href="#Note2:"><small>See Note2</small></a><br>
   </li>
@@ -1187,12 +1205,15 @@ using '^' as separator: <br>
 -DTestSpecialProps=derby.infolog.append=true
 org.apache.derbyTesting.functionTests.RunTest lang/arithmetic.sql <br>
 jvmflags<br>
-&nbsp;&nbsp;&nbsp; sets specific jvm properties for the jvm used in the test harness, for
-instance initial memory, and heap size, or properties normally passed on with a -D. For instance:
-<br>
+&nbsp;&nbsp;&nbsp; sets specific jvm properties for the jvm used in the
+test harness, for
+instance initial memory, and heap size, or properties normally passed
+on with a -D. For instance:
+      <br>
 &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; java
 -Djvmflags=ms32M -mx128M
-org.apache.derbyTesting.functionTests.RunTest lang/streamingColumn.java <br>
+org.apache.derbyTesting.functionTests.RunTest lang/streamingColumn.java
+      <br>
 excludeJCC<br>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; See above section <a
  href="#skipping">4.10</a><br>
diff --git a/java/testing/build.xml b/java/testing/build.xml
index 29bedd6e8..0c9d09e5e 100644
--- a/java/testing/build.xml
+++ b/java/testing/build.xml
@@ -52,6 +52,7 @@
     <ant dir="${derby.testing.src.dir}/${derby.testing.functest.dir}/tests/derbynet"/> 
     <ant dir="${derby.testing.src.dir}/${derby.testing.functest.dir}/tests/unit"/> 
     <ant dir="${derby.testing.src.dir}/${derby.testing.functest.dir}/tests/i18n"/> 
+    <ant dir="${derby.testing.src.dir}/${derby.testing.functest.dir}/tests/largedata"/> 
     <ant dir="${derby.testing.src.dir}/${derby.testing.functest.dir}/multi/stress"/> 
     <ant dir="${derby.testing.src.dir}/${derby.testing.functest.dir}/master"/> 
     <ant dir="${derby.testing.src.dir}/${derby.testing.suites.dir}"/> 
diff --git a/java/testing/org/apache/derbyTesting/functionTests/harness/NetServer.java b/java/testing/org/apache/derbyTesting/functionTests/harness/NetServer.java
index c21e499a0..d1bc96f9a 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/harness/NetServer.java
+++ b/java/testing/org/apache/derbyTesting/functionTests/harness/NetServer.java
@@ -158,14 +158,21 @@ public class NetServer
 		if ( (clPath != null) && (clPath.length()>0) )
 		    jvm.setClasspath(clPath);
 
-        if ( (jvmflags != null) && (jvmflags.length()>0) )
+        boolean setJvmFlags = false;
+        if ( (jvmflags != null) && (jvmflags.length()>0) ) {
             jvm.setFlags(jvmflags);
+            setJvmFlags = true;
+        }
 
 
         if (!jvmName.equals("jview"))
         {
-            jvm.setMs(16*1024*1024); // -ms16m
-            jvm.setMx(32*1024*1024); // -mx32m
+            if (setJvmFlags && (jvmflags.indexOf("-ms") == -1))
+            // only setMs if no starting memory was given
+                jvm.setMs(16*1024*1024); // -ms16m
+            if (setJvmFlags && (jvmflags.indexOf("-mx") == -1))
+            // only setMx if no max memory was given
+                jvm.setMx(32*1024*1024); // -mx32m
             jvm.setNoasyncgc(true); // -noasyncgc
         }
 
diff --git a/java/testing/org/apache/derbyTesting/functionTests/master/lobLengthTests.out b/java/testing/org/apache/derbyTesting/functionTests/master/lobLengthTests.out
new file mode 100644
index 000000000..abbe60e3b
--- /dev/null
+++ b/java/testing/org/apache/derbyTesting/functionTests/master/lobLengthTests.out
@@ -0,0 +1,2 @@
+Testing server read of lob length > 2^24 bytes.
+PASS.
diff --git a/java/testing/org/apache/derbyTesting/functionTests/suites/largeData.properties b/java/testing/org/apache/derbyTesting/functionTests/suites/largeData.properties
new file mode 100644
index 000000000..fa68e3b86
--- /dev/null
+++ b/java/testing/org/apache/derbyTesting/functionTests/suites/largeData.properties
@@ -0,0 +1 @@
+suites=largeDataTests largeDataNet largeDataClient
diff --git a/java/testing/org/apache/derbyTesting/functionTests/suites/largeDataClient.properties b/java/testing/org/apache/derbyTesting/functionTests/suites/largeDataClient.properties
new file mode 100644
index 000000000..00a44e102
--- /dev/null
+++ b/java/testing/org/apache/derbyTesting/functionTests/suites/largeDataClient.properties
@@ -0,0 +1,2 @@
+framework=DerbyNetClient
+suites=largeDataTests
diff --git a/java/testing/org/apache/derbyTesting/functionTests/suites/largeDataNet.properties b/java/testing/org/apache/derbyTesting/functionTests/suites/largeDataNet.properties
new file mode 100644
index 000000000..b959e305b
--- /dev/null
+++ b/java/testing/org/apache/derbyTesting/functionTests/suites/largeDataNet.properties
@@ -0,0 +1,2 @@
+framework=DerbyNet
+suites=largeDataTests
diff --git a/java/testing/org/apache/derbyTesting/functionTests/suites/largeDataTests.runall b/java/testing/org/apache/derbyTesting/functionTests/suites/largeDataTests.runall
new file mode 100644
index 000000000..11f697534
--- /dev/null
+++ b/java/testing/org/apache/derbyTesting/functionTests/suites/largeDataTests.runall
@@ -0,0 +1 @@
+largedata/lobLengthTests.java
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/largedata/build.xml b/java/testing/org/apache/derbyTesting/functionTests/tests/largedata/build.xml
new file mode 100644
index 000000000..26b4b1535
--- /dev/null
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/largedata/build.xml
@@ -0,0 +1,85 @@
+<?xml version="1.0"?>
+
+<!-- ==================================================================== -->
+<!--                       Derby build file                          -->
+<!-- ==================================================================== -->
+
+<project default="FTOtestsubdir" basedir="../../../../../../../.." >
+
+<!-- ==================================================================== -->
+<!--                           Set properties                             -->
+<!-- ==================================================================== -->
+
+  <!-- User settings -->
+  <property file="${user.home}/ant.properties"/>
+
+  <!-- Set property lib dir -->
+  <property name="properties.dir" value="tools/ant/properties" />
+
+  <!-- Significant dirs -->
+  <property file="${properties.dir}/dirs.properties"/>
+  <property file="${properties.dir}/derbytesting.properties"/>
+
+  <!-- Compiler settings -->
+  <property file="${properties.dir}/sane${sanity}.properties"/>
+  <property file="${properties.dir}/defaultcompiler.properties"/>
+  <property file="${properties.dir}/${build.compiler}.properties"/>
+
+  <!-- Parser properties -->
+  <!--property file="${properties.dir}/parser.properties"/-->
+
+  <!-- Compile-time classpath properties files -->
+  <property file="${properties.dir}/extrapath.properties"/>
+  <property file="${properties.dir}/compilepath.properties"/>
+
+  <!-- Release and Version info -->
+  <property file="${properties.dir}/release.properties"/>
+
+  <!-- derby testing specific properties files -->
+  <property file="${ant.home}/properties/derbytesting.properties"/>
+  <property file="${user.home}/properties/derbytesting.properties"/>
+  <property name="this.dir" value="${derby.testing.functest.dir}/tests/largedata"/>
+
+<!--             ============ Begin Targets ==============                -->
+ 
+  <target name="FTOtestsubdir" depends="compilet1,copyfiles"/>
+
+  <!-- mkdir / init target may not be necessary, just here for reference... -->
+  <target name="init">
+    <mkdir dir="${out.dir}/${derby.testing.functest.dir}/tests/largedata"/>
+  </target>
+
+  <target name="compilet1">
+    <javac
+      bootclasspath="${empty}"
+      nowarn="on"
+      debug="${debug}"
+      depend="${depend}"
+      deprecation="${deprecation}"
+      optimize="${optimize}"
+      proceed="${proceed}"
+      verbose="${verbose}" 
+      srcdir="${derby.testing.src.dir}"
+      destdir="${out.dir}">
+      <classpath>
+        <!--pathelement location="${oro}"/-->
+        <pathelement path="${compile.classpath}"/>
+      </classpath>
+      <include name="${this.dir}/*.java"/>
+    </javac>
+  </target>
+
+  <target name="copyfiles">
+    <copy todir="${out.dir}/${derby.testing.functest.dir}/tests/largedata">
+      <fileset dir="${derby.testing.src.dir}/${derby.testing.functest.dir}/tests/largedata" 
+        includesfile="${derby.testing.src.dir}/${derby.testing.functest.dir}/tests/largedata/copyfiles.ant"/>  
+    </copy>
+  </target> 
+
+
+<!--             ============= End Targets ==============                -->
+
+<!--             ============= End Project ==============                -->
+
+</project>
+
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/largedata/copyfiles.ant b/java/testing/org/apache/derbyTesting/functionTests/tests/largedata/copyfiles.ant
new file mode 100644
index 000000000..4fdc60c9e
--- /dev/null
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/largedata/copyfiles.ant
@@ -0,0 +1 @@
+lobLengthTests_app.properties
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/largedata/lobLengthTests.java b/java/testing/org/apache/derbyTesting/functionTests/tests/largedata/lobLengthTests.java
new file mode 100644
index 000000000..854f37d8a
--- /dev/null
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/largedata/lobLengthTests.java
@@ -0,0 +1,142 @@
+/*
+
+   Derby - Class org.apache.derbyTesting.functionTests.tests.largedata.lobLengthTests
+
+   Copyright 2003, 2005 The Apache Software Foundation or its licensors, as applicable.
+
+   Licensed under the Apache License, Version 2.0 (the "License");
+   you may not use this file except in compliance with the License.
+   You may obtain a copy of the License at
+
+      http://www.apache.org/licenses/LICENSE-2.0
+
+   Unless required by applicable law or agreed to in writing, software
+   distributed under the License is distributed on an "AS IS" BASIS,
+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+   See the License for the specific language governing permissions and
+   limitations under the License.
+
+ */
+
+package org.apache.derbyTesting.functionTests.tests.largedata;
+
+import java.sql.Connection;
+import java.sql.PreparedStatement;
+import java.sql.Statement;
+import java.sql.SQLException;
+
+import java.io.ByteArrayInputStream;
+
+import org.apache.derby.tools.ij;
+import org.apache.derby.tools.JDBCDisplayUtil;
+
+/**
+ * This test is part of the "largedata" suite because the use of
+ * very large LOBs can require extra memory for the server JVM.
+ * If this test was run as part of the normal 'derbyall' suite,
+ * it would require that any developer running the derbyall suite
+ * have a machine with a good deal of memory.  And since _every_
+ * developer is encouraged to run 'derbyall' before submitting
+ * any patches, that would mean that _every_ developer would
+ * need a machine with lots of memory--and that's something we
+ * do NOT want to require.
+ * 
+ * The specific JVM memory requirements for this test are set in the
+ * properties file for this test (lobLengthTests_app.properties).
+ * It started out as -mx128M -ms128M, but that could change in the
+ * future as more test cases are added to this class.  If it's not
+ * at least 128M, the result will be OutOfMemory exceptions when
+ * running against Network Server.
+ */
+
+public class lobLengthTests {
+
+    /**
+     * Create an instance of this class and do the test.
+     */
+    public static void main(String [] args)
+    {
+        new lobLengthTests().go(args);
+    }
+
+    /**
+     * Create a JDBC connection using the arguments passed
+     * in from the harness, and then run the LOB length
+     * tests.
+     * @param args Arguments from the harness.
+     */
+    public void go(String [] args)
+    {
+        try {
+
+            // use the ij utility to read the property file and
+            // make the initial connection.
+            ij.getPropertyArg(args);
+            Connection conn = ij.startJBMS();
+
+            // Add additional tests here.
+            derby_121Test(conn);
+
+        } catch (Exception e) {
+
+            System.out.println("FAIL -- Unexpected exception:");
+            e.printStackTrace(System.out);
+
+        }
+    }
+
+    /**
+     * There was a defect (DERBY-121) where the server and client
+     * were processing lob lengths incorrectly.  For lob lengths
+     * that are represented by 24 or more bits, the server and
+     * Derby client were doing incorrect bit-shifting.  This
+     * test makes sure that problem no longer occurs.
+     */
+    private static void derby_121Test(Connection conn)
+        throws SQLException
+    {
+        System.out.println("Testing server read of lob length > 2^24 bytes.");
+
+        boolean autoc = conn.getAutoCommit();
+        conn.setAutoCommit(false);
+
+        // Create a test table.
+        Statement st = conn.createStatement();
+        st.execute("create table lobTable100M(bl blob(100M))");
+
+        PreparedStatement pSt = conn.prepareStatement(
+            "insert into lobTable100M(bl) values (?)");
+
+        // The error we're testing occurs when the server
+        // is shifting bits 24 and higher of the lob's
+        // length (in bytes).  This means that, in order
+        // to check for the error, we have to specify a
+        // lob length (in bytes) that requires at least
+        // 24 bits to represent.  Thus for a blob the
+        // length of the test data must be specified as
+        // at least 2^24 bytes (hence the '16800000' in
+        // the next line).
+        byte [] bA = new byte[16800000];
+        pSt.setBinaryStream(1,
+            new java.io.ByteArrayInputStream(bA), bA.length);
+
+        // Now try the insert; this is where the server processes
+        // the lob length.
+        try {
+            pSt.execute();
+            System.out.println("PASS.");
+        } catch (Exception e) {
+            System.out.println("FAIL -- unexpected exception:");
+            e.printStackTrace(System.out);
+        }
+
+        // Clean up.
+        try {
+            st.execute("drop table lobTable100M");
+        } catch (SQLException se) {}
+
+        conn.setAutoCommit(autoc);
+        return;
+
+    }
+}
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/largedata/lobLengthTests_app.properties b/java/testing/org/apache/derbyTesting/functionTests/tests/largedata/lobLengthTests_app.properties
new file mode 100644
index 000000000..bdc54b33e
--- /dev/null
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/largedata/lobLengthTests_app.properties
@@ -0,0 +1,14 @@
+#
+# This is the system properties file for lobLengthTests.java
+#
+# *** DO NOT PUT PROPERTIES FOR THE DERBY SYSTEM IN THIS FILE.  
+# *** THEY BELONG IN lobLengthTests_derby.properties.
+#
+# This file will get handed to the test on the command line in a -p <filename>
+# argument.
+#
+# The .java test has to call util.getPropertyArg and util.startJBMS
+# to process the property file.  See any of the .java tests for this code.
+#
+database=jdbc:derby:wombat;create=true
+jvmflags=-mx128M -ms128M
