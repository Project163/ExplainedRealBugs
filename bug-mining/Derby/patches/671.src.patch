diff --git a/java/engine/org/apache/derby/iapi/services/loader/GeneratedByteCode.java b/java/engine/org/apache/derby/iapi/services/loader/GeneratedByteCode.java
index a53b82f00..802656844 100644
--- a/java/engine/org/apache/derby/iapi/services/loader/GeneratedByteCode.java
+++ b/java/engine/org/apache/derby/iapi/services/loader/GeneratedByteCode.java
@@ -35,7 +35,8 @@ public interface GeneratedByteCode {
 		Called by the class manager just after
 		creating the instance of the new class.
 	*/
-	public void initFromContext(Context context);
+	public void initFromContext(Context context)
+		throws StandardException;
 
 	/**
 		Set the Generated Class. Call by the class manager just after
diff --git a/java/engine/org/apache/derby/iapi/sql/conn/LanguageConnectionContext.java b/java/engine/org/apache/derby/iapi/sql/conn/LanguageConnectionContext.java
index 98d7218fa..461fc6df2 100644
--- a/java/engine/org/apache/derby/iapi/sql/conn/LanguageConnectionContext.java
+++ b/java/engine/org/apache/derby/iapi/sql/conn/LanguageConnectionContext.java
@@ -143,7 +143,13 @@ public interface LanguageConnectionContext extends Context {
 	 * Add the activation to those known about by this connection.
 	 *
 	 */
-	void addActivation(Activation a);
+	void addActivation(Activation a)
+		throws StandardException;
+
+	/**
+	 * Make a note that some activations are marked unused
+	 */
+	void notifyUnusedActivation();
 
 	/**
 	 * Remove the activation from those known about by this connection.
diff --git a/java/engine/org/apache/derby/impl/sql/conn/GenericLanguageConnectionContext.java b/java/engine/org/apache/derby/impl/sql/conn/GenericLanguageConnectionContext.java
index 7843f95e3..4c5ad6e68 100644
--- a/java/engine/org/apache/derby/impl/sql/conn/GenericLanguageConnectionContext.java
+++ b/java/engine/org/apache/derby/impl/sql/conn/GenericLanguageConnectionContext.java
@@ -116,6 +116,7 @@ public class GenericLanguageConnectionContext
 	 */
 
 	private final Vector acts;
+	private volatile boolean unusedActs=false;
 	protected int bindCount;
 	private boolean ddWriteMode;
 	private boolean runTimeStatisticsSetting ;
@@ -429,9 +430,32 @@ public class GenericLanguageConnectionContext
 	/**
 	 * Add the activation to those known about by this connection.
 	 */
-	public void addActivation(Activation a) {
+	public void addActivation(Activation a) 
+		throws StandardException {
 		acts.addElement(a);
 
+		// DERBY-418. Activations which are marked unused,
+		// are closed here. Activations Vector is iterated 
+		// to identify and close unused activations, only if 
+		// unusedActs flag is set to true and if the total 
+		// size exceeds 20.
+		if( (unusedActs) && (acts.size() > 20) ) {
+			unusedActs = false;
+			for (int i = acts.size() - 1; i >= 0; i--) {
+
+				// it maybe the case that a Activation's reset() ends up
+				// closing one or more activation leaving our index beyond
+				// the end of the array
+				if (i >= acts.size())
+					continue;
+
+				Activation a1 = (Activation) acts.elementAt(i);
+				if (!a1.isInUse()) {
+					a1.close();
+				}
+			}
+		}
+
 		if (SanityManager.DEBUG) {
 
 			if (SanityManager.DEBUG_ON("memoryLeakTrace")) {
@@ -442,6 +466,13 @@ public class GenericLanguageConnectionContext
 		}
 	}
 
+	/**
+	 * Make a note that some activations are marked unused
+	 */
+	public void notifyUnusedActivation() {
+	    unusedActs = true;
+	}
+
 	/**
 	 * @see LanguageConnectionContext#checkIfAnyDeclaredGlobalTempTablesForThisConnection
 	 */
diff --git a/java/engine/org/apache/derby/impl/sql/execute/BaseActivation.java b/java/engine/org/apache/derby/impl/sql/execute/BaseActivation.java
index 0d67e081f..894b96caa 100644
--- a/java/engine/org/apache/derby/impl/sql/execute/BaseActivation.java
+++ b/java/engine/org/apache/derby/impl/sql/execute/BaseActivation.java
@@ -125,7 +125,10 @@ public abstract class BaseActivation implements CursorActivation, GeneratedByteC
 	protected int numSubqueries;
 
 	private boolean singleExecution;
-	private boolean inUse;
+
+	// This flag is declared volatile to ensure it is 
+	// visible when it has been modified by the finalizer thread.
+	private volatile boolean inUse;
 
 	private java.sql.ResultSet targetVTI;
 	private SQLWarning warnings;
@@ -192,7 +195,8 @@ public abstract class BaseActivation implements CursorActivation, GeneratedByteC
 		super();
 	}
 
-	public final void initFromContext(Context context) {
+	public final void initFromContext(Context context) 
+		throws StandardException {
 
 		if (SanityManager.DEBUG)
 		{
@@ -786,7 +790,10 @@ public abstract class BaseActivation implements CursorActivation, GeneratedByteC
 	 */
 	public final void markUnused()
 	{
-		inUse = false;
+		if(isInUse()) {
+			inUse = false;
+			lcc.notifyUnusedActivation();
+		}
 	}
 
 	/**
