diff --git a/java/client/org/apache/derby/client/am/Connection.java b/java/client/org/apache/derby/client/am/Connection.java
index 12d99868b..9e00119ee 100644
--- a/java/client/org/apache/derby/client/am/Connection.java
+++ b/java/client/org/apache/derby/client/am/Connection.java
@@ -85,13 +85,29 @@ public abstract class Connection implements java.sql.Connection,
     protected boolean isXAConnection_ = false; // Indicates an XA connection
 
     // XA States
-    public static final int XA_LOCAL = 0;   //  No global transaction in process
-    public static final int XA_GLOBAL = 1;  // Global transaction in process
-    //TODO: Remove entirely once indoubtlist is gone.  
+    // The client needs to keep track of the connection's transaction branch association
+    // per table 2.6 in the XA+ specification in order to determine if commits should flow in
+    // autocommit mode.  There is no need to keep track of suspended transactions separately from
+    // XA_TO_NOT_ASSOCIATED.
+    // 
+    /**
+     * <code>XA_T0_NOT_ASSOCIATED</code>
+     * This connection is not currently associated with an XA transaction
+     * In this state commits will flow in autocommit mode.
+     */
+    public static final int XA_T0_NOT_ASSOCIATED = 0;   
+    
+    /**
+     * <code>XA_T1_ASSOCIATED</code>
+     * In this state commits will not flow in autocommit mode.
+     */
+    public static final int XA_T1_ASSOCIATED = 1;  
+    
+    //TODO: Remove XA_RECOVER entirely once indoubtlist is gone.  
     //public static final int XA_RECOVER = 14;
 
 
-    protected int xaState_ = XA_LOCAL;
+    protected int xaState_ = XA_T0_NOT_ASSOCIATED;
 
     // XA Host Type
     public int xaHostVersion_ = 0;
@@ -524,7 +540,7 @@ public abstract class Connection implements java.sql.Connection,
 
     public void writeCommit() throws SqlException {
         if (isXAConnection_) {
-            if ((xaState_ == XA_LOCAL) ) {
+            if ((xaState_ == XA_T0_NOT_ASSOCIATED) ) {
                 writeLocalXACommit_();
             }
         } else {
@@ -541,7 +557,7 @@ public abstract class Connection implements java.sql.Connection,
 
     public void readCommit() throws SqlException {
         if (isXAConnection_) {
-            if ((xaState_ == XA_LOCAL) ) {
+            if ((xaState_ == XA_T0_NOT_ASSOCIATED) ) {
                 readLocalXACommit_();               
             }
         } else {
@@ -749,7 +765,7 @@ public abstract class Connection implements java.sql.Connection,
     * 	Might be logically closed but available for reuse.
     *   @return true if physical connection still open
     */
-    public boolean isPhysicallyClosed() {
+    public boolean isPhysicalConnClosed() {
     return !open_ && !availableForReuse_; 
    }
 
diff --git a/java/client/org/apache/derby/client/am/Statement.java b/java/client/org/apache/derby/client/am/Statement.java
index 9e1752eab..bbae95d75 100644
--- a/java/client/org/apache/derby/client/am/Statement.java
+++ b/java/client/org/apache/derby/client/am/Statement.java
@@ -1189,7 +1189,7 @@ public class Statement implements java.sql.Statement, StatementCallbackInterface
         }
         if (connection_.autoCommit_ && requiresAutocommit) { // for the auto-commit;
             if (connection_.isXAConnection_) {
-                return (connection_.xaState_ == Connection.XA_LOCAL) ;
+                return (connection_.xaState_ == Connection.XA_T0_NOT_ASSOCIATED) ;
             } else {
                 return true;
             }
@@ -1268,7 +1268,7 @@ public class Statement implements java.sql.Statement, StatementCallbackInterface
         if (connection_.autoCommit_ && requiresAutocommit && isAutoCommittableStatement_) {
             connection_.writeAutoCommit();
             if (connection_.isXAConnection_) {
-                return (connection_.xaState_ == Connection.XA_LOCAL) ;
+                return (connection_.xaState_ == Connection.XA_T0_NOT_ASSOCIATED) ;
             } else {
                 return true;
             }
diff --git a/java/client/org/apache/derby/client/net/NetConnection.java b/java/client/org/apache/derby/client/net/NetConnection.java
index ab3b008ee..25cc6aae1 100644
--- a/java/client/org/apache/derby/client/net/NetConnection.java
+++ b/java/client/org/apache/derby/client/net/NetConnection.java
@@ -1367,7 +1367,7 @@ public class NetConnection extends org.apache.derby.client.am.Connection {
     // Allow local COMMIT/ROLLBACK only if we are not in an XA transaction
     protected boolean allowLocalCommitRollback_() throws org.apache.derby.client.am.SqlException {
        
-    	if (xaState_ == XA_LOCAL) {
+    	if (xaState_ == XA_T0_NOT_ASSOCIATED) {
             return true;
         }
         return false;
@@ -1471,7 +1471,7 @@ public class NetConnection extends org.apache.derby.client.am.Connection {
         int xaState = getXAState();
 
         
-        if (xaState == XA_LOCAL) {
+        if (xaState == XA_T0_NOT_ASSOCIATED) {
             doCommit = true;
         }
 
diff --git a/java/client/org/apache/derby/client/net/NetXAConnection.java b/java/client/org/apache/derby/client/net/NetXAConnection.java
index fa0c32c7b..b46ec1bff 100644
--- a/java/client/org/apache/derby/client/net/NetXAConnection.java
+++ b/java/client/org/apache/derby/client/net/NetXAConnection.java
@@ -132,7 +132,7 @@ public class NetXAConnection extends org.apache.derby.client.net.NetConnection {
         // this logic must be in sync with willAutoCommitGenerateFlow() logic
         if (isXAConnection_) { // XA Connection
             int xaState = getXAState();
-            if (xaState == XA_LOCAL){
+            if (xaState == XA_T0_NOT_ASSOCIATED){
                 xares_.callInfoArray_[xares_.conn_.currXACallInfoOffset_].xid_ =
                         NetXAResource.nullXid;
                 writeLocalXACommit_();
@@ -147,7 +147,7 @@ public class NetXAConnection extends org.apache.derby.client.net.NetConnection {
             int xaState = getXAState();
             NetXACallInfo callInfo = xares_.callInfoArray_[currXACallInfoOffset_];
             callInfo.xaRetVal_ = NetXAResource.XARETVAL_XAOK; // initialize XARETVAL
-            if (xaState == XA_LOCAL) {
+            if (xaState == XA_T0_NOT_ASSOCIATED) {
                 readLocalXACommit_();
                 //TODO: Remove
                 //setXAState(XA_LOCAL);
@@ -191,7 +191,7 @@ public class NetXAConnection extends org.apache.derby.client.net.NetConnection {
 
             // for all XA connectiions
             // TODO:KATHEY - Do we need this?
-            setXAState(XA_LOCAL);
+            setXAState(XA_T0_NOT_ASSOCIATED);
         } else {
             readLocalRollback_(); // non-XA connections
         }
diff --git a/java/client/org/apache/derby/client/net/NetXAResource.java b/java/client/org/apache/derby/client/net/NetXAResource.java
index 6b4c9475d..7aad9fab3 100644
--- a/java/client/org/apache/derby/client/net/NetXAResource.java
+++ b/java/client/org/apache/derby/client/net/NetXAResource.java
@@ -183,7 +183,7 @@ public class NetXAResource implements XAResource {
         if (conn_.agent_.loggingEnabled()) {
             conn_.agent_.logWriter_.traceEntry(this, "commit", xid, onePhase);
         }
-        if (conn_.isPhysicallyClosed()) {
+        if (conn_.isPhysicalConnClosed()) {
             connectionClosedFailure();
         }
 
@@ -215,9 +215,6 @@ public class NetXAResource implements XAResource {
         if (rc != XAResource.XA_OK) {
             throwXAException(rc, false);
         }
-        else {
-        	conn_.setXAState(Connection.XA_LOCAL);
-        }
     }
 
     /**
@@ -247,7 +244,7 @@ public class NetXAResource implements XAResource {
         if (conn_.agent_.loggingEnabled()) {
             conn_.agent_.logWriter_.traceEntry(this, "end", xid, flags);
         }
-        if (conn_.isPhysicallyClosed()) {
+        if (conn_.isPhysicalConnClosed()) {
             connectionClosedFailure();
         }
 
@@ -278,8 +275,9 @@ public class NetXAResource implements XAResource {
         }
         if (rc != XAResource.XA_OK) {
             throwXAException(rc, false);
+        }else {
+        	conn_.setXAState(Connection.XA_T0_NOT_ASSOCIATED);
         } 
-
     }
 
     /**
@@ -299,7 +297,7 @@ public class NetXAResource implements XAResource {
         if (conn_.agent_.loggingEnabled()) {
             conn_.agent_.logWriter_.traceEntry(this, "forget", xid);
         }
-        if (conn_.isPhysicallyClosed()) {
+        if (conn_.isPhysicalConnClosed()) {
             connectionClosedFailure();
         }
         NetXACallInfo callInfo = callInfoArray_[conn_.currXACallInfoOffset_];
@@ -352,7 +350,7 @@ public class NetXAResource implements XAResource {
             conn_.agent_.logWriter_.traceEntry(this, "getTransactionTimeout");
         }
         exceptionsOnXA = null;
-        if (conn_.isPhysicallyClosed()) {
+        if (conn_.isPhysicalConnClosed()) {
             connectionClosedFailure();
         }
 
@@ -381,7 +379,7 @@ public class NetXAResource implements XAResource {
         if (conn_.agent_.loggingEnabled()) {
             conn_.agent_.logWriter_.traceEntry(this, "prepare", xid);
         }
-        if (conn_.isPhysicallyClosed()) {
+        if (conn_.isPhysicalConnClosed()) {
             connectionClosedFailure();
         }
 
@@ -447,7 +445,7 @@ public class NetXAResource implements XAResource {
             conn_.agent_.logWriter_.traceEntry(this, "recover", flag);
         }
         exceptionsOnXA = null;
-        if (conn_.isPhysicallyClosed()) {
+        if (conn_.isPhysicalConnClosed()) {
             connectionClosedFailure();
         }
 
@@ -512,7 +510,7 @@ public class NetXAResource implements XAResource {
         if (conn_.agent_.loggingEnabled()) {
             conn_.agent_.logWriter_.traceEntry(this, "rollback", xid);
         }
-        if (conn_.isPhysicallyClosed()) {
+        if (conn_.isPhysicalConnClosed()) {
             connectionClosedFailure();
         }
 
@@ -543,9 +541,7 @@ public class NetXAResource implements XAResource {
         if (rc != XAResource.XA_OK) {
             throwXAException(rc, false);
         }
-        else {
-        	conn_.setXAState(Connection.XA_LOCAL);
-        }
+ 
     }
 
     /**
@@ -585,7 +581,7 @@ public class NetXAResource implements XAResource {
         if (conn_.agent_.loggingEnabled()) {
             conn_.agent_.logWriter_.traceEntry(this, "start", xid, flags);
         }
-        if (conn_.isPhysicallyClosed()) {
+        if (conn_.isPhysicalConnClosed()) {
             connectionClosedFailure();
         }
 
@@ -609,7 +605,7 @@ public class NetXAResource implements XAResource {
             // Setting this is currently required to avoid client from sending
             // commit for autocommit.
             if (rc == XARETVAL_XAOK) {
-                conn_.setXAState(Connection.XA_GLOBAL);
+                conn_.setXAState(Connection.XA_T1_ASSOCIATED);
             }
 
         } catch (SqlException sqle) {
@@ -626,7 +622,6 @@ public class NetXAResource implements XAResource {
 
 
     protected void throwXAException(int rc) throws XAException {
-        // By default, throwXAException will reset the state of the failed connection
         throwXAException(rc, rc != XAException.XAER_NOTA);
     }
 
@@ -735,9 +730,56 @@ public class NetXAResource implements XAResource {
                         sqlExceptions,
                         xaExceptionText);
         xaException.errorCode = rc;
+        setXaStateForXAException(rc); 
         throw xaException;
     }
 
+
+    /**
+     * Reset the transaction branch association state  to XA_T0_NOT_ASSOCIATED
+     * for XAER_RM* and XA_RB* Exceptions. All other exeptions leave the state 
+     * unchanged
+     * 
+     * @param rc  // return code from XAException
+     * @throws XAException
+     */
+    private void setXaStateForXAException(int rc) {
+    	switch (rc)
+		{
+        	// Reset to T0, not  associated for XA_RB*, RM*
+           // XAER_RMFAIL and XAER_RMERR will be fatal to the connection
+           // but that is not dealt with here
+           case javax.transaction.xa.XAException.XAER_RMFAIL:
+           case javax.transaction.xa.XAException.XAER_RMERR:
+           case javax.transaction.xa.XAException.XA_RBROLLBACK:
+           case javax.transaction.xa.XAException.XA_RBCOMMFAIL:
+           case javax.transaction.xa.XAException.XA_RBDEADLOCK:
+           case javax.transaction.xa.XAException.XA_RBINTEGRITY:
+           case javax.transaction.xa.XAException.XA_RBOTHER:
+           case javax.transaction.xa.XAException.XA_RBPROTO:
+           case javax.transaction.xa.XAException.XA_RBTIMEOUT:
+           case javax.transaction.xa.XAException.XA_RBTRANSIENT:
+           	conn_.setXAState(Connection.XA_T0_NOT_ASSOCIATED);
+           break;
+            // No change for other XAExceptions
+            // javax.transaction.xa.XAException.XA_NOMIGRATE
+           //javax.transaction.xa.XAException.XA_HEURHAZ
+           // javax.transaction.xa.XAException.XA_HEURCOM
+           // javax.transaction.xa.XAException.XA_HEURRB
+           // javax.transaction.xa.XAException.XA_HEURMIX
+           // javax.transaction.xa.XAException.XA_RETRY
+           // javax.transaction.xa.XAException.XA_RDONLY
+           // javax.transaction.xa.XAException.XAER_ASYNC
+           // javax.transaction.xa.XAException.XAER_NOTA
+           // javax.transaction.xa.XAException.XAER_INVAL                
+           // javax.transaction.xa.XAException.XAER_PROTO
+           // javax.transaction.xa.XAException.XAER_DUPID
+           // javax.transaction.xa.XAException.XAER_OUTSIDE            	
+            default:
+  			  return;
+		}	
+    }
+
     public boolean isSameRM(XAResource xares) throws XAException {
         boolean isSame = false; // preset that the RMs are NOT the same
         exceptionsOnXA = null;
@@ -745,7 +787,7 @@ public class NetXAResource implements XAResource {
         if (conn_.agent_.loggingEnabled()) {
             conn_.agent_.logWriter_.traceEntry(this, "isSameRM", xares);
         }
-        if (conn_.isPhysicallyClosed()) {
+        if (conn_.isPhysicalConnClosed()) {
             connectionClosedFailure();
         }
 
@@ -787,7 +829,7 @@ public class NetXAResource implements XAResource {
         }
         return isSame;
     }
-
+    
     public static boolean xidsEqual(Xid xid1, Xid xid2) { // determine if the 2 xids contain the same values even if not same object
         // comapre the format ids
         if (xid1.getFormatId() != xid2.getFormatId()) {
diff --git a/java/testing/org/apache/derbyTesting/functionTests/master/xaSimpleNegative.out b/java/testing/org/apache/derbyTesting/functionTests/master/xaSimpleNegative.out
index bbbcb9eae..39a0b09b3 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/master/xaSimpleNegative.out
+++ b/java/testing/org/apache/derbyTesting/functionTests/master/xaSimpleNegative.out
@@ -2,7 +2,7 @@ ij> --
 -- some negative test for error checking
 --
 xa_datasource 'wombat';
-ij> xa_connect user 'negativeTest';
+ij> xa_connect user 'negativeTest' password 'xxx';
 ij> -- start new transaction
 xa_start xa_noflags 0;
 ij> -- ERROR: cannot start without end
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/copyfiles.ant b/java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/copyfiles.ant
index d23696d0f..29c7992c2 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/copyfiles.ant
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/copyfiles.ant
@@ -63,4 +63,5 @@ xaSimpleNegative_sed.properties
 xaSimplePositive.sql
 xaSimplePositive_app.properties
 xaSimplePositive_sed.properties
+xaSimplePositive_derby.properties
 xaStateTran.sql
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/xaSimpleNegative.sql b/java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/xaSimpleNegative.sql
index f602a18ee..5bd4d6b54 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/xaSimpleNegative.sql
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/xaSimpleNegative.sql
@@ -2,7 +2,7 @@
 -- some negative test for error checking
 --
 xa_datasource 'wombat';
-xa_connect user 'negativeTest';
+xa_connect user 'negativeTest' password 'xxx';
 
 -- start new transaction
 xa_start xa_noflags 0;
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/xaSimplePositive_derby.properties b/java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/xaSimplePositive_derby.properties
new file mode 100644
index 000000000..a0543e6e4
--- /dev/null
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/xaSimplePositive_derby.properties
@@ -0,0 +1,4 @@
+#derby.drda.debug=true
+#derby.language.logStatementText=true
+#derby.stream.error.logSeverityLevel=0
+
