diff --git a/java/engine/org/apache/derby/iapi/reference/SQLState.java b/java/engine/org/apache/derby/iapi/reference/SQLState.java
index 158a21c2a..da346311a 100644
--- a/java/engine/org/apache/derby/iapi/reference/SQLState.java
+++ b/java/engine/org/apache/derby/iapi/reference/SQLState.java
@@ -222,6 +222,9 @@ public interface SQLState {
     String ENCRYPTION_BAD_JCE           = "XBCXJ.S";
     String ENCRYPTION_BAD_EXTERNAL_KEY  = "XBCXK.S";
     String ENCRYPTION_UNABLE_KEY_VERIFICATION  = "XBCXL.S";
+    String ENCRYPTION_INVALID_EXKEY_LENGTH          = "XBCXM.S";
+    String ENCRYPTION_ILLEGAL_EXKEY_CHARS           = "XBCXN.S";
+        
 	/*
 	** Cache Service
 	*/
diff --git a/java/engine/org/apache/derby/impl/services/jce/JCECipherFactory.java b/java/engine/org/apache/derby/impl/services/jce/JCECipherFactory.java
index b29173efe..009c7c336 100644
--- a/java/engine/org/apache/derby/impl/services/jce/JCECipherFactory.java
+++ b/java/engine/org/apache/derby/impl/services/jce/JCECipherFactory.java
@@ -546,6 +546,14 @@ public final class JCECipherFactory implements CipherFactory, ModuleControl, jav
 					throw StandardException.newException(SQLState.SERVICE_WRONG_BOOT_PASSWORD);
 
 				generatedKey = org.apache.derby.iapi.util.StringUtil.fromHexString(externalKey, 0, externalKey.length());
+                if (generatedKey == null) {
+                    throw StandardException.newException(
+                        // If length is even, we assume invalid character(s),
+                        // based on how 'fromHexString' behaves.
+                        externalKey.length() % 2 == 0 
+                            ? SQLState.ENCRYPTION_ILLEGAL_EXKEY_CHARS
+                            : SQLState.ENCRYPTION_INVALID_EXKEY_LENGTH);
+                }
 
 			} else {
 
diff --git a/java/engine/org/apache/derby/loc/messages_en.properties b/java/engine/org/apache/derby/loc/messages_en.properties
index 672c1ec46..ae25df696 100644
--- a/java/engine/org/apache/derby/loc/messages_en.properties
+++ b/java/engine/org/apache/derby/loc/messages_en.properties
@@ -83,6 +83,8 @@ XBCXI.S=The feedback mode ''{0}'' is not supported. Supported feedback modes are
 XBCXJ.S=The application is using a version of the Java Cryptography Extension (JCE) earlier than 1.2.1.  Please upgrade to JCE 1.2.1 and try the operation again.    
 XBCXK.S=The given encryption key does not match the encryption key used when creating the database. Please ensure that you are using the correct encryption key and try again. 
 XBCXL.S=The verification process for the encryption key was not successful. This could have been caused by an error when accessing the appropriate file to do the verification process.  See next exception for details.  
+XBCXM.S=The length of the external encryption key must be an even number.
+XBCXN.S=The external encryption key contains one or more illegal characters. Allowed characters for a hexedecimal number are 0-9, a-f and A-F.
 
 #../java/com/ibm/db2j/impl/BasicServices/CacheService/Generic/messages.properties
 
diff --git a/java/testing/org/apache/derbyTesting/functionTests/master/encryptionKey.out b/java/testing/org/apache/derbyTesting/functionTests/master/encryptionKey.out
index e27417493..321a7010c 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/master/encryptionKey.out
+++ b/java/testing/org/apache/derbyTesting/functionTests/master/encryptionKey.out
@@ -13,7 +13,10 @@ ij> ----------------------------------------------------------------------------
 --	   with right key
 --	   with wrong key
 --	   with right key
--- 	   test restoreFrom 
+--	   test restoreFrom
+-- Case 4: use invalid key when trying to create
+--     key length not even
+--     key contains invalid character(s)
 --	   
 ------------------------------------------------------------------------------------
 -- case1:	give external encryptionKey instead of bootpassword
@@ -113,4 +116,15 @@ I1         |C2
 --------------------------------
 1          |a                   
 ij(CONNECTION6)> disconnect;
+ij> -- case 4 : invalid keys
+-- key length not even
+connect 'jdbc:derby:encddbdb_invkey;create=true;dataEncryption=true;encryptionAlgorithm=DES/CBC/NoPadding;encryptionKey=123456789';
+ERROR XJ041: Failed to create database 'encddbdb_invkey', see the next exception for details.
+ERROR XBM01: Startup failed due to an exception. See next exception for details. 
+ERROR XBCXM: The length of the external encryption key must be an even number.
+ij> -- key contains illegal character(s)
+connect 'jdbc:derby:encddbdb_invkey;create=true;dataEncryption=true;encryptionAlgorithm=DES/CBC/NoPadding;encryptionKey=616263646566676869616263646565XY';
+ERROR XJ041: Failed to create database 'encddbdb_invkey', see the next exception for details.
+ERROR XBM01: Startup failed due to an exception. See next exception for details. 
+ERROR XBCXN: The external encryption key contains one or more illegal characters. Allowed characters for a hexedecimal number are 0-9, a-f and A-F.
 ij> 
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/store/encryptionKey.sql b/java/testing/org/apache/derbyTesting/functionTests/tests/store/encryptionKey.sql
index 9b51502d2..1afb6ce61 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/store/encryptionKey.sql
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/store/encryptionKey.sql
@@ -13,7 +13,10 @@
 --	   with right key
 --	   with wrong key
 --	   with right key
--- 	   test restoreFrom 
+--	   test restoreFrom
+-- Case 4: use invalid key when trying to create
+--     key length not even
+--     key contains invalid character(s)
 --	   
 ------------------------------------------------------------------------------------
 -- case1:	give external encryptionKey instead of bootpassword
@@ -83,3 +86,11 @@ disconnect;
 connect 'jdbc:derby:encdb;restoreFrom=extinout/mybackup2/encdb;dataEncryption=true;encryptionAlgorithm=DES/CBC/NoPadding;encryptionKey=61626364656667686961626364656568';
 select * from t1;
 disconnect;
+
+-- case 4 : invalid keys
+-- key length not even
+connect 'jdbc:derby:encddbdb_invkey;create=true;dataEncryption=true;encryptionAlgorithm=DES/CBC/NoPadding;encryptionKey=123456789';
+
+-- key contains illegal character(s)
+connect 'jdbc:derby:encddbdb_invkey;create=true;dataEncryption=true;encryptionAlgorithm=DES/CBC/NoPadding;encryptionKey=616263646566676869616263646565XY';
+
