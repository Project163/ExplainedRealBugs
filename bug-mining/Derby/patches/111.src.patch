diff --git a/java/engine/org/apache/derby/iapi/services/loader/ClassFactory.java b/java/engine/org/apache/derby/iapi/services/loader/ClassFactory.java
index fd16b84be..bc94af6c3 100755
--- a/java/engine/org/apache/derby/iapi/services/loader/ClassFactory.java
+++ b/java/engine/org/apache/derby/iapi/services/loader/ClassFactory.java
@@ -51,7 +51,8 @@ public interface ClassFactory {
 	/**
 		Load an application class, or a class that is potentially an application class.
 
-		@exception ClassNotFoundException Class cannot be found
+		@exception ClassNotFoundException Class cannot be found, or
+		a SecurityException or LinkageException was thrown loading the class.
 	*/
 	public Class loadApplicationClass(String className)
 		throws ClassNotFoundException;
@@ -59,7 +60,8 @@ public interface ClassFactory {
 	/**
 		Load an application class, or a class that is potentially an application class.
 
-		@exception ClassNotFoundException Class cannot be found
+		@exception ClassNotFoundException Class cannot be found, or
+		a SecurityException or LinkageException was thrown loading the class.
 	*/
 	public Class loadApplicationClass(ObjectStreamClass classDescriptor)
 		throws ClassNotFoundException;
diff --git a/java/engine/org/apache/derby/iapi/services/loader/ClassInspector.java b/java/engine/org/apache/derby/iapi/services/loader/ClassInspector.java
index 79d5d16f4..691956156 100755
--- a/java/engine/org/apache/derby/iapi/services/loader/ClassInspector.java
+++ b/java/engine/org/apache/derby/iapi/services/loader/ClassInspector.java
@@ -794,7 +794,8 @@ nextMethod:	for (int i = 0; i < methods.length; i++) {
 		and primitive types.
 		This will attempt to load the class from the application set.
 
-		@exception ClassNotFoundException Class cannot be found.
+		@exception ClassNotFoundException Class cannot be found, or
+		a SecurityException or LinkageException was thrown loading the class.
 	*/
 	public Class getClass(String className) throws ClassNotFoundException {
 
diff --git a/java/engine/org/apache/derby/iapi/types/TypeId.java b/java/engine/org/apache/derby/iapi/types/TypeId.java
index 72c690ed8..2bb9d87b2 100755
--- a/java/engine/org/apache/derby/iapi/types/TypeId.java
+++ b/java/engine/org/apache/derby/iapi/types/TypeId.java
@@ -1267,10 +1267,6 @@ public final class TypeId implements Formatable
                                 {
                                         orderable = false;
                                 } 
-                                catch (LinkageError le) 
-                                {
-                                        orderable = false;
-                                }
                                 break;
 
                         default:
diff --git a/java/engine/org/apache/derby/impl/services/reflect/DatabaseClasses.java b/java/engine/org/apache/derby/impl/services/reflect/DatabaseClasses.java
index 37c9cc896..9fead5c3a 100755
--- a/java/engine/org/apache/derby/impl/services/reflect/DatabaseClasses.java
+++ b/java/engine/org/apache/derby/impl/services/reflect/DatabaseClasses.java
@@ -76,7 +76,7 @@ import java.io.Serializable;
 	@see org.apache.derby.iapi.services.loader.ClassFactory
 */
 
-public abstract class DatabaseClasses
+abstract class DatabaseClasses
 	implements ClassFactory, ModuleControl
 {
 	/*
@@ -92,7 +92,7 @@ public abstract class DatabaseClasses
 	** Constructor
 	*/
 
-	public DatabaseClasses() {
+	DatabaseClasses() {
 	}
 
 	/*
@@ -208,22 +208,36 @@ public abstract class DatabaseClasses
 	public final Class loadApplicationClass(String className)
 		throws ClassNotFoundException {
 
+		Throwable loadError;
 		try {
-			return loadClassNotInDatabaseJar(className);
-		} catch (ClassNotFoundException cnfe) {
-			if (applicationLoader == null)
-				throw cnfe;
-			Class c = applicationLoader.loadClass(className, true);
-			if (c == null)
-				throw cnfe;
-			return c;
+			try {
+				return loadClassNotInDatabaseJar(className);
+			} catch (ClassNotFoundException cnfe) {
+				if (applicationLoader == null)
+					throw cnfe;
+				Class c = applicationLoader.loadClass(className, true);
+				if (c == null)
+					throw cnfe;
+				return c;
+			}
 		}
+		catch (SecurityException se)
+		{
+			// Thrown if the class has been comprimised in some
+			// way, e.g. modified in a signed jar.
+			loadError = se;	
+		}
+		catch (LinkageError le)
+		{
+			// some error linking the jar, again could
+			// be malicious code inserted into a jar.
+			loadError = le;	
+		}
+		throw new ClassNotFoundException(className + " : " + loadError.getMessage());
 	}
-
-	Class loadClassNotInDatabaseJar(String className) throws ClassNotFoundException {
-		return Class.forName(className);
-	}
-
+	
+	abstract Class loadClassNotInDatabaseJar(String className)
+		throws ClassNotFoundException;
 
 	public final Class loadApplicationClass(ObjectStreamClass classDescriptor)
 		throws ClassNotFoundException {
diff --git a/java/engine/org/apache/derby/impl/services/reflect/ReflectClassesJava2.java b/java/engine/org/apache/derby/impl/services/reflect/ReflectClassesJava2.java
index 34eda72a1..bc8b28c31 100755
--- a/java/engine/org/apache/derby/impl/services/reflect/ReflectClassesJava2.java
+++ b/java/engine/org/apache/derby/impl/services/reflect/ReflectClassesJava2.java
@@ -31,7 +31,7 @@ public final class ReflectClassesJava2 extends DatabaseClasses
 
 	private java.util.HashMap preCompiled;
 
-	private int action;
+	private int action = -1;
 
 	synchronized LoadedGeneratedClass loadGeneratedClassFromData(String fullyQualifiedName, ByteArray classDump) {
 
@@ -62,21 +62,27 @@ public final class ReflectClassesJava2 extends DatabaseClasses
 	}
 
 	public final Object run() {
-		// SECURITY PERMISSION - MP2
-		switch (action) {
-		case 1:
-			return new ReflectLoaderJava2(getClass().getClassLoader(), this);
-		case 2:
-			return Thread.currentThread().getContextClassLoader();
-		default:
-			return null;
+
+		try {
+			// SECURITY PERMISSION - MP2
+			switch (action) {
+			case 1:
+				return new ReflectLoaderJava2(getClass().getClassLoader(), this);
+			case 2:
+				return Thread.currentThread().getContextClassLoader();
+			default:
+				return null;
+			}
+		} finally {
+			action = -1;
 		}
+		
 	}
 
-	synchronized Class loadClassNotInDatabaseJar(String name) throws ClassNotFoundException {
+	Class loadClassNotInDatabaseJar(String name) throws ClassNotFoundException {
 		
 		Class foundClass = null;
-		action = 2;
+		
 	    // We may have two problems with calling  getContextClassLoader()
 	    // when trying to find our own classes for aggregates.
 	    // 1) If using the URLClassLoader a ClassNotFoundException may be 
@@ -88,8 +94,12 @@ public final class ReflectClassesJava2 extends DatabaseClasses
 	    // (the classLoader that loaded Cloudscape). 
 	    // So we call Class.forName to ensure that we find the class.
         try {
-            ClassLoader cl = ((ClassLoader)
+        	ClassLoader cl;
+        	synchronized(this) {
+        	  action = 2;
+              cl = ((ClassLoader)
 			      java.security.AccessController.doPrivileged(this));
+        	}
 			
 			foundClass = (cl != null) ?  cl.loadClass(name) 
 				      :Class.forName(name);
diff --git a/java/engine/org/apache/derby/impl/sql/compile/ColumnDefinitionNode.java b/java/engine/org/apache/derby/impl/sql/compile/ColumnDefinitionNode.java
index 3430dcaf2..86cf5bf83 100755
--- a/java/engine/org/apache/derby/impl/sql/compile/ColumnDefinitionNode.java
+++ b/java/engine/org/apache/derby/impl/sql/compile/ColumnDefinitionNode.java
@@ -306,8 +306,6 @@ public class ColumnDefinitionNode extends TableElementNode
 			foundMatch = classInspector.accessible(columnTypeName);
 		} catch (ClassNotFoundException cnfe) {
 			reason = cnfe;
-		} catch (LinkageError le) {
-			reason = le;
 		}
 
 		if (!foundMatch)
diff --git a/java/engine/org/apache/derby/impl/sql/compile/QueryTreeNode.java b/java/engine/org/apache/derby/impl/sql/compile/QueryTreeNode.java
index 87ac5d02a..8b067b46f 100755
--- a/java/engine/org/apache/derby/impl/sql/compile/QueryTreeNode.java
+++ b/java/engine/org/apache/derby/impl/sql/compile/QueryTreeNode.java
@@ -1559,8 +1559,6 @@ public abstract class QueryTreeNode implements Visitable
 		} catch (ClassNotFoundException cnfe) {
 
 			reason = cnfe;
-		} catch (LinkageError le) {
-			reason = le;
 		}
 
 		if (!foundMatch)
diff --git a/java/engine/org/apache/derby/impl/sql/execute/CreateAliasConstantAction.java b/java/engine/org/apache/derby/impl/sql/execute/CreateAliasConstantAction.java
index 618882db4..c9696884b 100755
--- a/java/engine/org/apache/derby/impl/sql/execute/CreateAliasConstantAction.java
+++ b/java/engine/org/apache/derby/impl/sql/execute/CreateAliasConstantAction.java
@@ -211,7 +211,7 @@ class CreateAliasConstantAction extends DDLConstantAction
 				// Does the class exist?
 				realClass = cf.loadApplicationClass(checkClassName);
 			}
-			catch (Throwable t)
+			catch (ClassNotFoundException t)
 			{
 				throw StandardException.newException(SQLState.LANG_TYPE_DOESNT_EXIST2, t, checkClassName);
 			}
diff --git a/java/testing/org/apache/derbyTesting/functionTests/master/dcl.out b/java/testing/org/apache/derbyTesting/functionTests/master/dcl.out
index 37590edf9..c267c8f80 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/master/dcl.out
+++ b/java/testing/org/apache/derbyTesting/functionTests/master/dcl.out
@@ -97,6 +97,53 @@ penguin@antartic.com          |0
 big@blue.com                  |0     
 spammer@ripoff.com            |0     
 open@source.org               |1     
+ij> -- function that gets the signers of the class (loaded from the jar)
+create function EMC.GETSIGNERS(CLASS_NAME VARCHAR(256))
+RETURNS VARCHAR(60)
+NO SQL
+external name 'org.apache.derbyTesting.databaseclassloader.emc.getSigners'
+language java parameter style java;
+0 rows inserted/updated/deleted
+ij> -- at this point the jar is not signed, NULL expected
+VALUES EMC.GETSIGNERS('org.apache.derbyTesting.databaseclassloader.emc');
+1                                                                                                                               
+--------------------------------------------------------------------------------------------------------------------------------
+NULL                                                                                                                            
+ij> -- Replace with a signed jar
+-- (self signed certificate)
+--
+-- Commands used to sign jar
+-- keytool -genkey -dname "cn=EMC CTO, ou=EMC APP, o=Easy Mail Company, c=US" -alias emccto -keypass kpi135 -keystore emcks -storepass ab987c
+-- keytool -selfcert -alias emccto -keypass kpi135 -keystore emcks -storepass ab987c
+-- jarsigner -keystore emcks -storepass ab987c -keypass kpi135 -signedjar dcl_emc2s.jar dcl_emc2.jar emccto
+--
+--
+CALL SQLJ.REPLACE_JAR('file:dcl_emc2s.jar', 'EMC.MAIL_APP');
+0 rows inserted/updated/deleted
+ij> VALUES EMC.GETSIGNERS('org.apache.derbyTesting.databaseclassloader.emc');
+1                                                                                                                               
+--------------------------------------------------------------------------------------------------------------------------------
+CN=EMC CTO, OU=EMC APP, O=Easy Mail Company, C=US                                                                               
+ij> -- other jar should not be signed
+VALUES EMC.GETSIGNERS('org.apache.derbyTesting.databaseclassloader.addon.vendor.util');
+1                                                                                                                               
+--------------------------------------------------------------------------------------------------------------------------------
+NULL                                                                                                                            
+ij> -- replace with a hacked jar file, emc.class modified to diable
+-- valid e-mail address check but using same signatures.
+-- ie direct replacement of the .class file.
+CALL SQLJ.REPLACE_JAR('file:dcl_emc2sm.jar', 'EMC.MAIL_APP');
+0 rows inserted/updated/deleted
+ij> CALL EMC.ADDCONTACT(99, 'spamking@cracker.org');
+ERROR 42X51: The class 'org.apache.derbyTesting.databaseclassloader.emc' does not exist or is inaccessible. This can happen if the class is not public.
+ERROR XJ001: Java exception: 'org.apache.derbyTesting.databaseclassloader.emc : Security exception thrown accessing class org.apache.derbyTesting.databaseclassloader.emc in jar "EMC"."MAIL_APP" : SHA1 digest error for org/apache/derbyTesting/databaseclassloader/emc.class: java.lang.ClassNotFoundException'.
+ij> -- replace with a hacked jar file, emc.class modified to 
+-- be an invalid jar file (no signing on this jar).
+CALL SQLJ.REPLACE_JAR('file:dcl_emc2l.jar', 'EMC.MAIL_APP');
+0 rows inserted/updated/deleted
+ij> CALL EMC.ADDCONTACT(999, 'spamking2@cracker.org');
+ERROR 42X51: The class 'org.apache.derbyTesting.databaseclassloader.emc' does not exist or is inaccessible. This can happen if the class is not public.
+ERROR XJ001: Java exception: 'org.apache.derbyTesting.databaseclassloader.emc : org/apache/derbyTesting/databaseclassloader/emc (Unsupported major.minor version 32558.32639): java.lang.ClassNotFoundException'.
 ij> -- cleanup
 CALL SQLJ.REMOVE_JAR('EMC.MAIL_APP', 0);
 ERROR X0X07: Cannot drop jar file '"EMC"."MAIL_APP"' because its on your db2j.database.classpath '"EMC"."MAIL_APP"'.
@@ -109,6 +156,8 @@ ij> CALL SQLJ.REMOVE_JAR('EMC.MAIL_APP', 0);
 0 rows inserted/updated/deleted
 ij> DROP PROCEDURE EMC.ADDCONTACT;
 0 rows inserted/updated/deleted
+ij> DROP FUNCTION EMC.GETSIGNERS;
+0 rows inserted/updated/deleted
 ij> select e_mail, "emcAddOn".VALIDCONTACT(e_mail) from EMC.CONTACTS;
 E_MAIL                        |2     
 -------------------------------------
diff --git a/java/testing/org/apache/derbyTesting/functionTests/master/jdk15/dcl.out b/java/testing/org/apache/derbyTesting/functionTests/master/jdk15/dcl.out
new file mode 100644
index 000000000..f27a35114
--- /dev/null
+++ b/java/testing/org/apache/derbyTesting/functionTests/master/jdk15/dcl.out
@@ -0,0 +1,180 @@
+ij> -- test database class loading.
+create schema emc;
+0 rows inserted/updated/deleted
+ij> set schema emc;
+0 rows inserted/updated/deleted
+ij> create table contacts (id int primary key, e_mail varchar(30));
+0 rows inserted/updated/deleted
+ij> create procedure EMC.ADDCONTACT(id INT, e_mail VARCHAR(30))
+MODIFIES SQL DATA
+external name 'org.apache.derbyTesting.databaseclassloader.emc.addContact'
+language java parameter style java;
+0 rows inserted/updated/deleted
+ij> -- fails because no class in classpath, 
+CALL EMC.ADDCONTACT(1, 'bill@somecompany.com');
+ERROR 42X51: The class 'org.apache.derbyTesting.databaseclassloader.emc' does not exist or is inaccessible. This can happen if the class is not public.
+ERROR XJ001: Java exception: 'org.apache.derbyTesting.databaseclassloader.emc: java.lang.ClassNotFoundException'.
+ij> -- install the jar, copied there by the magic of supportfiles
+-- in the test harness (dcl_app.properties). The source for
+-- the class is contained within the jar for reference.
+CALL SQLJ.INSTALL_JAR('file:dcl_emc1.jar', 'EMC.MAIL_APP', 0);
+0 rows inserted/updated/deleted
+ij> -- fails because no class not in classpath, jar file not in database classpath.
+CALL EMC.ADDCONTACT(1, 'bill@somecompany.com');
+ERROR 42X51: The class 'org.apache.derbyTesting.databaseclassloader.emc' does not exist or is inaccessible. This can happen if the class is not public.
+ERROR XJ001: Java exception: 'org.apache.derbyTesting.databaseclassloader.emc: java.lang.ClassNotFoundException'.
+ij> -- now add this into the database class path
+call SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY('derby.database.classpath', 'EMC.MAIL_APP');
+0 rows inserted/updated/deleted
+ij> -- all should work now
+CALL EMC.ADDCONTACT(1, 'bill@ruletheworld.com');
+0 rows inserted/updated/deleted
+ij> CALL EMC.ADDCONTACT(2, 'penguin@antartic.com');
+0 rows inserted/updated/deleted
+ij> SELECT id, e_mail from EMC.CONTACTS;
+ID         |E_MAIL                        
+------------------------------------------
+1          |bill@ruletheworld.com         
+2          |penguin@antartic.com          
+ij> -- now the application needs to track if e-mails are valid
+ALTER TABLE EMC.CONTACTS ADD COLUMN OK SMALLINT;
+0 rows inserted/updated/deleted
+ij> SELECT id, e_mail, ok from EMC.CONTACTS;
+ID         |E_MAIL                        |OK    
+-------------------------------------------------
+1          |bill@ruletheworld.com         |NULL  
+2          |penguin@antartic.com          |NULL  
+ij> -- well written application, INSERT used explicit column names
+-- ok defaults to NULL
+CALL EMC.ADDCONTACT(3, 'big@blue.com');
+0 rows inserted/updated/deleted
+ij> SELECT id, e_mail, ok from EMC.CONTACTS;
+ID         |E_MAIL                        |OK    
+-------------------------------------------------
+1          |bill@ruletheworld.com         |NULL  
+2          |penguin@antartic.com          |NULL  
+3          |big@blue.com                  |NULL  
+ij> -- now change the application to run checks on the e-mail
+-- address to ensure it is valid (in this case by seeing if
+-- simply includes 'spam' in the title.
+CALL SQLJ.REPLACE_JAR('file:dcl_emc2.jar', 'EMC.MAIL_APP');
+0 rows inserted/updated/deleted
+ij> CALL EMC.ADDCONTACT(4, 'spammer@ripoff.com');
+0 rows inserted/updated/deleted
+ij> CALL EMC.ADDCONTACT(5, 'open@source.org');
+0 rows inserted/updated/deleted
+ij> SELECT id, e_mail, ok from EMC.CONTACTS;
+ID         |E_MAIL                        |OK    
+-------------------------------------------------
+1          |bill@ruletheworld.com         |NULL  
+2          |penguin@antartic.com          |NULL  
+3          |big@blue.com                  |NULL  
+4          |spammer@ripoff.com            |0     
+5          |open@source.org               |1     
+ij> -- now add another jar in to test two jars and
+-- a quoted identifer for the jar names.
+create schema "emcAddOn";
+0 rows inserted/updated/deleted
+ij> set schema emcAddOn;
+ERROR 42Y07: Schema 'EMCADDON' does not exist
+ij> set schema "emcAddOn";
+0 rows inserted/updated/deleted
+ij> create function "emcAddOn".VALIDCONTACT(e_mail VARCHAR(30))
+RETURNS SMALLINT
+READS SQL DATA
+external name 'org.apache.derbyTesting.databaseclassloader.addon.vendor.util.valid'
+language java parameter style java;
+0 rows inserted/updated/deleted
+ij> CALL SQLJ.INSTALL_JAR('file:dcl_emcaddon.jar', '"emcAddOn"."MailAddOn"', 0);
+0 rows inserted/updated/deleted
+ij> call SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY('derby.database.classpath', 'EMC.MAIL_APP:"emcAddOn"."MailAddOn"');
+0 rows inserted/updated/deleted
+ij> select e_mail, "emcAddOn".VALIDCONTACT(e_mail) from EMC.CONTACTS;
+E_MAIL                        |2     
+-------------------------------------
+bill@ruletheworld.com         |0     
+penguin@antartic.com          |0     
+big@blue.com                  |0     
+spammer@ripoff.com            |0     
+open@source.org               |1     
+ij> -- function that gets the signers of the class (loaded from the jar)
+create function EMC.GETSIGNERS(CLASS_NAME VARCHAR(256))
+RETURNS VARCHAR(60)
+NO SQL
+external name 'org.apache.derbyTesting.databaseclassloader.emc.getSigners'
+language java parameter style java;
+0 rows inserted/updated/deleted
+ij> -- at this point the jar is not signed, NULL expected
+VALUES EMC.GETSIGNERS('org.apache.derbyTesting.databaseclassloader.emc');
+1                                                                                                                               
+--------------------------------------------------------------------------------------------------------------------------------
+NULL                                                                                                                            
+ij> -- Replace with a signed jar
+-- (self signed certificate)
+--
+-- Commands used to sign jar
+-- keytool -genkey -dname "cn=EMC CTO, ou=EMC APP, o=Easy Mail Company, c=US" -alias emccto -keypass kpi135 -keystore emcks -storepass ab987c
+-- keytool -selfcert -alias emccto -keypass kpi135 -keystore emcks -storepass ab987c
+-- jarsigner -keystore emcks -storepass ab987c -keypass kpi135 -signedjar dcl_emc2s.jar dcl_emc2.jar emccto
+--
+--
+CALL SQLJ.REPLACE_JAR('file:dcl_emc2s.jar', 'EMC.MAIL_APP');
+0 rows inserted/updated/deleted
+ij> VALUES EMC.GETSIGNERS('org.apache.derbyTesting.databaseclassloader.emc');
+1                                                                                                                               
+--------------------------------------------------------------------------------------------------------------------------------
+CN=EMC CTO, OU=EMC APP, O=Easy Mail Company, C=US                                                                               
+ij> -- other jar should not be signed
+VALUES EMC.GETSIGNERS('org.apache.derbyTesting.databaseclassloader.addon.vendor.util');
+1                                                                                                                               
+--------------------------------------------------------------------------------------------------------------------------------
+NULL                                                                                                                            
+ij> -- replace with a hacked jar file, emc.class modified to diable
+-- valid e-mail address check but using same signatures.
+-- ie direct replacement of the .class file.
+CALL SQLJ.REPLACE_JAR('file:dcl_emc2sm.jar', 'EMC.MAIL_APP');
+0 rows inserted/updated/deleted
+ij> CALL EMC.ADDCONTACT(99, 'spamking@cracker.org');
+ERROR 42X51: The class 'org.apache.derbyTesting.databaseclassloader.emc' does not exist or is inaccessible. This can happen if the class is not public.
+ERROR XJ001: Java exception: 'org.apache.derbyTesting.databaseclassloader.emc : Security exception thrown accessing class org.apache.derbyTesting.databaseclassloader.emc in jar "EMC"."MAIL_APP" : SHA1 digest error for org/apache/derbyTesting/databaseclassloader/emc.class: java.lang.ClassNotFoundException'.
+ij> -- replace with a hacked jar file, emc.class modified to 
+-- be an invalid jar file (no signing on this jar).
+CALL SQLJ.REPLACE_JAR('file:dcl_emc2l.jar', 'EMC.MAIL_APP');
+0 rows inserted/updated/deleted
+ij> CALL EMC.ADDCONTACT(999, 'spamking2@cracker.org');
+ERROR 42X51: The class 'org.apache.derbyTesting.databaseclassloader.emc' does not exist or is inaccessible. This can happen if the class is not public.
+ERROR XJ001: Java exception: 'org.apache.derbyTesting.databaseclassloader.emc : Bad version number in .class file: java.lang.ClassNotFoundException'.
+ij> -- cleanup
+CALL SQLJ.REMOVE_JAR('EMC.MAIL_APP', 0);
+ERROR X0X07: Cannot drop jar file '"EMC"."MAIL_APP"' because its on your db2j.database.classpath '"EMC"."MAIL_APP"'.
+ij> call SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY('derby.database.classpath', '"emcAddOn"."MailAddOn"');
+0 rows inserted/updated/deleted
+ij> CALL EMC.ADDCONTACT(99, 'cash@venture.com');
+ERROR 42X51: The class 'org.apache.derbyTesting.databaseclassloader.emc' does not exist or is inaccessible. This can happen if the class is not public.
+ERROR XJ001: Java exception: 'org.apache.derbyTesting.databaseclassloader.emc: java.lang.ClassNotFoundException'.
+ij> CALL SQLJ.REMOVE_JAR('EMC.MAIL_APP', 0);
+0 rows inserted/updated/deleted
+ij> DROP PROCEDURE EMC.ADDCONTACT;
+0 rows inserted/updated/deleted
+ij> DROP FUNCTION EMC.GETSIGNERS;
+0 rows inserted/updated/deleted
+ij> select e_mail, "emcAddOn".VALIDCONTACT(e_mail) from EMC.CONTACTS;
+E_MAIL                        |2     
+-------------------------------------
+bill@ruletheworld.com         |0     
+penguin@antartic.com          |0     
+big@blue.com                  |0     
+spammer@ripoff.com            |0     
+open@source.org               |1     
+ij> call SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY('derby.database.classpath', '');
+0 rows inserted/updated/deleted
+ij> select e_mail, "emcAddOn".VALIDCONTACT(e_mail) from EMC.CONTACTS;
+ERROR 42X51: The class 'org.apache.derbyTesting.databaseclassloader.addon.vendor.util' does not exist or is inaccessible. This can happen if the class is not public.
+ERROR XJ001: Java exception: 'org.apache.derbyTesting.databaseclassloader.addon.vendor.util: java.lang.ClassNotFoundException'.
+ij> CALL SQLJ.REMOVE_JAR('"emcAddOn"."MailAddOn"', 0);
+0 rows inserted/updated/deleted
+ij> DROP FUNCTION "emcAddOn".VALIDCONTACT;
+0 rows inserted/updated/deleted
+ij> DROP TABLE EMC.CONTACTS;
+0 rows inserted/updated/deleted
+ij> 
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/lang/copyfiles.ant b/java/testing/org/apache/derbyTesting/functionTests/tests/lang/copyfiles.ant
index 1d83f1fc6..56567daec 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/lang/copyfiles.ant
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/lang/copyfiles.ant
@@ -53,6 +53,9 @@ dcl.sql
 dcl_app.properties
 dcl_emc1.jar
 dcl_emc2.jar
+dcl_emc2l.jar
+dcl_emc2s.jar
+dcl_emc2sm.jar
 dcl_emcaddon.jar
 ddlTableLockMode.sql
 ddlTableLockMode_app.properties
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/lang/dcl.sql b/java/testing/org/apache/derbyTesting/functionTests/tests/lang/dcl.sql
index 6e041eb1b..9a71aa1da 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/lang/dcl.sql
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/lang/dcl.sql
@@ -67,6 +67,43 @@ call SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY('derby.database.classpath', 'EMC.MAI
 
 select e_mail, "emcAddOn".VALIDCONTACT(e_mail) from EMC.CONTACTS;
 
+-- function that gets the signers of the class (loaded from the jar)
+create function EMC.GETSIGNERS(CLASS_NAME VARCHAR(256))
+RETURNS VARCHAR(60)
+NO SQL
+external name 'org.apache.derbyTesting.databaseclassloader.emc.getSigners'
+language java parameter style java;
+
+-- at this point the jar is not signed, NULL expected
+VALUES EMC.GETSIGNERS('org.apache.derbyTesting.databaseclassloader.emc');
+
+-- Replace with a signed jar
+-- (self signed certificate)
+--
+-- Commands used to sign jar
+-- keytool -genkey -dname "cn=EMC CTO, ou=EMC APP, o=Easy Mail Company, c=US" -alias emccto -keypass kpi135 -keystore emcks -storepass ab987c
+-- keytool -selfcert -alias emccto -keypass kpi135 -keystore emcks -storepass ab987c
+-- jarsigner -keystore emcks -storepass ab987c -keypass kpi135 -signedjar dcl_emc2s.jar dcl_emc2.jar emccto
+--
+--
+
+CALL SQLJ.REPLACE_JAR('file:dcl_emc2s.jar', 'EMC.MAIL_APP');
+VALUES EMC.GETSIGNERS('org.apache.derbyTesting.databaseclassloader.emc');
+
+-- other jar should not be signed
+VALUES EMC.GETSIGNERS('org.apache.derbyTesting.databaseclassloader.addon.vendor.util');
+
+-- replace with a hacked jar file, emc.class modified to diable
+-- valid e-mail address check but using same signatures.
+-- ie direct replacement of the .class file.
+CALL SQLJ.REPLACE_JAR('file:dcl_emc2sm.jar', 'EMC.MAIL_APP');
+CALL EMC.ADDCONTACT(99, 'spamking@cracker.org');
+
+-- replace with a hacked jar file, emc.class modified to 
+-- be an invalid jar file (no signing on this jar).
+CALL SQLJ.REPLACE_JAR('file:dcl_emc2l.jar', 'EMC.MAIL_APP');
+CALL EMC.ADDCONTACT(999, 'spamking2@cracker.org');
+
 
 -- cleanup
 CALL SQLJ.REMOVE_JAR('EMC.MAIL_APP', 0);
@@ -74,6 +111,7 @@ call SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY('derby.database.classpath', '"emcAdd
 CALL EMC.ADDCONTACT(99, 'cash@venture.com');
 CALL SQLJ.REMOVE_JAR('EMC.MAIL_APP', 0);
 DROP PROCEDURE EMC.ADDCONTACT;
+DROP FUNCTION EMC.GETSIGNERS;
 
 select e_mail, "emcAddOn".VALIDCONTACT(e_mail) from EMC.CONTACTS;
 call SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY('derby.database.classpath', '');
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/lang/dcl_app.properties b/java/testing/org/apache/derbyTesting/functionTests/tests/lang/dcl_app.properties
index a18425471..97791f245 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/lang/dcl_app.properties
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/lang/dcl_app.properties
@@ -1,4 +1,4 @@
 usedefaults=true
-supportfiles=tests/lang/dcl_emc1.jar,tests/lang/dcl_emc2.jar,tests/lang/dcl_emcaddon.jar
+supportfiles=tests/lang/dcl_emc1.jar,tests/lang/dcl_emc2.jar,tests/lang/dcl_emcaddon.jar,tests/lang/dcl_emc2s.jar,tests/lang/dcl_emc2sm.jar,tests/lang/dcl_emc2l.jar
 #Exclude for J2ME/Foundation - test requires java.sql.DriverManager for server side JDBC
 runwithfoundation=false
\ No newline at end of file
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/lang/dcl_emc2.jar b/java/testing/org/apache/derbyTesting/functionTests/tests/lang/dcl_emc2.jar
index 9d43c3102..00229a02d 100644
Binary files a/java/testing/org/apache/derbyTesting/functionTests/tests/lang/dcl_emc2.jar and b/java/testing/org/apache/derbyTesting/functionTests/tests/lang/dcl_emc2.jar differ
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/lang/dcl_emc2l.jar b/java/testing/org/apache/derbyTesting/functionTests/tests/lang/dcl_emc2l.jar
new file mode 100644
index 000000000..9d26a97b8
Binary files /dev/null and b/java/testing/org/apache/derbyTesting/functionTests/tests/lang/dcl_emc2l.jar differ
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/lang/dcl_emc2s.jar b/java/testing/org/apache/derbyTesting/functionTests/tests/lang/dcl_emc2s.jar
new file mode 100644
index 000000000..4360ae0a5
Binary files /dev/null and b/java/testing/org/apache/derbyTesting/functionTests/tests/lang/dcl_emc2s.jar differ
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/lang/dcl_emc2sm.jar b/java/testing/org/apache/derbyTesting/functionTests/tests/lang/dcl_emc2sm.jar
new file mode 100644
index 000000000..9371232e5
Binary files /dev/null and b/java/testing/org/apache/derbyTesting/functionTests/tests/lang/dcl_emc2sm.jar differ
