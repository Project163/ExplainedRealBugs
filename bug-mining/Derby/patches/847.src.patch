diff --git a/java/engine/org/apache/derby/impl/sql/compile/SubqueryNode.java b/java/engine/org/apache/derby/impl/sql/compile/SubqueryNode.java
index fbbfd8741..ae1c14e33 100644
--- a/java/engine/org/apache/derby/impl/sql/compile/SubqueryNode.java
+++ b/java/engine/org/apache/derby/impl/sql/compile/SubqueryNode.java
@@ -489,6 +489,14 @@ public class SubqueryNode extends ValueNode
 			/* Bind the expression in the SELECT list */
 			resultSet.bindTargetExpressions(fromList);
 
+			resultSet.bindResultColumns(fromList);
+
+			/* 
+			 * reject any untyped nulls in the EXISTS subquery before 
+			 * SELECT TRUE transformation. 
+			 */
+			resultSet.bindUntypedNullsToResultColumns(null);
+	        
 			/* Transform the ResultColumn into true.
 			 * NOTE: This may be a 2nd instance of the same transformation for
 			 * an EXISTS (select * ...), since we had to transform the 
@@ -510,6 +518,9 @@ public class SubqueryNode extends ValueNode
 
 		resultSet.bindResultColumns(fromList);
 
+		/* reject any untyped nulls in the subquery */
+		resultSet.bindUntypedNullsToResultColumns(null);
+        
 		/* We need to reset resultColumns since the underlying resultSet may
 		 * be a UNION (and UnionNode.bindResultColumns() regens a new RCL).
 		 */
diff --git a/java/testing/org/apache/derbyTesting/functionTests/master/subquery.out b/java/testing/org/apache/derbyTesting/functionTests/master/subquery.out
index 1332a3940..f11533ca2 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/master/subquery.out
+++ b/java/testing/org/apache/derbyTesting/functionTests/master/subquery.out
@@ -1685,4 +1685,31 @@ ij> drop table t1;
 0 rows inserted/updated/deleted
 ij> drop table t2;
 0 rows inserted/updated/deleted
+ij> -- DERBY-2218
+create table t1 (i int);
+0 rows inserted/updated/deleted
+ij> -- ok
+select * from t1 where i in (1, 2, (values cast(null as integer)));
+I          
+-----------
+ij> -- expect error, this used to throw NPE
+select * from t1 where i in (1, 2, (values null));
+ERROR 42X07: Null is only allowed in a VALUES clause within an INSERT statement.
+ij> select * from t1 where i in (select i from t1 where i in (1, 2, (values null)));
+ERROR 42X07: Null is only allowed in a VALUES clause within an INSERT statement.
+ij> -- expect error
+select * from t1 where exists (values null);
+ERROR 42X07: Null is only allowed in a VALUES clause within an INSERT statement.
+ij> select * from t1 where exists (select * from t1 where exists(values null));
+ERROR 42X07: Null is only allowed in a VALUES clause within an INSERT statement.
+ij> select i from t1 where exists (select i from t1 where exists(values null));
+ERROR 42X07: Null is only allowed in a VALUES clause within an INSERT statement.
+ij> select * from (values null) as t2;
+ERROR 42X07: Null is only allowed in a VALUES clause within an INSERT statement.
+ij> select * from t1 where exists (select 1 from (values null) as t2);
+ERROR 42X07: Null is only allowed in a VALUES clause within an INSERT statement.
+ij> select * from t1 where exists (select * from (values null) as t2);
+ERROR 42X07: Null is only allowed in a VALUES clause within an INSERT statement.
+ij> drop table t1;
+0 rows inserted/updated/deleted
 ij> 
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/lang/subquery.sql b/java/testing/org/apache/derbyTesting/functionTests/tests/lang/subquery.sql
index 707ee5cdc..e9fe5624f 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/lang/subquery.sql
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/lang/subquery.sql
@@ -556,3 +556,18 @@ select * from t1;
 drop table t1;
 drop table t2;
 
+-- DERBY-2218
+create table t1 (i int);
+-- ok
+select * from t1 where i in (1, 2, (values cast(null as integer)));
+-- expect error, this used to throw NPE
+select * from t1 where i in (1, 2, (values null));
+select * from t1 where i in (select i from t1 where i in (1, 2, (values null)));
+-- expect error
+select * from t1 where exists (values null);
+select * from t1 where exists (select * from t1 where exists(values null));
+select i from t1 where exists (select i from t1 where exists(values null));
+select * from (values null) as t2;
+select * from t1 where exists (select 1 from (values null) as t2);
+select * from t1 where exists (select * from (values null) as t2);
+drop table t1;
