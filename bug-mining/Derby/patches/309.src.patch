diff --git a/java/engine/org/apache/derby/iapi/services/context/Context.java b/java/engine/org/apache/derby/iapi/services/context/Context.java
index bb349945e..450dea6cf 100644
--- a/java/engine/org/apache/derby/iapi/services/context/Context.java
+++ b/java/engine/org/apache/derby/iapi/services/context/Context.java
@@ -87,6 +87,13 @@ public interface Context
 	 * context manager. If there are no other references
 	 * to the context, removing itself from the manager
 	 * equates to freeing it.
+     * <BR>
+     * On an exception that is session severity or greater
+     * the Context must push itself off the stack. This is
+     * to ensure that after a session has been closed there
+     * are no Contexts on the stack that potentially hold
+     * references to objects, thus delaying their garbage
+     * collection.
 	 * <p>
 	 * Contexts must release all their resources before
 	 * removing themselves from their context manager.
diff --git a/java/engine/org/apache/derby/iapi/services/context/SystemContext.java b/java/engine/org/apache/derby/iapi/services/context/SystemContext.java
index 52e3a449f..b59a7af76 100644
--- a/java/engine/org/apache/derby/iapi/services/context/SystemContext.java
+++ b/java/engine/org/apache/derby/iapi/services/context/SystemContext.java
@@ -42,6 +42,8 @@ final class SystemContext extends ContextImpl
 			int severity = se.getSeverity();
 			if (severity < ExceptionSeverity.SESSION_SEVERITY)
 				return;
+            
+            popMe();
 
 			if (severity >= ExceptionSeverity.SYSTEM_SEVERITY)
 				doShutdown = true;
diff --git a/java/engine/org/apache/derby/iapi/services/loader/ClassFactoryContext.java b/java/engine/org/apache/derby/iapi/services/loader/ClassFactoryContext.java
index d8ff3f9fc..c6cbc273a 100644
--- a/java/engine/org/apache/derby/iapi/services/loader/ClassFactoryContext.java
+++ b/java/engine/org/apache/derby/iapi/services/loader/ClassFactoryContext.java
@@ -23,29 +23,42 @@ package org.apache.derby.iapi.services.loader;
 import org.apache.derby.iapi.services.context.ContextImpl;
 import org.apache.derby.iapi.services.context.ContextManager;
 import org.apache.derby.iapi.services.property.PersistentSet;
+import org.apache.derby.iapi.error.ExceptionSeverity;
 import org.apache.derby.iapi.error.StandardException;
+
 /**
+ * Context that provides the correct ClassFactory for the
+ * current service. Allows stateless code to obtain the
+ * correct class loading scheme.
 */
-
 public abstract class ClassFactoryContext extends ContextImpl {
 
 	public static final String CONTEXT_ID = "ClassFactoryContext";
 
 	private final ClassFactory cf;
 
-	public ClassFactoryContext(ContextManager cm, ClassFactory cf) {
+	protected ClassFactoryContext(ContextManager cm, ClassFactory cf) {
 
 		super(cm, CONTEXT_ID);
 
 		this.cf = cf;
 	}
 
-	public ClassFactory getClassFactory() {
+	public final ClassFactory getClassFactory() {
 		return cf;
 	}
 
+    /**
+     * Get the lock compatibility space to use for the
+     * transactional nature of the class loading lock.
+     * Used when the classpath changes or a database
+     * jar file is installed, removed or replaced.
+     */
 	public abstract Object getLockSpace() throws StandardException;
 
+    /**
+     * Get the set of properties stored with this service.
+    */
 	public abstract PersistentSet getPersistentSet() throws StandardException;
 
 	/**
@@ -54,5 +67,17 @@ public abstract class ClassFactoryContext extends ContextImpl {
 	*/
 	public abstract JarReader getJarReader();
 
-	public void cleanupOnError(Throwable error) {}
+    /**
+     * Handle any errors. Only work here is to pop myself
+     * on a session or greater severity error.
+     */
+	public final void cleanupOnError(Throwable error) {
+        if (error instanceof StandardException) {
+
+            StandardException se = (StandardException) error;
+            
+            if (se.getSeverity() >= ExceptionSeverity.SESSION_SEVERITY)
+                popMe();
+        }
+    }
 }
diff --git a/java/engine/org/apache/derby/impl/db/DatabaseContextImpl.java b/java/engine/org/apache/derby/impl/db/DatabaseContextImpl.java
index 51fdc8b24..1b5a27473 100644
--- a/java/engine/org/apache/derby/impl/db/DatabaseContextImpl.java
+++ b/java/engine/org/apache/derby/impl/db/DatabaseContextImpl.java
@@ -33,7 +33,7 @@ import org.apache.derby.iapi.error.ExceptionSeverity;
 /**
 	A context that shutdowns down the database on a databsae exception.
 */
-class DatabaseContextImpl extends ContextImpl implements DatabaseContext
+final class DatabaseContextImpl extends ContextImpl implements DatabaseContext
 {
 
 	private final Database	db;
@@ -46,10 +46,18 @@ class DatabaseContextImpl extends ContextImpl implements DatabaseContext
 	public void cleanupOnError(Throwable t) {
 		if (!(t instanceof StandardException)) return;
 		StandardException se = (StandardException)t;
-		if (se.getSeverity() != ExceptionSeverity.DATABASE_SEVERITY) return;
-		popMe();
-		ContextService.getFactory().notifyAllActiveThreads(this);
-		Monitor.getMonitor().shutdown(db);
+
+        // Ensure the context is popped if the session is
+        // going away.
+        if (se.getSeverity() < ExceptionSeverity.SESSION_SEVERITY)
+            return;
+
+        popMe();
+        
+        if (se.getSeverity() == ExceptionSeverity.DATABASE_SEVERITY) {
+		    ContextService.getFactory().notifyAllActiveThreads(this);
+		    Monitor.getMonitor().shutdown(db);
+        }
 	}
 
 	public boolean equals(Object other) {
diff --git a/java/engine/org/apache/derby/impl/sql/execute/GenericExecutionContext.java b/java/engine/org/apache/derby/impl/sql/execute/GenericExecutionContext.java
index 8c7c540a5..fea7e4955 100644
--- a/java/engine/org/apache/derby/impl/sql/execute/GenericExecutionContext.java
+++ b/java/engine/org/apache/derby/impl/sql/execute/GenericExecutionContext.java
@@ -160,8 +160,16 @@ class GenericExecutionContext
 		if (error instanceof StandardException) {
 
 			StandardException se = (StandardException) error;
-			if (se.getSeverity() > ExceptionSeverity.STATEMENT_SEVERITY)
-				return;
+            int severity = se.getSeverity();
+            if (severity >= ExceptionSeverity.SESSION_SEVERITY)
+            {
+               popMe();
+               return;
+            }
+			if (severity > ExceptionSeverity.STATEMENT_SEVERITY)
+            {
+ 				return;
+            }
 
 
 			if (sourceRS != null)
diff --git a/java/engine/org/apache/derby/jdbc/XATransactionState.java b/java/engine/org/apache/derby/jdbc/XATransactionState.java
index c95eabce7..2e79196a8 100644
--- a/java/engine/org/apache/derby/jdbc/XATransactionState.java
+++ b/java/engine/org/apache/derby/jdbc/XATransactionState.java
@@ -88,6 +88,11 @@ final class XATransactionState extends ContextImpl {
 		if (t instanceof StandardException) {
 
 			StandardException se = (StandardException) t;
+            
+            if (se.getSeverity() >= ExceptionSeverity.SESSION_SEVERITY) {
+                popMe();
+                return;
+            }
 
 			if (se.getSeverity() == ExceptionSeverity.TRANSACTION_SEVERITY) {
 
