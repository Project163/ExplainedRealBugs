diff --git a/java/engine/org/apache/derby/impl/sql/compile/MatchingClauseNode.java b/java/engine/org/apache/derby/impl/sql/compile/MatchingClauseNode.java
index d08f3e0a2..cd67eb758 100644
--- a/java/engine/org/apache/derby/impl/sql/compile/MatchingClauseNode.java
+++ b/java/engine/org/apache/derby/impl/sql/compile/MatchingClauseNode.java
@@ -1610,5 +1610,17 @@ public class MatchingClauseNode extends QueryTreeNode
 
         return false;
     }
-    
+
+    @Override
+    public boolean referencesSessionSchema() throws StandardException {
+        return referencesSessionSchema(_matchingRefinement)
+                || referencesSessionSchema(_updateColumns)
+                || referencesSessionSchema(_insertColumns)
+                || referencesSessionSchema(_insertValues);
+    }
+
+    private static boolean referencesSessionSchema(QueryTreeNode node)
+            throws StandardException {
+        return node != null && node.referencesSessionSchema();
+    }
 }
diff --git a/java/engine/org/apache/derby/impl/sql/compile/MergeNode.java b/java/engine/org/apache/derby/impl/sql/compile/MergeNode.java
index a48ce6cd6..336c77ae2 100644
--- a/java/engine/org/apache/derby/impl/sql/compile/MergeNode.java
+++ b/java/engine/org/apache/derby/impl/sql/compile/MergeNode.java
@@ -183,7 +183,7 @@ public final class MergeNode extends DMLModStatementNode
     private FromBaseTable   _targetTable;
     private FromTable   _sourceTable;
     private ValueNode   _searchCondition;
-    private ArrayList<MatchingClauseNode>   _matchingClauses;
+    private QueryTreeNodeVector<MatchingClauseNode> _matchingClauses;
 
     //
     // Filled in at bind() time.
@@ -214,7 +214,7 @@ public final class MergeNode extends DMLModStatementNode
          FromTable          targetTable,
          FromTable          sourceTable,
          ValueNode          searchCondition,
-         ArrayList<MatchingClauseNode>  matchingClauses,
+         QueryTreeNodeVector<MatchingClauseNode> matchingClauses,
          ContextManager     cm
          )
         throws StandardException
@@ -424,6 +424,14 @@ public final class MergeNode extends DMLModStatementNode
         return ft.getTableName().getTableName();
     }
 
+    @Override
+    public boolean referencesSessionSchema() throws StandardException {
+        return _sourceTable.referencesSessionSchema()
+                || _targetTable.referencesSessionSchema()
+                || _searchCondition.referencesSessionSchema()
+                || _matchingClauses.referencesSessionSchema();
+    }
+
     /**
      *<p>
      * Because of name resolution complexities, we do not allow derived column lists
@@ -1031,7 +1039,7 @@ public final class MergeNode extends DMLModStatementNode
         ConstantAction[]    clauseActions = new ConstantAction[ clauseCount ];
         for ( int i = 0; i < clauseCount; i++ )
         {
-            MatchingClauseNode  mcn = _matchingClauses.get( i );
+            MatchingClauseNode mcn = _matchingClauses.elementAt(i);
 
             mcn.generate( acb, _selectList, generatedScan, _hojn, i );
             clauseActions[ i ] = mcn.makeConstantAction( acb );
diff --git a/java/engine/org/apache/derby/impl/sql/compile/sqlgrammar.jj b/java/engine/org/apache/derby/impl/sql/compile/sqlgrammar.jj
index 64f8c2001..f2f7082a5 100644
--- a/java/engine/org/apache/derby/impl/sql/compile/sqlgrammar.jj
+++ b/java/engine/org/apache/derby/impl/sql/compile/sqlgrammar.jj
@@ -3660,7 +3660,7 @@ mergeStatement() throws StandardException :
 	FromTable   targetTable;
     FromTable       sourceTable;
     ValueNode       searchCondition;
-    ArrayList<MatchingClauseNode>   matchingClauses;
+    QueryTreeNodeVector<MatchingClauseNode> matchingClauses;
 }
 {
 	<MERGE> <INTO> targetTable = tableFactor()
@@ -3686,10 +3686,12 @@ mergeStatement() throws StandardException :
 /*
  * <A NAME="matchingClauseList">matchingClauseList</A>
  */
-ArrayList<MatchingClauseNode>
+QueryTreeNodeVector<MatchingClauseNode>
 matchingClauseList() throws StandardException :
 {
-    ArrayList<MatchingClauseNode>   matchingClauses = new ArrayList<MatchingClauseNode>();
+    QueryTreeNodeVector<MatchingClauseNode> matchingClauses =
+            new QueryTreeNodeVector<MatchingClauseNode>(
+                    MatchingClauseNode.class, getContextManager());
 }
 {
     matchingClause( matchingClauses ) ( matchingClause( matchingClauses ) ) *
@@ -3702,7 +3704,8 @@ matchingClauseList() throws StandardException :
  * <A NAME="matchingClause">matchingClause</A>
  */
 void
-matchingClause( ArrayList<MatchingClauseNode> matchingClauses ) throws StandardException :
+matchingClause(QueryTreeNodeVector<MatchingClauseNode> matchingClauses)
+    throws StandardException :
 {
     ValueNode   matchingRefinement = null;
     ResultColumnList               updateColumns = null;
@@ -3731,7 +3734,7 @@ matchingClause( ArrayList<MatchingClauseNode> matchingClauses ) throws StandardE
             ( matchingRefinement, getContextManager() );
         }
 
-        matchingClauses.add( matchingClause );
+        matchingClauses.addElement(matchingClause);
 	}
 |
     LOOKAHEAD ( { getToken(1).kind == WHEN && getToken(2).kind == NOT } )
@@ -3743,7 +3746,7 @@ matchingClause( ArrayList<MatchingClauseNode> matchingClauses ) throws StandardE
         matchingClause = MatchingClauseNode.makeInsertClause
         ( matchingRefinement, insertColumns, insertValues, getContextManager() );
 
-        matchingClauses.add( matchingClause );
+        matchingClauses.addElement(matchingClause);
 	}
 }
 
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/lang/TriggerTest.java b/java/testing/org/apache/derbyTesting/functionTests/tests/lang/TriggerTest.java
index 22ff332cd..544647a53 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/lang/TriggerTest.java
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/lang/TriggerTest.java
@@ -2022,6 +2022,24 @@ public class TriggerTest extends BaseJDBCTestCase {
                 + "(select count(*) from session.temptable) = "
                 + "(select count(*) from sysibm.sysdummy1)");
 
+        // DERBY-6705
+        assertCompileError("XCL51",
+                "create trigger tr7 after insert on t1 "
+                + "merge into t2 using session.temptable on i=x "
+                + "when matched then delete");
+
+        // DERBY-6705
+        assertCompileError("XCL51",
+                "create trigger tr8 after insert on t1 "
+                + "merge into session.temptable using t2 on i=x "
+                + "when matched then delete");
+
+        // DERBY-6705
+        assertCompileError("XCL51",
+                "create trigger tr9 after insert on t1 "
+                + "merge into t2 using t1 "
+                + "on exists(select * from session.temptable where t1.x=t2.i) "
+                + "when matched then delete");
     }
 
     /**
