diff --git a/java/engine/org/apache/derby/iapi/services/context/ContextService.java b/java/engine/org/apache/derby/iapi/services/context/ContextService.java
index e8f5c9b22..a69095e60 100644
--- a/java/engine/org/apache/derby/iapi/services/context/ContextService.java
+++ b/java/engine/org/apache/derby/iapi/services/context/ContextService.java
@@ -158,9 +158,22 @@ public final class ContextService //OLD extends Hashtable
 	*/
 	private ThreadLocal threadContextList = new ThreadLocal();
 
+    /**
+     * Collection of all ContextManagers that are open
+     * in the complete Derby system. A ContextManager is
+     * added when it is created with newContextManager and
+     * removed when the session is closed.
+     * 
+     * @see #newContextManager()
+     * @see SystemContext#cleanupOnError(Throwable)
+     */
 	private HashSet allContexts;
 
-	// don't want any instances
+    /**
+     * Create a new ContextService for a Derby system.
+     * Only a single system is active at any time.
+     *
+     */
 	public ContextService() {
 
 		// find the error stream
@@ -179,10 +192,14 @@ public final class ContextService //OLD extends Hashtable
 		// For some unknown reason, the ContextManager and
 		// ContextService objects will not be garbage collected
 		// without the next two lines.
-		factory.allContexts = null;
-		factory.threadContextList = null;
-
-		ContextService.factory = null;
+        ContextService fact = ContextService.factory;
+        if (fact != null) {
+            synchronized (fact) {
+                fact.allContexts = null;
+                fact.threadContextList = null;
+                ContextService.factory = null;
+            }
+        }
 	}
 
 	public static ContextService getFactory() {
@@ -495,7 +512,7 @@ public final class ContextService //OLD extends Hashtable
 
 		synchronized (this) {
 			allContexts.add(cm);
-
+            
 			if (SanityManager.DEBUG) {
 
 				if (SanityManager.DEBUG_ON("memoryLeakTrace")) {
@@ -531,8 +548,13 @@ public final class ContextService //OLD extends Hashtable
 		}
 	}
 
-    synchronized void removeContext( ContextManager cm)
+    /**
+     * Remove a ContextManager from the list of all active
+     * contexts managers.
+     */
+    synchronized void removeContext(ContextManager cm)
     {
-        allContexts.remove( cm);
+        if (allContexts != null)
+            allContexts.remove( cm);
     }
 }
diff --git a/java/engine/org/apache/derby/impl/services/monitor/BaseMonitor.java b/java/engine/org/apache/derby/impl/services/monitor/BaseMonitor.java
index c50b00ce3..97d278a29 100644
--- a/java/engine/org/apache/derby/impl/services/monitor/BaseMonitor.java
+++ b/java/engine/org/apache/derby/impl/services/monitor/BaseMonitor.java
@@ -1836,7 +1836,10 @@ nextModule:
 						BaseMonitor.removeRuntimeProperties(properties), false);
 				usProperties.setServiceBooted();
 			}
-
+            
+            if (cm != previousCM)
+                cm.cleanupOnError(StandardException.closeException());
+            
 		} catch (Throwable t) {
 
 			// ensure that the severity will shutdown the service
