diff --git a/java/engine/org/apache/derby/impl/sql/compile/SelectNode.java b/java/engine/org/apache/derby/impl/sql/compile/SelectNode.java
index 28b41dd50..30fd57a1a 100644
--- a/java/engine/org/apache/derby/impl/sql/compile/SelectNode.java
+++ b/java/engine/org/apache/derby/impl/sql/compile/SelectNode.java
@@ -591,7 +591,18 @@ public class SelectNode extends ResultSetNode
 	public void bindTargetExpressions(FromList fromListParam)
 					throws StandardException
 	{
-		bindTargetListOnly = true;
+		/*
+		 * With a FromSubquery in the FromList we cannot bind target expressions 
+		 * at this level (DERBY-3321)
+		 */
+		CollectNodesVisitor cnv = new CollectNodesVisitor(FromSubquery.class, 
+														  FromSubquery.class);
+		fromList.accept(cnv);
+		if (!cnv.getList().isEmpty()){		
+			bindTargetListOnly = false;
+		} else {
+			bindTargetListOnly = true;				
+		}		
 		bindExpressions(fromListParam);
 		bindTargetListOnly = false;
 	}
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/lang/NestedWhereSubqueryTest.java b/java/testing/org/apache/derbyTesting/functionTests/tests/lang/NestedWhereSubqueryTest.java
index 9b3095050..987d85b03 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/lang/NestedWhereSubqueryTest.java
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/lang/NestedWhereSubqueryTest.java
@@ -355,6 +355,33 @@ public class NestedWhereSubqueryTest extends BaseJDBCTestCase {
 		/* Expected rows are as above */
 		JDBC.assertUnorderedResultSet(rs, expectedRows);
 		
+		/*
+		 * DERBY-3321 revealed an NPE with a subquery in the [NOT] EXIST subuery FromList.
+		 */
+		s.executeUpdate("create table a (aa int, bb int)");
+		s.executeUpdate("create table b (bb int)");
+		s.executeUpdate("insert into a values (1,1),(1,2),(2,2)");
+		s.executeUpdate("insert into b values (1)");
+		
+		/* NOT EXISTS */
+		sb = new StringBuffer();
+		sb.append("select * from a ");
+		sb.append("where not exists ");
+		sb.append("(select bb from (select bb from b) p where a.bb=p.bb)");
+		rs = s.executeQuery(sb.toString());
+		expectedRows = new String [][] {{"1","2"},		
+										{"2","2"}};
+		JDBC.assertUnorderedResultSet(rs, expectedRows);		
+		
+		/* EXISTS */
+		sb = new StringBuffer();
+		sb.append("select * from a ");
+		sb.append("where exists ");
+		sb.append("(select bb from (select bb from b) p where a.bb=p.bb)");
+		rs = s.executeQuery(sb.toString());
+		expectedRows = new String [][] {{"1","1"}};										
+		JDBC.assertUnorderedResultSet(rs, expectedRows);	
+		
 		/*
 		 * Clean up the tables used.
 		 */				
@@ -363,6 +390,9 @@ public class NestedWhereSubqueryTest extends BaseJDBCTestCase {
 		s.executeUpdate("drop table employees");
 		s.executeUpdate("drop table departments");			
 		
+		s.executeUpdate("drop table a");	
+		s.executeUpdate("drop table b");	
+		
 		s.close();
 	}
 
