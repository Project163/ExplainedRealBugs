diff --git a/java/drda/org/apache/derby/impl/drda/XADatabase.java b/java/drda/org/apache/derby/impl/drda/XADatabase.java
index 1b2c39b4f..69ce8a80e 100644
--- a/java/drda/org/apache/derby/impl/drda/XADatabase.java
+++ b/java/drda/org/apache/derby/impl/drda/XADatabase.java
@@ -89,6 +89,9 @@ class XADatabase extends Database {
 		
 		// Get a new logical connection.
 		conn = xaConnection.getConnection();
+		// Client will always drive the commits so connection should
+		// always be autocommit false on the server. DERBY-898/DERBY-899
+		conn.setAutoCommit(false);
 		setConnection(conn);
 		return conn;
 		
diff --git a/java/testing/org/apache/derbyTesting/functionTests/master/DerbyNet/savepointJdbc30_JSR169.out b/java/testing/org/apache/derbyTesting/functionTests/master/DerbyNet/savepointJdbc30_JSR169.out
index 366e05c02..12efe91b7 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/master/DerbyNet/savepointJdbc30_JSR169.out
+++ b/java/testing/org/apache/derbyTesting/functionTests/master/DerbyNet/savepointJdbc30_JSR169.out
@@ -1,4 +1,5 @@
 Test savepointJdbc30 starting
+Test savepointJdbc30 starting for regular connections
 Tests common to DRDA and embedded Cloudscape
 Test1 - no unnamed savepoints allowed if autocommit is true
 Expected Exception is Cannot set savepoint when in auto-commit mode.
@@ -72,4 +73,3 @@ Expected Exception is Cannot rollback to a null savepoint.
 Test 26b release  of null savepoint
 Expected Exception is Cannot release a null savepoint.
 Next try non-DRDA tests
-Test savepointJdbc30 finished
diff --git a/java/testing/org/apache/derbyTesting/functionTests/master/DerbyNetClient/savepointJdbc30_JSR169.out b/java/testing/org/apache/derbyTesting/functionTests/master/DerbyNetClient/savepointJdbc30_JSR169.out
index 366e05c02..12efe91b7 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/master/DerbyNetClient/savepointJdbc30_JSR169.out
+++ b/java/testing/org/apache/derbyTesting/functionTests/master/DerbyNetClient/savepointJdbc30_JSR169.out
@@ -1,4 +1,5 @@
 Test savepointJdbc30 starting
+Test savepointJdbc30 starting for regular connections
 Tests common to DRDA and embedded Cloudscape
 Test1 - no unnamed savepoints allowed if autocommit is true
 Expected Exception is Cannot set savepoint when in auto-commit mode.
@@ -72,4 +73,3 @@ Expected Exception is Cannot rollback to a null savepoint.
 Test 26b release  of null savepoint
 Expected Exception is Cannot release a null savepoint.
 Next try non-DRDA tests
-Test savepointJdbc30 finished
diff --git a/java/testing/org/apache/derbyTesting/functionTests/master/DerbyNetClient/savepointJdbc30_XA.out b/java/testing/org/apache/derbyTesting/functionTests/master/DerbyNetClient/savepointJdbc30_XA.out
new file mode 100644
index 000000000..42173dea6
--- /dev/null
+++ b/java/testing/org/apache/derbyTesting/functionTests/master/DerbyNetClient/savepointJdbc30_XA.out
@@ -0,0 +1,74 @@
+Test savepointJdbc30 starting for connections from XADataSource (local tranasaction)
+Tests common to DRDA and embedded Cloudscape
+Test1 - no unnamed savepoints allowed if autocommit is true
+Expected Exception is Cannot set savepoint when in auto-commit mode.
+Test1a - no named savepoints allowed if autocommit is true
+Expected Exception is Cannot set savepoint when in auto-commit mode.
+Test2 - Release and reuse a savepoint name
+Test3 - null name not allowed for named savepoints
+Expected Exception is Named savepoint needs a none-null name.
+Test4 - Verify names/ids of named/unnamed savepoints
+Expected Exception is This is an un-named savepoint.
+Expected Exception is This is a named savepoint.
+Test5a - create two savepoints in two different transactions and release the first one in the subsequent transaction
+Expected Exception is SAVEPOINT, s1 does not  exist or is not active in the current transaction.
+Test5b - create two savepoints in two different transactions and rollback the first one in the subsequent transaction
+Expected Exception is SAVEPOINT, s1 does not  exist or is not active in the current transaction.
+Test6a - create a savepoint, release it, create another with same name and release the first one
+Expected Exception is SAVEPOINT, s1 does not  exist or is not active in the current transaction.
+Test6b - create a savepoint, release it, create another with same name and rollback the first one
+Expected Exception is SAVEPOINT, s1 does not  exist or is not active in the current transaction.
+Test6c - Try to use a savepoint from another connection for release
+Expected Exception is Cannot release a savepoint that was not created by this connection.
+Test7a - swap savepoints across connections with release
+Expected Exception is Cannot release a savepoint that was not created by this connection.
+Test7b - swap savepoints across connections with rollback
+Expected Exception is Rollback to a savepoint not created by this connection.
+Test 9 test savepoint name
+Test 10 test savepoint name case sensitivity
+Test 11 rolling back a savepoint multiple times - should work
+Test 12 releasing a savepoint multiple times - should not work
+Expected Exception is SAVEPOINT, MyName does not  exist or is not active in the current transaction.
+Test 13 shouldn't be able to use a savepoint from earlier transaction after setting autocommit on and off
+Expected Exception is SAVEPOINT, MyName does not  exist or is not active in the current transaction.
+Test 14 A non-user initiated transaction rollback should release the internal savepoint array
+Expected Exception is A lock could not be obtained within the time requested
+Expected Exception is SAVEPOINT, MyName does not  exist or is not active in the current transaction.
+Test 15 check savepoints in batch
+Test 16 grammar check for savepoint sq1
+Expected Exception is Syntax error: MISSING ON ROLLBACK RETAIN CURSORS.
+Expected Exception is Multiple or conflicting keywords involving the 'ON ROLLBACK RETAIN CURSORS' clause are present.
+Expected Exception is Multiple or conflicting keywords involving the 'ON ROLLBACK RETAIN LOCKS' clause are present.
+Expected Exception is Multiple or conflicting keywords involving the 'UNIQUE' clause are present.
+Test 17 No nested savepoints allowed when using SQL to set savepoints.
+Test 17a Test with UNIQUE clause.
+Expected Exception is The maximum number of savepoints has been reached. 
+Test 17b Test without UNIQUE clause.
+Since no nesting is allowed, skipping UNIQUE still gives error for trying to define another savepoint
+Expected Exception is The maximum number of savepoints has been reached. 
+Test 18 No nested SQL savepoints allowed inside JDBC savepoint.
+Following SQL savepoint will fail because we are trying to nest it inside JDBC savepoint
+Expected Exception is The maximum number of savepoints has been reached. 
+Test 19 No nested SQL savepoints allowed inside SQL savepoint.
+Following SQL savepoint will fail because we are trying to nest it inside SQL savepoint
+Expected Exception is The maximum number of savepoints has been reached. 
+Test 20 Rollback of SQL savepoint works same as rollback of JDBC savepoint.
+Test 21 After releasing the SQL savepoint, rollback the transaction and should see everything undone.
+Test 22 Should not be able to create a SQL savepoint starting with name SYS
+Expected Exception is An object cannot be created with the schema name 'SYS'.
+Test 23 Should be able to use non-reserved keywords savepoint and release as identifiers
+Create table with savepoint and release as identifiers
+Create a savepoint with name savepoint
+Release the savepoint with name savepoint
+Create a savepoint with name release
+Rollback to the savepoint with name release
+Release the savepoint with name release
+Test 24 Savepoint name can't exceed 128 characters
+Expected Exception is The name 'MyName1234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890' is too long. The maximum length is '128'.
+Test 25 Should not be able to create a SQL savepoint starting with name SYS through jdbc
+Expected Exception is An object cannot be created with the schema name 'SYS'.
+Test 26a rollback of null savepoint
+Expected Exception is Cannot rollback to a null savepoint.
+Test 26b release  of null savepoint
+Expected Exception is Cannot release a null savepoint.
+Next try non-DRDA tests
diff --git a/java/testing/org/apache/derbyTesting/functionTests/master/savepointJdbc30_JSR169.out b/java/testing/org/apache/derbyTesting/functionTests/master/savepointJdbc30_JSR169.out
index 4f3a829f0..aeabd1433 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/master/savepointJdbc30_JSR169.out
+++ b/java/testing/org/apache/derbyTesting/functionTests/master/savepointJdbc30_JSR169.out
@@ -1,4 +1,5 @@
 Test savepointJdbc30 starting
+Test savepointJdbc30 starting for regular connections
 Tests common to DRDA and embedded Cloudscape
 Test1 - no unnamed savepoints allowed if autocommit is true
 Expected Exception is Cannot issue savepoint when autoCommit is on.
@@ -99,4 +100,3 @@ Test 48 No nested SQL savepoints allowed.
 Following SQL savepoint will fail because we are trying to nest it inside JDBC savepoint
 Expected Exception is The maximum number of savepoints has been reached. 
 Expected Exception is The maximum number of savepoints has been reached. 
-Test savepointJdbc30 finished
diff --git a/java/testing/org/apache/derbyTesting/functionTests/master/savepointJdbc30_XA.out b/java/testing/org/apache/derbyTesting/functionTests/master/savepointJdbc30_XA.out
new file mode 100644
index 000000000..5c10f75fa
--- /dev/null
+++ b/java/testing/org/apache/derbyTesting/functionTests/master/savepointJdbc30_XA.out
@@ -0,0 +1,101 @@
+Test savepointJdbc30 starting for connections from XADataSource (local tranasaction)
+Tests common to DRDA and embedded Cloudscape
+Test1 - no unnamed savepoints allowed if autocommit is true
+Expected Exception is Cannot issue savepoint when autoCommit is on.
+Test1a - no named savepoints allowed if autocommit is true
+Expected Exception is Cannot issue savepoint when autoCommit is on.
+Test2 - Release and reuse a savepoint name
+Test3 - null name not allowed for named savepoints
+Expected Exception is Cannot pass null for savepoint name.
+Test4 - Verify names/ids of named/unnamed savepoints
+Expected Exception is No name for un-named savepoints.
+Expected Exception is No ID for named savepoints.
+Test5a - create two savepoints in two different transactions and release the first one in the subsequent transaction
+Expected Exception is SAVEPOINT, s1 does not  exist or is not active in the current transaction.
+Test5b - create two savepoints in two different transactions and rollback the first one in the subsequent transaction
+Expected Exception is SAVEPOINT, s1 does not  exist or is not active in the current transaction.
+Test6a - create a savepoint, release it, create another with same name and release the first one
+Expected Exception is SAVEPOINT, s1 does not  exist or is not active in the current transaction.
+Test6b - create a savepoint, release it, create another with same name and rollback the first one
+Expected Exception is SAVEPOINT, s1 does not  exist or is not active in the current transaction.
+Test6c - Try to use a savepoint from another connection for release
+Expected Exception is A RELEASE or ROLLBACK TO SAVEPOINT was specified, but the savepoint does not exist.
+Test7a - swap savepoints across connections with release
+Expected Exception is A RELEASE or ROLLBACK TO SAVEPOINT was specified, but the savepoint does not exist.
+Test7b - swap savepoints across connections with rollback
+Expected Exception is A RELEASE or ROLLBACK TO SAVEPOINT was specified, but the savepoint does not exist.
+Test 9 test savepoint name
+Test 10 test savepoint name case sensitivity
+Test 11 rolling back a savepoint multiple times - should work
+Test 12 releasing a savepoint multiple times - should not work
+Expected Exception is SAVEPOINT, MyName does not  exist or is not active in the current transaction.
+Test 13 shouldn't be able to use a savepoint from earlier transaction after setting autocommit on and off
+Expected Exception is SAVEPOINT, MyName does not  exist or is not active in the current transaction.
+Test 14 A non-user initiated transaction rollback should release the internal savepoint array
+Expected Exception is A lock could not be obtained within the time requested
+Expected Exception is SAVEPOINT, MyName does not  exist or is not active in the current transaction.
+Test 15 check savepoints in batch
+Test 16 grammar check for savepoint sq1
+Expected Exception is Syntax error: MISSING ON ROLLBACK RETAIN CURSORS.
+Expected Exception is Multiple or conflicting keywords involving the 'ON ROLLBACK RETAIN CURSORS' clause are present.
+Expected Exception is Multiple or conflicting keywords involving the 'ON ROLLBACK RETAIN LOCKS' clause are present.
+Expected Exception is Multiple or conflicting keywords involving the 'UNIQUE' clause are present.
+Test 17 No nested savepoints allowed when using SQL to set savepoints.
+Test 17a Test with UNIQUE clause.
+Expected Exception is The maximum number of savepoints has been reached. 
+Test 17b Test without UNIQUE clause.
+Since no nesting is allowed, skipping UNIQUE still gives error for trying to define another savepoint
+Expected Exception is The maximum number of savepoints has been reached. 
+Test 18 No nested SQL savepoints allowed inside JDBC savepoint.
+Following SQL savepoint will fail because we are trying to nest it inside JDBC savepoint
+Expected Exception is The maximum number of savepoints has been reached. 
+Test 19 No nested SQL savepoints allowed inside SQL savepoint.
+Following SQL savepoint will fail because we are trying to nest it inside SQL savepoint
+Expected Exception is The maximum number of savepoints has been reached. 
+Test 20 Rollback of SQL savepoint works same as rollback of JDBC savepoint.
+Test 21 After releasing the SQL savepoint, rollback the transaction and should see everything undone.
+Test 22 Should not be able to create a SQL savepoint starting with name SYS
+Expected Exception is An object cannot be created with the schema name 'SYS'.
+Test 23 Should be able to use non-reserved keywords savepoint and release as identifiers
+Create table with savepoint and release as identifiers
+Create a savepoint with name savepoint
+Release the savepoint with name savepoint
+Create a savepoint with name release
+Rollback to the savepoint with name release
+Release the savepoint with name release
+Test 24 Savepoint name can't exceed 128 characters
+Expected Exception is The name 'MyName1234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890' is too long. The maximum length is '128'.
+Test 25 Should not be able to create a SQL savepoint starting with name SYS through jdbc
+Expected Exception is An object cannot be created with the schema name 'SYS'.
+Test 26a rollback of null savepoint
+Expected Exception is SAVEPOINT, null does not  exist or is not active in the current transaction.
+Test 26b release  of null savepoint
+Expected Exception is SAVEPOINT, null does not  exist or is not active in the current transaction.
+Next try non-DRDA tests
+Test40 - named savepoint can't conflict with internally generated name for unnamed savepoints
+Test41a - Rollback to a savepoint, then try to release savepoint created after that savepoint
+Expected Exception is SAVEPOINT, s2 does not  exist or is not active in the current transaction.
+Test41b - Rollback to a savepoint, then try to rollback savepoint created after that savepoint
+Expected Exception is SAVEPOINT, s2 does not  exist or is not active in the current transaction.
+Test42 - Rollback/commit the transaction, then try to use savepoint from that transaction
+Expected Exception is SAVEPOINT, SAVEPT5 does not  exist or is not active in the current transaction.
+Expected Exception is SAVEPOINT, SAVEPT6 does not  exist or is not active in the current transaction.
+Test43 - Release and reuse a savepoint name
+Expected Exception is A SAVEPOINT with the passed name already exists in the current transaction.
+Test 45 reuse savepoint name after rollback - should not work
+Expected Exception is A SAVEPOINT with the passed name already exists in the current transaction.
+Test 46 Cursors declared before and within the savepoint unit will be closed when rolling back the savepoint
+Expected Exception is ResultSet not open. Operation 'next' not permitted. Verify that autocommit is OFF.
+Expected Exception is ResultSet not open. Operation 'next' not permitted. Verify that autocommit is OFF.
+Expected Exception is ResultSet not open. Operation 'next' not permitted. Verify that autocommit is OFF.
+Expected Exception is ResultSet not open. Operation 'next' not permitted. Verify that autocommit is OFF.
+Test 47 multiple tests for getSavepointId()
+8
+9
+10
+11
+12
+Test 48 No nested SQL savepoints allowed.
+Following SQL savepoint will fail because we are trying to nest it inside JDBC savepoint
+Expected Exception is The maximum number of savepoints has been reached. 
+Expected Exception is The maximum number of savepoints has been reached. 
diff --git a/java/testing/org/apache/derbyTesting/functionTests/suites/DerbyNet.exclude b/java/testing/org/apache/derbyTesting/functionTests/suites/DerbyNet.exclude
index d23d1f2a8..7620935d2 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/suites/DerbyNet.exclude
+++ b/java/testing/org/apache/derbyTesting/functionTests/suites/DerbyNet.exclude
@@ -28,3 +28,5 @@ jdbcapi/checkDataSource30.java
 jdbcapi/statementJdbc30.java
 lang/holdCursorJava.java
 jdbcapi/dataSourceReference.java
+#no XA for JCC
+jdbcapi/savepointJdbc30_XA.java
diff --git a/java/testing/org/apache/derbyTesting/functionTests/suites/jdk14.runall b/java/testing/org/apache/derbyTesting/functionTests/suites/jdk14.runall
index 16b68cf01..96a647fa2 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/suites/jdk14.runall
+++ b/java/testing/org/apache/derbyTesting/functionTests/suites/jdk14.runall
@@ -7,4 +7,5 @@ lang/procedureJdbc30.java
 jdbcapi/resultsetJdbc30.java
 jdbcapi/statementJdbc30.java
 jdbcapi/savepointJdbc30_JSR169.java
+jdbcapi/savepointJdbc30_XA.java
 
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/build.xml b/java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/build.xml
index 25ac2690c..e31d2894e 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/build.xml
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/build.xml
@@ -76,6 +76,7 @@
       <exclude name="${this.dir}/resultsetJdbc30.java"/>
       <exclude name="${this.dir}/statementJdbc30.java"/>
       <exclude name="${this.dir}/savepointJdbc30_JSR169.java"/>
+      <exclude name="${this.dir}/savepointJdbc30_XA.java"/>
       <exclude name="${this.dir}/xaJNDI.java"/>
       <exclude name="${this.dir}/lobStreams.java"/>
     </javac>
@@ -101,6 +102,7 @@
       <include name="${this.dir}/dbMetaDataJdbc30.java"/>
       <include name="${this.dir}/checkDataSource30.java"/>
       <include name="${this.dir}/savepointJdbc30_JSR169.java"/>
+      <include name="${this.dir}/savepointJdbc30_XA.java"/>
       <include name="${this.dir}/dataSourcePermissions.java"/>
       <include name="${this.dir}/parameterMetaDataJdbc30.java"/>
       <include name="${this.dir}/resultsetJdbc30.java"/>
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/copyfiles.ant b/java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/copyfiles.ant
index 58eae4e78..712d8bb0f 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/copyfiles.ant
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/copyfiles.ant
@@ -38,6 +38,8 @@ resultset_app.properties
 resultset_derby.properties
 savepointJdbc30_JSR169_app.properties
 savepointJdbc30_JSR169_derby.properties
+savepointJdbc30_XA_app.properties
+savepointJdbc30_XA_derby.properties
 secureUsers.sql
 secureUsers1.sql
 secureUsers1_app.properties
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/savepointJdbc30_JSR169.java b/java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/savepointJdbc30_JSR169.java
index df8854169..1c1fb6a4d 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/savepointJdbc30_JSR169.java
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/savepointJdbc30_JSR169.java
@@ -22,14 +22,12 @@ package org.apache.derbyTesting.functionTests.tests.jdbcapi;
 
 import java.sql.Connection;
 import java.sql.DriverManager;
-import java.sql.Savepoint;
 import java.sql.ResultSet;
-import java.sql.Statement;
 import java.sql.SQLException;
-import java.sql.Types;
+import java.sql.Savepoint;
+import java.sql.Statement;
 
 import org.apache.derby.tools.ij;
-import org.apache.derby.tools.JDBCDisplayUtil;
 import org.apache.derbyTesting.functionTests.util.TestUtil;
 /**
  * Test the new class Savepoint in jdbc 30.
@@ -50,7 +48,7 @@ public class savepointJdbc30_JSR169 {
 
 
 	public static void main(String[] args) {
-		Connection con = null, con2 = null, con3 = null;
+		Connection con = null, con2 = null;
 		Statement  s;
 		System.out.println("Test savepointJdbc30 starting");
 
@@ -60,40 +58,12 @@ public class savepointJdbc30_JSR169 {
 			// make the initial connection.
 			ij.getPropertyArg(args);
 			con = ij.startJBMS();
-			isDerbyNet = TestUtil.isNetFramework();
-
-			con.setAutoCommit(true); // make sure it is true
-			s = con.createStatement();
 			con2 = ij.startJBMS();
-			con2.setAutoCommit(false);
-			/* Create the table and do any other set-up */
-			setUpTest(s);
-
-			//JCC translates the JDBC savepoint calls into equivalent SQL statements.
-			//In addition, we do not allow nested savepoints when
-			//coming through SQL statements. Because of this restriction, we can't run most of the
-			//JDBC savepoint tests under DRDA framework. The JDBC tests have nested JDBC savepoint
-			//calls and they fail when run under JCC(because they get translated into nested SQL savepoints).
-			//Hence, splitting the test cases into non-DRDA and more generic tests.
-			System.out.println("Tests common to DRDA and embedded Cloudscape");
-			genericTests(con, con2, s);
-
-			System.out.println("Next try non-DRDA tests");
-			if (!isDerbyNet)
-				nonDRDATests(con, s);
-
-			s.close();
+			runTests("regular connections", con,con2);
+			
 			con.close();
 			con2.close();
 
-			con3 = ij.startJBMS();
-			con3.setAutoCommit(true);
-			s = con3.createStatement();
-			TestUtil.cleanUpTest(s, testObjects);
-			s.close();
-			con3.close();
-
-
 		}
 		catch (SQLException e) {
 			dumpSQLExceptions(e);
@@ -103,9 +73,44 @@ public class savepointJdbc30_JSR169 {
 			e.printStackTrace(System.out);
 		}
 
-		System.out.println("Test savepointJdbc30 finished");
+	
+	}
+
+public static void runTests(String tag, Connection con, Connection con2) 
+throws SQLException {
+	
+	Statement  s;
+	System.out.println("Test savepointJdbc30 starting for "  + tag);
+	isDerbyNet = TestUtil.isNetFramework();
+	con.setAutoCommit(true); // make sure it is true
+	con2.setAutoCommit(false);
+	s = con.createStatement();
+
+	/* Create the table and do any other set-up */
+	setUpTest(s);
+
+	//JCC translates the JDBC savepoint calls into equivalent SQL statements.
+	//In addition, we do not allow nested savepoints when
+	//coming through SQL statements. Because of this restriction, we can't run most of the
+	//JDBC savepoint tests under DRDA framework. The JDBC tests have nested JDBC savepoint
+	//calls and they fail when run under JCC(because they get translated into nested SQL savepoints).
+	//Hence, splitting the test cases into non-DRDA and more generic tests.
+	System.out.println("Tests common to DRDA and embedded Cloudscape");
+	genericTests(con, con2, s);
+
+	System.out.println("Next try non-DRDA tests");
+	if (!isDerbyNet)
+		nonDRDATests(con, s);
+
+	
+	con.setAutoCommit(true);
+	TestUtil.cleanUpTest(s, testObjects);
+	
+	s.close();
+	
 	}
 
+
 	//The following tests have nested savepoints through JDBC calls. When coming through JCC,
 	//these nested JDBC savepoint calls are translated into equivalent SQL savepoint statements.
 	//But we do not allow nested savepoints coming through SQL statments
@@ -946,7 +951,7 @@ public class savepointJdbc30_JSR169 {
 		s.executeUpdate("insert into t2 values(1)");
 	}
 
-	static private void dumpSQLExceptions (SQLException se) {
+	 public static void dumpSQLExceptions (SQLException se) {
 		System.out.println("FAIL -- unexpected exception");
 		while (se != null) {
 			System.out.print("SQLSTATE("+se.getSQLState()+"):");
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/savepointJdbc30_XA.java b/java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/savepointJdbc30_XA.java
new file mode 100644
index 000000000..290c43015
--- /dev/null
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/savepointJdbc30_XA.java
@@ -0,0 +1,75 @@
+/*
+
+   Derby - Class org.apache.derbyTesting.functionTests.tests.jdbcapi.savepointJdbc30_XA.java
+
+   Copyright 2002, 2004 The Apache Software Foundation or its licensors, as applicable.
+
+   Licensed under the Apache License, Version 2.0 (the "License");
+   you may not use this file except in compliance with the License.
+   You may obtain a copy of the License at
+
+      http://www.apache.org/licenses/LICENSE-2.0
+
+   Unless required by applicable law or agreed to in writing, software
+   distributed under the License is distributed on an "AS IS" BASIS,
+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+   See the License for the specific language governing permissions and
+   limitations under the License.
+
+ */
+
+package org.apache.derbyTesting.functionTests.tests.jdbcapi;
+
+import java.sql.Connection;
+import java.sql.Savepoint;
+import java.sql.ResultSet;
+import java.sql.Statement;
+import java.sql.SQLException;
+import java.sql.Types;
+import java.util.Properties;
+
+import javax.sql.XADataSource;
+
+import org.apache.derby.tools.ij;
+import org.apache.derbyTesting.functionTests.util.TestUtil;
+/**
+ * Additional savepoint tests not available with J2ME for connections
+ * obtained from XADataSource (DERBY-898/DERBY-899)
+ */
+
+
+public class savepointJdbc30_XA  extends savepointJdbc30_JSR169{
+
+
+
+	public static void main(String[] args) {
+		Connection con = null, con2 = null;
+	    // Check savepoints for local transactions for
+		// connections fromXADataSource	    
+	    
+	    try {
+	    // Get a connection just to set up the environment with the properties
+	    ij.getPropertyArg(args);	
+	    ij.startJBMS().close();
+		// Test connections obtained via XADataSource DERBY-898/899
+		Properties dsprops = new Properties();
+		dsprops.setProperty("databaseName","wombat");
+		XADataSource ds  = TestUtil.getXADataSource(dsprops);
+		con = ds.getXAConnection().getConnection();
+		con2 = ds.getXAConnection().getConnection();
+		
+		runTests("connections from XADataSource (local tranasaction)", 
+				 con, con2);
+		con.close();
+		con2.close();
+	    }
+		catch (SQLException e) {
+		    dumpSQLExceptions(e);
+				}
+		catch (Throwable e) {
+			System.out.println("FAIL -- unexpected exception:");
+			e.printStackTrace(System.out);
+		}
+
+	}
+}
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/savepointJdbc30_XA_app.properties b/java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/savepointJdbc30_XA_app.properties
new file mode 100644
index 000000000..ed2914d75
--- /dev/null
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/savepointJdbc30_XA_app.properties
@@ -0,0 +1,5 @@
+runwithfoundation=false
+runwithj9=false
+runwithjdk13=false
+runwithibm13=false
+usedefaults=true
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/savepointJdbc30_XA_derby.properties b/java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/savepointJdbc30_XA_derby.properties
new file mode 100644
index 000000000..aa29bde6a
--- /dev/null
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/savepointJdbc30_XA_derby.properties
@@ -0,0 +1,3 @@
+#there is a lock time out test case, setting waittimeout to lower value for that
+derby.infolog.append=true
+derby.locks.waitTimeout=4
