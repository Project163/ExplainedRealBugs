diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/store/RecoveryAfterBackup.java b/java/testing/org/apache/derbyTesting/functionTests/tests/store/RecoveryAfterBackup.java
index d825c14d5..52f777808 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/store/RecoveryAfterBackup.java
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/store/RecoveryAfterBackup.java
@@ -77,12 +77,9 @@ public class RecoveryAfterBackup
             s.execute ("INSERT INTO t1 SELECT a+128 FROM t1");
 
             // Shut down database
-            Properties shutdownAttrs = new Properties();
-            shutdownAttrs.setProperty("shutdownDatabase", "shutdown");
             System.out.println("Shutting down database ...");
             try {
-                DataSource ds = TestUtil.getDataSource(shutdownAttrs);
-                ds.getConnection();
+            	TestUtil.getConnection("", "shutdown=true");
             } catch(SQLException sqle) {
                 if (sqle.getSQLState() != null 
                     && sqle.getSQLState().equals("XJ015")) {
@@ -94,12 +91,10 @@ public class RecoveryAfterBackup
 
             // Start up with rollforward-recovery
             System.out.println("Starting restore with roll-forward recovery..");
-            Properties restoreAttrs = new Properties();
-            restoreAttrs.setProperty("DatabaseName", "hairynosedwombat");
-            restoreAttrs.setProperty("connectionAttributes", 
-                  "rollForwardRecoveryFrom=extinout/mybackup/hairynosedwombat");
-            DataSource ds = TestUtil.getDataSource(restoreAttrs);
-            conn = ds.getConnection();
+            String dbName = "hairynosedwombat";
+            String connAttrs = 
+            	"rollForwardRecoveryFrom=extinout/mybackup/hairynosedwombat";
+            conn = TestUtil.getConnection(dbName, connAttrs);
 
             // After restore table should contain all records inserted above
             System.out.println("Verifying database ...");
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/store/RecoveryAfterBackupSetup_app.properties b/java/testing/org/apache/derbyTesting/functionTests/tests/store/RecoveryAfterBackupSetup_app.properties
index 38fb29bea..be3b75092 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/store/RecoveryAfterBackupSetup_app.properties
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/store/RecoveryAfterBackupSetup_app.properties
@@ -1,5 +1,15 @@
 useextdirs=true
-usedefaults=true
-database=hairynosedwombat;create=true
+ij.database=hairynosedwombat;create=true
+ij.protocol=jdbc:derby:
+
+ij.showNoConnectionsAtStart=true
+ij.showNoCountForSelect=true
+
+ij.defaultResourcePackage=/org/apache/derbyTesting/functionTests/tests/store/
+
 #exclude with SecurityManager
 noSecurityManager=true
+
+# DataSource properties, only used if ij.dataSource is set
+ij.dataSource.databaseName=hairynosedwombat
+ij.dataSource.createDatabase=create
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/store/RecoveryAfterBackup_app.properties b/java/testing/org/apache/derbyTesting/functionTests/tests/store/RecoveryAfterBackup_app.properties
index 9b13a16e1..6e90dd57b 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/store/RecoveryAfterBackup_app.properties
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/store/RecoveryAfterBackup_app.properties
@@ -1,4 +1,13 @@
-usedefaults=true
-database=hairynosedwombat
+ij.database=hairynosedwombat
+ij.protocol=jdbc:derby:
+
+ij.showNoConnectionsAtStart=true
+ij.showNoCountForSelect=true
+
+ij.defaultResourcePackage=/org/apache/derbyTesting/functionTests/tests/store/
+
 #exclude with SecurityManager
 noSecurityManager=true
+
+# DataSource properties, only used if ij.dataSource is set
+ij.dataSource.databaseName=hairynosedwombat
diff --git a/java/testing/org/apache/derbyTesting/functionTests/util/TestUtil.java b/java/testing/org/apache/derbyTesting/functionTests/util/TestUtil.java
index fcea2317e..074dfb571 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/util/TestUtil.java
+++ b/java/testing/org/apache/derbyTesting/functionTests/util/TestUtil.java
@@ -694,8 +694,48 @@ public class TestUtil {
         }	
     }
 
-	
-	public static Connection getDataSourceConnection (Properties prop) throws SQLException {
+    
+    /**
+     * Get connection to given database using the connection attributes. This
+     * method is used by tests to get a secondary connection with 
+     * different set of attributes. It does not use what is specified in 
+     * app_properties file or system properties. This method uses DataSource 
+     * class for CDC/Foundation Profile environments, which are based on 
+     * JSR169. Using DataSource will not work with other j9 profiles. So
+     * DriverManager is used for non-JSR169. The method is used as a wrapper to
+     * hide this difference in getting connections in different environments.
+     *  
+     * @param databaseName
+     * @param connAttrs
+     * @return Connection to database 
+     * @throws SQLException on failure to connect.
+     * @throws ClassNotFoundException on failure to load driver.
+     * @throws InstantiationException on failure to load driver.
+     * @throws IllegalAccessException on failure to load driver.
+     */
+    public static Connection getConnection(String databaseName, 
+    									   String connAttrs) 
+    	throws SQLException, ClassNotFoundException, 
+				InstantiationException, IllegalAccessException {
+    	
+    	Connection conn;
+    	if(TestUtil.HAVE_DRIVER_CLASS) {
+    		String driver = "org.apache.derby.jdbc.EmbeddedDriver";
+    		Class.forName(driver).newInstance();
+    		conn = DriverManager.getConnection("jdbc:derby:" + databaseName 
+												+ ";" + connAttrs );
+    	}
+    	else {
+    		//Use DataSource for JSR169
+	    	Properties prop = new Properties();
+	        prop.setProperty("databaseName", databaseName);
+	        prop.setProperty("connectionAttributes", connAttrs);
+	        conn = getDataSourceConnection(prop);
+    	}
+        return conn;
+    }
+    
+    public static Connection getDataSourceConnection (Properties prop) throws SQLException {
 		DataSource ds = TestUtil.getDataSource(prop);
 		try {
 			Connection conn = ds.getConnection();
