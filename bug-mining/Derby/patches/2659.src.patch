diff --git a/java/engine/org/apache/derby/impl/store/raw/data/BaseDataFileFactory.java b/java/engine/org/apache/derby/impl/store/raw/data/BaseDataFileFactory.java
index 6716495b5..7122fa25e 100644
--- a/java/engine/org/apache/derby/impl/store/raw/data/BaseDataFileFactory.java
+++ b/java/engine/org/apache/derby/impl/store/raw/data/BaseDataFileFactory.java
@@ -526,7 +526,8 @@ public class BaseDataFileFactory
 
 		if (isReadOnly())		// do enough to close all files, then return 
         {
-            storageFactory.shutdown();
+			if (storageFactory != null)
+				storageFactory.shutdown();
 			return;
         }
 
@@ -1583,15 +1584,18 @@ public class BaseDataFileFactory
 	*/
 	private synchronized void removeStubs()
 	{
-        actionCode = REMOVE_STUBS_ACTION;
-        try
+        if( storageFactory != null) 
         {
-            AccessController.doPrivileged( this);
+            actionCode = REMOVE_STUBS_ACTION;
+            try
+            {
+                AccessController.doPrivileged( this);
+            }
+            catch (PrivilegedActionException pae)
+            {
+                // removeStubs does not throw an exception
+            } 
         }
-        catch (PrivilegedActionException pae)
-        {
-            // removeStubs does not throw an exception
-        } 
 	}
 
 	/**
