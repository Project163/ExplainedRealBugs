diff --git a/java/engine/org/apache/derby/impl/sql/compile/sqlgrammar.jj b/java/engine/org/apache/derby/impl/sql/compile/sqlgrammar.jj
index 61f7c8461..3ef4d7352 100755
--- a/java/engine/org/apache/derby/impl/sql/compile/sqlgrammar.jj
+++ b/java/engine/org/apache/derby/impl/sql/compile/sqlgrammar.jj
@@ -9657,7 +9657,12 @@ DB2DefaultOption(String columnName) throws StandardException :
 	}
 |
 	LOOKAHEAD( {getToken(2).kind == LEFT_PAREN ||
-				getToken(4).kind == LEFT_PAREN})
+		       (getToken(4).kind == LEFT_PAREN && 
+		        getToken(2).kind != COMMA)} ) 
+		// Check against comma: see Derby-331 
+		// Before adding this, the following was erroneously
+		// flagged as invalid: 
+		//	   create table foo(.., b int default 0, unique (a))
 	value = miscBuiltins()
 	{
 		// If we have a function (as indicated by an open paren,
diff --git a/java/testing/org/apache/derbyTesting/functionTests/master/columnDefaults.out b/java/testing/org/apache/derbyTesting/functionTests/master/columnDefaults.out
index 3618352a7..5541be9f3 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/master/columnDefaults.out
+++ b/java/testing/org/apache/derbyTesting/functionTests/master/columnDefaults.out
@@ -175,6 +175,17 @@ ij> select * from t7;
 C1         
 -----------
 10         
+ij> -- JIRA issue Derby-331
+create table t_331 (a int not null, b int default 0, unique (a));
+0 rows inserted/updated/deleted
+ij> insert into t_331 values (4, default);
+1 row inserted/updated/deleted
+ij> insert into t_331 values (4, default);
+ERROR 23505: The statement was aborted because it would have caused a duplicate key value in a unique or primary key constraint or unique index identified by 'xxxxGENERATED-IDxxxx' defined on 'T_331'.
+ij> select * from t_331;
+A          |B          
+-----------------------
+4          |0          
 ij> -- clean up
 drop function asdf;
 0 rows inserted/updated/deleted
@@ -188,4 +199,6 @@ ij> drop table "otherschema"."y1";
 0 rows inserted/updated/deleted
 ij> drop schema "otherschema" restrict;
 0 rows inserted/updated/deleted
+ij> drop table t_331;
+0 rows inserted/updated/deleted
 ij> 
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/lang/columnDefaults.sql b/java/testing/org/apache/derbyTesting/functionTests/tests/lang/columnDefaults.sql
index 07e128e37..0b0ea263e 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/lang/columnDefaults.sql
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/lang/columnDefaults.sql
@@ -103,6 +103,12 @@ create table t7(c1 int default 10);
 insert into t7 values (default);
 select * from t7;
 
+-- JIRA issue Derby-331
+create table t_331 (a int not null, b int default 0, unique (a));
+insert into t_331 values (4, default);
+insert into t_331 values (4, default);
+select * from t_331;
+
 -- clean up
 drop function asdf;
 drop table t1;
@@ -110,3 +116,5 @@ drop table t7;
 drop table "x1";
 drop table "otherschema"."y1";
 drop schema "otherschema" restrict;
+drop table t_331;
+
