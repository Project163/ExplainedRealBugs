diff --git a/java/engine/org/apache/derby/impl/sql/compile/FromVTI.java b/java/engine/org/apache/derby/impl/sql/compile/FromVTI.java
index f67f0dbd1..afcc325a5 100644
--- a/java/engine/org/apache/derby/impl/sql/compile/FromVTI.java
+++ b/java/engine/org/apache/derby/impl/sql/compile/FromVTI.java
@@ -885,27 +885,40 @@ public class FromVTI extends FromTable implements VTIEnvironment
             //
             // Table Function parameters may not reference columns from other tables in the
             // FROM list of the current query block. See DERBY-5579. We also do not allow
-            // VTI parameters to refer to other VTIs.
+            // VTI parameters to refer to other VTIs. We also do not allow even VTIs to
+            // reference other elements in the current <joined table>.
             //
             int referencedTableNumber = ref.getTableNumber();
+            boolean illegalReference = !ref.getCorrelated();
 
-            for ( int i = 0; i < fromListParam.size(); i++ )
+            if ( !ref.getCorrelated() ) // if the arg refers to a table in this query block
             {
-                FromTable   fromTable = (FromTable) fromListParam.elementAt( i );
-
-                if ( referencedTableNumber == fromTable.getTableNumber() )
+                for ( int i = 0; i < fromListParam.size(); i++ )
                 {
-                    // remember this FromTable so that we can code generate the arg
-                    // from actual result columns later on.
-                    argSources.put( new Integer( fromTable.getTableNumber() ), fromTable );
-                    
-                    if ( isDerbyStyleTableFunction || (fromTable instanceof FromVTI) )
+                    FromTable   fromTable = (FromTable) fromListParam.elementAt( i );
+
+                    if ( referencedTableNumber == fromTable.getTableNumber() )
                     {
-                        throw StandardException.newException
-                            ( SQLState.LANG_BAD_TABLE_FUNCTION_PARAM_REF, ref.getSQLColumnName() );
+                        // remember this FromTable so that we can code generate the arg
+                        // from actual result columns later on.
+                        argSources.put( new Integer( fromTable.getTableNumber() ), fromTable );
+
+                        // the only legal kind of reference is a VTI argument which
+                        // references a non-VTI table in the current query block
+                        if ( !isDerbyStyleTableFunction && !(fromTable instanceof FromVTI) )
+                        {
+                            illegalReference = false;
+                            break;
+                        }
                     }
                 }
             }
+            
+            if ( illegalReference )
+            {
+                throw StandardException.newException
+                    ( SQLState.LANG_BAD_TABLE_FUNCTION_PARAM_REF, ref.getSQLColumnName() );
+            }
 
 			// Rebind the CR if the tableNumber is uninitialized
 			if (ref.getTableNumber() == -1)
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/lang/TableFunctionTest.java b/java/testing/org/apache/derbyTesting/functionTests/tests/lang/TableFunctionTest.java
index 6cf004086..a5f777f3c 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/lang/TableFunctionTest.java
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/lang/TableFunctionTest.java
@@ -52,6 +52,8 @@ public class TableFunctionTest extends BaseJDBCTestCase
 
     private static  final   String  UTF8 = "UTF-8";
 
+    private static  final   String  BAD_ARG_JOIN = "42ZB7";
+
     private static  final   int MAX_VARIABLE_DATA_TYPE_LENGTH = 32700;
     
     // functions to drop at teardown time
@@ -2064,10 +2066,34 @@ public class TableFunctionTest extends BaseJDBCTestCase
         // by DERBY-5779.
         expectError
             (
-             "42ZB7",
+             BAD_ARG_JOIN,
              "select tablename, contents\n" +
              "from sys.systables t, table( lowerCaseRow( cast (t.tablename as varchar(32672)) ) ) s\n"
              );
+        // diagnostic vti arg joining to another table in a <joined table> clause
+        expectError
+            (
+             BAD_ARG_JOIN,
+             "select tt.* from table(syscs_diag.space_table(st.tablename)) tt join sys.systables st using(tableid)"
+             );
+        // table function arg joining to another table in a <joined table> clause
+        expectError
+            (
+             BAD_ARG_JOIN,
+             "select tt.* from table( lowerCaseRow(st.tablename)) tt join sys.systables st on tt.contents = st.tablename"
+             );
+        // diagnostic vti arg joining to another table in a <joined table> clause
+        expectError
+            (
+             BAD_ARG_JOIN,
+             "select tt.* from table(syscs_diag.space_table(st.tablename)) tt right join sys.systables st using(tableid)"
+             );
+        // table function arg joining to another table in a <joined table> clause
+        expectError
+            (
+             BAD_ARG_JOIN,
+             "select tt.* from table( lowerCaseRow(st.tablename)) tt right join sys.systables st on tt.contents = st.tablename"
+             );
 
         // pre-existing error not affected: table function correlated
         // to inner query block
