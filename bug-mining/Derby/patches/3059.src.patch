diff --git a/java/testing/org/apache/derbyTesting/junit/SecurityManagerSetup.java b/java/testing/org/apache/derbyTesting/junit/SecurityManagerSetup.java
index fe8d1c202..c76c46743 100644
--- a/java/testing/org/apache/derbyTesting/junit/SecurityManagerSetup.java
+++ b/java/testing/org/apache/derbyTesting/junit/SecurityManagerSetup.java
@@ -97,11 +97,14 @@ public final class SecurityManagerSetup extends TestSetup {
     private static boolean checkIfJacocoIsRunning() {
         return AccessController.doPrivileged(new PrivilegedAction<Boolean>() {
                 public Boolean run() {
-                    if (getURL("org.jacoco.agent.rt.RT") != null) {
-                        System.setProperty("jacoco.active", "");
-                        return Boolean.TRUE;
+                    try {
+                        Class.forName("org.jacoco.agent.rt.RT");
+                        return true;
+                    } catch (ClassNotFoundException e) {
+                        return false;
+                    } catch (LinkageError e) {
+                        return false;
                     }
-                    return Boolean.FALSE;
                 }
         });
     }
diff --git a/java/testing/org/apache/derbyTesting/unitTests/junit/MissingPermissionsTest.policy b/java/testing/org/apache/derbyTesting/unitTests/junit/MissingPermissionsTest.policy
index 93ae28791..ec64bfeac 100644
--- a/java/testing/org/apache/derbyTesting/unitTests/junit/MissingPermissionsTest.policy
+++ b/java/testing/org/apache/derbyTesting/unitTests/junit/MissingPermissionsTest.policy
@@ -154,3 +154,9 @@ grant codeBase "${derbyTesting.antjunit}" {
     // This permission is needed when running the tests using ant 1.7
     permission java.io.FilePermission "${user.dir}${/}*", "write";
 };
+
+// Grant the required permissions for JaCoCo (code coverage tool).
+grant {
+  permission java.io.FilePermission "${jacoco.active}${user.dir}${/}*", "read, write";
+  permission java.lang.RuntimePermission "${jacoco.active}shutdownHooks";
+};
