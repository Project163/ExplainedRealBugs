diff --git a/java/engine/org/apache/derby/impl/sql/compile/GroupByList.java b/java/engine/org/apache/derby/impl/sql/compile/GroupByList.java
index 8b96de9d3..b7498211d 100644
--- a/java/engine/org/apache/derby/impl/sql/compile/GroupByList.java
+++ b/java/engine/org/apache/derby/impl/sql/compile/GroupByList.java
@@ -220,6 +220,13 @@ public class GroupByList extends OrderedColumnList
 				*/
 				numColsAddedHere++;
 			}
+			if (groupingCol.getColumnExpression() instanceof JavaToSQLValueNode) 
+			{
+				// disallow any expression which involves native java computation. 
+				// Not possible to consider java expressions for equivalence.
+				throw StandardException.newException(					
+						SQLState.LANG_INVALID_GROUPED_SELECT_LIST);
+			}
 		}
 
 		/* Verify that no subqueries got added to the dummy list */
diff --git a/java/engine/org/apache/derby/impl/sql/compile/VerifyAggregateExpressionsVisitor.java b/java/engine/org/apache/derby/impl/sql/compile/VerifyAggregateExpressionsVisitor.java
index ec554364e..4e623ad58 100644
--- a/java/engine/org/apache/derby/impl/sql/compile/VerifyAggregateExpressionsVisitor.java
+++ b/java/engine/org/apache/derby/impl/sql/compile/VerifyAggregateExpressionsVisitor.java
@@ -119,15 +119,7 @@ public class VerifyAggregateExpressionsVisitor implements Visitor
 							SQLState.LANG_INVALID_NON_GROUPED_SELECT_LIST :
 							SQLState.LANG_INVALID_GROUPED_SELECT_LIST);
 			}
-		} else if (node instanceof JavaToSQLValueNode) 
-		{
-			// disallow any expression which involves native java computation. 
-		    	// Not possible to consider java expressions for equivalence.
-			throw StandardException.newException( (groupByList == null) ?
-					SQLState.LANG_INVALID_NON_GROUPED_SELECT_LIST :
-						SQLState.LANG_INVALID_GROUPED_SELECT_LIST);
 		}
-
 		return node;
 	}
 
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/lang/GroupByExpressionTest.java b/java/testing/org/apache/derbyTesting/functionTests/tests/lang/GroupByExpressionTest.java
index 379713a18..117827349 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/lang/GroupByExpressionTest.java
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/lang/GroupByExpressionTest.java
@@ -478,7 +478,9 @@ public class GroupByExpressionTest extends BaseJDBCTestCase
         // disallow java function 
         assertCompileError(
                 "42Y30", "select r(), count(*) from test group by r()");
-
+        
+        assertCompileError(
+                "42Y30", "select count(*) from test group by r()");
         // invalid grouping expression.
         assertCompileError(
                 "42Y30", "select c1+1, count(*) from test group by c1+2");
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/lang/RoutineTest.java b/java/testing/org/apache/derbyTesting/functionTests/tests/lang/RoutineTest.java
index fefa4e84a..ac44e1126 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/lang/RoutineTest.java
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/lang/RoutineTest.java
@@ -23,6 +23,7 @@ package org.apache.derbyTesting.functionTests.tests.lang;
 
 import java.io.UnsupportedEncodingException;
 import java.sql.PreparedStatement;
+import java.sql.ResultSet;
 import java.sql.SQLException;
 import java.sql.Statement;
 import java.sql.Time;
@@ -461,6 +462,23 @@ public class RoutineTest extends BaseJDBCTestCase {
         s.close();
     }
     
+    /**
+     * Test function with an aggregate argument. DERBY-3649
+     * @throws SQLException
+     */
+    public void testAggregateArgument() throws SQLException
+    {
+    	Statement s = createStatement();
+    	s.executeUpdate("CREATE TABLE TEST (I INT)");
+    	s.executeUpdate("INSERT INTO TEST VALUES(1)");
+    	s.executeUpdate("INSERT INTO TEST VALUES(2)");
+    	s.executeUpdate("CREATE FUNCTION CheckCount(count integer) RETURNS INTEGER PARAMETER STYLE JAVA NO SQL LANGUAGE JAVA EXTERNAL NAME 'org.apache.derbyTesting.functionTests.tests.lang.RoutineTest.checkCount'");
+    	ResultSet rs = s.executeQuery("select checkCount(count(*)) from test");
+    	JDBC.assertSingleValueResultSet(rs, "2");
+    	
+    	
+    }
+    
     /*
     ** Routine implementations called from the tests but do
     *  not use DriverManager so that this test can be used on
@@ -492,5 +510,19 @@ public class RoutineTest extends BaseJDBCTestCase {
         
         return t;
     }
+    
+
+    public static int checkCount(int count)
+               throws SQLException {
+           //   throws ZeroException {
+
+           if (count == 0) {
+               //throw new ZeroException();
+               throw new SQLException("No results found", "38777");
+           }
+
+           return count;
+       }
+
 }
 
