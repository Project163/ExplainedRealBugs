diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/lang/_Suite.java b/java/testing/org/apache/derbyTesting/functionTests/tests/lang/_Suite.java
index 2049355ed..23cb75a3b 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/lang/_Suite.java
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/lang/_Suite.java
@@ -169,8 +169,7 @@ public class _Suite extends BaseTestCase  {
         suite.addTest(LangHarnessJavaTest.suite());
         		
         suite.addTest(ResultSetsFromPreparedStatementTest.suite());
-        if (!( System.getProperty("java.vm.name").equals("CVM")
-            && System.getProperty("java.vm.version").startsWith("phoneme") ) )
+        if (!isPhoneME())
         { // Disable temporarily until CVM/phoneME is fixed.. See DERBY-4290)
         suite.addTest(OrderByAndSortAvoidance.suite());
         }
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/memory/MemoryLeakFixesTest.java b/java/testing/org/apache/derbyTesting/functionTests/tests/memory/MemoryLeakFixesTest.java
index 321e1e651..cd1ed9357 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/memory/MemoryLeakFixesTest.java
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/memory/MemoryLeakFixesTest.java
@@ -230,11 +230,20 @@ public class MemoryLeakFixesTest extends BaseJDBCTestCase {
             JDBCDataSource.setBeanProperty(ds, "shutdownDatabase", "shutdown");
             try {
                 ds.getConnection();
+                fail("Expected shutdown exception");
             } catch (SQLException e) {
                 assertSQLState("08006", e);
             } finally {
                 JDBCDataSource.clearStringBeanProperty(ds, "shutdownDatabase");
             }
+
+            if (isPhoneME()) {
+                // DERBY-5412: phoneME fails after some iterations because the
+                // number of class names exceeds a VM limit. If we invoke
+                // garbage collection manually, it seems to be able to reclaim
+                // the classes that are no longer in use, and complete the test.
+                Runtime.getRuntime().gc();
+            }
         }
 
         // extra sanity check making sure that the database was created in the
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/upgradeTests/OldVersions.java b/java/testing/org/apache/derbyTesting/functionTests/tests/upgradeTests/OldVersions.java
index bee3106aa..212b80550 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/upgradeTests/OldVersions.java
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/upgradeTests/OldVersions.java
@@ -100,8 +100,7 @@ public class OldVersions
             }
             // Derby 10.3.1.4 does not boot on the phoneME advanced platform,
             // (see DERBY-3176) so don't run upgrade tests in this combination.
-            if ( System.getProperty("java.vm.name").equals("CVM")
-                  && System.getProperty("java.vm.version").startsWith("phoneme")
+            if ( BaseTestCase.isPhoneME()
                   && old[i][0]==10 && old[i][1]==3 
                   && old[i][2]==1 && old[i][3]==4 ) {
                 traceit("Skipping 10.3.1.4 on CVM/phoneme");
diff --git a/java/testing/org/apache/derbyTesting/junit/BaseTestCase.java b/java/testing/org/apache/derbyTesting/junit/BaseTestCase.java
index c4c942c9c..fc85ed49e 100644
--- a/java/testing/org/apache/derbyTesting/junit/BaseTestCase.java
+++ b/java/testing/org/apache/derbyTesting/junit/BaseTestCase.java
@@ -606,6 +606,16 @@ public abstract class BaseTestCase
                 "Oracle Corporation".equals(vendor);
     }
 
+    /**
+     * Check if the VM is phoneME.
+     *
+     * @return true if it is phoneME
+     */
+    public static boolean isPhoneME() {
+        return getSystemProperty("java.vm.name").equals("CVM") &&
+                getSystemProperty("java.vm.version").startsWith("phoneme");
+    }
+
     /**
      * Determine if there is a platform match with os.name.
      * This method uses an exact equals. Other methods might be useful
