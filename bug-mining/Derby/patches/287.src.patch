diff --git a/java/engine/org/apache/derby/iapi/reference/MessageId.java b/java/engine/org/apache/derby/iapi/reference/MessageId.java
index 75ab12612..392b8214e 100644
--- a/java/engine/org/apache/derby/iapi/reference/MessageId.java
+++ b/java/engine/org/apache/derby/iapi/reference/MessageId.java
@@ -71,7 +71,7 @@ public interface MessageId {
     String STORE_SHUTDOWN_MSG               = "D002";
     String STORE_BACKUP_STARTED             = "D004";
     String STORE_MOVED_BACKUP               = "D005";
-    String STORE_COPIED_DB_DIR              = "D006";
+    String STORE_DATA_SEG_BACKUP_COMPLETED  = "D006";
     String STORE_EDITED_SERVICEPROPS        = "D007";
     String STORE_ERROR_EDIT_SERVICEPROPS    = "D008";
     String STORE_COPIED_LOG                 = "D009";
diff --git a/java/engine/org/apache/derby/impl/services/monitor/StorageFactoryService.java b/java/engine/org/apache/derby/impl/services/monitor/StorageFactoryService.java
index c25931cb0..a4ead52ad 100644
--- a/java/engine/org/apache/derby/impl/services/monitor/StorageFactoryService.java
+++ b/java/engine/org/apache/derby/impl/services/monitor/StorageFactoryService.java
@@ -401,69 +401,83 @@ final class StorageFactoryService implements PersistentService
 		@exception StandardException Properties cannot be saved.
 	*/
 
-	public void saveServiceProperties(String serviceName, Properties properties, boolean replace)
+	public void saveServiceProperties(final String serviceName, 
+                                      final Properties properties, 
+                                      final boolean replace)
 		throws StandardException {
-		File backupFile = null;
-
-		File servicePropertiesFile = new File(serviceName, PersistentService.PROPERTIES_NAME);
-		
-		if (replace) {
-			backupFile = new File(serviceName, PersistentService.PROPERTIES_NAME.concat("old"));
-
-			try {
-				if(!servicePropertiesFile.renameTo(backupFile)) {
-					throw StandardException.newException(SQLState.UNABLE_TO_RENAME_FILE, servicePropertiesFile, backupFile);
-				}
-			} catch (SecurityException se) {
-				throw Monitor.exceptionStartingModule(se);
-			}
-		}
-
-		FileOutputStream fos = null;
-		try {
-
-			fos = new FileOutputStream(servicePropertiesFile);
-			properties.store(fos, serviceName + MessageService.getTextMessage(MessageId.SERVICE_PROPERTIES_DONT_EDIT));
-			fos.getFD().sync();
-			fos.close();
-			fos = null;
-
-			replace = false;
 
+        try
+        {
+            AccessController.doPrivileged(
+                new PrivilegedExceptionAction()
+                {
+                    File backupFile = null;
+                    public Object run() throws StandardException
+                    {
 
-		} catch (IOException ioe) {
+                        File servicePropertiesFile = 
+                            new File(serviceName, PersistentService.PROPERTIES_NAME);
+                        if (replace) {
+                            backupFile = 
+                                new File(serviceName, PersistentService.PROPERTIES_NAME.concat("old"));
+                            try {
+                                if(!servicePropertiesFile.renameTo(backupFile)) {
+                                    throw StandardException.newException(
+                                     SQLState.UNABLE_TO_RENAME_FILE, servicePropertiesFile, backupFile);
+                                }
+                            } catch (SecurityException se) {
+                                throw Monitor.exceptionStartingModule(se);
+                            }
+                        }
 
-			if (fos != null) {
-				try {
-					fos.close();
-				} catch (IOException ioe2) {
-				}
-				fos = null;
-			}
+                        FileOutputStream fos = null;
+                        try {
+
+                            fos = new FileOutputStream(servicePropertiesFile);
+                            properties.store(fos, 
+                                             serviceName + 
+                                             MessageService.getTextMessage(
+                                                  MessageId.SERVICE_PROPERTIES_DONT_EDIT));
+                            fos.getFD().sync();
+                            fos.close();
+                            fos = null;
+                        } catch (IOException ioe) {
+
+                            if (fos != null) {
+                                try {
+                                    fos.close();
+                                } catch (IOException ioe2) {
+                                }
+                                fos = null;
+                            }
 
-			if (backupFile != null) {
-				// need to re-name the old properties file back again
-				try {
-					servicePropertiesFile.delete();
-					backupFile.renameTo(servicePropertiesFile);
-				} catch (SecurityException se) {
-				}
-			}
-			throw Monitor.exceptionStartingModule(ioe);
-		}
+                            if (backupFile != null) {
+                                // need to re-name the old properties file back again
+                                try {
+                                    servicePropertiesFile.delete();
+                                    backupFile.renameTo(servicePropertiesFile);
+                                } catch (SecurityException se) {
+                                }
+                            }
+                            throw Monitor.exceptionStartingModule(ioe);
+                        }
 		
 		
-		if (backupFile != null) {
-			try {
-				backupFile.delete();
-				backupFile = null;
-			} catch (SecurityException se) {
-				// do nothing
-			}
-		}
-
-	}
-
+                        if (backupFile != null) {
+                            try {
+                                backupFile.delete();
+                                backupFile = null;
+                            } catch (SecurityException se) {
+                                // do nothing
+                            }
+                        }
+                        return null;
+                    }
+                }
+                );
+        }catch( PrivilegedActionException pae) { throw (StandardException) pae.getException();}
+    }
+                
     /*
 	**Recreates service root if required depending on which of the following
 	**attribute is specified on the conection URL:
diff --git a/java/engine/org/apache/derby/impl/store/raw/RawStore.java b/java/engine/org/apache/derby/impl/store/raw/RawStore.java
index 7c42f58a3..1be90ad0f 100644
--- a/java/engine/org/apache/derby/impl/store/raw/RawStore.java
+++ b/java/engine/org/apache/derby/impl/store/raw/RawStore.java
@@ -140,6 +140,8 @@ public final class RawStore implements RawStoreFactory, ModuleControl, ModuleSup
     private static final int REGULAR_FILE_LIST_DIRECTORY_ACTION = 12;
     private static final int STORAGE_FILE_LIST_DIRECTORY_ACTION = 13;
     private static final int COPY_STORAGE_FILE_TO_REGULAR_ACTION = 14;
+    private static final int REGULAR_FILE_GET_CANONICALPATH_ACTION = 15;
+    private static final int STORAGE_FILE_GET_CANONICALPATH_ACTION = 16;
 
 	public RawStore() {
 	}
@@ -592,8 +594,10 @@ public final class RawStore implements RawStoreFactory, ModuleControl, ModuleSup
 		File oldbackup = null;
 		File backupcopy = null;
 		OutputStreamWriter historyFile = null;
+        StorageFile dbHistoryFile = null;
+        File backupHistoryFile = null;
 		LogInstant backupInstant = logFactory.getFirstUnflushedInstant();
-
+        
 		try
 		{
 			// first figure out our name
@@ -604,14 +608,17 @@ public final class RawStore implements RawStoreFactory, ModuleControl, ModuleSup
 
 			// append to end of history file
 			historyFile = privFileWriter( storageFactory.newStorageFile( BACKUP_HISTORY), true);
+            
+			backupcopy = new File(backupDir, dbname);
 
 			logHistory(historyFile,
                         MessageService.getTextMessage(
-                            MessageId.STORE_BACKUP_STARTED, canonicalDbName));
-
-			// if a backup copy of this database already exists,
-			backupcopy = new File(backupDir, dbname);
+                            MessageId.STORE_BACKUP_STARTED, 
+                            canonicalDbName, 
+                            getFilePath(backupcopy)));
 
+            
+            // check if a backup copy of this database already exists,
             if (privExists(backupcopy))
 			{
 				// first make a backup of the backup
@@ -637,8 +644,8 @@ public final class RawStore implements RawStoreFactory, ModuleControl, ModuleSup
                         historyFile,
                         MessageService.getTextMessage(
                             MessageId.STORE_MOVED_BACKUP,
-                            backupcopy.getCanonicalPath(),
-                            oldbackup.getCanonicalPath()));
+                            getFilePath(backupcopy),
+                            getFilePath(oldbackup)));
 					renamed = true;
 				}
 			}
@@ -651,6 +658,15 @@ public final class RawStore implements RawStoreFactory, ModuleControl, ModuleSup
                     (File) backupcopy);
             }
 
+            dbHistoryFile = storageFactory.newStorageFile(BACKUP_HISTORY);
+            backupHistoryFile = new File(backupcopy, BACKUP_HISTORY); 
+            // copy the history file into the backup. 
+            if(!privCopyFile(dbHistoryFile, backupHistoryFile))
+                throw StandardException. 
+                    newException(SQLState.RAWSTORE_ERROR_COPYING_FILE,
+                                 dbHistoryFile, backupHistoryFile);  
+
+
             // if they are any jar file stored in the database, copy them into
             // the backup. 
             StorageFile jarDir = 
@@ -780,13 +796,12 @@ public final class RawStore implements RawStoreFactory, ModuleControl, ModuleSup
 			// backup all the information in the data segment.
 			dataFactory.backupDataFiles(t, segBackup);
 
-			logHistory(historyFile,
-                MessageService.getTextMessage(
-                    MessageId.STORE_COPIED_DB_DIR,
-                    canonicalDbName,
-                    backupcopy.getCanonicalPath()));
+            logHistory(historyFile,
+                   MessageService.getTextMessage(
+                   MessageId.STORE_DATA_SEG_BACKUP_COMPLETED,
+                   getFilePath(segBackup)));
+
 
-		
             // copy the log that got generated after the backup started to
 			// backup location and tell the logfactory that backup has come to end.
 			logFactory.endLogBackup(logBackup);
@@ -794,8 +809,8 @@ public final class RawStore implements RawStoreFactory, ModuleControl, ModuleSup
 			logHistory(historyFile,
                 MessageService.getTextMessage(
                     MessageId.STORE_COPIED_LOG,
-                    logdir.getCanonicalPath(),
-                    logBackup.getCanonicalPath()));
+                    getFilePath(logdir),
+                    getFilePath(logBackup)));
 
 			error = false;
 		}
@@ -841,13 +856,19 @@ public final class RawStore implements RawStoreFactory, ModuleControl, ModuleSup
 						logHistory(historyFile,
                             MessageService.getTextMessage(
                                 MessageId.STORE_REMOVED_BACKUP,
-                                oldbackup.getCanonicalPath()));
+                                getFilePath(oldbackup)));
  					}
 					logHistory(historyFile,
                         MessageService.getTextMessage(
                             MessageId.STORE_BACKUP_COMPLETED,
                             backupInstant));
 
+                    // copy the updated version of history file with current
+                    // backup information into the backup.
+                    if(!privCopyFile(dbHistoryFile, backupHistoryFile))
+                        throw StandardException. 
+                            newException(SQLState.RAWSTORE_ERROR_COPYING_FILE,
+                                         dbHistoryFile, backupHistoryFile);  
 				}
 
 				historyFile.close();
@@ -1172,6 +1193,48 @@ public final class RawStore implements RawStoreFactory, ModuleControl, ModuleSup
 		historyFile.flush();
 	}
 
+    /*
+     * Get the file path. If the canonical path can be obtained then return the 
+     * canonical path, otherwise just return the abstract path. Typically if
+     * there are no permission to read user.dir when  running under security
+     * manager canonical path can not be obtained.
+     *
+     * This method is used to a write path name to error/status log file, where it
+     * would be nice to print full paths but not esstential that the user 
+     * grant permissions to read user.dir property.
+     */
+    private String getFilePath(StorageFile file) {
+        String path = privGetCanonicalPath(file);
+        if(path != null ) {
+            return path;
+        }else {
+            //can not get the canoncal path, 
+            // return the abstract path
+            return file.getPath();
+        }
+    }
+
+    /*
+     * Get the file path.  If the canonical path can be obtained then return the 
+     * canonical path, otherwise just return the abstract path. Typically if
+     * there are no permission to read user.dir when  running under security
+     * manager canonical path can not be obtained.
+     *
+     * This method is used to a write a file path name to error/status log file, 
+     * where it would be nice to print full paths but not esstential that the user
+     * grant permissions to read user.dir property.
+     *
+     */
+    private String getFilePath(File file) {
+        String path = privGetCanonicalPath(file);
+        if(path != null ) {
+            return path;
+        }else {
+            // can not get the canoncal path, 
+            // return the abstract path
+            return file.getPath();
+        }
+    }
 
 	protected boolean privCopyDirectory(StorageFile from, File to)
 	{
@@ -1472,7 +1535,41 @@ public final class RawStore implements RawStoreFactory, ModuleControl, ModuleSup
             actionStorageFile = null;
         }
     }
-    
+
+
+    private synchronized String privGetCanonicalPath(final StorageFile file)
+    {
+        actionCode = STORAGE_FILE_GET_CANONICALPATH_ACTION;
+        actionStorageFile = file;
+
+        try
+        {
+            return (String) AccessController.doPrivileged( this);
+        }
+        catch( PrivilegedActionException pae) { return null;} // does not throw an exception
+        finally
+        {
+            actionStorageFile = null;
+        }
+    }
+
+
+    private synchronized String privGetCanonicalPath(final File file)
+    {
+        actionCode = REGULAR_FILE_GET_CANONICALPATH_ACTION;
+        actionRegularFile = file;
+
+        try
+        {
+            return (String) AccessController.doPrivileged( this);
+        }
+        catch( PrivilegedActionException pae) { return null;} // does not throw an exception
+        finally
+        {
+            actionRegularFile = null;
+        }
+    }
+
 
     // PrivilegedExceptionAction method
     public final Object run() throws IOException
@@ -1545,8 +1642,14 @@ public final class RawStore implements RawStoreFactory, ModuleControl, ModuleSup
                                            (WritableStorageFactory) storageFactory,
                                            actionStorageFile,
                                            actionRegularFile));
-
-
+            
+        case REGULAR_FILE_GET_CANONICALPATH_ACTION:
+            // SECURITY PERMISSION - MP1
+            return (String)(actionRegularFile.getCanonicalPath());
+            
+        case STORAGE_FILE_GET_CANONICALPATH_ACTION:
+            // SECURITY PERMISSION - MP1
+            return (String)(actionStorageFile.getCanonicalPath());
         }
         return null;
     } // end of run
diff --git a/java/engine/org/apache/derby/loc/messages_en.properties b/java/engine/org/apache/derby/loc/messages_en.properties
index 6e55a6475..58118f690 100644
--- a/java/engine/org/apache/derby/loc/messages_en.properties
+++ b/java/engine/org/apache/derby/loc/messages_en.properties
@@ -1209,9 +1209,9 @@ C007=Exception loading class {0} from jar {1} - {2}
 
 D001=:\n Booting Derby version {0}: instance {1}\non database directory {2} {3} \n
 D002=:\nShutting down instance {0}
-D004=Backup started for database located at {0}
+D004=Backup started for database located at {0} to {1}.
 D005=moved old backup copy from {0} to {1}
-D006=copied database directory from {0} to {1}
+D006=Backup of data segment to {0} completed. 
 D007=edited database service.properties to use default log device
 D008=error editing database service.properties, backup aborted: {0}
 D009=copied log directory from {0} to {1}
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/store/BackupPathTests_app.properties b/java/testing/org/apache/derbyTesting/functionTests/tests/store/BackupPathTests_app.properties
index afb32bfa3..37667d7a1 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/store/BackupPathTests_app.properties
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/store/BackupPathTests_app.properties
@@ -18,5 +18,6 @@ supportfiles=tests/store/brtestjar.jar
 #Exclude for J2ME/Foundation - test uses procedure with server-side JDBC
 runwithfoundation=false
 
-#exclude with SecurityManager DERBY-709
+# Test fails with security manager due to bug DEBRY-537
 noSecurityManager=true
+
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/store/OnlineBackupTest1_app.properties b/java/testing/org/apache/derbyTesting/functionTests/tests/store/OnlineBackupTest1_app.properties
index ac32f6ef7..eee972e7d 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/store/OnlineBackupTest1_app.properties
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/store/OnlineBackupTest1_app.properties
@@ -10,9 +10,6 @@
 #
 #
 
-#database=jdbc:derby:wombat;create=true;logDevice=extinout/br1logDir
 usedefaults=true
 useextdirs=true
 
-#exclude with SecurityManager DERBY-709
-noSecurityManager=true
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/store/OnlineBackupTest3_app.properties b/java/testing/org/apache/derbyTesting/functionTests/tests/store/OnlineBackupTest3_app.properties
index 23a9f20e0..2b89ede44 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/store/OnlineBackupTest3_app.properties
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/store/OnlineBackupTest3_app.properties
@@ -18,5 +18,5 @@ supportfiles=tests/store/brtestjar.jar,tests/store/obtest_customer.jar
 #Exclude for J2ME/Foundation - test uses procedure with server-side JDBC
 runwithfoundation=false
 
-#exclude with SecurityManager DERBY-709
+# Test fails with security manager due to bug DEBRY-537
 noSecurityManager=true
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/store/RecoveryAfterBackupSetup_app.properties b/java/testing/org/apache/derbyTesting/functionTests/tests/store/RecoveryAfterBackupSetup_app.properties
index be3b75092..f70e3f0a1 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/store/RecoveryAfterBackupSetup_app.properties
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/store/RecoveryAfterBackupSetup_app.properties
@@ -7,8 +7,6 @@ ij.showNoCountForSelect=true
 
 ij.defaultResourcePackage=/org/apache/derbyTesting/functionTests/tests/store/
 
-#exclude with SecurityManager
-noSecurityManager=true
 
 # DataSource properties, only used if ij.dataSource is set
 ij.dataSource.databaseName=hairynosedwombat
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/store/RecoveryAfterBackup_app.properties b/java/testing/org/apache/derbyTesting/functionTests/tests/store/RecoveryAfterBackup_app.properties
index 6e90dd57b..e352183d5 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/store/RecoveryAfterBackup_app.properties
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/store/RecoveryAfterBackup_app.properties
@@ -6,8 +6,6 @@ ij.showNoCountForSelect=true
 
 ij.defaultResourcePackage=/org/apache/derbyTesting/functionTests/tests/store/
 
-#exclude with SecurityManager
-noSecurityManager=true
 
 # DataSource properties, only used if ij.dataSource is set
 ij.dataSource.databaseName=hairynosedwombat
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/store/backupRestore1_app.properties b/java/testing/org/apache/derbyTesting/functionTests/tests/store/backupRestore1_app.properties
index 8f8ce103d..48424635c 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/store/backupRestore1_app.properties
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/store/backupRestore1_app.properties
@@ -14,5 +14,3 @@
 usedefaults=true
 useextdirs=true
 
-#exclude with SecurityManager DERBY-709
-noSecurityManager=true
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/store/backupRestore_app.properties b/java/testing/org/apache/derbyTesting/functionTests/tests/store/backupRestore_app.properties
index 74d6fa0ed..60bb61bc6 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/store/backupRestore_app.properties
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/store/backupRestore_app.properties
@@ -2,5 +2,6 @@ supportfiles=tests/store/brtestjar.jar
 usedefaults=true
 useextdirs=true
 
-#exclude with SecurityManager DERBY-709
+# Test fails with security manager due to bug DEBRY-537
 noSecurityManager=true
+
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/store/encryptionKey_app.properties b/java/testing/org/apache/derbyTesting/functionTests/tests/store/encryptionKey_app.properties
index 4d11ae9be..05d219a3b 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/store/encryptionKey_app.properties
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/store/encryptionKey_app.properties
@@ -7,6 +7,4 @@ ij.showNoConnectionsAtStart=true
 ij.showNoCountForSelect=true
 runwithjdk13=false
 
-#exclude with SecurityManager DERBY-709
-noSecurityManager=true
 
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/store/logDevice_app.properties b/java/testing/org/apache/derbyTesting/functionTests/tests/store/logDevice_app.properties
index e12f43c5e..1e9a5cb8f 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/store/logDevice_app.properties
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/store/logDevice_app.properties
@@ -20,6 +20,4 @@ ij.dataSource.databaseName=wombat
 ij.dataSource.createDatabase=create
 ij.dataSource.connectionAttributes=logDevice=extinout/wierdlog
 
-#exclude with SecurityManager DERBY-709
-noSecurityManager=true
 
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/store/onlineBackupTest2_app.properties b/java/testing/org/apache/derbyTesting/functionTests/tests/store/onlineBackupTest2_app.properties
index b7f742bae..df49b8c4a 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/store/onlineBackupTest2_app.properties
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/store/onlineBackupTest2_app.properties
@@ -1,5 +1,2 @@
 usedefaults=true
 useextdirs=true
-
-#exclude with SecurityManager DERBY-709
-noSecurityManager=true
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/store/onlineBackupTest4_app.properties b/java/testing/org/apache/derbyTesting/functionTests/tests/store/onlineBackupTest4_app.properties
index b7f742bae..df49b8c4a 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/store/onlineBackupTest4_app.properties
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/store/onlineBackupTest4_app.properties
@@ -1,5 +1,2 @@
 usedefaults=true
 useextdirs=true
-
-#exclude with SecurityManager DERBY-709
-noSecurityManager=true
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/store/rollForwardBackup_app.properties b/java/testing/org/apache/derbyTesting/functionTests/tests/store/rollForwardBackup_app.properties
index 88cc4166b..2e0c3001c 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/store/rollForwardBackup_app.properties
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/store/rollForwardBackup_app.properties
@@ -12,6 +12,3 @@
 
 useextdirs=true
 usedefaults=true
-
-#exclude with SecurityManager DERBY-709
-noSecurityManager=true
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/store/rollForwardRecovery_app.properties b/java/testing/org/apache/derbyTesting/functionTests/tests/store/rollForwardRecovery_app.properties
index 88cc4166b..2e0c3001c 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/store/rollForwardRecovery_app.properties
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/store/rollForwardRecovery_app.properties
@@ -12,6 +12,3 @@
 
 useextdirs=true
 usedefaults=true
-
-#exclude with SecurityManager DERBY-709
-noSecurityManager=true
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/storetests/st_1_app.properties b/java/testing/org/apache/derbyTesting/functionTests/tests/storetests/st_1_app.properties
index 24c34d3ad..876c027e0 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/storetests/st_1_app.properties
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/storetests/st_1_app.properties
@@ -1,5 +1,3 @@
 usedefaults=true
 
-# BUG - fails with security manager due to DERBY-709
-noSecurityManager=true
 
diff --git a/java/testing/org/apache/derbyTesting/functionTests/util/FTFileUtil.java b/java/testing/org/apache/derbyTesting/functionTests/util/FTFileUtil.java
index 78bb74f52..78b9e6838 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/util/FTFileUtil.java
+++ b/java/testing/org/apache/derbyTesting/functionTests/util/FTFileUtil.java
@@ -22,6 +22,11 @@ package org.apache.derbyTesting.functionTests.util;
 
 import java.io.FileWriter;
 import java.io.File;
+import java.security.AccessController;
+import java.security.PrivilegedAction;
+import java.security.PrivilegedActionException;
+import java.security.PrivilegedExceptionAction;
+
 /**
   Convience functions for performing file manipulations
   in ij scripts.
@@ -50,40 +55,71 @@ public class FTFileUtil
 	}
 
 	/**
-	   rename a file
-	   @param location location of the file
-	   @param name the file's name
-	   @param newName the file's new name
+     * rename a file. 
+     * This method is  called by some tests through a SQL procedure:
+     * RENAME_FILE(LOCATION VARCHAR(32000), NAME VARCHAR(32000), 
+     *                                 NEW_NAME  VARCHAR(32000))
+     * @param location location of the file
+     * @param name the file's name
+	 * @param newName the file's new name
 	*/
-	public static void renameFile(String location, String name , String newName) throws Exception
+	public static void renameFile(String location, String name , 
+                                  String newName) throws Exception
 	{
-		File src = new File(location, name);
-		File dst = new File(location, newName);
-		if(!src.renameTo(dst))
-		{
-			throw new Exception("unable to rename File: " +
-								src.getAbsolutePath() +
-							    " To: " + dst.getAbsolutePath());
-		}
-	}
+		final File src = new File(location, name);
+		final File dst = new File(location, newName);
+        
+        // needs to run in a privileged block as it will be
+		// called through a SQL statement and thus a generated
+		// class. The generated class on the stack has no permissions
+		// granted to it.
+        AccessController.doPrivileged(new PrivilegedExceptionAction() {
+                public Object run() throws Exception {
+                    if(!src.renameTo(dst))
+                    {
+                        throw new Exception("unable to rename File: " +
+                                            src.getAbsolutePath() +
+                                            " To: " + dst.getAbsolutePath());
+                    }
+                    
+                    return null; // nothing to return
+                }
+            });
+    }
 
 
     /**
      * Check if a file exists ?
      *
+     * This method is  called by some tests through a SQL function:
+     * fileExists(fileName varchar(128))returns VARCHAR(100)
+     *
      * @param name the file's name.
      * @return     <tt>"true"</tt> if the given file exists 
      *             <tt>"false"</tt> otherwise.
      * @exception Exception if any exception occurs 
      */
-    public static String fileExists(String fileName) throws Exception
+    public static String fileExists(String fileName) 
+        throws PrivilegedActionException
     {
-        File fl = new File(fileName);
-        if(fl.exists()) {
-            return "true";
-        }else {
-            return "false";
-        }
+        final File fl = new File(fileName);
+                
+        // needs to run in a privileged block as it will be
+		// called through a SQL statement and thus a generated
+		// class. The generated class on the stack has no permissions
+		// granted to it.
+
+        return (String) 
+            AccessController.doPrivileged(new PrivilegedExceptionAction() {
+                public Object run()
+                {
+                    if(fl.exists()) {
+                        return "true";
+                    }else {
+                        return "false";
+                    }
+                }
+            });
     }
 
 
@@ -128,17 +164,32 @@ public class FTFileUtil
 	}
 
     /**
-     *	Remove a directory and all of its contents.
+     * Remove a directory and all of its contents.
+     * This method is  called by some tests through a SQL function:
+     * removeDirectory(fileName varchar(128)) returns VARCHAR(100)
      *   
-     *  @param name the file's name.
+     * @param name the file's name.
      * @return     <tt>"true"</tt> if the omplete directory was removed
      *             <tt>"false"</tt> otherwise.f false is returned then some of 
      *              the files in the directory may have been removed.
      */
 
-	public static String removeDirectory(String directory)
+	public static String removeDirectory(final String directory)
+        throws PrivilegedActionException
 	{
-	    return (removeDirectory(new File(directory)) ? "true" : "false");
+        // needs to run in a privileged block as it will be
+		// called through a SQL statement and thus a generated
+		// class. The generated class on the stack has no permissions
+		// granted to it.
+
+        return (String) 
+            AccessController.doPrivileged(new PrivilegedExceptionAction() {
+                    public Object run()
+                    {
+                        return (removeDirectory(
+                               new File(directory)) ? "true" : "false");
+                    }
+                });
 	}
     
 }
