diff --git a/java/engine/org/apache/derby/impl/sql/compile/GenerationClauseNode.java b/java/engine/org/apache/derby/impl/sql/compile/GenerationClauseNode.java
index aa48e5ac3..d924989e7 100644
--- a/java/engine/org/apache/derby/impl/sql/compile/GenerationClauseNode.java
+++ b/java/engine/org/apache/derby/impl/sql/compile/GenerationClauseNode.java
@@ -26,6 +26,7 @@ import org.apache.derby.iapi.error.StandardException;
 import org.apache.derby.iapi.reference.SQLState;
 import org.apache.derby.iapi.services.compiler.MethodBuilder;
 import org.apache.derby.iapi.services.context.ContextManager;
+import org.apache.derby.iapi.sql.compile.Visitor;
 import org.apache.derby.shared.common.sanity.SanityManager;
 import org.apache.derby.iapi.sql.depend.ProviderList;
 
@@ -146,7 +147,28 @@ class GenerationClauseNode extends ValueNode
         return visitor.getList();
     }
 
-	/*
+    /**
+     * Accept the visitor for all visitable children of this node.
+     *
+     * @param v the visitor
+     *
+     * @exception StandardException on error
+     */
+    @Override
+    void acceptChildren(Visitor v) throws StandardException {
+
+        super.acceptChildren(v);
+
+        if (_generationExpression != null) {
+            _generationExpression = (ValueNode)_generationExpression.accept(v);
+        }
+
+        if (_boundExpression != null) {
+            _boundExpression = (ValueNode)_boundExpression.accept(v);
+        }
+    }
+
+    /*
 		Stringify.
 	 */
     @Override
diff --git a/java/engine/org/apache/derby/impl/sql/compile/TableElementList.java b/java/engine/org/apache/derby/impl/sql/compile/TableElementList.java
index 3e2381a94..658d37f02 100644
--- a/java/engine/org/apache/derby/impl/sql/compile/TableElementList.java
+++ b/java/engine/org/apache/derby/impl/sql/compile/TableElementList.java
@@ -731,6 +731,8 @@ class TableElementList extends QueryTreeNodeVector<TableElementNode>
                 generationTree = generationClauseNode.bindExpression(
                         fromList, (SubqueryList) null, aggregates);
 
+                SelectNode.checkNoWindowFunctions(generationClauseNode, "generation clause");
+
                 //
                 // If the user did not declare a type for this column, then the column type defaults
                 // to the type of the generation clause.
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/lang/OLAPTest.java b/java/testing/org/apache/derbyTesting/functionTests/tests/lang/OLAPTest.java
index e16e2bba3..d3f533551 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/lang/OLAPTest.java
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/lang/OLAPTest.java
@@ -633,6 +633,18 @@ public class OLAPTest extends BaseJDBCTestCase {
             s,
             "call syscs_util.syscs_compress_table(" + 
             "    'APP', 'T2', row_number() over ())");
+
+        // DERBY-6690: a window function in generated clause was not detected
+        // before
+        assertStatementError(LANG_WINDOW_FUNCTION_CONTEXT_ERROR,
+            s,
+            "create table t (x int generated always as " +
+            "    (row_number() over ()))");
+
+        assertStatementError(LANG_WINDOW_FUNCTION_CONTEXT_ERROR,
+            s,
+            "alter table t2 add column foo int generated always as " +
+            "    (row_number() over ())");
     }
 
 
