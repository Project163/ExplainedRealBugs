diff --git a/frameworks/NetworkServer/bin/NetworkServerControl.bat b/frameworks/NetworkServer/bin/NetworkServerControl.bat
index 2e6322c9f..bef99632b 100755
--- a/frameworks/NetworkServer/bin/NetworkServerControl.bat
+++ b/frameworks/NetworkServer/bin/NetworkServerControl.bat
@@ -11,19 +11,37 @@
 @REM -- 
 @REM -- This file for use on Windows systems
 @REM ---------------------------------------------------------
-
+@echo off
 rem set DERBY_INSTALL=
- 
-@if !"%CLASSPATH%"==! call "%DERBY_INSTALL%"/frameworks/NetworkServer/bin/setNetworkServerCP.bat
-@if "%CLASSPATH%" == "" call "%DERBY_INSTALL%"/frameworks/NetworkServer/bin/setNetworkServerCP.bat
+
+@if "%DERBY_HOME%"=="" set DERBY_HOME=%DERBY_INSTALL%
+@if "%DERBY_HOME%"=="" goto noderbyhome
+
+@if "%JAVA_HOME%"=="" goto nojavahome
+@if not exist "%JAVA_HOME%\bin\java.exe" goto nojavahome
+
+@if !"%CLASSPATH%"==! call "%DERBY_HOME%"/frameworks/NetworkServer/bin/setNetworkServerCP.bat
+@if "%CLASSPATH%" == "" call "%DERBY_HOME%"/frameworks/NetworkServer/bin/setNetworkServerCP.bat
 
 @REM ---------------------------------------------------------
 @REM -- start Derby as a Network server
 @REM ---------------------------------------------------------
-java org.apache.derby.drda.NetworkServerControl %*
+"%JAVA_HOME%\bin\java" org.apache.derby.drda.NetworkServerControl %*
+@goto end
 
 @REM ---------------------------------------------------------
 @REM -- To use a different JVM with a different syntax, simply edit
 @REM -- this file
 @REM ---------------------------------------------------------
 
+:nojavahome
+echo JAVA_HOME not set or could not find java executable in JAVA_HOME.
+echo Please set JAVA_HOME to the location of a valid Java installation.
+goto end
+
+:noderbyhome
+echo DERBY_HOME or DERBY_INSTALL not set. Set one of these variables
+echo to the location of your Derby installation.
+goto end
+
+:end
\ No newline at end of file
diff --git a/frameworks/NetworkServer/bin/NetworkServerControl.ksh b/frameworks/NetworkServer/bin/NetworkServerControl.ksh
index 403996a98..f20389f0a 100755
--- a/frameworks/NetworkServer/bin/NetworkServerControl.ksh
+++ b/frameworks/NetworkServer/bin/NetworkServerControl.ksh
@@ -13,15 +13,34 @@
 
 # DERBY_INSTALL=
 
+DERBY_HOME=${DERBY_HOME:-$DERBY_INSTALL}
+
+[ -z "$DERBY_HOME" ] && {
+  echo "\$DERBY_HOME or \$DERBY_INSTALL not set. Please set one of these variables"
+  echo "to the location of your Derby installation."
+  exit 1
+}
+
+[ -z "$JAVA_HOME" ] && {
+  [ -x /usr/java/bin/java ] && {
+    JAVA_HOME=/usr/java
+  }
+  [ -z "$JAVA_HOME" ] && {
+    echo "JAVA_HOME not set. Please set JAVA_HOME to the location of your Java"
+    echo "installation."
+    exit 1
+  }
+} 
+
 [ -z "$CLASSPATH" ] && {
-  . "$DERBY_INSTALL"/frameworks/NetworkServer/bin/setNetworkServerCP.ksh
+  . "$DERBY_HOME"/frameworks/NetworkServer/bin/setNetworkServerCP.ksh
 }
 
 # ---------------------------------------------------------
 # -- start Derby Network Server
 # ---------------------------------------------------------
 
-java org.apache.derby.drda.NetworkServerControl $*
+"$JAVA_HOME/bin/java" org.apache.derby.drda.NetworkServerControl $*
 
 
 # ---------------------------------------------------------
diff --git a/frameworks/NetworkServer/bin/dblook.bat b/frameworks/NetworkServer/bin/dblook.bat
index a4bb4a149..1e07bff06 100755
--- a/frameworks/NetworkServer/bin/dblook.bat
+++ b/frameworks/NetworkServer/bin/dblook.bat
@@ -10,19 +10,37 @@
 @REM --
 @REM -- This file for use on Windows systems
 @REM ---------------------------------------------------------
-
+@echo off
 rem set DERBY_INSTALL=
- 
-@if !"%CLASSPATH%"==! call "%DERBY_INSTALL%"/frameworks/NetworkServer/bin/setNetworkClientCP.bat
-@if "%CLASSPATH%" == "" call "%DERBY_INSTALL%"/frameworks/NetworkServer/bin/setNetworkClientCP.bat
+
+@if "%DERBY_HOME%"=="" set DERBY_HOME=%DERBY_INSTALL%
+@if "%DERBY_HOME%"=="" goto noderbyhome
+
+@if "%JAVA_HOME%"=="" goto nojavahome
+@if not exist "%JAVA_HOME%\bin\java.exe" goto nojavahome
+
+if !"%CLASSPATH%"==! call "%DERBY_HOME%"/frameworks/NetworkServer/bin/setNetworkClientCP.bat
+if "%CLASSPATH%" == "" call "%DERBY_HOME%"/frameworks/NetworkServer/bin/setNetworkClientCP.bat
 
 @REM ---------------------------------------------------------
 @REM -- start dblook
 @REM ---------------------------------------------------------
-java org.apache.derby.tools.dblook %*
+"%JAVA_HOME%\bin\java" org.apache.derby.tools.dblook %*
+@GOTO end
 
 @REM ---------------------------------------------------------
 @REM -- To use a different JVM with a different syntax, simply edit
 @REM -- this file
 @REM ---------------------------------------------------------
 
+:nojavahome
+echo JAVA_HOME not set or could not find java executable in JAVA_HOME.
+echo Please set JAVA_HOME to the location of a valid Java installation.
+goto end
+
+:noderbyhome
+echo DERBY_HOME or DERBY_INSTALL not set. Set one of these variables
+echo to the location of your Derby installation.
+goto end
+
+:end
\ No newline at end of file
diff --git a/frameworks/NetworkServer/bin/dblook.ksh b/frameworks/NetworkServer/bin/dblook.ksh
index e0a001b69..9a507469e 100755
--- a/frameworks/NetworkServer/bin/dblook.ksh
+++ b/frameworks/NetworkServer/bin/dblook.ksh
@@ -13,14 +13,33 @@
 
 # DERBY_INSTALL=
 
+DERBY_HOME=${DERBY_HOME:-$DERBY_INSTALL}
+
+[ -z "$DERBY_HOME" ] && {
+  echo "\$DERBY_HOME or \$DERBY_INSTALL not set. Please set one of these variables"
+  echo "to the location of your Derby installation."
+  exit 1
+}
+
+[ -z "$JAVA_HOME" ] && {
+  [ -x /usr/java/bin/java ] && {
+    JAVA_HOME=/usr/java
+  }
+  [ -z "$JAVA_HOME" ] && {
+    echo "JAVA_HOME not set. Please set JAVA_HOME to the location of your Java"
+    echo "installation."
+    exit 1
+  }
+} 
+
 [ -z "$CLASSPATH" ] && {
-  . "$DERBY_INSTALL"/frameworks/NetworkServer/bin/setNetworkClientCP.ksh
+  . "$DERBY_HOME"/frameworks/NetworkServer/bin/setNetworkClientCP.ksh
 }
 
 # ---------------------------------------------------------
 # -- start dblook
 # ---------------------------------------------------------
-java org.apache.derby.tools.dblook $@
+"$JAVA_HOME/bin/java" org.apache.derby.tools.dblook $@
 
 # ---------------------------------------------------------
 # -- To use a different JVM with a different syntax, simply edit
diff --git a/frameworks/NetworkServer/bin/ij.bat b/frameworks/NetworkServer/bin/ij.bat
index 45856feb8..83f6d4e61 100755
--- a/frameworks/NetworkServer/bin/ij.bat
+++ b/frameworks/NetworkServer/bin/ij.bat
@@ -13,11 +13,17 @@
 @REM --
 @REM -- This file for use on Windows systems
 @REM ---------------------------------------------------------
-
+@echo off
 rem set DERBY_INSTALL=
- 
-@if !"%CLASSPATH%"==! call "%DERBY_INSTALL%"/frameworks/NetworkServer/bin/setNetworkClientCP.bat
-@if "%CLASSPATH%" == "" call "%DERBY_INSTALL%"/frameworks/NetworkServer/bin/setNetworkClientCP.bat
+
+@if "%DERBY_HOME%"=="" set DERBY_HOME=%DERBY_INSTALL%
+@if "%DERBY_HOME%"=="" goto noderbyhome
+
+@if "%JAVA_HOME%"=="" goto nojavahome
+@if not exist "%JAVA_HOME%\bin\java.exe" goto nojavahome
+
+@if !"%CLASSPATH%"==! call "%DERBY_HOME%"/frameworks/NetworkServer/bin/setNetworkClientCP.bat
+@if "%CLASSPATH%" == "" call "%DERBY_HOME%"/frameworks/NetworkServer/bin/setNetworkClientCP.bat
 
 set IJ_HOST=localhost
 set IJ_PORT=1527
@@ -28,10 +34,23 @@ set IJ_PASSWORD=APP
 @REM -- start ij
 @REM -- host, port, user and password may need to be changed
 @REM ---------------------------------------------------------
-java -Dij.driver=org.apache.derby.jdbc.ClientDriver -Dij.protocol=jdbc:derby://%IJ_HOST%:%IJ_PORT%/ -Dij.user=%IJ_USER% -Dij.password=%IJ_PASSWORD%  org.apache.derby.tools.ij
+@echo on
+"%JAVA_HOME%\bin\java" -Dij.driver=org.apache.derby.jdbc.ClientDriver -Dij.protocol=jdbc:derby://%IJ_HOST%:%IJ_PORT%/ -Dij.user=%IJ_USER% -Dij.password=%IJ_PASSWORD%  org.apache.derby.tools.ij
+@goto end
 
 @REM ---------------------------------------------------------
 @REM -- To use a different JVM with a different syntax, simply edit
 @REM -- this file
 @REM ---------------------------------------------------------
 
+:nojavahome
+echo JAVA_HOME not set or could not find java executable in JAVA_HOME.
+echo Please set JAVA_HOME to the location of a valid Java installation.
+goto end
+
+:noderbyhome
+echo DERBY_HOME or DERBY_INSTALL not set. Set one of these variables
+echo to the location of your Derby installation.
+goto end
+
+:end
\ No newline at end of file
diff --git a/frameworks/NetworkServer/bin/ij.ksh b/frameworks/NetworkServer/bin/ij.ksh
index b70ce46e0..7faa592a8 100755
--- a/frameworks/NetworkServer/bin/ij.ksh
+++ b/frameworks/NetworkServer/bin/ij.ksh
@@ -13,8 +13,27 @@
 
 # DERBY_INSTALL=
 
+DERBY_HOME=${DERBY_HOME:-$DERBY_INSTALL}
+
+[ -z "$DERBY_HOME" ] && {
+  echo "\$DERBY_HOME or \$DERBY_INSTALL not set. Please set one of these variables"
+  echo "to the location of your Derby installation."
+  exit 1
+}
+
+[ -z "$JAVA_HOME" ] && {
+  [ -x /usr/java/bin/java ] && {
+    JAVA_HOME=/usr/java
+  }
+  [ -z "$JAVA_HOME" ] && {
+    echo "JAVA_HOME not set. Please set JAVA_HOME to the location of your Java"
+    echo "installation."
+    exit 1
+  }
+} 
+
 [ -z "$CLASSPATH" ] && {
-  . "$DERBY_INSTALL"/frameworks/NetworkServer/bin/setNetworkClientCP.ksh
+  . "$DERBY_HOME"/frameworks/NetworkServer/bin/setNetworkClientCP.ksh
 }
  
 export IJ_HOST=localhost
@@ -25,7 +44,7 @@ export IJ_PASSWORD=APP
 # ---------------------------------------------------------
 # -- start ij
 # ---------------------------------------------------------
-java -Dij.driver=org.apache.derby.jdbc.ClientDriver -Dij.protocol=jdbc:derby://$IJ_HOST:$IJ_PORT/ -Dij.user=$IJ_USER -Dij.password=$IJ_PASSWORD  org.apache.derby.tools.ij
+"$JAVA_HOME/bin/java" -Dij.driver=org.apache.derby.jdbc.ClientDriver -Dij.protocol=jdbc:derby://$IJ_HOST:$IJ_PORT/ -Dij.user=$IJ_USER -Dij.password=$IJ_PASSWORD  org.apache.derby.tools.ij
 
 # ---------------------------------------------------------
 # -- To use a different JVM with a different syntax, simply edit
diff --git a/frameworks/NetworkServer/bin/setNetworkClientCP.bat b/frameworks/NetworkServer/bin/setNetworkClientCP.bat
index 56fb622ac..ee7f3294b 100755
--- a/frameworks/NetworkServer/bin/setNetworkClientCP.bat
+++ b/frameworks/NetworkServer/bin/setNetworkClientCP.bat
@@ -3,15 +3,26 @@
 @REM -- for use with Derby products in Network Server mode
 @REM --
 @REM -- To use this script from other locations, change the 
-@REM -- value assigned to DERBY_INSTALL to be an absolute path 
-@REM -- (set DERBY_INSTALL=C:\derby) instead of the current relative path
+@REM -- value assigned to DERBY_HOME to be an absolute path 
+@REM -- (set DERBY_HOME=C:\derby) instead of the current relative path
 @REM --
 @REM -- This file for use on Windows systems
 @REM -- 
 @REM ---------------------------------------------------------
 
-rem set DERBY_INSTALL=
+@rem set DERBY_INSTALL=
 
-FOR %%X in ("%DERBY_INSTALL%") DO SET DERBY_INSTALL=%%~sX
+@if "%DERBY_HOME%"=="" set DERBY_HOME=%DERBY_INSTALL%
+@if "%DERBY_HOME%"=="" goto noderbyhome
 
-set CLASSPATH=%DERBY_INSTALL%\lib\derbyclient.jar;%DERBY_INSTALL%\lib\derbytools.jar;%CLASSPATH%
+@FOR %%X in ("%DERBY_HOME%") DO SET DERBY_HOME=%%~sX
+
+set CLASSPATH=%DERBY_HOME%\lib\derbyclient.jar;%DERBY_HOME%\lib\derbytools.jar;%CLASSPATH%
+@goto end
+
+:noderbyhome
+@echo DERBY_HOME or DERBY_INSTALL not set. Set one of these variables
+@echo to the location of your Derby installation.
+@goto end
+
+:end
\ No newline at end of file
diff --git a/frameworks/NetworkServer/bin/setNetworkClientCP.ksh b/frameworks/NetworkServer/bin/setNetworkClientCP.ksh
index 3cc6f99b7..2fece07a7 100755
--- a/frameworks/NetworkServer/bin/setNetworkClientCP.ksh
+++ b/frameworks/NetworkServer/bin/setNetworkClientCP.ksh
@@ -11,4 +11,12 @@
 # ---------------------------------------------------------
 # DERBY_INSTALL=
 
-export CLASSPATH="${DERBY_INSTALL}/lib/derbyclient.jar:${DERBY_INSTALL}/lib/derbytools.jar:${CLASSPATH}"
+DERBY_HOME=${DERBY_HOME:-$DERBY_INSTALL}
+
+[ -z "$DERBY_HOME" ] && {
+  echo "\$DERBY_HOME or \$DERBY_INSTALL not set. Please set one of these variables"
+  echo "to the location of your Derby installation."
+  exit 1
+}
+
+export CLASSPATH="${DERBY_HOME}/lib/derbyclient.jar:${DERBY_HOME}/lib/derbytools.jar:${CLASSPATH}"
diff --git a/frameworks/NetworkServer/bin/setNetworkServerCP.bat b/frameworks/NetworkServer/bin/setNetworkServerCP.bat
index 63a2fa174..6f0979784 100755
--- a/frameworks/NetworkServer/bin/setNetworkServerCP.bat
+++ b/frameworks/NetworkServer/bin/setNetworkServerCP.bat
@@ -10,8 +10,18 @@
 @REM -- 
 @REM ---------------------------------------------------------
 
-rem set DERBY_INSTALL=
+@rem set DERBY_INSTALL=
 
-FOR %%X in ("%DERBY_INSTALL%") DO SET DERBY_INSTALL=%%~sX
+@if "%DERBY_HOME%"=="" set DERBY_HOME=%DERBY_INSTALL%
+@if "%DERBY_HOME%"=="" goto noderbyhome
 
-set CLASSPATH=%DERBY_INSTALL%\lib\derby.jar;%DERBY_INSTALL%\lib\derbytools.jar;%DERBY_INSTALL%\lib\derbynet.jar;%CLASSPATH%
+@FOR %%X in ("%DERBY_HOME%") DO SET DERBY_INSTALL=%%~sX
+
+set CLASSPATH=%DERBY_HOME%\lib\derby.jar;%DERBY_HOME%\lib\derbytools.jar;%DERBY_HOME%\lib\derbynet.jar;%CLASSPATH%
+@goto end
+
+:noderbyhome
+@echo DERBY_HOME or DERBY_INSTALL not set. Set one of these variables
+@echo to the location of your Derby installation.
+
+:end
\ No newline at end of file
diff --git a/frameworks/NetworkServer/bin/setNetworkServerCP.ksh b/frameworks/NetworkServer/bin/setNetworkServerCP.ksh
index a27dfdfbc..2c277ab3f 100755
--- a/frameworks/NetworkServer/bin/setNetworkServerCP.ksh
+++ b/frameworks/NetworkServer/bin/setNetworkServerCP.ksh
@@ -11,4 +11,12 @@
 # ---------------------------------------------------------
 # DERBY_INSTALL=
 
-export CLASSPATH="${DERBY_INSTALL}/lib/derby.jar:${DERBY_INSTALL}/lib/derbytools.jar:${DERBY_INSTALL}/lib/derbynet.jar:${CLASSPATH}"
+DERBY_HOME=${DERBY_HOME:-$DERBY_INSTALL}
+
+[ -z "$DERBY_HOME" ] && {
+  echo "\$DERBY_HOME or \$DERBY_INSTALL not set. Please set one of these variables"
+  echo "to the location of your Derby installation."
+  exit 1
+}
+
+export CLASSPATH="${DERBY_HOME}/lib/derby.jar:${DERBY_HOME}/lib/derbytools.jar:${DERBY_HOME}/lib/derbynet.jar:${CLASSPATH}"
diff --git a/frameworks/NetworkServer/bin/startNetworkServer.bat b/frameworks/NetworkServer/bin/startNetworkServer.bat
index 16f990ab2..d5fdeef54 100755
--- a/frameworks/NetworkServer/bin/startNetworkServer.bat
+++ b/frameworks/NetworkServer/bin/startNetworkServer.bat
@@ -4,11 +4,14 @@
 @echo off
 @rem set DERBY_INSTALL=
 
+@if "%DERBY_HOME%"=="" set DERBY_HOME=%DERBY_INSTALL%
+@if "%DERBY_HOME%"=="" goto noderbyhome
 
-@if !"%CLASSPATH%"==! call "%DERBY_INSTALL%"/frameworks/NetworkServer/bin/setNetworkServerCP.bat
-@if "%CLASSPATH%" == "" call "%DERBY_INSTALL%"/frameworks/NetworkServer/bin/setNetworkServerCP.bat
+@if "%JAVA_HOME%"=="" goto nojavahome
+@if not exist "%JAVA_HOME%\bin\java.exe" goto nojavahome
 
-if   "%JAVA_HOME%" == "" goto setjavaMsg
+@if !"%CLASSPATH%"==! call "%DERBY_HOME%"/frameworks/NetworkServer/bin/setNetworkServerCP.bat
+@if "%CLASSPATH%" == "" call "%DERBY_HOME%"/frameworks/NetworkServer/bin/setNetworkServerCP.bat
 
 :set_host
 
@@ -45,7 +48,7 @@ set derbyPort=%DERBY_SERVER_PORT%
 @REM ---------------------------------------------------------
 @REM -- start Derby as a Network server
 @REM ---------------------------------------------------------
-%JAVA_HOME%\bin\java org.apache.derby.drda.NetworkServerControl start -h %derbyHost% -p %derbyPort%
+"%JAVA_HOME%\bin\java" org.apache.derby.drda.NetworkServerControl start -h %derbyHost% -p %derbyPort%
 
 goto end
 @REM ---------------------------------------------------------
@@ -53,8 +56,15 @@ goto end
 @REM -- this file
 @REM ---------------------------------------------------------
 
-:setJavaMsg
-echo Please set JAVA_HOME in order to start the Network Server
+:nojavahome
+echo JAVA_HOME not set or could not find java executable in JAVA_HOME.
+echo Please set JAVA_HOME to the location of a valid Java installation.
+goto end
+
+:noderbyhome
+echo DERBY_HOME or DERBY_INSTALL not set. Set one of these variables
+echo to the location of your Derby installation.
+goto end
 
 :end
 set derbyPort=
diff --git a/frameworks/NetworkServer/bin/startNetworkServer.ksh b/frameworks/NetworkServer/bin/startNetworkServer.ksh
index 9b4a8334a..495b85020 100755
--- a/frameworks/NetworkServer/bin/startNetworkServer.ksh
+++ b/frameworks/NetworkServer/bin/startNetworkServer.ksh
@@ -16,14 +16,29 @@
 
 # DERBY_INSTALL=
 
+DERBY_HOME=${DERBY_HOME:-$DERBY_INSTALL}
+
+[ -z "$DERBY_HOME" ] && {
+  echo "\$DERBY_HOME or \$DERBY_INSTALL not set. Please set one of these variables"
+  echo "to the location of your Derby installation."
+  exit 1
+} 
+
+[ -z "$JAVA_HOME" ] && {
+  [ -x /usr/java/bin/java ] && {
+    JAVA_HOME=/usr/java
+  }
+  [ -z "$JAVA_HOME" ] && {
+    echo "JAVA_HOME not set. Please set JAVA_HOME to the location of your Java"
+    echo "installation."
+    exit 1
+  }
+}
+
 [ -z "$CLASSPATH" ] && {
-  . "$DERBY_INSTALL"/frameworks/NetworkServer/bin/setNetworkServerCP.ksh
+  . "$DERBY_HOME"/frameworks/NetworkServer/bin/setNetworkServerCP.ksh
 }
 
-if [ -z "$JAVA_HOME" ]
-then
-   JAVA_HOME=/usr/java
-fi
 
 # ---------------------------------------------------------
 # -- Determine the host and port to use by:
@@ -52,7 +67,7 @@ then
    DERBY_SERVER_PORT=1527
 fi
 
-$JAVA_HOME/bin/java org.apache.derby.drda.NetworkServerControl start -h $DERBY_SERVER_HOST -p $DERBY_SERVER_PORT
+"$JAVA_HOME/bin/java" org.apache.derby.drda.NetworkServerControl start -h $DERBY_SERVER_HOST -p $DERBY_SERVER_PORT
 
 # ---------------------------------------------------------
 # -- To use a different JVM with a different syntax, simply edit
diff --git a/frameworks/NetworkServer/bin/stopNetworkServer.bat b/frameworks/NetworkServer/bin/stopNetworkServer.bat
index ce5fe52be..a9cae9799 100755
--- a/frameworks/NetworkServer/bin/stopNetworkServer.bat
+++ b/frameworks/NetworkServer/bin/stopNetworkServer.bat
@@ -11,11 +11,14 @@
 @echo off
 @rem set DERBY_INSTALL=
 
+@if "%DERBY_HOME%"=="" set DERBY_HOME=%DERBY_INSTALL%
+@if "%DERBY_HOME%"=="" goto noderbyhome
 
-@if !"%CLASSPATH%"==! call "%DERBY_INSTALL%"/frameworks/NetworkServer/bin/setNetworkServerCP.bat
-@if "%CLASSPATH%" == "" call "%DERBY_INSTALL%"/frameworks/NetworkServer/bin/setNetworkServerCP.bat
+@if "%JAVA_HOME%"=="" goto nojavahome
+@if not exist "%JAVA_HOME%\bin\java.exe" goto nojavahome
 
-if   "%JAVA_HOME%" == "" goto setjavaMsg
+@if !"%CLASSPATH%"==! call "%DERBY_HOME%"/frameworks/NetworkServer/bin/setNetworkServerCP.bat
+@if "%CLASSPATH%" == "" call "%DERBY_HOME%"/frameworks/NetworkServer/bin/setNetworkServerCP.bat
 
 :set_host
 
@@ -60,8 +63,15 @@ goto end
 @REM -- this file
 @REM ---------------------------------------------------------
 
-:setJavaMsg
-echo Please set JAVA_HOME in order to start the Network Server
+:nojavahome
+echo JAVA_HOME not set or could not find java executable in JAVA_HOME.
+echo Please set JAVA_HOME to the location of a valid Java installation.
+goto end
+
+:noderbyhome
+echo DERBY_HOME or DERBY_INSTALL not set. Set one of these variables
+echo to the location of your Derby installation.
+goto end
 
 :end
 set derbyPort=
diff --git a/frameworks/NetworkServer/bin/stopNetworkServer.ksh b/frameworks/NetworkServer/bin/stopNetworkServer.ksh
index 6eafc1236..d590868b1 100755
--- a/frameworks/NetworkServer/bin/stopNetworkServer.ksh
+++ b/frameworks/NetworkServer/bin/stopNetworkServer.ksh
@@ -16,14 +16,28 @@
 
 # DERBY_INSTALL=
 
-[ -z "$CLASSPATH" ] && {
-  . "$DERBY_INSTALL"/frameworks/NetworkServer/bin/setNetworkServerCP.ksh
+DERBY_HOME=${DERBY_HOME:-$DERBY_INSTALL}
+
+[ -z "$DERBY_HOME" ] && {
+  echo "\$DERBY_HOME or \$DERBY_INSTALL not set. Please set one of these variables"
+  echo "to the location of your Derby installation."
+  exit 1
 }
 
-if [ -z "$JAVA_HOME" ]
-then
-   JAVA_HOME=/usr/java
-fi
+[ -z "$JAVA_HOME" ] && {
+  [ -x /usr/java/bin/java ] && {
+    JAVA_HOME=/usr/java
+  }
+  [ -z "$JAVA_HOME" ] && {
+    echo "JAVA_HOME not set. Please set JAVA_HOME to the location of your Java"
+    echo "installation."
+    exit 1
+  }
+}
+ 
+[ -z "$CLASSPATH" ] && {
+  . "$DERBY_HOME"/frameworks/NetworkServer/bin/setNetworkServerCP.ksh
+}
 
 # ---------------------------------------------------------
 # -- Determine the host and port to use by:
@@ -52,7 +66,7 @@ then
    DERBY_SERVER_PORT=1527
 fi
 
-$JAVA_HOME/bin/java org.apache.derby.drda.NetworkServerControl shutdown -h $DERBY_SERVER_HOST -p $DERBY_SERVER_PORT
+"$JAVA_HOME/bin/java" org.apache.derby.drda.NetworkServerControl shutdown -h $DERBY_SERVER_HOST -p $DERBY_SERVER_PORT
 
 # ---------------------------------------------------------
 # -- To use a different JVM with a different syntax, simply edit
diff --git a/frameworks/NetworkServer/bin/sysinfo.bat b/frameworks/NetworkServer/bin/sysinfo.bat
index 6e504c723..db465d9bb 100755
--- a/frameworks/NetworkServer/bin/sysinfo.bat
+++ b/frameworks/NetworkServer/bin/sysinfo.bat
@@ -13,20 +13,38 @@
 @REM -- 
 @REM -- This file for use on Windows systems
 @REM ---------------------------------------------------------
-
+@echo off
 rem set DERBY_INSTALL=
- 
-@if !"%CLASSPATH%"==! call "%DERBY_INSTALL%"/frameworks/NetworkServer/bin/setNetworkServerCP.bat
-@if "%CLASSPATH%" == "" call "%DERBY_INSTALL%"/frameworks/NetworkServer/bin/setNetworkServerCP.bat
+
+@if "%DERBY_HOME%"=="" set DERBY_HOME=%DERBY_INSTALL%
+@if "%DERBY_HOME%"=="" goto noderbyhome
+
+@if "%JAVA_HOME%"=="" goto nojavahome
+@if not exist "%JAVA_HOME%\bin\java.exe" goto nojavahome
+
+@if !"%CLASSPATH%"==! call "%DERBY_HOME%"/frameworks/NetworkServer/bin/setNetworkServerCP.bat
+@if "%CLASSPATH%" == "" call "%DERBY_HOME%"/frameworks/NetworkServer/bin/setNetworkServerCP.bat
 
 @REM ---------------------------------------------------------
 @REM -- start sysinfo
 @REM ---------------------------------------------------------
-java org.apache.derby.drda.NetworkServerControl sysinfo %*
+"%JAVA_HOME%\bin\java" org.apache.derby.drda.NetworkServerControl sysinfo %*
+@GOTO end
 
 @REM ---------------------------------------------------------
 @REM -- To use a different JVM with a different syntax, simply edit
 @REM -- this file
 @REM ---------------------------------------------------------
 
+:nojavahome
+echo JAVA_HOME not set or could not find java executable in JAVA_HOME.
+echo Please set JAVA_HOME to the location of a valid Java installation.
+goto end
+
+:noderbyhome
+echo DERBY_HOME or DERBY_INSTALL not set. Set one of these variables
+echo to the location of your Derby installation.
+goto end
+
+:end
 
diff --git a/frameworks/NetworkServer/bin/sysinfo.ksh b/frameworks/NetworkServer/bin/sysinfo.ksh
index 5bb13ec28..ac97e216b 100755
--- a/frameworks/NetworkServer/bin/sysinfo.ksh
+++ b/frameworks/NetworkServer/bin/sysinfo.ksh
@@ -19,14 +19,33 @@
 
 # DERBY_INSTALL=
 
+DERBY_HOME=${DERBY_HOME:-$DERBY_INSTALL}
+
+[ -z "$DERBY_HOME" ] && {
+  echo "\$DERBY_HOME or \$DERBY_INSTALL not set. Please set one of these variables"
+  echo "to the location of your Derby installation."
+  exit 1
+}
+
+[ -z "$JAVA_HOME" ] && {
+  [ -x /usr/java/bin/java ] && {
+    JAVA_HOME=/usr/java
+  }
+  [ -z "$JAVA_HOME" ] && {
+    echo "JAVA_HOME not set. Please set JAVA_HOME to the location of your Java"
+    echo "installation."
+    exit 1
+  }
+}
+ 
 [ -z "$CLASSPATH" ] && {
-  . "$DERBY_INSTALL"/frameworks/NetworkServer/bin/setNetworkServerCP.ksh
+  . "$DERBY_HOME"/frameworks/NetworkServer/bin/setNetworkServerCP.ksh
 }
 
 # ---------------------------------------------------------
 # -- start sysinfo
 # ---------------------------------------------------------
-java org.apache.derby.drda.NetworkServerControl sysinfo $*
+"$JAVA_HOME/bin/java" org.apache.derby.drda.NetworkServerControl sysinfo $*
 # ---------------------------------------------------------
 # -- To use a different JVM with a different syntax, simply edit
 # -- this file
diff --git a/frameworks/embedded/bin/dblook.bat b/frameworks/embedded/bin/dblook.bat
index a96784b6b..44bb9ba62 100755
--- a/frameworks/embedded/bin/dblook.bat
+++ b/frameworks/embedded/bin/dblook.bat
@@ -10,19 +10,37 @@
 @REM --
 @REM -- This file for use on Windows systems
 @REM ---------------------------------------------------------
-
+@echo off
 rem set DERBY_INSTALL=
- 
-@if !"%CLASSPATH%"==! call "%DERBY_INSTALL%"/frameworks/embedded/bin/setEmbeddedCP.bat
-@if "%CLASSPATH%" == "" call "%DERBY_INSTALL%"/frameworks/embedded/bin/setEmbeddedCP.bat
+
+@if "%DERBY_HOME%"=="" set DERBY_HOME=%DERBY_INSTALL%
+@if "%DERBY_HOME%"=="" goto noderbyhome
+
+@if "%JAVA_HOME%"=="" goto nojavahome
+@if not exist "%JAVA_HOME%\bin\java.exe" goto nojavahome
+
+@if !"%CLASSPATH%"==! call "%DERBY_HOME%"/frameworks/embedded/bin/setEmbeddedCP.bat
+@if "%CLASSPATH%" == "" call "%DERBY_HOME%"/frameworks/embedded/bin/setEmbeddedCP.bat
 
 @REM ---------------------------------------------------------
 @REM -- start dblook
 @REM ---------------------------------------------------------
-java org.apache.derby.tools.dblook %*
+"%JAVA_HOME%\bin\java" org.apache.derby.tools.dblook %*
+@GOTO end
 
 @REM ---------------------------------------------------------
 @REM -- To use a different JVM with a different syntax, simply edit
 @REM -- this file
 @REM ---------------------------------------------------------
 
+:nojavahome
+echo JAVA_HOME not set or could not find java executable in JAVA_HOME.
+echo Please set JAVA_HOME to the location of a valid Java installation.
+goto end
+
+:noderbyhome
+echo DERBY_HOME or DERBY_INSTALL not set. Set one of these variables
+echo to the location of your Derby installation.
+goto end
+
+:end
\ No newline at end of file
diff --git a/frameworks/embedded/bin/dblook.ksh b/frameworks/embedded/bin/dblook.ksh
index a5e505636..eb997445d 100755
--- a/frameworks/embedded/bin/dblook.ksh
+++ b/frameworks/embedded/bin/dblook.ksh
@@ -13,14 +13,33 @@
 
 # DERBY_INSTALL=
 
+DERBY_HOME=${DERBY_HOME:-$DERBY_INSTALL}
+
+[ -z "$DERBY_HOME" ] && {
+  echo "\$DERBY_HOME or \$DERBY_INSTALL not set. Please set one of these variables"
+  echo "to the location of your Derby installation."
+  exit 1
+}
+
+[ -z "$JAVA_HOME" ] && {
+  [ -x /usr/java/bin/java ] && {
+    JAVA_HOME=/usr/java
+  }
+  [ -z "$JAVA_HOME" ] && {
+    echo "JAVA_HOME not set. Please set JAVA_HOME to the location of your Java"
+    echo "installation."
+    exit 1
+  }
+}
+ 
 [ -z "$CLASSPATH" ] && {
-  . "$DERBY_INSTALL"/frameworks/embedded/bin/setEmbeddedCP.ksh
+  . "$DERBY_HOME"/frameworks/embedded/bin/setEmbeddedCP.ksh
 }
  
 # ---------------------------------------------------------
 # -- start dblook
 # ---------------------------------------------------------
-java org.apache.derby.tools.dblook $@
+"$JAVA_HOME/bin/java" org.apache.derby.tools.dblook $@
 
 # ---------------------------------------------------------
 # -- To use a different JVM with a different syntax, simply edit
diff --git a/frameworks/embedded/bin/ij.bat b/frameworks/embedded/bin/ij.bat
index 10c3bf894..6884889de 100755
--- a/frameworks/embedded/bin/ij.bat
+++ b/frameworks/embedded/bin/ij.bat
@@ -10,20 +10,37 @@
 @REM --
 @REM -- This file for use on Windows systems
 @REM ---------------------------------------------------------
-
+@echo off
 rem set DERBY_INSTALL=
- 
+
+@if "%DERBY_HOME%"=="" set DERBY_HOME=%DERBY_INSTALL%
+@if "%DERBY_HOME%"=="" goto noderbyhome
+
+@if "%JAVA_HOME%"=="" goto nojavahome
+@if not exist "%JAVA_HOME%\bin\java.exe" goto nojavahome
+
 @if !"%CLASSPATH%"==! call "%DERBY_INSTALL%"/frameworks/embedded/bin/setEmbeddedCP.bat
 @if "%CLASSPATH%" == "" call "%DERBY_INSTALL%"/frameworks/embedded/bin/setEmbeddedCP.bat
 
 @REM ---------------------------------------------------------
 @REM -- start ij
 @REM ---------------------------------------------------------
-java -Dij.protocol=jdbc:derby: org.apache.derby.tools.ij
-
+"%JAVA_HOME%\bin\java" -Dij.protocol=jdbc:derby: org.apache.derby.tools.ij
+@goto end
 
 @REM ---------------------------------------------------------
 @REM -- To use a different JVM with a different syntax, simply edit
 @REM -- this file
 @REM ---------------------------------------------------------
 
+:nojavahome
+echo JAVA_HOME not set or could not find java executable in JAVA_HOME.
+echo Please set JAVA_HOME to the location of a valid Java installation.
+goto end
+
+:noderbyhome
+echo DERBY_HOME or DERBY_INSTALL not set. Set one of these variables
+echo to the location of your Derby installation.
+goto end
+
+:end
\ No newline at end of file
diff --git a/frameworks/embedded/bin/ij.ksh b/frameworks/embedded/bin/ij.ksh
index 8c8a88f30..b1f20e38a 100755
--- a/frameworks/embedded/bin/ij.ksh
+++ b/frameworks/embedded/bin/ij.ksh
@@ -13,14 +13,33 @@
 
 # DERBY_INSTALL=
 
+DERBY_HOME=${DERBY_HOME:-$DERBY_INSTALL}
+
+[ -z "$DERBY_HOME" ] && {
+  echo "\$DERBY_HOME or \$DERBY_INSTALL not set. Please set one of these variables"
+  echo "to the location of your Derby installation."
+  exit 1
+}
+
+[ -z "$JAVA_HOME" ] && {
+  [ -x /usr/java/bin/java ] && {
+    JAVA_HOME=/usr/java
+  }
+  [ -z "$JAVA_HOME" ] && {
+    echo "JAVA_HOME not set. Please set JAVA_HOME to the location of your Java"
+    echo "installation."
+    exit 1
+  }
+}
+ 
 [ -z "$CLASSPATH" ] && {
-  . "$DERBY_INSTALL"/frameworks/embedded/bin/setEmbeddedCP.ksh
+  . "$DERBY_HOME"/frameworks/embedded/bin/setEmbeddedCP.ksh
 }
  
 # ---------------------------------------------------------
 # -- start ij
 # ---------------------------------------------------------
-java -Dij.protocol=jdbc:derby: org.apache.derby.tools.ij
+"$JAVA_HOME/bin/java" -Dij.protocol=jdbc:derby: org.apache.derby.tools.ij
 
 # ---------------------------------------------------------
 # -- To use a different JVM with a different syntax, simply edit
diff --git a/frameworks/embedded/bin/setEmbeddedCP.bat b/frameworks/embedded/bin/setEmbeddedCP.bat
index 7ed6f4d65..62d254701 100755
--- a/frameworks/embedded/bin/setEmbeddedCP.bat
+++ b/frameworks/embedded/bin/setEmbeddedCP.bat
@@ -10,8 +10,19 @@
 @REM -- 
 @REM ---------------------------------------------------------
 
-rem set DERBY_INSTALL=
+@rem set DERBY_INSTALL=
 
-FOR %%X in ("%DERBY_INSTALL%") DO SET DERBY_INSTALL=%%~sX
+@if "%DERBY_HOME%"=="" set DERBY_HOME=%DERBY_INSTALL%
+@if "%DERBY_HOME%"=="" goto noderbyhome
 
-set CLASSPATH=%DERBY_INSTALL%\lib\derby.jar;%DERBY_INSTALL%\lib\derbytools.jar;%CLASSPATH%
+@FOR %%X in ("%DERBY_HOME%") DO SET DERBY_HOME=%%~sX
+
+set CLASSPATH=%DERBY_HOME%\lib\derby.jar;%DERBY_HOME%\lib\derbytools.jar;%CLASSPATH%
+@goto end
+
+:noderbyhome
+@echo DERBY_HOME or DERBY_INSTALL not set. Set one of these variables
+@echo to the location of your Derby installation.
+@goto end
+
+:end
\ No newline at end of file
diff --git a/frameworks/embedded/bin/setEmbeddedCP.ksh b/frameworks/embedded/bin/setEmbeddedCP.ksh
index d23a965be..49286f2b3 100755
--- a/frameworks/embedded/bin/setEmbeddedCP.ksh
+++ b/frameworks/embedded/bin/setEmbeddedCP.ksh
@@ -12,4 +12,12 @@
 
 # DERBY_INSTALL=
 
+DERBY_HOME=${DERBY_HOME:-$DERBY_INSTALL}
+
+[ -z "$DERBY_HOME" ] && {
+  echo "\$DERBY_HOME or \$DERBY_INSTALL not set. Please set one of these variables"
+  echo "to the location of your Derby installation."
+  exit 1
+}
+
 export CLASSPATH="${DERBY_INSTALL}/lib/derby.jar:${DERBY_INSTALL}/lib/derbytools.jar:${CLASSPATH}"
diff --git a/frameworks/embedded/bin/sysinfo.bat b/frameworks/embedded/bin/sysinfo.bat
index 827f5c922..c28886710 100755
--- a/frameworks/embedded/bin/sysinfo.bat
+++ b/frameworks/embedded/bin/sysinfo.bat
@@ -13,16 +13,23 @@
 @REM -- 
 @REM -- This file for use on Windows systems
 @REM ---------------------------------------------------------
+@echo off
+@rem set DERBY_INSTALL=
+
+@if "%DERBY_HOME%"=="" set DERBY_HOME=%DERBY_INSTALL%
+@if "%DERBY_HOME%"=="" goto noderbyhome
+
+@if "%JAVA_HOME%"=="" goto nojavahome
+@if not exist "%JAVA_HOME%\bin\java.exe" goto nojavahome
 
-rem set DERBY_INSTALL=
- 
 @if !"%CLASSPATH%"==! call "%DERBY_INSTALL%"/frameworks/embedded/bin/setEmbeddedCP.bat
 @if "%CLASSPATH%" == "" call "%DERBY_INSTALL%"/frameworks/embedded/bin/setEmbeddedCP.bat
 
 @REM ---------------------------------------------------------
 @REM -- start sysinfo
 @REM ---------------------------------------------------------
-java org.apache.derby.tools.sysinfo
+"%JAVA_HOME%\bin\java" org.apache.derby.tools.sysinfo
+@GOTO end
 
 @REM ---------------------------------------------------------
 @REM -- To use Microsoft's JView JVM, use the following command
@@ -34,4 +41,14 @@ java org.apache.derby.tools.sysinfo
 @REM -- this file
 @REM ---------------------------------------------------------
 
+:nojavahome
+echo JAVA_HOME not set or could not find java executable in JAVA_HOME.
+echo Please set JAVA_HOME to the location of a valid Java installation.
+goto end
+
+:noderbyhome
+echo DERBY_HOME or DERBY_INSTALL not set. Set one of these variables
+echo to the location of your Derby installation.
+goto end
 
+:end
\ No newline at end of file
diff --git a/frameworks/embedded/bin/sysinfo.ksh b/frameworks/embedded/bin/sysinfo.ksh
index 0e89d2792..fa966a97c 100755
--- a/frameworks/embedded/bin/sysinfo.ksh
+++ b/frameworks/embedded/bin/sysinfo.ksh
@@ -17,14 +17,33 @@
 
 # DERBY_INSTALL=
 
+DERBY_HOME=${DERBY_HOME:-$DERBY_INSTALL}
+
+[ -z "$DERBY_HOME" ] && {
+  echo "\$DERBY_HOME or \$DERBY_INSTALL not set. Please set one of these variables"
+  echo "to the location of your Derby installation."
+  exit 1
+}
+
+[ -z "$JAVA_HOME" ] && {
+  [ -x /usr/java/bin/java ] && {
+    JAVA_HOME=/usr/java
+  }
+  [ -z "$JAVA_HOME" ] && {
+    echo "JAVA_HOME not set. Please set JAVA_HOME to the location of your Java"
+    echo "installation."
+    exit 1
+  }
+}
+ 
 [ -z "$CLASSPATH" ] && {
-  . "$DERBY_INSTALL"/frameworks/embedded/bin/setEmbeddedCP.ksh
+  . "$DERBY_HOME"/frameworks/embedded/bin/setEmbeddedCP.ksh
 }
  
 # ---------------------------------------------------------
 # -- start sysinfo
 # ---------------------------------------------------------
-java org.apache.derby.tools.sysinfo
+"$JAVA_HOME/bin/java" org.apache.derby.tools.sysinfo
 
 # ---------------------------------------------------------
 # -- To use a different JVM with a different syntax, simply edit
