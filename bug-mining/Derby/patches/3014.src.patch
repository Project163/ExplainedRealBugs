diff --git a/java/engine/org/apache/derby/impl/sql/execute/FKInfo.java b/java/engine/org/apache/derby/impl/sql/execute/FKInfo.java
index 76e9da5c1..12fa3c59c 100644
--- a/java/engine/org/apache/derby/impl/sql/execute/FKInfo.java
+++ b/java/engine/org/apache/derby/impl/sql/execute/FKInfo.java
@@ -291,6 +291,7 @@ public class FKInfo implements Formatable
 		ArrayUtil.writeIntArray(out, colArray);
 		ArrayUtil.writeIntArray(out, raRules);
         ArrayUtil.writeBooleanArray(out, deferrable);
+        ArrayUtil.writeArray(out, fkIds);
 	}
 
 	/**
@@ -334,6 +335,8 @@ public class FKInfo implements Formatable
 			colArray = ArrayUtil.readIntArray(in);
 			raRules = ArrayUtil.readIntArray(in);
             deferrable = ArrayUtil.readBooleanArray(in);
+            fkIds = new UUID[ArrayUtil.readArrayLength(in)];
+            ArrayUtil.readArrayItems(in, fkIds);
 		}
 		catch (StandardException exception)
 		{
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/lang/TriggerTest.java b/java/testing/org/apache/derbyTesting/functionTests/tests/lang/TriggerTest.java
index 9122dc2f0..22ff332cd 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/lang/TriggerTest.java
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/lang/TriggerTest.java
@@ -65,6 +65,7 @@ public class TriggerTest extends BaseJDBCTestCase {
     private static final String HAS_DEPENDENT_SPS = "X0Y24";
     private static final String HAS_DEPENDENT_TRIGGER = "X0Y25";
     private static final String TRIGGER_DROPPED = "01502";
+    private static final String FOREIGN_KEY_VIOLATION = "23503";
    
     /**
      * Thread local that a trigger can access to
@@ -2545,4 +2546,31 @@ public class TriggerTest extends BaseJDBCTestCase {
         //s.execute("insert into t1 values (1,2,3)");
         s.execute("insert into tp_t1 values cast(null as tp)");
     }
+
+    /**
+     * Regression test case for DERBY-6663 (NPE when a trigger tries to
+     * insert into a table with a foreign key).
+     */
+    public void testDerby6663() throws SQLException {
+        setAutoCommit(false);
+        Statement s = createStatement();
+        s.execute("create table d6663_t1(pk int primary key)");
+        s.execute("create table d6663_t2(x int references d6663_t1)");
+        s.execute("create table d6663_t3(y int)");
+        s.execute("create trigger d6663_tr after insert on d6663_t3 "
+                + "referencing new as new for each row "
+                + "insert into d6663_t2 values new.y");
+
+        // Used to fail with NPE instead of foreign key violation.
+        assertStatementError(
+                FOREIGN_KEY_VIOLATION, s, "insert into d6663_t3 values 1");
+
+        // Verify that trigger executes successfully if there is no
+        // foreign key violation.
+        s.execute("insert into d6663_t1 values 1");
+        s.execute("insert into d6663_t3 values 1");
+        JDBC.assertSingleValueResultSet(
+                s.executeQuery("select * from d6663_t2"),
+                "1");
+    }
 }
