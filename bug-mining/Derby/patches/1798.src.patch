diff --git a/java/engine/org/apache/derby/impl/sql/compile/JavaToSQLValueNode.java b/java/engine/org/apache/derby/impl/sql/compile/JavaToSQLValueNode.java
index 42fe7b98a..0ea41b3ea 100644
--- a/java/engine/org/apache/derby/impl/sql/compile/JavaToSQLValueNode.java
+++ b/java/engine/org/apache/derby/impl/sql/compile/JavaToSQLValueNode.java
@@ -21,6 +21,7 @@
 
 package	org.apache.derby.impl.sql.compile;
 
+import org.apache.derby.catalog.TypeDescriptor;
 import org.apache.derby.iapi.sql.dictionary.DataDictionary;
 import org.apache.derby.iapi.types.DataTypeDescriptor;
 import org.apache.derby.iapi.types.StringDataValue;
@@ -251,6 +252,13 @@ public class JavaToSQLValueNode extends ValueNode
 			throw StandardException.newException(SQLState.LANG_NO_CORRESPONDING_S_Q_L_TYPE, 
 				javaNode.getJavaTypeName());
 		}
+
+        TypeDescriptor catalogType = dts.getCatalogType();
+
+        if ( catalogType.getTypeName().equals( "java.sql.ResultSet" ) )
+        {
+			throw StandardException.newException(SQLState.LANG_TABLE_FUNCTION_NOT_ALLOWED);
+        }
         
         setType(dts);
 		
diff --git a/java/engine/org/apache/derby/loc/messages.xml b/java/engine/org/apache/derby/loc/messages.xml
index 3502cae31..4c567cdff 100644
--- a/java/engine/org/apache/derby/loc/messages.xml
+++ b/java/engine/org/apache/derby/loc/messages.xml
@@ -2768,6 +2768,11 @@ Guide.
                 <arg>className</arg>
             </msg>
 
+            <msg>
+                <name>42ZB6</name>
+                <text>A scalar value is expected, not a row set returned by a table function.</text>
+            </msg>
+
         </family>
 
 
diff --git a/java/shared/org/apache/derby/shared/common/reference/SQLState.java b/java/shared/org/apache/derby/shared/common/reference/SQLState.java
index 5d45e7225..cf8eb6995 100644
--- a/java/shared/org/apache/derby/shared/common/reference/SQLState.java
+++ b/java/shared/org/apache/derby/shared/common/reference/SQLState.java
@@ -1092,6 +1092,7 @@ public interface SQLState {
     String LANG_XML_NOT_ALLOWED_DJRS                                = "42ZB3";
     String LANG_NOT_TABLE_FUNCTION                                  = "42ZB4";
     String LANG_NO_COSTING_CONSTRUCTOR                              = "42ZB5";
+    String LANG_TABLE_FUNCTION_NOT_ALLOWED                   = "42ZB6";
 
 	//following 3 matches the DB2 sql states
 	String LANG_DECLARED_GLOBAL_TEMP_TABLE_ONLY_IN_SESSION_SCHEMA = "428EK";
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/lang/TableFunctionTest.java b/java/testing/org/apache/derbyTesting/functionTests/tests/lang/TableFunctionTest.java
index 77bcc2f7b..659c71438 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/lang/TableFunctionTest.java
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/lang/TableFunctionTest.java
@@ -925,6 +925,8 @@ public class TableFunctionTest extends BaseJDBCTestCase
         subqueryTest();
 
         coercionTest();
+
+        miscBugs();
     }
     
     /**
@@ -1619,6 +1621,51 @@ public class TableFunctionTest extends BaseJDBCTestCase
              );
     }
     
+    /**
+     * <p>
+     * Miscellaneous bugs.
+     * </p>
+     */
+    private void  miscBugs()
+        throws Exception
+    {
+        derby_4092();
+    }
+    
+    /**
+     * <p>
+     * Don't allow table functions to appear where scalar functions are expected.
+     * </p>
+     */
+    private void  derby_4092()
+        throws Exception
+    {
+        goodStatement
+            (
+             "create function derby_4092()\n" +
+             "returns TABLE\n" +
+             "  (\n" +
+             "     column0 varchar( 10 ),\n" +
+             "     column1 varchar( 10 )\n" +
+             "  )\n" +
+             "language java\n" +
+             "parameter style DERBY_JDBC_RESULT_SET\n" +
+             "no sql\n" +
+             "external name '" + getClass().getName() + ".returnsACoupleRows'\n"
+             );
+
+        expectError
+            (
+             "42ZB6",
+             "values( derby_4092() )"
+             );
+        expectError
+            (
+             "42ZB6",
+             "select derby_4092(), tablename from sys.systables"
+             );
+    }
+    
     /**
      * <p>
      * Make the input rows for the coercion function.
