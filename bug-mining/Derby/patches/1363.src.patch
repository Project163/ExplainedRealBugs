diff --git a/java/engine/org/apache/derby/impl/jdbc/EmbedConnection.java b/java/engine/org/apache/derby/impl/jdbc/EmbedConnection.java
index e2b3b8345..7a396e377 100644
--- a/java/engine/org/apache/derby/impl/jdbc/EmbedConnection.java
+++ b/java/engine/org/apache/derby/impl/jdbc/EmbedConnection.java
@@ -1213,7 +1213,7 @@ public abstract class EmbedConnection implements EngineConnection
 			JDBC20Translation.TYPE_FORWARD_ONLY,
 			JDBC20Translation.CONCUR_READ_ONLY,
 			connectionHoldAbility,
-			columnIndexes == null
+			(columnIndexes == null || columnIndexes.length == 0)
 				? JDBC30Translation.NO_GENERATED_KEYS
 				: JDBC30Translation.RETURN_GENERATED_KEYS,
 			columnIndexes,
@@ -1248,7 +1248,7 @@ public abstract class EmbedConnection implements EngineConnection
 			JDBC20Translation.TYPE_FORWARD_ONLY,
 			JDBC20Translation.CONCUR_READ_ONLY,
 			connectionHoldAbility,
-			columnNames == null
+			(columnNames == null || columnNames.length == 0)
 				? JDBC30Translation.NO_GENERATED_KEYS
 				: JDBC30Translation.RETURN_GENERATED_KEYS,
 			null,
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/AutoGenJDBC30Test.java b/java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/AutoGenJDBC30Test.java
index a9168b3f8..7b8ee0eb3 100755
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/AutoGenJDBC30Test.java
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/AutoGenJDBC30Test.java
@@ -1116,19 +1116,16 @@ public class AutoGenJDBC30Test extends BaseJDBCTestCase {
             s.getGeneratedKeys());
 
         PreparedStatement ps = null;
-        if (!usingEmbedded())
-        {
-            // Can't run these with embedded now because of DERBY-3430
-            ps = prepareStatement(sql, new String[] {});
-            ps.execute();
-            assertNull("Expected NULL ResultSet after ps.execute()", 
-            ps.getGeneratedKeys());
+        
+        ps = prepareStatement(sql, new String[] {});
+        ps.execute();
+        assertNull("Expected NULL ResultSet after ps.execute()", 
+        ps.getGeneratedKeys());
 
-            ps = prepareStatement(sql, new String[] {});
-            ps.executeUpdate();
-            assertNull("Expected NULL ResultSet after ps.executeUpdate()", 
-                    ps.getGeneratedKeys());
-        }
+        ps = prepareStatement(sql, new String[] {});
+        ps.executeUpdate();
+        assertNull("Expected NULL ResultSet after ps.executeUpdate()", 
+                ps.getGeneratedKeys());       
        // No columnIndexes yet for derby client. 
        if (usingDerbyNetClient())
             return;
