diff --git a/java/engine/org/apache/derby/impl/sql/compile/sqlgrammar.jj b/java/engine/org/apache/derby/impl/sql/compile/sqlgrammar.jj
index 26e121614..d3588e1b3 100644
--- a/java/engine/org/apache/derby/impl/sql/compile/sqlgrammar.jj
+++ b/java/engine/org/apache/derby/impl/sql/compile/sqlgrammar.jj
@@ -9743,17 +9743,19 @@ groupingColumnReference(GroupByList groupingCols) throws StandardException :
 {
 	columnExpression = additiveExpression(null, 0, false)
 	{
+		/* Aggregates not allowed in group by */
+		HasNodeVisitor visitor =
+			new HasNodeVisitor(AggregateNode.class);
+		columnExpression.accept(visitor);
+		if (visitor.hasNode())
+		{
+			{if (true) throw StandardException.newException(
+				SQLState.LANG_AGGREGATE_IN_GROUPBY_LIST);}
+		}
 		if (columnExpression.isParameterNode()) 
 	    	{
 			throw StandardException.newException(SQLState.LANG_SYNTAX_ERROR, "?");
 	    	}
-		if (columnExpression instanceof AggregateNode)
-		{
-			AggregateNode agNode = (AggregateNode)columnExpression;
-			throw StandardException.newException(
-				SQLState.LANG_AGGREGATE_IN_GROUPBY_LIST, 
-				agNode.getAggregateName());
-		}        
 		groupingCols.addGroupByColumn(
 			(GroupByColumn) nodeFactory.getNode(
 							C_NodeTypes.GROUP_BY_COLUMN,
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/lang/GroupByExpressionTest.java b/java/testing/org/apache/derbyTesting/functionTests/tests/lang/GroupByExpressionTest.java
index 32f7f8719..10c8acb8c 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/lang/GroupByExpressionTest.java
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/lang/GroupByExpressionTest.java
@@ -122,6 +122,18 @@ public class GroupByExpressionTest extends BaseJDBCTestCase
                         {9,13,2}});
     }
     
+    /**
+     * DERBY-4202 Aggregates not allowed in group by
+     * @throws Exception
+     */
+    public void testDerby4402AggregateInGroupBy() throws Exception
+    {
+    	assertCompileError(
+                "42Y26", "select c1 from test group by sum(c3)");
+    	assertCompileError(
+                "42Y26", "select c1 from test group by (c1+sum(c3))");
+    }
+    
     /**
      * queries which combine compound expressions and simple column refs.
      */
