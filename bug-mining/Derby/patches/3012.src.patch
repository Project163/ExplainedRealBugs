diff --git a/java/testing/org/apache/derbyTesting/junit/BaseTestCase.java b/java/testing/org/apache/derbyTesting/junit/BaseTestCase.java
index a5d8143d9..f23c7fcc7 100644
--- a/java/testing/org/apache/derbyTesting/junit/BaseTestCase.java
+++ b/java/testing/org/apache/derbyTesting/junit/BaseTestCase.java
@@ -1153,12 +1153,23 @@ public abstract class BaseTestCase
      */
     public static void fail(String msg, Throwable t)
             throws AssertionFailedError {
+        throw newAssertionFailedError(msg, t);
+    }
 
-        AssertionFailedError ae = new AssertionFailedError(msg);
-        ae.initCause(t);
-        throw ae;
+    /**
+     * Create a new AssertionFailedError linked to another Throwable.
+     *
+     * @param message message explaining the failure
+     * @param cause the cause of the failure
+     * @return an AssertionFailedError
+     */
+    public static AssertionFailedError newAssertionFailedError(
+            String message, Throwable cause) {
+        AssertionFailedError e = new AssertionFailedError(message);
+        e.initCause(cause);
+        return e;
     }
-    
+
     /**
      * assert a method from an executing test
      * 
diff --git a/java/testing/org/apache/derbyTesting/junit/JDBC.java b/java/testing/org/apache/derbyTesting/junit/JDBC.java
index 2aaf20d96..8328e2a00 100644
--- a/java/testing/org/apache/derbyTesting/junit/JDBC.java
+++ b/java/testing/org/apache/derbyTesting/junit/JDBC.java
@@ -1796,84 +1796,95 @@ public class JDBC {
             List<String> seenRow,
             ResultSet rs) throws SQLException {
 
-        if (rs == null) {
-            return new AssertionFailedError(afe.getMessage() + "\n<NULL>");
-        }
-
-        final int c = rsmd.getColumnCount();
-        StringBuilder heading = new StringBuilder("    ");
-        StringBuilder underline = new StringBuilder("    ");
-
-        // Display column headings
-        for (int i=1; i<= c; i++) {
-            if (i > 1) {
-                heading.append(",");
-                underline.append(" ");
+        try {
+            if (rs == null) {
+                return BaseTestCase.newAssertionFailedError(
+                        afe.getMessage() + "\n<NULL>", afe);
             }
 
-            int len = heading.length();
-            heading.append(rsmd.getColumnLabel(i));
-            len = heading.length() - len;
+            final int c = rsmd.getColumnCount();
+            StringBuilder heading = new StringBuilder("    ");
+            StringBuilder underline = new StringBuilder("    ");
 
-            for (int j = len; j > 0; j--) {
-                underline.append("-");
-            }
-        }
+            // Display column headings
+            for (int i=1; i<= c; i++) {
+                if (i > 1) {
+                    heading.append(",");
+                    underline.append(" ");
+                }
 
-        heading.append("\n");
-        underline.append("\n");
+                int len = heading.length();
+                heading.append(rsmd.getColumnLabel(i));
+                len = heading.length() - len;
 
-        StringBuilder rowImg = new StringBuilder();
-        rowImg.append(afe.getMessage()).
-               append("\n\n").
-               append(heading.toString()).
-               append(underline.toString());
+                for (int j = len; j > 0; j--) {
+                    underline.append("-");
+                }
+            }
 
-        if (!rs.isClosed()) {
-            final int s = seenRow.size();
+            heading.append("\n");
+            underline.append("\n");
+
+            StringBuilder rowImg = new StringBuilder();
+            rowImg.append(afe.getMessage()).
+                   append("\n\n").
+                   append(heading.toString()).
+                   append(underline.toString());
+
+            if (!rs.isClosed()) {
+                final int s = seenRow.size();
+
+                // Get any rest of columns of current row
+                for (int i=0; i < c - s; i++) {
+                    String column = null;
+
+                    try {
+                        column = rs.getString(s + i + 1);
+                    } catch (SQLException e) {
+                        // We may not yet have called next?
+                        if (e.getSQLState().equals("24000")) {
+                            if (rs.next()) {
+                                column = rs.getString(s + i + 1);
+                            } else {
+                                break;
+                            }
+                        }
+                    }
+                    seenRow.add(column);
+                }
 
-            // Get any rest of columns of current row
-            for (int i=0; i < c - s; i++) {
-                String column = null;
+                if (seenRow.size() > 0) {
+                    seen.add(new ArrayList<String>(seenRow));
+                    seenRow.clear();
+                }
 
-                try {
-                    column = rs.getString(s + i + 1);
-                } catch (SQLException e) {
-                    // We may not yet have called next?
-                    if (e.getSQLState().equals("24000")) {
-                        if (rs.next()) {
-                            column = rs.getString(s + i + 1);
-                        } else {
-                            break;
-                        }
+                // Get any remaining rows
+                while (rs.next()) {
+                    for (int i = 0; i < c; i++) {
+                        seenRow.add(rs.getString(i + 1));
                     }
+                    seen.add(new ArrayList<String>(seenRow));
+                    seenRow.clear();
                 }
-                seenRow.add(column);
             }
 
-            if (seenRow.size() > 0) {
-                seen.add(new ArrayList<String>(seenRow));
-                seenRow.clear();
+            // Display data
+            for (List<String> row : seen) {
+                rowImg.append("   ").
+                       append(row.toString()).
+                       append("\n");
             }
 
-            // Get any remaining rows
-            while (rs.next()) {
-                for (int i = 0; i < c; i++) {
-                    seenRow.add(rs.getString(i + 1));
-                }
-                seen.add(new ArrayList<String>(seenRow));
-                seenRow.clear();
-            }
-        }
+            return BaseTestCase.newAssertionFailedError(rowImg.toString(), afe);
 
-        // Display data
-        for (List<String> row : seen) {
-            rowImg.append("   ").
-                   append(row.toString()).
-                   append("\n");
-        }
+        } catch (Throwable t) {
+            // Something went wrong when adding the ResultSet to the error
+            // message. Don't return this error, as it would shadow the
+            // original error. Print it to help debugging.
+            BaseTestCase.printStackTrace(t);
 
-        return new AssertionFailedError(rowImg.toString());
+            // Return the original error.
+            return afe;
+        }
     }
-
 }
