diff --git a/java/engine/org/apache/derby/impl/sql/catalog/SYSCONSTRAINTSRowFactory.java b/java/engine/org/apache/derby/impl/sql/catalog/SYSCONSTRAINTSRowFactory.java
index 9f616e23a..eef47bcc8 100644
--- a/java/engine/org/apache/derby/impl/sql/catalog/SYSCONSTRAINTSRowFactory.java
+++ b/java/engine/org/apache/derby/impl/sql/catalog/SYSCONSTRAINTSRowFactory.java
@@ -491,6 +491,9 @@ public class SYSCONSTRAINTSRowFactory extends CatalogRowFactory
 
         // Cf. the encoding description in javadoc for
         // #encodeCharacteristics.
+        //
+        // This code is cloned by DB_Key.makeDeferredClauses().
+        //
 		switch (constraintStateStr.charAt(0))
 		{
 			case 'E': 
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/tools/Test_6661.java b/java/testing/org/apache/derbyTesting/functionTests/tests/tools/Test_6661.java
new file mode 100644
index 000000000..d5176433c
--- /dev/null
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/tools/Test_6661.java
@@ -0,0 +1,233 @@
+/*
+
+   Derby - Class org.apache.derbyTesting.functionTests.tests.tools.Test_6661
+
+   Licensed to the Apache Software Foundation (ASF) under one or more
+   contributor license agreements.  See the NOTICE file distributed with
+   this work for additional information regarding copyright ownership.
+   The ASF licenses this file to You under the Apache License, Version 2.0
+   (the "License"); you may not use this file except in compliance with
+   the License.  You may obtain a copy of the License at
+
+      http://www.apache.org/licenses/LICENSE-2.0
+
+   Unless required by applicable law or agreed to in writing, software
+   distributed under the License is distributed on an "AS IS" BASIS,
+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+   See the License for the specific language governing permissions and
+   limitations under the License.
+
+ */
+
+package org.apache.derbyTesting.functionTests.tests.tools;
+
+import java.sql.Connection;
+import java.sql.SQLException;
+import junit.framework.Test;
+
+import org.apache.derby.tools.dblook;
+
+import org.apache.derbyTesting.junit.BaseJDBCTestCase;
+import org.apache.derbyTesting.junit.BaseTestSuite;
+import org.apache.derbyTesting.junit.CleanDatabaseTestSetup;
+import org.apache.derbyTesting.junit.SecurityManagerSetup;
+import org.apache.derbyTesting.junit.SupportFilesSetup;
+import org.apache.derbyTesting.junit.TestConfiguration;
+
+/**
+ * Test that deferrable constraints are recreated correctly by dblook.
+ */
+public class Test_6661 extends BaseJDBCTestCase
+{
+    ///////////////////////////////////////////////////////////////////////////////////
+    //
+    // CONSTANTS
+    //
+    ///////////////////////////////////////////////////////////////////////////////////
+
+    private static  final   String[][]  EXPECTED_CONSTRAINT_STATE = new String[][]
+    {
+        { "CHECK6661_INIT_DEFERRED", "e" },
+        { "CHECK6661_INIT_IMMEDIATE", "i" },
+        { "CHECK6661_VANILLA", "E" },
+        { "TPRIM6661_INIT_DEFERRED", "e" },
+        { "TPRIM6661_INIT_IMMEDIATE", "i" },
+        { "TPRIM6661_VANILLA", "E" },
+        { "TREF6661_INIT_DEFERRED", "e" },
+        { "TREF6661_INIT_IMMEDIATE","i" },
+        { "TREF6661_VANILLA", "E" },
+        { "TUNIQUE6661_INIT_DEFERRED", "e" },
+        { "TUNIQUE6661_INIT_IMMEDIATE", "i" },
+        { "TUNIQUE6661_VANILLA", "E" },
+    };
+
+    private static  final   String  DBLOOK_OUTPUT = SupportFilesSetup.getReadWrite( "dblookOutput.sql" ).getPath();
+
+    ///////////////////////////////////////////////////////////////////////////////////
+    //
+    // STATE
+    //
+    ///////////////////////////////////////////////////////////////////////////////////
+
+    ///////////////////////////////////////////////////////////////////////////////////
+    //
+    // CONSTRUCTOR
+    //
+    ///////////////////////////////////////////////////////////////////////////////////
+
+	public Test_6661(String name)
+    {
+		super( name );
+	}
+	
+    ///////////////////////////////////////////////////////////////////////////////////
+    //
+    // JUnit BEHAVIOR
+    //
+    ///////////////////////////////////////////////////////////////////////////////////
+
+	public static Test suite()
+    {
+        BaseTestSuite baseTest = new BaseTestSuite( Test_6661.class, "Test_6661" );
+        Test        supportFileWrapper = new SupportFilesSetup( baseTest );
+        Test        cleanDatabaseWrapper = new CleanDatabaseTestSetup( supportFileWrapper );
+        Test        noSecurityWrapper = SecurityManagerSetup.noSecurityManager( cleanDatabaseWrapper );
+
+        return noSecurityWrapper;
+	}
+	
+    ///////////////////////////////////////////////////////////////////////////////////
+    //
+    // TESTS
+    //
+    ///////////////////////////////////////////////////////////////////////////////////
+
+	public void test_01() throws Exception
+    {
+        Connection  conn = getConnection();
+
+        //
+        // Create and verify a number of constraints.
+        //
+        goodStatement
+            (
+             conn,
+             "create table tprim6661_vanilla\n" +
+             "(\n" +
+             "    keyCol  int not null,\n" +
+             "    constraint tprim6661_vanilla primary key( keyCol )\n" +
+             ")\n"
+             );
+        goodStatement
+            (
+             conn,
+             "create table tprim6661_init_deferred\n" +
+             "(\n" +
+             "    keyCol  int not null,\n" +
+             "    constraint tprim6661_init_deferred primary key( keyCol ) deferrable initially deferred\n" +
+             ")\n"
+             );
+        goodStatement
+            (
+             conn,
+             "create table tprim6661_init_immediate\n" +
+             "(\n" +
+             "    keyCol  int not null,\n" +
+             "    constraint tprim6661_init_immediate primary key( keyCol ) deferrable\n" +
+             ")\n"
+             );
+        goodStatement
+            (
+             conn,
+             "create table tunique6661_vanilla\n" +
+             "(\n" +
+             "    keyCol  int not null,\n" +
+             "    constraint tunique6661_vanilla primary key( keyCol )\n" +
+             ")\n"
+             );
+        goodStatement
+            (
+             conn,
+             "create table tunique6661_init_deferred\n" +
+             "(\n" +
+             "    keyCol  int not null,\n" +
+             "    constraint tunique6661_init_deferred primary key( keyCol ) deferrable initially deferred\n" +
+             ")\n"
+             );
+        goodStatement
+            (
+             conn,
+             "create table tunique6661_init_immediate\n" +
+             "(\n" +
+             "    keyCol  int not null,\n" +
+             "    constraint tunique6661_init_immediate primary key( keyCol ) deferrable\n" +
+             ")\n"
+             );
+        goodStatement
+            (
+             conn,
+             "create table tref6661\n" +
+             "(\n" +
+             "    tref6661_vanilla int,\n" +
+             "    tref6661_init_deferred int,\n" +
+             "    tref6661_init_immediate int,\n" +
+             "\n" +
+             "    constraint tref6661_vanilla foreign key( tref6661_vanilla ) references tprim6661_vanilla( keyCol ),\n" +
+"    constraint tref6661_init_deferred foreign key( tref6661_init_deferred ) references tprim6661_vanilla( keyCol ) deferrable initially deferred,\n" +
+             "    constraint tref6661_init_immediate foreign key( tref6661_init_immediate ) references tprim6661_vanilla( keyCol ) deferrable\n" +
+             ")\n"
+             );
+        goodStatement
+            (
+             conn,
+             "create table tcheck6661\n" +
+             "(\n" +
+             "    a int,\n" +
+             "\n" +
+             "    constraint check6661_vanilla check( a > 0 ),\n" +
+             "    constraint check6661_init_deferred check( a > 10 ) deferrable initially deferred,\n" +
+             "    constraint check6661_init_immediate check( a > 100 ) deferrable\n" +
+             ")\n" 
+             );
+
+        String  query = "select constraintname, state from sys.sysconstraints order by constraintname";
+        assertResults( conn, query, EXPECTED_CONSTRAINT_STATE, true );
+
+        //
+        // Create a dblook script.
+        //
+        TestConfiguration   config = getTestConfiguration();
+        String      dbName = config.getPhysicalDatabaseName( config.getDefaultDatabaseName() );
+        new dblook
+            (
+             new String[]
+             {
+                 "-d",
+                 "jdbc:derby:" + dbName,
+                 "-o",
+                 DBLOOK_OUTPUT
+             }
+             );
+
+        //
+        // Drop the schema objects.
+        //
+        goodStatement( conn, "drop table tcheck6661" );
+        goodStatement( conn, "drop table tref6661" );
+        goodStatement( conn, "drop table tunique6661_init_immediate" );
+        goodStatement( conn, "drop table tunique6661_init_deferred" );
+        goodStatement( conn, "drop table tunique6661_vanilla" );
+        goodStatement( conn, "drop table tprim6661_init_immediate" );
+        goodStatement( conn, "drop table tprim6661_init_deferred" );
+        goodStatement( conn, "drop table tprim6661_vanilla" );
+        assertResults( conn, query, new String[][] {}, true );
+
+        //
+        // Now run the script created by dblook and verify that the
+        // deferred constraints were re-created correctly.
+        //
+        dblook_test.runDDL( conn, DBLOOK_OUTPUT );
+        assertResults( conn, query, EXPECTED_CONSTRAINT_STATE, true );
+	}
+    
+}
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/tools/_Suite.java b/java/testing/org/apache/derbyTesting/functionTests/tests/tools/_Suite.java
index d04dd1d4b..2ceef5efc 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/tools/_Suite.java
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/tools/_Suite.java
@@ -60,6 +60,7 @@ public class _Suite extends BaseTestCase {
         suite.addTest(ConnectWrongSubprotocolTest.suite());
         suite.addTest(derbyrunjartest.suite());
         suite.addTest(ij3Test.suite());
+        suite.addTest(Test_6661.suite());
         
         // SysinfoAPITest currently fails when run against jars, so is
         // disabled. Only the first jar file on the classpath properly
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/tools/dblook_test.java b/java/testing/org/apache/derbyTesting/functionTests/tests/tools/dblook_test.java
index be61d7e82..48018ab23 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/tools/dblook_test.java
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/tools/dblook_test.java
@@ -1222,9 +1222,26 @@ public class dblook_test {
 				"jdbc:derby:" + newDBName +
 				";create=true;user=app;password=apppw" + territoryBased);
 
+        runDDL( conn, scriptName );
+
+		conn.close();
+
+		return;
+	}
+
+	/* **********************************************
+	 * runDDL:
+	 * Run an sql script.
+	 * @param conn database connection
+	 * @param scriptName Name of the script
+	 ****/
+
+	static  void runDDL( Connection conn, String scriptName)
+        throws Exception
+	{
 		Statement stmt = conn.createStatement();
 		BufferedReader ddlScript =
-			new BufferedReader(new FileReader(scriptName));
+			new BufferedReader( new FileReader( scriptName ) );
 
 		for (String sqlCmd = ddlScript.readLine(); sqlCmd != null;
 			sqlCmd = ddlScript.readLine()) {
@@ -1249,16 +1266,11 @@ public class dblook_test {
 					"from DDL script:\n" + sqlCmd + "\n");
 				System.out.println(e.getMessage());
 			}
-
 		}
 
 		// Cleanup.
 		ddlScript.close();
 		stmt.close();
-		conn.close();
-
-		return;
-
 	}
 
 	/* **********************************************
diff --git a/java/tools/org/apache/derby/impl/tools/dblook/DB_Check.java b/java/tools/org/apache/derby/impl/tools/dblook/DB_Check.java
index 877b8642f..05e91ea5c 100644
--- a/java/tools/org/apache/derby/impl/tools/dblook/DB_Check.java
+++ b/java/tools/org/apache/derby/impl/tools/dblook/DB_Check.java
@@ -49,7 +49,7 @@ public class DB_Check {
 
 		Statement stmt = conn.createStatement();
 		ResultSet rs = stmt.executeQuery("SELECT CS.CONSTRAINTNAME, " +
-			"CS.TABLEID, CS.SCHEMAID, CK.CHECKDEFINITION FROM SYS.SYSCONSTRAINTS CS, " +
+			"CS.TABLEID, CS.SCHEMAID, CS.STATE, CK.CHECKDEFINITION FROM SYS.SYSCONSTRAINTS CS, " +
 			"SYS.SYSCHECKS CK WHERE CS.CONSTRAINTID = " +
 			"CK.CONSTRAINTID AND CS.STATE != 'D' ORDER BY CS.TABLEID");
 
@@ -69,6 +69,9 @@ public class DB_Check {
 			}
 
 			StringBuffer chkString = createCheckString(tableName, rs);
+
+            DB_Key.makeDeferredClauses( chkString, rs, 4 );
+            
 			Logs.writeToNewDDL(chkString.toString());
 			Logs.writeStmtEndToNewDDL();
 			Logs.writeNewlineToNewDDL();
@@ -104,7 +107,7 @@ public class DB_Check {
 		sb.append(" CONSTRAINT ");
 		sb.append(constraintName);
 		sb.append(" CHECK ");
-		sb.append(dblook.removeNewlines(aCheck.getString(4)));
+		sb.append(dblook.removeNewlines(aCheck.getString(5)));
 
 		return sb;
 
diff --git a/java/tools/org/apache/derby/impl/tools/dblook/DB_Key.java b/java/tools/org/apache/derby/impl/tools/dblook/DB_Key.java
index c33c1a280..75783e4c2 100644
--- a/java/tools/org/apache/derby/impl/tools/dblook/DB_Key.java
+++ b/java/tools/org/apache/derby/impl/tools/dblook/DB_Key.java
@@ -60,7 +60,7 @@ public class DB_Key {
 		// Non-foreign keys, first.
 		Statement stmt = conn.createStatement();
 		ResultSet rs = stmt.executeQuery("SELECT CS.CONSTRAINTNAME, CS.TYPE, " +
-			"CS.TABLEID, CS.CONSTRAINTID, CS.SCHEMAID, CG.DESCRIPTOR, CG.ISCONSTRAINT " +
+			"CS.TABLEID, CS.CONSTRAINTID, CS.SCHEMAID, CS.STATE, CG.DESCRIPTOR, CG.ISCONSTRAINT " +
 			"FROM SYS.SYSCONSTRAINTS CS, SYS.SYSCONGLOMERATES CG, SYS.SYSKEYS K " +
 			"WHERE CS.STATE != 'D' AND CS.CONSTRAINTID = K.CONSTRAINTID AND " +
 			"CG.CONGLOMERATEID = K.CONGLOMERATEID ORDER BY CS.TABLEID");
@@ -68,7 +68,7 @@ public class DB_Key {
 
 		// Now, foreign keys.
 		rs = stmt.executeQuery("SELECT CS.CONSTRAINTNAME, CS.TYPE, CS.TABLEID, " +
-			"CS.CONSTRAINTID, CS.SCHEMAID, CG.DESCRIPTOR, CG.ISCONSTRAINT, " +
+			"CS.CONSTRAINTID, CS.SCHEMAID, CS.STATE, CG.DESCRIPTOR, CG.ISCONSTRAINT, " +
 			"K.DELETERULE, K.UPDATERULE, K.KEYCONSTRAINTID FROM SYS.SYSCONSTRAINTS CS, " +
 			"SYS.SYSCONGLOMERATES CG, SYS.SYSFOREIGNKEYS K WHERE CS.STATE != 'D' " +
 			"AND CS.CONSTRAINTID = K.CONSTRAINTID AND CG.CONGLOMERATEID = " +
@@ -99,7 +99,7 @@ public class DB_Key {
 		boolean firstTime = true;
 		while (rs.next()) {
 
-			if (!rs.getBoolean(7))
+			if (!rs.getBoolean(8))
 			// this row is NOT for a constraint, so skip it.
 				continue;
 
@@ -121,10 +121,12 @@ public class DB_Key {
 
 			if (rs.getString(2).equals("F")) {
 			// foreign key; we have to figure out the references info.
-				kString.append(makeFKReferenceClause(rs.getString(10),
-					rs.getString(8).charAt(0), rs.getString(9).charAt(0)));
+				kString.append(makeFKReferenceClause(rs.getString(11),
+					rs.getString(9).charAt(0), rs.getString(10).charAt(0)));
 			}
 
+            makeDeferredClauses( kString, rs, 6 );
+
 			Logs.writeToNewDDL(kString.toString());
 			Logs.writeStmtEndToNewDDL();
 			Logs.writeNewlineToNewDDL();
@@ -163,7 +165,7 @@ public class DB_Key {
 		// For keys, we need to get the column list.
 		sb.append("(");
 		sb.append(dblook.getColumnListFromDescription(
-			tableId, aKey.getString(6)));
+			tableId, aKey.getString(7)));
 		sb.append(")");
 
 		return sb;
@@ -252,6 +254,78 @@ public class DB_Key {
 
 	}
 
+	/* ************************************************
+	 * Generate the clauses for deferred constraints.
+	 * @param buffer    Evolving buffer where we write additional clauses.
+	 * @param aKey Info on the key to generate.
+	 * @param stateColumn 1-based position of the STATE column in the result set
+	 * @return DDL for the specified key is returned as
+	 *  a string.
+	 ****/
+
+	static void makeDeferredClauses
+        ( StringBuffer buffer, ResultSet constraint, int stateColumn )
+		throws SQLException
+	{
+        String              state = constraint.getString( stateColumn );
+		String              constraintName =
+            dblook.addQuotes( dblook.expandDoubleQuotes( constraint.getString( 1 ) ) );
+        boolean             deferrable = false;
+        boolean             initiallyDeferred = false;
+        boolean             enforced = true;
+
+        // cloned from SYSCONSTRAINTSRowFactory.buildDescriptor()
+		switch ( state.charAt( 0 ) )
+		{
+        case 'E': 
+            deferrable = false;
+            initiallyDeferred = false;
+            enforced = true;
+            break;
+        case 'D':
+            deferrable = false;
+            initiallyDeferred = false;
+            enforced = false;
+            break;
+        case 'e':
+            deferrable = true;
+            initiallyDeferred = true;
+            enforced = true;
+            break;
+        case 'd':
+            deferrable = true;
+            initiallyDeferred = true;
+            enforced = false;
+            break;
+        case 'i':
+            deferrable = true;
+            initiallyDeferred = false;
+            enforced = true;
+            break;
+        case 'j':
+            deferrable = true;
+            initiallyDeferred = false;
+            enforced = false;
+            break;
+        default: 
+            Logs.debug
+                (
+                 "INTERNAL ERROR: Invalid state value '" + state + "' for constraint " + constraintName,
+                 (String) null
+                 );
+        }
+
+        if ( deferrable )
+        {
+            buffer.append( " DEFERRABLE " );
+            if ( initiallyDeferred )
+            {
+                buffer.append( " INITIALLY DEFERRED " );
+            }
+        }
+    }
+
+
 	/* ************************************************
 	 * Print a simple header to output.
 	 ****/
