diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/derbynet/SecureServerTest.java b/java/testing/org/apache/derbyTesting/functionTests/tests/derbynet/SecureServerTest.java
index 755e5ec7b..1d5d20efa 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/derbynet/SecureServerTest.java
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/derbynet/SecureServerTest.java
@@ -214,7 +214,8 @@ public class SecureServerTest extends BaseTestCase
         String[]        startupProperties = getStartupProperties( authenticationRequired, useCustomDerbyProperties );
         String[]        startupArgs = getStartupArgs( unsecureSet );
 
-        TestSetup   testSetup = new NetworkServerTestSetup
+        Test  testSetup = SecurityManagerSetup.noSecurityManager(
+                new NetworkServerTestSetup
             (
              secureServerTest,
              startupProperties,
@@ -222,7 +223,7 @@ public class SecureServerTest extends BaseTestCase
              true,
              secureServerTest._outcome.serverShouldComeUp(),
              secureServerTest._inputStreamHolder
-             );
+             ));
 
         // if using the custom derby.properties, copy the custom properties to a visible place
         if ( useCustomDerbyProperties )
@@ -239,8 +240,6 @@ public class SecureServerTest extends BaseTestCase
 
         Test        test = TestConfiguration.defaultServerDecorator( testSetup );
 
-        test = SecurityManagerSetup.noSecurityManager( test );
-
         return test;
     }
 
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/upgradeTests/PhaseChanger.java b/java/testing/org/apache/derbyTesting/functionTests/tests/upgradeTests/PhaseChanger.java
index ef06994de..de7954699 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/upgradeTests/PhaseChanger.java
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/upgradeTests/PhaseChanger.java
@@ -28,6 +28,7 @@ import javax.sql.DataSource;
 import junit.extensions.TestSetup;
 import junit.framework.Test;
 
+import org.apache.derbyTesting.junit.BaseTestSetup;
 import org.apache.derbyTesting.junit.JDBCDataSource;
 import org.apache.derbyTesting.junit.TestConfiguration;
 
@@ -35,7 +36,7 @@ import org.apache.derbyTesting.junit.TestConfiguration;
  * Decorator that sets the phase of the upgrade process
  * for a suite of upgrade tests.
  */
-final class PhaseChanger extends TestSetup {
+final class PhaseChanger extends BaseTestSetup {
 
     private final int phase;
     private final int[] version;
diff --git a/java/testing/org/apache/derbyTesting/junit/BaseJDBCTestSetup.java b/java/testing/org/apache/derbyTesting/junit/BaseJDBCTestSetup.java
index de6c07fcb..02947c2e8 100644
--- a/java/testing/org/apache/derbyTesting/junit/BaseJDBCTestSetup.java
+++ b/java/testing/org/apache/derbyTesting/junit/BaseJDBCTestSetup.java
@@ -29,7 +29,7 @@ import junit.framework.Test;
  * Base class for JDBC JUnit test decorators.
  */
 public abstract class BaseJDBCTestSetup
-    extends TestSetup {
+    extends BaseTestSetup {
 	
 	public BaseJDBCTestSetup(Test test) {
 		super(test);
diff --git a/java/testing/org/apache/derbyTesting/junit/BaseTestSetup.java b/java/testing/org/apache/derbyTesting/junit/BaseTestSetup.java
new file mode 100644
index 000000000..f98df94bd
--- /dev/null
+++ b/java/testing/org/apache/derbyTesting/junit/BaseTestSetup.java
@@ -0,0 +1,61 @@
+/*
+ *
+ * Derby - Class BaseTestSetup
+ *
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *    http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, 
+ * software distributed under the License is distributed on an 
+ * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, 
+ * either express or implied. See the License for the specific 
+ * language governing permissions and limitations under the License.
+ */
+package org.apache.derbyTesting.junit;
+
+import junit.extensions.TestSetup;
+import junit.framework.Test;
+import junit.framework.TestResult;
+
+/**
+ * TestSetup/Decorator base class for Derby's JUnit
+ * tests. Installs the security manager according
+ * to the configuration before executing any setup
+ * or tests. Matches the security manager setup
+ * provided by BaseTestCase.
+ *
+ */
+public abstract class BaseTestSetup extends TestSetup {
+    
+    protected BaseTestSetup(Test test) {
+        super(test);
+    }
+
+    /**
+     * Setup the security manager for this Derby decorator/TestSetup
+     * and then call the part's run method to run the decorator and
+     * the test it wraps.
+     */
+    public final void run(TestResult result)
+    {
+        // install a default security manager if one has not already been
+        // installed
+        if ( System.getSecurityManager() == null )
+        {
+            if (TestConfiguration.getCurrent().defaultSecurityManagerSetup())
+            {
+                BaseTestCase.assertSecurityManager();
+            }
+        }
+        
+        super.run(result);
+    }
+
+
+}
diff --git a/java/testing/org/apache/derbyTesting/junit/Decorator.java b/java/testing/org/apache/derbyTesting/junit/Decorator.java
index 8aba8f8a0..f12f16972 100644
--- a/java/testing/org/apache/derbyTesting/junit/Decorator.java
+++ b/java/testing/org/apache/derbyTesting/junit/Decorator.java
@@ -61,7 +61,7 @@ public class Decorator {
      */
     public static Test encryptedDatabase(Test test)
     {
-        test = new TestSetup(test) {
+        test = new BaseTestSetup(test) {
             
             /**
              * Create an encrypted database using a
@@ -69,8 +69,6 @@ public class Decorator {
              */
             protected void setUp() throws SQLException
             {
-                String bootPhrase = getBootPhrase(16);
-
                 DataSource ds = JDBCDataSource.getDataSource();
                                
                 JDBCDataSource.setBeanProperty(ds,
@@ -108,7 +106,7 @@ public class Decorator {
      */
     public static Test encryptedDatabase(Test test, final String algorithm)
     {
-        test = new TestSetup(test) {
+        test = new BaseTestSetup(test) {
             
             /**
              * Create an encrypted database using a
diff --git a/java/testing/org/apache/derbyTesting/junit/DropDatabaseSetup.java b/java/testing/org/apache/derbyTesting/junit/DropDatabaseSetup.java
index 905b0e266..905a42f27 100644
--- a/java/testing/org/apache/derbyTesting/junit/DropDatabaseSetup.java
+++ b/java/testing/org/apache/derbyTesting/junit/DropDatabaseSetup.java
@@ -35,7 +35,7 @@ import junit.framework.Test;
  * name passed in when creating this decorator.
  *
  */
-class DropDatabaseSetup extends TestSetup {
+class DropDatabaseSetup extends BaseTestSetup {
 
     final String logicalDBName;
     DropDatabaseSetup(Test test, String logicalDBName) {
diff --git a/java/testing/org/apache/derbyTesting/junit/NetworkServerTestSetup.java b/java/testing/org/apache/derbyTesting/junit/NetworkServerTestSetup.java
index c00763e48..8e0d6732c 100644
--- a/java/testing/org/apache/derbyTesting/junit/NetworkServerTestSetup.java
+++ b/java/testing/org/apache/derbyTesting/junit/NetworkServerTestSetup.java
@@ -41,7 +41,7 @@ import org.apache.derby.drda.NetworkServerControl;
  * and it does not support starting it from a remote 
  * machine.
  */
-final public class NetworkServerTestSetup extends TestSetup {
+final public class NetworkServerTestSetup extends BaseTestSetup {
 
     /** Setting maximum wait time to 300 seconds.   For some systems it looks
      *  like restarting a server to listen on the same port is blocked waiting
diff --git a/java/testing/org/apache/derbyTesting/junit/SecurityManagerSetup.java b/java/testing/org/apache/derbyTesting/junit/SecurityManagerSetup.java
index 28a69ab63..6a77aa1b0 100644
--- a/java/testing/org/apache/derbyTesting/junit/SecurityManagerSetup.java
+++ b/java/testing/org/apache/derbyTesting/junit/SecurityManagerSetup.java
@@ -22,6 +22,7 @@ package org.apache.derbyTesting.junit;
 import java.io.File;
 import java.net.URL;
 import java.security.AccessController;
+import java.security.Policy;
 import java.security.PrivilegedActionException;
 import java.util.Enumeration;
 import java.util.Properties;
@@ -75,6 +76,10 @@ public final class SecurityManagerSetup extends TestSetup {
 	 * mode of no security manager as it may not have enough information
 	 * to re-install the security manager. So the passed in test
 	 * will be skipped.
+     * 
+     * @param test Test to run without a security manager. Note that
+     * this must be an instance of BaseTestCase as this call depends
+     * on setup code in that class. Arbitrary Test instances cannot be passed in.
 	 */
 	public static Test noSecurityManager(Test test)
 	{
@@ -83,18 +88,6 @@ public final class SecurityManagerSetup extends TestSetup {
                     + test.toString());
 		return new SecurityManagerSetup(test, "<NONE>");
 	}
-	
-    /**
-     * Same as noSecurityManager() above but takes a TestSetup
-     * instead of a BaseTestCase.
-     */
-    public static Test noSecurityManager(TestSetup tSetup)
-    {
-		if (externalSecurityManagerInstalled)
-			return new TestSuite("skipped due to external security manager "
-                    + tSetup.toString());
-		return new SecurityManagerSetup(tSetup, "<NONE>");
-    }
 
 	/**
 	 * "Install" no security manager.
@@ -183,8 +176,9 @@ public final class SecurityManagerSetup extends TestSetup {
 
 
                 public Object run() {
-				System.setSecurityManager(new SecurityManager());
-				return null;
+                    SecurityManager sm = new SecurityManager();
+				System.setSecurityManager(sm);
+ 				return null;
 			}
 		});
 
@@ -206,9 +200,10 @@ public final class SecurityManagerSetup extends TestSetup {
 			catch (Exception e) { System.out.println( "Unreadable url: " + policyResource ); }
 		}
 
-		if (policyURL != null)
+		if (policyURL != null) {
 			set.setProperty("java.security.policy",
 					policyURL.toExternalForm());
+        }
 	}
 
 	
@@ -376,7 +371,7 @@ public final class SecurityManagerSetup extends TestSetup {
              new java.security.PrivilegedAction()
              {
                  public Object run() {
-                     System.setSecurityManager(null);
+                      System.setSecurityManager(null);
                      return null;
                  }
              }
