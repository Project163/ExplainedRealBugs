diff --git a/java/engine/org/apache/derby/impl/sql/execute/InsertResultSet.java b/java/engine/org/apache/derby/impl/sql/execute/InsertResultSet.java
index 31b3afe48..d69adc5c1 100644
--- a/java/engine/org/apache/derby/impl/sql/execute/InsertResultSet.java
+++ b/java/engine/org/apache/derby/impl/sql/execute/InsertResultSet.java
@@ -885,7 +885,7 @@ class InsertResultSet extends DMLWriteResultSet implements TargetResultSet
                  throw se;
              }
  
-             if (se.getMessageId().equals(SQLState.LOCK_TIMEOUT))
+             if ( se.getMessageId().equals(SQLState.LOCK_TIMEOUT) || se.isSelfDeadlock() )
              {
                  // if we couldn't do this with a nested xaction, retry with
                  // parent-- we need to wait this time!
diff --git a/java/testing/org/apache/derbyTesting/functionTests/tests/upgradeTests/Changes10_11.java b/java/testing/org/apache/derbyTesting/functionTests/tests/upgradeTests/Changes10_11.java
index e43e354c8..2a9b3e0e4 100644
--- a/java/testing/org/apache/derbyTesting/functionTests/tests/upgradeTests/Changes10_11.java
+++ b/java/testing/org/apache/derbyTesting/functionTests/tests/upgradeTests/Changes10_11.java
@@ -385,6 +385,36 @@ public class Changes10_11 extends UpgradeChange
         }
     }
 
+    /** Test that identity columns handle self-deadlock in soft-upgrade mode */
+    public void test_derby6692() throws Exception
+    {
+        Connection  conn = getConnection();
+        
+        switch (getPhase())
+        {
+            case PH_CREATE:
+            case PH_SOFT_UPGRADE:
+            case PH_POST_SOFT_UPGRADE:
+            case PH_HARD_UPGRADE:
+
+                boolean originalAutoCommit = conn.getAutoCommit();
+                try
+                {
+                    conn.setAutoCommit( false );
+
+                    conn.prepareStatement( "create table t_6692(i int generated always as identity)" ).execute();
+                    conn.prepareStatement( "insert into t_6692 values (default)" ).execute();
+
+                    conn.rollback();
+                }
+                finally
+                {
+                    conn.setAutoCommit( originalAutoCommit );
+                }
+                break;
+        }
+    }
+
     /** Test the Lucene plugin */
     public void testLuceneSupport() throws Exception
     {
