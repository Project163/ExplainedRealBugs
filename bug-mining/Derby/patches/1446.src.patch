diff --git a/java/engine/org/apache/derby/impl/jdbc/EmbedBlob.java b/java/engine/org/apache/derby/impl/jdbc/EmbedBlob.java
index db72434d3..e21a611aa 100644
--- a/java/engine/org/apache/derby/impl/jdbc/EmbedBlob.java
+++ b/java/engine/org/apache/derby/impl/jdbc/EmbedBlob.java
@@ -75,7 +75,7 @@ final class EmbedBlob extends ConnectionChild implements Blob, EngineLOB
     private InputStream     myStream;
     
     // locator key for lob. used by Network Server.
-    private final int             locator;
+    private int             locator;
     
     /*
      * Length of the BLOB if known. Set to -1 if
@@ -117,7 +117,7 @@ final class EmbedBlob extends ConnectionChild implements Blob, EngineLOB
              materialized = true;
              //add entry in connection so it can be cleared 
              //when transaction is not valid
-             locator = con.addLOBMapping (this);
+             con.addLOBReference (this);
          }
          catch (IOException e) {
              throw Util.setStreamFailure (e);
@@ -193,7 +193,7 @@ final class EmbedBlob extends ConnectionChild implements Blob, EngineLOB
         pos = 0;
         //add entry in connection so it can be cleared 
         //when transaction is not valid
-        this.locator = con.addLOBMapping (this);
+        con.addLOBReference (this);
     }
 
 
@@ -906,6 +906,8 @@ final class EmbedBlob extends ConnectionChild implements Blob, EngineLOB
         //valid
         isValid = false;
         
+        //remove entry from connection
+        localConn.removeLOBMapping(locator);
         //initialialize length to default value -1
         myLength = -1;
         
@@ -1000,6 +1002,9 @@ final class EmbedBlob extends ConnectionChild implements Blob, EngineLOB
      * @return The locator identifying this lob.
      */
     public int getLocator() {
+        if (locator == 0) {
+            locator = localConn.addLOBMapping(this);
+        }
         return locator;
     }
 }
diff --git a/java/engine/org/apache/derby/impl/jdbc/EmbedClob.java b/java/engine/org/apache/derby/impl/jdbc/EmbedClob.java
index 9f55e82c6..d2b3952a1 100644
--- a/java/engine/org/apache/derby/impl/jdbc/EmbedClob.java
+++ b/java/engine/org/apache/derby/impl/jdbc/EmbedClob.java
@@ -79,7 +79,7 @@ final class EmbedClob extends ConnectionChild implements Clob, EngineLOB
     /** Tells whether the Clob has been freed or not. */
     private boolean isValid = true;
 
-    private final int locator;
+    private int locator;
     
     /**
      * Creates an empty Clob object.
@@ -91,7 +91,7 @@ final class EmbedClob extends ConnectionChild implements Clob, EngineLOB
     EmbedClob(EmbedConnection con) throws SQLException {
         super(con);
         this.clob = new TemporaryClob (con.getDBName(), this);
-        this.locator = con.addLOBMapping (this);
+        con.addLOBReference (this);
     }
 
     /**
@@ -156,7 +156,7 @@ final class EmbedClob extends ConnectionChild implements Clob, EngineLOB
                 throw se;
             }
         }
-        this.locator = con.addLOBMapping (this);
+        con.addLOBReference (this);
     }
 
     /**
@@ -663,6 +663,7 @@ restartScan:
             } catch (IOException e) {
                 throw Util.setStreamFailure(e);
             } finally {
+                localConn.removeLOBMapping(locator);
                 this.clob = null;
             }
         }
@@ -791,6 +792,9 @@ restartScan:
      * @return locator value for this Clob.
      */
     public int getLocator() {
+        if (locator == 0) {
+            locator = localConn.addLOBMapping(this);
+        }
         return locator;
     }
 }
diff --git a/java/engine/org/apache/derby/impl/jdbc/EmbedConnection.java b/java/engine/org/apache/derby/impl/jdbc/EmbedConnection.java
index 8653e6104..74b4fadba 100644
--- a/java/engine/org/apache/derby/impl/jdbc/EmbedConnection.java
+++ b/java/engine/org/apache/derby/impl/jdbc/EmbedConnection.java
@@ -65,6 +65,8 @@ import java.sql.SQLException;
 import java.sql.SQLWarning;
 import java.sql.Statement;
 
+import java.util.Map;
+import java.util.WeakHashMap;
 import java.util.HashMap;
 import java.util.Properties;
 import java.util.Iterator;
@@ -131,6 +133,13 @@ public abstract class EmbedConnection implements EngineConnection
 	private HashMap lobHashMap = null;
 	private int lobHMKey = 0;
 
+    /**
+     * Map to keep track of all the lobs associated with this
+     * connection. These lobs will be cleared after the transaction
+     * is no longer valid or when connection is closed
+     */
+    private WeakHashMap lobReferences = null;
+
 	//////////////////////////////////////////////////////////
 	// STATE (copied to new nested connections, but nesting
 	// specific)
@@ -2901,14 +2910,17 @@ public abstract class EmbedConnection implements EngineConnection
 		//free all the lob resources in the HashMap
 		//initialize the locator value to 0 and
 		//the hash table object to null.
-		HashMap map = rootConnection.lobHashMap;
+		Map map = rootConnection.lobReferences;
 		if (map != null) {
-            Iterator it = map.values().iterator();
+            Iterator it = map.keySet ().iterator ();
             while (it.hasNext()) {
                 ((EngineLOB)it.next()).free();
 			}
 			map.clear();
 		}
+        if (rootConnection.lobHashMap != null) {
+            rootConnection.lobHashMap.clear ();
+        }
 	}
 
 	/**
@@ -2939,6 +2951,18 @@ public abstract class EmbedConnection implements EngineConnection
                 return newKey;
 	}
 
+    /**
+     * Adds an entry of the lob in WeakHashMap. These entries are used
+     * for cleanup during commit/rollback or close.
+     * @param lobReference LOB Object
+     */
+    void addLOBReference (Object lobReference) {
+        if (rootConnection.lobReferences == null) {
+            rootConnection.lobReferences = new WeakHashMap ();
+        }
+        rootConnection.lobReferences.put (lobReference, null);
+    }
+
 	/**
 	* Return the Hash Map in the root connection
 	* @return the HashMap that contains the locator to LOB object mapping
