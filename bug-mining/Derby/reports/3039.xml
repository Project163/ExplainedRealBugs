<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 14:48:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DERBY-5003] NPE in ReplicationRun_Local_3_p5 when stopping slave after purposefully crashing master</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5003</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Derby.log trace of this: (&lt;b&gt;Daily&lt;/b&gt; 1066867/2011-02-03 18:00:24 MET, JVM 1.5, Vista):&lt;/p&gt;

&lt;p&gt;NullPointerException in LogToFile.flush on slave: &lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
	at org.apache.derby.impl.store.raw.log.LogToFile.flush(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.log.LogToFile.flushAll(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.log.LogToFile.stopReplicationSlaveRole(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.store.replication.slave.SlaveController.stopSlave(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.store.replication.slave.SlaveController.stopSlave(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.db.SlaveDatabase.stopReplicationSlave(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.handleStopReplicationSlave(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.&amp;lt;init&amp;gt;(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection30.&amp;lt;init&amp;gt;(Unknown Source)&lt;br/&gt;
	at org.apache.derby.jdbc.Driver30.getNewEmbedConnection(Unknown Source)&lt;br/&gt;
	at org.apache.derby.jdbc.InternalDriver.connect(Unknown Source)&lt;br/&gt;
	at org.apache.derby.jdbc.AutoloadedDriver.connect(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.drda.Database.makeConnection(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.getConnFromDatabaseName(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.verifyUserIdPassword(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.parseSECCHK(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.parseDRDAConnection(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.processCommands(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.run(Unknown&lt;br/&gt;
        Source)&lt;/p&gt;

&lt;p&gt;The client side stack dump:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;Error/failure logged at Fri Feb 04 04:46:55 CET 2011&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.sql.SQLException: DERBY SQL error: SQLCODE: -1, SQLSTATE: XJ001, SQLERRMC: java.lang.NullPointerExceptionXJ001.U&lt;br/&gt;
	at org.apache.derby.client.am.SQLExceptionFactory.getSQLException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.am.SqlException.getSQLException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.jdbc.ClientDriver.connect(Unknown Source)&lt;br/&gt;
	at java.sql.DriverManager.getConnection(DriverManager.java:525)&lt;br/&gt;
	at java.sql.DriverManager.getConnection(DriverManager.java:193)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.stopSlave(ReplicationRun.java:3445)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.stopSlave(ReplicationRun.java:3395)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_3_p5.testReplication_Local_3_p5_DERBY_3878(ReplicationRun_Local_3_p5.java:93)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:585)&lt;br/&gt;
	at junit.framework.TestCase.runTest(TestCase.java:164)&lt;br/&gt;
	at junit.framework.TestCase.runBare(TestCase.java:130)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:112)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.runBare(ReplicationRun.java:207)&lt;br/&gt;
	at junit.framework.TestResult$1.protect(TestResult.java:106)&lt;br/&gt;
	at junit.framework.TestResult.runProtected(TestResult.java:124)&lt;br/&gt;
	at junit.framework.TestResult.run(TestResult.java:109)&lt;br/&gt;
	at junit.framework.TestCase.run(TestCase.java:120)&lt;br/&gt;
	at junit.framework.TestSuite.runTest(TestSuite.java:230)&lt;br/&gt;
	at junit.framework.TestSuite.run(TestSuite.java:225)&lt;br/&gt;
	at junit.framework.TestSuite.runTest(TestSuite.java:230)&lt;br/&gt;
	at junit.framework.TestSuite.run(TestSuite.java:225)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.framework.TestResult.runProtected(TestResult.java:124)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at junit.framework.TestSuite.runTest(TestSuite.java:230)&lt;br/&gt;
	at junit.framework.TestSuite.run(TestSuite.java:225)&lt;br/&gt;
	at junit.framework.TestSuite.runTest(TestSuite.java:230)&lt;br/&gt;
	at junit.framework.TestSuite.run(TestSuite.java:225)&lt;br/&gt;
	at junit.framework.TestSuite.runTest(TestSuite.java:230)&lt;br/&gt;
	at junit.framework.TestSuite.run(TestSuite.java:225)&lt;br/&gt;
	at junit.textui.TestRunner.doRun(TestRunner.java:121)&lt;br/&gt;
	at junit.textui.TestRunner.start(TestRunner.java:185)&lt;br/&gt;
	at junit.textui.TestRunner.main(TestRunner.java:143)&lt;br/&gt;
Caused by: org.apache.derby.client.am.SqlException: DERBY SQL error: SQLCODE: -1, SQLSTATE: XJ001, SQLERRMC: java.lang.NullPointerExceptionXJ001.U&lt;br/&gt;
	at org.apache.derby.client.am.Connection.completeSqlca(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnectionReply.parseRdbAccessFailed(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnectionReply.parseAccessRdbError(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnectionReply.parseACCRDBreply(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnectionReply.readAccessDatabase(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection.readSecurityCheckAndAccessRdb(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection.flowSecurityCheckAndAccessRdb(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection.flowUSRIDONLconnect(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection.flowConnect(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection.&amp;lt;init&amp;gt;(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.net.ClientJDBCObjectFactoryImpl.newNetConnection(Unknown Source)&lt;br/&gt;
	... 35 more&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12497730">DERBY-5003</key>
            <summary>NPE in ReplicationRun_Local_3_p5 when stopping slave after purposefully crashing master</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="dagw">Dag H. Wanvik</reporter>
                        <labels>
                            <label>derby_triage10_8</label>
                    </labels>
                <created>Sat, 5 Feb 2011 01:35:44 +0000</created>
                <updated>Thu, 28 Aug 2014 17:52:34 +0000</updated>
                                            <version>10.8.1.2</version>
                    <version>10.10.2.0</version>
                                                    <component>Replication</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="12990873" author="dagw" created="Sat, 5 Feb 2011 01:46:24 +0000"  >&lt;p&gt;I have saved the database images and log files bundle from this test (2Mb, a bit much to upload, so please contact me if you want to have a look at it).&lt;/p&gt;</comment>
                            <comment id="12996173" author="lilywei" created="Fri, 18 Feb 2011 00:40:28 +0000"  >&lt;p&gt;Did not reproduce it on windows 7 trunk svn 1071838&lt;/p&gt;</comment>
                            <comment id="12996843" author="dagw" created="Sat, 19 Feb 2011 19:35:38 +0000"  >

&lt;p&gt;These instabilities in the replication tests are very timing dependent&lt;br/&gt;
in my experience. Not sure what sets this one off.&lt;/p&gt;</comment>
                            <comment id="13016786" author="dagw" created="Thu, 7 Apr 2011 09:47:29 +0000"  >&lt;p&gt;Saw the same exception stack in testReplication_Local_StateTest_part1_1, running trunk on Solaris 11, Java 6, using Knut&apos;s parallel test runner, this time with sane build, cf. derby.log from slave uploaded &quot;db_slave-derby.log&quot;. NPE in LogToFile.flush when stopping slave.&lt;/p&gt;</comment>
                            <comment id="13018361" author="knutanders" created="Mon, 11 Apr 2011 14:10:02 +0000"  >&lt;p&gt;Also seen when testing the 10.8.1.0 release candidate on Windows Vista: &lt;a href=&quot;http://dbtg.foundry.sun.com/derby/test/10.8.1.0_RC-2/logs/jvm1.6-64/vista-64/suitesAll/report.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://dbtg.foundry.sun.com/derby/test/10.8.1.0_RC-2/logs/jvm1.6-64/vista-64/suitesAll/report.txt&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13078946" author="dagw" created="Wed, 3 Aug 2011 19:33:06 +0000"  >&lt;p&gt;Saw this again, but the slave derby.log file showed an NPE earlier this time, cf this stack from the uploaded file db_slave-derby.log.2:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;dailies error report: http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.6/testing/testlog/vista/1152848-suitesAll_diff.txt&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Replication slave role was stopped for database &apos;C:\cludev\jagtmp\autoderbyN_regression\suitesAll_7\log\db_slave\wombat&apos;.&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
	at org.apache.derby.impl.db.BasicDatabase.stop(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.db.SlaveDatabase.stop(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.TopService.stop(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.TopService.shutdown(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.shutdown(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.db.DatabaseContextImpl.cleanupOnError(Unknown Source)&lt;br/&gt;
	at org.apache.derby.iapi.services.context.ContextManager.cleanupOnError(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.cleanupOnError(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.internalStopReplicationSlave(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.&amp;lt;init&amp;gt;(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection30.&amp;lt;init&amp;gt;(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection40.&amp;lt;init&amp;gt;(Unknown Source)&lt;br/&gt;
	at org.apache.derby.jdbc.Driver40.getNewEmbedConnection(Unknown Source)&lt;br/&gt;
	at org.apache.derby.jdbc.InternalDriver.connect(Unknown Source)&lt;br/&gt;
	at org.apache.derby.jdbc.AutoloadedDriver.connect(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.db.SlaveDatabase.handleShutdown(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.db.SlaveDatabase.access$200(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.db.SlaveDatabase$SlaveDatabaseBootThread.run(Unknown Source)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:662)&lt;br/&gt;
----------------------------------------------------------------&lt;br/&gt;
Mon Aug 01 22:20:48 CEST 2011:&lt;br/&gt;
Shutting down instance 601a400f-0131-8701-514f-000002c3da64 on database directory C:\cludev\jagtmp\autoderbyN_regression\suitesAll_7\log\db_slave\wombat with class loader sun.misc.Launcher$AppClassLoader@1ea2dfe &lt;br/&gt;
Mon Aug 01 22:20:48 CEST 2011 Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;DRDAConnThread_3,5,main&amp;#93;&lt;/span&gt; Cleanup action starting&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
	at org.apache.derby.impl.store.raw.log.LogToFile.flush(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.log.LogToFile.flushAll(Unknown Source)&lt;br/&gt;
        :&lt;/p&gt;

&lt;p&gt;I am not sure the first NPE is related, though, just an observation. The variable &quot;dd&quot; (data dictionary) is null when stopping here, cf. BasicDatabase#stop.&lt;br/&gt;
But it happens as internalStopReplicationSlave shuts down the database after having verified that the slave has stopped, cf. line 1034 in EmbedConnection.&lt;/p&gt;</comment>
                            <comment id="13118233" author="dagw" created="Fri, 30 Sep 2011 17:50:10 +0000"  >&lt;p&gt;Saw this again:&lt;br/&gt;
&lt;a href=&quot;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.6/testing/testlog/vista-64/1176935-suitesAll_diff.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.6/testing/testlog/vista-64/1176935-suitesAll_diff.txt&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13128781" author="knutanders" created="Mon, 17 Oct 2011 10:38:44 +0000"  >&lt;p&gt;Also seen when testing the 10.8.2.2 release candidate: &lt;a href=&quot;http://dbtg.foundry.sun.com/derby/test/10.8.2.2_RC/logs/jvm1.6/win7/suitesAll/report.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://dbtg.foundry.sun.com/derby/test/10.8.2.2_RC/logs/jvm1.6/win7/suitesAll/report.txt&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13677324" author="mikem" created="Thu, 6 Jun 2013 18:10:27 +0000"  >&lt;p&gt;nightly regression test failure, null pointer during replication tests, on windows, 10.10, ibm15 jvm&lt;br/&gt;
&lt;a href=&quot;http://people.apache.org/~myrnavl/derby_test_results/v10_10/windows/testlog/ibm15/1489275-suites.All_diff.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://people.apache.org/~myrnavl/derby_test_results/v10_10/windows/testlog/ibm15/1489275-suites.All_diff.txt&lt;/a&gt;&lt;br/&gt;
There was 1 error:&lt;br/&gt;
1) testReplication_Local_3_p5_DERBY_3878(org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_3_p5)java.sql.SQLException: DERBY SQL error: ERRORCODE: 0, SQLSTATE: XJ001, SQLERRMC: java.lang.NullPointerException��XJ001.U&lt;br/&gt;
at org.apache.derby.client.am.SQLExceptionFactory.getSQLException(Unknown Source)&lt;br/&gt;
at org.apache.derby.client.am.SqlException.getSQLException(Unknown Source)&lt;br/&gt;
at org.apache.derby.jdbc.ClientDriver.connect(Unknown Source)&lt;br/&gt;
at java.sql.DriverManager.getConnection(DriverManager.java:572)&lt;br/&gt;
at java.sql.DriverManager.getConnection(DriverManager.java:218)&lt;br/&gt;
at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.stopSlave(ReplicationRun.java:2952)&lt;br/&gt;
at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.stopSlave(ReplicationRun.java:2901)&lt;br/&gt;
at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_3_p5.testReplication_Local_3_p5_DERBY_3878(ReplicationRun_Local_3_p5.java:93)&lt;br/&gt;
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:79)&lt;br/&gt;
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:117)&lt;br/&gt;
at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.runBare(ReplicationRun.java:247)&lt;br/&gt;
at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
Caused by: org.apache.derby.client.am.SqlException: DERBY SQL error: ERRORCODE: 0, SQLSTATE: XJ001, SQLERRMC: java.lang.NullPointerException��XJ001.U&lt;br/&gt;
at org.apache.derby.client.am.Connection.completeSqlca(Unknown Source)&lt;br/&gt;
at org.apache.derby.client.net.NetConnectionReply.parseRdbAccessFailed(Unknown Source)&lt;br/&gt;
at org.apache.derby.client.net.NetConnectionReply.parseAccessRdbError(Unknown Source)&lt;br/&gt;
at org.apache.derby.client.net.NetConnectionReply.parseACCRDBreply(Unknown Source)&lt;br/&gt;
at org.apache.derby.client.net.NetConnectionReply.readAccessDatabase(Unknown Source)&lt;br/&gt;
at org.apache.derby.client.net.NetConnection.readSecurityCheckAndAccessRdb(Unknown Source)&lt;br/&gt;
at org.apache.derby.client.net.NetConnection.flowSecurityCheckAndAccessRdb(Unknown Source)&lt;br/&gt;
at org.apache.derby.client.net.NetConnection.flowUSRIDONLconnect(Unknown Source)&lt;br/&gt;
at org.apache.derby.client.net.NetConnection.flowConnect(Unknown Source)&lt;br/&gt;
at org.apache.derby.client.net.NetConnection.&amp;lt;init&amp;gt;(Unknown Source)&lt;br/&gt;
at org.apache.derby.client.net.ClientJDBCObjectFactoryImpl.newNetConnection(Unknown Source)&lt;br/&gt;
... 35 more&lt;/p&gt;

&lt;p&gt;FAILURES!!! &lt;/p&gt;</comment>
                            <comment id="13822235" author="mamtas" created="Thu, 14 Nov 2013 07:36:53 +0000"  >&lt;p&gt;Failed again on trunk(1541374) with ibm 1.7 &lt;a href=&quot;http://people.apache.org/~myrnavl/derby_test_results/main/windows/testSummary-1541374.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://people.apache.org/~myrnavl/derby_test_results/main/windows/testSummary-1541374.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13914785" author="myrna" created="Thu, 27 Feb 2014 17:45:58 +0000"  >&lt;p&gt;Failed again, trunk, windows, ibm 1.6 (SR15), see: &lt;a href=&quot;http://people.apache.org/~myrnavl/derby_test_results/main/windows/testSummary-1572416.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://people.apache.org/~myrnavl/derby_test_results/main/windows/testSummary-1572416.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14091329" author="myrna" created="Fri, 8 Aug 2014 21:38:30 +0000"  >&lt;p&gt;This also failed during testing of the 10.11.1.1 RC2 (built at revision 1616546), with a somewhat different error stack trace:&lt;/p&gt;

&lt;p&gt;---------------------------------------------------------&lt;br/&gt;
testReplication_Local_3_p5_DERBY_3878(org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_3_p5)java.sql.SQLException: DERBY SQL error: ERRORCODE: 0, SQLSTATE: XJ001, SQLERRMC: java.lang.NullPointerException  XJ001.U&lt;br/&gt;
	at org.apache.derby.client.am.SQLExceptionFactory.getSQLException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.am.SqlException.getSQLException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.jdbc.ClientDriver.connect(Unknown Source)&lt;br/&gt;
	at java.sql.DriverManager.getConnection(DriverManager.java:664)&lt;br/&gt;
	at java.sql.DriverManager.getConnection(DriverManager.java:270)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.stopSlave(ReplicationRun.java:2948)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.stopSlave(ReplicationRun.java:2897)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_3_p5.testReplication_Local_3_p5_DERBY_3878(ReplicationRun_Local_3_p5.java:93)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:118)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.runBare(ReplicationRun.java:243)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
Caused by: ERROR XJ001: DERBY SQL error: ERRORCODE: 0, SQLSTATE: XJ001, SQLERRMC: java.lang.NullPointerException  XJ001.U&lt;br/&gt;
	at org.apache.derby.client.am.ClientConnection.completeSqlca(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnectionReply.parseRdbAccessFailed(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnectionReply.parseAccessRdbError(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnectionReply.parseACCRDBreply(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnectionReply.readAccessDatabase(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection.readSecurityCheckAndAccessRdb(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection.flowSecurityCheckAndAccessRdb(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection.flowUSRIDONLconnect(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection.flowConnect(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection.&amp;lt;init&amp;gt;(Unknown Source)&lt;br/&gt;
	at org.apache.derby.client.net.ClientJDBCObjectFactoryImpl.newNetConnection(Unknown Source)&lt;br/&gt;
	... 33 more&lt;br/&gt;
---------------------------------------------------------&lt;br/&gt;
The NPE in the db_slave-derby.log&lt;br/&gt;
---------------------------------------------------------&lt;br/&gt;
Thu Aug 07 21:10:27 PDT 2014 Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;DRDAConnThread_2,5,main&amp;#93;&lt;/span&gt; Cleanup action starting&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
        at org.apache.derby.impl.store.raw.log.LogToFile.flush(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.store.raw.log.LogToFile.flushAll(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.store.raw.log.LogToFile.stopReplicationSlaveRole(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.store.replication.slave.SlaveController.stopSlave(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.store.replication.slave.SlaveController.stopSlave(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.db.SlaveDatabase.stopReplicationSlave(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedConnection.handleStopReplicationSlave(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedConnection.&amp;lt;init&amp;gt;(Unknown Source)&lt;br/&gt;
        at org.apache.derby.jdbc.InternalDriver.getNewEmbedConnection(Unknown Source)&lt;br/&gt;
        at org.apache.derby.jdbc.InternalDriver.connect(Unknown Source)&lt;br/&gt;
        at org.apache.derby.jdbc.InternalDriver.connect(Unknown Source)&lt;br/&gt;
        at org.apache.derby.jdbc.EmbeddedDriver.connect(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.drda.Database.makeConnection(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.getConnFromDatabaseName(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.verifyUserIdPassword(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.parseSECCHK(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.parseDRDAConnection(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.processCommands(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.run(Unknown Source)&lt;br/&gt;
Cleanup action completed&lt;br/&gt;
---------------------------------------------------------&lt;/p&gt;</comment>
                            <comment id="14093218" author="dagw" created="Mon, 11 Aug 2014 20:00:24 +0000"  >&lt;p&gt;I suspect the NPE comes from FileToLog#logOut being null, but I don&apos;t yet have a theory how that can happen in this scenario. When the slave detects that the master is gone, could there be some kind of race which thread stops the slave? &lt;span class=&quot;error&quot;&gt;&amp;#91;the test does a) kill the master, b) stop slave&amp;#93;&lt;/span&gt;, cf. line 91 in ReplicationRun_Local_3_p5.&lt;/p&gt;</comment>
                            <comment id="14093247" author="dagw" created="Mon, 11 Aug 2014 20:24:36 +0000"  >&lt;p&gt;Hmm, no it seems the slave will try to reconnect to the master forever, unless it gets closed down, cf. SlaveController#handleDisconnect.&lt;/p&gt;</comment>
                            <comment id="14093446" author="dagw" created="Mon, 11 Aug 2014 22:21:54 +0000"  >&lt;p&gt;I can&apos;t reproduce this, so I am uploading a patch to print the state of LogToFile to derby.log at the moment we see this NPE &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12661079/12661079_derby-5003-diagnostics.diff&quot; title=&quot;derby-5003-diagnostics.diff attached to DERBY-5003&quot;&gt;derby-5003-diagnostics.diff&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; (with sane jars only).&lt;/p&gt;</comment>
                            <comment id="14093460" author="dagw" created="Mon, 11 Aug 2014 22:34:32 +0000"  >&lt;p&gt;Myrna, you had two tests on trunk that saw this error. Do you have derby.log for any of those (so we can see the exact line of the NPE)?&lt;/p&gt;</comment>
                            <comment id="14094085" author="jira-bot" created="Tue, 12 Aug 2014 14:20:21 +0000"  >&lt;p&gt;Commit 1617484 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dagw&quot; class=&quot;user-hover&quot; rel=&quot;dagw&quot;&gt;dagw&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1617484&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1617484&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5003&quot; title=&quot;NPE in ReplicationRun_Local_3_p5 when stopping slave after purposefully crashing master&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5003&quot;&gt;DERBY-5003&lt;/a&gt; NPE in ReplicationRun_Local_3_p5 when stopping slave after purposefully crashing master&lt;/p&gt;

&lt;p&gt;Patch to collect diagnostics (sane jars only): derby-5003-diagnostics.diff&lt;/p&gt;</comment>
                            <comment id="14094520" author="myrna" created="Tue, 12 Aug 2014 19:03:28 +0000"  >&lt;p&gt;I jarred up the following files from the fail directory from the 10.11.1.1 RC2 (build 1616546) run for Embedded (i.e. from subdir Embedded_40/ReplicationRun_Local_3_p5/testReplication_Local_3_p5_DERBY_3878):&lt;br/&gt;
  db_master-derby.log&lt;br/&gt;
  db_slave-derby.log&lt;br/&gt;
  derby.log&lt;br/&gt;
  error-stacktrace.out&lt;br/&gt;
Note that this was on a Windows 2008 machine (on VMWare), and the failure was with Oracle Hotspot jdk 1.8 (b132)&lt;/p&gt;</comment>
                            <comment id="14094559" author="dagw" created="Tue, 12 Aug 2014 19:27:53 +0000"  >&lt;p&gt;Thanks, Myrna. Unfortunately that jar contains logs from an insane derby jar, so it doesn&apos;t show the line numbers. This is the segment I am interested in (from the slave&apos;s derby.log):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.NullPointerException
at org.apache.derby.impl.store.raw.log.LogToFile.flush(Unknown Source)
at org.apache.derby.impl.store.raw.log.LogToFile.flushAll(Unknown Source)
at org.apache.derby.impl.store.raw.log.LogToFile.stopReplicationSlaveRole(Unknown Source)
at org.apache.derby.impl.store.replication.slave.SlaveController.stopSlave(Unknown Source)
at org.apache.derby.impl.store.replication.slave.SlaveController.stopSlave(Unknown Source)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I guess we&apos;ll just have to wait till it hits again.&lt;/p&gt;</comment>
                            <comment id="14094993" author="myrna" created="Wed, 13 Aug 2014 01:09:47 +0000"  >&lt;p&gt;Unfortunately I don&apos;t usually run with sane jars.&lt;br/&gt;
I ran the test 100x with (trunk) sane jars on the same machine where I saw the problem, but it didn&apos;t show...&lt;/p&gt;</comment>
                            <comment id="14114050" author="dagw" created="Thu, 28 Aug 2014 17:49:38 +0000"  >&lt;p&gt;Saw this last night: &lt;a href=&quot;http://javadb.se.oracle.com/javadb-testing/request_5595282/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://javadb.se.oracle.com/javadb-testing/request_5595282/&lt;/a&gt;&lt;br/&gt;
Here is the stack trace on derby.log:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.NullPointerException
at org.apache.derby.impl.store.raw.log.LogToFile.flush(LogToFile.java:4077)
at org.apache.derby.impl.store.raw.log.LogToFile.flushAll(LogToFile.java:1862)
at org.apache.derby.impl.store.raw.log.LogToFile.stopReplicationSlaveRole(LogToFile.java:5250)
at org.apache.derby.impl.store.replication.slave.SlaveController.stopSlave(SlaveController.java:266)
at org.apache.derby.impl.store.replication.slave.SlaveController.stopSlave(SlaveController.java:280)
at org.apache.derby.impl.db.SlaveDatabase.stopReplicationSlave(SlaveDatabase.java:255)
at org.apache.derby.impl.jdbc.EmbedConnection.handleStopReplicationSlave(EmbedConnection.java:1026)
at org.apache.derby.impl.jdbc.EmbedConnection.&amp;lt;init&amp;gt;(EmbedConnection.java:371)
at org.apache.derby.jdbc.InternalDriver.getNewEmbedConnection(InternalDriver.java:647)
at org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:301)
at org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:932)
at org.apache.derby.jdbc.EmbeddedDriver.connect(EmbeddedDriver.java:125)
at org.apache.derby.impl.drda.Database.makeConnection(Database.java:253)
at org.apache.derby.impl.drda.DRDAConnThread.getConnFromDatabaseName(DRDAConnThread.java:1472)
at org.apache.derby.impl.drda.DRDAConnThread.verifyUserIdPassword(DRDAConnThread.java:1422)
at org.apache.derby.impl.drda.DRDAConnThread.parseSECCHK(DRDAConnThread.java:3376)
at org.apache.derby.impl.drda.DRDAConnThread.parseDRDAConnection(DRDAConnThread.java:1206)
at org.apache.derby.impl.drda.DRDAConnThread.processCommands(DRDAConnThread.java:1006)
at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java:296)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14114054" author="dagw" created="Thu, 28 Aug 2014 17:52:26 +0000"  >&lt;p&gt;The NPE seems to stem from this code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;//add active buffers to dirty buffer list
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;//to flush to the disk.
&lt;/span&gt;logOut.switchLogBuffer();
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;so the variable &quot;logOut&quot; must be null.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12651182">DERBY-6249</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12501060">DERBY-5123</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12661279" name="D5003_080714.jar" size="6816" author="myrna" created="Tue, 12 Aug 2014 19:03:28 +0000"/>
                            <attachment id="12475693" name="db_slave-derby.log" size="15606" author="dagw" created="Thu, 7 Apr 2011 09:48:35 +0000"/>
                            <attachment id="12489233" name="db_slave-derby.log.2" size="13670" author="dagw" created="Wed, 3 Aug 2011 19:34:35 +0000"/>
                            <attachment id="12661079" name="derby-5003-diagnostics.diff" size="6188" author="dagw" created="Mon, 11 Aug 2014 22:24:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10369"><![CDATA[Regression Test Failure]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24587</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 12 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i06kkv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36268</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>