<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 14:44:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DERBY-6543] Syntax error when reference to transition variable has whitespace around it</title>
                <link>https://issues.apache.org/jira/browse/DERBY-6543</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;If a trigger action references a transition variable and has whitespace around the period sign that separates the transition variable name from the column name, it fails with a syntax error.&lt;/p&gt;

&lt;p&gt;For example:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ij&amp;gt; create table t1(x int);
0 rows inserted/updated/deleted
ij&amp;gt; create table t2(x int);
0 rows inserted/updated/deleted
ij&amp;gt; --fails
create trigger tr1 after insert on t1 referencing new as new
for each row insert into t1 select x from t2 where x = new . x;
ERROR 42X01: Syntax error: Encountered &quot;x&quot; at line 1, column 150.
Issue the &apos;help&apos; command for general information on IJ command syntax.
Any unrecognized commands are treated as potential SQL commands and executed directly.
Consult your DBMS server reference documentation for details of the SQL syntax supported by your server.
ij&amp;gt; --succeeds
create trigger tr2 after insert on t1 referencing new as new
for each row insert into t1 select x from t2 where x = new.x;
0 rows inserted/updated/deleted
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The only difference between the failing trigger definition and the successful one, is that the former says &quot;new . x&quot; and the latter &quot;new.x&quot;.&lt;/p&gt;

&lt;p&gt;Both should succeed.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12708714">DERBY-6543</key>
            <summary>Syntax error when reference to transition variable has whitespace around it</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 Apr 2014 09:25:01 +0000</created>
                <updated>Fri, 9 Sep 2016 09:53:27 +0000</updated>
                            <resolved>Tue, 7 Oct 2014 16:29:41 +0000</resolved>
                                    <version>10.10.2.0</version>
                                    <fixVersion>10.10.2.1</fixVersion>
                    <fixVersion>10.11.1.1</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13970615" author="knutanders" created="Wed, 16 Apr 2014 09:46:14 +0000"  >&lt;p&gt;The bug is caused by the rewrite of the SQL statement that happens in DataDictionaryImpl.getTriggerActionString(), where the original trigger action is supposed to be rewritten to:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;insert into t1 select x from t2 where x = CAST (org.apache.derby.iapi.db.Factory::getTriggerExecutionContext().getNewRow().getObject(1) AS INTEGER)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The logic is broken and instead rewrites it to:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;insert into t1 select x from t2 where x = CAST (org.apache.derby.iapi.db.Factory::getTriggerExecutionContext().getNewRow().getObject(1) AS INTEGER)  x
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Notice the trailing &quot;x&quot; that makes the statement invalid and causes the syntax error.&lt;/p&gt;

&lt;p&gt;I believe it is the following line at the end of the for loop in said method that&apos;s doing the wrong thing:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;			start = tokEndOffset- actionOffset + columnLength + 2;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It is supposed to make the start variable point after the end of the column reference. That is, just after the &quot;x&quot; in &quot;new . x&quot;.&lt;/p&gt;

&lt;p&gt;The buggy expression contains the magic number 2. It would probably have been clearer if it had been split up like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;			start = (tokEndOffset + 1) - actionOffset + 1 + columnLength;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The first +1 is to adjust the end offset so that it points just after the last character of the &quot;new&quot; token, instead of pointing at the last character. This is fine.&lt;/p&gt;

&lt;p&gt;The second +1 is to jump past the period sign to the beginning of the column name. If there are whitespace characters around the period sign, adding 1 isn&apos;t enough to jump to the beginning of the column name. This means parts of the column name are also seen in the next iteration, and the resulting SQL text gets garbled.&lt;/p&gt;</comment>
                            <comment id="13970646" author="knutanders" created="Wed, 16 Apr 2014 10:26:28 +0000"  >&lt;p&gt;The attached patch, d6543-1a.diff, fixes the problem and adds a regression test case for it.&lt;/p&gt;

&lt;p&gt;The patch changes how we calculate the next offset (the start variable). Instead of basing the calculation on the offset of the token before the period sign and adding the length of the period token and the column name token, it now uses the offset of the column name token directly. This simplifies the calculation, and removes the source of confusion (the length of the period token) from equation.&lt;/p&gt;

&lt;p&gt;TriggerTest passed with the patch. I&apos;m running the rest of the regression tests now.&lt;/p&gt;</comment>
                            <comment id="13970682" author="knutanders" created="Wed, 16 Apr 2014 11:24:21 +0000"  >&lt;p&gt;The full regression test suite passed with the patch.&lt;/p&gt;</comment>
                            <comment id="13976514" author="jira-bot" created="Tue, 22 Apr 2014 08:02:28 +0000"  >&lt;p&gt;Commit 1589036 from kahatlen@apache.org in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1589036&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1589036&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6543&quot; title=&quot;Syntax error when reference to transition variable has whitespace around it&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6543&quot;&gt;&lt;del&gt;DERBY-6543&lt;/del&gt;&lt;/a&gt;: Syntax error when reference to transition variable has whitespace around it&lt;/p&gt;</comment>
                            <comment id="14161030" author="myrna" created="Mon, 6 Oct 2014 21:50:21 +0000"  >&lt;p&gt;reopen for backport to 10.10&lt;/p&gt;</comment>
                            <comment id="14161033" author="jira-bot" created="Mon, 6 Oct 2014 21:51:22 +0000"  >&lt;p&gt;Commit 1629771 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=myrna&quot; class=&quot;user-hover&quot; rel=&quot;myrna&quot;&gt;myrna&lt;/a&gt; in branch &apos;code/branches/10.10&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1629771&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1629771&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6543&quot; title=&quot;Syntax error when reference to transition variable has whitespace around it&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6543&quot;&gt;&lt;del&gt;DERBY-6543&lt;/del&gt;&lt;/a&gt;; Syntax error when reference to transition variable has whitespace around it&lt;br/&gt;
   merge of revision 1589036 from trunk&lt;/p&gt;</comment>
                            <comment id="14162074" author="myrna" created="Tue, 7 Oct 2014 16:29:41 +0000"  >&lt;p&gt;Resolving again. &lt;br/&gt;
There were test failures, specifically:&lt;br/&gt;
&lt;a href=&quot;http://people.apache.org/~myrnavl/derby_test_results/v10_10/linux/testlog/ibm17/1629792-suites.All_diff.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://people.apache.org/~myrnavl/derby_test_results/v10_10/linux/testlog/ibm17/1629792-suites.All_diff.txt&lt;/a&gt; (error in spawning a compatibility test run)&lt;br/&gt;
&lt;a href=&quot;http://people.apache.org/~myrnavl/derby_test_results/v10_10/windows/testlog/ibm15/1629797-suites.All_diff.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://people.apache.org/~myrnavl/derby_test_results/v10_10/windows/testlog/ibm15/1629797-suites.All_diff.txt&lt;/a&gt;, but I think those are unrelated. &lt;/p&gt;</comment>
                            <comment id="15476629" author="knutanders" created="Fri, 9 Sep 2016 09:53:27 +0000"  >&lt;p&gt;[ Automatically closing all resolved issues that haven&apos;t been updated in more than six months. ]&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12746192">DERBY-6759</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12640447" name="d6543-1a.diff" size="3162" author="knutanders" created="Wed, 16 Apr 2014 10:26:28 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>387037</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 10 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1uo9j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>387300</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>