<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 14:49:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DERBY-6751] Prevent user code from getting the LanguageConnectionContext from an EmbedConnection</title>
                <link>https://issues.apache.org/jira/browse/DERBY-6751</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;User code can cast a java.sql.Connection to an EmbedConnection and then get the LanguageConnectionContext by calling EmbedConnection.getLanguageConnection(). We should prevent user code from doing this.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12744757">DERBY-6751</key>
            <summary>Prevent user code from getting the LanguageConnectionContext from an EmbedConnection</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rhillegas">Richard N. Hillegas</assignee>
                                    <reporter username="rhillegas">Richard N. Hillegas</reporter>
                        <labels>
                            <label>derby_backport_reject_10_11</label>
                    </labels>
                <created>Mon, 29 Sep 2014 19:12:44 +0000</created>
                <updated>Fri, 9 Sep 2016 09:54:12 +0000</updated>
                            <resolved>Wed, 1 Oct 2014 22:43:44 +0000</resolved>
                                    <version>10.12.1.1</version>
                                    <fixVersion>10.12.1.1</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14153131" author="rhillegas" created="Tue, 30 Sep 2014 12:55:49 +0000"  >&lt;p&gt;Attaching derby-6751-01-aa-usederbyinternals.diff. This patch adds a usederbyinternals check to EmbedConnection.getLanguageConnection(). I am running tests now.&lt;/p&gt;


&lt;p&gt;Touches the following files:&lt;/p&gt;

&lt;p&gt;----------------&lt;/p&gt;

&lt;p&gt;M       java/engine/org/apache/derby/impl/jdbc/EmbedConnectionContext.java&lt;/p&gt;

&lt;p&gt;Adds a check for usederbyinternals permission to EmbedConnection.getLanguageConnection().&lt;/p&gt;

&lt;p&gt;----------------&lt;/p&gt;

&lt;p&gt;M       java/engine/org/apache/derby/impl/jdbc/EmbedResultSet.java&lt;br/&gt;
M       java/engine/org/apache/derby/impl/jdbc/EmbedStatement.java&lt;br/&gt;
M       java/engine/org/apache/derby/impl/jdbc/EmbedDatabaseMetaData.java&lt;br/&gt;
M       java/engine/org/apache/derby/impl/jdbc/EmbedSavepoint.java&lt;br/&gt;
M       java/engine/org/apache/derby/impl/jdbc/EmbedConnection.java&lt;br/&gt;
M       java/engine/org/apache/derby/jdbc/InternalDriver.java&lt;/p&gt;

&lt;p&gt;Wraps doPrivileged() blocks around the callers of EmbedConnection.getLanguageConnection().&lt;/p&gt;

&lt;p&gt;----------------&lt;/p&gt;

&lt;p&gt;M       java/testing/org/apache/derbyTesting/functionTests/tests/lang/NoDBInternalsPermissionTest.java&lt;/p&gt;

&lt;p&gt;Adds a test case to verify that application code can&apos;t call EmbedConnection.getLanguageConnection() when running under a SecurityManager.&lt;/p&gt;</comment>
                            <comment id="14153361" author="rhillegas" created="Tue, 30 Sep 2014 16:33:58 +0000"  >&lt;p&gt;Attaching derby-6751-01-ab-usederbyinternals.diff. This version of the patch adds doPrivileged() blocks to some more callers of EmbedConnection.getLanguageConnection(). I am re-running tests now.&lt;/p&gt;


&lt;p&gt;Touches the following additional files:&lt;/p&gt;

&lt;p&gt;M       java/engine/org/apache/derby/impl/jdbc/ConnectionChild.java&lt;br/&gt;
M       java/engine/org/apache/derby/jdbc/EmbedPooledConnection.java&lt;br/&gt;
M       java/engine/org/apache/derby/jdbc/EmbedXAResource.java&lt;br/&gt;
M       java/testing/org/apache/derbyTesting/junit/BaseJDBCTestCase.java&lt;/p&gt;</comment>
                            <comment id="14155460" author="rhillegas" created="Wed, 1 Oct 2014 20:39:52 +0000"  >&lt;p&gt;Attaching derby-6751-01-ad-usederbyinternals.diff. This rev of the patch fixes a test regression introduced by the previous rev. I am re-running tests.&lt;/p&gt;

&lt;p&gt;I added a method to BaseJDBCTestCase whose signature included the LanguageConnectionContext and EmbedConnection types. This made the method lookup logic in junit.framework.TestSuite blow up when a TestSuite( JDBCDriverTest.class ) was added to the compatibility test suite. That is because LanguageConnectionContext and EmbedConnection are not on the client-only classpath, which deliberately does not include derby.jar.&lt;/p&gt;

&lt;p&gt;I&apos;ve changed the signature of that method so that it takes a java.sql.Connection and returns a java.lang.Object.&lt;/p&gt;

&lt;p&gt;Note that BaseJDBCTestCase still imports LanguageConnectionContext and EmbedConnection. It is conceivable that there are JVMs out there which would raise verification errors when running the compatibility tests. Fixing that pre-existing problem is outside the scope of this issue.&lt;/p&gt;</comment>
                            <comment id="14155540" author="myrna" created="Wed, 1 Oct 2014 21:13:24 +0000"  >&lt;p&gt;Rick, is this something that is going to be backported? I&apos;m thinking it should not be because there will be incompatibilities?&lt;/p&gt;</comment>
                            <comment id="14155698" author="jira-bot" created="Wed, 1 Oct 2014 22:41:23 +0000"  >&lt;p&gt;Commit 1628855 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhillegas&quot; class=&quot;user-hover&quot; rel=&quot;rhillegas&quot;&gt;rhillegas&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1628855&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1628855&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6751&quot; title=&quot;Prevent user code from getting the LanguageConnectionContext from an EmbedConnection&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6751&quot;&gt;&lt;del&gt;DERBY-6751&lt;/del&gt;&lt;/a&gt;: Prevent user code from getting a LanguageConnectionContext out of an EmbedConnection; tests passed cleanly on derby-6751-01-ad-usederbyinternals.diff.&lt;/p&gt;</comment>
                            <comment id="14155706" author="rhillegas" created="Wed, 1 Oct 2014 22:43:21 +0000"  >&lt;p&gt;Hi Myrna,&lt;/p&gt;

&lt;p&gt;I agree that this fix should not be backported. Thanks.&lt;/p&gt;</comment>
                            <comment id="14159489" author="knutanders" created="Sun, 5 Oct 2014 09:40:10 +0000"  >&lt;p&gt;In the last few days, the performance regression tests have shown a significant drop for primary key joins. See here: &lt;a href=&quot;http://home.online.no/~olmsan/derby/perf/joinprimarykey_30d.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://home.online.no/~olmsan/derby/perf/joinprimarykey_30d.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It seems to have started when the patch for this issue was committed. (The other candidates were &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6269&quot; title=&quot;Misleading warning text if you create an index duplicating a constraint.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6269&quot;&gt;&lt;del&gt;DERBY-6269&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6748&quot; title=&quot;Localize messages introduced or changed in 10.11.1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6748&quot;&gt;&lt;del&gt;DERBY-6748&lt;/del&gt;&lt;/a&gt;, but I find it unlikely that they had any performance impact.)&lt;/p&gt;

&lt;p&gt;The affected test uses &lt;tt&gt;org.apache.derbyTesting.perf.clients.Runner&lt;/tt&gt; with &lt;tt&gt;-load index_join&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;The other load types in the regression tests seem unaffected, as far as I can tell.&lt;/p&gt;</comment>
                            <comment id="14159692" author="knutanders" created="Sun, 5 Oct 2014 20:39:44 +0000"  >&lt;p&gt;I took a quick look in a profiler. The one thing that caught my attention, was that ConnectionChild.getLanguageConnectionContext(EmbedConnection) (called from EmbedResultSet.movePosition()) came fairly high up. It is called once per call to ResultSet.next(). The test in question works on relatively big result sets (1000 rows), so it makes sense that its performance is affected when doPrivileged() is called for every call to next(). Perhaps the lcc could be cached in EmbedResultSet to avoid the extra cost.&lt;/p&gt;</comment>
                            <comment id="14160483" author="rhillegas" created="Mon, 6 Oct 2014 16:47:10 +0000"  >&lt;p&gt;Thanks for that theory, Knut. Attaching derby-6751-02-aa-cacheLCC.diff. This patch makes the callers of EmbedConnection.getLanguageConnection() cache the lcc so that the lcc won&apos;t have to be re-read repeatedly inside tight loops. I will run tests.&lt;/p&gt;

&lt;p&gt;Hopefully, this will address the performance regression Knut saw.&lt;/p&gt;

&lt;p&gt;Touches the following files:&lt;/p&gt;

&lt;p&gt;M       java/engine/org/apache/derby/impl/jdbc/ConnectionChild.java&lt;br/&gt;
M       java/engine/org/apache/derby/jdbc/EmbedPooledConnection.java&lt;br/&gt;
M       java/engine/org/apache/derby/jdbc/EmbedXAResource.java&lt;/p&gt;</comment>
                            <comment id="14160768" author="rhillegas" created="Mon, 6 Oct 2014 19:19:10 +0000"  >&lt;p&gt;The previous patch raised errors in  J2EEDataSourceTest and SavepointJdbc30Test. Attaching derby-6751-02-ab-cacheLCC.diff. This patch backs off the change to EmbedPooledConnection and adjusts EmbedSavepoint to sometimes not grab the cached lcc. I will re-run the tests.&lt;/p&gt;

&lt;p&gt;Touches the following files:&lt;/p&gt;

&lt;p&gt;M       java/engine/org/apache/derby/impl/jdbc/ConnectionChild.java&lt;br/&gt;
M       java/engine/org/apache/derby/impl/jdbc/EmbedSavepoint.java&lt;br/&gt;
M       java/engine/org/apache/derby/jdbc/EmbedXAResource.java&lt;/p&gt;</comment>
                            <comment id="14161831" author="jira-bot" created="Tue, 7 Oct 2014 12:28:53 +0000"  >&lt;p&gt;Commit 1629866 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhillegas&quot; class=&quot;user-hover&quot; rel=&quot;rhillegas&quot;&gt;rhillegas&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1629866&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1629866&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6751&quot; title=&quot;Prevent user code from getting the LanguageConnectionContext from an EmbedConnection&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6751&quot;&gt;&lt;del&gt;DERBY-6751&lt;/del&gt;&lt;/a&gt;: Improve performance of ResultSet.next() by caching the lcc in ConnectionChild; tests passed cleanly on derby-6751-02-ab-cacheLCC.diff.&lt;/p&gt;</comment>
                            <comment id="14166531" author="knutanders" created="Fri, 10 Oct 2014 07:40:32 +0000"  >&lt;p&gt;The performance test results seem to be back to normal now. Thanks for fixing it.&lt;/p&gt;</comment>
                            <comment id="15476674" author="knutanders" created="Fri, 9 Sep 2016 09:54:12 +0000"  >&lt;p&gt;[ Automatically closing all resolved issues that haven&apos;t been updated in more than six months. ]&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12725352">DERBY-6648</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12672022" name="derby-6751-01-aa-usederbyinternals.diff" size="27118" author="rhillegas" created="Tue, 30 Sep 2014 12:55:49 +0000"/>
                            <attachment id="12672057" name="derby-6751-01-ab-usederbyinternals.diff" size="33633" author="rhillegas" created="Tue, 30 Sep 2014 16:33:58 +0000"/>
                            <attachment id="12672401" name="derby-6751-01-ad-usederbyinternals.diff" size="35194" author="rhillegas" created="Wed, 1 Oct 2014 20:39:52 +0000"/>
                            <attachment id="12673117" name="derby-6751-02-aa-cacheLCC.diff" size="5027" author="rhillegas" created="Mon, 6 Oct 2014 16:47:10 +0000"/>
                            <attachment id="12673169" name="derby-6751-02-ab-cacheLCC.diff" size="4036" author="rhillegas" created="Mon, 6 Oct 2014 19:19:10 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 10 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i20lnz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>