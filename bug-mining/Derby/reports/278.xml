<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 13:20:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DERBY-1010] setTransactionIsolation can cause ava.sql.SQLException: Invalid operation: statement closed in some contexts with xa</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1010</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;With xa setTransactionIsolation can cause a statement closed exception when calling &lt;br/&gt;
setTransactionIsolation&lt;/p&gt;

&lt;p&gt;Client tries to reuse a statement for sending SET CURRENT ISOLATION statements to the server.  There must be some problems with this logic where it is trying to use a closed statement.  Perhaps an overall better strategy would be to use an EXCSQLSET to send the set commands to the server and then invoke the embedded JDBC setTransactionIsolation call on the server as Oyvind did for setQueryTimeout.  Using the SET ISOLATION statements on the client has caused a variety of problems.&lt;/p&gt;


&lt;p&gt;// setTransactionIsolation in some contexts used in this test is &lt;br/&gt;
	// causing  java.sql.SQLException: Invalid operation: statement closed&lt;br/&gt;
	// error on client. These cases are omitted for now where they cause the&lt;br/&gt;
	// statement closed error&lt;br/&gt;
	private static boolean  causesStmtClosedOnSetTransactionIsolation = TestUtil.isDerbyNetClientFramework();&lt;/p&gt;

&lt;p&gt;java.sql.SQLException: Invalid operation: statement closed&lt;br/&gt;
        at org.apache.derby.client.am.SqlException.getSQLException(SqlException.java:280)&lt;br/&gt;
        at org.apache.derby.client.am.Statement.executeUpdate(Statement.java:437)&lt;br/&gt;
        at org.apache.derby.client.am.Connection.setTransactionIsolation(Connection.java:911)&lt;br/&gt;
        at org.apache.derby.client.am.LogicalConnection.setTransactionIsolation(LogicalConnection.java:184)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.jdbcapi.checkDataSource.runTest(checkDataSource.java:404)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.jdbcapi.checkDataSource.main(checkDataSource.java:119)&lt;br/&gt;
Caused by: org.apache.derby.client.am.SqlException: Invalid operation: statement closed&lt;br/&gt;
        at org.apache.derby.client.am.Statement.checkForClosedStatement(Statement.java:2231)&lt;br/&gt;
        at org.apache.derby.client.am.Statement.flowExecute(Statement.java:1737)&lt;br/&gt;
        at org.apache.derby.client.am.Statement.executeUpdateX(Statement.java:442)&lt;br/&gt;
        at org.apache.derby.client.am.Statement.executeUpdate(Statement.java:428)&lt;br/&gt;
        ... 4 more&lt;br/&gt;
Exception in thread &quot;main&quot; D&amp;gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12329159">DERBY-1010</key>
            <summary>setTransactionIsolation can cause ava.sql.SQLException: Invalid operation: statement closed in some contexts with xa</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kmarsden">Katherine Marsden</assignee>
                                    <reporter username="kmarsden">Katherine Marsden</reporter>
                        <labels>
                    </labels>
                <created>Sun, 19 Feb 2006 07:18:00 +0000</created>
                <updated>Wed, 24 May 2006 04:55:28 +0000</updated>
                            <resolved>Wed, 24 May 2006 04:55:08 +0000</resolved>
                                    <version>10.1.3.1</version>
                    <version>10.2.1.6</version>
                                    <fixVersion>10.1.3.1</fixVersion>
                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Network Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12367450" author="kmarsden" created="Thu, 23 Feb 2006 08:59:43 +0000"  >&lt;p&gt;Checked in a fix to 10.2 for this.&lt;/p&gt;

&lt;p&gt;Date: Wed Feb 22 15:57:30 2006&lt;br/&gt;
New Revision: 379993&lt;/p&gt;

&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/viewcvs?rev=379993&amp;amp;view=rev&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs?rev=379993&amp;amp;view=rev&lt;/a&gt;&lt;br/&gt;
Log:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1010&quot; title=&quot;setTransactionIsolation can cause ava.sql.SQLException: Invalid operation: statement closed in some contexts with xa&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1010&quot;&gt;&lt;del&gt;DERBY-1010&lt;/del&gt;&lt;/a&gt; - setTransactionIsolation can cause ava.sql.SQLException: Invalid operation: statement closed in some contexts with xa&lt;/p&gt;

&lt;p&gt;Client has a Statement object that it reuses to send SET CURRENT ISOLATION commands to the server.  Added a check to make sure this statement was not closed before trying to reuse it.&lt;/p&gt;

&lt;p&gt;This change takes the checkDataSource test a bit further (&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-435&quot; title=&quot;jdbcapi/checkDataSource.java and  jdbapi/checkDataSource30.java to tests should be changed or extended to test client DataSources&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-435&quot;&gt;&lt;del&gt;DERBY-435&lt;/del&gt;&lt;/a&gt;) but there seem to be issues with isolation being set correctly with xa_join.  I will investigate that and file a Jira issue&lt;/p&gt;</comment>
                            <comment id="12368393" author="kmarsden" created="Thu, 2 Mar 2006 08:21:55 +0000"  >&lt;p&gt;Date: Wed Mar  1 15:18:01 2006&lt;br/&gt;
New Revision: 382195&lt;/p&gt;

&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/viewcvs?rev=382195&amp;amp;view=rev&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs?rev=382195&amp;amp;view=rev&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12368632" author="kmarsden" created="Fri, 3 Mar 2006 10:46:41 +0000"  >&lt;p&gt;Putting on my Reporter hat:&lt;br/&gt;
This issue is  marked  resolved and it is but the tests won&apos;t come to 10.1 until &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-435&quot; title=&quot;jdbcapi/checkDataSource.java and  jdbapi/checkDataSource30.java to tests should be changed or extended to test client DataSources&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-435&quot;&gt;&lt;del&gt;DERBY-435&lt;/del&gt;&lt;/a&gt; is resolved.&lt;br/&gt;
I will close it at that time.&lt;/p&gt;

&lt;p&gt;Also wanted to mention that looking at the fix I am not so keen on it now.  &lt;br/&gt;
It checks to see if the statement is closed in addition to checking if it is null before using it.   Instead it should have been nulled out in closeResourcesX. &lt;/p&gt;</comment>
                            <comment id="12413010" author="kmarsden" created="Wed, 24 May 2006 04:54:24 +0000"  >&lt;p&gt;Reopen to change fixin to 10.1&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22261</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            19 years, 28 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i07brz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40674</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>