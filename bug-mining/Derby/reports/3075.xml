<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 14:49:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DERBY-6112] SSL Test (and network server )  can hang if serverSocket.accept() fails for something other than an IOException</title>
                <link>https://issues.apache.org/jira/browse/DERBY-6112</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;In starting a server with SSL as in SSLTest if serverSocket.accept() fails for some reason other than an IOException  it may just print the error to console and hang.  In this case it was:&lt;br/&gt;
java.security.AccessControlException: Access denied (java.util.PropertyPermission&lt;/p&gt;


&lt;p&gt;I saw this when debugging a java  issue in serverSocket.accept() but I think it could be simulated by adding an unwrapped System.getProperty() of some sort before serverSocket.accept() to force a  permission error. e.g. &lt;/p&gt;

&lt;p&gt;         System.getProperty(&quot;derby.system.home&quot;);&lt;br/&gt;
         return serverSocket.accept();&lt;br/&gt;
                            } catch (IOException acceptE) {&lt;/p&gt;

&lt;p&gt;I have not verified that would work.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12637637">DERBY-6112</key>
            <summary>SSL Test (and network server )  can hang if serverSocket.accept() fails for something other than an IOException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="myrna">Myrna van Lunteren</assignee>
                                    <reporter username="kmarsden">Katherine Marsden</reporter>
                        <labels>
                            <label>derby_triage10_11</label>
                    </labels>
                <created>Mon, 18 Mar 2013 20:47:25 +0000</created>
                <updated>Fri, 9 Sep 2016 09:52:14 +0000</updated>
                            <resolved>Thu, 18 Sep 2014 22:16:40 +0000</resolved>
                                    <version>10.8.3.0</version>
                                    <fixVersion>10.12.1.1</fixVersion>
                                    <component>Network Server</component>
                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14134523" author="myrna" created="Mon, 15 Sep 2014 21:30:40 +0000"  >&lt;p&gt;I tried the experiment Kathey suggested and added the line to the run() method in org.apache.derby.impl.drda.ClientThread:acceptClientWithRetry:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; Socket acceptClientWithRetry() {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; AccessController.doPrivileged(
                &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PrivilegedAction&amp;lt;Socket&amp;gt;() {
                    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Socket run() {
                        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; trycount = 1; trycount &amp;lt;= 3; trycount++) {
                            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
=&amp;gt; +                         &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.getProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;derby.system.home&quot;&lt;/span&gt;);
                                &lt;span class=&quot;code-comment&quot;&gt;// DERBY-5347 Need to exit &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;
&lt;/span&gt;                                &lt;span class=&quot;code-comment&quot;&gt;// accept fails with IOException
&lt;/span&gt;                                &lt;span class=&quot;code-comment&quot;&gt;// Cannot just aimlessly loop
&lt;/span&gt;                                &lt;span class=&quot;code-comment&quot;&gt;// writing errors
&lt;/span&gt;                                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; serverSocket.accept();
                            } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException acceptE) {
....
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Then I ran the test with sane jars using ibm 1.7. &lt;br/&gt;
The test did not hang, instead, I got a number of jvm core dumps and the test failed with  OutOfMemoryErrors like this:&lt;/p&gt;

&lt;p&gt;1) testSSLBasicDSConnect(org.apache.derbyTesting.functionTests.tests.derbynet.SSLTest)java.lang.OutOfMemoryError: Java heap space&lt;br/&gt;
        at java.lang.StringCoding.decode(StringCoding.java:508)&lt;br/&gt;
        at java.lang.StringCoding.decode(StringCoding.java:578)&lt;br/&gt;
        at java.lang.String.&amp;lt;init&amp;gt;(String.java:181)&lt;br/&gt;
        at com.ibm.jvm.io.ConsolePrintStream.write(ConsolePrintStream.java:177)&lt;br/&gt;
        at java.io.ByteArrayOutputStream.writeTo(ByteArrayOutputStream.java:165)&lt;br/&gt;
        at org.apache.derbyTesting.junit.SpawnedProcess.printDiagnostics(SpawnedProcess.java:367)&lt;br/&gt;
        at org.apache.derbyTesting.junit.SpawnedProcess.complete(SpawnedProcess.java:329)&lt;br/&gt;
        at org.apache.derbyTesting.junit.NetworkServerTestSetup.setUp(NetworkServerTestSetup.java:219)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:20)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:58)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;/p&gt;
</comment>
                            <comment id="14134554" author="myrna" created="Mon, 15 Sep 2014 21:54:37 +0000"  >&lt;p&gt;If I change the IOException caught into an Exception, I get the following output:&lt;/p&gt;

&lt;p&gt;1) testSSLBasicDSConnect(org.apache.derbyTesting.functionTests.tests.derbynet.SSLTest)junit.framework.AssertionFailedError: Timed out waiting for network server to start (localhost:1527):Spawned SpawnedNetworkServer exitCode=0&lt;br/&gt;
STDOUT:&lt;br/&gt;
Mon Sep 15 14:38:02 PDT 2014 : Security manager installed using the Basic server security policy.&lt;br/&gt;
Mon Sep 15 14:38:02 PDT 2014 : Apache Derby Network Server - 10.12.0.0 alpha - (1625092:1625093M) started and ready to accept SSL connections on port 1527&lt;br/&gt;
Mon Sep 15 14:38:02 PDT 2014 : Access denied (&quot;java.util.PropertyPermission&quot; &quot;derby.system.home&quot; &quot;read&quot;)&lt;br/&gt;
java.security.AccessControlException: Access denied (&quot;java.util.PropertyPermission&quot; &quot;derby.system.home&quot; &quot;read&quot;)&lt;br/&gt;
        at java.security.AccessController.throwACE(AccessController.java:100)&lt;br/&gt;
        at java.security.AccessController.checkPermission(AccessController.java:174)&lt;br/&gt;
        at java.lang.SecurityManager.checkPermission(SecurityManager.java:562)&lt;br/&gt;
        at java.lang.SecurityManager.checkPropertyAccess(SecurityManager.java:1311)&lt;br/&gt;
        at java.lang.System.getProperty(System.java:426)&lt;br/&gt;
        at java.lang.System.getProperty(System.java:410)&lt;br/&gt;
        at org.apache.derby.impl.drda.ClientThread$1.run(ClientThread.java:160)&lt;br/&gt;
        at org.apache.derby.impl.drda.ClientThread$1.run(ClientThread.java:156)&lt;br/&gt;
        at java.security.AccessController.doPrivileged(AccessController.java:274)&lt;br/&gt;
        at org.apache.derby.impl.drda.ClientThread.acceptClientWithRetry(ClientThread.java:155)&lt;br/&gt;
        at org.apache.derby.impl.drda.ClientThread.run(ClientThread.java:63)&lt;br/&gt;
Mon Sep 15 14:38:03 PDT 2014 : Access denied (&quot;java.util.PropertyPermission&quot; &quot;derby.system.home&quot; &quot;read&quot;)&lt;br/&gt;
java.security.AccessControlException: Access denied (&quot;java.util.PropertyPermission&quot; &quot;derby.system.home&quot; &quot;read&quot;)&lt;br/&gt;
        at java.security.AccessController.throwACE(AccessController.java:100)&lt;br/&gt;
        at java.security.AccessController.checkPermission(AccessController.java:174)&lt;br/&gt;
        at java.lang.SecurityManager.checkPermission(SecurityManager.java:562)&lt;br/&gt;
        at java.lang.SecurityManager.checkPropertyAccess(SecurityManager.java:1311)&lt;br/&gt;
        at java.lang.System.getProperty(System.java:426)&lt;br/&gt;
        at java.lang.System.getProperty(System.java:410)&lt;br/&gt;
        at org.apache.derby.impl.drda.ClientThread$1.run(ClientThread.java:160)&lt;br/&gt;
        at org.apache.derby.impl.drda.ClientThread$1.run(ClientThread.java:156)&lt;br/&gt;
        at java.security.AccessController.doPrivileged(AccessController.java:274)&lt;br/&gt;
        at org.apache.derby.impl.drda.ClientThread.acceptClientWithRetry(ClientThread.java:155)&lt;br/&gt;
        at org.apache.derby.impl.drda.ClientThread.run(ClientThread.java:63)&lt;br/&gt;
Mon Sep 15 14:38:04 PDT 2014 : Access denied (&quot;java.util.PropertyPermission&quot; &quot;derby.system.home&quot; &quot;read&quot;)&lt;br/&gt;
java.security.AccessControlException: Access denied (&quot;java.util.PropertyPermission&quot; &quot;derby.system.home&quot; &quot;read&quot;)&lt;br/&gt;
        at java.security.AccessController.throwACE(AccessController.java:100)&lt;br/&gt;
        at java.security.AccessController.checkPermission(AccessController.java:174)&lt;br/&gt;
        at java.lang.SecurityManager.checkPermission(SecurityManager.java:562)&lt;br/&gt;
        at java.lang.SecurityManager.checkPropertyAccess(SecurityManager.java:1311)&lt;br/&gt;
        at java.lang.System.getProperty(System.java:426)&lt;br/&gt;
        at java.lang.System.getProperty(System.java:410)&lt;br/&gt;
        at org.apache.derby.impl.drda.ClientThread$1.run(ClientThread.java:160)&lt;br/&gt;
        at org.apache.derby.impl.drda.ClientThread$1.run(ClientThread.java:156)&lt;br/&gt;
        at java.security.AccessController.doPrivileged(AccessController.java:274)&lt;br/&gt;
        at org.apache.derby.impl.drda.ClientThread.acceptClientWithRetry(ClientThread.java:155)&lt;br/&gt;
        at org.apache.derby.impl.drda.ClientThread.run(ClientThread.java:63)&lt;br/&gt;
Mon Sep 15 14:38:04 PDT 2014 : Apache Derby Network Server - 10.12.0.0 alpha - (1625092:1625093M) shutdown&lt;br/&gt;
------------&lt;br/&gt;
stack traces for all live threads...&lt;br/&gt;
------------&lt;br/&gt;
        at org.apache.derbyTesting.junit.NetworkServerTestSetup.setUp(NetworkServerTestSetup.java:225)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:20)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:58)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;/p&gt;


&lt;p&gt;Does this seem like an appropriate fix?&lt;/p&gt;</comment>
                            <comment id="14136256" author="myrna" created="Tue, 16 Sep 2014 21:23:39 +0000"  >&lt;p&gt;Attaching a patch that makes the proposed change.&lt;/p&gt;</comment>
                            <comment id="14136593" author="mamtas" created="Wed, 17 Sep 2014 00:54:27 +0000"  >&lt;p&gt;Myrna, the change looks fine to me. Atleast in your specific hand tested case, we are getting more information about the exception rather than just the memory dump. &lt;/p&gt;</comment>
                            <comment id="14136664" author="jira-bot" created="Wed, 17 Sep 2014 02:11:56 +0000"  >&lt;p&gt;Commit 1625453 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=myrna&quot; class=&quot;user-hover&quot; rel=&quot;myrna&quot;&gt;myrna&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1625453&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1625453&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6112&quot; title=&quot;SSL Test (and network server )  can hang if serverSocket.accept() fails for something other than an IOException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6112&quot;&gt;&lt;del&gt;DERBY-6112&lt;/del&gt;&lt;/a&gt;; SSL Test (and network server )  can hang if serverSocket.accept() fails for something other than an IOException&lt;br/&gt;
   Changing the IOException to an Exception will prevent a hang/OOM.&lt;/p&gt;</comment>
                            <comment id="15476563" author="knutanders" created="Fri, 9 Sep 2016 09:52:14 +0000"  >&lt;p&gt;[ Automatically closing all resolved issues that haven&apos;t been updated in more than six months. ]&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12669210" name="DERBY-6112.diff" size="792" author="myrna" created="Tue, 16 Sep 2014 21:23:39 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>318117</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 10 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1iw2v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>318458</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>