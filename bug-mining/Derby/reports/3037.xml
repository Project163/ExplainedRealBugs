<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 14:48:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DERBY-6697] Failures when running tests with JaCoCo</title>
                <link>https://issues.apache.org/jira/browse/DERBY-6697</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Some test cases have been failing in the code coverage tests at &lt;a href=&quot;https://builds.apache.org/job/Derby-JaCoCo/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Derby-JaCoCo/&lt;/a&gt; since Jul 28. The failing tests are:&lt;/p&gt;

&lt;p&gt;org.apache.derbyTesting.functionTests.tests.lang.DBOAccessTest.test_6616&lt;br/&gt;
org.apache.derbyTesting.functionTests.tests.lang.DBOAccessTest$NoAuthorization.test_6616&lt;br/&gt;
org.apache.derbyTesting.unitTests.junit.MissingPermissionsTest.testMissingFilePermission&lt;/p&gt;

&lt;p&gt;The first two fail with the following message: SQLJ.INSTALL_JAR should have succeeded: 46001 Exception while accessing jar file using URL &apos;foo&apos;.&lt;/p&gt;

&lt;p&gt;The last one fails with this stack trace:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;subprocess run failed: :Spawned MPT exitCode=134
STDERR:
java.security.AccessControlException: access denied (&quot;java.io.FilePermission&quot; &quot;/x1/jenkins/jenkins-slave/workspace/Derby-JaCoCo/trunk/junit_20140806_1917&quot; &quot;read&quot;)
	at java.security.AccessControlContext.checkPermission(AccessControlContext.java:372)
	at java.security.AccessController.checkPermission(AccessController.java:559)
	at java.lang.SecurityManager.checkPermission(SecurityManager.java:549)
	at java.lang.SecurityManager.checkRead(SecurityManager.java:888)
	at java.io.File.exists(File.java:770)
	at java.io.File.mkdirs(File.java:1263)
	at org.jacoco.agent.rt.internal_9dd1198.output.FileOutput.startup(FileOutput.java:46)
	at org.jacoco.agent.rt.internal_9dd1198.Agent.startup(Agent.java:126)
	at org.jacoco.agent.rt.internal_9dd1198.Agent.getInstance(Agent.java:56)
	at org.jacoco.agent.rt.internal_9dd1198.PreMain.premain(PreMain.java:45)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at sun.instrument.InstrumentationImpl.loadClassAndStartAgent(InstrumentationImpl.java:382)
	at sun.instrument.InstrumentationImpl.loadClassAndCallPremain(InstrumentationImpl.java:397)
Exception in thread &quot;main&quot; java.lang.reflect.InvocationTargetException
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at sun.instrument.InstrumentationImpl.loadClassAndStartAgent(InstrumentationImpl.java:382)
	at sun.instrument.InstrumentationImpl.loadClassAndCallPremain(InstrumentationImpl.java:397)
Caused by: java.security.AccessControlException: access denied (&quot;java.lang.RuntimePermission&quot; &quot;shutdownHooks&quot;)
	at java.security.AccessControlContext.checkPermission(AccessControlContext.java:372)
	at java.security.AccessController.checkPermission(AccessController.java:559)
	at java.lang.SecurityManager.checkPermission(SecurityManager.java:549)
	at java.lang.Runtime.addShutdownHook(Runtime.java:209)
	at org.jacoco.agent.rt.internal_9dd1198.Agent.getInstance(Agent.java:57)
	at org.jacoco.agent.rt.internal_9dd1198.PreMain.premain(PreMain.java:45)
	... 6 more

STDOUT:
FATAL ERROR in native method: processing of -javaagent failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12732794">DERBY-6697</key>
            <summary>Failures when running tests with JaCoCo</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Fri, 8 Aug 2014 09:23:08 +0000</created>
                <updated>Mon, 11 Aug 2014 18:10:32 +0000</updated>
                            <resolved>Mon, 11 Aug 2014 18:10:32 +0000</resolved>
                                    <version>10.12.1.1</version>
                                    <fixVersion>10.12.1.1</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14090755" author="knutanders" created="Fri, 8 Aug 2014 13:34:58 +0000"  >&lt;p&gt;I couldn&apos;t reproduce this in my environment, where I had JaCoCo version 0.5.7 installed. The Jenkins job uses a newer version (0.6.3). When I upgraded my environment to that version, I could reproduce the failures by running the two tests with the jacoco-junit-single target. I can also reproduce them with the latest JaCoCo version (0.7.1).&lt;/p&gt;</comment>
                            <comment id="14090804" author="knutanders" created="Fri, 8 Aug 2014 14:33:19 +0000"  >&lt;p&gt;MissingPermissionsTest seems to fail because its custom security policy doesn&apos;t grant the permissions JaCoCo requires (the JaCoCo section was not copied from the default test policy).&lt;/p&gt;

&lt;p&gt;DBOAccessTest seems to fail for the opposite reason. The default test policy grants the permissions JaCoCo requires to all code bases when the tests run under JaCoCo. This is too broad, and DBOAccessTest doesn&apos;t get the AccessControlException it expects. Instead, it fails with another exception further down the road.&lt;/p&gt;</comment>
                            <comment id="14092647" author="knutanders" created="Mon, 11 Aug 2014 10:19:52 +0000"  >&lt;p&gt;The failure in MissingPermissionsTest is easily fixed by adding the required permissions to its custom policy file, and adjusting BaseTestCase.execJavaCmd() so that it propagates the jacoco.enabled property that enables the extra permissions if JaCoCo is used.&lt;/p&gt;

&lt;p&gt;For DBOAccessTest I think we would ideally want to change the permissions so that they are only granted to the JaCoCo jar file and not to all code bases. I am not sure if this is possible. My guess is that it was originally done this way because JaCoCo didn&apos;t wrap privileged operations in doPrivileged() calls.&lt;/p&gt;

&lt;p&gt;Even so, there is a small change that can be made to DBOAccessTest so that it passes both with and without JaCoCo. Where this test expects procedure calls to fail with an AccessControlException, it is not essential for the test that they fail exactly that way. Those procedure calls are given dummy arguments, where the point is to check that they don&apos;t fail with an authorization error if authorization is not enabled. Because of the dummy arguments, the calls are expected to fail further down the road after they have passed the authorization check.&lt;/p&gt;

&lt;p&gt;For some of the procedure calls, the expected error further down the road is an AccessControlException because a dummy file name argument points to a directory that derby.jar is not allowed to read from (the current working directory). And the extra permissions granted to all code bases when running with JaCoCo, includes read permission on that directory, so the AccessControlException is not raised when running with JaCoCo.&lt;/p&gt;

&lt;p&gt;By changing those dummy file name arguments to point to a directory that derby.jar is allowed to read even without the extra permissions granted for JaCoCo, we change the expected error from an AccessControlException to file not found or something similar. This way, when we enable the broader permissions required by JaCoCo, it doesn&apos;t change anything for the test, since it is already permitted to read those files.&lt;/p&gt;

&lt;p&gt;The attached patch &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12660969/12660969_d6697-1a.diff&quot; title=&quot;d6697-1a.diff attached to DERBY-6697&quot;&gt;d6697-1a.diff&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; makes the suggested changes. This makes the failing test cases pass in my environment, both with and without JaCoCo.&lt;/p&gt;</comment>
                            <comment id="14092656" author="jira-bot" created="Mon, 11 Aug 2014 10:37:28 +0000"  >&lt;p&gt;Commit 1617240 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knutanders&quot; class=&quot;user-hover&quot; rel=&quot;knutanders&quot;&gt;knutanders&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1617240&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1617240&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6697&quot; title=&quot;Failures when running tests with JaCoCo&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6697&quot;&gt;&lt;del&gt;DERBY-6697&lt;/del&gt;&lt;/a&gt;: Failures when running tests with JaCoCo&lt;/p&gt;

&lt;p&gt;Add permissions needed by JaCoCo to MissingPermissionTest&apos;s custom&lt;br/&gt;
policy file.&lt;/p&gt;

&lt;p&gt;Make BaseTestCase.execJavaCmd() propagate the empty jacoco.active&lt;br/&gt;
property to sub-processes if the tests are running with JaCoCo.&lt;/p&gt;

&lt;p&gt;Adjust dummy arguments given to procedures in DBOAccessTest so that&lt;br/&gt;
they fail with an error that is not affected by the broader&lt;br/&gt;
permissions granted when running with JaCoCo.&lt;/p&gt;</comment>
                            <comment id="14093084" author="knutanders" created="Mon, 11 Aug 2014 18:10:32 +0000"  >&lt;p&gt;The latest build at &lt;a href=&quot;https://builds.apache.org/job/Derby-jacoco/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Derby-jacoco/&lt;/a&gt; was successful. Closing the issue.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12660969" name="d6697-1a.diff" size="9977" author="knutanders" created="Mon, 11 Aug 2014 10:19:52 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10369"><![CDATA[Regression Test Failure]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>410822</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 15 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1yoif:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>410815</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>