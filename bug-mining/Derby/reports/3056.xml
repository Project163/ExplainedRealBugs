<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 14:49:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DERBY-6631] FileMonitor can be used to elevate an application&apos;s privileges</title>
                <link>https://issues.apache.org/jira/browse/DERBY-6631</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Various vulnerabilities in FileMonitor allow applications to perform security-sensitive operations with the elevated privileges granted to Derby:&lt;/p&gt;

&lt;p&gt;getDaemonThread() - The application can call this method in order to create threads, using Derby&apos;s elevated privileges.&lt;/p&gt;

&lt;p&gt;getJVMProperty() -  The application can call this in order to read system properties using Derby&apos;s elevated privileges.&lt;/p&gt;

&lt;p&gt;setThreadPriority() - The application can call this method to change the priority of a daemon thread it has created. This call will execute with Derby&apos;s elevated privileges.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12722814">DERBY-6631</key>
            <summary>FileMonitor can be used to elevate an application&apos;s privileges</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rhillegas">Richard N. Hillegas</reporter>
                        <labels>
                            <label>derby_backport_reject_10_11</label>
                    </labels>
                <created>Fri, 20 Jun 2014 16:38:17 +0000</created>
                <updated>Thu, 2 Oct 2014 22:15:28 +0000</updated>
                            <resolved>Mon, 29 Sep 2014 13:01:21 +0000</resolved>
                                    <version>10.11.1.1</version>
                                    <fixVersion>10.12.1.1</fixVersion>
                                    <component>Services</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14106802" author="knutanders" created="Fri, 22 Aug 2014 12:52:40 +0000"  >&lt;p&gt;getJVMProperty() limits the privileged access to properties whose names start with &quot;derby.&quot;. So at least it doesn&apos;t allow you to read an arbitrary system property with Derby&apos;s privileges. Note also that this helper method is also used (indirectly via PropertyUtil) by the network server in order to read Derby properties (the default server policy does not grant read permission on derby.* properties to derbynet.jar).&lt;/p&gt;</comment>
                            <comment id="14106819" author="knutanders" created="Fri, 22 Aug 2014 13:33:03 +0000"  >&lt;p&gt;Attached is a patch (&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12663654/12663654_d6631-1a-setThreadPriority.diff&quot; title=&quot;d6631-1a-setThreadPriority.diff attached to DERBY-6631&quot;&gt;d6631-1a-setThreadPriority.diff&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;) that makes FileMonitor.setThreadPriority() stop using doPrivileged(). Instead, each caller has to wrap its call to FileMonitor.setThreadPriority() in doPrivileges(). This way, the privileged operation is not exposed publicly.&lt;/p&gt;</comment>
                            <comment id="14109054" author="knutanders" created="Mon, 25 Aug 2014 12:21:35 +0000"  >&lt;p&gt;Attaching &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12664140/12664140_d6631-1b-setThreadPriority.diff&quot; title=&quot;d6631-1b-setThreadPriority.diff attached to DERBY-6631&quot;&gt;d6631-1b-setThreadPriority.diff&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; which adjusts the approach in the 1a patch. The call to Thread.setPriority() is moved out of FileMonitor, since one doesn&apos;t really need the monitor to set the priority. The only thing the monitor was needed for, was to check if the thread was originally created by FileMonitor&apos;s getDaemonThread() method. A new method (isDaemonThread(Thread)) is added to provide that functionality. That method does not perform any privileged operations, so it should be safe to keep it as a public method.&lt;/p&gt;</comment>
                            <comment id="14109435" author="dagw" created="Mon, 25 Aug 2014 18:11:53 +0000"  >&lt;p&gt;Patch 1b looks good to me. +1&lt;/p&gt;</comment>
                            <comment id="14110511" author="jira-bot" created="Tue, 26 Aug 2014 08:54:35 +0000"  >&lt;p&gt;Commit 1620534 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knutanders&quot; class=&quot;user-hover&quot; rel=&quot;knutanders&quot;&gt;knutanders&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1620534&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1620534&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6631&quot; title=&quot;FileMonitor can be used to elevate an application&amp;#39;s privileges&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6631&quot;&gt;&lt;del&gt;DERBY-6631&lt;/del&gt;&lt;/a&gt;: FileMonitor can be used to elevate an application&apos;s privileges&lt;/p&gt;

&lt;p&gt;Don&apos;t elevate privileges in the setThreadPriority() method. Instead, let&lt;br/&gt;
the callers use doPrivileges() themselves.&lt;/p&gt;</comment>
                            <comment id="14110595" author="knutanders" created="Tue, 26 Aug 2014 10:53:13 +0000"  >&lt;p&gt;For the remaining methods (getDaemonThread() and getJVMProperty()), let&apos;s wait and see how &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6648&quot; title=&quot;Application code should not be able to call ContextService.getContextOrNull()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6648&quot;&gt;&lt;del&gt;DERBY-6648&lt;/del&gt;&lt;/a&gt; ends up being solved. We might get some help from the mechanisms introduced there.&lt;/p&gt;</comment>
                            <comment id="14151652" author="rhillegas" created="Mon, 29 Sep 2014 13:00:50 +0000"  >&lt;p&gt;The only way to get your hands on a FileMonitor is to call Monitor.getMonitor() or Monitor.getMonitorLite(). Those methods now require usederbyinternals permission as a result of the work done on &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6648&quot; title=&quot;Application code should not be able to call ContextService.getContextOrNull()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6648&quot;&gt;&lt;del&gt;DERBY-6648&lt;/del&gt;&lt;/a&gt;. All callers of those methods are wrapped by doPrivileged() blocks now. I believe these vulnerabilities have been addressed.&lt;/p&gt;</comment>
                            <comment id="14157135" author="myrna" created="Thu, 2 Oct 2014 20:35:06 +0000"  >&lt;p&gt;It seems to me the change made for this issue (revision 1625960) should not be backported, is that correct?&lt;/p&gt;</comment>
                            <comment id="14157298" author="knutanders" created="Thu, 2 Oct 2014 22:15:28 +0000"  >&lt;p&gt;I don&apos;t think there&apos;s any harm in backporting it, if someone is interested, but I don&apos;t see much value in doing it. Marking the issue as not for backport.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12725352">DERBY-6648</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12663654" name="d6631-1a-setThreadPriority.diff" size="3013" author="knutanders" created="Fri, 22 Aug 2014 13:33:03 +0000"/>
                            <attachment id="12664140" name="d6631-1b-setThreadPriority.diff" size="5014" author="knutanders" created="Mon, 25 Aug 2014 12:21:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10361"><![CDATA[Security]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>401001</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 7 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1x0yf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>401086</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>