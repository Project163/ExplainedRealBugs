<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 14:48:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DERBY-6705] Triggers should not allow MERGE statements that reference temporary tables</title>
                <link>https://issues.apache.org/jira/browse/DERBY-6705</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The reference manual topic on the DECLARE GLOBAL TEMPORARY TABLE statement says: &quot;Temporary tables cannot be referenced in a triggeredSQLStatement or in a WHEN clause&quot;&lt;/p&gt;

&lt;p&gt;Still, a CREATE TRIGGER statement succeeds if the triggered SQL statement is a MERGE statement that references a temporary table:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ij&amp;gt; connect &apos;jdbc:derby:memory:db;create=true&apos;;
ij&amp;gt; declare global temporary table temp (x int) not logged;
0 rows inserted/updated/deleted
ij&amp;gt; create table t1(x int);
0 rows inserted/updated/deleted
ij&amp;gt; create trigger tr after insert on t1 insert into session.temp values 1;
ERROR XCL51: The requested function can not reference tables in SESSION schema.
ij&amp;gt; create trigger tr after insert on t1 merge into session.temp using t1 on session.temp.x=t1.x when matched then delete;
0 rows inserted/updated/deleted
ij&amp;gt; insert into t1 values 1,2,3;
3 rows inserted/updated/deleted
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The second CREATE TRIGGER statement above should have failed the same way as the first.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12734076">DERBY-6705</key>
            <summary>Triggers should not allow MERGE statements that reference temporary tables</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Thu, 14 Aug 2014 14:52:08 +0000</created>
                <updated>Wed, 20 Aug 2014 08:32:56 +0000</updated>
                            <resolved>Wed, 20 Aug 2014 08:32:56 +0000</resolved>
                                    <version>10.11.1.1</version>
                                    <fixVersion>10.11.1.3</fixVersion>
                    <fixVersion>10.12.1.1</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14098419" author="knutanders" created="Fri, 15 Aug 2014 10:22:01 +0000"  >&lt;p&gt;The attached patch &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12662039/12662039_d6705-1a.diff&quot; title=&quot;d6705-1a.diff attached to DERBY-6705&quot;&gt;d6705-1a.diff&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; makes referencesSessionSchema() descend into MergeNode and its children, so that CREATE TRIGGER detects that the temporary table is referenced.&lt;/p&gt;

&lt;p&gt;Strictly speaking, it would be enough for referencesSessionSchema() to inspect the source table and target table of MergeNode, since we don&apos;t support subqueries in the ON clause or the matching clauses yet. I chose to make it inspect those clauses too so that the code is ready for it when support for subqueries is added some time in the future.&lt;/p&gt;

&lt;p&gt;I have started the regression test suite on the patch.&lt;/p&gt;

&lt;p&gt;I guess a more robust and future-proof solution might be to eliminate QTN.referencesSessionSchema() and all its overrides, and instead use a visitor to look for references to the session schema, so that we don&apos;t have to remember to duplicate the visiting logic for every new node type that is added. That would be a bigger change, though.&lt;/p&gt;</comment>
                            <comment id="14098426" author="knutanders" created="Fri, 15 Aug 2014 10:32:07 +0000"  >&lt;p&gt;Regression tests passed.&lt;/p&gt;</comment>
                            <comment id="14098531" author="knutanders" created="Fri, 15 Aug 2014 13:15:30 +0000"  >&lt;p&gt;What I said above about subqueries, wasn&apos;t quite right. Subqueries aren&apos;t supported in matching clauses, but they are supported in the ON clause. The patch &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12662055/12662055_d6705-1b.diff&quot; title=&quot;d6705-1b.diff attached to DERBY-6705&quot;&gt;d6705-1b.diff&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; updates the regression test with a test case for a statement that has an ON clause with a subquery that references a temporary table. No changes outside of the tests from the 1a patch, since the 1a patch had already added code to descend into the ON clause.&lt;/p&gt;</comment>
                            <comment id="14100323" author="jira-bot" created="Mon, 18 Aug 2014 06:17:20 +0000"  >&lt;p&gt;Commit 1618544 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knutanders&quot; class=&quot;user-hover&quot; rel=&quot;knutanders&quot;&gt;knutanders&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1618544&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1618544&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6705&quot; title=&quot;Triggers should not allow MERGE statements that reference temporary tables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6705&quot;&gt;&lt;del&gt;DERBY-6705&lt;/del&gt;&lt;/a&gt;: Triggers should not allow MERGE statements that reference temporary tables&lt;/p&gt;</comment>
                            <comment id="14103612" author="jira-bot" created="Wed, 20 Aug 2014 08:32:00 +0000"  >&lt;p&gt;Commit 1619047 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knutanders&quot; class=&quot;user-hover&quot; rel=&quot;knutanders&quot;&gt;knutanders&lt;/a&gt; in branch &apos;code/branches/10.11&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1619047&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1619047&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6705&quot; title=&quot;Triggers should not allow MERGE statements that reference temporary tables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6705&quot;&gt;&lt;del&gt;DERBY-6705&lt;/del&gt;&lt;/a&gt;: Triggers should not allow MERGE statements that reference temporary tables&lt;/p&gt;

&lt;p&gt;Merged revision 1618544 from trunk.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12671351">DERBY-6357</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12662039" name="d6705-1a.diff" size="6837" author="knutanders" created="Fri, 15 Aug 2014 10:22:01 +0000"/>
                            <attachment id="12662055" name="d6705-1b.diff" size="7131" author="knutanders" created="Fri, 15 Aug 2014 13:15:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>412103</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 14 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1yw8v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>412093</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>