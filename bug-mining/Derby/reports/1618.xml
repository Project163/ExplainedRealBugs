<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 13:58:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DERBY-3878] Replication: stopSlave does not close serversocket when master has crashed.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3878</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The stopSlave command (connection URL attribute) fails to close the ServerSocket when called after master database has crashed. Because of this, the same Derby instance cannot later start a slave on the same port. &lt;/p&gt;

&lt;p&gt;The problem is in ReplicationMessageReceive#tearDown and SocketConnection#tearDown:&lt;/p&gt;

&lt;p&gt;SC#tearDown:&lt;br/&gt;
When objOutputStream is closed, the stream&apos;s flush method is called. Flush throws an exception, and socket.close is not called.&lt;/p&gt;

&lt;p&gt;RMR#tearDown:&lt;br/&gt;
When socketCon.teardown throws an exception, serverSocket.close is not called.&lt;/p&gt;

&lt;p&gt;Suggested fix: add try/catch/finally blocks so that vital code (socket.close and serverSocket.close) is always called.&lt;/p&gt;

&lt;p&gt;Note that the stop slave command can also come from the master (if stopMaster connection URL is called), in which case this bug will not materialize.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12404429">DERBY-3878</key>
            <summary>Replication: stopSlave does not close serversocket when master has crashed.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="jorgenlo">Jorgen Loland</reporter>
                        <labels>
                    </labels>
                <created>Tue, 16 Sep 2008 11:51:27 +0000</created>
                <updated>Wed, 2 Jun 2010 11:12:08 +0000</updated>
                            <resolved>Mon, 27 Oct 2008 13:39:20 +0000</resolved>
                                    <version>10.4.2.0</version>
                                    <fixVersion>10.4.2.1</fixVersion>
                    <fixVersion>10.5.1.1</fixVersion>
                                    <component>Replication</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12631367" author="knutanders" created="Tue, 16 Sep 2008 12:36:02 +0000"  >&lt;p&gt;I tried the fix you suggested (attached as d3878-suggested-fix.diff) and it seems to fix the problem in my environment. Without the fix, I can successfully stop the slave after the master has crashed, but I cannot restart the slave because the port is still in use. With the fix, I can restart the slave on the same port.&lt;/p&gt;</comment>
                            <comment id="12632125" author="kristwaa" created="Thu, 18 Sep 2008 07:32:46 +0000"  >&lt;p&gt;Workaround&lt;br/&gt;
==========&lt;br/&gt;
As posted by J&#248;rgen on derby-user:&lt;br/&gt;
&quot;I think you&apos;ll have to shutdown the slave Derby instance before restarting replication until this bug has been fixed. &quot;&lt;/p&gt;

&lt;p&gt;( &lt;a href=&quot;http://www.nabble.com/Stopping---(Re)Starting-Slave-within-replication-td19496642.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.nabble.com/Stopping---(Re)Starting-Slave-within-replication-td19496642.html&lt;/a&gt; )&lt;/p&gt;</comment>
                            <comment id="12634815" author="knutanders" created="Fri, 26 Sep 2008 11:05:24 +0000"  >&lt;p&gt;Derbyall and suites.All ran cleanly with the suggested fix. I plan to add some comments to the patch and commit it. We should also have a regression test for this bug. I haven&apos;t looked at the replication tests before, so any advice would be appreciated.&lt;/p&gt;</comment>
                            <comment id="12642427" author="knutanders" created="Fri, 24 Oct 2008 09:47:57 +0000"  >&lt;p&gt;Same patch, but with comments added.&lt;/p&gt;</comment>
                            <comment id="12642428" author="knutanders" created="Fri, 24 Oct 2008 09:59:59 +0000"  >&lt;p&gt;Committed d3878-with-comments.diff to trunk with revision 707591.&lt;/p&gt;

&lt;p&gt;I haven&apos;t written regression tests for this bug (haven&apos;t learnt how to use the replication test framework yet). Will file a new issue for adding regression tests before I close this issue.&lt;/p&gt;

&lt;p&gt;I&apos;m leaving the issue open until the fix has been back-ported to the 10.4 branch.&lt;/p&gt;</comment>
                            <comment id="12642914" author="knutanders" created="Mon, 27 Oct 2008 13:39:20 +0000"  >&lt;p&gt;Back-ported to 10.4 with revision 708173.&lt;br/&gt;
I have logged &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3924&quot; title=&quot;Create test for restart of slave after master has crashed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3924&quot;&gt;DERBY-3924&lt;/a&gt; for creating regression tests for this issue.&lt;/p&gt;</comment>
                            <comment id="12874542" author="kristwaa" created="Wed, 2 Jun 2010 11:12:08 +0000"  >&lt;p&gt;Closing issue.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12407277">DERBY-3924</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12390192" name="d3878-suggested-fix.diff" size="1602" author="knutanders" created="Tue, 16 Sep 2008 12:36:02 +0000"/>
                            <attachment id="12392780" name="d3878-with-comments.diff" size="2157" author="knutanders" created="Fri, 24 Oct 2008 09:47:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23894</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10423"><![CDATA[Newcomer]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 26 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i06vmv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38059</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>