<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 14:49:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DERBY-6714] RuntimeInfoTest failed with insufficient data from server</title>
                <link>https://issues.apache.org/jira/browse/DERBY-6714</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Seen in the nightly testing of trunk.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://download.java.net/javadesktop/derby/request_5595117/javadb-task-3919785.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://download.java.net/javadesktop/derby/request_5595117/javadb-task-3919785.html&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.Exception: DRDA_InvalidReplyTooShort.S:Ung&#252;ltige Antwort von Network Server: Daten nicht ausreichend.
	at org.apache.derby.impl.drda.NetworkServerControlImpl.consolePropertyMessageWork(NetworkServerControlImpl.java:3357)
	at org.apache.derby.impl.drda.NetworkServerControlImpl.consolePropertyMessage(NetworkServerControlImpl.java:1988)
	at org.apache.derby.impl.drda.NetworkServerControlImpl.fillReplyBuffer(NetworkServerControlImpl.java:2957)
	at org.apache.derby.impl.drda.NetworkServerControlImpl.readStringReply(NetworkServerControlImpl.java:3010)
	at org.apache.derby.impl.drda.NetworkServerControlImpl.runtimeInfo(NetworkServerControlImpl.java:1443)
	at org.apache.derby.drda.NetworkServerControl.getRuntimeInfo(NetworkServerControl.java:516)
	at org.apache.derbyTesting.functionTests.tests.derbynet.RuntimeInfoTest.x_testRuntimeInfoAfterConnClose(RuntimeInfoTest.java:193)
	at org.apache.derbyTesting.functionTests.tests.derbynet.RuntimeInfoTest.testRunTests(RuntimeInfoTest.java:97)
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:119)
	at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBareOverridable(BaseJDBCTestCase.java:440)
	at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBare(BaseJDBCTestCase.java:457)
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)
	at junit.extensions.TestSetup.run(TestSetup.java:25)
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:58)
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)
	at junit.extensions.TestSetup.run(TestSetup.java:25)
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)
	at junit.extensions.TestSetup.run(TestSetup.java:25)
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:58)
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)
	at junit.extensions.TestSetup.run(TestSetup.java:25)
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)
	at junit.extensions.TestSetup.run(TestSetup.java:25)
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)
	at junit.extensions.TestSetup.run(TestSetup.java:25)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12664352/12664352_derby.log&quot; title=&quot;derby.log attached to DERBY-6714&quot;&gt;derby.log&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; showed that there was a NullPointerException while building the runtimeinfo string:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.NullPointerException
	at org.apache.derby.impl.drda.Database.buildRuntimeInfo(Database.java:417)
	at org.apache.derby.impl.drda.Session.buildRuntimeInfo(Session.java:291)
	at org.apache.derby.impl.drda.DRDAConnThread.buildRuntimeInfo(DRDAConnThread.java:9186)
	at org.apache.derby.impl.drda.NetworkServerControlImpl.buildRuntimeInfo(NetworkServerControlImpl.java:4069)
	at org.apache.derby.impl.drda.NetworkServerControlImpl.getRuntimeInfo(NetworkServerControlImpl.java:2229)
	at org.apache.derby.impl.drda.NetworkServerControlImpl.sendRuntimeInfo(NetworkServerControlImpl.java:2157)
	at org.apache.derby.impl.drda.NetworkServerControlImpl.processCommands(NetworkServerControlImpl.java:1804)
	at org.apache.derby.impl.drda.DRDAConnThread.sessionInitialState(DRDAConnThread.java:665)
	at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java:284)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12736741">DERBY-6714</key>
            <summary>RuntimeInfoTest failed with insufficient data from server</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Tue, 26 Aug 2014 08:19:09 +0000</created>
                <updated>Fri, 9 Sep 2016 09:53:37 +0000</updated>
                            <resolved>Fri, 3 Oct 2014 19:12:37 +0000</resolved>
                                    <version>10.12.1.1</version>
                                    <fixVersion>10.10.2.1</fixVersion>
                    <fixVersion>10.11.1.3</fixVersion>
                    <fixVersion>10.12.1.1</fixVersion>
                                    <component>Network Server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14110505" author="knutanders" created="Tue, 26 Aug 2014 08:50:15 +0000"  >&lt;p&gt;It looks like the NPE on the server happens because the session is being closed while the runtime info is retrieved from it, and stmtTable unexpectedly becomes null. I guess the changes in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6701&quot; title=&quot;Instability in RuntimeInfoTest.x_testRuntimeInfoAfterConnClose&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6701&quot;&gt;&lt;del&gt;DERBY-6701&lt;/del&gt;&lt;/a&gt; made this more likely to happen, since the test now doesn&apos;t sleep before calling getRuntimeInfo() the first time. It should be fixed by making the server more robust against this race condition, though, and not by reintroducing the call to sleep() in the test.&lt;/p&gt;</comment>
                            <comment id="14110620" author="knutanders" created="Tue, 26 Aug 2014 11:34:56 +0000"  >&lt;p&gt;I&apos;m able to reproduce the bug by running Connection.close() followed by NetworkServerControl.getRuntimeInfo() in a tight loop.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        NetworkServerControl control = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; NetworkServerControl();
        control.start(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PrintWriter(&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out));
        &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(2000L); &lt;span class=&quot;code-comment&quot;&gt;// give the server time to start
&lt;/span&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;) {
            DriverManager.getConnection(&lt;span class=&quot;code-quote&quot;&gt;&quot;jdbc:derby:&lt;span class=&quot;code-comment&quot;&gt;//localhost/memory:db;create=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;).close();
&lt;/span&gt;            control.getRuntimeInfo();
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It eventually fails with &quot;Invalid reply from network server: Insufficient data.&quot; and a NullPointerException in derby.log.&lt;/p&gt;</comment>
                            <comment id="14110621" author="knutanders" created="Tue, 26 Aug 2014 11:37:17 +0000"  >&lt;p&gt;I&apos;ve also seen the server fail with the following slightly different NullPointerExceptions:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.NullPointerException
	at org.apache.derby.impl.drda.Session.buildRuntimeInfo(Session.java:291)
	at org.apache.derby.impl.drda.DRDAConnThread.buildRuntimeInfo(DRDAConnThread.java:9186)
	at org.apache.derby.impl.drda.NetworkServerControlImpl.buildRuntimeInfo(NetworkServerControlImpl.java:4069)
	at org.apache.derby.impl.drda.NetworkServerControlImpl.getRuntimeInfo(NetworkServerControlImpl.java:2229)
	at org.apache.derby.impl.drda.NetworkServerControlImpl.sendRuntimeInfo(NetworkServerControlImpl.java:2157)
	at org.apache.derby.impl.drda.NetworkServerControlImpl.processCommands(NetworkServerControlImpl.java:1804)
	at org.apache.derby.impl.drda.DRDAConnThread.sessionInitialState(DRDAConnThread.java:665)
	at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java:284)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.NullPointerException
	at org.apache.derby.impl.drda.DRDAConnThread.buildRuntimeInfo(DRDAConnThread.java:9186)
	at org.apache.derby.impl.drda.NetworkServerControlImpl.buildRuntimeInfo(NetworkServerControlImpl.java:4069)
	at org.apache.derby.impl.drda.NetworkServerControlImpl.getRuntimeInfo(NetworkServerControlImpl.java:2229)
	at org.apache.derby.impl.drda.NetworkServerControlImpl.sendRuntimeInfo(NetworkServerControlImpl.java:2157)
	at org.apache.derby.impl.drda.NetworkServerControlImpl.processCommands(NetworkServerControlImpl.java:1804)
	at org.apache.derby.impl.drda.DRDAConnThread.sessionInitialState(DRDAConnThread.java:665)
	at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java:284)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14110643" author="knutanders" created="Tue, 26 Aug 2014 12:17:03 +0000"  >&lt;p&gt;The attached patch &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12664378/12664378_d6714-1a.diff&quot; title=&quot;d6714-1a.diff attached to DERBY-6714&quot;&gt;d6714-1a.diff&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; fixes the three NPEs I have seen.&lt;/p&gt;

&lt;p&gt;In Database.buildRuntimeInfo() there was no check for stmtTable being null, so such checks were added.&lt;/p&gt;

&lt;p&gt;In DRDAConnThread.buildRuntimeInfo() and Session.buildRuntimeInfo() such checks were in place. However, they worked on fields that could be set to null by another thread between the null check and the actual access of the field. These holes were plugged by creating a local copy of the field, and perform both the null check and the method call on the local copy.&lt;/p&gt;</comment>
                            <comment id="14110663" author="dagw" created="Tue, 26 Aug 2014 12:45:11 +0000"  >&lt;p&gt;Looks good to me. +1 &lt;br/&gt;
Tiny nit to prove I read it &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Missing &quot;and&quot; before &quot;check&quot; in this comment sentence&lt;br/&gt;
&quot;Create a local copy check for null before accessing it.&quot;&lt;/p&gt;</comment>
                            <comment id="14110742" author="jira-bot" created="Tue, 26 Aug 2014 14:23:21 +0000"  >&lt;p&gt;Commit 1620608 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knutanders&quot; class=&quot;user-hover&quot; rel=&quot;knutanders&quot;&gt;knutanders&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1620608&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1620608&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6714&quot; title=&quot;RuntimeInfoTest failed with insufficient data from server&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6714&quot;&gt;&lt;del&gt;DERBY-6714&lt;/del&gt;&lt;/a&gt;: RuntimeInfoTest failed with insufficient data from server&lt;/p&gt;

&lt;p&gt;Tighten up checks for sessions being closed while reading runtime info from&lt;br/&gt;
them, in order to protect against NullPointerExceptions on the server.&lt;/p&gt;</comment>
                            <comment id="14110743" author="knutanders" created="Tue, 26 Aug 2014 14:24:00 +0000"  >&lt;p&gt;Thanks, Dag. I fixed the comment and committed the patch. Resolving the issue.&lt;/p&gt;</comment>
                            <comment id="14155549" author="myrna" created="Wed, 1 Oct 2014 21:17:36 +0000"  >&lt;p&gt;reopen for backport&lt;/p&gt;</comment>
                            <comment id="14155600" author="jira-bot" created="Wed, 1 Oct 2014 21:43:29 +0000"  >&lt;p&gt;Commit 1628842 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=myrna&quot; class=&quot;user-hover&quot; rel=&quot;myrna&quot;&gt;myrna&lt;/a&gt; in branch &apos;code/branches/10.11&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1628842&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1628842&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6714&quot; title=&quot;RuntimeInfoTest failed with insufficient data from server&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6714&quot;&gt;&lt;del&gt;DERBY-6714&lt;/del&gt;&lt;/a&gt;; RuntimeInfoTest failed with insufficient data from server&lt;br/&gt;
  merge of revision 1620608 from trunk.&lt;/p&gt;</comment>
                            <comment id="14157182" author="jira-bot" created="Thu, 2 Oct 2014 21:03:47 +0000"  >&lt;p&gt;Commit 1629069 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=myrna&quot; class=&quot;user-hover&quot; rel=&quot;myrna&quot;&gt;myrna&lt;/a&gt; in branch &apos;code/branches/10.10&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1629069&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1629069&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6714&quot; title=&quot;RuntimeInfoTest failed with insufficient data from server&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6714&quot;&gt;&lt;del&gt;DERBY-6714&lt;/del&gt;&lt;/a&gt;; RuntimeInfoTest failed with insufficient data from server&lt;br/&gt;
  merge of revision 1628842 from 10.11 branch.&lt;/p&gt;</comment>
                            <comment id="14158388" author="myrna" created="Fri, 3 Oct 2014 19:12:37 +0000"  >&lt;p&gt;backport to 10.11 and 10.10 done. I do not intend to bring it back further at this point.&lt;br/&gt;
Resetting to resolved and to original assignee.&lt;/p&gt;</comment>
                            <comment id="15476639" author="knutanders" created="Fri, 9 Sep 2016 09:53:37 +0000"  >&lt;p&gt;[ Automatically closing all resolved issues that haven&apos;t been updated in more than six months. ]&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12732825">DERBY-6701</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12746192">DERBY-6759</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12664378" name="d6714-1a.diff" size="3719" author="knutanders" created="Tue, 26 Aug 2014 12:17:03 +0000"/>
                            <attachment id="12664352" name="derby.log" size="64866" author="knutanders" created="Tue, 26 Aug 2014 08:19:32 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10369"><![CDATA[Regression Test Failure]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 10 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1zbxr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>