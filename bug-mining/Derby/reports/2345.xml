<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 14:26:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DERBY-5280] Large batch of DDL in a database procedure dies on a transaction severity error.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5280</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The batch of DDL run by the procedure which registers database metadata functions now dies with the following error:&lt;/p&gt;

&lt;p&gt;ERROR 40XC0: Dead statement. This may be caused by catching a transaction severity error inside this statement.&lt;/p&gt;

&lt;p&gt;A process of binary search shows that this problem was introduced by revision 1086920 as part of the work on &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5161&quot; title=&quot;Cannot rollback after syntax error in internal statement&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5161&quot;&gt;&lt;del&gt;DERBY-5161&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The bug can be reproduced by compiling the DBMDWrapper class attached to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3973&quot; title=&quot;Create function wrappers for DatabaseMetaData so that you can join metadata results in queries.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3973&quot;&gt;&lt;del&gt;DERBY-3973&lt;/del&gt;&lt;/a&gt; and then running the following script:&lt;/p&gt;

&lt;p&gt;connect &apos;jdbc:derby:memory:db;create=true&apos;; &lt;/p&gt;

&lt;p&gt;create procedure registerPublicStaticMethods( in connectionURL varchar( 200 ), in printSQL boolean )&lt;br/&gt;
language java parameter style java modifies sql data&lt;br/&gt;
external name &apos;DBMDWrapper.registerPublicStaticMethods&apos;;&lt;/p&gt;

&lt;p&gt;call registerPublicStaticMethods( &apos;jdbc:default:connection&apos;, false );&lt;/p&gt;

&lt;p&gt;If you change the second argument to registerPublicStaticMethods to true, then you will see all of the DDL being issued by the database procedure. The procedure runs fine in 10.7 but fails with this error in 10.8.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12510497">DERBY-5280</key>
            <summary>Large batch of DDL in a database procedure dies on a transaction severity error.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="rhillegas">Richard N. Hillegas</reporter>
                        <labels>
                    </labels>
                <created>Wed, 15 Jun 2011 20:52:29 +0000</created>
                <updated>Tue, 25 Oct 2011 17:09:38 +0000</updated>
                            <resolved>Thu, 23 Jun 2011 12:44:27 +0000</resolved>
                                    <version>10.8.1.2</version>
                    <version>10.9.1.0</version>
                                    <fixVersion>10.8.2.2</fixVersion>
                    <fixVersion>10.9.1.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13050469" author="knutanders" created="Thu, 16 Jun 2011 14:53:43 +0000"  >&lt;p&gt;If we don&apos;t find a better solution, it would probably not do much harm to back out the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5161&quot; title=&quot;Cannot rollback after syntax error in internal statement&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5161&quot;&gt;&lt;del&gt;DERBY-5161&lt;/del&gt;&lt;/a&gt;. The problem it&apos;s supposed to fix shouldn&apos;t happen after &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5157&quot; title=&quot;Incomplete quoting of SQL identifiers in AlterTableConstantAction&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5157&quot;&gt;&lt;del&gt;DERBY-5157&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The stored procedure that gets called in the repro ignores many SQLExceptions that happen during normal operation (typically DROP FUNCTION statements that fail because the function doesn&apos;t exist). It looks like the extra cleanup on error that was added in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5161&quot; title=&quot;Cannot rollback after syntax error in internal statement&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5161&quot;&gt;&lt;del&gt;DERBY-5161&lt;/del&gt;&lt;/a&gt; somehow kills the parent statement and not only the statement running inside the stored procedure.&lt;/p&gt;</comment>
                            <comment id="13051200" author="knutanders" created="Fri, 17 Jun 2011 17:09:36 +0000"  >&lt;p&gt;Attached is a JUnit test case that reproduces the bug.&lt;/p&gt;</comment>
                            <comment id="13052575" author="knutanders" created="Tue, 21 Jun 2011 14:05:10 +0000"  >&lt;p&gt;The cleanup in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5161&quot; title=&quot;Cannot rollback after syntax error in internal statement&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5161&quot;&gt;&lt;del&gt;DERBY-5161&lt;/del&gt;&lt;/a&gt; always pops the right statement context, since it specifies explicitly which context to pop. However, there&apos;s a higher-level cleanup that detects statement severity errors and pops the first statement context it finds if there is one. In this case, where we have nested statement contexts, that causes the parent statement context to be popped. I think it&apos;s this higher-level cleanup that&apos;s missing when preparing an internal statement fails and that caused the problem seen in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5161&quot; title=&quot;Cannot rollback after syntax error in internal statement&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5161&quot;&gt;&lt;del&gt;DERBY-5161&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;A proper fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5161&quot; title=&quot;Cannot rollback after syntax error in internal statement&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5161&quot;&gt;&lt;del&gt;DERBY-5161&lt;/del&gt;&lt;/a&gt; might be to get this higher-level cleanup to kick in somehow also for errors when preparing internal statements, or keeping the low-level cleanup added in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5161&quot; title=&quot;Cannot rollback after syntax error in internal statement&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5161&quot;&gt;&lt;del&gt;DERBY-5161&lt;/del&gt;&lt;/a&gt; and making the higher-level detect that cleanup has already happened. However, since &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5161&quot; title=&quot;Cannot rollback after syntax error in internal statement&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5161&quot;&gt;&lt;del&gt;DERBY-5161&lt;/del&gt;&lt;/a&gt; is believed not to be possible after &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5157&quot; title=&quot;Incomplete quoting of SQL identifiers in AlterTableConstantAction&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5157&quot;&gt;&lt;del&gt;DERBY-5157&lt;/del&gt;&lt;/a&gt;, it&apos;s probably safer to just back out the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5161&quot; title=&quot;Cannot rollback after syntax error in internal statement&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5161&quot;&gt;&lt;del&gt;DERBY-5161&lt;/del&gt;&lt;/a&gt; than trying to devise an even more complex fix for something that&apos;s most likely not broken.&lt;/p&gt;</comment>
                            <comment id="13052583" author="rhillegas" created="Tue, 21 Jun 2011 14:14:41 +0000"  >&lt;p&gt;Thanks for looking into this, Knut. +1 to backing out the previous improvement and not over-rotating on a more involved solution at this time. Thanks.&lt;/p&gt;</comment>
                            <comment id="13053742" author="knutanders" created="Thu, 23 Jun 2011 09:28:59 +0000"  >&lt;p&gt;All regression tests ran cleanly with &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5161&quot; title=&quot;Cannot rollback after syntax error in internal statement&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5161&quot;&gt;&lt;del&gt;DERBY-5161&lt;/del&gt;&lt;/a&gt; backed out. Committed to trunk with revision 1138787.&lt;/p&gt;</comment>
                            <comment id="13053822" author="knutanders" created="Thu, 23 Jun 2011 12:44:27 +0000"  >&lt;p&gt;Merged fix to 10.8.&lt;br/&gt;
Committed revision 1138856.&lt;/p&gt;</comment>
                            <comment id="13053828" author="rhillegas" created="Thu, 23 Jun 2011 12:53:56 +0000"  >&lt;p&gt;Thanks for fixing this, Knut. I have verified that the DDMDWrapper registration procedure now runs cleanly. Closing this issue.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12502679">DERBY-5161</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12483568" name="d5280.diff" size="3077" author="knutanders" created="Thu, 23 Jun 2011 09:28:59 +0000"/>
                            <attachment id="12482954" name="junit-repro.diff" size="1939" author="knutanders" created="Fri, 17 Jun 2011 17:09:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10420"><![CDATA[Regression]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24755</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 22 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i06kc7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36229</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>