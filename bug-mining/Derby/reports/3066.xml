<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 14:49:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DERBY-6717] Policies with multiple SystemPermissions are not handled well</title>
                <link>https://issues.apache.org/jira/browse/DERBY-6717</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Rick noted in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6648&quot; title=&quot;Application code should not be able to call ContextService.getContextOrNull()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6648&quot;&gt;&lt;del&gt;DERBY-6648&lt;/del&gt;&lt;/a&gt; that if you wanted to grant both SystemPermission(&quot;engine&quot;, &quot;monitor&quot;) and SystemPermission(&quot;engine&quot;, &quot;usederbyinternals&quot;) to a code base, the following would work:&lt;/p&gt;

&lt;p&gt;permission org.apache.derby.security.SystemPermission &quot;engine&quot;, &quot;monitor,usederbyinternals&quot;;&lt;/p&gt;

&lt;p&gt;However, the following does not work:&lt;/p&gt;

&lt;p&gt;permission org.apache.derby.security.SystemPermission &quot;engine&quot;, &quot;usederbyinternals&quot;;&lt;br/&gt;
permission org.apache.derby.security.SystemPermission &quot;engine&quot;, &quot;monitor&quot;;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12737077">DERBY-6717</key>
            <summary>Policies with multiple SystemPermissions are not handled well</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Wed, 27 Aug 2014 11:36:34 +0000</created>
                <updated>Fri, 9 Sep 2016 09:53:44 +0000</updated>
                            <resolved>Fri, 29 Aug 2014 08:24:51 +0000</resolved>
                                    <version>10.11.1.1</version>
                                    <fixVersion>10.12.1.1</fixVersion>
                                    <component>Services</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14112168" author="knutanders" created="Wed, 27 Aug 2014 11:50:33 +0000"  >&lt;p&gt;SystemPermission extends BasicPermission, which by default ignores the action string. In particular, SystemPermission does not override BasicPermission.newPermissionCollection(). BasicPermission&apos;s implementation of newPermissionCollection() only considers the name of the permission.&lt;/p&gt;

&lt;p&gt;In our example, where the policy contains&lt;/p&gt;

&lt;p&gt;permission org.apache.derby.security.SystemPermission &quot;engine&quot;, &quot;usederbyinternals&quot;;&lt;br/&gt;
permission org.apache.derby.security.SystemPermission &quot;engine&quot;, &quot;monitor&quot;;&lt;/p&gt;

&lt;p&gt;both permission objects have the same name (&quot;engine&quot;), so the collection instance returned by BasicPermission.newPermissionCollection() will consider them the same, and it will only hold keep one of them.&lt;/p&gt;

&lt;p&gt;I believe SystemPermission should override newPermissionCollection(). It should either return a custom PermissionCollection instance with logic specific to SystemPermissions, or null if no custom logic is needed. Probably null would do for now. (Custom logic could for example be wildcard handling.)&lt;/p&gt;</comment>
                            <comment id="14113705" author="knutanders" created="Thu, 28 Aug 2014 12:30:26 +0000"  >&lt;p&gt;It turns out returning null from newPermissionCollection() isn&apos;t a complete solution. It does seem to fix the problem seen in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6648&quot; title=&quot;Application code should not be able to call ContextService.getContextOrNull()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6648&quot;&gt;&lt;del&gt;DERBY-6648&lt;/del&gt;&lt;/a&gt;, but in some other cases it works in a suboptimal way.&lt;/p&gt;

&lt;p&gt;For example:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Permissions perms = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Permissions();
perms.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SystemPermission(&lt;span class=&quot;code-quote&quot;&gt;&quot;engine&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;monitor&quot;&lt;/span&gt;));
perms.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SystemPermission(&lt;span class=&quot;code-quote&quot;&gt;&quot;engine&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;shutdown&quot;&lt;/span&gt;));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Given this collection, one would expect &lt;tt&gt;perms.implies(new SystemPermission(&quot;engine&quot;, &quot;monitor,shutdown&quot;))&lt;/tt&gt; to return &lt;tt&gt;true&lt;/tt&gt;. However, it returns &lt;tt&gt;false&lt;/tt&gt; because none of the individual permissions implies SystemPermission(&quot;engine&quot;, &quot;monitor,shutdown&quot;). A custom PermissionCollection class seems to be needed to handle this case correctly.&lt;/p&gt;

&lt;p&gt;The attached patch &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12664965/12664965_d6717-1a.diff&quot; title=&quot;d6717-1a.diff attached to DERBY-6717&quot;&gt;d6717-1a.diff&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; adds a custom PermissionCollection implementation, and returns an instance of it from SystemPermission.newPermissionCollection(). It also adds unit tests to verify that it works correctly, including negative test cases that verify that collections read from a corrupted serialization stream cannot end up with illegal permissions.&lt;/p&gt;

&lt;p&gt;I&apos;m running the full regression test suite on the patch.&lt;/p&gt;</comment>
                            <comment id="14113749" author="knutanders" created="Thu, 28 Aug 2014 13:33:00 +0000"  >&lt;p&gt;All regression tests passed.&lt;/p&gt;</comment>
                            <comment id="14115001" author="jira-bot" created="Fri, 29 Aug 2014 08:03:01 +0000"  >&lt;p&gt;Commit 1621257 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knutanders&quot; class=&quot;user-hover&quot; rel=&quot;knutanders&quot;&gt;knutanders&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1621257&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1621257&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6717&quot; title=&quot;Policies with multiple SystemPermissions are not handled well&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6717&quot;&gt;&lt;del&gt;DERBY-6717&lt;/del&gt;&lt;/a&gt;: Policies with multiple SystemPermissions are not handled well&lt;/p&gt;

&lt;p&gt;Override newPermissionCollection() and return an instance that is able&lt;br/&gt;
to distinguish between SystemPermissions with the same name and&lt;br/&gt;
different actions. The default implementation in BasicPermission only&lt;br/&gt;
considers the name of the permission.&lt;/p&gt;</comment>
                            <comment id="14115014" author="knutanders" created="Fri, 29 Aug 2014 08:23:57 +0000"  >&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12665294/12665294_d6717-2a-more-tests.diff&quot; title=&quot;d6717-2a-more-tests.diff attached to DERBY-6717&quot;&gt;d6717-2a-more-tests.diff&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; adds more cases to SystemPrivilegesPermissionTest to cover some edges of SystemPermissionCollection.implies() that were not tested before. JaCoCo now reports that all the code added by the 1a patch is covered by SystemPrivilegesPermissionTest.&lt;/p&gt;</comment>
                            <comment id="14115016" author="jira-bot" created="Fri, 29 Aug 2014 08:24:28 +0000"  >&lt;p&gt;Commit 1621260 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knutanders&quot; class=&quot;user-hover&quot; rel=&quot;knutanders&quot;&gt;knutanders&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1621260&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1621260&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6717&quot; title=&quot;Policies with multiple SystemPermissions are not handled well&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6717&quot;&gt;&lt;del&gt;DERBY-6717&lt;/del&gt;&lt;/a&gt;: Policies with multiple SystemPermissions are not handled well&lt;/p&gt;

&lt;p&gt;Extra test cases to improve test coverage.&lt;/p&gt;</comment>
                            <comment id="14157139" author="myrna" created="Thu, 2 Oct 2014 20:39:37 +0000"  >&lt;p&gt;It seems this should not get backported, is that correct?&lt;/p&gt;</comment>
                            <comment id="14157287" author="knutanders" created="Thu, 2 Oct 2014 22:10:03 +0000"  >&lt;p&gt;I think this bug also affects older versions and could be backported if someone is interested.&lt;/p&gt;

&lt;p&gt;The bug description might give the impression that it doesn&apos;t affect older versions, because it mentions the &quot;usederbyinternals&quot; privilege that was added in 10.12. But it could also affect policies that don&apos;t have that privilege. For example, if the policy file grants both SystemPermission(&quot;server&quot;, &quot;monitor&quot;) and SystemPermission(&quot;server&quot;, &quot;shutdown&quot;), it won&apos;t have the desired effect without the fix, and one has to grant SystemPermission(&quot;server&quot;, &quot;monitor,shutdown&quot;) in a single statement instead.&lt;/p&gt;</comment>
                            <comment id="15476648" author="knutanders" created="Fri, 9 Sep 2016 09:53:44 +0000"  >&lt;p&gt;[ Automatically closing all resolved issues that haven&apos;t been updated in more than six months. ]&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12725352">DERBY-6648</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12664965" name="d6717-1a.diff" size="15988" author="knutanders" created="Thu, 28 Aug 2014 12:30:26 +0000"/>
                            <attachment id="12665294" name="d6717-2a-more-tests.diff" size="1797" author="knutanders" created="Fri, 29 Aug 2014 08:23:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 10 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1zdzr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>