<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 14:48:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DERBY-6689] Assert failure/NPE when using ROW_NUMBER in MERGE ... INSERT</title>
                <link>https://issues.apache.org/jira/browse/DERBY-6689</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;sane build:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ij version 10.12
ij&amp;gt; connect &apos;jdbc:derby:memory:db;create=true&apos;;
ij&amp;gt; create table t1(x int);
0 rows inserted/updated/deleted
ij&amp;gt; create table t2(x int);
0 rows inserted/updated/deleted
ij&amp;gt; merge into t1 using t2 on (t1.x=t2.x) when not matched then insert values (row_number() over ());
ERROR XJ001: Java exception: &apos;ASSERT FAILED cannot get interface without operand: org.apache.derby.shared.common.sanity.AssertFailure&apos;.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;insane build:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ij version 10.11
ij&amp;gt; connect &apos;jdbc:derby:memory:db;create=true&apos;;
ij&amp;gt; create table t1(x int);
0 rows inserted/updated/deleted
ij&amp;gt; create table t2(x int);
0 rows inserted/updated/deleted
ij&amp;gt; merge into t1 using t2 on (t1.x=t2.x) when not matched then insert values (row_number() over ());
ERROR XJ001: Java exception: &apos;: java.lang.NullPointerException&apos;.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Full stack trace of the assert failure:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.derby.shared.common.sanity.AssertFailure: ASSERT FAILED cannot get interface without operand
	at org.apache.derby.shared.common.sanity.SanityManager.ASSERT(SanityManager.java:120)
	at org.apache.derby.impl.sql.compile.UnaryOperatorNode.getReceiverInterfaceName(UnaryOperatorNode.java:663)
	at org.apache.derby.impl.sql.compile.UnaryOperatorNode.generateExpression(UnaryOperatorNode.java:622)
	at org.apache.derby.impl.sql.compile.ResultColumn.generateExpression(ResultColumn.java:1061)
	at org.apache.derby.impl.sql.compile.ResultColumnList.generateEvaluatedRow(ResultColumnList.java:1458)
	at org.apache.derby.impl.sql.compile.MatchingClauseNode.generateInsertUpdateRow(MatchingClauseNode.java:1342)
	at org.apache.derby.impl.sql.compile.MatchingClauseNode.generate(MatchingClauseNode.java:1237)
	at org.apache.derby.impl.sql.compile.MergeNode.generate(MergeNode.java:1012)
	at org.apache.derby.impl.sql.compile.StatementNode.generate(StatementNode.java:317)
	at org.apache.derby.impl.sql.GenericStatement.prepMinion(GenericStatement.java:549)
	at org.apache.derby.impl.sql.GenericStatement.prepare(GenericStatement.java:99)
	at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(GenericLanguageConnectionContext.java:1114)
	at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:683)
	at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:631)
	at org.apache.derby.impl.tools.ij.ij.executeImmediate(ij.java:367)
	at org.apache.derby.impl.tools.ij.utilMain.doCatch(utilMain.java:529)
	at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(utilMain.java:371)
	at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:247)
	at org.apache.derby.impl.tools.ij.Main.go(Main.java:229)
	at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:184)
	at org.apache.derby.impl.tools.ij.Main.main(Main.java:75)
	at org.apache.derby.tools.ij.main(ij.java:59)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12732235">DERBY-6689</key>
            <summary>Assert failure/NPE when using ROW_NUMBER in MERGE ... INSERT</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dagw">Dag H. Wanvik</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                            <label>derby_backport_reject_10_10</label>
                    </labels>
                <created>Wed, 6 Aug 2014 07:15:06 +0000</created>
                <updated>Fri, 9 Sep 2016 09:53:19 +0000</updated>
                            <resolved>Thu, 7 Aug 2014 13:49:07 +0000</resolved>
                                                    <fixVersion>10.11.1.1</fixVersion>
                    <fixVersion>10.12.1.1</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14087362" author="knutanders" created="Wed, 6 Aug 2014 07:19:05 +0000"  >&lt;p&gt;I believe the failing statement is not allowed by the standard. See SQL 2011, part 2, 6.10 &amp;lt;window function&amp;gt;, syntax rule 4.&lt;/p&gt;</comment>
                            <comment id="14087940" author="dagw" created="Wed, 6 Aug 2014 17:45:27 +0000"  >&lt;p&gt;Attaching a patch &lt;span class=&quot;error&quot;&gt;&amp;#91;^derby-6689.diff&amp;#93;&lt;/span&gt; which makes this illegal. It adds checking for presence of window functions in the matching clause nodes and throws 42ZC2 is that&apos;s the case. Adds a test case. Running regression of the combo of the latest patch of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6688&quot; title=&quot;NPE (or sane: ASSERT failure) with ROW_NUMBER in some subqueries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6688&quot;&gt;&lt;del&gt;DERBY-6688&lt;/del&gt;&lt;/a&gt; and this.&lt;/p&gt;
</comment>
                            <comment id="14088157" author="jira-bot" created="Wed, 6 Aug 2014 20:05:49 +0000"  >&lt;p&gt;Commit 1616334 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dagw&quot; class=&quot;user-hover&quot; rel=&quot;dagw&quot;&gt;dagw&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1616334&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1616334&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6689&quot; title=&quot;Assert failure/NPE when using ROW_NUMBER in MERGE ... INSERT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6689&quot;&gt;&lt;del&gt;DERBY-6689&lt;/del&gt;&lt;/a&gt; Assert failure/NPE when using ROW_NUMBER in MERGE ... INSERT&lt;/p&gt;

&lt;p&gt;Patch derby-6689. Adds checking for presence of window functions in&lt;br/&gt;
the matching clause nodes and throws 42ZC2 is that&apos;s the case. Adds a&lt;br/&gt;
test case.&lt;/p&gt;</comment>
                            <comment id="14089361" author="jira-bot" created="Thu, 7 Aug 2014 15:49:11 +0000"  >&lt;p&gt;Commit 1616513 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dagw&quot; class=&quot;user-hover&quot; rel=&quot;dagw&quot;&gt;dagw&lt;/a&gt; in branch &apos;code/branches/10.11&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1616513&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1616513&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6689&quot; title=&quot;Assert failure/NPE when using ROW_NUMBER in MERGE ... INSERT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6689&quot;&gt;&lt;del&gt;DERBY-6689&lt;/del&gt;&lt;/a&gt; Assert failure/NPE when using ROW_NUMBER in MERGE ... INSERT&lt;/p&gt;

&lt;p&gt;Backported cleanly from trunk as:&lt;/p&gt;

&lt;p&gt;svn merge -c 1616334 &lt;a href=&quot;https://svn.apache.org/repos/asf/db/derby/code/trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/repos/asf/db/derby/code/trunk&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Patch derby-6689. Adds checking for presence of window functions in&lt;br/&gt;
the matching clause nodes and throws 42ZC2 is that&apos;s the case. Adds a&lt;br/&gt;
test case.&lt;/p&gt;</comment>
                            <comment id="14146994" author="mikem" created="Wed, 24 Sep 2014 22:36:17 +0000"  >&lt;p&gt;merge statement was introduced in 10.11 so fixes for bugs with merge statement should not be backported before 10.11&lt;/p&gt;</comment>
                            <comment id="15476623" author="knutanders" created="Fri, 9 Sep 2016 09:53:19 +0000"  >&lt;p&gt;[ Automatically closing all resolved issues that haven&apos;t been updated in more than six months. ]&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12712555">DERBY-6565</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12381347">DERBY-3155</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12660182" name="foo-6688-6689.diff" size="5433" author="dagw" created="Wed, 6 Aug 2014 17:45:27 +0000"/>
                            <attachment id="12660181" name="foo-6688-6689.stat" size="225" author="dagw" created="Wed, 6 Aug 2014 17:45:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>410264</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 10 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1yl33:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>410254</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>