<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 14:51:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DERBY-853] ResultSetMetaData.getScale returns inconsistent values for DOUBLE type.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-853</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;If a DOUBLE column is returned in the result set then getScale() returns 0.&lt;br/&gt;
If a DOUBLE expression is returned and the expression is the result of a DOUBLE combined with a DECIMAL then it seems the scale from the decimal sometimes affects the result set metadata.&lt;/p&gt;

&lt;p&gt;E.g. DECIMAL(10,2) - DOUBLE returns a DOUBLE with getScale() returning 2.&lt;/p&gt;

&lt;p&gt;See the test output for jdbcapi/metadata.java&lt;/p&gt;

&lt;p&gt;double &amp;#8211; precision: 15 scale: 0 display size: 22 type name: DOUBLE&lt;br/&gt;
double precision - dec(10,2) &amp;#8211; precision: 15 scale: 0 display size: 22 type name: DOUBLE&lt;br/&gt;
dec(10,2) - double precision &amp;#8211; precision: 15 scale: 2 display size: 22 type name: DOUBLE&lt;/p&gt;

&lt;p&gt;First line is a DOUBLE column, second is DOUBLE - DECIMAL, third is DECIMAL - DOUBLE&lt;/p&gt;

&lt;p&gt;I assume the scale  should always be zero for a DOUBLE, as it holds no meaning, but I can&apos;t see any proof of that in JDBC spec, javadoc or tutorial book.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12327925">DERBY-853</key>
            <summary>ResultSetMetaData.getScale returns inconsistent values for DOUBLE type.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="5" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Trivial</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="Dnj">Danoja Dias</assignee>
                                    <reporter username="djd">Daniel John Debrunner</reporter>
                        <labels>
                            <label>derby_triage10_5_2</label>
                    </labels>
                <created>Sat, 21 Jan 2006 04:28:57 +0000</created>
                <updated>Thu, 4 Aug 2016 02:26:23 +0000</updated>
                            <resolved>Thu, 4 Aug 2016 02:26:23 +0000</resolved>
                                    <version>10.2.1.6</version>
                                    <fixVersion>10.13.1.0</fixVersion>
                                    <component>JDBC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="12733688" author="rhillegas" created="Tue, 21 Jul 2009 16:15:35 +0000"  >&lt;p&gt;Triaged for 10.5.3: assigne normal urgency.&lt;/p&gt;</comment>
                            <comment id="13540568" author="knutanders" created="Fri, 28 Dec 2012 19:31:40 +0000"  >&lt;p&gt;Attaching Derby853.java which reproduces the problem. It subtracts a DOUBLE from a DECIMAL(10,2) and prints the scale and the type name of the result. On trunk, it prints:&lt;/p&gt;

&lt;p&gt;scale: 2&lt;br/&gt;
type: DOUBLE&lt;/p&gt;</comment>
                            <comment id="15400746" author="dnj" created="Sat, 30 Jul 2016 17:15:39 +0000"  >&lt;p&gt;I think the problem happens in getScale() method in NumericTypeCompiler.java . &lt;/p&gt;

&lt;p&gt;In this method, getStoredFormatIdFromTypeId() is not equal to Decimal it returns&lt;br/&gt;
the scale value of leftType.&lt;/p&gt;</comment>
                            <comment id="15401011" author="dnj" created="Sun, 31 Jul 2016 07:08:39 +0000"  >&lt;p&gt;I attached a patch. Could you please give me any comments about this patch.&lt;/p&gt;

&lt;p&gt;thanks.&lt;/p&gt;</comment>
                            <comment id="15401217" author="bryanpendleton" created="Sun, 31 Jul 2016 16:05:14 +0000"  >&lt;p&gt;It seems like a good approach &amp;#8211; did it fix the Derby853.java test?&lt;/p&gt;

&lt;p&gt;I think you are right that the problem is that we are using &apos;leftType&apos;,&lt;br/&gt;
which isn&apos;t correct in this case, because the type precedence rules&lt;br/&gt;
mean that at line 258 we have noticed that combining a DECIMAL and a&lt;br/&gt;
DOUBLE means we have a result of DOUBLE.&lt;/p&gt;

&lt;p&gt;I wonder if there is a way to fix this somewhere near line 258 instead,&lt;br/&gt;
because it seems like at line 258 we shouldn&apos;t even be calling the&lt;br/&gt;
getScale() method if higherType is not a DECIMAL type, so maybe that&lt;br/&gt;
call get getScale() should be inside the &quot;if&quot; test at line 260?&lt;/p&gt;

&lt;p&gt;bryan&lt;/p&gt;</comment>
                            <comment id="15401242" author="dnj" created="Sun, 31 Jul 2016 17:01:13 +0000"  >&lt;blockquote&gt;&lt;p&gt;did it fix the Derby853.java test?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes. It fixed Derby853.java test.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I wonder if there is a way to fix this somewhere near line 258 instead,&lt;br/&gt;
because it seems like at line 258 we shouldn&apos;t even be calling the&lt;br/&gt;
getScale() method if higherType is not a DECIMAL type, so maybe that&lt;br/&gt;
call get getScale() should be inside the &quot;if&quot; test at line 260?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes. We shouldn&apos;t call getScale() is it is not decimal. &lt;br/&gt;
I&apos;ll check it and attach a new patch.&lt;/p&gt;</comment>
                            <comment id="15401387" author="dnj" created="Sun, 31 Jul 2016 22:48:39 +0000"  >&lt;p&gt;I attached doing changes. This patch also passes the test in Derby853.java&lt;/p&gt;</comment>
                            <comment id="15401556" author="dnj" created="Mon, 1 Aug 2016 05:49:02 +0000"  >&lt;p&gt;All tests are clean with this patch&lt;/p&gt;</comment>
                            <comment id="15402119" author="bryanpendleton" created="Mon, 1 Aug 2016 14:29:36 +0000"  >&lt;p&gt;Which test suite do you think would be a good place to add the test&lt;br/&gt;
cases from the Derby853.java code?&lt;/p&gt;</comment>
                            <comment id="15402150" author="dnj" created="Mon, 1 Aug 2016 14:47:07 +0000"  >&lt;p&gt;I think this suits for&lt;br/&gt;
java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/ResultSetMiscTest.java&lt;/p&gt;

&lt;p&gt;I&apos;ll add it with a new method.&lt;/p&gt;</comment>
                            <comment id="15404446" author="dnj" created="Tue, 2 Aug 2016 17:35:14 +0000"  >&lt;p&gt;This patch adds the tests to test this bug.&lt;/p&gt;

&lt;p&gt;This patch touches&lt;br/&gt;
M       java/engine/org/apache/derby/impl/sql/compile/NumericTypeCompiler.java&lt;br/&gt;
M       java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/ResultSetMiscTest.java&lt;/p&gt;</comment>
                            <comment id="15405244" author="bryanpendleton" created="Wed, 3 Aug 2016 03:20:42 +0000"  >&lt;p&gt;Hi Danoja,&lt;/p&gt;

&lt;p&gt;I was wondering if you could look at a slight variation on your patch,&lt;br/&gt;
which I have attached as &quot;BryanPossibleIdea.diff&quot;.&lt;/p&gt;

&lt;p&gt;It is very similar to your patch, with two differences:&lt;/p&gt;

&lt;p&gt;1) If the higher-precedence type isn&apos;t DECIMAL, I changed it to&lt;br/&gt;
simply set the scale to 0. I don&apos;t think it matters terribly much whether&lt;br/&gt;
the alternate type is DOUBLE, or BIGINT, or any other type; if it&apos;s&lt;br/&gt;
not DECIMAL, the scale should be 0.&lt;/p&gt;

&lt;p&gt;2) I also added a test of getPrecision to the test case that you&lt;br/&gt;
added to confirm that, whichever order the arguments are in&lt;br/&gt;
the test case, the precision still comes back 15. I didn&apos;t discover&lt;br/&gt;
any new problem; I just added the additional assertion on getPrecision&lt;/p&gt;

&lt;p&gt;What do you think about this idea?&lt;/p&gt;

&lt;p&gt;For me, it passes your new test case, and it also passes all&lt;br/&gt;
the existing test suites.&lt;/p&gt;

&lt;p&gt;thanks,&lt;/p&gt;

&lt;p&gt;bryan&lt;/p&gt;</comment>
                            <comment id="15405293" author="dnj" created="Wed, 3 Aug 2016 04:39:15 +0000"  >&lt;p&gt;Hi Bryan,&lt;/p&gt;

&lt;p&gt;I think since scale of all other types(that are supported for operations like &quot;-&quot;) should be 0, this is a simple and good approach.&lt;/p&gt;

&lt;p&gt;thanks.&lt;/p&gt;</comment>
                            <comment id="15406849" author="dnj" created="Wed, 3 Aug 2016 23:55:08 +0000"  >&lt;p&gt;All test are clean in my system too.&lt;/p&gt;</comment>
                            <comment id="15406955" author="jira-bot" created="Thu, 4 Aug 2016 01:29:03 +0000"  >&lt;p&gt;Commit 1755133 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bryanpendleton&quot; class=&quot;user-hover&quot; rel=&quot;bryanpendleton&quot;&gt;bryanpendleton&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1755133&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1755133&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-853&quot; title=&quot;ResultSetMetaData.getScale returns inconsistent values for DOUBLE type.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-853&quot;&gt;&lt;del&gt;DERBY-853&lt;/del&gt;&lt;/a&gt;: ResultSetMetaData.getScale returns inconsistent values&lt;/p&gt;

&lt;p&gt;This patch was contributed by Danoja Dias (danojadias at gmail dot com)&lt;/p&gt;

&lt;p&gt;When a SQL statement contains arithmetic expressions, the result of the&lt;br/&gt;
expression may be of a different type than the operands to the expression,&lt;br/&gt;
due to type precedence rules which may require promoting the operand&lt;br/&gt;
values during evaluation of the expression.&lt;/p&gt;

&lt;p&gt;For example, subtracting a DOUBLE from a DECIMAL results in a DOUBLE.&lt;/p&gt;

&lt;p&gt;In some of these cases, Derby was reporting that the result column&lt;br/&gt;
had a non-zero scale, although the result column was not of DECIMAL type.&lt;/p&gt;

&lt;p&gt;This change modifies the NumericTypeCompiler so that it only computes&lt;br/&gt;
a non-zero scale for the result column when it is of DECIMAL type.&lt;/p&gt;</comment>
                            <comment id="15407008" author="dnj" created="Thu, 4 Aug 2016 02:20:40 +0000"  >&lt;p&gt;I think, we can resolve this issue.&lt;/p&gt;</comment>
                            <comment id="15407016" author="bryanpendleton" created="Thu, 4 Aug 2016 02:26:23 +0000"  >&lt;p&gt;We&apos;ve completed all the planned work for this issue. Marking fixed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12939001">DERBY-6870</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12821760" name="BryanPossibleIdea.diff" size="2427" author="bryanpendleton" created="Wed, 3 Aug 2016 03:20:42 +0000"/>
                            <attachment id="12821203" name="Derby-853.diff" size="662" author="Dnj" created="Sun, 31 Jul 2016 07:08:39 +0000"/>
                            <attachment id="12821236" name="Derby-853_2.diff" size="1572" author="Dnj" created="Sun, 31 Jul 2016 22:48:39 +0000"/>
                            <attachment id="12821656" name="Derby-853_3.diff" size="2819" author="Dnj" created="Tue, 2 Aug 2016 17:35:14 +0000"/>
                            <attachment id="12562601" name="Derby853.java" size="754" author="knutanders" created="Fri, 28 Dec 2012 19:31:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22174</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10423"><![CDATA[Newcomer]]></customfieldvalue>
    <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 15 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i06obz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36876</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>