<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 14:50:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DERBY-6864] RawDBReaderTest fails on Windows</title>
                <link>https://issues.apache.org/jira/browse/DERBY-6864</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;RawDBReaderTest fails on Windows with the following output:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;.&amp;lt;assertDirectoryDeleted&amp;gt; attempt 1 left 2 files/dirs behind: 0=extinout\recovery.sql 1=extinout
&amp;lt;assertDirectoryDeleted&amp;gt; attempt 2 left 2 files/dirs behind: 0=extinout\recovery.sql 1=extinout
&amp;lt;assertDirectoryDeleted&amp;gt; attempt 3 left 2 files/dirs behind: 0=extinout\recovery.sql 1=extinout
&amp;lt;assertDirectoryDeleted&amp;gt; attempt 4 left 2 files/dirs behind: 0=extinout\recovery.sql 1=extinout
F
Time: 39,498
There was 1 failure:
1) RawDBReaderTest:embeddedjunit.framework.AssertionFailedError: Failed to delete 2 files (root=C:\cygwin64\tmp\derbytst\extinout): C:\cygwin64\tmp\derbytst\extinout\recovery.sql (isDir=false, canRead=true, canWrite=true, size=801), C:\cygwin64\tmp\derbytst\extinout (isDir=true, canRead=true, canWrite=true, size=0)
        at org.apache.derbyTesting.junit.BaseTestCase.assertDirectoryDeleted(BaseTestCase.java:1125)
        at org.apache.derbyTesting.junit.DropDatabaseSetup.removeDirectory(DropDatabaseSetup.java:128)
        at org.apache.derbyTesting.junit.DropDatabaseSetup.removeDirectory(DropDatabaseSetup.java:118)
        at org.apache.derbyTesting.junit.SupportFilesSetup.tearDown(SupportFilesSetup.java:130)
        at junit.extensions.TestSetup$1.protect(TestSetup.java:24)
        at junit.extensions.TestSetup.run(TestSetup.java:27)

FAILURES!!!
Tests run: 1,  Failures: 1,  Errors: 0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>Windows 10&lt;br/&gt;
JDK 8u71&lt;br/&gt;
Derby trunk revision 1728254</environment>
        <key id="12936406">DERBY-6864</key>
            <summary>RawDBReaderTest fails on Windows</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Wed, 3 Feb 2016 17:56:50 +0000</created>
                <updated>Thu, 4 Feb 2016 20:09:08 +0000</updated>
                            <resolved>Thu, 4 Feb 2016 20:09:08 +0000</resolved>
                                    <version>10.13.1.0</version>
                                    <fixVersion>10.13.1.0</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15131070" author="knutanders" created="Wed, 3 Feb 2016 20:28:42 +0000"  >&lt;p&gt;The problem is that RawDBReaderTest.runRecoveryScript() opens a FileReader that reads the recovery.sql script, but it doesn&apos;t close it. Windows doesn&apos;t allow deletion of open files, so tearDown() fails when trying to clean up the test directory.&lt;/p&gt;

&lt;p&gt;Attaching a patch which fixes the problem by opening the FileReader in a try-with-resources statement, which automatically closes the reader when it goes out of scope. The patch also removes the use of LineNumberReader in the method and instead makes it use a plain BufferedReader, since it didn&apos;t use any of the extra functionality provided by LineNumberReader.&lt;/p&gt;</comment>
                            <comment id="15131082" author="jira-bot" created="Wed, 3 Feb 2016 20:36:04 +0000"  >&lt;p&gt;Commit 1728370 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knutanders&quot; class=&quot;user-hover&quot; rel=&quot;knutanders&quot;&gt;knutanders&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1728370&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1728370&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6864&quot; title=&quot;RawDBReaderTest fails on Windows&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6864&quot;&gt;&lt;del&gt;DERBY-6864&lt;/del&gt;&lt;/a&gt;: RawDBReaderTest fails on Windows&lt;/p&gt;

&lt;p&gt;RawDBReaderTest.runRecoveryScript() opens a FileReader, but doesn&apos;t&lt;br/&gt;
close it. When the test harness tries to delete the test directory&lt;br/&gt;
upon completion of the test, it fails because one of the files in the&lt;br/&gt;
directory is still open.&lt;/p&gt;

&lt;p&gt;This patch makes runRecoveryScript() open the FileReader in a&lt;br/&gt;
try-with-resources statement, so that it is automatically closed when&lt;br/&gt;
it goes out of scope.&lt;/p&gt;</comment>
                            <comment id="15131982" author="knutanders" created="Thu, 4 Feb 2016 08:58:06 +0000"  >&lt;p&gt;Hmm... This fixed the issue in my environment, but it still fails in continuous integration tests on Windows:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;junit.framework.AssertionFailedError
	at org.apache.derbyTesting.functionTests.tests.lang.RawDBReaderTest.tearDown(RawDBReaderTest.java:156)
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:120)
	at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBareOverridable(BaseJDBCTestCase.java:443)
	at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBare(BaseJDBCTestCase.java:460)
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)
	at junit.extensions.TestSetup.run(TestSetup.java:25)
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)
	at junit.extensions.TestSetup.run(TestSetup.java:25)
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:58)
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)
	at junit.extensions.TestSetup.run(TestSetup.java:25)
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)
	at junit.extensions.TestSetup.run(TestSetup.java:25)
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:58)
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)
	at junit.extensions.TestSetup.run(TestSetup.java:25)
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:58)
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)
	at junit.extensions.TestSetup.run(TestSetup.java:25)
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)
	at junit.extensions.TestSetup.run(TestSetup.java:25)
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)
	at junit.extensions.TestSetup.run(TestSetup.java:25)
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)
	at junit.extensions.TestSetup.run(TestSetup.java:25)
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:58)
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)
	at junit.extensions.TestSetup.run(TestSetup.java:25)
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)
	at junit.extensions.TestSetup.run(TestSetup.java:25)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It&apos;s still a problem with deleting files, but there&apos;s no information about which files, because the tearDown() method of the test is simply asserting on the return value of File.delete().&lt;/p&gt;

&lt;p&gt;I&apos;ll change it so that it uses BaseTestCase.assertDirectoryDeleted() instead. It provides some extra debug information when it fails.&lt;/p&gt;</comment>
                            <comment id="15131992" author="jira-bot" created="Thu, 4 Feb 2016 09:06:31 +0000"  >&lt;p&gt;Commit 1728426 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knutanders&quot; class=&quot;user-hover&quot; rel=&quot;knutanders&quot;&gt;knutanders&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1728426&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1728426&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6864&quot; title=&quot;RawDBReaderTest fails on Windows&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6864&quot;&gt;&lt;del&gt;DERBY-6864&lt;/del&gt;&lt;/a&gt;: RawDBReaderTest fails on Windows&lt;/p&gt;

&lt;p&gt;Use BaseTestCase.assertDirectoryDeleted() instead of File.delete()&lt;br/&gt;
to delete the db directory, so that we get more information if the&lt;br/&gt;
directory cannot be deleted.&lt;/p&gt;</comment>
                            <comment id="15132247" author="knutanders" created="Thu, 4 Feb 2016 12:35:28 +0000"  >&lt;p&gt;After making the tearDown() method use assertDirectoryDeleted(), the test fails with the following error message:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;junit.framework.AssertionFailedError: Failed to delete 2 files (root=d:\tendril4\work\run\28679745\junit\system\dbsqlauth): d:\tendril4\work\run\28679745\junit\system\dbsqlauth\service.properties (isDir=false, canRead=true, canWrite=true, size=1218), d:\tendril4\work\run\28679745\junit\system\dbsqlauth (isDir=true, canRead=true, canWrite=true, size=4096)
	at org.apache.derbyTesting.junit.BaseTestCase.assertDirectoryDeleted(BaseTestCase.java:1125)
	at org.apache.derbyTesting.functionTests.tests.lang.RawDBReaderTest.tearDown(RawDBReaderTest.java:156)
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:120)
	at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBareOverridable(BaseJDBCTestCase.java:443)
	at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBare(BaseJDBCTestCase.java:460)
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15132262" author="knutanders" created="Thu, 4 Feb 2016 12:58:43 +0000"  >&lt;p&gt;Attaching d6864-2.diff which makes DataFileVTI close the stream it uses for reading from service.properties. Hopefully this is sufficient to get the test to pass again.&lt;/p&gt;</comment>
                            <comment id="15132263" author="jira-bot" created="Thu, 4 Feb 2016 12:59:34 +0000"  >&lt;p&gt;Commit 1728459 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knutanders&quot; class=&quot;user-hover&quot; rel=&quot;knutanders&quot;&gt;knutanders&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1728459&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1728459&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6864&quot; title=&quot;RawDBReaderTest fails on Windows&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6864&quot;&gt;&lt;del&gt;DERBY-6864&lt;/del&gt;&lt;/a&gt;: RawDBReaderTest fails on Windows&lt;/p&gt;

&lt;p&gt;DataFileVTI.makeDecryptionEngine() opens a stream that reads from&lt;br/&gt;
service.properties, but it never closes the stream. This prevents the&lt;br/&gt;
file from being deleted later. This patch makes it open the stream in&lt;br/&gt;
a try-with-resources statement so that it gets closed automatically.&lt;/p&gt;</comment>
                            <comment id="15132926" author="knutanders" created="Thu, 4 Feb 2016 20:09:08 +0000"  >&lt;p&gt;The test seems to pass now. Closing.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12786250" name="d6864-2.diff" size="4049" author="knutanders" created="Thu, 4 Feb 2016 12:58:43 +0000"/>
                            <attachment id="12786092" name="d6864.diff" size="2932" author="knutanders" created="Wed, 3 Feb 2016 20:28:42 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10369"><![CDATA[Regression Test Failure]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 41 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2sd9j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>