<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 14:50:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DERBY-6828] Network Server don&apos;t start in czech localized enviroment due missing key DRDA_MissingNetworkJar.S</title>
                <link>https://issues.apache.org/jira/browse/DERBY-6828</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Network Server don&apos;t start in czech localized enviroment due missing key DRDA_MissingNetworkJar.S in file org/apache/derby/loc/drda/messages_cs.properties&lt;/p&gt;

&lt;p&gt;Exception:&lt;br/&gt;
Thu Jul 23 15:56:24 CEST 2015 : null&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
        at org.apache.derby.iapi.tools.i18n.LocalizedResource.getTextMessage(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.drda.NetworkServerControlImpl.localizeMessage(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.drda.NetworkServerControlImpl.localizeMessage(Unknown Source)&lt;br/&gt;
        at org.apache.derby.drda.NetworkServerControl.installSecurityManager(Unknown Source)&lt;br/&gt;
        at org.apache.derby.drda.NetworkServerControl.main(Unknown Source)&lt;/p&gt;


&lt;p&gt;Missing key is called in file org.apache.derby.drda.NetworkServerControl.java at line 818.&lt;/p&gt;

&lt;p&gt;Reproduce under windows in console run:&lt;br/&gt;
set DERBY_OPTS=-Duser.language=cs&lt;br/&gt;
startNetworkServer.bat&lt;/p&gt;

&lt;p&gt;Workaround:&lt;br/&gt;
Run derby server under en localization.&lt;br/&gt;
Windows consola run:&lt;br/&gt;
set DERBY_OPTS=-Duser.language=en&lt;br/&gt;
startNetworkServer.bat&lt;/p&gt;</description>
                <environment>Windows 7 Profesional SP1 64bit (localized CS),&lt;br/&gt;
java version &amp;quot;1.8.0_51&amp;quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.8.0_51-b16)&lt;br/&gt;
Java HotSpot(TM) 64-Bit Server VM (build 25.51-b03, mixed mode)&lt;br/&gt;
</environment>
        <key id="12848579">DERBY-6828</key>
            <summary>Network Server don&apos;t start in czech localized enviroment due missing key DRDA_MissingNetworkJar.S</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bryanpendleton">Bryan Pendleton</assignee>
                                    <reporter username="david.jezek">David Je&#382;ek</reporter>
                        <labels>
                            <label>easyfix</label>
                    </labels>
                <created>Thu, 23 Jul 2015 14:16:16 +0000</created>
                <updated>Fri, 9 Sep 2016 09:53:10 +0000</updated>
                            <resolved>Mon, 22 Feb 2016 01:29:28 +0000</resolved>
                                    <version>10.11.1.1</version>
                                    <fixVersion>10.13.1.0</fixVersion>
                                    <component>Localization</component>
                    <component>Network Server</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15143697" author="jsvelta" created="Thu, 11 Feb 2016 23:31:34 +0000"  >&lt;p&gt;It is not possible to start Java DB network server on machine with czech locale. This is not a minor bug but critical bug. You shuld use default english message if localized one cannot be found.&lt;/p&gt;</comment>
                            <comment id="15143874" author="rhillegas" created="Fri, 12 Feb 2016 01:51:14 +0000"  >&lt;p&gt;That is the way that Derby is supposed to work: use English message if a localized variant isn&apos;t available. When you set the locale to English, what error do you see? It appears to be some error encountered while installing a SecurityManager. Thanks.&lt;/p&gt;</comment>
                            <comment id="15143875" author="bryanpendleton" created="Fri, 12 Feb 2016 01:51:23 +0000"  >&lt;p&gt;I have not (yet) succeeded in getting the NPE, but my Network Server definitely&lt;br/&gt;
fails to start if I use -Duser.language=cs:&lt;/p&gt;

&lt;p&gt;    java -Duser.language=cs -cp derbyrun.jar org.apache.derby.drda.NetworkServerControl start&lt;/p&gt;

&lt;p&gt;It just immediately returns back to the command prompt, while if I take off the&lt;br/&gt;
-Duser.language=cs, the Network Server starts fine.&lt;/p&gt;</comment>
                            <comment id="15144246" author="jsvelta" created="Fri, 12 Feb 2016 08:10:12 +0000"  >&lt;p&gt;I cannot use english locale. I run derby from Netbeans and there is no way to set env variables.&lt;/p&gt;</comment>
                            <comment id="15144249" author="jsvelta" created="Fri, 12 Feb 2016 08:13:12 +0000"  >&lt;p&gt;To reproduce use this command&lt;/p&gt;

&lt;p&gt;set &quot;DERBY_OPTS=-Duser.language=cs -Dderby.drda.debug=true&quot; &lt;br/&gt;
startNetworkServer.bat&lt;/p&gt;</comment>
                            <comment id="15144261" author="knutanders" created="Fri, 12 Feb 2016 08:33:03 +0000"  >&lt;p&gt;Looks like it&apos;s the message printed when the security manager is successfully installed. Here:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-comment&quot;&gt;// Report success.
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (securityManager.equals(&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.getSecurityManager())) {
            &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; successMessage = server.localizeMessage(
                    &lt;span class=&quot;code-quote&quot;&gt;&quot;DRDA_SecurityInstalled.I&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Notice that the second argument to localizeMessage() is &lt;tt&gt;null&lt;/tt&gt;. It is passed further down to LocalizedResource.getTextMessage():&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getTextMessage(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; key, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;... objectArr) {
		&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (res == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;){
			setResource();
		}
			&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;{
				&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; MessageFormat.format(res.getString(key), objectArr);
			} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
					&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; tmpFormat = key;
					&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i=0; i&amp;lt;objectArr.length; i++)
						tmpFormat = tmpFormat + &lt;span class=&quot;code-quote&quot;&gt;&quot;, &amp;lt;{&quot;&lt;/span&gt; + (i) + &lt;span class=&quot;code-quote&quot;&gt;&quot;}&amp;gt;&quot;&lt;/span&gt;;
					&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; MessageFormat.format(tmpFormat, objectArr);
			}
	}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here, an exception is raised because it cannot find the key in the Czech translation. However, the exception handler does not expect &lt;tt&gt;objectArr&lt;/tt&gt; to be &lt;tt&gt;null&lt;/tt&gt;, and a &lt;tt&gt;NullPointerException&lt;/tt&gt; is raised.&lt;/p&gt;</comment>
                            <comment id="15144661" author="bryanpendleton" created="Fri, 12 Feb 2016 14:54:40 +0000"  >&lt;p&gt;Thanks, Knut Anders, that makes a lot of sense.&lt;/p&gt;

&lt;p&gt;It suggests that the solution might be as simple as the&lt;br/&gt;
attached &apos;nullGuard.diff&apos;.&lt;/p&gt;

&lt;p&gt;Unfortunately, I&apos;m still not able to reproduce the problem&lt;br/&gt;
in my environment. I&apos;ll keep trying, but if anyone else&lt;br/&gt;
is able to reproduce the problem, and can test that&lt;br/&gt;
diff, that would be very helpful.&lt;/p&gt;</comment>
                            <comment id="15144688" author="knutanders" created="Fri, 12 Feb 2016 15:19:11 +0000"  >&lt;p&gt;Hi Bryan,&lt;/p&gt;

&lt;p&gt;Your patch fixes the immediate problem. Before your patch:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ java -Duser.language=cs -Dderby.drda.debug=true -jar /code/derby/trunk/jars/sane/derbynet.jar start
Fri Feb 12 16:03:52 CET 2016 : null
java.lang.NullPointerException
	at org.apache.derby.iapi.tools.i18n.LocalizedResource.getTextMessage(LocalizedResource.java:293)
	at org.apache.derby.impl.drda.NetworkServerControlImpl.localizeMessage(NetworkServerControlImpl.java:3625)
	at org.apache.derby.impl.drda.NetworkServerControlImpl.localizeMessage(NetworkServerControlImpl.java:3597)
	at org.apache.derby.drda.NetworkServerControl.installSecurityManager(NetworkServerControl.java:706)
	at org.apache.derby.drda.NetworkServerControl.main(NetworkServerControl.java:344)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After your patch:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ java -Duser.language=cs -Dderby.drda.debug=true -jar /code/derby/trunk/jars/sane/derbynet.jar start
Fri Feb 12 16:04:39 CET 2016 : DRDA_SecurityInstalled.I
total memory: 502792192 free: 495416760 Fri Feb 12 16:04:39 CET 2016
total memory: 502792192 free: 494413880 Fri Feb 12 16:04:39 CET 2016
Fri Feb 12 16:04:39 CET 2016 : S&#237;&#357;ov&#253; server Apache Derby - 10.13.0.0 alpha - (Unversioned directory): spu&#353;t&#283;n a p&#345;ipraven p&#345;ij&#237;mat p&#345;ipojen&#237; na portu 1527 v {3} 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think there are more problems, though:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Why did the server crash silently if the derby.drda.debug flag wasn&apos;t set? I think it should have printed the NPE in that case too.&lt;/li&gt;
	&lt;li&gt;When a localized message is not available, shouldn&apos;t it have printed the English message, rather than the key?&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="15145716" author="bryanpendleton" created="Sat, 13 Feb 2016 02:11:26 +0000"  >&lt;p&gt;The silence when derby.drda.debug is fall is apparently by design, &lt;br/&gt;
witness this code in NetworkServerControlImpl.java:&lt;/p&gt;

&lt;p&gt;    /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Write an exception to console output stream,&lt;/li&gt;
	&lt;li&gt;but only if debugOutput is true.&lt;br/&gt;
     *&lt;/li&gt;
	&lt;li&gt;@param e exception&lt;br/&gt;
     */&lt;br/&gt;
    public void consoleExceptionPrint(Exception e)
    {
        if (debugOutput == true)
            consoleExceptionPrintTrace(e);

        return;
    }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;We get to consoleExceptionPrint from the master exception handler in&lt;br/&gt;
NetworkServerControl.main:&lt;/p&gt;

&lt;p&gt;            //if there was an error, exit(1)&lt;br/&gt;
            if ((e.getMessage() == null) ||&lt;br/&gt;
                !e.getMessage().equals(NetworkServerControlImpl.UNEXPECTED_ERR) ||&lt;br/&gt;
                printErrors&lt;br/&gt;
            )&lt;/p&gt;
            {
                if (server != null)
                    server.consoleExceptionPrint(e);
                else
                    e.printStackTrace();  // default output stream is System.out
            }
&lt;p&gt;            // else, we&apos;ve already printed a trace, so just exit.&lt;br/&gt;
            System.exit(1);&lt;/p&gt;

&lt;p&gt;So although I agree with you that this is frustrating behavior, it&apos;s not new behavior.&lt;/p&gt;

&lt;p&gt;Your other question is very interesting too, but I have to study it some more.&lt;/p&gt;</comment>
                            <comment id="15145730" author="bryanpendleton" created="Sat, 13 Feb 2016 02:35:06 +0000"  >&lt;p&gt;In LocalizedResource.getResource, we appear to be expecting the call:&lt;/p&gt;

&lt;p&gt;    res = ResourceBundle.getBundle(messageFileName,locale);&lt;/p&gt;

&lt;p&gt;to throw an exception, in the case where&lt;br/&gt;
 messageFileName=&quot;org.apache.derby.loc.drda.messages&quot; and locale=cs_US&lt;br/&gt;
in which case we&apos;d catch that exception and fall back to:&lt;/p&gt;

&lt;p&gt;    res = ResourceBundle.getBundle(messageFileName,Locale.ENGLISH);&lt;/p&gt;

&lt;p&gt;But the first call &lt;b&gt;doesn&apos;t&lt;/b&gt; throw an exception; instead we get a valid&lt;br/&gt;
PropertyResourceBundle back. Unfortunately, when we try to use that&lt;br/&gt;
PropertyResourceBundle as follows:&lt;/p&gt;

&lt;p&gt;    return MessageFormat.format(res.getString(key), objectArr);&lt;/p&gt;

&lt;p&gt;we fail with:&lt;/p&gt;

&lt;p&gt;java.util.MissingResourceException: Can&apos;t find resource for bundle java.util.PropertyResourceBundle, key DRDA_SecurityInstalled.I&lt;br/&gt;
        at java.util.ResourceBundle.getObject(ResourceBundle.java:450)&lt;br/&gt;
        at java.util.ResourceBundle.getString(ResourceBundle.java:407)&lt;br/&gt;
        at org.apache.derby.iapi.tools.i18n.LocalizedResource.getTextMessage(LocalizedResource.java:297)&lt;br/&gt;
        at org.apache.derby.impl.drda.NetworkServerControlImpl.localizeMessage(NetworkServerControlImpl.java:3625)&lt;br/&gt;
        at org.apache.derby.impl.drda.NetworkServerControlImpl.localizeMessage(NetworkServerControlImpl.java:3597)&lt;br/&gt;
        at org.apache.derby.drda.NetworkServerControl.installSecurityManager(NetworkServerControl.java:706)&lt;br/&gt;
        at org.apache.derby.drda.NetworkServerControl.main(NetworkServerControl.java:344)&lt;/p&gt;
</comment>
                            <comment id="15145740" author="bryanpendleton" created="Sat, 13 Feb 2016 02:57:34 +0000"  >&lt;p&gt;Even though the first patch doesn&apos;t fix all the problems, it still seems like&lt;br/&gt;
a solid improvement over the current behavior, so if passes tests I intend to&lt;br/&gt;
commit it.&lt;/p&gt;</comment>
                            <comment id="15146004" author="rhillegas" created="Sat, 13 Feb 2016 14:51:17 +0000"  >&lt;p&gt;+1 to the improvement&lt;/p&gt;</comment>
                            <comment id="15146063" author="bryanpendleton" created="Sat, 13 Feb 2016 17:10:27 +0000"  >&lt;p&gt;The code in LocalizedResource.setResource to fall back to&lt;br/&gt;
English if the desired ResourceBundle cannot be found is&lt;br/&gt;
original code, present in the original code import in revision 37083.&lt;/p&gt;

&lt;p&gt;So there aren&apos;t any clues in the Subversion history about what&lt;br/&gt;
might be causing the fallback to English to fail, but it certainly&lt;br/&gt;
doesn&apos;t appear to have been a recent change.&lt;/p&gt;

&lt;p&gt;Similarly, the for-loop code in LocalizedResource.getTextMessage that&lt;br/&gt;
assumes that objectArr is non-null is also original code, and unchanged&lt;br/&gt;
since the original import. However, revision 1495023 did change&lt;br/&gt;
the signature of getTextMessage:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public String getTextMessage(String key, Object [] objectArr) {&lt;br/&gt;
+    public String getTextMessage(String key, Object... objectArr) {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The code that added the following bit to the NetworkServerControl&lt;/p&gt;

&lt;p&gt;+        //&lt;br/&gt;
+        // Report success.&lt;br/&gt;
+        //&lt;br/&gt;
+        String  successMessage = server.localizeMessage( &quot;DRDA_SecurityInstalled.I&quot;, null );&lt;/p&gt;

&lt;p&gt;was revision 506751.&lt;/p&gt;

&lt;p&gt;So perhaps this problem has been present since 506751, but we didn&apos;t notice.&lt;/p&gt;

&lt;p&gt;I&apos;m afraid I didn&apos;t find any solid clues about how to further pursue the&lt;br/&gt;
fallback-to-English behavior problems, but I don&apos;t want to let the perfect&lt;br/&gt;
be the enemy of the good. Perhaps we could enter that as a different issue?&lt;/p&gt;</comment>
                            <comment id="15146066" author="jira-bot" created="Sat, 13 Feb 2016 17:15:23 +0000"  >&lt;p&gt;Commit 1730254 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bryanpendleton&quot; class=&quot;user-hover&quot; rel=&quot;bryanpendleton&quot;&gt;bryanpendleton&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1730254&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1730254&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6828&quot; title=&quot;Network Server don&amp;#39;t start in czech localized enviroment due missing key DRDA_MissingNetworkJar.S&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6828&quot;&gt;&lt;del&gt;DERBY-6828&lt;/del&gt;&lt;/a&gt;: Network Server fails to start in Czech locale.&lt;/p&gt;

&lt;p&gt;LocalizedResource.getTextMessage has special exception-handling behavior&lt;br/&gt;
for situations where the chosen ResourceBundle does not contain the&lt;br/&gt;
message key that we are trying to format.&lt;/p&gt;

&lt;p&gt;The exception handler simply displays the message key, together with&lt;br/&gt;
any arguments to the message.&lt;/p&gt;

&lt;p&gt;But some messages have no arguments, for example the message&lt;br/&gt;
DRDA_SecurityInstalled.I has no arguments, and so NetworkServerControl&lt;br/&gt;
passes a null set of arguments when displaying that message.&lt;/p&gt;

&lt;p&gt;Therefore, LocalizedResource.getTextMessage needs to include a null&lt;br/&gt;
guard, so that its exception handler doesn&apos;t trip over the non-existent&lt;br/&gt;
arguments and crash with a NullPointerException.&lt;/p&gt;</comment>
                            <comment id="15147046" author="knutanders" created="Mon, 15 Feb 2016 08:20:59 +0000"  >&lt;p&gt;Agreed. Allowing the server to start is a good step forward. Thanks for fixing this.&lt;/p&gt;</comment>
                            <comment id="15147110" author="jsvelta" created="Mon, 15 Feb 2016 09:28:45 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;I&apos;ll be waiting for this fixed version in jdk distribution &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I hope it will be this year &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15147742" author="knutanders" created="Mon, 15 Feb 2016 19:48:50 +0000"  >&lt;p&gt;Jaroslav, I wouldn&apos;t count on it...&lt;br/&gt;
&lt;a href=&quot;https://blogs.oracle.com/java-platform-group/entry/deferring_to_derby_in_jdk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://blogs.oracle.com/java-platform-group/entry/deferring_to_derby_in_jdk&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15147759" author="knutanders" created="Mon, 15 Feb 2016 20:16:12 +0000"  >&lt;p&gt;As to the missing fallback to English for the messages that lack translation, issuing &lt;tt&gt;svn rename java/drda/org/apache/derby/loc/drda/messages_en.properties java/drda/org/apache/derby/loc/drda/messages.properties&lt;/tt&gt; and rebuilding seems to fix it for me:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ java -Dderby.ui.locale=cs -jar /code/derby/trunk/jars/sane/derbynet.jar start 
Mon Feb 15 20:41:17 CET 2016 : Security manager installed using the Basic server security policy.
Mon Feb 15 20:41:17 CET 2016 : S&#237;&#357;ov&#253; server Apache Derby - 10.13.0.0 alpha - (Unversioned directory): spu&#353;t&#283;n a p&#345;ipraven p&#345;ij&#237;mat p&#345;ipojen&#237; na portu 1527 v {3} 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If your locale is cs_CZ, ResourceBundle will look for the message in messages_cs_CZ.properties. If it is not found there, it will try with a less specific locale and look for it in messages_cs.properties. If it is not found there either, it will try with an even less specific locale and look for it in messages.properties. If we move the English messages from messages_en.properties to messages.properties, they will become fallback for messages that lack translation to the requested locale.&lt;/p&gt;

&lt;p&gt;The tools messages are already structured like this. There is a toolsmessages.properties, but not a toolsmessages_en.properties. Since both the tools messages and the drda messages are localized using LocalizedResource, I think it makes sense if the message files are structured the same way.&lt;/p&gt;

&lt;p&gt;The engine messages don&apos;t go through LocalizedResource, so they have a different mechanism for falling back to English (using MessageService). We could probably copy that logic into LocalizedResource. But since we can get this functionality for free from java.util.ResourceBundle by renaming a file, I don&apos;t see much value in copying the code.&lt;/p&gt;</comment>
                            <comment id="15149617" author="bryanpendleton" created="Wed, 17 Feb 2016 00:58:21 +0000"  >&lt;p&gt;That seems like a very practical approach. As you observe, we already follow this convention,&lt;br/&gt;
so extending it seems reasonable. And it seems like a simple and incremental change which&lt;br/&gt;
makes good progress.&lt;/p&gt;

&lt;p&gt;Unless you&apos;re already doing so, I&apos;ll look into implementing this approach for the DRDA messages&lt;br/&gt;
as you suggest, running some tests, and moving forward with this plan if I don&apos;t encounter&lt;br/&gt;
any problems.&lt;/p&gt;</comment>
                            <comment id="15149919" author="bryanpendleton" created="Wed, 17 Feb 2016 05:36:28 +0000"  >&lt;p&gt;I confirmed that renaming the properties file causes the missing message key&lt;br/&gt;
to be printed using the English translation. I also ran a full regression test run&lt;br/&gt;
with the renamed properties file and did not encounter any problems.&lt;/p&gt;</comment>
                            <comment id="15150107" author="knutanders" created="Wed, 17 Feb 2016 08:24:17 +0000"  >&lt;p&gt;Thanks for testing the approach, Bryan. +1 to commit.&lt;/p&gt;

&lt;p&gt;(Later, we may consider doing something similar for the servlet messages and the engine messages, and delete the code that manually falls back to English messages. But not as part of this bug, I think. The servlet messages use LocalizedResource and probably suffer from the same problems as the drda messages. I&apos;m not so worried about the servlet messages, though, as we document that it&apos;s only for testing - &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5653&quot; title=&quot;We should document that the NetServlet is a testing tool and not appropriate for production use.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5653&quot;&gt;&lt;del&gt;DERBY-5653&lt;/del&gt;&lt;/a&gt;.)&lt;/p&gt;</comment>
                            <comment id="15150573" author="jira-bot" created="Wed, 17 Feb 2016 14:34:16 +0000"  >&lt;p&gt;Commit 1730839 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bryanpendleton&quot; class=&quot;user-hover&quot; rel=&quot;bryanpendleton&quot;&gt;bryanpendleton&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1730839&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1730839&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6828&quot; title=&quot;Network Server don&amp;#39;t start in czech localized enviroment due missing key DRDA_MissingNetworkJar.S&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6828&quot;&gt;&lt;del&gt;DERBY-6828&lt;/del&gt;&lt;/a&gt;: Network Server fails to start in Czech locale.&lt;/p&gt;

&lt;p&gt;This change modifies the drda message properties filename so that it&lt;br/&gt;
works more elegantly with the LocalizedResource utility class, and with&lt;br/&gt;
the underlying JDK ResourceBundle class on which it is based.&lt;/p&gt;

&lt;p&gt;If your locale is cs_CZ, ResourceBundle will look for the message in&lt;br/&gt;
messages_cs_CZ.properties. If it is not found there, it will try&lt;br/&gt;
with a less specific locale and look for it in messages_cs.properties.&lt;/p&gt;

&lt;p&gt;If it is not found there either, it will try with an even less specific&lt;br/&gt;
locale and look for it in messages.properties. If we move the English&lt;br/&gt;
messages from messages_en.properties to messages.properties, they will&lt;br/&gt;
become fallback for messages that lack translation to the requested locale.&lt;/p&gt;

&lt;p&gt;The tools messages are already structured like this. There is a&lt;br/&gt;
toolsmessages.properties, but not a toolsmessages_en.properties.&lt;/p&gt;

&lt;p&gt;The engine messages don&apos;t go through LocalizedResource; they have a&lt;br/&gt;
different mechanism for falling back to English (using MessageService).&lt;/p&gt;

&lt;p&gt;It would be best if we had a single approach for Derby message property&lt;br/&gt;
files. However, messages processed by MessageService use a different&lt;br/&gt;
naming convention than messages processed by LocalizedResource, so for&lt;br/&gt;
the time being it seems the best approach is to rename the drda messages&lt;br/&gt;
to follow the LocalizedResource naming convention.&lt;/p&gt;</comment>
                            <comment id="15155688" author="bryanpendleton" created="Sat, 20 Feb 2016 16:57:43 +0000"  >&lt;p&gt;Have we adequately addressed this issue? I filed &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6871&quot; title=&quot;Handle message properties in a uniform style&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6871&quot;&gt;DERBY-6871&lt;/a&gt; to track&lt;br/&gt;
the suggestion that perhaps we don&apos;t need both the LocalizedResource&lt;br/&gt;
and MessageService approaches to handling language/locale fallback.&lt;br/&gt;
I propose to mark this issue resolved.&lt;/p&gt;</comment>
                            <comment id="15156278" author="rhillegas" created="Sun, 21 Feb 2016 23:09:56 +0000"  >&lt;p&gt;I think that this issue can be resolved now that you have logged derby-6871. Thanks.&lt;/p&gt;</comment>
                            <comment id="15156352" author="bryanpendleton" created="Mon, 22 Feb 2016 01:29:29 +0000"  >&lt;p&gt;We&apos;ve completed the planned work, and filed other issues for the outstanding future items.&lt;/p&gt;</comment>
                            <comment id="15476615" author="knutanders" created="Fri, 9 Sep 2016 09:53:08 +0000"  >&lt;p&gt;[ Automatically closing all resolved issues that haven&apos;t been updated in more than six months. ]&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12787670" name="nullGuard.diff" size="692" author="bryanpendleton" created="Fri, 12 Feb 2016 14:54:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10365"><![CDATA[Crash]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10426"><![CDATA[Known fix]]></customfieldvalue>
    <customfieldvalue key="10427"><![CDATA[Workaround attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 10 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2hucf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10053"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>