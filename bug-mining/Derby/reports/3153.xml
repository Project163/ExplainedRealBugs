<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 14:51:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DERBY-6726] NPE from trigger</title>
                <link>https://issues.apache.org/jira/browse/DERBY-6726</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Saw this strange exception when doing an insert to a table with a trigger&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Tue Sep 02 13:39:09 BST 2014 &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[SQLExecution,1,system] (XID = 62693), (SESSIONID = 1), (DATABASE = C:/Users/timbo/Documents/IJCProjects/mini-regs/Vanilla Oracle/.config/derby-minireg-01-sep/db), (DRDAID = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;), Failed Statement is: UPDATE samples SET sample_code = &lt;span class=&quot;code-quote&quot;&gt;&apos;S123456&apos;&lt;/span&gt; WHERE sample_id = CAST (org.apache.derby.iapi.db.Factory::getTriggerExecutionContext().getNewRow().getObject(1) AS INTEGER)
java.lang.NullPointerException
    at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getTriggerActionString(Unknown Source)
    at org.apache.derby.iapi.sql.dictionary.TriggerDescriptor.getActionSPS(Unknown Source)
    at org.apache.derby.impl.sql.execute.GenericTriggerExecutor.getAction(Unknown Source)
    at org.apache.derby.impl.sql.execute.RowTriggerExecutor.fireTrigger(Unknown Source)
    at org.apache.derby.impl.sql.execute.TriggerEventActivator.notifyEvent(Unknown Source)
    at org.apache.derby.impl.sql.execute.UpdateResultSet.fireAfterTriggers(Unknown Source)
    at org.apache.derby.impl.sql.execute.UpdateResultSet.open(Unknown Source)
    at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(Unknown Source)
    at org.apache.derby.impl.sql.GenericPreparedStatement.executeSubStatement(Unknown Source)
    at org.apache.derby.impl.sql.execute.GenericTriggerExecutor.executeSPS(Unknown Source)
    at org.apache.derby.impl.sql.execute.RowTriggerExecutor.fireTrigger(Unknown Source)
    at org.apache.derby.impl.sql.execute.TriggerEventActivator.notifyEvent(Unknown Source)
    at org.apache.derby.impl.sql.execute.InsertResultSet.normalInsertCore(Unknown Source)
    at org.apache.derby.impl.sql.execute.InsertResultSet.open(Unknown Source)
    at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(Unknown Source)
    at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source)
    at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source)
    at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source)
    at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The trigger definition is this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;CREATE TRIGGER samples_code_trg
AFTER INSERT ON samples
REFERENCING NEW AS newrow FOR EACH ROW MODE DB2SQL
UPDATE samples SET sample_code = &lt;span class=&quot;code-quote&quot;&gt;&apos;S123456&apos;&lt;/span&gt;
WHERE samples.sample_id = newrow.sample_id;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As mentioned here: &lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/db-derby-user/201408.mbox/%3Cltq5hl$kps$1@ger.gmane.org%3E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://mail-archives.apache.org/mod_mbox/db-derby-user/201408.mbox/%3Cltq5hl$kps$1@ger.gmane.org%3E&lt;/a&gt;&lt;br/&gt;
it could be that its caused by another AFTER UPDATE trigger that&apos;s on the table.&lt;/p&gt;

&lt;p&gt;Unfortunately I rebuilt all the tables and triggers and not the problem doesn&apos;t happen, so I can&apos;t provide a test case.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12738827">DERBY-6726</key>
            <summary>NPE from trigger</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bryanpendleton">Bryan Pendleton</assignee>
                                    <reporter username="tdudgeon">Tim Dudgeon</reporter>
                        <labels>
                    </labels>
                <created>Wed, 3 Sep 2014 15:40:10 +0000</created>
                <updated>Sat, 16 Sep 2017 19:50:02 +0000</updated>
                            <resolved>Sun, 2 Oct 2016 17:05:51 +0000</resolved>
                                    <version>10.10.1.1</version>
                                    <fixVersion>10.12.1.2</fixVersion>
                    <fixVersion>10.13.1.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14120563" author="dagw" created="Wed, 3 Sep 2014 22:10:43 +0000"  >&lt;p&gt;Working from the DDL shown, I have not been able to reproduce this on trunk yet.&lt;/p&gt;</comment>
                            <comment id="15528170" author="bruehlicke" created="Wed, 28 Sep 2016 02:38:53 +0000"  >&lt;p&gt;Just had similar stack trace when using derby 10.8.1.2 or newer. Works fine with 10.7.1.1 or below.  Fails on an UPDATE trigger. I am working on a test app to reproduce the error.&lt;/p&gt;
</comment>
                            <comment id="15530550" author="bruehlicke" created="Wed, 28 Sep 2016 19:01:25 +0000"  >&lt;p&gt;NetBeans 8.2RC project with a single JUnit test showing this error when using 10.8.1.2.  Replacing the jars with 10.7.1.1 will make the code working. Using any version higher than 10.8 will also fail.&lt;/p&gt;</comment>
                            <comment id="15530551" author="bruehlicke" created="Wed, 28 Sep 2016 19:01:37 +0000"  >&lt;p&gt;I was able to crystallize out the code causing the error in a JUNIT 4 test. Attached a NetBeans 8.2RC project with all setup causing the error. The README.txt file also tells how to make the error go away, i.e. which lines in the code causing it.&lt;/p&gt;

&lt;p&gt;I hope this will help to find the problem. The code was tested with JDK 1.8.0_102 64 bit.&lt;/p&gt;</comment>
                            <comment id="15530553" author="bruehlicke" created="Wed, 28 Sep 2016 19:02:13 +0000"  >&lt;p&gt;The Netbeans project is is the file &quot;derbytrig.zip&quot;&lt;/p&gt;</comment>
                            <comment id="15531575" author="bryanpendleton" created="Thu, 29 Sep 2016 02:28:56 +0000"  >&lt;p&gt;Thank you for the test case. It reproduces the problem for me!&lt;/p&gt;

&lt;p&gt;Attached &apos;TriggerTest.diff&apos; is your same test case (I believe),&lt;br/&gt;
edited into the format used by the Derby regression test suites.&lt;/p&gt;

&lt;p&gt;When I run the modified TriggerTest on the current Derby trunk, I get:&lt;/p&gt;

&lt;p&gt;Caused by: java.lang.NullPointerException&lt;br/&gt;
	at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.examineTriggerNodeAndCols(DataDictionaryImpl.java:4773)&lt;br/&gt;
	at org.apache.derby.iapi.sql.dictionary.TriggerDescriptor.getSPS(TriggerDescriptor.java:407)&lt;br/&gt;
	at org.apache.derby.iapi.sql.dictionary.TriggerDescriptor.getActionSPS(TriggerDescriptor.java:339)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.GenericTriggerExecutor.getAction(GenericTriggerExecutor.java:120)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.GenericTriggerExecutor.executeWhenClauseAndAction(GenericTriggerExecutor.java:346)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.RowTriggerExecutor.fireTrigger(RowTriggerExecutor.java:113)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.TriggerEventActivator.notifyEvent(TriggerEventActivator.java:272)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.UpdateResultSet.fireAfterTriggers(UpdateResultSet.java:870)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.UpdateResultSet.open(UpdateResultSet.java:289)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:472)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericPreparedStatement.executeSubStatement(GenericPreparedStatement.java:338)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.GenericTriggerExecutor.executeSPS(GenericTriggerExecutor.java:216)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.GenericTriggerExecutor.executeWhenClauseAndAction(GenericTriggerExecutor.java:346)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.RowTriggerExecutor.fireTrigger(RowTriggerExecutor.java:113)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.TriggerEventActivator.notifyEvent(TriggerEventActivator.java:272)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.UpdateResultSet.fireAfterTriggers(UpdateResultSet.java:870)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.UpdateResultSet.open(UpdateResultSet.java:289)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:472)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:351)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1339)&lt;/p&gt;</comment>
                            <comment id="15532846" author="bruehlicke" created="Thu, 29 Sep 2016 13:58:23 +0000"  >&lt;p&gt;Super ! Thanx, it is always great to hear if a problem can be reproduced. This stack trace I get using 10.12.1.1. When using 10.8.1.2 - 10.11.1.1 a get a slightly different and with 10.7.1.1 and lower version, all works perfect without any error.&lt;/p&gt;</comment>
                            <comment id="15533985" author="bruehlicke" created="Thu, 29 Sep 2016 20:39:18 +0000"  >&lt;p&gt;Trying to understand more on this and going through the Derby code, it looks to me that the initial guess of &quot;it could be that its caused by another AFTER UPDATE trigger that&apos;s on the table.&quot;  could be a guess in the right direction. In the test I provided there are 2 AFTER UPDATE triggers - both on the same table. Disabling any of them makes the code work - but having both make the code fail.&lt;/p&gt;
</comment>
                            <comment id="15534805" author="bryanpendleton" created="Fri, 30 Sep 2016 02:34:51 +0000"  >&lt;p&gt;That seems like a very important insight, thanks. It seems to me that this&lt;br/&gt;
indicates that the TriggerEventActivator is possibly the important class&lt;br/&gt;
to investigate, as that appears to be the frame in the call stack where&lt;br/&gt;
the different triggers are being tracked, ordered, and scheduled for execution.&lt;/p&gt;</comment>
                            <comment id="15536087" author="bruehlicke" created="Fri, 30 Sep 2016 14:02:40 +0000"  >&lt;p&gt;I have tracked down the problem,&lt;/p&gt;

&lt;p&gt;First I was comparing sources changes between 7.1.1 and 8.1.2 to reduce amount of source to be checked and as I know it worked in 7.1.1. and failed in 8.1.2.  GenericTriggerExecutor, RowTriggerExecutor. TriggerEventActivator, UpdateResultSet and GenericPreparedStatement where the same - so no problem should be in those.&lt;/p&gt;

&lt;p&gt;The problem happens in :   iapi/sql/dictionary/TriggerDescriptor in the method getActionSPS.  (In 12.1.1. this is getSPS).&lt;/p&gt;

&lt;p&gt;In 8.1.2 code was added to the method as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4874&quot; title=&quot;Trigger does not recognize new size of VARCHAR column  expanded with ALTER TABLE. It fails with ERROR 22001: A truncation error was encountered trying to shrink VARCHAR &quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4874&quot;&gt;&lt;del&gt;DERBY-4874&lt;/del&gt;&lt;/a&gt;. When I comment out this extra code in the 8.1.2 code base - the Test works !  I do not currently understand what this extra code is doing, but it is for sure the culprit of the problem.&lt;/p&gt;

&lt;p&gt;Now looking at the 12.1.1 code we have the same or similar code in TriggerDescriptor.getSPS(...). Again, commenting out the addition made for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4874&quot; title=&quot;Trigger does not recognize new size of VARCHAR column  expanded with ALTER TABLE. It fails with ERROR 22001: A truncation error was encountered trying to shrink VARCHAR &quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4874&quot;&gt;&lt;del&gt;DERBY-4874&lt;/del&gt;&lt;/a&gt; and just have it do the same as back in the 7.1.1 days - the code works also on 12.1.1&lt;/p&gt;

&lt;p&gt;I will try to understand what the getSPS(..) is trying to do and why it falls over having a double set of AFTER UPDATE triggers, but maybe someone closer to the code can help with ideas as the problem is now pinned down to a few lines of source.&lt;/p&gt;



&lt;p&gt;I will now go into the 12.1.1 code base and try to understand the logic here &lt;/p&gt;</comment>
                            <comment id="15536466" author="bruehlicke" created="Fri, 30 Sep 2016 16:56:16 +0000"  >&lt;p&gt;Looks like the rabbit hole goes deeper ... looks like the core of the problem is hidden way deeper but hard to pin down not knowing the code. I debugged the test and found that the TriggerEventActivator seem to do its job correctly. It finds both triggers and executes both after each other. Going up the stack trace it become more blurry. I will try to debug, below what I have found so far ... maybe someone has a light bulb going on after seeing this ... for me it is still deep darkness what is going on.&lt;/p&gt;

&lt;p&gt;TriggerDescriptor.getSPS fails because the TableDescriptor is null&lt;br/&gt;
    it worked in 7.1.1 as no TableDescriptor was needed&lt;/p&gt;

&lt;p&gt;TriggerEventActivator correctly identified both triggers as eventNumber = 5 with i=0 the first trigger and i=2 the second.&lt;br/&gt;
   .notifyEvent(..) line 272 though calls the fireTrigger with &quot;colsReadFromTable&quot; which is null and which should contain the columns required from the Trigger Table&lt;/p&gt;


&lt;p&gt;UpdateResultSet.fireAfterTriggers() calls the TriggerEventActivator passing down &quot;constants.getBaseRowReadMap()&quot; which is null&lt;br/&gt;
   &quot;constants&quot; is a UpdateConstantAction which is a WriteCursorConstantAction which is a ConstantAction (Interface) and is passed into the class as an ConstantAction from a GenericResultSetFactory.getUpdateResultSet it gets created  new UpdateResultSet(source, generationClauses, checkGM, activation);&lt;/p&gt;

&lt;p&gt;UpdateResultSet constructor will call its this with the activation as well as activation.getConstantAction() as &quot;passedInConstantAction&quot; which will be the &quot;constants&quot; which returns null when called on getBaseRowReadMap().&lt;/p&gt;</comment>
                            <comment id="15536681" author="bruehlicke" created="Fri, 30 Sep 2016 18:36:00 +0000"  >&lt;p&gt;OK - after 7 hours debugging the reason is found - Bryan your instincts serve you well ... The main error is in TriggerEventActivator.&lt;/p&gt;

&lt;p&gt;for 10.12.1.1 it is in the line 86 which has&lt;br/&gt;
tableName = triggerInfo.triggerArray&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;.getTableDescriptor().getQualifiedName();&lt;/p&gt;

&lt;p&gt;Note that the triggerInfo.triggerArray is HARDCODED to use index 0. Now this gives the needed tableName, BUT the &quot;getTableDiscriptor()&quot; method in TriggerDescriptor is actually a SETTER !!! It SETS  td if td is null,  That&apos;s why it works when just one trigger is in the test code and fails if 2 as the second trigger&apos;s td is never set. This bug must have been here for a long time and never surfaced.&lt;/p&gt;

&lt;p&gt;So,  in the TriggerEventActivator line 86 the triggerInfo.triggerArray has correctly the 2 triggers but onlyindex 0 gets its &quot;td&quot; set via the &quot;getTableDescriptor()&quot;.  To test this just add code which will loop for the length of the triggerArray and call the getTableDescritptor on each element.&lt;/p&gt;

&lt;p&gt;I.e;  HACK to make it work (assuming the tableName is the same for each of the triggerInfo TableDescription ), replace line 86 with this chunk of code and it will work, it is of course the &quot;setting&quot; behavior of the getTableDescriptor which is the ugly part here,&lt;/p&gt;

&lt;p&gt;tableName = triggerInfo.triggerArray&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;.getTableDescriptor().getQualifiedName();&lt;br/&gt;
for(int i=1;i&amp;lt;triggerInfo.triggerArray.length;i++){&lt;br/&gt;
      triggerInfo.triggerArray&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;.getTableDescriptor();&lt;br/&gt;
}&lt;/p&gt;



</comment>
                            <comment id="15537491" author="bryanpendleton" created="Sat, 1 Oct 2016 00:12:10 +0000"  >&lt;p&gt;Bernd, firstly, thank you VERY much for putting this energy into this issue! Also, thank&lt;br/&gt;
you for the clear and detailed notes about your investigations, it is extremely helpful.&lt;/p&gt;

&lt;p&gt;I will try to find some time this weekend to replicate your findings in detail, and to see&lt;br/&gt;
if I can add any additional clarity to your observations so far.&lt;/p&gt;

&lt;p&gt;My instinct is that the initialization loop that you describe is not really a hack, it is a&lt;br/&gt;
reasonable approach to correctly setting up the runtime data structures, including&lt;br/&gt;
the table descriptors.&lt;/p&gt;

&lt;p&gt;I agree with you that it is disturbing that &quot;getTableDescriptor()&quot; is the routine that&lt;br/&gt;
gets used to initialize the table descriptor, although this sort of &quot;initialize upon first&lt;br/&gt;
reference&quot; is not all that uncommon in the Derby codebase.&lt;/p&gt;

&lt;p&gt;The other question is where, precisely, we want that initialization loop to be, but as&lt;br/&gt;
a first guess, line 86 of TriggerEventActivator seems like a place to start.&lt;/p&gt;

&lt;p&gt;As I said, I will try to find a few hours soon to dig through the code and catch up&lt;br/&gt;
with your findings and give you some more feedback about whatever I might learn.&lt;/p&gt;</comment>
                            <comment id="15537680" author="bryanpendleton" created="Sat, 1 Oct 2016 02:10:33 +0000"  >&lt;p&gt;With Bernd&apos;s proposed change to the TriggerEventActivator constructor,&lt;br/&gt;
the reproduction script passes, and the other tests in TriggerTest&lt;br/&gt;
pass as well. Attached &apos;fixesRepro.diff&apos; contains that diff.&lt;/p&gt;

&lt;p&gt;I&apos;ll do some more testing with this patch proposal.&lt;/p&gt;</comment>
                            <comment id="15538541" author="bryanpendleton" created="Sat, 1 Oct 2016 13:39:22 +0000"  >&lt;p&gt;The entire regression suite passes with &apos;fixesRepro.diff&apos;.&lt;/p&gt;</comment>
                            <comment id="15538545" author="bryanpendleton" created="Sat, 1 Oct 2016 13:42:27 +0000"  >&lt;p&gt;It seems like another potential way to fix this problem is tied to Bernd&apos;s observation&lt;br/&gt;
that TriggerDescriptor&apos;s &apos;td&apos; member is a lazy-initialize field, which is set when it&lt;br/&gt;
is first referenced by the getTableDescriptor() method.&lt;/p&gt;

&lt;p&gt;But in the TriggerDescriptor code itself, we don&apos;t always go through getTableDescriptor();&lt;br/&gt;
sometimes we directly reference &apos;td&apos;. Such code will fail if td is still NULL at that point,&lt;br/&gt;
which is precisely the description of the test case scenario.&lt;/p&gt;

&lt;p&gt;So perhaps, instead of the initialization loop in TriggerEventActivator, we could&lt;br/&gt;
go through all of TriggerDescriptor, and every time we reference &apos;td&apos;, we instead&lt;br/&gt;
reference it by calling getTableDescriptor(), thus allowing &apos;td&apos; to auto-initialize properly.&lt;/p&gt;

&lt;p&gt;I&apos;ll give that a try and see how it behaves.&lt;/p&gt;

&lt;p&gt;bryan&lt;/p&gt;</comment>
                            <comment id="15538596" author="bruehlicke" created="Sat, 1 Oct 2016 14:19:28 +0000"  >&lt;p&gt;Yep - sounds better to me. I did not like my little hack. It is at the &quot;wrong&quot; place and the loop starts with i=1 and no-one would understand what is going on when reading it (if no comments are added why this was added).  How would the td auto-initialization approach work in a multi threaded environment ? Is Derby actually (in theory) thread safe ?&lt;/p&gt;

&lt;p&gt;Thinking about the stack trace I cannot see any other point where td is used directly and not just passed along. I wonder if this idea will work with the above test case.  Exciting to hear if it worked for you.&lt;/p&gt;</comment>
                            <comment id="15538599" author="bryanpendleton" created="Sat, 1 Oct 2016 14:20:36 +0000"  >&lt;p&gt;Attached &apos;getTableDescriptor.diff&apos; is an alternate patch proposal.&lt;/p&gt;

&lt;p&gt;In some ways, this patch seems more precise and desirable, as it&lt;br/&gt;
fixes the problem closer to the symptom, that is, inside TriggerDescriptor&lt;br/&gt;
itself, which is the class that *&lt;b&gt;ought&lt;/b&gt;* to encapsulate the knowledge of&lt;br/&gt;
the lazy-initialization of the &apos;td&apos; member field. The other patch could be&lt;br/&gt;
critiqued because it allowed that knowledge to &quot;leak out&quot; into the&lt;br/&gt;
TriggerEventActivator class.&lt;/p&gt;

&lt;p&gt;The new patch passes the reproduction script; I&apos;ll do more testing.&lt;/p&gt;</comment>
                            <comment id="15538624" author="bruehlicke" created="Sat, 1 Oct 2016 14:42:53 +0000"  >&lt;p&gt;Looked at the getTableDescriptor.diff - if all tests pass, it for sure has my vote. As you are stating so correctly it keeps the knowledge of the initialization internal allowing to user to be &quot;clueless&quot; which is good for any API development.  Thank you for this Bryan ! I can now use 12.1.1 + patch and move forward.&lt;/p&gt;</comment>
                            <comment id="15538918" author="jira-bot" created="Sat, 1 Oct 2016 17:54:47 +0000"  >&lt;p&gt;Commit 1763024 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bryanpendleton&quot; class=&quot;user-hover&quot; rel=&quot;bryanpendleton&quot;&gt;bryanpendleton&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1763024&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1763024&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6726&quot; title=&quot;NPE from trigger&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6726&quot;&gt;&lt;del&gt;DERBY-6726&lt;/del&gt;&lt;/a&gt;: NPE from trigger&lt;/p&gt;

&lt;p&gt;When there are multiple triggers on the same table, it is crucial that the&lt;br/&gt;
TriggerDescriptor class always uses the getTableDescriptor() getter method&lt;br/&gt;
to access its &apos;td&apos; member field, so that the field can be lazy-initialized&lt;br/&gt;
if it has not yet been set.&lt;/p&gt;</comment>
                            <comment id="15538923" author="bryanpendleton" created="Sat, 1 Oct 2016 17:57:48 +0000"  >&lt;p&gt;Thank you for the code review Bernd, and thanks once again for all the help on&lt;br/&gt;
tracking this down. It seems that we&apos;ve had this issue for a while, and it&apos;s nice to&lt;br/&gt;
feel like we may have addressed it.&lt;/p&gt;

&lt;p&gt;Please do let us know of your further experiences running with this fix in your environment.&lt;/p&gt;

&lt;p&gt;I&apos;ve left the issue open for now, because I intend to back-port it to (at least) the&lt;br/&gt;
10.12 and 10.13 branches. We could certainly back-port it all the way back to the 10.8&lt;br/&gt;
branch, but I&apos;m not planning to do that at this time.&lt;/p&gt;</comment>
                            <comment id="15539244" author="jira-bot" created="Sat, 1 Oct 2016 22:16:37 +0000"  >&lt;p&gt;Commit 1763034 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bryanpendleton&quot; class=&quot;user-hover&quot; rel=&quot;bryanpendleton&quot;&gt;bryanpendleton&lt;/a&gt; in branch &apos;code/branches/10.13&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1763034&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1763034&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6726&quot; title=&quot;NPE from trigger&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6726&quot;&gt;&lt;del&gt;DERBY-6726&lt;/del&gt;&lt;/a&gt;: NPE from trigger&lt;/p&gt;

&lt;p&gt;Merged from main via svn merge of 1763024 from trunk (no conflicts)&lt;/p&gt;

&lt;p&gt;When there are multiple triggers on the same table, it is crucial that the&lt;br/&gt;
TriggerDescriptor class always uses the getTableDescriptor() getter method&lt;br/&gt;
to access its &apos;td&apos; member field, so that the field can be lazy-initialized&lt;br/&gt;
if it has not yet been set.&lt;/p&gt;</comment>
                            <comment id="15540627" author="jira-bot" created="Sun, 2 Oct 2016 16:39:35 +0000"  >&lt;p&gt;Commit 1763083 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bryanpendleton&quot; class=&quot;user-hover&quot; rel=&quot;bryanpendleton&quot;&gt;bryanpendleton&lt;/a&gt; in branch &apos;code/branches/10.12&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1763083&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1763083&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6726&quot; title=&quot;NPE from trigger&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6726&quot;&gt;&lt;del&gt;DERBY-6726&lt;/del&gt;&lt;/a&gt;: NPE from trigger&lt;/p&gt;

&lt;p&gt;Merged from main via svn merge of 1763024 from trunk (no conflicts)&lt;/p&gt;

&lt;p&gt;When there are multiple triggers on the same table, it is crucial that the&lt;br/&gt;
TriggerDescriptor class always uses the getTableDescriptor() getter method&lt;br/&gt;
to access its &apos;td&apos; member field, so that the field can be lazy-initialized&lt;br/&gt;
if it has not yet been set.&lt;/p&gt;</comment>
                            <comment id="15540659" author="bryanpendleton" created="Sun, 2 Oct 2016 17:05:53 +0000"  >&lt;p&gt;We&apos;ve completed all the intended work on this issue. Resolving.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12478632">DERBY-4874</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12761462">DERBY-6783</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12830836" name="TriggerTest.diff" size="7182" author="bryanpendleton" created="Thu, 29 Sep 2016 02:28:56 +0000"/>
                            <attachment id="12830768" name="derbytrig.zip" size="2642573" author="bruehlicke" created="Wed, 28 Sep 2016 19:01:24 +0000"/>
                            <attachment id="12831207" name="fixesRepro.diff" size="8472" author="bryanpendleton" created="Sat, 1 Oct 2016 02:10:33 +0000"/>
                            <attachment id="12831224" name="getTableDescriptor.diff" size="8436" author="bryanpendleton" created="Sat, 1 Oct 2016 14:20:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 7 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1zmsv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>