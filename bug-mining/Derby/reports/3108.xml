<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 14:50:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DERBY-6774] background post commit threads cause ASSERTS/errors on interaction with alter table add column</title>
                <link>https://issues.apache.org/jira/browse/DERBY-6774</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;intermittent error in sane test runs in some nightly runs.&lt;/p&gt;

&lt;p&gt;java.sql.SQLException: DERBY SQL error: ERRORCODE: 0, SQLSTATE: XJ001, SQLERRMC: org.apache.derby.shared.common.sanity.AssertFailureASSERT FAILED Expected (column_id == format_ids.length)column_id = 1format_ids.length = 2format_ids = [I@2abb6423XJ001.U&lt;br/&gt;
	at org.apache.derby.client.am.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:112)&lt;br/&gt;
	at org.apache.derby.client.am.SqlException.getSQLException(SqlException.java:321)&lt;br/&gt;
	at org.apache.derby.client.am.ClientStatement.execute(ClientStatement.java:990)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.lang.AlterTableTest.testAddIdentityColumn(AlterTableTest.java:377)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:120)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBareOverridable(BaseJDBCTestCase.java:443)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBare(BaseJDBCTestCase.java:460)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:58)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:58)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:58)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
Caused by: ERROR XJ001: DERBY SQL error: ERRORCODE: 0, SQLSTATE: XJ001, SQLERRMC: org.apache.derby.shared.common.sanity.AssertFailureASSERT FAILED Expected (column_id == format_ids.length)column_id = 1format_ids.length = 2format_ids = [I@2abb6423XJ001.U&lt;br/&gt;
	at org.apache.derby.client.am.ClientStatement.completeSqlca(ClientStatement.java:2109)&lt;br/&gt;
	at org.apache.derby.client.am.ClientStatement.completeExecuteImmediate(ClientStatement.java:1676)&lt;br/&gt;
	at org.apache.derby.client.net.NetStatementReply.parseEXCSQLIMMreply(NetStatementReply.java:209)&lt;br/&gt;
	at org.apache.derby.client.net.NetStatementReply.readExecuteImmediate(NetStatementReply.java:60)&lt;br/&gt;
	at org.apache.derby.client.net.StatementReply.readExecuteImmediate(StatementReply.java:47)&lt;br/&gt;
	at org.apache.derby.client.net.NetStatement.readExecuteImmediate_(NetStatement.java:142)&lt;br/&gt;
	at org.apache.derby.client.am.ClientStatement.readExecuteImmediate(ClientStatement.java:1672)&lt;br/&gt;
	at org.apache.derby.client.am.ClientStatement.flowExecute(ClientStatement.java:2401)&lt;br/&gt;
	at org.apache.derby.client.am.ClientStatement.executeX(ClientStatement.java:995)&lt;br/&gt;
	at org.apache.derby.client.am.ClientStatement.execute(ClientStatement.java:981)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12757606">DERBY-6774</key>
            <summary>background post commit threads cause ASSERTS/errors on interaction with alter table add column</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikem">Mike Matrigali</assignee>
                                    <reporter username="mikem">Mike Matrigali</reporter>
                        <labels>
                            <label>derby_backport_reject_10_11</label>
                    </labels>
                <created>Tue, 25 Nov 2014 03:44:38 +0000</created>
                <updated>Fri, 9 Sep 2016 09:51:41 +0000</updated>
                            <resolved>Wed, 14 Jan 2015 20:03:43 +0000</resolved>
                                    <version>10.11.1.3</version>
                                    <fixVersion>10.12.1.1</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14224009" author="mikem" created="Tue, 25 Nov 2014 03:46:25 +0000"  >&lt;p&gt;This issue is likely related to changes for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4057&quot; title=&quot;Space is not reclaimed if transaction is rolled back&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4057&quot;&gt;&lt;del&gt;DERBY-4057&lt;/del&gt;&lt;/a&gt;.  Not sure if &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4057&quot; title=&quot;Space is not reclaimed if transaction is rolled back&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4057&quot;&gt;&lt;del&gt;DERBY-4057&lt;/del&gt;&lt;/a&gt; causes the bug or it adjusts background timing such that and existing bug is now sometimes hit.  &lt;/p&gt;</comment>
                            <comment id="14224014" author="mikem" created="Tue, 25 Nov 2014 03:52:41 +0000"  >&lt;p&gt;I saw this bug once on my machine but could never reproduce.  Tried running the whole AlterTableTest 200 times.&lt;br/&gt;
It failed in the sun test runs after checkin in 3 out of 25 runs:&lt;br/&gt;
Linux_amd64_jdk6:&lt;br/&gt;
&lt;a href=&quot;http://download.java.net/javadesktop/derby/request_5599729/javadb-task-3977772.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://download.java.net/javadesktop/derby/request_5599729/javadb-task-3977772.html&lt;/a&gt;&lt;br/&gt;
line 377 in the test&lt;br/&gt;
Linux_jdk8-compact2:&lt;br/&gt;
&lt;a href=&quot;http://download.java.net/javadesktop/derby/request_5599729/javadb-task-3977767.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://download.java.net/javadesktop/derby/request_5599729/javadb-task-3977767.html&lt;/a&gt;&lt;br/&gt;
line 352 in the test&lt;br/&gt;
Windows_amd64_jdk6 :&lt;br/&gt;
&lt;a href=&quot;http://download.java.net/javadesktop/derby/request_5599729/javadb-task-3977772.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://download.java.net/javadesktop/derby/request_5599729/javadb-task-3977772.html&lt;/a&gt;&lt;br/&gt;
line 377 in the test&lt;/p&gt;</comment>
                            <comment id="14225624" author="jira-bot" created="Wed, 26 Nov 2014 02:48:14 +0000"  >&lt;p&gt;Commit 1641753 from mikem@apache.org in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1641753&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1641753&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6774&quot; title=&quot;background post commit threads cause ASSERTS/errors on interaction with alter table add column&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6774&quot;&gt;&lt;del&gt;DERBY-6774&lt;/del&gt;&lt;/a&gt; org.apache.derbyTesting.functionTests.tests.lang.AlterTableTest.testAddIdentityColumn failed with assert in nightlys&lt;/p&gt;

&lt;p&gt;Temporarily removing assert that is failing, looks like code should handle&lt;br/&gt;
the condition anyway.  Will renable after figuring out what is going on, &lt;br/&gt;
hoping this will allow for clean runs from others while I work on this issue.&lt;br/&gt;
My current theory is that there is a long time problem with alter table&lt;br/&gt;
and the conglomerate cache that has been uncovered by this relatively new&lt;br/&gt;
test and the new background work introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4057&quot; title=&quot;Space is not reclaimed if transaction is rolled back&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4057&quot;&gt;&lt;del&gt;DERBY-4057&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14237284" author="jira-bot" created="Sun, 7 Dec 2014 21:44:18 +0000"  >&lt;p&gt;Commit 1643721 from mikem@apache.org in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1643721&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1643721&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6774&quot; title=&quot;background post commit threads cause ASSERTS/errors on interaction with alter table add column&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6774&quot;&gt;&lt;del&gt;DERBY-6774&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Temporarily disabling the failing test in nightly testing while&lt;br/&gt;
actively working on fixing this bug.&lt;/p&gt;</comment>
                            <comment id="14242756" author="mikem" created="Thu, 11 Dec 2014 16:27:10 +0000"  >&lt;p&gt;patch for this issue.  It reenables the tests that were failing on some platforms, and adds tests that were failing consistently in my environment (laptop, windows 7, ibm17).  The fix was to insure that background threads waited on table intent lock before going to the conglomerate cache. &lt;/p&gt;

&lt;p&gt;Before doing this an inconsistent conglomerate would sometimes be faulted into the cache between time when alter table abort was invalidating the cache and abort had finished backing out the alter table.  Then a subsequent alter table would fail as it correctly passed in that there was 1 existing column, but the conglomerate cache thought there were 2 columns.&lt;/p&gt;</comment>
                            <comment id="14244709" author="jira-bot" created="Fri, 12 Dec 2014 20:13:26 +0000"  >&lt;p&gt;Commit 1645055 from mikem@apache.org in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1645055&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1645055&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6774&quot; title=&quot;background post commit threads cause ASSERTS/errors on interaction with alter table add column&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6774&quot;&gt;&lt;del&gt;DERBY-6774&lt;/del&gt;&lt;/a&gt; background post commit threads cause ASSERTS/errors on interaction with alter table add column&lt;/p&gt;

&lt;p&gt;Renable the tests that were failing on some platforms, and adds tests that&lt;br/&gt;
were failing consistently in my environment (laptop, windows 7, ibm17). &lt;/p&gt;

&lt;p&gt;The fix was to insure that background threads waited on table intent lock &lt;br/&gt;
before going to the conglomerate cache.&lt;/p&gt;

&lt;p&gt;Before doing this an inconsistent conglomerate would sometimes be faulted into &lt;br/&gt;
the cache between time when alter table abort was invalidating the cache and &lt;br/&gt;
abort had finished backing out the alter table. Then a subsequent alter table &lt;br/&gt;
would fail as it correctly passed in that there was 1 existing column, but the&lt;br/&gt;
conglomerate cache thought there were 2 columns.&lt;/p&gt;</comment>
                            <comment id="14277583" author="mikem" created="Wed, 14 Jan 2015 20:06:16 +0000"  >&lt;p&gt;at least this particular repro seems caused by changes for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4057&quot; title=&quot;Space is not reclaimed if transaction is rolled back&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4057&quot;&gt;&lt;del&gt;DERBY-4057&lt;/del&gt;&lt;/a&gt; which will not be backported, so marking this not for backport.  A new issue &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6780&quot; title=&quot;change conglomerate cache to handle concurrency and alter table add column calls.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6780&quot;&gt;DERBY-6780&lt;/a&gt; was created to track the underlying problem.&lt;/p&gt;</comment>
                            <comment id="15476532" author="knutanders" created="Fri, 9 Sep 2016 09:51:41 +0000"  >&lt;p&gt;[ Automatically closing all resolved issues that haven&apos;t been updated in more than six months. ]&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12761105">DERBY-6780</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12414759">DERBY-4057</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12686611" name="derby-6774_diff.txt" size="28539" author="mikem" created="Thu, 11 Dec 2014 16:27:10 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10102"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 10 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i22qyv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>