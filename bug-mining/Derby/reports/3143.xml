<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 14:51:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DERBY-6880] Update failing with java.sql.SQLDataException </title>
                <link>https://issues.apache.org/jira/browse/DERBY-6880</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;When updating a single column in a table using executeUpdate() via Vert.x I am receiving the following exception:&lt;/p&gt;

&lt;p&gt;java.sql.SQLDataException: Invalid character string format for type long.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:84)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Util.java:233)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:424)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:353)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2405)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:88)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1432)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(EmbedPreparedStatement.java:1709)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeLargeUpdate(EmbedPreparedStatement.java:320)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeUpdate(EmbedPreparedStatement.java:309)&lt;br/&gt;
	at com.mchange.v2.c3p0.impl.NewProxyPreparedStatement.executeUpdate(NewProxyPreparedStatement.java:410)&lt;br/&gt;
	at io.vertx.ext.jdbc.impl.actions.JDBCUpdate.execute(JDBCUpdate.java:50)&lt;br/&gt;
	at io.vertx.ext.jdbc.impl.actions.JDBCUpdate.execute(JDBCUpdate.java:34)&lt;br/&gt;
	at io.vertx.ext.jdbc.impl.actions.AbstractJDBCAction.handle(AbstractJDBCAction.java:48)&lt;br/&gt;
	at io.vertx.ext.jdbc.impl.actions.AbstractJDBCAction.handle(AbstractJDBCAction.java:33)&lt;br/&gt;
	at io.vertx.core.impl.ContextImpl.lambda$executeBlocking$15(ContextImpl.java:296)&lt;br/&gt;
	at io.vertx.core.impl.OrderedExecutorFactory$OrderedExecutor.lambda$new$261(OrderedExecutorFactory.java:91)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:745)&lt;br/&gt;
Caused by: ERROR 22018: Invalid character string format for type long.&lt;br/&gt;
	at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:290)&lt;br/&gt;
	at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:285)&lt;br/&gt;
	at org.apache.derby.iapi.types.SQLChar.getLong(SQLChar.java:447)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.UpdateResultSet.collectAffectedRows(UpdateResultSet.java:534)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.UpdateResultSet.open(UpdateResultSet.java:272)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:473)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:352)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1340)&lt;br/&gt;
	... 13 more&lt;/p&gt;

&lt;p&gt;Further details and discussion can be found here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://mail-archives.apache.org/mod_mbox/db-derby-user/201603.mbox/%3CCAHbUnCXkHMKE1u9R3D-z9Njp8goAV7%2B0vPOmgafH8DCqG8mSpQ%40mail.gmail.com%3E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://mail-archives.apache.org/mod_mbox/db-derby-user/201603.mbox/%3CCAHbUnCXkHMKE1u9R3D-z9Njp8goAV7%2B0vPOmgafH8DCqG8mSpQ%40mail.gmail.com%3E&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Notably, I have tried executing the same update via other means (for example, manually via SquirrelSQL, and via the ORMLite framework) and the update succeeds. This may be due to the exact JDBC APIs they are using (for example, SquirrelSQL is not using a prepared statement, and ORMLite updates all the columns when it updates a table rather than just some of them).&lt;/p&gt;

&lt;p&gt;I have created a complete but minimal example that illustrates the problem in the following GitHub project:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/ssadedin/DerbyDebug&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/ssadedin/DerbyDebug&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;My derby / system information is as follows:&lt;/p&gt;

&lt;p&gt;$ java -cp &apos;lib/*&apos; org.apache.derby.tools.sysinfo&lt;br/&gt;
------------------ Java Information ------------------&lt;br/&gt;
Java Version:    1.8.0_72&lt;br/&gt;
Java Vendor:     Oracle Corporation&lt;br/&gt;
Java home:       /Library/Java/JavaVirtualMachines/jdk1.8.0_72.jdk/Contents/Home/jre&lt;br/&gt;
Java classpath:  lib/derby.jar:lib/derbyclient.jar&lt;br/&gt;
OS name:         Mac OS X&lt;br/&gt;
OS architecture: x86_64&lt;br/&gt;
OS version:      10.11.1&lt;br/&gt;
Java user name:  simon&lt;br/&gt;
Java user home:  /Users/simon&lt;br/&gt;
Java user dir:   /Users/simon/Documents/workspace/BrokenDerby&lt;br/&gt;
java.specification.name: Java Platform API Specification&lt;br/&gt;
java.specification.version: 1.8&lt;br/&gt;
java.runtime.version: 1.8.0_72-b15&lt;br/&gt;
--------- Derby Information --------&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;/Users/simon/Documents/workspace/BrokenDerby/lib/derby.jar&amp;#93;&lt;/span&gt; 10.12.1.1 - (Unversioned directory)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;/Users/simon/Documents/workspace/BrokenDerby/lib/derbyclient.jar&amp;#93;&lt;/span&gt; 10.12.1.1 - (Unversioned directory)&lt;br/&gt;
------------------------------------------------------&lt;br/&gt;
----------------- Locale Information -----------------&lt;br/&gt;
------------------------------------------------------&lt;br/&gt;
------------------------------------------------------&lt;/p&gt;</description>
                <environment></environment>
        <key id="12954458">DERBY-6880</key>
            <summary>Update failing with java.sql.SQLDataException </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bryanpendleton">Bryan Pendleton</assignee>
                                    <reporter username="simonzee">Simon Zee</reporter>
                        <labels>
                    </labels>
                <created>Tue, 29 Mar 2016 23:19:39 +0000</created>
                <updated>Thu, 28 Apr 2016 11:59:11 +0000</updated>
                            <resolved>Thu, 28 Apr 2016 02:44:54 +0000</resolved>
                                    <version>10.12.1.1</version>
                                    <fixVersion>10.13.1.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15220932" author="bryanpendleton" created="Fri, 1 Apr 2016 00:44:15 +0000"  >&lt;p&gt;Attached &apos;repro.diff&apos; adds a new test case to the&lt;br/&gt;
GeneratedColumnsTest suite which demonstrates&lt;br/&gt;
the &quot;Invalid character string format for type long&quot; error.&lt;/p&gt;</comment>
                            <comment id="15220950" author="bryanpendleton" created="Fri, 1 Apr 2016 01:02:01 +0000"  >&lt;p&gt;The code which calls getLong, provoking the exception,&lt;br/&gt;
is new code added by &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6742&quot; title=&quot;For update statement, collect generated keys if Statement.RETURN_GENERATED_KEYS flag is supplied to the JDBC call.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6742&quot;&gt;&lt;del&gt;DERBY-6742&lt;/del&gt;&lt;/a&gt;, so marking this&lt;br/&gt;
issue as linked to that one.&lt;/p&gt;</comment>
                            <comment id="15221076" author="bryanpendleton" created="Fri, 1 Apr 2016 03:17:39 +0000"  >&lt;p&gt;In the code:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;                &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(col=1;col&amp;lt;=maxColumns;col++)
                {
                    ColumnDescriptor cd = td.getColumnDescriptor(col);
                    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(cd.isAutoincrement())
                    {
                        &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
                    }
                }

                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(col &amp;lt;= maxColumns)
                {
                    DataValueDescriptor dvd = row.cloneColumn(col);
                    identityVal = dvd.getLong();
                }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;is where we go astray. The for loop locates the correct column descriptor,&lt;br/&gt;
it is for the &quot;id&quot; column of table &quot;pipeline_command&quot;.&lt;/p&gt;

&lt;p&gt;But the table descriptor in &quot;td&quot; is not accurate for use with the data in &quot;row&quot;.&lt;/p&gt;

&lt;p&gt;In this particular case, &quot;td&quot; describes the underlying &quot;pipeline_command&quot; table,&lt;br/&gt;
and it appears to have all the relevant columns just as you would expect, and&lt;br/&gt;
so column 1 is indeed the autogenerated &quot;ID&quot; column.&lt;/p&gt;

&lt;p&gt;However, column 1 of &quot;row&quot; is nothing the same at all. &quot;row&quot; is a ValueRow,&lt;br/&gt;
and has only 3 columns, in my case the three columns are:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;the old value of the &quot;status&quot; column&lt;/li&gt;
	&lt;li&gt;the new value of the &quot;status&quot; column&lt;/li&gt;
	&lt;li&gt;some sort of value that is displayed as &quot;(1,8)&quot;, which I haven&apos;t decoded yet.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I think that &quot;row&quot;, at the time when we are running, is some sort of intermediate&lt;br/&gt;
object, and the code in UpdateResultSet is getting all confused because it&lt;br/&gt;
is trying to use the underlying table descriptor to interpret the values in &quot;row&quot;,&lt;br/&gt;
but &quot;row&quot; is not a row from the base &quot;pipeline_command&quot; table anymore, it is&lt;br/&gt;
some intermediate &quot;old-value,new-value&quot; row that has been constructed by the query.&lt;/p&gt;

&lt;p&gt;Anyway, that&apos;s as far as I got today fooling around with the reproduction script.&lt;/p&gt;</comment>
                            <comment id="15222600" author="bryanpendleton" created="Sat, 2 Apr 2016 00:51:37 +0000"  >&lt;p&gt;standalone.java is the same reproduction program, but as a&lt;br/&gt;
standalone JDBC program, so easier to run under debuggers, etc.&lt;/p&gt;</comment>
                            <comment id="15222616" author="bryanpendleton" created="Sat, 2 Apr 2016 01:17:43 +0000"  >&lt;p&gt;Here&apos;s a snip from the change that was submitted for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6414&quot; title=&quot;Incorrect handling when using an UPDATE to SET an identity column to DEFAULT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6414&quot;&gt;&lt;del&gt;DERBY-6414&lt;/del&gt;&lt;/a&gt;:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;+     *  The 2nd array, rla has a spot &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; each of the columns in the table, 
+     *  with non &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; value &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; auto generated column. But in &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; of Update,
+     *  resultDescription does not include all the columns in the table. It
+     *  only has the columns being touched by the Update statement(the &lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt; of
+     *  the columns in the table will retain their original values), and &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 
+     *  each of those touched columns, it has a duplicate entry in 
+     *  resultDescription in order to have before and after values &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the 
+     *  changed column values. Lastly, it has a row location information &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 
+     *  the row being updated. This difference in array content of 
+     *  resultDescription requires us to have separate implementation of &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;
+     *  method &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; insert and update.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think this description (before and after values for the changed column values,&lt;br/&gt;
plus the row location information for the row being updated) exactly describes&lt;br/&gt;
the 3-column ValueRow object that I am seeing when I run the reproduction.&lt;/p&gt;

&lt;p&gt;I have the before and after values for the &apos;status&apos; column as columns 1 and 2&lt;br/&gt;
of my 3-column row, and the third column (1,8) is the row location information.&lt;/p&gt;</comment>
                            <comment id="15222622" author="bryanpendleton" created="Sat, 2 Apr 2016 01:23:23 +0000"  >&lt;p&gt;One possibility is to back-out the change to UpdateResultSet made by &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6742&quot; title=&quot;For update statement, collect generated keys if Statement.RETURN_GENERATED_KEYS flag is supplied to the JDBC call.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6742&quot;&gt;&lt;del&gt;DERBY-6742&lt;/del&gt;&lt;/a&gt; in &lt;br/&gt;
revision &lt;a href=&quot;https://svn.apache.org/r1628596&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1628596&lt;/a&gt;. Of course, that would re-open &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6742&quot; title=&quot;For update statement, collect generated keys if Statement.RETURN_GENERATED_KEYS flag is supplied to the JDBC call.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6742&quot;&gt;&lt;del&gt;DERBY-6742&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15222911" author="bryanpendleton" created="Sat, 2 Apr 2016 14:59:57 +0000"  >&lt;p&gt;As an experiment, I deleted the section of code added to&lt;br/&gt;
UpdateResultSet.collectAffectedRows() by &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6742&quot; title=&quot;For update statement, collect generated keys if Statement.RETURN_GENERATED_KEYS flag is supplied to the JDBC call.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6742&quot;&gt;&lt;del&gt;DERBY-6742&lt;/del&gt;&lt;/a&gt;,&lt;br/&gt;
and I ran the complete regression test suite, including the&lt;br/&gt;
new test of the &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6880&quot; title=&quot;Update failing with java.sql.SQLDataException &quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6880&quot;&gt;&lt;del&gt;DERBY-6880&lt;/del&gt;&lt;/a&gt; reproduction script.&lt;/p&gt;

&lt;p&gt;All tests were successful.&lt;/p&gt;

&lt;p&gt;So apparently reverting that section of the &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6742&quot; title=&quot;For update statement, collect generated keys if Statement.RETURN_GENERATED_KEYS flag is supplied to the JDBC call.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6742&quot;&gt;&lt;del&gt;DERBY-6742&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
changes does not cause any of our existing regression&lt;br/&gt;
test suites to fail.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure what to conclude from this. There were a substantial&lt;br/&gt;
number of new tests added by &lt;a href=&quot;https://svn.apache.org/r1625884&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1625884&lt;/a&gt;&lt;br/&gt;
but it appears that none of those test cases directly exercised&lt;br/&gt;
the code in UpdateResultSet.collectAffectedRows, whereas&lt;br/&gt;
the new reproduction script from &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6880&quot; title=&quot;Update failing with java.sql.SQLDataException &quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6880&quot;&gt;&lt;del&gt;DERBY-6880&lt;/del&gt;&lt;/a&gt; does exercise&lt;br/&gt;
that code.&lt;/p&gt;

&lt;p&gt;Frankly, it&apos;s hard to tell whether removing that section of code&lt;br/&gt;
would actually re-open &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6742&quot; title=&quot;For update statement, collect generated keys if Statement.RETURN_GENERATED_KEYS flag is supplied to the JDBC call.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6742&quot;&gt;&lt;del&gt;DERBY-6742&lt;/del&gt;&lt;/a&gt; or not.&lt;/p&gt;

&lt;p&gt;I may just let this one sit for a bit, until others have had a chance&lt;br/&gt;
to think about it.&lt;/p&gt;

&lt;p&gt;Simon, as an experiment (not sure if you can do this), you could&lt;br/&gt;
take this patch (undo6742.diff) and apply it to your own copy of&lt;br/&gt;
either the Derby 10.12 source tree or the Derby mainline source tree,&lt;br/&gt;
build yourself a custom version of derby.jar, and confirm that this&lt;br/&gt;
change resolves the problem you are seeing with your application&lt;br/&gt;
in the Vert.x framework.&lt;/p&gt;</comment>
                            <comment id="15223097" author="simonzee" created="Sun, 3 Apr 2016 01:43:47 +0000"  >&lt;p&gt;Thanks for all your work on this Bryan!&lt;/p&gt;

&lt;p&gt;I applied the undo patch that you attached and that resolved the problem for me. I will leave this patched version in place and work with it over the next few days and report back if there are any regressions. &lt;/p&gt;</comment>
                            <comment id="15225916" author="peen" created="Tue, 5 Apr 2016 08:54:42 +0000"  >&lt;p&gt;If I understand the javadoc describing the section you&apos;ve tried commenting out, I think you should be able to get the identity value of the updated row after executing an update affecting a single row, like the one in the test.&lt;/p&gt;

&lt;p&gt;So if you expand the test to also check the result of ustmt.getGeneratedKeys(), I think it will fail (always returns 0) when the section of code in UpdateResultSet.collectAffectedRows() is commented out.&lt;/p&gt;</comment>
                            <comment id="15228281" author="bryanpendleton" created="Wed, 6 Apr 2016 13:55:08 +0000"  >&lt;p&gt;That&apos;s a really interesting perspective, thank you for suggesting it!&lt;/p&gt;

&lt;p&gt;The JavaDoc in question, I think, is for Statement.getGeneratedKeys:&lt;br/&gt;
&lt;a href=&quot;https://docs.oracle.com/javase/7/docs/api/java/sql/Statement.html#getGeneratedKeys(&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.oracle.com/javase/7/docs/api/java/sql/Statement.html#getGeneratedKeys(&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;It says:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;    Retrieves any auto-generated keys created as a result of executing this &lt;br/&gt;
    Statement object. If this Statement object did not generate any keys, &lt;br/&gt;
    an empty ResultSet object is returned.&lt;/p&gt;

&lt;p&gt;    Note:If the columns which represent the auto-generated keys were not &lt;br/&gt;
    specified, the JDBC driver implementation will determine the columns &lt;br/&gt;
    which best represent the auto-generated keys.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Which isn&apos;t a lot of detail. But, to me, it clearly uses the phrases&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;    auto-generated keys created as a result&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;and&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;    generate any keys&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;To me, that specifically means that the update must cause a &lt;b&gt;NEW&lt;/b&gt; value for&lt;br/&gt;
a column which is &quot;GENERATED ... AS IDENTITY&quot; to be generated by the&lt;br/&gt;
statement, and the reproduction&apos;s statement:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;    update pipeline_command set status = &apos;WAIT RESULT&apos; where id = ?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;only updates the &quot;status&quot; column, and does not cause any new values to&lt;br/&gt;
be generated for the &quot;id&quot; column.&lt;/p&gt;

&lt;p&gt;However, while doing a bit of web searching, I came across this page from&lt;br/&gt;
the DB2 documentation set:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://www.ibm.com/support/knowledgecenter/SSEPGG_9.7.0/com.ibm.db2.luw.apdv.java.doc/src/tpc/imjcc_t0057054.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.ibm.com/support/knowledgecenter/SSEPGG_9.7.0/com.ibm.db2.luw.apdv.java.doc/src/tpc/imjcc_t0057054.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;which suggests a thoroughly different reading of how Statement.getGeneratedKeys&lt;br/&gt;
should behave, stating that:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;    The following code names the EMPNO column as an automatically &lt;br/&gt;
    generated key, updates the thirty rows in the EMP_BONUS table, &lt;br/&gt;
    and retrieves the values of EMPNO for the updated rows. &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The statement in the DB2 example, like the statement in this issue&apos;s reproduction,&lt;br/&gt;
does not modify nor create new values for any automatically generated keys, but&lt;br/&gt;
the DB2 example suggests that Statement.getGeneratedKeys is intended to&lt;br/&gt;
return the generated key values of &lt;b&gt;other&lt;/b&gt; columns in the rows which were updated,&lt;br/&gt;
even if those columns were not actually created or updated by the statement.&lt;/p&gt;

&lt;p&gt;It&apos;s a bit of a puzzle, actually. But, your comment does suggest some new test&lt;br/&gt;
cases that I might write (thank you!)&lt;/p&gt;

&lt;p&gt;I&apos;ll try to find some time to dig into that some more.&lt;/p&gt;

&lt;p&gt;In the meantime, if anyone knows of any more information about how Statement.getGeneratedKeys&lt;br/&gt;
is intended to behave, that would be welcomed.&lt;/p&gt;</comment>
                            <comment id="15230293" author="peen" created="Thu, 7 Apr 2016 14:11:46 +0000"  >&lt;p&gt;In case you could use this info; &lt;br/&gt;
I tried changing the PreparedStatement in the test to this:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;PreparedStatement ustmt = conn.prepareStatement(&lt;br/&gt;
				&quot;update pipeline_command set status = &apos;WAIT RESULT&apos;&quot; +&lt;br/&gt;
						&quot;       where id = ?&quot;, new String[] {&quot;ID&quot;});&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It results in the same error on Derby as before. But running this against DB2 makes Statement.getGeneratedKeys return the ID of the updated row (In this test &apos;2&apos;). Running the original PreparedStatement against DB2 makes Statement.getGeneratedKeys return an empty resultsset.&lt;/p&gt;</comment>
                            <comment id="15233679" author="bryanpendleton" created="Sat, 9 Apr 2016 18:33:24 +0000"  >&lt;p&gt;Soren, does DB2 allow&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;PreparedStatement ustmt = conn.prepareStatement(
&lt;span class=&quot;code-quote&quot;&gt;&quot;update pipeline_command set status = &lt;span class=&quot;code-quote&quot;&gt;&apos;WAIT RESULT&apos;&lt;/span&gt;&quot;&lt;/span&gt; +
&lt;span class=&quot;code-quote&quot;&gt;&quot; where id = ?&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] {&lt;span class=&quot;code-quote&quot;&gt;&quot;STATUS&quot;&lt;/span&gt;});
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15234182" author="bryanpendleton" created="Sun, 10 Apr 2016 16:31:05 +0000"  >&lt;p&gt;I added some more tests experimenting with the variant&lt;br/&gt;
of Connection.prepareStatement() that allows the program&lt;br/&gt;
to specify an array of column names to indicate the &lt;br/&gt;
auto-generated columns of interest for getGeneratedKeys.&lt;/p&gt;

&lt;p&gt;It seems like the array of column names is case-sensitive.&lt;br/&gt;
Is this wrong? Shouldn&apos;t these column names be handled&lt;br/&gt;
in the typical case-insensitive manner of SQL, given that&lt;br/&gt;
they aren&apos;t &quot;delimited identifiers&quot;? The Javadoc for&lt;br/&gt;
java.sql.Connection didn&apos;t provide any guidance on that.&lt;/p&gt;

&lt;p&gt;Derby throws the same X0X0F exception in all three cases:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;column name is unknown&lt;/li&gt;
	&lt;li&gt;column name is valid, but is in the wrong case&lt;/li&gt;
	&lt;li&gt;column name is valid, but does not specify a IDENTITY column&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Anyway, I still feel like backing out the code in UpdateResultSet&lt;br/&gt;
is the right thing to do. The DB2 behaviors described by Soren Peen&lt;br/&gt;
are fascinating, but it would be a substantial change to the Derby&lt;br/&gt;
runtime model to implement them.&lt;/p&gt;

&lt;p&gt;And, the code in UpdateResultSet seems fundamentally incorrect&lt;br/&gt;
to me, as it is attempting to use the column descriptions from the&lt;br/&gt;
full table descriptor for the UPDATE statement&apos;s target table to&lt;br/&gt;
access the columns in the transient, projected &quot;row&quot; which has&lt;br/&gt;
the subset of (before,after,rowid) values that are used by things&lt;br/&gt;
like trigger execution. Some alternate sort of data structures, as&lt;br/&gt;
well as a different code-generation strategy, might be needed in&lt;br/&gt;
order to allow us to capture the values of IDENTITY columns&lt;br/&gt;
during an UPDATE statement.&lt;/p&gt;</comment>
                            <comment id="15261437" author="jira-bot" created="Thu, 28 Apr 2016 02:39:01 +0000"  >&lt;p&gt;Commit 1741380 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bryanpendleton&quot; class=&quot;user-hover&quot; rel=&quot;bryanpendleton&quot;&gt;bryanpendleton&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1741380&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1741380&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6880&quot; title=&quot;Update failing with java.sql.SQLDataException &quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6880&quot;&gt;&lt;del&gt;DERBY-6880&lt;/del&gt;&lt;/a&gt;: Update failing with java.sql.SQLDataException&lt;/p&gt;

&lt;p&gt;This change reverts part of the changes made by revision 1628596 for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6742&quot; title=&quot;For update statement, collect generated keys if Statement.RETURN_GENERATED_KEYS flag is supplied to the JDBC call.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6742&quot;&gt;&lt;del&gt;DERBY-6742&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Specifically, the section of code added to UpdateResultSet.collectAffectedRows&lt;br/&gt;
is removed. That code caused problems with certain SQL UPDATE statements&lt;br/&gt;
which were compiled with Statement.RETURN_GENERATED_KEYS. The new test cases&lt;br/&gt;
added by this change include several examples of such SQL statements.&lt;/p&gt;

&lt;p&gt;The JDBC documentation for the intended behavior of UPDATE statements with the&lt;br/&gt;
RETURN_GENERATED_KEYS option is unclear; the intended behavior is much&lt;br/&gt;
clearer with INSERT statements. Given that I don&apos;t understand the intended&lt;br/&gt;
behavior, it seems safer to me to return Derby to the previous state for&lt;br/&gt;
UPDATE statements; namely, that no attempt is made to compute the set of&lt;br/&gt;
generated keys for an UPDATE statement.&lt;/p&gt;</comment>
                            <comment id="15261441" author="bryanpendleton" created="Thu, 28 Apr 2016 02:44:54 +0000"  >&lt;p&gt;I&apos;ve gone as far on this issue as I care to, for the time being. My feeling&lt;br/&gt;
is that this patch is an incremental improvement: the new test cases&lt;br/&gt;
pass, including several test cases which worked in older Derby releases&lt;br/&gt;
and broke in the latest release, and no known test cases are broken by&lt;br/&gt;
this patch.&lt;/p&gt;

&lt;p&gt;It&apos;s clear that I don&apos;t really understand what is meant by the JDBC&lt;br/&gt;
documentation for Statement.RETURN_GENERATED_KEYS for an&lt;br/&gt;
UPDATE SQL statement, and it&apos;s also clear that I don&apos;t know how to&lt;br/&gt;
implement the behavior that is exhibited by other systems (notably&lt;br/&gt;
the DB2 behaviors that Soren Peen described).&lt;/p&gt;

&lt;p&gt;But, for the time being, those are not my itch to scratch, whereas&lt;br/&gt;
fixing the regression is, so I decided to commit this patch and mark&lt;br/&gt;
this issue resolved.&lt;/p&gt;

&lt;p&gt;We certainly could back-port this change to 10.12, if anyone is planning&lt;br/&gt;
to make a patch release of 10.12, but I&apos;m not intending to back-port&lt;br/&gt;
this change at this time.&lt;/p&gt;</comment>
                            <comment id="15262027" author="simonzee" created="Thu, 28 Apr 2016 11:59:11 +0000"  >&lt;p&gt;Bryan, thanks for your persistence and diligence on this issue!&lt;/p&gt;

&lt;p&gt;I think you&apos;ve made the right call. While there was clearly an intention behind the code changes that were made, the regression caused seems worse than whatever subtle feature of the JDBC APIs they were intended to implement.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12742051">DERBY-6742</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12796438" name="repro.diff" size="2493" author="bryanpendleton" created="Fri, 1 Apr 2016 00:44:15 +0000"/>
                            <attachment id="12796634" name="standalone.java" size="2589" author="bryanpendleton" created="Sat, 2 Apr 2016 00:51:37 +0000"/>
                            <attachment id="12796677" name="undo6742.diff" size="4899" author="bryanpendleton" created="Sat, 2 Apr 2016 14:59:57 +0000"/>
                            <attachment id="12797923" name="undoMoreTests.diff" size="7892" author="bryanpendleton" created="Sun, 10 Apr 2016 16:31:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10365"><![CDATA[Crash]]></customfieldvalue>
    <customfieldvalue key="10420"><![CDATA[Regression]]></customfieldvalue>
    <customfieldvalue key="10421"><![CDATA[Seen in production]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 29 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2vden:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>