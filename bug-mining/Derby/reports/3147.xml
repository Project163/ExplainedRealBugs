<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 14:51:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DERBY-6550] Bulk-insert causes identity columns to cycle when they shouldn&apos;t</title>
                <link>https://issues.apache.org/jira/browse/DERBY-6550</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;According to the SQL Standard, an identity column is conceptually backed by a sequence generator. If you don&apos;t specify a cycle option (and for Derby&apos;s identity column, you can&apos;t), then the identity column is supposed to NOT cycle. This is described by the following sections of the 2011 edition of the SQL Standard:&lt;/p&gt;

&lt;p&gt;o Section 11.4 (column definition), syntax rule 16&lt;/p&gt;

&lt;p&gt;o Section 9.26 (Creation of a sequence generator), syntax rule 13&lt;/p&gt;

&lt;p&gt;If you aren&apos;t doing a bulk-insert, then Derby honors this contract. However, due to an optimization in InsertResultSet, this contract is not honored for bigint identity columns. Bulk-insert causes Derby to cycle past the biggest positive long value and to begin generating negative longs.&lt;/p&gt;

&lt;p&gt;The following script shows this behavior:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;connect &apos;jdbc:derby:memory:db;create=true&apos;;

create table t
(
    a bigint generated always as identity ( start with 9223372036854775806 ),
    b int
);

create function integerList() returns table
(
    a int,
    b int,
    c int,
    d int
)
language java parameter style derby_jdbc_result_set no sql
external name &apos;org.apache.derbyTesting.functionTests.tests.lang.MergeStatementTest.integerList_023&apos;;

-- this fails because bulk-insert isn&apos;t used and we go past the end of the identity column&apos;s range
insert into t( b ) values ( 1 ), ( 2 ), ( 3 ), ( 4 ), ( 5 );

-- inserting into an empty table from a table function uses bulk-insert
--
-- this should fail just like the previous statement, but it succeeds
insert into t( b ) select b from table( integerList() ) il;

select * from t;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12710136">DERBY-6550</key>
            <summary>Bulk-insert causes identity columns to cycle when they shouldn&apos;t</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="5">Cannot Reproduce</resolution>
                                        <assignee username="Dnj">Danoja Dias</assignee>
                                    <reporter username="rhillegas">Richard N. Hillegas</reporter>
                        <labels>
                    </labels>
                <created>Wed, 23 Apr 2014 20:34:44 +0000</created>
                <updated>Mon, 1 Aug 2016 06:23:30 +0000</updated>
                            <resolved>Thu, 9 Jun 2016 03:09:27 +0000</resolved>
                                    <version>10.11.1.1</version>
                                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="13978856" author="rhillegas" created="Wed, 23 Apr 2014 20:36:44 +0000"  >&lt;p&gt;Linking to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6542&quot; title=&quot;Improve the concurrency of identity columns by using SYS.SYSSEQUENCES&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6542&quot;&gt;&lt;del&gt;DERBY-6542&lt;/del&gt;&lt;/a&gt; because this bug was discovered while investigating that issue.&lt;/p&gt;</comment>
                            <comment id="15202570" author="sandyridgeracer" created="Sat, 19 Mar 2016 05:16:23 +0000"  >&lt;p&gt;While trying to reproduce the problem, I got the following error:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; ij&amp;gt; insert into t( b ) select b from table( integerList() ) il;
ERROR 42X51: The class &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.derbyTesting.functionTests.tests.lang.MergeStatementTest&apos;&lt;/span&gt; does not exist or is inaccessible. This can happen &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;is not &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt;.
ERROR XJ001: Java exception: &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.derbyTesting.functionTests.tests.lang.MergeStatementTest: java.lang.ClassNotFoundException&apos;&lt;/span&gt;.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A valid error was thrown while trying to insert values by not using bulk-insert. Could you please let me know am I missing something?&lt;/p&gt;</comment>
                            <comment id="15202598" author="bryanpendleton" created="Sat, 19 Mar 2016 06:21:18 +0000"  >&lt;p&gt;It sounds like maybe your CLASSPATH isn&apos;t quite right. I think that if derbyTesting.jar is not in your CLASSPATH, then you&apos;lll get an exception like this.&lt;/p&gt;</comment>
                            <comment id="15202625" author="sandyridgeracer" created="Sat, 19 Mar 2016 07:09:11 +0000"  >&lt;p&gt;Yes Bryan. Correcting the CLASSPATH made it worked. However, while doing bulk-insert it throws a valid error and doesn&apos;t succeed. I have attached the screenshot for the same. Please let me know if I missed something.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Sandeep.&lt;/p&gt;</comment>
                            <comment id="15202869" author="bryanpendleton" created="Sat, 19 Mar 2016 17:29:07 +0000"  >&lt;p&gt;I&apos;m not sure why you&apos;re seeing the behavior captured in your screenshot. I&apos;m having trouble&lt;br/&gt;
reproducing this problem, myself; I keep getting hung up on the CLASSPATH issues.&lt;br/&gt;
...&lt;br/&gt;
UPDATE: I figured out my CLASSPATH problem. I had to have both derbyTesting.jar AND junit.jar in my CLASSPATH, because MergeStatementTest extends junit.framework.Test.&lt;/p&gt;

&lt;p&gt;Now I see the same behavior that Sandeep sees: the insert from the IntegerArrayVTI integerList_023 throws the same &quot;does not cycle&quot; exception that the simple &quot;values&quot; insert throws.&lt;/p&gt;

&lt;p&gt;So I think that means that I can&apos;t reproduce this job at this point, either.&lt;/p&gt;</comment>
                            <comment id="15203173" author="sandyridgeracer" created="Sun, 20 Mar 2016 08:58:32 +0000"  >&lt;p&gt;Yes, I also had to include junit.jar in CLASSPATH to make it work. &lt;br/&gt;
While working on &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6852&quot; title=&quot;Allow identity columns to cycle (as defined in SQL:2003)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6852&quot;&gt;&lt;del&gt;DERBY-6852&lt;/del&gt;&lt;/a&gt;, I will try to find if its reproducible or not. If not, I will try to identify the patch which resolved the problem.&lt;/p&gt;</comment>
                            <comment id="15312313" author="dnj" created="Thu, 2 Jun 2016 13:39:18 +0000"  >&lt;p&gt;I also experienced the same thing as shown in the screen shot. What does that mean? Does this bug no longer exist?&lt;/p&gt;</comment>
                            <comment id="15312318" author="bryanpendleton" created="Thu, 2 Jun 2016 13:46:35 +0000"  >&lt;p&gt;Possibly, but it might also mean that, in the 2 years since Rick first discovered it, the conditions for&lt;br/&gt;
reproducing it have changed, and the simple reproduction script is not sufficient anymore.&lt;/p&gt;

&lt;p&gt;Perhaps the key is in this comment in the repro script:&lt;/p&gt;

&lt;p&gt;    inserting into an empty table from a table function uses bulk-insert&lt;/p&gt;

&lt;p&gt;Maybe that isn&apos;t occurring when we run the reproduction; perhaps for some reason Derby is&lt;br/&gt;
making a different decision about whether to use bulk-insert or not.&lt;/p&gt;

&lt;p&gt;Rick suggested that the decision is made in InsertResultSet; perhaps you could look&lt;br/&gt;
into that code and see if you can determine where it makes the decision about whether&lt;br/&gt;
to use bulk-insert or not?&lt;/p&gt;</comment>
                            <comment id="15312360" author="bryanpendleton" created="Thu, 2 Jun 2016 14:11:18 +0000"  >&lt;p&gt;Another idea is to try the reproduction script against Derby 10.10, 10.11, and 10.12, to see if&lt;br/&gt;
the bug reproduces in an older version. I think 10.10 was the active version at the time this&lt;br/&gt;
job was logged. You can find the older release jars in the &quot;lib&quot; or &quot;lib-debug&quot; downloads from&lt;br/&gt;
&lt;a href=&quot;http://db.apache.org/derby/derby_downloads.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://db.apache.org/derby/derby_downloads.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15313367" author="rhillegas" created="Fri, 3 Jun 2016 00:13:13 +0000"  >&lt;p&gt;I agree that it is quite likely that this bug was fixed as a side-effect of making identity columns be backed by sequence generators.&lt;/p&gt;</comment>
                            <comment id="15313493" author="bryanpendleton" created="Fri, 3 Jun 2016 02:32:32 +0000"  >&lt;p&gt;If none of our additional testing uncovers any evidence that this bug still occurs, perhaps&lt;br/&gt;
a reasonable action plan would be:&lt;/p&gt;

&lt;p&gt;1) Add a new test case to SequenceTest.java or to MergeStatementTest.java,&lt;br/&gt;
    using the repro script of this issue.&lt;br/&gt;
2) Submit the test and mark this issue as resolved.&lt;/p&gt;</comment>
                            <comment id="15317573" author="dnj" created="Tue, 7 Jun 2016 00:46:10 +0000"  >&lt;p&gt;I attached the test that I added to MergeStatementTest.java &lt;/p&gt;</comment>
                            <comment id="15319832" author="bryanpendleton" created="Wed, 8 Jun 2016 01:31:25 +0000"  >&lt;p&gt;I think that, in addition to creating the table, and the function,&lt;br/&gt;
we have to perform the two INSERT statements shown in the&lt;br/&gt;
reproduction script, and verify that they both fail with the expected&lt;br/&gt;
SQLState error.&lt;/p&gt;

&lt;p&gt;We want to make sure that we test that both forms of the INSERT&lt;br/&gt;
statement fail in the same way, since the original bug was that&lt;br/&gt;
one of the INSERT statements unexpectedly succeeded.&lt;/p&gt;

&lt;p&gt;I updated the test to include the INSERT statements, and&lt;br/&gt;
attached it as &quot;updatedTest.diff&quot;.&lt;/p&gt;

&lt;p&gt;Can you please have a look at the updated test and try it&lt;br/&gt;
on your system, and tell me if it seems to be behaving&lt;br/&gt;
properly for you?&lt;/p&gt;</comment>
                            <comment id="15319927" author="dnj" created="Wed, 8 Jun 2016 03:32:40 +0000"  >&lt;p&gt;Yes I should have added it. &lt;br/&gt;
I have missed that.&lt;/p&gt;

&lt;p&gt;I ran the test by running &lt;br/&gt;
ant -Dderby.junit.testclass=org.apache.derbyTesting.functionTests.tests.lang.MergeStatementTest junit-single&lt;/p&gt;

&lt;p&gt;It worked fine.&lt;/p&gt;</comment>
                            <comment id="15320647" author="bryanpendleton" created="Wed, 8 Jun 2016 14:34:20 +0000"  >&lt;p&gt;Hi Danoja, did you have a chance to run the reproduction script against&lt;br/&gt;
the Derby 10.10 or 10.11 builds?&lt;/p&gt;</comment>
                            <comment id="15321723" author="dnj" created="Thu, 9 Jun 2016 00:52:19 +0000"  >&lt;p&gt;Hi Bryan,&lt;/p&gt;

&lt;p&gt;I tried downloading db-derby-10.11.1.1-lib.zip . It does not provide junit.jar and I tried adding existing junit.jar to the classpath. But I had classpath problems when trying to execute the second insert statement.&lt;/p&gt;

&lt;p&gt;Then I tried downloading the 10.11 branch from &lt;a href=&quot;https://svn.apache.org/repos/asf/db/derby/code/branches/10.11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/repos/asf/db/derby/code/branches/10.11&lt;/a&gt;&lt;br/&gt;
After rebuilding that I could able to run it. Results were like the screenshot attached here.&lt;/p&gt;

&lt;p&gt;I think it is okay running like that. &lt;/p&gt;</comment>
                            <comment id="15321824" author="jira-bot" created="Thu, 9 Jun 2016 03:05:41 +0000"  >&lt;p&gt;Commit 1747486 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bryanpendleton&quot; class=&quot;user-hover&quot; rel=&quot;bryanpendleton&quot;&gt;bryanpendleton&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1747486&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1747486&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6550&quot; title=&quot;Bulk-insert causes identity columns to cycle when they shouldn&amp;#39;t&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6550&quot;&gt;&lt;del&gt;DERBY-6550&lt;/del&gt;&lt;/a&gt;: Bulk-insert causes identity columns to cycle when they shouldn&apos;t&lt;/p&gt;

&lt;p&gt;This change was contributed by Danoja Dias (danojadias at gmail dot com)&lt;/p&gt;

&lt;p&gt;Adds a new test case to verify that a bigint identity column correctly&lt;br/&gt;
refuses to cycle when the identity value reaches the maximum value.&lt;/p&gt;</comment>
                            <comment id="15321826" author="bryanpendleton" created="Thu, 9 Jun 2016 03:09:28 +0000"  >&lt;p&gt;We&apos;ve tested this against several recent versions and have persuaded&lt;br/&gt;
ourselves that the problem no longer occurs with the current version.&lt;/p&gt;

&lt;p&gt;We&apos;ve added a new test case to the regression test suite to help&lt;br/&gt;
ensure that the problem does not creep back in.&lt;/p&gt;

&lt;p&gt;Resolving as &quot;Cannot reproduce&quot; because we aren&apos;t 100% certain&lt;br/&gt;
which change resolved the problem (We suspect it was &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6542&quot; title=&quot;Improve the concurrency of identity columns by using SYS.SYSSEQUENCES&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6542&quot;&gt;&lt;del&gt;DERBY-6542&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
that fixed this, though.)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12928849">DERBY-6852</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12708269">DERBY-6542</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12939001">DERBY-6870</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12794326" name="screenshot-1.png" size="740240" author="sandyridgeracer" created="Sat, 19 Mar 2016 07:06:35 +0000"/>
                            <attachment id="12808519" name="test.diff" size="1169" author="Dnj" created="Tue, 7 Jun 2016 00:46:10 +0000"/>
                            <attachment id="12808816" name="updatedTest.diff" size="2146" author="bryanpendleton" created="Wed, 8 Jun 2016 01:31:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10367"><![CDATA[Deviation from standard]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>388458</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 23 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1uwzb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>388713</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>