<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 14:31:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DERBY-5607] Deadlock in Java 5 VM when using NATIVE authentication with a client running in the same VM as the server</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5607</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;A deadlock in the Java 5 VM hangs connection attempts if you are using NATIVE authentication with a client which runs in the same VM as the server. I will attach a test case which demonstrates this. This bug is implicated in the failures being discussed on &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5601&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/DERBY-5601&lt;/a&gt; and was disclosed by the discussion on this email thread: &lt;a href=&quot;http://old.nabble.com/-URGENT--Critical-test-situation-on-trunk-to33259629.html#a33259629&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://old.nabble.com/-URGENT--Critical-test-situation-on-trunk-to33259629.html#a33259629&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The bug arises when NativeAuthenticationServiceImpl attempts a nested connection to the Credentials database during database creation. The nested connection is attempted in order to dertermine whether the user has system-wide privilege to create databases.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12541864">DERBY-5607</key>
            <summary>Deadlock in Java 5 VM when using NATIVE authentication with a client running in the same VM as the server</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rhillegas">Richard N. Hillegas</assignee>
                                    <reporter username="rhillegas">Richard N. Hillegas</reporter>
                        <labels>
                            <label>derby_backport_reject_10_8</label>
                            <label>derby_triage10_9</label>
                    </labels>
                <created>Wed, 8 Feb 2012 19:32:31 +0000</created>
                <updated>Fri, 5 Jul 2013 12:42:48 +0000</updated>
                            <resolved>Fri, 14 Jun 2013 16:50:48 +0000</resolved>
                                    <version>10.9.1.0</version>
                                    <fixVersion>10.9.1.0</fixVersion>
                                    <component>Network Client</component>
                    <component>Network Server</component>
                    <component>Services</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13203884" author="rhillegas" created="Wed, 8 Feb 2012 19:34:14 +0000"  >&lt;p&gt;Attaching NASTHang.java. This short program demonstrates the problem. Make sure that you compile this program at bytecode level 1.5 or earlier so that you can run it on Java 5.&lt;/p&gt;</comment>
                            <comment id="13204010" author="rhillegas" created="Wed, 8 Feb 2012 21:26:40 +0000"  >&lt;p&gt;Attaching derby-5607-01-aa-useInternalDriver.diff. This patch changes the way that the NATIVE authentication service opens a connection to Credentials DB when system-wide privileges need to be authenticated. Previously, the service called in through the Derby DataSources, which in turn called through the JDBC api. The deadlock occurred in that call through the JDBC api which happened inside the user&apos;s original JDBC call. That approach is replaced: now the NATIVE authentication service opens a connection to the Credentials DB using Derby&apos;s own InternalDriver, skipping the need for a nested call through JDBC.&lt;/p&gt;

&lt;p&gt;With this patch, the NASTHang test case now runs correctly on Java 5.&lt;/p&gt;

&lt;p&gt;I have run the NativeAuthenticationServiceTest successfully on the following platforms:&lt;/p&gt;

&lt;p&gt;1) Java 6 on Mac OSX.&lt;/p&gt;

&lt;p&gt;2) Java 5 on Linux.&lt;/p&gt;

&lt;p&gt;3) CDC/FP 1.1 on OJEC.&lt;/p&gt;

&lt;p&gt;On the strength of those successful runs, I have committed this patch at subversion revision 1242105. Let&apos;s see if this fixes the nightly tests on the other Java 5 platforms.&lt;/p&gt;


&lt;p&gt;Touches the following file:&lt;/p&gt;

&lt;p&gt;M       java/engine/org/apache/derby/impl/jdbc/authentication/NativeAuthenticationServiceImpl.java&lt;/p&gt;</comment>
                            <comment id="13210438" author="kmarsden" created="Fri, 17 Feb 2012 18:44:46 +0000"  >&lt;p&gt;Would it make sense to  avoid DriverManager usage in EmbeddedDataSource?&lt;/p&gt;
</comment>
                            <comment id="13210446" author="rhillegas" created="Fri, 17 Feb 2012 19:01:17 +0000"  >&lt;p&gt;Hi Kathey,&lt;/p&gt;

&lt;p&gt;That might make sense and might eliminate other possible deadlocks in the VM. On the other hand, Derby bootstrapping has proven to be very brittle and we would want to think about this carefully. Unless we have evidence that there is another deadlock in there, I would advice caution. Thanks.&lt;/p&gt;</comment>
                            <comment id="13212124" author="kmarsden" created="Mon, 20 Feb 2012 21:55:34 +0000"  >&lt;p&gt;Triage for 10.9. upped priority since it was a hang, but I there has already been a fix checked in for this issue. Is it ready to be resolved?&lt;/p&gt;

</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12541126">DERBY-5601</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12328052">DERBY-866</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12513850" name="NASTHang.java" size="1028" author="rhillegas" created="Wed, 8 Feb 2012 19:34:14 +0000"/>
                            <attachment id="12513864" name="derby-5607-01-aa-userInternalDriver.diff" size="2133" author="rhillegas" created="Wed, 8 Feb 2012 21:26:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10369"><![CDATA[Regression Test Failure]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>227151</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10102"><![CDATA[Patch Available]]></customfieldvalue>
    <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 40 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i06icf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>35906</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>