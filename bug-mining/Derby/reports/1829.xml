<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 14:06:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DERBY-4411] Scalar subquery erroneously rejected for not returning exactly one row</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4411</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;This sequence of statements causes an error because the scalar sub-query supposedly doesn&apos;t return exactly one row, even though it does return exactly one row:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; create table t (x int unique, y int);&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; insert into t values (1,2);&lt;br/&gt;
1 row inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; select * from t where x &amp;gt; (values 1 union select y from t where 1=0);&lt;br/&gt;
ERROR 21000: Scalar subquery is only allowed to return a single row.&lt;br/&gt;
ij&amp;gt; values 1 union select y from t where 1=0;&lt;br/&gt;
1          &lt;br/&gt;
-----------&lt;br/&gt;
1          &lt;/p&gt;

&lt;p&gt;1 row selected&lt;/p&gt;

&lt;p&gt;Before &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4391&quot; title=&quot;NullPointerException when comparing indexed column with result from a set operation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4391&quot;&gt;&lt;del&gt;DERBY-4391&lt;/del&gt;&lt;/a&gt;, the problematic statement would have caused a NullPointerException.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12438246">DERBY-4411</key>
            <summary>Scalar subquery erroneously rejected for not returning exactly one row</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Thu, 15 Oct 2009 20:50:04 +0000</created>
                <updated>Wed, 28 Oct 2009 08:17:45 +0000</updated>
                            <resolved>Wed, 28 Oct 2009 08:17:45 +0000</resolved>
                                    <version>10.5.3.1</version>
                    <version>10.6.1.0</version>
                                    <fixVersion>10.5.3.1</fixVersion>
                    <fixVersion>10.6.1.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12767106" author="knutanders" created="Sun, 18 Oct 2009 18:53:02 +0000"  >&lt;p&gt;When the problematic query is compiled, the byte code for the UnionNode is generated twice. I&apos;m not sure why it&apos;s needed twice in this case, but it looks like the byte code generation in general is prepared for it, so I assume it&apos;s OK for now.&lt;/p&gt;

&lt;p&gt;The right side of the UnionNode contains a ProjectRestrictNode with the predicate 1=0. The first time PRN.generate() is called, predicates are taken out from restrictionList and put into restriction or constantRestriction, depending on the nature of the predicate. restrictionList is nulled out. The second time PRN.generate() is called on the same object, the predicates are supposed to be taken from the restriction and constantRestriction fields instead of the, so all the predicates should be preserved between the invocations.&lt;/p&gt;

&lt;p&gt;However, PRN has a method nopProjectRestrict() which checks whether the PRN actually restricts the result. This method checks if there are predicates restrictionList and restriction. But since 1=0 is a constant expression and has been moved to constantRestriction, the method doesn&apos;t detect that the PRN actually does restrict the result, and the code to restrict the result is not generated.&lt;/p&gt;

&lt;p&gt;The attached patch makes nopProjectRestrict() check the constant restrictions as well. This makes the query return the expected result. The patch does not add any regression tests, nor has any regression tests been run with the patch.&lt;/p&gt;</comment>
                            <comment id="12767226" author="knutanders" created="Mon, 19 Oct 2009 06:34:08 +0000"  >&lt;p&gt;Here&apos;s a new patch with a regression test case added. All the existing regression tests ran cleanly.&lt;/p&gt;</comment>
                            <comment id="12767229" author="knutanders" created="Mon, 19 Oct 2009 06:55:03 +0000"  >&lt;p&gt;Adding 10.5.3.1 to affects versions since &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4391&quot; title=&quot;NullPointerException when comparing indexed column with result from a set operation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4391&quot;&gt;&lt;del&gt;DERBY-4391&lt;/del&gt;&lt;/a&gt; was back-ported, and the bug is now reproducible there. The bug is also present in earlier versions, but &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4391&quot; title=&quot;NullPointerException when comparing indexed column with result from a set operation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4391&quot;&gt;&lt;del&gt;DERBY-4391&lt;/del&gt;&lt;/a&gt; hides it by throwing a NullPointerException when running the repro provided in this issue.&lt;/p&gt;</comment>
                            <comment id="12769195" author="knutanders" created="Fri, 23 Oct 2009 12:24:13 +0000"  >&lt;p&gt;Committed revision 829022.&lt;/p&gt;

&lt;p&gt;I&apos;ll leave the issue open until the fix has been back-ported to 10.5.&lt;/p&gt;</comment>
                            <comment id="12770826" author="knutanders" created="Wed, 28 Oct 2009 08:17:45 +0000"  >&lt;p&gt;Merged fix to 10.5 and committed revision 830457. Closing the issue.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12436909">DERBY-4391</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12422497" name="constantRestriction.diff" size="622" author="knutanders" created="Sun, 18 Oct 2009 18:53:02 +0000"/>
                            <attachment id="12422527" name="derby-4411-1a.diff" size="2711" author="knutanders" created="Mon, 19 Oct 2009 06:34:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24240</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 5 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i06x3z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38298</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>