<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 14:51:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DERBY-6918] Problem with schema name starting with number followed by a dot</title>
                <link>https://issues.apache.org/jira/browse/DERBY-6918</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;It seems that there is a problem with schema names that start with a number followed by a dot.&lt;br/&gt;
Please take a look at the following script. Everything works fine but the last line which is a delete statement. Note that having the foreign key constraints was necessary to make it reproduce the problem.&lt;/p&gt;

&lt;p&gt;create schema &quot;1.a&quot;;&lt;/p&gt;

&lt;p&gt;create table &quot;1.a&quot;.&quot;role&quot;&lt;br/&gt;
(&lt;br/&gt;
&quot;id&quot; integer generated always as identity,&lt;br/&gt;
&quot;name&quot; varchar(255) not null&lt;br/&gt;
);&lt;/p&gt;

&lt;p&gt;alter table &quot;1.a&quot;.&quot;role&quot; add constraint &quot;role_pk&quot;&lt;br/&gt;
primary key (&quot;id&quot;);&lt;/p&gt;

&lt;p&gt;create table &quot;1.a&quot;.&quot;user&quot;&lt;br/&gt;
(&lt;br/&gt;
&quot;id&quot; integer generated always as identity,&lt;br/&gt;
&quot;name&quot; varchar(255) not null&lt;br/&gt;
);&lt;/p&gt;

&lt;p&gt;alter table &quot;1.a&quot;.&quot;user&quot; add constraint &quot;user_pk&quot;&lt;br/&gt;
primary key (&quot;id&quot;);&lt;/p&gt;

&lt;p&gt;create table &quot;1.a&quot;.&quot;user_role&quot;&lt;br/&gt;
(&lt;br/&gt;
&quot;role&quot; integer not null,&lt;br/&gt;
&quot;user&quot; integer not null&lt;br/&gt;
);&lt;/p&gt;

&lt;p&gt;alter table &quot;1.a&quot;.&quot;user_role&quot; add constraint &quot;user_role_fk1&quot;&lt;br/&gt;
foreign key (&quot;role&quot;)&lt;br/&gt;
references &quot;1.a&quot;.&quot;role&quot; (&quot;id&quot;)&lt;br/&gt;
on delete cascade;&lt;/p&gt;

&lt;p&gt;alter table &quot;1.a&quot;.&quot;user_role&quot; add constraint &quot;user_role_fk2&quot;&lt;br/&gt;
foreign key (&quot;user&quot;)&lt;br/&gt;
references &quot;1.a&quot;.&quot;user&quot; (&quot;id&quot;)&lt;br/&gt;
on delete cascade;&lt;/p&gt;

&lt;p&gt;alter table &quot;1.a&quot;.&quot;user_role&quot; add constraint &quot;user_role_u1&quot;&lt;br/&gt;
unique (&quot;user&quot;, &quot;role&quot;);&lt;/p&gt;

&lt;p&gt;insert into &quot;1.a&quot;.&quot;role&quot; (&quot;name&quot;) values (&apos;r1&apos;);&lt;br/&gt;
insert into &quot;1.a&quot;.&quot;user&quot; (&quot;name&quot;) values (&apos;u1&apos;);&lt;br/&gt;
insert into &quot;1.a&quot;.&quot;user_role&quot; (&quot;role&quot;,&quot;user&quot;) values (1,1);&lt;/p&gt;

&lt;p&gt;select * from &quot;1.a&quot;.&quot;user&quot;;&lt;/p&gt;

&lt;p&gt;delete from &quot;1.a&quot;.&quot;user&quot;;&lt;/p&gt;

&lt;p&gt;Last delete statement fails. The error is:&lt;br/&gt;
Schema &apos;1&apos; does not exist &lt;span class=&quot;error&quot;&gt;&amp;#91;SQL State=42Y07, DB Errorcode=20000&amp;#93;&lt;/span&gt; &lt;/p&gt;</description>
                <environment></environment>
        <key id="13023586">DERBY-6918</key>
            <summary>Problem with schema name starting with number followed by a dot</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bryanpendleton">Bryan Pendleton</assignee>
                                    <reporter username="hoomanv">Hooman Valibeigi</reporter>
                        <labels>
                    </labels>
                <created>Sun, 27 Nov 2016 16:38:32 +0000</created>
                <updated>Sun, 4 Dec 2016 08:59:27 +0000</updated>
                            <resolved>Sat, 3 Dec 2016 03:55:59 +0000</resolved>
                                    <version>10.13.1.1</version>
                                    <fixVersion>10.14.1.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15700053" author="bryanpendleton" created="Sun, 27 Nov 2016 17:48:24 +0000"  >&lt;p&gt;Reproduces for me with the current head of trunk.&lt;/p&gt;

&lt;p&gt;Here&apos;s the precise stack trace where the problem occurs:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ERROR 42Y07: Schema &apos;1&apos; does not exist&lt;br/&gt;
	at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:290)&lt;br/&gt;
	at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:285)&lt;br/&gt;
	at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getSchemaDescriptor(DataDictionaryImpl.java:1709)&lt;br/&gt;
	at org.apache.derby.iapi.sql.StatementUtil.getSchemaDescriptor(StatementUtil.java:138)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.QueryTreeNode.getSchemaDescriptor(QueryTreeNode.java:1146)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.QueryTreeNode.getSchemaDescriptor(QueryTreeNode.java:1121)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.TableName.bind(TableName.java:245)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.FromBaseTable.bindNonVTITables(FromBaseTable.java:2338)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.FromList.bindTables(FromList.java:348)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.SelectNode.bindNonVTITables(SelectNode.java:490)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.DMLStatementNode.bindTables(DMLStatementNode.java:190)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.DeleteNode.bindStatement(DeleteNode.java:151)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.DeleteNode.bindStatement(DeleteNode.java:374)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericStatement.prepMinion(GenericStatement.java:401)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericStatement.prepare(GenericStatement.java:99)&lt;br/&gt;
	at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(GenericLanguageConnectionContext.java:1114)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:684)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:632)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.ij.executeImmediate(ij.java:372)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.utilMain.doCatch(utilMain.java:533)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(utilMain.java:375)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:251)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.Main.go(Main.java:229)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:184)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.Main.main(Main.java:75)&lt;br/&gt;
	at org.apache.derby.tools.ij.main(ij.java:59)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It&apos;s possible that the problem arises in this code in DeleteNode.java, where we are&lt;br/&gt;
generating an internal &quot;delete&quot; statement to perform the cascading delete:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;			&lt;span class=&quot;code-comment&quot;&gt;//In &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; of cascade delete , create nodes &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;
&lt;/span&gt;			&lt;span class=&quot;code-comment&quot;&gt;//the ref action  dependent tables and bind them.
&lt;/span&gt;			&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(fkTableNames != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
			{
				&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; currentTargetTableName = targetTableDescriptor.getSchemaName() +
						 &lt;span class=&quot;code-quote&quot;&gt;&quot;.&quot;&lt;/span&gt; + targetTableDescriptor.getName();

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This code does not seem to be properly using delimited identifiers to manage&lt;br/&gt;
the targetTableDescriptor&apos;s schema name and table name; it&apos;s just pasting them&lt;br/&gt;
together, resulting in the simple names &quot;1.a.user&quot; and &quot;1.a.role&quot; being used&lt;br/&gt;
for the generated cascaded deletes. &lt;/p&gt;</comment>
                            <comment id="15700073" author="bryanpendleton" created="Sun, 27 Nov 2016 18:01:58 +0000"  >&lt;p&gt;Yuck. It&apos;s not that simple. Even adjusting the half-dozen places where&lt;br/&gt;
DeleteNode simply pastes together the schema name and table name without&lt;br/&gt;
considering delimited identifiers doesn&apos;t work because there is other&lt;br/&gt;
code that later bursts those names back apart by looking for the first dot:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;	&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; StatementNode getDependentTableNode(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; tableName, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; refAction,
												ColumnDescriptorList cdl) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; StandardException
	{
        DMLModStatementNode node = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;

		&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; index = tableName.indexOf(&lt;span class=&quot;code-quote&quot;&gt;&apos;.&apos;&lt;/span&gt;);
		&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; schemaName = tableName.substring(0 , index);
		&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; tName = tableName.substring(index+1);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So fixing this is a bit of a project.&lt;/p&gt;

&lt;p&gt;Regardless, thanks very much for the clear and precise reproduction script,&lt;br/&gt;
it is VERY helpful!&lt;/p&gt;</comment>
                            <comment id="15700167" author="bryanpendleton" created="Sun, 27 Nov 2016 19:11:58 +0000"  >&lt;p&gt;Attached &quot;schemaNames.diff&quot; is a small patch that&lt;br/&gt;
cleans up the handling of schema names in the&lt;br/&gt;
foreign key maintenance logic in DMLModStatementNode&lt;br/&gt;
and DeleteNode: rather than pasting the schema name&lt;br/&gt;
and table name together, then bursting them back apart,&lt;br/&gt;
the schema name and table name are simply treated&lt;br/&gt;
separately, which seems cleaner and simpler to me.&lt;/p&gt;

&lt;p&gt;The test case from the repro script is also added to the&lt;br/&gt;
regression test suites.&lt;/p&gt;

&lt;p&gt;From a quick scan of the Subversion history, it seems like&lt;br/&gt;
this part of the code dates back to the original donation&lt;br/&gt;
of the Derby code by IBM. So this is old, old code; it&apos;s a&lt;br/&gt;
bit interesting that we hadn&apos;t encountered this problem&lt;br/&gt;
until now. I didn&apos;t take the repro script and hunt back through&lt;br/&gt;
old releases to confirm that it&apos;s &quot;always&quot; been broken, though.&lt;/p&gt;

&lt;p&gt;But if this patch proves to work, it could certainly be&lt;br/&gt;
back-ported to older Derby releases, if anyone so desired.&lt;/p&gt;

&lt;p&gt;I&apos;m running the full set of tests and will report back on my findings.&lt;/p&gt;</comment>
                            <comment id="15700595" author="bryanpendleton" created="Mon, 28 Nov 2016 00:49:10 +0000"  >&lt;p&gt;No problems were revealed by running the complete regression suite.&lt;/p&gt;</comment>
                            <comment id="15717309" author="jira-bot" created="Sat, 3 Dec 2016 03:54:49 +0000"  >&lt;p&gt;Commit 1772428 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bryanpendleton&quot; class=&quot;user-hover&quot; rel=&quot;bryanpendleton&quot;&gt;bryanpendleton&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1772428&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1772428&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6918&quot; title=&quot;Problem with schema name starting with number followed by a dot&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6918&quot;&gt;&lt;del&gt;DERBY-6918&lt;/del&gt;&lt;/a&gt;: Problem with schema name containing a period&lt;/p&gt;

&lt;p&gt;When processing DELETE statements in a database schema including&lt;br/&gt;
referential integrity constraints that specify ON DELETE CASCADE,&lt;br/&gt;
it is easiest to keep the schema name and table name separate,&lt;br/&gt;
rather than pasting them together into a compound name joined with&lt;br/&gt;
a period, because pasting them together results in ambiguity about&lt;br/&gt;
which period separates the schema name from the table name, and&lt;br/&gt;
which period was simply part of the schema name proper.&lt;/p&gt;

&lt;p&gt;Adjusted the logic in DeleteNode and DMLModStatementNode accordingly.&lt;/p&gt;</comment>
                            <comment id="15717312" author="bryanpendleton" created="Sat, 3 Dec 2016 03:55:59 +0000"  >&lt;p&gt;No additional improvements to the patch occurred to me over the&lt;br/&gt;
last few days, so I&apos;ve committed it to the trunk and resolved the job.&lt;/p&gt;</comment>
                            <comment id="15717792" author="hoomanv" created="Sat, 3 Dec 2016 09:31:34 +0000"  >&lt;p&gt;Bryan thanks a lot for fixing this.&lt;br/&gt;
Is it possible to release it as a hotfix for 10.13? Otherwise we have to wait for 10.14 to be released on maven central.&lt;/p&gt;</comment>
                            <comment id="15718844" author="jira-bot" created="Sat, 3 Dec 2016 22:28:34 +0000"  >&lt;p&gt;Commit 1772493 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bryanpendleton&quot; class=&quot;user-hover&quot; rel=&quot;bryanpendleton&quot;&gt;bryanpendleton&lt;/a&gt; in branch &apos;code/branches/10.13&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1772493&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1772493&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6918&quot; title=&quot;Problem with schema name starting with number followed by a dot&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6918&quot;&gt;&lt;del&gt;DERBY-6918&lt;/del&gt;&lt;/a&gt;: Problem with schema name containing a period&lt;/p&gt;

&lt;p&gt;Merged: svn merge -r 1772427:1772428 &lt;a href=&quot;https://svn.apache.org/repos/asf/db/derby/code/trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/repos/asf/db/derby/code/trunk&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;No merge conflicts; no additional changes.&lt;/p&gt;</comment>
                            <comment id="15718848" author="bryanpendleton" created="Sat, 3 Dec 2016 22:30:14 +0000"  >&lt;p&gt;The code merge was straightforward, so I&apos;ve merged the fix back to 10.13&lt;br/&gt;
and committed it.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure when the next release from the 10.13 branch might occur;&lt;br/&gt;
one thing that would help would be if you could build a copy of 10.13&lt;br/&gt;
from source yourself, and perform some additional testing to verify&lt;br/&gt;
that this fix is working properly in your environment.&lt;/p&gt;
</comment>
                            <comment id="15719604" author="hoomanv" created="Sun, 4 Dec 2016 08:59:27 +0000"  >&lt;p&gt;Thank you&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12840591" name="schemaNames.diff" size="6671" author="bryanpendleton" created="Sun, 27 Nov 2016 19:11:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 50 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i36thr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>