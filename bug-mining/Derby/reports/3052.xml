<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 14:48:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DERBY-6701] Instability in RuntimeInfoTest.x_testRuntimeInfoAfterConnClose</title>
                <link>https://issues.apache.org/jira/browse/DERBY-6701</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;I have seen variations of the following error twice in the past 2 days: once on the 10.12 trunk while testing the fix to derby-6692 and then again on the 10.11.1.1 release candidate while running the tests without the Lucene jar files.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;1) testRunTests(org.apache.derbyTesting.functionTests.tests.derbynet.RuntimeInfoTest)junit.framework.ComparisonFailure: Output doesn&apos;t match expected:&amp;lt;...-----
Sessionnummer:[8


-------------------------------------------------------------
Anzahl Verbindungsthreads: 4
Anzahl aktive Sessions: 1]
Anzahl wartende Ses...&amp;gt; but was:&amp;lt;...-----
Sessionnummer:[5
Datenbank:singleUse/oneuse5
Benutzer:APP
Anzahl Anweisungen:2
Informationen zur vorbereiteten Anweisung: 
	Anwsg-ID		SQL-Text
	-------------	-----------
	null
	null



Sessionnummer:8


-------------------------------------------------------------
Anzahl Verbindungsthreads: 4
Anzahl aktive Sessions: 2]
Anzahl wartende Ses...&amp;gt;
	at org.apache.derbyTesting.functionTests.tests.derbynet.RuntimeInfoTest.x_testRuntimeInfoAfterConnClose(RuntimeInfoTest.java:192)
	at org.apache.derbyTesting.functionTests.tests.derbynet.RuntimeInfoTest.testRunTests(RuntimeInfoTest.java:97)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:118)
	at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBareOverridable(BaseJDBCTestCase.java:440)
	at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBare(BaseJDBCTestCase.java:457)
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)
	at junit.extensions.TestSetup.run(TestSetup.java:25)
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)
	at junit.extensions.TestSetup.run(TestSetup.java:25)
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)
	at junit.extensions.TestSetup.run(TestSetup.java:25)
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)
	at junit.extensions.TestSetup.run(TestSetup.java:25)
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)
	at junit.extensions.TestSetup.run(TestSetup.java:25)
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)
	at junit.extensions.TestSetup.run(TestSetup.java:25)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>mac osx 10.7.5, jdk1.8.0-b132</environment>
        <key id="12732825">DERBY-6701</key>
            <summary>Instability in RuntimeInfoTest.x_testRuntimeInfoAfterConnClose</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="rhillegas">Richard N. Hillegas</reporter>
                        <labels>
                    </labels>
                <created>Fri, 8 Aug 2014 12:50:19 +0000</created>
                <updated>Fri, 9 Sep 2016 09:51:17 +0000</updated>
                            <resolved>Fri, 22 Aug 2014 12:19:10 +0000</resolved>
                                    <version>10.11.1.1</version>
                    <version>10.12.1.1</version>
                                    <fixVersion>10.12.1.1</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14090735" author="rhillegas" created="Fri, 8 Aug 2014 13:00:33 +0000"  >&lt;p&gt;This may be a red herring: The second instance of this error (when running the tests without the Lucene jars) happened during a test run which tripped over a &apos;Metaspace: java.lang.OutOfMemoryError&apos;.&lt;/p&gt;</comment>
                            <comment id="14090772" author="rhillegas" created="Fri, 8 Aug 2014 13:56:06 +0000"  >&lt;p&gt;Linking to derby-1455. The header comment for the method points us at derby-1455 and the symptoms look similar. The solution to derby-1455 was to make the thread sleep for a second before checking the server state. Maybe we need to sleep an additional second.&lt;/p&gt;</comment>
                            <comment id="14090787" author="rhillegas" created="Fri, 8 Aug 2014 14:09:43 +0000"  >&lt;p&gt;Attaching derby-6701-01-aa-increaseSleepTime.diff. This increases the sleep time to 2 seconds. The test runs cleanly for me with this setting.&lt;/p&gt;

&lt;p&gt;I think it&apos;s probably harmless to commit this patch. However, I have no confidence that it actually fixes the problem. There&apos;s no guarantee that an additional second is what&apos;s needed. It is suspicious that this error has cropped up only recently. What&apos;s going on? An extra long garbage collection burp? And why?&lt;/p&gt;

&lt;p&gt;On the other hand, the 1 second sleep was added by derby-1455 8 years ago. Maybe napping for an additional second every 8 years is the best we can do.&lt;/p&gt;

&lt;p&gt;Other thoughts?&lt;/p&gt;

&lt;p&gt;Touches the following file:&lt;/p&gt;

&lt;p&gt;M       java/testing/org/apache/derbyTesting/functionTests/tests/derbynet/RuntimeInfoTest.java&lt;/p&gt;</comment>
                            <comment id="14093964" author="knutanders" created="Tue, 12 Aug 2014 11:09:19 +0000"  >&lt;p&gt;It sounds likely that the cause of the failure is the same as &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1455&quot; title=&quot;Intermittent failure in derbynet/runtimeinfo.java&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1455&quot;&gt;&lt;del&gt;DERBY-1455&lt;/del&gt;&lt;/a&gt;. There is a race condition between the server logic that closes sessions for disconnected clients, and the test code that calls getRuntimeInfo().&lt;/p&gt;

&lt;p&gt;When a client closes a connection, it doesn&apos;t send a &quot;close connection&quot; command to the server and block till the server has done the cleanup. It just closes the socket, and goes on to it&apos;s next tasks. The server thread doesn&apos;t clean up the session until it gets an exception when reading from the socket, so the client may already have called getRuntimeInfo() before the session is removed.&lt;/p&gt;

&lt;p&gt;Waiting longer in the test before calling getRuntimeInfo() makes it less likely to fail. But it&apos;s hard to tell how long is long enough. And increasing the length of the nap makes the test use longer time even in the common case where a nap is not needed. Maybe we could add some retry logic that keeps calling getRuntimeInfo() until it returns the expected output. Then we wouldn&apos;t need to sleep in the common case, and we&apos;d sleep as long as necessary in the cases where the session cleanup code loses the race.&lt;/p&gt;</comment>
                            <comment id="14094031" author="knutanders" created="Tue, 12 Aug 2014 12:53:56 +0000"  >&lt;p&gt;The attached patch &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12661210/12661210_retry.diff&quot; title=&quot;retry.diff attached to DERBY-6701&quot;&gt;retry.diff&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; implements the alternative approach, where we retry until we get the expected response from the getRuntimeInfo() call. It had to filter out the session number from the output, because that number will increase when the call is retried.&lt;/p&gt;

&lt;p&gt;I don&apos;t have any theories on why this popped up just now, though.&lt;/p&gt;</comment>
                            <comment id="14106765" author="jira-bot" created="Fri, 22 Aug 2014 12:18:49 +0000"  >&lt;p&gt;Commit 1619776 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knutanders&quot; class=&quot;user-hover&quot; rel=&quot;knutanders&quot;&gt;knutanders&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1619776&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1619776&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6701&quot; title=&quot;Instability in RuntimeInfoTest.x_testRuntimeInfoAfterConnClose&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6701&quot;&gt;&lt;del&gt;DERBY-6701&lt;/del&gt;&lt;/a&gt;: Instability in RuntimeInfoTest.x_testRuntimeInfoAfterConnClose&lt;/p&gt;

&lt;p&gt;Keep calling getRuntimeInfo() for up to a minute until it gives the&lt;br/&gt;
expected response.&lt;/p&gt;</comment>
                            <comment id="14110749" author="knutanders" created="Tue, 26 Aug 2014 14:26:14 +0000"  >&lt;p&gt;If the fix for this issue is backported, &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6714&quot; title=&quot;RuntimeInfoTest failed with insufficient data from server&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6714&quot;&gt;&lt;del&gt;DERBY-6714&lt;/del&gt;&lt;/a&gt; should also be backported. The fix for this issue makes &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6714&quot; title=&quot;RuntimeInfoTest failed with insufficient data from server&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6714&quot;&gt;&lt;del&gt;DERBY-6714&lt;/del&gt;&lt;/a&gt; more likely to be exposed by the test.&lt;/p&gt;</comment>
                            <comment id="15476510" author="knutanders" created="Fri, 9 Sep 2016 09:51:17 +0000"  >&lt;p&gt;[ Automatically closing all resolved issues that haven&apos;t been updated in more than six months. ]&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12732287">DERBY-6692</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12344904">DERBY-1455</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12736741">DERBY-6714</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12660630" name="derby-6701-01-aa-increaseSleepTime.diff" size="798" author="rhillegas" created="Fri, 8 Aug 2014 14:09:43 +0000"/>
                            <attachment id="12661210" name="retry.diff" size="5913" author="knutanders" created="Tue, 12 Aug 2014 12:53:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10369"><![CDATA[Regression Test Failure]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>410853</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 10 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1yop3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>410846</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>