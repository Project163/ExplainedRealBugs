<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 14:51:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DERBY-6961] SET CYCLE fails to let an identity column cycle if the range is already exhausted</title>
                <link>https://issues.apache.org/jira/browse/DERBY-6961</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;If a NO CYCLE identity column exhausts its range, then...&lt;/p&gt;

&lt;p&gt;  ALTER TABLE ALTER COLUMN $columnName SET CYCLE&lt;/p&gt;

&lt;p&gt;...will not revive the identity column. No more rows can be inserted into the table. This violates the SQL Standard and is very surprising behavior after the ALTER TABLE command completed successfully.&lt;/p&gt;

&lt;p&gt;The problem is that the exhausted sequence generator has a next value of NULL, signifying that it is done. After the ALTER TABLE command, the next value of the sequence generator should be the minimum value (for an ascending sequence generator) or the maximum value (for a descending sequence generator) according to the 2016 SQL Standard, section 4.27.2 (Operations involving sequence generators), quoted here in full:&lt;/p&gt;

&lt;p&gt;&quot;When a &amp;lt;next value expression&amp;gt; is applied to a sequence generator SG, SG issues a value V taken from SG&apos;s current cycle such that V is expressible as the current base value of SG plus N multiplied by the increment of SG, where N is a non-negative number.&lt;/p&gt;

&lt;p&gt;Thus a sequence generator will normally issue all of the values in its cycle and these will normally be in increasing or decreasing order (depending on the sign of the increment) but within that general ordering separate subgroups of ordered values may occur.&lt;/p&gt;

&lt;p&gt;If the sequence generator&apos;s cycle is exhausted (i.e., it cannot issue a value that meets the criteria), then a new cycle is created with the current base value set to the minimum value of SG (if SG is an ascending sequence generator) or the maximum value of SG (if SG is a descending sequence generator).&lt;/p&gt;

&lt;p&gt;If a new cycle is created and the descriptor of SG includes NOCYCLE, then an exception condition is raised.&lt;/p&gt;

&lt;p&gt;If there are multiple instances of &amp;lt;next value expression&amp;gt;s specifying the same sequence generator within a single SQL-statement, all those instances return the same value for a given row processed by that SQL-statement.&quot;&lt;/p&gt;


&lt;p&gt;The following script shows this problem:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;connect &apos;jdbc:derby:memory:db;create=true&apos;;

------------------------------------------------
--
-- Exhaust a NO CYCLE identity column.
-- SET CYCLE does not allow the sequence generator
-- to continue processing.
--
------------------------------------------------

create table t_noCycleExhaust(a int generated always as identity (start with 2147483646 no cycle), b int);
values syscs_util.syscs_peek_at_identity(&apos;APP&apos;, &apos;T_NOCYCLEEXHAUST&apos;);

insert into t_noCycleExhaust(b) values (1);
values syscs_util.syscs_peek_at_identity(&apos;APP&apos;, &apos;T_NOCYCLEEXHAUST&apos;);
insert into t_noCycleExhaust(b) values (2);
-- the sequence generator has NULL as its next value
values syscs_util.syscs_peek_at_identity(&apos;APP&apos;, &apos;T_NOCYCLEEXHAUST&apos;);

-- should fail
insert into t_noCycleExhaust(b) values (3);
values syscs_util.syscs_peek_at_identity(&apos;APP&apos;, &apos;T_NOCYCLEEXHAUST&apos;);
select * from t_noCycleExhaust order by b;

alter table t_noCycleExhaust alter column a set cycle;
-- the sequence generator still has NULL as its next value. this is the bug.
values syscs_util.syscs_peek_at_identity(&apos;APP&apos;, &apos;T_NOCYCLEEXHAUST&apos;);

-- incorrectly fails
insert into t_noCycleExhaust(b) values (3);
values syscs_util.syscs_peek_at_identity(&apos;APP&apos;, &apos;T_NOCYCLEEXHAUST&apos;);
select * from t_noCycleExhaust order by b;


------------------------------------------------
--
-- Do NOT exhaust a NO CYCLE identity column.
-- Then SET CYCLE. The sequence generator will
-- wrap around.
--
------------------------------------------------

create table t_noCycleDoNotExhaust(a int generated always as identity (start with 2147483646 no cycle), b int);
values syscs_util.syscs_peek_at_identity(&apos;APP&apos;, &apos;T_NOCYCLEDONOTEXHAUST&apos;);

insert into t_noCycleDoNotExhaust(b) values (1);
values syscs_util.syscs_peek_at_identity(&apos;APP&apos;, &apos;T_NOCYCLEDONOTEXHAUST&apos;);

alter table t_noCycleDoNotExhaust alter column a set cycle;
values syscs_util.syscs_peek_at_identity(&apos;APP&apos;, &apos;T_NOCYCLEDONOTEXHAUST&apos;);

insert into t_noCycleDoNotExhaust(b) values (2);
values syscs_util.syscs_peek_at_identity(&apos;APP&apos;, &apos;T_NOCYCLEDONOTEXHAUST&apos;);
insert into t_noCycleDoNotExhaust(b) values (3);
values syscs_util.syscs_peek_at_identity(&apos;APP&apos;, &apos;T_NOCYCLEDONOTEXHAUST&apos;);
select * from t_noCycleDoNotExhaust order by b;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13101837">DERBY-6961</key>
            <summary>SET CYCLE fails to let an identity column cycle if the range is already exhausted</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rhillegas">Richard N. Hillegas</assignee>
                                    <reporter username="rhillegas">Richard N. Hillegas</reporter>
                        <labels>
                    </labels>
                <created>Wed, 13 Sep 2017 02:15:13 +0000</created>
                <updated>Mon, 18 Sep 2017 02:56:34 +0000</updated>
                            <resolved>Mon, 18 Sep 2017 01:31:31 +0000</resolved>
                                    <version>10.14.1.0</version>
                                    <fixVersion>10.14.1.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16164078" author="bryanpendleton" created="Wed, 13 Sep 2017 03:00:24 +0000"  >&lt;p&gt;Thanks for catching this, Rick.&lt;/p&gt;

&lt;p&gt;I definitely don&apos;t think this was intentional behavior. I think we just missed it during the implementation and testing.&lt;/p&gt;

&lt;p&gt;Does it seem hard to fix?&lt;/p&gt;</comment>
                            <comment id="16165546" author="rhillegas" created="Thu, 14 Sep 2017 00:51:36 +0000"  >&lt;p&gt;Hey Bryan,&lt;/p&gt;

&lt;p&gt;I haven&apos;t looked at the code. But I think that it should be easy to fix. The underlying sequence generator needs to be queried, the value in the system tables needs to be updated, and the sequence generator needs to be destroyed so that it can be recreated after the DBA commits the transaction which runs the ALTER TABLE command.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
-Rick&lt;/p&gt;</comment>
                            <comment id="16165588" author="rhillegas" created="Thu, 14 Sep 2017 01:21:55 +0000"  >&lt;p&gt;Here&apos;s another, similar problem: If a CYCLE identity column is on the verge of wrapping around and then the column is ALTERed to NO CYCLE, then the next insert into the table should fail. But that insert succeeds, incorrectly. The following script shows this:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;connect &apos;jdbc:derby:memory:db;create=true&apos;;

create table t1(a int generated always as identity (start with 2147483646 cycle), b int);
insert into t1(b) values (1);
alter table t1 alter column a set no cycle;
insert into t1(b) values (2);
-- fails as expected
insert into t1(b) values (3);

select * from t1 order by b;

------

create table t2(a int generated always as identity (start with 2147483646 cycle), b int);
insert into t2(b) values (1);
insert into t2(b) values (2);
alter table t2 alter column a set no cycle;

-- should fail but does not
insert into t2(b) values (3);

select * from t2 order by b;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16169465" author="rhillegas" created="Sun, 17 Sep 2017 23:39:15 +0000"  >&lt;p&gt;Attaching derby-6961-01-aa-recyclingExhaustedIdentityColumns.diff. This patch addresses both of the problems scripted above. I am running full tests now.&lt;/p&gt;

&lt;p&gt;Touches the following files:&lt;/p&gt;

&lt;p&gt;---------------------------&lt;/p&gt;

&lt;p&gt;M       java/engine/org/apache/derby/impl/sql/execute/AlterTableConstantAction.java&lt;/p&gt;

&lt;p&gt;Correctly handle ALTER TABLE...SET &lt;span class=&quot;error&quot;&gt;&amp;#91;NO&amp;#93;&lt;/span&gt; CYCLE for exhausted identity columns which are at their rollover point.&lt;/p&gt;

&lt;p&gt;---------------------------&lt;/p&gt;

&lt;p&gt;M       java/testing/org/apache/derbyTesting/functionTests/tests/lang/AlterTableTest.java&lt;/p&gt;

&lt;p&gt;Tests.&lt;/p&gt;</comment>
                            <comment id="16169497" author="rhillegas" created="Mon, 18 Sep 2017 01:29:23 +0000"  >&lt;p&gt;Tests passed cleanly on derby-6961-01-aa-recyclingExhaustedIdentityColumns.diff.&lt;/p&gt;</comment>
                            <comment id="16169500" author="jira-bot" created="Mon, 18 Sep 2017 01:31:09 +0000"  >&lt;p&gt;Commit 1808668 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhillegas&quot; class=&quot;user-hover&quot; rel=&quot;rhillegas&quot;&gt;rhillegas&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1808668&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1808668&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6961&quot; title=&quot;SET CYCLE fails to let an identity column cycle if the range is already exhausted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6961&quot;&gt;&lt;del&gt;DERBY-6961&lt;/del&gt;&lt;/a&gt;: Correctly handle ALTER TABLE...SET &lt;span class=&quot;error&quot;&gt;&amp;#91;NO&amp;#93;&lt;/span&gt; CYCLE on exhausted identity columns; commit derby-6961-01-aa-recyclingExhaustedIdentityColumns.diff.&lt;/p&gt;</comment>
                            <comment id="16169532" author="bryanpendleton" created="Mon, 18 Sep 2017 02:56:34 +0000"  >&lt;p&gt;Thanks Rick! It&apos;s good to see that it was more-or-less as straightforward as you were hoping.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12997160">DERBY-6904</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12887573" name="derby-6961-01-aa-recyclingExhaustedIdentityColumns.diff" size="17624" author="rhillegas" created="Sun, 17 Sep 2017 23:38:51 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 9 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3jzyn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10050"><![CDATA[Blocker]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>