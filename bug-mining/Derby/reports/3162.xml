<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 14:51:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DERBY-6968] Instability in DatabaseMetaDataTest.testGetBestRowIdentifier</title>
                <link>https://issues.apache.org/jira/browse/DERBY-6968</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Ingo reports instabilities in his platform tests of the 10.14.1.0 release candidate. He sees intermittent failures in DatabaseMetaDataTest.testGetBestRowIdentifier and then subsequent failures due to poor test case isolation in that test. The test case fails because DatabaseMetaData.getBestRowIdentifier() sometimes returns rows in a different order than the test expects.&lt;/p&gt;

&lt;p&gt;The JDBC contract for that method does not specify an order for the returned rows. ORDER BY clauses appear on some but not all the catalog queries in metadata.properties which define the Derby result.&lt;/p&gt;

&lt;p&gt;I see two ways to address this issue:&lt;/p&gt;

&lt;p&gt;1) The test could be fixed so that it hand-sorts the returned rows in order to guarantee deterministic results.&lt;/p&gt;

&lt;p&gt;2) ORDER BY clauses could be added to all the implicated metadata queries.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13107710">DERBY-6968</key>
            <summary>Instability in DatabaseMetaDataTest.testGetBestRowIdentifier</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rhillegas">Richard N. Hillegas</reporter>
                        <labels>
                    </labels>
                <created>Sat, 7 Oct 2017 14:07:10 +0000</created>
                <updated>Sun, 8 Oct 2017 22:32:15 +0000</updated>
                                            <version>10.14.1.0</version>
                                                    <component>JDBC</component>
                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16195713" author="rhillegas" created="Sat, 7 Oct 2017 14:09:11 +0000"  >&lt;p&gt;Attaching 10.14.1.testResults.0-failures, a survey of the errors which Ingo saw.&lt;/p&gt;</comment>
                            <comment id="16195790" author="bryanpendleton" created="Sat, 7 Oct 2017 16:56:41 +0000"  >&lt;p&gt;Our results aren&apos;t ordered at all? Or they are only partially ordered?&lt;/p&gt;

&lt;p&gt;The spec says: &quot;They are ordered by SCOPE.&quot;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://docs.oracle.com/javase/7/docs/api/java/sql/DatabaseMetaData.html#getBestRowIdentifier(java.lang.String,%20java.lang.String,%20java.lang.String,%20int,%20boolean&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.oracle.com/javase/7/docs/api/java/sql/DatabaseMetaData.html#getBestRowIdentifier(java.lang.String,%20java.lang.String,%20java.lang.String,%20int,%20boolean&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;So if we aren&apos;t ordering our results by the SCOPE column, that certainly seems incorrect.&lt;/p&gt;

&lt;p&gt;Regarding your two suggestions, my instinct is to prefer improving the engine implementation over improving the test. I can&apos;t immediately think of a downside to making our implementation of getBestRowIdentifier deliver a tighter ordering than it currently does.&lt;/p&gt;

&lt;p&gt;That said, I&apos;ve never used getBestRowIdentifier, and the JDBC spec itself certainly doesn&apos;t provide much intuition about why I would want to, nor did I find any useful examples in a few minutes of idle searching. What the heck is this method used for, and why?&lt;/p&gt;</comment>
                            <comment id="16196273" author="rhillegas" created="Sun, 8 Oct 2017 18:31:39 +0000"  >&lt;p&gt;Hey Bryan,&lt;/p&gt;

&lt;p&gt;Thanks for pointing out the ordering on the SCOPE column. The queries are not ordered by returned column name, which is what the test needs. They are not ordered by SCOPE either.&lt;/p&gt;

&lt;p&gt;I can only guess at the purpose served by getBestRowIdentifier(). Maybe object-relational-mappers use the method in order to dream up object identifiers for updating/deleting rows in databases which don&apos;t have a system-supplied ROWID pseudo column. The following link was slightly useful: &lt;a href=&quot;http://media.datadirect.com/download/docs/jdbc/alljdbc/index.html#page/jdbcconnect/using-getbestrowidentifier.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://media.datadirect.com/download/docs/jdbc/alljdbc/index.html#page/jdbcconnect/using-getbestrowidentifier.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Adding an ordering by SCOPE to DatabaseMetaData.getBestRowIdentifier() is probably warranted since it would bring us into better compliance with the JDBC contract. I don&apos;t think that it will improve the behavior of this test, though. I do see that similar problems were addressed by &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6623&quot; title=&quot;DatabaseMetaDataTest fails intermittently&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6623&quot;&gt;&lt;del&gt;DERBY-6623&lt;/del&gt;&lt;/a&gt;. For those problems, Dag had another solution, a variation on (1):&lt;/p&gt;

&lt;p&gt;3) Use JDBC.assertUnorderedResultSet()&lt;/p&gt;

&lt;p&gt;Changing the order of the results returned by DatabaseMetaData.getBestRowIdentifier() would probably break the upgrade tests. That is because they end up running the current DatabaseMetaDataTest against old engines, and the old engines would still be returning results in the old order. We would still need to do (1) or (3) I think.&lt;/p&gt;</comment>
                            <comment id="16196290" author="rhillegas" created="Sun, 8 Oct 2017 19:11:43 +0000"  >&lt;p&gt;Attaching derby-6968-01-aa-assertUnorderedResultSet.diff. This patch changes the result set verifiers in DatabaseMetaDataTest.getBestRowIdentifier() to call JDBC.assertUnorderedResultSet(). The test runs cleanly for me--but then it ran cleanly for me without the patch too. The upgrade tests also ran cleanly, using 10.14.1.0 as the starting point. I will run full regression tests.&lt;/p&gt;

&lt;p&gt;Touches the following file:&lt;/p&gt;

&lt;p&gt;M       java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/DatabaseMetaDataTest.java&lt;/p&gt;</comment>
                            <comment id="16196319" author="bryanpendleton" created="Sun, 8 Oct 2017 20:13:29 +0000"  >&lt;p&gt;That patch looks fine to me, thanks for taking care of this. +1 from me.&lt;/p&gt;

&lt;p&gt;Perhaps we should file a separate issue to track the apparent mismatch with the spec (ordering on SCOPE)?&lt;/p&gt;</comment>
                            <comment id="16196344" author="rhillegas" created="Sun, 8 Oct 2017 22:07:17 +0000"  >&lt;p&gt;Thanks for the quick review, Bryan. Tests passed cleanly for me on derby-6968-01-aa-assertUnorderedResultSet.diff.&lt;/p&gt;</comment>
                            <comment id="16196347" author="jira-bot" created="Sun, 8 Oct 2017 22:12:46 +0000"  >&lt;p&gt;Commit 1811510 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhillegas&quot; class=&quot;user-hover&quot; rel=&quot;rhillegas&quot;&gt;rhillegas&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1811510&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1811510&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6968&quot; title=&quot;Instability in DatabaseMetaDataTest.testGetBestRowIdentifier&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6968&quot;&gt;DERBY-6968&lt;/a&gt;: Attempt to fix instability in DatabaseMetaDataTest.getBestRowIdentifier(); commit derby-6968-01-aa-assertUnorderedResultSet.diff.&lt;/p&gt;</comment>
                            <comment id="16196356" author="jira-bot" created="Sun, 8 Oct 2017 22:32:15 +0000"  >&lt;p&gt;Commit 1811511 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhillegas&quot; class=&quot;user-hover&quot; rel=&quot;rhillegas&quot;&gt;rhillegas&lt;/a&gt; in branch &apos;code/branches/10.14&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1811511&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1811511&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6968&quot; title=&quot;Instability in DatabaseMetaDataTest.testGetBestRowIdentifier&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6968&quot;&gt;DERBY-6968&lt;/a&gt;: Port 1811510 from trunk to 10.14 branch.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12722341">DERBY-6623</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13107867">DERBY-6969</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12890864" name="10.14.1.testResults.0-failures" size="30205" author="rhillegas" created="Sat, 7 Oct 2017 14:08:45 +0000"/>
                            <attachment id="12890981" name="derby-6968-01-aa-assertUnorderedResultSet.diff" size="1608" author="rhillegas" created="Sun, 8 Oct 2017 19:11:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 6 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3kzxj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>