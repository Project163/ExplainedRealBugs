{"url":"https://api.github.com/repos/airbnb/lottie-android/issues/1798","repository_url":"https://api.github.com/repos/airbnb/lottie-android","labels_url":"https://api.github.com/repos/airbnb/lottie-android/issues/1798/labels{/name}","comments_url":"https://api.github.com/repos/airbnb/lottie-android/issues/1798/comments","events_url":"https://api.github.com/repos/airbnb/lottie-android/issues/1798/events","html_url":"https://github.com/airbnb/lottie-android/issues/1798","id":868461947,"node_id":"MDU6SXNzdWU4Njg0NjE5NDc=","number":1798,"title":"Memory leak in LottieAnimationView","user":{"login":"serializer","id":31654207,"node_id":"MDQ6VXNlcjMxNjU0MjA3","avatar_url":"https://avatars.githubusercontent.com/u/31654207?v=4","gravatar_id":"","url":"https://api.github.com/users/serializer","html_url":"https://github.com/serializer","followers_url":"https://api.github.com/users/serializer/followers","following_url":"https://api.github.com/users/serializer/following{/other_user}","gists_url":"https://api.github.com/users/serializer/gists{/gist_id}","starred_url":"https://api.github.com/users/serializer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/serializer/subscriptions","organizations_url":"https://api.github.com/users/serializer/orgs","repos_url":"https://api.github.com/users/serializer/repos","events_url":"https://api.github.com/users/serializer/events{/privacy}","received_events_url":"https://api.github.com/users/serializer/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1460035932,"node_id":"MDU6TGFiZWwxNDYwMDM1OTMy","url":"https://api.github.com/repos/airbnb/lottie-android/labels/Non-Rendering%20Bug","name":"Non-Rendering Bug","color":"186199","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2021-04-27T05:11:13Z","updated_at":"2021-07-03T22:12:54Z","closed_at":"2021-07-03T22:12:54Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Lottie Version - 3.7.0\r\nAndroid - SDK 30\r\n\r\nI am using LottieAnimationView in a fragment (bottom sheet) and getting a memory leak in Lottie when the parent activity get destroyed after `onBackPressed()`. The animation in the view is populated through a URL.\r\nProbably it's due to passing short-lived context (activity) to long process (fetching animation from network fetcher). Maybe passing an `applicationcontext` or `WeakReference` can fix it.\r\n\r\n**Leak trace in Leak Canary**\r\n```\r\n├─ com.airbnb.lottie.L class\r\n│    Leaking: NO (a class is never leaking)\r\n│    ↓ static L.networkCache\r\n│               ~~~~~~~~~~~~\r\n├─ com.airbnb.lottie.network.NetworkCache instance\r\n│    Leaking: UNKNOWN\r\n│    Retaining 10.3 MB in 205549 objects\r\n│    ↓ NetworkCache.cacheProvider\r\n│                   ~~~~~~~~~~~~~\r\n├─ com.airbnb.lottie.L$1 instance\r\n│    Leaking: UNKNOWN\r\n│    Retaining 10.3 MB in 205548 objects\r\n│    Anonymous class implementing com.airbnb.lottie.network.\r\n│    LottieNetworkCacheProvider\r\n│    val$context instance of android.view.ContextThemeWrapper, wrapping\r\n│    activity MyActivity\r\n│    with mDestroyed = true\r\n│    ↓ L$1.val$context\r\n│          ~~~~~~~~~~~\r\n├─ android.view.ContextThemeWrapper instance\r\n│    Leaking: YES (ContextThemeWrapper wraps an Activity with Activity.\r\n│    mDestroyed true)\r\n│    Retaining 10.3 MB in 205547 objects\r\n│    mBase instance of android.view.ContextThemeWrapper, wrapping activity MyActivity with mDestroyed\r\n│    = true\r\n│    ↓ ContextWrapper.mBase\r\n```","closed_by":{"login":"gpeal","id":1307745,"node_id":"MDQ6VXNlcjEzMDc3NDU=","avatar_url":"https://avatars.githubusercontent.com/u/1307745?v=4","gravatar_id":"","url":"https://api.github.com/users/gpeal","html_url":"https://github.com/gpeal","followers_url":"https://api.github.com/users/gpeal/followers","following_url":"https://api.github.com/users/gpeal/following{/other_user}","gists_url":"https://api.github.com/users/gpeal/gists{/gist_id}","starred_url":"https://api.github.com/users/gpeal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gpeal/subscriptions","organizations_url":"https://api.github.com/users/gpeal/orgs","repos_url":"https://api.github.com/users/gpeal/repos","events_url":"https://api.github.com/users/gpeal/events{/privacy}","received_events_url":"https://api.github.com/users/gpeal/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/airbnb/lottie-android/issues/1798/reactions","total_count":4,"+1":4,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/airbnb/lottie-android/issues/1798/timeline","performed_via_github_app":null,"state_reason":"completed"}