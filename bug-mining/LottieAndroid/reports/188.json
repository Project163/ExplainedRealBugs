{"url":"https://api.github.com/repos/airbnb/lottie-android/issues/1464","repository_url":"https://api.github.com/repos/airbnb/lottie-android","labels_url":"https://api.github.com/repos/airbnb/lottie-android/issues/1464/labels{/name}","comments_url":"https://api.github.com/repos/airbnb/lottie-android/issues/1464/comments","events_url":"https://api.github.com/repos/airbnb/lottie-android/issues/1464/events","html_url":"https://github.com/airbnb/lottie-android/issues/1464","id":542007882,"node_id":"MDU6SXNzdWU1NDIwMDc4ODI=","number":1464,"title":"LottieAnimation memory leak","user":{"login":"ujung92","id":59191065,"node_id":"MDQ6VXNlcjU5MTkxMDY1","avatar_url":"https://avatars.githubusercontent.com/u/59191065?v=4","gravatar_id":"","url":"https://api.github.com/users/ujung92","html_url":"https://github.com/ujung92","followers_url":"https://api.github.com/users/ujung92/followers","following_url":"https://api.github.com/users/ujung92/following{/other_user}","gists_url":"https://api.github.com/users/ujung92/gists{/gist_id}","starred_url":"https://api.github.com/users/ujung92/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ujung92/subscriptions","organizations_url":"https://api.github.com/users/ujung92/orgs","repos_url":"https://api.github.com/users/ujung92/repos","events_url":"https://api.github.com/users/ujung92/events{/privacy}","received_events_url":"https://api.github.com/users/ujung92/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2019-12-24T06:19:05Z","updated_at":"2020-01-06T03:33:59Z","closed_at":"2020-01-06T03:33:59Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Analysis Lottie animation when using addValueCallback()\r\n\r\nCause)\r\n\r\nI found  abnormal memory allocated when use addValueCallback.\r\nBut this is not Object or reference maintain or duplicate operation process. \r\nIt means memory leak occur at Lottie library.\r\n\r\nSo I had analysis internal codes of Lottie library assumes Lottie library have bugs .\r\nFinally I found memory leak point at addValueCallback().\r\n\r\n\r\nThere is a section where memory leakage can occur in the process of transmitting callback factors KeyPath's KeyPathElement (addValueCallback() have keypath - one of parameters ).\r\n\r\nSome of KeyPath Factors - BaseStrokeContent, FillContent, GradientFillContent, GradientStrokeContent, StrokeContent, TextLayer - I could check that the logic of addAnimation() for BaseLayer is added without duplicate check, and also there isn't the logic pairly remove.\r\n\r\n  e.g.) BaseStrokeContent -> layer.addAnimation(colorFilterAnimation);\r\n       List<BaseKeyframeAnimation<?, ?>> animations = new ArrayList<>();\r\n\r\n       public void addAnimation(@Nullable BaseKeyframeAnimation<?, ?> newAnimation) {\r\n         if (newAnimation == null) { return; }\r\n         animations.add(newAnimation);\r\n       } \r\n\r\nManage BaseKeyframeAnimation on a list like upper code, but there isn't no duplication check and pairly remove logic.\r\nAs a result, there is unnecessarily added and stacked every time addValueCallback() is performed.\r\nThis problem cannot be improved at application side.\r\n\r\nplz check this memory leak problem.\r\n","closed_by":{"login":"gpeal","id":1307745,"node_id":"MDQ6VXNlcjEzMDc3NDU=","avatar_url":"https://avatars.githubusercontent.com/u/1307745?v=4","gravatar_id":"","url":"https://api.github.com/users/gpeal","html_url":"https://github.com/gpeal","followers_url":"https://api.github.com/users/gpeal/followers","following_url":"https://api.github.com/users/gpeal/following{/other_user}","gists_url":"https://api.github.com/users/gpeal/gists{/gist_id}","starred_url":"https://api.github.com/users/gpeal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gpeal/subscriptions","organizations_url":"https://api.github.com/users/gpeal/orgs","repos_url":"https://api.github.com/users/gpeal/repos","events_url":"https://api.github.com/users/gpeal/events{/privacy}","received_events_url":"https://api.github.com/users/gpeal/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/airbnb/lottie-android/issues/1464/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/airbnb/lottie-android/issues/1464/timeline","performed_via_github_app":null,"state_reason":"completed"}