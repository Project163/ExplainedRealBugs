{"url":"https://api.github.com/repos/airbnb/lottie-android/issues/1396","repository_url":"https://api.github.com/repos/airbnb/lottie-android","labels_url":"https://api.github.com/repos/airbnb/lottie-android/issues/1396/labels{/name}","comments_url":"https://api.github.com/repos/airbnb/lottie-android/issues/1396/comments","events_url":"https://api.github.com/repos/airbnb/lottie-android/issues/1396/events","html_url":"https://github.com/airbnb/lottie-android/issues/1396","id":499463319,"node_id":"MDU6SXNzdWU0OTk0NjMzMTk=","number":1396,"title":"TextLayers don't combine unicode combining characters","user":{"login":"Adimote-work","id":55881580,"node_id":"MDQ6VXNlcjU1ODgxNTgw","avatar_url":"https://avatars.githubusercontent.com/u/55881580?v=4","gravatar_id":"","url":"https://api.github.com/users/Adimote-work","html_url":"https://github.com/Adimote-work","followers_url":"https://api.github.com/users/Adimote-work/followers","following_url":"https://api.github.com/users/Adimote-work/following{/other_user}","gists_url":"https://api.github.com/users/Adimote-work/gists{/gist_id}","starred_url":"https://api.github.com/users/Adimote-work/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Adimote-work/subscriptions","organizations_url":"https://api.github.com/users/Adimote-work/orgs","repos_url":"https://api.github.com/users/Adimote-work/repos","events_url":"https://api.github.com/users/Adimote-work/events{/privacy}","received_events_url":"https://api.github.com/users/Adimote-work/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":779072398,"node_id":"MDU6TGFiZWw3NzkwNzIzOTg=","url":"https://api.github.com/repos/airbnb/lottie-android/labels/Rendering%20bug","name":"Rendering bug","color":"0052cc","default":false,"description":null},{"id":779072491,"node_id":"MDU6TGFiZWw3NzkwNzI0OTE=","url":"https://api.github.com/repos/airbnb/lottie-android/labels/Text","name":"Text","color":"0e8a16","default":false,"description":null},{"id":834809928,"node_id":"MDU6TGFiZWw4MzQ4MDk5Mjg=","url":"https://api.github.com/repos/airbnb/lottie-android/labels/Help%20wanted","name":"Help wanted","color":"ffde72","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2019-09-27T13:58:54Z","updated_at":"2022-02-21T18:37:08Z","closed_at":"2022-01-17T04:54:43Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Checklist**\r\n\r\n- [X] 1. My animation doesn't use any [unsupported features](http://airbnb.io/lottie/#/supported-features).\r\n- [X] 2. I know what part of my animation doesn't work.\r\n- [X] 3. I have created a simplified version of my animation \r\n- [X] 4. I have attached the AEP file - You can use [this one from a similar bug](https://github.com/airbnb/lottie-web/files/3177765/hindi.animation.zip). I think the json file is invalid so you'll need to re-export and set the FontAssetDelegate to something which returns `Typeface.DEFAULT`.\r\n\r\n**Describe the bug**\r\nText which uses unicode [combining characters](https://en.wikipedia.org/wiki/Combining_character) (notably Hindi) is rendered character-by-character, ignoring the need for combining characters to be rendered as one.\r\n\r\nCombining characters (i.e. diacritics) are unicode characters representing a modification to a previous character. For example: '​း' is a diacritic which can be added to 'ဆီ' to make 'ဆီး'.\r\n\r\nIn Lottie android it's rendered as 'ဆီ​း' (the circle denotes a missing previous character for the diacritic) which is invalid Hindi.\r\n\r\nI believe this is caused by the text being split into individual characters, then [`canvas.drawText()` is called on each individual character](https://github.com/airbnb/lottie-android/blob/5e12628a0ded9eb37473a3b7b54d0cccf8ef86be/lottie/src/main/java/com/airbnb/lottie/model/layer/TextLayer.java#L355), ignoring the need for combining characters to remain with their preceding characters.\r\n\r\nIt seems Lottie for web had a similar issue: https://github.com/airbnb/lottie-web/issues/1603 but [their fix](https://github.com/airbnb/lottie-web/commit/978935d35f6ee40a015cbf451ba11f55df3dab4d) just handled the hindi characters, it's probably best to support all combining characters.\r\n\r\n**What version of Lottie did you test this on?**\r\n\r\n3.0.1 (but this is still an issue at head)\r\n\r\n**What version of Android did you test this on?**\r\n\r\nQ and P\r\n\r\n**Steps To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Render the animation (set the FontAssetDelegate to something which always returns `Typeface.DEFAULT`)\r\n2. See the error\r\n\r\n","closed_by":{"login":"gpeal","id":1307745,"node_id":"MDQ6VXNlcjEzMDc3NDU=","avatar_url":"https://avatars.githubusercontent.com/u/1307745?v=4","gravatar_id":"","url":"https://api.github.com/users/gpeal","html_url":"https://github.com/gpeal","followers_url":"https://api.github.com/users/gpeal/followers","following_url":"https://api.github.com/users/gpeal/following{/other_user}","gists_url":"https://api.github.com/users/gpeal/gists{/gist_id}","starred_url":"https://api.github.com/users/gpeal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gpeal/subscriptions","organizations_url":"https://api.github.com/users/gpeal/orgs","repos_url":"https://api.github.com/users/gpeal/repos","events_url":"https://api.github.com/users/gpeal/events{/privacy}","received_events_url":"https://api.github.com/users/gpeal/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/airbnb/lottie-android/issues/1396/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/airbnb/lottie-android/issues/1396/timeline","performed_via_github_app":null,"state_reason":"completed"}