{"url":"https://api.github.com/repos/helix-editor/helix/issues/12742","repository_url":"https://api.github.com/repos/helix-editor/helix","labels_url":"https://api.github.com/repos/helix-editor/helix/issues/12742/labels{/name}","comments_url":"https://api.github.com/repos/helix-editor/helix/issues/12742/comments","events_url":"https://api.github.com/repos/helix-editor/helix/issues/12742/events","html_url":"https://github.com/helix-editor/helix/issues/12742","id":2823920269,"node_id":"I_kwDOD__WI86oUZqN","number":12742,"title":"LSP hover empty sometimes after #10122","user":{"login":"david-crespo","id":3612203,"node_id":"MDQ6VXNlcjM2MTIyMDM=","avatar_url":"https://avatars.githubusercontent.com/u/3612203?v=4","gravatar_id":"","url":"https://api.github.com/users/david-crespo","html_url":"https://github.com/david-crespo","followers_url":"https://api.github.com/users/david-crespo/followers","following_url":"https://api.github.com/users/david-crespo/following{/other_user}","gists_url":"https://api.github.com/users/david-crespo/gists{/gist_id}","starred_url":"https://api.github.com/users/david-crespo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/david-crespo/subscriptions","organizations_url":"https://api.github.com/users/david-crespo/orgs","repos_url":"https://api.github.com/users/david-crespo/repos","events_url":"https://api.github.com/users/david-crespo/events{/privacy}","received_events_url":"https://api.github.com/users/david-crespo/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2101491828,"node_id":"MDU6TGFiZWwyMTAxNDkxODI4","url":"https://api.github.com/repos/helix-editor/helix/labels/C-bug","name":"C-bug","color":"C5DEF5","default":false,"description":"Category: This is a bug"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2025-01-31T16:22:24Z","updated_at":"2025-01-31T17:07:32Z","closed_at":"2025-01-31T17:01:55Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Summary\n\nI noticed this on master and was able to narrow it down to #10122. I noticed this with both Rust Analyzer and the Deno and Typescript LSPs.\n\n### Bad\n\nBuilding 9829ac0c02a01a51e22b12570b82a076187b9f94 from source.\n\n<img width=\"349\" alt=\"Image\" src=\"https://github.com/user-attachments/assets/37ce33ef-cd3a-42a3-bc91-6ce3927e8d1f\" />\n\n\n### Good \n\nBuilding 7c907e66f429f82235c67332125910cde9c29216 (parent of 9829ac0c02a01a51e22b12570b82a076187b9f94) from source.\n\n<img width=\"325\" alt=\"Image\" src=\"https://github.com/user-attachments/assets/eac90f8d-6d24-4627-9fae-7c96e699b26f\" />\n\n### Reproduction Steps\n\nSimply put this in a file with a `.ts` extension and try to hover on `f`.\n\n### Simple repro file\n\n```ts\nconst f = () => 5\n```\n\n\n### TS language configs\n\nI thought maybe it was caused by having multiple language servers, but it doesn't matter whether I have one or two in there.\n\n```toml\n[[language]]\nname = \"typescript\"\nformatter = { command = \"prettierd\", args = [\"--stdin-filepath\", \"x.ts\"] }\nlanguage-servers = [ \"typescript-language-server\" ]\nauto-format = true\n```\n\nI also get it with `deno-lsp`.\n\n\n### Helix log\n\nThis is the log from `hx -v`. `-vv` seemed to have a lot of noise that is unlikely to be relevant but I'll be happy to provide it if necessary.\n\n<details><summary>~/.cache/helix/helix.log</summary>\n\n```\n2025-01-31T10:19:59.975 helix_lsp::transport [INFO] deno-lsp -> {\"jsonrpc\":\"2.0\",\"method\":\"initialize\",\"params\":{\"capabilities\":{\"general\":{\"positionEncodings\":[\"utf-8\",\"utf-32\",\"utf-16\"]},\"textDocument\":{\"codeAction\":{\"codeActionLiteralSupport\":{\"codeActionKind\":{\"valueSet\":[\"\",\"quickfix\",\"refactor\",\"refactor.extract\",\"refactor.inline\",\"refactor.rewrite\",\"source\",\"source.organizeImports\"]}},\"dataSupport\":true,\"disabledSupport\":true,\"isPreferredSupport\":true,\"resolveSupport\":{\"properties\":[\"edit\",\"command\"]}},\"completion\":{\"completionItem\":{\"deprecatedSupport\":true,\"insertReplaceSupport\":true,\"resolveSupport\":{\"properties\":[\"documentation\",\"detail\",\"additionalTextEdits\"]},\"snippetSupport\":true,\"tagSupport\":{\"valueSet\":[1]}},\"completionItemKind\":{}},\"formatting\":{\"dynamicRegistration\":false},\"hover\":{\"contentFormat\":[\"markdown\"]},\"inlayHint\":{\"dynamicRegistration\":false},\"publishDiagnostics\":{\"tagSupport\":{\"valueSet\":[1,2]},\"versionSupport\":true},\"rename\":{\"dynamicRegistration\":false,\"honorsChangeAnnotations\":false,\"prepareSupport\":true},\"signatureHelp\":{\"signatureInformation\":{\"activeParameterSupport\":true,\"documentationFormat\":[\"markdown\"],\"parameterInformation\":{\"labelOffsetSupport\":true}}}},\"window\":{\"workDoneProgress\":true},\"workspace\":{\"applyEdit\":true,\"configuration\":true,\"didChangeConfiguration\":{\"dynamicRegistration\":false},\"didChangeWatchedFiles\":{\"dynamicRegistration\":true,\"relativePatternSupport\":false},\"executeCommand\":{\"dynamicRegistration\":false},\"fileOperations\":{\"didRename\":true,\"willRename\":true},\"inlayHint\":{\"refreshSupport\":false},\"symbol\":{\"dynamicRegistration\":false},\"workspaceEdit\":{\"documentChanges\":true,\"failureHandling\":\"abort\",\"normalizesLineEndings\":false,\"resourceOperations\":[\"create\",\"rename\",\"delete\"]},\"workspaceFolders\":true}},\"clientInfo\":{\"name\":\"helix\",\"version\":\"25.01.1 (9829ac0c)\"},\"processId\":30553,\"rootPath\":\"/Users/david/repos/llm-cli\",\"rootUri\":\"file:///Users/david/repos/llm-cli\",\"workspaceFolders\":[{\"name\":\"llm-cli\",\"uri\":\"file:///Users/david/repos/llm-cli\"}]},\"id\":0}\n2025-01-31T10:19:59.989 helix_lsp::transport [ERROR] deno-lsp err <- \"Starting Deno language server...\\n\"\n2025-01-31T10:19:59.989 helix_lsp::transport [ERROR] deno-lsp err <- \"  version: 2.1.9 (release, aarch64-apple-darwin)\\n\"\n2025-01-31T10:19:59.989 helix_lsp::transport [ERROR] deno-lsp err <- \"  executable: /Users/david/.deno/bin/deno\\n\"\n2025-01-31T10:19:59.989 helix_lsp::transport [ERROR] deno-lsp err <- \"Connected to \\\"helix\\\" 25.01.1 (9829ac0c)\\n\"\n2025-01-31T10:20:00.035 helix_lsp::transport [INFO] deno-lsp <- {\"jsonrpc\":\"2.0\",\"result\":{\"capabilities\":{\"textDocumentSync\":{\"openClose\":true,\"change\":2,\"save\":{}},\"selectionRangeProvider\":true,\"hoverProvider\":true,\"completionProvider\":{\"resolveProvider\":true,\"triggerCharacters\":[\".\",\"\\\"\",\"'\",\"`\",\"/\",\"@\",\"<\",\"#\"],\"allCommitCharacters\":[\".\",\";\",\"(\"]},\"signatureHelpProvider\":{\"triggerCharacters\":[\",\",\"(\",\"<\"],\"retriggerCharacters\":[\")\"]},\"definitionProvider\":true,\"typeDefinitionProvider\":true,\"implementationProvider\":true,\"referencesProvider\":true,\"documentHighlightProvider\":true,\"documentSymbolProvider\":{\"label\":\"Deno\"},\"workspaceSymbolProvider\":true,\"codeActionProvider\":{\"codeActionKinds\":[\"quickfix\",\"refactor\",\"refactor.extract.function\",\"refactor.extract.constant\",\"refactor.extract.type\",\"refactor.extract.interface\",\"refactor.move.newFile\",\"refactor.rewrite.import\",\"refactor.rewrite.export\",\"refactor.rewrite.arrow.braces\",\"refactor.rewrite.parameters.toDestructured\",\"refactor.rewrite.property.generateAccessors\"],\"resolveProvider\":true},\"codeLensProvider\":{\"resolveProvider\":true},\"documentFormattingProvider\":true,\"renameProvider\":true,\"foldingRangeProvider\":true,\"executeCommandProvider\":{\"commands\":[\"deno.cache\",\"deno.reloadImportRegistries\"]},\"workspace\":{\"workspaceFolders\":{\"supported\":true,\"changeNotifications\":true}},\"callHierarchyProvider\":true,\"semanticTokensProvider\":{\"legend\":{\"tokenTypes\":[\"class\",\"enum\",\"interface\",\"namespace\",\"typeParameter\",\"type\",\"parameter\",\"variable\",\"enumMember\",\"property\",\"function\",\"method\"],\"tokenModifiers\":[\"declaration\",\"static\",\"async\",\"readonly\",\"defaultLibrary\",\"local\"]},\"range\":true,\"full\":true},\"inlayHintProvider\":true,\"experimental\":{\"denoConfigTasks\":true,\"testingApi\":true,\"didRefreshDenoConfigurationTreeNotifications\":true}},\"serverInfo\":{\"name\":\"deno-language-server\",\"version\":\"2.1.9 (release, aarch64-apple-darwin)\"}},\"id\":0}\n2025-01-31T10:20:00.035 helix_lsp::transport [INFO] deno-lsp <- {\"capabilities\":{\"callHierarchyProvider\":true,\"codeActionProvider\":{\"codeActionKinds\":[\"quickfix\",\"refactor\",\"refactor.extract.function\",\"refactor.extract.constant\",\"refactor.extract.type\",\"refactor.extract.interface\",\"refactor.move.newFile\",\"refactor.rewrite.import\",\"refactor.rewrite.export\",\"refactor.rewrite.arrow.braces\",\"refactor.rewrite.parameters.toDestructured\",\"refactor.rewrite.property.generateAccessors\"],\"resolveProvider\":true},\"codeLensProvider\":{\"resolveProvider\":true},\"completionProvider\":{\"allCommitCharacters\":[\".\",\";\",\"(\"],\"resolveProvider\":true,\"triggerCharacters\":[\".\",\"\\\"\",\"'\",\"`\",\"/\",\"@\",\"<\",\"#\"]},\"definitionProvider\":true,\"documentFormattingProvider\":true,\"documentHighlightProvider\":true,\"documentSymbolProvider\":{\"label\":\"Deno\"},\"executeCommandProvider\":{\"commands\":[\"deno.cache\",\"deno.reloadImportRegistries\"]},\"experimental\":{\"denoConfigTasks\":true,\"didRefreshDenoConfigurationTreeNotifications\":true,\"testingApi\":true},\"foldingRangeProvider\":true,\"hoverProvider\":true,\"implementationProvider\":true,\"inlayHintProvider\":true,\"referencesProvider\":true,\"renameProvider\":true,\"selectionRangeProvider\":true,\"semanticTokensProvider\":{\"full\":true,\"legend\":{\"tokenModifiers\":[\"declaration\",\"static\",\"async\",\"readonly\",\"defaultLibrary\",\"local\"],\"tokenTypes\":[\"class\",\"enum\",\"interface\",\"namespace\",\"typeParameter\",\"type\",\"parameter\",\"variable\",\"enumMember\",\"property\",\"function\",\"method\"]},\"range\":true},\"signatureHelpProvider\":{\"retriggerCharacters\":[\")\"],\"triggerCharacters\":[\",\",\"(\",\"<\"]},\"textDocumentSync\":{\"change\":2,\"openClose\":true,\"save\":{}},\"typeDefinitionProvider\":true,\"workspace\":{\"workspaceFolders\":{\"changeNotifications\":true,\"supported\":true}},\"workspaceSymbolProvider\":true},\"serverInfo\":{\"name\":\"deno-language-server\",\"version\":\"2.1.9 (release, aarch64-apple-darwin)\"}}\n2025-01-31T10:20:00.035 helix_lsp::transport [INFO] deno-lsp -> {\"jsonrpc\":\"2.0\",\"method\":\"initialized\",\"params\":{}}\n2025-01-31T10:20:00.035 helix_lsp::transport [INFO] deno-lsp -> {\"jsonrpc\":\"2.0\",\"method\":\"textDocument/didOpen\",\"params\":{\"textDocument\":{\"languageId\":\"typescript\",\"text\":\"const f = () => 5\\n\",\"uri\":\"file:///Users/david/repos/llm-cli/test.ts\",\"version\":0}}}\n2025-01-31T10:20:00.035 helix_lsp::transport [INFO] deno-lsp <- {\"jsonrpc\":\"2.0\",\"method\":\"workspace/configuration\",\"params\":{\"items\":[{\"section\":\"deno\"},{\"section\":\"javascript\"},{\"section\":\"typescript\"},{\"scopeUri\":\"file:///Users/david/repos/llm-cli\",\"section\":\"deno\"},{\"scopeUri\":\"file:///Users/david/repos/llm-cli\",\"section\":\"javascript\"},{\"scopeUri\":\"file:///Users/david/repos/llm-cli\",\"section\":\"typescript\"}]},\"id\":0}\n2025-01-31T10:20:00.035 helix_lsp::transport [INFO] deno-lsp -> {\"jsonrpc\":\"2.0\",\"result\":[null,null,null,null,null,null],\"id\":0}\n2025-01-31T10:20:00.039 helix_lsp::transport [ERROR] deno-lsp err <- \"Hit the language server document preload limit of 1000 file system entries. You may want to use the \\\"deno.enablePaths\\\" configuration setting to only have Deno partially enable a workspace or increase the limit via \\\"deno.documentPreloadLimit\\\". In cases where Deno ends up using too much memory, you may want to lower the limit.\\n\"\n2025-01-31T10:20:00.039 helix_lsp::transport [ERROR] deno-lsp err <- \"Refreshing configuration tree...\\n\"\n2025-01-31T10:20:00.039 helix_lsp::transport [ERROR] deno-lsp err <- \"  Resolved Deno configuration file: \\\"file:///Users/david/repos/llm-cli/deno.jsonc\\\"\\n\"\n2025-01-31T10:20:00.040 helix_lsp::transport [ERROR] deno-lsp err <- \"  Resolved .npmrc: \\\"/Users/david/.npmrc\\\"\\n\"\n2025-01-31T10:20:00.040 helix_lsp::transport [ERROR] deno-lsp err <- \"  Resolved lockfile: \\\"file:///Users/david/repos/llm-cli/deno.lock\\\"\\n\"\n2025-01-31T10:20:00.056 helix_lsp::transport [INFO] deno-lsp <- {\"jsonrpc\":\"2.0\",\"method\":\"deno/didRefreshDenoConfigurationTree\",\"params\":{\"data\":[{\"scopeUri\":\"file:///Users/david/repos/llm-cli/\",\"workspaceRootScopeUri\":null,\"denoJson\":{\"uri\":\"file:///Users/david/repos/llm-cli/deno.jsonc\"},\"packageJson\":null}]}}\n2025-01-31T10:20:00.056 helix_term::application [INFO] Ignoring Unhandled notification from Language Server\n2025-01-31T10:20:00.058 helix_lsp::transport [INFO] deno-lsp <- {\"jsonrpc\":\"2.0\",\"method\":\"client/registerCapability\",\"params\":{\"registrations\":[{\"id\":\"workspace/didChangeWatchedFiles\",\"method\":\"workspace/didChangeWatchedFiles\",\"registerOptions\":{\"watchers\":[{\"globPattern\":\"**/*.{json,jsonc,lock}\"}]}}]},\"id\":1}\n2025-01-31T10:20:00.058 helix_lsp::transport [INFO] deno-lsp <- {\"jsonrpc\":\"2.0\",\"method\":\"deno/didChangeDenoConfiguration\",\"params\":{\"changes\":[{\"scopeUri\":\"file:///Users/david/repos/llm-cli/\",\"fileUri\":\"file:///Users/david/repos/llm-cli/deno.jsonc\",\"type\":\"added\",\"configurationType\":\"denoJson\"}]}}\n2025-01-31T10:20:00.058 helix_lsp::transport [INFO] deno-lsp -> {\"jsonrpc\":\"2.0\",\"result\":null,\"id\":1}\n2025-01-31T10:20:00.059 helix_term::application [INFO] Ignoring Unhandled notification from Language Server\n2025-01-31T10:20:00.059 helix_lsp::transport [ERROR] deno-lsp err <- \"Server ready.\\n\"\n2025-01-31T10:20:00.059 helix_lsp::transport [INFO] deno-lsp <- {\"jsonrpc\":\"2.0\",\"method\":\"textDocument/publishDiagnostics\",\"params\":{\"uri\":\"file:///Users/david/repos/llm-cli/test.ts\",\"diagnostics\":[],\"version\":0}}\n2025-01-31T10:20:00.059 helix_lsp::transport [INFO] deno-lsp <- {\"jsonrpc\":\"2.0\",\"method\":\"textDocument/publishDiagnostics\",\"params\":{\"uri\":\"file:///Users/david/repos/llm-cli/test.ts\",\"diagnostics\":[{\"range\":{\"start\":{\"line\":0,\"character\":6},\"end\":{\"line\":0,\"character\":7}},\"severity\":2,\"code\":\"no-unused-vars\",\"source\":\"deno-lint\",\"message\":\"`f` is never used\\nIf this is intentional, prefix it with an underscore like `_f`\"}],\"version\":0}}\n2025-01-31T10:20:00.228 helix_lsp::transport [INFO] deno-lsp <- {\"jsonrpc\":\"2.0\",\"method\":\"deno/didUpgradeCheck\",\"params\":{\"upgradeAvailable\":null}}\n2025-01-31T10:20:00.228 helix_term::application [INFO] Ignoring Unhandled notification from Language Server\n2025-01-31T10:20:01.059 helix_lsp::transport [INFO] deno-lsp <- {\"jsonrpc\":\"2.0\",\"method\":\"textDocument/publishDiagnostics\",\"params\":{\"uri\":\"file:///Users/david/repos/llm-cli/test.ts\",\"diagnostics\":[{\"range\":{\"start\":{\"line\":0,\"character\":6},\"end\":{\"line\":0,\"character\":7}},\"severity\":2,\"code\":\"no-unused-vars\",\"source\":\"deno-lint\",\"message\":\"`f` is never used\\nIf this is intentional, prefix it with an underscore like `_f`\"}],\"version\":0}}\n2025-01-31T10:20:01.059 helix_lsp::transport [INFO] deno-lsp <- {\"jsonrpc\":\"2.0\",\"method\":\"textDocument/publishDiagnostics\",\"params\":{\"uri\":\"file:///Users/david/repos/llm-cli/test.ts\",\"diagnostics\":[{\"range\":{\"start\":{\"line\":0,\"character\":6},\"end\":{\"line\":0,\"character\":7}},\"severity\":4,\"code\":6133,\"source\":\"deno-ts\",\"message\":\"'f' is declared but its value is never read.\",\"tags\":[1]},{\"range\":{\"start\":{\"line\":0,\"character\":6},\"end\":{\"line\":0,\"character\":7}},\"severity\":2,\"code\":\"no-unused-vars\",\"source\":\"deno-lint\",\"message\":\"`f` is never used\\nIf this is intentional, prefix it with an underscore like `_f`\"}],\"version\":0}}\n2025-01-31T10:20:01.753 helix_lsp::transport [INFO] deno-lsp -> {\"jsonrpc\":\"2.0\",\"method\":\"textDocument/hover\",\"params\":{\"position\":{\"character\":6,\"line\":0},\"textDocument\":{\"uri\":\"file:///Users/david/repos/llm-cli/test.ts\"}},\"id\":1}\n2025-01-31T10:20:01.801 helix_lsp::transport [INFO] deno-lsp <- {\"jsonrpc\":\"2.0\",\"result\":{\"contents\":[{\"language\":\"typescript\",\"value\":\"const f: () => number\"},\"\"],\"range\":{\"start\":{\"line\":0,\"character\":6},\"end\":{\"line\":0,\"character\":7}}},\"id\":1}\n2025-01-31T10:20:01.802 helix_lsp::transport [INFO] deno-lsp <- {\"contents\":[{\"language\":\"typescript\",\"value\":\"const f: () => number\"},\"\"],\"range\":{\"end\":{\"character\":7,\"line\":0},\"start\":{\"character\":6,\"line\":0}}}\n2025-01-31T10:20:03.252 helix_lsp::transport [INFO] deno-lsp -> {\"jsonrpc\":\"2.0\",\"method\":\"shutdown\",\"id\":2}\n2025-01-31T10:20:03.253 helix_lsp::transport [ERROR] deno-lsp err <- \"shutdown request received, shutting down\\n\"\n2025-01-31T10:20:03.253 helix_lsp::transport [INFO] deno-lsp <- {\"jsonrpc\":\"2.0\",\"result\":null,\"id\":2}\n2025-01-31T10:20:03.253 helix_lsp::transport [INFO] deno-lsp <- null\n2025-01-31T10:20:03.253 helix_lsp::transport [INFO] deno-lsp -> {\"jsonrpc\":\"2.0\",\"method\":\"exit\"}\n2025-01-31T10:20:03.254 helix_lsp::transport [ERROR] deno-lsp err <- \"exit notification received, stopping\\n\"\n```\n\n</details>\n\n\n### Platform\n\nmacOS\n\n### Terminal Emulator\n\nghostty adf4066b\n\n### Installation Method\n\nsource\n\n### Helix Version\n\nhelix 25.01.1 (9829ac0c)","closed_by":{"login":"the-mikedavis","id":21230295,"node_id":"MDQ6VXNlcjIxMjMwMjk1","avatar_url":"https://avatars.githubusercontent.com/u/21230295?v=4","gravatar_id":"","url":"https://api.github.com/users/the-mikedavis","html_url":"https://github.com/the-mikedavis","followers_url":"https://api.github.com/users/the-mikedavis/followers","following_url":"https://api.github.com/users/the-mikedavis/following{/other_user}","gists_url":"https://api.github.com/users/the-mikedavis/gists{/gist_id}","starred_url":"https://api.github.com/users/the-mikedavis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/the-mikedavis/subscriptions","organizations_url":"https://api.github.com/users/the-mikedavis/orgs","repos_url":"https://api.github.com/users/the-mikedavis/repos","events_url":"https://api.github.com/users/the-mikedavis/events{/privacy}","received_events_url":"https://api.github.com/users/the-mikedavis/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/helix-editor/helix/issues/12742/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/helix-editor/helix/issues/12742/timeline","performed_via_github_app":null,"state_reason":"completed"}