{"url":"https://api.github.com/repos/helix-editor/helix/issues/12461","repository_url":"https://api.github.com/repos/helix-editor/helix","labels_url":"https://api.github.com/repos/helix-editor/helix/issues/12461/labels{/name}","comments_url":"https://api.github.com/repos/helix-editor/helix/issues/12461/comments","events_url":"https://api.github.com/repos/helix-editor/helix/issues/12461/events","html_url":"https://github.com/helix-editor/helix/issues/12461","id":2778166258,"node_id":"I_kwDOD__WI86ll3Py","number":12461,"title":"Ropey char index out of bounds panic ","user":{"login":"gibbz00","id":31696304,"node_id":"MDQ6VXNlcjMxNjk2MzA0","avatar_url":"https://avatars.githubusercontent.com/u/31696304?v=4","gravatar_id":"","url":"https://api.github.com/users/gibbz00","html_url":"https://github.com/gibbz00","followers_url":"https://api.github.com/users/gibbz00/followers","following_url":"https://api.github.com/users/gibbz00/following{/other_user}","gists_url":"https://api.github.com/users/gibbz00/gists{/gist_id}","starred_url":"https://api.github.com/users/gibbz00/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gibbz00/subscriptions","organizations_url":"https://api.github.com/users/gibbz00/orgs","repos_url":"https://api.github.com/users/gibbz00/repos","events_url":"https://api.github.com/users/gibbz00/events{/privacy}","received_events_url":"https://api.github.com/users/gibbz00/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2101491828,"node_id":"MDU6TGFiZWwyMTAxNDkxODI4","url":"https://api.github.com/repos/helix-editor/helix/labels/C-bug","name":"C-bug","color":"C5DEF5","default":false,"description":"Category: This is a bug"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2025-01-09T15:42:40Z","updated_at":"2025-01-15T16:11:18Z","closed_at":"2025-01-15T16:11:18Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Summary\n\nGetting a panic when copying some EBNF from a PDF and then inserting some newlines into it. (https://standards.scheme.org/official/r7rs.pdf p. 62 if it helps.)\n\n### Reproduction Steps\n\nTried to enter a newline at every ` |` after pasting the following:\r\n\r\n```\r\nreal R〉 | 〈real R〉 @ 〈real R〉\r\n| 〈real R〉 + 〈ureal R〉 i | 〈real R〉 - 〈ureal R〉 i\r\n| 〈real R〉 + i | 〈real R〉 - i | 〈real R〉 〈infnan〉 i\r\n| + 〈ureal R〉 i | - 〈ureal R〉 i\r\n| 〈infnan〉 i | + i | - i\r\n```\r\nhttps://asciinema.org/a/gIJF8EpZ9wTsOGTxHWbX7NKgk\n\n### Helix log\n\n### Stderr\r\n```\r\nthread 'main' panicked at /build/.cargo/registry/src/index.crates.io-6f17d22bba15001f/ropey-1.6.1/src/slice.rs:360:41:\r\ncalled `Result::unwrap()` on an `Err` value: Char index out of bounds: char index 220, Rope/RopeSlice char length 219\r\nstack backtrace:\r\n   0:     0x5c1d5077f278 - <unknown>\r\n   1:     0x5c1d4f94c2d3 - <unknown>\r\n   2:     0x5c1d5077a553 - <unknown>\r\n   3:     0x5c1d5077f0c2 - <unknown>\r\n   4:     0x5c1d50780ea8 - <unknown>\r\n   5:     0x5c1d50780cee - <unknown>\r\n   6:     0x5c1d507815a9 - <unknown>\r\n   7:     0x5c1d5078130a - <unknown>\r\n   8:     0x5c1d5077f739 - <unknown>\r\n   9:     0x5c1d50780f9c - <unknown>\r\n  10:     0x5c1d4f8598f0 - <unknown>\r\n  11:     0x5c1d4f859cf6 - <unknown>\r\n  12:     0x5c1d4fbd4727 - <unknown>\r\n  13:     0x5c1d4fbc0eda - <unknown>\r\n  14:     0x5c1d4fbc2c3c - <unknown>\r\n  15:     0x5c1d50463805 - <unknown>\r\n  16:     0x5c1d50463fc9 - <unknown>\r\n  17:     0x5c1d5031264f - <unknown>\r\n  18:     0x5c1d50002726 - <unknown>\r\n  19:     0x5c1d5000267e - <unknown>\r\n  20:     0x5c1d500028c1 - <unknown>\r\n  21:     0x5c1d5000538b - <unknown>\r\n  22:     0x5c1d4fff55ae - <unknown>\r\n  23:     0x5c1d504f343e - <unknown>\r\n  24:     0x5c1d504f0be9 - <unknown>\r\n  25:     0x5c1d50549546 - <unknown>\r\n  26:     0x5c1d50525b39 - <unknown>\r\n  27:     0x5c1d5058ace6 - <unknown>\r\n  28:     0x5c1d5056dc51 - <unknown>\r\n  29:     0x5c1d507718b7 - <unknown>\r\n  30:     0x5c1d50525d24 - <unknown>\r\n  31:     0x73e8748a0e08 - <unknown>\r\n  32:     0x73e8748a0ecc - __libc_start_main\r\n  33:     0x5c1d4f8c4de5 - <unknown>\r\n  34:                0x0 - <unknown>\r\n```\r\n### Logs\r\n```\r\n2025-01-09T16:36:54.280 helix_term::application [DEBUG] received editor event: IdleTimer\r\n2025-01-09T16:36:54.513 helix_term::commands [TRACE] entering insert mode with sel: Selection { ranges: [Range { anchor: 35, head: 36, old_visual_position: None }, Range { anchor: 82, head: 83, old_visual_position: None }, Range { anchor: 122, head: 123, old_visual_position: None }, Range { anchor: 137, head: 138, old_visual_position: None }, Range { anchor: 175, head: 176, old_visual_position: None }, Range { anchor: 204, head: 205, old_visual_position: None }, Range { anchor: 210, head: 211, old_visual_position: None }], primary_index: 0 }, text: \"pub struct Number(Number);\\nreal R〉 | 〈real R〉 @ 〈real R〉\\n| 〈real R〉 + 〈ureal R〉 i | 〈real R〉 - 〈ureal R〉 i\\n| 〈real R〉 + i | 〈real R〉 - i | 〈real R〉 〈infnan〉 i\\n| + 〈ureal R〉 i | - 〈ureal R〉 i\\n| 〈infnan〉 i | + i | - i\"\r\n2025-01-09T16:36:54.513 helix_view::document [DEBUG] id 2 modified - last saved: 0, current: 1\r\n2025-01-09T16:36:54.515 helix_term::application [DEBUG] received editor event: IdleTimer\r\n2025-01-09T16:36:54.706 helix_core::indent [TRACE] indent result = IndentQueryResult { indent_captures: {95912711633680: [IndentCapture { capture_type: Indent, scope: Tail }], 95912708964336: [IndentCapture { capture_type: Indent, scope: Tail }], 95912709598032: [IndentCapture { capture_type: Indent, scope: Tail }], 95912711010272: [IndentCapture { capture_type: Indent, scope: Tail }], 95912711007696: [IndentCapture { capture_type: Indent, scope: Tail }], 95912709600320: [IndentCapture { capture_type: Indent, scope: Tail }], 95912709598576: [IndentCapture { capture_type: Indent, scope: Tail }], 95912711009024: [IndentCapture { capture_type: Indent, scope: Tail }], 95912711006496: [IndentCapture { capture_type: Indent, scope: Tail }], 95912709601536: [IndentCapture { capture_type: Indent, scope: Tail }]}, extend_captures: {} }\r\n2025-01-09T16:36:54.706 helix_core::indent [TRACE] indent result = IndentQueryResult { indent_captures: {95912711009024: [IndentCapture { capture_type: Indent, scope: Tail }], 95912709598032: [IndentCapture { capture_type: Indent, scope: Tail }], 95912708964336: [IndentCapture { capture_type: Indent, scope: Tail }], 95912711010272: [IndentCapture { capture_type: Indent, scope: Tail }], 95912709600320: [IndentCapture { capture_type: Indent, scope: Tail }], 95912711006496: [IndentCapture { capture_type: Indent, scope: Tail }], 95912711007696: [IndentCapture { capture_type: Indent, scope: Tail }], 95912709598576: [IndentCapture { capture_type: Indent, scope: Tail }], 95912711633680: [IndentCapture { capture_type: Indent, scope: Tail }], 95912709601536: [IndentCapture { capture_type: Indent, scope: Tail }]}, extend_captures: {} }\r\n2025-01-09T16:36:54.706 helix_core::indent [TRACE] indent result = IndentQueryResult { indent_captures: {95912711006496: [IndentCapture { capture_type: Indent, scope: Tail }], 95912709601536: [IndentCapture { capture_type: Indent, scope: Tail }], 95912711009024: [IndentCapture { capture_type: Indent, scope: Tail }], 95912709598032: [IndentCapture { capture_type: Indent, scope: Tail }], 95912709598576: [IndentCapture { capture_type: Indent, scope: Tail }], 95912711010272: [IndentCapture { capture_type: Indent, scope: Tail }], 95912711007696: [IndentCapture { capture_type: Indent, scope: Tail }], 95912709600320: [IndentCapture { capture_type: Indent, scope: Tail }]}, extend_captures: {} }\r\n2025-01-09T16:36:54.706 helix_core::indent [TRACE] indent result = IndentQueryResult { indent_captures: {95912709600320: [IndentCapture { capture_type: Indent, scope: Tail }], 95912711009024: [IndentCapture { capture_type: Indent, scope: Tail }], 95912709598576: [IndentCapture { capture_type: Indent, scope: Tail }], 95912711633680: [IndentCapture { capture_type: Indent, scope: Tail }], 95912711006496: [IndentCapture { capture_type: Indent, scope: Tail }], 95912711007696: [IndentCapture { capture_type: Indent, scope: Tail }], 95912709601536: [IndentCapture { capture_type: Indent, scope: Tail }], 95912711010272: [IndentCapture { capture_type: Indent, scope: Tail }], 95912709598032: [IndentCapture { capture_type: Indent, scope: Tail }]}, extend_captures: {} }\r\n2025-01-09T16:36:54.706 helix_core::indent [TRACE] indent result = IndentQueryResult { indent_captures: {95912711010272: [IndentCapture { capture_type: Indent, scope: Tail }], 95912711009024: [IndentCapture { capture_type: Indent, scope: Tail }], 95912709600320: [IndentCapture { capture_type: Indent, scope: Tail }], 95912711006496: [IndentCapture { capture_type: Indent, scope: Tail }], 95912711007696: [IndentCapture { capture_type: Indent, scope: Tail }], 95912709601536: [IndentCapture { capture_type: Indent, scope: Tail }]}, extend_captures: {} }\r\n2025-01-09T16:36:54.706 helix_core::indent [TRACE] indent result = IndentQueryResult { indent_captures: {95912711007696: [IndentCapture { capture_type: Indent, scope: Tail }], 95912709601536: [IndentCapture { capture_type: Indent, scope: Tail }], 95912709600320: [IndentCapture { capture_type: Indent, scope: Tail }], 95912711010272: [IndentCapture { capture_type: Indent, scope: Tail }], 95912709598576: [IndentCapture { capture_type: Indent, scope: Tail }], 95912711006496: [IndentCapture { capture_type: Indent, scope: Tail }], 95912711009024: [IndentCapture { capture_type: Indent, scope: Tail }]}, extend_captures: {} }\r\n2025-01-09T16:36:54.706 helix_core::indent [TRACE] indent result = IndentQueryResult { indent_captures: {95912711010272: [IndentCapture { capture_type: Indent, scope: Tail }], 95912711006496: [IndentCapture { capture_type: Indent, scope: Tail }], 95912709601536: [IndentCapture { capture_type: Indent, scope: Tail }], 95912711009024: [IndentCapture { capture_type: Indent, scope: Tail }], 95912711007696: [IndentCapture { capture_type: Indent, scope: Tail }]}, extend_captures: {} }\r\n2025-01-09T16:36:54.706 helix_core::indent [TRACE] indent result = IndentQueryResult { indent_captures: {95912709598576: [IndentCapture { capture_type: Indent, scope: Tail }], 95912711007696: [IndentCapture { capture_type: Indent, scope: Tail }], 95912711006496: [IndentCapture { capture_type: Indent, scope: Tail }], 95912711010272: [IndentCapture { capture_type: Indent, scope: Tail }], 95912709601536: [IndentCapture { capture_type: Indent, scope: Tail }], 95912711009024: [IndentCapture { capture_type: Indent, scope: Tail }], 95912709600320: [IndentCapture { capture_type: Indent, scope: Tail }]}, extend_captures: {} }\r\n2025-01-09T16:36:54.706 helix_core::indent [TRACE] indent result = IndentQueryResult { indent_captures: {95912711009024: [IndentCapture { capture_type: Indent, scope: Tail }], 95912711007696: [IndentCapture { capture_type: Indent, scope: Tail }], 95912711010272: [IndentCapture { capture_type: Indent, scope: Tail }]}, extend_captures: {} }\r\n2025-01-09T16:36:54.707 helix_core::indent [TRACE] indent result = IndentQueryResult { indent_captures: {95912711010272: [IndentCapture { capture_type: Indent, scope: Tail }], 95912711007696: [IndentCapture { capture_type: Indent, scope: Tail }], 95912711009024: [IndentCapture { capture_type: Indent, scope: Tail }], 95912711006496: [IndentCapture { capture_type: Indent, scope: Tail }]}, extend_captures: {} }\r\n2025-01-09T16:36:54.707 helix_core::indent [TRACE] indent result = IndentQueryResult { indent_captures: {95912711010272: [IndentCapture { capture_type: Indent, scope: Tail }]}, extend_captures: {} }\r\n2025-01-09T16:36:54.707 helix_core::indent [TRACE] indent result = IndentQueryResult { indent_captures: {95912711009024: [IndentCapture { capture_type: Indent, scope: Tail }], 95912711010272: [IndentCapture { capture_type: Indent, scope: Tail }]}, extend_captures: {} }\r\n2025-01-09T16:36:54.707 helix_core::indent [TRACE] indent result = IndentQueryResult { indent_captures: {}, extend_captures: {} }\r\n2025-01-09T16:36:54.707 helix_core::indent [TRACE] indent result = IndentQueryResult { indent_captures: {95912711009024: [IndentCapture { capture_type: Indent, scope: Tail }], 95912711010272: [IndentCapture { capture_type: Indent, scope: Tail }]}, extend_captures: {} }\r\n2025-01-09T16:36:54.708 mio::poll [TRACE] deregistering event source from poller\r\n2025-01-09T16:36:54.708 mio::poll [TRACE] deregistering event source from poller\r\n2025-01-09T16:36:54.708 mio::poll [TRACE] deregistering event source from poller\r\n2025-01-09T16:36:54.708 mio::poll [TRACE] deregistering event source from poller\r\n2025-01-09T16:36:54.708 mio::poll [TRACE] deregistering event source from poller\r\n2025-01-09T16:36:54.708 mio::poll [TRACE] deregistering event source from poller\r\n2025-01-09T16:36:54.709 helix_lsp::transport [ERROR] err: <- Other(failed to send a message to server\r\n\r\nCaused by:\r\n    channel closed\r\n\r\nStack backtrace:\r\n   0: <unknown>\r\n   1: <unknown>\r\n   2: <unknown>\r\n   3: <unknown>\r\n   4: <unknown>\r\n   5: <unknown>\r\n   6: <unknown>\r\n   7: <unknown>\r\n   8: <unknown>\r\n   9: <unknown>\r\n  10: <unknown>\r\n  11: <unknown>\r\n  12: <unknown>\r\n  13: <unknown>\r\n  14: <unknown>\r\n  15: <unknown>\r\n  16: <unknown>)\r\n2025-01-09T16:36:54.709 mio::poll [TRACE] deregistering event source from poller\r\n2025-01-09T16:36:54.709 helix_lsp::transport [ERROR] scls err: <- StreamClosed\r\n2025-01-09T16:36:54.709 mio::poll [TRACE] deregistering event source from poller\r\n2025-01-09T16:36:54.710 mio::poll [TRACE] deregistering event source from poller\r\n2025-01-09T16:36:54.710 mio::poll [TRACE] deregistering event source from poller\r\n2025-01-09T16:36:54.710 mio::poll [TRACE] deregistering event source from poller\r\n2025-01-09T16:36:54.710 mio::poll [TRACE] deregistering event source from poller\r\n2025-01-09T16:36:54.710 mio::poll [TRACE] deregistering event source from poller\r\n2025-01-09T16:36:54.710 mio::poll [TRACE] deregistering event source from poller\r\n```\n\n### Platform\n\nLinux\n\n### Terminal Emulator\n\nfoot version: 1.17.2 +pgo +ime +graphemes -assertions\n\n### Installation Method\n\narch repo with paru\n\n### Helix Version\n\nhelix 25.1","closed_by":{"login":"the-mikedavis","id":21230295,"node_id":"MDQ6VXNlcjIxMjMwMjk1","avatar_url":"https://avatars.githubusercontent.com/u/21230295?v=4","gravatar_id":"","url":"https://api.github.com/users/the-mikedavis","html_url":"https://github.com/the-mikedavis","followers_url":"https://api.github.com/users/the-mikedavis/followers","following_url":"https://api.github.com/users/the-mikedavis/following{/other_user}","gists_url":"https://api.github.com/users/the-mikedavis/gists{/gist_id}","starred_url":"https://api.github.com/users/the-mikedavis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/the-mikedavis/subscriptions","organizations_url":"https://api.github.com/users/the-mikedavis/orgs","repos_url":"https://api.github.com/users/the-mikedavis/repos","events_url":"https://api.github.com/users/the-mikedavis/events{/privacy}","received_events_url":"https://api.github.com/users/the-mikedavis/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/helix-editor/helix/issues/12461/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/helix-editor/helix/issues/12461/timeline","performed_via_github_app":null,"state_reason":"completed"}