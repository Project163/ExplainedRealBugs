{"url":"https://api.github.com/repos/helix-editor/helix/issues/4473","repository_url":"https://api.github.com/repos/helix-editor/helix","labels_url":"https://api.github.com/repos/helix-editor/helix/issues/4473/labels{/name}","comments_url":"https://api.github.com/repos/helix-editor/helix/issues/4473/comments","events_url":"https://api.github.com/repos/helix-editor/helix/issues/4473/events","html_url":"https://github.com/helix-editor/helix/issues/4473","id":1423589212,"node_id":"I_kwDOD__WI85U2j9c","number":4473,"title":"Panic on LSP completion","user":{"login":"xbol0","id":36223476,"node_id":"MDQ6VXNlcjM2MjIzNDc2","avatar_url":"https://avatars.githubusercontent.com/u/36223476?v=4","gravatar_id":"","url":"https://api.github.com/users/xbol0","html_url":"https://github.com/xbol0","followers_url":"https://api.github.com/users/xbol0/followers","following_url":"https://api.github.com/users/xbol0/following{/other_user}","gists_url":"https://api.github.com/users/xbol0/gists{/gist_id}","starred_url":"https://api.github.com/users/xbol0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xbol0/subscriptions","organizations_url":"https://api.github.com/users/xbol0/orgs","repos_url":"https://api.github.com/users/xbol0/repos","events_url":"https://api.github.com/users/xbol0/events{/privacy}","received_events_url":"https://api.github.com/users/xbol0/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2101491828,"node_id":"MDU6TGFiZWwyMTAxNDkxODI4","url":"https://api.github.com/repos/helix-editor/helix/labels/C-bug","name":"C-bug","color":"C5DEF5","default":false,"description":"Category: This is a bug"},{"id":3067591794,"node_id":"MDU6TGFiZWwzMDY3NTkxNzk0","url":"https://api.github.com/repos/helix-editor/helix/labels/A-language-server","name":"A-language-server","color":"FBCA04","default":false,"description":"Area: Language server client"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2022-10-26T07:51:50Z","updated_at":"2022-11-08T11:50:54Z","closed_at":"2022-11-08T11:50:53Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Summary\n\n```\r\nthread 'main' panicked at 'not implemented: completion: insert_and_replace InsertReplaceEdit { new_text: \"?.[Symbol]\", insert: Range { start: Position { line: 43, character: 34 }, end: Position { line: 43, character: 35 } }, replace: Range { start: Position { line: 43, character: 34 }, end: Position { line: 43, character: 35 } } }', helix-term/src/ui/completion.rs:112:29\r\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\r\n```\r\n\r\nI'm using Deno, here's my `language.toml`:\r\n\r\n```toml\r\n[[language]]\r\nname = \"javascript\"\r\nshebangs = [\"deno\", \"node\"]\r\nauto-format = true\r\nroots = [\"deno.json\", \"package.json\", \"tsconfig.json\"]\r\nconfig = { enable = true, lint = true, unstable = true }\r\nlanguage-server = { command = \"deno\", args = [\"lsp\"], language-id = \"javascript\" }\r\n\r\n[[language]]\r\nname = \"jsx\"\r\nshebangs = [\"deno\", \"node\"]\r\nauto-format = true\r\nroots = [\"deno.json\", \"package.json\", \"tsconfig.json\"]\r\nconfig = { enable = true, lint = true, unstable = true }\r\nlanguage-server = { command = \"deno\", args = [\"lsp\"], language-id = \"javascriptreact\" }\r\n\r\n[[language]]\r\nname = \"typescript\"\r\nshebangs = [\"deno\"]\r\nauto-format = true\r\nroots = [\"deno.json\"]\r\nconfig = { enable = true, lint = true, unstable = true }\r\nlanguage-server = { command = \"deno\", args = [\"lsp\"], language-id = \"typescript\" }\r\n\r\n[[language]]\r\nname = \"tsx\"\r\nshebangs = [\"deno\", \"node\"]\r\nauto-format = true\r\nroots = [\"deno.json\", \"package.json\", \"tsconfig.json\"]\r\nconfig = { enable = true, lint = true, unstable = true }\r\nlanguage-server = { command = \"deno\", args = [\"lsp\"], language-id = \"typescriptreact\" }\r\n```\r\n\r\nIt panic many times.\n\n### Reproduction Steps\n\n<!-- Ideally provide a key sequence and/or asciinema.org recording. --> \r\nhttps://asciinema.org/a/Oa2WMFaTzMdlG6pdQ8VcazC8d\r\nI tried this:\r\n\r\n1. `hx`\r\n\r\nUse `tab` switch completion items, it panicked.\n\n### Helix log\n\n<details><summary>~/.cache/helix/helix.log</summary>\r\n\r\n```\r\n2022-10-26T15:04:06.283 helix_view::theme [WARN] Theme: malformed hexcode: highlight\r\n2022-10-26T15:04:06.430 helix_lsp::transport [ERROR] err <- \"Starting Deno language server...\\n\"\r\n2022-10-26T15:04:06.431 helix_lsp::transport [ERROR] err <- \"  version: 1.26.2 (release, aarch64-apple-darwin)\\n\"\r\n2022-10-26T15:04:06.431 helix_lsp::transport [ERROR] err <- \"  executable: /opt/homebrew/bin/deno\\n\"\r\n2022-10-26T15:04:06.507 helix_lsp::transport [ERROR] err <- \"Server ready.\\n\"\r\n2022-10-26T15:04:06.511 helix_lsp::transport [ERROR] err <- \"failed to update settings: invalid type: null, expected struct WorkspaceSettings\\n\"\r\n2022-10-26T15:04:06.511 helix_lsp::transport [ERROR] err <- \"Error converting specifier settings (file:///Users/boloto/Desktop/commoe/commoe.ts): Error converting specifier settings: invalid type: null, expected struct SpecifierSettings\\n\"\r\n2022-10-26T15:23:49.938 helix_lsp::transport [ERROR] err <- \"Format error: Unexpected token `)`. Expected this, import, async, function, [ for array literal, { for object literal, @ for decorator, function, class, null, true, false, number, bigint, string, regexp, ` for template literal, (, or an identifier at file:///Users/boloto/Desktop/commoe/commoe.ts:23:8\\n\"\r\n2022-10-26T15:23:49.940 helix_term::application [WARN] unhandled window/showMessage: ShowMessageParams { typ: Warning, message: \"Unable to format \\\"file:///Users/boloto/Desktop/commoe/commoe.ts\\\". Likely due to unrecoverable syntax errors in the file.\" }\r\n2022-10-26T15:24:06.250 helix_lsp::transport [ERROR] err <- \"Format error: Unexpected token `)`. Expected this, import, async, function, [ for array literal, { for object literal, @ for decorator, function, class, null, true, false, number, bigint, string, regexp, ` for template literal, (, or an identifier at file:///Users/boloto/Desktop/commoe/commoe.ts:25:8\\n\"\r\n2022-10-26T15:24:06.250 helix_term::application [WARN] unhandled window/showMessage: ShowMessageParams { typ: Warning, message: \"Unable to format \\\"file:///Users/boloto/Desktop/commoe/commoe.ts\\\". Likely due to unrecoverable syntax errors in the file.\" }\r\n2022-10-26T15:24:18.686 helix_lsp::transport [ERROR] err <- \"Format error: Unexpected token `)`. Expected this, import, async, function, [ for array literal, { for object literal, @ for decorator, function, class, null, true, false, number, bigint, string, regexp, ` for template literal, (, or an identifier at file:///Users/boloto/Desktop/commoe/commoe.ts:25:8\\n\"\r\n2022-10-26T15:24:18.687 helix_term::application [WARN] unhandled window/showMessage: ShowMessageParams { typ: Warning, message: \"Unable to format \\\"file:///Users/boloto/Desktop/commoe/commoe.ts\\\". Likely due to unrecoverable syntax errors in the file.\" }\r\n2022-10-26T15:24:53.577 helix_lsp::transport [ERROR] err <- \"Format error: Unexpected token `)`. Expected this, import, async, function, [ for array literal, { for object literal, @ for decorator, function, class, null, true, false, number, bigint, string, regexp, ` for template literal, (, or an identifier at file:///Users/boloto/Desktop/commoe/commoe.ts:28:8\\n\"\r\n2022-10-26T15:24:53.578 helix_term::application [WARN] unhandled window/showMessage: ShowMessageParams { typ: Warning, message: \"Unable to format \\\"file:///Users/boloto/Desktop/commoe/commoe.ts\\\". Likely due to unrecoverable syntax errors in the file.\" }\r\n2022-10-26T15:25:08.977 helix_lsp::transport [ERROR] err <- \"Format error: Unexpected token `)`. Expected this, import, async, function, [ for array literal, { for object literal, @ for decorator, function, class, null, true, false, number, bigint, string, regexp, ` for template literal, (, or an identifier at file:///Users/boloto/Desktop/commoe/commoe.ts:28:8\\n\"\r\n2022-10-26T15:25:08.978 helix_term::application [WARN] unhandled window/showMessage: ShowMessageParams { typ: Warning, message: \"Unable to format \\\"file:///Users/boloto/Desktop/commoe/commoe.ts\\\". Likely due to unrecoverable syntax errors in the file.\" }\r\n```\r\n\r\n</details>\r\n\n\n### Platform\n\nmacOS 13.0 (22A380) m1 chip\n\n### Terminal Emulator\n\niterm2\n\n### Helix Version\n\nhelix 22.08.1 (66276ce6)","closed_by":{"login":"archseer","id":1372918,"node_id":"MDQ6VXNlcjEzNzI5MTg=","avatar_url":"https://avatars.githubusercontent.com/u/1372918?v=4","gravatar_id":"","url":"https://api.github.com/users/archseer","html_url":"https://github.com/archseer","followers_url":"https://api.github.com/users/archseer/followers","following_url":"https://api.github.com/users/archseer/following{/other_user}","gists_url":"https://api.github.com/users/archseer/gists{/gist_id}","starred_url":"https://api.github.com/users/archseer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/archseer/subscriptions","organizations_url":"https://api.github.com/users/archseer/orgs","repos_url":"https://api.github.com/users/archseer/repos","events_url":"https://api.github.com/users/archseer/events{/privacy}","received_events_url":"https://api.github.com/users/archseer/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/helix-editor/helix/issues/4473/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/helix-editor/helix/issues/4473/timeline","performed_via_github_app":null,"state_reason":"completed"}