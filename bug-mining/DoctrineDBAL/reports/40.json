{"url":"https://api.github.com/repos/doctrine/dbal/issues/4263","repository_url":"https://api.github.com/repos/doctrine/dbal","labels_url":"https://api.github.com/repos/doctrine/dbal/issues/4263/labels{/name}","comments_url":"https://api.github.com/repos/doctrine/dbal/issues/4263/comments","events_url":"https://api.github.com/repos/doctrine/dbal/issues/4263/events","html_url":"https://github.com/doctrine/dbal/issues/4263","id":696816560,"node_id":"MDU6SXNzdWU2OTY4MTY1NjA=","number":4263,"title":"Support true VARCHAR binding to prevent implicit conversions?","user":{"login":"gjdanis","id":8147430,"node_id":"MDQ6VXNlcjgxNDc0MzA=","avatar_url":"https://avatars.githubusercontent.com/u/8147430?v=4","gravatar_id":"","url":"https://api.github.com/users/gjdanis","html_url":"https://github.com/gjdanis","followers_url":"https://api.github.com/users/gjdanis/followers","following_url":"https://api.github.com/users/gjdanis/following{/other_user}","gists_url":"https://api.github.com/users/gjdanis/gists{/gist_id}","starred_url":"https://api.github.com/users/gjdanis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gjdanis/subscriptions","organizations_url":"https://api.github.com/users/gjdanis/orgs","repos_url":"https://api.github.com/users/gjdanis/repos","events_url":"https://api.github.com/users/gjdanis/events{/privacy}","received_events_url":"https://api.github.com/users/gjdanis/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":225630784,"node_id":"MDU6TGFiZWwyMjU2MzA3ODQ=","url":"https://api.github.com/repos/doctrine/dbal/labels/Improvement","name":"Improvement","color":"0052cc","default":false,"description":null},{"id":308743551,"node_id":"MDU6TGFiZWwzMDg3NDM1NTE=","url":"https://api.github.com/repos/doctrine/dbal/labels/SQL%20Server","name":"SQL Server","color":"c7def8","default":false,"description":null},{"id":308745058,"node_id":"MDU6TGFiZWwzMDg3NDUwNTg=","url":"https://api.github.com/repos/doctrine/dbal/labels/pdo_sqlsrv","name":"pdo_sqlsrv","color":"d4c5f9","default":false,"description":null},{"id":308745102,"node_id":"MDU6TGFiZWwzMDg3NDUxMDI=","url":"https://api.github.com/repos/doctrine/dbal/labels/sqlsrv","name":"sqlsrv","color":"d4c5f9","default":false,"description":null},{"id":308808049,"node_id":"MDU6TGFiZWwzMDg4MDgwNDk=","url":"https://api.github.com/repos/doctrine/dbal/labels/Types","name":"Types","color":"bfe5bf","default":false,"description":null},{"id":308837051,"node_id":"MDU6TGFiZWwzMDg4MzcwNTE=","url":"https://api.github.com/repos/doctrine/dbal/labels/Prepared%20Statements","name":"Prepared Statements","color":"ffffff","default":false,"description":null}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/doctrine/dbal/milestones/77","html_url":"https://github.com/doctrine/dbal/milestone/77","labels_url":"https://api.github.com/repos/doctrine/dbal/milestones/77/labels","id":5028536,"node_id":"MDk6TWlsZXN0b25lNTAyODUzNg==","number":77,"title":"2.11.0","description":"","creator":{"login":"morozov","id":59683,"node_id":"MDQ6VXNlcjU5Njgz","avatar_url":"https://avatars.githubusercontent.com/u/59683?v=4","gravatar_id":"","url":"https://api.github.com/users/morozov","html_url":"https://github.com/morozov","followers_url":"https://api.github.com/users/morozov/followers","following_url":"https://api.github.com/users/morozov/following{/other_user}","gists_url":"https://api.github.com/users/morozov/gists{/gist_id}","starred_url":"https://api.github.com/users/morozov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/morozov/subscriptions","organizations_url":"https://api.github.com/users/morozov/orgs","repos_url":"https://api.github.com/users/morozov/repos","events_url":"https://api.github.com/users/morozov/events{/privacy}","received_events_url":"https://api.github.com/users/morozov/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":62,"state":"closed","created_at":"2020-01-21T15:51:52Z","updated_at":"2022-08-11T19:41:00Z","due_on":"2020-08-06T07:00:00Z","closed_at":"2020-09-20T23:44:43Z"},"comments":4,"created_at":"2020-09-09T13:29:10Z","updated_at":"2022-07-28T00:22:51Z","closed_at":"2020-09-18T23:15:33Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Feature Request\r\n\r\n<!-- Fill in the relevant information below to help triage your issue. -->\r\n\r\n|    Q        |   A\r\n|------------ | ------\r\n| New Feature | yes\r\n| RFC         | no\r\n| BC Break    | no\r\n\r\n#### Summary\r\n\r\nPHP 7.2 added support for specifying different bind types for unicode and non-unicode string data: https://wiki.php.net/rfc/extended-string-types-for-pdo\r\n\r\nThis is a major improvement over the default (PDO::PARAM_STR) which binds strings as unicode data. In the past, the inability for PHP to handle this has led to performance problems in certain cases. For example if we have something like:\r\n\r\n```php\r\n$statement = $connection->prepare(\r\n   'SELECT * FROM ... WHERE myVarcharColumn = :value' -- will bind as N'...'\r\n);\r\n\r\n$statement->bindValue(':value', $myVarcharValue);\r\n$statement->execute();\r\n```\r\n\r\nIf there's an index on `myVarcharColumn` SQL won't be able to use the index effectively since the binding will be an NVARCHAR string and force an [implicit conversation](http://blog.sqlgrease.com/are-varchar-or-char-hurting-your-performance-due-to-implicit-conversions/).\r\n\r\nDoes the team have a plan to support this binding in the future? We actually implemented this internally in a wrapper we have DBAL. I'm happy to open a PR if the team supports this feature:\r\n\r\n```php\r\nuse Doctrine\\DBAL\\Platforms\\AbstractPlatform;\r\nuse Doctrine\\DBAL\\Types\\StringType;\r\nuse PDO;\r\n\r\nclass VarcharType extends StringType\r\n{\r\n    public const NAME = 'varchar';\r\n\r\n    public function getSQLDeclaration(array $field, AbstractPlatform $platform)\r\n    {\r\n        $length = $field['length'] ?? $platform->getVarcharDefaultLength();\r\n        return 'VARCHAR(' . $length . ')';\r\n    }\r\n\r\n    public function getBindingType()\r\n    {\r\n        return PDO::PARAM_STR | PDO::PARAM_STR_CHAR;\r\n    }\r\n\r\n    public function getName()\r\n    {\r\n        return static::NAME;\r\n    }\r\n}\r\n```\r\n","closed_by":{"login":"morozov","id":59683,"node_id":"MDQ6VXNlcjU5Njgz","avatar_url":"https://avatars.githubusercontent.com/u/59683?v=4","gravatar_id":"","url":"https://api.github.com/users/morozov","html_url":"https://github.com/morozov","followers_url":"https://api.github.com/users/morozov/followers","following_url":"https://api.github.com/users/morozov/following{/other_user}","gists_url":"https://api.github.com/users/morozov/gists{/gist_id}","starred_url":"https://api.github.com/users/morozov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/morozov/subscriptions","organizations_url":"https://api.github.com/users/morozov/orgs","repos_url":"https://api.github.com/users/morozov/repos","events_url":"https://api.github.com/users/morozov/events{/privacy}","received_events_url":"https://api.github.com/users/morozov/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/doctrine/dbal/issues/4263/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/doctrine/dbal/issues/4263/timeline","performed_via_github_app":null,"state_reason":"completed"}