{"url":"https://api.github.com/repos/doctrine/dbal/issues/2306","repository_url":"https://api.github.com/repos/doctrine/dbal","labels_url":"https://api.github.com/repos/doctrine/dbal/issues/2306/labels{/name}","comments_url":"https://api.github.com/repos/doctrine/dbal/issues/2306/comments","events_url":"https://api.github.com/repos/doctrine/dbal/issues/2306/events","html_url":"https://github.com/doctrine/dbal/issues/2306","id":127885975,"node_id":"MDU6SXNzdWUxMjc4ODU5NzU=","number":2306,"title":"Add \"easy connect string\" support for the Oci8Driver","user":{"login":"bobvandevijver","id":1835343,"node_id":"MDQ6VXNlcjE4MzUzNDM=","avatar_url":"https://avatars.githubusercontent.com/u/1835343?v=4","gravatar_id":"","url":"https://api.github.com/users/bobvandevijver","html_url":"https://github.com/bobvandevijver","followers_url":"https://api.github.com/users/bobvandevijver/followers","following_url":"https://api.github.com/users/bobvandevijver/following{/other_user}","gists_url":"https://api.github.com/users/bobvandevijver/gists{/gist_id}","starred_url":"https://api.github.com/users/bobvandevijver/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bobvandevijver/subscriptions","organizations_url":"https://api.github.com/users/bobvandevijver/orgs","repos_url":"https://api.github.com/users/bobvandevijver/repos","events_url":"https://api.github.com/users/bobvandevijver/events{/privacy}","received_events_url":"https://api.github.com/users/bobvandevijver/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":225630784,"node_id":"MDU6TGFiZWwyMjU2MzA3ODQ=","url":"https://api.github.com/repos/doctrine/dbal/labels/Improvement","name":"Improvement","color":"0052cc","default":false,"description":null},{"id":308743849,"node_id":"MDU6TGFiZWwzMDg3NDM4NDk=","url":"https://api.github.com/repos/doctrine/dbal/labels/Oracle","name":"Oracle","color":"c7def8","default":false,"description":null},{"id":308744594,"node_id":"MDU6TGFiZWwzMDg3NDQ1OTQ=","url":"https://api.github.com/repos/doctrine/dbal/labels/oci8","name":"oci8","color":"d4c5f9","default":false,"description":null},{"id":308745351,"node_id":"MDU6TGFiZWwzMDg3NDUzNTE=","url":"https://api.github.com/repos/doctrine/dbal/labels/pdo_oci","name":"pdo_oci","color":"d4c5f9","default":false,"description":""},{"id":308807734,"node_id":"MDU6TGFiZWwzMDg4MDc3MzQ=","url":"https://api.github.com/repos/doctrine/dbal/labels/Drivers","name":"Drivers","color":"bfe5bf","default":false,"description":null},{"id":308818813,"node_id":"MDU6TGFiZWwzMDg4MTg4MTM=","url":"https://api.github.com/repos/doctrine/dbal/labels/Configuration","name":"Configuration","color":"bfe5bf","default":false,"description":null},{"id":308836296,"node_id":"MDU6TGFiZWwzMDg4MzYyOTY=","url":"https://api.github.com/repos/doctrine/dbal/labels/Connecting","name":"Connecting","color":"ffffff","default":false,"description":null},{"id":309370792,"node_id":"MDU6TGFiZWwzMDkzNzA3OTI=","url":"https://api.github.com/repos/doctrine/dbal/labels/Fixed","name":"Fixed","color":"009800","default":false,"description":null}],"state":"closed","locked":true,"assignee":{"login":"deeky666","id":1411514,"node_id":"MDQ6VXNlcjE0MTE1MTQ=","avatar_url":"https://avatars.githubusercontent.com/u/1411514?v=4","gravatar_id":"","url":"https://api.github.com/users/deeky666","html_url":"https://github.com/deeky666","followers_url":"https://api.github.com/users/deeky666/followers","following_url":"https://api.github.com/users/deeky666/following{/other_user}","gists_url":"https://api.github.com/users/deeky666/gists{/gist_id}","starred_url":"https://api.github.com/users/deeky666/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/deeky666/subscriptions","organizations_url":"https://api.github.com/users/deeky666/orgs","repos_url":"https://api.github.com/users/deeky666/repos","events_url":"https://api.github.com/users/deeky666/events{/privacy}","received_events_url":"https://api.github.com/users/deeky666/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"deeky666","id":1411514,"node_id":"MDQ6VXNlcjE0MTE1MTQ=","avatar_url":"https://avatars.githubusercontent.com/u/1411514?v=4","gravatar_id":"","url":"https://api.github.com/users/deeky666","html_url":"https://github.com/deeky666","followers_url":"https://api.github.com/users/deeky666/followers","following_url":"https://api.github.com/users/deeky666/following{/other_user}","gists_url":"https://api.github.com/users/deeky666/gists{/gist_id}","starred_url":"https://api.github.com/users/deeky666/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/deeky666/subscriptions","organizations_url":"https://api.github.com/users/deeky666/orgs","repos_url":"https://api.github.com/users/deeky666/repos","events_url":"https://api.github.com/users/deeky666/events{/privacy}","received_events_url":"https://api.github.com/users/deeky666/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/doctrine/dbal/milestones/4","html_url":"https://github.com/doctrine/dbal/milestone/4","labels_url":"https://api.github.com/repos/doctrine/dbal/milestones/4/labels","id":1446226,"node_id":"MDk6TWlsZXN0b25lMTQ0NjIyNg==","number":4,"title":"2.6.0","description":"","creator":{"login":"beberlei","id":26936,"node_id":"MDQ6VXNlcjI2OTM2","avatar_url":"https://avatars.githubusercontent.com/u/26936?v=4","gravatar_id":"","url":"https://api.github.com/users/beberlei","html_url":"https://github.com/beberlei","followers_url":"https://api.github.com/users/beberlei/followers","following_url":"https://api.github.com/users/beberlei/following{/other_user}","gists_url":"https://api.github.com/users/beberlei/gists{/gist_id}","starred_url":"https://api.github.com/users/beberlei/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/beberlei/subscriptions","organizations_url":"https://api.github.com/users/beberlei/orgs","repos_url":"https://api.github.com/users/beberlei/repos","events_url":"https://api.github.com/users/beberlei/events{/privacy}","received_events_url":"https://api.github.com/users/beberlei/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":229,"state":"closed","created_at":"2015-12-06T13:18:45Z","updated_at":"2019-11-02T23:34:44Z","due_on":null,"closed_at":"2017-07-23T01:08:46Z"},"comments":4,"created_at":"2016-01-21T09:54:13Z","updated_at":"2022-08-04T02:02:20Z","closed_at":"2016-01-22T18:32:23Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I am using the [Oci8Driver](https://github.com/doctrine/dbal/blob/02e5b61baedbeb1832702d0feac3174e70c32c74/lib/Doctrine/DBAL/Driver/OCI8/Driver.php) currently with static connect information, such as host, port and dbname. These parameters are used in the [AbstractOracleDriver#L114](https://github.com/doctrine/dbal/blob/02e5b61baedbeb1832702d0feac3174e70c32c74/lib/Doctrine/DBAL/Driver/AbstractOracleDriver.php#L114) class to generate an easy connect string, which is used to connect to the server/database. \n\nHowever, I want to switch to LDAP resolving for the database host and port. The LDAP server already returns an easy connect string, which currently can not be used directly. I parse the string to retrieve the first mentioned hostname and port, which are set in the connection using a Symfony Compiler Pass (see the shortened snippet below).\n\n``` php\n/** @var DefinitionDecorator $dbal */\n$matches        = array();\npreg_match('/HOST=([^)]*)/ix', $connectionInfo, $matches);\n$host = $matches[1];\npreg_match('/PORT=([^)]*)/ix', $connectionInfo, $matches);\n$port = $matches[1];\n$dbal                 = $container->getDefinition('doctrine.dbal.osiris_connection');\n$arguments            = $dbal->getArguments();\n$arguments[0]['host'] = $host;\n$arguments[0]['port'] = $port;\n$dbal->setArguments($arguments);\n```\n\nThis creates a problem when the first server does not have the database available: an error is thrown (in this case 'ORA-12505: TNS:listener does not currently know of SID given in connect descriptor') and there is no possibility to switch to the other database, although there is a connection list available during the Compiller Pass (but not during runtime). \n\n```\n(DESCRIPTION=\n  (ADDRESS_LIST=\n    (ADDRESS=\n      (PROTOCOL=TCP)\n      (Host=server1.host.nl)\n      (Port=1521)\n    )\n    (ADDRESS=\n      (PROTOCOL=TCP)\n      (Host=server2.host.nl)\n      (Port=1521)\n    )\n  )\n  (CONNECT_DATA=\n    (SERVER=DEDICATED)\n    (SERVICE_NAME=PROD.host.nl)\n  )\n)\n```\n\nI believe that when the connect string can be set in the driver, that handling of such database errors can be done by the lower driver (correct me if I'm wrong). \n\nSo, it would be convenient to be able to set the connect string directly, which can be used if set. I can make a PR for this if wanted. Any opinions?\n\nP.S.: The link in [AbstractOracleDriver#L112](https://github.com/doctrine/dbal/blob/02e5b61baedbeb1832702d0feac3174e70c32c74/lib/Doctrine/DBAL/Driver/AbstractOracleDriver.php#L112) is no longer valid, I can fix that as well.\n","closed_by":{"login":"deeky666","id":1411514,"node_id":"MDQ6VXNlcjE0MTE1MTQ=","avatar_url":"https://avatars.githubusercontent.com/u/1411514?v=4","gravatar_id":"","url":"https://api.github.com/users/deeky666","html_url":"https://github.com/deeky666","followers_url":"https://api.github.com/users/deeky666/followers","following_url":"https://api.github.com/users/deeky666/following{/other_user}","gists_url":"https://api.github.com/users/deeky666/gists{/gist_id}","starred_url":"https://api.github.com/users/deeky666/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/deeky666/subscriptions","organizations_url":"https://api.github.com/users/deeky666/orgs","repos_url":"https://api.github.com/users/deeky666/repos","events_url":"https://api.github.com/users/deeky666/events{/privacy}","received_events_url":"https://api.github.com/users/deeky666/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/doctrine/dbal/issues/2306/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/doctrine/dbal/issues/2306/timeline","performed_via_github_app":null,"state_reason":"completed"}