{"url":"https://api.github.com/repos/doctrine/dbal/issues/4282","repository_url":"https://api.github.com/repos/doctrine/dbal","labels_url":"https://api.github.com/repos/doctrine/dbal/issues/4282/labels{/name}","comments_url":"https://api.github.com/repos/doctrine/dbal/issues/4282/comments","events_url":"https://api.github.com/repos/doctrine/dbal/issues/4282/events","html_url":"https://github.com/doctrine/dbal/issues/4282","id":706204040,"node_id":"MDU6SXNzdWU3MDYyMDQwNDA=","number":4282,"title":"Skip empty expression parts","user":{"login":"infabo","id":3999104,"node_id":"MDQ6VXNlcjM5OTkxMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/3999104?v=4","gravatar_id":"","url":"https://api.github.com/users/infabo","html_url":"https://github.com/infabo","followers_url":"https://api.github.com/users/infabo/followers","following_url":"https://api.github.com/users/infabo/following{/other_user}","gists_url":"https://api.github.com/users/infabo/gists{/gist_id}","starred_url":"https://api.github.com/users/infabo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/infabo/subscriptions","organizations_url":"https://api.github.com/users/infabo/orgs","repos_url":"https://api.github.com/users/infabo/repos","events_url":"https://api.github.com/users/infabo/events{/privacy}","received_events_url":"https://api.github.com/users/infabo/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":308809497,"node_id":"MDU6TGFiZWwzMDg4MDk0OTc=","url":"https://api.github.com/repos/doctrine/dbal/labels/QueryBuilder","name":"QueryBuilder","color":"bfe5bf","default":false,"description":""},{"id":308827849,"node_id":"MDU6TGFiZWwzMDg4Mjc4NDk=","url":"https://api.github.com/repos/doctrine/dbal/labels/BC%20Break","name":"BC Break","color":"e11d21","default":false,"description":null}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/doctrine/dbal/milestones/80","html_url":"https://github.com/doctrine/dbal/milestone/80","labels_url":"https://api.github.com/repos/doctrine/dbal/milestones/80/labels","id":5904164,"node_id":"MDk6TWlsZXN0b25lNTkwNDE2NA==","number":80,"title":"2.11.1","description":"","creator":{"login":"morozov","id":59683,"node_id":"MDQ6VXNlcjU5Njgz","avatar_url":"https://avatars.githubusercontent.com/u/59683?v=4","gravatar_id":"","url":"https://api.github.com/users/morozov","html_url":"https://github.com/morozov","followers_url":"https://api.github.com/users/morozov/followers","following_url":"https://api.github.com/users/morozov/following{/other_user}","gists_url":"https://api.github.com/users/morozov/gists{/gist_id}","starred_url":"https://api.github.com/users/morozov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/morozov/subscriptions","organizations_url":"https://api.github.com/users/morozov/orgs","repos_url":"https://api.github.com/users/morozov/repos","events_url":"https://api.github.com/users/morozov/events{/privacy}","received_events_url":"https://api.github.com/users/morozov/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":10,"state":"closed","created_at":"2020-09-22T13:37:01Z","updated_at":"2020-09-27T04:32:41Z","due_on":null,"closed_at":"2020-09-27T04:32:41Z"},"comments":20,"created_at":"2020-09-22T09:06:28Z","updated_at":"2022-07-28T00:22:43Z","closed_at":"2020-09-23T01:37:08Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Bug Report\r\n\r\n|    Q        |   A\r\n|------------ | ------\r\n| BC Break    | yes\r\n| Version     | 2.11.0\r\n\r\n#### Summary\r\n\r\nThe commit 1d503253ff57987161f10d4f2c81b5a9889d48a4 introduced a breaking change.\r\n\r\n[CompsiteExpression->with()](https://github.com/doctrine/dbal/blob/2.11.x/lib/Doctrine/DBAL/Query/Expression/CompositeExpression.php#L119) directly adds `parts`, whereas the old [CompositeExpression->addMultiple()](https://github.com/doctrine/dbal/blob/2.11.x/lib/Doctrine/DBAL/Query/Expression/CompositeExpression.php#L80) utilized [CompositeExpression->add()](https://github.com/doctrine/dbal/blob/2.11.x/lib/Doctrine/DBAL/Query/Expression/CompositeExpression.php#L98) which had an `empty`-check.\r\n\r\n- has a guard\r\nsee https://github.com/doctrine/dbal/blob/2.11.x/lib/Doctrine/DBAL/Query/Expression/CompositeExpression.php#L100\r\n\r\n- has no guard\r\nsee https://github.com/doctrine/dbal/blob/2.11.x/lib/Doctrine/DBAL/Query/Expression/CompositeExpression.php#L126\r\n\r\n#### Current behaviour\r\n\r\n`parts` with empty-string result in `AND ()` which is an invalid where-expression.\r\n\r\n#### How to reproduce\r\n\r\n- Instantiate QueryBuilder instance.\r\n- provide an empty string to `andWhere`\r\n\r\n```php\r\n$queryBuilder->andWhere('', \"foo = 'bar'\")->getSQL();\r\n```\r\n\r\n#### Expected behaviour\r\n\r\nDo not add empty where conditions in `CompositeExpression->with()` as `CompositeExpression->add()` did.\r\n\r\n","closed_by":{"login":"morozov","id":59683,"node_id":"MDQ6VXNlcjU5Njgz","avatar_url":"https://avatars.githubusercontent.com/u/59683?v=4","gravatar_id":"","url":"https://api.github.com/users/morozov","html_url":"https://github.com/morozov","followers_url":"https://api.github.com/users/morozov/followers","following_url":"https://api.github.com/users/morozov/following{/other_user}","gists_url":"https://api.github.com/users/morozov/gists{/gist_id}","starred_url":"https://api.github.com/users/morozov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/morozov/subscriptions","organizations_url":"https://api.github.com/users/morozov/orgs","repos_url":"https://api.github.com/users/morozov/repos","events_url":"https://api.github.com/users/morozov/events{/privacy}","received_events_url":"https://api.github.com/users/morozov/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/doctrine/dbal/issues/4282/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/doctrine/dbal/issues/4282/timeline","performed_via_github_app":null,"state_reason":"completed"}