{"url":"https://api.github.com/repos/doctrine/dbal/issues/2917","repository_url":"https://api.github.com/repos/doctrine/dbal","labels_url":"https://api.github.com/repos/doctrine/dbal/issues/2917/labels{/name}","comments_url":"https://api.github.com/repos/doctrine/dbal/issues/2917/comments","events_url":"https://api.github.com/repos/doctrine/dbal/issues/2917/events","html_url":"https://github.com/doctrine/dbal/issues/2917","id":274557422,"node_id":"MDU6SXNzdWUyNzQ1NTc0MjI=","number":2917,"title":"Incremental check for coding standards in pull requests","user":{"login":"morozov","id":59683,"node_id":"MDQ6VXNlcjU5Njgz","avatar_url":"https://avatars.githubusercontent.com/u/59683?v=4","gravatar_id":"","url":"https://api.github.com/users/morozov","html_url":"https://github.com/morozov","followers_url":"https://api.github.com/users/morozov/followers","following_url":"https://api.github.com/users/morozov/following{/other_user}","gists_url":"https://api.github.com/users/morozov/gists{/gist_id}","starred_url":"https://api.github.com/users/morozov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/morozov/subscriptions","organizations_url":"https://api.github.com/users/morozov/orgs","repos_url":"https://api.github.com/users/morozov/repos","events_url":"https://api.github.com/users/morozov/events{/privacy}","received_events_url":"https://api.github.com/users/morozov/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":225630784,"node_id":"MDU6TGFiZWwyMjU2MzA3ODQ=","url":"https://api.github.com/repos/doctrine/dbal/labels/Improvement","name":"Improvement","color":"0052cc","default":false,"description":null},{"id":307658611,"node_id":"MDU6TGFiZWwzMDc2NTg2MTE=","url":"https://api.github.com/repos/doctrine/dbal/labels/CI","name":"CI","color":"006b75","default":false,"description":""}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2017-11-16T15:30:39Z","updated_at":"2022-08-03T02:07:48Z","closed_at":"2017-12-22T07:21:06Z","author_association":"MEMBER","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"The existing approach of running `phpcs` over the entire codebase on pull requests is not really helpful because:\r\n\r\n1. The build stage [always fails](https://travis-ci.org/doctrine/dbal/jobs/289967293) due to existing standard violations.\r\n2. It's unlikely that they all will be fixed any time soon due to the number of them (looks like thousands).\r\n3. Fixing some violations may be BC-breaking-ish (e.g. renaming `protected` methods/properties starting with an underscore).\r\n4. There's a waste of time of developers and reviewers on manually finding and additionally fixing violations.\r\n5. If not found/fixed, new violations are introduced. It's a vicious circle.\r\n6. Without proper automation, many new contributors (including myself until recently) don't even know that the project has its own custom coding standards.\r\n\r\nIncremental checks could be done using [morozov/diff-sniffer-pull-request](https://github.com/morozov/diff-sniffer-pull-request) like following:\r\n```\r\n# assuming we're in the dbal repo with installed dependencies\r\n$ wget https://github.com/morozov/diff-sniffer-pull-request/releases/download/3.1.1/pull-request.phar\r\n$ php pull-request.phar doctrine dbal 2494\r\n\r\nFILE: lib/Doctrine/DBAL/Driver/SQLSrv/SQLSrvStatement.php\r\n-------------------------------------------------------------------------------\r\nFOUND 4 ERRORS AFFECTING 2 LINES\r\n-------------------------------------------------------------------------------\r\n 203 | ERROR | [x] There must be a single space before a NOT operator; 0 found\r\n 203 | ERROR | [x] There must be a single space after a NOT operator; 0 found\r\n 210 | ERROR | [x] There must be a single space before a NOT operator; 0 found\r\n 210 | ERROR | [x] There must be a single space after a NOT operator; 0 found\r\n-------------------------------------------------------------------------------\r\nPHPCBF CAN FIX THE 4 MARKED SNIFF VIOLATIONS AUTOMATICALLY\r\n-------------------------------------------------------------------------------\r\n--More--\r\n```\r\n\r\nOn Travis CI, it could be a [conditional build job](https://docs.travis-ci.com/user/conditional-builds-stages-jobs/#Conditional-Stages) which is only executed for pull requests. Some pull requests will inevitably fail (e.g. if they override a method starting with an underscore). Even in this case, I'd prefer to not allow this stage to fail since a pull request with a failed build still can be merged.\r\n\r\nAnyone volunteers to implement?","closed_by":{"login":"Ocramius","id":154256,"node_id":"MDQ6VXNlcjE1NDI1Ng==","avatar_url":"https://avatars.githubusercontent.com/u/154256?v=4","gravatar_id":"","url":"https://api.github.com/users/Ocramius","html_url":"https://github.com/Ocramius","followers_url":"https://api.github.com/users/Ocramius/followers","following_url":"https://api.github.com/users/Ocramius/following{/other_user}","gists_url":"https://api.github.com/users/Ocramius/gists{/gist_id}","starred_url":"https://api.github.com/users/Ocramius/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Ocramius/subscriptions","organizations_url":"https://api.github.com/users/Ocramius/orgs","repos_url":"https://api.github.com/users/Ocramius/repos","events_url":"https://api.github.com/users/Ocramius/events{/privacy}","received_events_url":"https://api.github.com/users/Ocramius/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/doctrine/dbal/issues/2917/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/doctrine/dbal/issues/2917/timeline","performed_via_github_app":null,"state_reason":"completed"}