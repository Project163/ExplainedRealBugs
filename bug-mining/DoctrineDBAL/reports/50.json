{"url":"https://api.github.com/repos/doctrine/dbal/issues/7021","repository_url":"https://api.github.com/repos/doctrine/dbal","labels_url":"https://api.github.com/repos/doctrine/dbal/issues/7021/labels{/name}","comments_url":"https://api.github.com/repos/doctrine/dbal/issues/7021/comments","events_url":"https://api.github.com/repos/doctrine/dbal/issues/7021/events","html_url":"https://github.com/doctrine/dbal/issues/7021","id":3221734931,"node_id":"I_kwDOAApWWM7AB8YT","number":7021,"title":"MySQLSchemaManagerTest::testUpdateSchemaWithForeignKeyRenaming test failure on MariaDB nightly","user":{"login":"grooverdan","id":462287,"node_id":"MDQ6VXNlcjQ2MjI4Nw==","avatar_url":"https://avatars.githubusercontent.com/u/462287?v=4","gravatar_id":"","url":"https://api.github.com/users/grooverdan","html_url":"https://github.com/grooverdan","followers_url":"https://api.github.com/users/grooverdan/followers","following_url":"https://api.github.com/users/grooverdan/following{/other_user}","gists_url":"https://api.github.com/users/grooverdan/gists{/gist_id}","starred_url":"https://api.github.com/users/grooverdan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/grooverdan/subscriptions","organizations_url":"https://api.github.com/users/grooverdan/orgs","repos_url":"https://api.github.com/users/grooverdan/repos","events_url":"https://api.github.com/users/grooverdan/events{/privacy}","received_events_url":"https://api.github.com/users/grooverdan/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":308745760,"node_id":"MDU6TGFiZWwzMDg3NDU3NjA=","url":"https://api.github.com/repos/doctrine/dbal/labels/MariaDB","name":"MariaDB","color":"c7def8","default":false,"description":null},{"id":308835900,"node_id":"MDU6TGFiZWwzMDg4MzU5MDA=","url":"https://api.github.com/repos/doctrine/dbal/labels/Quoting","name":"Quoting","color":"ffffff","default":false,"description":null},{"id":309180183,"node_id":"MDU6TGFiZWwzMDkxODAxODM=","url":"https://api.github.com/repos/doctrine/dbal/labels/Foreign%20Keys","name":"Foreign Keys","color":"ffffff","default":false,"description":null},{"id":3199880642,"node_id":"MDU6TGFiZWwzMTk5ODgwNjQy","url":"https://api.github.com/repos/doctrine/dbal/labels/Identifiers","name":"Identifiers","color":"17D419","default":false,"description":""}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2025-07-11T06:32:37Z","updated_at":"2025-08-21T00:28:26Z","closed_at":"2025-07-21T06:49:06Z","author_association":"CONTRIBUTOR","type":{"id":99724,"node_id":"IT_kwDOAAMxZs4AAYWM","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-25T09:11:40Z","updated_at":"2024-07-26T10:05:02Z","is_enabled":true},"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Bug Report\n\n<!-- Fill in the relevant information below to help triage your issue. -->\n\n|    Q                                        |   A\n|-------------------------------------------- | ------\n| Version                                     | 4.3.x\n| Previous Version if the bug is a regression |  (Mariadb change from 12.0)\n\n#### Summary\n\nfrom:  https://github.com/doctrine/dbal/actions/runs/16211252860/job/45771634245\n\nand [MDEV-28933: Per-table unique FOREIGN KEY constraint names](https://github.com/MariaDB/server/pull/3960/files#top) [#3960](https://github.com/MariaDB/server/pull/3960)\n\nA new feature of MariaDB simplified the column names to just numbers.\n\nPreviously a query:\n```\nMariaDB [(none)]>  SELECT\n    ->             k.TABLE_NAME,\n    ->             k.CONSTRAINT_NAME,\n    ->             k.COLUMN_NAME,\n    ->             k.REFERENCED_TABLE_NAME,\n    ->             k.REFERENCED_COLUMN_NAME,\n    ->             k.ORDINAL_POSITION,\n    ->             c.UPDATE_RULE,\n    ->             c.DELETE_RULE\n    -> FROM information_schema.key_column_usage k\n    -> INNER JOIN information_schema.referential_constraints c\n    -> ON c.CONSTRAINT_NAME = k.CONSTRAINT_NAME\n    -> AND c.TABLE_NAME = k.TABLE_NAME\n    -> WHERE k.TABLE_SCHEMA = 'doctrine_tests' AND c.CONSTRAINT_SCHEMA = 'doctrine_tests' AND k.TABLE_NAME = 'test_fk_rename'\n    -> AND k.REFERENCED_COLUMN_NAME IS NOT NULL\n    -> ORDER BY k.TABLE_NAME,\n    ->          k.CONSTRAINT_NAME,\n    ->          k.ORDINAL_POSITION;\n+----------------+-----------------------+--------------+-----------------------+------------------------+------------------+-------------+-------------+\n| TABLE_NAME     | CONSTRAINT_NAME       | COLUMN_NAME  | REFERENCED_TABLE_NAME | REFERENCED_COLUMN_NAME | ORDINAL_POSITION | UPDATE_RULE | DELETE_RULE |\n+----------------+-----------------------+--------------+-----------------------+------------------------+------------------+-------------+-------------+\n| test_fk_rename | test_fk_rename_ibfk_1 | rename_fk_id | test_fk_base          | id                     |                1 | RESTRICT    | RESTRICT    |\n+----------------+-----------------------+--------------+-----------------------+------------------------+------------------+-------------+-------------+\n```\n\nAnd executes:\n\n```\n             5 Query    ALTER TABLE test_fk_rename DROP FOREIGN KEY test_fk_rename_ibfk_1\n```\n\nWith the new 12.1 version:\n\n```\n+----------------+-----------------+-------------+-----------------------+------------------------+------------------+-------------+-------------+\n| TABLE_NAME     | CONSTRAINT_NAME | COLUMN_NAME | REFERENCED_TABLE_NAME | REFERENCED_COLUMN_NAME | ORDINAL_POSITION | UPDATE_RULE | DELETE_RULE |\n+----------------+-----------------+-------------+-----------------------+------------------------+------------------+-------------+-------------+\n| test_fk_rename | 1               | fk_id       | test_fk_base          | id                     |                1 | RESTRICT    | RESTRICT    |\n+----------------+-----------------+-------------+-----------------------+------------------------+------------------+-------------+-------------+\n```\n\nresults in:\n\n```\nALTER TABLE test_fk_rename DROP FOREIGN KEY 1\n```\n\nresulting in:\n```\n Doctrine\\DBAL\\Exception\\SyntaxErrorException: An exception occurred while executing a query: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '1' at line 1\n```\n\n<!-- Provide a summary describing the problem you are experiencing. -->\n\n#### Current behavior\n\nThe current FK constraint names are unquoted. This worked fine until they became numbers requiring quotes.\n\nAs @dr-m points out MySQL 4.0.17 or earlier would have had a similar issue with the 0_1 style names.\n\n`src/Platforms/MariaDBPlatform.php:getPreAlterTableRenameIndexForeignKeySQL`\n\n```\n$this->getDropForeignKeySQL($foreignKey->getQuotedName($this), $tableName);\n```\n\nSo it looks like its quoting the name, but it actually doesnâ€™t.\n\n#### Expected behavior\n\n\nThe `getDropForeignKeySQL` to get passed a quoted `$foreignKey` from MariaDBPlatform.\n\n\n#### How to reproduce\n\ntest case MySQLSchemaManagerTest::testUpdateSchemaWithForeignKeyRenaming on  `quay.io/mariadb-foundation/mariadb-devel:12.1`\n\n<!--\nProvide a failing Unit or Functional Test - you can submit one in a Pull\nRequest separately, referencing this bug report. And if you feel like it, why\nnot fix the bug while you're at it?\nIf that is too difficult, provide a link to a minimal repository containing an\napplication that reproduces the bug.\nIf the bug is simple, you may provide a code snippet instead, or even a list of\nsteps.\n-->\n","closed_by":{"login":"greg0ire","id":657779,"node_id":"MDQ6VXNlcjY1Nzc3OQ==","avatar_url":"https://avatars.githubusercontent.com/u/657779?v=4","gravatar_id":"","url":"https://api.github.com/users/greg0ire","html_url":"https://github.com/greg0ire","followers_url":"https://api.github.com/users/greg0ire/followers","following_url":"https://api.github.com/users/greg0ire/following{/other_user}","gists_url":"https://api.github.com/users/greg0ire/gists{/gist_id}","starred_url":"https://api.github.com/users/greg0ire/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/greg0ire/subscriptions","organizations_url":"https://api.github.com/users/greg0ire/orgs","repos_url":"https://api.github.com/users/greg0ire/repos","events_url":"https://api.github.com/users/greg0ire/events{/privacy}","received_events_url":"https://api.github.com/users/greg0ire/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/doctrine/dbal/issues/7021/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/doctrine/dbal/issues/7021/timeline","performed_via_github_app":null,"state_reason":"completed"}