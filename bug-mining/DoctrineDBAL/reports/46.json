{"url":"https://api.github.com/repos/doctrine/dbal/issues/6126","repository_url":"https://api.github.com/repos/doctrine/dbal","labels_url":"https://api.github.com/repos/doctrine/dbal/issues/6126/labels{/name}","comments_url":"https://api.github.com/repos/doctrine/dbal/issues/6126/comments","events_url":"https://api.github.com/repos/doctrine/dbal/issues/6126/events","html_url":"https://github.com/doctrine/dbal/issues/6126","id":1845165798,"node_id":"I_kwDOAApWWM5t-v7m","number":6126,"title":"DBAL36 - BIGINT documentation misunderstanding","user":{"login":"cizordj","id":32869222,"node_id":"MDQ6VXNlcjMyODY5MjIy","avatar_url":"https://avatars.githubusercontent.com/u/32869222?v=4","gravatar_id":"","url":"https://api.github.com/users/cizordj","html_url":"https://github.com/cizordj","followers_url":"https://api.github.com/users/cizordj/followers","following_url":"https://api.github.com/users/cizordj/following{/other_user}","gists_url":"https://api.github.com/users/cizordj/gists{/gist_id}","starred_url":"https://api.github.com/users/cizordj/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cizordj/subscriptions","organizations_url":"https://api.github.com/users/cizordj/orgs","repos_url":"https://api.github.com/users/cizordj/repos","events_url":"https://api.github.com/users/cizordj/events{/privacy}","received_events_url":"https://api.github.com/users/cizordj/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":308808049,"node_id":"MDU6TGFiZWwzMDg4MDgwNDk=","url":"https://api.github.com/repos/doctrine/dbal/labels/Types","name":"Types","color":"bfe5bf","default":false,"description":null},{"id":308814101,"node_id":"MDU6TGFiZWwzMDg4MTQxMDE=","url":"https://api.github.com/repos/doctrine/dbal/labels/Documentation","name":"Documentation","color":"fef2c0","default":false,"description":null},{"id":309182720,"node_id":"MDU6TGFiZWwzMDkxODI3MjA=","url":"https://api.github.com/repos/doctrine/dbal/labels/Type%20Conversion","name":"Type Conversion","color":"ffffff","default":false,"description":null}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":17,"created_at":"2023-08-10T13:13:02Z","updated_at":"2023-12-09T00:19:58Z","closed_at":"2023-11-08T12:37:32Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Bug Report\r\n\r\n|    Q        |   A\r\n|------------ | ------\r\n| Version     | 3.6.5\r\n\r\n#### Summary\r\n\r\nPlease rephrase the explanation in the docs about the **BIGINT** datatype.\r\n\r\n#### Current behaviour\r\n\r\nThe current statements lead to misinterpretation:\r\n\r\n```markdown\r\n<!-- dbal/docs/en/reference/types.rst:90 -->\r\nValues retrieved from the database are always converted to PHP's ``string`` type\r\nor ``null`` if no data is present.\r\n```\r\n\r\n```markdown\r\n<!-- dbal/docs/en/reference/types.rst:95 -->\r\nFor compatibility reasons this type is not converted to an integer\r\n```\r\n\r\nWhich is not true.\r\n\r\nWe have many entities mapped with **BIGINT** and **BIGSERIAL** in a PostgreSQL database\r\nand doctrine always casts their value to a regular PHP integer. We use the 64 bit architecture\r\nand the primary keys are mapped this way.\r\n\r\n```php\r\n<?php\r\nclass User {\r\n    #[ORM\\Id]\r\n    #[ORM\\GeneratedValue(strategy: 'SEQUENCE')]\r\n    #[ORM\\SequenceGenerator(\r\n        sequenceName: 'user.user_id_user_seq',\r\n        allocationSize: 1,\r\n        initialValue: 1\r\n    )]\r\n    #[ORM\\Column(name: 'id_user', type: Types::BIGINT)]\r\n    private ?int $id = null;\r\n}\r\n```\r\nAccording to the [PostgreSQL's documentation](https://www.postgresql.org/docs/11/datatype-numeric.html) the maximum number for a BIGINT field is **9223372036854775807** which is the same as the [PHP_INT_MAX](https://www.php.net/manual/en/reserved.constants.php).\r\n\r\n#### How to reproduce\r\n\r\n<!--\r\nProvide steps to reproduce the bug.\r\nIf possible, also add a code snippet with relevant configuration, driver/platform information, SQL queries, etc.\r\nAdding a failing Unit or Functional Test would help us a lot - you can submit one in a Pull Request separately, referencing this bug report.\r\n-->\r\n\r\n- Make an entity whose primary key represents a **BIGINT** type in the database.\r\n- Run the respective migration\r\n- Add a row to the table via a SQL script\r\n- Fetch that entity using that entity's repository via Symfony Commands or Regular Controllers\r\n- Debug the datatype via `dd()` or let it serialize it through a JsonResponse.\r\n\r\nYou'll notice that the value comes as a PHP integer.\r\n\r\nYou can also add another row to the table with the maximum possible value, see the value of PHP_INT_MAX and make an insertion to the database.\r\nFetch all the entities and you can see that the value still comes as a regular integer type.\r\n\r\nDue to the limitations of JSON, things start to get really weird for numbers like this, so you can only trust the `dd()` output in this case.\r\n\r\n#### Expected behaviour\r\n\r\nThe docs should say that the values retrieved from the database are always converted to PHP's ``int`` type or ``null`` if no data is present and display a notice about it being cast to string only in legacy 32-bit platforms.\r\n\r\nBtw why have you guys changed your minds? #2976","closed_by":{"login":"derrabus","id":1506493,"node_id":"MDQ6VXNlcjE1MDY0OTM=","avatar_url":"https://avatars.githubusercontent.com/u/1506493?v=4","gravatar_id":"","url":"https://api.github.com/users/derrabus","html_url":"https://github.com/derrabus","followers_url":"https://api.github.com/users/derrabus/followers","following_url":"https://api.github.com/users/derrabus/following{/other_user}","gists_url":"https://api.github.com/users/derrabus/gists{/gist_id}","starred_url":"https://api.github.com/users/derrabus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/derrabus/subscriptions","organizations_url":"https://api.github.com/users/derrabus/orgs","repos_url":"https://api.github.com/users/derrabus/repos","events_url":"https://api.github.com/users/derrabus/events{/privacy}","received_events_url":"https://api.github.com/users/derrabus/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/doctrine/dbal/issues/6126/reactions","total_count":5,"+1":5,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/doctrine/dbal/issues/6126/timeline","performed_via_github_app":null,"state_reason":"completed"}