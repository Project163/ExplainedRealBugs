{"url":"https://api.github.com/repos/doctrine/dbal/issues/6595","repository_url":"https://api.github.com/repos/doctrine/dbal","labels_url":"https://api.github.com/repos/doctrine/dbal/issues/6595/labels{/name}","comments_url":"https://api.github.com/repos/doctrine/dbal/issues/6595/comments","events_url":"https://api.github.com/repos/doctrine/dbal/issues/6595/events","html_url":"https://github.com/doctrine/dbal/issues/6595","id":2653058647,"node_id":"I_kwDOAApWWM6eInZX","number":6595,"title":"OCI8 driver does not check result from oci_parse, relies on disabled assert in production","user":{"login":"segrax","id":1327406,"node_id":"MDQ6VXNlcjEzMjc0MDY=","avatar_url":"https://avatars.githubusercontent.com/u/1327406?v=4","gravatar_id":"","url":"https://api.github.com/users/segrax","html_url":"https://github.com/segrax","followers_url":"https://api.github.com/users/segrax/followers","following_url":"https://api.github.com/users/segrax/following{/other_user}","gists_url":"https://api.github.com/users/segrax/gists{/gist_id}","starred_url":"https://api.github.com/users/segrax/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/segrax/subscriptions","organizations_url":"https://api.github.com/users/segrax/orgs","repos_url":"https://api.github.com/users/segrax/repos","events_url":"https://api.github.com/users/segrax/events{/privacy}","received_events_url":"https://api.github.com/users/segrax/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":225630643,"node_id":"MDU6TGFiZWwyMjU2MzA2NDM=","url":"https://api.github.com/repos/doctrine/dbal/labels/Bug","name":"Bug","color":"e11d21","default":false,"description":null},{"id":308744594,"node_id":"MDU6TGFiZWwzMDg3NDQ1OTQ=","url":"https://api.github.com/repos/doctrine/dbal/labels/oci8","name":"oci8","color":"d4c5f9","default":false,"description":null},{"id":308837051,"node_id":"MDU6TGFiZWwzMDg4MzcwNTE=","url":"https://api.github.com/repos/doctrine/dbal/labels/Prepared%20Statements","name":"Prepared Statements","color":"ffffff","default":false,"description":null}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/doctrine/dbal/milestones/169","html_url":"https://github.com/doctrine/dbal/milestone/169","labels_url":"https://api.github.com/repos/doctrine/dbal/milestones/169/labels","id":11711136,"node_id":"MI_kwDOAApWWM4AsrKg","number":169,"title":"4.2.2","description":"","creator":{"login":"derrabus","id":1506493,"node_id":"MDQ6VXNlcjE1MDY0OTM=","avatar_url":"https://avatars.githubusercontent.com/u/1506493?v=4","gravatar_id":"","url":"https://api.github.com/users/derrabus","html_url":"https://github.com/derrabus","followers_url":"https://api.github.com/users/derrabus/followers","following_url":"https://api.github.com/users/derrabus/following{/other_user}","gists_url":"https://api.github.com/users/derrabus/gists{/gist_id}","starred_url":"https://api.github.com/users/derrabus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/derrabus/subscriptions","organizations_url":"https://api.github.com/users/derrabus/orgs","repos_url":"https://api.github.com/users/derrabus/repos","events_url":"https://api.github.com/users/derrabus/events{/privacy}","received_events_url":"https://api.github.com/users/derrabus/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":19,"state":"closed","created_at":"2024-10-10T18:12:35Z","updated_at":"2025-01-16T08:50:53Z","due_on":"2025-01-16T08:00:00Z","closed_at":"2025-01-16T08:50:53Z"},"comments":2,"created_at":"2024-11-12T18:58:23Z","updated_at":"2024-12-23T00:29:15Z","closed_at":"2024-11-22T07:14:55Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Bug Report\r\n\r\n\r\n|    Q                                        |   A\r\n|-------------------------------------------- | ------\r\n| Version                                     | 4.2.1\r\n\r\n#### Summary\r\n\r\nThe Oracle (OCI8) driver uses assert to verify the result from oci_parse. \r\n\r\nBy default (since PHP7), assert is disabled in production environments, which means the validation is never executed in prod. Unlike other drivers that handle this check by throwing exceptions, the OCI8 driver relies on assert, resulting in warnings in the log, and no way of catching the lost connection\r\n\r\n```php\r\n        $statement = oci_parse($this->connection, $visitor->getSQL());\r\n        assert(is_resource($statement));\r\n\r\n        return new Statement($this->connection, $statement, $visitor->getParameterMap(), $this->executionMode);\r\n```\r\n#### Current behavior\r\n\r\nIn production, if oci_parse fails (e.g., due to a connection issue), the assert statement is bypassed, leading to PHP warnings rather than controlled exceptions. This results in the following warning:\r\n```\r\nPHP Warning: oci_parse(): ORA-03114: not connected to ORACLE in /srv/app/vendor/doctrine/dbal/src/Driver/OCI8/Connection.php on line 57\r\n```\r\n\r\n#### Expected behavior\r\n\r\nThe Oracle driver should handle oci_parse failures consistently with other drivers by checking the result and throwing an appropriate exception if oci_parse fails. This would ensure reliable error handling across all environments\r\n\r\n#### How to reproduce\r\n\r\n1. Disable assertions in your production-like environment\r\n2. Use the OCI8 driver to connect to an Oracle database\r\n3. Trigger a connection issue (e.g., disconnect or shutdown the Oracle server)\r\n4. Observe that instead of an exception, a PHP warning is issued, and the error is not handled as expected\r\n","closed_by":{"login":"morozov","id":59683,"node_id":"MDQ6VXNlcjU5Njgz","avatar_url":"https://avatars.githubusercontent.com/u/59683?v=4","gravatar_id":"","url":"https://api.github.com/users/morozov","html_url":"https://github.com/morozov","followers_url":"https://api.github.com/users/morozov/followers","following_url":"https://api.github.com/users/morozov/following{/other_user}","gists_url":"https://api.github.com/users/morozov/gists{/gist_id}","starred_url":"https://api.github.com/users/morozov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/morozov/subscriptions","organizations_url":"https://api.github.com/users/morozov/orgs","repos_url":"https://api.github.com/users/morozov/repos","events_url":"https://api.github.com/users/morozov/events{/privacy}","received_events_url":"https://api.github.com/users/morozov/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/doctrine/dbal/issues/6595/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/doctrine/dbal/issues/6595/timeline","performed_via_github_app":null,"state_reason":"completed"}