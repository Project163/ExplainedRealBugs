{"url":"https://api.github.com/repos/syncthing/syncthing/issues/6734","repository_url":"https://api.github.com/repos/syncthing/syncthing","labels_url":"https://api.github.com/repos/syncthing/syncthing/issues/6734/labels{/name}","comments_url":"https://api.github.com/repos/syncthing/syncthing/issues/6734/comments","events_url":"https://api.github.com/repos/syncthing/syncthing/issues/6734/events","html_url":"https://github.com/syncthing/syncthing/issues/6734","id":636529265,"node_id":"MDU6SXNzdWU2MzY1MjkyNjU=","number":6734,"title":"Consider moving configuration to a proto contract","user":{"login":"AudriusButkevicius","id":1144861,"node_id":"MDQ6VXNlcjExNDQ4NjE=","avatar_url":"https://avatars.githubusercontent.com/u/1144861?v=4","gravatar_id":"","url":"https://api.github.com/users/AudriusButkevicius","html_url":"https://github.com/AudriusButkevicius","followers_url":"https://api.github.com/users/AudriusButkevicius/followers","following_url":"https://api.github.com/users/AudriusButkevicius/following{/other_user}","gists_url":"https://api.github.com/users/AudriusButkevicius/gists{/gist_id}","starred_url":"https://api.github.com/users/AudriusButkevicius/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AudriusButkevicius/subscriptions","organizations_url":"https://api.github.com/users/AudriusButkevicius/orgs","repos_url":"https://api.github.com/users/AudriusButkevicius/repos","events_url":"https://api.github.com/users/AudriusButkevicius/events{/privacy}","received_events_url":"https://api.github.com/users/AudriusButkevicius/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":67767667,"node_id":"MDU6TGFiZWw2Nzc2NzY2Nw==","url":"https://api.github.com/repos/syncthing/syncthing/labels/enhancement","name":"enhancement","color":"0e8a16","default":true,"description":"New features or improvements of some kind, as opposed to a problem (bug)"},{"id":628314330,"node_id":"MDU6TGFiZWw2MjgzMTQzMzA=","url":"https://api.github.com/repos/syncthing/syncthing/labels/frozen-due-to-age","name":"frozen-due-to-age","color":"eeeeee","default":false,"description":"Issues closed and untouched for a long time, together with being locked for discussion"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/syncthing/syncthing/milestones/54","html_url":"https://github.com/syncthing/syncthing/milestone/54","labels_url":"https://api.github.com/repos/syncthing/syncthing/milestones/54/labels","id":5807421,"node_id":"MDk6TWlsZXN0b25lNTgwNzQyMQ==","number":54,"title":"v1.10.0","description":"This release adds the config option `announceLANAddresses` to enable (the default) or disable announcing private (RFC1918)  LAN IP addresses to global discovery.","creator":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":45,"state":"closed","created_at":"2020-08-25T09:49:15Z","updated_at":"2020-10-06T10:50:34Z","due_on":"2020-10-06T07:00:00Z","closed_at":"2020-10-06T10:50:34Z"},"comments":1,"created_at":"2020-06-10T20:33:10Z","updated_at":"2021-08-25T07:02:35Z","closed_at":"2020-08-25T06:11:16Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I think it would not be too hard to move structs to be generated from proto.\r\n\r\ngogoproto supports additional tags as well as json overrides:\r\n https://github.com/gogo/protobuf/blob/master/test/tags/tags.proto\r\n\r\nwhich should be sufficient for our purposes to replicate what we have now.\r\n\r\nThis proto file could then be used by other languages to generate serialisation code/classes for the config, and proto as a format natively supports json serialization, atleast in every language I used it.\r\n\r\nI guess we can't make other clients not generate deprecated fields (even tho there is `deprecated` extension for that), but we could still ignore them when deserializing json by setting the json tag to `-`\r\n\r\nReason I am proposing this is because in non-dynamic languages, the classes you use to deserialize the data needs to map exactly to what the config has, otherwise you'll lose fields, and then potentially unset them when posting the config back.\r\n\r\nIn dynamic languages, this is not or a problem as you can just have dic of dics in python with random types and nobody cares.\r\n\r\nObviously, people might not use the latest version of tne contract, which could still lead to the same issue, but I guess we could make it more obvious in the release notes that people need to update the contract, especially when the default value of the field is not an empty value (urUrl for example)\r\n","closed_by":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/syncthing/syncthing/issues/6734/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/syncthing/syncthing/issues/6734/timeline","performed_via_github_app":null,"state_reason":"completed"}