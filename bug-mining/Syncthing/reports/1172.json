{"url":"https://api.github.com/repos/syncthing/syncthing/issues/7137","repository_url":"https://api.github.com/repos/syncthing/syncthing","labels_url":"https://api.github.com/repos/syncthing/syncthing/issues/7137/labels{/name}","comments_url":"https://api.github.com/repos/syncthing/syncthing/issues/7137/comments","events_url":"https://api.github.com/repos/syncthing/syncthing/issues/7137/events","html_url":"https://github.com/syncthing/syncthing/issues/7137","id":748251736,"node_id":"MDU6SXNzdWU3NDgyNTE3MzY=","number":7137,"title":"[Untrusted] Remove Unexpected Items leaves things behind","user":{"login":"bugith","id":6240207,"node_id":"MDQ6VXNlcjYyNDAyMDc=","avatar_url":"https://avatars.githubusercontent.com/u/6240207?v=4","gravatar_id":"","url":"https://api.github.com/users/bugith","html_url":"https://github.com/bugith","followers_url":"https://api.github.com/users/bugith/followers","following_url":"https://api.github.com/users/bugith/following{/other_user}","gists_url":"https://api.github.com/users/bugith/gists{/gist_id}","starred_url":"https://api.github.com/users/bugith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bugith/subscriptions","organizations_url":"https://api.github.com/users/bugith/orgs","repos_url":"https://api.github.com/users/bugith/repos","events_url":"https://api.github.com/users/bugith/events{/privacy}","received_events_url":"https://api.github.com/users/bugith/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":67767665,"node_id":"MDU6TGFiZWw2Nzc2NzY2NQ==","url":"https://api.github.com/repos/syncthing/syncthing/labels/bug","name":"bug","color":"d93f0b","default":true,"description":"A problem with current functionality, as opposed to missing functionality (enhancement)"},{"id":628314330,"node_id":"MDU6TGFiZWw2MjgzMTQzMzA=","url":"https://api.github.com/repos/syncthing/syncthing/labels/frozen-due-to-age","name":"frozen-due-to-age","color":"eeeeee","default":false,"description":"Issues closed and untouched for a long time, together with being locked for discussion"}],"state":"closed","locked":true,"assignee":{"login":"imsodin","id":15955093,"node_id":"MDQ6VXNlcjE1OTU1MDkz","avatar_url":"https://avatars.githubusercontent.com/u/15955093?v=4","gravatar_id":"","url":"https://api.github.com/users/imsodin","html_url":"https://github.com/imsodin","followers_url":"https://api.github.com/users/imsodin/followers","following_url":"https://api.github.com/users/imsodin/following{/other_user}","gists_url":"https://api.github.com/users/imsodin/gists{/gist_id}","starred_url":"https://api.github.com/users/imsodin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imsodin/subscriptions","organizations_url":"https://api.github.com/users/imsodin/orgs","repos_url":"https://api.github.com/users/imsodin/repos","events_url":"https://api.github.com/users/imsodin/events{/privacy}","received_events_url":"https://api.github.com/users/imsodin/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"imsodin","id":15955093,"node_id":"MDQ6VXNlcjE1OTU1MDkz","avatar_url":"https://avatars.githubusercontent.com/u/15955093?v=4","gravatar_id":"","url":"https://api.github.com/users/imsodin","html_url":"https://github.com/imsodin","followers_url":"https://api.github.com/users/imsodin/followers","following_url":"https://api.github.com/users/imsodin/following{/other_user}","gists_url":"https://api.github.com/users/imsodin/gists{/gist_id}","starred_url":"https://api.github.com/users/imsodin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imsodin/subscriptions","organizations_url":"https://api.github.com/users/imsodin/orgs","repos_url":"https://api.github.com/users/imsodin/repos","events_url":"https://api.github.com/users/imsodin/events{/privacy}","received_events_url":"https://api.github.com/users/imsodin/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/syncthing/syncthing/milestones/58","html_url":"https://github.com/syncthing/syncthing/milestone/58","labels_url":"https://api.github.com/repos/syncthing/syncthing/milestones/58/labels","id":6122062,"node_id":"MDk6TWlsZXN0b25lNjEyMjA2Mg==","number":58,"title":"v1.12.1","description":"","creator":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":40,"state":"closed","created_at":"2020-11-18T12:53:43Z","updated_at":"2021-01-06T08:05:54Z","due_on":"2021-01-05T08:00:00Z","closed_at":"2021-01-06T08:05:54Z"},"comments":1,"created_at":"2020-11-22T14:12:41Z","updated_at":"2021-11-25T07:02:41Z","closed_at":"2020-11-24T20:49:48Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Does your log mention database corruption?\r\nNo\r\n\r\n### Include required information\r\n\r\nPlease be sure to include at least:\r\n\r\n - 1.12.rc3 each side, Me win10-64 Other Linux ubuntu 16.04\r\n - Latest FF both side\r\n - After testing sync OK from trusted to untrusted, I purged the folder at trusted side and waited Local=Global=0/UptoDate on both side. Then I wanted to test the \"Remove Unexpected Items\" feature at untrusted side. Created a file in the folder, Folder Title turned to \"Unexpected Items\", and red button showed in GUI + a line stating \"Locally Changed Items - 1 elements\". Clicked the red button but after it disappeared the Folder's Title remained stuck to \"Unexpected Items\" and further file additions to trusted side ended in no sync. I performed the test twice. Either cleaning out the unexpected elements in the folder from within the GUI or manually in the FS is effective, meaning GUI deletes files and manually makes the button to disappear after a while, we can notice the following : adding a new unexpected element on untrusted side makes the button to show again (fine), but then if we click the link in the GUI in front of \"Locally changed element\" will show the elements we previously cleaned are still listed... maybe this will give a track.  \r\n\r\n\r\nIn another experience (don't remember which) I got a negative amount of Bytes at Untrusted local count after I purged the trusted side and manually (i.e. not from ST GUI) restored the content of .stversion, readded and purged again the trusted side and removed unexpected. \r\n\r\nLog :\r\n\r\n```\r\n2020-11-22 13:50:41 My ID: 334ZKDC-2222222-2222222-2222222-2222222-2222222-2222222-3K3FFAU\r\n\r\n2020-11-22 13:50:42 Single thread SHA256 performance is 484 MB/s using minio/sha256-simd (416 MB/s using crypto/sha256).\r\n\r\n2020-11-22 13:50:43 Hashing performance is 396.63 MB/s\r\n\r\n2020-11-22 13:50:43 Starting deadlock detector with 20m0s timeout\r\n\r\n2020-11-22 13:50:43 Overall send rate is unlimited, receive rate is unlimited\r\n\r\n2020-11-22 13:50:43 Anonymous usage reporting is always enabled for candidate releases.\r\n\r\n2020-11-22 13:50:43 Using discovery mechanism: global discovery server https://discovery.syncthing.net/v2/?noannounce&id=LYXKCHX-VI3NYZR-ALCJBHF-WMZYSPK-QG6QJA3-MPFYMSO-U56GTUK-NA2MIAW\r\n\r\n2020-11-22 13:50:43 Using discovery mechanism: global discovery server https://discovery-v4.syncthing.net/v2/?nolookup&id=LYXKCHX-VI3NYZR-ALCJBHF-WMZYSPK-QG6QJA3-MPFYMSO-U56GTUK-NA2MIAW\r\n\r\n2020-11-22 13:50:43 Using discovery mechanism: global discovery server https://discovery-v6.syncthing.net/v2/?nolookup&id=LYXKCHX-VI3NYZR-ALCJBHF-WMZYSPK-QG6QJA3-MPFYMSO-U56GTUK-NA2MIAW\r\n\r\n2020-11-22 13:50:43 Using discovery mechanism: IPv4 local broadcast discovery on port 21027\r\n\r\n2020-11-22 13:50:43 ...\r\n\r\n2020-11-22 13:50:43 Using discovery mechanism: IPv6 local multicast discovery on address [ff12::8384]:21027\r\n\r\n2020-11-22 13:50:43 Feature flag \"untrusted\": true\r\n\r\n2020-11-22 13:50:43 Ready to synchronize \"1_test crypt\" (eodcv-7qphu) (receiveencrypted)\r\n\r\n2020-11-22 13:50:43 Ready to synchronize \"Folder1\" (aaaaa-bbbbb) (sendreceive)\r\n\r\n2020-11-22 13:50:43 Completed initial scan of receiveencrypted folder \"1_test crypt\" (eodcv-7qphu)\r\n\r\n2020-11-22 13:50:43 Puller (folder \"1_test crypt\" (eodcv-7qphu), item \"R.syncthing-enc\\\\2G\\\\L6L5ULGHN5VO984KCK0APKQHNG1FK9EC9SBQN6NEHGUNA0P5SLHOPE6SJURV9QQCUQRS2ERO0S1B7B3RBO0N0RU8D0F00TJ90\"): syncing: no connected device has the required version of this file\r\n\r\n2020-11-22 13:50:43 \"1_test crypt\" (eodcv-7qphu): Failed to sync 1 items\r\n\r\n2020-11-22 13:50:43 Folder \"1_test crypt\" (eodcv-7qphu) isn't making sync progress - retrying in 1m0s.\r\n\r\n2020-11-22 13:50:43 GUI and API listening on 127.0.0.1:8384\r\n\r\n2020-11-22 13:50:43 Access the GUI via the following URL: http://127.0.0.1:8384/\r\n\r\n2020-11-22 13:50:43 My name is \"LapHome\"\r\n\r\n2020-11-22 13:50:43 Device GUDAPRV-2222222-2222222-2222222-2222222-2222222-2222222-A267DQQ is \"DeskPro\" at [dynamic]\r\n\r\n2020-11-22 13:50:43 Device LF5AG4N-3333333-3333333-3333333-3333333-3333333-3333333-AIO6WQ2 is \"DeskHome\" at [dynamic]\r\n\r\n2020-11-22 13:50:43 Device 772V4XB-1111111-1111111-1111111-1111111-1111111-1111111-AOOEVA2 is \"LapHome\" at [dynamic]\r\n\r\n2020-11-22 13:50:43 Puller (folder \"1_test crypt\" (eodcv-7qphu), item \"R.syncthing-enc\\\\2G\\\\L6L5ULGHN5VO984KCK0APKQHNG1FK9EC9SBQN6NEHGUNA0P5SLHOPE6SJURV9QQCUQRS2ERO0S1B7B3RBO0N0RU8D0F00TJ90\"): syncing: no connected device has the required version of this file\r\n\r\n2020-11-22 13:50:43 \"1_test crypt\" (eodcv-7qphu): Failed to sync 1 items\r\n\r\n2020-11-22 13:50:43 Folder \"1_test crypt\" (eodcv-7qphu) isn't making sync progress - retrying in 1m0s.\r\n\r\n2020-11-22 13:50:43 TCP listener ([::]:23000) starting\r\n\r\n2020-11-22 13:50:44 Completed initial scan of sendreceive folder \"Folder1\" (aaaaa-bbbbb)\r\n\r\n2020-11-22 13:50:48 Established secure connection to 772V4XB-1111111-1111111-1111111-1111111-1111111-1111111-AOOEVA2 at 192.168.22.30:23000-192.168.22.29:22290/tcp-server/TLS1.3-TLS_AES_128_GCM_SHA256\r\n\r\n2020-11-22 13:50:48 Device 772V4XB-1111111-1111111-1111111-1111111-1111111-1111111-AOOEVA2 client is \"syncthing v1.12.0-rc.3\" named \"LapHome\" at 192.168.22.30:23000-192.168.22.29:22290/tcp-server/TLS1.3-TLS_AES_128_GCM_SHA256\r\n\r\n2020-11-22 13:50:48 Device 772V4XB-1111111-1111111-1111111-1111111-1111111-1111111-AOOEVA2 folder \"1_test crypt\" (eodcv-7qphu) is delta index compatible, but seems out of sync with reality\r\n\r\n2020-11-22 13:50:53 Detected 0 NAT services\r\n\r\n2020-11-22 13:50:54 Connection to 772V4XB-1111111-1111111-1111111-1111111-1111111-1111111-AOOEVA2 at 192.168.22.30:23000-192.168.22.29:22290/tcp-server/TLS1.3-TLS_AES_128_GCM_SHA256 closed: reading length: read tcp 192.168.22.30:23000->192.168.22.29:22290: wsarecv: An existing connection may have been closed by remote host.\r\n\r\n2020-11-22 13:50:54 Puller (folder \"1_test crypt\" (eodcv-7qphu), item \"R.syncthing-enc\\\\2G\\\\L6L5ULGHN5VO984KCK0APKQHNG1FK9EC9SBQN6NEHGUNA0P5SLHOPE6SJURV9QQCUQRS2ERO0S1B7B3RBO0N0RU8D0F00TJ90\"): syncing: no connected device has the required version of this file\r\n\r\n2020-11-22 13:50:54 \"1_test crypt\" (eodcv-7qphu): Failed to sync 1 items\r\n\r\n2020-11-22 13:50:54 Folder \"1_test crypt\" (eodcv-7qphu) isn't making sync progress - retrying in 1m6s.\r\n\r\n2020-11-22 13:50:58 Failed to exchange Hello messages with 772V4XB-1111111-1111111-1111111-1111111-1111111-1111111-AOOEVA2 at [2a01:e0a:444:4680:9910:5c17:bc9d:ad33]:23000-[2a01:e0a:444:4680:b6b6:76ff:fe2a:e482]:22290/tcp-server/TLS1.3-TLS_AES_128_GCM_SHA256: EOF\r\n\r\n2020-11-22 13:51:16 Established secure connection to GUDAPRV-2222222-2222222-2222222-2222222-2222222-2222222-A267DQQ at 192.168.22.30:53032-195.219.163.89:443/relay-client/TLS1.3-TLS_AES_128_GCM_SHA256\r\n\r\n2020-11-22 13:51:16 Device GUDAPRV-2222222-2222222-2222222-2222222-2222222-2222222-A267DQQ client is \"syncthing v1.11.1\" named \"Server-Teacher\" at 192.168.22.30:53032-195.219.163.89:443/relay-client/TLS1.3-TLS_AES_128_GCM_SHA256\r\n\r\n2020-11-22 13:51:16 Established secure connection to LF5AG4N-3333333-3333333-3333333-3333333-3333333-3333333-AIO6WQ2 at [fe80::e01e:bd3e:299:14fd%Ethernet]:23000-[fe80::468a:5bff:fe2c:d3e6%Ethernet]:22190/tcp-client/TLS1.3-TLS_AES_128_GCM_SHA256\r\n\r\n2020-11-22 13:51:16 Device LF5AG4N-3333333-3333333-3333333-3333333-3333333-3333333-AIO6WQ2 client is \"syncthing v1.11.1\" named \"DeskHome\" at [fe80::e01e:bd3e:299:14fd%Ethernet]:23000-[fe80::468a:5bff:fe2c:d3e6%Ethernet]:22190/tcp-client/TLS1.3-TLS_AES_128_GCM_SHA256\r\n\r\n2020-11-22 13:51:16 Established secure connection to 772V4XB-1111111-1111111-1111111-1111111-1111111-1111111-AOOEVA2 at [fe80::e01e:bd3e:299:14fd%Ethernet]:23000-[fe80::b6b6:76ff:fe2a:e482%Ethernet]:22290/tcp-client/TLS1.3-TLS_AES_128_GCM_SHA256\r\n\r\n2020-11-22 13:51:16 Device 772V4XB-1111111-1111111-1111111-1111111-1111111-1111111-AOOEVA2 client is \"syncthing v1.12.0-rc.3\" named \"LapHome\" at [fe80::e01e:bd3e:299:14fd%Ethernet]:23000-[fe80::b6b6:76ff:fe2a:e482%Ethernet]:22290/tcp-client/TLS1.3-TLS_AES_128_GCM_SHA256\r\n\r\n2020-11-22 13:51:16 Device 772V4XB-1111111-1111111-1111111-1111111-1111111-1111111-AOOEVA2 folder \"1_test crypt\" (eodcv-7qphu) is delta index compatible, but seems out of sync with reality\r\n\r\n2020-11-22 13:52:37 Connection to 772V4XB-1111111-1111111-1111111-1111111-1111111-1111111-AOOEVA2 at [fe80::e01e:bd3e:299:14fd%Ethernet]:23000-[fe80::b6b6:76ff:fe2a:e482%Ethernet]:22290/tcp-client/TLS1.3-TLS_AES_128_GCM_SHA256 closed: reading length: read tcp [fe80::e01e:bd3e:299:14fd%Ethernet]:23000->[fe80::b6b6:76ff:fe2a:e482%Ethernet]:22290: wsarecv: An existing connection may have been closed by remote host.\r\n\r\n2020-11-22 13:52:37 Puller (folder \"1_test crypt\" (eodcv-7qphu), item \"R.syncthing-enc\\\\2G\\\\L6L5ULGHN5VO984KCK0APKQHNG1FK9EC9SBQN6NEHGUNA0P5SLHOPE6SJURV9QQCUQRS2ERO0S1B7B3RBO0N0RU8D0F00TJ90\"): syncing: no connected device has the required version of this file\r\n\r\n2020-11-22 13:52:37 \"1_test crypt\" (eodcv-7qphu): Failed to sync 1 items\r\n\r\n2020-11-22 13:52:37 Folder \"1_test crypt\" (eodcv-7qphu) isn't making sync progress - retrying in 2m21s.\r\n\r\n2020-11-22 13:52:45 Established secure connection to 772V4XB-1111111-1111111-1111111-1111111-1111111-1111111-AOOEVA2 at [2a01:e0a:444:4680:9910:5c17:bc9d:ad33]:23000-[2a01:e0a:444:4680:b6b6:76ff:fe2a:e482]:22290/tcp-server/TLS1.3-TLS_AES_128_GCM_SHA256\r\n\r\n2020-11-22 13:52:45 Device 772V4XB-1111111-1111111-1111111-1111111-1111111-1111111-AOOEVA2 client is \"syncthing v1.12.0-rc.3\" named \"LapHome\" at [2a01:e0a:444:4680:9910:5c17:bc9d:ad33]:23000-[2a01:e0a:444:4680:b6b6:76ff:fe2a:e482]:22290/tcp-server/TLS1.3-TLS_AES_128_GCM_SHA256\r\n\r\n2020-11-22 13:52:45 Device 772V4XB-1111111-1111111-1111111-1111111-1111111-1111111-AOOEVA2 folder \"1_test crypt\" (eodcv-7qphu) is delta index compatible, but seems out of sync with reality\r\n```","closed_by":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/syncthing/syncthing/issues/7137/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/syncthing/syncthing/issues/7137/timeline","performed_via_github_app":null,"state_reason":"completed"}