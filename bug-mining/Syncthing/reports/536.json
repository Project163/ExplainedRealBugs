{"url":"https://api.github.com/repos/syncthing/syncthing/issues/3502","repository_url":"https://api.github.com/repos/syncthing/syncthing","labels_url":"https://api.github.com/repos/syncthing/syncthing/issues/3502/labels{/name}","comments_url":"https://api.github.com/repos/syncthing/syncthing/issues/3502/comments","events_url":"https://api.github.com/repos/syncthing/syncthing/issues/3502/events","html_url":"https://github.com/syncthing/syncthing/issues/3502","id":171041764,"node_id":"MDU6SXNzdWUxNzEwNDE3NjQ=","number":3502,"title":"Older files lost during update from v0.14.3 to 0.14.4","user":{"login":"AloisMahdal","id":217935,"node_id":"MDQ6VXNlcjIxNzkzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/217935?v=4","gravatar_id":"","url":"https://api.github.com/users/AloisMahdal","html_url":"https://github.com/AloisMahdal","followers_url":"https://api.github.com/users/AloisMahdal/followers","following_url":"https://api.github.com/users/AloisMahdal/following{/other_user}","gists_url":"https://api.github.com/users/AloisMahdal/gists{/gist_id}","starred_url":"https://api.github.com/users/AloisMahdal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AloisMahdal/subscriptions","organizations_url":"https://api.github.com/users/AloisMahdal/orgs","repos_url":"https://api.github.com/users/AloisMahdal/repos","events_url":"https://api.github.com/users/AloisMahdal/events{/privacy}","received_events_url":"https://api.github.com/users/AloisMahdal/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":628314330,"node_id":"MDU6TGFiZWw2MjgzMTQzMzA=","url":"https://api.github.com/repos/syncthing/syncthing/labels/frozen-due-to-age","name":"frozen-due-to-age","color":"eeeeee","default":false,"description":"Issues closed and untouched for a long time, together with being locked for discussion"}],"state":"closed","locked":true,"assignee":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":19,"created_at":"2016-08-14T04:28:14Z","updated_at":"2017-09-02T16:13:08Z","closed_at":"2016-09-02T13:23:28Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Setup\n\nHere's what I have:\n-  a Fedora 23 where syncthing and syncthing-inotify are started as user service.  Update is enabled so syncthing updates from web.  this has two folders: one called 'st' and other 'file-vornet.cz-rpm'\n-  a Debian Jessie VPS, syncing 'st' fully (also syncing it to two other machines that are offline now and also holding other folders for other machines)\n-  a Debian Jessie VM, hosted on the Fedora machine: syncing 'st' partially (just few megs)\n\nAll folders are \"peers\" (no \"master\"), and all \n### Incident\n1. opened QTSyncthingTray and noticed ST wants to update\n2. clicked the red update button (ignoring common advice about red buttons)\n3. ssh'd to the other two machines and started updating there via APT\n\nNow at some point soon, I noticed in QTSyncthingTray that the 'st' folder is too small (~7M instead of ~1.7G) \"Out Of Sync\", \"Failed items\" loading forever, and items that are \"Out of sync\" are few seemingly random folders (some of them not accessed for long time). Also, Devices showed \"syncing\" status with negative percentage. Also \"Last file received\" shows \"Deleted <some file>\" but that's not the case.\n\nSee screenshot: http://file.vornet.cz/tmp/st-badstate.png\n\nI jumped to the VPS, ran `du -s` (size) repeatedly and I could observe how the folder is shrinking.  I would not be able to see anything on the local VM as that one uses only tiny slice of the 'st' folder.\n\nLuckily, I had relatively fresh backup (actually this machine is on dual boot with debian and there's separate instance of this 'st' folder so I used that.\n### aftermath\n\nNow what I have found about the issue:\n1. No folders seem to have gone: structure is preserved, but files are gone.\n2. Files/folders touched recently were OK.\n3. There's one folder which holds my payrolls (each in own sub-folder) and a script for decrypting them (I get encrypted zip via email).  Yesterday I added a payroll here: the payroll was present, old payrolls gone, and the script gone.  This shows that there's age-based system in which files got lost.\n4. There's another interesting folder \"st/_sin\" (\"syncthing in\", not \"sin\" :)): I recently moved into it another folder \"ean-pdf\" (from elsewhere in 'st' folder).  The \"ean-pdf\" is there with all its files, but other files in the \"_sin\" folder are gone. This seems strange: the \"_sin\" was techincally \"changed recently\", but got damaged; but the ean-pdf -- a \"new arrival\" or \"subject of the change\" did not.\n5. In the Fedora's log, soon after start of new syncthing, there's lot of lines like:\n   \n   ```\n   Aug 14 03:35:53 fullmoon.brq.redhat.com syncthing[22127]: [ZINNF] INFO: Puller (folder \"xvndu-bvmzg\", dir \"archive/personal\"): delete: remove /home/amahdal/st/archive/personal: directory not empty\n   ```\n   \n   where the dir is one that contains empty subdirectories.\n6.  'the file-vornet.cz-rpm' dir does not seem affected, maybe because it's recently changed and just holds couple of RPMS and a script...\n### Version Information\n\nSyncthing Version: v0.14.4\nOS Version: Fedora 23 (other devices: Debian Jessie)\n\nI'm assuming the culprit happened on Fedora: from the \"Deleted\" info it appears as if the VPS deleted it, but the local VM never had it and as I said I could observe the file loss on the VPS; it looks as if there was already some misunderstanding going.\n","closed_by":{"login":"st-review","id":16196517,"node_id":"MDQ6VXNlcjE2MTk2NTE3","avatar_url":"https://avatars.githubusercontent.com/u/16196517?v=4","gravatar_id":"","url":"https://api.github.com/users/st-review","html_url":"https://github.com/st-review","followers_url":"https://api.github.com/users/st-review/followers","following_url":"https://api.github.com/users/st-review/following{/other_user}","gists_url":"https://api.github.com/users/st-review/gists{/gist_id}","starred_url":"https://api.github.com/users/st-review/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/st-review/subscriptions","organizations_url":"https://api.github.com/users/st-review/orgs","repos_url":"https://api.github.com/users/st-review/repos","events_url":"https://api.github.com/users/st-review/events{/privacy}","received_events_url":"https://api.github.com/users/st-review/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/syncthing/syncthing/issues/3502/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/syncthing/syncthing/issues/3502/timeline","performed_via_github_app":null,"state_reason":"completed"}