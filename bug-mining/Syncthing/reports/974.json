{"url":"https://api.github.com/repos/syncthing/syncthing/issues/5940","repository_url":"https://api.github.com/repos/syncthing/syncthing","labels_url":"https://api.github.com/repos/syncthing/syncthing/issues/5940/labels{/name}","comments_url":"https://api.github.com/repos/syncthing/syncthing/issues/5940/comments","events_url":"https://api.github.com/repos/syncthing/syncthing/issues/5940/events","html_url":"https://github.com/syncthing/syncthing/issues/5940","id":479359810,"node_id":"MDU6SXNzdWU0NzkzNTk4MTA=","number":5940,"title":"TLS: Support x25519, reconsider elliptic curve priority in handshake","user":{"login":"GermanCoding","id":4279661,"node_id":"MDQ6VXNlcjQyNzk2NjE=","avatar_url":"https://avatars.githubusercontent.com/u/4279661?v=4","gravatar_id":"","url":"https://api.github.com/users/GermanCoding","html_url":"https://github.com/GermanCoding","followers_url":"https://api.github.com/users/GermanCoding/followers","following_url":"https://api.github.com/users/GermanCoding/following{/other_user}","gists_url":"https://api.github.com/users/GermanCoding/gists{/gist_id}","starred_url":"https://api.github.com/users/GermanCoding/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GermanCoding/subscriptions","organizations_url":"https://api.github.com/users/GermanCoding/orgs","repos_url":"https://api.github.com/users/GermanCoding/repos","events_url":"https://api.github.com/users/GermanCoding/events{/privacy}","received_events_url":"https://api.github.com/users/GermanCoding/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":67767667,"node_id":"MDU6TGFiZWw2Nzc2NzY2Nw==","url":"https://api.github.com/repos/syncthing/syncthing/labels/enhancement","name":"enhancement","color":"0e8a16","default":true,"description":"New features or improvements of some kind, as opposed to a problem (bug)"},{"id":628314330,"node_id":"MDU6TGFiZWw2MjgzMTQzMzA=","url":"https://api.github.com/repos/syncthing/syncthing/labels/frozen-due-to-age","name":"frozen-due-to-age","color":"eeeeee","default":false,"description":"Issues closed and untouched for a long time, together with being locked for discussion"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/syncthing/syncthing/milestones/38","html_url":"https://github.com/syncthing/syncthing/milestone/38","labels_url":"https://api.github.com/repos/syncthing/syncthing/milestones/38/labels","id":4534457,"node_id":"MDk6TWlsZXN0b25lNDUzNDQ1Nw==","number":38,"title":"v1.2.2","description":"","creator":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":41,"state":"closed","created_at":"2019-07-30T19:01:21Z","updated_at":"2019-09-03T07:10:18Z","due_on":"2019-09-03T07:00:00Z","closed_at":"2019-09-03T07:10:18Z"},"comments":7,"created_at":"2019-08-11T11:29:50Z","updated_at":"2020-08-11T07:02:34Z","closed_at":"2019-08-11T17:02:02Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"This issue is related to a post I created in the forums some time ago: https://forum.syncthing.net/t/android-and-tls1-2/12931/38\r\n\r\nForeword note: This feature request only talks about curves supported in the ECDHE handshake. This is **not** related to the elliptic curve used in the ECDSA certificate.\r\n\r\n### Background and reasoning\r\n\r\nWith TLS 1.3 right around the corner - it will become on by default in Go 1.13 - it's time to reconsider some elliptic curves in the handshake.\r\n\r\nSyncthing currently configures Go to support 3 curves, preferring them in the following order:\r\n\r\n`CurvePreferences: []tls.CurveID{tls.CurveP521, tls.CurveP384, tls.CurveP256}` ([here](https://github.com/syncthing/syncthing/blob/f24676ba5ab294d3bd250479718564eb404b93b6/lib/tlsutil/tlsutil.go#L92))\r\n\r\nStarting with TLS 1.3, clients connecting to syncthing - browsers, syncthing clients - will need to _guess_ the curves supported by the server. _(This is because the ECDHE handshake is done immediatly in the ClientHello)_. Right now, **many** [modern] applications are preferring `x25519`. I've already given examples in the forum post and I can give additonal info's if requested.\r\n\r\nFor example, in my tests Firefox guessed curves `x25519` (also known as `Curve25519`) and `P-256` as backup in the TLS 1.3 `key_share`. Chrome **only** guessed `x25519` in my test setup. If the server doesn't support at least one of the guessed groups/curves, the Server will send a `HelloRetryRequest` and the client will need to try again, this time choosing a server supported curve.\r\n\r\nIf Syncthing does not support `x25519`, this will likely cause `HelloRetryRequest`'s, which lengthen the TLS handshake and are totally unnecessary/avoidable by supporting x25519.\r\n\r\n_Supplement: I just verified that enabling TLS 1.3 in Syncthing (via GODEBUG) and then opening the web gui with Chrome definetly caused repeated  `HelloRetryRequest`, because Chrome is convinced to use x25519._\r\n\r\nFrom a security point of view, `x25519` is supposedly the \"best\" elliptic curve (note the quotation marks), because it was openly standardized (NIST curves are based on partly unknown values) and because it's implementation is said to be less affected by timing issues or other implementation errors. \r\n\r\nAdditionally, it's supposedly faster compared to the NIST curves, but that is probably assuming no hardware acceleration is present.\r\n\r\n### Go support\r\n\r\nMajor question is obviously, does Go support `x25519`? Browsing the source code of Go, it seems that support for this curve in TLS was added in Go 1.8 (see [here](https://github.com/golang/go/commit/8a11cb318f5c4c15b67ffe9ff9b2fa772bf1dd85)). So if Syncthing is fine supporting only Go 1.8 and newer, adding in `x25519` should cause _no (new) issues or compatibility problems_. Clients that do not know this curve will simply fall back to one of the three NIST curves.\r\n\r\n### Curve priority\r\n\r\nThe last point of my feature request concerns the priority of the elliptic curves, because these affect what is used in most enviroments.\r\n\r\nThis is the current default curve preference, found in the latest Go source code:\r\n\r\n`var defaultCurvePreferences = []CurveID{X25519, CurveP256, CurveP384, CurveP521}`\r\n\r\nSyncthing currently misses x25519 and has the other curves exactly the other way around. There's also this comment in the syncthing source code:\r\n\r\n> // We want the longer curves at the front, because that's more\r\n\t\t// secure (so the web tells me, don't ask me to explain the\r\n\t\t// details).\r\n\r\nI, personally, disagree with this. I support curve priority order of the Go team - x25519 and P-256 are both very secure, together widely supported curves. The other two are (mostly) useless junk that hardly adds in any security benefit. The only real difference is the bit-level-security (number of operations required for a brute-force). Assuming you can break P-256, it's not because of the 128 bit security level, but because of some other weakness that will likely affect P-384 and P-521 too (because they were likely generated using the same unknown constants).\r\n\r\nHaving x25519 the curve at the front (= the preferred) would be my favored choice, because of the reasons above. And if a 128-bit-security curve is preferred, there's no real reason to place a 256-bit-curve (P-521) right behind it - bit-level-security is not the important factor here and if it were, an attacker could just break x25519. Therefore I totally favor the curve priority order that the Go team has choosen as default.\r\n\r\nI understand that this is only my personal, half-informed opinion, but at least reconsider the current curve priority.\r\n\r\n### Summary (TL;DR)\r\n\r\n1. Add support for `Curve25519/x25519`, preferably putting it at the front.\r\n2. Reorder the priority of the other three NIST curves.\r\n\r\nI can _probably_ do a Pull Request with the needed changes in the next few days, altough I've zero experience in Go (changes should be minimal).\r\n\r\n### Version Information\r\n\r\nTLS tests performed with Syncthing Version: v1.2.1 (both with TLS 1.2 and TLS 1.3)\r\nTLS tests performed with OS Version: Windows 10 v1903\r\nTLS tests performed with Browser Version: Firefox 68.0.1, Chrome 76.0.3809.100\r\n\r\n","closed_by":{"login":"imsodin","id":15955093,"node_id":"MDQ6VXNlcjE1OTU1MDkz","avatar_url":"https://avatars.githubusercontent.com/u/15955093?v=4","gravatar_id":"","url":"https://api.github.com/users/imsodin","html_url":"https://github.com/imsodin","followers_url":"https://api.github.com/users/imsodin/followers","following_url":"https://api.github.com/users/imsodin/following{/other_user}","gists_url":"https://api.github.com/users/imsodin/gists{/gist_id}","starred_url":"https://api.github.com/users/imsodin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imsodin/subscriptions","organizations_url":"https://api.github.com/users/imsodin/orgs","repos_url":"https://api.github.com/users/imsodin/repos","events_url":"https://api.github.com/users/imsodin/events{/privacy}","received_events_url":"https://api.github.com/users/imsodin/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/syncthing/syncthing/issues/5940/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/syncthing/syncthing/issues/5940/timeline","performed_via_github_app":null,"state_reason":"completed"}