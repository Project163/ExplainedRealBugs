{"url":"https://api.github.com/repos/syncthing/syncthing/issues/9719","repository_url":"https://api.github.com/repos/syncthing/syncthing","labels_url":"https://api.github.com/repos/syncthing/syncthing/issues/9719/labels{/name}","comments_url":"https://api.github.com/repos/syncthing/syncthing/issues/9719/comments","events_url":"https://api.github.com/repos/syncthing/syncthing/issues/9719/events","html_url":"https://github.com/syncthing/syncthing/issues/9719","id":2538339515,"node_id":"I_kwDOAOCAEs6XS_y7","number":9719,"title":"Unable to establish/maintain multiple connections due to connection priority error","user":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":67767665,"node_id":"MDU6TGFiZWw2Nzc2NzY2NQ==","url":"https://api.github.com/repos/syncthing/syncthing/labels/bug","name":"bug","color":"d93f0b","default":true,"description":"A problem with current functionality, as opposed to missing functionality (enhancement)"},{"id":2043110077,"node_id":"MDU6TGFiZWwyMDQzMTEwMDc3","url":"https://api.github.com/repos/syncthing/syncthing/labels/needs-triage","name":"needs-triage","color":"ce23af","default":false,"description":"New issues needed to be validated"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/syncthing/syncthing/milestones/112","html_url":"https://github.com/syncthing/syncthing/milestone/112","labels_url":"https://api.github.com/repos/syncthing/syncthing/milestones/112/labels","id":11554117,"node_id":"MI_kwDOAOCAEs4AsE1F","number":112,"title":"v1.28.0","description":"","creator":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":45,"state":"closed","created_at":"2024-09-08T19:39:16Z","updated_at":"2024-10-16T07:59:34Z","due_on":"2024-10-15T07:00:00Z","closed_at":"2024-10-16T07:59:34Z"},"comments":15,"created_at":"2024-09-20T09:32:03Z","updated_at":"2024-09-23T14:33:02Z","closed_at":"2024-09-21T07:27:24Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### What happened?\n\nConnections are getting unexpectedly closed (\"replacing connection\" on one side, \"connection reset by peer\" on the other) for no discernible reason, making it so that more than one connection never stays open despite both sides being configured for eight connections. Problem seems to be incorrect connection priorities. Linux side drops the link local IPv6 connection:\r\n\r\n```\r\n[PSEUD] 2024/09/20 09:25:37.501964 service.go:1453: DEBUG: Closing connection [fd7a:115c:a1e0::5501:4880]:22000-[fd7a:115c:a1e0::7301:283d]:22000/tcp-server/TLS1.3-TLS_AES_128_GCM_SHA256/WAN-P30-5VMT6ACVKOPSMK1QVES23Q3HUO to HX2ELNU with priority 30 (cutoff 20)\r\n```\r\n\r\nPriority 30 in my setup is \"TCP WAN\", while this is clearly a LAN connection.\r\n\r\nMac side keeps dialing those connections, correctly classifying them as TCP-LAN (priority 10):\r\n\r\n```\r\n2024-09-20 11:23:32 dialing PSEUDOP-YLA5DBR-XO2HBNT-2FOG4AC-SWOW5EZ-H3QQY76-GISB7PG-E2SWOA2 tcp://[fd7a:115c:a1e0::5501:4880]:22000 success: [fd7a:115c:a1e0::7301:283d]:22000-[fd7a:115c:a1e0::5501:4880]:22000/tcp-client/TLS1.3-TLS_AES_128_GCM_SHA256/LAN-P10-\r\n```\n\n### Syncthing version\n\nv1.27.13-rc.1\n\n### Platform & operating system\n\nlinux/mac\n\n### Browser version\n\n_No response_\n\n### Relevant log output\n\n_No response_","closed_by":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/syncthing/syncthing/issues/9719/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/syncthing/syncthing/issues/9719/timeline","performed_via_github_app":null,"state_reason":"completed"}