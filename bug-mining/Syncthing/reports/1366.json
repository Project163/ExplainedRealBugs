{"url":"https://api.github.com/repos/syncthing/syncthing/issues/8503","repository_url":"https://api.github.com/repos/syncthing/syncthing","labels_url":"https://api.github.com/repos/syncthing/syncthing/issues/8503/labels{/name}","comments_url":"https://api.github.com/repos/syncthing/syncthing/issues/8503/comments","events_url":"https://api.github.com/repos/syncthing/syncthing/issues/8503/events","html_url":"https://github.com/syncthing/syncthing/issues/8503","id":1340116114,"node_id":"I_kwDOAOCAEs5P4IyS","number":8503,"title":"\"syncthing cli config devices add\" reflect error when using --addresses flag","user":{"login":"fatflyingpigs","id":2653682,"node_id":"MDQ6VXNlcjI2NTM2ODI=","avatar_url":"https://avatars.githubusercontent.com/u/2653682?v=4","gravatar_id":"","url":"https://api.github.com/users/fatflyingpigs","html_url":"https://github.com/fatflyingpigs","followers_url":"https://api.github.com/users/fatflyingpigs/followers","following_url":"https://api.github.com/users/fatflyingpigs/following{/other_user}","gists_url":"https://api.github.com/users/fatflyingpigs/gists{/gist_id}","starred_url":"https://api.github.com/users/fatflyingpigs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fatflyingpigs/subscriptions","organizations_url":"https://api.github.com/users/fatflyingpigs/orgs","repos_url":"https://api.github.com/users/fatflyingpigs/repos","events_url":"https://api.github.com/users/fatflyingpigs/events{/privacy}","received_events_url":"https://api.github.com/users/fatflyingpigs/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":67767665,"node_id":"MDU6TGFiZWw2Nzc2NzY2NQ==","url":"https://api.github.com/repos/syncthing/syncthing/labels/bug","name":"bug","color":"d93f0b","default":true,"description":"A problem with current functionality, as opposed to missing functionality (enhancement)"},{"id":628314330,"node_id":"MDU6TGFiZWw2MjgzMTQzMzA=","url":"https://api.github.com/repos/syncthing/syncthing/labels/frozen-due-to-age","name":"frozen-due-to-age","color":"eeeeee","default":false,"description":"Issues closed and untouched for a long time, together with being locked for discussion"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/syncthing/syncthing/milestones/93","html_url":"https://github.com/syncthing/syncthing/milestone/93","labels_url":"https://api.github.com/repos/syncthing/syncthing/milestones/93/labels","id":9249433,"node_id":"MI_kwDOAOCAEs4AjSKZ","number":93,"title":"v1.23.5","description":"","creator":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":17,"state":"closed","created_at":"2023-04-05T13:34:11Z","updated_at":"2023-06-06T07:47:53Z","due_on":"2023-06-06T07:00:00Z","closed_at":"2023-06-06T07:47:53Z"},"comments":6,"created_at":"2022-08-16T10:06:05Z","updated_at":"2024-04-13T18:44:17Z","closed_at":"2023-04-14T16:46:54Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Does your log mention database corruption?\r\n\r\nNay\r\n\r\n### Include required information\r\n\r\nI'm attempting to use the CLI to add a device. This device can be added via the GUI, and the address(es) also work within the GUI.\r\n\r\n```syncthing cli config devices add --device-id GYRZZQB-IRNPV4Z-T7TC52W-EQYJ3TT-FDQW6MW-DFLMU42-SSSU6EM-FBK2VAY --name MyDevice --addresses tcp://example.com:22000```\r\n\r\nRemoving the `--addresses tcp://example.com:22000` will cause the cli call to work correctly. \r\n\r\nOther forms that also error:\r\n`--addresses 'tcp://example.com:22000'`\r\n`--addresses \"tcp://example.com:22000\"`\r\n`--addresses tcp://example.com`\r\n`--addresses tcp://192.168.1.6:22000`\r\n`--addresses \"tcp://192.168.1.6:22000\"`\r\n`--addresses tcp://192.168.1.6`\r\n\r\nPlease be sure to include at least:\r\n - Raspberry Pi 4B, raspbian lite, syncthing v1.20.4, Linux (64-bit ARM)\r\n - ssh to the pi via Win 10 powershell (latest)\r\n\r\nThe console output:\r\n\r\n```log\r\npi@raspberrypi:~ $ syncthing cli config devices add --device-id GYRZZQB-IRNPV4Z-T7TC52W-EQYJ3TT-FDQW6MW-DFLMU42-SSSU6EM-FBK2VAY --name MyDevice --addresses tcp://example.com:22000\r\npanic: reflect: call of reflect.Value.Elem on slice Value\r\n\r\ngoroutine 1 [running]:\r\nreflect.Value.Elem({0x8d3f80?, 0x400017e830?, 0x40002dbdb8?})\r\n        reflect/value.go:1213 +0x1a8\r\ngithub.com/AudriusButkevicius/recli.(*constructor).makeSliceItemBuilders.func1(0x40002a0c60)\r\n        github.com/AudriusButkevicius/recli@v0.0.6/recli.go:391 +0x270\r\ngithub.com/AudriusButkevicius/recli.expectArgs.func1(0x400027bd20?)\r\n        github.com/AudriusButkevicius/recli@v0.0.6/utils.go:154 +0xe4\r\ngithub.com/urfave/cli.HandleAction({0x91ae80?, 0x40002d47f8?}, 0x3?)\r\n        github.com/urfave/cli@v1.22.5/app.go:522 +0xa0\r\ngithub.com/urfave/cli.Command.Run({{0xa3cbb3, 0x3}, {0x0, 0x0}, {0x0, 0x0, 0x0}, {0xa5ca58, 0x1c}, {0x0, ...}, ...}, ...)\r\n        github.com/urfave/cli@v1.22.5/command.go:173 +0x534\r\ngithub.com/urfave/cli.(*App).RunAsSubcommand(0x40001a2c40, 0x40002a09a0)\r\n        github.com/urfave/cli@v1.22.5/app.go:405 +0x6fc\r\ngithub.com/urfave/cli.Command.startApp({{0x40002daff0, 0x7}, {0x0, 0x0}, {0x0, 0x0, 0x0}, {0x0, 0x0}, {0x0, ...}, ...}, ...)\r\n        github.com/urfave/cli@v1.22.5/command.go:372 +0x668\r\ngithub.com/urfave/cli.Command.Run({{0x40002daff0, 0x7}, {0x0, 0x0}, {0x0, 0x0, 0x0}, {0x0, 0x0}, {0x0, ...}, ...}, ...)\r\n        github.com/urfave/cli@v1.22.5/command.go:102 +0x694\r\ngithub.com/urfave/cli.(*App).RunAsSubcommand(0x40001a2a80, 0x40002a0840)\r\n        github.com/urfave/cli@v1.22.5/app.go:405 +0x6fc\r\ngithub.com/urfave/cli.Command.startApp({{0xa3fed8, 0x6}, {0x0, 0x0}, {0x0, 0x0, 0x0}, {0xa6b660, 0x28}, {0x0, ...}, ...}, ...)\r\n        github.com/urfave/cli@v1.22.5/command.go:372 +0x668\r\ngithub.com/urfave/cli.Command.Run({{0xa3fed8, 0x6}, {0x0, 0x0}, {0x0, 0x0, 0x0}, {0xa6b660, 0x28}, {0x0, ...}, ...}, ...)\r\n        github.com/urfave/cli@v1.22.5/command.go:102 +0x694\r\ngithub.com/urfave/cli.(*App).RunAsSubcommand(0x40001a28c0, 0x40002a06e0)\r\n        github.com/urfave/cli@v1.22.5/app.go:405 +0x6fc\r\ngithub.com/urfave/cli.Command.startApp({{0xa3cbe9, 0x3}, {0x0, 0x0}, {0x0, 0x0, 0x0}, {0xa61ccf, 0x20}, {0x0, ...}, ...}, ...)\r\n        github.com/urfave/cli@v1.22.5/command.go:372 +0x668\r\ngithub.com/urfave/cli.Command.Run({{0xa3cbe9, 0x3}, {0x0, 0x0}, {0x0, 0x0, 0x0}, {0xa61ccf, 0x20}, {0x0, ...}, ...}, ...)\r\n        github.com/urfave/cli@v1.22.5/command.go:102 +0x694\r\ngithub.com/urfave/cli.(*App).Run(0x40001a2700, {0x4000128000, 0xb, 0xb})\r\n        github.com/urfave/cli@v1.22.5/app.go:277 +0x630\r\ngithub.com/syncthing/syncthing/cmd/syncthing/cli.Run()\r\n        github.com/syncthing/syncthing/cmd/syncthing/cli/main.go:134 +0x7f0\r\nmain.main()\r\n        github.com/syncthing/syncthing/cmd/syncthing/main.go:216 +0x80\r\n\r\ngoroutine 34 [chan receive]:\r\ngithub.com/syncthing/notify.(*nonrecursiveTree).dispatch(0x400011c480, 0x0?)\r\n        github.com/syncthing/notify@v0.0.0-20210616190510-c6b7342338d2/tree_nonrecursive.go:36 +0x40\r\ncreated by github.com/syncthing/notify.newNonrecursiveTree\r\n        github.com/syncthing/notify@v0.0.0-20210616190510-c6b7342338d2/tree_nonrecursive.go:29 +0x158\r\n\r\ngoroutine 35 [chan receive]:\r\ngithub.com/syncthing/notify.(*nonrecursiveTree).internal(0x400011c480, 0x400011c420)\r\n        github.com/syncthing/notify@v0.0.0-20210616190510-c6b7342338d2/tree_nonrecursive.go:81 +0x3c\r\ncreated by github.com/syncthing/notify.newNonrecursiveTree\r\n        github.com/syncthing/notify@v0.0.0-20210616190510-c6b7342338d2/tree_nonrecursive.go:30 +0x1b0\r\n\r\ngoroutine 36 [sleep]:\r\ntime.Sleep(0x1dcd6500)\r\n        runtime/time.go:194 +0x124\r\ngithub.com/syncthing/syncthing/lib/dialer.init.1.func2()\r\n        github.com/syncthing/syncthing/lib/dialer/internal.go:43 +0x28\r\ncreated by github.com/syncthing/syncthing/lib/dialer.init.1\r\n        github.com/syncthing/syncthing/lib/dialer/internal.go:42 +0xf0\r\n\r\ngoroutine 38 [IO wait]:\r\ninternal/poll.runtime_pollWait(0x7f5e7dbfe8, 0x72)\r\n        runtime/netpoll.go:302 +0xa4\r\ninternal/poll.(*pollDesc).wait(0x400017ce80?, 0x4000291000?, 0x0)\r\n        internal/poll/fd_poll_runtime.go:83 +0x2c\r\ninternal/poll.(*pollDesc).waitRead(...)\r\n        internal/poll/fd_poll_runtime.go:88\r\ninternal/poll.(*FD).Read(0x400017ce80, {0x4000291000, 0x1000, 0x1000})\r\n        internal/poll/fd_unix.go:167 +0x1ec\r\nnet.(*netFD).Read(0x400017ce80, {0x4000291000?, 0x40000a1c58?, 0x15590?})\r\n        net/fd_posix.go:55 +0x2c\r\nnet.(*conn).Read(0x400011a268, {0x4000291000?, 0x0?, 0x400011a260?})\r\n        net/net.go:183 +0x38\r\nnet/http.(*persistConn).Read(0x400027ac60, {0x4000291000?, 0x15640?, 0x40000a4000?})\r\n        net/http/transport.go:1929 +0x54\r\nbufio.(*Reader).fill(0x400029ce40)\r\n        bufio/bufio.go:106 +0x100\r\nbufio.(*Reader).Peek(0x400029ce40, 0x1)\r\n        bufio/bufio.go:144 +0x6c\r\nnet/http.(*persistConn).readLoop(0x400027ac60)\r\n        net/http/transport.go:2093 +0x160\r\ncreated by net/http.(*Transport).dialConn\r\n        net/http/transport.go:1750 +0x1214\r\n\r\ngoroutine 39 [select]:\r\nnet/http.(*persistConn).writeLoop(0x400027ac60)\r\n        net/http/transport.go:2392 +0xa4\r\ncreated by net/http.(*Transport).dialConn\r\n        net/http/transport.go:1751 +0x1260\r\n```\r\n\r\n","closed_by":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/syncthing/syncthing/issues/8503/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/syncthing/syncthing/issues/8503/timeline","performed_via_github_app":null,"state_reason":"completed"}