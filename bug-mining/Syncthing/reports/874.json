{"url":"https://api.github.com/repos/syncthing/syncthing/issues/5450","repository_url":"https://api.github.com/repos/syncthing/syncthing","labels_url":"https://api.github.com/repos/syncthing/syncthing/issues/5450/labels{/name}","comments_url":"https://api.github.com/repos/syncthing/syncthing/issues/5450/comments","events_url":"https://api.github.com/repos/syncthing/syncthing/issues/5450/events","html_url":"https://github.com/syncthing/syncthing/issues/5450","id":398666926,"node_id":"MDU6SXNzdWUzOTg2NjY5MjY=","number":5450,"title":"Failed item after quick moving","user":{"login":"matthieu-vergne","id":1774210,"node_id":"MDQ6VXNlcjE3NzQyMTA=","avatar_url":"https://avatars.githubusercontent.com/u/1774210?v=4","gravatar_id":"","url":"https://api.github.com/users/matthieu-vergne","html_url":"https://github.com/matthieu-vergne","followers_url":"https://api.github.com/users/matthieu-vergne/followers","following_url":"https://api.github.com/users/matthieu-vergne/following{/other_user}","gists_url":"https://api.github.com/users/matthieu-vergne/gists{/gist_id}","starred_url":"https://api.github.com/users/matthieu-vergne/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/matthieu-vergne/subscriptions","organizations_url":"https://api.github.com/users/matthieu-vergne/orgs","repos_url":"https://api.github.com/users/matthieu-vergne/repos","events_url":"https://api.github.com/users/matthieu-vergne/events{/privacy}","received_events_url":"https://api.github.com/users/matthieu-vergne/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":67767665,"node_id":"MDU6TGFiZWw2Nzc2NzY2NQ==","url":"https://api.github.com/repos/syncthing/syncthing/labels/bug","name":"bug","color":"d93f0b","default":true,"description":"A problem with current functionality, as opposed to missing functionality (enhancement)"},{"id":628314330,"node_id":"MDU6TGFiZWw2MjgzMTQzMzA=","url":"https://api.github.com/repos/syncthing/syncthing/labels/frozen-due-to-age","name":"frozen-due-to-age","color":"eeeeee","default":false,"description":"Issues closed and untouched for a long time, together with being locked for discussion"}],"state":"closed","locked":true,"assignee":{"login":"imsodin","id":15955093,"node_id":"MDQ6VXNlcjE1OTU1MDkz","avatar_url":"https://avatars.githubusercontent.com/u/15955093?v=4","gravatar_id":"","url":"https://api.github.com/users/imsodin","html_url":"https://github.com/imsodin","followers_url":"https://api.github.com/users/imsodin/followers","following_url":"https://api.github.com/users/imsodin/following{/other_user}","gists_url":"https://api.github.com/users/imsodin/gists{/gist_id}","starred_url":"https://api.github.com/users/imsodin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imsodin/subscriptions","organizations_url":"https://api.github.com/users/imsodin/orgs","repos_url":"https://api.github.com/users/imsodin/repos","events_url":"https://api.github.com/users/imsodin/events{/privacy}","received_events_url":"https://api.github.com/users/imsodin/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"imsodin","id":15955093,"node_id":"MDQ6VXNlcjE1OTU1MDkz","avatar_url":"https://avatars.githubusercontent.com/u/15955093?v=4","gravatar_id":"","url":"https://api.github.com/users/imsodin","html_url":"https://github.com/imsodin","followers_url":"https://api.github.com/users/imsodin/followers","following_url":"https://api.github.com/users/imsodin/following{/other_user}","gists_url":"https://api.github.com/users/imsodin/gists{/gist_id}","starred_url":"https://api.github.com/users/imsodin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imsodin/subscriptions","organizations_url":"https://api.github.com/users/imsodin/orgs","repos_url":"https://api.github.com/users/imsodin/repos","events_url":"https://api.github.com/users/imsodin/events{/privacy}","received_events_url":"https://api.github.com/users/imsodin/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":3,"created_at":"2019-01-13T15:12:13Z","updated_at":"2020-01-15T07:02:47Z","closed_at":"2019-01-14T07:30:53Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"It looks to me as a duplicate of #2211, but since it is blocked for collaborators only I open a new issue.\r\n\r\n# Context\r\n\r\nI have 2 nodes:\r\n- PC on Ubuntu 16.04, with Syncthing taken from the [latest release](https://github.com/syncthing/syncthing/releases/tag/v1.0.0) link of the website. The version used is [syncthing-linux-amd64-v1.0.0.tar.gz](https://github.com/syncthing/syncthing/releases/download/v1.0.0/syncthing-linux-amd64-v1.0.0.tar.gz). Displayed version on the Web interface: v1.0.0, Linux (64 bit).\r\n- Tablet on Android 7.0, with Syncthing taken from the Play store. Displayed version on the Web interface: v0.14.51, android (ARM)\r\n\r\nI have one shared folder, let's call it `share`, for these two nodes. No specific configuration besides a limit of 1GB of free space. Since I am far from reaching it, I assume it is out of topic and we can assume a default configuration of the shared folder.\r\n\r\nAs of the storage:\r\n- Tablet stores on the internal storage.\r\n- PC stores on an external hard drive in NTFS (to be accessible on Windows too)\r\n\r\nBoth nodes were continuously running during the whole operation, so they could sync at any time.\r\n\r\n# What happened\r\n\r\nYesterday on the tablet, I added 3 files (several hundreds of MB each) to `share`, and then quickly moved 2 of them to `share/myFolder`. Today I checked my PC, and it displays that the folder is up to date (which is true when I look at the content) but on the 2 moved items 1 is listed as failed item. The message displayed is:\r\n> peers who had this file went away, or the file has changed while syncing. will retry later\r\n\r\n# What you expected to happen instead\r\n\r\nI would expect Syncthing to be aware of file moving. So rather than considering the `share` and `share/myFolder` files as different, it should consider them as the same, and thus don't expect to have the `share` one when it already has the `share/myFolder` one.\r\n\r\nIn other words, although the error might happen during the state transition, now it should have figured it was a move and the error should have disappeared already.\r\n\r\n# Any steps to reproduce the problem\r\n\r\nI assume these are the steps:\r\n- Create a shared folder between 2 nodes A & B\r\n- Create a subfolder\r\n- Wait for both nodes to be sync\r\n- Add a file F in A\r\n- Wait for B to see there is F\r\n- Move F to subfolder before it is fully sync on B (F should be big enough or upload should be limited to ensure it is not too fast)\r\n- Let syncing until B fully retrieves F in the subfolder\r\n- B should still display the error for the missing F in the root folder\r\n","closed_by":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/syncthing/syncthing/issues/5450/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/syncthing/syncthing/issues/5450/timeline","performed_via_github_app":null,"state_reason":"completed"}