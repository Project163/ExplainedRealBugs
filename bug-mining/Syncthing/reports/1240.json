{"url":"https://api.github.com/repos/syncthing/syncthing/issues/7600","repository_url":"https://api.github.com/repos/syncthing/syncthing","labels_url":"https://api.github.com/repos/syncthing/syncthing/issues/7600/labels{/name}","comments_url":"https://api.github.com/repos/syncthing/syncthing/issues/7600/comments","events_url":"https://api.github.com/repos/syncthing/syncthing/issues/7600/events","html_url":"https://github.com/syncthing/syncthing/issues/7600","id":867061193,"node_id":"MDU6SXNzdWU4NjcwNjExOTM=","number":7600,"title":"Fast connect to new devices following config update","user":{"login":"gsaraf","id":5310467,"node_id":"MDQ6VXNlcjUzMTA0Njc=","avatar_url":"https://avatars.githubusercontent.com/u/5310467?v=4","gravatar_id":"","url":"https://api.github.com/users/gsaraf","html_url":"https://github.com/gsaraf","followers_url":"https://api.github.com/users/gsaraf/followers","following_url":"https://api.github.com/users/gsaraf/following{/other_user}","gists_url":"https://api.github.com/users/gsaraf/gists{/gist_id}","starred_url":"https://api.github.com/users/gsaraf/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gsaraf/subscriptions","organizations_url":"https://api.github.com/users/gsaraf/orgs","repos_url":"https://api.github.com/users/gsaraf/repos","events_url":"https://api.github.com/users/gsaraf/events{/privacy}","received_events_url":"https://api.github.com/users/gsaraf/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":67767667,"node_id":"MDU6TGFiZWw2Nzc2NzY2Nw==","url":"https://api.github.com/repos/syncthing/syncthing/labels/enhancement","name":"enhancement","color":"0e8a16","default":true,"description":"New features or improvements of some kind, as opposed to a problem (bug)"},{"id":628314330,"node_id":"MDU6TGFiZWw2MjgzMTQzMzA=","url":"https://api.github.com/repos/syncthing/syncthing/labels/frozen-due-to-age","name":"frozen-due-to-age","color":"eeeeee","default":false,"description":"Issues closed and untouched for a long time, together with being locked for discussion"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/syncthing/syncthing/milestones/65","html_url":"https://github.com/syncthing/syncthing/milestone/65","labels_url":"https://api.github.com/repos/syncthing/syncthing/milestones/65/labels","id":6699525,"node_id":"MDk6TWlsZXN0b25lNjY5OTUyNQ==","number":65,"title":"v1.17.0","description":"This release deprecates TLS 1.2 for sync connections; other side should be Syncthing 1.3.0 or newer, or see [insecureAllowOldTLSVersions](https://docs.syncthing.net/advanced/option-insecure-allow-old-tls-versions.html).","creator":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":58,"state":"closed","created_at":"2021-04-26T13:40:14Z","updated_at":"2021-06-01T14:11:34Z","due_on":"2021-06-01T07:00:00Z","closed_at":"2021-06-01T14:11:34Z"},"comments":2,"created_at":"2021-04-25T17:05:42Z","updated_at":"2022-08-11T07:14:57Z","closed_at":"2021-04-26T20:14:01Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"We are using syncthing as part of a larger system, as an end-to-end solution for file synchronization between two [or more] endpoints. It is working well for us, but we have encountered a problem with the time it takes syncthing to register that a new device was added and connect to it.\r\n\r\nIn our system, syncthing is running in the background, and at a random time we may change the devices to which we sync the folder[s]. We do this using the REST API - `/rest/config/devices`. Following that we listen on events that inform us that the connection has succeeded and initial content sync completed.\r\n\r\nThe problem is that after the config update it can take up to a minute (`stdConnectionLoopSleep`) for syncthing to actually reach out to the remote device, and in an interactive context that is a **long** time. This affects all users of the REST API - I think reducing the time it takes to implement config updates would be useful to everyone ðŸ˜„ \r\n\r\nFrom reading around the code, it seems a relatively simple solution of adding a \"deviceConfigUpdated\" channel to the select in the loop in `lib/connections/service.go:connect`, and sending a signal from the REST api handlers once the config is updated, should solve. I'd be happy to work on this ðŸ™‚ \r\n","closed_by":{"login":"AudriusButkevicius","id":1144861,"node_id":"MDQ6VXNlcjExNDQ4NjE=","avatar_url":"https://avatars.githubusercontent.com/u/1144861?v=4","gravatar_id":"","url":"https://api.github.com/users/AudriusButkevicius","html_url":"https://github.com/AudriusButkevicius","followers_url":"https://api.github.com/users/AudriusButkevicius/followers","following_url":"https://api.github.com/users/AudriusButkevicius/following{/other_user}","gists_url":"https://api.github.com/users/AudriusButkevicius/gists{/gist_id}","starred_url":"https://api.github.com/users/AudriusButkevicius/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AudriusButkevicius/subscriptions","organizations_url":"https://api.github.com/users/AudriusButkevicius/orgs","repos_url":"https://api.github.com/users/AudriusButkevicius/repos","events_url":"https://api.github.com/users/AudriusButkevicius/events{/privacy}","received_events_url":"https://api.github.com/users/AudriusButkevicius/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/syncthing/syncthing/issues/7600/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/syncthing/syncthing/issues/7600/timeline","performed_via_github_app":null,"state_reason":"completed"}