{"url":"https://api.github.com/repos/syncthing/syncthing/issues/5148","repository_url":"https://api.github.com/repos/syncthing/syncthing","labels_url":"https://api.github.com/repos/syncthing/syncthing/issues/5148/labels{/name}","comments_url":"https://api.github.com/repos/syncthing/syncthing/issues/5148/comments","events_url":"https://api.github.com/repos/syncthing/syncthing/issues/5148/events","html_url":"https://github.com/syncthing/syncthing/issues/5148","id":354585950,"node_id":"MDU6SXNzdWUzNTQ1ODU5NTA=","number":5148,"title":"Consider switching to Go modules","user":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":122660823,"node_id":"MDU6TGFiZWwxMjI2NjA4MjM=","url":"https://api.github.com/repos/syncthing/syncthing/labels/build","name":"build","color":"1d76db","default":false,"description":"Issues caused by or requiring changes to the build system (scripts or Docker image)"},{"id":628314330,"node_id":"MDU6TGFiZWw2MjgzMTQzMzA=","url":"https://api.github.com/repos/syncthing/syncthing/labels/frozen-due-to-age","name":"frozen-due-to-age","color":"eeeeee","default":false,"description":"Issues closed and untouched for a long time, together with being locked for discussion"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/syncthing/syncthing/milestones/30","html_url":"https://github.com/syncthing/syncthing/milestone/30","labels_url":"https://api.github.com/repos/syncthing/syncthing/milestones/30/labels","id":3893101,"node_id":"MDk6TWlsZXN0b25lMzg5MzEwMQ==","number":30,"title":"v1.0.1","description":"","creator":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":43,"state":"closed","created_at":"2018-12-12T14:51:05Z","updated_at":"2019-02-05T06:41:30Z","due_on":"2019-02-05T08:00:00Z","closed_at":"2019-02-05T06:41:30Z"},"comments":1,"created_at":"2018-08-28T06:17:36Z","updated_at":"2019-12-19T07:02:18Z","closed_at":"2018-12-18T11:36:46Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Now that Go 1.11 has landed we have Go modules support in the standard tooling, [with forward compatibility](https://golang.org/doc/go1.11#modules) (what we do now will work in the future). Our current preferred vendoring tool [has been discontinued](https://twitter.com/FiloSottile/status/1033216762454503424). I propose that we switch internally to using modules, while retaining the vendor directory for pre-1.11 (or in-GOPATH) builds. Here's a short fictive FAQ on how I envision that.\r\n\r\n### What's the migration process?\r\n\r\nEssentially `GO111MODULE=on go build ./...`. The new mode kicks in, creates a `go.mod` file based on our existing vendor manifest. We delete delete that manifest. The vendor directory remains.\r\n\r\nThe build script today attempts to set up a temporary GOPATH and build there if called with the source outside of GOPATH. We disable this when the compiler is 1.11+.\r\n\r\n(In the future I want to clean up our package paths a bit as well, but realistically after Go 1.12.)\r\n\r\n### What do I need to do as a developer?\r\n\r\nNothing, urgently. When building within GOPATH Go 1.11 behaves exactly like previous versions, and previous versions will continue working as well because the dependencies are still vendored.\r\n\r\n### What's the point then?\r\n\r\nWhen building outside of GOPATH (with Go 1.11) the new behavior kicks in and everything still just works. This is neat for build servers and stuff as well.\r\n\r\nCleaner dependency/vendor updates.\r\n\r\n### How do I update a dependency?\r\n\r\nThis is when you need to actually interact with the module system. You do it like this;\r\n\r\n1. Enable the module system. Do this by using Go 1.11 and not having the source in GOPATH, or by setting `GO111MODULE=on`.\r\n2. `go get` your updated dependency from within the `syncthing`  source. The `go mod` file is updated appropriately.\r\n3. `go mod vendor` to update the vendored dependencies.\r\n\r\n### How do I hack on a dependency without pushing it etc?\r\n\r\nThis is a bit rough. You can do it like you would today (be in GOPATH, remove it from the vendor dir), or you can add a `replace` directive to `go.mod` that points a certain package towards a local path on your disk.\r\n\r\n### How does this work with my favorite IDE?\r\n\r\nConsult your IDE vendor.","closed_by":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/syncthing/syncthing/issues/5148/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/syncthing/syncthing/issues/5148/timeline","performed_via_github_app":null,"state_reason":"completed"}