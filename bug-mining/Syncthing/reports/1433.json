{"url":"https://api.github.com/repos/syncthing/syncthing/issues/9417","repository_url":"https://api.github.com/repos/syncthing/syncthing","labels_url":"https://api.github.com/repos/syncthing/syncthing/issues/9417/labels{/name}","comments_url":"https://api.github.com/repos/syncthing/syncthing/issues/9417/comments","events_url":"https://api.github.com/repos/syncthing/syncthing/issues/9417/events","html_url":"https://github.com/syncthing/syncthing/issues/9417","id":2132959743,"node_id":"I_kwDOAOCAEs5_ImH_","number":9417,"title":"CPU usage increases after folder scans (and hence, over time)","user":{"login":"olifre","id":166759,"node_id":"MDQ6VXNlcjE2Njc1OQ==","avatar_url":"https://avatars.githubusercontent.com/u/166759?v=4","gravatar_id":"","url":"https://api.github.com/users/olifre","html_url":"https://github.com/olifre","followers_url":"https://api.github.com/users/olifre/followers","following_url":"https://api.github.com/users/olifre/following{/other_user}","gists_url":"https://api.github.com/users/olifre/gists{/gist_id}","starred_url":"https://api.github.com/users/olifre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/olifre/subscriptions","organizations_url":"https://api.github.com/users/olifre/orgs","repos_url":"https://api.github.com/users/olifre/repos","events_url":"https://api.github.com/users/olifre/events{/privacy}","received_events_url":"https://api.github.com/users/olifre/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":67767665,"node_id":"MDU6TGFiZWw2Nzc2NzY2NQ==","url":"https://api.github.com/repos/syncthing/syncthing/labels/bug","name":"bug","color":"d93f0b","default":true,"description":"A problem with current functionality, as opposed to missing functionality (enhancement)"},{"id":628314330,"node_id":"MDU6TGFiZWw2MjgzMTQzMzA=","url":"https://api.github.com/repos/syncthing/syncthing/labels/frozen-due-to-age","name":"frozen-due-to-age","color":"eeeeee","default":false,"description":"Issues closed and untouched for a long time, together with being locked for discussion"},{"id":2043110077,"node_id":"MDU6TGFiZWwyMDQzMTEwMDc3","url":"https://api.github.com/repos/syncthing/syncthing/labels/needs-triage","name":"needs-triage","color":"ce23af","default":false,"description":"New issues needed to be validated"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/syncthing/syncthing/milestones/104","html_url":"https://github.com/syncthing/syncthing/milestone/104","labels_url":"https://api.github.com/repos/syncthing/syncthing/milestones/104/labels","id":10635289,"node_id":"MI_kwDOAOCAEs4AokgZ","number":104,"title":"v1.27.5","description":"","creator":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":17,"state":"closed","created_at":"2024-03-04T09:28:37Z","updated_at":"2024-04-02T05:28:36Z","due_on":"2024-04-02T07:00:00Z","closed_at":"2024-04-02T05:28:36Z"},"comments":15,"created_at":"2024-02-13T18:58:32Z","updated_at":"2025-04-09T18:48:57Z","closed_at":"2024-03-05T18:04:28Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"- Syncthing: v1.27.3, Linux (64-bit Intel/AMD)\r\n- OS: Debian 12, Kernel 6.1.0-18-amd64\r\n- Size: 23.075 files, 1.738 dirs, ~45,6 GiB total size, 6 folders\r\n- Staggered versioning enabled (not sure if relevant)\r\n- `inotify` watches enabled\r\n\r\n# Observation\r\n\r\nCPU usage is low in general (< 1 % on a small Intel SoC), but keeps growing slowly over time (after >2 days) to 2 % and above, i.e. by over a factor of two (in idle). After prolonged runtime of some weeks, I also observed > 4 %. \r\n\r\n# Reproduction steps\r\n\r\nEither wait ;-), or run many folder rescans. Slowly hitting \"Rescan all folders\" about 80 times, then waiting until everything has settled down, CPU usage has increased, too. \r\nSo likely, the regular hourly scan is causing it. \r\n\r\n# Further information\r\n\r\nInitially reported as:\r\nhttps://forum.syncthing.net/t/slowly-increasing-cpu-usage-over-time/21639/2\r\n(until I found a reproducer). \r\n\r\nNote I also observe a higher rate of syscalls such as:\r\n```\r\n[pid  1605] epoll_pwait(4, [], 128, 0, NULL, 0) = 0\r\n[pid  1605] epoll_pwait(4, [], 128, 0, NULL, 0) = 0\r\n[pid  1605] epoll_pwait(4,  <unfinished ...>\r\n[pid   962] <... nanosleep resumed>NULL) = 0\r\n[pid   962] futex(0x1a2afa0, FUTEX_WAIT_PRIVATE, 0, {tv_sec=0, tv_nsec=2996919}) = -1 ETIMEDOUT (Connection timed out)\r\n[pid  1605] <... epoll_pwait resumed>[], 128, 13, NULL, 0) = 0\r\n[pid   962] nanosleep({tv_sec=0, tv_nsec=10000000},  <unfinished ...>\r\n[pid  1605] epoll_pwait(4, [], 128, 0, NULL, 0) = 0\r\n[pid  1605] epoll_pwait(4,  <unfinished ...>\r\n[pid   962] <... nanosleep resumed>NULL) = 0\r\n[pid   962] futex(0x1a2afa0, FUTEX_WAIT_PRIVATE, 0, {tv_sec=0, tv_nsec=1697811} <unfinished ...>\r\n[pid  1605] <... epoll_pwait resumed>[], 128, 12, NULL, 0) = 0\r\n[pid   962] <... futex resumed>)        = -1 ETIMEDOUT (Connection timed out)\r\n[pid  1605] epoll_pwait(4,  <unfinished ...>\r\n[pid   962] nanosleep({tv_sec=0, tv_nsec=10000000},  <unfinished ...>\r\n[pid  1605] <... epoll_pwait resumed>[], 128, 0, NULL, 0) = 0\r\n[pid  1605] epoll_pwait(4, [], 128, 0, NULL, 0) = 0\r\n[pid  1605] epoll_pwait(4,  <unfinished ...>\r\n[pid   962] <... nanosleep resumed>NULL) = 0\r\n[pid   962] futex(0x1a2afa0, FUTEX_WAIT_PRIVATE, 0, {tv_sec=0, tv_nsec=3958898} <unfinished ...>\r\n[pid  1605] <... epoll_pwait resumed>[], 128, 14, NULL, 0) = 0\r\n[pid   962] <... futex resumed>)        = -1 ETIMEDOUT (Connection timed out)\r\n```\r\nin this state, but not sure whether this is really related. ","closed_by":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/syncthing/syncthing/issues/9417/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/syncthing/syncthing/issues/9417/timeline","performed_via_github_app":null,"state_reason":"completed"}