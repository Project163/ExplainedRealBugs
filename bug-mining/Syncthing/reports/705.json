{"url":"https://api.github.com/repos/syncthing/syncthing/issues/4400","repository_url":"https://api.github.com/repos/syncthing/syncthing","labels_url":"https://api.github.com/repos/syncthing/syncthing/issues/4400/labels{/name}","comments_url":"https://api.github.com/repos/syncthing/syncthing/issues/4400/comments","events_url":"https://api.github.com/repos/syncthing/syncthing/issues/4400/events","html_url":"https://github.com/syncthing/syncthing/issues/4400","id":260170859,"node_id":"MDU6SXNzdWUyNjAxNzA4NTk=","number":4400,"title":"Keep enough counters and state in the database to avoid initial database traversal","user":{"login":"Nutomic","id":1044450,"node_id":"MDQ6VXNlcjEwNDQ0NTA=","avatar_url":"https://avatars.githubusercontent.com/u/1044450?v=4","gravatar_id":"","url":"https://api.github.com/users/Nutomic","html_url":"https://github.com/Nutomic","followers_url":"https://api.github.com/users/Nutomic/followers","following_url":"https://api.github.com/users/Nutomic/following{/other_user}","gists_url":"https://api.github.com/users/Nutomic/gists{/gist_id}","starred_url":"https://api.github.com/users/Nutomic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Nutomic/subscriptions","organizations_url":"https://api.github.com/users/Nutomic/orgs","repos_url":"https://api.github.com/users/Nutomic/repos","events_url":"https://api.github.com/users/Nutomic/events{/privacy}","received_events_url":"https://api.github.com/users/Nutomic/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":67767667,"node_id":"MDU6TGFiZWw2Nzc2NzY2Nw==","url":"https://api.github.com/repos/syncthing/syncthing/labels/enhancement","name":"enhancement","color":"0e8a16","default":true,"description":"New features or improvements of some kind, as opposed to a problem (bug)"},{"id":628314330,"node_id":"MDU6TGFiZWw2MjgzMTQzMzA=","url":"https://api.github.com/repos/syncthing/syncthing/labels/frozen-due-to-age","name":"frozen-due-to-age","color":"eeeeee","default":false,"description":"Issues closed and untouched for a long time, together with being locked for discussion"}],"state":"closed","locked":true,"assignee":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/syncthing/syncthing/milestones/17","html_url":"https://github.com/syncthing/syncthing/milestone/17","labels_url":"https://api.github.com/repos/syncthing/syncthing/milestones/17/labels","id":2979444,"node_id":"MDk6TWlsZXN0b25lMjk3OTQ0NA==","number":17,"title":"v0.14.43","description":null,"creator":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":11,"state":"closed","created_at":"2017-12-14T10:23:00Z","updated_at":"2018-01-09T12:32:34Z","due_on":null,"closed_at":"2018-01-09T12:32:34Z"},"comments":13,"created_at":"2017-09-25T06:53:02Z","updated_at":"2018-12-15T07:02:01Z","closed_at":"2017-12-14T09:51:26Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"The initial traversal of the database to build up counters and verify state can take a long time. It would be neat to have all the data available up front and, if necessary, do a consistency scan in the background instead.\r\n\r\n// edited by @calmh\r\n\r\n\r\n---\r\n\r\nThis is related to #4348. When I created that issue, I was only testing startup times for Syncthing without any folders. Now that I'm using the released version on my phone, I was surprised that startup is still relatively slow. Turns out that this seems to be caused initial folder scan, which is run before the GUI port is opened.\r\n\r\nOn my LG G4, startup with ~15 GB data (~6500 files) takes around 5 seconds. If I remove all folders, startup only takes around 1 second.\r\n\r\nStartup log with folders:\r\n```\r\n09-25 15:14:00.491 INFO: syncthing v0.14.38 \"Dysprosium Dragonfly\" (go1.8 linux-arm64) vagrant@jessie64 2017-09-07 09:40:46 UTC [noupgrade]\r\n09-25 15:14:00.495 INFO: My ID: 3FNAXCD-EZX3HBW-CPBD3DB-2UFFG5W-KDTG7FE-XK74CYU-JYJHTP3-7UYTNQC\r\n09-25 15:14:00.498 INFO: Disabling weak hash\r\n09-25 15:14:00.919 INFO: Ready to synchronize \"Whatsapp Backup\" (uzrbq-phjza) (readonly)\r\n09-25 15:14:03.333 INFO: Ready to synchronize felix_sync (readwrite)\r\n09-25 15:14:04.175 INFO: Ready to synchronize g4_music (readwrite)\r\n09-25 15:14:04.324 INFO: Ready to synchronize g4_pictures (readwrite)\r\n09-25 15:14:04.325 INFO: Send rate is unlimited, receive rate is unlimited\r\n09-25 15:14:04.326 INFO: Rate limits do not apply to LAN connections\r\n09-25 15:14:04.327 INFO: Using discovery server https://discovery-v4-2.syncthing.net/v2/?id=DVU36WY-H3LVZHW-E6LLFRE-YAFN5EL-HILWRYP-OC2M47J-Z4PE62Y-ADIBDQC\r\n09-25 15:14:04.328 INFO: Using discovery server https://discovery-v4-3.syncthing.net/v2/?id=VK6HNJ3-VVMM66S-HRVWSCR-IXEHL2H-U4AQ4MW-UCPQBWX-J2L2UBK-NVZRDQZ\r\n09-25 15:14:04.331 INFO: TCP listener ([::]:22000) starting\r\n09-25 15:14:04.479 INFO: Completed initial scan of readwrite folder g4_pictures\r\n09-25 15:14:04.897 INFO: Completed initial scan of readonly folder \"Whatsapp Backup\" (uzrbq-phjza)\r\n09-25 15:14:05.250 INFO: Completed initial scan of readwrite folder g4_music\r\n09-25 15:14:05.365 INFO: Using discovery server https://discovery-v4-4.syncthing.net/v2/?id=LYXKCHX-VI3NYZR-ALCJBHF-WMZYSPK-QG6QJA3-MPFYMSO-U56GTUK-NA2MIAW\r\n09-25 15:14:05.371 INFO: Using discovery server https://discovery-v6-2.syncthing.net/v2/?id=DVU36WY-H3LVZHW-E6LLFRE-YAFN5EL-HILWRYP-OC2M47J-Z4PE62Y-ADIBDQC\r\n09-25 15:14:05.372 INFO: Using discovery server https://discovery-v6-3.syncthing.net/v2/?id=VK6HNJ3-VVMM66S-HRVWSCR-IXEHL2H-U4AQ4MW-UCPQBWX-J2L2UBK-NVZRDQZ\r\n09-25 15:14:05.376 INFO: Using discovery server https://discovery-v6-4.syncthing.net/v2/?id=LYXKCHX-VI3NYZR-ALCJBHF-WMZYSPK-QG6QJA3-MPFYMSO-U56GTUK-NA2MIAW\r\n09-25 15:14:05.474 INFO: Device xyz is \"xyz\" at [dynamic]\r\n09-25 15:14:05.480 INFO: Device xyz is \"xyz\" at [dynamic]\r\n09-25 15:14:05.481 INFO: Device xyz is \"xyz\" at [dynamic]\r\n09-25 15:14:05.482 INFO: No automatic upgrades; STNOUPGRADE environment variable defined.\r\n09-25 15:14:05.483 INFO: Starting usage reporting\r\n09-25 15:14:05.485 INFO: GUI and API listening on 127.0.0.1:8384\r\n09-25 15:14:05.490 INFO: Access the GUI via the following URL: https://127.0.0.1:8384/\r\n```\r\nStartup log without any folders:\r\n```\r\n09-25 15:36:24.484 INFO: syncthing v0.14.38 \"Dysprosium Dragonfly\" (go1.8 linux-arm64) vagrant@jessie64 2017-09-07 09:40:46 UTC [noupgrade]\r\n09-25 15:36:24.485 INFO: My ID: 3FNAXCD-EZX3HBW-CPBD3DB-2UFFG5W-KDTG7FE-XK74CYU-JYJHTP3-7UYTNQC\r\n09-25 15:36:24.486 INFO: Disabling weak hash\r\n09-25 15:36:24.505 INFO: Send rate is unlimited, receive rate is unlimited\r\n09-25 15:36:24.506 INFO: Rate limits do not apply to LAN connections\r\n09-25 15:36:24.507 INFO: Using discovery server https://discovery-v4-2.syncthing.net/v2/?id=DVU36WY-H3LVZHW-E6LLFRE-YAFN5EL-HILWRYP-OC2M47J-Z4PE62Y-ADIBDQC\r\n09-25 15:36:24.508 INFO: Using discovery server https://discovery-v4-3.syncthing.net/v2/?id=VK6HNJ3-VVMM66S-HRVWSCR-IXEHL2H-U4AQ4MW-UCPQBWX-J2L2UBK-NVZRDQZ\r\n09-25 15:36:24.509 INFO: TCP listener ([::]:22000) starting\r\n09-25 15:36:24.543 Using DNS servers: [168.126.63.1:53 168.126.63.2:53]\r\n09-25 15:36:25.441 INFO: Using discovery server https://discovery-v4-4.syncthing.net/v2/?id=LYXKCHX-VI3NYZR-ALCJBHF-WMZYSPK-QG6QJA3-MPFYMSO-U56GTUK-NA2MIAW\r\n09-25 15:36:25.442 INFO: Using discovery server https://discovery-v6-2.syncthing.net/v2/?id=DVU36WY-H3LVZHW-E6LLFRE-YAFN5EL-HILWRYP-OC2M47J-Z4PE62Y-ADIBDQC\r\n09-25 15:36:25.446 INFO: Using discovery server https://discovery-v6-3.syncthing.net/v2/?id=VK6HNJ3-VVMM66S-HRVWSCR-IXEHL2H-U4AQ4MW-UCPQBWX-J2L2UBK-NVZRDQZ\r\n09-25 15:36:25.453 INFO: Using discovery server https://discovery-v6-4.syncthing.net/v2/?id=LYXKCHX-VI3NYZR-ALCJBHF-WMZYSPK-QG6QJA3-MPFYMSO-U56GTUK-NA2MIAW\r\n09-25 15:36:25.575 INFO: Device X4NSCQK-47ZCRF4-DKSFSDY-3AALZCG-QNXQQDG-KUBQL7T-V4IPFIU-UGKBAQP is \"P50\" at [dynamic]\r\n09-25 15:36:25.576 INFO: Device xyz is \"xyz\" at [dynamic]\r\n09-25 15:36:25.577 INFO: Device xyz is \"xyz\" at [dynamic]\r\n09-25 15:36:25.578 INFO: No automatic upgrades; STNOUPGRADE environment variable defined.\r\n09-25 15:36:25.579 INFO: Starting usage reporting\r\n09-25 15:36:25.587 INFO: GUI and API listening on 127.0.0.1:8384\r\n09-25 15:36:25.588 INFO: Access the GUI via the following URL: https://127.0.0.1:8384/\r\n```\r\nI don't see why the initial folder scan should prevent the web GUI from starting. Instead, the scan should run in the background while the web GUI is running.\r\n\r\n### Version Information\r\n\r\nSyncthing Version: v0.14.38\r\nOS Version: Android 7.1\r\n\r\n","closed_by":{"login":"st-review","id":16196517,"node_id":"MDQ6VXNlcjE2MTk2NTE3","avatar_url":"https://avatars.githubusercontent.com/u/16196517?v=4","gravatar_id":"","url":"https://api.github.com/users/st-review","html_url":"https://github.com/st-review","followers_url":"https://api.github.com/users/st-review/followers","following_url":"https://api.github.com/users/st-review/following{/other_user}","gists_url":"https://api.github.com/users/st-review/gists{/gist_id}","starred_url":"https://api.github.com/users/st-review/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/st-review/subscriptions","organizations_url":"https://api.github.com/users/st-review/orgs","repos_url":"https://api.github.com/users/st-review/repos","events_url":"https://api.github.com/users/st-review/events{/privacy}","received_events_url":"https://api.github.com/users/st-review/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/syncthing/syncthing/issues/4400/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/syncthing/syncthing/issues/4400/timeline","performed_via_github_app":null,"state_reason":"completed"}