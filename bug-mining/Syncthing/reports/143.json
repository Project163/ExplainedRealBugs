{"url":"https://api.github.com/repos/syncthing/syncthing/issues/994","repository_url":"https://api.github.com/repos/syncthing/syncthing","labels_url":"https://api.github.com/repos/syncthing/syncthing/issues/994/labels{/name}","comments_url":"https://api.github.com/repos/syncthing/syncthing/issues/994/comments","events_url":"https://api.github.com/repos/syncthing/syncthing/issues/994/events","html_url":"https://github.com/syncthing/syncthing/issues/994","id":49625315,"node_id":"MDU6SXNzdWU0OTYyNTMxNQ==","number":994,"title":"Staggered file versioning - files missing in .stversions","user":{"login":"uok","id":9367272,"node_id":"MDQ6VXNlcjkzNjcyNzI=","avatar_url":"https://avatars.githubusercontent.com/u/9367272?v=4","gravatar_id":"","url":"https://api.github.com/users/uok","html_url":"https://github.com/uok","followers_url":"https://api.github.com/users/uok/followers","following_url":"https://api.github.com/users/uok/following{/other_user}","gists_url":"https://api.github.com/users/uok/gists{/gist_id}","starred_url":"https://api.github.com/users/uok/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/uok/subscriptions","organizations_url":"https://api.github.com/users/uok/orgs","repos_url":"https://api.github.com/users/uok/repos","events_url":"https://api.github.com/users/uok/events{/privacy}","received_events_url":"https://api.github.com/users/uok/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":67767665,"node_id":"MDU6TGFiZWw2Nzc2NzY2NQ==","url":"https://api.github.com/repos/syncthing/syncthing/labels/bug","name":"bug","color":"d93f0b","default":true,"description":"A problem with current functionality, as opposed to missing functionality (enhancement)"},{"id":628314330,"node_id":"MDU6TGFiZWw2MjgzMTQzMzA=","url":"https://api.github.com/repos/syncthing/syncthing/labels/frozen-due-to-age","name":"frozen-due-to-age","color":"eeeeee","default":false,"description":"Issues closed and untouched for a long time, together with being locked for discussion"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2014-11-20T22:13:14Z","updated_at":"2017-06-16T21:11:10Z","closed_at":"2014-12-06T12:27:20Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I just noticed that some deleted files never end up in the `.stversions` folder\nSettings (both devices): Staggered File Versioning, 30 days\n\n**Scenario 1** - file \"today.jpg\" (11/20/2014 16:01) \n1. device A: copy file \"today.jpg\" to synced folder and rescan\n2. device B: file is downloaded\n3. wait some time\n4. device A: rename file to \"today2.jpg\" and rescan\n5. device B: file is renamed and old version moved to `.stversions` with suffix \"~20141120-1601\"\n6. wait some time\n7. device A: delete file and do rescan \n8. device B: file is deleted / moved to `.stversions` with suffix \"~20141120-1601\"\n\n_Result_: 2 files (today.jpg and today2.jpg, both with suffixes) in `.stversions` \n\n**Scenario 2** - file \"old.jpg\" (04/04/2014 14:32)\n1. device A: copy file \"old.jpg\" to synced folder and do rescan\n2. device B: file is downloaded\n3. wait some time\n4. device A: rename file to \"old2.jpg\" and do rescan\n5. device B: file is renamed\n6. wait some time\n7. device A: delete file and do rescan\n8. device B: file is deleted\n\n_Result_: no files in `.stversions` \n\nThis seems to be a bug because both scenarios were tested at ~ 8pm today (11/20/2014) and it seems that Syncthing is appending the wrong \"timestamp\". Instead of date/time when file was renamed/deleted it uses the original creation timestamp \"20141120-1601\" and \"20140416-1432\". The problem shows in scenario 2: the timestamp is outside of the 30 days which are set as maximum age and the file is deleted immediately. Expected in both scenarios would be an appended timestamp with date/time of actual file change/rename/deletion, e.g. \"20141120-2005\" so if you change/delete old.jpg and today.jpg both today, they will be kept in `.stversions` until 12/18/2014\n","closed_by":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/syncthing/syncthing/issues/994/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/syncthing/syncthing/issues/994/timeline","performed_via_github_app":null,"state_reason":"completed"}