{"url":"https://api.github.com/repos/syncthing/syncthing/issues/5175","repository_url":"https://api.github.com/repos/syncthing/syncthing","labels_url":"https://api.github.com/repos/syncthing/syncthing/issues/5175/labels{/name}","comments_url":"https://api.github.com/repos/syncthing/syncthing/issues/5175/comments","events_url":"https://api.github.com/repos/syncthing/syncthing/issues/5175/events","html_url":"https://github.com/syncthing/syncthing/issues/5175","id":358697872,"node_id":"MDU6SXNzdWUzNTg2OTc4NzI=","number":5175,"title":"Record more performance metrics","user":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":67767667,"node_id":"MDU6TGFiZWw2Nzc2NzY2Nw==","url":"https://api.github.com/repos/syncthing/syncthing/labels/enhancement","name":"enhancement","color":"0e8a16","default":true,"description":"New features or improvements of some kind, as opposed to a problem (bug)"},{"id":628314330,"node_id":"MDU6TGFiZWw2MjgzMTQzMzA=","url":"https://api.github.com/repos/syncthing/syncthing/labels/frozen-due-to-age","name":"frozen-due-to-age","color":"eeeeee","default":false,"description":"Issues closed and untouched for a long time, together with being locked for discussion"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/syncthing/syncthing/milestones/96","html_url":"https://github.com/syncthing/syncthing/milestone/96","labels_url":"https://api.github.com/repos/syncthing/syncthing/milestones/96/labels","id":9763365,"node_id":"MI_kwDOAOCAEs4AlPol","number":96,"title":"v1.24.0","description":"","creator":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":19,"state":"closed","created_at":"2023-08-09T09:20:17Z","updated_at":"2023-09-05T06:50:00Z","due_on":"2023-09-05T07:00:00Z","closed_at":"2023-09-05T06:50:00Z"},"comments":17,"created_at":"2018-09-10T16:24:12Z","updated_at":"2024-08-03T18:44:22Z","closed_at":"2023-08-04T17:57:39Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Currently we do a hash benchmark. We track transfer rates. There are often support issues on sync being slow, and narrowing down the cause is tricky. To help that out we could sample our operations to perhaps be able to present useful data. Things we could measure:\r\n\r\n- Per device block request data; time taken for each request-response and the amount of data thus transferred. (This would aggregate to per-device and total transfer rates.)\r\n- Per block write stats. Time taken to write a block (and size) and the operation that caused it (copy or transferred).\r\n- Per block read stats. Time to read a block (and size) and why (copy, incoming request, etc).\r\n- Per block verification stats. Time to verify block hashes.\r\n- Per block database lookup stats. Time to iterate or look up candidate blocks from database.\r\n- General database stats: time per get/set operation. (Timing iterations is trickier.)\r\n- etc\r\n\r\nWe already keep some counters for block actions, but not fine grained and not with timing metrics.\r\n\r\nOne way to expose this could be as a prometheus endpoint, which then also buys us the data types for tracking histograms or percentiles of these things.\r\n\r\nActually showing, interpreting and understanding the data is another issue. Having it accessible as an endpoint that can be viewed (and included in a future \"support bundle\" thing) could be a good start.\r\n\r\n","closed_by":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/syncthing/syncthing/issues/5175/reactions","total_count":6,"+1":5,"-1":1,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/syncthing/syncthing/issues/5175/timeline","performed_via_github_app":null,"state_reason":"completed"}