{"url":"https://api.github.com/repos/syncthing/syncthing/issues/8594","repository_url":"https://api.github.com/repos/syncthing/syncthing","labels_url":"https://api.github.com/repos/syncthing/syncthing/issues/8594/labels{/name}","comments_url":"https://api.github.com/repos/syncthing/syncthing/issues/8594/comments","events_url":"https://api.github.com/repos/syncthing/syncthing/issues/8594/events","html_url":"https://github.com/syncthing/syncthing/issues/8594","id":1402020579,"node_id":"I_kwDOAOCAEs5TkSLj","number":8594,"title":"Extended attributes are only synced one way","user":{"login":"mafredri","id":147409,"node_id":"MDQ6VXNlcjE0NzQwOQ==","avatar_url":"https://avatars.githubusercontent.com/u/147409?v=4","gravatar_id":"","url":"https://api.github.com/users/mafredri","html_url":"https://github.com/mafredri","followers_url":"https://api.github.com/users/mafredri/followers","following_url":"https://api.github.com/users/mafredri/following{/other_user}","gists_url":"https://api.github.com/users/mafredri/gists{/gist_id}","starred_url":"https://api.github.com/users/mafredri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mafredri/subscriptions","organizations_url":"https://api.github.com/users/mafredri/orgs","repos_url":"https://api.github.com/users/mafredri/repos","events_url":"https://api.github.com/users/mafredri/events{/privacy}","received_events_url":"https://api.github.com/users/mafredri/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":67767665,"node_id":"MDU6TGFiZWw2Nzc2NzY2NQ==","url":"https://api.github.com/repos/syncthing/syncthing/labels/bug","name":"bug","color":"d93f0b","default":true,"description":"A problem with current functionality, as opposed to missing functionality (enhancement)"},{"id":628314330,"node_id":"MDU6TGFiZWw2MjgzMTQzMzA=","url":"https://api.github.com/repos/syncthing/syncthing/labels/frozen-due-to-age","name":"frozen-due-to-age","color":"eeeeee","default":false,"description":"Issues closed and untouched for a long time, together with being locked for discussion"}],"state":"closed","locked":true,"assignee":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/syncthing/syncthing/milestones/86","html_url":"https://github.com/syncthing/syncthing/milestone/86","labels_url":"https://api.github.com/repos/syncthing/syncthing/milestones/86/labels","id":8440894,"node_id":"MI_kwDOAOCAEs4AgMw-","number":86,"title":"v1.22.1","description":"","creator":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":23,"state":"closed","created_at":"2022-09-20T09:35:07Z","updated_at":"2022-11-02T07:52:29Z","due_on":"2022-11-01T07:00:00Z","closed_at":"2022-11-02T07:52:29Z"},"comments":7,"created_at":"2022-10-08T18:04:43Z","updated_at":"2023-10-16T18:45:41Z","closed_at":"2022-10-16T15:04:30Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"This happens using Syncthing v1.22.0.\r\n\r\nGiven two clients, A and B. For a file created by A, extended attribute modifications are only synced from A to B, not from B to A.\r\n\r\nSo let's say I do the following (Scenario 1):\r\n\r\n1. A: `touch test.txt; setfattr -n user.test -v test test.txt`\r\n2. B: `setfattr -n user.test2 -v test2 test.txt`\r\n\r\nOnly `test.txt` on B will have both attributes, it's not being synced from B. The same happens the other way around (Scenario 2):\r\n\r\n1. B: `touch test2.txt; setfattr -n user.test -v test test2.txt`\r\n2. A: `setfattr -n user.test2 -v test2 test2.txt`\r\n\r\nOnly `test.txt` on A will have both attributes.\r\n\r\nRestarting syncthing makes no difference, this behavior seems set at file creation.\r\n\r\nInterestingly, the change is picked up, but not transmitted for some reason (this is B from scenario 1, step 2):\r\n\r\n```\r\n[TWUEC] 2022/10/08 17:54:41.627739 basicfs_watch.go:102: DEBUG: basic /var/syncthing/Test Watch: Sending test.txt non-remove\r\n[TWUEC] 2022/10/08 17:54:41.627784 aggregator.go:296: DEBUG: aggregator/\"Test\" (errvk-ajxc3): Tracking (type non-remove): test.txt\r\n[TWUEC] 2022/10/08 17:54:41.627804 aggregator.go:315: DEBUG: aggregator/\"Test\" (errvk-ajxc3): Resetting notifyTimer to 10s\r\n[TWUEC] 2022/10/08 17:54:51.627968 aggregator.go:347: DEBUG: aggregator/\"Test\" (errvk-ajxc3): Notifying about 1 fs events\r\n[TWUEC] 2022/10/08 17:54:51.628012 aggregator.go:315: DEBUG: aggregator/\"Test\" (errvk-ajxc3): Resetting notifyTimer to 10s\r\n[TWUEC] 2022/10/08 17:54:51.628094 logfs.go:115: DEBUG: folderconfiguration.go:116 basic /var/syncthing/Test Stat . {0xc0000b7520} <nil>\r\n[TWUEC] 2022/10/08 17:54:51.628204 logfs.go:115: DEBUG: folderconfiguration.go:134 basic /var/syncthing/Test Stat .stfolder {0xc0000b7790} <nil>\r\n[TWUEC] 2022/10/08 17:54:51.628255 logfs.go:163: DEBUG: folder.go:334 basic /var/syncthing/config/index-v0.14.0.db Usage . {2078167924736 2078168711168} <nil>\r\n[TWUEC] 2022/10/08 17:54:51.628434 events.go:334: DEBUG: log 37 StateChanged map[duration:23.628311741 folder:errvk-ajxc3 from:idle to:scan-waiting]\r\n[TWUEC] 2022/10/08 17:54:51.628510 events.go:334: DEBUG: log 38 StateChanged map[duration:0.628361153 folder:errvk-ajxc3 from:scan-waiting to:scanning]\r\n[TWUEC] 2022/10/08 17:54:51.628818 walk.go:123: DEBUG: walker/errvk-ajxc3@0xc0007f20b0 Walk [test.txt] Matcher/[]@0xc0008e6000\r\n[TWUEC] 2022/10/08 17:54:51.628984 walkfs.go:84: DEBUG: walk: path=test.txt\r\n[TWUEC] 2022/10/08 17:54:51.629643 walk.go:423: DEBUG: walker/errvk-ajxc3@0xc0007f20b0 rescan: File{Name:\"test.txt\", Sequence:22, Permissions:0644, ModTime:2022-10-08 17:54:13.090756718 +0000 UTC, Version:{[{ATW3ZMM 1665251668}]}, VersionHash:, Length:0, Deleted:false, Invalid:false, LocalFlags:0x0, NoPermissions:false, BlockSize:131072, Blocks:[Block{0/0/0/e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855}], BlocksHash:d3bfe98e8f1ce891614854569a20f5f4508d6ab4025b872b7b3a8282ef75b12a, Platform:{<nil> <nil> xattrs:<name:\"user.test1\" value:\"test1\" >  <nil> <nil> <nil>}} 1665251653 -rw-r--r--\r\n[TWUEC] 2022/10/08 17:54:51.629705 walk.go:426: DEBUG: walker/errvk-ajxc3@0xc0007f20b0 to hash: test.txt File{Name:\"test.txt\", Sequence:0, Permissions:0644, ModTime:2022-10-08 17:54:13.090756718 +0000 UTC, Version:{[{ATW3ZMM 1665251668} {TWUECHX 1665251691}]}, VersionHash:, Length:0, Deleted:false, Invalid:false, LocalFlags:0x0, NoPermissions:false, BlockSize:131072, Blocks:[], BlocksHash:, Platform:{<nil> <nil> xattrs:<name:\"user.test1\" value:\"test1\" > xattrs:<name:\"user.test2\" value:\"test2\" >  <nil> <nil> <nil>}}\r\n[TWUEC] 2022/10/08 17:54:51.629814 walk.go:198: DEBUG: walker/errvk-ajxc3@0xc0007f20b0 real to hash: test.txt\r\n[TWUEC] 2022/10/08 17:54:51.630085 walk.go:176: DEBUG: walker/errvk-ajxc3@0xc0007f20b0 Walk progress done errvk-ajxc3 [test.txt] Matcher/[]@0xc0008e6000\r\n[TWUEC] 2022/10/08 17:54:51.630182 logfs.go:115: DEBUG: folderconfiguration.go:116 basic /var/syncthing/Test Stat . {0xc000379e10} <nil>\r\n[TWUEC] 2022/10/08 17:54:51.630244 logfs.go:115: DEBUG: folderconfiguration.go:134 basic /var/syncthing/Test Stat .stfolder {0xc001533c70} <nil>\r\n[TWUEC] 2022/10/08 17:54:51.630309 logfs.go:163: DEBUG: folder.go:334 basic /var/syncthing/config/index-v0.14.0.db Usage . {2078167924736 2078168711168} <nil>\r\n[TWUEC] 2022/10/08 17:54:51.630687 events.go:334: DEBUG: log 39 LocalIndexUpdated map[filenames:[test.txt] folder:errvk-ajxc3 items:1 sequence:23 version:23]\r\n[TWUEC] 2022/10/08 17:54:51.630735 events.go:334: DEBUG: log 40 LocalChangeDetected map[action:modified folder:errvk-ajxc3 folderID:errvk-ajxc3 label:Test modifiedBy:TWUECHX path:test.txt type:file]\r\n[TWUEC] 2022/10/08 17:54:51.630889 events.go:334: DEBUG: log 41 StateChanged map[duration:0.630799815 folder:errvk-ajxc3 from:scanning to:idle]\r\n[TWUEC] 2022/10/08 17:54:52.594940 events.go:334: DEBUG: log 42 FolderSummary {errvk-ajxc3 0xc000c5b4a0}\r\n[TWUEC] 2022/10/08 17:54:52.595076 events.go:334: DEBUG: log 43 FolderCompletion map[completion:100 device:ATW3ZMM-DJ3APTY-WA372XM-4KMWDNX-TNGCN7W-NTE543B-5IJRG7D-QLNLLAY folder:errvk-ajxc3 globalBytes:0 globalItems:1 needBytes:0 needDeletes:0 needItems:1 remoteState:valid sequence:37]\r\n[TWUEC] 2022/10/08 17:55:01.628904 aggregator.go:323: DEBUG: aggregator/\"Test\" (errvk-ajxc3): No tracked events, waiting for new event.\r\n```","closed_by":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/syncthing/syncthing/issues/8594/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/syncthing/syncthing/issues/8594/timeline","performed_via_github_app":null,"state_reason":"completed"}