{"url":"https://api.github.com/repos/syncthing/syncthing/issues/1524","repository_url":"https://api.github.com/repos/syncthing/syncthing","labels_url":"https://api.github.com/repos/syncthing/syncthing/issues/1524/labels{/name}","comments_url":"https://api.github.com/repos/syncthing/syncthing/issues/1524/comments","events_url":"https://api.github.com/repos/syncthing/syncthing/issues/1524/events","html_url":"https://github.com/syncthing/syncthing/issues/1524","id":64400278,"node_id":"MDU6SXNzdWU2NDQwMDI3OA==","number":1524,"title":"High CPU usage and constant thrashing of ~/.config/syncthing/index when \"idle\"","user":{"login":"ToxicFrog","id":90456,"node_id":"MDQ6VXNlcjkwNDU2","avatar_url":"https://avatars.githubusercontent.com/u/90456?v=4","gravatar_id":"","url":"https://api.github.com/users/ToxicFrog","html_url":"https://github.com/ToxicFrog","followers_url":"https://api.github.com/users/ToxicFrog/followers","following_url":"https://api.github.com/users/ToxicFrog/following{/other_user}","gists_url":"https://api.github.com/users/ToxicFrog/gists{/gist_id}","starred_url":"https://api.github.com/users/ToxicFrog/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ToxicFrog/subscriptions","organizations_url":"https://api.github.com/users/ToxicFrog/orgs","repos_url":"https://api.github.com/users/ToxicFrog/repos","events_url":"https://api.github.com/users/ToxicFrog/events{/privacy}","received_events_url":"https://api.github.com/users/ToxicFrog/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":628314330,"node_id":"MDU6TGFiZWw2MjgzMTQzMzA=","url":"https://api.github.com/repos/syncthing/syncthing/labels/frozen-due-to-age","name":"frozen-due-to-age","color":"eeeeee","default":false,"description":"Issues closed and untouched for a long time, together with being locked for discussion"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2015-03-26T00:06:03Z","updated_at":"2017-06-16T21:08:38Z","closed_at":"2015-03-26T12:55:06Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Two systems, both running Syncthing 0.10.29 on amd64 Linux. Starting as soon as the initial scan completes, and continuing forever (even after leaving it running for 3+ hours), ST exhibits 100-130% CPU usage. iotop shows it writing several MBps continuously.\n\nExamination of ~/.config/syncthing/index shows where the writes are going; the ldb files there are constantly being deleted and replaced. The total number and size remains more or less constant, but it's creating about 10 new ones _per second_ (and deleting old ones).\n\nStarting it with `STTRACE=events,files,model,scanner,stats,xdr` results in a huge amount of spam:\n\n```\ndevice.go:58: DEBUG: stats.DeviceStatisticsReference.WasSeen: 63R6ZOT...\n```\n\nThe device ID is always the same and is the ID of the other computer this one is connected to. It generates 500-600 of these log messages per second.\n\nThe other device exhibits the same behaviour, except showing the device ID of the first device, of course.\n\nIf I shut one of them down, the other one immediately calms down to about 15% CPU usage (which is still high for a service doing nothing, but acceptable) and the WasSeen spam goes away (to be replaced with much gentler log spam from puller.go, on the order of one message per dir per second).\n\nBased on a cursory reading of the source, it looks like there's something calling WasSeen in a busyloop, constantly updating the last-seen timestamp of the connected devices, resulting in maxed out CPU usage and constant disk thrashing by the levelDB files. I'm not sure what, though.\n\nLogs gistable on request, or you can find me in the IRC channel and grill me there.\n","closed_by":{"login":"AudriusButkevicius","id":1144861,"node_id":"MDQ6VXNlcjExNDQ4NjE=","avatar_url":"https://avatars.githubusercontent.com/u/1144861?v=4","gravatar_id":"","url":"https://api.github.com/users/AudriusButkevicius","html_url":"https://github.com/AudriusButkevicius","followers_url":"https://api.github.com/users/AudriusButkevicius/followers","following_url":"https://api.github.com/users/AudriusButkevicius/following{/other_user}","gists_url":"https://api.github.com/users/AudriusButkevicius/gists{/gist_id}","starred_url":"https://api.github.com/users/AudriusButkevicius/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AudriusButkevicius/subscriptions","organizations_url":"https://api.github.com/users/AudriusButkevicius/orgs","repos_url":"https://api.github.com/users/AudriusButkevicius/repos","events_url":"https://api.github.com/users/AudriusButkevicius/events{/privacy}","received_events_url":"https://api.github.com/users/AudriusButkevicius/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/syncthing/syncthing/issues/1524/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/syncthing/syncthing/issues/1524/timeline","performed_via_github_app":null,"state_reason":"completed"}