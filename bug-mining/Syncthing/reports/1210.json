{"url":"https://api.github.com/repos/syncthing/syncthing/issues/7419","repository_url":"https://api.github.com/repos/syncthing/syncthing","labels_url":"https://api.github.com/repos/syncthing/syncthing/issues/7419/labels{/name}","comments_url":"https://api.github.com/repos/syncthing/syncthing/issues/7419/comments","events_url":"https://api.github.com/repos/syncthing/syncthing/issues/7419/events","html_url":"https://github.com/syncthing/syncthing/issues/7419","id":820156089,"node_id":"MDU6SXNzdWU4MjAxNTYwODk=","number":7419,"title":"panic \"Snapshot(): database is closed\" on start after wiping database","user":{"login":"tomasz1986","id":5626656,"node_id":"MDQ6VXNlcjU2MjY2NTY=","avatar_url":"https://avatars.githubusercontent.com/u/5626656?v=4","gravatar_id":"","url":"https://api.github.com/users/tomasz1986","html_url":"https://github.com/tomasz1986","followers_url":"https://api.github.com/users/tomasz1986/followers","following_url":"https://api.github.com/users/tomasz1986/following{/other_user}","gists_url":"https://api.github.com/users/tomasz1986/gists{/gist_id}","starred_url":"https://api.github.com/users/tomasz1986/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tomasz1986/subscriptions","organizations_url":"https://api.github.com/users/tomasz1986/orgs","repos_url":"https://api.github.com/users/tomasz1986/repos","events_url":"https://api.github.com/users/tomasz1986/events{/privacy}","received_events_url":"https://api.github.com/users/tomasz1986/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":67767665,"node_id":"MDU6TGFiZWw2Nzc2NzY2NQ==","url":"https://api.github.com/repos/syncthing/syncthing/labels/bug","name":"bug","color":"d93f0b","default":true,"description":"A problem with current functionality, as opposed to missing functionality (enhancement)"},{"id":628314330,"node_id":"MDU6TGFiZWw2MjgzMTQzMzA=","url":"https://api.github.com/repos/syncthing/syncthing/labels/frozen-due-to-age","name":"frozen-due-to-age","color":"eeeeee","default":false,"description":"Issues closed and untouched for a long time, together with being locked for discussion"}],"state":"closed","locked":true,"assignee":{"login":"imsodin","id":15955093,"node_id":"MDQ6VXNlcjE1OTU1MDkz","avatar_url":"https://avatars.githubusercontent.com/u/15955093?v=4","gravatar_id":"","url":"https://api.github.com/users/imsodin","html_url":"https://github.com/imsodin","followers_url":"https://api.github.com/users/imsodin/followers","following_url":"https://api.github.com/users/imsodin/following{/other_user}","gists_url":"https://api.github.com/users/imsodin/gists{/gist_id}","starred_url":"https://api.github.com/users/imsodin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imsodin/subscriptions","organizations_url":"https://api.github.com/users/imsodin/orgs","repos_url":"https://api.github.com/users/imsodin/repos","events_url":"https://api.github.com/users/imsodin/events{/privacy}","received_events_url":"https://api.github.com/users/imsodin/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"imsodin","id":15955093,"node_id":"MDQ6VXNlcjE1OTU1MDkz","avatar_url":"https://avatars.githubusercontent.com/u/15955093?v=4","gravatar_id":"","url":"https://api.github.com/users/imsodin","html_url":"https://github.com/imsodin","followers_url":"https://api.github.com/users/imsodin/followers","following_url":"https://api.github.com/users/imsodin/following{/other_user}","gists_url":"https://api.github.com/users/imsodin/gists{/gist_id}","starred_url":"https://api.github.com/users/imsodin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imsodin/subscriptions","organizations_url":"https://api.github.com/users/imsodin/orgs","repos_url":"https://api.github.com/users/imsodin/repos","events_url":"https://api.github.com/users/imsodin/events{/privacy}","received_events_url":"https://api.github.com/users/imsodin/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/syncthing/syncthing/milestones/62","html_url":"https://github.com/syncthing/syncthing/milestone/62","labels_url":"https://api.github.com/repos/syncthing/syncthing/milestones/62/labels","id":6443170,"node_id":"MDk6TWlsZXN0b25lNjQ0MzE3MA==","number":62,"title":"v1.15.0","description":"This release fixes a vulnerability where Syncthing and the relay server can crash due to malformed relay protocol messages (CVE-2021-21404); see https://github.com/syncthing/syncthing/security/advisories/GHSA-x462-89pf-6r5h.\r\n\r\nThis release updates the CLI to use subcommands and adds the subcommands `cli` (previously standalone `stcli` utility) and `decrypt` (for offline verifying and decrypting encrypted folders).\r\n\r\nWith this release we invite everyone to test the \"untrusted (encrypted) devices\" feature. You should not use it yet on important production data. Thus UI controls are hidden behind a feature flag. For more information, visit: \r\nhttps://forum.syncthing.net/t/testing-untrusted-encrypted-devices/16470","creator":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":88,"state":"closed","created_at":"2021-02-17T10:21:38Z","updated_at":"2021-04-29T20:05:04Z","due_on":"2021-04-06T07:00:00Z","closed_at":"2021-04-06T06:17:01Z"},"comments":2,"created_at":"2021-03-02T16:02:20Z","updated_at":"2022-08-11T07:17:54Z","closed_at":"2021-03-07T12:43:24Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I had this panic today when starting Syncthing after wiping the database. By this I mean manually deleting `index-v0.14.0.db` after completely shutting Syncthing down, and then trying to start it again. The program still probably restarted itself after the panic and continued to work, and I only noticed the log many hours later.\r\n\r\n```\r\n[7LDIB] 2021/03/02 15:37:18 WARNING: Fatal error: ccmsc-zsmeh Snapshot(): database is closed\r\nPanic at 2021-03-02T15:37:19+09:00\r\npanic: database is closed\r\n\r\ngoroutine 150 [running]:\r\ngithub.com/syncthing/syncthing/lib/db.fatalError(0x1b4ca40, 0x20f50f4, 0x160e1280, 0x16, 0x128c01e0)\r\n\tgithub.com/syncthing/syncthing/lib/db/set.go:508 +0x14b\r\ngithub.com/syncthing/syncthing/lib/db.(*FileSet).Snapshot(0x14fa8720, 0x187459b0)\r\n\tgithub.com/syncthing/syncthing/lib/db/set.go:159 +0x220\r\ngithub.com/syncthing/syncthing/lib/model.(*folder).pull(0x129ad340, 0x12c9bd00)\r\n\tgithub.com/syncthing/syncthing/lib/model/folder.go:333 +0x10d\r\ngithub.com/syncthing/syncthing/lib/model.(*folder).Serve(0x129ad340, 0x1b56460, 0x150e26a0, 0x0, 0x0)\r\n\tgithub.com/syncthing/syncthing/lib/model/folder.go:173 +0x9a3\r\ngithub.com/thejerf/suture/v4.(*Supervisor).runService.func2(0x128f7bc0, 0x6, 0x332ab610, 0x129ad340, 0x1b56460, 0x150e26a0, 0x150dca30, 0x150ea400)\r\n\tgithub.com/thejerf/suture/v4@v4.0.0/supervisor.go:546 +0x5f\r\ncreated by github.com/thejerf/suture/v4.(*Supervisor).runService\r\n\tgithub.com/thejerf/suture/v4@v4.0.0/supervisor.go:534 +0x12a\r\n```\r\n\r\n[panic-20210302-153719.log](https://github.com/syncthing/syncthing/files/6069916/panic-20210302-153719.log)\r\n\r\nSyncthing v1.13.x (self-compiled with a few custom commits, see https://github.com/tomasz1986/syncthing/commits/tomasz86-v1.13.0)","closed_by":{"login":"imsodin","id":15955093,"node_id":"MDQ6VXNlcjE1OTU1MDkz","avatar_url":"https://avatars.githubusercontent.com/u/15955093?v=4","gravatar_id":"","url":"https://api.github.com/users/imsodin","html_url":"https://github.com/imsodin","followers_url":"https://api.github.com/users/imsodin/followers","following_url":"https://api.github.com/users/imsodin/following{/other_user}","gists_url":"https://api.github.com/users/imsodin/gists{/gist_id}","starred_url":"https://api.github.com/users/imsodin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imsodin/subscriptions","organizations_url":"https://api.github.com/users/imsodin/orgs","repos_url":"https://api.github.com/users/imsodin/repos","events_url":"https://api.github.com/users/imsodin/events{/privacy}","received_events_url":"https://api.github.com/users/imsodin/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/syncthing/syncthing/issues/7419/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/syncthing/syncthing/issues/7419/timeline","performed_via_github_app":null,"state_reason":"completed"}