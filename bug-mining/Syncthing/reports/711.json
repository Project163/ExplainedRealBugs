{"url":"https://api.github.com/repos/syncthing/syncthing/issues/1845","repository_url":"https://api.github.com/repos/syncthing/syncthing","labels_url":"https://api.github.com/repos/syncthing/syncthing/issues/1845/labels{/name}","comments_url":"https://api.github.com/repos/syncthing/syncthing/issues/1845/comments","events_url":"https://api.github.com/repos/syncthing/syncthing/issues/1845/events","html_url":"https://github.com/syncthing/syncthing/issues/1845","id":78947984,"node_id":"MDU6SXNzdWU3ODk0Nzk4NA==","number":1845,"title":"Files on deduplicated NTFS volumes are ignored by scanner","user":{"login":"NTmatter","id":243993,"node_id":"MDQ6VXNlcjI0Mzk5Mw==","avatar_url":"https://avatars.githubusercontent.com/u/243993?v=4","gravatar_id":"","url":"https://api.github.com/users/NTmatter","html_url":"https://github.com/NTmatter","followers_url":"https://api.github.com/users/NTmatter/followers","following_url":"https://api.github.com/users/NTmatter/following{/other_user}","gists_url":"https://api.github.com/users/NTmatter/gists{/gist_id}","starred_url":"https://api.github.com/users/NTmatter/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/NTmatter/subscriptions","organizations_url":"https://api.github.com/users/NTmatter/orgs","repos_url":"https://api.github.com/users/NTmatter/repos","events_url":"https://api.github.com/users/NTmatter/events{/privacy}","received_events_url":"https://api.github.com/users/NTmatter/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":67767665,"node_id":"MDU6TGFiZWw2Nzc2NzY2NQ==","url":"https://api.github.com/repos/syncthing/syncthing/labels/bug","name":"bug","color":"d93f0b","default":true,"description":"A problem with current functionality, as opposed to missing functionality (enhancement)"},{"id":628314330,"node_id":"MDU6TGFiZWw2MjgzMTQzMzA=","url":"https://api.github.com/repos/syncthing/syncthing/labels/frozen-due-to-age","name":"frozen-due-to-age","color":"eeeeee","default":false,"description":"Issues closed and untouched for a long time, together with being locked for discussion"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/syncthing/syncthing/milestones/17","html_url":"https://github.com/syncthing/syncthing/milestone/17","labels_url":"https://api.github.com/repos/syncthing/syncthing/milestones/17/labels","id":2979444,"node_id":"MDk6TWlsZXN0b25lMjk3OTQ0NA==","number":17,"title":"v0.14.43","description":null,"creator":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":11,"state":"closed","created_at":"2017-12-14T10:23:00Z","updated_at":"2018-01-09T12:32:34Z","due_on":null,"closed_at":"2018-01-09T12:32:34Z"},"comments":45,"created_at":"2015-05-21T11:12:01Z","updated_at":"2018-12-30T07:01:59Z","closed_at":"2017-12-29T21:23:12Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"When adding a folder on a volume with NTFS Deduplication enabled, deduped files are incorrectly skipped by the scanner. Files that are still pending deduplication are processed as expected. Folders are also processed as normal.\n\nA bit of digging indicates that os.Lstat on a deduped file has a FileMode containing ModeSymLink. Looking at the Read function in [symlink_windows.go](https://github.com/syncthing/syncthing/blob/master/internal/symlinks/symlink_windows.go#L104), the type of reparse point is available in reparseData.reparseTag, which should allow for correctly handling the condition. \n\nA quick reference to the tag values is available in [smbfsctl.h](https://github.com/torvalds/linux/blob/master/fs/cifs/smbfsctl.h#L100). Of interest are:\n- IO_REPARSE_TAG_DEDUP = 0x80000013\n- IO_REPARSE_TAG_SYMLINK = 0xA000000C\n- IO_REPARSE_TAG_MOUNT_POINT = 0xA0000003 (may be related to #1830)\n- More info about [Reparse Points](https://msdn.microsoft.com/en-us/library/windows/desktop/aa365511%28v=vs.85%29.aspx) and supported operations\n\nFor reference, it is possible to query a reparse point's tag and data with <code>fsutil reparsepoint query PATH_TO_FILE</code>. This even works across SMB shares with UNC paths.\n","closed_by":{"login":"st-review","id":16196517,"node_id":"MDQ6VXNlcjE2MTk2NTE3","avatar_url":"https://avatars.githubusercontent.com/u/16196517?v=4","gravatar_id":"","url":"https://api.github.com/users/st-review","html_url":"https://github.com/st-review","followers_url":"https://api.github.com/users/st-review/followers","following_url":"https://api.github.com/users/st-review/following{/other_user}","gists_url":"https://api.github.com/users/st-review/gists{/gist_id}","starred_url":"https://api.github.com/users/st-review/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/st-review/subscriptions","organizations_url":"https://api.github.com/users/st-review/orgs","repos_url":"https://api.github.com/users/st-review/repos","events_url":"https://api.github.com/users/st-review/events{/privacy}","received_events_url":"https://api.github.com/users/st-review/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/syncthing/syncthing/issues/1845/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/syncthing/syncthing/issues/1845/timeline","performed_via_github_app":null,"state_reason":"completed"}