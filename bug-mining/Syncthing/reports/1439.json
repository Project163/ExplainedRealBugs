{"url":"https://api.github.com/repos/syncthing/syncthing/issues/9455","repository_url":"https://api.github.com/repos/syncthing/syncthing","labels_url":"https://api.github.com/repos/syncthing/syncthing/issues/9455/labels{/name}","comments_url":"https://api.github.com/repos/syncthing/syncthing/issues/9455/comments","events_url":"https://api.github.com/repos/syncthing/syncthing/issues/9455/events","html_url":"https://github.com/syncthing/syncthing/issues/9455","id":2173853771,"node_id":"I_kwDOAOCAEs6BkmBL","number":9455,"title":"lib/api tests unreliable, failing ~50% of the time on Fedora Linux","user":{"login":"decathorpe","id":12836693,"node_id":"MDQ6VXNlcjEyODM2Njkz","avatar_url":"https://avatars.githubusercontent.com/u/12836693?v=4","gravatar_id":"","url":"https://api.github.com/users/decathorpe","html_url":"https://github.com/decathorpe","followers_url":"https://api.github.com/users/decathorpe/followers","following_url":"https://api.github.com/users/decathorpe/following{/other_user}","gists_url":"https://api.github.com/users/decathorpe/gists{/gist_id}","starred_url":"https://api.github.com/users/decathorpe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/decathorpe/subscriptions","organizations_url":"https://api.github.com/users/decathorpe/orgs","repos_url":"https://api.github.com/users/decathorpe/repos","events_url":"https://api.github.com/users/decathorpe/events{/privacy}","received_events_url":"https://api.github.com/users/decathorpe/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":67767665,"node_id":"MDU6TGFiZWw2Nzc2NzY2NQ==","url":"https://api.github.com/repos/syncthing/syncthing/labels/bug","name":"bug","color":"d93f0b","default":true,"description":"A problem with current functionality, as opposed to missing functionality (enhancement)"},{"id":122660823,"node_id":"MDU6TGFiZWwxMjI2NjA4MjM=","url":"https://api.github.com/repos/syncthing/syncthing/labels/build","name":"build","color":"1d76db","default":false,"description":"Issues caused by or requiring changes to the build system (scripts or Docker image)"},{"id":628314330,"node_id":"MDU6TGFiZWw2MjgzMTQzMzA=","url":"https://api.github.com/repos/syncthing/syncthing/labels/frozen-due-to-age","name":"frozen-due-to-age","color":"eeeeee","default":false,"description":"Issues closed and untouched for a long time, together with being locked for discussion"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/syncthing/syncthing/milestones/109","html_url":"https://github.com/syncthing/syncthing/milestone/109","labels_url":"https://api.github.com/repos/syncthing/syncthing/milestones/109/labels","id":11295028,"node_id":"MI_kwDOAOCAEs4ArFk0","number":109,"title":"v1.27.10","description":"","creator":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":7,"state":"closed","created_at":"2024-07-10T06:13:48Z","updated_at":"2024-08-06T06:28:33Z","due_on":"2024-08-06T07:00:00Z","closed_at":"2024-08-06T06:28:33Z"},"comments":4,"created_at":"2024-03-07T13:22:19Z","updated_at":"2025-07-09T18:45:14Z","closed_at":"2024-07-08T22:37:45Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### What happened?\n\nI'm the package maintainer for syncthing on Fedora Linux (and for EPEL 9 and 8). We're running tests during package builds, and one of the tests (for the `github.com/syncthing/syncthing/lib/api` module) has been very unstable and unreliable. This started happening a few releases ago, but it is much worse with v1.27.4 now.\r\n\r\nThe errors I see most often happen on Linux x86_64. I have seen then occur with both Go 1.22 (Fedora Rawhide and Fedora 40) and Go 1.21 (Fedora 39). With v1.27.4, about half of my attempted builds fail with the log output included below (or output very similar to it).\r\n\r\nI am building from the official \"source\" distribution that includes your vendored dependencies (i.e. not against Go packages that are packaged by the distribution), so there should be no mismatch between the sources and dependencies you use and the ones used for my builds.\n\n### Syncthing version\n\nv1.27.4\n\n### Platform & operating system\n\nLinux x86_64\n\n### Browser version\n\nN/A\n\n### Relevant log output\n\n```shell\n$ go test -buildmode pie -compiler gc -ldflags '  -extldflags '\\''-Wl,-z,relro -Wl,--as-needed  -Wl,-z,pack-relative-relocs -Wl,-z,now -specs=/usr/lib/rpm/redhat/redhat-hardened-ld-errors -specs=/usr/lib/rpm/redhat/redhat-hardened-ld -specs=/usr/lib/rpm/redhat/redhat-annobin-cc1  -Wl,--build-id=sha1 -specs=/usr/lib/rpm/redhat/redhat-package-notes  '\\''' github.com/syncthing/syncthing/lib/api\r\n2024/03/07 13:01:39 INFO: GUI and API listening on 127.0.0.1:35601\r\n2024/03/07 13:01:39 INFO: Access the GUI via the following URL: http://127.0.0.1:0/\r\n2024/03/07 13:01:39 INFO: GUI and API listening on 127.0.0.1:45031\r\n2024/03/07 13:01:39 INFO: Access the GUI via the following URL: http://127.0.0.1:0/\r\n2024/03/07 13:01:39 INFO: GUI and API listening on 127.0.0.1:34027\r\n2024/03/07 13:01:39 INFO: Access the GUI via the following URL: http://127.0.0.1:0/\r\n2024/03/07 13:01:39 INFO: GUI and API listening on [::]:45301\r\n2024/03/07 13:01:39 INFO: Access the GUI via the following URL: http:///\r\n2024/03/07 13:01:39 INFO: GUI and API listening on 127.0.0.1:44831\r\n2024/03/07 13:01:39 INFO: Access the GUI via the following URL: http://127.0.0.1:0/\r\n2024/03/07 13:01:39 INFO: GUI and API listening on 127.0.0.1:36359\r\n2024/03/07 13:01:39 INFO: Access the GUI via the following URL: http://127.0.0.1:0/\r\n2024/03/07 13:01:39 INFO: GUI and API listening on 127.0.0.1:43877\r\n2024/03/07 13:01:39 INFO: Access the GUI via the following URL: http://127.0.0.1:0/\r\n2024/03/07 13:01:39 INFO: GUI and API listening on 127.0.0.1:37173\r\n2024/03/07 13:01:39 INFO: Access the GUI via the following URL: http://127.0.0.1:0/\r\n2024/03/07 13:01:39 INFO: GUI and API listening on 127.0.0.1:39525\r\n2024/03/07 13:01:39 INFO: Access the GUI via the following URL: http://127.0.0.1:0/\r\n2024/03/07 13:01:39 INFO: GUI and API listening on 127.0.0.1:46203\r\n2024/03/07 13:01:39 INFO: GUI and API listening on 127.0.0.1:46383\r\n2024/03/07 13:01:39 INFO: Access the GUI via the following URL: http://127.0.0.1:0/\r\n2024/03/07 13:01:39 INFO: Access the GUI via the following URL: http://127.0.0.1:0/\r\n2024/03/07 13:01:39 WARNING: Connection priority number for QUIC over WAN must be worse (higher) than QUIC over LAN. Correcting.\r\n2024/03/07 13:01:39 WARNING: Connection priority number for TCP over WAN must be worse (higher) than TCP over LAN. Correcting.\r\n2024/03/07 13:01:39 INFO: GUI and API listening on 127.0.0.1:37241\r\n2024/03/07 13:01:39 INFO: Access the GUI via the following URL: http://127.0.0.1:0/\r\n2024/03/07 13:01:39 INFO: GUI and API listening on 127.0.0.1:41315\r\n2024/03/07 13:01:39 INFO: Access the GUI via the following URL: http://127.0.0.1:0/\r\n2024/03/07 13:01:39 WARNING: Decoding posted config: folder \"foo\": folder has duplicate ID\r\n2024/03/07 13:01:39 INFO: GUI and API listening on 127.0.0.1:34627\r\n2024/03/07 13:01:39 INFO: Access the GUI via the following URL: http://127.0.0.1:0/\r\n2024/03/07 13:01:39 INFO: GUI and API listening on [::]:33697\r\n2024/03/07 13:01:39 INFO: Access the GUI via the following URL: http://127.0.0.1:0/\r\n2024/03/07 13:01:40 INFO: GUI and API listening on [::1]:43443\r\n2024/03/07 13:01:40 INFO: Access the GUI via the following URL: http://[::1]:0/\r\n2024/03/07 13:01:40 INFO: Wrong credentials supplied during API authorization from 127.0.0.1:34780\r\n2024/03/07 13:01:40 INFO: Wrong credentials supplied during API authorization from 127.0.0.1:34784\r\n2024/03/07 13:01:40 INFO: Wrong credentials supplied during API authorization from 127.0.0.1:51566\r\n2024/03/07 13:01:40 INFO: Wrong credentials supplied during API authorization from 127.0.0.1:51614\r\n2024/03/07 13:01:40 INFO: GUI and API listening on 127.0.0.1:39313\r\n2024/03/07 13:01:40 INFO: Access the GUI via the following URL: http://127.0.0.1:0/\r\n2024/03/07 13:01:40 INFO: Wrong credentials supplied during API authorization from 127.0.0.1:40874\r\n2024/03/07 13:01:40 INFO: Wrong credentials supplied during API authorization from 127.0.0.1:40872\r\n2024/03/07 13:01:40 INFO: GUI and API listening on 127.0.0.1:41619\r\n2024/03/07 13:01:40 INFO: Access the GUI via the following URL: http://127.0.0.1:0/\r\n2024/03/07 13:01:40 INFO: Wrong credentials supplied during API authorization from 127.0.0.1:34506\r\n2024/03/07 13:01:40 INFO: Wrong credentials supplied during API authorization from 127.0.0.1:34470\r\n2024/03/07 13:01:41 INFO: GUI and API listening on 127.0.0.1:33699\r\n2024/03/07 13:01:41 INFO: Access the GUI via the following URL: http://127.0.0.1:0/\r\n2024/03/07 13:01:41 INFO: Wrong credentials supplied during API authorization from 127.0.0.1:42548\r\n2024/03/07 13:01:41 INFO: Wrong credentials supplied during API authorization from 127.0.0.1:42564\r\n--- FAIL: TestAPIServiceRequests (0.01s)\r\n    --- FAIL: TestAPIServiceRequests//rest/db/file?folder=default&file=something (1.00s)\r\n        api_test.go:464: Unexpected error requesting /rest/db/file?folder=default&file=something: Get \"http://127.0.0.1:44831/rest/db/file?folder=default&file=something\": context deadline exceeded (Client.Timeout exceeded while awaiting headers)\r\n    --- FAIL: TestAPIServiceRequests//rest/db/need?folder=default (1.00s)\r\n        api_test.go:464: Unexpected error requesting /rest/db/need?folder=default: Get \"http://127.0.0.1:44831/rest/db/need?folder=default\": context deadline exceeded (Client.Timeout exceeded while awaiting headers)\r\n    --- FAIL: TestAPIServiceRequests//rest/db/ignores?folder=default (1.00s)\r\n        api_test.go:464: Unexpected error requesting /rest/db/ignores?folder=default: Get \"http://127.0.0.1:44831/rest/db/ignores?folder=default\": context deadline exceeded (Client.Timeout exceeded while awaiting headers)\r\n    --- FAIL: TestAPIServiceRequests//rest/system/log?since=0 (1.00s)\r\n        api_test.go:464: Unexpected error requesting /rest/system/log?since=0: Get \"http://127.0.0.1:44831/rest/system/log?since=0\": context deadline exceeded (Client.Timeout exceeded while awaiting headers)\r\n2024/03/07 13:01:41 INFO: GUI and API listening on 127.0.0.1:46033\r\n2024/03/07 13:01:41 INFO: Access the GUI via the following URL: http://127.0.0.1:0/\r\n2024/03/07 13:01:41 INFO: Wrong credentials supplied during API authorization from 127.0.0.1:50216\r\n2024/03/07 13:01:41 INFO: Wrong credentials supplied during API authorization from 127.0.0.1:50174\r\n2024/03/07 13:01:41 INFO: GUI and API listening on 127.0.0.1:36115\r\n2024/03/07 13:01:41 INFO: Access the GUI via the following URL: http://127.0.0.1:0/\r\n2024/03/07 13:01:41 INFO: Wrong credentials supplied during API authorization from 127.0.0.1:33410\r\n2024/03/07 13:01:41 INFO: Wrong credentials supplied during API authorization from 127.0.0.1:33422\r\nFAIL\r\nFAIL\tgithub.com/syncthing/syncthing/lib/api\t2.284s\r\nFAIL\n```\n","closed_by":{"login":"imsodin","id":15955093,"node_id":"MDQ6VXNlcjE1OTU1MDkz","avatar_url":"https://avatars.githubusercontent.com/u/15955093?v=4","gravatar_id":"","url":"https://api.github.com/users/imsodin","html_url":"https://github.com/imsodin","followers_url":"https://api.github.com/users/imsodin/followers","following_url":"https://api.github.com/users/imsodin/following{/other_user}","gists_url":"https://api.github.com/users/imsodin/gists{/gist_id}","starred_url":"https://api.github.com/users/imsodin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imsodin/subscriptions","organizations_url":"https://api.github.com/users/imsodin/orgs","repos_url":"https://api.github.com/users/imsodin/repos","events_url":"https://api.github.com/users/imsodin/events{/privacy}","received_events_url":"https://api.github.com/users/imsodin/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/syncthing/syncthing/issues/9455/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/syncthing/syncthing/issues/9455/timeline","performed_via_github_app":null,"state_reason":"completed"}