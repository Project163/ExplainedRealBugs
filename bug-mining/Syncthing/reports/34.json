{"url":"https://api.github.com/repos/syncthing/syncthing/issues/607","repository_url":"https://api.github.com/repos/syncthing/syncthing","labels_url":"https://api.github.com/repos/syncthing/syncthing/issues/607/labels{/name}","comments_url":"https://api.github.com/repos/syncthing/syncthing/issues/607/comments","events_url":"https://api.github.com/repos/syncthing/syncthing/issues/607/events","html_url":"https://github.com/syncthing/syncthing/issues/607","id":41617045,"node_id":"MDU6SXNzdWU0MTYxNzA0NQ==","number":607,"title":"Staggered versioner tries to delete non-empty directory and fails to do so","user":{"login":"rkfg","id":184066,"node_id":"MDQ6VXNlcjE4NDA2Ng==","avatar_url":"https://avatars.githubusercontent.com/u/184066?v=4","gravatar_id":"","url":"https://api.github.com/users/rkfg","html_url":"https://github.com/rkfg","followers_url":"https://api.github.com/users/rkfg/followers","following_url":"https://api.github.com/users/rkfg/following{/other_user}","gists_url":"https://api.github.com/users/rkfg/gists{/gist_id}","starred_url":"https://api.github.com/users/rkfg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rkfg/subscriptions","organizations_url":"https://api.github.com/users/rkfg/orgs","repos_url":"https://api.github.com/users/rkfg/repos","events_url":"https://api.github.com/users/rkfg/events{/privacy}","received_events_url":"https://api.github.com/users/rkfg/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":628314330,"node_id":"MDU6TGFiZWw2MjgzMTQzMzA=","url":"https://api.github.com/repos/syncthing/syncthing/labels/frozen-due-to-age","name":"frozen-due-to-age","color":"eeeeee","default":false,"description":"Issues closed and untouched for a long time, together with being locked for discussion"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2014-09-01T08:22:00Z","updated_at":"2017-06-17T00:13:40Z","closed_at":"2014-09-04T19:59:38Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I've setup a staggered versioning in some of my repos. Pretty often after I delete/rename files on the other end, I get this message (the path is redacted but the number of directory levels are correct):\n\n```\n12:10:31: Versioner: can't remove directory /home/rkfg/repo/.stversions/dir1/dir2/dir3 remove /home/rkfg/repo/.stversions/dir1/dir2/dir3: directory not empty\n```\n\nSo I've run ST with STTRACE=versioner envvar and it says in the log:\n\n```\n[6ZF3D] 2014/09/01 12:10:31.457855 staggered.go:166: DEBUG: Cleaner: deleting empty directory /home/rkfg/repo/.stversions/dir1/dir2/dir3\n[6ZF3D] 2014/09/01 12:10:31.457913 staggered.go:170: WARNING: Versioner: can't remove directory /home/rkfg/repo/.stversions/dir1/dir2/dir3 remove /home/rkfg/repo/.stversions/dir1/dir2/dir3: directory not empty\n```\n\nThe said directory has a dozen of subdirs in it (definitely not empty!) and each of them has files inside, files are properly versioned, (filename.ext.v1409555296 for example). I've recently removed the entire .stversions directory because of the error, I thought it could contain some old pre-0.9 stuff that gets in the way. Seems like it didn't help.\n","closed_by":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/syncthing/syncthing/issues/607/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/syncthing/syncthing/issues/607/timeline","performed_via_github_app":null,"state_reason":"completed"}