{"url":"https://api.github.com/repos/syncthing/syncthing/issues/890","repository_url":"https://api.github.com/repos/syncthing/syncthing","labels_url":"https://api.github.com/repos/syncthing/syncthing/issues/890/labels{/name}","comments_url":"https://api.github.com/repos/syncthing/syncthing/issues/890/comments","events_url":"https://api.github.com/repos/syncthing/syncthing/issues/890/events","html_url":"https://github.com/syncthing/syncthing/issues/890","id":46380493,"node_id":"MDU6SXNzdWU0NjM4MDQ5Mw==","number":890,"title":"UPnP mapping failing since 0.10.2 release","user":{"login":"gavmorrison","id":3501679,"node_id":"MDQ6VXNlcjM1MDE2Nzk=","avatar_url":"https://avatars.githubusercontent.com/u/3501679?v=4","gravatar_id":"","url":"https://api.github.com/users/gavmorrison","html_url":"https://github.com/gavmorrison","followers_url":"https://api.github.com/users/gavmorrison/followers","following_url":"https://api.github.com/users/gavmorrison/following{/other_user}","gists_url":"https://api.github.com/users/gavmorrison/gists{/gist_id}","starred_url":"https://api.github.com/users/gavmorrison/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gavmorrison/subscriptions","organizations_url":"https://api.github.com/users/gavmorrison/orgs","repos_url":"https://api.github.com/users/gavmorrison/repos","events_url":"https://api.github.com/users/gavmorrison/events{/privacy}","received_events_url":"https://api.github.com/users/gavmorrison/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":628314330,"node_id":"MDU6TGFiZWw2MjgzMTQzMzA=","url":"https://api.github.com/repos/syncthing/syncthing/labels/frozen-due-to-age","name":"frozen-due-to-age","color":"eeeeee","default":false,"description":"Issues closed and untouched for a long time, together with being locked for discussion"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2014-10-21T11:02:42Z","updated_at":"2017-06-16T21:11:39Z","closed_at":"2014-10-21T11:41:25Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I have Windows x64 clients connecting to a pfSense firewall with UPnP enabled for this network segment that are unable to setup a port mapping since the 0.10.2 update. There have been no configuration changes made to the firewall since this was known to be working in 0.10.1. Console output from the initialisation of the the 0.10.1 and 0.10.2 clients shown below with STTRACE=upnp set.\n\n**0.10.1**\n\n```\n[monitor] 2014/10/21 11:25:57.633925 monitor.go:75: INFO: Starting syncthing\n[IQ53X] 2014/10/21 11:25:58.983001 main.go:337: INFO: syncthing v0.10.1 (go1.3.3 windows-amd64 default) jenkins@build.syncthing.net 2014-10-12 12:09:40 UTC\n[IQ53X] 2014/10/21 11:25:58.984001 main.go:338: INFO: My ID: IQ53XXU-\n[IQ53X] 2014/10/21 11:25:58.990002 main.go:367: INFO: Archiving a copy of old config file format\n[IQ53X] 2014/10/21 11:25:59.879052 main.go:557: INFO: Starting web GUI on http://127.0.0.1:8080/\n[IQ53X] 2014/10/21 11:26:01.018118 upnp.go:100: DEBUG: HTTP/1.1 200 OK\nCACHE-CONTROL: max-age=120\nST: urn:schemas-upnp-org:device:InternetGatewayDevice:1\nUSN: uuid:faac0521-771c-f003-b525-c48b0ff5165::urn:schemas-upnp-org:device:InternetGatewayDevice:1\nEXT:\nSERVER: FreeBSD/8.3-RELEASE-p14 UPnP/1.1 MiniUPnPd/1.8\nLOCATION: http://10.255.100.1:2189/rootDesc.xml\nOPT: \"http://schemas.upnp.org/upnp/1/0/\"; ns=01\n01-NLS: 1\nBOOTID.UPNP.ORG: 1\nCONFIGID.UPNP.ORG: 1337\n\n\n[IQ53X] 2014/10/21 11:26:01.026118 upnp.go:268: DEBUG: \"urn:schemas-upnp-org:service:WANIPConnection:1#AddPortMapping\"\n[IQ53X] 2014/10/21 11:26:01.026118 upnp.go:269: DEBUG: <?xml version=\"1.0\" ?>\n    <s:Envelope xmlns:s=\"http://schemas.xmlsoap.org/soap/envelope/\" s:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\">\n    <s:Body><u:AddPortMapping xmlns:u=\"urn:schemas-upnp-org:service:WANIPConnection:1\">\n    <NewRemoteHost></NewRemoteHost>\n    <NewExternalPort>56704</NewExternalPort>\n    <NewProtocol>TCP</NewProtocol>\n    <NewInternalPort>22000</NewInternalPort>\n    <NewInternalClient>10.255.100.11</NewInternalClient>\n    <NewEnabled>1</NewEnabled>\n    <NewPortMappingDescription>syncthing</NewPortMappingDescription>\n    <NewLeaseDuration>0</NewLeaseDuration>\n    </u:AddPortMapping>\n    </s:Body>\n    </s:Envelope>\n\n[IQ53X] 2014/10/21 11:26:01.030118 upnp.go:279: DEBUG: <?xml version=\"1.0\"?>\n<s:Envelope xmlns:s=\"http://schemas.xmlsoap.org/soap/envelope/\" s:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\"><s:Body><u:AddPortMappingResponse xmlns:u=\"urn:schemas-upnp-org:service:WANIPConnection:1\"/></s:Body></s:Envelope>\n\n[IQ53X] 2014/10/21 11:26:01.030118 main.go:669: INFO: Created UPnP port mapping - external port 56704\n[IQ53X] 2014/10/21 11:26:01.030118 main.go:990: INFO: Starting local discovery announcements\n[IQ53X] 2014/10/21 11:26:01.031118 discover.go:95: INFO: Local discovery over IPv6 unavailable\n[IQ53X] 2014/10/21 11:26:01.031118 main.go:995: INFO: Starting global discovery announcements\n```\n\n**0.10.2**\n\n```\n[monitor] 2014/10/21 11:27:37.147102 monitor.go:75: INFO: Starting syncthing\n[IQ53X] 2014/10/21 11:27:38.478179 main.go:352: INFO: syncthing v0.10.2 (go1.3.3 windows-amd64 default) jenkins@build.syncthing.net 2014-10-18 18:50:40 UTC\n[IQ53X] 2014/10/21 11:27:38.479179 main.go:353: INFO: My ID: IQ53XXU-\n[IQ53X] 2014/10/21 11:27:39.373230 main.go:580: INFO: Starting web GUI on http://127.0.0.1:8080/\n[IQ53X] 2014/10/21 11:27:40.486293 upnp.go:80: INFO: Starting UPnP discovery...\n[IQ53X] 2014/10/21 11:27:40.486293 upnp.go:129: DEBUG: Starting discovery of device type urn:schemas-upnp-org:device:InternetGatewayDevice:2...\n[IQ53X] 2014/10/21 11:27:40.486293 upnp.go:149: DEBUG: Sending search request for device type urn:schemas-upnp-org:device:InternetGatewayDevice:2...\n[IQ53X] 2014/10/21 11:27:40.486293 upnp.go:161: DEBUG: Listening for UPnP response for device type urn:schemas-upnp-org:device:InternetGatewayDevice:2...\n[IQ53X] 2014/10/21 11:27:40.487294 upnp.go:201: DEBUG: Handling UPnP response:\n\nHTTP/1.1 200 OK\nCACHE-CONTROL: max-age=120\nST: urn:schemas-upnp-org:device:InternetGatewayDevice:2\nUSN: uuid:faac0521-771c-f003-b525-c48b0ff5165::urn:schemas-upnp-org:device:InternetGatewayDevice:2\nEXT:\nSERVER: FreeBSD/8.3-RELEASE-p14 UPnP/1.1 MiniUPnPd/1.8\nLOCATION: http://10.255.100.1:2189/rootDesc.xml\nOPT: \"http://schemas.upnp.org/upnp/1/0/\"; ns=01\n01-NLS: 1\nBOOTID.UPNP.ORG: 1\nCONFIGID.UPNP.ORG: 1337\n\n\n[IQ53X] 2014/10/21 11:27:40.487294 upnp.go:239: INFO: Invalid IGD response: invalid device UUID faac0521-771c-f003-b525-c48b0ff5165\n[IQ53X] 2014/10/21 11:27:43.486465 upnp.go:191: DEBUG: Discovery for device type urn:schemas-upnp-org:device:InternetGatewayDevice:2 finished.\n[IQ53X] 2014/10/21 11:27:43.486465 upnp.go:129: DEBUG: Starting discovery of device type urn:schemas-upnp-org:device:InternetGatewayDevice:1...\n[IQ53X] 2014/10/21 11:27:43.486465 upnp.go:149: DEBUG: Sending search request for device type urn:schemas-upnp-org:device:InternetGatewayDevice:1...\n[IQ53X] 2014/10/21 11:27:43.486465 upnp.go:161: DEBUG: Listening for UPnP response for device type urn:schemas-upnp-org:device:InternetGatewayDevice:1...\n[IQ53X] 2014/10/21 11:27:43.487465 upnp.go:201: DEBUG: Handling UPnP response:\n\nHTTP/1.1 200 OK\nCACHE-CONTROL: max-age=120\nST: urn:schemas-upnp-org:device:InternetGatewayDevice:1\nUSN: uuid:faac0521-771c-f003-b525-c48b0ff5165::urn:schemas-upnp-org:device:InternetGatewayDevice:1\nEXT:\nSERVER: FreeBSD/8.3-RELEASE-p14 UPnP/1.1 MiniUPnPd/1.8\nLOCATION: http://10.255.100.1:2189/rootDesc.xml\nOPT: \"http://schemas.upnp.org/upnp/1/0/\"; ns=01\n01-NLS: 1\nBOOTID.UPNP.ORG: 1\nCONFIGID.UPNP.ORG: 1337\n\n\n[IQ53X] 2014/10/21 11:27:43.487465 upnp.go:239: INFO: Invalid IGD response: invalid device UUID faac0521-771c-f003-b525-c48b0ff5165\n[IQ53X] 2014/10/21 11:27:46.486637 upnp.go:191: DEBUG: Discovery for device type urn:schemas-upnp-org:device:InternetGatewayDevice:1 finished.\n[IQ53X] 2014/10/21 11:27:46.486637 upnp.go:107: INFO: UPnP discovery complete (found 0 devices).\n```\n","closed_by":{"login":"gavmorrison","id":3501679,"node_id":"MDQ6VXNlcjM1MDE2Nzk=","avatar_url":"https://avatars.githubusercontent.com/u/3501679?v=4","gravatar_id":"","url":"https://api.github.com/users/gavmorrison","html_url":"https://github.com/gavmorrison","followers_url":"https://api.github.com/users/gavmorrison/followers","following_url":"https://api.github.com/users/gavmorrison/following{/other_user}","gists_url":"https://api.github.com/users/gavmorrison/gists{/gist_id}","starred_url":"https://api.github.com/users/gavmorrison/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gavmorrison/subscriptions","organizations_url":"https://api.github.com/users/gavmorrison/orgs","repos_url":"https://api.github.com/users/gavmorrison/repos","events_url":"https://api.github.com/users/gavmorrison/events{/privacy}","received_events_url":"https://api.github.com/users/gavmorrison/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/syncthing/syncthing/issues/890/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/syncthing/syncthing/issues/890/timeline","performed_via_github_app":null,"state_reason":"completed"}