{"url":"https://api.github.com/repos/syncthing/syncthing/issues/5138","repository_url":"https://api.github.com/repos/syncthing/syncthing","labels_url":"https://api.github.com/repos/syncthing/syncthing/issues/5138/labels{/name}","comments_url":"https://api.github.com/repos/syncthing/syncthing/issues/5138/comments","events_url":"https://api.github.com/repos/syncthing/syncthing/issues/5138/events","html_url":"https://github.com/syncthing/syncthing/issues/5138","id":352399655,"node_id":"MDU6SXNzdWUzNTIzOTk2NTU=","number":5138,"title":"Rate limit can be very bursty","user":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":67767667,"node_id":"MDU6TGFiZWw2Nzc2NzY2Nw==","url":"https://api.github.com/repos/syncthing/syncthing/labels/enhancement","name":"enhancement","color":"0e8a16","default":true,"description":"New features or improvements of some kind, as opposed to a problem (bug)"},{"id":628314330,"node_id":"MDU6TGFiZWw2MjgzMTQzMzA=","url":"https://api.github.com/repos/syncthing/syncthing/labels/frozen-due-to-age","name":"frozen-due-to-age","color":"eeeeee","default":false,"description":"Issues closed and untouched for a long time, together with being locked for discussion"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/syncthing/syncthing/milestones/39","html_url":"https://github.com/syncthing/syncthing/milestone/39","labels_url":"https://api.github.com/repos/syncthing/syncthing/milestones/39/labels","id":4644179,"node_id":"MDk6TWlsZXN0b25lNDY0NDE3OQ==","number":39,"title":"v1.3.0","description":"","creator":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":25,"state":"closed","created_at":"2019-09-09T12:43:56Z","updated_at":"2019-10-01T05:38:21Z","due_on":"2019-10-01T07:00:00Z","closed_at":"2019-10-01T05:38:21Z"},"comments":5,"created_at":"2018-08-21T06:17:28Z","updated_at":"2020-09-04T07:02:35Z","closed_at":"2019-09-04T10:12:24Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Filing this to see if anyone thinks it's a problem...\r\n\r\nWe do rate limiting by delaying read/write operations until the amount of data in the read/write is allowed by the desired rate. The layer above this deals in messages. So at least for writes, a message will go out as a single write. Messages can be large, especially with large blocks. So, for example, a 100 KiB/s rate limit sending a 4 GiB file (4 MiB blocks) will result in one message every 40 seconds. That's 4 MiB sent infinitely fast, and then a long wait.\r\n\r\nIf the purpose of the rate limit is to avoid choking an ADSL link to avoid dropping VoIP packets (for example) this doesn't accomplish the desired effect at all.\r\n\r\nIf the purpose is just to limit the amount of data sent during any given hour or so, it's fine.\r\n\r\nSolving this would involve making the LimitedReader/Writer smarter about the amount of data in relation to the limit and potentially chopping up the operations into smaller reads/writes. ","closed_by":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/syncthing/syncthing/issues/5138/reactions","total_count":5,"+1":5,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/syncthing/syncthing/issues/5138/timeline","performed_via_github_app":null,"state_reason":"completed"}