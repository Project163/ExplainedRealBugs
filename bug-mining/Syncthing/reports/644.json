{"url":"https://api.github.com/repos/syncthing/syncthing/issues/4177","repository_url":"https://api.github.com/repos/syncthing/syncthing","labels_url":"https://api.github.com/repos/syncthing/syncthing/issues/4177/labels{/name}","comments_url":"https://api.github.com/repos/syncthing/syncthing/issues/4177/comments","events_url":"https://api.github.com/repos/syncthing/syncthing/issues/4177/events","html_url":"https://github.com/syncthing/syncthing/issues/4177","id":231851792,"node_id":"MDU6SXNzdWUyMzE4NTE3OTI=","number":4177,"title":"KCP: Data races in STUN stuff","user":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":67767665,"node_id":"MDU6TGFiZWw2Nzc2NzY2NQ==","url":"https://api.github.com/repos/syncthing/syncthing/labels/bug","name":"bug","color":"d93f0b","default":true,"description":"A problem with current functionality, as opposed to missing functionality (enhancement)"},{"id":628314330,"node_id":"MDU6TGFiZWw2MjgzMTQzMzA=","url":"https://api.github.com/repos/syncthing/syncthing/labels/frozen-due-to-age","name":"frozen-due-to-age","color":"eeeeee","default":false,"description":"Issues closed and untouched for a long time, together with being locked for discussion"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2017-05-28T07:18:44Z","updated_at":"2018-06-08T07:01:34Z","closed_at":"2017-06-07T08:17:07Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"```\r\n==================\r\nWARNING: DATA RACE\r\nWrite at 0x00c420fd6080 by goroutine 73:\r\n  github.com/syncthing/syncthing/lib/connections.(*kcpListener).stunRenewal()\r\n      /Users/jb/src/github.com/syncthing/syncthing/lib/connections/kcp_listen.go:230 +0xa20\r\n\r\nPrevious read at 0x00c420fd6080 by goroutine 123:\r\n  net/url.(*URL).String()\r\n      /usr/local/go/src/net/url/url.go:726 +0x98\r\n  github.com/syncthing/syncthing/lib/connections.urlsToStrings()\r\n      /Users/jb/src/github.com/syncthing/syncthing/lib/connections/service.go:626 +0xb6\r\n  github.com/syncthing/syncthing/lib/connections.(*Service).Status()\r\n      /Users/jb/src/github.com/syncthing/syncthing/lib/connections/service.go:569 +0x32e\r\n  main.(*apiService).getSystemStatus()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:899 +0x8f0\r\n  main.(*apiService).(main.getSystemStatus)-fm()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:262 +0x5f\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  net/http.(*ServeMux).ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:2238 +0xa2\r\n  main.getPostHandler.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:422 +0x167\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.metricsMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:494 +0x11b\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.noCacheMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:517 +0x1ef\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  net/http.(*ServeMux).ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:2238 +0xa2\r\n  main.csrfMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui_csrf.go:77 +0x34a\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.withDetailsMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:525 +0x17d\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.corsMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:485 +0x9a\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.debugMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:434 +0xcb\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  net/http.serverHandler.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:2568 +0xbc\r\n  net/http.(*conn).serve()\r\n      /usr/local/go/src/net/http/server.go:1825 +0x71a\r\n\r\nGoroutine 73 (running) created at:\r\n  github.com/syncthing/syncthing/lib/connections.(*kcpListener).Serve()\r\n      /Users/jb/src/github.com/syncthing/syncthing/lib/connections/kcp_listen.go:89 +0xc6f\r\n  github.com/syncthing/syncthing/vendor/github.com/thejerf/suture.(*Supervisor).runService.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/vendor/github.com/thejerf/suture/supervisor.go:454 +0x70\r\n\r\nGoroutine 123 (running) created at:\r\n  net/http.(*Server).Serve()\r\n      /usr/local/go/src/net/http/server.go:2668 +0x35f\r\n  main.(*apiService).Serve.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:369 +0x50\r\n==================\r\n==================\r\nWARNING: DATA RACE\r\nWrite at 0x00c420fd6090 by goroutine 73:\r\n  github.com/syncthing/syncthing/lib/connections.(*kcpListener).stunRenewal()\r\n      /Users/jb/src/github.com/syncthing/syncthing/lib/connections/kcp_listen.go:230 +0xa20\r\n\r\nPrevious read at 0x00c420fd6090 by goroutine 123:\r\n  net/url.(*URL).String()\r\n      /usr/local/go/src/net/url/url.go:730 +0xbf\r\n  github.com/syncthing/syncthing/lib/connections.urlsToStrings()\r\n      /Users/jb/src/github.com/syncthing/syncthing/lib/connections/service.go:626 +0xb6\r\n  github.com/syncthing/syncthing/lib/connections.(*Service).Status()\r\n      /Users/jb/src/github.com/syncthing/syncthing/lib/connections/service.go:569 +0x32e\r\n  main.(*apiService).getSystemStatus()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:899 +0x8f0\r\n  main.(*apiService).(main.getSystemStatus)-fm()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:262 +0x5f\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  net/http.(*ServeMux).ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:2238 +0xa2\r\n  main.getPostHandler.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:422 +0x167\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.metricsMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:494 +0x11b\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.noCacheMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:517 +0x1ef\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  net/http.(*ServeMux).ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:2238 +0xa2\r\n  main.csrfMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui_csrf.go:77 +0x34a\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.withDetailsMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:525 +0x17d\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.corsMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:485 +0x9a\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.debugMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:434 +0xcb\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  net/http.serverHandler.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:2568 +0xbc\r\n  net/http.(*conn).serve()\r\n      /usr/local/go/src/net/http/server.go:1825 +0x71a\r\n\r\nGoroutine 73 (running) created at:\r\n  github.com/syncthing/syncthing/lib/connections.(*kcpListener).Serve()\r\n      /Users/jb/src/github.com/syncthing/syncthing/lib/connections/kcp_listen.go:89 +0xc6f\r\n  github.com/syncthing/syncthing/vendor/github.com/thejerf/suture.(*Supervisor).runService.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/vendor/github.com/thejerf/suture/supervisor.go:454 +0x70\r\n\r\nGoroutine 123 (running) created at:\r\n  net/http.(*Server).Serve()\r\n      /usr/local/go/src/net/http/server.go:2668 +0x35f\r\n  main.(*apiService).Serve.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:369 +0x50\r\n==================\r\n==================\r\nWARNING: DATA RACE\r\nWrite at 0x00c420fd60a0 by goroutine 73:\r\n  github.com/syncthing/syncthing/lib/connections.(*kcpListener).stunRenewal()\r\n      /Users/jb/src/github.com/syncthing/syncthing/lib/connections/kcp_listen.go:230 +0xa20\r\n\r\nPrevious read at 0x00c420fd60a0 by goroutine 123:\r\n  net/url.(*URL).String()\r\n      /usr/local/go/src/net/url/url.go:735 +0x356\r\n  github.com/syncthing/syncthing/lib/connections.urlsToStrings()\r\n      /Users/jb/src/github.com/syncthing/syncthing/lib/connections/service.go:626 +0xb6\r\n  github.com/syncthing/syncthing/lib/connections.(*Service).Status()\r\n      /Users/jb/src/github.com/syncthing/syncthing/lib/connections/service.go:569 +0x32e\r\n  main.(*apiService).getSystemStatus()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:899 +0x8f0\r\n  main.(*apiService).(main.getSystemStatus)-fm()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:262 +0x5f\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  net/http.(*ServeMux).ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:2238 +0xa2\r\n  main.getPostHandler.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:422 +0x167\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.metricsMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:494 +0x11b\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.noCacheMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:517 +0x1ef\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  net/http.(*ServeMux).ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:2238 +0xa2\r\n  main.csrfMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui_csrf.go:77 +0x34a\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.withDetailsMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:525 +0x17d\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.corsMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:485 +0x9a\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.debugMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:434 +0xcb\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  net/http.serverHandler.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:2568 +0xbc\r\n  net/http.(*conn).serve()\r\n      /usr/local/go/src/net/http/server.go:1825 +0x71a\r\n\r\nGoroutine 73 (running) created at:\r\n  github.com/syncthing/syncthing/lib/connections.(*kcpListener).Serve()\r\n      /Users/jb/src/github.com/syncthing/syncthing/lib/connections/kcp_listen.go:89 +0xc6f\r\n  github.com/syncthing/syncthing/vendor/github.com/thejerf/suture.(*Supervisor).runService.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/vendor/github.com/thejerf/suture/supervisor.go:454 +0x70\r\n\r\nGoroutine 123 (running) created at:\r\n  net/http.(*Server).Serve()\r\n      /usr/local/go/src/net/http/server.go:2668 +0x35f\r\n  main.(*apiService).Serve.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:369 +0x50\r\n==================\r\n==================\r\nWARNING: DATA RACE\r\nWrite at 0x00c420fd60a8 by goroutine 73:\r\n  github.com/syncthing/syncthing/lib/connections.(*kcpListener).stunRenewal()\r\n      /Users/jb/src/github.com/syncthing/syncthing/lib/connections/kcp_listen.go:230 +0xa20\r\n\r\nPrevious read at 0x00c420fd60a8 by goroutine 123:\r\n  net/url.(*URL).String()\r\n      /usr/local/go/src/net/url/url.go:739 +0x375\r\n  github.com/syncthing/syncthing/lib/connections.urlsToStrings()\r\n      /Users/jb/src/github.com/syncthing/syncthing/lib/connections/service.go:626 +0xb6\r\n  github.com/syncthing/syncthing/lib/connections.(*Service).Status()\r\n      /Users/jb/src/github.com/syncthing/syncthing/lib/connections/service.go:569 +0x32e\r\n  main.(*apiService).getSystemStatus()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:899 +0x8f0\r\n  main.(*apiService).(main.getSystemStatus)-fm()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:262 +0x5f\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  net/http.(*ServeMux).ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:2238 +0xa2\r\n  main.getPostHandler.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:422 +0x167\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.metricsMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:494 +0x11b\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.noCacheMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:517 +0x1ef\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  net/http.(*ServeMux).ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:2238 +0xa2\r\n  main.csrfMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui_csrf.go:77 +0x34a\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.withDetailsMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:525 +0x17d\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.corsMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:485 +0x9a\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.debugMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:434 +0xcb\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  net/http.serverHandler.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:2568 +0xbc\r\n  net/http.(*conn).serve()\r\n      /usr/local/go/src/net/http/server.go:1825 +0x71a\r\n\r\nGoroutine 73 (running) created at:\r\n  github.com/syncthing/syncthing/lib/connections.(*kcpListener).Serve()\r\n      /Users/jb/src/github.com/syncthing/syncthing/lib/connections/kcp_listen.go:89 +0xc6f\r\n  github.com/syncthing/syncthing/vendor/github.com/thejerf/suture.(*Supervisor).runService.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/vendor/github.com/thejerf/suture/supervisor.go:454 +0x70\r\n\r\nGoroutine 123 (running) created at:\r\n  net/http.(*Server).Serve()\r\n      /usr/local/go/src/net/http/server.go:2668 +0x35f\r\n  main.(*apiService).Serve.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:369 +0x50\r\n==================\r\n==================\r\nWARNING: DATA RACE\r\nWrite at 0x00c420fd60b8 by goroutine 73:\r\n  github.com/syncthing/syncthing/lib/connections.(*kcpListener).stunRenewal()\r\n      /Users/jb/src/github.com/syncthing/syncthing/lib/connections/kcp_listen.go:230 +0xa20\r\n\r\nPrevious read at 0x00c420fd60b8 by goroutine 123:\r\n  net/url.(*URL).EscapedPath()\r\n      /usr/local/go/src/net/url/url.go:656 +0x6f\r\n  net/url.(*URL).String()\r\n      /usr/local/go/src/net/url/url.go:743 +0x394\r\n  github.com/syncthing/syncthing/lib/connections.urlsToStrings()\r\n      /Users/jb/src/github.com/syncthing/syncthing/lib/connections/service.go:626 +0xb6\r\n  github.com/syncthing/syncthing/lib/connections.(*Service).Status()\r\n      /Users/jb/src/github.com/syncthing/syncthing/lib/connections/service.go:569 +0x32e\r\n  main.(*apiService).getSystemStatus()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:899 +0x8f0\r\n  main.(*apiService).(main.getSystemStatus)-fm()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:262 +0x5f\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  net/http.(*ServeMux).ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:2238 +0xa2\r\n  main.getPostHandler.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:422 +0x167\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.metricsMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:494 +0x11b\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.noCacheMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:517 +0x1ef\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  net/http.(*ServeMux).ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:2238 +0xa2\r\n  main.csrfMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui_csrf.go:77 +0x34a\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.withDetailsMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:525 +0x17d\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.corsMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:485 +0x9a\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.debugMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:434 +0xcb\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  net/http.serverHandler.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:2568 +0xbc\r\n  net/http.(*conn).serve()\r\n      /usr/local/go/src/net/http/server.go:1825 +0x71a\r\n\r\nGoroutine 73 (running) created at:\r\n  github.com/syncthing/syncthing/lib/connections.(*kcpListener).Serve()\r\n      /Users/jb/src/github.com/syncthing/syncthing/lib/connections/kcp_listen.go:89 +0xc6f\r\n  github.com/syncthing/syncthing/vendor/github.com/thejerf/suture.(*Supervisor).runService.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/vendor/github.com/thejerf/suture/supervisor.go:454 +0x70\r\n\r\nGoroutine 123 (running) created at:\r\n  net/http.(*Server).Serve()\r\n      /usr/local/go/src/net/http/server.go:2668 +0x35f\r\n  main.(*apiService).Serve.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:369 +0x50\r\n==================\r\n==================\r\nWARNING: DATA RACE\r\nWrite at 0x00c420fd60c8 by goroutine 73:\r\n  github.com/syncthing/syncthing/lib/connections.(*kcpListener).stunRenewal()\r\n      /Users/jb/src/github.com/syncthing/syncthing/lib/connections/kcp_listen.go:230 +0xa20\r\n\r\nPrevious read at 0x00c420fd60c8 by goroutine 123:\r\n  net/url.(*URL).EscapedPath()\r\n      /usr/local/go/src/net/url/url.go:650 +0x48\r\n  net/url.(*URL).String()\r\n      /usr/local/go/src/net/url/url.go:743 +0x394\r\n  github.com/syncthing/syncthing/lib/connections.urlsToStrings()\r\n      /Users/jb/src/github.com/syncthing/syncthing/lib/connections/service.go:626 +0xb6\r\n  github.com/syncthing/syncthing/lib/connections.(*Service).Status()\r\n      /Users/jb/src/github.com/syncthing/syncthing/lib/connections/service.go:569 +0x32e\r\n  main.(*apiService).getSystemStatus()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:899 +0x8f0\r\n  main.(*apiService).(main.getSystemStatus)-fm()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:262 +0x5f\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  net/http.(*ServeMux).ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:2238 +0xa2\r\n  main.getPostHandler.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:422 +0x167\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.metricsMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:494 +0x11b\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.noCacheMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:517 +0x1ef\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  net/http.(*ServeMux).ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:2238 +0xa2\r\n  main.csrfMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui_csrf.go:77 +0x34a\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.withDetailsMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:525 +0x17d\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.corsMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:485 +0x9a\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.debugMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:434 +0xcb\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  net/http.serverHandler.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:2568 +0xbc\r\n  net/http.(*conn).serve()\r\n      /usr/local/go/src/net/http/server.go:1825 +0x71a\r\n\r\nGoroutine 73 (running) created at:\r\n  github.com/syncthing/syncthing/lib/connections.(*kcpListener).Serve()\r\n      /Users/jb/src/github.com/syncthing/syncthing/lib/connections/kcp_listen.go:89 +0xc6f\r\n  github.com/syncthing/syncthing/vendor/github.com/thejerf/suture.(*Supervisor).runService.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/vendor/github.com/thejerf/suture/supervisor.go:454 +0x70\r\n\r\nGoroutine 123 (running) created at:\r\n  net/http.(*Server).Serve()\r\n      /usr/local/go/src/net/http/server.go:2668 +0x35f\r\n  main.(*apiService).Serve.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:369 +0x50\r\n==================\r\n==================\r\nWARNING: DATA RACE\r\nWrite at 0x00c420fd60d8 by goroutine 73:\r\n  github.com/syncthing/syncthing/lib/connections.(*kcpListener).stunRenewal()\r\n      /Users/jb/src/github.com/syncthing/syncthing/lib/connections/kcp_listen.go:230 +0xa20\r\n\r\nPrevious read at 0x00c420fd60d8 by goroutine 123:\r\n  net/url.(*URL).String()\r\n      /usr/local/go/src/net/url/url.go:760 +0x116\r\n  github.com/syncthing/syncthing/lib/connections.urlsToStrings()\r\n      /Users/jb/src/github.com/syncthing/syncthing/lib/connections/service.go:626 +0xb6\r\n  github.com/syncthing/syncthing/lib/connections.(*Service).Status()\r\n      /Users/jb/src/github.com/syncthing/syncthing/lib/connections/service.go:569 +0x32e\r\n  main.(*apiService).getSystemStatus()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:899 +0x8f0\r\n  main.(*apiService).(main.getSystemStatus)-fm()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:262 +0x5f\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  net/http.(*ServeMux).ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:2238 +0xa2\r\n  main.getPostHandler.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:422 +0x167\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.metricsMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:494 +0x11b\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.noCacheMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:517 +0x1ef\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  net/http.(*ServeMux).ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:2238 +0xa2\r\n  main.csrfMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui_csrf.go:77 +0x34a\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.withDetailsMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:525 +0x17d\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.corsMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:485 +0x9a\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.debugMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:434 +0xcb\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  net/http.serverHandler.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:2568 +0xbc\r\n  net/http.(*conn).serve()\r\n      /usr/local/go/src/net/http/server.go:1825 +0x71a\r\n\r\nGoroutine 73 (running) created at:\r\n  github.com/syncthing/syncthing/lib/connections.(*kcpListener).Serve()\r\n      /Users/jb/src/github.com/syncthing/syncthing/lib/connections/kcp_listen.go:89 +0xc6f\r\n  github.com/syncthing/syncthing/vendor/github.com/thejerf/suture.(*Supervisor).runService.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/vendor/github.com/thejerf/suture/supervisor.go:454 +0x70\r\n\r\nGoroutine 123 (running) created at:\r\n  net/http.(*Server).Serve()\r\n      /usr/local/go/src/net/http/server.go:2668 +0x35f\r\n  main.(*apiService).Serve.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:369 +0x50\r\n==================\r\n==================\r\nWARNING: DATA RACE\r\nWrite at 0x00c420fd60e0 by goroutine 73:\r\n  github.com/syncthing/syncthing/lib/connections.(*kcpListener).stunRenewal()\r\n      /Users/jb/src/github.com/syncthing/syncthing/lib/connections/kcp_listen.go:230 +0xa20\r\n\r\nPrevious read at 0x00c420fd60e0 by goroutine 123:\r\n  net/url.(*URL).String()\r\n      /usr/local/go/src/net/url/url.go:760 +0x2ec\r\n  github.com/syncthing/syncthing/lib/connections.urlsToStrings()\r\n      /Users/jb/src/github.com/syncthing/syncthing/lib/connections/service.go:626 +0xb6\r\n  github.com/syncthing/syncthing/lib/connections.(*Service).Status()\r\n      /Users/jb/src/github.com/syncthing/syncthing/lib/connections/service.go:569 +0x32e\r\n  main.(*apiService).getSystemStatus()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:899 +0x8f0\r\n  main.(*apiService).(main.getSystemStatus)-fm()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:262 +0x5f\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  net/http.(*ServeMux).ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:2238 +0xa2\r\n  main.getPostHandler.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:422 +0x167\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.metricsMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:494 +0x11b\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.noCacheMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:517 +0x1ef\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  net/http.(*ServeMux).ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:2238 +0xa2\r\n  main.csrfMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui_csrf.go:77 +0x34a\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.withDetailsMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:525 +0x17d\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.corsMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:485 +0x9a\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.debugMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:434 +0xcb\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  net/http.serverHandler.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:2568 +0xbc\r\n  net/http.(*conn).serve()\r\n      /usr/local/go/src/net/http/server.go:1825 +0x71a\r\n\r\nGoroutine 73 (running) created at:\r\n  github.com/syncthing/syncthing/lib/connections.(*kcpListener).Serve()\r\n      /Users/jb/src/github.com/syncthing/syncthing/lib/connections/kcp_listen.go:89 +0xc6f\r\n  github.com/syncthing/syncthing/vendor/github.com/thejerf/suture.(*Supervisor).runService.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/vendor/github.com/thejerf/suture/supervisor.go:454 +0x70\r\n\r\nGoroutine 123 (running) created at:\r\n  net/http.(*Server).Serve()\r\n      /usr/local/go/src/net/http/server.go:2668 +0x35f\r\n  main.(*apiService).Serve.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:369 +0x50\r\n==================\r\n==================\r\nWARNING: DATA RACE\r\nWrite at 0x00c420fd60f0 by goroutine 73:\r\n  github.com/syncthing/syncthing/lib/connections.(*kcpListener).stunRenewal()\r\n      /Users/jb/src/github.com/syncthing/syncthing/lib/connections/kcp_listen.go:230 +0xa20\r\n\r\nPrevious read at 0x00c420fd60f0 by goroutine 123:\r\n  net/url.(*URL).String()\r\n      /usr/local/go/src/net/url/url.go:764 +0x18b\r\n  github.com/syncthing/syncthing/lib/connections.urlsToStrings()\r\n      /Users/jb/src/github.com/syncthing/syncthing/lib/connections/service.go:626 +0xb6\r\n  github.com/syncthing/syncthing/lib/connections.(*Service).Status()\r\n      /Users/jb/src/github.com/syncthing/syncthing/lib/connections/service.go:569 +0x32e\r\n  main.(*apiService).getSystemStatus()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:899 +0x8f0\r\n  main.(*apiService).(main.getSystemStatus)-fm()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:262 +0x5f\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  net/http.(*ServeMux).ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:2238 +0xa2\r\n  main.getPostHandler.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:422 +0x167\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.metricsMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:494 +0x11b\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.noCacheMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:517 +0x1ef\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  net/http.(*ServeMux).ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:2238 +0xa2\r\n  main.csrfMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui_csrf.go:77 +0x34a\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.withDetailsMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:525 +0x17d\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.corsMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:485 +0x9a\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  main.debugMiddleware.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:434 +0xcb\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:1942 +0x51\r\n  net/http.serverHandler.ServeHTTP()\r\n      /usr/local/go/src/net/http/server.go:2568 +0xbc\r\n  net/http.(*conn).serve()\r\n      /usr/local/go/src/net/http/server.go:1825 +0x71a\r\n\r\nGoroutine 73 (running) created at:\r\n  github.com/syncthing/syncthing/lib/connections.(*kcpListener).Serve()\r\n      /Users/jb/src/github.com/syncthing/syncthing/lib/connections/kcp_listen.go:89 +0xc6f\r\n  github.com/syncthing/syncthing/vendor/github.com/thejerf/suture.(*Supervisor).runService.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/vendor/github.com/thejerf/suture/supervisor.go:454 +0x70\r\n\r\nGoroutine 123 (running) created at:\r\n  net/http.(*Server).Serve()\r\n      /usr/local/go/src/net/http/server.go:2668 +0x35f\r\n  main.(*apiService).Serve.func1()\r\n      /Users/jb/src/github.com/syncthing/syncthing/cmd/syncthing/gui.go:369 +0x50\r\n==================\r\n```","closed_by":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/syncthing/syncthing/issues/4177/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/syncthing/syncthing/issues/4177/timeline","performed_via_github_app":null,"state_reason":"completed"}