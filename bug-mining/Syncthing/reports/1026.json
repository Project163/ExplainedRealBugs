{"url":"https://api.github.com/repos/syncthing/syncthing/issues/5952","repository_url":"https://api.github.com/repos/syncthing/syncthing","labels_url":"https://api.github.com/repos/syncthing/syncthing/issues/5952/labels{/name}","comments_url":"https://api.github.com/repos/syncthing/syncthing/issues/5952/comments","events_url":"https://api.github.com/repos/syncthing/syncthing/issues/5952/events","html_url":"https://github.com/syncthing/syncthing/issues/5952","id":480321243,"node_id":"MDU6SXNzdWU0ODAzMjEyNDM=","number":5952,"title":"panic: Should never get a deleted file as needed when we don't have it","user":{"login":"syncthing-sentry[bot]","id":50799100,"node_id":"MDM6Qm90NTA3OTkxMDA=","avatar_url":"https://avatars.githubusercontent.com/u/7628018?v=4","gravatar_id":"","url":"https://api.github.com/users/syncthing-sentry%5Bbot%5D","html_url":"https://github.com/apps/syncthing-sentry","followers_url":"https://api.github.com/users/syncthing-sentry%5Bbot%5D/followers","following_url":"https://api.github.com/users/syncthing-sentry%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/syncthing-sentry%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/syncthing-sentry%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/syncthing-sentry%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/syncthing-sentry%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/syncthing-sentry%5Bbot%5D/repos","events_url":"https://api.github.com/users/syncthing-sentry%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/syncthing-sentry%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"labels":[{"id":67767665,"node_id":"MDU6TGFiZWw2Nzc2NzY2NQ==","url":"https://api.github.com/repos/syncthing/syncthing/labels/bug","name":"bug","color":"d93f0b","default":true,"description":"A problem with current functionality, as opposed to missing functionality (enhancement)"},{"id":628314330,"node_id":"MDU6TGFiZWw2MjgzMTQzMzA=","url":"https://api.github.com/repos/syncthing/syncthing/labels/frozen-due-to-age","name":"frozen-due-to-age","color":"eeeeee","default":false,"description":"Issues closed and untouched for a long time, together with being locked for discussion"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/syncthing/syncthing/milestones/44","html_url":"https://github.com/syncthing/syncthing/milestone/44","labels_url":"https://api.github.com/repos/syncthing/syncthing/milestones/44/labels","id":5009490,"node_id":"MDk6TWlsZXN0b25lNTAwOTQ5MA==","number":44,"title":"v1.4.0","description":"Important changes:\r\n\r\n- A new config option maxConcurrentIncomingRequestKiB has been added to limit the maximum amount of request data being concurrently processed due to incoming requests. This limits Syncthing's peak RAM usage when there are many connected devices all requesting file data. The default is 256 MiB.\r\n\r\n- The config option maxConcurrentScans has been removed and replaced a new config option maxFolderConcurrency. In addition to just limiting concurrent scans it now also limits concurrent sync operations. The default is the number of available CPU threads (\"GOMAXPROCS\").\r\n\r\n- Syncthing now always runs the monitor process, which previously was disabled with -no-restart. This facilitates crash reporting and makes logging behave more consistently. The observed behavior with -no-restart should be the same as before but the internals differ.\r\n\r\n- The database schema has been improved and will result in a migration plus compaction at first startup after the upgrade.\r\n","creator":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":53,"state":"closed","created_at":"2020-01-16T06:48:10Z","updated_at":"2020-03-17T06:20:59Z","due_on":"2020-03-17T07:00:00Z","closed_at":"2020-03-17T06:20:59Z"},"comments":0,"created_at":"2019-08-13T19:13:04Z","updated_at":"2021-01-21T07:02:57Z","closed_at":"2020-01-21T17:23:11Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Sentry Issue: [SYNCTHING-2E](https://sentry.syncthing.net/syncthing/syncthing/issues/94/?referrer=github_integration)\n\n```\nStacktrace (most recent call first):\n\n  File \"/opt/tcagent/syncthing-3-work/174e136266f8a219/lib/model/folder_sendonly.go\", line 69, in func1\n    panic(\"Should never get a deleted file as needed when we don't have it\")\n  File \"/opt/tcagent/syncthing-3-work/174e136266f8a219/lib/db/set.go\", line 313, in func1\n    return fn(f)\n  File \"/opt/tcagent/syncthing-3-work/174e136266f8a219/lib/db/instance.go\", line 398, in withNeedLocal\n    if !fn(f) {\n  File \"/opt/tcagent/syncthing-3-work/174e136266f8a219/lib/db/instance.go\", line 319, in withNeed\n    db.withNeedLocal(folder, truncate, fn)\n  File \"/opt/tcagent/syncthing-3-work/174e136266f8a219/lib/db/set.go\", line 157, in WithNeed\n    s.db.withNeed([]byte(s.folder), device[:], false, nativeFileIterator(fn))\n  File \"/opt/tcagent/syncthing-3-work/174e136266f8a219/lib/model/folder_sendonly.go\", line 50, in pull\n    f.fset.WithNeed(protocol.LocalDeviceID, func(intf db.FileIntf) bool {\n  File \"/opt/tcagent/syncthing-3-work/174e136266f8a219/lib/model/folder.go\", line 137, in func2\n    if f.puller.pull() {\n  File \"/opt/tcagent/syncthing-3-work/174e136266f8a219/lib/model/folder.go\", line 163, in Serve\n    pull()\n  File \"/opt/tcagent/syncthing-3-work/pkg/mod/github.com/thejerf/suture@v3.0.2+incompatible/supervisor.go\", line 600, in func1\n\npanic: Should never get a deleted file as needed when we don't have it\n```\n\n\n\nThis implies inconsistencies in the model somehow?","closed_by":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/syncthing/syncthing/issues/5952/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/syncthing/syncthing/issues/5952/timeline","performed_via_github_app":null,"state_reason":"completed"}