{"url":"https://api.github.com/repos/syncthing/syncthing/issues/7076","repository_url":"https://api.github.com/repos/syncthing/syncthing","labels_url":"https://api.github.com/repos/syncthing/syncthing/issues/7076/labels{/name}","comments_url":"https://api.github.com/repos/syncthing/syncthing/issues/7076/comments","events_url":"https://api.github.com/repos/syncthing/syncthing/issues/7076/events","html_url":"https://github.com/syncthing/syncthing/issues/7076","id":733780419,"node_id":"MDU6SXNzdWU3MzM3ODA0MTk=","number":7076,"title":"File not detected due to watching reporting events on old, deleted path","user":{"login":"BeayemX","id":3453076,"node_id":"MDQ6VXNlcjM0NTMwNzY=","avatar_url":"https://avatars.githubusercontent.com/u/3453076?v=4","gravatar_id":"","url":"https://api.github.com/users/BeayemX","html_url":"https://github.com/BeayemX","followers_url":"https://api.github.com/users/BeayemX/followers","following_url":"https://api.github.com/users/BeayemX/following{/other_user}","gists_url":"https://api.github.com/users/BeayemX/gists{/gist_id}","starred_url":"https://api.github.com/users/BeayemX/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BeayemX/subscriptions","organizations_url":"https://api.github.com/users/BeayemX/orgs","repos_url":"https://api.github.com/users/BeayemX/repos","events_url":"https://api.github.com/users/BeayemX/events{/privacy}","received_events_url":"https://api.github.com/users/BeayemX/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":67767665,"node_id":"MDU6TGFiZWw2Nzc2NzY2NQ==","url":"https://api.github.com/repos/syncthing/syncthing/labels/bug","name":"bug","color":"d93f0b","default":true,"description":"A problem with current functionality, as opposed to missing functionality (enhancement)"},{"id":628314330,"node_id":"MDU6TGFiZWw2MjgzMTQzMzA=","url":"https://api.github.com/repos/syncthing/syncthing/labels/frozen-due-to-age","name":"frozen-due-to-age","color":"eeeeee","default":false,"description":"Issues closed and untouched for a long time, together with being locked for discussion"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/syncthing/syncthing/milestones/59","html_url":"https://github.com/syncthing/syncthing/milestone/59","labels_url":"https://api.github.com/repos/syncthing/syncthing/milestones/59/labels","id":6215237,"node_id":"MDk6TWlsZXN0b25lNjIxNTIzNw==","number":59,"title":"v1.13.0","description":"This release adds configuration options for min/max connections (see https://docs.syncthing.net/advanced/option-connection-limits.html) and moves the storage of pending devices/folders from the config to the database (see https://docs.syncthing.net/dev/rest.html#cluster-endpoints).","creator":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":45,"state":"closed","created_at":"2020-12-15T13:04:43Z","updated_at":"2021-02-02T16:05:22Z","due_on":"2021-02-02T08:00:00Z","closed_at":"2021-02-02T16:05:22Z"},"comments":7,"created_at":"2020-10-31T18:25:31Z","updated_at":"2021-12-11T07:02:23Z","closed_at":"2020-12-10T14:43:16Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Does your log mention database corruption?\r\nNo\r\n\r\n---\r\n\r\nWhen trying to reproduce the issue #7032 I saw that sometimes folders would not sync.\r\n\r\n### The setup\r\n\r\nFirst system\r\n+ Linux Mint 20 ulyana\r\n+ syncthing v1.10.0 \"Fermium Flea\" (go1.15.2 linux-amd64) deb@build.syncthing.net 2020-09-15 17:38:23 UTC [noupgrade]\r\n\r\nSecond system\r\n+ Ubuntu 18.04 bionic\r\n+ syncthing v1.10.0 \"Fermium Flea\" (go1.15.2 linux-amd64) deb@build.syncthing.net 2020-09-15 17:38:23 UTC [noupgrade]\r\n\r\n### Steps taken\r\n\r\n1. Create a new folder in the default sync directory with the linux file browser 'nemo'.\r\n1. Initially the folder is named \"Untitled folder\".\r\n1. Accept the name by pressing enter.\r\n1. Wait for the folder to be synchronized to the second computer.\r\n1. Rename the folder on the first computer to `tmp`.\r\n1. Wait for the rename to be synced to the second computer.\r\n1. Create a new folder inside `tmp` via Nemo on the first computer.\r\n1. Rename it immediately to `a`.\r\n1. Before the folder is created on the second system create a file inside the folder `a`.\r\n1. The file is initially named `Untitled Document`.\r\n1. Rename the file to `a`.\r\n1. The folder `a` and the document inside it called `a` are never synced to the second system.\r\n\r\n### Logs\r\nI activated `model` in the debug facilities on both systems.\r\n\r\n#### System 1\r\n```\r\n2020-10-31 18:56:47 Enabled debug data for \"model\"\r\n2020-10-31 18:56:51 Established secure connection to 3UVYIBI-RE7S5IJ-G4I7COG-4KXQVYR-IFEL3LA-SWRFXGL-CEOKHKR-DFVYNQQ at 192.168.1.231:22000-192.168.1.43:22000/tcp-client/TLS1.3-TLS_AES_128_GCM_SHA256\r\n2020-10-31 18:56:51 Device 3UVYIBI-RE7S5IJ-G4I7COG-4KXQVYR-IFEL3LA-SWRFXGL-CEOKHKR-DFVYNQQ client is \"syncthing v1.10.0\" named \"Pixel 3\" at 192.168.1.231:22000-192.168.1.43:22000/tcp-client/TLS1.3-TLS_AES_128_GCM_SHA256\r\n2020-10-31 18:56:51 Device 3UVYIBI-RE7S5IJ-G4I7COG-4KXQVYR-IFEL3LA-SWRFXGL-CEOKHKR-DFVYNQQ folder \"Default Folder\" (default) is delta index compatible (mlv=2267)\r\n2020-10-31 18:56:51 Starting indexSender for default to  at 192.168.1.231:22000-192.168.1.43:22000/tcp-client/TLS1.3-TLS_AES_128_GCM_SHA256 (slv=2267)\r\n2020-10-31 18:56:51 progress emitter: bytes completed for default: 0\r\n2020-10-31 18:56:51 model@0xc000103800 Completion(ZRRNJRT-X4QQKN5-6FVNXTN-OG2YLBY-VBYO55O-2Z6NQGQ-BRCD5MT-QDZUQAA, \"default\"): map[completion:100 globalBytes:1579109578 globalItems:599 needBytes:0 needDeletes:0 needItems:0 sequence:2217]\r\n2020-10-31 18:56:51 model@0xc000103800 Completion(3UVYIBI-RE7S5IJ-G4I7COG-4KXQVYR-IFEL3LA-SWRFXGL-CEOKHKR-DFVYNQQ, \"default\"): map[completion:100 globalBytes:1579109578 globalItems:599 needBytes:0 needDeletes:0 needItems:0 sequence:2093]\r\n2020-10-31 18:57:11 Sent usage report (version 3)\r\n2020-10-31 18:57:39 Connection to 3UVYIBI-RE7S5IJ-G4I7COG-4KXQVYR-IFEL3LA-SWRFXGL-CEOKHKR-DFVYNQQ at 192.168.1.231:22000-192.168.1.43:22000/tcp-client/TLS1.3-TLS_AES_128_GCM_SHA256 closed: reading length: read tcp 192.168.1.231:22000->192.168.1.43:22000: read: connection reset by peer\r\n2020-10-31 18:57:39 Exiting indexSender for default to  at 192.168.1.231:22000-192.168.1.43:22000/tcp-client/TLS1.3-TLS_AES_128_GCM_SHA256: <nil>\r\n2020-10-31 18:58:16 sendreceive/default@0xc0002c2380 Scan due to watcher\r\n2020-10-31 18:58:16 indexSender@0xc0003f9730 for default to  at 192.168.1.231:22000-116.203.108.209:22000/tcp-client/TLS1.3-TLS_AES_128_GCM_SHA256: Sending 1 files (<85 bytes)\r\n2020-10-31 18:58:16 Index update (in): ZRRNJRT-X4QQKN5-6FVNXTN-OG2YLBY-VBYO55O-2Z6NQGQ-BRCD5MT-QDZUQAA / \"default\": 1 files\r\n2020-10-31 18:58:17 progress emitter: bytes completed for default: 0\r\n2020-10-31 18:58:17 model@0xc000103800 Completion(ZRRNJRT-X4QQKN5-6FVNXTN-OG2YLBY-VBYO55O-2Z6NQGQ-BRCD5MT-QDZUQAA, \"default\"): map[completion:100 globalBytes:1579109706 globalItems:600 needBytes:0 needDeletes:0 needItems:0 sequence:2218]\r\n2020-10-31 18:58:56 sendreceive/default@0xc0002c2380 Scan due to watcher\r\n2020-10-31 18:58:56 sendreceive/default@0xc0002c2380 Scan due to watcher\r\n2020-10-31 18:58:56 indexSender@0xc0003f9730 for default to  at 192.168.1.231:22000-116.203.108.209:22000/tcp-client/TLS1.3-TLS_AES_128_GCM_SHA256: Sending 1 files (<74 bytes)\r\n2020-10-31 18:58:56 marking file as deleted Directory{Name:\"Untitled Folder\", Sequence:2268, Permissions:0775, ModTime:2020-10-31 18:58:56.51704532 +0100 CET, Version:{[{BCROSJ5 1604167136} {FPE4P7T 1603469496}]}, VersionHash:, Deleted:true, Invalid:false, LocalFlags:0x0, NoPermissions:false}\r\n2020-10-31 18:58:56 Index update (in): ZRRNJRT-X4QQKN5-6FVNXTN-OG2YLBY-VBYO55O-2Z6NQGQ-BRCD5MT-QDZUQAA / \"default\": 1 files\r\n2020-10-31 18:58:57 indexSender@0xc0003f9730 for default to  at 192.168.1.231:22000-116.203.108.209:22000/tcp-client/TLS1.3-TLS_AES_128_GCM_SHA256: Sending 1 files (<87 bytes)\r\n2020-10-31 18:58:57 Index update (in): ZRRNJRT-X4QQKN5-6FVNXTN-OG2YLBY-VBYO55O-2Z6NQGQ-BRCD5MT-QDZUQAA / \"default\": 1 files\r\n2020-10-31 18:58:57 progress emitter: bytes completed for default: 0\r\n2020-10-31 18:58:57 model@0xc000103800 Completion(ZRRNJRT-X4QQKN5-6FVNXTN-OG2YLBY-VBYO55O-2Z6NQGQ-BRCD5MT-QDZUQAA, \"default\"): map[completion:100 globalBytes:1579109706 globalItems:600 needBytes:0 needDeletes:0 needItems:0 sequence:2220]\r\n2020-10-31 18:59:19 sendreceive/default@0xc0002c2380 Scan due to watcher\r\n2020-10-31 18:59:19 sendreceive/default@0xc0002c2380 Scan due to watcher\r\n2020-10-31 19:00:25 Established secure connection to 3UVYIBI-RE7S5IJ-G4I7COG-4KXQVYR-IFEL3LA-SWRFXGL-CEOKHKR-DFVYNQQ at 192.168.1.231:22000-192.168.1.43:22000/tcp-client/TLS1.3-TLS_AES_128_GCM_SHA256\r\n2020-10-31 19:00:25 Device 3UVYIBI-RE7S5IJ-G4I7COG-4KXQVYR-IFEL3LA-SWRFXGL-CEOKHKR-DFVYNQQ client is \"syncthing v1.10.0\" named \"Pixel 3\" at 192.168.1.231:22000-192.168.1.43:22000/tcp-client/TLS1.3-TLS_AES_128_GCM_SHA256\r\n2020-10-31 19:00:27 progress emitter: bytes completed for default: 0\r\n2020-10-31 19:00:27 model@0xc000103800 Completion(ZRRNJRT-X4QQKN5-6FVNXTN-OG2YLBY-VBYO55O-2Z6NQGQ-BRCD5MT-QDZUQAA, \"default\"): map[completion:100 globalBytes:1579109706 globalItems:600 needBytes:0 needDeletes:0 needItems:0 sequence:2220]\r\n2020-10-31 19:00:27 model@0xc000103800 Completion(3UVYIBI-RE7S5IJ-G4I7COG-4KXQVYR-IFEL3LA-SWRFXGL-CEOKHKR-DFVYNQQ, \"default\"): map[completion:99.99999189416673 globalBytes:1579109706 globalItems:600 needBytes:128 needDeletes:1 needItems:1 sequence:2093]\r\n```\r\n\r\n#### System 2\r\n```\r\n2020-10-31 18:57:52 Enabled debug data for \"model\"\r\n2020-10-31 18:58:16 Index update (in): BCROSJ5-2UBPL5A-M6XI2YN-Z4GKL76-4TBBPSA-47VDXPC-NJLUTOT-5UNJJAH / \"default\": 1 files\r\n2020-10-31 18:58:16 sendreceive/default@0xc00008a000 pulling\r\n2020-10-31 18:58:16 sendreceive/default@0xc00008a000 copiers: 2 pullerPendingKiB: 32768\r\n2020-10-31 18:58:16 sendreceive/default@0xc00008a000 Handling directory Untitled Folder\r\n2020-10-31 18:58:16 sendreceive/default@0xc00008a000 parent not missing Untitled Folder\r\n2020-10-31 18:58:16 need dir\r\n\tDirectory{Name:\"Untitled Folder\", Sequence:2268, Permissions:0775, ModTime:2020-10-31 18:58:06.51704532 +0100 CET, Version:{[{BCROSJ5 1604167096} {FPE4P7T 1603469496}]}, VersionHash:, Deleted:false, Invalid:false, LocalFlags:0x0, NoPermissions:false}\r\n\tDirectory{Name:\"Untitled Folder\", Sequence:2209, Permissions:0775, ModTime:2020-10-30 18:23:19.557839089 +0100 CET, Version:{[{BCROSJ5 1604078599} {FPE4P7T 1603469496}]}, VersionHash:, Deleted:true, Invalid:false, LocalFlags:0x0, NoPermissions:false}\r\n2020-10-31 18:58:16 sendreceive/default@0xc00008a000 changed 1 on try 1\r\n2020-10-31 18:58:16 sendreceive/default@0xc00008a000 copiers: 2 pullerPendingKiB: 32768\r\n2020-10-31 18:58:16 sendreceive/default@0xc00008a000 changed 0 on try 2\r\n2020-10-31 18:58:16 progress emitter: bytes completed for default: 0\r\n2020-10-31 18:58:16 model@0xc000001980 Completion(BCROSJ5-2UBPL5A-M6XI2YN-Z4GKL76-4TBBPSA-47VDXPC-NJLUTOT-5UNJJAH, \"default\"): map[completion:100 globalBytes:1579109706 globalItems:600 needBytes:0 needDeletes:0 needItems:0 sequence:2268]\r\n2020-10-31 18:58:16 indexSender@0xc0024ce230 for default to  at 116.203.108.209:22000-82.218.192.199:22002/tcp-server/TLS1.3-TLS_AES_128_GCM_SHA256: Sending 1 files (<85 bytes)\r\n2020-10-31 18:58:22 sendreceive/default@0xc00008a000 Scan due to watcher\r\n2020-10-31 18:58:56 Index update (in): BCROSJ5-2UBPL5A-M6XI2YN-Z4GKL76-4TBBPSA-47VDXPC-NJLUTOT-5UNJJAH / \"default\": 1 files\r\n2020-10-31 18:58:56 sendreceive/default@0xc00008a000 pulling\r\n2020-10-31 18:58:56 sendreceive/default@0xc00008a000 copiers: 2 pullerPendingKiB: 32768\r\n2020-10-31 18:58:56 sendreceive/default@0xc00008a000 Handling directory tmp\r\n2020-10-31 18:58:56 sendreceive/default@0xc00008a000 parent not missing tmp\r\n2020-10-31 18:58:56 need dir\r\n\tDirectory{Name:\"tmp\", Sequence:2269, Permissions:0775, ModTime:2020-10-31 18:58:06.51704532 +0100 CET, Version:{[{BCROSJ5 1604167136} {ZRRNJRT 1604078169}]}, VersionHash:, Deleted:false, Invalid:false, LocalFlags:0x0, NoPermissions:false}\r\n\tDirectory{Name:\"tmp\", Sequence:2208, Permissions:0775, ModTime:2020-10-30 20:23:03.557839089 +0100 CET, Version:{[{BCROSJ5 1604085783} {ZRRNJRT 1604078169}]}, VersionHash:, Deleted:true, Invalid:false, LocalFlags:0x0, NoPermissions:false}\r\n2020-10-31 18:58:56 sendreceive/default@0xc00008a000 changed 1 on try 1\r\n2020-10-31 18:58:56 sendreceive/default@0xc00008a000 copiers: 2 pullerPendingKiB: 32768\r\n2020-10-31 18:58:56 sendreceive/default@0xc00008a000 changed 0 on try 2\r\n2020-10-31 18:58:56 progress emitter: bytes completed for default: 0\r\n2020-10-31 18:58:56 model@0xc000001980 Completion(BCROSJ5-2UBPL5A-M6XI2YN-Z4GKL76-4TBBPSA-47VDXPC-NJLUTOT-5UNJJAH, \"default\"): map[completion:100 globalBytes:1579109834 globalItems:601 needBytes:0 needDeletes:0 needItems:0 sequence:2269]\r\n2020-10-31 18:58:56 indexSender@0xc0024ce230 for default to  at 116.203.108.209:22000-82.218.192.199:22002/tcp-server/TLS1.3-TLS_AES_128_GCM_SHA256: Sending 1 files (<74 bytes)\r\n2020-10-31 18:58:57 Index update (in): BCROSJ5-2UBPL5A-M6XI2YN-Z4GKL76-4TBBPSA-47VDXPC-NJLUTOT-5UNJJAH / \"default\": 1 files\r\n2020-10-31 18:58:57 sendreceive/default@0xc00008a000 pulling\r\n2020-10-31 18:58:57 sendreceive/default@0xc00008a000 copiers: 2 pullerPendingKiB: 32768\r\n2020-10-31 18:58:57 sendreceive/default@0xc00008a000 Deleting dir Untitled Folder\r\n2020-10-31 18:58:57 sendreceive/default@0xc00008a000 changed 1 on try 1\r\n2020-10-31 18:58:57 sendreceive/default@0xc00008a000 copiers: 2 pullerPendingKiB: 32768\r\n2020-10-31 18:58:57 sendreceive/default@0xc00008a000 changed 0 on try 2\r\n2020-10-31 18:58:57 progress emitter: bytes completed for default: 0\r\n2020-10-31 18:58:57 model@0xc000001980 Completion(BCROSJ5-2UBPL5A-M6XI2YN-Z4GKL76-4TBBPSA-47VDXPC-NJLUTOT-5UNJJAH, \"default\"): map[completion:100 globalBytes:1579109706 globalItems:600 needBytes:0 needDeletes:0 needItems:0 sequence:2270]\r\n2020-10-31 18:58:57 indexSender@0xc0024ce230 for default to  at 116.203.108.209:22000-82.218.192.199:22002/tcp-server/TLS1.3-TLS_AES_128_GCM_SHA256: Sending 1 files (<87 bytes)\r\n2020-10-31 18:59:02 sendreceive/default@0xc00008a000 Scan due to watcher\r\n2020-10-31 18:59:02 sendreceive/default@0xc00008a000 Scan due to watcher\r\n2020-10-31 18:59:53 Established secure connection to 3UVYIBI-RE7S5IJ-G4I7COG-4KXQVYR-IFEL3LA-SWRFXGL-CEOKHKR-DFVYNQQ at 116.203.108.209:22000-82.218.192.199:22000/tcp-server/TLS1.3-TLS_AES_128_GCM_SHA256\r\n2020-10-31 18:59:53 Device 3UVYIBI-RE7S5IJ-G4I7COG-4KXQVYR-IFEL3LA-SWRFXGL-CEOKHKR-DFVYNQQ client is \"syncthing v1.10.0\" named \"Pixel 3\" at 116.203.108.209:22000-82.218.192.199:22000/tcp-server/TLS1.3-TLS_AES_128_GCM_SHA256\r\n2020-10-31 18:59:53 progress emitter: bytes completed for default: 0\r\n2020-10-31 18:59:53 model@0xc000001980 Completion(BCROSJ5-2UBPL5A-M6XI2YN-Z4GKL76-4TBBPSA-47VDXPC-NJLUTOT-5UNJJAH, \"default\"): map[completion:100 globalBytes:1579109706 globalItems:600 needBytes:0 needDeletes:0 needItems:0 sequence:2270]\r\n2020-10-31 18:59:53 model@0xc000001980 Completion(3UVYIBI-RE7S5IJ-G4I7COG-4KXQVYR-IFEL3LA-SWRFXGL-CEOKHKR-DFVYNQQ, \"default\"): map[completion:99.99999189416673 globalBytes:1579109706 globalItems:600 needBytes:128 needDeletes:1 needItems:1 sequence:2093]\r\n```","closed_by":{"login":"imsodin","id":15955093,"node_id":"MDQ6VXNlcjE1OTU1MDkz","avatar_url":"https://avatars.githubusercontent.com/u/15955093?v=4","gravatar_id":"","url":"https://api.github.com/users/imsodin","html_url":"https://github.com/imsodin","followers_url":"https://api.github.com/users/imsodin/followers","following_url":"https://api.github.com/users/imsodin/following{/other_user}","gists_url":"https://api.github.com/users/imsodin/gists{/gist_id}","starred_url":"https://api.github.com/users/imsodin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imsodin/subscriptions","organizations_url":"https://api.github.com/users/imsodin/orgs","repos_url":"https://api.github.com/users/imsodin/repos","events_url":"https://api.github.com/users/imsodin/events{/privacy}","received_events_url":"https://api.github.com/users/imsodin/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/syncthing/syncthing/issues/7076/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/syncthing/syncthing/issues/7076/timeline","performed_via_github_app":null,"state_reason":"completed"}