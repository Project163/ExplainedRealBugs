{"url":"https://api.github.com/repos/syncthing/syncthing/issues/4965","repository_url":"https://api.github.com/repos/syncthing/syncthing","labels_url":"https://api.github.com/repos/syncthing/syncthing/issues/4965/labels{/name}","comments_url":"https://api.github.com/repos/syncthing/syncthing/issues/4965/comments","events_url":"https://api.github.com/repos/syncthing/syncthing/issues/4965/events","html_url":"https://github.com/syncthing/syncthing/issues/4965","id":325639540,"node_id":"MDU6SXNzdWUzMjU2Mzk1NDA=","number":4965,"title":"Web UI JS error due to missing folder attribute in global change list","user":{"login":"imsodin","id":15955093,"node_id":"MDQ6VXNlcjE1OTU1MDkz","avatar_url":"https://avatars.githubusercontent.com/u/15955093?v=4","gravatar_id":"","url":"https://api.github.com/users/imsodin","html_url":"https://github.com/imsodin","followers_url":"https://api.github.com/users/imsodin/followers","following_url":"https://api.github.com/users/imsodin/following{/other_user}","gists_url":"https://api.github.com/users/imsodin/gists{/gist_id}","starred_url":"https://api.github.com/users/imsodin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imsodin/subscriptions","organizations_url":"https://api.github.com/users/imsodin/orgs","repos_url":"https://api.github.com/users/imsodin/repos","events_url":"https://api.github.com/users/imsodin/events{/privacy}","received_events_url":"https://api.github.com/users/imsodin/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":628314330,"node_id":"MDU6TGFiZWw2MjgzMTQzMzA=","url":"https://api.github.com/repos/syncthing/syncthing/labels/frozen-due-to-age","name":"frozen-due-to-age","color":"eeeeee","default":false,"description":"Issues closed and untouched for a long time, together with being locked for discussion"},{"id":753433298,"node_id":"MDU6TGFiZWw3NTM0MzMyOTg=","url":"https://api.github.com/repos/syncthing/syncthing/labels/skip-changelog","name":"skip-changelog","color":"7fffb4","default":false,"description":"Bugs that have never been in a released stable version, and as such excluded from the release notes"}],"state":"closed","locked":true,"assignee":{"login":"imsodin","id":15955093,"node_id":"MDQ6VXNlcjE1OTU1MDkz","avatar_url":"https://avatars.githubusercontent.com/u/15955093?v=4","gravatar_id":"","url":"https://api.github.com/users/imsodin","html_url":"https://github.com/imsodin","followers_url":"https://api.github.com/users/imsodin/followers","following_url":"https://api.github.com/users/imsodin/following{/other_user}","gists_url":"https://api.github.com/users/imsodin/gists{/gist_id}","starred_url":"https://api.github.com/users/imsodin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imsodin/subscriptions","organizations_url":"https://api.github.com/users/imsodin/orgs","repos_url":"https://api.github.com/users/imsodin/repos","events_url":"https://api.github.com/users/imsodin/events{/privacy}","received_events_url":"https://api.github.com/users/imsodin/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"imsodin","id":15955093,"node_id":"MDQ6VXNlcjE1OTU1MDkz","avatar_url":"https://avatars.githubusercontent.com/u/15955093?v=4","gravatar_id":"","url":"https://api.github.com/users/imsodin","html_url":"https://github.com/imsodin","followers_url":"https://api.github.com/users/imsodin/followers","following_url":"https://api.github.com/users/imsodin/following{/other_user}","gists_url":"https://api.github.com/users/imsodin/gists{/gist_id}","starred_url":"https://api.github.com/users/imsodin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imsodin/subscriptions","organizations_url":"https://api.github.com/users/imsodin/orgs","repos_url":"https://api.github.com/users/imsodin/repos","events_url":"https://api.github.com/users/imsodin/events{/privacy}","received_events_url":"https://api.github.com/users/imsodin/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/syncthing/syncthing/milestones/23","html_url":"https://github.com/syncthing/syncthing/milestone/23","labels_url":"https://api.github.com/repos/syncthing/syncthing/milestones/23/labels","id":3343149,"node_id":"MDk6TWlsZXN0b25lMzM0MzE0OQ==","number":23,"title":"v0.14.49","description":null,"creator":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":78,"state":"closed","created_at":"2018-05-14T07:01:53Z","updated_at":"2018-07-24T20:19:43Z","due_on":null,"closed_at":"2018-07-24T20:19:43Z"},"comments":0,"created_at":"2018-05-23T10:14:03Z","updated_at":"2019-05-24T07:03:14Z","closed_at":"2018-05-23T10:41:08Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Disclaimer: I cannot reproduce the following problem after a restart, so unless the underlying issue is blatantly obvious to someone, I will just close it with the \"easy fix\" described at the end.\r\n\r\nI get the yellow error bar in the web UI and the console error is:\r\n\r\n```\r\nError: $scope.folders[folderID] is undefined\r\n$scope.folderLabel@http://localhost:8384/syncthing/core/syncthingController.js:1763:17\r\n$parseFunctionCall@http://localhost:8384/vendor/angular/angular.js:12474:15\r\nexpressionInputWatch@http://localhost:8384/vendor/angular/angular.js:12883:31\r\n$digest@http://localhost:8384/vendor/angular/angular.js:14404:34\r\n$apply@http://localhost:8384/vendor/angular/angular.js:14675:13\r\nscheduleApplyAsync/applyAsyncId<@http://localhost:8384/vendor/angular/angular.js:14965:11\r\ncompleteOutstandingRequest@http://localhost:8384/vendor/angular/angular.js:4940:7\r\nBrowser/self.defer/timeoutId<@http://localhost:8384/vendor/angular/angular.js:5328:7\r\n```\r\n\r\nBreaking on `folderLabel` shows that it is sometimes called with an empty `folderID`. The call apparently comes from the global change list:\r\n\r\n![screenshot_2018-05-23_11-48-53](https://user-images.githubusercontent.com/15955093/40418427-ac83b07c-5e82-11e8-81d9-736675ed0350.png)\r\n\r\nThe weird thing is, it only happened for some of the events. I checked that the folder attribute is actually missing for just those events in `globalChangeEvents`. The code in model.go that generates these events does not set the folder field conditionally, so I have no clue how this can happen at all.\r\n\r\nThe \"fix\" for the JS error is simple: Just check that `$scope.folders[folderID] ` exists in `folderLabel`. However that still means that the folder field will be missing in the global view.","closed_by":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/syncthing/syncthing/issues/4965/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/syncthing/syncthing/issues/4965/timeline","performed_via_github_app":null,"state_reason":"completed"}