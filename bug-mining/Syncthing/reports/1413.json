{"url":"https://api.github.com/repos/syncthing/syncthing/issues/9234","repository_url":"https://api.github.com/repos/syncthing/syncthing","labels_url":"https://api.github.com/repos/syncthing/syncthing/issues/9234/labels{/name}","comments_url":"https://api.github.com/repos/syncthing/syncthing/issues/9234/comments","events_url":"https://api.github.com/repos/syncthing/syncthing/issues/9234/events","html_url":"https://github.com/syncthing/syncthing/issues/9234","id":2001011335,"node_id":"I_kwDOAOCAEs53RQKH","number":9234,"title":"Nil deref in index handler","user":{"login":"imsodin","id":15955093,"node_id":"MDQ6VXNlcjE1OTU1MDkz","avatar_url":"https://avatars.githubusercontent.com/u/15955093?v=4","gravatar_id":"","url":"https://api.github.com/users/imsodin","html_url":"https://github.com/imsodin","followers_url":"https://api.github.com/users/imsodin/followers","following_url":"https://api.github.com/users/imsodin/following{/other_user}","gists_url":"https://api.github.com/users/imsodin/gists{/gist_id}","starred_url":"https://api.github.com/users/imsodin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imsodin/subscriptions","organizations_url":"https://api.github.com/users/imsodin/orgs","repos_url":"https://api.github.com/users/imsodin/repos","events_url":"https://api.github.com/users/imsodin/events{/privacy}","received_events_url":"https://api.github.com/users/imsodin/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":67767665,"node_id":"MDU6TGFiZWw2Nzc2NzY2NQ==","url":"https://api.github.com/repos/syncthing/syncthing/labels/bug","name":"bug","color":"d93f0b","default":true,"description":"A problem with current functionality, as opposed to missing functionality (enhancement)"},{"id":628314330,"node_id":"MDU6TGFiZWw2MjgzMTQzMzA=","url":"https://api.github.com/repos/syncthing/syncthing/labels/frozen-due-to-age","name":"frozen-due-to-age","color":"eeeeee","default":false,"description":"Issues closed and untouched for a long time, together with being locked for discussion"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/syncthing/syncthing/milestones/99","html_url":"https://github.com/syncthing/syncthing/milestone/99","labels_url":"https://api.github.com/repos/syncthing/syncthing/milestones/99/labels","id":10184364,"node_id":"MI_kwDOAOCAEs4Am2as","number":99,"title":"v1.27.0","description":"","creator":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":20,"state":"closed","created_at":"2023-11-14T08:21:19Z","updated_at":"2023-12-07T21:55:10Z","due_on":"2023-12-05T08:00:00Z","closed_at":"2023-12-05T07:01:06Z"},"comments":2,"created_at":"2023-11-19T19:54:05Z","updated_at":"2025-04-09T18:52:26Z","closed_at":"2023-12-07T21:55:10Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Panic were reported in android a few times and then here an actual/ful panic trace was referenced:\r\nhttps://forum.syncthing.net/t/syncthing-1-26-crashing-on-android-in-syncthing-fork/21115/2\r\n\r\n> \r\n> 11-19 11:32:51.661 11506 21478 W SyncthingNativeCode: panic: runtime error: invalid memory address or nil pointer dereference\r\n> 11-19 11:32:51.661 11506 21478 W SyncthingNativeCode: [signal SIGSEGV: segmentation violation code=0x1 addr=0x60 pc=0x637d5ee060]\r\n> 11-19 11:32:51.661 11506 21478 W SyncthingNativeCode:\r\n> 11-19 11:32:51.661 11506 21478 W SyncthingNativeCode: goroutine 325 [running]:\r\n> 11-19 11:32:51.663 21476     0 E Go      : github.com/syncthing/syncthing/lib/model.(*indexHandlerRegistry).startLocked(_, {{0x4000363e44, 0xc}, {0x4000363e70, 0xc}, 0x0, {0x400011af78, 0x18}, 0x1, {0x40000c2b40, ...}, ...}, ...)\r\n> 11-19 11:32:51.663 21476     0 E Go      :      github.com/syncthing/syncthing/lib/model/indexhandler.go:419 +0x100\r\n> 11-19 11:32:51.663 21476     0 E Go      : github.com/syncthing/syncthing/lib/model.(*indexHandlerRegistry).AddIndexInfo(0x400040e370, {0x40001307b0, 0xc}, 0x4000000640)\r\n> 11-19 11:32:51.663 21476     0 E Go      :      github.com/syncthing/syncthing/lib/model/indexhandler.go:439 +0x430\r\n> 11-19 11:32:51.663 21476     0 E Go      : github.com/syncthing/syncthing/lib/model.(*model).ccHandleFolders(_, {_, _, _}, {{0xdb, 0xa, 0xa4, 0x47, 0xc6, 0x6f, ...}, ...}, ...)\r\n> 11-19 11:32:51.663 21476     0 E Go      :      github.com/syncthing/syncthing/lib/model/model.go:1496 +0x5a8\r\n> 11-19 11:32:51.663 21476     0 E Go      : github.com/syncthing/syncthing/lib/model.(*model).ClusterConfig(0x40001c6180, {0x637d8d4148, 0x4000eec350}, {{0x400154ca00?, 0x40000e8088?, 0x40000e8088?}, 0x68?})\r\n> 11-19 11:32:51.663 21476     0 E Go      :      github.com/syncthing/syncthing/lib/model/model.go:1296 +0x784\r\n> 11-19 11:32:51.663 21476     0 E Go      : github.com/syncthing/syncthing/lib/protocol.(*connectionWrappingModel).ClusterConfig(0x4000bc5d68?, {{0x400154ca00?, 0x10?, 0x637d710540?}, 0x1?})\r\n> 11-19 11:32:51.663 21476     0 E Go      :      github.com/syncthing/syncthing/lib/protocol/protocol.go:1143 +0x50\r\n> 11-19 11:32:51.663 21476     0 E Go      : github.com/syncthing/syncthing/lib/protocol.encryptedModel.ClusterConfig(...)\r\n> 11-19 11:32:51.663 21476     0 E Go      :      github.com/syncthing/syncthing/lib/protocol/encryption.go:155\r\n> 11-19 11:32:51.663 21476     0 E Go      : github.com/syncthing/syncthing/lib/protocol.(*rawConnection).dispatcherLoop(0x4000116a20)\r\n> 11-19 11:32:51.663 21476     0 E Go      :      github.com/syncthing/syncthing/lib/protocol/protocol.go:496 +0x308\r\n> 11-19 11:32:51.663 21476     0 E Go      : github.com/syncthing/syncthing/lib/protocol.(*rawConnection).Start.func2()\r\n> 11-19 11:32:51.663 21476     0 E Go      :      github.com/syncthing/syncthing/lib/protocol/protocol.go:307 +0x24\r\n> 11-19 11:32:51.663 21476     0 E Go      : created by github.com/syncthing/syncthing/lib/protocol.(*rawConnection).Start\r\n> 11-19 11:32:51.663 21476     0 E Go      :      github.com/syncthing/syncthing/lib/protocol/protocol.go:306 +0x144\r\n> 11-19 11:32:51.663 21476     0 E Go      :\r\n\r\nThere's recently changed/added code that sets up index handlers and access fmut protected fields without holding the lock: https://github.com/syncthing/syncthing/blob/main/lib/model/model.go#L1370  \r\nI don't see how exactly this can lead to the panic, but presumably some race around pausing a folder.\r\n\r\nI am sending a PR shortly.","closed_by":{"login":"imsodin","id":15955093,"node_id":"MDQ6VXNlcjE1OTU1MDkz","avatar_url":"https://avatars.githubusercontent.com/u/15955093?v=4","gravatar_id":"","url":"https://api.github.com/users/imsodin","html_url":"https://github.com/imsodin","followers_url":"https://api.github.com/users/imsodin/followers","following_url":"https://api.github.com/users/imsodin/following{/other_user}","gists_url":"https://api.github.com/users/imsodin/gists{/gist_id}","starred_url":"https://api.github.com/users/imsodin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imsodin/subscriptions","organizations_url":"https://api.github.com/users/imsodin/orgs","repos_url":"https://api.github.com/users/imsodin/repos","events_url":"https://api.github.com/users/imsodin/events{/privacy}","received_events_url":"https://api.github.com/users/imsodin/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/syncthing/syncthing/issues/9234/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/syncthing/syncthing/issues/9234/timeline","performed_via_github_app":null,"state_reason":"completed"}