{"url":"https://api.github.com/repos/syncthing/syncthing/issues/6540","repository_url":"https://api.github.com/repos/syncthing/syncthing","labels_url":"https://api.github.com/repos/syncthing/syncthing/issues/6540/labels{/name}","comments_url":"https://api.github.com/repos/syncthing/syncthing/issues/6540/comments","events_url":"https://api.github.com/repos/syncthing/syncthing/issues/6540/events","html_url":"https://github.com/syncthing/syncthing/issues/6540","id":600777014,"node_id":"MDU6SXNzdWU2MDA3NzcwMTQ=","number":6540,"title":"Config PATCH/PUT/DELETE API","user":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":67767667,"node_id":"MDU6TGFiZWw2Nzc2NzY2Nw==","url":"https://api.github.com/repos/syncthing/syncthing/labels/enhancement","name":"enhancement","color":"0e8a16","default":true,"description":"New features or improvements of some kind, as opposed to a problem (bug)"},{"id":628314330,"node_id":"MDU6TGFiZWw2MjgzMTQzMzA=","url":"https://api.github.com/repos/syncthing/syncthing/labels/frozen-due-to-age","name":"frozen-due-to-age","color":"eeeeee","default":false,"description":"Issues closed and untouched for a long time, together with being locked for discussion"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/syncthing/syncthing/milestones/56","html_url":"https://github.com/syncthing/syncthing/milestone/56","labels_url":"https://api.github.com/repos/syncthing/syncthing/milestones/56/labels","id":6022346,"node_id":"MDk6TWlsZXN0b25lNjAyMjM0Ng==","number":56,"title":"v1.12.0","description":"This release adds a new config REST API.","creator":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":36,"state":"closed","created_at":"2020-10-22T19:43:20Z","updated_at":"2020-12-18T11:23:32Z","due_on":"2020-12-01T08:00:00Z","closed_at":"2020-12-01T12:11:24Z"},"comments":0,"created_at":"2020-04-16T06:19:03Z","updated_at":"2021-10-23T07:02:29Z","closed_at":"2020-10-22T17:54:36Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Currently we just have the one config API endpoint, `POST /rest/system/config` to replace the whole thing. This isn't optimally easy to use from API clients that just want to change an option or two as you need a while get/change/post and there is also an inherent race condition.\r\n\r\nIt would be nice to have an API that can twiddle parts of the config easier and safer. From the outside it could look something like this:\r\n\r\n- `PUT /rest/system/config/devices/5Y62GZS-...` creates or replaces a single device in its entirety\r\n- `DELETE /rest/system/config/folders/default` deletes the default folder\r\n- `PATCH /rest/system/config/devices/5Y62GZS-...` overwrites the properties present in the given object only, which could be something like `{\"name\": \"Unused for now\", \"paused\": true}`.\r\n- `PUT /rest/system/config/options/localAnnounceEnabled` overwrites the named field in the config, in this case the JSON in the body needs to a boolean like `false`.\r\n- ... and so on\r\n\r\nImplementation wise we can mostly just take the current config, JSON serialize it, traverse the resulting object according to the request path, and then remove, replace or unmarshal on top of the resulting leaf object, then commit. (Folders and devices handled specifically as they are arrays in the config object and not dicts.) This would happen while holding the API config lock, so it's atomic from an API perspective.","closed_by":{"login":"imsodin","id":15955093,"node_id":"MDQ6VXNlcjE1OTU1MDkz","avatar_url":"https://avatars.githubusercontent.com/u/15955093?v=4","gravatar_id":"","url":"https://api.github.com/users/imsodin","html_url":"https://github.com/imsodin","followers_url":"https://api.github.com/users/imsodin/followers","following_url":"https://api.github.com/users/imsodin/following{/other_user}","gists_url":"https://api.github.com/users/imsodin/gists{/gist_id}","starred_url":"https://api.github.com/users/imsodin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imsodin/subscriptions","organizations_url":"https://api.github.com/users/imsodin/orgs","repos_url":"https://api.github.com/users/imsodin/repos","events_url":"https://api.github.com/users/imsodin/events{/privacy}","received_events_url":"https://api.github.com/users/imsodin/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/syncthing/syncthing/issues/6540/reactions","total_count":5,"+1":5,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/syncthing/syncthing/issues/6540/timeline","performed_via_github_app":null,"state_reason":"completed"}