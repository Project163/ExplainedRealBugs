{"url":"https://api.github.com/repos/syncthing/syncthing/issues/4653","repository_url":"https://api.github.com/repos/syncthing/syncthing","labels_url":"https://api.github.com/repos/syncthing/syncthing/issues/4653/labels{/name}","comments_url":"https://api.github.com/repos/syncthing/syncthing/issues/4653/comments","events_url":"https://api.github.com/repos/syncthing/syncthing/issues/4653/events","html_url":"https://github.com/syncthing/syncthing/issues/4653","id":286592778,"node_id":"MDU6SXNzdWUyODY1OTI3Nzg=","number":4653,"title":"lib/model test fails with \"ThreadSanitizer failed to allocate 0x200000 (2097152) bytes\" with Go 1.9.2","user":{"login":"vrusinov","id":711348,"node_id":"MDQ6VXNlcjcxMTM0OA==","avatar_url":"https://avatars.githubusercontent.com/u/711348?v=4","gravatar_id":"","url":"https://api.github.com/users/vrusinov","html_url":"https://github.com/vrusinov","followers_url":"https://api.github.com/users/vrusinov/followers","following_url":"https://api.github.com/users/vrusinov/following{/other_user}","gists_url":"https://api.github.com/users/vrusinov/gists{/gist_id}","starred_url":"https://api.github.com/users/vrusinov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vrusinov/subscriptions","organizations_url":"https://api.github.com/users/vrusinov/orgs","repos_url":"https://api.github.com/users/vrusinov/repos","events_url":"https://api.github.com/users/vrusinov/events{/privacy}","received_events_url":"https://api.github.com/users/vrusinov/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":122660823,"node_id":"MDU6TGFiZWwxMjI2NjA4MjM=","url":"https://api.github.com/repos/syncthing/syncthing/labels/build","name":"build","color":"1d76db","default":false,"description":"Issues caused by or requiring changes to the build system (scripts or Docker image)"},{"id":628314330,"node_id":"MDU6TGFiZWw2MjgzMTQzMzA=","url":"https://api.github.com/repos/syncthing/syncthing/labels/frozen-due-to-age","name":"frozen-due-to-age","color":"eeeeee","default":false,"description":"Issues closed and untouched for a long time, together with being locked for discussion"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/syncthing/syncthing/milestones/18","html_url":"https://github.com/syncthing/syncthing/milestone/18","labels_url":"https://api.github.com/repos/syncthing/syncthing/milestones/18/labels","id":3009485,"node_id":"MDk6TWlsZXN0b25lMzAwOTQ4NQ==","number":18,"title":"v0.14.44","description":null,"creator":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":15,"state":"closed","created_at":"2018-01-03T08:10:40Z","updated_at":"2018-02-08T10:55:32Z","due_on":null,"closed_at":"2018-02-08T10:46:00Z"},"comments":7,"created_at":"2018-01-07T19:31:55Z","updated_at":"2019-01-09T07:02:22Z","closed_at":"2018-01-08T18:32:09Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Checked out fresh master, no local changes.\r\n\r\nRun tests via `./build.sh test`.\r\n\r\nI see two test failures: one in lib/model, another is lib/logger, with similar messages:\r\n\r\n```\r\nGOPATH is /tmp/syncthing-3f04b07a\r\nok  \tgithub.com/syncthing/syncthing/lib/auto\t1.161s\r\nok  \tgithub.com/syncthing/syncthing/lib/beacon\t1.005s\r\nok  \tgithub.com/syncthing/syncthing/lib/config\t1.114s\r\nok  \tgithub.com/syncthing/syncthing/lib/connections\t1.019s\r\n==20126==ERROR: ThreadSanitizer failed to allocate 0x1000000 (16777216) bytes at address 23108f400000 (errno: 12)\r\nfatal error: unexpected signal during runtime execution\r\nfatal error: unexpected signal during runtime execution\r\npanic during panic\r\n\r\nruntime stack:\r\nruntime.startpanic_m()\r\n\t/usr/lib64/go/src/runtime/panic.go:671 +0x19a\r\nruntime.systemstack(0xc42002b900)\r\n\t/usr/lib64/go/src/runtime/asm_amd64.s:344 +0x79\r\nruntime.mstart()\r\n\t/usr/lib64/go/src/runtime/proc.go:1135\r\n\r\ngoroutine 107 [running]:\r\nruntime.systemstack_switch()\r\n\t/usr/lib64/go/src/runtime/asm_amd64.s:298 fp=0x7f8e9aa74d88 sp=0x7f8e9aa74d80 pc=0x486c40\r\nruntime.dopanic_m(0xc420001500, 0x45626a, 0x7f8e9aa74e70)\r\n\t/usr/lib64/go/src/runtime/panic.go:717 +0x182 fp=0x7f8e9aa74df8 sp=0x7f8e9aa74d88 pc=0x456472\r\nruntime.dopanic.func1()\r\n\t/usr/lib64/go/src/runtime/panic.go:587 +0x3c fp=0x7f8e9aa74e20 sp=0x7f8e9aa74df8 pc=0x485b6c\r\nruntime.systemstack(0x7f8e9aa74e40)\r\n\t/usr/lib64/go/src/runtime/asm_amd64.s:360 +0xab fp=0x7f8e9aa74e28 sp=0x7f8e9aa74e20 pc=0x486cfb\r\nruntime.dopanic(0x0)\r\n\t/usr/lib64/go/src/runtime/panic.go:586 +0x70 fp=0x7f8e9aa74e70 sp=0x7f8e9aa74e28 pc=0x455e70\r\nruntime.startpanic_m()\r\n\t/usr/lib64/go/src/runtime/panic.go:671 +0x19a fp=0x7f8e9aa74e98 sp=0x7f8e9aa74e70 pc=0x45626a\r\nruntime.systemstack(0xc42002b900)\r\n\t/usr/lib64/go/src/runtime/asm_amd64.s:344 +0x79 fp=0x7f8e9aa74ea0 sp=0x7f8e9aa74e98 pc=0x486cc9\r\nruntime.mstart()\r\n\t/usr/lib64/go/src/runtime/proc.go:1135 fp=0x7f8e9aa74ea8 sp=0x7f8e9aa74ea0 pc=0x45a200\r\ncreated by testing.(*T).Run\r\n\t/usr/lib64/go/src/testing/testing.go:789 +0x569\r\n\r\n...\r\ngoroutine 108 [select]:\r\ngithub.com/syncthing/syncthing/vendor/github.com/syndtr/goleveldb/leveldb/util.(*BufferPool).drain(0xc4201670a0)\r\n\t/tmp/syncthing-3f04b07a/src/github.com/syncthing/syncthing/vendor/github.com/syndtr/goleveldb/leveldb/util/buffer_pool.go:206 +0x1c5\r\ncreated by github.com/syncthing/syncthing/vendor/github.com/syndtr/goleveldb/leveldb/util.NewBufferPool\r\n\t/tmp/syncthing-3f04b07a/src/github.com/syncthing/syncthing/vendor/github.com/syndtr/goleveldb/leveldb/util/buffer_pool.go:237 +0x310\r\nFAIL\tgithub.com/syncthing/syncthing/lib/db\t0.134s\r\nok  \tgithub.com/syncthing/syncthing/lib/dialer\t1.016s [no tests to run]\r\nok  \tgithub.com/syncthing/syncthing/lib/discover\t1.655s\r\nok  \tgithub.com/syncthing/syncthing/lib/events\t6.425s\r\nok  \tgithub.com/syncthing/syncthing/lib/fs\t2.723s\r\nok  \tgithub.com/syncthing/syncthing/lib/ignore\t1.022s\r\nok  \tgithub.com/syncthing/syncthing/lib/logger\t1.007s\r\n==20524==ERROR: ThreadSanitizer failed to allocate 0x40000 (262144) bytes at address 60014f9a0000 (errno: 12)\r\nFATAL: ThreadSanitizer can not mmap thread trace (0x60014f9a0000/0x000000040000->0xfffffffffffffff4)\r\nFAIL\tgithub.com/syncthing/syncthing/lib/model\t0.146s\r\nok  \tgithub.com/syncthing/syncthing/lib/nat\t1.009s\r\nok  \tgithub.com/syncthing/syncthing/lib/osutil\t1.011s\r\nok  \tgithub.com/syncthing/syncthing/lib/pmp\t1.009s [no tests to run]\r\nok  \tgithub.com/syncthing/syncthing/lib/protocol\t1.169s\r\nok  \tgithub.com/syncthing/syncthing/lib/rand\t3.559s\r\n?   \tgithub.com/syncthing/syncthing/lib/rc\t[no test files]\r\nok  \tgithub.com/syncthing/syncthing/lib/relay/client\t1.009s [no tests to run]\r\nok  \tgithub.com/syncthing/syncthing/lib/relay/protocol\t1.006s [no tests to run]\r\nok  \tgithub.com/syncthing/syncthing/lib/scanner\t2.614s\r\n?   \tgithub.com/syncthing/syncthing/lib/sha256\t[no test files]\r\nok  \tgithub.com/syncthing/syncthing/lib/signature\t1.649s\r\nok  \tgithub.com/syncthing/syncthing/lib/stats\t1.023s [no tests to run]\r\nok  \tgithub.com/syncthing/syncthing/lib/sync\t2.037s\r\nok  \tgithub.com/syncthing/syncthing/lib/tlsutil\t1.005s\r\nok  \tgithub.com/syncthing/syncthing/lib/upgrade\t1.008s\r\nok  \tgithub.com/syncthing/syncthing/lib/upnp\t1.010s\r\nok  \tgithub.com/syncthing/syncthing/lib/util\t1.007s\r\nok  \tgithub.com/syncthing/syncthing/lib/versioner\t1.025s\r\nok  \tgithub.com/syncthing/syncthing/lib/watchaggregator\t7.235s\r\nok  \tgithub.com/syncthing/syncthing/lib/weakhash\t1.008s\r\n?   \tgithub.com/syncthing/syncthing/cmd/stbench\t[no test files]\r\n?   \tgithub.com/syncthing/syncthing/cmd/stcli\t[no test files]\r\n?   \tgithub.com/syncthing/syncthing/cmd/stcompdirs\t[no test files]\r\n?   \tgithub.com/syncthing/syncthing/cmd/stdisco\t[no test files]\r\n?   \tgithub.com/syncthing/syncthing/cmd/stdiscosrv\t[no test files]\r\n?   \tgithub.com/syncthing/syncthing/cmd/stevents\t[no test files]\r\n?   \tgithub.com/syncthing/syncthing/cmd/stfileinfo\t[no test files]\r\n?   \tgithub.com/syncthing/syncthing/cmd/stfinddevice\t[no test files]\r\n?   \tgithub.com/syncthing/syncthing/cmd/stgenfiles\t[no test files]\r\n?   \tgithub.com/syncthing/syncthing/cmd/stindex\t[no test files]\r\n?   \tgithub.com/syncthing/syncthing/cmd/strelaypoolsrv\t[no test files]\r\n?   \tgithub.com/syncthing/syncthing/cmd/strelaypoolsrv/auto\t[no test files]\r\n?   \tgithub.com/syncthing/syncthing/cmd/strelaysrv\t[no test files]\r\n?   \tgithub.com/syncthing/syncthing/cmd/strelaysrv/testutil\t[no test files]\r\n?   \tgithub.com/syncthing/syncthing/cmd/stsigtool\t[no test files]\r\n?   \tgithub.com/syncthing/syncthing/cmd/stvanity\t[no test files]\r\n?   \tgithub.com/syncthing/syncthing/cmd/stwatchfile\t[no test files]\r\nok  \tgithub.com/syncthing/syncthing/cmd/syncthing\t11.497s\r\nexit status 1\r\nexit status 1\r\n\r\n```\r\n\r\nNot sure if it's syncthing or Go bug, but filing here in case anyone knows what's up with ThreadSanitizer.\r\nI use 1.9.2 compiled from source and cannot reproduce with 1.8.\r\n\r\n### Version Information\r\n\r\nSyncthing Version:\r\n\r\n$ PAGER=\"cat\" git show --oneline -s \r\ndb03562d (HEAD -> master, upstream/master, origin/master, origin/HEAD) lib/scanner: Fix UTF-8 normalization on ZFS (fixes #4649)\r\n\r\nOS Version: Linux x64 (Gentoo)\r\n\r\nGo: 1.9.2, compiled from source. Cannot reproduce with 1.8 provided via CentOS rpm on another box.\r\n```\r\n$ go version\r\ngo version go1.9.2 linux/amd64\r\n```\r\n  \r\n  ","closed_by":{"login":"AudriusButkevicius","id":1144861,"node_id":"MDQ6VXNlcjExNDQ4NjE=","avatar_url":"https://avatars.githubusercontent.com/u/1144861?v=4","gravatar_id":"","url":"https://api.github.com/users/AudriusButkevicius","html_url":"https://github.com/AudriusButkevicius","followers_url":"https://api.github.com/users/AudriusButkevicius/followers","following_url":"https://api.github.com/users/AudriusButkevicius/following{/other_user}","gists_url":"https://api.github.com/users/AudriusButkevicius/gists{/gist_id}","starred_url":"https://api.github.com/users/AudriusButkevicius/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AudriusButkevicius/subscriptions","organizations_url":"https://api.github.com/users/AudriusButkevicius/orgs","repos_url":"https://api.github.com/users/AudriusButkevicius/repos","events_url":"https://api.github.com/users/AudriusButkevicius/events{/privacy}","received_events_url":"https://api.github.com/users/AudriusButkevicius/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/syncthing/syncthing/issues/4653/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/syncthing/syncthing/issues/4653/timeline","performed_via_github_app":null,"state_reason":"completed"}