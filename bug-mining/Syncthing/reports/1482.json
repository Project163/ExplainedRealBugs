{"url":"https://api.github.com/repos/syncthing/syncthing/issues/9626","repository_url":"https://api.github.com/repos/syncthing/syncthing","labels_url":"https://api.github.com/repos/syncthing/syncthing/issues/9626/labels{/name}","comments_url":"https://api.github.com/repos/syncthing/syncthing/issues/9626/comments","events_url":"https://api.github.com/repos/syncthing/syncthing/issues/9626/events","html_url":"https://github.com/syncthing/syncthing/issues/9626","id":2447154742,"node_id":"I_kwDOAOCAEs6R3J42","number":9626,"title":"Files “created” by Syncthing ignore UMask (.stfolder and .stversions)","user":{"login":"xitoshi","id":1262591,"node_id":"MDQ6VXNlcjEyNjI1OTE=","avatar_url":"https://avatars.githubusercontent.com/u/1262591?v=4","gravatar_id":"","url":"https://api.github.com/users/xitoshi","html_url":"https://github.com/xitoshi","followers_url":"https://api.github.com/users/xitoshi/followers","following_url":"https://api.github.com/users/xitoshi/following{/other_user}","gists_url":"https://api.github.com/users/xitoshi/gists{/gist_id}","starred_url":"https://api.github.com/users/xitoshi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xitoshi/subscriptions","organizations_url":"https://api.github.com/users/xitoshi/orgs","repos_url":"https://api.github.com/users/xitoshi/repos","events_url":"https://api.github.com/users/xitoshi/events{/privacy}","received_events_url":"https://api.github.com/users/xitoshi/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":67767665,"node_id":"MDU6TGFiZWw2Nzc2NzY2NQ==","url":"https://api.github.com/repos/syncthing/syncthing/labels/bug","name":"bug","color":"d93f0b","default":true,"description":"A problem with current functionality, as opposed to missing functionality (enhancement)"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2024-08-04T14:17:12Z","updated_at":"2025-05-24T05:35:33Z","closed_at":"2025-05-24T05:35:33Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### What happened?\n\nI am using Syncthing as a `systemd` service on a Raspberry Pi with Raspbian. I have set it up so it’s run by a `syncthing` user, but to keep access to all users in the group I’ve set the `UMask` parameter to `0002` in the `syncthing@syncthing.service` and for good measure in the `.bash_rc`, `.bash_pofile` and `.profile` files for that user.\r\n\r\nSetting `umask` in the service file works correctly for synchronization, but Syncthing seems to ignore it when the files are “created” by Syncthing itself and not synchronized. I’ve noticed this happening both in `.stfolder` and subfiles (when a new synchronization folder is created) and the `.stversions` and subfolders (only directories, not files).\r\n\r\nE.g.: Creating a new, still unshared folder through the web GUI:\r\n\r\n```\r\npi@raspberrypi:/media/data/Sync $ ls TEST/ -ld\r\ndrwxrwsr-x 3 syncthing drive-users 4096 Aug  3 00:10 TEST/\r\npi@raspberrypi:/media/data/Sync $ ls TEST/ -lAR\r\nTEST/:\r\ntotal 4\r\ndrwxr-sr-x 2 syncthing drive-users 4096 Aug  3 00:10 .stfolder\r\n\r\nTEST/.stfolder:\r\ntotal 4\r\n-rw-r--r-- 1 syncthing drive-users 117 Aug  3 00:10 syncthing-folder-ccaee1.txt\r\n```\r\n\r\nAs for `.stversions`, I use “Simple” file versioning, and when I remove files the `.stversions` folder and any subfolders are created without group writing permissions, seemingly ignoring the `umask`. The files keep the writing permission, but without the folder writing permission I can’t delete them.\r\n\r\nE.g.: Note that in this folder I have turned on “Ignore Permissions”. Also, in this case `.stfolder` has group write permission set manually.\r\n\r\n```\r\npi@raspberrypi:/media/data/Sync/Linux-Documents $ ls -lAR\r\n.:\r\ntotal 8\r\ndrwxrwsr-x 2 syncthing drive-users 4096 Aug  2 23:54 'New Folder'\r\ndrwxrwsr-x 2 syncthing drive-users 4096 May  7 22:56  .stfolder\r\n\r\n'./New Folder':\r\ntotal 4\r\n-rw-rw-r-- 1 syncthing drive-users 2 Aug  2 23:54 'Text File.txt'\r\n\r\n./.stfolder:\r\ntotal 0\r\npi@raspberrypi:/media/data/Sync/Linux-Documents $ ls -lAR\r\n.:\r\ntotal 8\r\ndrwxrwsr-x 2 syncthing drive-users 4096 May  7 22:56 .stfolder\r\ndrwxr-sr-x 3 syncthing drive-users 4096 Aug  2 23:55 .stversions\r\n\r\n./.stfolder:\r\ntotal 0\r\n\r\n./.stversions:\r\ntotal 4\r\ndrwxr-sr-x 2 syncthing drive-users 4096 Aug  2 23:55 'New Folder'\r\n\r\n'./.stversions/New Folder':\r\ntotal 4\r\n-rw-rw-r-- 1 syncthing drive-users 2 Aug  2 23:54 'Text File~20240802-235507.txt'\r\npi@raspberrypi:/media/data/Sync/Linux-Documents $ rm .stversions/New\\ Folder/Text\\ File~20240802-235507.txt\r\nrm: cannot remove '.stversions/New Folder/Text File~20240802-235507.txt': Permission denied\r\n```\r\n\r\nFor more information, here is my service file:\r\n\r\n```\r\n$ cat /lib/systemd/system/syncthing@syncthing.service \r\n[Unit]\r\nDescription=Syncthing - Open Source Continuous File Synchronization for %I\r\nDocumentation=man:syncthing(1)\r\nAfter=network.target\r\n\r\n[Service]\r\nUser=%i\r\nExecStart=/usr/bin/syncthing -no-browser -no-restart -logflags=0\r\nRestart=on-failure\r\nSuccessExitStatus=3 4\r\nRestartForceExitStatus=3 4\r\nUMask=0002\r\n\r\n# Hardening\r\nProtectSystem=full\r\nPrivateTmp=true\r\nSystemCallArchitectures=native\r\nMemoryDenyWriteExecute=true\r\nNoNewPrivileges=true\r\n\r\n[Install]\r\nWantedBy=multi-user.target\r\n```\r\n\r\nI have brought up this problem on the forum as well, where @calmh [identified it as a bug](https://forum.syncthing.net/t/files-created-by-syncthing-ignore-umask-stfolder-and-stversions/22530/2?u=xitoshi):\r\n\r\n>You’re right, mkdirs in the versioner code use 0755 as the base permissions, so umask won’t help there (to get group write). Please feel free to file an issue on this, and perhaps a fix :slight_smile:\r\n\r\n>Probably the real fix would be to grab the permissions from the corresponding directory in the synced folder.\r\n\r\n\n\n### Syncthing version\n\nsyncthing v1.27.9 \"Gold Grasshopper\" (go1.22.4 linux-arm) debian@github.syncthing.net 2024-07-01 03:45:16 UTC [noupgrade]\n\n### Platform & operating system\n\nRaspbian GNU/Linux 11 (bullseye)\n\n### Browser version\n\n_No response_\n\n### Relevant log output\n\n_No response_","closed_by":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/syncthing/syncthing/issues/9626/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/syncthing/syncthing/issues/9626/timeline","performed_via_github_app":null,"state_reason":"completed"}