{"url":"https://api.github.com/repos/syncthing/syncthing/issues/7649","repository_url":"https://api.github.com/repos/syncthing/syncthing","labels_url":"https://api.github.com/repos/syncthing/syncthing/issues/7649/labels{/name}","comments_url":"https://api.github.com/repos/syncthing/syncthing/issues/7649/comments","events_url":"https://api.github.com/repos/syncthing/syncthing/issues/7649/events","html_url":"https://github.com/syncthing/syncthing/issues/7649","id":882377647,"node_id":"MDU6SXNzdWU4ODIzNzc2NDc=","number":7649,"title":"Incorrect local and global states after ignoring and unignoring files","user":{"login":"tomasz1986","id":5626656,"node_id":"MDQ6VXNlcjU2MjY2NTY=","avatar_url":"https://avatars.githubusercontent.com/u/5626656?v=4","gravatar_id":"","url":"https://api.github.com/users/tomasz1986","html_url":"https://github.com/tomasz1986","followers_url":"https://api.github.com/users/tomasz1986/followers","following_url":"https://api.github.com/users/tomasz1986/following{/other_user}","gists_url":"https://api.github.com/users/tomasz1986/gists{/gist_id}","starred_url":"https://api.github.com/users/tomasz1986/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tomasz1986/subscriptions","organizations_url":"https://api.github.com/users/tomasz1986/orgs","repos_url":"https://api.github.com/users/tomasz1986/repos","events_url":"https://api.github.com/users/tomasz1986/events{/privacy}","received_events_url":"https://api.github.com/users/tomasz1986/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":67767665,"node_id":"MDU6TGFiZWw2Nzc2NzY2NQ==","url":"https://api.github.com/repos/syncthing/syncthing/labels/bug","name":"bug","color":"d93f0b","default":true,"description":"A problem with current functionality, as opposed to missing functionality (enhancement)"},{"id":628314330,"node_id":"MDU6TGFiZWw2MjgzMTQzMzA=","url":"https://api.github.com/repos/syncthing/syncthing/labels/frozen-due-to-age","name":"frozen-due-to-age","color":"eeeeee","default":false,"description":"Issues closed and untouched for a long time, together with being locked for discussion"},{"id":2043110077,"node_id":"MDU6TGFiZWwyMDQzMTEwMDc3","url":"https://api.github.com/repos/syncthing/syncthing/labels/needs-triage","name":"needs-triage","color":"ce23af","default":false,"description":"New issues needed to be validated"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/syncthing/syncthing/milestones/65","html_url":"https://github.com/syncthing/syncthing/milestone/65","labels_url":"https://api.github.com/repos/syncthing/syncthing/milestones/65/labels","id":6699525,"node_id":"MDk6TWlsZXN0b25lNjY5OTUyNQ==","number":65,"title":"v1.17.0","description":"This release deprecates TLS 1.2 for sync connections; other side should be Syncthing 1.3.0 or newer, or see [insecureAllowOldTLSVersions](https://docs.syncthing.net/advanced/option-insecure-allow-old-tls-versions.html).","creator":{"login":"calmh","id":125426,"node_id":"MDQ6VXNlcjEyNTQyNg==","avatar_url":"https://avatars.githubusercontent.com/u/125426?v=4","gravatar_id":"","url":"https://api.github.com/users/calmh","html_url":"https://github.com/calmh","followers_url":"https://api.github.com/users/calmh/followers","following_url":"https://api.github.com/users/calmh/following{/other_user}","gists_url":"https://api.github.com/users/calmh/gists{/gist_id}","starred_url":"https://api.github.com/users/calmh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calmh/subscriptions","organizations_url":"https://api.github.com/users/calmh/orgs","repos_url":"https://api.github.com/users/calmh/repos","events_url":"https://api.github.com/users/calmh/events{/privacy}","received_events_url":"https://api.github.com/users/calmh/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":58,"state":"closed","created_at":"2021-04-26T13:40:14Z","updated_at":"2021-06-01T14:11:34Z","due_on":"2021-06-01T07:00:00Z","closed_at":"2021-06-01T14:11:34Z"},"comments":14,"created_at":"2021-05-09T14:23:53Z","updated_at":"2023-03-10T12:00:39Z","closed_at":"2021-05-15T09:13:44Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I'm sorry for the so-so title, but this is a little bit complicated. I have experienced the issue in my real network, and now I have managed to reproduce it.\r\n\r\n1. Create a new Send Only folder on Device 1 with a few files in it, and share it with Device 2.\r\n2. Accept the folder on Device 2 as Send & Receive, but set the ignore patterns to `*`.\r\n\r\n   ![image](https://user-images.githubusercontent.com/5626656/117575240-f0602c00-b11b-11eb-88e9-5122a3aa6a38.png)\r\n   ![image](https://user-images.githubusercontent.com/5626656/117575548-50a39d80-b11d-11eb-8aec-e397569fb36f.png)\r\n\r\n5. Add a new file to the folder on Device 2, and unignore it with `!`.\r\n\r\n   ![image](https://user-images.githubusercontent.com/5626656/117575256-04a42900-b11c-11eb-93f2-3e05547a46f6.png)\r\n\r\n6. Change the folder type on Device 1 to Send & Receive.\r\n\r\n   ![image](https://user-images.githubusercontent.com/5626656/117575311-31584080-b11c-11eb-8877-81065524a2b5.png)\r\n\r\n7. Remove the `!` exclusion from the ignore patterns on Device 2, so that everything is ignored again with `*`.\r\n\r\n   ![image](https://user-images.githubusercontent.com/5626656/117575379-77ad9f80-b11c-11eb-87e1-387e48a71b3c.png)\r\n\r\n   As you can see in the screenshot, the global state on Device 2 has been broken.\r\n\r\n8. Clear the ignore patterns on Device 2, so that there are no ignore patterns on both devices now.\r\n9. The final state looks like this, i.e both folders seem to think that they are up-to-date, but the are not.\r\n\r\n   ![image](https://user-images.githubusercontent.com/5626656/117575441-bf342b80-b11c-11eb-9a9a-d2023dad86a2.png)\r\n   ![image](https://user-images.githubusercontent.com/5626656/117575457-d07d3800-b11c-11eb-85f9-bb2a269e692a.png)\r\n\r\n**Edit**: Resetting deltas on Device 2 seems to get the folder states back to normal.","closed_by":{"login":"imsodin","id":15955093,"node_id":"MDQ6VXNlcjE1OTU1MDkz","avatar_url":"https://avatars.githubusercontent.com/u/15955093?v=4","gravatar_id":"","url":"https://api.github.com/users/imsodin","html_url":"https://github.com/imsodin","followers_url":"https://api.github.com/users/imsodin/followers","following_url":"https://api.github.com/users/imsodin/following{/other_user}","gists_url":"https://api.github.com/users/imsodin/gists{/gist_id}","starred_url":"https://api.github.com/users/imsodin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imsodin/subscriptions","organizations_url":"https://api.github.com/users/imsodin/orgs","repos_url":"https://api.github.com/users/imsodin/repos","events_url":"https://api.github.com/users/imsodin/events{/privacy}","received_events_url":"https://api.github.com/users/imsodin/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/syncthing/syncthing/issues/7649/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/syncthing/syncthing/issues/7649/timeline","performed_via_github_app":null,"state_reason":"completed"}