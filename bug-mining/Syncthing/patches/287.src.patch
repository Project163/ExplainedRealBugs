diff --git a/cmd/syncthing/main.go b/cmd/syncthing/main.go
index afb330470..475cc5383 100644
--- a/cmd/syncthing/main.go
+++ b/cmd/syncthing/main.go
@@ -601,7 +601,6 @@ func syncthingMain() {
 
 	m := model.NewModel(cfg, myID, myName, "syncthing", Version, ldb)
 	cfg.Subscribe(m)
-	mainSvc.Add(m)
 
 	if t := os.Getenv("STDEADLOCKTIMEOUT"); len(t) > 0 {
 		it, err := strconv.Atoi(t)
@@ -634,6 +633,8 @@ func syncthingMain() {
 		}
 	}
 
+	mainSvc.Add(m)
+
 	// GUI
 
 	setupGUI(mainSvc, cfg, m, apiSub)
diff --git a/internal/model/model.go b/internal/model/model.go
index 39956f978..2de748c42 100644
--- a/internal/model/model.go
+++ b/internal/model/model.go
@@ -179,6 +179,7 @@ func (m *Model) StartFolderRW(folder string) {
 		if !ok {
 			l.Fatalf("Requested versioning type %q that does not exist", cfg.Versioning.Type)
 		}
+
 		versioner := factory(folder, cfg.Path(), cfg.Versioning.Params)
 		if service, ok := versioner.(suture.Service); ok {
 			// The versioner implements the suture.Service interface, so
@@ -189,7 +190,7 @@ func (m *Model) StartFolderRW(folder string) {
 		p.versioner = versioner
 	}
 
-	go p.Serve()
+	m.Add(p)
 }
 
 // StartFolderRO starts read only processing on the current model. When in
diff --git a/test/h2/config.xml b/test/h2/config.xml
index 5bf45a9f4..e24e9011f 100644
--- a/test/h2/config.xml
+++ b/test/h2/config.xml
@@ -3,31 +3,31 @@
         <device id="I6KAH76-66SLLLB-5PFXSOA-UFJCDZC-YAOMLEK-CP2GB32-BV5RQST-3PSROAU"></device>
         <device id="JMFJCXB-GZDE4BN-OCJE3VF-65GYZNU-AIVJRET-3J6HMRQ-AUQIGJO-FKNHMQU"></device>
         <device id="373HSRP-QLPNLIE-JYKZVQF-P4PKZ63-R2ZE6K3-YD442U2-JHBGBQG-WWXAHAU"></device>
-        <versioning type="simple">
-            <param key="keep" val="5"></param>
+        <versioning type="trashcan">
+            <param key="cleanoutDays" val="1"></param>
         </versioning>
-        <lenientMtimes>false</lenientMtimes>
         <copiers>1</copiers>
         <pullers>16</pullers>
         <hashers>0</hashers>
+        <order>random</order>
     </folder>
     <folder id="s12" path="s12-2" ro="false" rescanIntervalS="15" ignorePerms="false" autoNormalize="true">
         <device id="I6KAH76-66SLLLB-5PFXSOA-UFJCDZC-YAOMLEK-CP2GB32-BV5RQST-3PSROAU"></device>
         <device id="JMFJCXB-GZDE4BN-OCJE3VF-65GYZNU-AIVJRET-3J6HMRQ-AUQIGJO-FKNHMQU"></device>
         <versioning></versioning>
-        <lenientMtimes>false</lenientMtimes>
         <copiers>1</copiers>
         <pullers>16</pullers>
         <hashers>0</hashers>
+        <order>random</order>
     </folder>
     <folder id="s23" path="s23-2" ro="false" rescanIntervalS="15" ignorePerms="false" autoNormalize="true">
         <device id="JMFJCXB-GZDE4BN-OCJE3VF-65GYZNU-AIVJRET-3J6HMRQ-AUQIGJO-FKNHMQU"></device>
         <device id="373HSRP-QLPNLIE-JYKZVQF-P4PKZ63-R2ZE6K3-YD442U2-JHBGBQG-WWXAHAU"></device>
         <versioning></versioning>
-        <lenientMtimes>false</lenientMtimes>
         <copiers>1</copiers>
         <pullers>16</pullers>
         <hashers>0</hashers>
+        <order>random</order>
     </folder>
     <device id="I6KAH76-66SLLLB-5PFXSOA-UFJCDZC-YAOMLEK-CP2GB32-BV5RQST-3PSROAU" name="s1" compression="metadata" introducer="false">
         <address>127.0.0.1:22001</address>
@@ -57,6 +57,7 @@
         <upnpEnabled>true</upnpEnabled>
         <upnpLeaseMinutes>0</upnpLeaseMinutes>
         <upnpRenewalMinutes>1</upnpRenewalMinutes>
+        <upnpTimeoutSeconds>10</upnpTimeoutSeconds>
         <urAccepted>-1</urAccepted>
         <urUniqueID></urUniqueID>
         <restartOnWakeup>true</restartOnWakeup>
@@ -66,5 +67,6 @@
         <progressUpdateIntervalS>5</progressUpdateIntervalS>
         <symlinksEnabled>true</symlinksEnabled>
         <limitBandwidthInLan>false</limitBandwidthInLan>
+        <databaseBlockCacheMiB>0</databaseBlockCacheMiB>
     </options>
 </configuration>
diff --git a/test/h3/config.xml b/test/h3/config.xml
index 060a531c4..716f9fc1c 100644
--- a/test/h3/config.xml
+++ b/test/h3/config.xml
@@ -1,24 +1,24 @@
-<configuration version="9">
-    <folder id="s23" path="s23-3" ro="false" rescanIntervalS="20" ignorePerms="false" autoNormalize="false">
+<configuration version="10">
+    <folder id="s23" path="s23-3" ro="false" rescanIntervalS="20" ignorePerms="false" autoNormalize="true">
         <device id="JMFJCXB-GZDE4BN-OCJE3VF-65GYZNU-AIVJRET-3J6HMRQ-AUQIGJO-FKNHMQU"></device>
         <device id="373HSRP-QLPNLIE-JYKZVQF-P4PKZ63-R2ZE6K3-YD442U2-JHBGBQG-WWXAHAU"></device>
         <versioning></versioning>
-        <lenientMtimes>false</lenientMtimes>
         <copiers>1</copiers>
         <pullers>16</pullers>
         <hashers>0</hashers>
+        <order>random</order>
     </folder>
-    <folder id="default" path="s3" ro="false" rescanIntervalS="20" ignorePerms="false" autoNormalize="false">
+    <folder id="default" path="s3" ro="false" rescanIntervalS="20" ignorePerms="false" autoNormalize="true">
         <device id="I6KAH76-66SLLLB-5PFXSOA-UFJCDZC-YAOMLEK-CP2GB32-BV5RQST-3PSROAU"></device>
         <device id="JMFJCXB-GZDE4BN-OCJE3VF-65GYZNU-AIVJRET-3J6HMRQ-AUQIGJO-FKNHMQU"></device>
         <device id="373HSRP-QLPNLIE-JYKZVQF-P4PKZ63-R2ZE6K3-YD442U2-JHBGBQG-WWXAHAU"></device>
         <versioning type="simple">
             <param key="keep" val="5"></param>
         </versioning>
-        <lenientMtimes>false</lenientMtimes>
         <copiers>1</copiers>
         <pullers>16</pullers>
         <hashers>0</hashers>
+        <order>random</order>
     </folder>
     <device id="I6KAH76-66SLLLB-5PFXSOA-UFJCDZC-YAOMLEK-CP2GB32-BV5RQST-3PSROAU" name="s1" compression="metadata" introducer="false">
         <address>127.0.0.1:22001</address>
@@ -48,6 +48,7 @@
         <upnpEnabled>false</upnpEnabled>
         <upnpLeaseMinutes>0</upnpLeaseMinutes>
         <upnpRenewalMinutes>30</upnpRenewalMinutes>
+        <upnpTimeoutSeconds>10</upnpTimeoutSeconds>
         <urAccepted>-1</urAccepted>
         <urUniqueID></urUniqueID>
         <restartOnWakeup>true</restartOnWakeup>
@@ -57,5 +58,6 @@
         <progressUpdateIntervalS>5</progressUpdateIntervalS>
         <symlinksEnabled>true</symlinksEnabled>
         <limitBandwidthInLan>false</limitBandwidthInLan>
+        <databaseBlockCacheMiB>0</databaseBlockCacheMiB>
     </options>
 </configuration>
