diff --git a/cmd/syncthing/main.go b/cmd/syncthing/main.go
index 1bd77e84e..eff5536f5 100644
--- a/cmd/syncthing/main.go
+++ b/cmd/syncthing/main.go
@@ -530,6 +530,14 @@ nextRepo:
 		}
 	}
 
+	// The default port we announce, possibly modified by setupUPnP next.
+
+	addr, err := net.ResolveTCPAddr("tcp", cfg.Options.ListenAddress[0])
+	if err != nil {
+		l.Fatalln("Bad listen address:", err)
+	}
+	externalPort = addr.Port
+
 	// UPnP
 
 	if cfg.Options.UPnPEnabled {
