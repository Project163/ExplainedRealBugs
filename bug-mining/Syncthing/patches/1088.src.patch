diff --git a/lib/model/folder.go b/lib/model/folder.go
index 8db1dfb58..b0e9d1fe2 100644
--- a/lib/model/folder.go
+++ b/lib/model/folder.go
@@ -460,13 +460,8 @@ func (f *folder) scanSubdirs(subDirs []string) error {
 			continue
 		}
 
-		if batch.full() {
-			if err := batch.flush(); err != nil {
-				return err
-			}
-			snap.Release()
-			snap = f.fset.Snapshot()
-			alreadyUsed = make(map[string]struct{})
+		if err := batch.flushIfFull(); err != nil {
+			return err
 		}
 
 		batch.append(res.File)
