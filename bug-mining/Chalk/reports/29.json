{"url":"https://api.github.com/repos/chalk/chalk/issues/500","repository_url":"https://api.github.com/repos/chalk/chalk","labels_url":"https://api.github.com/repos/chalk/chalk/issues/500/labels{/name}","comments_url":"https://api.github.com/repos/chalk/chalk/issues/500/comments","events_url":"https://api.github.com/repos/chalk/chalk/issues/500/events","html_url":"https://github.com/chalk/chalk/issues/500","id":956475560,"node_id":"MDU6SXNzdWU5NTY0NzU1NjA=","number":500,"title":"Missing `types` field in package.json","user":{"login":"dagerikhl","id":9092237,"node_id":"MDQ6VXNlcjkwOTIyMzc=","avatar_url":"https://avatars.githubusercontent.com/u/9092237?v=4","gravatar_id":"","url":"https://api.github.com/users/dagerikhl","html_url":"https://github.com/dagerikhl","followers_url":"https://api.github.com/users/dagerikhl/followers","following_url":"https://api.github.com/users/dagerikhl/following{/other_user}","gists_url":"https://api.github.com/users/dagerikhl/gists{/gist_id}","starred_url":"https://api.github.com/users/dagerikhl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dagerikhl/subscriptions","organizations_url":"https://api.github.com/users/dagerikhl/orgs","repos_url":"https://api.github.com/users/dagerikhl/repos","events_url":"https://api.github.com/users/dagerikhl/events{/privacy}","received_events_url":"https://api.github.com/users/dagerikhl/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2021-07-30T07:17:13Z","updated_at":"2021-07-31T20:24:09Z","closed_at":"2021-07-30T15:30:25Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hello! Great work on this library, I love using it.\r\n\r\nI've come across a bug that prevents type completion for the library, at least in my IntelliJ editor.\r\n\r\nThe library now serves its own `index.d.ts` typings file, which is superb, but it's not pointed to in package.json, which prevents editors (and possibly TS itself, unsure about that) from recognizing that those are the types for chalk.\r\n\r\nThe issue may be limited to IntelliJ, but I suspect the `types` attribute in package.json should be specified for any library shipping its own types.\r\n\r\n# To reproduce\r\n\r\n1. Install chalk in a clean and simple node JS project.\r\n2. Try to write e.g.:\r\n  ```\r\n  const chalk = require(\"chalk\");\r\n  chalk.blue(\"I am blue, and if I was green I would die\");\r\n  ```\r\n\r\n# Expected behaviour\r\n\r\n1. `chalk.blue` (and all other colors, converters, etc.) are autocompleted and possible to navigate to typings for.\r\n\r\n# Actual behaviour\r\n\r\n- `chalk` only presents three possible members: `.template, .stderr, .supportsColor` (in addition to the standard function members).\r\n\r\nWhat seems to happen is that the types are resolved by the `main` field in package.json instead, and the types exported there are not parsable in full. Ref. resolution order described here: https://www.typescriptlang.org/docs/handbook/declaration-files/dts-from-js.html#editing-the-packagejson\r\n\r\n# Findings\r\n\r\nRef. the resolution order above (`types` field > `main` field > index.d.ts in root), the `main` takes precedence and source/index.ts is chosen as the types root.\r\n\r\n## Possible fixes\r\n\r\n### Remove `main` field from package.json\r\n\r\nThis fixes the issue, and the types fall back to index.d.ts in root of the project.\r\n\r\nNow, obviously, I don't think this is a valid solution, `main` should remain. But included this just to illuminate the resolution order.\r\n\r\n### Add `types` field to package.json\r\n\r\nAdding `types: \"index.d.ts\"` to package.json (I tried by editing chalk's package.json directly in node_modules) fixes the issue.\r\n\r\nMy editor then resolves types for chalk to the typings file, instead of directly on index.js.\r\n\r\nI don't see any issues by adding this field, but I might be blind to some other concerns.\r\n\r\n\r\nHope this is something that can get addressed, and that I've provided enough information :)","closed_by":{"login":"sindresorhus","id":170270,"node_id":"MDQ6VXNlcjE3MDI3MA==","avatar_url":"https://avatars.githubusercontent.com/u/170270?v=4","gravatar_id":"","url":"https://api.github.com/users/sindresorhus","html_url":"https://github.com/sindresorhus","followers_url":"https://api.github.com/users/sindresorhus/followers","following_url":"https://api.github.com/users/sindresorhus/following{/other_user}","gists_url":"https://api.github.com/users/sindresorhus/gists{/gist_id}","starred_url":"https://api.github.com/users/sindresorhus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sindresorhus/subscriptions","organizations_url":"https://api.github.com/users/sindresorhus/orgs","repos_url":"https://api.github.com/users/sindresorhus/repos","events_url":"https://api.github.com/users/sindresorhus/events{/privacy}","received_events_url":"https://api.github.com/users/sindresorhus/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/chalk/chalk/issues/500/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/chalk/chalk/issues/500/timeline","performed_via_github_app":null,"state_reason":"completed"}