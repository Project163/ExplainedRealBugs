<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:19:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOGGING-37] [logging] LogFactory#getLogFactory should not look for method every time</title>
                <link>https://issues.apache.org/jira/browse/LOGGING-37</link>
                <project id="12310484" key="LOGGING">Commons Logging</project>
                    <description>&lt;p&gt;LogFactory checks for the existence of Thread#getContextClassLoader every time&lt;br/&gt;
#getLogFactory is invoked and does a reflective invocation. This is&lt;br/&gt;
unnecessarily expensive if many Log objects are created. An easy patch is to&lt;br/&gt;
remember the Method object; the lookup happens only once and it will massively&lt;br/&gt;
profit from reflection optimizations after a number of calls (a Java code stub&lt;br/&gt;
is generated by the reflection package).&lt;/p&gt;

&lt;p&gt;Patch:&lt;/p&gt;

&lt;p&gt;419a420,426&lt;br/&gt;
&amp;gt;     private static Method GET_CONTEXT_CLASS_LOADER = null;&lt;br/&gt;
&amp;gt;     static {&lt;br/&gt;
&amp;gt;       try &lt;/p&gt;
{
&amp;gt;         GET_CONTEXT_CLASS_LOADER = Thread.class.getMethod(&quot;getContextClassLoad
er&quot;, null);
&amp;gt;       }
&lt;p&gt; catch (NoSuchMethodException e) &lt;/p&gt;
{
&amp;gt;       }
&lt;p&gt;&amp;gt;     }&lt;br/&gt;
436,439c443&lt;br/&gt;
&amp;lt;         try {&lt;br/&gt;
&amp;lt;             // Are we running on a JDK 1.2 or later system?&lt;br/&gt;
&amp;lt;             Method method = Thread.class.getMethod(&quot;getContextClassLoader&quot;, nu&lt;br/&gt;
ll);&lt;br/&gt;
&amp;lt;&lt;br/&gt;
&amp;#8212;&lt;br/&gt;
&amp;gt;         if(GET_CONTEXT_CLASS_LOADER != null) &lt;/p&gt;
{
442c446
&amp;lt;                 classLoader = (ClassLoader)method.invoke(Thread.currentThread(
), null);
---
&amp;gt;                 classLoader = (ClassLoader)GET_CONTEXT_CLASS_LOADER.invoke(Thr
ead.currentThread(), null);
472c476
&amp;lt;         }
&lt;p&gt; catch (NoSuchMethodException e) &lt;/p&gt;
{
---
&amp;gt;         }
&lt;p&gt; else {&lt;/p&gt;</description>
                <environment>&lt;p&gt;Operating System: other&lt;br/&gt;
Platform: Other&lt;/p&gt;</environment>
        <key id="12342905">LOGGING-37</key>
            <summary>[logging] LogFactory#getLogFactory should not look for method every time</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="matthias.ernst@coremedia.com">Matthias Ernst</reporter>
                        <labels>
                    </labels>
                <created>Mon, 13 Feb 2006 07:23:59 +0000</created>
                <updated>Wed, 9 Jul 2014 20:14:33 +0000</updated>
                            <resolved>Fri, 27 Jun 2014 12:09:12 +0000</resolved>
                                    <version>1.0.4</version>
                                    <fixVersion>1.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12411414" author="matthias.ernst@coremedia.com" created="Mon, 13 Feb 2006 07:25:22 +0000"  >
&lt;p&gt;&amp;gt; &amp;gt;     private static Method GET_CONTEXT_CLASS_LOADER = null;&lt;/p&gt;

&lt;p&gt;Add a &quot;final&quot; there.&lt;/p&gt;</comment>
                            <comment id="12411415" author="skitching" created="Mon, 13 Feb 2006 10:31:23 +0000"  >&lt;p&gt;Nice idea, but unfortunately it&apos;s not quite that simple.&lt;/p&gt;

&lt;p&gt;The code&lt;br/&gt;
  Thread.class.getMethod&lt;br/&gt;
is currently in method directGetContextClassLoader that is invoked from method&lt;br/&gt;
getContextClassLoader via AccessController.doPrivileged.&lt;/p&gt;

&lt;p&gt;The use of SecurityController is for the case where the commons-logging.jar file&lt;br/&gt;
is signed and trusted to use reflection but the calling code is not.&lt;/p&gt;

&lt;p&gt;What happens if we move this call into a static initialisation block of the&lt;br/&gt;
LogFactory class?&lt;/p&gt;

&lt;p&gt;Is there any security on this call, or is the current use of AccessController&lt;br/&gt;
really just meant to wrap the Method.invoke call?&lt;/p&gt;

&lt;p&gt;If we perform this operation from the static initialisation block of the&lt;br/&gt;
LogFactory class, what are the security manager implications? I would &lt;b&gt;guess&lt;/b&gt;&lt;br/&gt;
that such an operation would be performed with the privileges of the class being&lt;br/&gt;
loaded, ie would be ok WITHOUT using an AccessController. However I don&apos;t know a&lt;br/&gt;
whole lot about this area..&lt;/p&gt;</comment>
                            <comment id="12411416" author="matthias.ernst@coremedia.com" created="Mon, 13 Feb 2006 16:06:39 +0000"  >&lt;p&gt;That is a valid concern that I didn&apos;t think about. I checked the specification&lt;br/&gt;
for #getMethod which would throw a SecurityException in two cases:&lt;br/&gt;
if a security manager would deny &lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;member access to Thread.class with scope PUBLIC&lt;/li&gt;
	&lt;li&gt;package access to java.lang&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I would suggest this would be a dysfunctional setup anyway. If you&apos;re really&lt;br/&gt;
concerned, wouldn&apos;t it be possible to wrap the Method lookup in a privileged&lt;br/&gt;
block as well?&lt;/p&gt;</comment>
                            <comment id="12411417" author="rdonkin@apache.org" created="Fri, 17 Feb 2006 05:47:28 +0000"  >&lt;p&gt;After consideration, I&apos;m not happy addressing this for this release.&lt;/p&gt;

&lt;p&gt;I would consider a performance patch with either extensive unit tests&lt;br/&gt;
(preferrably with security managers) or demonstration code (if it&apos;s not feasible&lt;br/&gt;
to easily codify into tests) once this release is out. If anyone feels like&lt;br/&gt;
contributing one, please attach to this bugzilla and reopen&lt;/p&gt;</comment>
                            <comment id="14043663" author="archie172" created="Wed, 25 Jun 2014 16:13:28 +0000"  >&lt;p&gt;I noticed this method consuming inordinate CPU on my system as well.&lt;/p&gt;

&lt;p&gt;Can the next release of commons-logging drop support for Java 1.1? If so then this issue can go away... simply invoke &lt;tt&gt;Thread.getContextClassLoader()&lt;/tt&gt; directly.&lt;/p&gt;</comment>
                            <comment id="14043881" author="tn" created="Wed, 25 Jun 2014 18:31:44 +0000"  >&lt;p&gt;I think it is reasonable to make a 1.2 release that drops java 1.1 support.&lt;/p&gt;</comment>
                            <comment id="14044752" author="sebb@apache.org" created="Thu, 26 Jun 2014 15:21:32 +0000"  >&lt;p&gt;Agreed, but we should only increase the Java version by the minimum necessary.&lt;/p&gt;</comment>
                            <comment id="14045884" author="tn" created="Fri, 27 Jun 2014 12:09:12 +0000"  >&lt;p&gt;Fixed in r1606041.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                        <customfieldname>Bugzilla Id</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38626</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>148217</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 21 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0d7uf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>75047</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>