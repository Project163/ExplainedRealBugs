<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:19:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOGGING-135] Thread-safety improvements</title>
                <link>https://issues.apache.org/jira/browse/LOGGING-135</link>
                <project id="12310484" key="LOGGING">Commons Logging</project>
                    <description>&lt;p&gt;The LogKitLogger.logger field is not final or volatile so changes are not guaranteed to be published.&lt;br/&gt;
This includes calls to getLogger(), so two different threads using the same instance can theoretically both create the logger.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12455662">LOGGING-135</key>
            <summary>Thread-safety improvements</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="sebb">Sebb</reporter>
                        <labels>
                    </labels>
                <created>Mon, 8 Feb 2010 18:00:41 +0000</created>
                <updated>Wed, 20 Mar 2013 20:11:47 +0000</updated>
                            <resolved>Wed, 20 Feb 2013 12:31:13 +0000</resolved>
                                                    <fixVersion>1.1.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13417351" author="sebb@apache.org" created="Wed, 18 Jul 2012 18:33:30 +0000"  >&lt;p&gt;Other problem fields include:&lt;/p&gt;

&lt;p&gt;AvalonLogger.defaultLogger&lt;/p&gt;

&lt;p&gt;SimpleLog - most fields&lt;/p&gt;

&lt;p&gt;Log4JLogger.logger&lt;/p&gt;</comment>
                            <comment id="13552264" author="tn" created="Sun, 13 Jan 2013 18:04:31 +0000"  >&lt;p&gt;Can this really happen, as the logger field is set in the constructor?&lt;br/&gt;
A second thread would only be able to use the LogKitLogger object after it has been created.&lt;/p&gt;</comment>
                            <comment id="13552955" author="sebb@apache.org" created="Mon, 14 Jan 2013 18:21:18 +0000"  >&lt;p&gt;If thread A creates the class and passes it to thread B (which already exists) there is no guarantee that thread B will see the same value as written by thread A (this is a consequence of the Java memory model, which allows for lots of hardware optimisations).&lt;/p&gt;

&lt;p&gt;Furthermore, the field is protected, so it can be changed at any later time. Unless the writer and reader threads synchronise on the same lock (or the field is made volatile), there is no guarantee that thread B will see what thread A wrote.&lt;/p&gt;</comment>
                            <comment id="13553623" author="tn" created="Tue, 15 Jan 2013 10:07:48 +0000"  >&lt;p&gt;I do not think the respective logger will be created multiple times, but retrieved from the underlying logging system.&lt;br/&gt;
In case the underlying system is flawed (e.g. not returning the same instance everytime it is called with the same name), this may create problems in the commons-logging wrapper, but otherwise the synchronisation may be a bottleneck.&lt;/p&gt;

&lt;p&gt;This only relates to the logger fields, SimpleLog may be a different case.&lt;/p&gt;</comment>
                            <comment id="13553697" author="sebb@apache.org" created="Tue, 15 Jan 2013 11:44:26 +0000"  >&lt;p&gt;I agree it&apos;s unlikely to occur, however that does not mean it cannot occur.&lt;br/&gt;
And if it does cause problems, debugging is likely to be extremely difficult.&lt;/p&gt;

&lt;p&gt;It may well be that all logger implementations return a singleton.&lt;br/&gt;
But writing to the protected logger field can still cause issues.&lt;/p&gt;

&lt;p&gt;At the very least the issue should be clearly documented.&lt;/p&gt;

&lt;p&gt;Making the variable volatile would solve the publication issue.&lt;br/&gt;
Ideally the variables should be private and final, but that would break compatibility.&lt;/p&gt;

&lt;p&gt;If logging is ever rewritten, it should use immutable classes as far as possible, and certainly no mutable protected or public fields.&lt;/p&gt;</comment>
                            <comment id="13553774" author="tn" created="Tue, 15 Jan 2013 13:07:45 +0000"  >&lt;p&gt;Yes I agree, also it is not clear why it is protected in the first place.&lt;br/&gt;
Some of the wrappers have it private (log4j, avalon), while others have it private.&lt;br/&gt;
Imho, there should be no reason to make it protected, and this should be fixed in future releases.&lt;/p&gt;</comment>
                            <comment id="13557156" author="tn" created="Fri, 18 Jan 2013 11:39:53 +0000"  >&lt;p&gt;Looking at the Log4JLogger, wouldn&apos;t it be better to always set the underlying logger in the constructor, and change the getLogger method in a way to just return the logger (similar to the AvalonLogger)?&lt;/p&gt;

&lt;p&gt;The null check looks unnecessary, as it should always be set in the constructor (its missing in the standard ctor, but could be added there too).&lt;/p&gt;

&lt;p&gt;The only thing that comes to my mind is that at creation time, the underlying log system may return null, but this would be odd anyway.&lt;/p&gt;</comment>
                            <comment id="13557187" author="tn" created="Fri, 18 Jan 2013 12:47:07 +0000"  >&lt;p&gt;Applied first bunch of changes in r1435115:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;SimpleLog:
	&lt;ul&gt;
		&lt;li&gt;made fields logName and shortLogName volatile -&amp;gt; should become private final in next major version&lt;/li&gt;
		&lt;li&gt;made modifiable field currentLogLevel volatile&lt;/li&gt;
		&lt;li&gt;made protected static fields showLogName, showShortName, showDateTime and dateTimeFormat volatile -&amp;gt; should become private in next major version with static getters?&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;AvalonLogger:
	&lt;ul&gt;
		&lt;li&gt;made static field defaultLogger volatile: there is already a static setter, so this should be fine&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Open:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Log4JLogger: logger field&lt;/li&gt;
	&lt;li&gt;LogKitLogger: logger field&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I would prefer to change the logger to a final field (Log4JLogger), always set the logger in the ctors and change the getLogger to just return the field. For LogKitLogger we can not set it final as it is a protected field, so adding volatile for now, and postpone for the next major version to change it to private.&lt;/p&gt;</comment>
                            <comment id="13558204" author="tn" created="Sun, 20 Jan 2013 08:34:15 +0000"  >&lt;p&gt;I missed that the loggers are serializable, thus the logic in the getLogger() makes sense (no need to re-initialize the transient logger fields in a readObject method, as it will be checked each access to getLogger).&lt;/p&gt;</comment>
                            <comment id="13582141" author="tn" created="Wed, 20 Feb 2013 12:31:14 +0000"  >&lt;p&gt;Applied the double-checked locking idiom from Josh Bloch (Item 71) for Log4JLogger and LogKitLogger (and changing the logger variable to volatile).&lt;/p&gt;

&lt;p&gt;This is not working reliably for pre-1.5 java but at least better than before.&lt;br/&gt;
We could also make the getLogger() methods synchronized, but this may have a negative effect on performance in certain environments.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>148312</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 39 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0d7hb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>74988</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>