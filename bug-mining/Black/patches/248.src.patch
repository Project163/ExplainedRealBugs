diff --git a/CHANGES.md b/CHANGES.md
index 3dc0c87..8fb8677 100644
--- a/CHANGES.md
+++ b/CHANGES.md
@@ -21,6 +21,7 @@
 - Remove empty lines before docstrings in async functions (#4132)
 - Address a missing case in the change to allow empty lines at the beginning of all
   blocks, except immediately before a docstring (#4130)
+- For stubs, fix logic to enforce empty line after nested classes with bodies (#4141)
 
 ### Configuration
 
diff --git a/src/black/lines.py b/src/black/lines.py
index b544c5e..9eb5785 100644
--- a/src/black/lines.py
+++ b/src/black/lines.py
@@ -640,15 +640,15 @@ def _maybe_empty_lines(self, current_line: Line) -> Tuple[int, int]:
         if previous_def is not None:
             assert self.previous_line is not None
             if self.mode.is_pyi:
-                if depth and not current_line.is_def and self.previous_line.is_def:
-                    # Empty lines between attributes and methods should be preserved.
-                    before = 1 if user_had_newline else 0
-                elif (
+                if (
                     Preview.blank_line_after_nested_stub_class in self.mode
                     and previous_def.is_class
                     and not previous_def.is_stub_class
                 ):
                     before = 1
+                elif depth and not current_line.is_def and self.previous_line.is_def:
+                    # Empty lines between attributes and methods should be preserved.
+                    before = 1 if user_had_newline else 0
                 elif depth:
                     before = 0
                 else:
diff --git a/tests/data/cases/nested_stub.py b/tests/data/cases/nested_stub.py
index b81549e..ef13c58 100644
--- a/tests/data/cases/nested_stub.py
+++ b/tests/data/cases/nested_stub.py
@@ -18,6 +18,18 @@ def function_definition(self): ...
         assignment = 1
     def f2(self) -> str: ...
 
+
+class TopLevel:
+    class Nested1:
+        foo: int
+        def bar(self): ...
+    field = 1
+
+    class Nested2:
+        def bar(self): ...
+        foo: int
+    field = 1
+
 # output
 
 import sys
@@ -41,4 +53,17 @@ def f1(self) -> str: ...
         def function_definition(self): ...
         assignment = 1
 
-    def f2(self) -> str: ...
\ No newline at end of file
+    def f2(self) -> str: ...
+
+class TopLevel:
+    class Nested1:
+        foo: int
+        def bar(self): ...
+
+    field = 1
+
+    class Nested2:
+        def bar(self): ...
+        foo: int
+
+    field = 1
