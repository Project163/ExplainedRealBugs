{"url":"https://api.github.com/repos/psf/black/issues/2506","repository_url":"https://api.github.com/repos/psf/black","labels_url":"https://api.github.com/repos/psf/black/issues/2506/labels{/name}","comments_url":"https://api.github.com/repos/psf/black/issues/2506/comments","events_url":"https://api.github.com/repos/psf/black/issues/2506/events","html_url":"https://github.com/psf/black/issues/2506","id":1006663355,"node_id":"I_kwDOB3dpmM48AHa7","number":2506,"title":"Custom cache directory to be thread/process safe","user":{"login":"percurnicus","id":12278722,"node_id":"MDQ6VXNlcjEyMjc4NzIy","avatar_url":"https://avatars.githubusercontent.com/u/12278722?v=4","gravatar_id":"","url":"https://api.github.com/users/percurnicus","html_url":"https://github.com/percurnicus","followers_url":"https://api.github.com/users/percurnicus/followers","following_url":"https://api.github.com/users/percurnicus/following{/other_user}","gists_url":"https://api.github.com/users/percurnicus/gists{/gist_id}","starred_url":"https://api.github.com/users/percurnicus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/percurnicus/subscriptions","organizations_url":"https://api.github.com/users/percurnicus/orgs","repos_url":"https://api.github.com/users/percurnicus/repos","events_url":"https://api.github.com/users/percurnicus/events{/privacy}","received_events_url":"https://api.github.com/users/percurnicus/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":867432796,"node_id":"MDU6TGFiZWw4Njc0MzI3OTY=","url":"https://api.github.com/repos/psf/black/labels/T:%20enhancement","name":"T: enhancement","color":"a2eeef","default":false,"description":"New feature or request"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2021-09-24T17:05:55Z","updated_at":"2022-01-22T06:00:33Z","closed_at":"2022-01-22T06:00:33Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Is your feature request related to a problem? Please describe.**\r\n\r\nThe cache files are not thread/process safe. I've checked multiple projects simultaneously in different processes but get permission errors when one process is writing to the cache while another is reading from it. On linux the fix is pretty easy: set a different temp directory for each process using the ``XDG_CACHE_HOME`` environment variable but there is no equivalent for Windows (there's somewhat an equivalent but you need a rather [specific setup](https://github.com/platformdirs/platformdirs/blob/main/src/platformdirs/windows.py#L157-L165) to use the environment variable).\r\n\r\n**Describe the solution you'd like**\r\n\r\nThe solution that will work for my use case (and I think is the least amount of changes) is to create a custom environment variable that overrides using platformdirs to get the cache directory. Think this could look like:\r\n```python\r\nCACHE_DIR = Path(os.environ.get(\"BLACK_CACHE_DIR\", user_cache_dir(\"black\", version=__version__)))\r\nif not CACHE_DIR.exists():\r\n    raise RuntimeError(f\"{CACHE_DIR} does not exist\")\r\n```\r\n\r\n**Describe alternatives you've considered**\r\n\r\n1. Add the command line option to turn off cacheing (as this ticket as #248 asked for) (guess is this  more work)\r\n2. Add command line option to set the cache directory (guess is this is more work but not a lot)\r\n3. Make the cache dir thread/process safe (guess is this is more work)","closed_by":{"login":"JelleZijlstra","id":906600,"node_id":"MDQ6VXNlcjkwNjYwMA==","avatar_url":"https://avatars.githubusercontent.com/u/906600?v=4","gravatar_id":"","url":"https://api.github.com/users/JelleZijlstra","html_url":"https://github.com/JelleZijlstra","followers_url":"https://api.github.com/users/JelleZijlstra/followers","following_url":"https://api.github.com/users/JelleZijlstra/following{/other_user}","gists_url":"https://api.github.com/users/JelleZijlstra/gists{/gist_id}","starred_url":"https://api.github.com/users/JelleZijlstra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JelleZijlstra/subscriptions","organizations_url":"https://api.github.com/users/JelleZijlstra/orgs","repos_url":"https://api.github.com/users/JelleZijlstra/repos","events_url":"https://api.github.com/users/JelleZijlstra/events{/privacy}","received_events_url":"https://api.github.com/users/JelleZijlstra/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/psf/black/issues/2506/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/psf/black/issues/2506/timeline","performed_via_github_app":null,"state_reason":"completed"}