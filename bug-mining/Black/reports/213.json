{"url":"https://api.github.com/repos/psf/black/issues/2567","repository_url":"https://api.github.com/repos/psf/black","labels_url":"https://api.github.com/repos/psf/black/issues/2567/labels{/name}","comments_url":"https://api.github.com/repos/psf/black/issues/2567/comments","events_url":"https://api.github.com/repos/psf/black/issues/2567/events","html_url":"https://github.com/psf/black/issues/2567","id":1036218455,"node_id":"I_kwDOB3dpmM49w3BX","number":2567,"title":"Black messes up indentation of else block after for-statement in fmt on/off block ","user":{"login":"jofrev","id":45565462,"node_id":"MDQ6VXNlcjQ1NTY1NDYy","avatar_url":"https://avatars.githubusercontent.com/u/45565462?v=4","gravatar_id":"","url":"https://api.github.com/users/jofrev","html_url":"https://github.com/jofrev","followers_url":"https://api.github.com/users/jofrev/followers","following_url":"https://api.github.com/users/jofrev/following{/other_user}","gists_url":"https://api.github.com/users/jofrev/gists{/gist_id}","starred_url":"https://api.github.com/users/jofrev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jofrev/subscriptions","organizations_url":"https://api.github.com/users/jofrev/orgs","repos_url":"https://api.github.com/users/jofrev/repos","events_url":"https://api.github.com/users/jofrev/events{/privacy}","received_events_url":"https://api.github.com/users/jofrev/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":3042738224,"node_id":"MDU6TGFiZWwzMDQyNzM4MjI0","url":"https://api.github.com/repos/psf/black/labels/F:%20fmtoff","name":"F: fmtoff","color":"BFD4F2","default":false,"description":"fmt: off implementation"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2021-10-26T12:08:33Z","updated_at":"2022-09-24T03:37:23Z","closed_at":"2022-09-24T03:37:23Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Black https://github.com/psf/black/commit/62ed53**\r\n\r\nThe MRE below shows the issue pretty clearly, I think, but there's also a [Playground][playground] available.  \r\nThe [docs](https://black.readthedocs.io/en/stable/the_black_code_style/current_style.html) state:\r\n\r\n> fmt: on/off have to be on the same level of indentation.\r\n\r\nSo this kind of single line block should be okay, shouldn't it? `#fmt: skip` didn't work for me, either.\r\n\r\nFor what it's worth, I came across this issue in a Docker container based on Ubuntu 20.04 with Python 3.8.10 and **black** v21.9b0. Only then, I tested against the latest main using the Playground.\r\n\r\n## Options\r\n\r\n`--line-length=88` -> this doesn't matter, I've only been using it in the Playground since it's a default there\r\n`--safe`\r\n\r\n## Input\r\n\r\n```python\r\n\r\nif True:\r\n    #fmt: off\r\n    for _ in range(1):\r\n    #fmt: on\r\n        print(\"This should get printed\")\r\nelse:\r\n    print(\"This shouldn't\")\r\n\r\n```\r\n\r\n## Output\r\n\r\nPlease take a look at the [Playground][playground] for the entire output, it seemed too long to post here.\r\n\r\nIf run with `--fast`, the reformatted file becomes:\r\n\r\n```python\r\n\r\nif True:\r\n    #fmt: off\r\n    for _ in range(1):\r\n    #fmt: on\r\n        print(\"This should get printed\")\r\n    else:\r\n        print(\"This shouldn't\")\r\n\r\n ```\r\n\r\nAs you can see, the `else` block gets indented, which is wrong although it's still valid Python.\r\n\r\n## Expected\r\n\r\n```python\r\n\r\nif True:\r\n    #fmt: off\r\n    for _ in range(1):\r\n    #fmt: on\r\n        print(\"This should get printed\")\r\nelse:\r\n    print(\"This shouldn't\")\r\n\r\n```\r\n\r\n[playground]: https://black.vercel.app/?version=main&state=_Td6WFoAAATm1rRGAgAhARYAAAB0L-Wj4ADwAI1dAD2IimZxl1N_Wk6tt2q7tSLl4fLzSlExTOe62cV85aNDqCpOaxXFob5mQnBW7EOhxkJcp094SrFs5Y2mbZBhnBBDIRKeZ7WUPqswGCaSh1Kgwf-UL39x7qWPSbj4lZBrvDxO53d1Yue-ugjbuqO46w2QtMSNhO74FMXBSsks1cHu704LieJUtTZFcGrEgAAAAAAaiPeLMc0-VQABqQHxAQAAvqY-_7HEZ_sCAAAAAARZWg==","closed_by":{"login":"JelleZijlstra","id":906600,"node_id":"MDQ6VXNlcjkwNjYwMA==","avatar_url":"https://avatars.githubusercontent.com/u/906600?v=4","gravatar_id":"","url":"https://api.github.com/users/JelleZijlstra","html_url":"https://github.com/JelleZijlstra","followers_url":"https://api.github.com/users/JelleZijlstra/followers","following_url":"https://api.github.com/users/JelleZijlstra/following{/other_user}","gists_url":"https://api.github.com/users/JelleZijlstra/gists{/gist_id}","starred_url":"https://api.github.com/users/JelleZijlstra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JelleZijlstra/subscriptions","organizations_url":"https://api.github.com/users/JelleZijlstra/orgs","repos_url":"https://api.github.com/users/JelleZijlstra/repos","events_url":"https://api.github.com/users/JelleZijlstra/events{/privacy}","received_events_url":"https://api.github.com/users/JelleZijlstra/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/psf/black/issues/2567/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/psf/black/issues/2567/timeline","performed_via_github_app":null,"state_reason":"completed"}