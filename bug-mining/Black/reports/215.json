{"url":"https://api.github.com/repos/psf/black/issues/3292","repository_url":"https://api.github.com/repos/psf/black","labels_url":"https://api.github.com/repos/psf/black/issues/3292/labels{/name}","comments_url":"https://api.github.com/repos/psf/black/issues/3292/comments","events_url":"https://api.github.com/repos/psf/black/issues/3292/events","html_url":"https://github.com/psf/black/issues/3292","id":1388182454,"node_id":"I_kwDOB3dpmM5Svfu2","number":3292,"title":"String processing: wrap concatenated strings in parens in all cases","user":{"login":"yilei","id":581947,"node_id":"MDQ6VXNlcjU4MTk0Nw==","avatar_url":"https://avatars.githubusercontent.com/u/581947?v=4","gravatar_id":"","url":"https://api.github.com/users/yilei","html_url":"https://github.com/yilei","followers_url":"https://api.github.com/users/yilei/followers","following_url":"https://api.github.com/users/yilei/following{/other_user}","gists_url":"https://api.github.com/users/yilei/gists{/gist_id}","starred_url":"https://api.github.com/users/yilei/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yilei/subscriptions","organizations_url":"https://api.github.com/users/yilei/orgs","repos_url":"https://api.github.com/users/yilei/repos","events_url":"https://api.github.com/users/yilei/events{/privacy}","received_events_url":"https://api.github.com/users/yilei/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":869135448,"node_id":"MDU6TGFiZWw4NjkxMzU0NDg=","url":"https://api.github.com/repos/psf/black/labels/T:%20style","name":"T: style","color":"0052cc","default":false,"description":"What do we want Blackened code to look like?"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2022-09-27T18:23:00Z","updated_at":"2022-10-27T01:03:15Z","closed_at":"2022-10-27T01:03:15Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Exending the dicussions in #3260 and #2553, I'd like to once more try to bring up the topic of how black should format concatenated strings.\r\n\r\nAfter a lot of reading and experimenting, I'm now in favor of always wrapping concatenated strings in parens, i.e. extending the cases from #3159 to all. Examples:\r\n\r\n```python\r\n# Unformatted:\r\nfunction_call(\r\n    \" lorem ipsum dolor sit amet consectetur adipiscing elit sed do eiusmod tempor incididunt ut labore et dolore magna aliqua Ut enim ad minim\",\r\n    \" veniam quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo\",\r\n)\r\nsome_list = [\r\n    \" lorem ipsum dolor sit amet consectetur adipiscing elit sed do eiusmod tempor incididunt ut labore et dolore magna aliqua Ut enim ad minim\",\r\n    \" veniam quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo\",\r\n]\r\n\r\n# v22.8.0 --preview:\r\nfunction_call(\r\n    \" lorem ipsum dolor sit amet consectetur adipiscing elit sed do eiusmod tempor\"\r\n    \" incididunt ut labore et dolore magna aliqua Ut enim ad minim\",\r\n    \" veniam quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo\",\r\n)\r\nsome_list = [\r\n    (\r\n        \" lorem ipsum dolor sit amet consectetur adipiscing elit sed do eiusmod tempor\"\r\n        \" incididunt ut labore et dolore magna aliqua Ut enim ad minim\"\r\n    ),\r\n    \" veniam quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo\",\r\n]\r\n\r\n# Proposed:\r\nfunction_call(\r\n    (\r\n        \" lorem ipsum dolor sit amet consectetur adipiscing elit sed do eiusmod tempor\"\r\n        \" incididunt ut labore et dolore magna aliqua Ut enim ad minim\"\r\n    ),\r\n    \" veniam quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo\",\r\n)\r\nsome_list = [\r\n    (\r\n        \" lorem ipsum dolor sit amet consectetur adipiscing elit sed do eiusmod tempor\"\r\n        \" incididunt ut labore et dolore magna aliqua Ut enim ad minim\"\r\n    ),\r\n    \" veniam quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo\",\r\n]\r\n```\r\n\r\nThis in turn makes #3260 and #2553 redundant/obsolete.\r\n\r\n## Pros\r\n\r\n1. Code is more readable since the extra indentation makes the scope more clear.\r\n2. Avoids common coding errors when commas are accidentally left-out or missed in function calls, and especially list/tuple/set literals.\r\n3. It's consistent no matter where the string appears. `--preview` (even without #3162) already does this in a few places:\r\n\r\n    ```python\r\n    def function():\r\n        value = \"a very long string a very long string a very long string a very long string a very long string a very long string\"\r\n        dct = {\"key\": \"a very long string a very long string a very long string a very long string a very long string a very long string\"}\r\n        return (\r\n            \"a very long string a very long string a very long string a very long string a\"\r\n            \" very long string a very long string\"\r\n        )\r\n\r\n    # output:\r\n    def function():\r\n        value = (\r\n            \"a very long string a very long string a very long string a very long string a\"\r\n            \" very long string a very long string\"\r\n        )\r\n        dct = {\r\n            \"key\": (\r\n                \"a very long string a very long string a very long string a very long\"\r\n                \" string a very long string a very long string\"\r\n            )\r\n        }\r\n        return (\r\n            \"a very long string a very long string a very long string a very long string a\"\r\n            \" very long string a very long string\"\r\n        )\r\n    ```\r\n4. It's much easier to explain _Black_'s behavior: if a string (after merging implicitly or explicitly concated parts)\r\n exceeds the line length, it's wrapped in parens then split. (FWIW, *this is the point that finally convinces me we should adopt this approach*.)\r\n\r\n## Cons\r\n\r\n1. It can introduce decent amount of diffs\r\n\r\n## How about explicit concatenation *without* parens?\r\n\r\nIt introduces somewhat less amount of diffs, but the formatting is less readable some cases:\r\n\r\n```python\r\nsome_list = [\r\n    \" lorem ipsum dolor sit amet consectetur adipiscing elit sed do eiusmod tempor\"\r\n    + \" incididunt ut labore et dolore magna aliqua Ut enim ad minim\",\r\n    \" veniam quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo\",\r\n]\r\n\r\n## Modified example from https://github.com/psf/black/blob/main/tests/data/preview/long_strings__regression.py\r\nclass A:\r\n    def append(self):\r\n        if True:\r\n            xxxx.xxxxxxx.xxxxx(\r\n                \"xxxxxxxxxx xxxx xx xxxxxx xxxxxxxxxx xxxx xx xxxxxx xxxxxxxxxx xxxx xx\"\r\n                + \" xxxxxx (%x) xx %x xxxx xx xxx %x.xx\"\r\n                % (len(self) + 1, xxxx.xxxxxxxxxx, xxxx.xxxxxxxxxx)\r\n                + \" %.3f (%s) to %.3f (%s).\\n\"\r\n                % (\r\n                    xxxx.xxxxxxxxx,\r\n                    xxxx.xxxxxxxxxxxxxx(xxxx.xxxxxxxxx),\r\n                    x,\r\n                    xxxx.xxxxxxxxxxxxxx(xx),\r\n                )\r\n            )\r\n\r\n```\r\n\r\n## How about explicit concatenation *with* parens?\r\n\r\nSince it's already wrapped in parens, the explicit concatenation is redundant and doesn't\r\nincrease readability (and also occupies two extra columns).\r\n\r\n## How about keep organising parens added by users?\r\n\r\nSince Black removes parens if the string fits on a single line, keeping organising parens\r\nhas the similar issue as the magic-trailing-comma: https://github.com/psf/black/pull/2237#issuecomment-850861722.\r\n\r\ncc @felix-hilden @JelleZijlstra @ichard26 \r\n","closed_by":{"login":"JelleZijlstra","id":906600,"node_id":"MDQ6VXNlcjkwNjYwMA==","avatar_url":"https://avatars.githubusercontent.com/u/906600?v=4","gravatar_id":"","url":"https://api.github.com/users/JelleZijlstra","html_url":"https://github.com/JelleZijlstra","followers_url":"https://api.github.com/users/JelleZijlstra/followers","following_url":"https://api.github.com/users/JelleZijlstra/following{/other_user}","gists_url":"https://api.github.com/users/JelleZijlstra/gists{/gist_id}","starred_url":"https://api.github.com/users/JelleZijlstra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JelleZijlstra/subscriptions","organizations_url":"https://api.github.com/users/JelleZijlstra/orgs","repos_url":"https://api.github.com/users/JelleZijlstra/repos","events_url":"https://api.github.com/users/JelleZijlstra/events{/privacy}","received_events_url":"https://api.github.com/users/JelleZijlstra/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/psf/black/issues/3292/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/psf/black/issues/3292/timeline","performed_via_github_app":null,"state_reason":"completed"}