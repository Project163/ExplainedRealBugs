{"url":"https://api.github.com/repos/psf/black/issues/2964","repository_url":"https://api.github.com/repos/psf/black","labels_url":"https://api.github.com/repos/psf/black/issues/2964/labels{/name}","comments_url":"https://api.github.com/repos/psf/black/issues/2964/comments","events_url":"https://api.github.com/repos/psf/black/issues/2964/events","html_url":"https://github.com/psf/black/issues/2964","id":1183788875,"node_id":"I_kwDOB3dpmM5Gjy9L","number":2964,"title":"Incompatible with click 8.1.0 (ImportError: cannot import name '_unicodefun' from 'click')","user":{"login":"stumpylog","id":797416,"node_id":"MDQ6VXNlcjc5NzQxNg==","avatar_url":"https://avatars.githubusercontent.com/u/797416?v=4","gravatar_id":"","url":"https://api.github.com/users/stumpylog","html_url":"https://github.com/stumpylog","followers_url":"https://api.github.com/users/stumpylog/followers","following_url":"https://api.github.com/users/stumpylog/following{/other_user}","gists_url":"https://api.github.com/users/stumpylog/gists{/gist_id}","starred_url":"https://api.github.com/users/stumpylog/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stumpylog/subscriptions","organizations_url":"https://api.github.com/users/stumpylog/orgs","repos_url":"https://api.github.com/users/stumpylog/repos","events_url":"https://api.github.com/users/stumpylog/events{/privacy}","received_events_url":"https://api.github.com/users/stumpylog/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":867432792,"node_id":"MDU6TGFiZWw4Njc0MzI3OTI=","url":"https://api.github.com/repos/psf/black/labels/T:%20bug","name":"T: bug","color":"d73a4a","default":false,"description":"Something isn't working"},{"id":1348565447,"node_id":"MDU6TGFiZWwxMzQ4NTY1NDQ3","url":"https://api.github.com/repos/psf/black/labels/C:%20packaging","name":"C: packaging","color":"AB5709","default":false,"description":"Installation and packaging of Black"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":40,"created_at":"2022-03-28T17:59:10Z","updated_at":"2022-08-21T21:30:27Z","closed_at":"2022-03-28T19:01:13Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Please use Black 22.3.0 (or newer) which was just released to fix this issue or pin Click to 8.0.0, 8.0.1, 8.0.2, 8.0.3, or 8.0.4.\r\n\r\n~ @ichard26 at March 28 3:15 PM EST\r\n\r\n---\r\n\r\nSo hey y'all, CI is broken eh?\r\n\r\nAnyway, we are aware the most recent release of Click, 8.1.0, is breaking Black. This is because Black imports an internal module so Python 3.6 users with misconfigured LANG continues to work mostly properly. The code that patches click was supposed to be resilient to the module disappearing but the code was catching the wrong exception. \r\n\r\n**To unbreak your CI, please pin Click to 8.0.0, 8.0.1, 8.0.2, 8.0.3, or 8.0.4. We are working on a more longterm fix (probably fixing the patching code or getting rid of it entirely) and will try to get a release out soon.**\r\n\r\n~ @ichard26 at March 28 2:29 PM EST\r\n\r\n---\r\n\r\n**Describe the bug**\r\n\r\nThe Github Action step:\r\n\r\n```\r\n- name: Run black\r\n  uses: psf/black@stable\r\n  with:\r\n     options: \"--check --diff\"\r\n      version: \"22.1.0\"\r\n```\r\n\r\nfails with the following trackeback:\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"/home/runner/work/_actions/psf/black/stable/.black-env/bin/black\", line 8, in <module>\r\n    sys.exit(patched_main())\r\n  File \"src/black/__init__.py\", line 1423, in patched_main\r\n  File \"src/black/__init__.py\", line 1[40](https://github.com/stumpylog/paperless-ngx/runs/5724998040?check_suite_focus=true#step:7:40)9, in patch_click\r\nImportError: cannot import name '_unicodefun' from 'click' (/home/runner/work/_actions/psf/black/stable/.black-env/lib/python3.8/site-packages/click/__init__.py)\r\n```\r\n\r\n**To Reproduce**\r\n\r\nRun the `black` action on a Github runner, configured as above.\r\n\r\n**Expected behavior**\r\n\r\nThe action should only fail if files are not formatted.\r\n\r\n**Environment**\r\n\r\nOS: `runs-on: ubuntu-20.04`\r\nVersion: `22.1.0`\r\nAction: `@stable`\r\nPython version: `3.8` I believe\r\n\r\n**Additional context**\r\n","closed_by":{"login":"JelleZijlstra","id":906600,"node_id":"MDQ6VXNlcjkwNjYwMA==","avatar_url":"https://avatars.githubusercontent.com/u/906600?v=4","gravatar_id":"","url":"https://api.github.com/users/JelleZijlstra","html_url":"https://github.com/JelleZijlstra","followers_url":"https://api.github.com/users/JelleZijlstra/followers","following_url":"https://api.github.com/users/JelleZijlstra/following{/other_user}","gists_url":"https://api.github.com/users/JelleZijlstra/gists{/gist_id}","starred_url":"https://api.github.com/users/JelleZijlstra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JelleZijlstra/subscriptions","organizations_url":"https://api.github.com/users/JelleZijlstra/orgs","repos_url":"https://api.github.com/users/JelleZijlstra/repos","events_url":"https://api.github.com/users/JelleZijlstra/events{/privacy}","received_events_url":"https://api.github.com/users/JelleZijlstra/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/psf/black/issues/2964/reactions","total_count":240,"+1":220,"-1":0,"laugh":0,"hooray":7,"confused":5,"heart":3,"rocket":5,"eyes":0},"timeline_url":"https://api.github.com/repos/psf/black/issues/2964/timeline","performed_via_github_app":null,"state_reason":"completed"}