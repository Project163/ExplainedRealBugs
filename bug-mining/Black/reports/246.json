{"url":"https://api.github.com/repos/psf/black/issues/4043","repository_url":"https://api.github.com/repos/psf/black","labels_url":"https://api.github.com/repos/psf/black/issues/4043/labels{/name}","comments_url":"https://api.github.com/repos/psf/black/issues/4043/comments","events_url":"https://api.github.com/repos/psf/black/issues/4043/events","html_url":"https://github.com/psf/black/issues/4043","id":1990065965,"node_id":"I_kwDOB3dpmM52nf8t","number":4043,"title":"Newlines after code block open, once and for all?","user":{"login":"hauntsaninja","id":12621235,"node_id":"MDQ6VXNlcjEyNjIxMjM1","avatar_url":"https://avatars.githubusercontent.com/u/12621235?v=4","gravatar_id":"","url":"https://api.github.com/users/hauntsaninja","html_url":"https://github.com/hauntsaninja","followers_url":"https://api.github.com/users/hauntsaninja/followers","following_url":"https://api.github.com/users/hauntsaninja/following{/other_user}","gists_url":"https://api.github.com/users/hauntsaninja/gists{/gist_id}","starred_url":"https://api.github.com/users/hauntsaninja/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hauntsaninja/subscriptions","organizations_url":"https://api.github.com/users/hauntsaninja/orgs","repos_url":"https://api.github.com/users/hauntsaninja/repos","events_url":"https://api.github.com/users/hauntsaninja/events{/privacy}","received_events_url":"https://api.github.com/users/hauntsaninja/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2023-11-13T07:52:46Z","updated_at":"2023-12-28T07:38:55Z","closed_at":"2023-12-10T02:29:10Z","author_association":"COLLABORATOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Background:\r\n- https://github.com/psf/black/issues/902\r\n  Original issue, with some follow-up comments post merge\r\n- https://github.com/psf/black/pull/3035\r\n  Original implementation\r\n- https://github.com/psf/black/issues/3551\r\n  Follow-up issue\r\n- https://github.com/psf/black/pull/3967 \r\n  Recent preview change partially walking things back\r\n- https://github.com/psf/black/issues/619#issuecomment-1792996633\r\n  Discussion about PEP 8\r\n\r\n(there's discussion elsewhere too, but I think these are the most important links)\r\n\r\n---\r\n\r\ntldr; the 2023 stable style strips newlines after code block opens. This has proven controversial (and was most of the change from 22 to 23 by volume). Recently, we walked this back a little bit in preview style, but we should try to get it right for 24.\r\n\r\nThe main argument against is it can hurt readability, see https://github.com/psf/black/issues/902#issuecomment-1425713025 . I'm quite sympathetic to this. For instance, functions with a complicated return type and first statement can get quite dense. Similarly, there are examples with comments in a new code block where things can get too dense.\r\n\r\nAn auxiliary argument against it is that stripping new lines between `class` and first method is in violation of a close reading and changelog analysis of PEP 8, see https://github.com/psf/black/issues/619#issuecomment-1792996633. I don't care much for PEP 8 absolutism (and certainly not at the expense of churning established behaviour), but I consider it a nice-to-have to not reformat away from it.\r\n\r\nRecently in https://github.com/psf/black/pull/3967, Henri contributed a nice change that walks this back in some cases, involving comments or compound statements. However, I'm not sure this is enough. [Here are two examples from the first few pages of Black 22 -> 23 diff in my work codebase where I feel readability really suffers](https://black.vercel.app/?version=stable&state=_Td6WFoAAATm1rRGAgAhARYAAAB0L-Wj4ARDAb9dAD2IimZxl1N_WlbvK5V-fnaWIwL5TYBadve5dORVlMpn2CM7Ex6036-fmBvZZxxU7M4SzueDveXQyyVCyVj-_SI8G5MhyXK3nNLHUmR1qpfo3F4ciXU1BMotQs0XgWgkBVKnr_rKC7aIr11sgQsmB5Vap7pzA0R4M5007ghia_366U1-hEjwpaB66-Lkb9ZsEQGd_I3HS8XCUyn1O9pe47U_JM9qrygevkU8y8MHi42r1FAGT-KAUg8Rw7JMVMPhspr1cpS3BzKbGToLSkpjYcCJCj70GUsfc-SKPPQf6n9nHSnwHTurwtoO8zChj8UkwEuEK_PzkD2G_pjTZTi2pwy8tqqwW4_Sg7NqddQaPn1JDfnMvajayo16d3g90jDv7alCLxL4CghJEpl5sU2gaWINat_wzfhsHjDOd77doe6GceCBcWuklNcdz1KAT8N7e_h68QFQcENH51Z8nzi6Nsk0ViOJ7WcYti9iYfIqrura2wKKSmLKz1FVErFWWojvd07WdSB1M2nGrsld_aGwOC7R7wb84ks5wpovY1jSZdnLj1QgrWWAB8ns3Zvi7HnLsmBGxIFV2EtqyAyKkQswAAAAs1goWJRFiskAAdsDxAgAAAhqMAuxxGf7AgAAAAAEWVo=) (scrolling through I see many others). Henri's change won't save us here. And fundamentally this code is quite simple, it just has slightly long type and variable names, i.e. it's not the kind of code where there should have been a comment or something.\r\n\r\n---\r\n\r\nJelle nudged me to think about this, and I now feel we should just walk this change back entirely. We should allow users to have either 0 or 1 blank newlines. This is also simpler and more explainable than the partially walked back logic.\r\n\r\nI am fine with continuing to strip blank newlines between a function declaration and its docstring (and preview does this for classes as well). We currently enforce one blank newline after class and module docstrings. We don't have an opinion on blank newlines after function docstrings (see https://github.com/psf/black/issues/2370). I think this is probably fine as-is and not having an opinion would be consistent with the proposed no docstring case. (I'll grant that it feels easier to come up with a good opinion for the post docstring blank line in functions. At the very least, we certainly should not resolve that issue by always removing blank lines).\r\n\r\nThis will not create any churn going from 23 -> 24 (in fact, most of this change technically even meets our stability policy (although any change here should certainly only be made in preview style)).\r\n\r\n---\r\n\r\nAs a meta thing, as a relatively new maintainer of Black, I'm still unsure of my decision making framework. I feel the original change had at most marginal benefit, especially given its churn (I've never browsed code and been like ugh one extra blank line, nor has any code reviewer or linter ever yelled at me for it. These are the things Black usually saves me from. All the motivating changes I found have multiple blank newlines or are toy code). On the other hand, it's very costly to revert changes in stable style. The only thing that makes it possible in this case is that both unreverted and reverted formatting will be valid and inconsistency in this specific case is not costly.","closed_by":{"login":"JelleZijlstra","id":906600,"node_id":"MDQ6VXNlcjkwNjYwMA==","avatar_url":"https://avatars.githubusercontent.com/u/906600?v=4","gravatar_id":"","url":"https://api.github.com/users/JelleZijlstra","html_url":"https://github.com/JelleZijlstra","followers_url":"https://api.github.com/users/JelleZijlstra/followers","following_url":"https://api.github.com/users/JelleZijlstra/following{/other_user}","gists_url":"https://api.github.com/users/JelleZijlstra/gists{/gist_id}","starred_url":"https://api.github.com/users/JelleZijlstra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JelleZijlstra/subscriptions","organizations_url":"https://api.github.com/users/JelleZijlstra/orgs","repos_url":"https://api.github.com/users/JelleZijlstra/repos","events_url":"https://api.github.com/users/JelleZijlstra/events{/privacy}","received_events_url":"https://api.github.com/users/JelleZijlstra/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/psf/black/issues/4043/reactions","total_count":15,"+1":8,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":6,"rocket":1,"eyes":0},"timeline_url":"https://api.github.com/repos/psf/black/issues/4043/timeline","performed_via_github_app":null,"state_reason":"completed"}