[{"url":"https://api.github.com/repos/psf/black/issues/comments/455582486","html_url":"https://github.com/psf/black/issues/671#issuecomment-455582486","issue_url":"https://api.github.com/repos/psf/black/issues/671","id":455582486,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1NTU4MjQ4Ng==","user":{"login":"georgeaf99","id":5133801,"node_id":"MDQ6VXNlcjUxMzM4MDE=","avatar_url":"https://avatars.githubusercontent.com/u/5133801?v=4","gravatar_id":"","url":"https://api.github.com/users/georgeaf99","html_url":"https://github.com/georgeaf99","followers_url":"https://api.github.com/users/georgeaf99/followers","following_url":"https://api.github.com/users/georgeaf99/following{/other_user}","gists_url":"https://api.github.com/users/georgeaf99/gists{/gist_id}","starred_url":"https://api.github.com/users/georgeaf99/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/georgeaf99/subscriptions","organizations_url":"https://api.github.com/users/georgeaf99/orgs","repos_url":"https://api.github.com/users/georgeaf99/repos","events_url":"https://api.github.com/users/georgeaf99/events{/privacy}","received_events_url":"https://api.github.com/users/georgeaf99/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-18T15:22:32Z","updated_at":"2019-01-18T15:22:32Z","body":"Just ran into the same issue; thanks for writing up the issue!","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/psf/black/issues/comments/455582486/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"georgeaf99","id":5133801,"node_id":"MDQ6VXNlcjUxMzM4MDE=","avatar_url":"https://avatars.githubusercontent.com/u/5133801?v=4","gravatar_id":"","url":"https://api.github.com/users/georgeaf99","html_url":"https://github.com/georgeaf99","followers_url":"https://api.github.com/users/georgeaf99/followers","following_url":"https://api.github.com/users/georgeaf99/following{/other_user}","gists_url":"https://api.github.com/users/georgeaf99/gists{/gist_id}","starred_url":"https://api.github.com/users/georgeaf99/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/georgeaf99/subscriptions","organizations_url":"https://api.github.com/users/georgeaf99/orgs","repos_url":"https://api.github.com/users/georgeaf99/repos","events_url":"https://api.github.com/users/georgeaf99/events{/privacy}","received_events_url":"https://api.github.com/users/georgeaf99/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":2085024473,"node_id":"MDEyOkxhYmVsZWRFdmVudDIwODUwMjQ0NzM=","url":"https://api.github.com/repos/psf/black/issues/events/2085024473","actor":{"login":"zsol","id":66740,"node_id":"MDQ6VXNlcjY2NzQw","avatar_url":"https://avatars.githubusercontent.com/u/66740?v=4","gravatar_id":"","url":"https://api.github.com/users/zsol","html_url":"https://github.com/zsol","followers_url":"https://api.github.com/users/zsol/followers","following_url":"https://api.github.com/users/zsol/following{/other_user}","gists_url":"https://api.github.com/users/zsol/gists{/gist_id}","starred_url":"https://api.github.com/users/zsol/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zsol/subscriptions","organizations_url":"https://api.github.com/users/zsol/orgs","repos_url":"https://api.github.com/users/zsol/repos","events_url":"https://api.github.com/users/zsol/events{/privacy}","received_events_url":"https://api.github.com/users/zsol/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2019-01-20T15:45:31Z","label":{"name":"bug","color":"d73a4a"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/psf/black/issues/comments/455877104","html_url":"https://github.com/psf/black/issues/671#issuecomment-455877104","issue_url":"https://api.github.com/repos/psf/black/issues/671","id":455877104,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1NTg3NzEwNA==","user":{"login":"zsol","id":66740,"node_id":"MDQ6VXNlcjY2NzQw","avatar_url":"https://avatars.githubusercontent.com/u/66740?v=4","gravatar_id":"","url":"https://api.github.com/users/zsol","html_url":"https://github.com/zsol","followers_url":"https://api.github.com/users/zsol/followers","following_url":"https://api.github.com/users/zsol/following{/other_user}","gists_url":"https://api.github.com/users/zsol/gists{/gist_id}","starred_url":"https://api.github.com/users/zsol/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zsol/subscriptions","organizations_url":"https://api.github.com/users/zsol/orgs","repos_url":"https://api.github.com/users/zsol/repos","events_url":"https://api.github.com/users/zsol/events{/privacy}","received_events_url":"https://api.github.com/users/zsol/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-20T15:45:45Z","updated_at":"2019-01-20T15:45:45Z","body":"I can also repro.","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/psf/black/issues/comments/455877104/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"zsol","id":66740,"node_id":"MDQ6VXNlcjY2NzQw","avatar_url":"https://avatars.githubusercontent.com/u/66740?v=4","gravatar_id":"","url":"https://api.github.com/users/zsol","html_url":"https://github.com/zsol","followers_url":"https://api.github.com/users/zsol/followers","following_url":"https://api.github.com/users/zsol/following{/other_user}","gists_url":"https://api.github.com/users/zsol/gists{/gist_id}","starred_url":"https://api.github.com/users/zsol/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zsol/subscriptions","organizations_url":"https://api.github.com/users/zsol/orgs","repos_url":"https://api.github.com/users/zsol/repos","events_url":"https://api.github.com/users/zsol/events{/privacy}","received_events_url":"https://api.github.com/users/zsol/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":2140858257,"node_id":"MDEyOkxhYmVsZWRFdmVudDIxNDA4NTgyNTc=","url":"https://api.github.com/repos/psf/black/issues/events/2140858257","actor":{"login":"zsol","id":66740,"node_id":"MDQ6VXNlcjY2NzQw","avatar_url":"https://avatars.githubusercontent.com/u/66740?v=4","gravatar_id":"","url":"https://api.github.com/users/zsol","html_url":"https://github.com/zsol","followers_url":"https://api.github.com/users/zsol/followers","following_url":"https://api.github.com/users/zsol/following{/other_user}","gists_url":"https://api.github.com/users/zsol/gists{/gist_id}","starred_url":"https://api.github.com/users/zsol/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zsol/subscriptions","organizations_url":"https://api.github.com/users/zsol/orgs","repos_url":"https://api.github.com/users/zsol/repos","events_url":"https://api.github.com/users/zsol/events{/privacy}","received_events_url":"https://api.github.com/users/zsol/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2019-02-14T21:00:22Z","label":{"name":"invalid code","color":"ff0000"},"performed_via_github_app":null},{"actor":{"login":"zsol","id":66740,"node_id":"MDQ6VXNlcjY2NzQw","avatar_url":"https://avatars.githubusercontent.com/u/66740?v=4","gravatar_id":"","url":"https://api.github.com/users/zsol","html_url":"https://github.com/zsol","followers_url":"https://api.github.com/users/zsol/followers","following_url":"https://api.github.com/users/zsol/following{/other_user}","gists_url":"https://api.github.com/users/zsol/gists{/gist_id}","starred_url":"https://api.github.com/users/zsol/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zsol/subscriptions","organizations_url":"https://api.github.com/users/zsol/orgs","repos_url":"https://api.github.com/users/zsol/repos","events_url":"https://api.github.com/users/zsol/events{/privacy}","received_events_url":"https://api.github.com/users/zsol/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-02-14T21:00:56Z","updated_at":"2019-02-14T21:00:56Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/psf/black/issues/612","repository_url":"https://api.github.com/repos/psf/black","labels_url":"https://api.github.com/repos/psf/black/issues/612/labels{/name}","comments_url":"https://api.github.com/repos/psf/black/issues/612/comments","events_url":"https://api.github.com/repos/psf/black/issues/612/events","html_url":"https://github.com/psf/black/issues/612","id":382186911,"node_id":"MDU6SXNzdWUzODIxODY5MTE=","number":612,"title":"Invalid code when comments inside import statement parentheses","user":{"login":"fredley","id":270631,"node_id":"MDQ6VXNlcjI3MDYzMQ==","avatar_url":"https://avatars.githubusercontent.com/u/270631?v=4","gravatar_id":"","url":"https://api.github.com/users/fredley","html_url":"https://github.com/fredley","followers_url":"https://api.github.com/users/fredley/followers","following_url":"https://api.github.com/users/fredley/following{/other_user}","gists_url":"https://api.github.com/users/fredley/gists{/gist_id}","starred_url":"https://api.github.com/users/fredley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fredley/subscriptions","organizations_url":"https://api.github.com/users/fredley/orgs","repos_url":"https://api.github.com/users/fredley/repos","events_url":"https://api.github.com/users/fredley/events{/privacy}","received_events_url":"https://api.github.com/users/fredley/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2018-11-19T12:10:52Z","updated_at":"2019-02-14T21:00:57Z","closed_at":"2019-02-14T21:00:56Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":125266328,"node_id":"MDEwOlJlcG9zaXRvcnkxMjUyNjYzMjg=","name":"black","full_name":"psf/black","private":false,"owner":{"login":"psf","id":50630501,"node_id":"MDEyOk9yZ2FuaXphdGlvbjUwNjMwNTAx","avatar_url":"https://avatars.githubusercontent.com/u/50630501?v=4","gravatar_id":"","url":"https://api.github.com/users/psf","html_url":"https://github.com/psf","followers_url":"https://api.github.com/users/psf/followers","following_url":"https://api.github.com/users/psf/following{/other_user}","gists_url":"https://api.github.com/users/psf/gists{/gist_id}","starred_url":"https://api.github.com/users/psf/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/psf/subscriptions","organizations_url":"https://api.github.com/users/psf/orgs","repos_url":"https://api.github.com/users/psf/repos","events_url":"https://api.github.com/users/psf/events{/privacy}","received_events_url":"https://api.github.com/users/psf/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/psf/black","description":"The uncompromising Python code formatter","fork":false,"url":"https://api.github.com/repos/psf/black","forks_url":"https://api.github.com/repos/psf/black/forks","keys_url":"https://api.github.com/repos/psf/black/keys{/key_id}","collaborators_url":"https://api.github.com/repos/psf/black/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/psf/black/teams","hooks_url":"https://api.github.com/repos/psf/black/hooks","issue_events_url":"https://api.github.com/repos/psf/black/issues/events{/number}","events_url":"https://api.github.com/repos/psf/black/events","assignees_url":"https://api.github.com/repos/psf/black/assignees{/user}","branches_url":"https://api.github.com/repos/psf/black/branches{/branch}","tags_url":"https://api.github.com/repos/psf/black/tags","blobs_url":"https://api.github.com/repos/psf/black/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/psf/black/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/psf/black/git/refs{/sha}","trees_url":"https://api.github.com/repos/psf/black/git/trees{/sha}","statuses_url":"https://api.github.com/repos/psf/black/statuses/{sha}","languages_url":"https://api.github.com/repos/psf/black/languages","stargazers_url":"https://api.github.com/repos/psf/black/stargazers","contributors_url":"https://api.github.com/repos/psf/black/contributors","subscribers_url":"https://api.github.com/repos/psf/black/subscribers","subscription_url":"https://api.github.com/repos/psf/black/subscription","commits_url":"https://api.github.com/repos/psf/black/commits{/sha}","git_commits_url":"https://api.github.com/repos/psf/black/git/commits{/sha}","comments_url":"https://api.github.com/repos/psf/black/comments{/number}","issue_comment_url":"https://api.github.com/repos/psf/black/issues/comments{/number}","contents_url":"https://api.github.com/repos/psf/black/contents/{+path}","compare_url":"https://api.github.com/repos/psf/black/compare/{base}...{head}","merges_url":"https://api.github.com/repos/psf/black/merges","archive_url":"https://api.github.com/repos/psf/black/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/psf/black/downloads","issues_url":"https://api.github.com/repos/psf/black/issues{/number}","pulls_url":"https://api.github.com/repos/psf/black/pulls{/number}","milestones_url":"https://api.github.com/repos/psf/black/milestones{/number}","notifications_url":"https://api.github.com/repos/psf/black/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/psf/black/labels{/name}","releases_url":"https://api.github.com/repos/psf/black/releases{/id}","deployments_url":"https://api.github.com/repos/psf/black/deployments","created_at":"2018-03-14T19:54:45Z","updated_at":"2025-11-09T16:48:04Z","pushed_at":"2025-11-05T18:14:18Z","git_url":"git://github.com/psf/black.git","ssh_url":"git@github.com:psf/black.git","clone_url":"https://github.com/psf/black.git","svn_url":"https://github.com/psf/black","homepage":"https://black.readthedocs.io/en/stable/","size":7569,"stargazers_count":41126,"watchers_count":41126,"language":"Python","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":2665,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":337,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["autopep8","code","codeformatter","formatter","gofmt","hacktoberfest","pre-commit-hook","python","yapf"],"visibility":"public","forks":2665,"open_issues":337,"watchers":41126,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"Operating system: OSX\r\nPython version: 3.6.5\r\n*Black* version: 18.9b0\r\nDoes also happen on master: [Yes](https://black.now.sh/?version=master&state=_Td6WFoAAATm1rRGAgAhARYAAAB0L-Wj4ADDAHpdAD2IimZxl1N_WlXnON2nzNG_BfI5BzQfpPnalTlFrncmY0kglaZF122ozJl2ID89TjNVJdFk4uwWiWtwKNajut2v3G-dDw4JA_rfQEjggTuIlxr9WYzHTa6B9YErlR-b71jPUf4rFi1Yp3bfE6hpS-Cw8x52yBRaBcgeAAAAiGxBBU-FP0QAAZYBxAEAAFUb582xxGf7AgAAAAAEWVo=)\r\n\r\nInput:\r\n```\r\nclass BlackFail:\r\n    def fail(self):\r\n        from os.path import (\r\n            join,\r\n            # FAIL\r\n        )\r\n```\r\n\r\nExpected output:\r\n(Same as input)\r\n\r\nActual output:\r\n```\r\nclass BlackFail:\r\n    def fail(self):\r\n        from os.path import (\r\n            join,\r\n            # FAIL\r\n            ,\r\n        )\r\n```\r\n\r\nHanging comma causes black to produce invalid output.","reactions":{"url":"https://api.github.com/repos/psf/black/issues/612/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/psf/black/issues/612/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"actor":{"login":"zsol","id":66740,"node_id":"MDQ6VXNlcjY2NzQw","avatar_url":"https://avatars.githubusercontent.com/u/66740?v=4","gravatar_id":"","url":"https://api.github.com/users/zsol","html_url":"https://github.com/zsol","followers_url":"https://api.github.com/users/zsol/followers","following_url":"https://api.github.com/users/zsol/following{/other_user}","gists_url":"https://api.github.com/users/zsol/gists{/gist_id}","starred_url":"https://api.github.com/users/zsol/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zsol/subscriptions","organizations_url":"https://api.github.com/users/zsol/orgs","repos_url":"https://api.github.com/users/zsol/repos","events_url":"https://api.github.com/users/zsol/events{/privacy}","received_events_url":"https://api.github.com/users/zsol/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-02-14T21:01:55Z","updated_at":"2019-02-14T21:01:55Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/psf/black/issues/542","repository_url":"https://api.github.com/repos/psf/black","labels_url":"https://api.github.com/repos/psf/black/issues/542/labels{/name}","comments_url":"https://api.github.com/repos/psf/black/issues/542/comments","events_url":"https://api.github.com/repos/psf/black/issues/542/events","html_url":"https://github.com/psf/black/issues/542","id":365364536,"node_id":"MDU6SXNzdWUzNjUzNjQ1MzY=","number":542,"title":"Error during processing import tuples with comments","user":{"login":"eIGato","id":15613061,"node_id":"MDQ6VXNlcjE1NjEzMDYx","avatar_url":"https://avatars.githubusercontent.com/u/15613061?v=4","gravatar_id":"","url":"https://api.github.com/users/eIGato","html_url":"https://github.com/eIGato","followers_url":"https://api.github.com/users/eIGato/followers","following_url":"https://api.github.com/users/eIGato/following{/other_user}","gists_url":"https://api.github.com/users/eIGato/gists{/gist_id}","starred_url":"https://api.github.com/users/eIGato/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eIGato/subscriptions","organizations_url":"https://api.github.com/users/eIGato/orgs","repos_url":"https://api.github.com/users/eIGato/repos","events_url":"https://api.github.com/users/eIGato/events{/privacy}","received_events_url":"https://api.github.com/users/eIGato/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":867432792,"node_id":"MDU6TGFiZWw4Njc0MzI3OTI=","url":"https://api.github.com/repos/psf/black/labels/T:%20bug","name":"T: bug","color":"d73a4a","default":false,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2018-10-01T08:52:54Z","updated_at":"2019-02-14T21:01:55Z","closed_at":"2019-02-14T21:01:55Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":125266328,"node_id":"MDEwOlJlcG9zaXRvcnkxMjUyNjYzMjg=","name":"black","full_name":"psf/black","private":false,"owner":{"login":"psf","id":50630501,"node_id":"MDEyOk9yZ2FuaXphdGlvbjUwNjMwNTAx","avatar_url":"https://avatars.githubusercontent.com/u/50630501?v=4","gravatar_id":"","url":"https://api.github.com/users/psf","html_url":"https://github.com/psf","followers_url":"https://api.github.com/users/psf/followers","following_url":"https://api.github.com/users/psf/following{/other_user}","gists_url":"https://api.github.com/users/psf/gists{/gist_id}","starred_url":"https://api.github.com/users/psf/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/psf/subscriptions","organizations_url":"https://api.github.com/users/psf/orgs","repos_url":"https://api.github.com/users/psf/repos","events_url":"https://api.github.com/users/psf/events{/privacy}","received_events_url":"https://api.github.com/users/psf/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/psf/black","description":"The uncompromising Python code formatter","fork":false,"url":"https://api.github.com/repos/psf/black","forks_url":"https://api.github.com/repos/psf/black/forks","keys_url":"https://api.github.com/repos/psf/black/keys{/key_id}","collaborators_url":"https://api.github.com/repos/psf/black/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/psf/black/teams","hooks_url":"https://api.github.com/repos/psf/black/hooks","issue_events_url":"https://api.github.com/repos/psf/black/issues/events{/number}","events_url":"https://api.github.com/repos/psf/black/events","assignees_url":"https://api.github.com/repos/psf/black/assignees{/user}","branches_url":"https://api.github.com/repos/psf/black/branches{/branch}","tags_url":"https://api.github.com/repos/psf/black/tags","blobs_url":"https://api.github.com/repos/psf/black/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/psf/black/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/psf/black/git/refs{/sha}","trees_url":"https://api.github.com/repos/psf/black/git/trees{/sha}","statuses_url":"https://api.github.com/repos/psf/black/statuses/{sha}","languages_url":"https://api.github.com/repos/psf/black/languages","stargazers_url":"https://api.github.com/repos/psf/black/stargazers","contributors_url":"https://api.github.com/repos/psf/black/contributors","subscribers_url":"https://api.github.com/repos/psf/black/subscribers","subscription_url":"https://api.github.com/repos/psf/black/subscription","commits_url":"https://api.github.com/repos/psf/black/commits{/sha}","git_commits_url":"https://api.github.com/repos/psf/black/git/commits{/sha}","comments_url":"https://api.github.com/repos/psf/black/comments{/number}","issue_comment_url":"https://api.github.com/repos/psf/black/issues/comments{/number}","contents_url":"https://api.github.com/repos/psf/black/contents/{+path}","compare_url":"https://api.github.com/repos/psf/black/compare/{base}...{head}","merges_url":"https://api.github.com/repos/psf/black/merges","archive_url":"https://api.github.com/repos/psf/black/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/psf/black/downloads","issues_url":"https://api.github.com/repos/psf/black/issues{/number}","pulls_url":"https://api.github.com/repos/psf/black/pulls{/number}","milestones_url":"https://api.github.com/repos/psf/black/milestones{/number}","notifications_url":"https://api.github.com/repos/psf/black/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/psf/black/labels{/name}","releases_url":"https://api.github.com/repos/psf/black/releases{/id}","deployments_url":"https://api.github.com/repos/psf/black/deployments","created_at":"2018-03-14T19:54:45Z","updated_at":"2025-11-09T16:48:04Z","pushed_at":"2025-11-05T18:14:18Z","git_url":"git://github.com/psf/black.git","ssh_url":"git@github.com:psf/black.git","clone_url":"https://github.com/psf/black.git","svn_url":"https://github.com/psf/black","homepage":"https://black.readthedocs.io/en/stable/","size":7569,"stargazers_count":41126,"watchers_count":41126,"language":"Python","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":2665,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":337,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["autopep8","code","codeformatter","formatter","gofmt","hacktoberfest","pre-commit-hook","python","yapf"],"visibility":"public","forks":2665,"open_issues":337,"watchers":41126,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"Operating system: Mac OS High Sierra 10.13.6\r\nPython version: 3.6.6\r\n*Black* version: 18.9b0\r\nDoes also happen on master: yes\r\n\r\nA short file to cause the error:\r\n```python\r\nfrom importlib import (\r\n    reload,\r\n    # comment\r\n)\r\n```","reactions":{"url":"https://api.github.com/repos/psf/black/issues/542/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/psf/black/issues/542/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/psf/black/issues/comments/467652656","html_url":"https://github.com/psf/black/issues/671#issuecomment-467652656","issue_url":"https://api.github.com/repos/psf/black/issues/671","id":467652656,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NzY1MjY1Ng==","user":{"login":"d-chambers","id":11671536,"node_id":"MDQ6VXNlcjExNjcxNTM2","avatar_url":"https://avatars.githubusercontent.com/u/11671536?v=4","gravatar_id":"","url":"https://api.github.com/users/d-chambers","html_url":"https://github.com/d-chambers","followers_url":"https://api.github.com/users/d-chambers/followers","following_url":"https://api.github.com/users/d-chambers/following{/other_user}","gists_url":"https://api.github.com/users/d-chambers/gists{/gist_id}","starred_url":"https://api.github.com/users/d-chambers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/d-chambers/subscriptions","organizations_url":"https://api.github.com/users/d-chambers/orgs","repos_url":"https://api.github.com/users/d-chambers/repos","events_url":"https://api.github.com/users/d-chambers/events{/privacy}","received_events_url":"https://api.github.com/users/d-chambers/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-02-26T23:07:40Z","updated_at":"2019-02-26T23:07:40Z","body":"I just ran into this as well.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/psf/black/issues/comments/467652656/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"d-chambers","id":11671536,"node_id":"MDQ6VXNlcjExNjcxNTM2","avatar_url":"https://avatars.githubusercontent.com/u/11671536?v=4","gravatar_id":"","url":"https://api.github.com/users/d-chambers","html_url":"https://github.com/d-chambers","followers_url":"https://api.github.com/users/d-chambers/followers","following_url":"https://api.github.com/users/d-chambers/following{/other_user}","gists_url":"https://api.github.com/users/d-chambers/gists{/gist_id}","starred_url":"https://api.github.com/users/d-chambers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/d-chambers/subscriptions","organizations_url":"https://api.github.com/users/d-chambers/orgs","repos_url":"https://api.github.com/users/d-chambers/repos","events_url":"https://api.github.com/users/d-chambers/events{/privacy}","received_events_url":"https://api.github.com/users/d-chambers/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"JelleZijlstra","id":906600,"node_id":"MDQ6VXNlcjkwNjYwMA==","avatar_url":"https://avatars.githubusercontent.com/u/906600?v=4","gravatar_id":"","url":"https://api.github.com/users/JelleZijlstra","html_url":"https://github.com/JelleZijlstra","followers_url":"https://api.github.com/users/JelleZijlstra/followers","following_url":"https://api.github.com/users/JelleZijlstra/following{/other_user}","gists_url":"https://api.github.com/users/JelleZijlstra/gists{/gist_id}","starred_url":"https://api.github.com/users/JelleZijlstra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JelleZijlstra/subscriptions","organizations_url":"https://api.github.com/users/JelleZijlstra/orgs","repos_url":"https://api.github.com/users/JelleZijlstra/repos","events_url":"https://api.github.com/users/JelleZijlstra/events{/privacy}","received_events_url":"https://api.github.com/users/JelleZijlstra/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-27T04:16:34Z","updated_at":"2019-03-27T04:16:34Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/psf/black/issues/783","repository_url":"https://api.github.com/repos/psf/black","labels_url":"https://api.github.com/repos/psf/black/issues/783/labels{/name}","comments_url":"https://api.github.com/repos/psf/black/issues/783/comments","events_url":"https://api.github.com/repos/psf/black/issues/783/events","html_url":"https://github.com/psf/black/issues/783","id":425741247,"node_id":"MDU6SXNzdWU0MjU3NDEyNDc=","number":783,"title":"INTERNAL ERROR: Black produced invalid code: invalid syntax ","user":{"login":"waketzheng","id":35413830,"node_id":"MDQ6VXNlcjM1NDEzODMw","avatar_url":"https://avatars.githubusercontent.com/u/35413830?v=4","gravatar_id":"","url":"https://api.github.com/users/waketzheng","html_url":"https://github.com/waketzheng","followers_url":"https://api.github.com/users/waketzheng/followers","following_url":"https://api.github.com/users/waketzheng/following{/other_user}","gists_url":"https://api.github.com/users/waketzheng/gists{/gist_id}","starred_url":"https://api.github.com/users/waketzheng/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/waketzheng/subscriptions","organizations_url":"https://api.github.com/users/waketzheng/orgs","repos_url":"https://api.github.com/users/waketzheng/repos","events_url":"https://api.github.com/users/waketzheng/events{/privacy}","received_events_url":"https://api.github.com/users/waketzheng/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2019-03-27T03:06:01Z","updated_at":"2019-03-27T15:34:11Z","closed_at":"2019-03-27T04:16:34Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":125266328,"node_id":"MDEwOlJlcG9zaXRvcnkxMjUyNjYzMjg=","name":"black","full_name":"psf/black","private":false,"owner":{"login":"psf","id":50630501,"node_id":"MDEyOk9yZ2FuaXphdGlvbjUwNjMwNTAx","avatar_url":"https://avatars.githubusercontent.com/u/50630501?v=4","gravatar_id":"","url":"https://api.github.com/users/psf","html_url":"https://github.com/psf","followers_url":"https://api.github.com/users/psf/followers","following_url":"https://api.github.com/users/psf/following{/other_user}","gists_url":"https://api.github.com/users/psf/gists{/gist_id}","starred_url":"https://api.github.com/users/psf/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/psf/subscriptions","organizations_url":"https://api.github.com/users/psf/orgs","repos_url":"https://api.github.com/users/psf/repos","events_url":"https://api.github.com/users/psf/events{/privacy}","received_events_url":"https://api.github.com/users/psf/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/psf/black","description":"The uncompromising Python code formatter","fork":false,"url":"https://api.github.com/repos/psf/black","forks_url":"https://api.github.com/repos/psf/black/forks","keys_url":"https://api.github.com/repos/psf/black/keys{/key_id}","collaborators_url":"https://api.github.com/repos/psf/black/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/psf/black/teams","hooks_url":"https://api.github.com/repos/psf/black/hooks","issue_events_url":"https://api.github.com/repos/psf/black/issues/events{/number}","events_url":"https://api.github.com/repos/psf/black/events","assignees_url":"https://api.github.com/repos/psf/black/assignees{/user}","branches_url":"https://api.github.com/repos/psf/black/branches{/branch}","tags_url":"https://api.github.com/repos/psf/black/tags","blobs_url":"https://api.github.com/repos/psf/black/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/psf/black/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/psf/black/git/refs{/sha}","trees_url":"https://api.github.com/repos/psf/black/git/trees{/sha}","statuses_url":"https://api.github.com/repos/psf/black/statuses/{sha}","languages_url":"https://api.github.com/repos/psf/black/languages","stargazers_url":"https://api.github.com/repos/psf/black/stargazers","contributors_url":"https://api.github.com/repos/psf/black/contributors","subscribers_url":"https://api.github.com/repos/psf/black/subscribers","subscription_url":"https://api.github.com/repos/psf/black/subscription","commits_url":"https://api.github.com/repos/psf/black/commits{/sha}","git_commits_url":"https://api.github.com/repos/psf/black/git/commits{/sha}","comments_url":"https://api.github.com/repos/psf/black/comments{/number}","issue_comment_url":"https://api.github.com/repos/psf/black/issues/comments{/number}","contents_url":"https://api.github.com/repos/psf/black/contents/{+path}","compare_url":"https://api.github.com/repos/psf/black/compare/{base}...{head}","merges_url":"https://api.github.com/repos/psf/black/merges","archive_url":"https://api.github.com/repos/psf/black/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/psf/black/downloads","issues_url":"https://api.github.com/repos/psf/black/issues{/number}","pulls_url":"https://api.github.com/repos/psf/black/pulls{/number}","milestones_url":"https://api.github.com/repos/psf/black/milestones{/number}","notifications_url":"https://api.github.com/repos/psf/black/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/psf/black/labels{/name}","releases_url":"https://api.github.com/repos/psf/black/releases{/id}","deployments_url":"https://api.github.com/repos/psf/black/deployments","created_at":"2018-03-14T19:54:45Z","updated_at":"2025-11-09T16:48:04Z","pushed_at":"2025-11-05T18:14:18Z","git_url":"git://github.com/psf/black.git","ssh_url":"git@github.com:psf/black.git","clone_url":"https://github.com/psf/black.git","svn_url":"https://github.com/psf/black","homepage":"https://black.readthedocs.io/en/stable/","size":7569,"stargazers_count":41126,"watchers_count":41126,"language":"Python","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":2665,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":337,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["autopep8","code","codeformatter","formatter","gofmt","hacktoberfest","pre-commit-hook","python","yapf"],"visibility":"public","forks":2665,"open_issues":337,"watchers":41126,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"error: cannot format app/accounts/views.py: INTERNAL ERROR: Black produced invalid code: invalid syntax (<unknown>, line 37). Please report a bug on https://github.com/ambv/black/issues.  This invalid output might be helpful: /tmp/blk__89snadi.log\r\n```\r\n  File \"/home/vagrant/.local/lib/python3.6/site-packages/black.py\", line 3388, in assert_equivalent\r\n    dst_ast = ast.parse(dst)\r\n  File \"/usr/lib/python3.6/ast.py\", line 35, in parse\r\n    return compile(source, filename, mode, PyCF_ONLY_AST)\r\n# -*- coding:utf-8 -*-\r\n\"\"\"\r\nDescription: 用户相关路由方法\r\nDate: 2018-07-26\r\nAuthor: xieen\r\n\"\"\"\r\nimport time\r\nimport os\r\nimport json\r\nimport requests\r\nimport calendar\r\nimport traceback\r\n\r\n# from flask import request, abort, current_app, jsonify, session\r\nfrom flask import jsonify, session\r\nfrom flask_login import current_user, login_user, login_required, logout_user\r\n\r\nfrom datetime import date, datetime, timedelta\r\n\r\n# from ..db_base import db\r\nfrom . import accounts as bp\r\nfrom .accounts_dao import (\r\n    AccountsDao,\r\n    UserWithdrawalDao,\r\n    UserIncomeDao,\r\n    SocialUserDao,\r\n    AccountsSettingsPasswordDao,\r\n    AccountsChangeMobiDao,\r\n    UserLabelDao,\r\n)\r\nfrom .func_accounts import set_user_offline, set_user_online, WXBizDataCrypt\r\nfrom lib._flask import (\r\n    request_args,\r\n    request_jsons,\r\n    # request_headers,\r\n    # request_form,\r\n    ,\r\n)\r\nfrom lib import utils\r\nfrom lib.api_exception import APICODE\r\nfrom services.accounts.auth import XUser\r\nfrom services.accounts import utils as user_utils\r\nfrom .db_user import (\r\n    # User,\r\n    # UserWithdrawal,\r\n    UserIncome,\r\n    SocialUser,\r\n    AccountsSettingsPassword,\r\n    AccountsChangeMobi,\r\n    UserLabel,\r\n)\r\nfrom ..course.course_dao import (\r\n    ProductOrderDao,\r\n    LessonPlayDao,\r\n    CourseDao,\r\n    ClassGradeDao,\r\n)\r\n\r\n# from ..course.db_course import ProductOrder, LessonPlay, Course, ClassGrade\r\nfrom ..course.db_course import ProductOrder\r\nfrom ..qa.qa_dao import QuestionQADao, AnswerQADao\r\n\r\n# from ..phone_message.db_phone_message import PhoneMessage\r\nfrom ..phone_message.phone_message_dao import PhoneMessageDao\r\nfrom ..order.order_dao import OrderDao\r\nfrom ..order.func_order import get_alipay_transfer_url\r\nfrom ..phone_message.func_phone_message import (\r\n    send_code_for_reg_use_mobile,\r\n    send_message_for_find_pwd_use_mobile,\r\n    send_message_for_login_use_mobile,\r\n)\r\n\r\n\r\nMINI_APPS_APPID = os.environ.get(\"MINI_APPS_APPID\")\r\nMINI_APPS_SECRET_KEY = os.environ.get(\"MINI_APPS_SECRET_KEY\")\r\nMINI_APPS_URL = os.environ.get(\"MINI_APPS_URL\")\r\nGENERALIZE_APPS_APPID = os.environ.get(\"GENERALIZE_APPS_APPID\")\r\nGENERALIZE_APPS_SECRET_KEY = os.environ.get(\"GENERALIZE_APPS_SECRET_KEY\")\r\n\r\n\r\n@bp.route(\"/not_logined\")\r\ndef not_logined():\r\n    \"\"\" 没有登录 \"\"\"\r\n    next = request_args(key=\"next\", default=\"\")\r\n\r\n    return jsonify({\"code\": 1002, \"message\": APICODE[1002], \"next\": next})\r\n\r\n\r\n@bp.route(\"/logout\", methods=[\"GET\", \"POST\"])\r\ndef logout():\r\n    \"\"\" 退出登录 \"\"\"\r\n    logout_user()\r\n\r\n    return jsonify({\"code\": 1003, \"message\": APICODE[1003]})\r\n\r\n\r\n@bp.route(\"/login\", methods=[\"POST\"])\r\ndef login():\r\n    \"\"\"\r\n        @密码登录\r\n        param account 管理员账号 手机号 or 邮箱\r\n        param password 密码\r\n    \"\"\"\r\n    account = request_jsons(\"account\", type=str, required=True)\r\n    password = request_jsons(\"password\", type=str, required=True)\r\n\r\n    user = AccountsDao().find_by_email_phone(account)\r\n    if not user:\r\n        return jsonify({\"code\": 1004, \"message\": APICODE[1004]})\r\n\r\n    if not user.verify_password(password):\r\n        return jsonify({\"code\": 1005, \"message\": APICODE[1005]})\r\n\r\n    if not user.is_super_admin():\r\n        return jsonify({\"code\": 1006, \"message\": APICODE[1006]})\r\n\r\n    xuser = XUser(user.cookie_info())\r\n    set_user_offline(user.id)\r\n    login_user(xuser)\r\n    set_user_online(user.id, session.sid)\r\n    data = user.cookie_info()\r\n\r\n    return jsonify({\"code\": 1001, \"message\": APICODE[1001], \"data\": data})\r\n\r\n\r\n@bp.route(\"/mini/apps/login\", methods=[\"POST\"])\r\ndef mini_apps_login():\r\n    \"\"\"\r\n        @小程序授权登录\r\n        param code 授权code\r\n        param nickname 用户名称\r\n        param avatar 用户图像\r\n        param device 平台 eg:WEB MINI_APPS\r\n        param type 第三方登录平台 qq，weibo ，wechat， github\r\n        param is_generalize 是否推广小程序 0否 1是 默认0\r\n    \"\"\"\r\n    code = request_jsons(\"code\", type=str, required=True)\r\n    nickname = request_jsons(\"nickname\", type=str, required=True)\r\n    avatar = request_jsons(\"avatar\", type=str, default=\"\")\r\n    # device = request_jsons(\"device\", type=str, default=\"MINI_APPS\")\r\n    type = request_jsons(\"type\", type=str, default=\"wechat\")\r\n    is_generalize = request_jsons(\"is_generalize\", type=int, default=0)\r\n    encrypteddata = request_jsons(\"encrypteddata\", type=str, default=\"\")\r\n    iv = request_jsons(\"iv\", type=str, default=\"\")\r\n\r\n    if is_generalize:\r\n        appid = GENERALIZE_APPS_APPID\r\n        secret_key = GENERALIZE_APPS_SECRET_KEY\r\n    else:\r\n        appid = MINI_APPS_APPID\r\n        secret_key = MINI_APPS_SECRET_KEY\r\n\r\n    params = {\r\n        \"appid\": appid,\r\n        \"secret\": secret_key,\r\n        \"js_code\": code,\r\n        \"grant_type\": \"authorization_code\",\r\n    }\r\n    res = requests.get(MINI_APPS_URL, params=params).json()\r\n    print(res, \"小程序授权登录返回\")\r\n    if not res.get(\"openid\", False):\r\n        return jsonify({\"code\": 1000, \"message\": APICODE[1000]})\r\n\r\n    if res.get(\"unionid\"):\r\n        unionid = res[\"unionid\"]\r\n    else:\r\n        try:\r\n            pc = WXBizDataCrypt(appid, res.get(\"session_key\"))\r\n            _data = pc.decrypt(encrypteddata, iv)\r\n            print(_data, \"_data\")\r\n            unionid = _data.get(\"unionId\")\r\n        except Exception:\r\n            print(traceback.format_exc())\r\n            unionid = \"\"\r\n    print(unionid, \"unionid\")\r\n    social = SocialUserDao().get_type_union_id(type, unionid)\r\n    if not social:\r\n        social = SocialUser(\r\n            union_id=unionid,\r\n            open_id=res[\"openid\"],\r\n            type=type,\r\n            access_token=res[\"session_key\"],\r\n            nickname=nickname,\r\n            head_url=avatar,\r\n        )\r\n        SocialUserDao().save(social)\r\n\r\n    if not social.user_id:\r\n        return jsonify({\"code\": 1000, \"message\": APICODE[1000]})\r\n\r\n    user = AccountsDao().get(social.user_id)\r\n    login_time = int(time.time())\r\n    user.login_time = login_time\r\n    AccountsDao().update(user)\r\n\r\n    if user.is_black_user():\r\n        return jsonify({\"code\": 1075, \"message\": APICODE[1075]})\r\n\r\n    if not user.is_super_admin():\r\n        return jsonify({\"code\": 1006, \"message\": APICODE[1006]})\r\n\r\n    data = user.basic()\r\n    data[\"union_type\"] = social.type\r\n    data[\"union_id\"] = social.union_id\r\n\r\n    return jsonify({\"code\": 1001, \"message\": APICODE[1001], \"data\": data})\r\n\r\n\r\n@bp.route(\"/userinfo\")\r\n@login_required\r\ndef userinfo():\r\n    \"\"\"\r\n        @用户详情\r\n        param user_id 用户id\r\n    \"\"\"\r\n    user_id = request_args(\"user_id\", type=int, required=True)\r\n\r\n    user = AccountsDao().get_user_id(user_id)\r\n    if not user:\r\n        return jsonify({\"code\": 1004, \"message\": APICODE[1004]})\r\n\r\n    lesson_play = LessonPlayDao().get_play_duration_sum(user_id)\r\n    total_money = OrderDao().get_user_id_order_total_price_sum(user_id)\r\n\r\n    data = user.to_data()\r\n    data[\"total_money\"] = float(total_money) if total_money else 0\r\n    data[\"order_number\"] = OrderDao().get_user_id_order_num_count(user_id)\r\n    data[\"study_time\"] = int(lesson_play) if lesson_play else 0\r\n    data[\"course_number\"] = LessonPlayDao().get_user_id_course_study_num(\r\n        user_id\r\n    )\r\n\r\n    return jsonify({\"code\": 1001, \"message\": APICODE[1001], \"data\": data})\r\n\r\n\r\n@bp.route(\"/by/user_id/username/mobi/find/info\")\r\n@login_required\r\ndef by_user_id_username_mobi_find_info():\r\n    \"\"\"\r\n        @用户 id/username/mobi 查找信息\r\n        param user_id 用户id\r\n        param username 用户名称\r\n        param mobi 用户手机号\r\n    \"\"\"\r\n    user_id = request_args(\"user_id\", type=int, default=0)\r\n    username = request_args(\"username\", type=str, default=\"\")\r\n    mobi = request_args(\"mobi\", type=int, default=0)\r\n\r\n    data = []\r\n    if user_id:\r\n        user = AccountsDao().get(user_id)\r\n        data.append(user.user_data())\r\n\r\n    if username:\r\n        user = AccountsDao().get_username(username)\r\n        data = [u.user_data() for u in user]\r\n\r\n    if mobi:\r\n        user = AccountsDao().get_user_phone(mobi)\r\n        data.append(user.user_data())\r\n    data = {\"datas\": data}\r\n\r\n    return jsonify({\"code\": 1001, \"message\": APICODE[1001], \"data\": data})\r\n\r\n\r\n@bp.route(\"/withdrawal/list\")\r\n@login_required\r\ndef withdrawal_list():\r\n    \"\"\"\r\n        @用户结算列表\r\n        param start_time 开始时间\r\n        param end_time 结束时间\r\n        param mobi 申请人手机\r\n        param state 0 等待处理，1：成功，2：驳回 默认全部 -1\r\n        param type 1教师 2普通用户\r\n        param page 页面数 默认1\r\n        param size 每页显示数 默认20\r\n    \"\"\"\r\n    start_time = request_args(\"start_time\", type=str, default=\"\")\r\n    end_time = request_args(\"end_time\", type=str, default=\"\")\r\n    type = request_args(\"type\", type=int, default=2)\r\n    mobi = request_args(\"mobi\", type=int, default=0)\r\n    state = request_args(\"state\", type=int, default=-1)\r\n    page = request_args(\"page\", type=int, default=1)\r\n    size = request_args(\"size\", type=int, default=20)\r\n\r\n    try:\r\n        if start_time and end_time:\r\n            start_time = datetime.strptime(start_time, \"%Y-%m-%d\")\r\n            end_time = datetime.strptime(end_time, \"%Y-%m-%d\") + timedelta(1)\r\n    except Exception:\r\n        print(traceback.format_exc())\r\n        return jsonify({\"code\": 1063, \"message\": APICODE[1063]})\r\n\r\n    user_id = 0\r\n    if mobi:\r\n        user = AccountsDao().get_user_phone(mobi)\r\n        user_id = user.id if user else 0\r\n\r\n    total, withdrawal, total_page = UserWithdrawalDao().find_all(\r\n        start_time, end_time, user_id, state, type, page, size\r\n    )\r\n    data = [w.to_data() for w in withdrawal]\r\n    data = {\r\n        \"datas\": data,\r\n        \"page\": page,\r\n        \"size\": size,\r\n        \"total\": total,\r\n        \"total_page\": total_page,\r\n    }\r\n\r\n    return jsonify({\"code\": 1001, \"message\": APICODE[1001], \"data\": data})\r\n\r\n\r\n@bp.route(\"/confirm/pay\", methods=[\"POST\"])\r\n@login_required\r\ndef confirm_pay():\r\n    \"\"\"\r\n        @用户结算打款\r\n        param id 结算id\r\n    \"\"\"\r\n    id = request_jsons(\"id\", type=int, required=True)\r\n    password = request_jsons(\"password\", type=str, required=True)\r\n\r\n    if current_user.id != 1:\r\n        return jsonify({\"code\": 1000, \"message\": APICODE[1000]})\r\n\r\n    account = AccountsSettingsPasswordDao().get_user_id(current_user.id)\r\n    if account is None:\r\n        return jsonify({\"code\": 1077, \"message\": APICODE[1077]})\r\n\r\n    if not account.verify_password(password):\r\n        return jsonify({\"code\": 1005, \"message\": APICODE[1005]})\r\n\r\n    withdrawal = UserWithdrawalDao().get(id)\r\n    if withdrawal is None:\r\n        return jsonify({\"code\": 1058, \"message\": APICODE[1058]})\r\n\r\n    if withdrawal.state != 0:\r\n        return jsonify({\"code\": 1000, \"message\": APICODE[1000]})\r\n\r\n    if withdrawal.pay_channel != \"alipay\":\r\n        return jsonify({\"code\": 1076, \"message\": APICODE[1076]})\r\n\r\n    out_biz_no = utils.create_uuid()\r\n    url = get_alipay_transfer_url(\r\n        out_biz_no,\r\n        \"ALIPAY_LOGONID\",\r\n        withdrawal.beneficiary_account,\r\n        withdrawal.apply_money,\r\n    )\r\n    ret = requests.get(url).json()\r\n    code = int(ret[\"alipay_fund_trans_toaccount_transfer_response\"][\"code\"])\r\n    if code != 10000:\r\n        return jsonify({\"code\": 1000, \"message\": APICODE[1000]})\r\n\r\n    withdrawal.state = 1\r\n    withdrawal.pay_money = withdrawal.apply_money\r\n    withdrawal.hande_user_id = current_user.id\r\n    withdrawal.hande_time = datetime.now()\r\n    withdrawal.remark = \"结算打款\"\r\n    withdrawal.order_id = ret[\"alipay_fund_trans_toaccount_transfer_response\"][\r\n        \"order_id\"\r\n    ]\r\n    withdrawal.out_biz_no = out_biz_no\r\n    UserWithdrawalDao().update(withdrawal)\r\n\r\n    user = AccountsDao().get(current_user.id)\r\n    user.frozen_capital -= withdrawal.apply_money\r\n    AccountsDao().update(user)\r\n\r\n    return jsonify({\"code\": 1001, \"message\": APICODE[1001]})\r\n\r\n\r\n@bp.route(\"/cancel/pay\", methods=[\"POST\"])\r\n@login_required\r\ndef cancel_pay():\r\n    \"\"\"\r\n        @用户结算驳回\r\n        param id 结算id\r\n    \"\"\"\r\n    id = request_jsons(\"id\", type=int, required=True)\r\n\r\n    withdrawal = UserWithdrawalDao().get(id)\r\n    if withdrawal is None:\r\n        return jsonify({\"code\": 1058, \"message\": APICODE[1058]})\r\n\r\n    if withdrawal.state != 0:\r\n        return jsonify({\"code\": 1000, \"message\": APICODE[1000]})\r\n\r\n    withdrawal.state = 2\r\n    withdrawal.hande_user_id = current_user.id\r\n    withdrawal.hande_time = datetime.now()\r\n    UserWithdrawalDao().update(withdrawal)\r\n\r\n    title = \"结算申请驳回\"\r\n    user_income = UserIncome(\r\n        user_id=current_user.id,\r\n        money=withdrawal.apply_money,\r\n        title=title,\r\n        from_type=9,\r\n        from_id=id,\r\n    )\r\n    UserIncomeDao().save(user_income)\r\n\r\n    user = AccountsDao().get(current_user.id)\r\n    user.balance += withdrawal.apply_money\r\n    user.frozen_capital -= withdrawal.apply_money\r\n    AccountsDao().update(user)\r\n\r\n    return jsonify({\"code\": 1001, \"message\": APICODE[1001]})\r\n\r\n\r\n@bp.route(\"/income/details\")\r\n@login_required\r\ndef income_details():\r\n    \"\"\"\r\n        @用户收入明细\r\n        param user_id 用户id\r\n        param page 每页数 默认1\r\n        param size 每页显示数 默认20\r\n    \"\"\"\r\n    user_id = request_args(\"user_id\", type=int, required=True)\r\n    page = request_args(\"page\", type=int, default=1)\r\n    size = request_args(\"size\", type=int, default=20)\r\n\r\n    user = AccountsDao().get_user_id(user_id)\r\n    if not user:\r\n        return jsonify({\"code\": 1004, \"message\": APICODE[1004]})\r\n\r\n    total, income, total_page = UserIncomeDao().find_user_id_all(\r\n        user_id, page, size, 0\r\n    )\r\n\r\n    data = [i.to_data() for i in income]\r\n    data = {\r\n        \"datas\": data,\r\n        \"page\": page,\r\n        \"size\": size,\r\n        \"total\": total,\r\n        \"total_page\": total_page,\r\n    }\r\n\r\n    return jsonify({\"code\": 1001, \"message\": APICODE[1001], \"data\": data})\r\n\r\n\r\n@bp.route(\"/list\")\r\n@login_required\r\ndef users_list():\r\n    \"\"\"\r\n        @用户列表\r\n        param username 用户名称\r\n        param mobi 用户手机\r\n        param start_time 开始时间\r\n        param end_time 结束时间\r\n        param device 注册设备\r\n        param label 标签 all全部 其他则对应\r\n        param page 每页数 默认1\r\n        param size 每页显示数 默认20\r\n    \"\"\"\r\n    username = request_args(\"username\", type=str, default=\"\")\r\n    mobi = request_args(\"mobi\", type=str, default=\"\")\r\n    start_time = request_args(\"start_time\", type=str, default=\"\")\r\n    end_time = request_args(\"end_time\", type=str, default=\"\")\r\n    device = request_args(\"device\", type=str, default=\"\")\r\n    label = request_args(\"label\", type=str, default=\"all\")\r\n    page = request_args(\"page\", type=int, default=1)\r\n    size = request_args(\"size\", type=int, default=20)\r\n\r\n    try:\r\n        if start_time and end_time:\r\n            start_time = datetime.strptime(start_time, \"%Y-%m-%d\")\r\n            end_time = datetime.strptime(end_time, \"%Y-%m-%d\") + timedelta(1)\r\n    except Exception:\r\n        print(traceback.format_exc())\r\n        return jsonify({\"code\": 1063, \"message\": APICODE[1063]})\r\n\r\n    total, users, total_page = AccountsDao().find_all(\r\n        username, mobi, start_time, end_time, device, label, page, size\r\n    )\r\n\r\n    data = [u.to_data() for u in users]\r\n    data = {\r\n        \"datas\": data,\r\n        \"page\": page,\r\n        \"size\": size,\r\n        \"total\": total,\r\n        \"total_page\": total_page,\r\n    }\r\n\r\n    return jsonify({\"code\": 1001, \"message\": APICODE[1001], \"data\": data})\r\n\r\n\r\n@bp.route(\"/set/black\", methods=[\"POST\"])\r\n@login_required\r\ndef set_black():\r\n    \"\"\"\r\n        @用户设置黑名单\r\n        param user_id 用户id\r\n    \"\"\"\r\n    user_id = request_jsons(\"user_id\", type=int, required=True)\r\n    black_remark = request_jsons(\"black_remark\", type=str, default=\"\")\r\n\r\n    user = AccountsDao().get_user_id(user_id)\r\n    if user is None:\r\n        return jsonify({\"code\": 1004, \"message\": APICODE[1004]})\r\n\r\n    user.is_black = 1\r\n    if black_remark:\r\n        user.black_remark = black_remark\r\n\r\n    user.black_time = datetime.now()\r\n    AccountsDao().update(user)\r\n\r\n    return jsonify({\"code\": 1001, \"message\": APICODE[1001]})\r\n\r\n\r\n@bp.route(\"/relieve/black\", methods=[\"POST\"])\r\n@login_required\r\ndef relieve_black():\r\n    \"\"\"\r\n        @用户解除黑名单\r\n        param user_id 用户id\r\n    \"\"\"\r\n    user_id = request_jsons(\"user_id\", type=int, required=True)\r\n\r\n    user = AccountsDao().get_user_id(user_id)\r\n    if not user:\r\n        return jsonify({\"code\": 1004, \"message\": APICODE[1004]})\r\n\r\n    user.is_black = 0\r\n    AccountsDao().update(user)\r\n\r\n    return jsonify({\"code\": 1001, \"message\": APICODE[1001]})\r\n\r\n\r\n@bp.route(\"/set/teacher\", methods=[\"POST\"])\r\n@login_required\r\ndef set_teacher():\r\n    \"\"\"\r\n        @用户设置为讲师\r\n        param user_id 用户id\r\n        param type 1设置 2取消\r\n    \"\"\"\r\n    user_id = request_jsons(\"user_id\", type=int, required=True)\r\n    type = request_jsons(\"type\", type=int, default=1)\r\n\r\n    user = AccountsDao().get_user_id(user_id)\r\n    if not user:\r\n        return jsonify({\"code\": 1004, \"message\": APICODE[1004]})\r\n\r\n    if type == 1:\r\n        user.user_type = 2\r\n    elif type == 2:\r\n        user.user_type = 1\r\n    else:\r\n        return jsonify({\"code\": 1000, \"message\": APICODE[1000]})\r\n\r\n    AccountsDao().update(user)\r\n\r\n    return jsonify({\"code\": 1001, \"message\": APICODE[1001]})\r\n\r\n\r\n@bp.route(\"/change/mobi\", methods=[\"POST\"])\r\n@login_required\r\ndef change_mobi():\r\n    \"\"\"\r\n        @用户更换手机号码\r\n        param user_id 用户id\r\n        param change_mobi 要更换的手机号码\r\n        param origin_mobi 原手机号码\r\n    \"\"\"\r\n    user_id = request_jsons(\"user_id\", type=int, required=True)\r\n    change_mobi = request_jsons(\"change_mobi\", type=int, required=True)\r\n    origin_mobi = request_jsons(\"origin_mobi\", type=int, required=True)\r\n\r\n    user = AccountsDao().get_user_id(user_id)\r\n    if not user:\r\n        return jsonify({\"code\": 1004, \"message\": APICODE[1004]})\r\n\r\n    if user.mobi != str(origin_mobi):\r\n        return jsonify({\"code\": 1000, \"message\": APICODE[1000]})\r\n\r\n    user.mobi = change_mobi\r\n    AccountsDao().update(user)\r\n\r\n    change = AccountsChangeMobi(\r\n        user_id=user_id, change_mobi=change_mobi, origin_mobi=origin_mobi\r\n    )\r\n    AccountsChangeMobiDao().save(change)\r\n\r\n    return jsonify({\"code\": 1001, \"message\": APICODE[1001]})\r\n\r\n\r\n@bp.route(\"/phone/message\", methods=[\"POST\"])\r\ndef phone_message():\r\n    \"\"\"\r\n        @短信验证码\r\n        params mobi 手机号码\r\n        params type 验证码类型 reg 注册 find_pwd 查找密码 mobi_login 登录\r\n    \"\"\"\r\n    mobi = request_jsons(\"mobi\", type=int, required=True)\r\n    type = request_jsons(\"type\", required=True)\r\n\r\n    if not user_utils.is_valid_mobi(mobi):\r\n        return jsonify({\"code\": 1084, \"message\": APICODE[1084]})\r\n\r\n    ip = utils.get_ip()\r\n    count = PhoneMessageDao().get_phone_count(type, mobi)\r\n    if count > 5:\r\n        return jsonify({\"code\": 1085, \"message\": APICODE[1085]})\r\n\r\n    if type == \"reg\":\r\n        send_code_for_reg_use_mobile(mobi, ip)\r\n    elif type == \"find_pwd\":\r\n        send_message_for_find_pwd_use_mobile(mobi)\r\n    elif type == \"mobi_login\":\r\n        send_message_for_login_use_mobile(mobi)\r\n\r\n    return jsonify({\"code\": 1001, \"message\": APICODE[1001]})\r\n\r\n\r\n@bp.route(\"/student/list\")\r\n@login_required\r\ndef student_list():\r\n    \"\"\"\r\n        @用户学员管理\r\n        param product_id 课程id / 班级id\r\n        param product_type 类型 3课程 4班级 默认3\r\n        param start_time 开始时间\r\n        param end_time 结束时间\r\n        param user_id 用户id\r\n        param page 页码数 默认1\r\n        param size 每页显示数 默认20\r\n        param is_experience 是否是体验 0否 1是\r\n        param duration 学习时长\r\n    \"\"\"\r\n    product_id = request_args(\"product_id\", type=int, default=0)\r\n    product_type = request_args(\"product_type\", type=int, default=3)\r\n    start_time = request_args(\"start_time\", type=str, default=\"\")\r\n    end_time = request_args(\"end_time\", type=str, default=\"\")\r\n    user_id = request_args(\"user_id\", type=int, default=0)\r\n    is_experience = request_args(\"is_experience\", type=int, default=0)\r\n    play_duration = request_args(\"play_duration\", type=int, default=0)\r\n    page = request_args(\"page\", type=int, default=1)\r\n    size = request_args(\"size\", type=int, default=20)\r\n\r\n    user_ids = []\r\n    is_ids = 0\r\n    try:\r\n        if start_time and end_time:\r\n            start_time = datetime.strptime(start_time, \"%Y-%m-%d\")\r\n            end_time = datetime.strptime(end_time, \"%Y-%m-%d\") + timedelta(1)\r\n            ret = LessonPlayDao().find_classe_id_grade_id_all(\r\n                product_id,\r\n                product_type,\r\n                start_time,\r\n                end_time,\r\n                user_id,\r\n                play_duration,\r\n            )\r\n            user_ids = [int(r[0]) for r in ret if ret]\r\n            is_ids = 1\r\n    except Exception:\r\n        print(traceback.format_exc())\r\n        return jsonify({\"code\": 1063, \"message\": APICODE[1063]})\r\n\r\n    total, product_order, total_page = ProductOrderDao().find_product_id_user_id_all(  # noqa\r\n        product_id,\r\n        product_type,\r\n        user_id,\r\n        user_ids,\r\n        is_ids,\r\n        is_experience,\r\n        page,\r\n        size,\r\n    )\r\n    # class_id = 0\r\n    # grade_id = 0\r\n    data = []\r\n    for p in product_order:\r\n        d = p.to_data()\r\n        if product_type == 3:\r\n            course = CourseDao().get(d[\"product_id\"])\r\n            study = LessonPlayDao().get_user_study_course(\r\n                d[\"user_id\"], d[\"product_id\"]\r\n            )\r\n            d[\"lessons_count\"] = course.lessons_count if course else 0\r\n            d[\"is_finish\"] = 1 if int(d[\"lessons_count\"]) == int(study) else 0\r\n            d[\"progress\"] = study\r\n\r\n        elif product_type == 4:\r\n            course = ClassGradeDao().get(d[\"product_id\"])\r\n            study = LessonPlayDao().get_user_study_grade(\r\n                d[\"user_id\"], d[\"product_id\"]\r\n            )\r\n            d[\"lessons_count\"] = course.lessons_count if course else 0\r\n            d[\"is_finish\"] = 1 if int(d[\"lessons_count\"]) == int(study) else 0\r\n            d[\"progress\"] = study\r\n\r\n        play_time = LessonPlayDao().get_user_id_course_time(\r\n            d[\"user_id\"], product_id, product_type\r\n        )\r\n        d[\"final_study_time\"] = str(play_time.end_time) if play_time else \"\"\r\n        data.append(d)\r\n\r\n    data = {\r\n        \"datas\": data,\r\n        \"page\": page,\r\n        \"size\": size,\r\n        \"total\": total,\r\n        \"total_page\": total_page,\r\n    }\r\n\r\n    return jsonify({\"code\": 1001, \"message\": APICODE[1001], \"data\": data})\r\n\r\n\r\n@bp.route(\"/forbid/study\", methods=[\"POST\"])\r\n@login_required\r\ndef forbid_study():\r\n    \"\"\"\r\n        @禁止学员学习\r\n        param product_id 课程id / 班级id\r\n        param product_type 类型 3课程 4班级 默认3\r\n        param user_id 用户id\r\n        param state 是否停用 0停用 1正常\r\n    \"\"\"\r\n    product_id = request_jsons(\"product_id\", type=int, required=True)\r\n    product_type = request_jsons(\"product_type\", type=int, required=True)\r\n    user_id = request_jsons(\"user_id\", type=int, required=True)\r\n    state = request_jsons(\"state\", type=int, required=True)\r\n\r\n    product = ProductOrderDao().get_product_id(\r\n        user_id, product_id, product_type\r\n    )\r\n    if not product:\r\n        return jsonify({\"code\": 1000, \"message\": APICODE[1000]})\r\n\r\n    product.state = state\r\n    ProductOrderDao().update(product)\r\n\r\n    return jsonify({\"code\": 1001, \"message\": APICODE[1001]})\r\n\r\n\r\n@bp.route(\"/learning/permissions/add\", methods=[\"POST\"])\r\n@login_required\r\ndef learning_permissions_add():\r\n    \"\"\"\r\n        @添加学员学习权限\r\n        param user_ids 用户ids list\r\n        param product_id 课程id / 班级id\r\n        param product_type 课程类型 课程3 班级4\r\n        param is_experience 是否体验 0不是 1是\r\n    \"\"\"\r\n    user_ids = request_jsons(\"user_ids\", type=list, required=True)\r\n    product_id = request_jsons(\"product_id\", type=int, required=True)\r\n    product_type = request_jsons(\"product_type\", type=int, required=True)\r\n    is_experience = request_jsons(\"is_experience\", type=int, required=True)\r\n\r\n    if product_type == 4:\r\n        grade = ClassGradeDao().get(product_id)\r\n        if grade is None:\r\n            return jsonify({\"code\": 1000, \"message\": APICODE[1000]})\r\n\r\n    if not user_ids:\r\n        return jsonify({\"code\": 1000, \"message\": APICODE[1000]})\r\n\r\n    for u in user_ids:\r\n        user = AccountsDao().get_user_id(u)\r\n        if not user:\r\n            return jsonify({\"code\": 1004, \"message\": APICODE[1004]})\r\n\r\n    for u in user_ids:\r\n        product = ProductOrderDao().get_product_id(\r\n            user_id=u, product_id=product_id, product_type=product_type\r\n        )\r\n        if not product:\r\n            now = datetime.now()\r\n            product = ProductOrder(\r\n                user_id=u,\r\n                product_id=product_id,\r\n                product_type=product_type,\r\n                is_experience=is_experience,\r\n                state=1,\r\n                order_time=now,\r\n                cancel_time=now + timedelta(days=365),\r\n            )\r\n            ProductOrderDao().save(product)\r\n        else:\r\n            product.is_experience = is_experience\r\n            product.state = 1\r\n            ProductOrderDao().update(product)\r\n\r\n    return jsonify({\"code\": 1001, \"message\": APICODE[1001]})\r\n\r\n\r\n@bp.route(\"/student/information\")\r\n@login_required\r\ndef student_information():\r\n    \"\"\"\r\n        @学员详情\r\n        param user_id 用户id\r\n        param course_id 课程id / 班级id\r\n        param product_type 课程类型\r\n    \"\"\"\r\n    user_id = request_args(\"user_id\", type=int, required=True)\r\n    course_id = request_args(\"course_id\", type=int, required=True)\r\n    product_type = request_args(\"product_type\", type=int, required=True)\r\n\r\n    user = AccountsDao().get_user_id(user_id)\r\n    if not user:\r\n        return jsonify({\"code\": 1004, \"message\": APICODE[1004]})\r\n\r\n    d = user.user_data()\r\n    if product_type == 3:\r\n        course = CourseDao().get(course_id)\r\n        study = LessonPlayDao().get_user_study_course(user_id, course_id)\r\n        d[\"lessons_count\"] = course.lessons_count if course else 0\r\n        d[\"is_finish\"] = 1 if int(d[\"lessons_count\"]) == int(study) else 0\r\n        d[\"progress\"] = study\r\n\r\n    elif product_type == 4:\r\n        course = ClassGradeDao().get(course_id)\r\n        study = LessonPlayDao().get_user_study_grade(user_id, course_id)\r\n        d[\"lessons_count\"] = course.lessons_count if course else 0\r\n        d[\"is_finish\"] = 1 if int(d[\"lessons_count\"]) == int(study) else 0\r\n        d[\"progress\"] = study\r\n\r\n    lesson_play = LessonPlayDao().get_play_duration_sum(user_id)\r\n    d[\"lesson_play\"] = int(lesson_play) if lesson_play else 0\r\n    d[\"questions\"] = QuestionQADao().get_user_questions_count(\r\n        user_id, course_id, product_type\r\n    )\r\n    d[\"answers\"] = AnswerQADao().get_user_answer_count(\r\n        user_id, course_id, product_type\r\n    )\r\n    d[\"homework\"] = 0\r\n\r\n    return jsonify({\"code\": 1001, \"message\": APICODE[1001], \"data\": d})\r\n\r\n\r\n@bp.route(\"/student/learn\")\r\n@login_required\r\ndef student_learn():\r\n    \"\"\"\r\n        @学员学习记录\r\n        param user_id 用户id\r\n        param product_id 课程id / 班级id\r\n        param product_type 课程类型\r\n        param start_time 学习时间\r\n        param end_time 结束时间\r\n        param page 页面数 默认1\r\n        param size 每页显示数 默认20\r\n    \"\"\"\r\n    product_id = request_args(\"product_id\", type=int, required=True)\r\n    product_type = request_args(\"product_type\", type=int, default=3)\r\n    start_time = request_args(\"start_time\", type=str, default=\"\")\r\n    end_time = request_args(\"end_time\", type=str, default=\"\")\r\n    user_id = request_args(\"user_id\", type=int, required=True)\r\n    page = request_args(\"page\", type=int, default=1)\r\n    size = request_args(\"size\", type=int, default=20)\r\n\r\n    try:\r\n        if start_time and end_time:\r\n            start_time = datetime.strptime(start_time, \"%Y-%m-%d\")\r\n            end_time = datetime.strptime(end_time, \"%Y-%m-%d\") + timedelta(1)\r\n    except Exception:\r\n        print(traceback.format_exc())\r\n        return jsonify({\"code\": 1063, \"message\": APICODE[1063]})\r\n\r\n    total, play, total_page = LessonPlayDao().find_list_all(\r\n        product_id, product_type, start_time, end_time, user_id, page, size\r\n    )\r\n    data = [p.to_data() for p in play]\r\n    data = {\r\n        \"datas\": data,\r\n        \"page\": page,\r\n        \"size\": size,\r\n        \"total\": total,\r\n        \"total_page\": total_page,\r\n    }\r\n\r\n    return jsonify({\"code\": 1001, \"message\": APICODE[1001], \"data\": data})\r\n\r\n\r\n@bp.route(\"/students/summarize\")\r\n@login_required\r\ndef students_summarize():\r\n    \"\"\"\r\n        @学员学习统计\r\n        param product_id 课程id / 班级id\r\n        param product_type 类型 3课程 4班级 默认3\r\n        param is_experience 是否是体验 0否 1是\r\n    \"\"\"\r\n    product_id = request_args(\"product_id\", type=int, default=0)\r\n    product_type = request_args(\"product_type\", type=int, default=3)\r\n    is_experience = request_args(\"is_experience\", type=int, default=0)\r\n\r\n    now = datetime.now()\r\n    start_time = (now - timedelta(days=now.weekday())).date()\r\n    end_time = (now + timedelta(days=6 - now.weekday())).date()\r\n    week_count = ProductOrderDao().get_user_study_statistics(\r\n        product_id, product_type, is_experience, start_time, end_time\r\n    )\r\n\r\n    year = int(now.year)\r\n    month = int(now.month)\r\n    first_day_week_day, month_range = calendar.monthrange(year, month)\r\n    start_time = date(year=year, month=month, day=1)\r\n    end_time = date(year=year, month=month, day=month_range)\r\n    month_count = ProductOrderDao().get_user_study_statistics(\r\n        product_id, product_type, is_experience, start_time, end_time\r\n    )\r\n\r\n    total_count = ProductOrderDao().get_user_study_statistics(\r\n        product_id, product_type, is_experience, None, None\r\n    )\r\n    data = {\r\n        \"week_count\": week_count,\r\n        \"month_count\": month_count,\r\n        \"total_count\": total_count,\r\n    }\r\n\r\n    return jsonify({\"code\": 1001, \"message\": APICODE[1001], \"data\": data})\r\n\r\n\r\n@bp.route(\"/settings/password\", methods=[\"POST\"])\r\n@login_required\r\ndef accounts_settings_password():\r\n    \"\"\"\r\n        @账号设置密码\r\n        param user_id 用户ID\r\n    \"\"\"\r\n    password = request_jsons(\"password\", type=str, required=True)\r\n\r\n    if current_user.id not in [1, 281268]:\r\n        return jsonify({\"code\": 1000, \"message\": APICODE[1000]})\r\n\r\n    account = AccountsSettingsPassword(\r\n        password=password, user_id=current_user.id\r\n    )\r\n    AccountsSettingsPasswordDao().save(account)\r\n\r\n    return jsonify({\"code\": 1001, \"message\": APICODE[1001]})\r\n\r\n\r\n@bp.route(\"/social/user/detail\")\r\n@login_required\r\ndef social_user_detail():\r\n    \"\"\"\r\n        @第三方账号详情\r\n        param user_id 用户ID\r\n    \"\"\"\r\n    user_id = request_args(\"user_id\", type=int, required=True)\r\n\r\n    qq = SocialUserDao().get_bind_social_user_type(user_id, \"qq\")\r\n    weibo = SocialUserDao().get_bind_social_user_type(user_id, \"weibo\")\r\n    wechat = SocialUserDao().get_bind_social_user_type(user_id, \"wechat\")\r\n\r\n    data = [\r\n        {\r\n            \"id\": qq.id if qq else \"\",\r\n            \"platform\": \"qq\",\r\n            \"nickname\": qq.nickname if qq else \"\",\r\n            \"user_id\": qq.user_id if qq else \"\",\r\n        },\r\n        {\r\n            \"id\": weibo.id if weibo else \"\",\r\n            \"platform\": \"weibo\",\r\n            \"nickname\": weibo.nickname if weibo else \"\",\r\n            \"user_id\": weibo.user_id if weibo else \"\",\r\n        },\r\n        {\r\n            \"id\": wechat.id if wechat else \"\",\r\n            \"platform\": \"wechat\",\r\n            \"nickname\": wechat.nickname if wechat else \"\",\r\n            \"user_id\": wechat.user_id if wechat else \"\",\r\n        },\r\n    ]\r\n\r\n    return jsonify({\"code\": 1001, \"message\": APICODE[1001], \"data\": data})\r\n\r\n\r\n@bp.route(\"/social/user/delete\", methods=[\"POST\"])\r\n@login_required\r\ndef social_user_delete():\r\n    \"\"\"\r\n        @第三方账号删除\r\n        param user_id 用户ID\r\n        param social_type 类型 qq weibo wechat\r\n        param type 1解绑 2绑定\r\n    \"\"\"\r\n    user_id = request_jsons(\"user_id\", type=int, required=True)\r\n    social_type = request_jsons(\"social_type\", type=str, required=True)\r\n    type = request_jsons(\"type\", type=int, default=1)\r\n\r\n    user = AccountsDao().get_user_id(user_id)\r\n    if user is None:\r\n        return jsonify({\"code\": 1004, \"message\": APICODE[1004]})\r\n\r\n    social = SocialUserDao().find_user_id_all(social_type, user_id)\r\n    if social:\r\n        for s in social:\r\n            if type == 1:\r\n                s.status = 0\r\n            elif type == 2:\r\n                s.status = 1\r\n            SocialUserDao().update(s)\r\n\r\n    return jsonify({\"code\": 1001, \"message\": APICODE[1001]})\r\n\r\n\r\n@bp.route(\"/is/black/list\")\r\n@login_required\r\ndef is_black_list():\r\n    \"\"\"\r\n        @用户黑名单列表\r\n        param page 页码数 默认1\r\n        param size 每页显示数 默认20\r\n    \"\"\"\r\n    page = request_args(\"page\", type=int, default=1)\r\n    size = request_args(\"size\", type=int, default=20)\r\n\r\n    total, users, total_page = AccountsDao().find_black_all(page, size)\r\n\r\n    data = [u.user_balck_data() for u in users]\r\n    data = {\r\n        \"datas\": data,\r\n        \"page\": page,\r\n        \"size\": size,\r\n        \"total\": total,\r\n        \"total_page\": total_page,\r\n    }\r\n\r\n    return jsonify({\"code\": 1001, \"message\": APICODE[1001], \"data\": data})\r\n\r\n\r\n@bp.route(\"/label/list\")\r\n@login_required\r\ndef user_label_list():\r\n    \"\"\"\r\n        @用户标签列表\r\n        param label_name 标签名称\r\n        param page 页码数 默认1\r\n        param size 每页显示数 默认20\r\n    \"\"\"\r\n    label_name = request_args(\"label_name\", type=str, default=\"\")\r\n    page = request_args(\"page\", type=int, default=1)\r\n    size = request_args(\"size\", type=int, default=20)\r\n\r\n    total, label, total_page = UserLabelDao().find_label_name_all(\r\n        label_name, page, size\r\n    )\r\n    data = [l.to_data() for l in label]\r\n    data = {\r\n        \"datas\": data,\r\n        \"page\": page,\r\n        \"size\": size,\r\n        \"total\": total,\r\n        \"total_page\": total_page,\r\n    }\r\n\r\n    return jsonify({\"code\": 1001, \"message\": APICODE[1001], \"data\": data})\r\n\r\n\r\n@bp.route(\"/label/delete\", methods=[\"POST\"])\r\n@login_required\r\ndef user_label_delete():\r\n    \"\"\"\r\n        @用户标签删除\r\n        param label_id 标签ID\r\n    \"\"\"\r\n    label_id = request_jsons(\"label_id\", type=int, required=True)\r\n\r\n    label = UserLabelDao().get(label_id)\r\n    if label is None:\r\n        return jsonify({\"code\": 1000, \"message\": APICODE[1000]})\r\n\r\n    UserLabelDao().delete(label)\r\n\r\n    return jsonify({\"code\": 1001, \"message\": APICODE[1001]})\r\n\r\n\r\n@bp.route(\"/label/detail\")\r\n@login_required\r\ndef user_label_detail():\r\n    \"\"\"\r\n        @用户标签详情\r\n        param label_id 标签ID\r\n    \"\"\"\r\n    label_id = request_args(\"label_id\", type=int, required=True)\r\n\r\n    label = UserLabelDao().get(label_id)\r\n    if label is None:\r\n        return jsonify({\"code\": 1000, \"message\": APICODE[1000]})\r\n\r\n    return jsonify(\r\n        {\"code\": 1001, \"message\": APICODE[1001], \"data\": label.to_data()}\r\n    )\r\n\r\n\r\n@bp.route(\"/label/save\", methods=[\"post\"])\r\n@login_required\r\ndef user_label_save():\r\n    \"\"\"\r\n        @用户标签保存\r\n        param label_id 标签ID\r\n        param label_name 标签名称\r\n    \"\"\"\r\n    label_id = request_jsons(\"label_id\", type=int, default=0)\r\n    label_name = request_jsons(\"label_name\", type=str, default=\"\")\r\n\r\n    _label = UserLabelDao().get_label_name(label_name)\r\n    if _label:\r\n        return jsonify({\"code\": 1000, \"message\": APICODE[1000]})\r\n\r\n    if label_id:\r\n        label = UserLabelDao().get(label_id)\r\n        if label is None:\r\n            return jsonify({\"code\": 1000, \"message\": APICODE[1000]})\r\n\r\n        label.label_name = label_name\r\n        UserLabelDao().update(label)\r\n\r\n    else:\r\n        label = UserLabel(label_name=label_name)\r\n        UserLabelDao().save(label)\r\n\r\n    return jsonify({\"code\": 1001, \"message\": APICODE[1001]})\r\n\r\n\r\n@bp.route(\"/label/add\", methods=[\"post\"])\r\n@login_required\r\ndef user_label_add():\r\n    \"\"\"\r\n        @用户打标签\r\n        param user_id 用户ID\r\n        param label_name 标签列表 []\r\n    \"\"\"\r\n    user_id = request_jsons(\"user_id\", type=int, required=True)\r\n    label_name_list = request_jsons(\"label_name_list\", type=list, default=[])\r\n\r\n    user = AccountsDao().get_user_id(user_id)\r\n    if user is None:\r\n        return jsonify({\"code\": 1004, \"message\": APICODE[1004]})\r\n\r\n    user.label = json.dumps(label_name_list)\r\n    AccountsDao().update(user)\r\n\r\n    return jsonify({\"code\": 1001, \"message\": APICODE[1001]})\r\n\r\n\r\n@bp.route(\"/label/statistics\", methods=[\"post\"])\r\n@login_required\r\ndef user_label_statistics():\r\n    \"\"\"\r\n        @标签使用统计\r\n        param label_name 标签名\r\n        param type 1添加 2删除\r\n    \"\"\"\r\n    label_name = request_jsons(\"label_name\", type=str, required=True)\r\n    type = request_jsons(\"type\", type=int, default=1)\r\n\r\n    label = UserLabelDao().get_label_name(label_name)\r\n    if label:\r\n        if type == 1:\r\n            label.label_num += 1\r\n        elif type == 2:\r\n            label.label_num -= 1\r\n\r\n        UserLabelDao().update(label)\r\n\r\n    return jsonify({\"code\": 1001, \"message\": APICODE[1001]})\r\n```","reactions":{"url":"https://api.github.com/repos/psf/black/issues/783/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/psf/black/issues/783/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"id":2319839238,"node_id":"MDEzOkFzc2lnbmVkRXZlbnQyMzE5ODM5MjM4","url":"https://api.github.com/repos/psf/black/issues/events/2319839238","actor":{"login":"JelleZijlstra","id":906600,"node_id":"MDQ6VXNlcjkwNjYwMA==","avatar_url":"https://avatars.githubusercontent.com/u/906600?v=4","gravatar_id":"","url":"https://api.github.com/users/JelleZijlstra","html_url":"https://github.com/JelleZijlstra","followers_url":"https://api.github.com/users/JelleZijlstra/followers","following_url":"https://api.github.com/users/JelleZijlstra/following{/other_user}","gists_url":"https://api.github.com/users/JelleZijlstra/gists{/gist_id}","starred_url":"https://api.github.com/users/JelleZijlstra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JelleZijlstra/subscriptions","organizations_url":"https://api.github.com/users/JelleZijlstra/orgs","repos_url":"https://api.github.com/users/JelleZijlstra/repos","events_url":"https://api.github.com/users/JelleZijlstra/events{/privacy}","received_events_url":"https://api.github.com/users/JelleZijlstra/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"assigned","commit_id":null,"commit_url":null,"created_at":"2019-05-05T22:58:59Z","assignee":{"login":"JelleZijlstra","id":906600,"node_id":"MDQ6VXNlcjkwNjYwMA==","avatar_url":"https://avatars.githubusercontent.com/u/906600?v=4","gravatar_id":"","url":"https://api.github.com/users/JelleZijlstra","html_url":"https://github.com/JelleZijlstra","followers_url":"https://api.github.com/users/JelleZijlstra/followers","following_url":"https://api.github.com/users/JelleZijlstra/following{/other_user}","gists_url":"https://api.github.com/users/JelleZijlstra/gists{/gist_id}","starred_url":"https://api.github.com/users/JelleZijlstra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JelleZijlstra/subscriptions","organizations_url":"https://api.github.com/users/JelleZijlstra/orgs","repos_url":"https://api.github.com/users/JelleZijlstra/repos","events_url":"https://api.github.com/users/JelleZijlstra/events{/privacy}","received_events_url":"https://api.github.com/users/JelleZijlstra/received_events","type":"User","user_view_type":"public","site_admin":false},"performed_via_github_app":null},{"id":2319845903,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDIzMTk4NDU5MDM=","url":"https://api.github.com/repos/psf/black/issues/events/2319845903","actor":{"login":"JelleZijlstra","id":906600,"node_id":"MDQ6VXNlcjkwNjYwMA==","avatar_url":"https://avatars.githubusercontent.com/u/906600?v=4","gravatar_id":"","url":"https://api.github.com/users/JelleZijlstra","html_url":"https://github.com/JelleZijlstra","followers_url":"https://api.github.com/users/JelleZijlstra/followers","following_url":"https://api.github.com/users/JelleZijlstra/following{/other_user}","gists_url":"https://api.github.com/users/JelleZijlstra/gists{/gist_id}","starred_url":"https://api.github.com/users/JelleZijlstra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JelleZijlstra/subscriptions","organizations_url":"https://api.github.com/users/JelleZijlstra/orgs","repos_url":"https://api.github.com/users/JelleZijlstra/repos","events_url":"https://api.github.com/users/JelleZijlstra/events{/privacy}","received_events_url":"https://api.github.com/users/JelleZijlstra/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"b20e182b8e59f5a26cbcc566a882af4ad2e3a546","commit_url":"https://api.github.com/repos/JelleZijlstra/black/commits/b20e182b8e59f5a26cbcc566a882af4ad2e3a546","created_at":"2019-05-05T23:15:53Z","performed_via_github_app":null},{"actor":{"login":"JelleZijlstra","id":906600,"node_id":"MDQ6VXNlcjkwNjYwMA==","avatar_url":"https://avatars.githubusercontent.com/u/906600?v=4","gravatar_id":"","url":"https://api.github.com/users/JelleZijlstra","html_url":"https://github.com/JelleZijlstra","followers_url":"https://api.github.com/users/JelleZijlstra/followers","following_url":"https://api.github.com/users/JelleZijlstra/following{/other_user}","gists_url":"https://api.github.com/users/JelleZijlstra/gists{/gist_id}","starred_url":"https://api.github.com/users/JelleZijlstra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JelleZijlstra/subscriptions","organizations_url":"https://api.github.com/users/JelleZijlstra/orgs","repos_url":"https://api.github.com/users/JelleZijlstra/repos","events_url":"https://api.github.com/users/JelleZijlstra/events{/privacy}","received_events_url":"https://api.github.com/users/JelleZijlstra/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-05-05T23:16:38Z","updated_at":"2019-05-05T23:16:38Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/psf/black/issues/829","repository_url":"https://api.github.com/repos/psf/black","labels_url":"https://api.github.com/repos/psf/black/issues/829/labels{/name}","comments_url":"https://api.github.com/repos/psf/black/issues/829/comments","events_url":"https://api.github.com/repos/psf/black/issues/829/events","html_url":"https://github.com/psf/black/pull/829","id":440501950,"node_id":"MDExOlB1bGxSZXF1ZXN0Mjc2MDM0MDcy","number":829,"title":"fix handling of comments in from imports","user":{"login":"JelleZijlstra","id":906600,"node_id":"MDQ6VXNlcjkwNjYwMA==","avatar_url":"https://avatars.githubusercontent.com/u/906600?v=4","gravatar_id":"","url":"https://api.github.com/users/JelleZijlstra","html_url":"https://github.com/JelleZijlstra","followers_url":"https://api.github.com/users/JelleZijlstra/followers","following_url":"https://api.github.com/users/JelleZijlstra/following{/other_user}","gists_url":"https://api.github.com/users/JelleZijlstra/gists{/gist_id}","starred_url":"https://api.github.com/users/JelleZijlstra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JelleZijlstra/subscriptions","organizations_url":"https://api.github.com/users/JelleZijlstra/orgs","repos_url":"https://api.github.com/users/JelleZijlstra/repos","events_url":"https://api.github.com/users/JelleZijlstra/events{/privacy}","received_events_url":"https://api.github.com/users/JelleZijlstra/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-05-05T23:16:38Z","updated_at":"2019-09-09T02:33:34Z","closed_at":"2019-05-06T13:13:26Z","author_association":"COLLABORATOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":125266328,"node_id":"MDEwOlJlcG9zaXRvcnkxMjUyNjYzMjg=","name":"black","full_name":"psf/black","private":false,"owner":{"login":"psf","id":50630501,"node_id":"MDEyOk9yZ2FuaXphdGlvbjUwNjMwNTAx","avatar_url":"https://avatars.githubusercontent.com/u/50630501?v=4","gravatar_id":"","url":"https://api.github.com/users/psf","html_url":"https://github.com/psf","followers_url":"https://api.github.com/users/psf/followers","following_url":"https://api.github.com/users/psf/following{/other_user}","gists_url":"https://api.github.com/users/psf/gists{/gist_id}","starred_url":"https://api.github.com/users/psf/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/psf/subscriptions","organizations_url":"https://api.github.com/users/psf/orgs","repos_url":"https://api.github.com/users/psf/repos","events_url":"https://api.github.com/users/psf/events{/privacy}","received_events_url":"https://api.github.com/users/psf/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/psf/black","description":"The uncompromising Python code formatter","fork":false,"url":"https://api.github.com/repos/psf/black","forks_url":"https://api.github.com/repos/psf/black/forks","keys_url":"https://api.github.com/repos/psf/black/keys{/key_id}","collaborators_url":"https://api.github.com/repos/psf/black/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/psf/black/teams","hooks_url":"https://api.github.com/repos/psf/black/hooks","issue_events_url":"https://api.github.com/repos/psf/black/issues/events{/number}","events_url":"https://api.github.com/repos/psf/black/events","assignees_url":"https://api.github.com/repos/psf/black/assignees{/user}","branches_url":"https://api.github.com/repos/psf/black/branches{/branch}","tags_url":"https://api.github.com/repos/psf/black/tags","blobs_url":"https://api.github.com/repos/psf/black/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/psf/black/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/psf/black/git/refs{/sha}","trees_url":"https://api.github.com/repos/psf/black/git/trees{/sha}","statuses_url":"https://api.github.com/repos/psf/black/statuses/{sha}","languages_url":"https://api.github.com/repos/psf/black/languages","stargazers_url":"https://api.github.com/repos/psf/black/stargazers","contributors_url":"https://api.github.com/repos/psf/black/contributors","subscribers_url":"https://api.github.com/repos/psf/black/subscribers","subscription_url":"https://api.github.com/repos/psf/black/subscription","commits_url":"https://api.github.com/repos/psf/black/commits{/sha}","git_commits_url":"https://api.github.com/repos/psf/black/git/commits{/sha}","comments_url":"https://api.github.com/repos/psf/black/comments{/number}","issue_comment_url":"https://api.github.com/repos/psf/black/issues/comments{/number}","contents_url":"https://api.github.com/repos/psf/black/contents/{+path}","compare_url":"https://api.github.com/repos/psf/black/compare/{base}...{head}","merges_url":"https://api.github.com/repos/psf/black/merges","archive_url":"https://api.github.com/repos/psf/black/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/psf/black/downloads","issues_url":"https://api.github.com/repos/psf/black/issues{/number}","pulls_url":"https://api.github.com/repos/psf/black/pulls{/number}","milestones_url":"https://api.github.com/repos/psf/black/milestones{/number}","notifications_url":"https://api.github.com/repos/psf/black/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/psf/black/labels{/name}","releases_url":"https://api.github.com/repos/psf/black/releases{/id}","deployments_url":"https://api.github.com/repos/psf/black/deployments","created_at":"2018-03-14T19:54:45Z","updated_at":"2025-11-09T16:48:04Z","pushed_at":"2025-11-05T18:14:18Z","git_url":"git://github.com/psf/black.git","ssh_url":"git@github.com:psf/black.git","clone_url":"https://github.com/psf/black.git","svn_url":"https://github.com/psf/black","homepage":"https://black.readthedocs.io/en/stable/","size":7569,"stargazers_count":41126,"watchers_count":41126,"language":"Python","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":2665,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":337,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["autopep8","code","codeformatter","formatter","gofmt","hacktoberfest","pre-commit-hook","python","yapf"],"visibility":"public","forks":2665,"open_issues":337,"watchers":41126,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/psf/black/pulls/829","html_url":"https://github.com/psf/black/pull/829","diff_url":"https://github.com/psf/black/pull/829.diff","patch_url":"https://github.com/psf/black/pull/829.patch","merged_at":"2019-05-06T13:13:26Z"},"body":"Fixes #671","reactions":{"url":"https://api.github.com/repos/psf/black/issues/829/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/psf/black/issues/829/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":2320932148,"node_id":"MDExOkNsb3NlZEV2ZW50MjMyMDkzMjE0OA==","url":"https://api.github.com/repos/psf/black/issues/events/2320932148","actor":{"login":"JelleZijlstra","id":906600,"node_id":"MDQ6VXNlcjkwNjYwMA==","avatar_url":"https://avatars.githubusercontent.com/u/906600?v=4","gravatar_id":"","url":"https://api.github.com/users/JelleZijlstra","html_url":"https://github.com/JelleZijlstra","followers_url":"https://api.github.com/users/JelleZijlstra/followers","following_url":"https://api.github.com/users/JelleZijlstra/following{/other_user}","gists_url":"https://api.github.com/users/JelleZijlstra/gists{/gist_id}","starred_url":"https://api.github.com/users/JelleZijlstra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JelleZijlstra/subscriptions","organizations_url":"https://api.github.com/users/JelleZijlstra/orgs","repos_url":"https://api.github.com/users/JelleZijlstra/repos","events_url":"https://api.github.com/users/JelleZijlstra/events{/privacy}","received_events_url":"https://api.github.com/users/JelleZijlstra/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2019-05-06T13:13:26Z","state_reason":null,"performed_via_github_app":null},{"id":2320932289,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDIzMjA5MzIyODk=","url":"https://api.github.com/repos/psf/black/issues/events/2320932289","actor":{"login":"JelleZijlstra","id":906600,"node_id":"MDQ6VXNlcjkwNjYwMA==","avatar_url":"https://avatars.githubusercontent.com/u/906600?v=4","gravatar_id":"","url":"https://api.github.com/users/JelleZijlstra","html_url":"https://github.com/JelleZijlstra","followers_url":"https://api.github.com/users/JelleZijlstra/followers","following_url":"https://api.github.com/users/JelleZijlstra/following{/other_user}","gists_url":"https://api.github.com/users/JelleZijlstra/gists{/gist_id}","starred_url":"https://api.github.com/users/JelleZijlstra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JelleZijlstra/subscriptions","organizations_url":"https://api.github.com/users/JelleZijlstra/orgs","repos_url":"https://api.github.com/users/JelleZijlstra/repos","events_url":"https://api.github.com/users/JelleZijlstra/events{/privacy}","received_events_url":"https://api.github.com/users/JelleZijlstra/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"6b994fdb8ab70ce4c2eafb8f2f0ff2648f3ff1ef","commit_url":"https://api.github.com/repos/psf/black/commits/6b994fdb8ab70ce4c2eafb8f2f0ff2648f3ff1ef","created_at":"2019-05-06T13:13:29Z","performed_via_github_app":null},{"actor":{"login":"ichard26","id":63936253,"node_id":"MDQ6VXNlcjYzOTM2MjUz","avatar_url":"https://avatars.githubusercontent.com/u/63936253?v=4","gravatar_id":"","url":"https://api.github.com/users/ichard26","html_url":"https://github.com/ichard26","followers_url":"https://api.github.com/users/ichard26/followers","following_url":"https://api.github.com/users/ichard26/following{/other_user}","gists_url":"https://api.github.com/users/ichard26/gists{/gist_id}","starred_url":"https://api.github.com/users/ichard26/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ichard26/subscriptions","organizations_url":"https://api.github.com/users/ichard26/orgs","repos_url":"https://api.github.com/users/ichard26/repos","events_url":"https://api.github.com/users/ichard26/events{/privacy}","received_events_url":"https://api.github.com/users/ichard26/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-07T00:57:30Z","updated_at":"2020-11-07T00:57:30Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/psf/black/issues/1808","repository_url":"https://api.github.com/repos/psf/black","labels_url":"https://api.github.com/repos/psf/black/issues/1808/labels{/name}","comments_url":"https://api.github.com/repos/psf/black/issues/1808/comments","events_url":"https://api.github.com/repos/psf/black/issues/1808/events","html_url":"https://github.com/psf/black/issues/1808","id":737796866,"node_id":"MDU6SXNzdWU3Mzc3OTY4NjY=","number":1808,"title":"Failure on multiline import","user":{"login":"gbernstein6","id":13679774,"node_id":"MDQ6VXNlcjEzNjc5Nzc0","avatar_url":"https://avatars.githubusercontent.com/u/13679774?v=4","gravatar_id":"","url":"https://api.github.com/users/gbernstein6","html_url":"https://github.com/gbernstein6","followers_url":"https://api.github.com/users/gbernstein6/followers","following_url":"https://api.github.com/users/gbernstein6/following{/other_user}","gists_url":"https://api.github.com/users/gbernstein6/gists{/gist_id}","starred_url":"https://api.github.com/users/gbernstein6/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gbernstein6/subscriptions","organizations_url":"https://api.github.com/users/gbernstein6/orgs","repos_url":"https://api.github.com/users/gbernstein6/repos","events_url":"https://api.github.com/users/gbernstein6/events{/privacy}","received_events_url":"https://api.github.com/users/gbernstein6/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":867432792,"node_id":"MDU6TGFiZWw4Njc0MzI3OTI=","url":"https://api.github.com/repos/psf/black/labels/T:%20bug","name":"T: bug","color":"d73a4a","default":false,"description":"Something isn't working"},{"id":867432794,"node_id":"MDU6TGFiZWw4Njc0MzI3OTQ=","url":"https://api.github.com/repos/psf/black/labels/R:%20duplicate","name":"R: duplicate","color":"ffffff","default":false,"description":"This issue or pull request already exists"},{"id":867438288,"node_id":"MDU6TGFiZWw4Njc0MzgyODg=","url":"https://api.github.com/repos/psf/black/labels/C:%20invalid%20code","name":"C: invalid code","color":"ff0000","default":false,"description":"Black destroyed a valid Python file"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2020-11-06T14:21:13Z","updated_at":"2020-11-09T13:51:49Z","closed_at":"2020-11-07T00:57:30Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":125266328,"node_id":"MDEwOlJlcG9zaXRvcnkxMjUyNjYzMjg=","name":"black","full_name":"psf/black","private":false,"owner":{"login":"psf","id":50630501,"node_id":"MDEyOk9yZ2FuaXphdGlvbjUwNjMwNTAx","avatar_url":"https://avatars.githubusercontent.com/u/50630501?v=4","gravatar_id":"","url":"https://api.github.com/users/psf","html_url":"https://github.com/psf","followers_url":"https://api.github.com/users/psf/followers","following_url":"https://api.github.com/users/psf/following{/other_user}","gists_url":"https://api.github.com/users/psf/gists{/gist_id}","starred_url":"https://api.github.com/users/psf/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/psf/subscriptions","organizations_url":"https://api.github.com/users/psf/orgs","repos_url":"https://api.github.com/users/psf/repos","events_url":"https://api.github.com/users/psf/events{/privacy}","received_events_url":"https://api.github.com/users/psf/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/psf/black","description":"The uncompromising Python code formatter","fork":false,"url":"https://api.github.com/repos/psf/black","forks_url":"https://api.github.com/repos/psf/black/forks","keys_url":"https://api.github.com/repos/psf/black/keys{/key_id}","collaborators_url":"https://api.github.com/repos/psf/black/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/psf/black/teams","hooks_url":"https://api.github.com/repos/psf/black/hooks","issue_events_url":"https://api.github.com/repos/psf/black/issues/events{/number}","events_url":"https://api.github.com/repos/psf/black/events","assignees_url":"https://api.github.com/repos/psf/black/assignees{/user}","branches_url":"https://api.github.com/repos/psf/black/branches{/branch}","tags_url":"https://api.github.com/repos/psf/black/tags","blobs_url":"https://api.github.com/repos/psf/black/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/psf/black/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/psf/black/git/refs{/sha}","trees_url":"https://api.github.com/repos/psf/black/git/trees{/sha}","statuses_url":"https://api.github.com/repos/psf/black/statuses/{sha}","languages_url":"https://api.github.com/repos/psf/black/languages","stargazers_url":"https://api.github.com/repos/psf/black/stargazers","contributors_url":"https://api.github.com/repos/psf/black/contributors","subscribers_url":"https://api.github.com/repos/psf/black/subscribers","subscription_url":"https://api.github.com/repos/psf/black/subscription","commits_url":"https://api.github.com/repos/psf/black/commits{/sha}","git_commits_url":"https://api.github.com/repos/psf/black/git/commits{/sha}","comments_url":"https://api.github.com/repos/psf/black/comments{/number}","issue_comment_url":"https://api.github.com/repos/psf/black/issues/comments{/number}","contents_url":"https://api.github.com/repos/psf/black/contents/{+path}","compare_url":"https://api.github.com/repos/psf/black/compare/{base}...{head}","merges_url":"https://api.github.com/repos/psf/black/merges","archive_url":"https://api.github.com/repos/psf/black/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/psf/black/downloads","issues_url":"https://api.github.com/repos/psf/black/issues{/number}","pulls_url":"https://api.github.com/repos/psf/black/pulls{/number}","milestones_url":"https://api.github.com/repos/psf/black/milestones{/number}","notifications_url":"https://api.github.com/repos/psf/black/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/psf/black/labels{/name}","releases_url":"https://api.github.com/repos/psf/black/releases{/id}","deployments_url":"https://api.github.com/repos/psf/black/deployments","created_at":"2018-03-14T19:54:45Z","updated_at":"2025-11-09T16:48:04Z","pushed_at":"2025-11-05T18:14:18Z","git_url":"git://github.com/psf/black.git","ssh_url":"git@github.com:psf/black.git","clone_url":"https://github.com/psf/black.git","svn_url":"https://github.com/psf/black","homepage":"https://black.readthedocs.io/en/stable/","size":7569,"stargazers_count":41126,"watchers_count":41126,"language":"Python","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":2665,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":337,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["autopep8","code","codeformatter","formatter","gofmt","hacktoberfest","pre-commit-hook","python","yapf"],"visibility":"public","forks":2665,"open_issues":337,"watchers":41126,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"Black fails to execute for the below code. The issue is the comma after `squeeze`. When I remove the comma it then reformats the file so that the comma reappears on a newline after `# safe_eval,`. Error message and logfile contents below as well.\r\n\r\n```\r\nerror: cannot format src/palantir/test.py: INTERNAL ERROR: Black produced invalid code: invalid syntax (<unknown>, line 11). Please report a bug on https://github.com/ambv/black/issues.  This invalid output might be helpful: /var/folders/5w/dvsy4xlx59b0q005dm_30_280000gp/T/blk_e31j3dau.log\r\n```\r\n\r\n```\r\nFile \".../.cache/pre-commit/repojk41ik_w/py_env-python3/lib/python3.7/site-packages/black.py\", line 3303, in assert_equivalent dst_ast = ast.parse(dst)\r\n\r\n  File \".../.pyenv/versions/3.7.6/lib/python3.7/ast.py\", line 35, in parse return compile(source, filename, mode, PyCF_ONLY_AST)\r\n```\r\n\r\n```\r\n\r\nfrom numpy import (\r\n    sum,\r\n    shape,\r\n    source,\r\n    squeeze,\r\n    # save,\r\n    # select,\r\n    # shape_base,\r\n    # setup,\r\n    # safe_eval,\r\n)\r\n\r\nsum()\r\nshape()\r\nsource()\r\nsqueeze()\r\nsave()\r\nselect()\r\nshape_base()\r\nsetup()\r\nsafe_eval()\r\n```","reactions":{"url":"https://api.github.com/repos/psf/black/issues/1808/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/psf/black/issues/1808/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"}]