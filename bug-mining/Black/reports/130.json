{"url":"https://api.github.com/repos/psf/black/issues/1064","repository_url":"https://api.github.com/repos/psf/black","labels_url":"https://api.github.com/repos/psf/black/issues/1064/labels{/name}","comments_url":"https://api.github.com/repos/psf/black/issues/1064/comments","events_url":"https://api.github.com/repos/psf/black/issues/1064/events","html_url":"https://github.com/psf/black/issues/1064","id":506828469,"node_id":"MDU6SXNzdWU1MDY4Mjg0Njk=","number":1064,"title":"Please update docstring for format_str() method","user":{"login":"ProbonoBonobo","id":4884737,"node_id":"MDQ6VXNlcjQ4ODQ3Mzc=","avatar_url":"https://avatars.githubusercontent.com/u/4884737?v=4","gravatar_id":"","url":"https://api.github.com/users/ProbonoBonobo","html_url":"https://github.com/ProbonoBonobo","followers_url":"https://api.github.com/users/ProbonoBonobo/followers","following_url":"https://api.github.com/users/ProbonoBonobo/following{/other_user}","gists_url":"https://api.github.com/users/ProbonoBonobo/gists{/gist_id}","starred_url":"https://api.github.com/users/ProbonoBonobo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ProbonoBonobo/subscriptions","organizations_url":"https://api.github.com/users/ProbonoBonobo/orgs","repos_url":"https://api.github.com/users/ProbonoBonobo/repos","events_url":"https://api.github.com/users/ProbonoBonobo/events{/privacy}","received_events_url":"https://api.github.com/users/ProbonoBonobo/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-10-14T19:16:19Z","updated_at":"2020-03-04T22:18:16Z","closed_at":"2020-03-04T22:18:15Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Operating system: Ubuntu 19.04\r\nPython version: 3.7.4\r\n*Black* version: 19.03b\r\nDoes also happen on master: Yes\r\n\r\nI'm trying to use black programmatically to diff a code string before/after transformation. The `format_str` method appears to be my best bet for this, but that function takes a required keyword-only `mode` argument which is not described by the docstring. The type annotations in the signature of `format_str` helpfully suggest this argument must be a `black.FileMode` instance, but after reading several different docstrings I'm still at a loss how to appease this method.\r\n\r\nExample usage of this method in the docstring, or at least an explanation of the `mode` parameter, would be really helpful.\r\n\r\n\r\n\r\n```\r\n>>> import black\r\n>>> black.format_str(obfuscated)\r\nTraceback (most recent call last):\r\n  File \"/home/kz/.local/pyenv/versions/3.7.3/lib/python3.7/site-packages/IPython/core/interactiveshell.py\", line 3326, in run_code\r\n    exec(code_obj, self.user_global_ns, self.user_ns)\r\n  File \"<ipython-input-6-ae5fae166c69>\", line 1, in <module>\r\n    black.format_str(obfuscated)\r\nTypeError: format_str() missing 1 required keyword-only argument: 'mode'\r\n```\r\n\r\nAh no worries, we'll just check the docstring...\r\n\r\n```\r\n>>> help(black.format_str)\r\nHelp on function format_str in module black:\r\nformat_str(src_contents: str, *, mode: black.FileMode) -> str\r\n    Reformat a string and return new contents.\r\n    \r\n    `line_length` determines how many characters per line are allowed.\r\n```\r\n\r\nI'm guessing the API has recently changed, because `line_length` is no longer present in the signature. Still, at least now we know the type of argument `mode` is expecting... we'll check the docstring for that.\r\n\r\n```\r\n>>> help(black.FileMode)\r\nHelp on class FileMode in module black:\r\nclass FileMode(builtins.object)\r\n |  FileMode(target_versions: Set[black.TargetVersion] = NOTHING, line_length: int = 88, string_normalization: bool = True, is_pyi: bool = False) -> None\r\n |  \r\n |  Methods defined here:\r\n |  \r\n |  __eq__(self, other)\r\n |      Return self==value.\r\n |  \r\n |  __ge__(self, other)\r\n |      Automatically created by attrs.\r\n |  \r\n |  __gt__(self, other)\r\n |      Automatically created by attrs.\r\n |  \r\n |  __init__(self, target_versions: Set[black.TargetVersion] = NOTHING, line_length: int = 88, string_normalization: bool = True, is_pyi: bool = False) -> None\r\n |      Initialize self.  See help(type(self)) for accurate signature.\r\n |  \r\n |  __le__(self, other)\r\n |      Automatically created by attrs.\r\n |  \r\n |  __lt__(self, other)\r\n |      Automatically created by attrs.\r\n |  \r\n |  __ne__(self, other)\r\n |      Check equality and either forward a NotImplemented or return the result\r\n |      negated.\r\n |  \r\n |  __repr__(self)\r\n |      Automatically created by attrs.\r\n |  \r\n |  get_cache_key(self) -> str\r\n |  \r\n |  ----------------------------------------------------------------------\r\n |  Data descriptors defined here:\r\n |  \r\n |  __dict__\r\n |      dictionary for instance variables (if defined)\r\n |  \r\n |  __weakref__\r\n |      list of weak references to the object (if defined)\r\n |  \r\n |  ----------------------------------------------------------------------\r\n |  Data and other attributes defined here:\r\n |  \r\n |  __annotations__ = {'is_pyi': <class 'bool'>, 'line_length': <class 'in...\r\n |  \r\n |  __attrs_attrs__ = (Attribute(name='target_versions', default=Facto...e...\r\n |  \r\n |  __hash__ = None\r\n```\r\n\r\nSo if I'm reading this correctly, the `black.FileMode` class maps `black.TargetVersion` keys to some configuration settings. Ok, let's make a `black.TargetVersion` object...\r\n\r\n```\r\n>>> black.TargetVersion\r\n<enum 'TargetVersion'>\r\n>>> help(black.TargetVersion)\r\nHelp on class TargetVersion in module black:\r\nclass TargetVersion(enum.Enum)\r\n |  TargetVersion(value, names=None, *, module=None, qualname=None, type=None, start=1)\r\n |  \r\n |  An enumeration.\r\n |  \r\n |  Method resolution order:\r\n |      TargetVersion\r\n |      enum.Enum\r\n |      builtins.object\r\n |  \r\n |  Data and other attributes defined here:\r\n |  \r\n |  PY27 = <TargetVersion.PY27: 2>\r\n |  \r\n |  PY33 = <TargetVersion.PY33: 3>\r\n |  \r\n |  PY34 = <TargetVersion.PY34: 4>\r\n |  \r\n |  PY35 = <TargetVersion.PY35: 5>\r\n |  \r\n |  PY36 = <TargetVersion.PY36: 6>\r\n |  \r\n |  PY37 = <TargetVersion.PY37: 7>\r\n |  \r\n |  PY38 = <TargetVersion.PY38: 8>\r\n |  \r\n |  ----------------------------------------------------------------------\r\n |  Data descriptors inherited from enum.Enum:\r\n |  \r\n |  name\r\n |      The name of the Enum member.\r\n |  \r\n |  value\r\n |      The value of the Enum member.\r\n |  \r\n |  ----------------------------------------------------------------------\r\n |  Data descriptors inherited from enum.EnumMeta:\r\n |  \r\n |  __members__\r\n |      Returns a mapping of member name->value.\r\n |      \r\n |      This mapping lists all enum members, including aliases. Note that this\r\n |      is a read-only view of the internal mapping.\r\n\r\n>>> type(black.TargetVersion['PY37']) \r\n<enum 'TargetVersion'>\r\n\r\n```\r\n\r\nPhew,  alright we have a TargetVersion object. Let's turn it into a file mode object...\r\n```\r\n>>>  black.FileMode(black.TargetVersion['PY37'])                                               \r\nFileMode(target_versions=<TargetVersion.PY37: 7>, line_length=88, string_normalization=True, is_pyi=False)\r\n\r\n```\r\n\r\nCool. Looks like a FileMode. Let's try this again... \r\n\r\n```\r\nblack.format_str(\"def square   (    x     ) :   \\n        return x * x       \\n\\n\", mode=black.FileMode(black.TargetVersion['PY37']))\r\n---------------------------------------------------------------------------\r\nTypeError                                 Traceback (most recent call last)\r\n<ipython-input-14-6a7482dec2f5> in <module>\r\n----> 1 black.format_str(\"def square   (    x     ) :   \\n        return x * x       \\n\\n\", mode=black.FileMode(black.TargetVersion['PY37']))\r\n\r\n~/.local/pyenv/versions/3.7.3/lib/python3.7/site-packages/black.py in format_str(src_contents, mode)\r\n    667     `line_length` determines how many characters per line are allowed.\r\n    668     \"\"\"\r\n--> 669     src_node = lib2to3_parse(src_contents.lstrip(), mode.target_versions)\r\n    670     dst_contents = \"\"\r\n    671     future_imports = get_future_imports(src_node)\r\n\r\n~/.local/pyenv/versions/3.7.3/lib/python3.7/site-packages/black.py in lib2to3_parse(src_txt, target_versions)\r\n    741         src_txt += \"\\n\"\r\n    742 \r\n--> 743     for grammar in get_grammars(set(target_versions)):\r\n    744         drv = driver.Driver(grammar, pytree.convert)\r\n    745         try:\r\n\r\nTypeError: 'TargetVersion' object is not iterable\r\n\r\n```\r\n\r\nðŸ˜‘ I give up...\r\n","closed_by":{"login":"ambv","id":55281,"node_id":"MDQ6VXNlcjU1Mjgx","avatar_url":"https://avatars.githubusercontent.com/u/55281?v=4","gravatar_id":"","url":"https://api.github.com/users/ambv","html_url":"https://github.com/ambv","followers_url":"https://api.github.com/users/ambv/followers","following_url":"https://api.github.com/users/ambv/following{/other_user}","gists_url":"https://api.github.com/users/ambv/gists{/gist_id}","starred_url":"https://api.github.com/users/ambv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ambv/subscriptions","organizations_url":"https://api.github.com/users/ambv/orgs","repos_url":"https://api.github.com/users/ambv/repos","events_url":"https://api.github.com/users/ambv/events{/privacy}","received_events_url":"https://api.github.com/users/ambv/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/psf/black/issues/1064/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/psf/black/issues/1064/timeline","performed_via_github_app":null,"state_reason":"completed"}