{"url":"https://api.github.com/repos/psf/black/issues/1042","repository_url":"https://api.github.com/repos/psf/black","labels_url":"https://api.github.com/repos/psf/black/issues/1042/labels{/name}","comments_url":"https://api.github.com/repos/psf/black/issues/1042/comments","events_url":"https://api.github.com/repos/psf/black/issues/1042/events","html_url":"https://github.com/psf/black/issues/1042","id":501818759,"node_id":"MDU6SXNzdWU1MDE4MTg3NTk=","number":1042,"title":"Regression: Unstable formatting on long strings","user":{"login":"JelleZijlstra","id":906600,"node_id":"MDQ6VXNlcjkwNjYwMA==","avatar_url":"https://avatars.githubusercontent.com/u/906600?v=4","gravatar_id":"","url":"https://api.github.com/users/JelleZijlstra","html_url":"https://github.com/JelleZijlstra","followers_url":"https://api.github.com/users/JelleZijlstra/followers","following_url":"https://api.github.com/users/JelleZijlstra/following{/other_user}","gists_url":"https://api.github.com/users/JelleZijlstra/gists{/gist_id}","starred_url":"https://api.github.com/users/JelleZijlstra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JelleZijlstra/subscriptions","organizations_url":"https://api.github.com/users/JelleZijlstra/orgs","repos_url":"https://api.github.com/users/JelleZijlstra/repos","events_url":"https://api.github.com/users/JelleZijlstra/events{/privacy}","received_events_url":"https://api.github.com/users/JelleZijlstra/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-10-03T02:34:37Z","updated_at":"2019-10-20T16:02:18Z","closed_at":"2019-10-20T16:02:18Z","author_association":"COLLABORATOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I tested Black master on our codebase in preparation for a release, but found that Black failed to format 17 files (the previous release didn't crash on any of our files). It's not clear that all of these have the same root cause, but here's one I minimized somewhat:\r\n\r\n```\r\n$ black infra-common/qroxy/qroxy.py \r\nerror: cannot format infra-common/qroxy/qroxy.py: INTERNAL ERROR: Black produced different code on the second pass of the formatter.  Please report a bug on https://github.com/psf/black/issues.  This diff might be helpful: /tmp/blk_i040l_hj.log\r\nOh no! ðŸ’¥ ðŸ’” ðŸ’¥\r\n1 file failed to reformat.\r\n$ cat /tmp/blk_i040l_hj.log \r\n--- source\r\n+++ first pass\r\n@@ -1,10 +1,10 @@\r\n async def show_status():\r\n     while True:\r\n         try:\r\n             if report_host:\r\n                 data = (\r\n-                    f\"{boxname},{alive_server_connections},{server_queue.size()},{requester_queue.size()}\"\r\n-                ).encode()\r\n+                    f\"{boxname},{alive_server_connections},{server_queue.size()},{requester_queue.size()}\".encode()\r\n+                )\r\n         except Exception as e:\r\n             log.error(f\"show_status thread encounters exception: {e}\")\r\n \r\n--- first pass\r\n+++ second pass\r\n@@ -1,10 +1,8 @@\r\n async def show_status():\r\n     while True:\r\n         try:\r\n             if report_host:\r\n-                data = (\r\n-                    f\"{boxname},{alive_server_connections},{server_queue.size()},{requester_queue.size()}\".encode()\r\n-                )\r\n+                data = f\"{boxname},{alive_server_connections},{server_queue.size()},{requester_queue.size()}\".encode()\r\n         except Exception as e:\r\n             log.error(f\"show_status thread encounters exception: {e}\")\r\n \r\n$ cat infra-common/qroxy/qroxy.py \r\nasync def show_status():\r\n    while True:\r\n        try:\r\n            if report_host:\r\n                data = (\r\n                    f\"{boxname},{alive_server_connections},{server_queue.size()},{requester_queue.size()}\"\r\n                ).encode()\r\n        except Exception as e:\r\n            log.error(f\"show_status thread encounters exception: {e}\")\r\n\r\n```","closed_by":{"login":"JelleZijlstra","id":906600,"node_id":"MDQ6VXNlcjkwNjYwMA==","avatar_url":"https://avatars.githubusercontent.com/u/906600?v=4","gravatar_id":"","url":"https://api.github.com/users/JelleZijlstra","html_url":"https://github.com/JelleZijlstra","followers_url":"https://api.github.com/users/JelleZijlstra/followers","following_url":"https://api.github.com/users/JelleZijlstra/following{/other_user}","gists_url":"https://api.github.com/users/JelleZijlstra/gists{/gist_id}","starred_url":"https://api.github.com/users/JelleZijlstra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JelleZijlstra/subscriptions","organizations_url":"https://api.github.com/users/JelleZijlstra/orgs","repos_url":"https://api.github.com/users/JelleZijlstra/repos","events_url":"https://api.github.com/users/JelleZijlstra/events{/privacy}","received_events_url":"https://api.github.com/users/JelleZijlstra/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/psf/black/issues/1042/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/psf/black/issues/1042/timeline","performed_via_github_app":null,"state_reason":"completed"}