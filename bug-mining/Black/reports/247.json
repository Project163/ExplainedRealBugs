{"url":"https://api.github.com/repos/psf/black/issues/3555","repository_url":"https://api.github.com/repos/psf/black","labels_url":"https://api.github.com/repos/psf/black/issues/3555/labels{/name}","comments_url":"https://api.github.com/repos/psf/black/issues/3555/comments","events_url":"https://api.github.com/repos/psf/black/issues/3555/events","html_url":"https://github.com/psf/black/issues/3555","id":1574825287,"node_id":"I_kwDOB3dpmM5d3e1H","number":3555,"title":"Black unexpectedly alters comments and one-liner expressions when comments are placed above, when using --preview","user":{"login":"sjdemartini","id":1647130,"node_id":"MDQ6VXNlcjE2NDcxMzA=","avatar_url":"https://avatars.githubusercontent.com/u/1647130?v=4","gravatar_id":"","url":"https://api.github.com/users/sjdemartini","html_url":"https://github.com/sjdemartini","followers_url":"https://api.github.com/users/sjdemartini/followers","following_url":"https://api.github.com/users/sjdemartini/following{/other_user}","gists_url":"https://api.github.com/users/sjdemartini/gists{/gist_id}","starred_url":"https://api.github.com/users/sjdemartini/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sjdemartini/subscriptions","organizations_url":"https://api.github.com/users/sjdemartini/orgs","repos_url":"https://api.github.com/users/sjdemartini/repos","events_url":"https://api.github.com/users/sjdemartini/events{/privacy}","received_events_url":"https://api.github.com/users/sjdemartini/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":867432792,"node_id":"MDU6TGFiZWw4Njc0MzI3OTI=","url":"https://api.github.com/repos/psf/black/labels/T:%20bug","name":"T: bug","color":"d73a4a","default":false,"description":"Something isn't working"},{"id":4923632282,"node_id":"LA_kwDOB3dpmM8AAAABJXiqmg","url":"https://api.github.com/repos/psf/black/labels/C:%20preview%20style","name":"C: preview style","color":"E4C5D3","default":false,"description":"Issues with the preview and unstable style. Add the name of the responsible feature in the title."}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2023-02-07T18:21:19Z","updated_at":"2024-01-02T01:55:12Z","closed_at":"2024-01-02T01:55:12Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Describe the bug**\r\n\r\nWhen a comment is placed above a one-liner expression that uses a conditional statement, and `--preview` mode is on, black changes the comment and one-liner into a parenthesized block, or moves the comment to the end of the expression. The former situation with parentheses happens when the expression is preceded by at least one newline. The latter happens if there is no newline above the comment/expression. Neither of those formatting changes is expected.\r\n\r\nThis one-liner expression syntax isn't the cleanest, and I would guess black has this behavior for cases where you assign the expression result to a variable, but perhaps this situation should still be left unaltered by black.\r\n\r\n**To Reproduce**\r\n\r\nCheck this out in the black playground [here](https://black.vercel.app/?version=main&state=_Td6WFoAAATm1rRGAgAhARYAAAB0L-Wj4AHtAPRdAD2IimZxl1N_WlbvK5V9KEd05bPKfrgn-jS7XwT8BW-rAzTr1u24b-mgoqRREhj9HZa5HqC5KcCjLvnFQrxyrlkfy1eivFMEfQVBhi8-WRmqaJaBa3xPBprkdPfWFk8tx4u5Xidk5byolnQTCivP_dUSHL8rI_y85GRWD686YecWyGyWhZYGgI3I5b25OO5p-OnwjsED4dvFs4FZkFcd9kwKo1hqCVilLmQxgxTr5Pu7mzWZkyXjbEzRG_-xF1Kug4_qFpfQxEcdppZe50fh_YFAJnyv5M9faTjFHCjvQ8muU1XVJcUZsr8_3ftiBkgND7ncAQAAsIJVJITs70wAAZAC7gMAAKwZFZCxxGf7AgAAAAAEWVo=)\r\n\r\n\r\nInput code:\r\n\r\n```python\r\ndef foo(wait: bool = True):\r\n    # This full comment and the next one after it will get wrapped into\r\n    # the next one-liner unexpectedly\r\n    \r\n    # even if this comment is separated\r\n    time.sleep(1) if wait else None\r\n    time.sleep(1) if wait else None\r\n\r\n    # With newline above\r\n    time.sleep(1) if wait else None\r\n    # Without newline above\r\n    time.sleep(1) if wait else None\r\n```\r\n\r\nOutput using latest/`main` version of black with the `--preview` argument:\r\n\r\n```python\r\ndef foo(wait: bool = True):\r\n    (  # This full comment and the next one after it will get wrapped into\r\n        # the next one-liner unexpectedly\r\n        # even if this comment is separated\r\n        time.sleep(1)\r\n        if wait\r\n        else None\r\n    )\r\n    time.sleep(1) if wait else None\r\n    (\r\n        # With newline above\r\n        time.sleep(1)\r\n        if wait\r\n        else None\r\n    )\r\n    time.sleep(1) if wait else None  # Without newline above\r\n```\r\n\r\nExpected behavior: No change to the original code whatsoever. That was Black's behavior prior to the latest version, 23.1.0.\r\n\r\n**Environment**\r\n\r\n- Black's version: 23.1.0 or main\r\n- OS and Python version: Python 3.10, Mac","closed_by":{"login":"JelleZijlstra","id":906600,"node_id":"MDQ6VXNlcjkwNjYwMA==","avatar_url":"https://avatars.githubusercontent.com/u/906600?v=4","gravatar_id":"","url":"https://api.github.com/users/JelleZijlstra","html_url":"https://github.com/JelleZijlstra","followers_url":"https://api.github.com/users/JelleZijlstra/followers","following_url":"https://api.github.com/users/JelleZijlstra/following{/other_user}","gists_url":"https://api.github.com/users/JelleZijlstra/gists{/gist_id}","starred_url":"https://api.github.com/users/JelleZijlstra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JelleZijlstra/subscriptions","organizations_url":"https://api.github.com/users/JelleZijlstra/orgs","repos_url":"https://api.github.com/users/JelleZijlstra/repos","events_url":"https://api.github.com/users/JelleZijlstra/events{/privacy}","received_events_url":"https://api.github.com/users/JelleZijlstra/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/psf/black/issues/3555/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/psf/black/issues/3555/timeline","performed_via_github_app":null,"state_reason":"completed"}