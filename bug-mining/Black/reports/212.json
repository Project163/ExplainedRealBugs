{"url":"https://api.github.com/repos/psf/black/issues/2734","repository_url":"https://api.github.com/repos/psf/black","labels_url":"https://api.github.com/repos/psf/black/issues/2734/labels{/name}","comments_url":"https://api.github.com/repos/psf/black/issues/2734/comments","events_url":"https://api.github.com/repos/psf/black/issues/2734/events","html_url":"https://github.com/psf/black/issues/2734","id":1091362581,"node_id":"I_kwDOB3dpmM5BDN8V","number":2734,"title":"ESP: a standalone comment causes strings to be merged into one far too long (and requiring two passes to do so)","user":{"login":"ichard26","id":63936253,"node_id":"MDQ6VXNlcjYzOTM2MjUz","avatar_url":"https://avatars.githubusercontent.com/u/63936253?v=4","gravatar_id":"","url":"https://api.github.com/users/ichard26","html_url":"https://github.com/ichard26","followers_url":"https://api.github.com/users/ichard26/followers","following_url":"https://api.github.com/users/ichard26/following{/other_user}","gists_url":"https://api.github.com/users/ichard26/gists{/gist_id}","starred_url":"https://api.github.com/users/ichard26/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ichard26/subscriptions","organizations_url":"https://api.github.com/users/ichard26/orgs","repos_url":"https://api.github.com/users/ichard26/repos","events_url":"https://api.github.com/users/ichard26/events{/privacy}","received_events_url":"https://api.github.com/users/ichard26/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":867432792,"node_id":"MDU6TGFiZWw4Njc0MzI3OTI=","url":"https://api.github.com/repos/psf/black/labels/T:%20bug","name":"T: bug","color":"d73a4a","default":false,"description":"Something isn't working"},{"id":867439213,"node_id":"MDU6TGFiZWw4Njc0MzkyMTM=","url":"https://api.github.com/repos/psf/black/labels/C:%20unstable%20formatting","name":"C: unstable formatting","color":"ff0000","default":false,"description":"Formatting changed on the second pass"},{"id":2972766151,"node_id":"MDU6TGFiZWwyOTcyNzY2MTUx","url":"https://api.github.com/repos/psf/black/labels/F:%20strings","name":"F: strings","color":"BFD4F2","default":false,"description":"Related to our handling of strings"},{"id":3042838963,"node_id":"MDU6TGFiZWwzMDQyODM4OTYz","url":"https://api.github.com/repos/psf/black/labels/F:%20linetoolong","name":"F: linetoolong","color":"BFD4F2","default":false,"description":"Black makes our lines too long"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2021-12-31T00:53:41Z","updated_at":"2022-08-23T03:40:39Z","closed_at":"2022-08-23T03:40:39Z","author_association":"COLLABORATOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**To Reproduce**\r\n\r\nFor example, take this code:\r\n\r\n```python\r\ndef a():\r\n    CompiledSQL(\r\n        \"addresses.id AS addresses_id, \"\r\n        \"addresses.email_address AS addresses_email_address \"\r\n        # note the comma-separated FROM clause\r\n        \"IN (__[POSTCOMPILE_primary_keys]) \"\r\n        \"AND addresses.id = anon_1.id ORDER BY addresses.id\",\r\n        [\"hmm\"]\r\n    )\r\n```\r\n\r\nAnd run it with these arguments:\r\n\r\n```sh\r\n$ black file.py --experimental-string-processing\r\n```\r\n\r\nThe resulting error is:\r\n\r\n```\r\nerror: cannot format test.py: INTERNAL ERROR: Black produced different code on the second pass of the formatter.  Please report a bug on https://github.com/psf/black/issues.  This diff might be helpful: /tmp/blk_wqp6guhd.log\r\nOh no! ðŸ’¥ ðŸ’” ðŸ’¥\r\n1 file failed to reformat.\r\n```\r\n\r\n```diff\r\nMode(target_versions={<TargetVersion.PY36: 6>, <TargetVersion.PY38: 8>, <TargetVersion.PY37: 7>}, line_length=88, string_normalization=True, is_pyi=False, is_ipynb=False, magic_trailing_comma=True, experimental_string_processing=True)\r\n--- source\r\n+++ first pass\r\n@@ -1,9 +1,9 @@\r\n def a():\r\n     CompiledSQL(\r\n         \"addresses.id AS addresses_id, \"\r\n         \"addresses.email_address AS addresses_email_address \"\r\n         # note the comma-separated FROM clause\r\n-        \"IN (__[POSTCOMPILE_primary_keys]) \"\r\n-        \"AND addresses.id = anon_1.id ORDER BY addresses.id\",\r\n-        [\"hmm\"]\r\n+        \"IN (__[POSTCOMPILE_primary_keys]) AND addresses.id = anon_1.id ORDER BY\"\r\n+        \" addresses.id\",\r\n+        [\"hmm\"],\r\n     )\r\n--- first pass\r\n+++ second pass\r\n@@ -1,9 +1,8 @@\r\n def a():\r\n     CompiledSQL(\r\n         \"addresses.id AS addresses_id, \"\r\n         \"addresses.email_address AS addresses_email_address \"\r\n         # note the comma-separated FROM clause\r\n-        \"IN (__[POSTCOMPILE_primary_keys]) AND addresses.id = anon_1.id ORDER BY\"\r\n-        \" addresses.id\",\r\n+        \"IN (__[POSTCOMPILE_primary_keys]) AND addresses.id = anon_1.id ORDER BY addresses.id\",\r\n         [\"hmm\"],\r\n     )\r\n```\r\n\r\n**Expected behavior**\r\n\r\nIt not crashing :slightly_smiling_face: \r\n\r\n**Environment**\r\n\r\n<!-- Please complete the following information: -->\r\n\r\n- Black's version: main on b8df7e4b10bca2d7e478e224502975ec8f220e21\r\n- OS and Python version: Ubuntu 20.04.03 LTS w/ CPython 3.8.5\r\n\r\n**Additional context**\r\n\r\nThis was discovered by primer (in sqlalchemy, test/orm/test_relationship_criteria.py) and I wasn't able to fix it quickly so instead of letting primer fail on every build unproductively, I'm excluding it and filing this issue so we don't forget about it.","closed_by":{"login":"JelleZijlstra","id":906600,"node_id":"MDQ6VXNlcjkwNjYwMA==","avatar_url":"https://avatars.githubusercontent.com/u/906600?v=4","gravatar_id":"","url":"https://api.github.com/users/JelleZijlstra","html_url":"https://github.com/JelleZijlstra","followers_url":"https://api.github.com/users/JelleZijlstra/followers","following_url":"https://api.github.com/users/JelleZijlstra/following{/other_user}","gists_url":"https://api.github.com/users/JelleZijlstra/gists{/gist_id}","starred_url":"https://api.github.com/users/JelleZijlstra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JelleZijlstra/subscriptions","organizations_url":"https://api.github.com/users/JelleZijlstra/orgs","repos_url":"https://api.github.com/users/JelleZijlstra/repos","events_url":"https://api.github.com/users/JelleZijlstra/events{/privacy}","received_events_url":"https://api.github.com/users/JelleZijlstra/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/psf/black/issues/2734/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/psf/black/issues/2734/timeline","performed_via_github_app":null,"state_reason":"completed"}