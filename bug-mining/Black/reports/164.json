{"url":"https://api.github.com/repos/psf/black/issues/2157","repository_url":"https://api.github.com/repos/psf/black","labels_url":"https://api.github.com/repos/psf/black/issues/2157/labels{/name}","comments_url":"https://api.github.com/repos/psf/black/issues/2157/comments","events_url":"https://api.github.com/repos/psf/black/issues/2157/events","html_url":"https://github.com/psf/black/issues/2157","id":869197232,"node_id":"MDU6SXNzdWU4NjkxOTcyMzI=","number":2157,"title":"Exception raised if installed under root.","user":{"login":"Spacetown","id":40258682,"node_id":"MDQ6VXNlcjQwMjU4Njgy","avatar_url":"https://avatars.githubusercontent.com/u/40258682?v=4","gravatar_id":"","url":"https://api.github.com/users/Spacetown","html_url":"https://github.com/Spacetown","followers_url":"https://api.github.com/users/Spacetown/followers","following_url":"https://api.github.com/users/Spacetown/following{/other_user}","gists_url":"https://api.github.com/users/Spacetown/gists{/gist_id}","starred_url":"https://api.github.com/users/Spacetown/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Spacetown/subscriptions","organizations_url":"https://api.github.com/users/Spacetown/orgs","repos_url":"https://api.github.com/users/Spacetown/repos","events_url":"https://api.github.com/users/Spacetown/events{/privacy}","received_events_url":"https://api.github.com/users/Spacetown/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":867432792,"node_id":"MDU6TGFiZWw4Njc0MzI3OTI=","url":"https://api.github.com/repos/psf/black/labels/T:%20bug","name":"T: bug","color":"d73a4a","default":false,"description":"Something isn't working"},{"id":1348567694,"node_id":"MDU6TGFiZWwxMzQ4NTY3Njk0","url":"https://api.github.com/repos/psf/black/labels/C:%20configuration","name":"C: configuration","color":"16BC84","default":false,"description":"CLI and configuration"},{"id":2272618118,"node_id":"MDU6TGFiZWwyMjcyNjE4MTE4","url":"https://api.github.com/repos/psf/black/labels/C:%20crash","name":"C: crash","color":"ff0000","default":false,"description":"Black is crashing"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2021-04-27T19:35:10Z","updated_at":"2021-04-28T15:29:00Z","closed_at":"2021-04-27T21:16:36Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Describe the bug**\r\nIf black is installed under root and run as restricted user following exception is raised:\r\n```\r\npython3 -m black --diff doc gcovr\r\nRunning chmod with sudoTraceback (most recent call last):\r\n  File \"/usr/lib/python3.6/runpy.py\", line 193, in _run_module_as_main\r\n    \"__main__\", mod_spec)\r\n  File \"/usr/lib/python3.6/runpy.py\", line 85, in _run_code\r\n    exec(code, run_globals)\r\n  File \"/usr/local/lib/python3.6/dist-packages/black/__main__.py\", line 3, in <module>\r\n    patched_main()\r\n  File \"/usr/local/lib/python3.6/dist-packages/black/__init__.py\", line 7002, in patched_main\r\n    main()\r\n  File \"/usr/local/lib/python3.6/dist-packages/click/core.py\", line 829, in __call__\r\n    return self.main(*args, **kwargs)\r\n  File \"/usr/local/lib/python3.6/dist-packages/click/core.py\", line 781, in main\r\n    with self.make_context(prog_name, args, **extra) as ctx:\r\n  File \"/usr/local/lib/python3.6/dist-packages/click/core.py\", line 700, in make_context\r\n    self.parse_args(ctx, args)\r\n  File \"/usr/local/lib/python3.6/dist-packages/click/core.py\", line 1048, in parse_args\r\n    value, args = param.handle_parse_result(ctx, opts, args)\r\n  File \"/usr/local/lib/python3.6/dist-packages/click/core.py\", line 1630, in handle_parse_result\r\n    value = invoke_param_callback(self.callback, ctx, self, value)\r\n  File \"/usr/local/lib/python3.6/dist-packages/click/core.py\", line 123, in invoke_param_callback\r\n    return callback(ctx, param, value)\r\n  File \"/usr/local/lib/python3.6/dist-packages/black/__init__.py\", line 337, in read_pyproject_toml\r\n    value = find_pyproject_toml(ctx.params.get(\"src\", ()))\r\n  File \"/usr/local/lib/python3.6/dist-packages/black/__init__.py\", line 315, in find_pyproject_toml\r\n    return str(path_user_pyproject_toml) if path_user_pyproject_toml.is_file() else None\r\n  File \"/usr/lib/python3.6/pathlib.py\", line 1362, in is_file\r\n    return S_ISREG(self.stat().st_mode)\r\n  File \"/usr/lib/python3.6/pathlib.py\", line 1158, in stat\r\n    return self._accessor.stat(self)\r\n  File \"/usr/lib/python3.6/pathlib.py\", line 387, in wrapped\r\n    return strfunc(str(pathobj), *args)\r\nPermissionError: [Errno 13] Permission denied: '/root/.config/black'\r\n```\r\n\r\n**To Reproduce**\r\n\r\n1. Install black as root\r\n2. Run `python3 -m black --diff .`\r\n3. See error (e.g. https://github.com/Spacetown/gcovr/runs/2450843804?check_suite_focus=true)\r\n\r\n**Expected behavior**\r\n\r\nThe code shall formatted the same way as in `20.8b1, see https://github.com/Spacetown/gcovr/runs/2433190163?check_suite_focus=true.\r\n\r\n**Environment (please complete the following information):**\r\n\r\n- Version: 21.4b1\r\n- OS and Python version: Docker image based on ubuntu:18.04 with Python 3.6.7.\r\n\r\n**Does this bug also happen on master?**\r\n\r\nThis is the current master.\r\n\r\n**Additional context**\r\n-","closed_by":{"login":"JelleZijlstra","id":906600,"node_id":"MDQ6VXNlcjkwNjYwMA==","avatar_url":"https://avatars.githubusercontent.com/u/906600?v=4","gravatar_id":"","url":"https://api.github.com/users/JelleZijlstra","html_url":"https://github.com/JelleZijlstra","followers_url":"https://api.github.com/users/JelleZijlstra/followers","following_url":"https://api.github.com/users/JelleZijlstra/following{/other_user}","gists_url":"https://api.github.com/users/JelleZijlstra/gists{/gist_id}","starred_url":"https://api.github.com/users/JelleZijlstra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JelleZijlstra/subscriptions","organizations_url":"https://api.github.com/users/JelleZijlstra/orgs","repos_url":"https://api.github.com/users/JelleZijlstra/repos","events_url":"https://api.github.com/users/JelleZijlstra/events{/privacy}","received_events_url":"https://api.github.com/users/JelleZijlstra/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/psf/black/issues/2157/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/psf/black/issues/2157/timeline","performed_via_github_app":null,"state_reason":"completed"}