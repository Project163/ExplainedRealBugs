diff --git a/CHANGELOG.md b/CHANGELOG.md
index 84e4d8cea..568e8115b 100644
--- a/CHANGELOG.md
+++ b/CHANGELOG.md
@@ -19,6 +19,8 @@
   ([#7509](https://github.com/mitmproxy/mitmproxy/pull/7509), @EstherRoeth)
 - Fixed a bug that caused mitmproxy to crash when loading prior knowledge h2 flows.
   ([#7514](https://github.com/mitmproxy/mitmproxy/pull/7514), @sujaldev)
+- Fix a bug where mitmproxy would get stuck in secure web proxy mode when using `ignore_hosts` or `allow_hosts`.
+  ([#7519](https://github.com/mitmproxy/mitmproxy/pull/7519), @mhils)
 
 ## 12 January 2025: mitmproxy 11.1.0
 
diff --git a/mitmproxy/addons/next_layer.py b/mitmproxy/addons/next_layer.py
index 6d158745f..9f612d998 100644
--- a/mitmproxy/addons/next_layer.py
+++ b/mitmproxy/addons/next_layer.py
@@ -48,7 +48,6 @@ from mitmproxy.proxy.layers import UDPLayer
 from mitmproxy.proxy.layers.http import HTTPMode
 from mitmproxy.proxy.layers.quic import quic_parse_client_hello_from_datagrams
 from mitmproxy.proxy.layers.tls import dtls_parse_client_hello
-from mitmproxy.proxy.layers.tls import HTTP1_ALPNS
 from mitmproxy.proxy.layers.tls import HTTP_ALPNS
 from mitmproxy.proxy.layers.tls import parse_client_hello
 from mitmproxy.tls import ClientHello
@@ -281,7 +280,7 @@ class NextLayer:
         if context.client.transport_protocol != "tcp" or data_server:
             return None
 
-        host_header_expected = context.client.alpn in HTTP1_ALPNS or re.match(
+        host_header_expected = re.match(
             rb"[A-Z]{3,}.+HTTP/", data_client, re.IGNORECASE
         )
         if host_header_expected:
diff --git a/test/mitmproxy/addons/test_next_layer.py b/test/mitmproxy/addons/test_next_layer.py
index 10dfa3b6b..4694e3529 100644
--- a/test/mitmproxy/addons/test_next_layer.py
+++ b/test/mitmproxy/addons/test_next_layer.py
@@ -487,6 +487,23 @@ explicit_proxy_configs = [
         ),
         id=f"explicit proxy: secure web proxy",
     ),
+    pytest.param(
+        TConf(
+            before=[
+                modes.HttpProxy,
+                ClientTLSLayer,
+                partial(HttpLayer, mode=HTTPMode.regular),
+                partial(HttpStream, stream_id=1),
+            ],
+            after=[modes.HttpProxy, ClientTLSLayer, HttpLayer, HttpStream, TCPLayer],
+            server_address=("192.0.2.1", 443),
+            ignore_hosts=[".+"],
+            ignore_conn=True,
+            data_client=client_hello_with_extensions,
+            alpn=b"http/1.1",
+        ),
+        id=f"explicit proxy: ignore_hosts over established secure web proxy",
+    ),
     pytest.param(
         TConf(
             before=[modes.HttpUpstreamProxy],
