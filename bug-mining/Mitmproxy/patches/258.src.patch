diff --git a/mitmproxy/io/compat.py b/mitmproxy/io/compat.py
index 99da496d1..da9d2a44b 100644
--- a/mitmproxy/io/compat.py
+++ b/mitmproxy/io/compat.py
@@ -58,7 +58,7 @@ def convert_017_018(data):
     # convert_unicode needs to be called for every dual release and the first py3-only release
     data = convert_unicode(data)
 
-    data["server_conn"]["ip_address"] = data["server_conn"].pop("peer_address")
+    data["server_conn"]["ip_address"] = data["server_conn"].pop("peer_address", None)
     data["marked"] = False
     data["version"] = (0, 18)
     return data
