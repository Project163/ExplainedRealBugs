diff --git a/mitmproxy/addons/tlsconfig.py b/mitmproxy/addons/tlsconfig.py
index a05d63598..f46b7252a 100644
--- a/mitmproxy/addons/tlsconfig.py
+++ b/mitmproxy/addons/tlsconfig.py
@@ -172,7 +172,7 @@ class TlsConfig:
                     server.alpn_offers = tuple(client.alpn_offers)
                 else:
                     server.alpn_offers = tuple(x for x in client.alpn_offers if x != b"h2")
-            elif client.tls_established:
+            elif client.tls:
                 # We would perfectly support HTTP/1 -> HTTP/2, but we want to keep things on the same protocol version.
                 # There are some edge cases where we want to mirror the regular server's behavior accurately,
                 # for example header capitalization.
diff --git a/test/helper_tools/loggrep.py b/test/helper_tools/loggrep.py
index 005ca21b2..a986e47c4 100755
--- a/test/helper_tools/loggrep.py
+++ b/test/helper_tools/loggrep.py
@@ -1,6 +1,7 @@
 #!/usr/bin/env python3
 import fileinput
 import sys
+import re
 
 if __name__ == "__main__":
     if len(sys.argv) < 3:
@@ -10,7 +11,7 @@ if __name__ == "__main__":
     port = sys.argv[1]
     matches = False
     for line in fileinput.input(sys.argv[2:]):
-        if line.startswith("["):
+        if re.match(r"^\[|(\d+\.){3}", line):
             matches = port in line
         if matches:
             print(line, end="")
