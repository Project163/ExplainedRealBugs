diff --git a/mitmproxy/proxy/layers/http/__init__.py b/mitmproxy/proxy/layers/http/__init__.py
index 2af8aefb7..08d6d7fb3 100644
--- a/mitmproxy/proxy/layers/http/__init__.py
+++ b/mitmproxy/proxy/layers/http/__init__.py
@@ -260,6 +260,7 @@ class HttpStream(layer.Layer):
             )
         ok = yield from self.make_server_connection()
         if not ok:
+            self.client_state = self.state_errored
             return
         yield SendHttp(
             RequestHeaders(self.stream_id, self.flow.request, end_stream=False),
@@ -628,8 +629,7 @@ class HttpStream(layer.Layer):
             and self.server_state not in (self.state_done, self.state_errored)
         )
         need_error_hook = not (
-            self.client_state
-            in (self.state_wait_for_request_headers, self.state_errored)
+            self.client_state == self.state_errored
             or self.server_state in (self.state_done, self.state_errored)
         )
 
diff --git a/test/mitmproxy/proxy/layers/http/test_http.py b/test/mitmproxy/proxy/layers/http/test_http.py
index 9008f5a8b..6c82a5814 100644
--- a/test/mitmproxy/proxy/layers/http/test_http.py
+++ b/test/mitmproxy/proxy/layers/http/test_http.py
@@ -1640,3 +1640,25 @@ def test_memory_usage_errored_flows(tctx):
 
     gc.collect()
     assert flows_tracked() == flow_count
+
+
+def test_drop_stream_with_paused_events(tctx):
+    """Make sure that we don't crash if we still have paused events for streams that error."""
+    tctx.options.stream_large_bodies = "1"
+    server = Placeholder(Server)
+    flow = Placeholder(HTTPFlow)
+    assert (
+        Playbook(http.HttpLayer(tctx, HTTPMode.regular))
+        >> DataReceived(
+            tctx.client,
+            b"POST http://example.com/ HTTP/1.1\r\nHost: example.com\r\nContent-Length: 4\r\n\r\ndata",
+        )
+        << http.HttpRequestHeadersHook(flow)
+        >> reply()
+        << OpenConnection(server)
+        >> reply('Connection killed: error')
+        << http.HttpErrorHook(flow)
+        >> reply()
+        << SendData(tctx.client, BytesMatching(b"502 Bad Gateway.+Connection killed"))
+        << CloseConnection(tctx.client)
+    )
