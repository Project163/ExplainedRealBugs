[{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/73050435","html_url":"https://github.com/mitmproxy/mitmproxy/issues/464#issuecomment-73050435","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/464","id":73050435,"node_id":"MDEyOklzc3VlQ29tbWVudDczMDUwNDM1","user":{"login":"yoavfrancis","id":328378,"node_id":"MDQ6VXNlcjMyODM3OA==","avatar_url":"https://avatars.githubusercontent.com/u/328378?v=4","gravatar_id":"","url":"https://api.github.com/users/yoavfrancis","html_url":"https://github.com/yoavfrancis","followers_url":"https://api.github.com/users/yoavfrancis/followers","following_url":"https://api.github.com/users/yoavfrancis/following{/other_user}","gists_url":"https://api.github.com/users/yoavfrancis/gists{/gist_id}","starred_url":"https://api.github.com/users/yoavfrancis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yoavfrancis/subscriptions","organizations_url":"https://api.github.com/users/yoavfrancis/orgs","repos_url":"https://api.github.com/users/yoavfrancis/repos","events_url":"https://api.github.com/users/yoavfrancis/events{/privacy}","received_events_url":"https://api.github.com/users/yoavfrancis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-02-05T14:04:26Z","updated_at":"2015-02-05T14:04:26Z","body":"On a deeper look , it seems that the handling mechanism in protocol\\http.py catches exceptions of type:\n\n```\n        except (\n                HttpAuthenticationError,\n                http.HttpError,\n                proxy.ProxyError,\n                tcp.NetLibError,\n        ), e:\n```\n\nWhile protocol\\tcp.py only catches `socket.error` exception.\n\nSo this explains why the NetLibXXX errors are raised (While on http proxying they are handled and logged) - However, regarding the other errors (Those that come from PyOpenSSL) - what's should be done with them?\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/73050435/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"yoavfrancis","id":328378,"node_id":"MDQ6VXNlcjMyODM3OA==","avatar_url":"https://avatars.githubusercontent.com/u/328378?v=4","gravatar_id":"","url":"https://api.github.com/users/yoavfrancis","html_url":"https://github.com/yoavfrancis","followers_url":"https://api.github.com/users/yoavfrancis/followers","following_url":"https://api.github.com/users/yoavfrancis/following{/other_user}","gists_url":"https://api.github.com/users/yoavfrancis/gists{/gist_id}","starred_url":"https://api.github.com/users/yoavfrancis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yoavfrancis/subscriptions","organizations_url":"https://api.github.com/users/yoavfrancis/orgs","repos_url":"https://api.github.com/users/yoavfrancis/repos","events_url":"https://api.github.com/users/yoavfrancis/events{/privacy}","received_events_url":"https://api.github.com/users/yoavfrancis/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":230784453,"node_id":"MDExOkNsb3NlZEV2ZW50MjMwNzg0NDUz","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/230784453","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"310fb18aac972123e0b25e618978d4dce7031078","commit_url":"https://api.github.com/repos/mitmproxy/mitmproxy/commits/310fb18aac972123e0b25e618978d4dce7031078","created_at":"2015-02-05T14:24:43Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/73053841","html_url":"https://github.com/mitmproxy/mitmproxy/issues/464#issuecomment-73053841","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/464","id":73053841,"node_id":"MDEyOklzc3VlQ29tbWVudDczMDUzODQx","user":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-02-05T14:26:36Z","updated_at":"2015-02-05T14:27:02Z","body":"Hey Yoav,\n\nthanks for investigating. The errors you are seeing are apparently unexpected client or server disconnects. While we usually operate on plain sockets here (performance), this is not the case if SSL/TLS comes into play. It looks like there are two unrelated issues:\n1. We should catch NetLibError as you indicated.\n2. If there's SSL, we should only use the netlib wrappers (not dst.connection itself) for sending data, so that PyOpenSSLs errors are re-raised as NetlibErrors.\n\nI just commited a fix, let me know how it works.\n\nCheers,\nMax\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/73053841/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/73060791","html_url":"https://github.com/mitmproxy/mitmproxy/issues/464#issuecomment-73060791","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/464","id":73060791,"node_id":"MDEyOklzc3VlQ29tbWVudDczMDYwNzkx","user":{"login":"yoavfrancis","id":328378,"node_id":"MDQ6VXNlcjMyODM3OA==","avatar_url":"https://avatars.githubusercontent.com/u/328378?v=4","gravatar_id":"","url":"https://api.github.com/users/yoavfrancis","html_url":"https://github.com/yoavfrancis","followers_url":"https://api.github.com/users/yoavfrancis/followers","following_url":"https://api.github.com/users/yoavfrancis/following{/other_user}","gists_url":"https://api.github.com/users/yoavfrancis/gists{/gist_id}","starred_url":"https://api.github.com/users/yoavfrancis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yoavfrancis/subscriptions","organizations_url":"https://api.github.com/users/yoavfrancis/orgs","repos_url":"https://api.github.com/users/yoavfrancis/repos","events_url":"https://api.github.com/users/yoavfrancis/events{/privacy}","received_events_url":"https://api.github.com/users/yoavfrancis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-02-05T15:06:21Z","updated_at":"2015-02-05T15:06:21Z","body":"Hi Max!\n\nThanks for the super-fast response.\nYour solution indeed fixes up a lot the errors - but there's still an error:\n\n```\n\nmitmproxy has crashed!\nPlease lodge a bug report at: https://github.com/mitmproxy/mitmproxy\n192.168.0.18:62969: Traceback (most recent call last):\n  File \"/root/mitmproxy/mitmproxy/libmproxy/proxy/server.py\", line 99, in handle\n    protocol_handler(self.conntype)(self, **conn_kwargs).handle_messages()\n  File \"/root/mitmproxy/mitmproxy/libmproxy/protocol/tcp.py\", line 59, in handle_messages\n    dst.connection.shutdown()\n  File \"/root/mitmproxy/local/lib/python2.7/site-packages/OpenSSL/SSL.py\", line 1157, in shutdown\n    _raise_current_error()\n  File \"/root/mitmproxy/local/lib/python2.7/site-packages/OpenSSL/_util.py\", line 22, in exception_from_error_queue\n    raise exceptionType(errors)\nError: []\n\n\nmitmproxy has crashed!\nPlease lodge a bug report at: https://github.com/mitmproxy/mitmproxy\n192.168.0.18:63911: Traceback (most recent call last):\n  File \"/root/mitmproxy/mitmproxy/libmproxy/proxy/server.py\", line 99, in handle\n    protocol_handler(self.conntype)(self, **conn_kwargs).handle_messages()\n  File \"/root/mitmproxy/mitmproxy/libmproxy/protocol/tcp.py\", line 59, in handle_messages\n    dst.connection.shutdown()\n  File \"/root/mitmproxy/local/lib/python2.7/site-packages/OpenSSL/SSL.py\", line 1157, in shutdown\n    _raise_current_error()\n  File \"/root/mitmproxy/local/lib/python2.7/site-packages/OpenSSL/_util.py\", line 22, in exception_from_error_queue\n    raise exceptionType(errors)\nError: []\n```\n\nI tried omitting the \"connection\" from `dst.connection.shutdown` - however it seems that the `shutdown` method is not implemented in `ServerConnection` (libmproxy\\proxy\\connection.py) nor at `TCPClient` (netlib\\tcp.py) - so my guess would be that it needs to be properly implemented in `TCPClient` (as it is in `TCPServer`) in netlib so things would work well?\n\nThanks,\nYoav\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/73060791/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"yoavfrancis","id":328378,"node_id":"MDQ6VXNlcjMyODM3OA==","avatar_url":"https://avatars.githubusercontent.com/u/328378?v=4","gravatar_id":"","url":"https://api.github.com/users/yoavfrancis","html_url":"https://github.com/yoavfrancis","followers_url":"https://api.github.com/users/yoavfrancis/followers","following_url":"https://api.github.com/users/yoavfrancis/following{/other_user}","gists_url":"https://api.github.com/users/yoavfrancis/gists{/gist_id}","starred_url":"https://api.github.com/users/yoavfrancis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yoavfrancis/subscriptions","organizations_url":"https://api.github.com/users/yoavfrancis/orgs","repos_url":"https://api.github.com/users/yoavfrancis/repos","events_url":"https://api.github.com/users/yoavfrancis/events{/privacy}","received_events_url":"https://api.github.com/users/yoavfrancis/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":230837390,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDIzMDgzNzM5MA==","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/230837390","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"efd1eb159f85edb013d02263c46c6c36d05941b6","commit_url":"https://api.github.com/repos/mitmproxy/mitmproxy/commits/efd1eb159f85edb013d02263c46c6c36d05941b6","created_at":"2015-02-05T15:42:05Z","performed_via_github_app":null},{"id":230841295,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDIzMDg0MTI5NQ==","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/230841295","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"52d696df3d23a2ef1d32131752634d97b7fc965c","commit_url":"https://api.github.com/repos/mitmproxy/mitmproxy/commits/52d696df3d23a2ef1d32131752634d97b7fc965c","created_at":"2015-02-05T15:47:06Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/73068435","html_url":"https://github.com/mitmproxy/mitmproxy/issues/464#issuecomment-73068435","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/464","id":73068435,"node_id":"MDEyOklzc3VlQ29tbWVudDczMDY4NDM1","user":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-02-05T15:47:51Z","updated_at":"2015-02-05T15:47:51Z","body":"Closing (py)OpenSSL Connections is the worst PITA you can ever imagine (feel free to read through the comments in netlib.tcp...). I'd say screw it, just `return` here. We'll clean up everything on a higher level anyway. Fix commited, let me know how it works.\n\nCheers,\nMax\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/73068435/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/73082883","html_url":"https://github.com/mitmproxy/mitmproxy/issues/464#issuecomment-73082883","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/464","id":73082883,"node_id":"MDEyOklzc3VlQ29tbWVudDczMDgyODgz","user":{"login":"yoavfrancis","id":328378,"node_id":"MDQ6VXNlcjMyODM3OA==","avatar_url":"https://avatars.githubusercontent.com/u/328378?v=4","gravatar_id":"","url":"https://api.github.com/users/yoavfrancis","html_url":"https://github.com/yoavfrancis","followers_url":"https://api.github.com/users/yoavfrancis/followers","following_url":"https://api.github.com/users/yoavfrancis/following{/other_user}","gists_url":"https://api.github.com/users/yoavfrancis/gists{/gist_id}","starred_url":"https://api.github.com/users/yoavfrancis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yoavfrancis/subscriptions","organizations_url":"https://api.github.com/users/yoavfrancis/orgs","repos_url":"https://api.github.com/users/yoavfrancis/repos","events_url":"https://api.github.com/users/yoavfrancis/events{/privacy}","received_events_url":"https://api.github.com/users/yoavfrancis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-02-05T16:59:06Z","updated_at":"2015-02-05T16:59:06Z","body":"Seems to do the trick :) Smart idea just leaving the cleanup to a higher level.\nThanks again!\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/73082883/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"yoavfrancis","id":328378,"node_id":"MDQ6VXNlcjMyODM3OA==","avatar_url":"https://avatars.githubusercontent.com/u/328378?v=4","gravatar_id":"","url":"https://api.github.com/users/yoavfrancis","html_url":"https://github.com/yoavfrancis","followers_url":"https://api.github.com/users/yoavfrancis/followers","following_url":"https://api.github.com/users/yoavfrancis/following{/other_user}","gists_url":"https://api.github.com/users/yoavfrancis/gists{/gist_id}","starred_url":"https://api.github.com/users/yoavfrancis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yoavfrancis/subscriptions","organizations_url":"https://api.github.com/users/yoavfrancis/orgs","repos_url":"https://api.github.com/users/yoavfrancis/repos","events_url":"https://api.github.com/users/yoavfrancis/events{/privacy}","received_events_url":"https://api.github.com/users/yoavfrancis/received_events","type":"User","user_view_type":"public","site_admin":false}}]