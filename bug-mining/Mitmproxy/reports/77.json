{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/443","repository_url":"https://api.github.com/repos/mitmproxy/mitmproxy","labels_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/443/labels{/name}","comments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/443/comments","events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/443/events","html_url":"https://github.com/mitmproxy/mitmproxy/issues/443","id":53788344,"node_id":"MDU6SXNzdWU1Mzc4ODM0NA==","number":443,"title":"mitmdump uses an unexpectedly large amount of CPU while idle","user":{"login":"lexelby","id":4446653,"node_id":"MDQ6VXNlcjQ0NDY2NTM=","avatar_url":"https://avatars.githubusercontent.com/u/4446653?v=4","gravatar_id":"","url":"https://api.github.com/users/lexelby","html_url":"https://github.com/lexelby","followers_url":"https://api.github.com/users/lexelby/followers","following_url":"https://api.github.com/users/lexelby/following{/other_user}","gists_url":"https://api.github.com/users/lexelby/gists{/gist_id}","starred_url":"https://api.github.com/users/lexelby/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lexelby/subscriptions","organizations_url":"https://api.github.com/users/lexelby/orgs","repos_url":"https://api.github.com/users/lexelby/repos","events_url":"https://api.github.com/users/lexelby/events{/privacy}","received_events_url":"https://api.github.com/users/lexelby/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2015-01-08T19:12:52Z","updated_at":"2015-01-09T16:32:42Z","closed_at":"2015-01-09T15:40:44Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"How to reproduce:\n\n`$ mitmdump -P http://google.com -p 10001`\n\nThen run top and see that it's using as much as 20% of a core.\n\n`strace` yields a fast scroll of short sleeps:\n\n```\nselect(0, NULL, NULL, NULL, {0, 2259})  = 0 (Timeout)\nselect(0, NULL, NULL, NULL, {0, 1000})  = 0 (Timeout)\nselect(0, NULL, NULL, NULL, {0, 2000})  = 0 (Timeout)\nselect(0, NULL, NULL, NULL, {0, 4000})  = 0 (Timeout)\nselect(0, NULL, NULL, NULL, {0, 2301})  = 0 (Timeout)\nselect(0, NULL, NULL, NULL, {0, 1000})  = 0 (Timeout)\nselect(0, NULL, NULL, NULL, {0, 2000})  = 0 (Timeout)\nselect(0, NULL, NULL, NULL, {0, 4000})  = 0 (Timeout)\nselect(0, NULL, NULL, NULL, {0, 2401})  = 0 (Timeout)\n```\n\n`Master.tick` (in controller.py) calls `Queue.get` with a `timeout` of 0.01.  `Queue` in turn waits on a `threading.Condition` with that same timeout.  `Condition` waits in increasingly large increments starting at 500usec in an attempt to avoid making the program unresponsive (to what?  Probably KeyboardInterrupt?).  It'll wait 500usec, 1000, 2000, 4000, and then the remainder to get up to 10000usec.  End result: `select()` is called as often as 5000 times per second.  A far cry from the 100Hz that one might expect from a 0.01 timeout :)\n","closed_by":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/443/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/443/timeline","performed_via_github_app":null,"state_reason":"completed"}