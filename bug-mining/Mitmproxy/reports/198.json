{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/1620","repository_url":"https://api.github.com/repos/mitmproxy/mitmproxy","labels_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/1620/labels{/name}","comments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/1620/comments","events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/1620/events","html_url":"https://github.com/mitmproxy/mitmproxy/issues/1620","id":183377699,"node_id":"MDU6SXNzdWUxODMzNzc2OTk=","number":1620,"title":"StackTrace printed if you quit mitmproxy and any flow is in intercept mode","user":{"login":"mkagenius","id":1682656,"node_id":"MDQ6VXNlcjE2ODI2NTY=","avatar_url":"https://avatars.githubusercontent.com/u/1682656?v=4","gravatar_id":"","url":"https://api.github.com/users/mkagenius","html_url":"https://github.com/mkagenius","followers_url":"https://api.github.com/users/mkagenius/followers","following_url":"https://api.github.com/users/mkagenius/following{/other_user}","gists_url":"https://api.github.com/users/mkagenius/gists{/gist_id}","starred_url":"https://api.github.com/users/mkagenius/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mkagenius/subscriptions","organizations_url":"https://api.github.com/users/mkagenius/orgs","repos_url":"https://api.github.com/users/mkagenius/repos","events_url":"https://api.github.com/users/mkagenius/events{/privacy}","received_events_url":"https://api.github.com/users/mkagenius/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":79336502,"node_id":"MDU6TGFiZWw3OTMzNjUwMg==","url":"https://api.github.com/repos/mitmproxy/mitmproxy/labels/kind/bug","name":"kind/bug","color":"d93f0b","default":false,"description":null},{"id":429899749,"node_id":"MDU6TGFiZWw0Mjk4OTk3NDk=","url":"https://api.github.com/repos/mitmproxy/mitmproxy/labels/area/core","name":"area/core","color":"fef2c0","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/milestones/17","html_url":"https://github.com/mitmproxy/mitmproxy/milestone/17","labels_url":"https://api.github.com/repos/mitmproxy/mitmproxy/milestones/17/labels","id":2091535,"node_id":"MDk6TWlsZXN0b25lMjA5MTUzNQ==","number":17,"title":"0.18.1","description":"","creator":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":4,"state":"closed","created_at":"2016-10-25T07:49:28Z","updated_at":"2016-10-27T23:13:42Z","due_on":null,"closed_at":"2016-10-27T23:13:42Z"},"comments":1,"created_at":"2016-10-17T10:18:09Z","updated_at":"2016-10-26T19:26:51Z","closed_at":"2016-10-26T19:26:51Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"##### Steps to reproduce the problem:\n1. Launch mitmproxy\n2. intercept any request\n3. quit mitmproxy while the request still intercept\n##### What is the expected behavior?\n\nDid not expect the stacktrace ... earlier it used to be no such error\n##### What went wrong?\n\n```\nTraceback (most recent call last):\n  File \"/Users/manish/Work/mitmproxy/venv/bin/mitmproxy\", line 11, in <module>\n    load_entry_point('mitmproxy', 'console_scripts', 'mitmproxy')()\n  File \"/Users/manish/Work/mitmproxy/mitmproxy/main.py\", line 80, in mitmproxy\n    m.run()\n  File \"/Users/manish/Work/mitmproxy/mitmproxy/console/master.py\", line 495, in run\n    self.shutdown()\n  File \"/Users/manish/Work/mitmproxy/mitmproxy/console/master.py\", line 647, in shutdown\n    self.state.killall(self)\n  File \"/Users/manish/Work/mitmproxy/mitmproxy/flow/state.py\", line 269, in killall\n    self.flows.kill_all(master)\n  File \"/Users/manish/Work/mitmproxy/mitmproxy/flow/state.py\", line 182, in kill_all\n    f.kill(master)\n  File \"/Users/manish/Work/mitmproxy/mitmproxy/models/flow.py\", line 176, in kill\n    master.error(self)\n  File \"/Users/manish/Work/mitmproxy/mitmproxy/controller.py\", line 238, in wrapper\n    ret = f(master, message)\n  File \"/Users/manish/Work/mitmproxy/mitmproxy/console/master.py\", line 692, in error\n    self.process_flow(f)\n  File \"/Users/manish/Work/mitmproxy/mitmproxy/console/master.py\", line 681, in process_flow\n    f.intercept(self)\n  File \"/Users/manish/Work/mitmproxy/mitmproxy/models/flow.py\", line 186, in intercept\n    self.reply.take()\n  File \"/Users/manish/Work/mitmproxy/mitmproxy/controller.py\", line 314, in take\n    raise exceptions.ControlException(\"Reply is {}, but expected it to be handled.\".format(self.state))\nmitmproxy.exceptions.ControlException: Reply is committed, but expected it to be handled.\n```\n##### Any other comments? What have you tried so far?\n\nThis may result in problems in saving flows to file? if any request is in intercept mode it might cause abort at that point .. only flows till that point gets saved.. i think, also, har dump may get problem due to this.. \n\n---\n\nMitmproxy Version: head, master\nOperating System: mac\n\n<!-- Please use the mitmproxy forums (https://discourse.mitmproxy.org/) for support/how-to questions. Thanks! :) -->\n","closed_by":{"login":"cortesi","id":22544,"node_id":"MDQ6VXNlcjIyNTQ0","avatar_url":"https://avatars.githubusercontent.com/u/22544?v=4","gravatar_id":"","url":"https://api.github.com/users/cortesi","html_url":"https://github.com/cortesi","followers_url":"https://api.github.com/users/cortesi/followers","following_url":"https://api.github.com/users/cortesi/following{/other_user}","gists_url":"https://api.github.com/users/cortesi/gists{/gist_id}","starred_url":"https://api.github.com/users/cortesi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cortesi/subscriptions","organizations_url":"https://api.github.com/users/cortesi/orgs","repos_url":"https://api.github.com/users/cortesi/repos","events_url":"https://api.github.com/users/cortesi/events{/privacy}","received_events_url":"https://api.github.com/users/cortesi/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/1620/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/1620/timeline","performed_via_github_app":null,"state_reason":"completed"}