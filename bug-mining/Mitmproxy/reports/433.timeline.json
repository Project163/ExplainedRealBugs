[{"id":4339265166,"node_id":"MDEyOkxhYmVsZWRFdmVudDQzMzkyNjUxNjY=","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/4339265166","actor":{"login":"r00t-","id":2834981,"node_id":"MDQ6VXNlcjI4MzQ5ODE=","avatar_url":"https://avatars.githubusercontent.com/u/2834981?v=4","gravatar_id":"","url":"https://api.github.com/users/r00t-","html_url":"https://github.com/r00t-","followers_url":"https://api.github.com/users/r00t-/followers","following_url":"https://api.github.com/users/r00t-/following{/other_user}","gists_url":"https://api.github.com/users/r00t-/gists{/gist_id}","starred_url":"https://api.github.com/users/r00t-/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/r00t-/subscriptions","organizations_url":"https://api.github.com/users/r00t-/orgs","repos_url":"https://api.github.com/users/r00t-/repos","events_url":"https://api.github.com/users/r00t-/events{/privacy}","received_events_url":"https://api.github.com/users/r00t-/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2021-02-17T03:23:06Z","label":{"name":"kind/triage","color":"006b75"},"performed_via_github_app":null},{"id":4339319508,"node_id":"MDE3OlJlbmFtZWRUaXRsZUV2ZW50NDMzOTMxOTUwOA==","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/4339319508","actor":{"login":"r00t-","id":2834981,"node_id":"MDQ6VXNlcjI4MzQ5ODE=","avatar_url":"https://avatars.githubusercontent.com/u/2834981?v=4","gravatar_id":"","url":"https://api.github.com/users/r00t-","html_url":"https://github.com/r00t-","followers_url":"https://api.github.com/users/r00t-/followers","following_url":"https://api.github.com/users/r00t-/following{/other_user}","gists_url":"https://api.github.com/users/r00t-/gists{/gist_id}","starred_url":"https://api.github.com/users/r00t-/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/r00t-/subscriptions","organizations_url":"https://api.github.com/users/r00t-/orgs","repos_url":"https://api.github.com/users/r00t-/repos","events_url":"https://api.github.com/users/r00t-/events{/privacy}","received_events_url":"https://api.github.com/users/r00t-/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"renamed","commit_id":null,"commit_url":null,"created_at":"2021-02-17T03:51:44Z","rename":{"from":"mitmdump usage is always constanctly growing","to":"mitmdump memory usage is always constanctly growing"},"performed_via_github_app":null},{"id":4339333086,"node_id":"MDE3OlJlbmFtZWRUaXRsZUV2ZW50NDMzOTMzMzA4Ng==","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/4339333086","actor":{"login":"r00t-","id":2834981,"node_id":"MDQ6VXNlcjI4MzQ5ODE=","avatar_url":"https://avatars.githubusercontent.com/u/2834981?v=4","gravatar_id":"","url":"https://api.github.com/users/r00t-","html_url":"https://github.com/r00t-","followers_url":"https://api.github.com/users/r00t-/followers","following_url":"https://api.github.com/users/r00t-/following{/other_user}","gists_url":"https://api.github.com/users/r00t-/gists{/gist_id}","starred_url":"https://api.github.com/users/r00t-/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/r00t-/subscriptions","organizations_url":"https://api.github.com/users/r00t-/orgs","repos_url":"https://api.github.com/users/r00t-/repos","events_url":"https://api.github.com/users/r00t-/events{/privacy}","received_events_url":"https://api.github.com/users/r00t-/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"renamed","commit_id":null,"commit_url":null,"created_at":"2021-02-17T03:59:02Z","rename":{"from":"mitmdump memory usage is always constanctly growing","to":"mitmdump memory usage is always constantly growing"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/780710897","html_url":"https://github.com/mitmproxy/mitmproxy/issues/4456#issuecomment-780710897","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4456","id":780710897,"node_id":"MDEyOklzc3VlQ29tbWVudDc4MDcxMDg5Nw==","user":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-17T17:14:48Z","updated_at":"2021-02-17T17:15:32Z","body":"I assume the drops are restarts and not done by mitmproxy itself? ðŸ˜„ \r\n\r\nBased on https://gist.github.com/r00t-/a35b52b68cd457a455bc515c4294a36a you seem to have a bunch of flow objects around that are not garbage collected. I have written a small mitmproxy addon that overwrites SIGUSR1 and outputs which other objects still hold a reference:\r\n\r\n```python\r\nimport collections\r\nimport gc\r\nimport os\r\nimport signal\r\n\r\nfrom mitmproxy import flow\r\n\r\n\r\ndef debug(*_):\r\n    print()\r\n    print(\"Memory\")\r\n    print(\"=======\")\r\n    gc.collect()\r\n\r\n    d = collections.Counter()\r\n    for o in gc.get_objects():\r\n        t = str(type(o))\r\n        if \"mitmproxy\" in t:\r\n            d[t] += 1\r\n\r\n    for t, count in d.most_common(10):\r\n        print(count, t)\r\n\r\n    print()\r\n    print(\"Flow References\")\r\n    print(\"===============\")\r\n    objs = gc.get_objects()\r\n    for i in range(len(objs)):\r\n        if isinstance(objs[i], flow.Flow):\r\n            print(f\"{objs[i]}\")\r\n            holder = {\"val\": objs[i]}\r\n\r\n            # We hold references here ourselves. Ignore those, and make sure that we don't run into cycles.\r\n            _seen = {id(objs), id(holder)}\r\n\r\n            def seen(x):\r\n                if x in _seen:\r\n                    return True\r\n                _seen.add(x)\r\n\r\n            for _ in range(20):\r\n                referrers = [\r\n                    val for val in gc.get_referrers(holder[\"val\"])\r\n                    if not seen(id(val))\r\n                ]\r\n                if referrers:\r\n                    print(f\"  {len(referrers)=} {type(referrers[0])=}\")\r\n                    holder[\"val\"] = referrers[0]\r\n                    del referrers\r\n                else:\r\n                    break\r\n            break\r\n    else:\r\n        print(\"No flows!\")\r\n\r\n\r\ndef load(loader):\r\n    print(f\"Registering debug signal... {os.getpid()}\")\r\n    signal.signal(signal.SIGUSR1, debug)\r\n```\r\n\r\nIf you run this as a regular mitmproxy addon, sending SIGUSR1 should show you 1) object statistics and 2) the reference chain for the first flow object found. Does that yield anything useful?\r\n\r\n\r\nOh, and you can iterate live on this: with this addon there's no shutdown on SIGUSR1, and mitmproxy live-reloads the addon if you change it on disk.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/780710897/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/780853113","html_url":"https://github.com/mitmproxy/mitmproxy/issues/4456#issuecomment-780853113","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4456","id":780853113,"node_id":"MDEyOklzc3VlQ29tbWVudDc4MDg1MzExMw==","user":{"login":"r00t-","id":2834981,"node_id":"MDQ6VXNlcjI4MzQ5ODE=","avatar_url":"https://avatars.githubusercontent.com/u/2834981?v=4","gravatar_id":"","url":"https://api.github.com/users/r00t-","html_url":"https://github.com/r00t-","followers_url":"https://api.github.com/users/r00t-/followers","following_url":"https://api.github.com/users/r00t-/following{/other_user}","gists_url":"https://api.github.com/users/r00t-/gists{/gist_id}","starred_url":"https://api.github.com/users/r00t-/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/r00t-/subscriptions","organizations_url":"https://api.github.com/users/r00t-/orgs","repos_url":"https://api.github.com/users/r00t-/repos","events_url":"https://api.github.com/users/r00t-/events{/privacy}","received_events_url":"https://api.github.com/users/r00t-/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-17T21:06:18Z","updated_at":"2021-02-17T21:06:18Z","body":"cool, i was wondering if the object stats in that that dump are expected or not.\r\ni'll try this as i get to it, but as mentioned, #4451 is the more important issue for me.\r\n(i have also not used addons before, time to learn something new ;) )","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/780853113/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"r00t-","id":2834981,"node_id":"MDQ6VXNlcjI4MzQ5ODE=","avatar_url":"https://avatars.githubusercontent.com/u/2834981?v=4","gravatar_id":"","url":"https://api.github.com/users/r00t-","html_url":"https://github.com/r00t-","followers_url":"https://api.github.com/users/r00t-/followers","following_url":"https://api.github.com/users/r00t-/following{/other_user}","gists_url":"https://api.github.com/users/r00t-/gists{/gist_id}","starred_url":"https://api.github.com/users/r00t-/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/r00t-/subscriptions","organizations_url":"https://api.github.com/users/r00t-/orgs","repos_url":"https://api.github.com/users/r00t-/repos","events_url":"https://api.github.com/users/r00t-/events{/privacy}","received_events_url":"https://api.github.com/users/r00t-/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/780880534","html_url":"https://github.com/mitmproxy/mitmproxy/issues/4456#issuecomment-780880534","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4456","id":780880534,"node_id":"MDEyOklzc3VlQ29tbWVudDc4MDg4MDUzNA==","user":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-17T21:56:08Z","updated_at":"2021-02-17T21:56:08Z","body":"> cool, i was wondering if the object stats in that that dump are expected or not.\r\n\r\nIf there are no active connections, I have zero flow.Flow instances in mitmdump. Anything else is unintended behavior. :)","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/780880534/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/782162299","html_url":"https://github.com/mitmproxy/mitmproxy/issues/4456#issuecomment-782162299","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4456","id":782162299,"node_id":"MDEyOklzc3VlQ29tbWVudDc4MjE2MjI5OQ==","user":{"login":"r00t-","id":2834981,"node_id":"MDQ6VXNlcjI4MzQ5ODE=","avatar_url":"https://avatars.githubusercontent.com/u/2834981?v=4","gravatar_id":"","url":"https://api.github.com/users/r00t-","html_url":"https://github.com/r00t-","followers_url":"https://api.github.com/users/r00t-/followers","following_url":"https://api.github.com/users/r00t-/following{/other_user}","gists_url":"https://api.github.com/users/r00t-/gists{/gist_id}","starred_url":"https://api.github.com/users/r00t-/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/r00t-/subscriptions","organizations_url":"https://api.github.com/users/r00t-/orgs","repos_url":"https://api.github.com/users/r00t-/repos","events_url":"https://api.github.com/users/r00t-/events{/privacy}","received_events_url":"https://api.github.com/users/r00t-/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-19T15:51:43Z","updated_at":"2021-02-19T15:53:34Z","body":"curiously, since the three fixes from #4451 (and #4452 ) are in, memory usage has never exceeded 200mb.\r\nis it possible that objects were simply not being cleaned up after those crashes?\r\ndid you expect the memory usage and crashes to be related? it was not obvious to me.\r\n\r\n![mitmdump_mem_commits](https://user-images.githubusercontent.com/2834981/108527018-1969e100-72d2-11eb-8abb-1befac4ea325.png)\r\nthe three marks are deploys of the last three commits,\r\nhttps://github.com/mitmproxy/mitmproxy/commit/c8eca9a396adb63f50e00506c53cf24ec723291d\r\nhttps://github.com/mitmproxy/mitmproxy/commit/ff4120d4f3dd1d786377a541ec790945ae321b08\r\nhttps://github.com/mitmproxy/mitmproxy/commit/70e08c880cadc5b87eb5187787a65c7857e0750c\r\n\r\nbut i also added `--no-http2` about an hour after the last one.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/782162299/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"r00t-","id":2834981,"node_id":"MDQ6VXNlcjI4MzQ5ODE=","avatar_url":"https://avatars.githubusercontent.com/u/2834981?v=4","gravatar_id":"","url":"https://api.github.com/users/r00t-","html_url":"https://github.com/r00t-","followers_url":"https://api.github.com/users/r00t-/followers","following_url":"https://api.github.com/users/r00t-/following{/other_user}","gists_url":"https://api.github.com/users/r00t-/gists{/gist_id}","starred_url":"https://api.github.com/users/r00t-/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/r00t-/subscriptions","organizations_url":"https://api.github.com/users/r00t-/orgs","repos_url":"https://api.github.com/users/r00t-/repos","events_url":"https://api.github.com/users/r00t-/events{/privacy}","received_events_url":"https://api.github.com/users/r00t-/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/782274323","html_url":"https://github.com/mitmproxy/mitmproxy/issues/4456#issuecomment-782274323","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4456","id":782274323,"node_id":"MDEyOklzc3VlQ29tbWVudDc4MjI3NDMyMw==","user":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-19T18:57:30Z","updated_at":"2021-02-19T18:58:08Z","body":"> is it possible that objects were simply not being cleaned up after those crashes?\r\n\r\nThere really isn't anything that should keep them around... some cyclic references in the traceback objects, maybe? I am not convinced, but I also don't mind them going away without much effort. ðŸ˜… To put a positive spin on this: if they reappear the script from https://github.com/mitmproxy/mitmproxy/issues/4456#issuecomment-780710897 should help us out. :)\r\n\r\nAlso FYI, you have got me to the point that I'm tunneling all my own traffic through mitmproxy for a while ðŸ˜‰ ","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/782274323/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/782321370","html_url":"https://github.com/mitmproxy/mitmproxy/issues/4456#issuecomment-782321370","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4456","id":782321370,"node_id":"MDEyOklzc3VlQ29tbWVudDc4MjMyMTM3MA==","user":{"login":"r00t-","id":2834981,"node_id":"MDQ6VXNlcjI4MzQ5ODE=","avatar_url":"https://avatars.githubusercontent.com/u/2834981?v=4","gravatar_id":"","url":"https://api.github.com/users/r00t-","html_url":"https://github.com/r00t-","followers_url":"https://api.github.com/users/r00t-/followers","following_url":"https://api.github.com/users/r00t-/following{/other_user}","gists_url":"https://api.github.com/users/r00t-/gists{/gist_id}","starred_url":"https://api.github.com/users/r00t-/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/r00t-/subscriptions","organizations_url":"https://api.github.com/users/r00t-/orgs","repos_url":"https://api.github.com/users/r00t-/repos","events_url":"https://api.github.com/users/r00t-/events{/privacy}","received_events_url":"https://api.github.com/users/r00t-/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-19T20:22:31Z","updated_at":"2021-02-19T20:25:08Z","body":"> you have got me to the point that I'm tunneling all my own traffic through mitmproxy\r\n\r\nalready losing my newly gained tester positon ;(\r\n\r\n![mitmdump_mem_2020-02-19](https://user-images.githubusercontent.com/2834981/108554353-40390f00-72f4-11eb-9cf0-ecda132b05c3.png)\r\nthe run starting at ~1:50 is with `--no-http2`, at 16:30 i turned http2 back on and loaded the script you provided above.\r\nso here's data for that spike at the end:\r\n```\r\nMemory\r\n=======\r\n4515 <class 'mitmproxy.websocket.WebSocketMessage'>\r\n573 <class 'mitmproxy.certs.Cert'>\r\n563 <class 'mitmproxy.http.Headers'>\r\n378 <class 'mitmproxy.proxy.context.Context'>\r\n342 <class 'mitmproxy.http.HTTPFlow'>\r\n342 <class 'mitmproxy.http.Request'>\r\n342 <class 'mitmproxy.http.RequestData'>\r\n262 <class 'mitmproxy.connection.Server'>\r\n221 <class 'mitmproxy.http.Response'>\r\n221 <class 'mitmproxy.http.ResponseData'>\r\n\r\nFlow References\r\n===============\r\n<WebSocketFlow (1109 messages)>\r\n  len(referrers)=2 type(referrers[0])=<class 'set'>\r\n  len(referrers)=1 type(referrers[0])=<class 'dict'>\r\n  len(referrers)=1 type(referrers[0])=<class 'mitmproxy.addons.save.Save'>\r\n  len(referrers)=3 type(referrers[0])=<class 'list'>\r\n  len(referrers)=2 type(referrers[0])=<class 'dict'>\r\n  len(referrers)=1 type(referrers[0])=<class 'mitmproxy.addonmanager.AddonManager'>\r\n  len(referrers)=49 type(referrers[0])=<class 'dict'>\r\n  len(referrers)=1 type(referrers[0])=<class 'mitmproxy.tools.dump.DumpMaster'>\r\n  len(referrers)=36 type(referrers[0])=<class 'dict'>\r\n  len(referrers)=1 type(referrers[0])=<class 'module'>\r\n  len(referrers)=34 type(referrers[0])=<class 'dict'>\r\n  len(referrers)=2 type(referrers[0])=<class 'dict'>\r\n  len(referrers)=1 type(referrers[0])=<class 'module'>\r\n  len(referrers)=198 type(referrers[0])=<class 'builtin_function_or_method'>\r\n```","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/782321370/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"r00t-","id":2834981,"node_id":"MDQ6VXNlcjI4MzQ5ODE=","avatar_url":"https://avatars.githubusercontent.com/u/2834981?v=4","gravatar_id":"","url":"https://api.github.com/users/r00t-","html_url":"https://github.com/r00t-","followers_url":"https://api.github.com/users/r00t-/followers","following_url":"https://api.github.com/users/r00t-/following{/other_user}","gists_url":"https://api.github.com/users/r00t-/gists{/gist_id}","starred_url":"https://api.github.com/users/r00t-/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/r00t-/subscriptions","organizations_url":"https://api.github.com/users/r00t-/orgs","repos_url":"https://api.github.com/users/r00t-/repos","events_url":"https://api.github.com/users/r00t-/events{/privacy}","received_events_url":"https://api.github.com/users/r00t-/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/782338506","html_url":"https://github.com/mitmproxy/mitmproxy/issues/4456#issuecomment-782338506","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4456","id":782338506,"node_id":"MDEyOklzc3VlQ29tbWVudDc4MjMzODUwNg==","user":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-19T20:49:08Z","updated_at":"2021-02-19T20:49:08Z","body":"Imitation is the sincerest form of flattery. ðŸ˜‹ Jokes aside, really appreciate your super useful bug reports. :)\r\n\r\nThe log explains a lot. You are probably running `mitmdump -w something` and the `Save` addon is simply not discarding errored flows right away. This should be easily fixable! :)","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/782338506/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":4354107937,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDQzNTQxMDc5Mzc=","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/4354107937","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"07de06a71fdff03a007755b79bacb5fd80c869e3","commit_url":"https://api.github.com/repos/mhils/mitmproxy/commits/07de06a71fdff03a007755b79bacb5fd80c869e3","created_at":"2021-02-19T21:14:33Z","performed_via_github_app":null},{"id":4354110789,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDQzNTQxMTA3ODk=","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/4354110789","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"2c4e9dfb22c8feeabb05efe59ff9f3a203e66b19","commit_url":"https://api.github.com/repos/mhils/mitmproxy/commits/2c4e9dfb22c8feeabb05efe59ff9f3a203e66b19","created_at":"2021-02-19T21:15:26Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/782359812","html_url":"https://github.com/mitmproxy/mitmproxy/issues/4456#issuecomment-782359812","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4456","id":782359812,"node_id":"MDEyOklzc3VlQ29tbWVudDc4MjM1OTgxMg==","user":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-19T21:20:51Z","updated_at":"2021-02-19T21:20:51Z","body":"#4461 has the fix for the Save addon. There might be other memleaks, but I don't see any on my system at the moment. If there are, the script should point out the next one. :)","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/782359812/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":4354138484,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDQzNTQxMzg0ODQ=","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/4354138484","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"001cf6c10a21211802577687f1cae4b2cea7fd1e","commit_url":"https://api.github.com/repos/mitmproxy/mitmproxy/commits/001cf6c10a21211802577687f1cae4b2cea7fd1e","created_at":"2021-02-19T21:23:43Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/784593599","html_url":"https://github.com/mitmproxy/mitmproxy/issues/4456#issuecomment-784593599","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4456","id":784593599,"node_id":"MDEyOklzc3VlQ29tbWVudDc4NDU5MzU5OQ==","user":{"login":"r00t-","id":2834981,"node_id":"MDQ6VXNlcjI4MzQ5ODE=","avatar_url":"https://avatars.githubusercontent.com/u/2834981?v=4","gravatar_id":"","url":"https://api.github.com/users/r00t-","html_url":"https://github.com/r00t-","followers_url":"https://api.github.com/users/r00t-/followers","following_url":"https://api.github.com/users/r00t-/following{/other_user}","gists_url":"https://api.github.com/users/r00t-/gists{/gist_id}","starred_url":"https://api.github.com/users/r00t-/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/r00t-/subscriptions","organizations_url":"https://api.github.com/users/r00t-/orgs","repos_url":"https://api.github.com/users/r00t-/repos","events_url":"https://api.github.com/users/r00t-/events{/privacy}","received_events_url":"https://api.github.com/users/r00t-/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-23T23:24:49Z","updated_at":"2021-02-23T23:37:44Z","body":"is it plausible that all of that memory is from messages on websocket connections that are still open?\r\n\r\nif so, would it be a valid feature for mitmproxy (or probably just a possible addon) to have a way to close all active (websocket) connections and flush their data?\r\n(as it would probably also mean that that data is otherwise lost on exit.)\r\n\r\ni updated my daily restart script to send SIGUSR1 before sigterm, so this is the memory graph for yesterday, with associated memory stats from just before shutdown.\r\n(graph with gigabyte scale this time)\r\na bunch of downloads around 16h that matches the usage logged is plausible.\r\n![mitmdump_rss_2021-02-23](https://user-images.githubusercontent.com/2834981/108920981-ee66f080-7635-11eb-83c7-c03fc95ca9af.png)\r\n```\r\nMemory\r\n=======\r\n16500 <class 'mitmproxy.websocket.WebSocketMessage'>\r\n1347 <class 'mitmproxy.certs.Cert'>\r\n818 <class 'mitmproxy.proxy.context.Context'>\r\n816 <class 'mitmproxy.http.Headers'>\r\n416 <class 'mitmproxy.http.HTTPFlow'>\r\n416 <class 'mitmproxy.http.Request'>\r\n416 <class 'mitmproxy.http.RequestData'>\r\n416 <class 'mitmproxy.proxy.layers.http.HttpStream'>\r\n400 <class 'mitmproxy.http.Response'>\r\n400 <class 'mitmproxy.http.ResponseData'>\r\n\r\nFlow References\r\n===============\r\n<WebSocketFlow (2778 messages)>\r\n  len(referrers)=2 type(referrers[0])=<class 'set'>\r\n  len(referrers)=1 type(referrers[0])=<class 'dict'>\r\n  len(referrers)=1 type(referrers[0])=<class 'mitmproxy.addons.save.Save'>\r\n  len(referrers)=3 type(referrers[0])=<class 'list'>\r\n  len(referrers)=1 type(referrers[0])=<class 'dict'>\r\n  len(referrers)=1 type(referrers[0])=<class 'mitmproxy.addonmanager.AddonManager'>\r\n  len(referrers)=1 type(referrers[0])=<class 'dict'>\r\n  len(referrers)=1 type(referrers[0])=<class 'mitmproxy.tools.dump.DumpMaster'>\r\n  len(referrers)=33 type(referrers[0])=<class 'dict'>\r\n  len(referrers)=1 type(referrers[0])=<class 'module'>\r\n  len(referrers)=34 type(referrers[0])=<class 'dict'>\r\n  len(referrers)=2 type(referrers[0])=<class 'dict'>\r\n  len(referrers)=1 type(referrers[0])=<class 'module'>\r\n  len(referrers)=198 type(referrers[0])=<class 'builtin_function_or_method'>\r\n```","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/784593599/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"r00t-","id":2834981,"node_id":"MDQ6VXNlcjI4MzQ5ODE=","avatar_url":"https://avatars.githubusercontent.com/u/2834981?v=4","gravatar_id":"","url":"https://api.github.com/users/r00t-","html_url":"https://github.com/r00t-","followers_url":"https://api.github.com/users/r00t-/followers","following_url":"https://api.github.com/users/r00t-/following{/other_user}","gists_url":"https://api.github.com/users/r00t-/gists{/gist_id}","starred_url":"https://api.github.com/users/r00t-/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/r00t-/subscriptions","organizations_url":"https://api.github.com/users/r00t-/orgs","repos_url":"https://api.github.com/users/r00t-/repos","events_url":"https://api.github.com/users/r00t-/events{/privacy}","received_events_url":"https://api.github.com/users/r00t-/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/785061740","html_url":"https://github.com/mitmproxy/mitmproxy/issues/4456#issuecomment-785061740","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4456","id":785061740,"node_id":"MDEyOklzc3VlQ29tbWVudDc4NTA2MTc0MA==","user":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-24T13:06:42Z","updated_at":"2021-02-24T13:06:42Z","body":"That is at least somewhat plausible, but did you have ~400 active HTTP connections when creating this screenshot? Probably not, so it looks like we still leak somewhere.\r\n\r\n> if so, would it be a valid feature for mitmproxy (or probably just a possible addon) to have a way to close all active (websocket) connections and flush their data?\r\n(as it would probably also mean that that data is otherwise lost on exit.)\r\n\r\nYou can probably write a custom addon that iterates through `asyncio.all_tasks()` and then cancels all connections... but that's a terrible workaround, not a solution. ðŸ˜…  FWIW we do have [a watchdog](https://github.com/mitmproxy/mitmproxy/blob/4bd7b6c4eadeaca712f63e0e73f20bcf6aadbffb/mitmproxy/proxy/server.py#L30-L64) that closes connections after ten minutes of absolutely no activity.\r\n\r\n> (as it would probably also mean that that data is otherwise lost on exit.)\r\n\r\nNo, at least all active flows are written to disk on exit:\r\n\r\nhttps://github.com/mitmproxy/mitmproxy/blob/4bd7b6c4eadeaca712f63e0e73f20bcf6aadbffb/mitmproxy/addons/save.py#L115-L118\r\n\r\nDo you have any particular website that you suspect could be leaking here? Maybe you can modify your script to check for  `if isinstance(objs[i], http.HTTPFlow):` and then `print(objs[i].request.url)`. I'll also see if I can reproduce this locally. This week is super busy for me, so probably not before Sunday :)","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/785061740/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/788599623","html_url":"https://github.com/mitmproxy/mitmproxy/issues/4456#issuecomment-788599623","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4456","id":788599623,"node_id":"MDEyOklzc3VlQ29tbWVudDc4ODU5OTYyMw==","user":{"login":"r00t-","id":2834981,"node_id":"MDQ6VXNlcjI4MzQ5ODE=","avatar_url":"https://avatars.githubusercontent.com/u/2834981?v=4","gravatar_id":"","url":"https://api.github.com/users/r00t-","html_url":"https://github.com/r00t-","followers_url":"https://api.github.com/users/r00t-/followers","following_url":"https://api.github.com/users/r00t-/following{/other_user}","gists_url":"https://api.github.com/users/r00t-/gists{/gist_id}","starred_url":"https://api.github.com/users/r00t-/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/r00t-/subscriptions","organizations_url":"https://api.github.com/users/r00t-/orgs","repos_url":"https://api.github.com/users/r00t-/repos","events_url":"https://api.github.com/users/r00t-/events{/privacy}","received_events_url":"https://api.github.com/users/r00t-/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-02T05:19:31Z","updated_at":"2021-03-02T05:20:47Z","body":"thanks for the explanations on handling of flows!\r\n\r\n> but did you have ~400 active HTTP connections when creating this screenshot? \r\n\r\nactually i think i saw 150 client connections when i checked after reading your post, so 400 is not completely unthinkable.\r\nwhatever my browsers were doing there - sadly i did not check in detail. ofcourse an excessive number of clients could explain the usage, but i can't imagine what those would be doing, i will re-check.\r\n\r\ni added this to the script you provided:\r\n```\r\n    objs = gc.get_objects()\r\n    for i in range(len(objs)):\r\n        if isinstance(objs[i], http.HTTPFlow):\r\n            print(f\"HTTPFlow: {objs[i].request.url}\")\r\n```\r\na first look with very little uptime:\r\n```\r\n$ kill -USR1 $(pgrep -f 'mitmdump .*-w')\r\n$ tail -n 1024 $(ls -rt *.log | tail -n1) | tac | sed -n '1,/Flow References/p' | grep ^HTTPFlow: | cut -d\\? -f1 | sort|uniq -c|sort -nr\r\n    112 HTTPFlow: https://venus.web.telegram.org/apiw1\r\n```\r\ni see that URL all over my logs too, i guess that is from http://web.telegram.org/ ,\r\nthe count seems to be slowly but steadily growing. but i don't think those are possibly large enough to account for the usage observed.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/788599623/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"r00t-","id":2834981,"node_id":"MDQ6VXNlcjI4MzQ5ODE=","avatar_url":"https://avatars.githubusercontent.com/u/2834981?v=4","gravatar_id":"","url":"https://api.github.com/users/r00t-","html_url":"https://github.com/r00t-","followers_url":"https://api.github.com/users/r00t-/followers","following_url":"https://api.github.com/users/r00t-/following{/other_user}","gists_url":"https://api.github.com/users/r00t-/gists{/gist_id}","starred_url":"https://api.github.com/users/r00t-/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/r00t-/subscriptions","organizations_url":"https://api.github.com/users/r00t-/orgs","repos_url":"https://api.github.com/users/r00t-/repos","events_url":"https://api.github.com/users/r00t-/events{/privacy}","received_events_url":"https://api.github.com/users/r00t-/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/788914789","html_url":"https://github.com/mitmproxy/mitmproxy/issues/4456#issuecomment-788914789","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4456","id":788914789,"node_id":"MDEyOklzc3VlQ29tbWVudDc4ODkxNDc4OQ==","user":{"login":"r00t-","id":2834981,"node_id":"MDQ6VXNlcjI4MzQ5ODE=","avatar_url":"https://avatars.githubusercontent.com/u/2834981?v=4","gravatar_id":"","url":"https://api.github.com/users/r00t-","html_url":"https://github.com/r00t-","followers_url":"https://api.github.com/users/r00t-/followers","following_url":"https://api.github.com/users/r00t-/following{/other_user}","gists_url":"https://api.github.com/users/r00t-/gists{/gist_id}","starred_url":"https://api.github.com/users/r00t-/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/r00t-/subscriptions","organizations_url":"https://api.github.com/users/r00t-/orgs","repos_url":"https://api.github.com/users/r00t-/repos","events_url":"https://api.github.com/users/r00t-/events{/privacy}","received_events_url":"https://api.github.com/users/r00t-/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-02T13:37:46Z","updated_at":"2021-03-02T23:52:32Z","body":"it got killed by my script due to exceeding 2.5gb, 10 hours later.\r\nin this case it's kind of obvious that some tab with twitch.tv open decided to start playing a video.\r\nso as for that, this is possibly related to #4470 ... i don't have stream_large_bodies set, so mitmproxy buffers the whole stream in memory? for what i remember, it's actually possible to watch twitch streams through mitmproxy, only latency was a bit higher than ususal.\r\n\r\nin any case, telegram and wordpress look weird.\r\n\r\n```\r\nMemory\r\n=======\r\n36545 <class 'mitmproxy.websocket.WebSocketMessage'>\r\n9801 <class 'mitmproxy.certs.Cert'>\r\n7506 <class 'mitmproxy.proxy.context.Context'>\r\n7456 <class 'mitmproxy.http.Headers'>\r\n3729 <class 'mitmproxy.http.HTTPFlow'>\r\n3729 <class 'mitmproxy.http.Request'>\r\n3729 <class 'mitmproxy.http.RequestData'>\r\n3729 <class 'mitmproxy.proxy.layers.http.HttpStream'>\r\n3728 <class 'mitmproxy.connection.Server'>\r\n3727 <class 'mitmproxy.http.Response'>\r\n```\r\n```\r\n$ tail -n 10024 2021-03-02c.log | tac | sed -n '1,/Flow References/p' | grep ^HTTPFlow: | cut -d\\? -f1 | sort|uniq -c|sort -nr\r\n   2156 HTTPFlow: https://venus.web.telegram.org/apiw1\r\n    754 HTTPFlow: http://private-wordpress-site/wp-admin/admin-ajax.php\r\n     79 HTTPFlow: https://gql.twitch.tv/gql\r\n     68 HTTPFlow: https://embeds.driftcdn.com/embeds/***.json\r\n     63 HTTPFlow: https://c.go-mpulse.net/api/config.json\r\n     59 HTTPFlow: https://video-edge-b0b5d3.pdx01.abs.hls.ttvnw.net/v1/segment/**removed**.ts\r\n     59 HTTPFlow: https://static.twitchcdn.net/config/manifest.json\r\n      6 HTTPFlow: https://connectivitycheck.gstatic.com/generate_204\r\n```\r\n(the references list seem to be missing because the script did not give mitmproxy enough time to log them before killing it.)","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/788914789/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"r00t-","id":2834981,"node_id":"MDQ6VXNlcjI4MzQ5ODE=","avatar_url":"https://avatars.githubusercontent.com/u/2834981?v=4","gravatar_id":"","url":"https://api.github.com/users/r00t-","html_url":"https://github.com/r00t-","followers_url":"https://api.github.com/users/r00t-/followers","following_url":"https://api.github.com/users/r00t-/following{/other_user}","gists_url":"https://api.github.com/users/r00t-/gists{/gist_id}","starred_url":"https://api.github.com/users/r00t-/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/r00t-/subscriptions","organizations_url":"https://api.github.com/users/r00t-/orgs","repos_url":"https://api.github.com/users/r00t-/repos","events_url":"https://api.github.com/users/r00t-/events{/privacy}","received_events_url":"https://api.github.com/users/r00t-/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"r00t-","id":2834981,"node_id":"MDQ6VXNlcjI4MzQ5ODE=","avatar_url":"https://avatars.githubusercontent.com/u/2834981?v=4","gravatar_id":"","url":"https://api.github.com/users/r00t-","html_url":"https://github.com/r00t-","followers_url":"https://api.github.com/users/r00t-/followers","following_url":"https://api.github.com/users/r00t-/following{/other_user}","gists_url":"https://api.github.com/users/r00t-/gists{/gist_id}","starred_url":"https://api.github.com/users/r00t-/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/r00t-/subscriptions","organizations_url":"https://api.github.com/users/r00t-/orgs","repos_url":"https://api.github.com/users/r00t-/repos","events_url":"https://api.github.com/users/r00t-/events{/privacy}","received_events_url":"https://api.github.com/users/r00t-/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-05T04:08:02Z","updated_at":"2021-04-05T04:08:02Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4544","repository_url":"https://api.github.com/repos/mitmproxy/mitmproxy","labels_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4544/labels{/name}","comments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4544/comments","events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4544/events","html_url":"https://github.com/mitmproxy/mitmproxy/issues/4544","id":850053093,"node_id":"MDU6SXNzdWU4NTAwNTMwOTM=","number":4544,"title":"mitmdump with new proxy core hangs instead of failing if listening port unavailable","user":{"login":"r00t-","id":2834981,"node_id":"MDQ6VXNlcjI4MzQ5ODE=","avatar_url":"https://avatars.githubusercontent.com/u/2834981?v=4","gravatar_id":"","url":"https://api.github.com/users/r00t-","html_url":"https://github.com/r00t-","followers_url":"https://api.github.com/users/r00t-/followers","following_url":"https://api.github.com/users/r00t-/following{/other_user}","gists_url":"https://api.github.com/users/r00t-/gists{/gist_id}","starred_url":"https://api.github.com/users/r00t-/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/r00t-/subscriptions","organizations_url":"https://api.github.com/users/r00t-/orgs","repos_url":"https://api.github.com/users/r00t-/repos","events_url":"https://api.github.com/users/r00t-/events{/privacy}","received_events_url":"https://api.github.com/users/r00t-/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":79336502,"node_id":"MDU6TGFiZWw3OTMzNjUwMg==","url":"https://api.github.com/repos/mitmproxy/mitmproxy/labels/kind/bug","name":"kind/bug","color":"d93f0b","default":false,"description":null},{"id":429899749,"node_id":"MDU6TGFiZWw0Mjk4OTk3NDk=","url":"https://api.github.com/repos/mitmproxy/mitmproxy/labels/area/core","name":"area/core","color":"fef2c0","default":false,"description":null},{"id":2831217282,"node_id":"MDU6TGFiZWwyODMxMjE3Mjgy","url":"https://api.github.com/repos/mitmproxy/mitmproxy/labels/prio/high","name":"prio/high","color":"B3193B","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2021-04-05T04:08:02Z","updated_at":"2022-03-16T13:23:36Z","closed_at":"2022-03-16T13:23:36Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":519832,"node_id":"MDEwOlJlcG9zaXRvcnk1MTk4MzI=","name":"mitmproxy","full_name":"mitmproxy/mitmproxy","private":false,"owner":{"login":"mitmproxy","id":4652787,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQ2NTI3ODc=","avatar_url":"https://avatars.githubusercontent.com/u/4652787?v=4","gravatar_id":"","url":"https://api.github.com/users/mitmproxy","html_url":"https://github.com/mitmproxy","followers_url":"https://api.github.com/users/mitmproxy/followers","following_url":"https://api.github.com/users/mitmproxy/following{/other_user}","gists_url":"https://api.github.com/users/mitmproxy/gists{/gist_id}","starred_url":"https://api.github.com/users/mitmproxy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mitmproxy/subscriptions","organizations_url":"https://api.github.com/users/mitmproxy/orgs","repos_url":"https://api.github.com/users/mitmproxy/repos","events_url":"https://api.github.com/users/mitmproxy/events{/privacy}","received_events_url":"https://api.github.com/users/mitmproxy/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/mitmproxy/mitmproxy","description":"An interactive TLS-capable intercepting HTTP proxy for penetration testers and software developers.","fork":false,"url":"https://api.github.com/repos/mitmproxy/mitmproxy","forks_url":"https://api.github.com/repos/mitmproxy/mitmproxy/forks","keys_url":"https://api.github.com/repos/mitmproxy/mitmproxy/keys{/key_id}","collaborators_url":"https://api.github.com/repos/mitmproxy/mitmproxy/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/mitmproxy/mitmproxy/teams","hooks_url":"https://api.github.com/repos/mitmproxy/mitmproxy/hooks","issue_events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events{/number}","events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/events","assignees_url":"https://api.github.com/repos/mitmproxy/mitmproxy/assignees{/user}","branches_url":"https://api.github.com/repos/mitmproxy/mitmproxy/branches{/branch}","tags_url":"https://api.github.com/repos/mitmproxy/mitmproxy/tags","blobs_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/refs{/sha}","trees_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/trees{/sha}","statuses_url":"https://api.github.com/repos/mitmproxy/mitmproxy/statuses/{sha}","languages_url":"https://api.github.com/repos/mitmproxy/mitmproxy/languages","stargazers_url":"https://api.github.com/repos/mitmproxy/mitmproxy/stargazers","contributors_url":"https://api.github.com/repos/mitmproxy/mitmproxy/contributors","subscribers_url":"https://api.github.com/repos/mitmproxy/mitmproxy/subscribers","subscription_url":"https://api.github.com/repos/mitmproxy/mitmproxy/subscription","commits_url":"https://api.github.com/repos/mitmproxy/mitmproxy/commits{/sha}","git_commits_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/commits{/sha}","comments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/comments{/number}","issue_comment_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments{/number}","contents_url":"https://api.github.com/repos/mitmproxy/mitmproxy/contents/{+path}","compare_url":"https://api.github.com/repos/mitmproxy/mitmproxy/compare/{base}...{head}","merges_url":"https://api.github.com/repos/mitmproxy/mitmproxy/merges","archive_url":"https://api.github.com/repos/mitmproxy/mitmproxy/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/mitmproxy/mitmproxy/downloads","issues_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues{/number}","pulls_url":"https://api.github.com/repos/mitmproxy/mitmproxy/pulls{/number}","milestones_url":"https://api.github.com/repos/mitmproxy/mitmproxy/milestones{/number}","notifications_url":"https://api.github.com/repos/mitmproxy/mitmproxy/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/mitmproxy/mitmproxy/labels{/name}","releases_url":"https://api.github.com/repos/mitmproxy/mitmproxy/releases{/id}","deployments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/deployments","created_at":"2010-02-16T04:10:13Z","updated_at":"2025-11-09T17:55:49Z","pushed_at":"2025-11-09T14:36:54Z","git_url":"git://github.com/mitmproxy/mitmproxy.git","ssh_url":"git@github.com:mitmproxy/mitmproxy.git","clone_url":"https://github.com/mitmproxy/mitmproxy.git","svn_url":"https://github.com/mitmproxy/mitmproxy","homepage":"https://mitmproxy.org","size":67124,"stargazers_count":41160,"watchers_count":41160,"language":"Python","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":4359,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":387,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["debugging","http","http2","man-in-the-middle","mitmproxy","proxy","python","security","ssl","tls","websocket"],"visibility":"public","forks":4359,"open_issues":387,"watchers":41160,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"ran into this because my script that restarts mitmdump to rotate the dump file or for #4456\r\nuses a hardcoded delay after killing the old instance.\r\nrecently it took longer than usual for the old instance to die and release the port;\r\ni always ended up with an newly started instance that was running but not listening on any ports.\r\n\r\ndid some bisecting on\r\n```\r\ntime timeout 60 mitmdump -w /dev/null ; [ $? != 124 ]\r\n```\r\n(the default port is always in use by my \"production\" instance)\r\n\r\nand ended up on https://github.com/mitmproxy/mitmproxy/commit/e0e7934d22c4e5e42802a2e666c6d76e26728790\r\n\r\nsadly i'm not familiar enough with python/asyncio to fix this.\r\n\r\nit seems that `await asyncio.start_server()` simply never returns if it fails to bind the port...\r\nhttps://github.com/mitmproxy/mitmproxy/commit/e0e7934d22c4e5e42802a2e666c6d76e26728790#diff-a5cc10fb7c496a1ea1c4f24aec72d0acecb34eaf5e50002d09c1f86e3132e55bR111\r\n(\"Proxy server listening at \" is never printed)\r\n\r\nthe docs don't mention anything special about error behaviour:\r\nhttps://docs.python.org/3.8/library/asyncio-stream.html#asyncio.start_server\r\nthe returned value is a coroutine object even in the error case.\r\n","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4544/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4544/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/815979592","html_url":"https://github.com/mitmproxy/mitmproxy/issues/4456#issuecomment-815979592","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4456","id":815979592,"node_id":"MDEyOklzc3VlQ29tbWVudDgxNTk3OTU5Mg==","user":{"login":"hazcod","id":5222512,"node_id":"MDQ6VXNlcjUyMjI1MTI=","avatar_url":"https://avatars.githubusercontent.com/u/5222512?v=4","gravatar_id":"","url":"https://api.github.com/users/hazcod","html_url":"https://github.com/hazcod","followers_url":"https://api.github.com/users/hazcod/followers","following_url":"https://api.github.com/users/hazcod/following{/other_user}","gists_url":"https://api.github.com/users/hazcod/gists{/gist_id}","starred_url":"https://api.github.com/users/hazcod/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hazcod/subscriptions","organizations_url":"https://api.github.com/users/hazcod/orgs","repos_url":"https://api.github.com/users/hazcod/repos","events_url":"https://api.github.com/users/hazcod/events{/privacy}","received_events_url":"https://api.github.com/users/hazcod/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-08T16:49:19Z","updated_at":"2021-04-08T16:49:26Z","body":"@r00t- I have stream_large_bodies set with `stream_large_bodies: \"1k\"` to enhance my comparable setup.\r\nAny obvious use cases I can try to reproduce? I think I saw the same issue.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/815979592/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"hazcod","id":5222512,"node_id":"MDQ6VXNlcjUyMjI1MTI=","avatar_url":"https://avatars.githubusercontent.com/u/5222512?v=4","gravatar_id":"","url":"https://api.github.com/users/hazcod","html_url":"https://github.com/hazcod","followers_url":"https://api.github.com/users/hazcod/followers","following_url":"https://api.github.com/users/hazcod/following{/other_user}","gists_url":"https://api.github.com/users/hazcod/gists{/gist_id}","starred_url":"https://api.github.com/users/hazcod/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hazcod/subscriptions","organizations_url":"https://api.github.com/users/hazcod/orgs","repos_url":"https://api.github.com/users/hazcod/repos","events_url":"https://api.github.com/users/hazcod/events{/privacy}","received_events_url":"https://api.github.com/users/hazcod/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":4569839064,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDU2OTgzOTA2NA==","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/4569839064","actor":{"login":"r00t-","id":2834981,"node_id":"MDQ6VXNlcjI4MzQ5ODE=","avatar_url":"https://avatars.githubusercontent.com/u/2834981?v=4","gravatar_id":"","url":"https://api.github.com/users/r00t-","html_url":"https://github.com/r00t-","followers_url":"https://api.github.com/users/r00t-/followers","following_url":"https://api.github.com/users/r00t-/following{/other_user}","gists_url":"https://api.github.com/users/r00t-/gists{/gist_id}","starred_url":"https://api.github.com/users/r00t-/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/r00t-/subscriptions","organizations_url":"https://api.github.com/users/r00t-/orgs","repos_url":"https://api.github.com/users/r00t-/repos","events_url":"https://api.github.com/users/r00t-/events{/privacy}","received_events_url":"https://api.github.com/users/r00t-/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-04-08T16:49:19Z","performed_via_github_app":null},{"id":4569839069,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQ1Njk4MzkwNjk=","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/4569839069","actor":{"login":"r00t-","id":2834981,"node_id":"MDQ6VXNlcjI4MzQ5ODE=","avatar_url":"https://avatars.githubusercontent.com/u/2834981?v=4","gravatar_id":"","url":"https://api.github.com/users/r00t-","html_url":"https://github.com/r00t-","followers_url":"https://api.github.com/users/r00t-/followers","following_url":"https://api.github.com/users/r00t-/following{/other_user}","gists_url":"https://api.github.com/users/r00t-/gists{/gist_id}","starred_url":"https://api.github.com/users/r00t-/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/r00t-/subscriptions","organizations_url":"https://api.github.com/users/r00t-/orgs","repos_url":"https://api.github.com/users/r00t-/repos","events_url":"https://api.github.com/users/r00t-/events{/privacy}","received_events_url":"https://api.github.com/users/r00t-/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-04-08T16:49:19Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/816004824","html_url":"https://github.com/mitmproxy/mitmproxy/issues/4456#issuecomment-816004824","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4456","id":816004824,"node_id":"MDEyOklzc3VlQ29tbWVudDgxNjAwNDgyNA==","user":{"login":"r00t-","id":2834981,"node_id":"MDQ6VXNlcjI4MzQ5ODE=","avatar_url":"https://avatars.githubusercontent.com/u/2834981?v=4","gravatar_id":"","url":"https://api.github.com/users/r00t-","html_url":"https://github.com/r00t-","followers_url":"https://api.github.com/users/r00t-/followers","following_url":"https://api.github.com/users/r00t-/following{/other_user}","gists_url":"https://api.github.com/users/r00t-/gists{/gist_id}","starred_url":"https://api.github.com/users/r00t-/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/r00t-/subscriptions","organizations_url":"https://api.github.com/users/r00t-/orgs","repos_url":"https://api.github.com/users/r00t-/repos","events_url":"https://api.github.com/users/r00t-/events{/privacy}","received_events_url":"https://api.github.com/users/r00t-/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-08T17:27:20Z","updated_at":"2021-04-08T17:27:20Z","body":"@hazcod:\r\nsetting `stream_large_bodies` is not an option for me, as i do want all data logged.\r\nso if it's that, i rather live with the memory usage.\r\n\r\ni could never pinpoint a specific site that causes or reproduces this.\r\nthe last stats dump i posted, showing even wordpress stuff sticking around made it seem to be a more general issue,\r\nbut i have no idea about the details of this.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/816004824/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"r00t-","id":2834981,"node_id":"MDQ6VXNlcjI4MzQ5ODE=","avatar_url":"https://avatars.githubusercontent.com/u/2834981?v=4","gravatar_id":"","url":"https://api.github.com/users/r00t-","html_url":"https://github.com/r00t-","followers_url":"https://api.github.com/users/r00t-/followers","following_url":"https://api.github.com/users/r00t-/following{/other_user}","gists_url":"https://api.github.com/users/r00t-/gists{/gist_id}","starred_url":"https://api.github.com/users/r00t-/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/r00t-/subscriptions","organizations_url":"https://api.github.com/users/r00t-/orgs","repos_url":"https://api.github.com/users/r00t-/repos","events_url":"https://api.github.com/users/r00t-/events{/privacy}","received_events_url":"https://api.github.com/users/r00t-/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":4570021821,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDU3MDAyMTgyMQ==","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/4570021821","actor":{"login":"hazcod","id":5222512,"node_id":"MDQ6VXNlcjUyMjI1MTI=","avatar_url":"https://avatars.githubusercontent.com/u/5222512?v=4","gravatar_id":"","url":"https://api.github.com/users/hazcod","html_url":"https://github.com/hazcod","followers_url":"https://api.github.com/users/hazcod/followers","following_url":"https://api.github.com/users/hazcod/following{/other_user}","gists_url":"https://api.github.com/users/hazcod/gists{/gist_id}","starred_url":"https://api.github.com/users/hazcod/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hazcod/subscriptions","organizations_url":"https://api.github.com/users/hazcod/orgs","repos_url":"https://api.github.com/users/hazcod/repos","events_url":"https://api.github.com/users/hazcod/events{/privacy}","received_events_url":"https://api.github.com/users/hazcod/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-04-08T17:27:20Z","performed_via_github_app":null},{"id":4570021824,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQ1NzAwMjE4MjQ=","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/4570021824","actor":{"login":"hazcod","id":5222512,"node_id":"MDQ6VXNlcjUyMjI1MTI=","avatar_url":"https://avatars.githubusercontent.com/u/5222512?v=4","gravatar_id":"","url":"https://api.github.com/users/hazcod","html_url":"https://github.com/hazcod","followers_url":"https://api.github.com/users/hazcod/followers","following_url":"https://api.github.com/users/hazcod/following{/other_user}","gists_url":"https://api.github.com/users/hazcod/gists{/gist_id}","starred_url":"https://api.github.com/users/hazcod/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hazcod/subscriptions","organizations_url":"https://api.github.com/users/hazcod/orgs","repos_url":"https://api.github.com/users/hazcod/repos","events_url":"https://api.github.com/users/hazcod/events{/privacy}","received_events_url":"https://api.github.com/users/hazcod/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-04-08T17:27:20Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/816719026","html_url":"https://github.com/mitmproxy/mitmproxy/issues/4456#issuecomment-816719026","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4456","id":816719026,"node_id":"MDEyOklzc3VlQ29tbWVudDgxNjcxOTAyNg==","user":{"login":"hazcod","id":5222512,"node_id":"MDQ6VXNlcjUyMjI1MTI=","avatar_url":"https://avatars.githubusercontent.com/u/5222512?v=4","gravatar_id":"","url":"https://api.github.com/users/hazcod","html_url":"https://github.com/hazcod","followers_url":"https://api.github.com/users/hazcod/followers","following_url":"https://api.github.com/users/hazcod/following{/other_user}","gists_url":"https://api.github.com/users/hazcod/gists{/gist_id}","starred_url":"https://api.github.com/users/hazcod/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hazcod/subscriptions","organizations_url":"https://api.github.com/users/hazcod/orgs","repos_url":"https://api.github.com/users/hazcod/repos","events_url":"https://api.github.com/users/hazcod/events{/privacy}","received_events_url":"https://api.github.com/users/hazcod/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-09T14:22:25Z","updated_at":"2021-04-09T14:22:55Z","body":"I am able to reproduce with :\r\n\r\n```shell\r\n% curl -x localhost:3128 -v -o ~/Downloads/1gb.bin -k https://speed.hetzner.de/1GB.bin\r\n```\r\n\r\nmitmproxy will get killed in my case when memory usage raises above 1GB, which happens every time I try download this file.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/816719026/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"hazcod","id":5222512,"node_id":"MDQ6VXNlcjUyMjI1MTI=","avatar_url":"https://avatars.githubusercontent.com/u/5222512?v=4","gravatar_id":"","url":"https://api.github.com/users/hazcod","html_url":"https://github.com/hazcod","followers_url":"https://api.github.com/users/hazcod/followers","following_url":"https://api.github.com/users/hazcod/following{/other_user}","gists_url":"https://api.github.com/users/hazcod/gists{/gist_id}","starred_url":"https://api.github.com/users/hazcod/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hazcod/subscriptions","organizations_url":"https://api.github.com/users/hazcod/orgs","repos_url":"https://api.github.com/users/hazcod/repos","events_url":"https://api.github.com/users/hazcod/events{/privacy}","received_events_url":"https://api.github.com/users/hazcod/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/816802422","html_url":"https://github.com/mitmproxy/mitmproxy/issues/4456#issuecomment-816802422","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4456","id":816802422,"node_id":"MDEyOklzc3VlQ29tbWVudDgxNjgwMjQyMg==","user":{"login":"r00t-","id":2834981,"node_id":"MDQ6VXNlcjI4MzQ5ODE=","avatar_url":"https://avatars.githubusercontent.com/u/2834981?v=4","gravatar_id":"","url":"https://api.github.com/users/r00t-","html_url":"https://github.com/r00t-","followers_url":"https://api.github.com/users/r00t-/followers","following_url":"https://api.github.com/users/r00t-/following{/other_user}","gists_url":"https://api.github.com/users/r00t-/gists{/gist_id}","starred_url":"https://api.github.com/users/r00t-/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/r00t-/subscriptions","organizations_url":"https://api.github.com/users/r00t-/orgs","repos_url":"https://api.github.com/users/r00t-/repos","events_url":"https://api.github.com/users/r00t-/events{/privacy}","received_events_url":"https://api.github.com/users/r00t-/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-09T16:29:12Z","updated_at":"2021-04-09T16:35:53Z","body":"> mitmproxy will get killed in my case when memory usage raises above 1GB, which happens every time I try download this file.\r\n\r\nthat is a different issue, or rather expected behaviour.\r\nmitmproxy holds any flow in memory until exit (or the buffer is cleared, if such an option exists, i'm not a user of it),\r\nmitmdump until it writes it our to disk.\r\n\r\nthis issue is about mitmdump's memory usage growing over time,\r\nwhile the number of _active_ streams is not expected to grow over time.\r\n(or maybe it does, due to websites doing weird things, like sending streams as very large chunked bodies, which end up as a single large flow that never gets written out.)","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/816802422/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"r00t-","id":2834981,"node_id":"MDQ6VXNlcjI4MzQ5ODE=","avatar_url":"https://avatars.githubusercontent.com/u/2834981?v=4","gravatar_id":"","url":"https://api.github.com/users/r00t-","html_url":"https://github.com/r00t-","followers_url":"https://api.github.com/users/r00t-/followers","following_url":"https://api.github.com/users/r00t-/following{/other_user}","gists_url":"https://api.github.com/users/r00t-/gists{/gist_id}","starred_url":"https://api.github.com/users/r00t-/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/r00t-/subscriptions","organizations_url":"https://api.github.com/users/r00t-/orgs","repos_url":"https://api.github.com/users/r00t-/repos","events_url":"https://api.github.com/users/r00t-/events{/privacy}","received_events_url":"https://api.github.com/users/r00t-/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"mario-sangar","id":66425016,"node_id":"MDQ6VXNlcjY2NDI1MDE2","avatar_url":"https://avatars.githubusercontent.com/u/66425016?v=4","gravatar_id":"","url":"https://api.github.com/users/mario-sangar","html_url":"https://github.com/mario-sangar","followers_url":"https://api.github.com/users/mario-sangar/followers","following_url":"https://api.github.com/users/mario-sangar/following{/other_user}","gists_url":"https://api.github.com/users/mario-sangar/gists{/gist_id}","starred_url":"https://api.github.com/users/mario-sangar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mario-sangar/subscriptions","organizations_url":"https://api.github.com/users/mario-sangar/orgs","repos_url":"https://api.github.com/users/mario-sangar/repos","events_url":"https://api.github.com/users/mario-sangar/events{/privacy}","received_events_url":"https://api.github.com/users/mario-sangar/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-08-31T13:44:13Z","updated_at":"2021-08-31T13:44:13Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4786","repository_url":"https://api.github.com/repos/mitmproxy/mitmproxy","labels_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4786/labels{/name}","comments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4786/comments","events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4786/events","html_url":"https://github.com/mitmproxy/mitmproxy/issues/4786","id":983880823,"node_id":"MDU6SXNzdWU5ODM4ODA4MjM=","number":4786,"title":"Memory constantly growing when using mitmdump","user":{"login":"mario-sangar","id":66425016,"node_id":"MDQ6VXNlcjY2NDI1MDE2","avatar_url":"https://avatars.githubusercontent.com/u/66425016?v=4","gravatar_id":"","url":"https://api.github.com/users/mario-sangar","html_url":"https://github.com/mario-sangar","followers_url":"https://api.github.com/users/mario-sangar/followers","following_url":"https://api.github.com/users/mario-sangar/following{/other_user}","gists_url":"https://api.github.com/users/mario-sangar/gists{/gist_id}","starred_url":"https://api.github.com/users/mario-sangar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mario-sangar/subscriptions","organizations_url":"https://api.github.com/users/mario-sangar/orgs","repos_url":"https://api.github.com/users/mario-sangar/repos","events_url":"https://api.github.com/users/mario-sangar/events{/privacy}","received_events_url":"https://api.github.com/users/mario-sangar/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":79336502,"node_id":"MDU6TGFiZWw3OTMzNjUwMg==","url":"https://api.github.com/repos/mitmproxy/mitmproxy/labels/kind/bug","name":"kind/bug","color":"d93f0b","default":false,"description":null},{"id":429896009,"node_id":"MDU6TGFiZWw0Mjk4OTYwMDk=","url":"https://api.github.com/repos/mitmproxy/mitmproxy/labels/area/protocols","name":"area/protocols","color":"fef2c0","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":23,"created_at":"2021-08-31T13:44:13Z","updated_at":"2024-02-22T04:36:17Z","closed_at":"2022-09-07T12:21:50Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":519832,"node_id":"MDEwOlJlcG9zaXRvcnk1MTk4MzI=","name":"mitmproxy","full_name":"mitmproxy/mitmproxy","private":false,"owner":{"login":"mitmproxy","id":4652787,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQ2NTI3ODc=","avatar_url":"https://avatars.githubusercontent.com/u/4652787?v=4","gravatar_id":"","url":"https://api.github.com/users/mitmproxy","html_url":"https://github.com/mitmproxy","followers_url":"https://api.github.com/users/mitmproxy/followers","following_url":"https://api.github.com/users/mitmproxy/following{/other_user}","gists_url":"https://api.github.com/users/mitmproxy/gists{/gist_id}","starred_url":"https://api.github.com/users/mitmproxy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mitmproxy/subscriptions","organizations_url":"https://api.github.com/users/mitmproxy/orgs","repos_url":"https://api.github.com/users/mitmproxy/repos","events_url":"https://api.github.com/users/mitmproxy/events{/privacy}","received_events_url":"https://api.github.com/users/mitmproxy/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/mitmproxy/mitmproxy","description":"An interactive TLS-capable intercepting HTTP proxy for penetration testers and software developers.","fork":false,"url":"https://api.github.com/repos/mitmproxy/mitmproxy","forks_url":"https://api.github.com/repos/mitmproxy/mitmproxy/forks","keys_url":"https://api.github.com/repos/mitmproxy/mitmproxy/keys{/key_id}","collaborators_url":"https://api.github.com/repos/mitmproxy/mitmproxy/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/mitmproxy/mitmproxy/teams","hooks_url":"https://api.github.com/repos/mitmproxy/mitmproxy/hooks","issue_events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events{/number}","events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/events","assignees_url":"https://api.github.com/repos/mitmproxy/mitmproxy/assignees{/user}","branches_url":"https://api.github.com/repos/mitmproxy/mitmproxy/branches{/branch}","tags_url":"https://api.github.com/repos/mitmproxy/mitmproxy/tags","blobs_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/refs{/sha}","trees_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/trees{/sha}","statuses_url":"https://api.github.com/repos/mitmproxy/mitmproxy/statuses/{sha}","languages_url":"https://api.github.com/repos/mitmproxy/mitmproxy/languages","stargazers_url":"https://api.github.com/repos/mitmproxy/mitmproxy/stargazers","contributors_url":"https://api.github.com/repos/mitmproxy/mitmproxy/contributors","subscribers_url":"https://api.github.com/repos/mitmproxy/mitmproxy/subscribers","subscription_url":"https://api.github.com/repos/mitmproxy/mitmproxy/subscription","commits_url":"https://api.github.com/repos/mitmproxy/mitmproxy/commits{/sha}","git_commits_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/commits{/sha}","comments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/comments{/number}","issue_comment_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments{/number}","contents_url":"https://api.github.com/repos/mitmproxy/mitmproxy/contents/{+path}","compare_url":"https://api.github.com/repos/mitmproxy/mitmproxy/compare/{base}...{head}","merges_url":"https://api.github.com/repos/mitmproxy/mitmproxy/merges","archive_url":"https://api.github.com/repos/mitmproxy/mitmproxy/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/mitmproxy/mitmproxy/downloads","issues_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues{/number}","pulls_url":"https://api.github.com/repos/mitmproxy/mitmproxy/pulls{/number}","milestones_url":"https://api.github.com/repos/mitmproxy/mitmproxy/milestones{/number}","notifications_url":"https://api.github.com/repos/mitmproxy/mitmproxy/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/mitmproxy/mitmproxy/labels{/name}","releases_url":"https://api.github.com/repos/mitmproxy/mitmproxy/releases{/id}","deployments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/deployments","created_at":"2010-02-16T04:10:13Z","updated_at":"2025-11-09T17:55:49Z","pushed_at":"2025-11-09T14:36:54Z","git_url":"git://github.com/mitmproxy/mitmproxy.git","ssh_url":"git@github.com:mitmproxy/mitmproxy.git","clone_url":"https://github.com/mitmproxy/mitmproxy.git","svn_url":"https://github.com/mitmproxy/mitmproxy","homepage":"https://mitmproxy.org","size":67124,"stargazers_count":41160,"watchers_count":41160,"language":"Python","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":4359,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":387,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["debugging","http","http2","man-in-the-middle","mitmproxy","proxy","python","security","ssl","tls","websocket"],"visibility":"public","forks":4359,"open_issues":387,"watchers":41160,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"Related to #4456, but this is for HTTP traffic.\r\n\r\n#### Problem Description\r\n\r\nWe are using MITMProxy (`mitmdump`) as a reverse proxy, running in a container. We are processing lots of incoming HTTP requests, that we forward on the proxy to a pool of nodes, that serve the response to the client. As you can see in the graph below, the memory of this container is never freed, it either stays flat or grows constantly until reaching what we currently set as maximum (8GB). The flat lines are not related to traffic, that is constantly coming to the proxy.\r\n\r\n![image](https://user-images.githubusercontent.com/66425016/131492463-a4084bc5-9f3d-4057-b956-f63b1a75fdb0.png)\r\n\r\nLooking at the snippet on the related issue (https://github.com/mitmproxy/mitmproxy/issues/4456#issuecomment-780710897), we sent `SIGUSR1` to the same proxy configuration on another environment that has a limit of 2GB. These are the results when the memory was growing and around 980MB:\r\n\r\n```\r\n****************************************************\r\nSummary\r\n=======\r\n\r\nThreads\r\n=======\r\n(...)\r\n\r\nMemory\r\n=======\r\n51 <class 'mitmproxy.proxy.layers.modes.ReverseProxy'>\r\n51 <class 'mitmproxy.proxy.layers.http.HttpLayer'>\r\n51 <class 'mitmproxy.proxy.layers.http._http1.Http1Server'>\r\n51 <class 'mitmproxy.proxy.server.TimeoutWatchdog'>\r\n72 <class 'mitmproxy.optmanager._Option'>\r\n102 <class 'mitmproxy.proxy.layer.NextLayer'>\r\n175 <class 'mitmproxy.proxy.layers.http._http1.Http1Client'>\r\n175 <class 'mitmproxy.proxy.layers.http.HttpClient'>\r\n175 <class 'mitmproxy.proxy.server_hooks.ServerConnectionHookData'>\r\n175 <class 'mitmproxy.proxy.commands.OpenConnection'>\r\n226 <class 'mitmproxy.connection.Server'>\r\n277 <class 'mitmproxy.proxy.server.ConnectionIO'>\r\n44111 <class 'mitmproxy.proxy.context.Context'>\r\n43834 <class 'mitmproxy.proxy.layers.http.HttpStream'>\r\n43834 <class 'mitmproxy.http.HTTPFlow'>\r\n43834 <class 'mitmproxy.http.Response'>\r\n43834 <class 'mitmproxy.http.Request'>\r\n43834 <class 'mitmproxy.http.ResponseData'>\r\n43834 <class 'mitmproxy.http.RequestData'>\r\n87668 <class 'mitmproxy.http.Headers'>\r\n```\r\n\r\nI don't think that the proxy has that amount of connections open, so there is something that is keeping these flows to be cleaned after they finish.\r\n\r\n#### Steps to reproduce the behavior:\r\n1. Run `mitmdump` in `mode:reverse`.\r\n2. Send lots of HTTP requests to the proxy (a rate of 100req/s should be enough)\r\n3. Wait for the container to reach the memory limit, being killed due to an OOM.\r\n4. (opt) Send `SIGUSR1` to the process within the container to get a report of the memory contents.\r\n\r\n#### System Information\r\nUsing a docker container and `mitmdump`:\r\n\r\n```shell\r\nMitmproxy: 7.0.0\r\nPython:    3.9.6\r\nOpenSSL:   OpenSSL 1.1.1k  25 Mar 2021\r\nPlatform:  Linux-5.11.0-27-generic-x86_64-with-glibc2.28\r\n```\r\n\r\nAlso, we're using custom addons to: redirect the traffic to a pool of nodes, expose Prometheus metrics and applying rate limiting to incoming requests.\r\n","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4786/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4786/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/1076941822","html_url":"https://github.com/mitmproxy/mitmproxy/issues/4456#issuecomment-1076941822","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4456","id":1076941822,"node_id":"IC_kwDOAAfumM5AMNP-","user":{"login":"bratao","id":1090152,"node_id":"MDQ6VXNlcjEwOTAxNTI=","avatar_url":"https://avatars.githubusercontent.com/u/1090152?v=4","gravatar_id":"","url":"https://api.github.com/users/bratao","html_url":"https://github.com/bratao","followers_url":"https://api.github.com/users/bratao/followers","following_url":"https://api.github.com/users/bratao/following{/other_user}","gists_url":"https://api.github.com/users/bratao/gists{/gist_id}","starred_url":"https://api.github.com/users/bratao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bratao/subscriptions","organizations_url":"https://api.github.com/users/bratao/orgs","repos_url":"https://api.github.com/users/bratao/repos","events_url":"https://api.github.com/users/bratao/events{/privacy}","received_events_url":"https://api.github.com/users/bratao/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-24T00:17:52Z","updated_at":"2022-03-24T00:17:52Z","body":"@mhils there is any pointers you can give me to how to solve or debug this problem?\r\nI do have a constant running mitmproxy instance handling hundreds of connections, and I had to restart it daily because the memory do not stop growling \r\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/1076941822/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"bratao","id":1090152,"node_id":"MDQ6VXNlcjEwOTAxNTI=","avatar_url":"https://avatars.githubusercontent.com/u/1090152?v=4","gravatar_id":"","url":"https://api.github.com/users/bratao","html_url":"https://github.com/bratao","followers_url":"https://api.github.com/users/bratao/followers","following_url":"https://api.github.com/users/bratao/following{/other_user}","gists_url":"https://api.github.com/users/bratao/gists{/gist_id}","starred_url":"https://api.github.com/users/bratao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bratao/subscriptions","organizations_url":"https://api.github.com/users/bratao/orgs","repos_url":"https://api.github.com/users/bratao/repos","events_url":"https://api.github.com/users/bratao/events{/privacy}","received_events_url":"https://api.github.com/users/bratao/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":6295631736,"node_id":"MEE_lADOAAfumM4wRNvDzwAAAAF3P7d4","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/6295631736","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-03-24T00:17:52Z","performed_via_github_app":null}]