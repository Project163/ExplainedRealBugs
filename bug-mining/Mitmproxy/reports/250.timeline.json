[{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/300760079","html_url":"https://github.com/mitmproxy/mitmproxy/issues/2329#issuecomment-300760079","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2329","id":300760079,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMDc2MDA3OQ==","user":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-11T11:20:25Z","updated_at":"2017-05-11T11:21:11Z","body":"Thanks for the fantastic bug report! ðŸ˜ƒ \r\n\r\nThis seems to be a bug. Here is the socat output on master with another mitmproxy instance running on port 999:\r\n```\r\nmitmproxy -p 8081 -s uplink.py --mode upstream:http://localhost:8082 --ssl-insecure --set upstream_cert=false\r\n```\r\n```\r\n> 2017/05/11 13:12:03.064050  length=119 from=0 to=118\r\nCONNECT www.google.com:80 HTTP/1.1\\r\r\nHost: www.google.com:443\\r\r\nUser-Agent: curl/7.47.0\\r\r\nProxy-Connection: Keep-Alive\\r\r\n\\r\r\n< 2017/05/11 13:12:03.120659  length=39 from=0 to=38\r\nHTTP/1.1 200 Connection established\\r\r\n\\r\r\n> 2017/05/11 13:12:03.426827  length=239 from=119 to=357\r\n...........2...?6n.dm*w`]..qm.{.|.u...q..]<..B.+.,.\t.#.\r\n.$.\\b./.0...'...(......./.<.5.=.A...\r\n.....3.g.9.k.E.........{.........www.google.com.\\v.......\r\n<snip>\r\nsocat[1498] E write(6, 0x15294a0, 31): Broken pipe\r\n\r\n\r\n> 2017/05/11 13:12:03.762322  length=115 from=0 to=114\r\nCONNECT www.google.com:80 HTTP/1.1\\r\r\nHost: www.google.com\\r\r\nUser-Agent: curl/7.47.0\\r\r\nProxy-Connection: Keep-Alive\\r\r\n\\r\r\n< 2017/05/11 13:12:03.846242  length=39 from=0 to=38\r\nHTTP/1.1 200 Connection established\\r\r\n\\r\r\n> 2017/05/11 13:12:03.849285  length=78 from=115 to=192\r\nGET / HTTP/1.1\\r\r\nHost: www.google.com\\r\r\nUser-Agent: curl/7.47.0\\r\r\nAccept: */*\\r\r\n\\r\r\n< 2017/05/11 13:12:03.988207  length=243 from=39 to=281\r\nHTTP/1.1 302 Found\\r\r\n<snip>\r\n```\r\n\r\nThis looks like we initially establish a TLS connection, but then immediately disconnect and open a new (plaintext) connection. Looking at the code, we always establish a connection [here](https://github.com/mitmproxy/mitmproxy/blob/6af72160bf98b58682b8f9fc5aabf51928d2b1d3/mitmproxy/proxy/protocol/http.py#L220). I'm not exactly sure why that is the case, maybe we just need to call `self.set_server(address)` at this point instead. \r\n\r\n@Kriechi @ujjwal96: Can one of you verify if that works? I'm moving this weekend, so I won't get to this before the end of next week.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/300760079/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":1078051542,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTA3ODA1MTU0Mg==","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/1078051542","actor":{"login":"Kriechi","id":114300,"node_id":"MDQ6VXNlcjExNDMwMA==","avatar_url":"https://avatars.githubusercontent.com/u/114300?v=4","gravatar_id":"","url":"https://api.github.com/users/Kriechi","html_url":"https://github.com/Kriechi","followers_url":"https://api.github.com/users/Kriechi/followers","following_url":"https://api.github.com/users/Kriechi/following{/other_user}","gists_url":"https://api.github.com/users/Kriechi/gists{/gist_id}","starred_url":"https://api.github.com/users/Kriechi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Kriechi/subscriptions","organizations_url":"https://api.github.com/users/Kriechi/orgs","repos_url":"https://api.github.com/users/Kriechi/repos","events_url":"https://api.github.com/users/Kriechi/events{/privacy}","received_events_url":"https://api.github.com/users/Kriechi/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2017-05-11T11:20:25Z","performed_via_github_app":null},{"id":1078051543,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDEwNzgwNTE1NDM=","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/1078051543","actor":{"login":"Kriechi","id":114300,"node_id":"MDQ6VXNlcjExNDMwMA==","avatar_url":"https://avatars.githubusercontent.com/u/114300?v=4","gravatar_id":"","url":"https://api.github.com/users/Kriechi","html_url":"https://github.com/Kriechi","followers_url":"https://api.github.com/users/Kriechi/followers","following_url":"https://api.github.com/users/Kriechi/following{/other_user}","gists_url":"https://api.github.com/users/Kriechi/gists{/gist_id}","starred_url":"https://api.github.com/users/Kriechi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Kriechi/subscriptions","organizations_url":"https://api.github.com/users/Kriechi/orgs","repos_url":"https://api.github.com/users/Kriechi/repos","events_url":"https://api.github.com/users/Kriechi/events{/privacy}","received_events_url":"https://api.github.com/users/Kriechi/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2017-05-11T11:20:25Z","performed_via_github_app":null},{"id":1078051544,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTA3ODA1MTU0NA==","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/1078051544","actor":{"login":"r00tdaemon","id":16747982,"node_id":"MDQ6VXNlcjE2NzQ3OTgy","avatar_url":"https://avatars.githubusercontent.com/u/16747982?v=4","gravatar_id":"","url":"https://api.github.com/users/r00tdaemon","html_url":"https://github.com/r00tdaemon","followers_url":"https://api.github.com/users/r00tdaemon/followers","following_url":"https://api.github.com/users/r00tdaemon/following{/other_user}","gists_url":"https://api.github.com/users/r00tdaemon/gists{/gist_id}","starred_url":"https://api.github.com/users/r00tdaemon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/r00tdaemon/subscriptions","organizations_url":"https://api.github.com/users/r00tdaemon/orgs","repos_url":"https://api.github.com/users/r00tdaemon/repos","events_url":"https://api.github.com/users/r00tdaemon/events{/privacy}","received_events_url":"https://api.github.com/users/r00tdaemon/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2017-05-11T11:20:25Z","performed_via_github_app":null},{"id":1078051545,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDEwNzgwNTE1NDU=","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/1078051545","actor":{"login":"r00tdaemon","id":16747982,"node_id":"MDQ6VXNlcjE2NzQ3OTgy","avatar_url":"https://avatars.githubusercontent.com/u/16747982?v=4","gravatar_id":"","url":"https://api.github.com/users/r00tdaemon","html_url":"https://github.com/r00tdaemon","followers_url":"https://api.github.com/users/r00tdaemon/followers","following_url":"https://api.github.com/users/r00tdaemon/following{/other_user}","gists_url":"https://api.github.com/users/r00tdaemon/gists{/gist_id}","starred_url":"https://api.github.com/users/r00tdaemon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/r00tdaemon/subscriptions","organizations_url":"https://api.github.com/users/r00tdaemon/orgs","repos_url":"https://api.github.com/users/r00tdaemon/repos","events_url":"https://api.github.com/users/r00tdaemon/events{/privacy}","received_events_url":"https://api.github.com/users/r00tdaemon/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2017-05-11T11:20:25Z","performed_via_github_app":null},{"id":1078051712,"node_id":"MDEyOkxhYmVsZWRFdmVudDEwNzgwNTE3MTI=","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/1078051712","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2017-05-11T11:20:35Z","label":{"name":"area/protocols","color":"fef2c0"},"performed_via_github_app":null},{"id":1078051714,"node_id":"MDEyOkxhYmVsZWRFdmVudDEwNzgwNTE3MTQ=","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/1078051714","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2017-05-11T11:20:35Z","label":{"name":"kind/bug","color":"d93f0b"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/302938090","html_url":"https://github.com/mitmproxy/mitmproxy/issues/2329#issuecomment-302938090","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2329","id":302938090,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMjkzODA5MA==","user":{"login":"kyle7zhang","id":6931216,"node_id":"MDQ6VXNlcjY5MzEyMTY=","avatar_url":"https://avatars.githubusercontent.com/u/6931216?v=4","gravatar_id":"","url":"https://api.github.com/users/kyle7zhang","html_url":"https://github.com/kyle7zhang","followers_url":"https://api.github.com/users/kyle7zhang/followers","following_url":"https://api.github.com/users/kyle7zhang/following{/other_user}","gists_url":"https://api.github.com/users/kyle7zhang/gists{/gist_id}","starred_url":"https://api.github.com/users/kyle7zhang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kyle7zhang/subscriptions","organizations_url":"https://api.github.com/users/kyle7zhang/orgs","repos_url":"https://api.github.com/users/kyle7zhang/repos","events_url":"https://api.github.com/users/kyle7zhang/events{/privacy}","received_events_url":"https://api.github.com/users/kyle7zhang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-21T13:52:24Z","updated_at":"2017-05-21T13:52:49Z","body":"Need this feature too.\r\n\r\nLike the post I send:\r\n\r\nhttps://discourse.mitmproxy.org/t/upstream-mode-always-send-connect-to-upstream-server-when-using-https/412","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/302938090/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"kyle7zhang","id":6931216,"node_id":"MDQ6VXNlcjY5MzEyMTY=","avatar_url":"https://avatars.githubusercontent.com/u/6931216?v=4","gravatar_id":"","url":"https://api.github.com/users/kyle7zhang","html_url":"https://github.com/kyle7zhang","followers_url":"https://api.github.com/users/kyle7zhang/followers","following_url":"https://api.github.com/users/kyle7zhang/following{/other_user}","gists_url":"https://api.github.com/users/kyle7zhang/gists{/gist_id}","starred_url":"https://api.github.com/users/kyle7zhang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kyle7zhang/subscriptions","organizations_url":"https://api.github.com/users/kyle7zhang/orgs","repos_url":"https://api.github.com/users/kyle7zhang/repos","events_url":"https://api.github.com/users/kyle7zhang/events{/privacy}","received_events_url":"https://api.github.com/users/kyle7zhang/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/304499120","html_url":"https://github.com/mitmproxy/mitmproxy/issues/2329#issuecomment-304499120","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2329","id":304499120,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNDQ5OTEyMA==","user":{"login":"felixgr","id":1822371,"node_id":"MDQ6VXNlcjE4MjIzNzE=","avatar_url":"https://avatars.githubusercontent.com/u/1822371?v=4","gravatar_id":"","url":"https://api.github.com/users/felixgr","html_url":"https://github.com/felixgr","followers_url":"https://api.github.com/users/felixgr/followers","following_url":"https://api.github.com/users/felixgr/following{/other_user}","gists_url":"https://api.github.com/users/felixgr/gists{/gist_id}","starred_url":"https://api.github.com/users/felixgr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/felixgr/subscriptions","organizations_url":"https://api.github.com/users/felixgr/orgs","repos_url":"https://api.github.com/users/felixgr/repos","events_url":"https://api.github.com/users/felixgr/events{/privacy}","received_events_url":"https://api.github.com/users/felixgr/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-28T07:57:09Z","updated_at":"2017-05-28T07:57:30Z","body":"The issue, which @icese7en linked, is the same I'm having.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/304499120/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"felixgr","id":1822371,"node_id":"MDQ6VXNlcjE4MjIzNzE=","avatar_url":"https://avatars.githubusercontent.com/u/1822371?v=4","gravatar_id":"","url":"https://api.github.com/users/felixgr","html_url":"https://github.com/felixgr","followers_url":"https://api.github.com/users/felixgr/followers","following_url":"https://api.github.com/users/felixgr/following{/other_user}","gists_url":"https://api.github.com/users/felixgr/gists{/gist_id}","starred_url":"https://api.github.com/users/felixgr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/felixgr/subscriptions","organizations_url":"https://api.github.com/users/felixgr/orgs","repos_url":"https://api.github.com/users/felixgr/repos","events_url":"https://api.github.com/users/felixgr/events{/privacy}","received_events_url":"https://api.github.com/users/felixgr/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":1100107443,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTEwMDEwNzQ0Mw==","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/1100107443","actor":{"login":"kyle7zhang","id":6931216,"node_id":"MDQ6VXNlcjY5MzEyMTY=","avatar_url":"https://avatars.githubusercontent.com/u/6931216?v=4","gravatar_id":"","url":"https://api.github.com/users/kyle7zhang","html_url":"https://github.com/kyle7zhang","followers_url":"https://api.github.com/users/kyle7zhang/followers","following_url":"https://api.github.com/users/kyle7zhang/following{/other_user}","gists_url":"https://api.github.com/users/kyle7zhang/gists{/gist_id}","starred_url":"https://api.github.com/users/kyle7zhang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kyle7zhang/subscriptions","organizations_url":"https://api.github.com/users/kyle7zhang/orgs","repos_url":"https://api.github.com/users/kyle7zhang/repos","events_url":"https://api.github.com/users/kyle7zhang/events{/privacy}","received_events_url":"https://api.github.com/users/kyle7zhang/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2017-05-28T07:57:09Z","performed_via_github_app":null},{"id":1100107444,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDExMDAxMDc0NDQ=","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/1100107444","actor":{"login":"kyle7zhang","id":6931216,"node_id":"MDQ6VXNlcjY5MzEyMTY=","avatar_url":"https://avatars.githubusercontent.com/u/6931216?v=4","gravatar_id":"","url":"https://api.github.com/users/kyle7zhang","html_url":"https://github.com/kyle7zhang","followers_url":"https://api.github.com/users/kyle7zhang/followers","following_url":"https://api.github.com/users/kyle7zhang/following{/other_user}","gists_url":"https://api.github.com/users/kyle7zhang/gists{/gist_id}","starred_url":"https://api.github.com/users/kyle7zhang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kyle7zhang/subscriptions","organizations_url":"https://api.github.com/users/kyle7zhang/orgs","repos_url":"https://api.github.com/users/kyle7zhang/repos","events_url":"https://api.github.com/users/kyle7zhang/events{/privacy}","received_events_url":"https://api.github.com/users/kyle7zhang/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2017-05-28T07:57:09Z","performed_via_github_app":null},{"id":1106862054,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDExMDY4NjIwNTQ=","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/1106862054","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"c96f3e875ebbca5ef6afb10787b6975e7ca9c758","commit_url":"https://api.github.com/repos/mhils/mitmproxy/commits/c96f3e875ebbca5ef6afb10787b6975e7ca9c758","created_at":"2017-06-01T21:35:40Z","performed_via_github_app":null},{"actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-01T21:38:05Z","updated_at":"2017-06-01T21:38:05Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2367","repository_url":"https://api.github.com/repos/mitmproxy/mitmproxy","labels_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2367/labels{/name}","comments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2367/comments","events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2367/events","html_url":"https://github.com/mitmproxy/mitmproxy/pull/2367","id":233018233,"node_id":"MDExOlB1bGxSZXF1ZXN0MTIzNTk5NzI1","number":2367,"title":"Fix #2329","user":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2017-06-01T21:38:05Z","updated_at":"2017-06-03T17:00:25Z","closed_at":"2017-06-02T12:18:57Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":519832,"node_id":"MDEwOlJlcG9zaXRvcnk1MTk4MzI=","name":"mitmproxy","full_name":"mitmproxy/mitmproxy","private":false,"owner":{"login":"mitmproxy","id":4652787,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQ2NTI3ODc=","avatar_url":"https://avatars.githubusercontent.com/u/4652787?v=4","gravatar_id":"","url":"https://api.github.com/users/mitmproxy","html_url":"https://github.com/mitmproxy","followers_url":"https://api.github.com/users/mitmproxy/followers","following_url":"https://api.github.com/users/mitmproxy/following{/other_user}","gists_url":"https://api.github.com/users/mitmproxy/gists{/gist_id}","starred_url":"https://api.github.com/users/mitmproxy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mitmproxy/subscriptions","organizations_url":"https://api.github.com/users/mitmproxy/orgs","repos_url":"https://api.github.com/users/mitmproxy/repos","events_url":"https://api.github.com/users/mitmproxy/events{/privacy}","received_events_url":"https://api.github.com/users/mitmproxy/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/mitmproxy/mitmproxy","description":"An interactive TLS-capable intercepting HTTP proxy for penetration testers and software developers.","fork":false,"url":"https://api.github.com/repos/mitmproxy/mitmproxy","forks_url":"https://api.github.com/repos/mitmproxy/mitmproxy/forks","keys_url":"https://api.github.com/repos/mitmproxy/mitmproxy/keys{/key_id}","collaborators_url":"https://api.github.com/repos/mitmproxy/mitmproxy/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/mitmproxy/mitmproxy/teams","hooks_url":"https://api.github.com/repos/mitmproxy/mitmproxy/hooks","issue_events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events{/number}","events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/events","assignees_url":"https://api.github.com/repos/mitmproxy/mitmproxy/assignees{/user}","branches_url":"https://api.github.com/repos/mitmproxy/mitmproxy/branches{/branch}","tags_url":"https://api.github.com/repos/mitmproxy/mitmproxy/tags","blobs_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/refs{/sha}","trees_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/trees{/sha}","statuses_url":"https://api.github.com/repos/mitmproxy/mitmproxy/statuses/{sha}","languages_url":"https://api.github.com/repos/mitmproxy/mitmproxy/languages","stargazers_url":"https://api.github.com/repos/mitmproxy/mitmproxy/stargazers","contributors_url":"https://api.github.com/repos/mitmproxy/mitmproxy/contributors","subscribers_url":"https://api.github.com/repos/mitmproxy/mitmproxy/subscribers","subscription_url":"https://api.github.com/repos/mitmproxy/mitmproxy/subscription","commits_url":"https://api.github.com/repos/mitmproxy/mitmproxy/commits{/sha}","git_commits_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/commits{/sha}","comments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/comments{/number}","issue_comment_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments{/number}","contents_url":"https://api.github.com/repos/mitmproxy/mitmproxy/contents/{+path}","compare_url":"https://api.github.com/repos/mitmproxy/mitmproxy/compare/{base}...{head}","merges_url":"https://api.github.com/repos/mitmproxy/mitmproxy/merges","archive_url":"https://api.github.com/repos/mitmproxy/mitmproxy/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/mitmproxy/mitmproxy/downloads","issues_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues{/number}","pulls_url":"https://api.github.com/repos/mitmproxy/mitmproxy/pulls{/number}","milestones_url":"https://api.github.com/repos/mitmproxy/mitmproxy/milestones{/number}","notifications_url":"https://api.github.com/repos/mitmproxy/mitmproxy/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/mitmproxy/mitmproxy/labels{/name}","releases_url":"https://api.github.com/repos/mitmproxy/mitmproxy/releases{/id}","deployments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/deployments","created_at":"2010-02-16T04:10:13Z","updated_at":"2025-11-09T17:55:49Z","pushed_at":"2025-11-09T14:36:54Z","git_url":"git://github.com/mitmproxy/mitmproxy.git","ssh_url":"git@github.com:mitmproxy/mitmproxy.git","clone_url":"https://github.com/mitmproxy/mitmproxy.git","svn_url":"https://github.com/mitmproxy/mitmproxy","homepage":"https://mitmproxy.org","size":67124,"stargazers_count":41160,"watchers_count":41160,"language":"Python","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":4359,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":387,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["debugging","http","http2","man-in-the-middle","mitmproxy","proxy","python","security","ssl","tls","websocket"],"visibility":"public","forks":4359,"open_issues":387,"watchers":41160,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/pulls/2367","html_url":"https://github.com/mitmproxy/mitmproxy/pull/2367","diff_url":"https://github.com/mitmproxy/mitmproxy/pull/2367.diff","patch_url":"https://github.com/mitmproxy/mitmproxy/pull/2367.patch","merged_at":"2017-06-02T12:18:57Z"},"body":"This PR makes it possible to remove TLS from upstream proxy connections. An addon can now define\r\n```python\r\ndef http_connect(flow):\r\n    flow.request.scheme = \"http\"\r\n```\r\nto disable TLS negotation with the upstream proxy. This should fix #2329.","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2367/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2367/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":1106866780,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDExMDY4NjY3ODA=","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/1106866780","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"89977ce414012182626f3bb6db2b9939034a0139","commit_url":"https://api.github.com/repos/mhils/mitmproxy/commits/89977ce414012182626f3bb6db2b9939034a0139","created_at":"2017-06-01T21:39:09Z","performed_via_github_app":null},{"id":1106868143,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDExMDY4NjgxNDM=","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/1106868143","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"2ba0791810cc7f843c49249c1107a9886da66f0f","commit_url":"https://api.github.com/repos/mhils/mitmproxy/commits/2ba0791810cc7f843c49249c1107a9886da66f0f","created_at":"2017-06-01T21:40:07Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/305628821","html_url":"https://github.com/mitmproxy/mitmproxy/issues/2329#issuecomment-305628821","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2329","id":305628821,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTYyODgyMQ==","user":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-01T21:40:52Z","updated_at":"2017-06-01T21:40:52Z","body":"@felixgr @icese7en: Sorry that this took so long! I just pushed #2367, which should fix this issue. Does that work for you two?","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/305628821/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":1106869167,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTEwNjg2OTE2Nw==","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/1106869167","actor":{"login":"felixgr","id":1822371,"node_id":"MDQ6VXNlcjE4MjIzNzE=","avatar_url":"https://avatars.githubusercontent.com/u/1822371?v=4","gravatar_id":"","url":"https://api.github.com/users/felixgr","html_url":"https://github.com/felixgr","followers_url":"https://api.github.com/users/felixgr/followers","following_url":"https://api.github.com/users/felixgr/following{/other_user}","gists_url":"https://api.github.com/users/felixgr/gists{/gist_id}","starred_url":"https://api.github.com/users/felixgr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/felixgr/subscriptions","organizations_url":"https://api.github.com/users/felixgr/orgs","repos_url":"https://api.github.com/users/felixgr/repos","events_url":"https://api.github.com/users/felixgr/events{/privacy}","received_events_url":"https://api.github.com/users/felixgr/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2017-06-01T21:40:52Z","performed_via_github_app":null},{"id":1106869169,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDExMDY4NjkxNjk=","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/1106869169","actor":{"login":"felixgr","id":1822371,"node_id":"MDQ6VXNlcjE4MjIzNzE=","avatar_url":"https://avatars.githubusercontent.com/u/1822371?v=4","gravatar_id":"","url":"https://api.github.com/users/felixgr","html_url":"https://github.com/felixgr","followers_url":"https://api.github.com/users/felixgr/followers","following_url":"https://api.github.com/users/felixgr/following{/other_user}","gists_url":"https://api.github.com/users/felixgr/gists{/gist_id}","starred_url":"https://api.github.com/users/felixgr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/felixgr/subscriptions","organizations_url":"https://api.github.com/users/felixgr/orgs","repos_url":"https://api.github.com/users/felixgr/repos","events_url":"https://api.github.com/users/felixgr/events{/privacy}","received_events_url":"https://api.github.com/users/felixgr/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2017-06-01T21:40:52Z","performed_via_github_app":null},{"id":1106869170,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTEwNjg2OTE3MA==","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/1106869170","actor":{"login":"kyle7zhang","id":6931216,"node_id":"MDQ6VXNlcjY5MzEyMTY=","avatar_url":"https://avatars.githubusercontent.com/u/6931216?v=4","gravatar_id":"","url":"https://api.github.com/users/kyle7zhang","html_url":"https://github.com/kyle7zhang","followers_url":"https://api.github.com/users/kyle7zhang/followers","following_url":"https://api.github.com/users/kyle7zhang/following{/other_user}","gists_url":"https://api.github.com/users/kyle7zhang/gists{/gist_id}","starred_url":"https://api.github.com/users/kyle7zhang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kyle7zhang/subscriptions","organizations_url":"https://api.github.com/users/kyle7zhang/orgs","repos_url":"https://api.github.com/users/kyle7zhang/repos","events_url":"https://api.github.com/users/kyle7zhang/events{/privacy}","received_events_url":"https://api.github.com/users/kyle7zhang/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2017-06-01T21:40:52Z","performed_via_github_app":null},{"id":1106869171,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDExMDY4NjkxNzE=","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/1106869171","actor":{"login":"kyle7zhang","id":6931216,"node_id":"MDQ6VXNlcjY5MzEyMTY=","avatar_url":"https://avatars.githubusercontent.com/u/6931216?v=4","gravatar_id":"","url":"https://api.github.com/users/kyle7zhang","html_url":"https://github.com/kyle7zhang","followers_url":"https://api.github.com/users/kyle7zhang/followers","following_url":"https://api.github.com/users/kyle7zhang/following{/other_user}","gists_url":"https://api.github.com/users/kyle7zhang/gists{/gist_id}","starred_url":"https://api.github.com/users/kyle7zhang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kyle7zhang/subscriptions","organizations_url":"https://api.github.com/users/kyle7zhang/orgs","repos_url":"https://api.github.com/users/kyle7zhang/repos","events_url":"https://api.github.com/users/kyle7zhang/events{/privacy}","received_events_url":"https://api.github.com/users/kyle7zhang/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2017-06-01T21:40:52Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/305709924","html_url":"https://github.com/mitmproxy/mitmproxy/issues/2329#issuecomment-305709924","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2329","id":305709924,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTcwOTkyNA==","user":{"login":"felixgr","id":1822371,"node_id":"MDQ6VXNlcjE4MjIzNzE=","avatar_url":"https://avatars.githubusercontent.com/u/1822371?v=4","gravatar_id":"","url":"https://api.github.com/users/felixgr","html_url":"https://github.com/felixgr","followers_url":"https://api.github.com/users/felixgr/followers","following_url":"https://api.github.com/users/felixgr/following{/other_user}","gists_url":"https://api.github.com/users/felixgr/gists{/gist_id}","starred_url":"https://api.github.com/users/felixgr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/felixgr/subscriptions","organizations_url":"https://api.github.com/users/felixgr/orgs","repos_url":"https://api.github.com/users/felixgr/repos","events_url":"https://api.github.com/users/felixgr/events{/privacy}","received_events_url":"https://api.github.com/users/felixgr/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-02T07:20:23Z","updated_at":"2017-06-02T07:20:23Z","body":"No problem at all. Thanks! Works like a charm!\r\n\r\nNew command line\r\n`mitmproxy -p 8081 -s uplink.py -m upstream:http://localhost:8082 -k`","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/305709924/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"felixgr","id":1822371,"node_id":"MDQ6VXNlcjE4MjIzNzE=","avatar_url":"https://avatars.githubusercontent.com/u/1822371?v=4","gravatar_id":"","url":"https://api.github.com/users/felixgr","html_url":"https://github.com/felixgr","followers_url":"https://api.github.com/users/felixgr/followers","following_url":"https://api.github.com/users/felixgr/following{/other_user}","gists_url":"https://api.github.com/users/felixgr/gists{/gist_id}","starred_url":"https://api.github.com/users/felixgr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/felixgr/subscriptions","organizations_url":"https://api.github.com/users/felixgr/orgs","repos_url":"https://api.github.com/users/felixgr/repos","events_url":"https://api.github.com/users/felixgr/events{/privacy}","received_events_url":"https://api.github.com/users/felixgr/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/305757385","html_url":"https://github.com/mitmproxy/mitmproxy/issues/2329#issuecomment-305757385","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2329","id":305757385,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTc1NzM4NQ==","user":{"login":"kyle7zhang","id":6931216,"node_id":"MDQ6VXNlcjY5MzEyMTY=","avatar_url":"https://avatars.githubusercontent.com/u/6931216?v=4","gravatar_id":"","url":"https://api.github.com/users/kyle7zhang","html_url":"https://github.com/kyle7zhang","followers_url":"https://api.github.com/users/kyle7zhang/followers","following_url":"https://api.github.com/users/kyle7zhang/following{/other_user}","gists_url":"https://api.github.com/users/kyle7zhang/gists{/gist_id}","starred_url":"https://api.github.com/users/kyle7zhang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kyle7zhang/subscriptions","organizations_url":"https://api.github.com/users/kyle7zhang/orgs","repos_url":"https://api.github.com/users/kyle7zhang/repos","events_url":"https://api.github.com/users/kyle7zhang/events{/privacy}","received_events_url":"https://api.github.com/users/kyle7zhang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-02T11:06:53Z","updated_at":"2017-06-02T11:13:02Z","body":"This is the version info:\r\n\r\n```\r\nMitmproxy version: 3.0.0 (0.8dev6189-0x5e17b5f6) \r\nPython version: 3.6.1\r\nPlatform: Darwin-15.6.0-x86_64-i386-64bit\r\nSSL version: OpenSSL 1.1.0f  25 May 2017\r\nMac version: 10.11.6 ('', '', '') x86_64\r\n(venv) \r\n```\r\n\r\nAnd this is the diagram that meets my purpose: \r\n\r\n```\r\nClient <- HTTPS -> mitmproxy Proxy <- HTTP -> B Proxy (Like charles) <- HTTP -> Server\r\n```\r\n\r\nB Proxy still get connect request from mitmproxy.\r\n\r\nThe inline script I use:\r\n\r\n```\r\nfrom mitmproxy import ctx\r\n\r\n\r\ndef http_connect(flow):\r\n    flow.request.scheme = 'http'\r\n    flow.request.port = 80\r\n    ctx.log.info('script: connect ' + repr(flow))\r\n\r\n\r\ndef request(flow):\r\n    flow.request.scheme = 'http'\r\n    flow.request.port = 80\r\n    ctx.log.info('script: request ' + repr(flow))\r\n```\r\n\r\nAnd the command line I use:\r\n\r\n```\r\nmitmdump -p 5678 -s uplink.py -m upstream:http://localhost:8989\r\n```\r\n\r\nThen charles get connect request from mitmproxy:\r\n\r\n```\r\nCONNECT www.google.com:80 HTTP/1.1\r\nHost: www.google.com:443\r\nUser-Agent: curl/7.43.0\r\nProxy-Connection: Keep-Alive\r\n```\r\n\r\nEven if I use the snippet from #2367 `RewriteToHttp`, Charles still get connect request but HTTP port is 443 now `CONNECT www.google.com:443 HTTP/1.1`.\r\n\r\nWould you please post your snippet and request diagram which is successful? @felixgr ","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/305757385/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"kyle7zhang","id":6931216,"node_id":"MDQ6VXNlcjY5MzEyMTY=","avatar_url":"https://avatars.githubusercontent.com/u/6931216?v=4","gravatar_id":"","url":"https://api.github.com/users/kyle7zhang","html_url":"https://github.com/kyle7zhang","followers_url":"https://api.github.com/users/kyle7zhang/followers","following_url":"https://api.github.com/users/kyle7zhang/following{/other_user}","gists_url":"https://api.github.com/users/kyle7zhang/gists{/gist_id}","starred_url":"https://api.github.com/users/kyle7zhang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kyle7zhang/subscriptions","organizations_url":"https://api.github.com/users/kyle7zhang/orgs","repos_url":"https://api.github.com/users/kyle7zhang/repos","events_url":"https://api.github.com/users/kyle7zhang/events{/privacy}","received_events_url":"https://api.github.com/users/kyle7zhang/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":1107616244,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTEwNzYxNjI0NA==","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/1107616244","actor":{"login":"felixgr","id":1822371,"node_id":"MDQ6VXNlcjE4MjIzNzE=","avatar_url":"https://avatars.githubusercontent.com/u/1822371?v=4","gravatar_id":"","url":"https://api.github.com/users/felixgr","html_url":"https://github.com/felixgr","followers_url":"https://api.github.com/users/felixgr/followers","following_url":"https://api.github.com/users/felixgr/following{/other_user}","gists_url":"https://api.github.com/users/felixgr/gists{/gist_id}","starred_url":"https://api.github.com/users/felixgr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/felixgr/subscriptions","organizations_url":"https://api.github.com/users/felixgr/orgs","repos_url":"https://api.github.com/users/felixgr/repos","events_url":"https://api.github.com/users/felixgr/events{/privacy}","received_events_url":"https://api.github.com/users/felixgr/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2017-06-02T11:08:43Z","performed_via_github_app":null},{"id":1107616245,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDExMDc2MTYyNDU=","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/1107616245","actor":{"login":"felixgr","id":1822371,"node_id":"MDQ6VXNlcjE4MjIzNzE=","avatar_url":"https://avatars.githubusercontent.com/u/1822371?v=4","gravatar_id":"","url":"https://api.github.com/users/felixgr","html_url":"https://github.com/felixgr","followers_url":"https://api.github.com/users/felixgr/followers","following_url":"https://api.github.com/users/felixgr/following{/other_user}","gists_url":"https://api.github.com/users/felixgr/gists{/gist_id}","starred_url":"https://api.github.com/users/felixgr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/felixgr/subscriptions","organizations_url":"https://api.github.com/users/felixgr/orgs","repos_url":"https://api.github.com/users/felixgr/repos","events_url":"https://api.github.com/users/felixgr/events{/privacy}","received_events_url":"https://api.github.com/users/felixgr/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2017-06-02T11:08:43Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/305758193","html_url":"https://github.com/mitmproxy/mitmproxy/issues/2329#issuecomment-305758193","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2329","id":305758193,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTc1ODE5Mw==","user":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-02T11:11:26Z","updated_at":"2017-06-02T11:11:26Z","body":"Thank you two for the quick feedback! :)\r\n\r\n@icese7en: There's still a CONNECT request, but no TLS negotiation after that. I was looking at what it would take to remove the CONNECT as well, but that's not easily doable with our current infrastructure - sorry.\r\n\r\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/305758193/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":1107619555,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTEwNzYxOTU1NQ==","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/1107619555","actor":{"login":"kyle7zhang","id":6931216,"node_id":"MDQ6VXNlcjY5MzEyMTY=","avatar_url":"https://avatars.githubusercontent.com/u/6931216?v=4","gravatar_id":"","url":"https://api.github.com/users/kyle7zhang","html_url":"https://github.com/kyle7zhang","followers_url":"https://api.github.com/users/kyle7zhang/followers","following_url":"https://api.github.com/users/kyle7zhang/following{/other_user}","gists_url":"https://api.github.com/users/kyle7zhang/gists{/gist_id}","starred_url":"https://api.github.com/users/kyle7zhang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kyle7zhang/subscriptions","organizations_url":"https://api.github.com/users/kyle7zhang/orgs","repos_url":"https://api.github.com/users/kyle7zhang/repos","events_url":"https://api.github.com/users/kyle7zhang/events{/privacy}","received_events_url":"https://api.github.com/users/kyle7zhang/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2017-06-02T11:11:26Z","performed_via_github_app":null},{"id":1107619556,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDExMDc2MTk1NTY=","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/1107619556","actor":{"login":"kyle7zhang","id":6931216,"node_id":"MDQ6VXNlcjY5MzEyMTY=","avatar_url":"https://avatars.githubusercontent.com/u/6931216?v=4","gravatar_id":"","url":"https://api.github.com/users/kyle7zhang","html_url":"https://github.com/kyle7zhang","followers_url":"https://api.github.com/users/kyle7zhang/followers","following_url":"https://api.github.com/users/kyle7zhang/following{/other_user}","gists_url":"https://api.github.com/users/kyle7zhang/gists{/gist_id}","starred_url":"https://api.github.com/users/kyle7zhang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kyle7zhang/subscriptions","organizations_url":"https://api.github.com/users/kyle7zhang/orgs","repos_url":"https://api.github.com/users/kyle7zhang/repos","events_url":"https://api.github.com/users/kyle7zhang/events{/privacy}","received_events_url":"https://api.github.com/users/kyle7zhang/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2017-06-02T11:11:26Z","performed_via_github_app":null},{"id":1107619747,"node_id":"MDExOkNsb3NlZEV2ZW50MTEwNzYxOTc0Nw==","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/1107619747","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2017-06-02T11:11:35Z","state_reason":null,"performed_via_github_app":null},{"id":1107698662,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDExMDc2OTg2NjI=","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/1107698662","actor":{"login":"Kriechi","id":114300,"node_id":"MDQ6VXNlcjExNDMwMA==","avatar_url":"https://avatars.githubusercontent.com/u/114300?v=4","gravatar_id":"","url":"https://api.github.com/users/Kriechi","html_url":"https://github.com/Kriechi","followers_url":"https://api.github.com/users/Kriechi/followers","following_url":"https://api.github.com/users/Kriechi/following{/other_user}","gists_url":"https://api.github.com/users/Kriechi/gists{/gist_id}","starred_url":"https://api.github.com/users/Kriechi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Kriechi/subscriptions","organizations_url":"https://api.github.com/users/Kriechi/orgs","repos_url":"https://api.github.com/users/Kriechi/repos","events_url":"https://api.github.com/users/Kriechi/events{/privacy}","received_events_url":"https://api.github.com/users/Kriechi/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"020e5a5c95f7de093e89c046ff4e34d2d02dcd93","commit_url":"https://api.github.com/repos/mitmproxy/mitmproxy/commits/020e5a5c95f7de093e89c046ff4e34d2d02dcd93","created_at":"2017-06-02T12:18:59Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/856014556","html_url":"https://github.com/mitmproxy/mitmproxy/issues/2329#issuecomment-856014556","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2329","id":856014556,"node_id":"MDEyOklzc3VlQ29tbWVudDg1NjAxNDU1Ng==","user":{"login":"pansila","id":5125601,"node_id":"MDQ6VXNlcjUxMjU2MDE=","avatar_url":"https://avatars.githubusercontent.com/u/5125601?v=4","gravatar_id":"","url":"https://api.github.com/users/pansila","html_url":"https://github.com/pansila","followers_url":"https://api.github.com/users/pansila/followers","following_url":"https://api.github.com/users/pansila/following{/other_user}","gists_url":"https://api.github.com/users/pansila/gists{/gist_id}","starred_url":"https://api.github.com/users/pansila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pansila/subscriptions","organizations_url":"https://api.github.com/users/pansila/orgs","repos_url":"https://api.github.com/users/pansila/repos","events_url":"https://api.github.com/users/pansila/events{/privacy}","received_events_url":"https://api.github.com/users/pansila/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-07T15:04:37Z","updated_at":"2021-06-07T15:04:37Z","body":"I'm using the mitmproxy 6.0.2 and this seems doesn't work, mitmproxy is still sending tls handshake to the upstream proxy.\r\n\r\nhttps2http.py:\r\n```\r\n#!/usr/bin/env python3\r\n\r\nfrom mitmproxy import ctx\r\n\r\nclass https2http:\r\n        def http_connect(self, flow):\r\n                flow.request.scheme = 'http'\r\n                #flow.request.port = 1088\r\n                ctx.log.info('script: connect '+repr(flow))\r\n\r\n        def request(self, flow):\r\n                flow.request.scheme = 'http'\r\n                #flow.request.port = 1088\r\n                ctx.log.info('script: request '+repr(flow))\r\n\r\naddons = [https2http()]\r\n```\r\n\r\nmitmproxy events:\r\n```\r\n\u000Finfo: Loading script https2http.py\r\n\u000Finfo: 172.17.64.1:63197: clientconnect\r\n\u000Finfo: script: connect <HTTPFlow?\r\n\u000F  request = Request(CONNECT www.bing.com:443)?\r\n\u000F  client_conn = <ClientConnection: [TLSv1.3] [ALPN: http/1.1] 172.17.64.1:63197>?\r\n\u000F  server_conn = <ServerConnection: 127.0.0.1:1088>>\r\n\u000Fwarn: 172.17.64.1:63197: Cannot establish TLS with 127.0.0.1:1088 (sni: None): TlsException(\"SSL handshake error:\r\n\u000FSysCallError(-1, 'Unexpected EOF')\")\r\n\u000Finfo: 172.17.64.1:63197: clientdisconnect\r\n```\r\n\r\ncommand\r\n```\r\nmitmproxy --mode upstream:http://127.0.0.1:1088 --ssl-insecure --set upstream_cert=false --certs=~/workspace/custom_certs/server.pem -s https2http.py\r\n```","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/856014556/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"pansila","id":5125601,"node_id":"MDQ6VXNlcjUxMjU2MDE=","avatar_url":"https://avatars.githubusercontent.com/u/5125601?v=4","gravatar_id":"","url":"https://api.github.com/users/pansila","html_url":"https://github.com/pansila","followers_url":"https://api.github.com/users/pansila/followers","following_url":"https://api.github.com/users/pansila/following{/other_user}","gists_url":"https://api.github.com/users/pansila/gists{/gist_id}","starred_url":"https://api.github.com/users/pansila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pansila/subscriptions","organizations_url":"https://api.github.com/users/pansila/orgs","repos_url":"https://api.github.com/users/pansila/repos","events_url":"https://api.github.com/users/pansila/events{/privacy}","received_events_url":"https://api.github.com/users/pansila/received_events","type":"User","user_view_type":"public","site_admin":false}}]