{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4751","repository_url":"https://api.github.com/repos/mitmproxy/mitmproxy","labels_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4751/labels{/name}","comments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4751/comments","events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4751/events","html_url":"https://github.com/mitmproxy/mitmproxy/issues/4751","id":970328912,"node_id":"MDU6SXNzdWU5NzAzMjg5MTI=","number":4751,"title":"Cannot inject websocket with binary or string content.","user":{"login":"TonicBoomerKewl","id":78714621,"node_id":"MDQ6VXNlcjc4NzE0NjIx","avatar_url":"https://avatars.githubusercontent.com/u/78714621?v=4","gravatar_id":"","url":"https://api.github.com/users/TonicBoomerKewl","html_url":"https://github.com/TonicBoomerKewl","followers_url":"https://api.github.com/users/TonicBoomerKewl/followers","following_url":"https://api.github.com/users/TonicBoomerKewl/following{/other_user}","gists_url":"https://api.github.com/users/TonicBoomerKewl/gists{/gist_id}","starred_url":"https://api.github.com/users/TonicBoomerKewl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TonicBoomerKewl/subscriptions","organizations_url":"https://api.github.com/users/TonicBoomerKewl/orgs","repos_url":"https://api.github.com/users/TonicBoomerKewl/repos","events_url":"https://api.github.com/users/TonicBoomerKewl/events{/privacy}","received_events_url":"https://api.github.com/users/TonicBoomerKewl/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":109607759,"node_id":"MDU6TGFiZWwxMDk2MDc3NTk=","url":"https://api.github.com/repos/mitmproxy/mitmproxy/labels/kind/docs","name":"kind/docs","color":"5319e7","default":false,"description":"Documentation work needs to be done!"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2021-08-13T11:50:38Z","updated_at":"2021-08-18T11:37:28Z","closed_at":"2021-08-18T11:37:28Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"#### Problem Description\r\nmitmproxy attempts to parse the injected websocket binary data as text, and replaces the binary data if it cannot be decoded into text, changing the injected websocket message. Also, when a string is given instead, there is error:\r\nFile \"\\mitmproxy\\proxy\\layers\\websocket.py\", line 230, in msg\r\n    data_str = data.decode(errors=\"replace\")\r\nAttributeError: 'str' object has no attribute 'decode'\r\n\r\n#### Steps to reproduce the behavior:\r\n1. from mitmproxy.ctx import master\r\n2. master.commands.call(\"inject.websocket\", flow, False, bytes([i for i in range(256)])) # No error, but message contents are changed\r\n3. master.commands.call(\"inject.websocket\", flow, False, \"string\") # AttributeError\r\n\r\n#### System Information\r\nMitmproxy: 7.0.2\r\nPython:    3.9.6\r\nOpenSSL:   OpenSSL 1.1.1k  25 Mar 2021\r\nPlatform:  Windows-10-10.0.19043-SP0\r\n","closed_by":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4751/reactions","total_count":8,"+1":1,"-1":1,"laugh":1,"hooray":1,"confused":1,"heart":1,"rocket":1,"eyes":1},"timeline_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4751/timeline","performed_via_github_app":null,"state_reason":"completed"}