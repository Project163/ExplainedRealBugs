{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/1005","repository_url":"https://api.github.com/repos/mitmproxy/mitmproxy","labels_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/1005/labels{/name}","comments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/1005/comments","events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/1005/events","html_url":"https://github.com/mitmproxy/mitmproxy/issues/1005","id":138837258,"node_id":"MDU6SXNzdWUxMzg4MzcyNTg=","number":1005,"title":"mitmproxy crashes in following mode with filters that remove items from the display based on server response","user":{"login":"dwfreed","id":931883,"node_id":"MDQ6VXNlcjkzMTg4Mw==","avatar_url":"https://avatars.githubusercontent.com/u/931883?v=4","gravatar_id":"","url":"https://api.github.com/users/dwfreed","html_url":"https://github.com/dwfreed","followers_url":"https://api.github.com/users/dwfreed/followers","following_url":"https://api.github.com/users/dwfreed/following{/other_user}","gists_url":"https://api.github.com/users/dwfreed/gists{/gist_id}","starred_url":"https://api.github.com/users/dwfreed/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dwfreed/subscriptions","organizations_url":"https://api.github.com/users/dwfreed/orgs","repos_url":"https://api.github.com/users/dwfreed/repos","events_url":"https://api.github.com/users/dwfreed/events{/privacy}","received_events_url":"https://api.github.com/users/dwfreed/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":79336502,"node_id":"MDU6TGFiZWw3OTMzNjUwMg==","url":"https://api.github.com/repos/mitmproxy/mitmproxy/labels/kind/bug","name":"kind/bug","color":"d93f0b","default":false,"description":null},{"id":174959532,"node_id":"MDU6TGFiZWwxNzQ5NTk1MzI=","url":"https://api.github.com/repos/mitmproxy/mitmproxy/labels/help%20wanted","name":"help wanted","color":"fbca04","default":true,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2016-03-06T20:57:37Z","updated_at":"2016-03-11T16:33:05Z","closed_at":"2016-03-11T16:33:05Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"##### Steps to reproduce the problem:\n1. Set a display filter that specifies things that should not be displayed based on server response (eg \"! ~bs foobar\")\n2. Switch to following mode\n3. Send request\n##### What is the expected behavior?\n\nmitmproxy should either briefly show the request while waiting for the server response, or not show the request until it has the response.\n##### What went wrong?\n\n``` pytb\nTraceback (most recent call last):\n  File \"/usr/local/Cellar/mitmproxy/0.16/libexec/lib/python2.7/site-packages/libmproxy/console/__init__.py\", line 498, in run\n    self.loop.run()\n  File \"/usr/local/Cellar/mitmproxy/0.16/libexec/vendor/lib/python2.7/site-packages/urwid/main_loop.py\", line 278, in run\n    self._run()\n  File \"/usr/local/Cellar/mitmproxy/0.16/libexec/vendor/lib/python2.7/site-packages/urwid/main_loop.py\", line 376, in _run\n    self.event_loop.run()\n  File \"/usr/local/Cellar/mitmproxy/0.16/libexec/vendor/lib/python2.7/site-packages/urwid/main_loop.py\", line 682, in run\n    self._loop()\n  File \"/usr/local/Cellar/mitmproxy/0.16/libexec/vendor/lib/python2.7/site-packages/urwid/main_loop.py\", line 715, in _loop\n    alarm_callback()\n  File \"/usr/local/Cellar/mitmproxy/0.16/libexec/vendor/lib/python2.7/site-packages/urwid/main_loop.py\", line 164, in cb\n    callback(self, user_data)\n  File \"/usr/local/Cellar/mitmproxy/0.16/libexec/lib/python2.7/site-packages/libmproxy/console/__init__.py\", line 451, in ticker\n    self.loop.draw_screen()\n  File \"/usr/local/Cellar/mitmproxy/0.16/libexec/vendor/lib/python2.7/site-packages/urwid/main_loop.py\", line 578, in draw_screen\n    canvas = self._topmost_widget.render(self.screen_size, focus=True)\n  File \"/usr/local/Cellar/mitmproxy/0.16/libexec/vendor/lib/python2.7/site-packages/urwid/widget.py\", line 141, in cached_render\n    canv = fn(self, size, focus=focus)\n  File \"/usr/local/Cellar/mitmproxy/0.16/libexec/vendor/lib/python2.7/site-packages/urwid/container.py\", line 1083, in render\n    focus and self.focus_part == 'body')\n  File \"/usr/local/Cellar/mitmproxy/0.16/libexec/vendor/lib/python2.7/site-packages/urwid/widget.py\", line 141, in cached_render\n    canv = fn(self, size, focus=focus)\n  File \"/usr/local/Cellar/mitmproxy/0.16/libexec/vendor/lib/python2.7/site-packages/urwid/decoration.py\", line 225, in render\n    canv = self._original_widget.render(size, focus=focus)\n  File \"/usr/local/Cellar/mitmproxy/0.16/libexec/vendor/lib/python2.7/site-packages/urwid/widget.py\", line 141, in cached_render\n    canv = fn(self, size, focus=focus)\n  File \"/usr/local/Cellar/mitmproxy/0.16/libexec/vendor/lib/python2.7/site-packages/urwid/listbox.py\", line 457, in render\n    (maxcol, maxrow), focus=focus)\n  File \"/usr/local/Cellar/mitmproxy/0.16/libexec/vendor/lib/python2.7/site-packages/urwid/listbox.py\", line 342, in calculate_visible\n    focus_widget, focus_pos = self.body.get_focus()\n  File \"/usr/local/Cellar/mitmproxy/0.16/libexec/lib/python2.7/site-packages/libmproxy/console/flowlist.py\", line 288, in get_focus\n    f, i = self.state.get_focus()\n  File \"/usr/local/Cellar/mitmproxy/0.16/libexec/lib/python2.7/site-packages/libmproxy/console/__init__.py\", line 69, in get_focus\n    return self.view[self.focus], self.focus\n  File \"/usr/local/Cellar/mitmproxy/0.16/libexec/lib/python2.7/site-packages/libmproxy/flow.py\", line 383, in __getitem__\n    return self._list[item]\nIndexError: list index out of range\n```\n##### Any other comments?\n\nThis only applies when using ! on a filter that depends on server response (eg ~bs, or ( ~s & ~b )) without any other part of the filter depending on the existence of the server response (eg ! ~bs without an & ~s).\n\n---\n\nMitmproxy Version: 0.16 (from Homebrew)\nOperating System: OS X 10.9, Python 2.7.5\n","closed_by":{"login":"Kriechi","id":114300,"node_id":"MDQ6VXNlcjExNDMwMA==","avatar_url":"https://avatars.githubusercontent.com/u/114300?v=4","gravatar_id":"","url":"https://api.github.com/users/Kriechi","html_url":"https://github.com/Kriechi","followers_url":"https://api.github.com/users/Kriechi/followers","following_url":"https://api.github.com/users/Kriechi/following{/other_user}","gists_url":"https://api.github.com/users/Kriechi/gists{/gist_id}","starred_url":"https://api.github.com/users/Kriechi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Kriechi/subscriptions","organizations_url":"https://api.github.com/users/Kriechi/orgs","repos_url":"https://api.github.com/users/Kriechi/repos","events_url":"https://api.github.com/users/Kriechi/events{/privacy}","received_events_url":"https://api.github.com/users/Kriechi/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/1005/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/1005/timeline","performed_via_github_app":null,"state_reason":"completed"}