{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2869","repository_url":"https://api.github.com/repos/mitmproxy/mitmproxy","labels_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2869/labels{/name}","comments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2869/comments","events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2869/events","html_url":"https://github.com/mitmproxy/mitmproxy/issues/2869","id":297482039,"node_id":"MDU6SXNzdWUyOTc0ODIwMzk=","number":2869,"title":"Inability to connect to ipv6 websites through mitmproxy from ipv6 network.","user":{"login":"aniketpanjwani","id":16311215,"node_id":"MDQ6VXNlcjE2MzExMjE1","avatar_url":"https://avatars.githubusercontent.com/u/16311215?v=4","gravatar_id":"","url":"https://api.github.com/users/aniketpanjwani","html_url":"https://github.com/aniketpanjwani","followers_url":"https://api.github.com/users/aniketpanjwani/followers","following_url":"https://api.github.com/users/aniketpanjwani/following{/other_user}","gists_url":"https://api.github.com/users/aniketpanjwani/gists{/gist_id}","starred_url":"https://api.github.com/users/aniketpanjwani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aniketpanjwani/subscriptions","organizations_url":"https://api.github.com/users/aniketpanjwani/orgs","repos_url":"https://api.github.com/users/aniketpanjwani/repos","events_url":"https://api.github.com/users/aniketpanjwani/events{/privacy}","received_events_url":"https://api.github.com/users/aniketpanjwani/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":466930397,"node_id":"MDU6TGFiZWw0NjY5MzAzOTc=","url":"https://api.github.com/repos/mitmproxy/mitmproxy/labels/kind/triage","name":"kind/triage","color":"006b75","default":false,"description":"Unclassified issues"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":19,"created_at":"2018-02-15T15:15:35Z","updated_at":"2020-01-25T20:28:47Z","closed_at":"2018-02-16T15:21:08Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"##### Steps to reproduce the problem:\r\n\r\n1. Follow [instructions](https://github.com/mitmproxy/mitmproxy/blob/master/docs/transparent/linux.rst) to setup transparent proxy on Linux on my own machine, substituting PREROUTING in the iptables ruleset with OUTPUT.\r\n2. Run `mitmdump --mode transparent`\r\n3. Navigate to ipv4 site (e.g. espn.com) and ipv6 site (e.g. facebook.com).\r\n\r\nI've done this from two networks. On one network, I have an ipv6 address (according to http://test-ipv6.com/). On the other network, I do not have an ipv6 address.\r\n\r\n+ ipv4 network: Able to connect to both espn.com and facebook.com\r\n+ ipv6 network: Only able to connect to espn.com. Additionally, when I use http://test-ipv6.com after doing the first two steps above, the website can no longer find my ipv6 address.\r\n\r\nOn the ipv6 network, I receive a message saying the following:\r\n\r\n```\r\nClient connection was killed because allow_remote option is set to false, client IP was not a private IP and proxyauth was not set.\r\nTo allow remote connections set allow_remote option to true or set proxyauth option.\r\n[2601:246:100:cefc:7da3:3d6c:6195:5f1f]:42868: Connection killed\r\n[2601:246:100:cefc:7da3:3d6c:6195:5f1f]:42868: clientdisconnect\r\n```\r\n\r\nWhen I set the allow_remote option to be true (`mitmproxy --mode transparent --set allow_remote=true`), I now receive the following message:\r\n\r\n```\r\n[2601:246:100:cefc:7da3:3d6c:6195:5f1f]:57032: Transparent mode failure: FileNotFoundError(2, ‘No such file or directory’)\r\n```\r\n\r\n##### Any other comments? What have you tried so far?\r\n\r\nI should try putting mitmproxy in a VM or Docker container. Then, I think I would instead have to use the PREROUTING chain. If the transparent proxy works from the VM/Docker container, this would indicate that the problem has to do with configuration when using the OUTPUT chain.\r\n\r\nI think it's reasonable that mitmproxy should support ipv6 when run on your own computer. If we can figure out what the problem is, I'd be happy to submit a pull request to the Linux transparent proxy documentation with more explicit instructions on how to set up mitmproxy. Apologies if this is a better fit in discourse, but I think this issue at the very least reflects something which could be improved in the transparent proxy documentation.\r\n\r\nOne hacky option would be to shut down ipv6 altogether through configuration, but I haven't figured out how to make it work. Another possibility is that this has to do with [router advertisements](http://strugglers.net/~andy/blog/2011/09/04/linux-ipv6-router-advertisements-and-forwarding/), but simply setting the accept_ra flag to be equal to two did not work for me. \r\n\r\n##### System information\r\n\r\nMitmproxy: 3.0.0.dev1179 (commit 6d8731e) \r\nPython:    3.6.4\r\nOpenSSL:   OpenSSL 1.1.0g  2 Nov 2017\r\nPlatform:  Linux-4.4.0-21-generic-x86_64-with-debian-stretch-sid\r\n\r\n\r\n<!-- Please use the mitmproxy forums (https://discourse.mitmproxy.org/) for support/how-to questions. Thanks! :) -->\r\n","closed_by":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2869/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2869/timeline","performed_via_github_app":null,"state_reason":"completed"}