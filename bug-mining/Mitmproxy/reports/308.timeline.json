[{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/365973888","html_url":"https://github.com/mitmproxy/mitmproxy/issues/2869#issuecomment-365973888","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2869","id":365973888,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NTk3Mzg4OA==","user":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-15T16:04:20Z","updated_at":"2018-02-15T16:04:20Z","body":"Thanks for the fantastic write-up! The `FileNotFoundError` in transparent mode is a really weird one, because the only function that could trigger that is `mitmproxy.platform.linux.original_addr`, which doesn't open any files... Can you verify that this is indeed triggered by [linux.py#L9](https://github.com/mitmproxy/mitmproxy/blob/baf4b5dc03c3b87fbef6e5df422eb7654594978f/mitmproxy/platform/linux.py#L9)?\r\n\r\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/365973888/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":1476192475,"node_id":"MDEyOkxhYmVsZWRFdmVudDE0NzYxOTI0NzU=","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/1476192475","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2018-02-15T16:04:31Z","label":{"name":"kind/triage","color":"006b75"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/365976471","html_url":"https://github.com/mitmproxy/mitmproxy/issues/2869#issuecomment-365976471","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2869","id":365976471,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NTk3NjQ3MQ==","user":{"login":"aniketpanjwani","id":16311215,"node_id":"MDQ6VXNlcjE2MzExMjE1","avatar_url":"https://avatars.githubusercontent.com/u/16311215?v=4","gravatar_id":"","url":"https://api.github.com/users/aniketpanjwani","html_url":"https://github.com/aniketpanjwani","followers_url":"https://api.github.com/users/aniketpanjwani/followers","following_url":"https://api.github.com/users/aniketpanjwani/following{/other_user}","gists_url":"https://api.github.com/users/aniketpanjwani/gists{/gist_id}","starred_url":"https://api.github.com/users/aniketpanjwani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aniketpanjwani/subscriptions","organizations_url":"https://api.github.com/users/aniketpanjwani/orgs","repos_url":"https://api.github.com/users/aniketpanjwani/repos","events_url":"https://api.github.com/users/aniketpanjwani/events{/privacy}","received_events_url":"https://api.github.com/users/aniketpanjwani/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-15T16:12:24Z","updated_at":"2018-02-15T16:15:23Z","body":"I think I made an important omission in writing up the issue, which is that I've usually been passing a script to mitmproxy, and this write up is based off errors received when passing the script. So, it's more likely that this is being triggered [here](https://github.com/mitmproxy/mitmproxy/blob/6d8731e144eaec2aaf2120c21969c9228b7af95a/mitmproxy/addons/script.py). It's still not obvious how ipv4/ipv6 would affect triggering the error here.\r\n\r\nI'm pretty sure I also encountered problems when not passing the script, but I'm now I'm a bit less confident. I'll have access to the ipv6 network tonight, and I'll try it again with and without a script.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/365976471/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"aniketpanjwani","id":16311215,"node_id":"MDQ6VXNlcjE2MzExMjE1","avatar_url":"https://avatars.githubusercontent.com/u/16311215?v=4","gravatar_id":"","url":"https://api.github.com/users/aniketpanjwani","html_url":"https://github.com/aniketpanjwani","followers_url":"https://api.github.com/users/aniketpanjwani/followers","following_url":"https://api.github.com/users/aniketpanjwani/following{/other_user}","gists_url":"https://api.github.com/users/aniketpanjwani/gists{/gist_id}","starred_url":"https://api.github.com/users/aniketpanjwani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aniketpanjwani/subscriptions","organizations_url":"https://api.github.com/users/aniketpanjwani/orgs","repos_url":"https://api.github.com/users/aniketpanjwani/repos","events_url":"https://api.github.com/users/aniketpanjwani/events{/privacy}","received_events_url":"https://api.github.com/users/aniketpanjwani/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/365977463","html_url":"https://github.com/mitmproxy/mitmproxy/issues/2869#issuecomment-365977463","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2869","id":365977463,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NTk3NzQ2Mw==","user":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-15T16:15:31Z","updated_at":"2018-02-15T16:15:41Z","body":"Not sure what your script does, but the code path for \"Transparent mode failure\" is pretty clear:\r\n\r\nhttps://github.com/mitmproxy/mitmproxy/blob/568f40c810f4de60f10bd814608fde8268ef7733/mitmproxy/proxy/modes/transparent_proxy.py#L12-L15\r\nhttps://github.com/mitmproxy/mitmproxy/blob/568f40c810f4de60f10bd814608fde8268ef7733/mitmproxy/platform/__init__.py#L20-L23\r\nhttps://github.com/mitmproxy/mitmproxy/blob/568f40c810f4de60f10bd814608fde8268ef7733/mitmproxy/platform/linux.py#L8-L12","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/365977463/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/365979061","html_url":"https://github.com/mitmproxy/mitmproxy/issues/2869#issuecomment-365979061","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2869","id":365979061,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NTk3OTA2MQ==","user":{"login":"aniketpanjwani","id":16311215,"node_id":"MDQ6VXNlcjE2MzExMjE1","avatar_url":"https://avatars.githubusercontent.com/u/16311215?v=4","gravatar_id":"","url":"https://api.github.com/users/aniketpanjwani","html_url":"https://github.com/aniketpanjwani","followers_url":"https://api.github.com/users/aniketpanjwani/followers","following_url":"https://api.github.com/users/aniketpanjwani/following{/other_user}","gists_url":"https://api.github.com/users/aniketpanjwani/gists{/gist_id}","starred_url":"https://api.github.com/users/aniketpanjwani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aniketpanjwani/subscriptions","organizations_url":"https://api.github.com/users/aniketpanjwani/orgs","repos_url":"https://api.github.com/users/aniketpanjwani/repos","events_url":"https://api.github.com/users/aniketpanjwani/events{/privacy}","received_events_url":"https://api.github.com/users/aniketpanjwani/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-15T16:20:12Z","updated_at":"2018-02-15T16:20:12Z","body":"You're right - I got fixated on the FileNotFoundError, since the only place it shows up in the code is in [script.py](https://github.com/mitmproxy/mitmproxy/blob/6d8731e144eaec2aaf2120c21969c9228b7af95a/mitmproxy/addons/script.py).\r\n\r\n[The script](https://github.com/aniketpanjwani/chomper/blob/master/chomper/filter.py) just adjusts the response for particular URLS.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/365979061/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"aniketpanjwani","id":16311215,"node_id":"MDQ6VXNlcjE2MzExMjE1","avatar_url":"https://avatars.githubusercontent.com/u/16311215?v=4","gravatar_id":"","url":"https://api.github.com/users/aniketpanjwani","html_url":"https://github.com/aniketpanjwani","followers_url":"https://api.github.com/users/aniketpanjwani/followers","following_url":"https://api.github.com/users/aniketpanjwani/following{/other_user}","gists_url":"https://api.github.com/users/aniketpanjwani/gists{/gist_id}","starred_url":"https://api.github.com/users/aniketpanjwani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aniketpanjwani/subscriptions","organizations_url":"https://api.github.com/users/aniketpanjwani/orgs","repos_url":"https://api.github.com/users/aniketpanjwani/repos","events_url":"https://api.github.com/users/aniketpanjwani/events{/privacy}","received_events_url":"https://api.github.com/users/aniketpanjwani/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/366106323","html_url":"https://github.com/mitmproxy/mitmproxy/issues/2869#issuecomment-366106323","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2869","id":366106323,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NjEwNjMyMw==","user":{"login":"aniketpanjwani","id":16311215,"node_id":"MDQ6VXNlcjE2MzExMjE1","avatar_url":"https://avatars.githubusercontent.com/u/16311215?v=4","gravatar_id":"","url":"https://api.github.com/users/aniketpanjwani","html_url":"https://github.com/aniketpanjwani","followers_url":"https://api.github.com/users/aniketpanjwani/followers","following_url":"https://api.github.com/users/aniketpanjwani/following{/other_user}","gists_url":"https://api.github.com/users/aniketpanjwani/gists{/gist_id}","starred_url":"https://api.github.com/users/aniketpanjwani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aniketpanjwani/subscriptions","organizations_url":"https://api.github.com/users/aniketpanjwani/orgs","repos_url":"https://api.github.com/users/aniketpanjwani/repos","events_url":"https://api.github.com/users/aniketpanjwani/events{/privacy}","received_events_url":"https://api.github.com/users/aniketpanjwani/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-16T00:17:03Z","updated_at":"2018-02-16T00:18:03Z","body":"So, I'm not entirely sure how to verify that it is being triggered by linux.py. Is there some sort of debug mode I can use to drop down to pdb in case of an error?\r\n\r\nI have two additional things to report:\r\n\r\n1. I followed [these instructions](https://community.rackspace.com/products/f/public-cloud-forum/5110/how-to-prefer-ipv4-over-ipv6-in-ubuntu-and-centos) to get my operating system to prefer ipv4 over ipv6. After following these instructions, I am now able to see in mitmproxy all the dual-stack websites such as facebook and instagram which I was previously not seeing. \r\n2. [One VPN](https://helpdesk.privateinternetaccess.com/hc/en-us/articles/232324908-Why-Do-You-Block-IPv6-) claims that they \"do not use ipv6 as the current implementations are insecure and could potentially compromise your privacy and security\", and that \"most VPN software fails to direct IPv6 traffic through the VPN tunnel, so when you connect to an IPv6 enabled website, your browser will make an IPv6 DNS request outside the VPN, which is therefore handled by your ISP\". They don't really explain why this occurs, but it's possible that whatever is inherent in ipv6 that makes its use difficult with VPNs is also the issue preventing its use as a transparent proxy. I really know very little about computer networks, so I'm just reasoning by induction.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/366106323/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"aniketpanjwani","id":16311215,"node_id":"MDQ6VXNlcjE2MzExMjE1","avatar_url":"https://avatars.githubusercontent.com/u/16311215?v=4","gravatar_id":"","url":"https://api.github.com/users/aniketpanjwani","html_url":"https://github.com/aniketpanjwani","followers_url":"https://api.github.com/users/aniketpanjwani/followers","following_url":"https://api.github.com/users/aniketpanjwani/following{/other_user}","gists_url":"https://api.github.com/users/aniketpanjwani/gists{/gist_id}","starred_url":"https://api.github.com/users/aniketpanjwani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aniketpanjwani/subscriptions","organizations_url":"https://api.github.com/users/aniketpanjwani/orgs","repos_url":"https://api.github.com/users/aniketpanjwani/repos","events_url":"https://api.github.com/users/aniketpanjwani/events{/privacy}","received_events_url":"https://api.github.com/users/aniketpanjwani/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/366107382","html_url":"https://github.com/mitmproxy/mitmproxy/issues/2869#issuecomment-366107382","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2869","id":366107382,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NjEwNzM4Mg==","user":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-16T00:22:30Z","updated_at":"2018-02-16T00:22:30Z","body":"> So, I'm not entirely sure how to verify that it is being triggered by linux.py. Is there some sort of debug mode I can use to drop down to pdb in case of an error?\r\n\r\nAssuming you have installed mitmproxy from source, the easiest form of debugging would be to add print statements in linux.py. pdb works as well of course, you can call that from an addon in mitmdump so that the UI is out of the way or use https://github.com/mitmproxy/mitmproxy/blob/master/examples/complex/remote_debug.py.\r\n\r\nAnd no, there's no particular reason why IPv6 DNS should behave differently. It's very likely possible that our `getsockopt` call doesn't work for IPv6, but I'm quite confused why that triggers a FileNotFound.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/366107382/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/366108132","html_url":"https://github.com/mitmproxy/mitmproxy/issues/2869#issuecomment-366108132","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2869","id":366108132,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NjEwODEzMg==","user":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-16T00:26:51Z","updated_at":"2018-02-16T00:26:51Z","body":"Ah, it looks like @chadbrubaker was ahead of us: https://github.com/google/nogotofail/commit/c73070ca3098faab2994a83a9249d7c973151aa4. \r\nCould you check if applying this fix solves it?","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/366108132/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":1477063033,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTQ3NzA2MzAzMw==","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/1477063033","actor":{"login":"chadbrubaker","id":9422938,"node_id":"MDQ6VXNlcjk0MjI5Mzg=","avatar_url":"https://avatars.githubusercontent.com/u/9422938?v=4","gravatar_id":"","url":"https://api.github.com/users/chadbrubaker","html_url":"https://github.com/chadbrubaker","followers_url":"https://api.github.com/users/chadbrubaker/followers","following_url":"https://api.github.com/users/chadbrubaker/following{/other_user}","gists_url":"https://api.github.com/users/chadbrubaker/gists{/gist_id}","starred_url":"https://api.github.com/users/chadbrubaker/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chadbrubaker/subscriptions","organizations_url":"https://api.github.com/users/chadbrubaker/orgs","repos_url":"https://api.github.com/users/chadbrubaker/repos","events_url":"https://api.github.com/users/chadbrubaker/events{/privacy}","received_events_url":"https://api.github.com/users/chadbrubaker/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2018-02-16T00:26:51Z","performed_via_github_app":null},{"id":1477063034,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDE0NzcwNjMwMzQ=","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/1477063034","actor":{"login":"chadbrubaker","id":9422938,"node_id":"MDQ6VXNlcjk0MjI5Mzg=","avatar_url":"https://avatars.githubusercontent.com/u/9422938?v=4","gravatar_id":"","url":"https://api.github.com/users/chadbrubaker","html_url":"https://github.com/chadbrubaker","followers_url":"https://api.github.com/users/chadbrubaker/followers","following_url":"https://api.github.com/users/chadbrubaker/following{/other_user}","gists_url":"https://api.github.com/users/chadbrubaker/gists{/gist_id}","starred_url":"https://api.github.com/users/chadbrubaker/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chadbrubaker/subscriptions","organizations_url":"https://api.github.com/users/chadbrubaker/orgs","repos_url":"https://api.github.com/users/chadbrubaker/repos","events_url":"https://api.github.com/users/chadbrubaker/events{/privacy}","received_events_url":"https://api.github.com/users/chadbrubaker/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2018-02-16T00:26:51Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/366113288","html_url":"https://github.com/mitmproxy/mitmproxy/issues/2869#issuecomment-366113288","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2869","id":366113288,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NjExMzI4OA==","user":{"login":"aniketpanjwani","id":16311215,"node_id":"MDQ6VXNlcjE2MzExMjE1","avatar_url":"https://avatars.githubusercontent.com/u/16311215?v=4","gravatar_id":"","url":"https://api.github.com/users/aniketpanjwani","html_url":"https://github.com/aniketpanjwani","followers_url":"https://api.github.com/users/aniketpanjwani/followers","following_url":"https://api.github.com/users/aniketpanjwani/following{/other_user}","gists_url":"https://api.github.com/users/aniketpanjwani/gists{/gist_id}","starred_url":"https://api.github.com/users/aniketpanjwani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aniketpanjwani/subscriptions","organizations_url":"https://api.github.com/users/aniketpanjwani/orgs","repos_url":"https://api.github.com/users/aniketpanjwani/repos","events_url":"https://api.github.com/users/aniketpanjwani/events{/privacy}","received_events_url":"https://api.github.com/users/aniketpanjwani/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-16T00:55:45Z","updated_at":"2018-02-16T00:55:45Z","body":"Oh cool! I'll get to this in the next few hours.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/366113288/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"aniketpanjwani","id":16311215,"node_id":"MDQ6VXNlcjE2MzExMjE1","avatar_url":"https://avatars.githubusercontent.com/u/16311215?v=4","gravatar_id":"","url":"https://api.github.com/users/aniketpanjwani","html_url":"https://github.com/aniketpanjwani","followers_url":"https://api.github.com/users/aniketpanjwani/followers","following_url":"https://api.github.com/users/aniketpanjwani/following{/other_user}","gists_url":"https://api.github.com/users/aniketpanjwani/gists{/gist_id}","starred_url":"https://api.github.com/users/aniketpanjwani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aniketpanjwani/subscriptions","organizations_url":"https://api.github.com/users/aniketpanjwani/orgs","repos_url":"https://api.github.com/users/aniketpanjwani/repos","events_url":"https://api.github.com/users/aniketpanjwani/events{/privacy}","received_events_url":"https://api.github.com/users/aniketpanjwani/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/366116962","html_url":"https://github.com/mitmproxy/mitmproxy/issues/2869#issuecomment-366116962","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2869","id":366116962,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NjExNjk2Mg==","user":{"login":"aniketpanjwani","id":16311215,"node_id":"MDQ6VXNlcjE2MzExMjE1","avatar_url":"https://avatars.githubusercontent.com/u/16311215?v=4","gravatar_id":"","url":"https://api.github.com/users/aniketpanjwani","html_url":"https://github.com/aniketpanjwani","followers_url":"https://api.github.com/users/aniketpanjwani/followers","following_url":"https://api.github.com/users/aniketpanjwani/following{/other_user}","gists_url":"https://api.github.com/users/aniketpanjwani/gists{/gist_id}","starred_url":"https://api.github.com/users/aniketpanjwani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aniketpanjwani/subscriptions","organizations_url":"https://api.github.com/users/aniketpanjwani/orgs","repos_url":"https://api.github.com/users/aniketpanjwani/repos","events_url":"https://api.github.com/users/aniketpanjwani/events{/privacy}","received_events_url":"https://api.github.com/users/aniketpanjwani/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-16T01:15:49Z","updated_at":"2018-02-16T01:15:49Z","body":"Getting this error when installing from source as per [instructions](https://github.com/mitmproxy/mitmproxy#development-setup):\r\n\r\n```\r\n+ echo Creating dev environment in ./venv...\r\nCreating dev environment in ./venv...\r\n+ python3 -m venv venv\r\n Error: Command '['/home/aniket/personal/other/mitmproxy/venv/bin/python3', '-Im', 'ensurepip', '--upgrade', '--default-pip']' returned non-zero exit status 1.\r\n```\r\nIf I install the requirements from pipenv, will it still be the case that mitmproxy is installed as \"editable\" (so that it responds to my pdb entries)? I'll try it out...","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/366116962/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"aniketpanjwani","id":16311215,"node_id":"MDQ6VXNlcjE2MzExMjE1","avatar_url":"https://avatars.githubusercontent.com/u/16311215?v=4","gravatar_id":"","url":"https://api.github.com/users/aniketpanjwani","html_url":"https://github.com/aniketpanjwani","followers_url":"https://api.github.com/users/aniketpanjwani/followers","following_url":"https://api.github.com/users/aniketpanjwani/following{/other_user}","gists_url":"https://api.github.com/users/aniketpanjwani/gists{/gist_id}","starred_url":"https://api.github.com/users/aniketpanjwani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aniketpanjwani/subscriptions","organizations_url":"https://api.github.com/users/aniketpanjwani/orgs","repos_url":"https://api.github.com/users/aniketpanjwani/repos","events_url":"https://api.github.com/users/aniketpanjwani/events{/privacy}","received_events_url":"https://api.github.com/users/aniketpanjwani/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/366126125","html_url":"https://github.com/mitmproxy/mitmproxy/issues/2869#issuecomment-366126125","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2869","id":366126125,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NjEyNjEyNQ==","user":{"login":"aniketpanjwani","id":16311215,"node_id":"MDQ6VXNlcjE2MzExMjE1","avatar_url":"https://avatars.githubusercontent.com/u/16311215?v=4","gravatar_id":"","url":"https://api.github.com/users/aniketpanjwani","html_url":"https://github.com/aniketpanjwani","followers_url":"https://api.github.com/users/aniketpanjwani/followers","following_url":"https://api.github.com/users/aniketpanjwani/following{/other_user}","gists_url":"https://api.github.com/users/aniketpanjwani/gists{/gist_id}","starred_url":"https://api.github.com/users/aniketpanjwani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aniketpanjwani/subscriptions","organizations_url":"https://api.github.com/users/aniketpanjwani/orgs","repos_url":"https://api.github.com/users/aniketpanjwani/repos","events_url":"https://api.github.com/users/aniketpanjwani/events{/privacy}","received_events_url":"https://api.github.com/users/aniketpanjwani/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-16T02:15:02Z","updated_at":"2018-02-16T02:15:02Z","body":"I got the environment working. Here's what I tried - copying @chadbrubaker as closely as possible:\r\n\r\n```\r\nimport socket\r\nimport struct\r\n\r\n# Python socket module does not have this constant\r\nSO_ORIGINAL_DST = 80\r\n\r\n\r\ndef original_addr(csock: socket.socket):\r\n    family = csock.family\r\n    if family == socket.AF_IFNET:\r\n        odestdata = csock.getsockopt(socket.SOL_IP, SO_ORIGINAL_DST, 28)\r\n    elif family == socket.AF_INET6:\r\n        SOL_IPV6 = 41\r\n        odestdata = csock.getsockopt(SOL_IPV6, SO_ORIGINAL_DST, 64)\r\n    _, port, a1, a2, a3, a4 = struct.unpack(\"!HHBBBBxxxxxxxx\", odestdata)\r\n    address = \"%d.%d.%d.%d\" % (a1, a2, a3, a4)\r\n    return address, port\r\n```\r\nI get an error saying `'socket' has no attribute 'AF_INET'`. Any thoughts?\r\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/366126125/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"aniketpanjwani","id":16311215,"node_id":"MDQ6VXNlcjE2MzExMjE1","avatar_url":"https://avatars.githubusercontent.com/u/16311215?v=4","gravatar_id":"","url":"https://api.github.com/users/aniketpanjwani","html_url":"https://github.com/aniketpanjwani","followers_url":"https://api.github.com/users/aniketpanjwani/followers","following_url":"https://api.github.com/users/aniketpanjwani/following{/other_user}","gists_url":"https://api.github.com/users/aniketpanjwani/gists{/gist_id}","starred_url":"https://api.github.com/users/aniketpanjwani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aniketpanjwani/subscriptions","organizations_url":"https://api.github.com/users/aniketpanjwani/orgs","repos_url":"https://api.github.com/users/aniketpanjwani/repos","events_url":"https://api.github.com/users/aniketpanjwani/events{/privacy}","received_events_url":"https://api.github.com/users/aniketpanjwani/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":1477165509,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTQ3NzE2NTUwOQ==","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/1477165509","actor":{"login":"chadbrubaker","id":9422938,"node_id":"MDQ6VXNlcjk0MjI5Mzg=","avatar_url":"https://avatars.githubusercontent.com/u/9422938?v=4","gravatar_id":"","url":"https://api.github.com/users/chadbrubaker","html_url":"https://github.com/chadbrubaker","followers_url":"https://api.github.com/users/chadbrubaker/followers","following_url":"https://api.github.com/users/chadbrubaker/following{/other_user}","gists_url":"https://api.github.com/users/chadbrubaker/gists{/gist_id}","starred_url":"https://api.github.com/users/chadbrubaker/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chadbrubaker/subscriptions","organizations_url":"https://api.github.com/users/chadbrubaker/orgs","repos_url":"https://api.github.com/users/chadbrubaker/repos","events_url":"https://api.github.com/users/chadbrubaker/events{/privacy}","received_events_url":"https://api.github.com/users/chadbrubaker/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2018-02-16T02:15:02Z","performed_via_github_app":null},{"id":1477165510,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDE0NzcxNjU1MTA=","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/1477165510","actor":{"login":"chadbrubaker","id":9422938,"node_id":"MDQ6VXNlcjk0MjI5Mzg=","avatar_url":"https://avatars.githubusercontent.com/u/9422938?v=4","gravatar_id":"","url":"https://api.github.com/users/chadbrubaker","html_url":"https://github.com/chadbrubaker","followers_url":"https://api.github.com/users/chadbrubaker/followers","following_url":"https://api.github.com/users/chadbrubaker/following{/other_user}","gists_url":"https://api.github.com/users/chadbrubaker/gists{/gist_id}","starred_url":"https://api.github.com/users/chadbrubaker/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chadbrubaker/subscriptions","organizations_url":"https://api.github.com/users/chadbrubaker/orgs","repos_url":"https://api.github.com/users/chadbrubaker/repos","events_url":"https://api.github.com/users/chadbrubaker/events{/privacy}","received_events_url":"https://api.github.com/users/chadbrubaker/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2018-02-16T02:15:02Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/366126309","html_url":"https://github.com/mitmproxy/mitmproxy/issues/2869#issuecomment-366126309","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2869","id":366126309,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NjEyNjMwOQ==","user":{"login":"aniketpanjwani","id":16311215,"node_id":"MDQ6VXNlcjE2MzExMjE1","avatar_url":"https://avatars.githubusercontent.com/u/16311215?v=4","gravatar_id":"","url":"https://api.github.com/users/aniketpanjwani","html_url":"https://github.com/aniketpanjwani","followers_url":"https://api.github.com/users/aniketpanjwani/followers","following_url":"https://api.github.com/users/aniketpanjwani/following{/other_user}","gists_url":"https://api.github.com/users/aniketpanjwani/gists{/gist_id}","starred_url":"https://api.github.com/users/aniketpanjwani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aniketpanjwani/subscriptions","organizations_url":"https://api.github.com/users/aniketpanjwani/orgs","repos_url":"https://api.github.com/users/aniketpanjwani/repos","events_url":"https://api.github.com/users/aniketpanjwani/events{/privacy}","received_events_url":"https://api.github.com/users/aniketpanjwani/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-16T02:16:18Z","updated_at":"2018-02-16T02:16:18Z","body":"Also, when I stick a `pdb.set_trace()` inside linux.py, I'm able to find `socket.AF_INET`. Some sort of namespace error going on...","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/366126309/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"aniketpanjwani","id":16311215,"node_id":"MDQ6VXNlcjE2MzExMjE1","avatar_url":"https://avatars.githubusercontent.com/u/16311215?v=4","gravatar_id":"","url":"https://api.github.com/users/aniketpanjwani","html_url":"https://github.com/aniketpanjwani","followers_url":"https://api.github.com/users/aniketpanjwani/followers","following_url":"https://api.github.com/users/aniketpanjwani/following{/other_user}","gists_url":"https://api.github.com/users/aniketpanjwani/gists{/gist_id}","starred_url":"https://api.github.com/users/aniketpanjwani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aniketpanjwani/subscriptions","organizations_url":"https://api.github.com/users/aniketpanjwani/orgs","repos_url":"https://api.github.com/users/aniketpanjwani/repos","events_url":"https://api.github.com/users/aniketpanjwani/events{/privacy}","received_events_url":"https://api.github.com/users/aniketpanjwani/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/366126339","html_url":"https://github.com/mitmproxy/mitmproxy/issues/2869#issuecomment-366126339","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2869","id":366126339,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NjEyNjMzOQ==","user":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-16T02:16:32Z","updated_at":"2018-02-16T02:16:32Z","body":"`if family == socket.AF_IFNET:` <- typo","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/366126339/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/366126862","html_url":"https://github.com/mitmproxy/mitmproxy/issues/2869#issuecomment-366126862","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2869","id":366126862,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NjEyNjg2Mg==","user":{"login":"aniketpanjwani","id":16311215,"node_id":"MDQ6VXNlcjE2MzExMjE1","avatar_url":"https://avatars.githubusercontent.com/u/16311215?v=4","gravatar_id":"","url":"https://api.github.com/users/aniketpanjwani","html_url":"https://github.com/aniketpanjwani","followers_url":"https://api.github.com/users/aniketpanjwani/followers","following_url":"https://api.github.com/users/aniketpanjwani/following{/other_user}","gists_url":"https://api.github.com/users/aniketpanjwani/gists{/gist_id}","starred_url":"https://api.github.com/users/aniketpanjwani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aniketpanjwani/subscriptions","organizations_url":"https://api.github.com/users/aniketpanjwani/orgs","repos_url":"https://api.github.com/users/aniketpanjwani/repos","events_url":"https://api.github.com/users/aniketpanjwani/events{/privacy}","received_events_url":"https://api.github.com/users/aniketpanjwani/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-16T02:19:52Z","updated_at":"2018-02-16T02:19:52Z","body":"Fixed the typo, but still getting the same TransparentModeFailure.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/366126862/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"aniketpanjwani","id":16311215,"node_id":"MDQ6VXNlcjE2MzExMjE1","avatar_url":"https://avatars.githubusercontent.com/u/16311215?v=4","gravatar_id":"","url":"https://api.github.com/users/aniketpanjwani","html_url":"https://github.com/aniketpanjwani","followers_url":"https://api.github.com/users/aniketpanjwani/followers","following_url":"https://api.github.com/users/aniketpanjwani/following{/other_user}","gists_url":"https://api.github.com/users/aniketpanjwani/gists{/gist_id}","starred_url":"https://api.github.com/users/aniketpanjwani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aniketpanjwani/subscriptions","organizations_url":"https://api.github.com/users/aniketpanjwani/orgs","repos_url":"https://api.github.com/users/aniketpanjwani/repos","events_url":"https://api.github.com/users/aniketpanjwani/events{/privacy}","received_events_url":"https://api.github.com/users/aniketpanjwani/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/366126914","html_url":"https://github.com/mitmproxy/mitmproxy/issues/2869#issuecomment-366126914","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2869","id":366126914,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NjEyNjkxNA==","user":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-16T02:20:13Z","updated_at":"2018-02-16T02:20:13Z","body":"Still a FileNotFound?","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/366126914/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/366127004","html_url":"https://github.com/mitmproxy/mitmproxy/issues/2869#issuecomment-366127004","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2869","id":366127004,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NjEyNzAwNA==","user":{"login":"aniketpanjwani","id":16311215,"node_id":"MDQ6VXNlcjE2MzExMjE1","avatar_url":"https://avatars.githubusercontent.com/u/16311215?v=4","gravatar_id":"","url":"https://api.github.com/users/aniketpanjwani","html_url":"https://github.com/aniketpanjwani","followers_url":"https://api.github.com/users/aniketpanjwani/followers","following_url":"https://api.github.com/users/aniketpanjwani/following{/other_user}","gists_url":"https://api.github.com/users/aniketpanjwani/gists{/gist_id}","starred_url":"https://api.github.com/users/aniketpanjwani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aniketpanjwani/subscriptions","organizations_url":"https://api.github.com/users/aniketpanjwani/orgs","repos_url":"https://api.github.com/users/aniketpanjwani/repos","events_url":"https://api.github.com/users/aniketpanjwani/events{/privacy}","received_events_url":"https://api.github.com/users/aniketpanjwani/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-16T02:20:48Z","updated_at":"2018-02-16T02:20:48Z","body":" Yep.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/366127004/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"aniketpanjwani","id":16311215,"node_id":"MDQ6VXNlcjE2MzExMjE1","avatar_url":"https://avatars.githubusercontent.com/u/16311215?v=4","gravatar_id":"","url":"https://api.github.com/users/aniketpanjwani","html_url":"https://github.com/aniketpanjwani","followers_url":"https://api.github.com/users/aniketpanjwani/followers","following_url":"https://api.github.com/users/aniketpanjwani/following{/other_user}","gists_url":"https://api.github.com/users/aniketpanjwani/gists{/gist_id}","starred_url":"https://api.github.com/users/aniketpanjwani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aniketpanjwani/subscriptions","organizations_url":"https://api.github.com/users/aniketpanjwani/orgs","repos_url":"https://api.github.com/users/aniketpanjwani/repos","events_url":"https://api.github.com/users/aniketpanjwani/events{/privacy}","received_events_url":"https://api.github.com/users/aniketpanjwani/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/366127081","html_url":"https://github.com/mitmproxy/mitmproxy/issues/2869#issuecomment-366127081","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2869","id":366127081,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NjEyNzA4MQ==","user":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-16T02:21:22Z","updated_at":"2018-02-16T02:21:22Z","body":"Can you get on Slack so that we can shorten turnaround times?","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/366127081/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/366127141","html_url":"https://github.com/mitmproxy/mitmproxy/issues/2869#issuecomment-366127141","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2869","id":366127141,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NjEyNzE0MQ==","user":{"login":"aniketpanjwani","id":16311215,"node_id":"MDQ6VXNlcjE2MzExMjE1","avatar_url":"https://avatars.githubusercontent.com/u/16311215?v=4","gravatar_id":"","url":"https://api.github.com/users/aniketpanjwani","html_url":"https://github.com/aniketpanjwani","followers_url":"https://api.github.com/users/aniketpanjwani/followers","following_url":"https://api.github.com/users/aniketpanjwani/following{/other_user}","gists_url":"https://api.github.com/users/aniketpanjwani/gists{/gist_id}","starred_url":"https://api.github.com/users/aniketpanjwani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aniketpanjwani/subscriptions","organizations_url":"https://api.github.com/users/aniketpanjwani/orgs","repos_url":"https://api.github.com/users/aniketpanjwani/repos","events_url":"https://api.github.com/users/aniketpanjwani/events{/privacy}","received_events_url":"https://api.github.com/users/aniketpanjwani/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-16T02:21:51Z","updated_at":"2018-02-16T02:21:51Z","body":"Sure thing.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/366127141/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"aniketpanjwani","id":16311215,"node_id":"MDQ6VXNlcjE2MzExMjE1","avatar_url":"https://avatars.githubusercontent.com/u/16311215?v=4","gravatar_id":"","url":"https://api.github.com/users/aniketpanjwani","html_url":"https://github.com/aniketpanjwani","followers_url":"https://api.github.com/users/aniketpanjwani/followers","following_url":"https://api.github.com/users/aniketpanjwani/following{/other_user}","gists_url":"https://api.github.com/users/aniketpanjwani/gists{/gist_id}","starred_url":"https://api.github.com/users/aniketpanjwani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aniketpanjwani/subscriptions","organizations_url":"https://api.github.com/users/aniketpanjwani/orgs","repos_url":"https://api.github.com/users/aniketpanjwani/repos","events_url":"https://api.github.com/users/aniketpanjwani/events{/privacy}","received_events_url":"https://api.github.com/users/aniketpanjwani/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/366145212","html_url":"https://github.com/mitmproxy/mitmproxy/issues/2869#issuecomment-366145212","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2869","id":366145212,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NjE0NTIxMg==","user":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-16T05:06:28Z","updated_at":"2018-02-16T05:06:28Z","body":"Ok, this turned out to be much more of a rabbit hole than I expected. \r\n\r\n1. `sock.getsockopt(SOL_IPV6, SO_ORIGINAL_DST, 28)` is generally the right thing we need to do to support IPv6.\r\n2. Surprise: On IPv6 networks this now breaks IPv4 connections: \r\n `sock.family` is `AF_INET6`, `peername` is an IPv4-mapped `::ffff:192.168.0.102`, and the syscall fails. \r\nIf we observe an IPv4-mapped IPv6 address, we do need to use the original IPv4 syscall. \r\n3. Biggest surprise: If we call `getsockopt` with arguments for the wrong address type, @aniketpanjwani can reliably crash his Python runtime. Example code:\r\n```python\r\n    try:\r\n        dst = sock.getsockopt(socket.SOL_IP, SO_ORIGINAL_DST, 16)\r\n        print(\"IPv4: {}\".format(dst))\r\n        port, raw_ip = struct.unpack_from(\"!2xH4s\", dst)\r\n        ip = socket.inet_ntop(socket.AF_INET, raw_ip)\r\n    except Exception:\r\n        dst = sock.getsockopt(SOL_IPV6, SO_ORIGINAL_DST, 28)\r\n        print(\"IPv4 failed, IPv6: {}\".format(dst))\r\n        port, raw_ip = struct.unpack_from(\"!2xH4x16s\", dst)\r\n        ip = socket.inet_ntop(socket.AF_INET6, raw_ip)\r\n```\r\n4. Overall, the solution seems to be something like this:\r\n```python\r\nimport socket\r\nimport struct\r\nimport typing\r\n\r\n# Python's socket module does not have these constants\r\nSO_ORIGINAL_DST = 80\r\nSOL_IPV6 = 41\r\n\r\n\r\ndef original_addr(sock: socket.socket) -> typing.Tuple[str, int]:\r\n    # Even if sock.family is AF_INET6, we can't be sure that we actually\r\n    # need to call getsockopt(SOL_IPV6, SO_ORIGINAL_DST, 28):\r\n    # For some reason we may have to deal with IPv4-mapped IPv6 addresses here,\r\n    # in which case only the IPv4 getsockopt call works.\r\n    # As an additional bonus, we can't just try the IPv4 one and then do IPv6 if that doesn't work,\r\n    # because doing the wrong call apparently crashes the whole Python runtime.\r\n    # As such, we use getsockname() as a heuristic to check if we need to go with IPv4.\r\n    is_ipv4 = \".\" in sock.getsockname()[0]  # either 127.0.0.1 or ::ffff:127.0.0.1\r\n    if is_ipv4:\r\n        # the struct returned here should only have 8 bytes, but invoking with buflen=8 doesn't work.\r\n        dst = sock.getsockopt(socket.SOL_IP, SO_ORIGINAL_DST, 16)\r\n        port, raw_ip = struct.unpack_from(\"!2xH4s\", dst)\r\n        ip = socket.inet_ntop(socket.AF_INET, raw_ip)\r\n    else:\r\n        dst = sock.getsockopt(SOL_IPV6, SO_ORIGINAL_DST, 28)\r\n        port, raw_ip = struct.unpack_from(\"!2xH4x16s\", dst)\r\n        ip = socket.inet_ntop(socket.AF_INET6, raw_ip)\r\n    return ip, port\r\n```\r\n\r\nI'll check this tomorrow with a fresh mind and then add tests and submit a PR. Thanks again for the help debugging, @aniketpanjwani!  ","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/366145212/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":1477274457,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTQ3NzI3NDQ1Nw==","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/1477274457","actor":{"login":"aniketpanjwani","id":16311215,"node_id":"MDQ6VXNlcjE2MzExMjE1","avatar_url":"https://avatars.githubusercontent.com/u/16311215?v=4","gravatar_id":"","url":"https://api.github.com/users/aniketpanjwani","html_url":"https://github.com/aniketpanjwani","followers_url":"https://api.github.com/users/aniketpanjwani/followers","following_url":"https://api.github.com/users/aniketpanjwani/following{/other_user}","gists_url":"https://api.github.com/users/aniketpanjwani/gists{/gist_id}","starred_url":"https://api.github.com/users/aniketpanjwani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aniketpanjwani/subscriptions","organizations_url":"https://api.github.com/users/aniketpanjwani/orgs","repos_url":"https://api.github.com/users/aniketpanjwani/repos","events_url":"https://api.github.com/users/aniketpanjwani/events{/privacy}","received_events_url":"https://api.github.com/users/aniketpanjwani/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2018-02-16T05:06:28Z","performed_via_github_app":null},{"id":1477274458,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDE0NzcyNzQ0NTg=","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/1477274458","actor":{"login":"aniketpanjwani","id":16311215,"node_id":"MDQ6VXNlcjE2MzExMjE1","avatar_url":"https://avatars.githubusercontent.com/u/16311215?v=4","gravatar_id":"","url":"https://api.github.com/users/aniketpanjwani","html_url":"https://github.com/aniketpanjwani","followers_url":"https://api.github.com/users/aniketpanjwani/followers","following_url":"https://api.github.com/users/aniketpanjwani/following{/other_user}","gists_url":"https://api.github.com/users/aniketpanjwani/gists{/gist_id}","starred_url":"https://api.github.com/users/aniketpanjwani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aniketpanjwani/subscriptions","organizations_url":"https://api.github.com/users/aniketpanjwani/orgs","repos_url":"https://api.github.com/users/aniketpanjwani/repos","events_url":"https://api.github.com/users/aniketpanjwani/events{/privacy}","received_events_url":"https://api.github.com/users/aniketpanjwani/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2018-02-16T05:06:28Z","performed_via_github_app":null},{"id":1477887889,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDE0Nzc4ODc4ODk=","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/1477887889","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"feba0e124d5b7915a7e2cf6c670fe43b504b6434","commit_url":"https://api.github.com/repos/mhils/mitmproxy/commits/feba0e124d5b7915a7e2cf6c670fe43b504b6434","created_at":"2018-02-16T13:41:18Z","performed_via_github_app":null},{"actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-16T13:43:27Z","updated_at":"2018-02-16T13:43:27Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2870","repository_url":"https://api.github.com/repos/mitmproxy/mitmproxy","labels_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2870/labels{/name}","comments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2870/comments","events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2870/events","html_url":"https://github.com/mitmproxy/mitmproxy/pull/2870","id":297788933,"node_id":"MDExOlB1bGxSZXF1ZXN0MTY5NjI3MTAy","number":2870,"title":"Linux: support IPv6 destinations in transparent mode","user":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2018-02-16T13:43:27Z","updated_at":"2018-02-16T15:21:10Z","closed_at":"2018-02-16T15:21:08Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":519832,"node_id":"MDEwOlJlcG9zaXRvcnk1MTk4MzI=","name":"mitmproxy","full_name":"mitmproxy/mitmproxy","private":false,"owner":{"login":"mitmproxy","id":4652787,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQ2NTI3ODc=","avatar_url":"https://avatars.githubusercontent.com/u/4652787?v=4","gravatar_id":"","url":"https://api.github.com/users/mitmproxy","html_url":"https://github.com/mitmproxy","followers_url":"https://api.github.com/users/mitmproxy/followers","following_url":"https://api.github.com/users/mitmproxy/following{/other_user}","gists_url":"https://api.github.com/users/mitmproxy/gists{/gist_id}","starred_url":"https://api.github.com/users/mitmproxy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mitmproxy/subscriptions","organizations_url":"https://api.github.com/users/mitmproxy/orgs","repos_url":"https://api.github.com/users/mitmproxy/repos","events_url":"https://api.github.com/users/mitmproxy/events{/privacy}","received_events_url":"https://api.github.com/users/mitmproxy/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/mitmproxy/mitmproxy","description":"An interactive TLS-capable intercepting HTTP proxy for penetration testers and software developers.","fork":false,"url":"https://api.github.com/repos/mitmproxy/mitmproxy","forks_url":"https://api.github.com/repos/mitmproxy/mitmproxy/forks","keys_url":"https://api.github.com/repos/mitmproxy/mitmproxy/keys{/key_id}","collaborators_url":"https://api.github.com/repos/mitmproxy/mitmproxy/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/mitmproxy/mitmproxy/teams","hooks_url":"https://api.github.com/repos/mitmproxy/mitmproxy/hooks","issue_events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events{/number}","events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/events","assignees_url":"https://api.github.com/repos/mitmproxy/mitmproxy/assignees{/user}","branches_url":"https://api.github.com/repos/mitmproxy/mitmproxy/branches{/branch}","tags_url":"https://api.github.com/repos/mitmproxy/mitmproxy/tags","blobs_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/refs{/sha}","trees_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/trees{/sha}","statuses_url":"https://api.github.com/repos/mitmproxy/mitmproxy/statuses/{sha}","languages_url":"https://api.github.com/repos/mitmproxy/mitmproxy/languages","stargazers_url":"https://api.github.com/repos/mitmproxy/mitmproxy/stargazers","contributors_url":"https://api.github.com/repos/mitmproxy/mitmproxy/contributors","subscribers_url":"https://api.github.com/repos/mitmproxy/mitmproxy/subscribers","subscription_url":"https://api.github.com/repos/mitmproxy/mitmproxy/subscription","commits_url":"https://api.github.com/repos/mitmproxy/mitmproxy/commits{/sha}","git_commits_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/commits{/sha}","comments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/comments{/number}","issue_comment_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments{/number}","contents_url":"https://api.github.com/repos/mitmproxy/mitmproxy/contents/{+path}","compare_url":"https://api.github.com/repos/mitmproxy/mitmproxy/compare/{base}...{head}","merges_url":"https://api.github.com/repos/mitmproxy/mitmproxy/merges","archive_url":"https://api.github.com/repos/mitmproxy/mitmproxy/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/mitmproxy/mitmproxy/downloads","issues_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues{/number}","pulls_url":"https://api.github.com/repos/mitmproxy/mitmproxy/pulls{/number}","milestones_url":"https://api.github.com/repos/mitmproxy/mitmproxy/milestones{/number}","notifications_url":"https://api.github.com/repos/mitmproxy/mitmproxy/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/mitmproxy/mitmproxy/labels{/name}","releases_url":"https://api.github.com/repos/mitmproxy/mitmproxy/releases{/id}","deployments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/deployments","created_at":"2010-02-16T04:10:13Z","updated_at":"2025-11-09T17:55:49Z","pushed_at":"2025-11-09T14:36:54Z","git_url":"git://github.com/mitmproxy/mitmproxy.git","ssh_url":"git@github.com:mitmproxy/mitmproxy.git","clone_url":"https://github.com/mitmproxy/mitmproxy.git","svn_url":"https://github.com/mitmproxy/mitmproxy","homepage":"https://mitmproxy.org","size":67124,"stargazers_count":41160,"watchers_count":41160,"language":"Python","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":4359,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":387,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["debugging","http","http2","man-in-the-middle","mitmproxy","proxy","python","security","ssl","tls","websocket"],"visibility":"public","forks":4359,"open_issues":387,"watchers":41160,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/pulls/2870","html_url":"https://github.com/mitmproxy/mitmproxy/pull/2870","diff_url":"https://github.com/mitmproxy/mitmproxy/pull/2870.diff","patch_url":"https://github.com/mitmproxy/mitmproxy/pull/2870.patch","merged_at":"2018-02-16T15:21:08Z"},"body":"This fixes #2869 with the help of @aniketpanjwani.\r\n\r\n@aniketpanjwani: If you find some time could you check if this code works for you? I improved the IPv4 detection heuristic a bit. Pretty sure it should work, but I'm still mostly coding in the dark here as we can't write sensible tests for this.","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2870/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2870/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":1477986846,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDE0Nzc5ODY4NDY=","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/1477986846","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"9e86764ce30641c2b5a417281dfd3e57a60d31d8","commit_url":"https://api.github.com/repos/mhils/mitmproxy/commits/9e86764ce30641c2b5a417281dfd3e57a60d31d8","created_at":"2018-02-16T14:36:38Z","performed_via_github_app":null},{"id":1478075994,"node_id":"MDExOkNsb3NlZEV2ZW50MTQ3ODA3NTk5NA==","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/1478075994","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2018-02-16T15:21:08Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/578440032","html_url":"https://github.com/mitmproxy/mitmproxy/issues/2869#issuecomment-578440032","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2869","id":578440032,"node_id":"MDEyOklzc3VlQ29tbWVudDU3ODQ0MDAzMg==","user":{"login":"hxtk","id":5395707,"node_id":"MDQ6VXNlcjUzOTU3MDc=","avatar_url":"https://avatars.githubusercontent.com/u/5395707?v=4","gravatar_id":"","url":"https://api.github.com/users/hxtk","html_url":"https://github.com/hxtk","followers_url":"https://api.github.com/users/hxtk/followers","following_url":"https://api.github.com/users/hxtk/following{/other_user}","gists_url":"https://api.github.com/users/hxtk/gists{/gist_id}","starred_url":"https://api.github.com/users/hxtk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hxtk/subscriptions","organizations_url":"https://api.github.com/users/hxtk/orgs","repos_url":"https://api.github.com/users/hxtk/repos","events_url":"https://api.github.com/users/hxtk/events{/privacy}","received_events_url":"https://api.github.com/users/hxtk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-01-25T20:24:16Z","updated_at":"2020-01-25T20:28:47Z","body":"I found this issue in a google search when I encountered the same issue trying to listen on an IPv6 address. I first encountered the issue using the version in the `mitmproxy/mitmproxy:5.0.1` docker image, but was able to verify the error still occurs in master as of right now. I can open a separate issue if you believe the problems to be unrelated.\r\n\r\nIn my case, the error occurs immediately when the client tries to connect, e.g., `telnet ::1 8080`. The error does not seem to occur when I `telnet 127.0.0.1 8080`.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/578440032/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"hxtk","id":5395707,"node_id":"MDQ6VXNlcjUzOTU3MDc=","avatar_url":"https://avatars.githubusercontent.com/u/5395707?v=4","gravatar_id":"","url":"https://api.github.com/users/hxtk","html_url":"https://github.com/hxtk","followers_url":"https://api.github.com/users/hxtk/followers","following_url":"https://api.github.com/users/hxtk/following{/other_user}","gists_url":"https://api.github.com/users/hxtk/gists{/gist_id}","starred_url":"https://api.github.com/users/hxtk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hxtk/subscriptions","organizations_url":"https://api.github.com/users/hxtk/orgs","repos_url":"https://api.github.com/users/hxtk/repos","events_url":"https://api.github.com/users/hxtk/events{/privacy}","received_events_url":"https://api.github.com/users/hxtk/received_events","type":"User","user_view_type":"public","site_admin":false}}]