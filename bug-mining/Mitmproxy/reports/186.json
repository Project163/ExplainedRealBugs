{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/1535","repository_url":"https://api.github.com/repos/mitmproxy/mitmproxy","labels_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/1535/labels{/name}","comments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/1535/comments","events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/1535/events","html_url":"https://github.com/mitmproxy/mitmproxy/issues/1535","id":175383584,"node_id":"MDU6SXNzdWUxNzUzODM1ODQ=","number":1535,"title":"Segfault running test suite concurrently on Python 3","user":{"login":"cortesi","id":22544,"node_id":"MDQ6VXNlcjIyNTQ0","avatar_url":"https://avatars.githubusercontent.com/u/22544?v=4","gravatar_id":"","url":"https://api.github.com/users/cortesi","html_url":"https://github.com/cortesi","followers_url":"https://api.github.com/users/cortesi/followers","following_url":"https://api.github.com/users/cortesi/following{/other_user}","gists_url":"https://api.github.com/users/cortesi/gists{/gist_id}","starred_url":"https://api.github.com/users/cortesi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cortesi/subscriptions","organizations_url":"https://api.github.com/users/cortesi/orgs","repos_url":"https://api.github.com/users/cortesi/repos","events_url":"https://api.github.com/users/cortesi/events{/privacy}","received_events_url":"https://api.github.com/users/cortesi/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":79336502,"node_id":"MDU6TGFiZWw3OTMzNjUwMg==","url":"https://api.github.com/repos/mitmproxy/mitmproxy/labels/kind/bug","name":"kind/bug","color":"d93f0b","default":false,"description":null},{"id":429901139,"node_id":"MDU6TGFiZWw0Mjk5MDExMzk=","url":"https://api.github.com/repos/mitmproxy/mitmproxy/labels/area/tests","name":"area/tests","color":"fef2c0","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2016-09-07T00:22:12Z","updated_at":"2016-09-09T22:07:11Z","closed_at":"2016-09-09T22:07:11Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"##### Steps to reproduce the problem:\n1. Set up a Python3.5 venv\n2. py.test -n8 ./test\n##### What is the expected behavior?\n\nNo segfault.\n##### What went wrong?\n\n```\nFatal Python error: Segmentation fault\n\nThread 0x0000700002816000 (most recent call first):\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py\", line 297 in wait\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/queue.py\", line 173 in get\n  File \"/Users/cortesi/mitmproxy/mitmproxy/venv3.5/lib/python3.5/site-packages/watchdog/observers/api.py\", line 360 in dispatch_events\n  File \"/Users/cortesi/mitmproxy/mitmproxy/venv3.5/lib/python3.5/site-packages/watchdog/observers/api.py\", line 199 in run\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py\", line 914 in _bootstrap_inner\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py\", line 882 in _bootstrap\n\nThread 0x0000700001e10000 (most recent call first):\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py\", line 297 in wait\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py\", line 549 in wait\n  File \"/Users/cortesi/mitmproxy/mitmproxy/venv3.5/lib/python3.5/site-packages/watchdog/observers/polling.py\", line 82 in queue_events\n  File \"/Users/cortesi/mitmproxy/mitmproxy/venv3.5/lib/python3.5/site-packages/watchdog/observers/api.py\", line 146 in run\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py\", line 914 in _bootstrap_inner\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py\", line 882 in _bootstrap\n\nThread 0x0000700004125000 (most recent call first):\n  File \"/Users/cortesi/mitmproxy/mitmproxy/venv3.5/lib/python3.5/site-packages/OpenSSL/SSL.py\", line 1301 in recv\n  File \"/Users/cortesi/mitmproxy/mitmproxy/netlib/tcp.py\", line 210 in read\n  File \"/Users/cortesi/mitmproxy/mitmproxy/netlib/tcp.py\", line 250 in readline\n  File \"/Users/cortesi/mitmproxy/mitmproxy/netlib/http/http1/read.py\", line 228 in _get_first_line\n  File \"/Users/cortesi/mitmproxy/mitmproxy/netlib/http/http1/read.py\", line 241 in _read_request_line\n  File \"/Users/cortesi/mitmproxy/mitmproxy/netlib/http/http1/read.py\", line 53 in read_request_head\n  File \"/Users/cortesi/mitmproxy/mitmproxy/netlib/http/http1/read.py\", line 27 in read_request\n  File \"/Users/cortesi/mitmproxy/mitmproxy/pathod/protocols/http.py\", line 47 in read_request\n  File \"/Users/cortesi/mitmproxy/mitmproxy/pathod/pathod.py\", line 131 in handle_http_request\n  File \"/Users/cortesi/mitmproxy/mitmproxy/pathod/pathod.py\", line 284 in handle\n  File \"/Users/cortesi/mitmproxy/mitmproxy/pathod/pathod.py\", line 386 in handle_client_connection\n  File \"/Users/cortesi/mitmproxy/mitmproxy/netlib/tcp.py\", line 907 in connection_thread\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py\", line 862 in run\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py\", line 914 in _bootstrap_inner\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py\", line 882 in _bootstrap\n\nThread 0x0000700003c22000 (most recent call first):\n  File \"/Users/cortesi/mitmproxy/mitmproxy/venv3.5/lib/python3.5/site-packages/OpenSSL/SSL.py\", line 1301 in recv\n  File \"/Users/cortesi/mitmproxy/mitmproxy/netlib/tcp.py\", line 210 in read\n  File \"/Users/cortesi/mitmproxy/mitmproxy/netlib/tcp.py\", line 250 in readline\n  File \"/Users/cortesi/mitmproxy/mitmproxy/netlib/http/http1/read.py\", line 228 in _get_first_line\n  File \"/Users/cortesi/mitmproxy/mitmproxy/netlib/http/http1/read.py\", line 241 in _read_request_line\n  File \"/Users/cortesi/mitmproxy/mitmproxy/netlib/http/http1/read.py\", line 53 in read_request_head\n  File \"/Users/cortesi/mitmproxy/mitmproxy/netlib/http/http1/read.py\", line 27 in read_request\n  File \"/Users/cortesi/mitmproxy/mitmproxy/mitmproxy/protocol/http1.py\", line 16 in read_request\n  File \"/Users/cortesi/mitmproxy/mitmproxy/mitmproxy/protocol/http.py\", line 245 in get_request_from_client\n  File \"/Users/cortesi/mitmproxy/mitmproxy/mitmproxy/protocol/http.py\", line 146 in __call__\n  File \"/Users/cortesi/mitmproxy/mitmproxy/mitmproxy/protocol/http1.py\", line 75 in __call__\n  File \"/Users/cortesi/mitmproxy/mitmproxy/mitmproxy/protocol/tls.py\", line 391 in __call__\n  File \"/Users/cortesi/mitmproxy/mitmproxy/mitmproxy/protocol/http.py\", line 271 in handle_regular_mode_connect\n  File \"/Users/cortesi/mitmproxy/mitmproxy/mitmproxy/protocol/http.py\", line 178 in __call__\n  File \"/Users/cortesi/mitmproxy/mitmproxy/mitmproxy/protocol/http1.py\", line 75 in __call__\n  File \"/Users/cortesi/mitmproxy/mitmproxy/mitmproxy/protocol/tls.py\", line 391 in __call__\n  File \"/Users/cortesi/mitmproxy/mitmproxy/mitmproxy/proxy/modes/http_proxy.py\", line 11 in __call__\n  File \"/Users/cortesi/mitmproxy/mitmproxy/mitmproxy/proxy/server.py\", line 119 in handle\n  File \"/Users/cortesi/mitmproxy/mitmproxy/mitmproxy/proxy/server.py\", line 65 in handle_client_connection\n  File \"/Users/cortesi/mitmproxy/mitmproxy/netlib/tcp.py\", line 907 in connection_thread\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py\", line 862 in run\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py\", line 914 in _bootstrap_inner\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py\", line 882 in _bootstrap\n\nThread 0x000070000371f000 (most recent call first):\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py\", line 297 in wait\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/queue.py\", line 173 in get\n  File \"/Users/cortesi/mitmproxy/mitmproxy/venv3.5/lib/python3.5/site-packages/watchdog/observers/api.py\", line 360 in dispatch_events\n  File \"/Users/cortesi/mitmproxy/mitmproxy/venv3.5/lib/python3.5/site-packages/watchdog/observers/api.py\", line 199 in run\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py\", line 914 in _bootstrap_inner\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py\", line 882 in _bootstrap\n\nThread 0x000070000321c000 (most recent call first):\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py\", line 297 in wait\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py\", line 549 in wait\n  File \"/Users/cortesi/mitmproxy/mitmproxy/venv3.5/lib/python3.5/site-packages/watchdog/observers/polling.py\", line 82 in queue_events\n  File \"/Users/cortesi/mitmproxy/mitmproxy/venv3.5/lib/python3.5/site-packages/watchdog/observers/api.py\", line 146 in run\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py\", line 914 in _bootstrap_inner\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py\", line 882 in _bootstrap\n\nThread 0x000070000190d000 (most recent call first):\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py\", line 297 in wait\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/queue.py\", line 173 in get\n  File \"/Users/cortesi/mitmproxy/mitmproxy/venv3.5/lib/python3.5/site-packages/watchdog/observers/api.py\", line 360 in dispatch_events\n  File \"/Users/cortesi/mitmproxy/mitmproxy/venv3.5/lib/python3.5/site-packages/watchdog/observers/api.py\", line 199 in run\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py\", line 914 in _bootstrap_inner\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py\", line 882 in _bootstrap\n\nThread 0x000070000140a000 (most recent call first):\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py\", line 297 in wait\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py\", line 549 in wait\n  File \"/Users/cortesi/mitmproxy/mitmproxy/venv3.5/lib/python3.5/site-packages/watchdog/observers/polling.py\", line 82 in queue_events\n  File \"/Users/cortesi/mitmproxy/mitmproxy/venv3.5/lib/python3.5/site-packages/watchdog/observers/api.py\", line 146 in run\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py\", line 914 in _bootstrap_inner\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py\", line 882 in _bootstrap\n\nThread 0x0000700000f07000 (most recent call first):\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py\", line 297 in wait\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/queue.py\", line 173 in get\n  File \"/Users/cortesi/mitmproxy/mitmproxy/venv3.5/lib/python3.5/site-packages/watchdog/observers/api.py\", line 360 in dispatch_events\n  File \"/Users/cortesi/mitmproxy/mitmproxy/venv3.5/lib/python3.5/site-packages/watchdog/observers/api.py\", line 199 in run\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py\", line 914 in _bootstrap_inner\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py\", line 882 in _bootstrap\n\nThread 0x0000700000a04000 (most recent call first):\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py\", line 297 in wait\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py\", line 549 in wait\n  File \"/Users/cortesi/mitmproxy/mitmproxy/venv3.5/lib/python3.5/site-packages/watchdog/observers/polling.py\", line 82 in queue_events\n  File \"/Users/cortesi/mitmproxy/mitmproxy/venv3.5/lib/python3.5/site-packages/watchdog/observers/api.py\", line 146 in run\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py\", line 914 in _bootstrap_inner\n  File \"/usr/local/Cellar/python3/3.5.2_1/Frameworks/Python.framework/Versions/3.5/lib/python3.5/threading.py\", line 882 in _bootstrap\n\nCurrent thread 0x00007fff75211000 (most recent call first):\n\n\n```\n##### Any other comments? What have you tried so far?\n\n---\n\nMitmproxy version: 0.18\nPython version: 3.5.2\nPlatform: Darwin-15.6.0-x86_64-i386-64bit\nSSL version: OpenSSL 1.0.2h  3 May 2016\nMac version: 10.11.6 ('', '', '') x86_64\n","closed_by":{"login":"cortesi","id":22544,"node_id":"MDQ6VXNlcjIyNTQ0","avatar_url":"https://avatars.githubusercontent.com/u/22544?v=4","gravatar_id":"","url":"https://api.github.com/users/cortesi","html_url":"https://github.com/cortesi","followers_url":"https://api.github.com/users/cortesi/followers","following_url":"https://api.github.com/users/cortesi/following{/other_user}","gists_url":"https://api.github.com/users/cortesi/gists{/gist_id}","starred_url":"https://api.github.com/users/cortesi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cortesi/subscriptions","organizations_url":"https://api.github.com/users/cortesi/orgs","repos_url":"https://api.github.com/users/cortesi/repos","events_url":"https://api.github.com/users/cortesi/events{/privacy}","received_events_url":"https://api.github.com/users/cortesi/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/1535/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/1535/timeline","performed_via_github_app":null,"state_reason":"completed"}