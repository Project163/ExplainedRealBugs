{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/210","repository_url":"https://api.github.com/repos/mitmproxy/mitmproxy","labels_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/210/labels{/name}","comments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/210/comments","events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/210/events","html_url":"https://github.com/mitmproxy/mitmproxy/issues/210","id":27160870,"node_id":"MDU6SXNzdWUyNzE2MDg3MA==","number":210,"title":"mitmdump -S... raises `AttributeError: 'NoneType' object has no attribute '_assemble'`","user":{"login":"lddubeau","id":1963493,"node_id":"MDQ6VXNlcjE5NjM0OTM=","avatar_url":"https://avatars.githubusercontent.com/u/1963493?v=4","gravatar_id":"","url":"https://api.github.com/users/lddubeau","html_url":"https://github.com/lddubeau","followers_url":"https://api.github.com/users/lddubeau/followers","following_url":"https://api.github.com/users/lddubeau/following{/other_user}","gists_url":"https://api.github.com/users/lddubeau/gists{/gist_id}","starred_url":"https://api.github.com/users/lddubeau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lddubeau/subscriptions","organizations_url":"https://api.github.com/users/lddubeau/orgs","repos_url":"https://api.github.com/users/lddubeau/repos","events_url":"https://api.github.com/users/lddubeau/events{/privacy}","received_events_url":"https://api.github.com/users/lddubeau/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":79336502,"node_id":"MDU6TGFiZWw3OTMzNjUwMg==","url":"https://api.github.com/repos/mitmproxy/mitmproxy/labels/kind/bug","name":"kind/bug","color":"d93f0b","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2014-02-07T18:44:19Z","updated_at":"2014-02-12T14:46:34Z","closed_at":"2014-02-08T04:22:54Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Summary\n\n`mitmdump -S` ... raises `AttributeError: 'NoneType' object has no attribute '_assemble'`\n### Versions\n\nOS: Debian testing (up to date as of 2014-02-07)\n\nmitmproxy: 0.10.0\n### How to Reproduce\n1. Issue:\n   \n   ```\n   $ mitmdump -e -a -F http://www.gnome.org -p 3333 -w test\n   # Switch terminal...\n   $ curl -k -x \"https://localhost:3333\" 'http://www.gnome.org/'\n   $ curl -k -x \"https://localhost:3333\" 'http://www.gnome.org/about/'\n   ```\n   \n   `mitmdump`'s output will look like this:\n   \n   ```\n   127.0.0.1:54820: connect\n   127.0.0.1 GET http://www.gnome.org/\n    << 200 OK 17.64kB\n   127.0.0.1:54820: disconnect\n     -> handled 1 requests\n   127.0.0.1:54824: connect\n   127.0.0.1 GET http://www.gnome.org/about/\n    << 200 OK 15.66kB\n   127.0.0.1:54824: disconnect\n     -> handled 1 requests\n   ```\n2. Kill mitmdump.\n3. Issue:\n   \n   ```\n   $ mitmdump -e -a -F http://www.gnome.org -p 3333 -S test\n   # Switch terminal...\n   $ curl -k -x \"https://localhost:3333\" 'http://www.gnome.org/'\n   $ curl -k -x \"https://localhost:3333\" 'http://www.gnome.org/about/'\n   ```\n   \n   `mitmdump`'s output will look like this:\n   \n   ```\n   127.0.0.1:54832: connect\n   127.0.0.1 GET http://www.gnome.org/\n    << [replay] 200 OK 17.64kB\n   127.0.0.1:54832: disconnect\n     -> handled 1 requests\n   127.0.0.1:54834: connect\n   ----------------------------------------\n   Error in processing of request from 127.0.0.1:54834\n   Traceback (most recent call last):\n     File \"/usr/local/lib/python2.7/dist-packages/netlib/tcp.py\", line 376, in request_thread\n       self.handle_connection(request, client_address)\n     File \"/usr/local/lib/python2.7/dist-packages/libmproxy/proxy.py\", line 545, in handle_connection\n       h.handle()\n     File \"/usr/local/lib/python2.7/dist-packages/libmproxy/proxy.py\", line 192, in handle\n       while self.handle_request(cc) and not cc.close:\n     File \"/usr/local/lib/python2.7/dist-packages/libmproxy/proxy.py\", line 274, in handle_request\n       self.send_response(response)\n     File \"/usr/local/lib/python2.7/dist-packages/libmproxy/proxy.py\", line 493, in send_response\n       d = response._assemble()\n   AttributeError: 'NoneType' object has no attribute '_assemble'\n   \n   ----------------------------------------\n   127.0.0.1 GET http://www.gnome.org/about/\n    << [replay] 200 OK 15.66kB\n   ```\n   \n   `curl`'s output:\n   \n   ```\n   curl: (52) Empty reply from server\n   ```\n### Actual Results\n\n`mitmdump` crashes while serving the second request.\n### Expected Results\n\nNo crash, and the second request served successfully.\n### Observations\n1. At the step of replaying server responses, starting `mitmproxy` with the same parameters as given to `mitmdump` above WORKS!\n2. If `mitmdump` is started with `--no-pop``, it WORKS!\n3. I'm able to reproduce the behavior with versions 0.10.0 and 0.9.2.\n4. I've reproduced this behavior with `api.zotero.org` and `www.eff.org` (which both use SSL). So it is not a problem with `www.gnome.org`\n5. I'm able to reproduce the behavior by connecting to the proxy with Python's `urllib2`, so `curl` is not the problem.\n","closed_by":{"login":"cortesi","id":22544,"node_id":"MDQ6VXNlcjIyNTQ0","avatar_url":"https://avatars.githubusercontent.com/u/22544?v=4","gravatar_id":"","url":"https://api.github.com/users/cortesi","html_url":"https://github.com/cortesi","followers_url":"https://api.github.com/users/cortesi/followers","following_url":"https://api.github.com/users/cortesi/following{/other_user}","gists_url":"https://api.github.com/users/cortesi/gists{/gist_id}","starred_url":"https://api.github.com/users/cortesi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cortesi/subscriptions","organizations_url":"https://api.github.com/users/cortesi/orgs","repos_url":"https://api.github.com/users/cortesi/repos","events_url":"https://api.github.com/users/cortesi/events{/privacy}","received_events_url":"https://api.github.com/users/cortesi/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/210/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/210/timeline","performed_via_github_app":null,"state_reason":"completed"}