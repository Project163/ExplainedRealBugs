{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/5363","repository_url":"https://api.github.com/repos/mitmproxy/mitmproxy","labels_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/5363/labels{/name}","comments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/5363/comments","events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/5363/events","html_url":"https://github.com/mitmproxy/mitmproxy/issues/5363","id":1244295189,"node_id":"I_kwDOAAfumM5KKnAV","number":5363,"title":"'socket.send() raised exception.' on stderr","user":{"login":"EndUser509","id":42170559,"node_id":"MDQ6VXNlcjQyMTcwNTU5","avatar_url":"https://avatars.githubusercontent.com/u/42170559?v=4","gravatar_id":"","url":"https://api.github.com/users/EndUser509","html_url":"https://github.com/EndUser509","followers_url":"https://api.github.com/users/EndUser509/followers","following_url":"https://api.github.com/users/EndUser509/following{/other_user}","gists_url":"https://api.github.com/users/EndUser509/gists{/gist_id}","starred_url":"https://api.github.com/users/EndUser509/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/EndUser509/subscriptions","organizations_url":"https://api.github.com/users/EndUser509/orgs","repos_url":"https://api.github.com/users/EndUser509/repos","events_url":"https://api.github.com/users/EndUser509/events{/privacy}","received_events_url":"https://api.github.com/users/EndUser509/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":466930397,"node_id":"MDU6TGFiZWw0NjY5MzAzOTc=","url":"https://api.github.com/repos/mitmproxy/mitmproxy/labels/kind/triage","name":"kind/triage","color":"006b75","default":false,"description":"Unclassified issues"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2022-05-22T15:54:38Z","updated_at":"2022-09-22T14:47:29Z","closed_at":"2022-09-22T14:47:29Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"#### Problem Description\r\nIn a long-running session of mitmdump that captures traffic of all surfing on an iPad, standard error logs a bunch of\r\n```\r\nsocket.send() raised exception.\r\n```\r\nNothing else is logged. Subjectively every now and then this is logged a browser tab stalls on the iPad. Looking at where the message comes from (`asyncio/*_events.py`) I believe this is the result of a socket already being dead when the HTTP/2 PING is sent periodically. \r\nIt looks to me like asyncio is catching this exception but mitmproxy is not made aware that the server connection is actually dead. Trying to use the dead connection often enough results in this log message:\r\n\r\n```\r\n            if self._conn_lost >= constants.LOG_THRESHOLD_FOR_CONNLOST_WRITES:\r\n                logger.warning('socket.send() raised exception.')\r\n```\r\nI do not see any method to query the status of `self._conn_lost` which would help fixing this.\r\n\r\n#### System Information\r\nMitmproxy: 9.0.0.dev (+151, commit 46f01ad)\r\nPython:    3.9.7\r\nOpenSSL:   OpenSSL 1.1.1n  15 Mar 2022\r\nPlatform:  Linux-4.18.0-383.el8.x86_64-x86_64-with-glibc2.28\r\n","closed_by":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/5363/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/5363/timeline","performed_via_github_app":null,"state_reason":"completed"}