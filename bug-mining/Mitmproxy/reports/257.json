{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2334","repository_url":"https://api.github.com/repos/mitmproxy/mitmproxy","labels_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2334/labels{/name}","comments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2334/comments","events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2334/events","html_url":"https://github.com/mitmproxy/mitmproxy/issues/2334","id":228293338,"node_id":"MDU6SXNzdWUyMjgyOTMzMzg=","number":2334,"title":"Unable to use upstream proxy and proxy authentification","user":{"login":"charlesdhdt","id":12187868,"node_id":"MDQ6VXNlcjEyMTg3ODY4","avatar_url":"https://avatars.githubusercontent.com/u/12187868?v=4","gravatar_id":"","url":"https://api.github.com/users/charlesdhdt","html_url":"https://github.com/charlesdhdt","followers_url":"https://api.github.com/users/charlesdhdt/followers","following_url":"https://api.github.com/users/charlesdhdt/following{/other_user}","gists_url":"https://api.github.com/users/charlesdhdt/gists{/gist_id}","starred_url":"https://api.github.com/users/charlesdhdt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/charlesdhdt/subscriptions","organizations_url":"https://api.github.com/users/charlesdhdt/orgs","repos_url":"https://api.github.com/users/charlesdhdt/repos","events_url":"https://api.github.com/users/charlesdhdt/events{/privacy}","received_events_url":"https://api.github.com/users/charlesdhdt/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":79336502,"node_id":"MDU6TGFiZWw3OTMzNjUwMg==","url":"https://api.github.com/repos/mitmproxy/mitmproxy/labels/kind/bug","name":"kind/bug","color":"d93f0b","default":false,"description":null},{"id":429899720,"node_id":"MDU6TGFiZWw0Mjk4OTk3MjA=","url":"https://api.github.com/repos/mitmproxy/mitmproxy/labels/area/addons","name":"area/addons","color":"fef2c0","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/milestones/19","html_url":"https://github.com/mitmproxy/mitmproxy/milestone/19","labels_url":"https://api.github.com/repos/mitmproxy/mitmproxy/milestones/19/labels","id":2215185,"node_id":"MDk6TWlsZXN0b25lMjIxNTE4NQ==","number":19,"title":"3.0","description":"","creator":{"login":"cortesi","id":22544,"node_id":"MDQ6VXNlcjIyNTQ0","avatar_url":"https://avatars.githubusercontent.com/u/22544?v=4","gravatar_id":"","url":"https://api.github.com/users/cortesi","html_url":"https://github.com/cortesi","followers_url":"https://api.github.com/users/cortesi/followers","following_url":"https://api.github.com/users/cortesi/following{/other_user}","gists_url":"https://api.github.com/users/cortesi/gists{/gist_id}","starred_url":"https://api.github.com/users/cortesi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cortesi/subscriptions","organizations_url":"https://api.github.com/users/cortesi/orgs","repos_url":"https://api.github.com/users/cortesi/repos","events_url":"https://api.github.com/users/cortesi/events{/privacy}","received_events_url":"https://api.github.com/users/cortesi/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":60,"state":"closed","created_at":"2016-12-26T03:49:12Z","updated_at":"2018-03-05T20:25:15Z","due_on":null,"closed_at":"2018-03-05T20:25:15Z"},"comments":3,"created_at":"2017-05-12T13:33:21Z","updated_at":"2017-08-01T21:39:38Z","closed_at":"2017-08-01T21:39:38Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"##### Steps to reproduce the problem:\r\n\r\n1. git clone https://github.com/mitmproxy/mitmproxy.git\r\n2. cd mitmproxy\r\n3. ./dev.sh \r\n4. . venv/bin/activate\r\n5. mitmdump --proxyauth test:test -m upstream:http://10.7.0.225:8080/ --ssl-insecure\r\n\r\nOn 10.7.0.225, I have a VM that runs mitmproxy :\r\n6. mitmdump --insecure\r\n\r\n##### Any other comments? What have you tried so far?\r\nIt seems that each time you have a clientdisconnect/clientconnect, you get a new prompt to login (proxyauth). Basically for each domain you have to login to the proxyauth, here test/test. \r\nI wild guess would be that the information in the header to pass by the upstreamproxy somehow is not compatible with the header auth information \r\n\r\n##### System information\r\nHOST : \r\n```\r\nMitmproxy version: 3.0.0 (2.0.0dev0435-0x1c6b33f) \r\nPython version: 3.6.0\r\nPlatform: Linux-4.9.0-0.bpo.2-amd64-x86_64-with-debian-8.7\r\nSSL version: OpenSSL 1.1.0e  16 Feb 2017\r\nLinux distro: debian 8.7 \r\n```\r\n\r\nVM (10.7.0.225):\r\n```\r\nMitmproxy version : 2.0.0 (release version)\r\nPython version : 3.5.2\r\nPlatform : Linux-4.4.0-75-generic-x86_64-with-Ubuntu-16.04-xenial\r\nSSL version: OpenSSL 1.0.2g 1 Mar 2016\r\nLinux distro: Ubuntu 16.04 xenial\r\n```\r\n","closed_by":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2334/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/2334/timeline","performed_via_github_app":null,"state_reason":"completed"}