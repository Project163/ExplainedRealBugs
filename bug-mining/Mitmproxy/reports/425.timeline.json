[{"id":3797399843,"node_id":"MDEyOkxhYmVsZWRFdmVudDM3OTczOTk4NDM=","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/3797399843","actor":{"login":"iTosun","id":22146339,"node_id":"MDQ6VXNlcjIyMTQ2MzM5","avatar_url":"https://avatars.githubusercontent.com/u/22146339?v=4","gravatar_id":"","url":"https://api.github.com/users/iTosun","html_url":"https://github.com/iTosun","followers_url":"https://api.github.com/users/iTosun/followers","following_url":"https://api.github.com/users/iTosun/following{/other_user}","gists_url":"https://api.github.com/users/iTosun/gists{/gist_id}","starred_url":"https://api.github.com/users/iTosun/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iTosun/subscriptions","organizations_url":"https://api.github.com/users/iTosun/orgs","repos_url":"https://api.github.com/users/iTosun/repos","events_url":"https://api.github.com/users/iTosun/events{/privacy}","received_events_url":"https://api.github.com/users/iTosun/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2020-09-23T10:30:27Z","label":{"name":"kind/feature","color":"207de5"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/795120476","html_url":"https://github.com/mitmproxy/mitmproxy/issues/4207#issuecomment-795120476","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4207","id":795120476,"node_id":"MDEyOklzc3VlQ29tbWVudDc5NTEyMDQ3Ng==","user":{"login":"lionel126","id":3871189,"node_id":"MDQ6VXNlcjM4NzExODk=","avatar_url":"https://avatars.githubusercontent.com/u/3871189?v=4","gravatar_id":"","url":"https://api.github.com/users/lionel126","html_url":"https://github.com/lionel126","followers_url":"https://api.github.com/users/lionel126/followers","following_url":"https://api.github.com/users/lionel126/following{/other_user}","gists_url":"https://api.github.com/users/lionel126/gists{/gist_id}","starred_url":"https://api.github.com/users/lionel126/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lionel126/subscriptions","organizations_url":"https://api.github.com/users/lionel126/orgs","repos_url":"https://api.github.com/users/lionel126/repos","events_url":"https://api.github.com/users/lionel126/events{/privacy}","received_events_url":"https://api.github.com/users/lionel126/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-10T09:06:18Z","updated_at":"2021-03-10T09:06:18Z","body":"extremely look forward to ","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/795120476/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"lionel126","id":3871189,"node_id":"MDQ6VXNlcjM4NzExODk=","avatar_url":"https://avatars.githubusercontent.com/u/3871189?v=4","gravatar_id":"","url":"https://api.github.com/users/lionel126","html_url":"https://github.com/lionel126","followers_url":"https://api.github.com/users/lionel126/followers","following_url":"https://api.github.com/users/lionel126/following{/other_user}","gists_url":"https://api.github.com/users/lionel126/gists{/gist_id}","starred_url":"https://api.github.com/users/lionel126/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lionel126/subscriptions","organizations_url":"https://api.github.com/users/lionel126/orgs","repos_url":"https://api.github.com/users/lionel126/repos","events_url":"https://api.github.com/users/lionel126/events{/privacy}","received_events_url":"https://api.github.com/users/lionel126/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/808830045","html_url":"https://github.com/mitmproxy/mitmproxy/issues/4207#issuecomment-808830045","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4207","id":808830045,"node_id":"MDEyOklzc3VlQ29tbWVudDgwODgzMDA0NQ==","user":{"login":"rachmadaniHaryono","id":6340878,"node_id":"MDQ6VXNlcjYzNDA4Nzg=","avatar_url":"https://avatars.githubusercontent.com/u/6340878?v=4","gravatar_id":"","url":"https://api.github.com/users/rachmadaniHaryono","html_url":"https://github.com/rachmadaniHaryono","followers_url":"https://api.github.com/users/rachmadaniHaryono/followers","following_url":"https://api.github.com/users/rachmadaniHaryono/following{/other_user}","gists_url":"https://api.github.com/users/rachmadaniHaryono/gists{/gist_id}","starred_url":"https://api.github.com/users/rachmadaniHaryono/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rachmadaniHaryono/subscriptions","organizations_url":"https://api.github.com/users/rachmadaniHaryono/orgs","repos_url":"https://api.github.com/users/rachmadaniHaryono/repos","events_url":"https://api.github.com/users/rachmadaniHaryono/events{/privacy}","received_events_url":"https://api.github.com/users/rachmadaniHaryono/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-28T01:42:53Z","updated_at":"2021-03-28T15:18:22Z","body":"```python\r\nimport asyncio\r\nimport os\r\nimport signal\r\n\r\nfrom mitmproxy import ctx\r\nfrom mitmproxy.tools import console, main\r\n\r\n\r\nclass Addons:\r\n\r\n    async def f1(self):\r\n        count = 0\r\n        while True:\r\n            await asyncio.sleep(1)\r\n            count += 1\r\n            ctx.log.info('count: {}'.format(count))\r\n\r\n\r\nopts = main.options.Options()\r\nmaster = console.master.ConsoleMaster(opts)\r\nif hasattr(main, \"proxy\"):\r\n    pconf = main.proxy.config.ProxyConfig(opts)\r\n    master.server = main.proxy.server.ProxyServer(pconf)\r\nloop = asyncio.get_event_loop()\r\n\r\n# addons section\r\nao_obj = Addons()\r\nmaster.addons.add(ao_obj)\r\nloop.create_task(ao_obj.f1())\r\n\r\nloop.add_signal_handler(\r\n    signal.SIGINT, getattr(master, \"prompt_for_exit\", master.shutdown))\r\nloop.add_signal_handler(signal.SIGTERM, master.shutdown)\r\nif os.name == \"nt\":\r\n    async def wakeup():\r\n        while True:\r\n            await asyncio.sleep(0.2)\r\n    asyncio.ensure_future(wakeup())\r\nmaster.run()\r\n```\r\nabove example is based on https://github.com/mitmproxy/mitmproxy/issues/4259 and ~~for mitmproxy v6.0.2~~\r\n\r\ne: add simple edit for 7.0.0.dev\r\ne2: more change based on mitmproxy.tools.main:run\r\ne3: group addons section","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/808830045/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"rachmadaniHaryono","id":6340878,"node_id":"MDQ6VXNlcjYzNDA4Nzg=","avatar_url":"https://avatars.githubusercontent.com/u/6340878?v=4","gravatar_id":"","url":"https://api.github.com/users/rachmadaniHaryono","html_url":"https://github.com/rachmadaniHaryono","followers_url":"https://api.github.com/users/rachmadaniHaryono/followers","following_url":"https://api.github.com/users/rachmadaniHaryono/following{/other_user}","gists_url":"https://api.github.com/users/rachmadaniHaryono/gists{/gist_id}","starred_url":"https://api.github.com/users/rachmadaniHaryono/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rachmadaniHaryono/subscriptions","organizations_url":"https://api.github.com/users/rachmadaniHaryono/orgs","repos_url":"https://api.github.com/users/rachmadaniHaryono/repos","events_url":"https://api.github.com/users/rachmadaniHaryono/events{/privacy}","received_events_url":"https://api.github.com/users/rachmadaniHaryono/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/814550730","html_url":"https://github.com/mitmproxy/mitmproxy/issues/4207#issuecomment-814550730","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4207","id":814550730,"node_id":"MDEyOklzc3VlQ29tbWVudDgxNDU1MDczMA==","user":{"login":"roniemartinez","id":2573537,"node_id":"MDQ6VXNlcjI1NzM1Mzc=","avatar_url":"https://avatars.githubusercontent.com/u/2573537?v=4","gravatar_id":"","url":"https://api.github.com/users/roniemartinez","html_url":"https://github.com/roniemartinez","followers_url":"https://api.github.com/users/roniemartinez/followers","following_url":"https://api.github.com/users/roniemartinez/following{/other_user}","gists_url":"https://api.github.com/users/roniemartinez/gists{/gist_id}","starred_url":"https://api.github.com/users/roniemartinez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roniemartinez/subscriptions","organizations_url":"https://api.github.com/users/roniemartinez/orgs","repos_url":"https://api.github.com/users/roniemartinez/repos","events_url":"https://api.github.com/users/roniemartinez/events{/privacy}","received_events_url":"https://api.github.com/users/roniemartinez/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-07T02:15:24Z","updated_at":"2021-04-07T02:15:24Z","body":"+1","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/814550730/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"roniemartinez","id":2573537,"node_id":"MDQ6VXNlcjI1NzM1Mzc=","avatar_url":"https://avatars.githubusercontent.com/u/2573537?v=4","gravatar_id":"","url":"https://api.github.com/users/roniemartinez","html_url":"https://github.com/roniemartinez","followers_url":"https://api.github.com/users/roniemartinez/followers","following_url":"https://api.github.com/users/roniemartinez/following{/other_user}","gists_url":"https://api.github.com/users/roniemartinez/gists{/gist_id}","starred_url":"https://api.github.com/users/roniemartinez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roniemartinez/subscriptions","organizations_url":"https://api.github.com/users/roniemartinez/orgs","repos_url":"https://api.github.com/users/roniemartinez/repos","events_url":"https://api.github.com/users/roniemartinez/events{/privacy}","received_events_url":"https://api.github.com/users/roniemartinez/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-25T10:11:18Z","updated_at":"2021-05-25T10:11:18Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4609","repository_url":"https://api.github.com/repos/mitmproxy/mitmproxy","labels_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4609/labels{/name}","comments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4609/comments","events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4609/events","html_url":"https://github.com/mitmproxy/mitmproxy/issues/4609","id":900401595,"node_id":"MDU6SXNzdWU5MDA0MDE1OTU=","number":4609,"title":"Async event hooks","user":{"login":"Prinzhorn","id":679144,"node_id":"MDQ6VXNlcjY3OTE0NA==","avatar_url":"https://avatars.githubusercontent.com/u/679144?v=4","gravatar_id":"","url":"https://api.github.com/users/Prinzhorn","html_url":"https://github.com/Prinzhorn","followers_url":"https://api.github.com/users/Prinzhorn/followers","following_url":"https://api.github.com/users/Prinzhorn/following{/other_user}","gists_url":"https://api.github.com/users/Prinzhorn/gists{/gist_id}","starred_url":"https://api.github.com/users/Prinzhorn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Prinzhorn/subscriptions","organizations_url":"https://api.github.com/users/Prinzhorn/orgs","repos_url":"https://api.github.com/users/Prinzhorn/repos","events_url":"https://api.github.com/users/Prinzhorn/events{/privacy}","received_events_url":"https://api.github.com/users/Prinzhorn/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":79336545,"node_id":"MDU6TGFiZWw3OTMzNjU0NQ==","url":"https://api.github.com/repos/mitmproxy/mitmproxy/labels/kind/feature","name":"kind/feature","color":"207de5","default":false,"description":"New features / enhancements"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2021-05-25T07:31:13Z","updated_at":"2021-05-25T10:15:40Z","closed_at":"2021-05-25T10:11:18Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":519832,"node_id":"MDEwOlJlcG9zaXRvcnk1MTk4MzI=","name":"mitmproxy","full_name":"mitmproxy/mitmproxy","private":false,"owner":{"login":"mitmproxy","id":4652787,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQ2NTI3ODc=","avatar_url":"https://avatars.githubusercontent.com/u/4652787?v=4","gravatar_id":"","url":"https://api.github.com/users/mitmproxy","html_url":"https://github.com/mitmproxy","followers_url":"https://api.github.com/users/mitmproxy/followers","following_url":"https://api.github.com/users/mitmproxy/following{/other_user}","gists_url":"https://api.github.com/users/mitmproxy/gists{/gist_id}","starred_url":"https://api.github.com/users/mitmproxy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mitmproxy/subscriptions","organizations_url":"https://api.github.com/users/mitmproxy/orgs","repos_url":"https://api.github.com/users/mitmproxy/repos","events_url":"https://api.github.com/users/mitmproxy/events{/privacy}","received_events_url":"https://api.github.com/users/mitmproxy/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/mitmproxy/mitmproxy","description":"An interactive TLS-capable intercepting HTTP proxy for penetration testers and software developers.","fork":false,"url":"https://api.github.com/repos/mitmproxy/mitmproxy","forks_url":"https://api.github.com/repos/mitmproxy/mitmproxy/forks","keys_url":"https://api.github.com/repos/mitmproxy/mitmproxy/keys{/key_id}","collaborators_url":"https://api.github.com/repos/mitmproxy/mitmproxy/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/mitmproxy/mitmproxy/teams","hooks_url":"https://api.github.com/repos/mitmproxy/mitmproxy/hooks","issue_events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events{/number}","events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/events","assignees_url":"https://api.github.com/repos/mitmproxy/mitmproxy/assignees{/user}","branches_url":"https://api.github.com/repos/mitmproxy/mitmproxy/branches{/branch}","tags_url":"https://api.github.com/repos/mitmproxy/mitmproxy/tags","blobs_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/refs{/sha}","trees_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/trees{/sha}","statuses_url":"https://api.github.com/repos/mitmproxy/mitmproxy/statuses/{sha}","languages_url":"https://api.github.com/repos/mitmproxy/mitmproxy/languages","stargazers_url":"https://api.github.com/repos/mitmproxy/mitmproxy/stargazers","contributors_url":"https://api.github.com/repos/mitmproxy/mitmproxy/contributors","subscribers_url":"https://api.github.com/repos/mitmproxy/mitmproxy/subscribers","subscription_url":"https://api.github.com/repos/mitmproxy/mitmproxy/subscription","commits_url":"https://api.github.com/repos/mitmproxy/mitmproxy/commits{/sha}","git_commits_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/commits{/sha}","comments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/comments{/number}","issue_comment_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments{/number}","contents_url":"https://api.github.com/repos/mitmproxy/mitmproxy/contents/{+path}","compare_url":"https://api.github.com/repos/mitmproxy/mitmproxy/compare/{base}...{head}","merges_url":"https://api.github.com/repos/mitmproxy/mitmproxy/merges","archive_url":"https://api.github.com/repos/mitmproxy/mitmproxy/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/mitmproxy/mitmproxy/downloads","issues_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues{/number}","pulls_url":"https://api.github.com/repos/mitmproxy/mitmproxy/pulls{/number}","milestones_url":"https://api.github.com/repos/mitmproxy/mitmproxy/milestones{/number}","notifications_url":"https://api.github.com/repos/mitmproxy/mitmproxy/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/mitmproxy/mitmproxy/labels{/name}","releases_url":"https://api.github.com/repos/mitmproxy/mitmproxy/releases{/id}","deployments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/deployments","created_at":"2010-02-16T04:10:13Z","updated_at":"2025-11-09T17:55:49Z","pushed_at":"2025-11-09T14:36:54Z","git_url":"git://github.com/mitmproxy/mitmproxy.git","ssh_url":"git@github.com:mitmproxy/mitmproxy.git","clone_url":"https://github.com/mitmproxy/mitmproxy.git","svn_url":"https://github.com/mitmproxy/mitmproxy","homepage":"https://mitmproxy.org","size":67124,"stargazers_count":41160,"watchers_count":41160,"language":"Python","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":4359,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":387,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["debugging","http","http2","man-in-the-middle","mitmproxy","proxy","python","security","ssl","tls","websocket"],"visibility":"public","forks":4359,"open_issues":387,"watchers":41160,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"#### Problem Description\r\n\r\nI don't want hooks to block the entire core but I also don't want race conditions. I'm doing I/O (gRPC) inside my addon hooks and currently this will block the entire proxy until it is finished.\r\n\r\n#### Proposal\r\n\r\nI vaguely remember some discussion in Slack about that. Essentially replacing the `@concurrent` hooks (https://github.com/mitmproxy/mitmproxy/blob/292e3b413cd6cff497e35f151e29c6d786417144/examples/addons/nonblocking.py) with `async` so that it's more reliable and doesn't require a thread for every single hook.\r\n\r\nMaybe the new architecture makes this really easy to implement? To `await` every hook?","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4609/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4609/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/849757272","html_url":"https://github.com/mitmproxy/mitmproxy/issues/4207#issuecomment-849757272","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4207","id":849757272,"node_id":"MDEyOklzc3VlQ29tbWVudDg0OTc1NzI3Mg==","user":{"login":"Prinzhorn","id":679144,"node_id":"MDQ6VXNlcjY3OTE0NA==","avatar_url":"https://avatars.githubusercontent.com/u/679144?v=4","gravatar_id":"","url":"https://api.github.com/users/Prinzhorn","html_url":"https://github.com/Prinzhorn","followers_url":"https://api.github.com/users/Prinzhorn/followers","following_url":"https://api.github.com/users/Prinzhorn/following{/other_user}","gists_url":"https://api.github.com/users/Prinzhorn/gists{/gist_id}","starred_url":"https://api.github.com/users/Prinzhorn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Prinzhorn/subscriptions","organizations_url":"https://api.github.com/users/Prinzhorn/orgs","repos_url":"https://api.github.com/users/Prinzhorn/repos","events_url":"https://api.github.com/users/Prinzhorn/events{/privacy}","received_events_url":"https://api.github.com/users/Prinzhorn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-27T16:06:42Z","updated_at":"2021-05-28T07:37:21Z","body":"One thing I'm concerned about are race conditions. They exist with `@concurrent` and maybe we can get rid of them with async events.\r\n\r\nI just switched to `@concurrent` to see how things are going. I just ran into a race condition where `server_connected` was racing `request`. This crashed my app because of the assumption that the connection exists when the request arrives (a SQL constraint failed).\r\n\r\n`websocket_message` seems to behave as expected, that means multiple messages from different connections are processed concurrently but on the same connection message B will only be processed when message A is done. That's perfect. I'd love to see **connection-wide serialization** in all of mitmproxy. That means the `request` event cannot happen before `server_connected` is done and so on. Is this feasible?\r\n\r\n```py\r\nimport time\r\nfrom mitmproxy.script import concurrent\r\n\r\n@concurrent\r\ndef server_connected(data):\r\n    print('server_connected')\r\n    print('server_connected: sleeping')\r\n    time.sleep(5)\r\n    print('server_connected: done sleeping')\r\n\r\n@concurrent\r\ndef request(flow):\r\n    print('request')\r\n    print('request: sleeping')\r\n    time.sleep(5)\r\n    print('request: done sleeping')\r\n```\r\n\r\n```\r\ncurl --insecure --proxy \"localhost:8080\" https://www.google.com/\r\n```\r\n\r\n\r\n```\r\nserver_connected\r\nserver_connected: sleeping\r\nrequest\r\nrequest: sleeping\r\nserver_connected: done sleeping\r\nrequest: done sleeping\r\n```","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/849757272/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Prinzhorn","id":679144,"node_id":"MDQ6VXNlcjY3OTE0NA==","avatar_url":"https://avatars.githubusercontent.com/u/679144?v=4","gravatar_id":"","url":"https://api.github.com/users/Prinzhorn","html_url":"https://github.com/Prinzhorn","followers_url":"https://api.github.com/users/Prinzhorn/followers","following_url":"https://api.github.com/users/Prinzhorn/following{/other_user}","gists_url":"https://api.github.com/users/Prinzhorn/gists{/gist_id}","starred_url":"https://api.github.com/users/Prinzhorn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Prinzhorn/subscriptions","organizations_url":"https://api.github.com/users/Prinzhorn/orgs","repos_url":"https://api.github.com/users/Prinzhorn/repos","events_url":"https://api.github.com/users/Prinzhorn/events{/privacy}","received_events_url":"https://api.github.com/users/Prinzhorn/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-17T08:40:01Z","updated_at":"2021-06-17T08:40:01Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4638","repository_url":"https://api.github.com/repos/mitmproxy/mitmproxy","labels_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4638/labels{/name}","comments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4638/comments","events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4638/events","html_url":"https://github.com/mitmproxy/mitmproxy/issues/4638","id":922331646,"node_id":"MDU6SXNzdWU5MjIzMzE2NDY=","number":4638,"title":"mitmproxy.exceptions.ControlException: Reply is taken, but expected it to be start.","user":{"login":"anylayer","id":46556817,"node_id":"MDQ6VXNlcjQ2NTU2ODE3","avatar_url":"https://avatars.githubusercontent.com/u/46556817?v=4","gravatar_id":"","url":"https://api.github.com/users/anylayer","html_url":"https://github.com/anylayer","followers_url":"https://api.github.com/users/anylayer/followers","following_url":"https://api.github.com/users/anylayer/following{/other_user}","gists_url":"https://api.github.com/users/anylayer/gists{/gist_id}","starred_url":"https://api.github.com/users/anylayer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/anylayer/subscriptions","organizations_url":"https://api.github.com/users/anylayer/orgs","repos_url":"https://api.github.com/users/anylayer/repos","events_url":"https://api.github.com/users/anylayer/events{/privacy}","received_events_url":"https://api.github.com/users/anylayer/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":466930397,"node_id":"MDU6TGFiZWw0NjY5MzAzOTc=","url":"https://api.github.com/repos/mitmproxy/mitmproxy/labels/kind/triage","name":"kind/triage","color":"006b75","default":false,"description":"Unclassified issues"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2021-06-16T08:49:50Z","updated_at":"2021-06-22T14:27:40Z","closed_at":"2021-06-22T14:27:39Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":519832,"node_id":"MDEwOlJlcG9zaXRvcnk1MTk4MzI=","name":"mitmproxy","full_name":"mitmproxy/mitmproxy","private":false,"owner":{"login":"mitmproxy","id":4652787,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQ2NTI3ODc=","avatar_url":"https://avatars.githubusercontent.com/u/4652787?v=4","gravatar_id":"","url":"https://api.github.com/users/mitmproxy","html_url":"https://github.com/mitmproxy","followers_url":"https://api.github.com/users/mitmproxy/followers","following_url":"https://api.github.com/users/mitmproxy/following{/other_user}","gists_url":"https://api.github.com/users/mitmproxy/gists{/gist_id}","starred_url":"https://api.github.com/users/mitmproxy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mitmproxy/subscriptions","organizations_url":"https://api.github.com/users/mitmproxy/orgs","repos_url":"https://api.github.com/users/mitmproxy/repos","events_url":"https://api.github.com/users/mitmproxy/events{/privacy}","received_events_url":"https://api.github.com/users/mitmproxy/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/mitmproxy/mitmproxy","description":"An interactive TLS-capable intercepting HTTP proxy for penetration testers and software developers.","fork":false,"url":"https://api.github.com/repos/mitmproxy/mitmproxy","forks_url":"https://api.github.com/repos/mitmproxy/mitmproxy/forks","keys_url":"https://api.github.com/repos/mitmproxy/mitmproxy/keys{/key_id}","collaborators_url":"https://api.github.com/repos/mitmproxy/mitmproxy/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/mitmproxy/mitmproxy/teams","hooks_url":"https://api.github.com/repos/mitmproxy/mitmproxy/hooks","issue_events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events{/number}","events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/events","assignees_url":"https://api.github.com/repos/mitmproxy/mitmproxy/assignees{/user}","branches_url":"https://api.github.com/repos/mitmproxy/mitmproxy/branches{/branch}","tags_url":"https://api.github.com/repos/mitmproxy/mitmproxy/tags","blobs_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/refs{/sha}","trees_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/trees{/sha}","statuses_url":"https://api.github.com/repos/mitmproxy/mitmproxy/statuses/{sha}","languages_url":"https://api.github.com/repos/mitmproxy/mitmproxy/languages","stargazers_url":"https://api.github.com/repos/mitmproxy/mitmproxy/stargazers","contributors_url":"https://api.github.com/repos/mitmproxy/mitmproxy/contributors","subscribers_url":"https://api.github.com/repos/mitmproxy/mitmproxy/subscribers","subscription_url":"https://api.github.com/repos/mitmproxy/mitmproxy/subscription","commits_url":"https://api.github.com/repos/mitmproxy/mitmproxy/commits{/sha}","git_commits_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/commits{/sha}","comments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/comments{/number}","issue_comment_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments{/number}","contents_url":"https://api.github.com/repos/mitmproxy/mitmproxy/contents/{+path}","compare_url":"https://api.github.com/repos/mitmproxy/mitmproxy/compare/{base}...{head}","merges_url":"https://api.github.com/repos/mitmproxy/mitmproxy/merges","archive_url":"https://api.github.com/repos/mitmproxy/mitmproxy/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/mitmproxy/mitmproxy/downloads","issues_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues{/number}","pulls_url":"https://api.github.com/repos/mitmproxy/mitmproxy/pulls{/number}","milestones_url":"https://api.github.com/repos/mitmproxy/mitmproxy/milestones{/number}","notifications_url":"https://api.github.com/repos/mitmproxy/mitmproxy/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/mitmproxy/mitmproxy/labels{/name}","releases_url":"https://api.github.com/repos/mitmproxy/mitmproxy/releases{/id}","deployments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/deployments","created_at":"2010-02-16T04:10:13Z","updated_at":"2025-11-09T17:55:49Z","pushed_at":"2025-11-09T14:36:54Z","git_url":"git://github.com/mitmproxy/mitmproxy.git","ssh_url":"git@github.com:mitmproxy/mitmproxy.git","clone_url":"https://github.com/mitmproxy/mitmproxy.git","svn_url":"https://github.com/mitmproxy/mitmproxy","homepage":"https://mitmproxy.org","size":67124,"stargazers_count":41160,"watchers_count":41160,"language":"Python","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":4359,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":387,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["debugging","http","http2","man-in-the-middle","mitmproxy","proxy","python","security","ssl","tls","websocket"],"visibility":"public","forks":4359,"open_issues":387,"watchers":41160,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"#### Problem Description\r\nError occurs when addons contains multiple scripts and @ concurrent is used to decorate response or request, it will not appear when addons has only one script\r\n![image](https://user-images.githubusercontent.com/46556817/122187716-e0c5c700-cec1-11eb-8662-76b255683da0.png)\r\n![image](https://user-images.githubusercontent.com/46556817/122187610-c4c22580-cec1-11eb-8588-da6eb1016ccd.png)\r\n\r\n\r\n#### Steps to reproduce the behavior:\r\n1. use @concurrent\r\n2. addons contains multiple scripts\r\n#### System Information\r\nPaste the output of \"mitmproxy --version\" here.\r\nMitmproxy: 6.0.2\r\nPython:    3.9.2\r\nOpenSSL:   OpenSSL 1.1.1i  8 Dec 2020\r\nPlatform:  Windows-10-10.0.19041-SP0","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4638/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4638/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-08-27T07:41:02Z","updated_at":"2021-08-27T07:41:02Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4781","repository_url":"https://api.github.com/repos/mitmproxy/mitmproxy","labels_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4781/labels{/name}","comments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4781/comments","events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4781/events","html_url":"https://github.com/mitmproxy/mitmproxy/issues/4781","id":979926169,"node_id":"MDU6SXNzdWU5Nzk5MjYxNjk=","number":4781,"title":"An exception occurs when call flow.copy() in version 7","user":{"login":"FeeiCN","id":1611552,"node_id":"MDQ6VXNlcjE2MTE1NTI=","avatar_url":"https://avatars.githubusercontent.com/u/1611552?v=4","gravatar_id":"","url":"https://api.github.com/users/FeeiCN","html_url":"https://github.com/FeeiCN","followers_url":"https://api.github.com/users/FeeiCN/followers","following_url":"https://api.github.com/users/FeeiCN/following{/other_user}","gists_url":"https://api.github.com/users/FeeiCN/gists{/gist_id}","starred_url":"https://api.github.com/users/FeeiCN/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/FeeiCN/subscriptions","organizations_url":"https://api.github.com/users/FeeiCN/orgs","repos_url":"https://api.github.com/users/FeeiCN/repos","events_url":"https://api.github.com/users/FeeiCN/events{/privacy}","received_events_url":"https://api.github.com/users/FeeiCN/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":79336502,"node_id":"MDU6TGFiZWw3OTMzNjUwMg==","url":"https://api.github.com/repos/mitmproxy/mitmproxy/labels/kind/bug","name":"kind/bug","color":"d93f0b","default":false,"description":null},{"id":174959532,"node_id":"MDU6TGFiZWwxNzQ5NTk1MzI=","url":"https://api.github.com/repos/mitmproxy/mitmproxy/labels/help%20wanted","name":"help wanted","color":"fbca04","default":true,"description":null},{"id":429899749,"node_id":"MDU6TGFiZWw0Mjk4OTk3NDk=","url":"https://api.github.com/repos/mitmproxy/mitmproxy/labels/area/core","name":"area/core","color":"fef2c0","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2021-08-26T07:27:42Z","updated_at":"2022-03-19T16:58:30Z","closed_at":"2022-03-19T16:58:29Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":519832,"node_id":"MDEwOlJlcG9zaXRvcnk1MTk4MzI=","name":"mitmproxy","full_name":"mitmproxy/mitmproxy","private":false,"owner":{"login":"mitmproxy","id":4652787,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQ2NTI3ODc=","avatar_url":"https://avatars.githubusercontent.com/u/4652787?v=4","gravatar_id":"","url":"https://api.github.com/users/mitmproxy","html_url":"https://github.com/mitmproxy","followers_url":"https://api.github.com/users/mitmproxy/followers","following_url":"https://api.github.com/users/mitmproxy/following{/other_user}","gists_url":"https://api.github.com/users/mitmproxy/gists{/gist_id}","starred_url":"https://api.github.com/users/mitmproxy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mitmproxy/subscriptions","organizations_url":"https://api.github.com/users/mitmproxy/orgs","repos_url":"https://api.github.com/users/mitmproxy/repos","events_url":"https://api.github.com/users/mitmproxy/events{/privacy}","received_events_url":"https://api.github.com/users/mitmproxy/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/mitmproxy/mitmproxy","description":"An interactive TLS-capable intercepting HTTP proxy for penetration testers and software developers.","fork":false,"url":"https://api.github.com/repos/mitmproxy/mitmproxy","forks_url":"https://api.github.com/repos/mitmproxy/mitmproxy/forks","keys_url":"https://api.github.com/repos/mitmproxy/mitmproxy/keys{/key_id}","collaborators_url":"https://api.github.com/repos/mitmproxy/mitmproxy/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/mitmproxy/mitmproxy/teams","hooks_url":"https://api.github.com/repos/mitmproxy/mitmproxy/hooks","issue_events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events{/number}","events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/events","assignees_url":"https://api.github.com/repos/mitmproxy/mitmproxy/assignees{/user}","branches_url":"https://api.github.com/repos/mitmproxy/mitmproxy/branches{/branch}","tags_url":"https://api.github.com/repos/mitmproxy/mitmproxy/tags","blobs_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/refs{/sha}","trees_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/trees{/sha}","statuses_url":"https://api.github.com/repos/mitmproxy/mitmproxy/statuses/{sha}","languages_url":"https://api.github.com/repos/mitmproxy/mitmproxy/languages","stargazers_url":"https://api.github.com/repos/mitmproxy/mitmproxy/stargazers","contributors_url":"https://api.github.com/repos/mitmproxy/mitmproxy/contributors","subscribers_url":"https://api.github.com/repos/mitmproxy/mitmproxy/subscribers","subscription_url":"https://api.github.com/repos/mitmproxy/mitmproxy/subscription","commits_url":"https://api.github.com/repos/mitmproxy/mitmproxy/commits{/sha}","git_commits_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/commits{/sha}","comments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/comments{/number}","issue_comment_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments{/number}","contents_url":"https://api.github.com/repos/mitmproxy/mitmproxy/contents/{+path}","compare_url":"https://api.github.com/repos/mitmproxy/mitmproxy/compare/{base}...{head}","merges_url":"https://api.github.com/repos/mitmproxy/mitmproxy/merges","archive_url":"https://api.github.com/repos/mitmproxy/mitmproxy/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/mitmproxy/mitmproxy/downloads","issues_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues{/number}","pulls_url":"https://api.github.com/repos/mitmproxy/mitmproxy/pulls{/number}","milestones_url":"https://api.github.com/repos/mitmproxy/mitmproxy/milestones{/number}","notifications_url":"https://api.github.com/repos/mitmproxy/mitmproxy/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/mitmproxy/mitmproxy/labels{/name}","releases_url":"https://api.github.com/repos/mitmproxy/mitmproxy/releases{/id}","deployments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/deployments","created_at":"2010-02-16T04:10:13Z","updated_at":"2025-11-09T17:55:49Z","pushed_at":"2025-11-09T14:36:54Z","git_url":"git://github.com/mitmproxy/mitmproxy.git","ssh_url":"git@github.com:mitmproxy/mitmproxy.git","clone_url":"https://github.com/mitmproxy/mitmproxy.git","svn_url":"https://github.com/mitmproxy/mitmproxy","homepage":"https://mitmproxy.org","size":67124,"stargazers_count":41160,"watchers_count":41160,"language":"Python","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":4359,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":387,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["debugging","http","http2","man-in-the-middle","mitmproxy","proxy","python","security","ssl","tls","websocket"],"visibility":"public","forks":4359,"open_issues":387,"watchers":41160,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"#### Problem Description\r\nAn exception occurs when call flow.copy() in version 7\r\n\r\n#### Steps to reproduce the behavior:\r\n1. add a custom script, and run `mitmdump -s=bac.py`\r\nin bac.py, flow.copy() in response function, then ctx.master.commands.call(\"replay.client\", [flow_copy])\r\n```python\r\n@concurrent\r\n    def response(self, flow: http.HTTPFlow) -> None:\r\n        print(f'< [RESP] {flow.request.method} {flow.request.url}')\r\n\r\n        resp = flow.response.get_text(strict=False)\r\n\r\n        # 此次响应是否为重放探测，是则检测响应内容判定越权，不是则发起重放探测请求\r\n        if hasattr(flow.request, 'is_replay_detect') and flow.request.is_replay_detect:\r\n            # print('   > 漏洞检测请求不做修改，跳过')\r\n            return\r\n        else:\r\n            # GET方式的Query部分，测试用例：漏洞管理平台、GitHub Avatar\r\n            print(f'   > GET Query探测，共{len(flow.request.query)}个参数')\r\n            for i, key in enumerate(dict(flow.request.query)):\r\n                value = flow.request.query[key]\r\n                print(f'      > [{i + 1}] {key} = {value}')\r\n                if re.match(self.regex_number, value):  # 如果Value为纯数字\r\n                    # 白名单情况-timestamp，长度为10位（秒）或者13位（毫秒）且首位为1(如果是2则会增加20年左右)数字，例如1624001999117(ms) 1624002166(s)\r\n                    if len(value) in [10, 13] and value[:1] == '1':\r\n                        print(f'         > 此参数为时间戳，跳过检测')\r\n                        return\r\n                    print(f'         > 参数{key}的值{value}，可能存在越权漏洞')\r\n                    uniq_mark = self.uniq_mark(flow, key)\r\n                    if uniq_mark not in self.processed_requests:\r\n                        print(\r\n                            f'         > 历史上并未探测过，{uniq_mark} processed_requests_len: {len(self.processed_requests)}')\r\n                        replay_flows = []\r\n                        payloads = self.payloads_number(value)\r\n                        for payload in payloads:\r\n                            flow_copy = flow.copy()\r\n                            flow_copy.request.query[key] = payload\r\n                            print(f'            > 值{value}更改为{payload}，发起探测请求 {flow_copy.request.url}')\r\n                            flow_copy.request.is_replay_detect = True\r\n                            ctx.master.commands.call(\"replay.client\", [flow_copy])\r\n```\r\n2. `https_proxy=http://127.0.0.1:8080 curl --cacert ~/.mitmproxy/mitmproxy-ca-cert.pem https://feei.cn/a.php\\?a\\=123`\r\n3. exception detail\r\n```Traceback (most recent call last):\r\n  File \"bac.py\", line 198, in response\r\n    flow_copy = flow.copy()\r\n  File \"mitmproxy/http.py\", line 1244, in copy\r\n  File \"mitmproxy/flow.py\", line 166, in copy\r\n  File \"mitmproxy/controller.py\", line 78, in __init__\r\n  File \"mitmproxy/controller.py\", line 16, in __init__\r\n  File \"asyncio/locks.py\", line 177, in __init__\r\n  File \"asyncio/events.py\", line 642, in get_event_loop\r\nRuntimeError: There is no current event loop in thread 'ScriptThread'.```\r\n```\r\n➜  bac git:(main) ✗ mitmproxy --version\r\nMitmproxy: 7.0.2\r\nPython:    3.9.5\r\nOpenSSL:   OpenSSL 1.1.1l  24 Aug 2021\r\nPlatform:  macOS-11.5-x86_64-i386-64bit\r\n\r\n➜  bac git:(main) ✗ pip3 show mitmproxy\r\nName: mitmproxy\r\nVersion: 7.0.2\r\nSummary: An interactive, SSL/TLS-capable intercepting proxy for HTTP/1, HTTP/2, and WebSockets.\r\nHome-page: http://mitmproxy.org\r\nAuthor: Aldo Cortesi\r\nAuthor-email: aldo@corte.si\r\nLicense: MIT\r\nLocation: /usr/local/lib/python3.9/site-packages\r\nRequires: h11, msgpack, asgiref, Brotli, zstandard, cryptography, protobuf, ruamel.yaml, ldap3, click, pyOpenSSL, hyperframe, blinker, pyparsing, publicsuffix2, tornado, kaitaistruct, sortedcontainers, certifi, pyperclip, urwid, wsproto, passlib, flask, h2\r\nRequired-by:\r\n```\r\n","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4781/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4781/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/906999315","html_url":"https://github.com/mitmproxy/mitmproxy/issues/4207#issuecomment-906999315","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4207","id":906999315,"node_id":"IC_kwDOAAfumM42D7YT","user":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-08-27T07:44:44Z","updated_at":"2021-08-27T07:44:44Z","body":"> I'd love to see connection-wide serialization in all of mitmproxy. That means the request event cannot happen before server_connected is done and so on. Is this feasible?\r\n\r\nYes and no. The good news for you is that most events are already serialized, e.g. the respective part in the proxy core is blocking until it a specific hook completes. That won't change, i.e. you'll never see `request` appear before `requestheaders` has completed.\r\n\r\nThe order of `request` and `server_connected` is not deterministic. If a request reuses an existing connection, `server_connected` obviously comes before `request`. If you set `connection_strategy` to `lazy`, `request` should happen even before `server_connect`. So no guarantees here. :)","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/906999315/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/907000437","html_url":"https://github.com/mitmproxy/mitmproxy/issues/4207#issuecomment-907000437","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4207","id":907000437,"node_id":"IC_kwDOAAfumM42D7p1","user":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-08-27T07:46:39Z","updated_at":"2021-08-27T07:46:39Z","body":"Regarding the actual suggestion: this is something we definitely plan to implement at some point, we can probably/hopefully use this to ditch `.reply` entirely. Let's see.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/907000437/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/907007982","html_url":"https://github.com/mitmproxy/mitmproxy/issues/4207#issuecomment-907007982","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4207","id":907007982,"node_id":"IC_kwDOAAfumM42D9fu","user":{"login":"Prinzhorn","id":679144,"node_id":"MDQ6VXNlcjY3OTE0NA==","avatar_url":"https://avatars.githubusercontent.com/u/679144?v=4","gravatar_id":"","url":"https://api.github.com/users/Prinzhorn","html_url":"https://github.com/Prinzhorn","followers_url":"https://api.github.com/users/Prinzhorn/followers","following_url":"https://api.github.com/users/Prinzhorn/following{/other_user}","gists_url":"https://api.github.com/users/Prinzhorn/gists{/gist_id}","starred_url":"https://api.github.com/users/Prinzhorn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Prinzhorn/subscriptions","organizations_url":"https://api.github.com/users/Prinzhorn/orgs","repos_url":"https://api.github.com/users/Prinzhorn/repos","events_url":"https://api.github.com/users/Prinzhorn/events{/privacy}","received_events_url":"https://api.github.com/users/Prinzhorn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-08-27T07:59:59Z","updated_at":"2021-08-27T08:03:18Z","body":"> If you set `connection_strategy` to `lazy`, `request` should happen even before `server_connect`.\r\n\r\nThat makes sense but I am explicitly using `lazy`. I've looked at my exception from back then again and my example above is not accurate. What failed was my `NOT NULL` constraint for `responses.server_connection_id` (_not_ request, which I associate with `requests.client_connection_id`). That happened only with `@concurrent` and only rarely. Never without `@concurrent`. So `request` was processed by me _after_ `server_connected` because the long running gRPC call in `server_connected` did not prevent `request` from firing and somehow `request` arrived earlier on the other end (I have a talent for race conditions).\r\n\r\nBut if I understand correctly async hooks solve this because it would \"block\" in a similar fashion that the current synchronous hooks do. But without blocking unrelated events (e.g. other connections). And since I'm now using asyncio gRPC it should just work and perform better.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/907007982/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Prinzhorn","id":679144,"node_id":"MDQ6VXNlcjY3OTE0NA==","avatar_url":"https://avatars.githubusercontent.com/u/679144?v=4","gravatar_id":"","url":"https://api.github.com/users/Prinzhorn","html_url":"https://github.com/Prinzhorn","followers_url":"https://api.github.com/users/Prinzhorn/followers","following_url":"https://api.github.com/users/Prinzhorn/following{/other_user}","gists_url":"https://api.github.com/users/Prinzhorn/gists{/gist_id}","starred_url":"https://api.github.com/users/Prinzhorn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Prinzhorn/subscriptions","organizations_url":"https://api.github.com/users/Prinzhorn/orgs","repos_url":"https://api.github.com/users/Prinzhorn/repos","events_url":"https://api.github.com/users/Prinzhorn/events{/privacy}","received_events_url":"https://api.github.com/users/Prinzhorn/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/907014592","html_url":"https://github.com/mitmproxy/mitmproxy/issues/4207#issuecomment-907014592","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4207","id":907014592,"node_id":"IC_kwDOAAfumM42D_HA","user":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-08-27T08:10:34Z","updated_at":"2021-08-27T08:10:34Z","body":"> But if I understand correctly async hooks solve this because it would \"block\" in a similar fashion that the current synchronous hooks do. But without blocking unrelated events (e.g. other connections). And since I'm now using asyncio gRPC it should just work and perform better.\r\n\r\nAh, you are hitting a special case here: We are not waiting for `server_connected` to complete before notifying the HTTP layer that the connection has been established (I didn't think this would be useful to anyone and it surely isn't faster). If you have a concrete use case here please open a separate issue, this should be straightforward to adjust. In fact at the moment it's a bit more complicated _because_  we don't block.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/907014592/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"Prinzhorn","id":679144,"node_id":"MDQ6VXNlcjY3OTE0NA==","avatar_url":"https://avatars.githubusercontent.com/u/679144?v=4","gravatar_id":"","url":"https://api.github.com/users/Prinzhorn","html_url":"https://github.com/Prinzhorn","followers_url":"https://api.github.com/users/Prinzhorn/followers","following_url":"https://api.github.com/users/Prinzhorn/following{/other_user}","gists_url":"https://api.github.com/users/Prinzhorn/gists{/gist_id}","starred_url":"https://api.github.com/users/Prinzhorn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Prinzhorn/subscriptions","organizations_url":"https://api.github.com/users/Prinzhorn/orgs","repos_url":"https://api.github.com/users/Prinzhorn/repos","events_url":"https://api.github.com/users/Prinzhorn/events{/privacy}","received_events_url":"https://api.github.com/users/Prinzhorn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-14T17:54:56Z","updated_at":"2022-01-14T17:54:56Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/5048","repository_url":"https://api.github.com/repos/mitmproxy/mitmproxy","labels_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/5048/labels{/name}","comments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/5048/comments","events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/5048/events","html_url":"https://github.com/mitmproxy/mitmproxy/issues/5048","id":1098950777,"node_id":"I_kwDOAAfumM5BgKh5","number":5048,"title":"Google Summer of Code 2022","user":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":911560442,"node_id":"MDU6TGFiZWw5MTE1NjA0NDI=","url":"https://api.github.com/repos/mitmproxy/mitmproxy/labels/gsoc","name":"gsoc","color":"5319e7","default":false,"description":"Google Summer of Code"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2022-01-11T10:14:27Z","updated_at":"2023-01-05T14:33:40Z","closed_at":"2023-01-05T14:33:40Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":519832,"node_id":"MDEwOlJlcG9zaXRvcnk1MTk4MzI=","name":"mitmproxy","full_name":"mitmproxy/mitmproxy","private":false,"owner":{"login":"mitmproxy","id":4652787,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQ2NTI3ODc=","avatar_url":"https://avatars.githubusercontent.com/u/4652787?v=4","gravatar_id":"","url":"https://api.github.com/users/mitmproxy","html_url":"https://github.com/mitmproxy","followers_url":"https://api.github.com/users/mitmproxy/followers","following_url":"https://api.github.com/users/mitmproxy/following{/other_user}","gists_url":"https://api.github.com/users/mitmproxy/gists{/gist_id}","starred_url":"https://api.github.com/users/mitmproxy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mitmproxy/subscriptions","organizations_url":"https://api.github.com/users/mitmproxy/orgs","repos_url":"https://api.github.com/users/mitmproxy/repos","events_url":"https://api.github.com/users/mitmproxy/events{/privacy}","received_events_url":"https://api.github.com/users/mitmproxy/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/mitmproxy/mitmproxy","description":"An interactive TLS-capable intercepting HTTP proxy for penetration testers and software developers.","fork":false,"url":"https://api.github.com/repos/mitmproxy/mitmproxy","forks_url":"https://api.github.com/repos/mitmproxy/mitmproxy/forks","keys_url":"https://api.github.com/repos/mitmproxy/mitmproxy/keys{/key_id}","collaborators_url":"https://api.github.com/repos/mitmproxy/mitmproxy/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/mitmproxy/mitmproxy/teams","hooks_url":"https://api.github.com/repos/mitmproxy/mitmproxy/hooks","issue_events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events{/number}","events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/events","assignees_url":"https://api.github.com/repos/mitmproxy/mitmproxy/assignees{/user}","branches_url":"https://api.github.com/repos/mitmproxy/mitmproxy/branches{/branch}","tags_url":"https://api.github.com/repos/mitmproxy/mitmproxy/tags","blobs_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/refs{/sha}","trees_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/trees{/sha}","statuses_url":"https://api.github.com/repos/mitmproxy/mitmproxy/statuses/{sha}","languages_url":"https://api.github.com/repos/mitmproxy/mitmproxy/languages","stargazers_url":"https://api.github.com/repos/mitmproxy/mitmproxy/stargazers","contributors_url":"https://api.github.com/repos/mitmproxy/mitmproxy/contributors","subscribers_url":"https://api.github.com/repos/mitmproxy/mitmproxy/subscribers","subscription_url":"https://api.github.com/repos/mitmproxy/mitmproxy/subscription","commits_url":"https://api.github.com/repos/mitmproxy/mitmproxy/commits{/sha}","git_commits_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/commits{/sha}","comments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/comments{/number}","issue_comment_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments{/number}","contents_url":"https://api.github.com/repos/mitmproxy/mitmproxy/contents/{+path}","compare_url":"https://api.github.com/repos/mitmproxy/mitmproxy/compare/{base}...{head}","merges_url":"https://api.github.com/repos/mitmproxy/mitmproxy/merges","archive_url":"https://api.github.com/repos/mitmproxy/mitmproxy/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/mitmproxy/mitmproxy/downloads","issues_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues{/number}","pulls_url":"https://api.github.com/repos/mitmproxy/mitmproxy/pulls{/number}","milestones_url":"https://api.github.com/repos/mitmproxy/mitmproxy/milestones{/number}","notifications_url":"https://api.github.com/repos/mitmproxy/mitmproxy/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/mitmproxy/mitmproxy/labels{/name}","releases_url":"https://api.github.com/repos/mitmproxy/mitmproxy/releases{/id}","deployments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/deployments","created_at":"2010-02-16T04:10:13Z","updated_at":"2025-11-09T17:55:49Z","pushed_at":"2025-11-09T14:36:54Z","git_url":"git://github.com/mitmproxy/mitmproxy.git","ssh_url":"git@github.com:mitmproxy/mitmproxy.git","clone_url":"https://github.com/mitmproxy/mitmproxy.git","svn_url":"https://github.com/mitmproxy/mitmproxy","homepage":"https://mitmproxy.org","size":67124,"stargazers_count":41160,"watchers_count":41160,"language":"Python","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":4359,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":387,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["debugging","http","http2","man-in-the-middle","mitmproxy","proxy","python","security","ssl","tls","websocket"],"visibility":"public","forks":4359,"open_issues":387,"watchers":41160,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"[![gsoc](https://cloud.githubusercontent.com/assets/1019198/22106433/058d5a26-de49-11e6-893e-6a5ff97ffe78.png)](https://summerofcode.withgoogle.com/)\r\n<p  align=\"center\">\r\n<a href=\"https://honeynet.org\">&nbsp;<img height=80 src=\"https://austria2019.honeynet.org/images/logo-text.png\"></a>\r\n</p>\r\n\r\nMitmproxy is participating under the umbrella of the [Honeynet project](https://www.honeynet.org/) in the [Google Summer of Code 2022](https://summerofcode.withgoogle.com/). \r\nIn short, GSoC participants can get involved into the mitmproxy community for ~12 weeks, contribute code, \r\nand receive [an attractive stipend](https://developers.google.com/open-source/gsoc/help/student-stipends) from Google for it! \r\n\r\nThis issue is targeted at potential participants to help them getting started and write a strong proposal. :smiley:\r\n\r\n# Getting Started\r\n\r\n1. Decide to apply for GSoC.\r\n2. Write a project proposal for your application.\r\n3. Reach out to @mhils on Slack to get feedback!\r\n\r\n# Project Ideas\r\n\r\nmitmproxy is a large project with a huge number of interesting areas to explore, down from low-level protocol work up to UX improvements. You know best what you are interested in, so why not get in touch with us and map out a custom GSoC project? Here are some ideas for inspiration:\r\n\r\n - **Web UI (TypeScript/React.js):** If you like to hack on front-end code, we have a vast array of ideas for mitmweb, our HTML frontend for mitmproxy. Just some ideas:\r\n   - Add graphical editors for the map remote, map local, modify body, and modify headers settings.\r\n   - Add body search filters\r\n   - Improve the onboarding experience, e.g. by showing instructions on how to configure the proxy if no traffic has been captured yet.\r\n   - Develop functionality to edit WebSocket/TCP messages before forwarding.\r\n - **Mitmproxy Core (Python):**\r\n   - https://github.com/mitmproxy/mitmproxy/issues/4515\r\n   - https://github.com/mitmproxy/mitmproxy/issues/1477\r\n   - https://github.com/mitmproxy/mitmproxy/issues/5231\r\n   - https://github.com/mitmproxy/mitmproxy/issues/4515\r\n   - https://github.com/mitmproxy/mitmproxy/issues/5247\r\n   - Develop functionality to edit WebSocket/TCP messages before forwarding.\r\n   - https://github.com/mitmproxy/mitmproxy/issues/5248\r\n   - Implement a prototype for WebSocket/TCP server replay.\r\n   - Refactor the flow table\r\n\r\n\r\n# Application Tips\r\n\r\nPicking the right students for a Google Summer of Code is hard - we really want to encourage all students to get involved with open source, but how do we determine who's best suited for a particular project? Here comes your part: Show us that you're super enthusiastic, that you can work autonomously and that you are capable of completing your project! :tada: \r\n\r\n#### Demonstrate that you are capable of fulfilling the project!\r\n\r\nWhile many of you probably have a good theoretical background from your university, you should show us that you can code as well:\r\n\r\n- Do you have a cool/interesting side project or university project? Show it to us! Even better if it's open source and we can read the code!\r\n- Have you contributed to an open source project before? Show us what you did!\r\n- No previous projects you could show? [Add a feature and/or fix a small bug](https://github.com/mitmproxy/mitmproxy/labels/help%20wanted) in mitmproxy!\r\n\r\nAs long as you have some code to show, please don't stress yourself about this part. We require a certain minimum level of technical proficiency so that GSoC is fun for everyone, but beyond that social components are way more important to us. 😃 \r\n\r\n#### Demonstrate that you want to contribute to mitmproxy specifically!\r\n\r\nGoogle accepts a variety of mentoring organizations every year, each of them with multiple projects. Now, why do you want to work on mitmproxy specifically? We do _not_ just want to hear a chorus of praise here (\"mitmproxy is a great tool\"). Instead, play around with it and tell us about your experiences:\r\n- Use mitmproxy to analyze a popular Android or iOS app or anything else. There are many hidden treasures/security issues to be found [[2]](https://corte.si/posts/security/skout/index.html)! Show us what you analyzed (screenshots), what you found, where mitmproxy was good/not good etc! :-)\r\n- Write a nice script that does something cool with a webpage! For example, we have an example script that turns all webpages upside down ([src](https://github.com/mitmproxy/mitmproxy/blob/main/examples/addons/internet-in-mirror.py)). Try to come up with something creative :-)\r\n- Again, a good way to show that you're a good candidate is to fix a bug, propose or implement a feature, add something that was unclear to you to the docs, etc.\r\n#### Get in touch!\r\n\r\nWe hang out on Slack (https://gsoc-slack.honeynet.org/ or the mitmproxy Slack). Feel free to just get in touch! :smiley:\r\n\r\n#### Make sure to have a plan!\r\n\r\nFor your GSoC proposal (please use [the template](https://gist.github.com/mhils/27e46c8a0caea135905d84f5d3a9f52b)), you need to write down a roadmap/timeline for your project. Think about which features you need to develop to accomplish your goal, split your project into subtasks and make sure that you'll end up with a viable timeline. Having at least one dedicated task per week would be a good way to track the progress of your project as well. If you already identified potential issues/caveats for your endeavour, make sure to discuss them in the proposal as well!\r\n\r\n**Last but not least:** GSoC is fun. Enjoy it! 😃 🍰 🚀 \r\n\r\n---\r\n# FAQ\r\n#### 1. There's a skilled and very motivated student already working hard on a proposal for the project I want to apply for. Should I even bother to apply?\r\n\r\nYes! First, if we get two convincing proposals for one project idea, we will try to just take both students¹. Second, if we cannot take you for some reason, we will actively introduce you to other projects at Honeynet that match your skills and interests after the application deadline². I can't stress this enough: Please do not worry about competition! If we see you cooperating with other contributors (students or not), this is a big plus.\r\n\r\n¹) This requires that the project can be split (and extended) in a way that there are no critical interdependencies between the students. You will not get a project which depends on another student's work.\r\n²) This is not just nice talk, we did this repeatedly with good outcomes. Some of those students are mentors now. 🙂 \r\n#### 2. I want to implement $MAJOR_FEATURE_X to show that I'm a super capable student!\r\n\r\nThis is great, but please please do not send us a single giant pull request! Please try to show us that you can split major tasks into small, (mostly) isolated parts. A PR is _never_ to small for first time contributors. :relaxed: \r\n\r\n#### 3. What is the team's preferred style of communication?\r\n\r\nAnswering every student's questions in a private conversation is often overwhelming for mentors during the peak GSoC application period. We therefore appreciate it if you ask your question publicly on GitHub or in #general on Slack so that others can help out as well. You are of course welcome to message us directly for feedback on your (already submitted) proposal, or if you feel umcomfortable discussing something in the open.\r\n\r\n#### 4. GSoC aside, how can I contribute to mitmproxy? \r\nCheck out https://github.com/mitmproxy/mitmproxy/blob/main/CONTRIBUTING.md! ","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/5048/reactions","total_count":10,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":10,"eyes":0},"timeline_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/5048/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"id":5993811197,"node_id":"REFE_lADOAAfumM4qJ6yEzwAAAAFlQkz9","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/5993811197","actor":{"login":"nneonneo","id":75449,"node_id":"MDQ6VXNlcjc1NDQ5","avatar_url":"https://avatars.githubusercontent.com/u/75449?v=4","gravatar_id":"","url":"https://api.github.com/users/nneonneo","html_url":"https://github.com/nneonneo","followers_url":"https://api.github.com/users/nneonneo/followers","following_url":"https://api.github.com/users/nneonneo/following{/other_user}","gists_url":"https://api.github.com/users/nneonneo/gists{/gist_id}","starred_url":"https://api.github.com/users/nneonneo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nneonneo/subscriptions","organizations_url":"https://api.github.com/users/nneonneo/orgs","repos_url":"https://api.github.com/users/nneonneo/repos","events_url":"https://api.github.com/users/nneonneo/events{/privacy}","received_events_url":"https://api.github.com/users/nneonneo/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"806cce1769899e3fc235759d4d76a70b70f64ee5","commit_url":"https://api.github.com/repos/nneonneo/mitmproxy/commits/806cce1769899e3fc235759d4d76a70b70f64ee5","created_at":"2022-02-02T07:43:53Z","performed_via_github_app":null},{"actor":{"login":"nneonneo","id":75449,"node_id":"MDQ6VXNlcjc1NDQ5","avatar_url":"https://avatars.githubusercontent.com/u/75449?v=4","gravatar_id":"","url":"https://api.github.com/users/nneonneo","html_url":"https://github.com/nneonneo","followers_url":"https://api.github.com/users/nneonneo/followers","following_url":"https://api.github.com/users/nneonneo/following{/other_user}","gists_url":"https://api.github.com/users/nneonneo/gists{/gist_id}","starred_url":"https://api.github.com/users/nneonneo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nneonneo/subscriptions","organizations_url":"https://api.github.com/users/nneonneo/orgs","repos_url":"https://api.github.com/users/nneonneo/repos","events_url":"https://api.github.com/users/nneonneo/events{/privacy}","received_events_url":"https://api.github.com/users/nneonneo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-02T07:55:06Z","updated_at":"2022-02-02T07:55:06Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/5106","repository_url":"https://api.github.com/repos/mitmproxy/mitmproxy","labels_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/5106/labels{/name}","comments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/5106/comments","events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/5106/events","html_url":"https://github.com/mitmproxy/mitmproxy/pull/5106","id":1121611819,"node_id":"PR_kwDOAAfumM4x82VC","number":5106,"title":"Support async hooks. Fixes #4207.","user":{"login":"nneonneo","id":75449,"node_id":"MDQ6VXNlcjc1NDQ5","avatar_url":"https://avatars.githubusercontent.com/u/75449?v=4","gravatar_id":"","url":"https://api.github.com/users/nneonneo","html_url":"https://github.com/nneonneo","followers_url":"https://api.github.com/users/nneonneo/followers","following_url":"https://api.github.com/users/nneonneo/following{/other_user}","gists_url":"https://api.github.com/users/nneonneo/gists{/gist_id}","starred_url":"https://api.github.com/users/nneonneo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nneonneo/subscriptions","organizations_url":"https://api.github.com/users/nneonneo/orgs","repos_url":"https://api.github.com/users/nneonneo/repos","events_url":"https://api.github.com/users/nneonneo/events{/privacy}","received_events_url":"https://api.github.com/users/nneonneo/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2022-02-02T07:54:20Z","updated_at":"2022-05-04T01:08:08Z","closed_at":"2022-02-04T20:20:34Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":519832,"node_id":"MDEwOlJlcG9zaXRvcnk1MTk4MzI=","name":"mitmproxy","full_name":"mitmproxy/mitmproxy","private":false,"owner":{"login":"mitmproxy","id":4652787,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQ2NTI3ODc=","avatar_url":"https://avatars.githubusercontent.com/u/4652787?v=4","gravatar_id":"","url":"https://api.github.com/users/mitmproxy","html_url":"https://github.com/mitmproxy","followers_url":"https://api.github.com/users/mitmproxy/followers","following_url":"https://api.github.com/users/mitmproxy/following{/other_user}","gists_url":"https://api.github.com/users/mitmproxy/gists{/gist_id}","starred_url":"https://api.github.com/users/mitmproxy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mitmproxy/subscriptions","organizations_url":"https://api.github.com/users/mitmproxy/orgs","repos_url":"https://api.github.com/users/mitmproxy/repos","events_url":"https://api.github.com/users/mitmproxy/events{/privacy}","received_events_url":"https://api.github.com/users/mitmproxy/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/mitmproxy/mitmproxy","description":"An interactive TLS-capable intercepting HTTP proxy for penetration testers and software developers.","fork":false,"url":"https://api.github.com/repos/mitmproxy/mitmproxy","forks_url":"https://api.github.com/repos/mitmproxy/mitmproxy/forks","keys_url":"https://api.github.com/repos/mitmproxy/mitmproxy/keys{/key_id}","collaborators_url":"https://api.github.com/repos/mitmproxy/mitmproxy/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/mitmproxy/mitmproxy/teams","hooks_url":"https://api.github.com/repos/mitmproxy/mitmproxy/hooks","issue_events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events{/number}","events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/events","assignees_url":"https://api.github.com/repos/mitmproxy/mitmproxy/assignees{/user}","branches_url":"https://api.github.com/repos/mitmproxy/mitmproxy/branches{/branch}","tags_url":"https://api.github.com/repos/mitmproxy/mitmproxy/tags","blobs_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/refs{/sha}","trees_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/trees{/sha}","statuses_url":"https://api.github.com/repos/mitmproxy/mitmproxy/statuses/{sha}","languages_url":"https://api.github.com/repos/mitmproxy/mitmproxy/languages","stargazers_url":"https://api.github.com/repos/mitmproxy/mitmproxy/stargazers","contributors_url":"https://api.github.com/repos/mitmproxy/mitmproxy/contributors","subscribers_url":"https://api.github.com/repos/mitmproxy/mitmproxy/subscribers","subscription_url":"https://api.github.com/repos/mitmproxy/mitmproxy/subscription","commits_url":"https://api.github.com/repos/mitmproxy/mitmproxy/commits{/sha}","git_commits_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/commits{/sha}","comments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/comments{/number}","issue_comment_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments{/number}","contents_url":"https://api.github.com/repos/mitmproxy/mitmproxy/contents/{+path}","compare_url":"https://api.github.com/repos/mitmproxy/mitmproxy/compare/{base}...{head}","merges_url":"https://api.github.com/repos/mitmproxy/mitmproxy/merges","archive_url":"https://api.github.com/repos/mitmproxy/mitmproxy/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/mitmproxy/mitmproxy/downloads","issues_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues{/number}","pulls_url":"https://api.github.com/repos/mitmproxy/mitmproxy/pulls{/number}","milestones_url":"https://api.github.com/repos/mitmproxy/mitmproxy/milestones{/number}","notifications_url":"https://api.github.com/repos/mitmproxy/mitmproxy/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/mitmproxy/mitmproxy/labels{/name}","releases_url":"https://api.github.com/repos/mitmproxy/mitmproxy/releases{/id}","deployments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/deployments","created_at":"2010-02-16T04:10:13Z","updated_at":"2025-11-09T17:55:49Z","pushed_at":"2025-11-09T14:36:54Z","git_url":"git://github.com/mitmproxy/mitmproxy.git","ssh_url":"git@github.com:mitmproxy/mitmproxy.git","clone_url":"https://github.com/mitmproxy/mitmproxy.git","svn_url":"https://github.com/mitmproxy/mitmproxy","homepage":"https://mitmproxy.org","size":67124,"stargazers_count":41160,"watchers_count":41160,"language":"Python","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":4359,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":387,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["debugging","http","http2","man-in-the-middle","mitmproxy","proxy","python","security","ssl","tls","websocket"],"visibility":"public","forks":4359,"open_issues":387,"watchers":41160,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/pulls/5106","html_url":"https://github.com/mitmproxy/mitmproxy/pull/5106","diff_url":"https://github.com/mitmproxy/mitmproxy/pull/5106.diff","patch_url":"https://github.com/mitmproxy/mitmproxy/pull/5106.patch","merged_at":"2022-02-04T20:20:34Z"},"body":"#### Description\r\n\r\nAdd support for async hooks to AddonManager, enabling the proxy server to call hooks asynchronously. Uses `inspect.isawaitable` to ensure that existing sync hooks continue to work without any change. Fixes #4207.\r\n\r\nThe forking of `invoke_addon` and `trigger` is a little unfortunate, but both of these get called from sync contexts throughout mitmproxy (in particular, `trigger`s are often called from `command.command` handlers, which are all sync). To ensure that we don't accidentally invoke an async handler in such cases, this patch adds a check to throw an exception if an async handler gets invoked synchronously.\r\n\r\nThis is a first stab at async hook support. There are more things that *could* be done here, and I'd love to hear if either of them makes sense for this PR, or left for future work:\r\n\r\n- ~Eliminate `concurrent` entirely, and possibly even the entire `reply` mechanism. This would be a significant, breaking API change. However, in almost every case, `async` hooks are better: async hooks are properly sequenced (even with respect to other sync hooks), races are essentially eliminated, and the behaviour is much more predictable. (It might be better to just deprecate `concurrent` now for future removal).~ Basically done: `concurrent` is kept, but made async. `reply` is gone.\r\n- Eliminate the sync versions of `trigger` and `invoke_addon` to allow async hooks in all contexts. This is trickier than it seems because of the number of places in which hooks are triggered in a synchronous context; a lot of code would probably need to be updated to be async. While this probably should happen eventually, I'm hoping this much smaller patch can serve 80% of use cases immediately.\r\n\r\nThere are also a few easier things that could be done:\r\n\r\n- Document which contexts will permit async hooks. Lifecycle hooks like `start`, `done`, etc. don't look like they should be async, for example, since they're often called synchronously.\r\n- Add tests, and/or modify existing tests to use async hooks instead.\r\n\r\n#### Checklist\r\n\r\n - [x] I have updated tests where applicable.\r\n - [x] I have added an entry to the CHANGELOG.\r\n","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/5106/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":1,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/5106/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":5993866517,"node_id":"REFE_lADOAAfumM4qJ6yEzwAAAAFlQyUV","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/5993866517","actor":{"login":"nneonneo","id":75449,"node_id":"MDQ6VXNlcjc1NDQ5","avatar_url":"https://avatars.githubusercontent.com/u/75449?v=4","gravatar_id":"","url":"https://api.github.com/users/nneonneo","html_url":"https://github.com/nneonneo","followers_url":"https://api.github.com/users/nneonneo/followers","following_url":"https://api.github.com/users/nneonneo/following{/other_user}","gists_url":"https://api.github.com/users/nneonneo/gists{/gist_id}","starred_url":"https://api.github.com/users/nneonneo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nneonneo/subscriptions","organizations_url":"https://api.github.com/users/nneonneo/orgs","repos_url":"https://api.github.com/users/nneonneo/repos","events_url":"https://api.github.com/users/nneonneo/events{/privacy}","received_events_url":"https://api.github.com/users/nneonneo/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"06a8953d87223f0155e11fd1ba3f3f8ca95f9e82","commit_url":"https://api.github.com/repos/nneonneo/mitmproxy/commits/06a8953d87223f0155e11fd1ba3f3f8ca95f9e82","created_at":"2022-02-02T07:57:03Z","performed_via_github_app":null},{"id":5994282618,"node_id":"REFE_lADOAAfumM4qJ6yEzwAAAAFlSX56","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/5994282618","actor":{"login":"nneonneo","id":75449,"node_id":"MDQ6VXNlcjc1NDQ5","avatar_url":"https://avatars.githubusercontent.com/u/75449?v=4","gravatar_id":"","url":"https://api.github.com/users/nneonneo","html_url":"https://github.com/nneonneo","followers_url":"https://api.github.com/users/nneonneo/followers","following_url":"https://api.github.com/users/nneonneo/following{/other_user}","gists_url":"https://api.github.com/users/nneonneo/gists{/gist_id}","starred_url":"https://api.github.com/users/nneonneo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nneonneo/subscriptions","organizations_url":"https://api.github.com/users/nneonneo/orgs","repos_url":"https://api.github.com/users/nneonneo/repos","events_url":"https://api.github.com/users/nneonneo/events{/privacy}","received_events_url":"https://api.github.com/users/nneonneo/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"629d6043d63dd0ac456e8df67f7ccada0985c347","commit_url":"https://api.github.com/repos/nneonneo/mitmproxy/commits/629d6043d63dd0ac456e8df67f7ccada0985c347","created_at":"2022-02-02T09:14:38Z","performed_via_github_app":null},{"actor":{"login":"Prinzhorn","id":679144,"node_id":"MDQ6VXNlcjY3OTE0NA==","avatar_url":"https://avatars.githubusercontent.com/u/679144?v=4","gravatar_id":"","url":"https://api.github.com/users/Prinzhorn","html_url":"https://github.com/Prinzhorn","followers_url":"https://api.github.com/users/Prinzhorn/followers","following_url":"https://api.github.com/users/Prinzhorn/following{/other_user}","gists_url":"https://api.github.com/users/Prinzhorn/gists{/gist_id}","starred_url":"https://api.github.com/users/Prinzhorn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Prinzhorn/subscriptions","organizations_url":"https://api.github.com/users/Prinzhorn/orgs","repos_url":"https://api.github.com/users/Prinzhorn/repos","events_url":"https://api.github.com/users/Prinzhorn/events{/privacy}","received_events_url":"https://api.github.com/users/Prinzhorn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-03T09:54:47Z","updated_at":"2022-02-03T09:54:47Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/5108","repository_url":"https://api.github.com/repos/mitmproxy/mitmproxy","labels_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/5108/labels{/name}","comments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/5108/comments","events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/5108/events","html_url":"https://github.com/mitmproxy/mitmproxy/issues/5108","id":1122872252,"node_id":"I_kwDOAAfumM5C7au8","number":5108,"title":"Wait for connection hooks to finish before calling HTTP hooks","user":{"login":"Prinzhorn","id":679144,"node_id":"MDQ6VXNlcjY3OTE0NA==","avatar_url":"https://avatars.githubusercontent.com/u/679144?v=4","gravatar_id":"","url":"https://api.github.com/users/Prinzhorn","html_url":"https://github.com/Prinzhorn","followers_url":"https://api.github.com/users/Prinzhorn/followers","following_url":"https://api.github.com/users/Prinzhorn/following{/other_user}","gists_url":"https://api.github.com/users/Prinzhorn/gists{/gist_id}","starred_url":"https://api.github.com/users/Prinzhorn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Prinzhorn/subscriptions","organizations_url":"https://api.github.com/users/Prinzhorn/orgs","repos_url":"https://api.github.com/users/Prinzhorn/repos","events_url":"https://api.github.com/users/Prinzhorn/events{/privacy}","received_events_url":"https://api.github.com/users/Prinzhorn/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":79336545,"node_id":"MDU6TGFiZWw3OTMzNjU0NQ==","url":"https://api.github.com/repos/mitmproxy/mitmproxy/labels/kind/feature","name":"kind/feature","color":"207de5","default":false,"description":"New features / enhancements"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2022-02-03T09:54:47Z","updated_at":"2022-02-04T13:49:57Z","closed_at":"2022-02-04T13:49:57Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":519832,"node_id":"MDEwOlJlcG9zaXRvcnk1MTk4MzI=","name":"mitmproxy","full_name":"mitmproxy/mitmproxy","private":false,"owner":{"login":"mitmproxy","id":4652787,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQ2NTI3ODc=","avatar_url":"https://avatars.githubusercontent.com/u/4652787?v=4","gravatar_id":"","url":"https://api.github.com/users/mitmproxy","html_url":"https://github.com/mitmproxy","followers_url":"https://api.github.com/users/mitmproxy/followers","following_url":"https://api.github.com/users/mitmproxy/following{/other_user}","gists_url":"https://api.github.com/users/mitmproxy/gists{/gist_id}","starred_url":"https://api.github.com/users/mitmproxy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mitmproxy/subscriptions","organizations_url":"https://api.github.com/users/mitmproxy/orgs","repos_url":"https://api.github.com/users/mitmproxy/repos","events_url":"https://api.github.com/users/mitmproxy/events{/privacy}","received_events_url":"https://api.github.com/users/mitmproxy/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/mitmproxy/mitmproxy","description":"An interactive TLS-capable intercepting HTTP proxy for penetration testers and software developers.","fork":false,"url":"https://api.github.com/repos/mitmproxy/mitmproxy","forks_url":"https://api.github.com/repos/mitmproxy/mitmproxy/forks","keys_url":"https://api.github.com/repos/mitmproxy/mitmproxy/keys{/key_id}","collaborators_url":"https://api.github.com/repos/mitmproxy/mitmproxy/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/mitmproxy/mitmproxy/teams","hooks_url":"https://api.github.com/repos/mitmproxy/mitmproxy/hooks","issue_events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events{/number}","events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/events","assignees_url":"https://api.github.com/repos/mitmproxy/mitmproxy/assignees{/user}","branches_url":"https://api.github.com/repos/mitmproxy/mitmproxy/branches{/branch}","tags_url":"https://api.github.com/repos/mitmproxy/mitmproxy/tags","blobs_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/refs{/sha}","trees_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/trees{/sha}","statuses_url":"https://api.github.com/repos/mitmproxy/mitmproxy/statuses/{sha}","languages_url":"https://api.github.com/repos/mitmproxy/mitmproxy/languages","stargazers_url":"https://api.github.com/repos/mitmproxy/mitmproxy/stargazers","contributors_url":"https://api.github.com/repos/mitmproxy/mitmproxy/contributors","subscribers_url":"https://api.github.com/repos/mitmproxy/mitmproxy/subscribers","subscription_url":"https://api.github.com/repos/mitmproxy/mitmproxy/subscription","commits_url":"https://api.github.com/repos/mitmproxy/mitmproxy/commits{/sha}","git_commits_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/commits{/sha}","comments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/comments{/number}","issue_comment_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments{/number}","contents_url":"https://api.github.com/repos/mitmproxy/mitmproxy/contents/{+path}","compare_url":"https://api.github.com/repos/mitmproxy/mitmproxy/compare/{base}...{head}","merges_url":"https://api.github.com/repos/mitmproxy/mitmproxy/merges","archive_url":"https://api.github.com/repos/mitmproxy/mitmproxy/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/mitmproxy/mitmproxy/downloads","issues_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues{/number}","pulls_url":"https://api.github.com/repos/mitmproxy/mitmproxy/pulls{/number}","milestones_url":"https://api.github.com/repos/mitmproxy/mitmproxy/milestones{/number}","notifications_url":"https://api.github.com/repos/mitmproxy/mitmproxy/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/mitmproxy/mitmproxy/labels{/name}","releases_url":"https://api.github.com/repos/mitmproxy/mitmproxy/releases{/id}","deployments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/deployments","created_at":"2010-02-16T04:10:13Z","updated_at":"2025-11-09T17:55:49Z","pushed_at":"2025-11-09T14:36:54Z","git_url":"git://github.com/mitmproxy/mitmproxy.git","ssh_url":"git@github.com:mitmproxy/mitmproxy.git","clone_url":"https://github.com/mitmproxy/mitmproxy.git","svn_url":"https://github.com/mitmproxy/mitmproxy","homepage":"https://mitmproxy.org","size":67124,"stargazers_count":41160,"watchers_count":41160,"language":"Python","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":4359,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":387,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["debugging","http","http2","man-in-the-middle","mitmproxy","proxy","python","security","ssl","tls","websocket"],"visibility":"public","forks":4359,"open_issues":387,"watchers":41160,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"#### Problem Description\r\n\r\nThis issue is in response to your comment https://github.com/mitmproxy/mitmproxy/issues/4207#issuecomment-907014592\r\n\r\n> Ah, you are hitting a special case here: We are not waiting for server_connected to complete before notifying the HTTP layer that the connection has been established (I didn't think this would be useful to anyone and it surely isn't faster). If you have a concrete use case here please open a separate issue, this should be straightforward to adjust. In fact at the moment it's a bit more complicated because we don't block.\r\n\r\nTo summarize: I'm doing rather heavy work in every hook and communicate with a different service (gRPC calls to Node.js that process the hooks). When using `@concurrent` (and probably same with async hooks) hooks such as `server_connected` and `request` are racing each other (I think that's actually the only case). With synchronous hooks this cannot happen because whatever I do in `server_connected` blocks the entire proxy.\r\n\r\n```py\r\nimport time\r\nfrom mitmproxy.script import concurrent\r\n\r\n\r\n@concurrent\r\ndef client_connected(data):\r\n    print('>>> client_connected')\r\n    time.sleep(2)\r\n    print('<<< client_connected')\r\n\r\n\r\n@concurrent\r\ndef server_connect(data):\r\n    print('>>> server_connect')\r\n    time.sleep(2)\r\n    print('<<< server_connect')\r\n\r\n\r\n@concurrent\r\ndef server_connected(data):\r\n    print('>>> server_connected')\r\n    time.sleep(2)\r\n    print('<<< server_connected')\r\n\r\n\r\n@concurrent\r\ndef request(flow):\r\n    print('>>> request')\r\n    time.sleep(2)\r\n    print('<<< request')\r\n\r\n\r\n@concurrent\r\ndef response(flow):\r\n    print('>>> response')\r\n    time.sleep(2)\r\n    print('<<< response')\r\n\r\n\r\n@concurrent\r\ndef client_disconnected(data):\r\n    print('>>> client_disconnected')\r\n    time.sleep(2)\r\n    print('<<< client_disconnected')\r\n\r\n\r\n@concurrent\r\ndef server_disconnected(data):\r\n    print('>>> server_disconnected')\r\n    time.sleep(2)\r\n    print('<<< server_disconnected')\r\n```\r\n\r\nAs you can see `server_connected` and `request` are interleaved.\r\n\r\n```\r\n>>> client_connected\r\n<<< client_connected\r\n>>> server_connect\r\n<<< server_connect\r\n>>> server_connected\r\n>>> request\r\n<<< server_connected\r\n<<< request\r\n>>> response\r\n<<< response\r\n>>> client_disconnected\r\n<<< client_disconnected\r\n>>> server_disconnected\r\n<<< server_disconnected\r\n```\r\n\r\n#### Proposal\r\n\r\nWait for the connection hooks to finish before continuing with the HTTP layer.\r\n\r\n#### Alternatives\r\n\r\nI could leave the connection event synchronous so that the always block and finish. But depending on the number of clients and servers this would mostly diminish the effect of making all other hooks async or concurrent.","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/5108/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/5108/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"id":6003167966,"node_id":"REFE_lADOAAfumM4qJ6yEzwAAAAFl0RLe","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/6003167966","actor":{"login":"nneonneo","id":75449,"node_id":"MDQ6VXNlcjc1NDQ5","avatar_url":"https://avatars.githubusercontent.com/u/75449?v=4","gravatar_id":"","url":"https://api.github.com/users/nneonneo","html_url":"https://github.com/nneonneo","followers_url":"https://api.github.com/users/nneonneo/followers","following_url":"https://api.github.com/users/nneonneo/following{/other_user}","gists_url":"https://api.github.com/users/nneonneo/gists{/gist_id}","starred_url":"https://api.github.com/users/nneonneo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nneonneo/subscriptions","organizations_url":"https://api.github.com/users/nneonneo/orgs","repos_url":"https://api.github.com/users/nneonneo/repos","events_url":"https://api.github.com/users/nneonneo/events{/privacy}","received_events_url":"https://api.github.com/users/nneonneo/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"152940f07d8c816f0e4e4445c0c66ad8f04dc52d","commit_url":"https://api.github.com/repos/nneonneo/mitmproxy/commits/152940f07d8c816f0e4e4445c0c66ad8f04dc52d","created_at":"2022-02-03T14:27:09Z","performed_via_github_app":null},{"id":6010508833,"node_id":"REFE_lADOAAfumM4qJ6yEzwAAAAFmQRYh","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/6010508833","actor":{"login":"nneonneo","id":75449,"node_id":"MDQ6VXNlcjc1NDQ5","avatar_url":"https://avatars.githubusercontent.com/u/75449?v=4","gravatar_id":"","url":"https://api.github.com/users/nneonneo","html_url":"https://github.com/nneonneo","followers_url":"https://api.github.com/users/nneonneo/followers","following_url":"https://api.github.com/users/nneonneo/following{/other_user}","gists_url":"https://api.github.com/users/nneonneo/gists{/gist_id}","starred_url":"https://api.github.com/users/nneonneo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nneonneo/subscriptions","organizations_url":"https://api.github.com/users/nneonneo/orgs","repos_url":"https://api.github.com/users/nneonneo/repos","events_url":"https://api.github.com/users/nneonneo/events{/privacy}","received_events_url":"https://api.github.com/users/nneonneo/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"d07197930ce57e70a1da524611ea68bcbcbafd9a","commit_url":"https://api.github.com/repos/nneonneo/mitmproxy/commits/d07197930ce57e70a1da524611ea68bcbcbafd9a","created_at":"2022-02-04T16:08:16Z","performed_via_github_app":null},{"id":6010649307,"node_id":"REFE_lADOAAfumM4qJ6yEzwAAAAFmQzrb","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/6010649307","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"cee4b724591dd614220c6df8fadd71cad00855b6","commit_url":"https://api.github.com/repos/nneonneo/mitmproxy/commits/cee4b724591dd614220c6df8fadd71cad00855b6","created_at":"2022-02-04T16:31:12Z","performed_via_github_app":null},{"id":6011833110,"node_id":"CE_lADOAAfumM4qJ6yEzwAAAAFmVUsW","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/6011833110","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2022-02-04T20:20:34Z","state_reason":null,"performed_via_github_app":null},{"id":6011833223,"node_id":"REFE_lADOAAfumM4qJ6yEzwAAAAFmVUuH","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/6011833223","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"4468046a261dcb04d2197399e2ec3deb1e1dc233","commit_url":"https://api.github.com/repos/mitmproxy/mitmproxy/commits/4468046a261dcb04d2197399e2ec3deb1e1dc233","created_at":"2022-02-04T20:20:35Z","performed_via_github_app":null}]