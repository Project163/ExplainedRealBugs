{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/169","repository_url":"https://api.github.com/repos/mitmproxy/mitmproxy","labels_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/169/labels{/name}","comments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/169/comments","events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/169/events","html_url":"https://github.com/mitmproxy/mitmproxy/issues/169","id":19632333,"node_id":"MDU6SXNzdWUxOTYzMjMzMw==","number":169,"title":"AttributeError: 'NoneType' object has no attribute 'decode'","user":{"login":"codersbrew","id":1431415,"node_id":"MDQ6VXNlcjE0MzE0MTU=","avatar_url":"https://avatars.githubusercontent.com/u/1431415?v=4","gravatar_id":"","url":"https://api.github.com/users/codersbrew","html_url":"https://github.com/codersbrew","followers_url":"https://api.github.com/users/codersbrew/followers","following_url":"https://api.github.com/users/codersbrew/following{/other_user}","gists_url":"https://api.github.com/users/codersbrew/gists{/gist_id}","starred_url":"https://api.github.com/users/codersbrew/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codersbrew/subscriptions","organizations_url":"https://api.github.com/users/codersbrew/orgs","repos_url":"https://api.github.com/users/codersbrew/repos","events_url":"https://api.github.com/users/codersbrew/events{/privacy}","received_events_url":"https://api.github.com/users/codersbrew/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2013-09-17T18:33:08Z","updated_at":"2013-12-12T02:24:22Z","closed_at":"2013-12-12T02:24:22Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"This might be an issue on my end.\n\n1) I am running a localserver apach2 with self signed openssl Cert.\n2) I then start up the basic mitmproxy via python. I can visit https sites like google or what have you and I see the requests and responses.\n3) If I go to my own apache2 server locally via firefox, \"https://127.0.0.1/test.html\" I get the following error.\n\n```\nError in processing of request from 127.0.0.1:50944\nTraceback (most recent call last):\n  File \"/usr/lib/python2.7/site-packages/netlib/tcp.py\", line 369, in request_thread\n    self.handle_connection(request, client_address)\n  File \"/usr/lib/python2.7/site-packages/libmproxy/proxy.py\", line 511, in handle_connection\n    h.handle()\n  File \"/usr/lib/python2.7/site-packages/libmproxy/proxy.py\", line 175, in handle\n    while self.handle_request(cc) and not cc.close:\n  File \"/usr/lib/python2.7/site-packages/libmproxy/proxy.py\", line 191, in handle_request\n    request = self.read_request(cc)\n  File \"/usr/lib/python2.7/site-packages/libmproxy/proxy.py\", line 441, in read_request\n    return self.read_request_proxy(client_conn)\n  File \"/usr/lib/python2.7/site-packages/libmproxy/proxy.py\", line 375, in read_request_proxy\n    dummycert = self.find_cert(client_conn, host, port, host)\n  File \"/usr/lib/python2.7/site-packages/libmproxy/proxy.py\", line 307, in find_cert\n    host = conn.cert.cn.decode(\"utf8\").encode(\"idna\")\nAttributeError: 'NoneType' object has no attribute 'decode'\n```\n\nThis is the code I am running \n\n```\n#!/usr/bin/env python\n\"\"\"\nThis example builds on mitmproxy's base proxying infrastructure to\nimplement functionality similar to the \"sticky cookies\" option. This is at\na lower level than the Flow mechanism, so we're dealing directly with\nrequest and response objects.\n\"\"\"\nfrom libmproxy import controller, proxy\nimport os\n\nclass StickyMaster(controller.Master):\n    def __init__(self, server):\n        controller.Master.__init__(self, server)\n        self.stickyhosts = {}\n\n    def run(self):\n        try:\n            return controller.Master.run(self)\n        except KeyboardInterrupt:\n            self.shutdown()\n\n    def handle_request(self, msg):\n        hid = (msg.host, msg.port)\n        #if msg.headers[\"cookie\"]:\n        #    self.stickyhosts[hid] = msg.headers[\"cookie\"]\n        #elif hid in self.stickyhosts:\n        #    msg.headers[\"cookie\"] = self.stickyhosts[hid]\n        msg.reply()\n\n    def handle_response(self, msg):\n        hid = (msg.request.host, msg.request.port)\n        print hid\n        output = msg._get_state()\n        print msg.request.path + msg.request.host + str(output['timestamp_start']) + str(output['timestamp_end'])\n        #if msg.headers[\"set-cookie\"]:\n        #    self.stickyhosts[hid] = msg.headers[\"set-cookie\"]\n        msg.reply()\n\n\nconfig = proxy.ProxyConfig(\n    cacert = os.path.expanduser(\"~/.mitmproxy/mitmproxy-ca.pem\")\n)\nserver = proxy.ProxyServer(config, 8080)\nm = StickyMaster(server)\nm.run()\n```\n","closed_by":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/169/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/169/timeline","performed_via_github_app":null,"state_reason":"completed"}