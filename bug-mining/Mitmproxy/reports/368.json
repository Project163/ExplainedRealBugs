{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4280","repository_url":"https://api.github.com/repos/mitmproxy/mitmproxy","labels_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4280/labels{/name}","comments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4280/comments","events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4280/events","html_url":"https://github.com/mitmproxy/mitmproxy/issues/4280","id":737876979,"node_id":"MDU6SXNzdWU3Mzc4NzY5Nzk=","number":4280,"title":"map-local not working in 5.3.0","user":{"login":"Krakau","id":7141241,"node_id":"MDQ6VXNlcjcxNDEyNDE=","avatar_url":"https://avatars.githubusercontent.com/u/7141241?v=4","gravatar_id":"","url":"https://api.github.com/users/Krakau","html_url":"https://github.com/Krakau","followers_url":"https://api.github.com/users/Krakau/followers","following_url":"https://api.github.com/users/Krakau/following{/other_user}","gists_url":"https://api.github.com/users/Krakau/gists{/gist_id}","starred_url":"https://api.github.com/users/Krakau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Krakau/subscriptions","organizations_url":"https://api.github.com/users/Krakau/orgs","repos_url":"https://api.github.com/users/Krakau/repos","events_url":"https://api.github.com/users/Krakau/events{/privacy}","received_events_url":"https://api.github.com/users/Krakau/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":466930397,"node_id":"MDU6TGFiZWw0NjY5MzAzOTc=","url":"https://api.github.com/repos/mitmproxy/mitmproxy/labels/kind/triage","name":"kind/triage","color":"006b75","default":false,"description":"Unclassified issues"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2020-11-06T16:09:32Z","updated_at":"2020-12-11T21:52:51Z","closed_at":"2020-12-10T08:55:30Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"#### Problem Description\r\nWe use mitmproxy locally to replay backend queries made from frontend. After updating from 5.2 to 5.3.0 every command that has the --map-local options seems to work otherwise correctly but mitmproxy seems to completely ignore the --map-local part when replaying. On startup mitmproxy does validate that the local resource is present so it doesn't completely ignore the option but it never actually seems to use it.\r\nThe replay command that we use also has flows that are replayed and that part does work as intended. But even if we leave the flows out of the command and only use --map-local command the local resource is not served.\r\n\r\n#### Steps to reproduce the behavior:\r\n1. Make a local resource file (local.json) and, optionally, prepare a flows file (mitmproxy-flows)\r\n2. Choose a server you are trying to mimick with replay\r\n3. Run command `mitmdump --mode reverse:http://localhost:8910/ -S mitmproxy-flows --server-replay-nopop --server-replay-refresh --listen-port 7777 --map-local \"|~m GET|localhost:8910/api/resource|local.json\"`\r\n4. Try to go to URL http://localhost:7777/api/resource\r\n\r\n#### System Information\r\nWORKING version info is:\r\n```\r\nMitmproxy: 5.2 binary\r\nPython:    3.7.8\r\nOpenSSL:   OpenSSL 1.1.1g  21 Apr 2020\r\nPlatform:  Darwin-19.6.0-x86_64-i386-64bit\r\n```\r\n(note that I used the macOS binaries here when testing with 5.2 but it was also working with 5.2 installed with homebrew)\r\n\r\nNOT WORKING version info is:\r\n```\r\nMitmproxy: 5.3.0\r\nPython:    3.9.0\r\nOpenSSL:   OpenSSL 1.1.1h  22 Sep 2020\r\nPlatform:  macOS-10.15.7-x86_64-i386-64bit\r\n```","closed_by":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4280/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4280/timeline","performed_via_github_app":null,"state_reason":"completed"}