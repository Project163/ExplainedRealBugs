[{"id":5496631713,"node_id":"LE_lADOAAfumM49hct4zwAAAAFHn_Gh","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/5496631713","actor":{"login":"HoffmannP","id":432592,"node_id":"MDQ6VXNlcjQzMjU5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/432592?v=4","gravatar_id":"","url":"https://api.github.com/users/HoffmannP","html_url":"https://github.com/HoffmannP","followers_url":"https://api.github.com/users/HoffmannP/followers","following_url":"https://api.github.com/users/HoffmannP/following{/other_user}","gists_url":"https://api.github.com/users/HoffmannP/gists{/gist_id}","starred_url":"https://api.github.com/users/HoffmannP/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HoffmannP/subscriptions","organizations_url":"https://api.github.com/users/HoffmannP/orgs","repos_url":"https://api.github.com/users/HoffmannP/repos","events_url":"https://api.github.com/users/HoffmannP/events{/privacy}","received_events_url":"https://api.github.com/users/HoffmannP/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2021-10-21T07:58:05Z","label":{"name":"kind/triage","color":"006b75"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/948358247","html_url":"https://github.com/mitmproxy/mitmproxy/issues/4876#issuecomment-948358247","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4876","id":948358247,"node_id":"IC_kwDOAAfumM44hsxn","user":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-10-21T08:00:53Z","updated_at":"2021-10-21T08:00:53Z","body":"This needs concrete repro steps. The following setup creates two perfectly replayable requests for me:\r\n```\r\nmitmproxy -p 8001\r\n```\r\n```\r\nmitmproxy --mode upstream:localhost:8001 --set ssl_insecure\r\n```\r\n```\r\ncurl -x localhost:8080 -k https://example.com http://example.com\r\n```\r\n\r\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/948358247/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/948756349","html_url":"https://github.com/mitmproxy/mitmproxy/issues/4876#issuecomment-948756349","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4876","id":948756349,"node_id":"IC_kwDOAAfumM44jN99","user":{"login":"HoffmannP","id":432592,"node_id":"MDQ6VXNlcjQzMjU5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/432592?v=4","gravatar_id":"","url":"https://api.github.com/users/HoffmannP","html_url":"https://github.com/HoffmannP","followers_url":"https://api.github.com/users/HoffmannP/followers","following_url":"https://api.github.com/users/HoffmannP/following{/other_user}","gists_url":"https://api.github.com/users/HoffmannP/gists{/gist_id}","starred_url":"https://api.github.com/users/HoffmannP/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HoffmannP/subscriptions","organizations_url":"https://api.github.com/users/HoffmannP/orgs","repos_url":"https://api.github.com/users/HoffmannP/repos","events_url":"https://api.github.com/users/HoffmannP/events{/privacy}","received_events_url":"https://api.github.com/users/HoffmannP/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-10-21T16:01:50Z","updated_at":"2021-10-21T16:01:50Z","body":"My setup is practically equal to yours, except I use `tinyproxy` as proxy. The original request works like a charm, replay fails with \"Upstream proxy 127.0.0.1:8001 refused HTTP CONNECT request: 403 Access violation\".\r\nMight be also be a tinyproxy bug but the CONNECT method is not required to replay the original request. ","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/948756349/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"HoffmannP","id":432592,"node_id":"MDQ6VXNlcjQzMjU5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/432592?v=4","gravatar_id":"","url":"https://api.github.com/users/HoffmannP","html_url":"https://github.com/HoffmannP","followers_url":"https://api.github.com/users/HoffmannP/followers","following_url":"https://api.github.com/users/HoffmannP/following{/other_user}","gists_url":"https://api.github.com/users/HoffmannP/gists{/gist_id}","starred_url":"https://api.github.com/users/HoffmannP/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HoffmannP/subscriptions","organizations_url":"https://api.github.com/users/HoffmannP/orgs","repos_url":"https://api.github.com/users/HoffmannP/repos","events_url":"https://api.github.com/users/HoffmannP/events{/privacy}","received_events_url":"https://api.github.com/users/HoffmannP/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/948802988","html_url":"https://github.com/mitmproxy/mitmproxy/issues/4876#issuecomment-948802988","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4876","id":948802988,"node_id":"IC_kwDOAAfumM44jZWs","user":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-10-21T16:55:23Z","updated_at":"2021-10-21T16:55:23Z","body":"Ah, I see. Can you confirm that this only applies to plaintext http:// requests? For HTTPS you do need `CONNECT`. In this case what we are doing is not wrong per se, but I agree that it would be nicer to proxy absolute-form HTTP requests and not `CONNECT` before that.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/948802988/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/949629911","html_url":"https://github.com/mitmproxy/mitmproxy/issues/4876#issuecomment-949629911","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4876","id":949629911,"node_id":"IC_kwDOAAfumM44mjPX","user":{"login":"HoffmannP","id":432592,"node_id":"MDQ6VXNlcjQzMjU5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/432592?v=4","gravatar_id":"","url":"https://api.github.com/users/HoffmannP","html_url":"https://github.com/HoffmannP","followers_url":"https://api.github.com/users/HoffmannP/followers","following_url":"https://api.github.com/users/HoffmannP/following{/other_user}","gists_url":"https://api.github.com/users/HoffmannP/gists{/gist_id}","starred_url":"https://api.github.com/users/HoffmannP/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HoffmannP/subscriptions","organizations_url":"https://api.github.com/users/HoffmannP/orgs","repos_url":"https://api.github.com/users/HoffmannP/repos","events_url":"https://api.github.com/users/HoffmannP/events{/privacy}","received_events_url":"https://api.github.com/users/HoffmannP/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-10-22T13:25:04Z","updated_at":"2021-10-22T13:25:04Z","body":"Yes, I can confirm, that this only applies for raw HTTP.\r\n With HTTPS it works.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/949629911/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"HoffmannP","id":432592,"node_id":"MDQ6VXNlcjQzMjU5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/432592?v=4","gravatar_id":"","url":"https://api.github.com/users/HoffmannP","html_url":"https://github.com/HoffmannP","followers_url":"https://api.github.com/users/HoffmannP/followers","following_url":"https://api.github.com/users/HoffmannP/following{/other_user}","gists_url":"https://api.github.com/users/HoffmannP/gists{/gist_id}","starred_url":"https://api.github.com/users/HoffmannP/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HoffmannP/subscriptions","organizations_url":"https://api.github.com/users/HoffmannP/orgs","repos_url":"https://api.github.com/users/HoffmannP/repos","events_url":"https://api.github.com/users/HoffmannP/events{/privacy}","received_events_url":"https://api.github.com/users/HoffmannP/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":5504881781,"node_id":"RTE_lADOAAfumM49hct4zwAAAAFIHdR1","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/5504881781","actor":{"login":"HoffmannP","id":432592,"node_id":"MDQ6VXNlcjQzMjU5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/432592?v=4","gravatar_id":"","url":"https://api.github.com/users/HoffmannP","html_url":"https://github.com/HoffmannP","followers_url":"https://api.github.com/users/HoffmannP/followers","following_url":"https://api.github.com/users/HoffmannP/following{/other_user}","gists_url":"https://api.github.com/users/HoffmannP/gists{/gist_id}","starred_url":"https://api.github.com/users/HoffmannP/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HoffmannP/subscriptions","organizations_url":"https://api.github.com/users/HoffmannP/orgs","repos_url":"https://api.github.com/users/HoffmannP/repos","events_url":"https://api.github.com/users/HoffmannP/events{/privacy}","received_events_url":"https://api.github.com/users/HoffmannP/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"renamed","commit_id":null,"commit_url":null,"created_at":"2021-10-22T13:25:29Z","rename":{"from":"Replay via upstream proxy uses CONNECT instead of original request method","to":"Replay via upstream proxy uses CONNECT instead of original request method for HTTP connections"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/949640477","html_url":"https://github.com/mitmproxy/mitmproxy/issues/4876#issuecomment-949640477","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4876","id":949640477,"node_id":"IC_kwDOAAfumM44ml0d","user":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-10-22T13:38:04Z","updated_at":"2021-10-22T13:38:04Z","body":"Thanks. The problem here likely is the interaction between replaying in transparent mode:\r\n\r\nhttps://github.com/mitmproxy/mitmproxy/blob/1c10abef000ba2f112bc00119bcdb6707d6ff08e/mitmproxy/addons/clientplayback.py#L81\r\n\r\nwhile checking whether we need to CONNECT here:\r\n\r\nhttps://github.com/mitmproxy/mitmproxy/blob/1c10abef000ba2f112bc00119bcdb6707d6ff08e/mitmproxy/proxy/layers/http/__init__.py#L834\r\n\r\nI think we need to be smarter about setting the HTTP mode for client replay, it may just be good enough to set this to upstream when we are in upstream mode. I won't find any time to work on this anytime soon, but if you want to take a closer look I'd be happy to merge a PR.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/949640477/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":5545678044,"node_id":"CE_lADOAAfumM49hct4zwAAAAFKjFTc","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/5545678044","actor":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"260fc682116e4fbbf3a559c885afb02a9420d0bd","commit_url":"https://api.github.com/repos/mitmproxy/mitmproxy/commits/260fc682116e4fbbf3a559c885afb02a9420d0bd","created_at":"2021-10-31T20:23:06Z","state_reason":null,"performed_via_github_app":null},{"id":12137562793,"node_id":"REFE_lADOAAfumM49hct4zwAAAALTdIKp","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/12137562793","actor":{"login":"jrblixt","id":10424783,"node_id":"MDQ6VXNlcjEwNDI0Nzgz","avatar_url":"https://avatars.githubusercontent.com/u/10424783?v=4","gravatar_id":"","url":"https://api.github.com/users/jrblixt","html_url":"https://github.com/jrblixt","followers_url":"https://api.github.com/users/jrblixt/followers","following_url":"https://api.github.com/users/jrblixt/following{/other_user}","gists_url":"https://api.github.com/users/jrblixt/gists{/gist_id}","starred_url":"https://api.github.com/users/jrblixt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jrblixt/subscriptions","organizations_url":"https://api.github.com/users/jrblixt/orgs","repos_url":"https://api.github.com/users/jrblixt/repos","events_url":"https://api.github.com/users/jrblixt/events{/privacy}","received_events_url":"https://api.github.com/users/jrblixt/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"260fc682116e4fbbf3a559c885afb02a9420d0bd","commit_url":"https://api.github.com/repos/jrblixt/mitmproxy/commits/260fc682116e4fbbf3a559c885afb02a9420d0bd","created_at":"2024-03-15T23:08:26Z","performed_via_github_app":null}]