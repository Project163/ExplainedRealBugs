[{"id":19025923,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDE5MDI1OTIz","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/19025923","actor":{"login":"Br3nda","id":12266,"node_id":"MDQ6VXNlcjEyMjY2","avatar_url":"https://avatars.githubusercontent.com/u/12266?v=4","gravatar_id":"","url":"https://api.github.com/users/Br3nda","html_url":"https://github.com/Br3nda","followers_url":"https://api.github.com/users/Br3nda/followers","following_url":"https://api.github.com/users/Br3nda/following{/other_user}","gists_url":"https://api.github.com/users/Br3nda/gists{/gist_id}","starred_url":"https://api.github.com/users/Br3nda/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Br3nda/subscriptions","organizations_url":"https://api.github.com/users/Br3nda/orgs","repos_url":"https://api.github.com/users/Br3nda/repos","events_url":"https://api.github.com/users/Br3nda/events{/privacy}","received_events_url":"https://api.github.com/users/Br3nda/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2012-06-30T03:31:49Z","performed_via_github_app":null},{"id":19026345,"node_id":"MDExOkNsb3NlZEV2ZW50MTkwMjYzNDU=","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/19026345","actor":{"login":"cortesi","id":22544,"node_id":"MDQ6VXNlcjIyNTQ0","avatar_url":"https://avatars.githubusercontent.com/u/22544?v=4","gravatar_id":"","url":"https://api.github.com/users/cortesi","html_url":"https://github.com/cortesi","followers_url":"https://api.github.com/users/cortesi/followers","following_url":"https://api.github.com/users/cortesi/following{/other_user}","gists_url":"https://api.github.com/users/cortesi/gists{/gist_id}","starred_url":"https://api.github.com/users/cortesi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cortesi/subscriptions","organizations_url":"https://api.github.com/users/cortesi/orgs","repos_url":"https://api.github.com/users/cortesi/repos","events_url":"https://api.github.com/users/cortesi/events{/privacy}","received_events_url":"https://api.github.com/users/cortesi/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"f070e4523aebd383f6424a020c93f4065aaa673c","commit_url":"https://api.github.com/repos/mitmproxy/mitmproxy/commits/f070e4523aebd383f6424a020c93f4065aaa673c","created_at":"2012-06-30T04:00:11Z","state_reason":null,"performed_via_github_app":null},{"id":19026346,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDE5MDI2MzQ2","url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events/19026346","actor":{"login":"cortesi","id":22544,"node_id":"MDQ6VXNlcjIyNTQ0","avatar_url":"https://avatars.githubusercontent.com/u/22544?v=4","gravatar_id":"","url":"https://api.github.com/users/cortesi","html_url":"https://github.com/cortesi","followers_url":"https://api.github.com/users/cortesi/followers","following_url":"https://api.github.com/users/cortesi/following{/other_user}","gists_url":"https://api.github.com/users/cortesi/gists{/gist_id}","starred_url":"https://api.github.com/users/cortesi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cortesi/subscriptions","organizations_url":"https://api.github.com/users/cortesi/orgs","repos_url":"https://api.github.com/users/cortesi/repos","events_url":"https://api.github.com/users/cortesi/events{/privacy}","received_events_url":"https://api.github.com/users/cortesi/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2012-06-30T04:00:11Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/6682508","html_url":"https://github.com/mitmproxy/mitmproxy/issues/47#issuecomment-6682508","issue_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/47","id":6682508,"node_id":"MDEyOklzc3VlQ29tbWVudDY2ODI1MDg=","user":{"login":"cortesi","id":22544,"node_id":"MDQ6VXNlcjIyNTQ0","avatar_url":"https://avatars.githubusercontent.com/u/22544?v=4","gravatar_id":"","url":"https://api.github.com/users/cortesi","html_url":"https://github.com/cortesi","followers_url":"https://api.github.com/users/cortesi/followers","following_url":"https://api.github.com/users/cortesi/following{/other_user}","gists_url":"https://api.github.com/users/cortesi/gists{/gist_id}","starred_url":"https://api.github.com/users/cortesi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cortesi/subscriptions","organizations_url":"https://api.github.com/users/cortesi/orgs","repos_url":"https://api.github.com/users/cortesi/repos","events_url":"https://api.github.com/users/cortesi/events{/privacy}","received_events_url":"https://api.github.com/users/cortesi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2012-06-30T04:03:17Z","updated_at":"2012-06-30T04:03:17Z","body":"Cheers, fixed in f070e45 (along with a similar case in CONNECT requests) - we now return an HTTP 400 response when seeing invalid data. This should only be triggered when mitmproxy is sent an invalid request - let me know if you're seeing this on valid HTTP traffic. \n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments/6682508/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"cortesi","id":22544,"node_id":"MDQ6VXNlcjIyNTQ0","avatar_url":"https://avatars.githubusercontent.com/u/22544?v=4","gravatar_id":"","url":"https://api.github.com/users/cortesi","html_url":"https://github.com/cortesi","followers_url":"https://api.github.com/users/cortesi/followers","following_url":"https://api.github.com/users/cortesi/following{/other_user}","gists_url":"https://api.github.com/users/cortesi/gists{/gist_id}","starred_url":"https://api.github.com/users/cortesi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cortesi/subscriptions","organizations_url":"https://api.github.com/users/cortesi/orgs","repos_url":"https://api.github.com/users/cortesi/repos","events_url":"https://api.github.com/users/cortesi/events{/privacy}","received_events_url":"https://api.github.com/users/cortesi/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"javabrett","id":1103477,"node_id":"MDQ6VXNlcjExMDM0Nzc=","avatar_url":"https://avatars.githubusercontent.com/u/1103477?v=4","gravatar_id":"","url":"https://api.github.com/users/javabrett","html_url":"https://github.com/javabrett","followers_url":"https://api.github.com/users/javabrett/followers","following_url":"https://api.github.com/users/javabrett/following{/other_user}","gists_url":"https://api.github.com/users/javabrett/gists{/gist_id}","starred_url":"https://api.github.com/users/javabrett/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javabrett/subscriptions","organizations_url":"https://api.github.com/users/javabrett/orgs","repos_url":"https://api.github.com/users/javabrett/repos","events_url":"https://api.github.com/users/javabrett/events{/privacy}","received_events_url":"https://api.github.com/users/javabrett/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-05-01T13:08:51Z","updated_at":"2016-05-01T13:08:51Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/1108","repository_url":"https://api.github.com/repos/mitmproxy/mitmproxy","labels_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/1108/labels{/name}","comments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/1108/comments","events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/1108/events","html_url":"https://github.com/mitmproxy/mitmproxy/issues/1108","id":152198562,"node_id":"MDU6SXNzdWUxNTIxOTg1NjI=","number":1108,"title":"No way to prevent hostname-from-client from being auto-added to X.509 SANs","user":{"login":"javabrett","id":1103477,"node_id":"MDQ6VXNlcjExMDM0Nzc=","avatar_url":"https://avatars.githubusercontent.com/u/1103477?v=4","gravatar_id":"","url":"https://api.github.com/users/javabrett","html_url":"https://github.com/javabrett","followers_url":"https://api.github.com/users/javabrett/followers","following_url":"https://api.github.com/users/javabrett/following{/other_user}","gists_url":"https://api.github.com/users/javabrett/gists{/gist_id}","starred_url":"https://api.github.com/users/javabrett/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javabrett/subscriptions","organizations_url":"https://api.github.com/users/javabrett/orgs","repos_url":"https://api.github.com/users/javabrett/repos","events_url":"https://api.github.com/users/javabrett/events{/privacy}","received_events_url":"https://api.github.com/users/javabrett/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2016-05-01T13:08:51Z","updated_at":"2016-05-03T18:26:44Z","closed_at":"2016-05-03T18:26:44Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":519832,"node_id":"MDEwOlJlcG9zaXRvcnk1MTk4MzI=","name":"mitmproxy","full_name":"mitmproxy/mitmproxy","private":false,"owner":{"login":"mitmproxy","id":4652787,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQ2NTI3ODc=","avatar_url":"https://avatars.githubusercontent.com/u/4652787?v=4","gravatar_id":"","url":"https://api.github.com/users/mitmproxy","html_url":"https://github.com/mitmproxy","followers_url":"https://api.github.com/users/mitmproxy/followers","following_url":"https://api.github.com/users/mitmproxy/following{/other_user}","gists_url":"https://api.github.com/users/mitmproxy/gists{/gist_id}","starred_url":"https://api.github.com/users/mitmproxy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mitmproxy/subscriptions","organizations_url":"https://api.github.com/users/mitmproxy/orgs","repos_url":"https://api.github.com/users/mitmproxy/repos","events_url":"https://api.github.com/users/mitmproxy/events{/privacy}","received_events_url":"https://api.github.com/users/mitmproxy/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/mitmproxy/mitmproxy","description":"An interactive TLS-capable intercepting HTTP proxy for penetration testers and software developers.","fork":false,"url":"https://api.github.com/repos/mitmproxy/mitmproxy","forks_url":"https://api.github.com/repos/mitmproxy/mitmproxy/forks","keys_url":"https://api.github.com/repos/mitmproxy/mitmproxy/keys{/key_id}","collaborators_url":"https://api.github.com/repos/mitmproxy/mitmproxy/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/mitmproxy/mitmproxy/teams","hooks_url":"https://api.github.com/repos/mitmproxy/mitmproxy/hooks","issue_events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/events{/number}","events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/events","assignees_url":"https://api.github.com/repos/mitmproxy/mitmproxy/assignees{/user}","branches_url":"https://api.github.com/repos/mitmproxy/mitmproxy/branches{/branch}","tags_url":"https://api.github.com/repos/mitmproxy/mitmproxy/tags","blobs_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/refs{/sha}","trees_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/trees{/sha}","statuses_url":"https://api.github.com/repos/mitmproxy/mitmproxy/statuses/{sha}","languages_url":"https://api.github.com/repos/mitmproxy/mitmproxy/languages","stargazers_url":"https://api.github.com/repos/mitmproxy/mitmproxy/stargazers","contributors_url":"https://api.github.com/repos/mitmproxy/mitmproxy/contributors","subscribers_url":"https://api.github.com/repos/mitmproxy/mitmproxy/subscribers","subscription_url":"https://api.github.com/repos/mitmproxy/mitmproxy/subscription","commits_url":"https://api.github.com/repos/mitmproxy/mitmproxy/commits{/sha}","git_commits_url":"https://api.github.com/repos/mitmproxy/mitmproxy/git/commits{/sha}","comments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/comments{/number}","issue_comment_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/comments{/number}","contents_url":"https://api.github.com/repos/mitmproxy/mitmproxy/contents/{+path}","compare_url":"https://api.github.com/repos/mitmproxy/mitmproxy/compare/{base}...{head}","merges_url":"https://api.github.com/repos/mitmproxy/mitmproxy/merges","archive_url":"https://api.github.com/repos/mitmproxy/mitmproxy/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/mitmproxy/mitmproxy/downloads","issues_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues{/number}","pulls_url":"https://api.github.com/repos/mitmproxy/mitmproxy/pulls{/number}","milestones_url":"https://api.github.com/repos/mitmproxy/mitmproxy/milestones{/number}","notifications_url":"https://api.github.com/repos/mitmproxy/mitmproxy/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/mitmproxy/mitmproxy/labels{/name}","releases_url":"https://api.github.com/repos/mitmproxy/mitmproxy/releases{/id}","deployments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/deployments","created_at":"2010-02-16T04:10:13Z","updated_at":"2025-11-09T17:55:49Z","pushed_at":"2025-11-09T14:36:54Z","git_url":"git://github.com/mitmproxy/mitmproxy.git","ssh_url":"git@github.com:mitmproxy/mitmproxy.git","clone_url":"https://github.com/mitmproxy/mitmproxy.git","svn_url":"https://github.com/mitmproxy/mitmproxy","homepage":"https://mitmproxy.org","size":67124,"stargazers_count":41160,"watchers_count":41160,"language":"Python","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":4359,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":387,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["debugging","http","http2","man-in-the-middle","mitmproxy","proxy","python","security","ssl","tls","websocket"],"visibility":"public","forks":4359,"open_issues":387,"watchers":41160,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"As at current master (d84fc64), `mitmproxy` will in certain situations generate X.509 certificates for remote sites which are accepted without error by a web-browser, whereas a direct-connection to the same site would trigger TLS errors such as `SSL_ERROR_BAD_CERT_DOMAIN`, `NET::ERR_CERT_COMMON_NAME_INVALID`.  This certificate \"enrichment\", whilst nicely removing a browser-error seen by a direct-connection, makes `mitmproxy` less transparent, and may prevent or interfere with certain types of testing.  Currently this behaviour cannot be configured; the behaviour should be absent or at least configurable, and preferably non-default.\n\nThe error-nilling occurs when accessing a domain via a name which is not the `Subject` `CN`, and also does not match a `subjectAltName` (SAN).  `mitmproxy` currently adds the client-request hostname to the SANs, even when upstream certificate-sniffing is enabled (default), so `mitmproxy` can see that the client's requested hostname does not match, but it is added to the certificate regardless.  This occurs [here](https://github.com/javabrett/mitmproxy/blob/master/mitmproxy/protocol/tls.py#L569).\n\nA good test-case is https://mitm.it/ , which is not-intended to be accessed over HTTPs, and when it is (directly), it serves the main `mitmproxy.org` website, but not before throwing a browser-error, because it is using `mitmproxy.org`'s certificate, which has no SAN for `mitm.it`.  If you `mitmproxy` this connection, the resulting generated certificate will have `mitm.it` as a SAN, and your browser-connection will be error-less.  Normally perhaps a nice thing in removing the error, but I didn't ask `mitmproxy` to do that, and it is sniffing upstream certs by-default, so I expect the cert to be more-or-less identical, other than the `Issuer` of course.\n##### Steps to reproduce the problem:\n1. Access https://mitm.it/ directly from your browser (no `mitmproxy`), observe CN mismatch warning and not mitm.it in CN or SAN.\n2. Access https://mitm.it/ via `mitmproxy` and observe that `mitm.it` appears in the certificate SAN.\n##### What is the expected behavior?\n- When upstream cert sniffing is enabled, just pass-through the `Subject` `CN` and the `subjectAltName` unmodified by-default.  Consider some _non-default_ runtime options to:\n  - Copy the `Subject` `CN` to a `subjectAltName` in the unusual case that there is a `subjectAltName`, but it does not contain the host data in `Subject` `CN`.  Note that this could change the acceptance of the cert in a client strictly adhering to RFC 2818 (Thunderbird 38?).  But can we find such an example certificate on the internet somewhere?\n  - Add the client-request hostname to the SANs (creating if necessary, in which case the `CN` also needs to be copied-in), to allow the current error-nullifying behaviour to be restored if desired.\n  - Always create `subjectAltName` if absent from (deprecated) `Subject` `CN`.  Probably unnecessary since clients always understand `Subject` `CN`.\n- When upstream cert sniffing is disabled with `--no-upstream-cert`, create both `Subject` `CN` (deprecated) and `subjectAltName` using that name.  Although this could result in a different certificate now having `subjectAltName`, there should be no difference to a client.  Hostname error-nullifying is enabled.\n##### What went wrong?\n\nGenerated cert allows more names than the upstream server cert.\n##### Any other comments?\n\nAn earlier change made in 375dbe070383caa79d9593a6d7a6b33eb0eb7a4a is correct, and stopped removing a hostname from the SANs, said removal/de-duplication being incorrect.  The relevant RFC 2818 https://tools.ietf.org/html/rfc2818 states:\n\n> 3.1 Server Identity\n> ...\n> If a subjectAltName extension of type dNSName is present, that MUST be used as the identity. Otherwise, the (most specific) Common Name field in the Subject field of the certificate MUST be used. Although the use of the Common Name is existing practice, it is deprecated and Certification Authorities are encouraged to use the dNSName instead.\n\nThat is, if there is a `subjectAltName`, for clients it ought to be read and be assumed authoritative and complete, and not unioned with a later-read `Subject` `CN`.  According to that, Thunderbird 38 as mentioned in the comment would be behaving correctly in ignoring the `Subject`.  Certificates that do not include the `Subject` hostname as a `dnsName` in `subjectAltName` are running-foul of the RFCs.\n\n---\n\nMitmproxy Version: master (d84fc64)\nOperating System: LinuxMint 17.1 3.13.0-24-generic #47-Ubuntu SMP Fri May 2 23:30:00 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux\n","reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/1108/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/1108/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"}]