{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4614","repository_url":"https://api.github.com/repos/mitmproxy/mitmproxy","labels_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4614/labels{/name}","comments_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4614/comments","events_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4614/events","html_url":"https://github.com/mitmproxy/mitmproxy/issues/4614","id":905936349,"node_id":"MDU6SXNzdWU5MDU5MzYzNDk=","number":4614,"title":"Options and Keybinding screen: home and end crash mitmproxy","user":{"login":"rbdixon","id":35279,"node_id":"MDQ6VXNlcjM1Mjc5","avatar_url":"https://avatars.githubusercontent.com/u/35279?v=4","gravatar_id":"","url":"https://api.github.com/users/rbdixon","html_url":"https://github.com/rbdixon","followers_url":"https://api.github.com/users/rbdixon/followers","following_url":"https://api.github.com/users/rbdixon/following{/other_user}","gists_url":"https://api.github.com/users/rbdixon/gists{/gist_id}","starred_url":"https://api.github.com/users/rbdixon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rbdixon/subscriptions","organizations_url":"https://api.github.com/users/rbdixon/orgs","repos_url":"https://api.github.com/users/rbdixon/repos","events_url":"https://api.github.com/users/rbdixon/events{/privacy}","received_events_url":"https://api.github.com/users/rbdixon/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":466930397,"node_id":"MDU6TGFiZWw0NjY5MzAzOTc=","url":"https://api.github.com/repos/mitmproxy/mitmproxy/labels/kind/triage","name":"kind/triage","color":"006b75","default":false,"description":"Unclassified issues"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2021-05-28T19:29:13Z","updated_at":"2021-08-02T17:18:23Z","closed_at":"2021-08-02T17:18:23Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"#### Problem Description\r\n\r\nIn both the Options and Keybindings views pressing home or end will crash mitmproxy.\r\n\r\n#### Steps to reproduce the behavior:\r\n\r\n1.  `mitmproxy`, K, Home\r\n\r\nor\r\n\r\n1. `mitmproxy`, O, Home\r\n\r\n#### System Information\r\n\r\n```\r\n$ mitmproxy --version\r\nMitmproxy: 7.0.0.dev (+449, commit 4f60e52)\r\nPython:    3.9.2\r\nOpenSSL:   OpenSSL 1.1.1k  25 Mar 2021\r\nPlatform:  Linux-5.10.0-kali3-amd64-x86_64-with-glibc2.31\r\n```\r\n\r\n```\r\nMitmproxy: 7.0.0.dev (+449, commit 4f60e52)\r\nPython:    3.9.4\r\nOpenSSL:   OpenSSL 1.1.1i  8 Dec 2020\r\nPlatform:  macOS-10.15.7-x86_64-i386-64bit\r\n```\r\n\r\n#### Patch\r\n\r\nNot really sure this is perfect but this fixed it locally. I can send this as a PR if it is appropriate.\r\n\r\n```diff\r\ndiff --git a/mitmproxy/tools/console/keybindings.py b/mitmproxy/tools/console/keybindings.py\r\nindex 312c19f94..6d08d135e 100644\r\n--- a/mitmproxy/tools/console/keybindings.py\r\n+++ b/mitmproxy/tools/console/keybindings.py\r\n@@ -66,6 +66,8 @@ class KeyListWalker(urwid.ListWalker):\r\n         self.index = index\r\n         self.focus_obj = self._get(self.index)\r\n         keybinding_focus_change.send(binding.help or \"\")\r\n+        self._modified()\r\n+\r\n \r\n     def get_next(self, pos):\r\n         if pos >= len(self.bindings) - 1:\r\n@@ -79,6 +81,12 @@ class KeyListWalker(urwid.ListWalker):\r\n             return None, None\r\n         return self._get(pos), pos\r\n \r\n+    def positions(self, reverse=False):\r\n+        if reverse:\r\n+            return reversed(range(len(self.bindings)))\r\n+        else:\r\n+            return range(len(self.bindings))\r\n+\r\n \r\n class KeyList(urwid.ListBox):\r\n     def __init__(self, master):\r\ndiff --git a/mitmproxy/tools/console/options.py b/mitmproxy/tools/console/options.py\r\nindex 5e5ef2a68..0c780f638 100644\r\n--- a/mitmproxy/tools/console/options.py\r\n+++ b/mitmproxy/tools/console/options.py\r\n@@ -142,6 +142,8 @@ class OptionListWalker(urwid.ListWalker):\r\n         self.index = index\r\n         self.focus_obj = self._get(self.index, self.editing)\r\n         option_focus_change.send(opt.help)\r\n+        self._modified()\r\n+\r\n \r\n     def get_next(self, pos):\r\n         if pos >= len(self.opts) - 1:\r\n@@ -155,6 +157,11 @@ class OptionListWalker(urwid.ListWalker):\r\n             return None, None\r\n         return self._get(pos, False), pos\r\n \r\n+    def positions(self, reverse=False):\r\n+        if reverse:\r\n+            return reversed(range(len(self.opts)))\r\n+        else:\r\n+            return range(len(self.opts))\r\n \r\n class OptionsList(urwid.ListBox):\r\n     def __init__(self, master):\r\n```\r\n","closed_by":{"login":"mhils","id":1019198,"node_id":"MDQ6VXNlcjEwMTkxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1019198?v=4","gravatar_id":"","url":"https://api.github.com/users/mhils","html_url":"https://github.com/mhils","followers_url":"https://api.github.com/users/mhils/followers","following_url":"https://api.github.com/users/mhils/following{/other_user}","gists_url":"https://api.github.com/users/mhils/gists{/gist_id}","starred_url":"https://api.github.com/users/mhils/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhils/subscriptions","organizations_url":"https://api.github.com/users/mhils/orgs","repos_url":"https://api.github.com/users/mhils/repos","events_url":"https://api.github.com/users/mhils/events{/privacy}","received_events_url":"https://api.github.com/users/mhils/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4614/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mitmproxy/mitmproxy/issues/4614/timeline","performed_via_github_app":null,"state_reason":"completed"}