<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:40:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CONFIGURATION-794] Unclosed file handle when reading config from JAR file URL</title>
                <link>https://issues.apache.org/jira/browse/CONFIGURATION-794</link>
                <project id="12310467" key="CONFIGURATION">Commons Configuration</project>
                    <description>&lt;p&gt;We read a properties file which is included in a JAR file. Unfortunately we cannot find any method to close the opened file handle after reading the properties.&lt;br/&gt;
This currently means that the JAR file can only be deleted after the JVM shuts down. I&apos;ll open a PR which shows the behavior.&lt;/p&gt;

&lt;p&gt;We currently run our code mostly on Windows systems and Oracle JDK8.&lt;/p&gt;

&lt;p&gt;PR: &lt;a href=&quot;https://github.com/apache/commons-configuration/pull/76&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-configuration/pull/76&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13334365">CONFIGURATION-794</key>
            <summary>Unclosed file handle when reading config from JAR file URL</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jansohn">Robin Jansohn</reporter>
                        <labels>
                    </labels>
                <created>Thu, 8 Oct 2020 07:19:46 +0000</created>
                <updated>Mon, 4 Jul 2022 15:07:34 +0000</updated>
                            <resolved>Tue, 13 Oct 2020 00:37:31 +0000</resolved>
                                    <version>2.7</version>
                                    <fixVersion>2.8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17210100" author="jansohn" created="Thu, 8 Oct 2020 09:27:22 +0000"  >&lt;p&gt;Seems to be Windows specific as we cannot reproduce the behavior when running on Linux...&lt;/p&gt;</comment>
                            <comment id="17211801" author="garydgregory" created="Sat, 10 Oct 2020 23:39:28 +0000"  >&lt;p&gt;Added test testGetConfigurationLoadFromJarFile().&lt;/p&gt;</comment>
                            <comment id="17211870" author="sebb@apache.org" created="Sun, 11 Oct 2020 10:19:04 +0000"  >&lt;p&gt;Windows locks JAR files when it opens them; this prevents deletion.&lt;/p&gt;

&lt;p&gt;Linux does not prevent deletion of open files.&lt;/p&gt;</comment>
                            <comment id="17211884" author="spoor" created="Sun, 11 Oct 2020 11:47:51 +0000"  >&lt;p&gt;I&apos;ve done some investigation, and the problem lies here, in &lt;tt&gt;FileHandler.load&lt;/tt&gt;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        InputStream in = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;

        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;
        {
            in = FileLocatorUtils.obtainFileSystem(locator).getInputStream(url);
            loadFromStream(in, locator.getEncoding(), url);
        }
        ...
        &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt;
        {
            closeSilent(in);
        }
    }&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;tt&gt;closeSilent&lt;/tt&gt; calls the following &lt;tt&gt;close&lt;/tt&gt; method:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;JarURLInputStream &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; java.io.FilterInputStream {
        JarURLInputStream (InputStream src) {
            &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt; (src);
        }
        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void close () &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.close();
            } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!getUseCaches()) {
                    jarFile.close();
                }
            }
        }
    }&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Here, &lt;tt&gt;getUseCaches()&lt;/tt&gt; returns &lt;tt&gt;true&lt;/tt&gt;, so the JAR file is not closed.&lt;/p&gt;

&lt;p&gt;A quick fix, in &lt;tt&gt;DefaultFileSystem.getInputStream&lt;/tt&gt;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;//            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; url.openStream();
&lt;/span&gt;            URLConnection connection = url.openConnection();
            connection.setUseCaches(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; connection.getInputStream();&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;However, this definitely requires more consideration, as it disables caching and therefore will open the JAR file every time.&lt;/p&gt;</comment>
                            <comment id="17211911" author="garydgregory" created="Sun, 11 Oct 2020 13:20:12 +0000"  >&lt;p&gt;We should surface this option IMO so that we can disable caching in tests at least. We can keep the default behavior as is if this ends up working.  &lt;/p&gt;

&lt;p&gt;WDYT?&lt;/p&gt;</comment>
                            <comment id="17211957" author="spoor" created="Sun, 11 Oct 2020 16:05:10 +0000"  >&lt;p&gt;Do you mean adding a flag somewhere to disable the caching, with caching enabled by default? Because I ran the failing test, and it succeeded with the quick fix applied. I didn&apos;t try any of the other tests so it&apos;s possible there could be failures, although I think it isn&apos;t likely.&lt;/p&gt;

&lt;p&gt;I think a flag would make sense. In most cases, there is no need to replace JAR files while the JVM is active. I&apos;ve never had this problem when using Commons Configuration inside JEE applications on Windows; EARs could be redeployed without any issues. If people need the option to have JAR files hot-swappable, then they could just set the flag, accepting the (possible) performance hit.&lt;/p&gt;</comment>
                            <comment id="17212750" author="garydgregory" created="Tue, 13 Oct 2020 00:37:31 +0000"  >&lt;p&gt;This fix requires you to disable caching, you will need to update code (from the test), from, for example:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; FileBasedConfigurationBuilder&amp;lt;PropertiesConfiguration&amp;gt; builder = 
            &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileBasedConfigurationBuilder&amp;lt;&amp;gt;(PropertiesConfiguration.class)
                .configure(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileBasedBuilderParametersImpl()
                .setURL(url));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;to:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; FileBasedConfigurationBuilder&amp;lt;PropertiesConfiguration&amp;gt; builder = 
            &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileBasedConfigurationBuilder&amp;lt;&amp;gt;(PropertiesConfiguration.class)
                .configure(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileBasedBuilderParametersImpl()
                .setURL(url, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; URLConnectionOptions().setUseCaches(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Note the use of &lt;tt&gt;FileBasedBuilderProperties&lt;/tt&gt;&apos;s&lt;br/&gt;
 &lt;tt&gt;setURL(URL, URLConnectionOptions)&lt;/tt&gt; &lt;br/&gt;
 instead of &lt;br/&gt;
 &lt;tt&gt;setURL(URL)&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="17213080" author="jansohn" created="Tue, 13 Oct 2020 12:04:57 +0000"  >&lt;p&gt;Thanks for investigating and fixing!&lt;/p&gt;</comment>
                            <comment id="17562203" author="mattjuntunen" created="Mon, 4 Jul 2022 15:07:34 +0000"  >&lt;p&gt;v2.8.0 released&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 18 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0jiow:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>