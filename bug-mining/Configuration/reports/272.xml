<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:39:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CONFIGURATION-712] FileHandlerReloadingDetector Does Not Correctly Initialize File Last Modified</title>
                <link>https://issues.apache.org/jira/browse/CONFIGURATION-712</link>
                <project id="12310467" key="CONFIGURATION">Commons Configuration</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://commons.apache.org/proper/commons-configuration/apidocs/src-html/org/apache/commons/configuration2/reloading/FileHandlerReloadingDetector.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;FileHandlerReloadingDetector&lt;/a&gt; declares the following method:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
150    @Override
151    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isReloadingRequired()
152    {
153        &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; now = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis();
154        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (now &amp;gt;= lastChecked + getRefreshDelay())
155        {
156            lastChecked = now;
157
158            &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; modified = getLastModificationDate();
159            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (modified &amp;gt; 0)
160            {
161                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (lastModified == 0)
162                {
163                    &lt;span class=&quot;code-comment&quot;&gt;// initialization
&lt;/span&gt;164                    updateLastModified(modified);
165                }
166                &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;
167                {
168                    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (modified != lastModified)
169                    {
170                        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
171                    }
172                }
173            }
174        }
175
176        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
177    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;During initialization of&#160;FileHandlerReloadingDetector, lastModified is never instantiated, so the first time isReloadingRequired() is invoked lastModified will be 0.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;This results in two issues:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Test #1&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Scenario Steps&#160;
	&lt;ol&gt;
		&lt;li&gt;Initialize&#160;ReloadingFileBasedConfigurationBuilder without invoking builder.getConfiguration()&lt;/li&gt;
		&lt;li&gt;Wait longer than refreshDelay&lt;/li&gt;
		&lt;li&gt;Invoke&#160;builder.getReloadingController().checkForReloading(null) to notify the&#160;FileHandlerReloadingDetector to check for reload&lt;/li&gt;
		&lt;li&gt;Invoke bulider.getConfiguration()&lt;/li&gt;
		&lt;li&gt;Update the properties file&lt;/li&gt;
		&lt;li&gt;Wait longer than refreshDelay&lt;/li&gt;
		&lt;li&gt;Invoke&#160;builder.getReloadingController().checkForReloading(null) to notify the&#160;FileHandlerReloadingDetector to check for reload&lt;/li&gt;
		&lt;li&gt;Invoke bulider.getConfiguration()&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
	&lt;li&gt;Result - the Configuration does not have the updated value.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Test #2&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Scenario Steps&#160;
	&lt;ol&gt;
		&lt;li&gt;Initialize&#160;ReloadingFileBasedConfigurationBuilder without invoking builder.getConfiguration()&lt;/li&gt;
		&lt;li&gt;Invoke bulider.getConfiguration()&lt;/li&gt;
		&lt;li&gt;Update the properties file&lt;/li&gt;
		&lt;li&gt;Wait longer than refreshDelay&lt;/li&gt;
		&lt;li&gt;Invoke&#160;builder.getReloadingController().checkForReloading(null) to notify the&#160;FileHandlerReloadingDetector to check for reload&lt;/li&gt;
		&lt;li&gt;Invoke bulider.getConfiguration()&lt;/li&gt;
		&lt;li&gt;Update the properties file&lt;/li&gt;
		&lt;li&gt;Wait longer than refreshDelay&lt;/li&gt;
		&lt;li&gt;Invoke&#160;builder.getReloadingController().checkForReloading(null) to notify the&#160;FileHandlerReloadingDetector to check for reload&lt;/li&gt;
		&lt;li&gt;Invoke bulider.getConfiguration()&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
	&lt;li&gt;Result - For the first two invocations, the Configuration is not updated. One the third invocation of builder.getConfiguration() the property is updated to the new value.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;As potential solution, the constructor of&#160;FileHandlerReloadingDetector should either call&#160;isReloadingRequired() or&#160;updateLastModified(getLastModificationDate()) to initialize the lastModified instance variable to the file current lastModified value.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13180555">CONFIGURATION-712</key>
            <summary>FileHandlerReloadingDetector Does Not Correctly Initialize File Last Modified</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rllndhbb">Rolland Hobbie</reporter>
                        <labels>
                    </labels>
                <created>Wed, 22 Aug 2018 20:56:37 +0000</created>
                <updated>Sun, 16 Sep 2018 20:24:11 +0000</updated>
                            <resolved>Sun, 16 Sep 2018 20:24:11 +0000</resolved>
                                    <version>2.3</version>
                                    <fixVersion>2.4</fixVersion>
                                    <component>File reloading</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="86400">24h</timeoriginalestimate>
                            <timeestimate seconds="86400">24h</timeestimate>
                                        <comments>
                            <comment id="16592692" author="oliver.heger@t-online.de" created="Sat, 25 Aug 2018 19:10:09 +0000"  >&lt;p&gt;Thanks for this report.&lt;/p&gt;

&lt;p&gt;I am not sure whether this is a bug, however, as the behavior is documented in the class comment:&lt;/p&gt;

&lt;p&gt;????&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;#808080&quot;&gt;* To initialize an instance either {&lt;/font&gt;&lt;font color=&quot;#808080&quot;&gt;@code &lt;/font&gt;&lt;font color=&quot;#808080&quot;&gt;isReloadingRequired()} or&lt;/font&gt;&lt;font color=&quot;#808080&quot;&gt;* {&lt;/font&gt;&lt;font color=&quot;#808080&quot;&gt;@code &lt;/font&gt;&lt;font color=&quot;#808080&quot;&gt;reloadingPerformed()} can be called. The first call of&lt;/font&gt;&lt;font color=&quot;#808080&quot;&gt;* {&lt;/font&gt;&lt;font color=&quot;#808080&quot;&gt;@code &lt;/font&gt;&lt;font color=&quot;#808080&quot;&gt;isReloadingRequired} does not perform a check, but obtains the initial&lt;/font&gt;&lt;font color=&quot;#808080&quot;&gt;* modification date of the monitored file. {&lt;/font&gt;&lt;font color=&quot;#808080&quot;&gt;@code &lt;/font&gt;&lt;font color=&quot;#808080&quot;&gt;reloadingPerformed()} always&lt;/font&gt;&lt;font color=&quot;#808080&quot;&gt;* obtains the file&apos;s modification date and stores it internally.&lt;/font&gt;&lt;/p&gt;

&lt;p&gt;The correct initialization of the reloading detector is indeed tricky. The solutions you describe are a bit problematic because they would require the constructor to call non-final methods on this instance.&lt;/p&gt;

&lt;p&gt;The assumption was that the behavior as implemented will probably not be an issue in practice. Do you encounter a real problem in production or is this only a theoretical observation?&lt;/p&gt;</comment>
                            <comment id="16597622" author="rllndhbb" created="Thu, 30 Aug 2018 16:21:30 +0000"  >&lt;p&gt;I&#160;saw the comment in&#160;FileHandlerReloadingDetector, however the&#160;ReloadingFileBasedConfigurationBuilder initializes this class using DefaultReloadingDetectorFactory so wouldn&apos;t the responsibility be for the&#160;factory to fully initialize FileHandlerReloadingDetector?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I also saw other places in the documentation&#160;state, &quot;If the underlying file has not been changed, this check has no effect. However, if the file has been changed by an external source, an updated last-modified date is detected, and the reloading detector signals a need for a reload&quot;&#160;(&lt;a href=&quot;https://commons.apache.org/proper/commons-configuration/userguide/howto_reloading.html)&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://commons.apache.org/proper/commons-configuration/userguide/howto_reloading.html)&lt;/a&gt;, with no mention of requiring further initialization of the&#160;ReloadingDetector.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Given the example in the documentation, both test scenarios fail.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Test #1 behaves the same as my example - incorrectly&#160;returns the initial configuration value (&quot;1&quot; not &quot;2&quot;)&lt;/li&gt;
	&lt;li&gt;Test #2 behaves the same as my example - incorrectly returns the&#160;initial configuration value for both the first and second invocations, and returns the updated value for the third invocation (&quot;3&quot; and the change of &quot;2&quot; is never seen)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I am unable to take my implementation&#160;to production because these tests scenarios fail. Given Test #1, if I change the trigger period to be 24 hours, and update the properties after 24 hours, the application would&#160;not&#160;see the updated&#160;changes. And, given Test #2 the changes would only be seen if the properties were updated a second time, and&#160;then only after another cycle&#160;of the triggering&#160;period&#160;(in the case of 24 hours only after 48 hours), but the first change would never be seen by the application.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16599653" author="oliver.heger@t-online.de" created="Sat, 1 Sep 2018 15:07:38 +0000"  >&lt;p&gt;Letting &lt;tt&gt;DefaultReloadingDetectorFactory&lt;/tt&gt; take care for the initialization of the reloading detector is a good idea. We can change this. Do you want to create a patch for this?&lt;/p&gt;

&lt;p&gt;Also, if you have concrete suggestions how to improve documentation, please let us know; this is highly appreciated.&lt;/p&gt;</comment>
                            <comment id="16609247" author="rllndhbb" created="Mon, 10 Sep 2018 13:59:36 +0000"  >&lt;p&gt;I have attached a patch for the change fix.&lt;/p&gt;

&lt;p&gt;I ended up creating a new refresh() method on&#160;FileHandlerReloadingDetector,&#160;which initializes the last modified field. I thought it was confusing for the factory to invoke reloadingPerformed() in order to initialize last modified.&#160;I considered other approaches for this fix, but decided on this approach as it was the most isolated change and the least impact.&lt;/p&gt;

&lt;p&gt;If other *ReloadingDetector implementations will&#160;need&#160;the ability of initializing state, maybe a new interface could be created to define refresh()?&lt;/p&gt;</comment>
                            <comment id="16615222" author="oliver.heger@t-online.de" created="Fri, 14 Sep 2018 18:37:35 +0000"  >&lt;p&gt;Thanks for the patch!&lt;/p&gt;

&lt;p&gt;It looks good, and I also like the idea with the new refresh() method. The only thing I am not sure about is the change on the isReloadingRequired() method. Is this really necessary?&lt;/p&gt;

&lt;p&gt;If I understand correctly, the changed method now expects that refresh() has been called before. This would change the behavior for users that create an instance of FileHandlerReloadingDetector directly without the factory. If the method was not changed, it would now still work correctly with the updated factory, wouldn&apos;t it?&lt;/p&gt;</comment>
                            <comment id="16615273" author="rllndhbb" created="Fri, 14 Sep 2018 19:21:31 +0000"  >&lt;p&gt;That&apos;s a fair point, which I did not consider.&lt;/p&gt;

&lt;p&gt;I don&apos;t think it is necessary to include the change for the isReloadingRequired() method.&lt;/p&gt;

&lt;p&gt;I can recreate the patch and rerun the unit tests to verify.&lt;/p&gt;</comment>
                            <comment id="16616366" author="oliver.heger@t-online.de" created="Sat, 15 Sep 2018 15:45:43 +0000"  >&lt;p&gt;Yes, this would be great. Many thanks in advance!&lt;/p&gt;</comment>
                            <comment id="16616600" author="rllndhbb" created="Sun, 16 Sep 2018 05:38:26 +0000"  >&lt;p&gt;I have attached the updated patch. I reverted the change&#160;in the&#160;isReloadingRequired() method of&#160;FileHandlerReloadingDetector. I also reverted the two test methods that were changed (leaving these methods unchanged to validate the original functionality), and added two new methods to test the new functionality with invoking the refresh method after instantiation.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Since you asked about documentation, I think it would be worth&#160;adding a note to&#160;FileHandlerReloadingDetector along the lines of:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;There is a cycle between the instantiation of&#160;FileHandlerReloadingDetector and the first invocation of&#160;isReloadingRequired() where no file changes are detected. The first file change detected by default is&#160;after the first&#160;invocation of&#160;isReloadingRequired(), and because&#160;FileHandlerReloadingDetector is recreated when the configuration is reset, this &quot;unobserved cycle&quot; is repeated after every reload of a configuration. To eliminate this &quot;unobserved cycle&quot;, the refresh() method can be invoked after instantiation to force the FileHandlerReloadingDetector to load the file&apos;s current last modified date, which is used in future calls of&#160;isReloadingRequired() to determine if the file has changed.&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="16616885" author="oliver.heger@t-online.de" created="Sun, 16 Sep 2018 20:24:11 +0000"  >&lt;p&gt;Patch applied in SVN revision 1841034. Many thanks again!&lt;/p&gt;

&lt;p&gt;If you want to be added to the contributor&apos;s section in pom.xml, please post the data you want to get in.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12939864" name="CONFIGURATION-712-InitializeLastModified.patch" size="4220" author="rllndhbb" created="Sun, 16 Sep 2018 05:37:13 +0000"/>
                            <attachment id="12937781" name="ReloadingFileBasedConfigurationBuilderExampleTest.java" size="6199" author="rllndhbb" created="Thu, 30 Aug 2018 16:17:43 +0000"/>
                            <attachment id="12936702" name="ReloadingFileBasedConfigurationBuilderTest.java" size="6040" author="rllndhbb" created="Wed, 22 Aug 2018 20:44:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 8 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3xbkv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>