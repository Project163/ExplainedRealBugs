<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:36:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CONFIGURATION-280] autoSave and FileChangedReloadingStrategy corrupts configuration</title>
                <link>https://issues.apache.org/jira/browse/CONFIGURATION-280</link>
                <project id="12310467" key="CONFIGURATION">Commons Configuration</project>
                    <description>&lt;p&gt;First of all, sorry if this is not a bug. I may have missed some information on how to make autoSave and FileChangedReloadingStrategy work.&lt;/p&gt;

&lt;p&gt;When a change has been detected by the FileChangedReloadingStrategy code, a clear() followed by a load() is executed in the AbstractFileConfiguration class (around line 809 of version 1.4). The clear() method leads to a possiblySave() call which overwrites the configuration. At the end of the clear() method, the configuration file is empty and the following load() method loads this empty configuration. The possiblySave() call is invoked via the work-around (according to the comment in the code) in AbstractConfiguration (line 538).&lt;/p&gt;

&lt;p&gt;I&apos;m using the following code:&lt;/p&gt;

&lt;p&gt;CompositeConfiguration config = new CompositeConfiguration();&lt;br/&gt;
XMLConfiguration xmlconfig = new XMLConfiguration(&quot;config.xml&quot;);&lt;br/&gt;
FileChangedReloadingStrategy fcrs = new FileChangedReloadingStrategy();&lt;br/&gt;
xmlconfig.setReloadingStrategy(fcrs);&lt;br/&gt;
config.addConfiguration(new SystemConfiguration());&lt;br/&gt;
config.addConfiguration(xmlconfig);&lt;br/&gt;
xmlconfig.setAutoSave(true);&lt;br/&gt;
...wait for config changes...		&lt;/p&gt;


&lt;p&gt;A workaround for the problem is to deactivate autoSave in the reload() method of the AbstractFileConfiguration class. After the configuration is cleared and loaded, the original autoSave is restored. See the diff below:&lt;/p&gt;

&lt;p&gt;806a807,808&lt;br/&gt;
&amp;gt;                         boolean autoSaveBak = this.isAutoSave(); // save the current state&lt;br/&gt;
&amp;gt;                         this.setAutoSave(false); // deactivate autoSave to prevent information loss&lt;br/&gt;
813a816&lt;br/&gt;
&amp;gt;                               this.setAutoSave(autoSaveBak); // set autoSave to previous value&lt;/p&gt;


&lt;p&gt;The code fragment looks like:&lt;br/&gt;
--------------------------&lt;br/&gt;
                    if (strategy.reloadingRequired())&lt;br/&gt;
                    {&lt;br/&gt;
                        if (getLogger().isInfoEnabled())&lt;/p&gt;
                        {
                            getLogger().info(&quot;Reloading configuration. URL is &quot; + getURL());
                        }
&lt;p&gt;                        fireEvent(EVENT_RELOAD, null, getURL(), true);&lt;br/&gt;
                        setDetailEvents(false);&lt;br/&gt;
                        boolean autoSaveBak = this.isAutoSave(); // save the current state&lt;br/&gt;
                        this.setAutoSave(false); // deactivate autoSave to prevent information loss&lt;br/&gt;
                        try&lt;/p&gt;
                        {
                            clear();
                            load();
                        }
&lt;p&gt;                        finally&lt;/p&gt;
                        {
                                this.setAutoSave(autoSaveBak); // set autoSave to previous value
                            setDetailEvents(true);
                        }
&lt;p&gt;                        fireEvent(EVENT_RELOAD, null, getURL(), false);&lt;/p&gt;

&lt;p&gt;                        // notify the strategy&lt;br/&gt;
                        strategy.reloadingPerformed();&lt;br/&gt;
                    }&lt;br/&gt;
--------------------------&lt;/p&gt;

&lt;p&gt;I hope this is a valid fix. &lt;/p&gt;</description>
                <environment>&lt;p&gt;Linux, Sun Java 5&lt;/p&gt;</environment>
        <key id="12371179">CONFIGURATION-280</key>
            <summary>autoSave and FileChangedReloadingStrategy corrupts configuration</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="oheger">Oliver Heger</assignee>
                                    <reporter username="roman.kurmanowytsch">Roman Kurmanowytsch</reporter>
                        <labels>
                    </labels>
                <created>Thu, 7 Jun 2007 21:33:35 +0000</created>
                <updated>Sat, 22 Aug 2009 19:36:49 +0000</updated>
                            <resolved>Sun, 10 Jun 2007 16:11:36 +0000</resolved>
                                    <version>1.4</version>
                                    <fixVersion>1.5</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12502536" author="roman.kurmanowytsch" created="Thu, 7 Jun 2007 21:36:27 +0000"  >&lt;p&gt;This may be related to ticket 119:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://issues.apache.org/jira/browse/CONFIGURATION-119&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/CONFIGURATION-119&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12502558" author="roman.kurmanowytsch" created="Thu, 7 Jun 2007 22:24:17 +0000"  >&lt;p&gt;Added patch based on trunk revision 545335.&lt;/p&gt;</comment>
                            <comment id="12503181" author="oliver.heger@t-online.de" created="Sun, 10 Jun 2007 16:11:36 +0000"  >&lt;p&gt;Patch applied. A test case was also added.&lt;/p&gt;

&lt;p&gt;Many thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12359217" name="autosave_reload.patch.txt" size="1143" author="roman.kurmanowytsch" created="Thu, 7 Jun 2007 22:24:16 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33978</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            18 years, 24 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0uozr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>177190</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>