<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:37:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CONFIGURATION-293] HierarchicalConfiguration.clearTree() does not remove named property</title>
                <link>https://issues.apache.org/jira/browse/CONFIGURATION-293</link>
                <project id="12310467" key="CONFIGURATION">Commons Configuration</project>
                    <description>&lt;p&gt;HierarchicalConfiguration.clearTree(String) calls HierarchicalConfiguration.removeNode(ConfigurationNode) which removes nothing if the passed in ConfigurationNode has no parent. Having no parent is true of nodes that have the root for their parent (it seems to me) as well as for nodes that have no properties defined &quot;above&quot; them. Here is an example:&lt;/p&gt;

&lt;p&gt;config.addProperty(&quot;a.b.c&quot;, &quot;c&quot;);&lt;br/&gt;
config.addProperty(&quot;a.b.c.d&quot;, &quot;d&quot;);&lt;br/&gt;
config.addProperty(&quot;a.b.c.d.e&quot;, &quot;e&quot;);&lt;/p&gt;

&lt;p&gt;The following sequence of calls will fail:&lt;br/&gt;
config.clearTree(&quot;a.b.c&quot;);&lt;br/&gt;
assert config.containsKey(&quot;a.b.c&quot;) == false;&lt;/p&gt;

&lt;p&gt;The following sequence of calls will succeed:&lt;br/&gt;
config.clearTree(&quot;a.b.c.d&quot;);&lt;br/&gt;
assert config.containsKey(&quot;a.b.c.d&quot;) == false;&lt;br/&gt;
assert config.containsKey(&quot;a.b.c.d.e&quot;) == false;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12376550">CONFIGURATION-293</key>
            <summary>HierarchicalConfiguration.clearTree() does not remove named property</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="josuah">Wesley Miaw</reporter>
                        <labels>
                    </labels>
                <created>Tue, 21 Aug 2007 23:08:48 +0000</created>
                <updated>Sat, 22 Aug 2009 19:36:50 +0000</updated>
                            <resolved>Fri, 24 Aug 2007 15:10:41 +0000</resolved>
                                    <version>1.4</version>
                                    <fixVersion>1.5</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12521846" author="oliver.heger@t-online.de" created="Wed, 22 Aug 2007 16:29:58 +0000"  >&lt;p&gt;I tried to reproduce the problem, but without success. The following test case (which I have added to TestHierarchicalConfiguration) based on your description does not cause any problems (on the current SVN head):&lt;/p&gt;

&lt;p&gt;    public void testClearTreeHierarchy()&lt;/p&gt;
    {
        config.addProperty(&quot;a.b.c&quot;, &quot;c&quot;);
        config.addProperty(&quot;a.b.c.d&quot;, &quot;d&quot;);
        config.addProperty(&quot;a.b.c.d.e&quot;, &quot;e&quot;);
        config.clearTree(&quot;a.b.c&quot;);
        assertFalse(&quot;Property not removed&quot;, config.containsKey(&quot;a.b.c&quot;));
        assertFalse(&quot;Sub property not removed&quot;, config.containsKey(&quot;a.b.c.d&quot;));
    }

&lt;p&gt;The code of removeNode() seems okay to me. It removes the affected node from its parent, which effectively causes the whole sub tree to be removed from the configuration.&lt;/p&gt;

&lt;p&gt;Can you please double-check?&lt;/p&gt;</comment>
                            <comment id="12521907" author="josuah" created="Wed, 22 Aug 2007 19:46:56 +0000"  >&lt;p&gt;Yeah. I looked into removeNode() and the code makes sense. I just tried again and it works, unless you have the following set up. I&apos;ll attach the bug-config.xml and the two files it tries to load up as well. (This is a CombinedConfiguration; I can only make this happen with the CombinedConfiguration, it works fine if either of the two files mentioned in bug-config.xml loses its inner-most definition (i.e. bug-override.xml only has &amp;lt;a&amp;gt;&amp;lt;/a&amp;gt; or bug-test.properties is empty).&lt;/p&gt;

&lt;p&gt;	final String prefix = &quot;a.b.c&quot;;&lt;br/&gt;
	public void clearTree() throws ConfigurationException &lt;/p&gt;
{
		final URL xml = this.getClass().getClassLoader().getResource(&quot;bug-config.xml&quot;);
		final DefaultConfigurationBuilder builder = new DefaultConfigurationBuilder(xml);
		final CombinedConfiguration config = (CombinedConfiguration)builder.getConfiguration(true);
		
		config.addProperty(prefix, &quot;c&quot;);
		config.addProperty(prefix + &quot;.d&quot;, &quot;d&quot;);
		config.addProperty(prefix + &quot;.d.e&quot;, &quot;e&quot;);
        
		config.clearTree(prefix);
		assert !config.containsKey(prefix + &quot;.d&quot;) : &quot;Sub property not removed&quot;;
		assert !config.containsKey(prefix) : &quot;Property not removed&quot;;
	}</comment>
                            <comment id="12521909" author="josuah" created="Wed, 22 Aug 2007 19:48:35 +0000"  >&lt;p&gt;The CombinedConfiguration initialization files for the situation described by this bug.&lt;/p&gt;</comment>
                            <comment id="12522059" author="oliver.heger@t-online.de" created="Thu, 23 Aug 2007 08:19:30 +0000"  >&lt;p&gt;Ah, I think I know now what is going on.&lt;/p&gt;

&lt;p&gt;With a CombinedConfiguration things are a little bit different. The node structure of a combined configuration is constructed from the nodes of its contained child configurations each time one of the children is modified. In your test you remove a sub tree, which causes a child configuration to be changed and results in an update event. This event causes the combined configuration to be re-created. This time, because an override node combiner is used (the child configurations are defined in an &amp;lt;override&amp;gt; section), the just deleted sub tree is pulled in from another child configuration.&lt;/p&gt;

&lt;p&gt;The following section of the user guide contains more information about updates on combined configurations; it should give you some background information about what is happening:&lt;br/&gt;
&lt;a href=&quot;http://commons.apache.org/configuration/userguide/howto_combinedconfiguration.html#Dealing_with_changes&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://commons.apache.org/configuration/userguide/howto_combinedconfiguration.html#Dealing_with_changes&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Well, how should this issue be treated? What you have found here is a known limitation of CombinedConfiguration. Given its design, it is not trivial to change. So I tend to resolve this issue as Won&apos;t fix. What do you think?&lt;/p&gt;</comment>
                            <comment id="12522195" author="josuah" created="Thu, 23 Aug 2007 17:00:57 +0000"  >&lt;p&gt;So I reimplemented clearTree() as follows, and it does what I expect it to do this way.&lt;/p&gt;

&lt;p&gt;  Iterator&amp;lt;String&amp;gt; keys = getKeys(key);&lt;br/&gt;
  while (keys.hasNext()) &lt;/p&gt;
{
    clearProperty(keys.next());
  }
&lt;p&gt;  if (containsKey(key)) &lt;/p&gt;
{
    clearProperty(key);
  }

&lt;p&gt;the getKeys() while loop clears out all of the sub-properties, and clearProperty(key) does the right thing because it actually sets the value of the property to null. So even though the node isn&apos;t actually removed because it has no parent, it has no value anymore. From what I understand, this fulfills the contract of clear*(), since technically none of the clear*() methods say the nodes are removed, just that they have no value.&lt;/p&gt;

&lt;p&gt;Of course, this fires off EVENT_CLEAR_PROPERTY instead of EVENT_CLEAR_TREE, but that&apos;s just because the above code calls the public methods.&lt;/p&gt;

&lt;p&gt;But that doesn&apos;t really match up with how you described it (and as the documentation mentions). Why is it that in a non-CombinedConfiguration, the node would have a parent, but in a CombinedConfiguration, it doesn&apos;t?&lt;/p&gt;</comment>
                            <comment id="12522210" author="oliver.heger@t-online.de" created="Thu, 23 Aug 2007 18:10:41 +0000"  >&lt;p&gt;As far as I understand it, clearTree() indeed removes a node from the combined configuration. This affects the child configuration, from which this node was obtained. After that the combined configuration has to be re-constructed. In this process the used override combiner will again add a node that matches the just removed key - but this time it is obtained from the other child configuration.&lt;/p&gt;

&lt;p&gt;The only save way of implementing your clearTree() method would be to iterate over all child configurations and to call clearTree() on them. Then you can be sure that all possible nodes have been removed.&lt;/p&gt;</comment>
                            <comment id="12522226" author="josuah" created="Thu, 23 Aug 2007 18:57:08 +0000"  >&lt;p&gt;I understand what you&apos;re saying, but tracing the code for clearTree() in this example case does not seem to modify the internal structure at all. So I don&apos;t see how the node is actually removed from anything.&lt;/p&gt;

&lt;p&gt;Well, I&apos;ll let you guys figure out if you&apos;d like to change this behavior, and if so, how you would do it. Iterating over the configurations to call clearTree() doesn&apos;t work because there&apos;s no guarantee a child configuration is an instance of HierarchicalConfiguration.&lt;/p&gt;

&lt;p&gt;It just seems to me that CombinedConfiguration, as a subclass of HierarchicalConfiguration, should not result in behavior different than that documented by HierarchicalConfiguration, otherwise things don&apos;t do what you&apos;d expect inheritance-wise.&lt;/p&gt;</comment>
                            <comment id="12522246" author="oliver.heger@t-online.de" created="Thu, 23 Aug 2007 19:47:26 +0000"  >&lt;p&gt;If nothing gets removed, this is probably because you have hit one of the &quot;link&quot; nodes that have been added by the NodeCombiner. Those nodes may indeed have no parent.&lt;/p&gt;

&lt;p&gt;Your statements about inheritance do make sense. OTOH a CombinedConfiguration acts like a logic view on an arbitrary number of child configurations. And this view is constructed by a pluggable strategy, a NodeCombiner. In this scenario I simply see no way of implementing all the operations defined in HierarchicalConfiguration in a generic way that is compatible with each possible NodeCombiner. Hence the warning in the user guide about updates of a combined configuration. Maybe this fact should be made more obvious in the class&apos;s documentation?&lt;/p&gt;</comment>
                            <comment id="12522254" author="josuah" created="Thu, 23 Aug 2007 20:07:07 +0000"  >&lt;p&gt;Maybe examples would help to illustrate the issue. I took &quot;It is not strictly forbidden to manipulate a CombinedConfiguration directly, but the results may be unpredictable.&quot; to mean if I tried to play around with its insides in a way other than the public interface.&lt;/p&gt;</comment>
                            <comment id="12522556" author="oliver.heger@t-online.de" created="Fri, 24 Aug 2007 15:10:41 +0000"  >&lt;p&gt;The javadocs for CombinedConfiguration have been updated with some examples why updates on such a configuration can be problematic.&lt;/p&gt;

&lt;p&gt;Closing this issue as Won&apos;t fix because no code is altered.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12364346" name="bug-config.xml" size="217" author="josuah" created="Wed, 22 Aug 2007 19:48:35 +0000"/>
                            <attachment id="12364347" name="bug-override.xml" size="95" author="josuah" created="Wed, 22 Aug 2007 19:48:35 +0000"/>
                            <attachment id="12364348" name="bug-test.properties" size="13" author="josuah" created="Wed, 22 Aug 2007 19:48:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33852</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            18 years, 14 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0uqlj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>177450</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>