{"url":"https://api.github.com/repos/sirupsen/logrus/issues/88","repository_url":"https://api.github.com/repos/sirupsen/logrus","labels_url":"https://api.github.com/repos/sirupsen/logrus/issues/88/labels{/name}","comments_url":"https://api.github.com/repos/sirupsen/logrus/issues/88/comments","events_url":"https://api.github.com/repos/sirupsen/logrus/issues/88/events","html_url":"https://github.com/sirupsen/logrus/issues/88","id":51509568,"node_id":"MDU6SXNzdWU1MTUwOTU2OA==","number":88,"title":"JSON prefix clash avoidance uses old messages","user":{"login":"nickvanw","id":1907071,"node_id":"MDQ6VXNlcjE5MDcwNzE=","avatar_url":"https://avatars.githubusercontent.com/u/1907071?v=4","gravatar_id":"","url":"https://api.github.com/users/nickvanw","html_url":"https://github.com/nickvanw","followers_url":"https://api.github.com/users/nickvanw/followers","following_url":"https://api.github.com/users/nickvanw/following{/other_user}","gists_url":"https://api.github.com/users/nickvanw/gists{/gist_id}","starred_url":"https://api.github.com/users/nickvanw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickvanw/subscriptions","organizations_url":"https://api.github.com/users/nickvanw/orgs","repos_url":"https://api.github.com/users/nickvanw/repos","events_url":"https://api.github.com/users/nickvanw/events{/privacy}","received_events_url":"https://api.github.com/users/nickvanw/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":61224100,"node_id":"MDU6TGFiZWw2MTIyNDEwMA==","url":"https://api.github.com/repos/sirupsen/logrus/labels/bug","name":"bug","color":"fc2929","default":true,"description":null}],"state":"closed","locked":false,"assignee":{"login":"aybabtme","id":1189716,"node_id":"MDQ6VXNlcjExODk3MTY=","avatar_url":"https://avatars.githubusercontent.com/u/1189716?v=4","gravatar_id":"","url":"https://api.github.com/users/aybabtme","html_url":"https://github.com/aybabtme","followers_url":"https://api.github.com/users/aybabtme/followers","following_url":"https://api.github.com/users/aybabtme/following{/other_user}","gists_url":"https://api.github.com/users/aybabtme/gists{/gist_id}","starred_url":"https://api.github.com/users/aybabtme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aybabtme/subscriptions","organizations_url":"https://api.github.com/users/aybabtme/orgs","repos_url":"https://api.github.com/users/aybabtme/repos","events_url":"https://api.github.com/users/aybabtme/events{/privacy}","received_events_url":"https://api.github.com/users/aybabtme/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"aybabtme","id":1189716,"node_id":"MDQ6VXNlcjExODk3MTY=","avatar_url":"https://avatars.githubusercontent.com/u/1189716?v=4","gravatar_id":"","url":"https://api.github.com/users/aybabtme","html_url":"https://github.com/aybabtme","followers_url":"https://api.github.com/users/aybabtme/followers","following_url":"https://api.github.com/users/aybabtme/following{/other_user}","gists_url":"https://api.github.com/users/aybabtme/gists{/gist_id}","starred_url":"https://api.github.com/users/aybabtme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aybabtme/subscriptions","organizations_url":"https://api.github.com/users/aybabtme/orgs","repos_url":"https://api.github.com/users/aybabtme/repos","events_url":"https://api.github.com/users/aybabtme/events{/privacy}","received_events_url":"https://api.github.com/users/aybabtme/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":1,"created_at":"2014-12-10T02:12:05Z","updated_at":"2014-12-10T19:08:18Z","closed_at":"2014-12-10T19:07:28Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I'm not sure how many other people use logrus in this manner, but it's very common that I create a single `log` instance to use throughout a HTTP route or log-running method, so that I can set the fields once and continue to use this. I find this incredibly useful for tracking the file or route that I'm working on, etc. \n\nUnfortunately, the prefix-clash copies the last-used message as `fields.msg`, causing each log line after the first to contain the message for the previous log. Here's a small program that demonstrates this:\n\n```\npackage main\n\nimport (\n    log \"github.com/Sirupsen/logrus\"\n)\n\n\nfunc init() {\n  // Log as JSON instead of the default ASCII formatter.\n  log.SetFormatter(&log.JSONFormatter{})\n}\n\nfunc main() {\n    ll := log.WithFields(log.Fields{\"test_field\":\"test_field_data\"})\n    ll.Info(\"Test Message 1\")\n    ll.Info(\"Test Message 2\")\n}\n```\n\nThis will output the following (I've pretty printed it):\n\n```\n{\n  \"level\": \"info\",\n  \"msg\": \"Test Message 1\",\n  \"test_field\": \"test_field_data\",\n  \"time\": \"2014-12-09T18:11:38-08:00\"\n}\n{\n  \"fields.level\": \"info\",\n  \"fields.msg\": \"Test Message 1\",\n  \"fields.time\": \"2014-12-09T18:11:38-08:00\",\n  \"level\": \"info\",\n  \"msg\": \"Test Message 2\",\n  \"test_field\": \"test_field_data\",\n  \"time\": \"2014-12-09T18:11:38-08:00\"\n}\n```\n\nNotice how the second log has the correct message in the `message` field, but `fields.msg` contains the `msg` body from the previous. Furthermore, the `fields` data is not present in the first log at all. \n","closed_by":{"login":"sirupsen","id":97400,"node_id":"MDQ6VXNlcjk3NDAw","avatar_url":"https://avatars.githubusercontent.com/u/97400?v=4","gravatar_id":"","url":"https://api.github.com/users/sirupsen","html_url":"https://github.com/sirupsen","followers_url":"https://api.github.com/users/sirupsen/followers","following_url":"https://api.github.com/users/sirupsen/following{/other_user}","gists_url":"https://api.github.com/users/sirupsen/gists{/gist_id}","starred_url":"https://api.github.com/users/sirupsen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sirupsen/subscriptions","organizations_url":"https://api.github.com/users/sirupsen/orgs","repos_url":"https://api.github.com/users/sirupsen/repos","events_url":"https://api.github.com/users/sirupsen/events{/privacy}","received_events_url":"https://api.github.com/users/sirupsen/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sirupsen/logrus/issues/88/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sirupsen/logrus/issues/88/timeline","performed_via_github_app":null,"state_reason":"completed"}