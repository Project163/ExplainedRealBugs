diff --git a/gofmt.go b/gofmt.go
index 1a9841b..5df768d 100644
--- a/gofmt.go
+++ b/gofmt.go
@@ -257,14 +257,23 @@ func (r *reporter) Report(err error) {
 		panic("Report with nil error")
 	}
 	st := r.getState()
-	scanner.PrintError(st.err, err)
-	st.exitCode = 2
+	switch err.(type) {
+	case printedDiff:
+		st.exitCode = 1
+	default:
+		scanner.PrintError(st.err, err)
+		st.exitCode = 2
+	}
 }
 
 func (r *reporter) ExitCode() int {
 	return r.getState().exitCode
 }
 
+type printedDiff struct{}
+
+func (printedDiff) Error() string { return "printed a diff, exiting with status code 1" }
+
 // If info == nil, we are formatting stdin instead of a file.
 // If in == nil, the source is the contents of the file with the given filename.
 func processFile(filename string, info fs.FileInfo, in io.Reader, r *reporter, explicit bool) error {
@@ -358,6 +367,7 @@ func processFile(filename string, info fs.FileInfo, in io.Reader, r *reporter, e
 			newName := filepath.ToSlash(filename)
 			oldName := newName + ".orig"
 			r.Write(diff.Diff(oldName, src, newName, res))
+			return printedDiff{}
 		}
 	}
 
diff --git a/testdata/script/diff.txtar b/testdata/script/diff.txtar
index 1dadf1d..0572186 100644
--- a/testdata/script/diff.txtar
+++ b/testdata/script/diff.txtar
@@ -1,10 +1,10 @@
-# gofumpt fails with -d if there is a diff (TODO).
+# gofumpt fails with -d if there is a diff.
 
 exec gofumpt -d good.go
 ! stdout .
 ! stderr .
 
-exec gofumpt -d bad.go
+! exec gofumpt -d bad.go
 cmp stdout bad.go.diff
 ! stderr .
 
