{"url":"https://api.github.com/repos/mvdan/gofumpt/issues/29","repository_url":"https://api.github.com/repos/mvdan/gofumpt","labels_url":"https://api.github.com/repos/mvdan/gofumpt/issues/29/labels{/name}","comments_url":"https://api.github.com/repos/mvdan/gofumpt/issues/29/comments","events_url":"https://api.github.com/repos/mvdan/gofumpt/issues/29/events","html_url":"https://github.com/mvdan/gofumpt/issues/29","id":470351511,"node_id":"MDU6SXNzdWU0NzAzNTE1MTE=","number":29,"title":"Panic when grouping imports","user":{"login":"tie","id":14792994,"node_id":"MDQ6VXNlcjE0NzkyOTk0","avatar_url":"https://avatars.githubusercontent.com/u/14792994?v=4","gravatar_id":"","url":"https://api.github.com/users/tie","html_url":"https://github.com/tie","followers_url":"https://api.github.com/users/tie/followers","following_url":"https://api.github.com/users/tie/following{/other_user}","gists_url":"https://api.github.com/users/tie/gists{/gist_id}","starred_url":"https://api.github.com/users/tie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tie/subscriptions","organizations_url":"https://api.github.com/users/tie/orgs","repos_url":"https://api.github.com/users/tie/repos","events_url":"https://api.github.com/users/tie/events{/privacy}","received_events_url":"https://api.github.com/users/tie/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-07-19T14:20:32Z","updated_at":"2019-07-20T19:34:33Z","closed_at":"2019-07-20T19:34:33Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"`gofumpt` panics when grouping unindented standard library and third-party imports.\r\n\r\nTested on the following Go versions:\r\n- `go1.12.6`\r\n- `go1.13-adcb2b1e7a`\r\n\r\nSteps to reproduce:\r\n\r\nRun `gofumpt` with the following input:\r\n\r\n```go\r\nimport (\r\n\"a\"\r\n\"a.b\"\r\n)\r\n```\r\n\r\nExpected output:\r\n```go\r\nimport (\r\n\t\"a\"\r\n\r\n\t\"a.b\"\r\n)\r\n```\r\n\r\nActual output:\r\n<details>\r\n<summary>stderr</summary>\r\n\r\n  ```\r\n  panic: could not set lines to [0 19 23 23 29] [recovered]\r\n  \tpanic: could not set lines to [0 19 23 23 29]\r\n  \r\n  goroutine 1 [running]:\r\n  golang.org/x/tools/go/ast/astutil.Apply.func1(0xc0000d40c0, 0xc0000bfc50)\r\n  \tgolang.org/x/tools@v0.0.0-20190625160430-252024b82959/go/ast/astutil/rewrite.go:47 +0xa3\r\n  panic(0x1152ae0, 0xc0000d40f0)\r\n  \truntime/panic.go:663 +0x1b2\r\n  mvdan.cc/gofumpt/internal.(*fumpter).addNewline(0xc0000ce160, 0x2e)\r\n  \tmvdan.cc/gofumpt@/internal/gofumpt.go:123 +0x584\r\n  mvdan.cc/gofumpt/internal.(*fumpter).joinStdImports(0xc0000ce160, 0xc0000da080)\r\n  \tmvdan.cc/gofumpt@/internal/gofumpt.go:409 +0x1fc\r\n  mvdan.cc/gofumpt/internal.(*fumpter).applyPre(0xc0000ce160, 0xc000082130)\r\n  \tmvdan.cc/gofumpt@/internal/gofumpt.go:241 +0x98d\r\n  mvdan.cc/gofumpt/internal.Gofumpt.func1(0xc000082130, 0xc0000d01a0)\r\n  \tmvdan.cc/gofumpt@/internal/gofumpt.go:50 +0x39\r\n  golang.org/x/tools/go/ast/astutil.(*application).apply(0xc000082120, 0x11c0a40, 0xc0000de100, 0x119047d, 0x5, 0xc000082168, 0x11c0b80, 0xc0000da080)\r\n  \tgolang.org/x/tools@v0.0.0-20190625160430-252024b82959/go/ast/astutil/rewrite.go:198 +0x3c18\r\n  golang.org/x/tools/go/ast/astutil.(*application).applyList(0xc000082120, 0x11c0a40, 0xc0000de100, 0x119047d, 0x5)\r\n  \tgolang.org/x/tools@v0.0.0-20190625160430-252024b82959/go/ast/astutil/rewrite.go:473 +0xa5\r\n  golang.org/x/tools/go/ast/astutil.(*application).apply(0xc000082120, 0x11c1240, 0xc0000d40c0, 0x119031a, 0x4, 0x0, 0x11c0a40, 0xc0000de100)\r\n  \tgolang.org/x/tools@v0.0.0-20190625160430-252024b82959/go/ast/astutil/rewrite.go:424 +0x13d7\r\n  golang.org/x/tools/go/ast/astutil.Apply(0x11c0a40, 0xc0000de100, 0xc0000d40a0, 0xc0000d40b0, 0x0, 0x0)\r\n  \tgolang.org/x/tools@v0.0.0-20190625160430-252024b82959/go/ast/astutil/rewrite.go:52 +0x14a\r\n  mvdan.cc/gofumpt/internal.Gofumpt(0xc0000b2240, 0xc0000de100)\r\n  \tmvdan.cc/gofumpt@/internal/gofumpt.go:62 +0x10f\r\n  main.processFile(0x1192301, 0x10, 0x11bfea0, 0xc000078000, 0x11bfec0, 0xc000080000, 0x1, 0x0, 0x0)\r\n  \tmvdan.cc/gofumpt@/gofmt.go:121 +0x1ff\r\n  main.gofumptMain()\r\n  \tmvdan.cc/gofumpt@/gofmt.go:215 +0x2e6\r\n  main.main()\r\n  \tmvdan.cc/gofumpt@/gofmt.go:186 +0x22\r\n  ```\r\n  </details>\r\n\r\nTemporary workaround: `gofmt | gofumpt`\r\n\r\n>Also panics on `import(\"a\";\"b\")`, but the behavior is consistent with `gofmt` :bug:.","closed_by":{"login":"mvdan","id":3576549,"node_id":"MDQ6VXNlcjM1NzY1NDk=","avatar_url":"https://avatars.githubusercontent.com/u/3576549?v=4","gravatar_id":"","url":"https://api.github.com/users/mvdan","html_url":"https://github.com/mvdan","followers_url":"https://api.github.com/users/mvdan/followers","following_url":"https://api.github.com/users/mvdan/following{/other_user}","gists_url":"https://api.github.com/users/mvdan/gists{/gist_id}","starred_url":"https://api.github.com/users/mvdan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mvdan/subscriptions","organizations_url":"https://api.github.com/users/mvdan/orgs","repos_url":"https://api.github.com/users/mvdan/repos","events_url":"https://api.github.com/users/mvdan/events{/privacy}","received_events_url":"https://api.github.com/users/mvdan/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mvdan/gofumpt/issues/29/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mvdan/gofumpt/issues/29/timeline","performed_via_github_app":null,"state_reason":"completed"}