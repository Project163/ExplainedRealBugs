{"url":"https://api.github.com/repos/mvdan/gofumpt/issues/130","repository_url":"https://api.github.com/repos/mvdan/gofumpt","labels_url":"https://api.github.com/repos/mvdan/gofumpt/issues/130/labels{/name}","comments_url":"https://api.github.com/repos/mvdan/gofumpt/issues/130/comments","events_url":"https://api.github.com/repos/mvdan/gofumpt/issues/130/events","html_url":"https://github.com/mvdan/gofumpt/issues/130","id":907373227,"node_id":"MDU6SXNzdWU5MDczNzMyMjc=","number":130,"title":"add a way to inspect gofumpt's own version by formatting a Go file","user":{"login":"mvdan","id":3576549,"node_id":"MDQ6VXNlcjM1NzY1NDk=","avatar_url":"https://avatars.githubusercontent.com/u/3576549?v=4","gravatar_id":"","url":"https://api.github.com/users/mvdan","html_url":"https://github.com/mvdan","followers_url":"https://api.github.com/users/mvdan/followers","following_url":"https://api.github.com/users/mvdan/following{/other_user}","gists_url":"https://api.github.com/users/mvdan/gists{/gist_id}","starred_url":"https://api.github.com/users/mvdan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mvdan/subscriptions","organizations_url":"https://api.github.com/users/mvdan/orgs","repos_url":"https://api.github.com/users/mvdan/repos","events_url":"https://api.github.com/users/mvdan/events{/privacy}","received_events_url":"https://api.github.com/users/mvdan/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2021-05-31T11:14:19Z","updated_at":"2021-10-01T22:11:19Z","closed_at":"2021-10-01T22:11:19Z","author_association":"OWNER","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"gofumpt often ends up being used indirectly, such as via higher level tools like gopls or \"multi linters\".\r\n\r\nThat can be confusing for end users and myself alike, because when they find bugs and report them, it's pretty tricky to know for sure what version of gofumpt their editor is using.\r\n\r\nThat's easy if they just use `gofumpt -w file.go`, as they can just do `gofumpt -version`, but if they indirectly use gofumpt as a library, they don't have access to that same version flag - the `gofumpt` tool they have in their $PATH might not be the same version, or might not be installed at all.\r\n\r\nHere's an idea, thanks to some folks over on the Gophers Slack. Have a magic comment that's recognized by gofumpt and replaced to contain its own version too. Then, when a user finds a bug while formatting a file in their editor, they can insert this comment and format again to have enough details to raise a good bug report.\r\n\r\nThis comment would include gofumpt's own version, as expected - just like `gofumpt -version`. It will also include any options or flags which affect gofumpt's behavior, such as `-lang` or `-extra`, to make sure we can reproduce the same behavior the user is seeing.\r\n\r\nOriginally I was thinking `//gofumpt:version`, but since we'll include other information such as options, I think `//gofumpt:diagnose` is best.\r\n\r\nSo, if gofumpt sees any comment starting with `//gofumpt:diagnose`, it will be replaced by a comment such as:\r\n\r\n```\r\n//gofumpt:diagnose v0.1.1-0.20210524140936-ba6406b58f36 -lang=1.16\r\n```\r\n\r\nOlder versions of gofumpt would not touch this comment directive at all, so if a user can't make the comment work, at least we know they're on an old version.","closed_by":{"login":"mvdan","id":3576549,"node_id":"MDQ6VXNlcjM1NzY1NDk=","avatar_url":"https://avatars.githubusercontent.com/u/3576549?v=4","gravatar_id":"","url":"https://api.github.com/users/mvdan","html_url":"https://github.com/mvdan","followers_url":"https://api.github.com/users/mvdan/followers","following_url":"https://api.github.com/users/mvdan/following{/other_user}","gists_url":"https://api.github.com/users/mvdan/gists{/gist_id}","starred_url":"https://api.github.com/users/mvdan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mvdan/subscriptions","organizations_url":"https://api.github.com/users/mvdan/orgs","repos_url":"https://api.github.com/users/mvdan/repos","events_url":"https://api.github.com/users/mvdan/events{/privacy}","received_events_url":"https://api.github.com/users/mvdan/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mvdan/gofumpt/issues/130/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":1},"timeline_url":"https://api.github.com/repos/mvdan/gofumpt/issues/130/timeline","performed_via_github_app":null,"state_reason":"completed"}