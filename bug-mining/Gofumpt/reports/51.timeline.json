[{"url":"https://api.github.com/repos/mvdan/gofumpt/issues/comments/965792925","html_url":"https://github.com/mvdan/gofumpt/issues/166#issuecomment-965792925","issue_url":"https://api.github.com/repos/mvdan/gofumpt/issues/166","id":965792925,"node_id":"IC_kwDOCqWoQc45kNSd","user":{"login":"mvdan","id":3576549,"node_id":"MDQ6VXNlcjM1NzY1NDk=","avatar_url":"https://avatars.githubusercontent.com/u/3576549?v=4","gravatar_id":"","url":"https://api.github.com/users/mvdan","html_url":"https://github.com/mvdan","followers_url":"https://api.github.com/users/mvdan/followers","following_url":"https://api.github.com/users/mvdan/following{/other_user}","gists_url":"https://api.github.com/users/mvdan/gists{/gist_id}","starred_url":"https://api.github.com/users/mvdan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mvdan/subscriptions","organizations_url":"https://api.github.com/users/mvdan/orgs","repos_url":"https://api.github.com/users/mvdan/repos","events_url":"https://api.github.com/users/mvdan/events{/privacy}","received_events_url":"https://api.github.com/users/mvdan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-11-10T22:09:30Z","updated_at":"2021-11-10T22:09:30Z","body":"Thanks for filing this issue! It seems like we're using an invalid position, which is out of bounds of the valid range of positions for a file in the parsed file set. We likely didn't trigger this in our tests because we essentially only format one file at a time.","author_association":"OWNER","reactions":{"url":"https://api.github.com/repos/mvdan/gofumpt/issues/comments/965792925/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mvdan","id":3576549,"node_id":"MDQ6VXNlcjM1NzY1NDk=","avatar_url":"https://avatars.githubusercontent.com/u/3576549?v=4","gravatar_id":"","url":"https://api.github.com/users/mvdan","html_url":"https://github.com/mvdan","followers_url":"https://api.github.com/users/mvdan/followers","following_url":"https://api.github.com/users/mvdan/following{/other_user}","gists_url":"https://api.github.com/users/mvdan/gists{/gist_id}","starred_url":"https://api.github.com/users/mvdan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mvdan/subscriptions","organizations_url":"https://api.github.com/users/mvdan/orgs","repos_url":"https://api.github.com/users/mvdan/repos","events_url":"https://api.github.com/users/mvdan/events{/privacy}","received_events_url":"https://api.github.com/users/mvdan/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":5600396059,"node_id":"REFE_lADOCqWoQc4-mZ8ZzwAAAAFNz0Mb","url":"https://api.github.com/repos/mvdan/gofumpt/issues/events/5600396059","actor":{"login":"mvdan","id":3576549,"node_id":"MDQ6VXNlcjM1NzY1NDk=","avatar_url":"https://avatars.githubusercontent.com/u/3576549?v=4","gravatar_id":"","url":"https://api.github.com/users/mvdan","html_url":"https://github.com/mvdan","followers_url":"https://api.github.com/users/mvdan/followers","following_url":"https://api.github.com/users/mvdan/following{/other_user}","gists_url":"https://api.github.com/users/mvdan/gists{/gist_id}","starred_url":"https://api.github.com/users/mvdan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mvdan/subscriptions","organizations_url":"https://api.github.com/users/mvdan/orgs","repos_url":"https://api.github.com/users/mvdan/repos","events_url":"https://api.github.com/users/mvdan/events{/privacy}","received_events_url":"https://api.github.com/users/mvdan/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"a9a5a69e2ff5ef489a1941e7600c746ced448015","commit_url":"https://api.github.com/repos/mvdan/gofumpt/commits/a9a5a69e2ff5ef489a1941e7600c746ced448015","created_at":"2021-11-10T22:39:27Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/mvdan/gofumpt/issues/comments/965810800","html_url":"https://github.com/mvdan/gofumpt/issues/166#issuecomment-965810800","issue_url":"https://api.github.com/repos/mvdan/gofumpt/issues/166","id":965810800,"node_id":"IC_kwDOCqWoQc45kRpw","user":{"login":"mvdan","id":3576549,"node_id":"MDQ6VXNlcjM1NzY1NDk=","avatar_url":"https://avatars.githubusercontent.com/u/3576549?v=4","gravatar_id":"","url":"https://api.github.com/users/mvdan","html_url":"https://github.com/mvdan","followers_url":"https://api.github.com/users/mvdan/followers","following_url":"https://api.github.com/users/mvdan/following{/other_user}","gists_url":"https://api.github.com/users/mvdan/gists{/gist_id}","starred_url":"https://api.github.com/users/mvdan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mvdan/subscriptions","organizations_url":"https://api.github.com/users/mvdan/orgs","repos_url":"https://api.github.com/users/mvdan/repos","events_url":"https://api.github.com/users/mvdan/events{/privacy}","received_events_url":"https://api.github.com/users/mvdan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-11-10T22:40:10Z","updated_at":"2021-11-10T22:40:10Z","body":"The fix is at https://github.com/mvdan/gofumpt/pull/167, if you want to give it a review or double check that it fixes the panic for you.","author_association":"OWNER","reactions":{"url":"https://api.github.com/repos/mvdan/gofumpt/issues/comments/965810800/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mvdan","id":3576549,"node_id":"MDQ6VXNlcjM1NzY1NDk=","avatar_url":"https://avatars.githubusercontent.com/u/3576549?v=4","gravatar_id":"","url":"https://api.github.com/users/mvdan","html_url":"https://github.com/mvdan","followers_url":"https://api.github.com/users/mvdan/followers","following_url":"https://api.github.com/users/mvdan/following{/other_user}","gists_url":"https://api.github.com/users/mvdan/gists{/gist_id}","starred_url":"https://api.github.com/users/mvdan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mvdan/subscriptions","organizations_url":"https://api.github.com/users/mvdan/orgs","repos_url":"https://api.github.com/users/mvdan/repos","events_url":"https://api.github.com/users/mvdan/events{/privacy}","received_events_url":"https://api.github.com/users/mvdan/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/mvdan/gofumpt/issues/comments/965821032","html_url":"https://github.com/mvdan/gofumpt/issues/166#issuecomment-965821032","issue_url":"https://api.github.com/repos/mvdan/gofumpt/issues/166","id":965821032,"node_id":"IC_kwDOCqWoQc45kUJo","user":{"login":"chipaca","id":1543430,"node_id":"MDQ6VXNlcjE1NDM0MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1543430?v=4","gravatar_id":"","url":"https://api.github.com/users/chipaca","html_url":"https://github.com/chipaca","followers_url":"https://api.github.com/users/chipaca/followers","following_url":"https://api.github.com/users/chipaca/following{/other_user}","gists_url":"https://api.github.com/users/chipaca/gists{/gist_id}","starred_url":"https://api.github.com/users/chipaca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chipaca/subscriptions","organizations_url":"https://api.github.com/users/chipaca/orgs","repos_url":"https://api.github.com/users/chipaca/repos","events_url":"https://api.github.com/users/chipaca/events{/privacy}","received_events_url":"https://api.github.com/users/chipaca/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-11-10T23:00:34Z","updated_at":"2021-11-10T23:00:34Z","body":"I can confirm it doesn't panic with #167.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/mvdan/gofumpt/issues/comments/965821032/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"chipaca","id":1543430,"node_id":"MDQ6VXNlcjE1NDM0MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1543430?v=4","gravatar_id":"","url":"https://api.github.com/users/chipaca","html_url":"https://github.com/chipaca","followers_url":"https://api.github.com/users/chipaca/followers","following_url":"https://api.github.com/users/chipaca/following{/other_user}","gists_url":"https://api.github.com/users/chipaca/gists{/gist_id}","starred_url":"https://api.github.com/users/chipaca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chipaca/subscriptions","organizations_url":"https://api.github.com/users/chipaca/orgs","repos_url":"https://api.github.com/users/chipaca/repos","events_url":"https://api.github.com/users/chipaca/events{/privacy}","received_events_url":"https://api.github.com/users/chipaca/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/mvdan/gofumpt/issues/comments/965822676","html_url":"https://github.com/mvdan/gofumpt/issues/166#issuecomment-965822676","issue_url":"https://api.github.com/repos/mvdan/gofumpt/issues/166","id":965822676,"node_id":"IC_kwDOCqWoQc45kUjU","user":{"login":"chipaca","id":1543430,"node_id":"MDQ6VXNlcjE1NDM0MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1543430?v=4","gravatar_id":"","url":"https://api.github.com/users/chipaca","html_url":"https://github.com/chipaca","followers_url":"https://api.github.com/users/chipaca/followers","following_url":"https://api.github.com/users/chipaca/following{/other_user}","gists_url":"https://api.github.com/users/chipaca/gists{/gist_id}","starred_url":"https://api.github.com/users/chipaca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chipaca/subscriptions","organizations_url":"https://api.github.com/users/chipaca/orgs","repos_url":"https://api.github.com/users/chipaca/repos","events_url":"https://api.github.com/users/chipaca/events{/privacy}","received_events_url":"https://api.github.com/users/chipaca/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-11-10T23:03:51Z","updated_at":"2021-11-10T23:03:51Z","body":"I looked at reviewing it, but it seems to be addressing two separate issues, and I don't know the codebase well enough to know if it's correct.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/mvdan/gofumpt/issues/comments/965822676/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"chipaca","id":1543430,"node_id":"MDQ6VXNlcjE1NDM0MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1543430?v=4","gravatar_id":"","url":"https://api.github.com/users/chipaca","html_url":"https://github.com/chipaca","followers_url":"https://api.github.com/users/chipaca/followers","following_url":"https://api.github.com/users/chipaca/following{/other_user}","gists_url":"https://api.github.com/users/chipaca/gists{/gist_id}","starred_url":"https://api.github.com/users/chipaca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chipaca/subscriptions","organizations_url":"https://api.github.com/users/chipaca/orgs","repos_url":"https://api.github.com/users/chipaca/repos","events_url":"https://api.github.com/users/chipaca/events{/privacy}","received_events_url":"https://api.github.com/users/chipaca/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":5604620653,"node_id":"CE_lADOCqWoQc4-mZ8ZzwAAAAFOD7lt","url":"https://api.github.com/repos/mvdan/gofumpt/issues/events/5604620653","actor":{"login":"mvdan","id":3576549,"node_id":"MDQ6VXNlcjM1NzY1NDk=","avatar_url":"https://avatars.githubusercontent.com/u/3576549?v=4","gravatar_id":"","url":"https://api.github.com/users/mvdan","html_url":"https://github.com/mvdan","followers_url":"https://api.github.com/users/mvdan/followers","following_url":"https://api.github.com/users/mvdan/following{/other_user}","gists_url":"https://api.github.com/users/mvdan/gists{/gist_id}","starred_url":"https://api.github.com/users/mvdan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mvdan/subscriptions","organizations_url":"https://api.github.com/users/mvdan/orgs","repos_url":"https://api.github.com/users/mvdan/repos","events_url":"https://api.github.com/users/mvdan/events{/privacy}","received_events_url":"https://api.github.com/users/mvdan/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"9d037d45f9bba9aac634623960a41439e4354675","commit_url":"https://api.github.com/repos/mvdan/gofumpt/commits/9d037d45f9bba9aac634623960a41439e4354675","created_at":"2021-11-11T15:39:26Z","state_reason":null,"performed_via_github_app":null},{"actor":{"login":"mvdan","id":3576549,"node_id":"MDQ6VXNlcjM1NzY1NDk=","avatar_url":"https://avatars.githubusercontent.com/u/3576549?v=4","gravatar_id":"","url":"https://api.github.com/users/mvdan","html_url":"https://github.com/mvdan","followers_url":"https://api.github.com/users/mvdan/followers","following_url":"https://api.github.com/users/mvdan/following{/other_user}","gists_url":"https://api.github.com/users/mvdan/gists{/gist_id}","starred_url":"https://api.github.com/users/mvdan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mvdan/subscriptions","organizations_url":"https://api.github.com/users/mvdan/orgs","repos_url":"https://api.github.com/users/mvdan/repos","events_url":"https://api.github.com/users/mvdan/events{/privacy}","received_events_url":"https://api.github.com/users/mvdan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-11-19T10:24:51Z","updated_at":"2021-11-19T10:24:51Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/mvdan/gofumpt/issues/169","repository_url":"https://api.github.com/repos/mvdan/gofumpt","labels_url":"https://api.github.com/repos/mvdan/gofumpt/issues/169/labels{/name}","comments_url":"https://api.github.com/repos/mvdan/gofumpt/issues/169/comments","events_url":"https://api.github.com/repos/mvdan/gofumpt/issues/169/events","html_url":"https://github.com/mvdan/gofumpt/issues/169","id":1058031145,"node_id":"I_kwDOCqWoQc4_EEYp","number":169,"title":"Gofumpt crashes when there is a file with a multiline function declaration which starts with a newline when the file is not the first file in the directory","user":{"login":"mogzol","id":11789801,"node_id":"MDQ6VXNlcjExNzg5ODAx","avatar_url":"https://avatars.githubusercontent.com/u/11789801?v=4","gravatar_id":"","url":"https://api.github.com/users/mogzol","html_url":"https://github.com/mogzol","followers_url":"https://api.github.com/users/mogzol/followers","following_url":"https://api.github.com/users/mogzol/following{/other_user}","gists_url":"https://api.github.com/users/mogzol/gists{/gist_id}","starred_url":"https://api.github.com/users/mogzol/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mogzol/subscriptions","organizations_url":"https://api.github.com/users/mogzol/orgs","repos_url":"https://api.github.com/users/mogzol/repos","events_url":"https://api.github.com/users/mogzol/events{/privacy}","received_events_url":"https://api.github.com/users/mogzol/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2021-11-19T01:25:57Z","updated_at":"2021-11-19T14:15:40Z","closed_at":"2021-11-19T14:15:40Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":178628673,"node_id":"MDEwOlJlcG9zaXRvcnkxNzg2Mjg2NzM=","name":"gofumpt","full_name":"mvdan/gofumpt","private":false,"owner":{"login":"mvdan","id":3576549,"node_id":"MDQ6VXNlcjM1NzY1NDk=","avatar_url":"https://avatars.githubusercontent.com/u/3576549?v=4","gravatar_id":"","url":"https://api.github.com/users/mvdan","html_url":"https://github.com/mvdan","followers_url":"https://api.github.com/users/mvdan/followers","following_url":"https://api.github.com/users/mvdan/following{/other_user}","gists_url":"https://api.github.com/users/mvdan/gists{/gist_id}","starred_url":"https://api.github.com/users/mvdan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mvdan/subscriptions","organizations_url":"https://api.github.com/users/mvdan/orgs","repos_url":"https://api.github.com/users/mvdan/repos","events_url":"https://api.github.com/users/mvdan/events{/privacy}","received_events_url":"https://api.github.com/users/mvdan/received_events","type":"User","user_view_type":"public","site_admin":false},"html_url":"https://github.com/mvdan/gofumpt","description":"A stricter gofmt","fork":false,"url":"https://api.github.com/repos/mvdan/gofumpt","forks_url":"https://api.github.com/repos/mvdan/gofumpt/forks","keys_url":"https://api.github.com/repos/mvdan/gofumpt/keys{/key_id}","collaborators_url":"https://api.github.com/repos/mvdan/gofumpt/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/mvdan/gofumpt/teams","hooks_url":"https://api.github.com/repos/mvdan/gofumpt/hooks","issue_events_url":"https://api.github.com/repos/mvdan/gofumpt/issues/events{/number}","events_url":"https://api.github.com/repos/mvdan/gofumpt/events","assignees_url":"https://api.github.com/repos/mvdan/gofumpt/assignees{/user}","branches_url":"https://api.github.com/repos/mvdan/gofumpt/branches{/branch}","tags_url":"https://api.github.com/repos/mvdan/gofumpt/tags","blobs_url":"https://api.github.com/repos/mvdan/gofumpt/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/mvdan/gofumpt/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/mvdan/gofumpt/git/refs{/sha}","trees_url":"https://api.github.com/repos/mvdan/gofumpt/git/trees{/sha}","statuses_url":"https://api.github.com/repos/mvdan/gofumpt/statuses/{sha}","languages_url":"https://api.github.com/repos/mvdan/gofumpt/languages","stargazers_url":"https://api.github.com/repos/mvdan/gofumpt/stargazers","contributors_url":"https://api.github.com/repos/mvdan/gofumpt/contributors","subscribers_url":"https://api.github.com/repos/mvdan/gofumpt/subscribers","subscription_url":"https://api.github.com/repos/mvdan/gofumpt/subscription","commits_url":"https://api.github.com/repos/mvdan/gofumpt/commits{/sha}","git_commits_url":"https://api.github.com/repos/mvdan/gofumpt/git/commits{/sha}","comments_url":"https://api.github.com/repos/mvdan/gofumpt/comments{/number}","issue_comment_url":"https://api.github.com/repos/mvdan/gofumpt/issues/comments{/number}","contents_url":"https://api.github.com/repos/mvdan/gofumpt/contents/{+path}","compare_url":"https://api.github.com/repos/mvdan/gofumpt/compare/{base}...{head}","merges_url":"https://api.github.com/repos/mvdan/gofumpt/merges","archive_url":"https://api.github.com/repos/mvdan/gofumpt/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/mvdan/gofumpt/downloads","issues_url":"https://api.github.com/repos/mvdan/gofumpt/issues{/number}","pulls_url":"https://api.github.com/repos/mvdan/gofumpt/pulls{/number}","milestones_url":"https://api.github.com/repos/mvdan/gofumpt/milestones{/number}","notifications_url":"https://api.github.com/repos/mvdan/gofumpt/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/mvdan/gofumpt/labels{/name}","releases_url":"https://api.github.com/repos/mvdan/gofumpt/releases{/id}","deployments_url":"https://api.github.com/repos/mvdan/gofumpt/deployments","created_at":"2019-03-31T01:17:51Z","updated_at":"2025-11-10T08:38:29Z","pushed_at":"2025-10-21T22:27:49Z","git_url":"git://github.com/mvdan/gofumpt.git","ssh_url":"git@github.com:mvdan/gofumpt.git","clone_url":"https://github.com/mvdan/gofumpt.git","svn_url":"https://github.com/mvdan/gofumpt","homepage":"https://pkg.go.dev/mvdan.cc/gofumpt","size":580,"stargazers_count":3776,"watchers_count":3776,"language":"Go","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":121,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":28,"license":{"key":"bsd-3-clause","name":"BSD 3-Clause \"New\" or \"Revised\" License","spdx_id":"BSD-3-Clause","url":"https://api.github.com/licenses/bsd-3-clause","node_id":"MDc6TGljZW5zZTU="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["format","go","gofmt","goimports","idiomatic","style"],"visibility":"public","forks":121,"open_issues":28,"watchers":3776,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"Sorry for the mess of a title, I don't really know how to describe it any better, so I'll just give an example of how to cause the crash:\r\n\r\n1. Create a new empty directory\r\n2. Within that directory, create two go files:\r\n    - aaa.go:\r\n      \r\n      ````\r\n      package example\r\n\r\n      // This file's contents don't matter, but its name must cause it to come before the next file alphabetically\r\n      ````\r\n   - crash.go:\r\n     \r\n      ````\r\n      package example\r\n      \r\n      func CrashGofumpt(a int,\r\n      \tb int) error {\r\n      \r\n      \treturn nil\r\n      }\r\n      ````\r\n3. Now run `gofumpt .` within that directory. Gofumpt should crash:\r\n      \r\n    ````\r\n   panic: invalid Pos value 1 (should be in [128, 201]) [recovered]\r\n       panic: invalid Pos value 1 (should be in [128, 201])\r\n   \r\n   goroutine 1 [running]:\r\n   golang.org/x/tools/go/ast/astutil.Apply.func1()\r\n       /Users/morganzolob/go/pkg/mod/golang.org/x/tools@v0.1.8-0.20211102182255-bb4add04ddef/go/ast/astutil/rewrite.go:49 +0x89\r\n   panic({0x12093a0, 0xc00010c790})\r\n       /usr/local/go/src/runtime/panic.go:1038 +0x215\r\n   go/token.(*File).Offset(0xc0001269c0, 0x2)\r\n       /usr/local/go/src/go/token/position.go:281 +0xeb\r\n   mvdan.cc/gofumpt/format.(*fumpter).addNewline(0xc000128640, 0xc00010c710)\r\n       /Users/morganzolob/go/pkg/mod/mvdan.cc/gofumpt@v0.2.0/format/format.go:213 +0x3a\r\n   mvdan.cc/gofumpt/format.(*fumpter).applyPre(0xc000128640, 0xc000126a90)\r\n       /Users/morganzolob/go/pkg/mod/mvdan.cc/gofumpt@v0.2.0/format/format.go:558 +0x12f5\r\n   mvdan.cc/gofumpt/format.File.func1(0xc000126a90)\r\n       /Users/morganzolob/go/pkg/mod/mvdan.cc/gofumpt@v0.2.0/format/format.go:104 +0x3a\r\n   golang.org/x/tools/go/ast/astutil.(*application).apply(0xc000126a80, {0x12943a0, 0xc00010ecc0}, {0x1247806, 0x18}, 0xc00012a9c8, {0x12940d0, 0xc00010ec90})\r\n       /Users/morganzolob/go/pkg/mod/golang.org/x/tools@v0.1.8-0.20211102182255-bb4add04ddef/go/ast/astutil/rewrite.go:200 +0x202\r\n   golang.org/x/tools/go/ast/astutil.(*application).apply(0xc000126a80, {0x1294350, 0xc000196280}, {0x1247a59, 0xc000196280}, 0x0, {0x12943a0, 0xc00010ecc0})\r\n       /Users/morganzolob/go/pkg/mod/golang.org/x/tools@v0.1.8-0.20211102182255-bb4add04ddef/go/ast/astutil/rewrite.go:424 +0x17fd\r\n   golang.org/x/tools/go/ast/astutil.(*application).applyList(0xc000126a80, {0x1294350, 0xc000196280}, {0x1247a59, 0x5})\r\n       /Users/morganzolob/go/pkg/mod/golang.org/x/tools@v0.1.8-0.20211102182255-bb4add04ddef/go/ast/astutil/rewrite.go:479 +0xae\r\n   golang.org/x/tools/go/ast/astutil.(*application).apply(0xc000126a80, {0x1294bc0, 0xc00010c770}, {0x124786a, 0x18}, 0x18, {0x1294350, 0xc000196280})\r\n       /Users/morganzolob/go/pkg/mod/golang.org/x/tools@v0.1.8-0.20211102182255-bb4add04ddef/go/ast/astutil/rewrite.go:430 +0xb0d\r\n   golang.org/x/tools/go/ast/astutil.Apply({0x1294350, 0xc000196280}, 0xc00011c1e0, 0xc00011c1f8)\r\n       /Users/morganzolob/go/pkg/mod/golang.org/x/tools@v0.1.8-0.20211102182255-bb4add04ddef/go/ast/astutil/rewrite.go:54 +0x166\r\n   mvdan.cc/gofumpt/format.File(0xc000128440, 0xc000196280, {{0xc00012a8fc, 0xc00014d600}, 0x94})\r\n       /Users/morganzolob/go/pkg/mod/mvdan.cc/gofumpt@v0.2.0/format/format.go:152 +0x335\r\n   main.processFile({0xc00012a960, 0x10}, {0x0, 0x0}, {0x12903c0, 0xc000124008}, 0x0)\r\n       /Users/morganzolob/go/pkg/mod/mvdan.cc/gofumpt@v0.2.0/gofmt.go:130 +0x388\r\n   main.visitFile({0xc00012a960, 0x10}, {0x1295e68, 0xc0001284c0}, {0x0, 0x0})\r\n       /Users/morganzolob/go/pkg/mod/mvdan.cc/gofumpt@v0.2.0/gofmt.go:185 +0xf2\r\n   path/filepath.walkDir({0xc00012a960, 0x10}, {0x1295e68, 0xc0001284c0}, 0x1256d78)\r\n       /usr/local/go/src/path/filepath/path.go:386 +0x63\r\n   path/filepath.walkDir({0x7ffeefbffb90, 0x7}, {0x1295ea0, 0xc00010c600}, 0x1256d78)\r\n       /usr/local/go/src/path/filepath/path.go:405 +0x232\r\n   path/filepath.WalkDir({0x7ffeefbffb90, 0x7}, 0x1256d78)\r\n       /usr/local/go/src/path/filepath/path.go:469 +0xb0\r\n   main.gofumptMain()\r\n       /Users/morganzolob/go/pkg/mod/mvdan.cc/gofumpt@v0.2.0/gofmt.go:248 +0x405\r\n   main.main()\r\n       /Users/morganzolob/go/pkg/mod/mvdan.cc/gofumpt@v0.2.0/gofmt.go:195 +0x19\r\n    ````\r\n\r\nI've only tested this on an Intel MacBook with Go 1.17.3 installed, not sure if the same thing happens in other environments","reactions":{"url":"https://api.github.com/repos/mvdan/gofumpt/issues/169/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mvdan/gofumpt/issues/169/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"actor":{"login":"mvdan","id":3576549,"node_id":"MDQ6VXNlcjM1NzY1NDk=","avatar_url":"https://avatars.githubusercontent.com/u/3576549?v=4","gravatar_id":"","url":"https://api.github.com/users/mvdan","html_url":"https://github.com/mvdan","followers_url":"https://api.github.com/users/mvdan/followers","following_url":"https://api.github.com/users/mvdan/following{/other_user}","gists_url":"https://api.github.com/users/mvdan/gists{/gist_id}","starred_url":"https://api.github.com/users/mvdan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mvdan/subscriptions","organizations_url":"https://api.github.com/users/mvdan/orgs","repos_url":"https://api.github.com/users/mvdan/repos","events_url":"https://api.github.com/users/mvdan/events{/privacy}","received_events_url":"https://api.github.com/users/mvdan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-11-30T22:13:13Z","updated_at":"2021-11-30T22:13:13Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/mvdan/gofumpt/issues/171","repository_url":"https://api.github.com/repos/mvdan/gofumpt","labels_url":"https://api.github.com/repos/mvdan/gofumpt/issues/171/labels{/name}","comments_url":"https://api.github.com/repos/mvdan/gofumpt/issues/171/comments","events_url":"https://api.github.com/repos/mvdan/gofumpt/issues/171/events","html_url":"https://github.com/mvdan/gofumpt/issues/171","id":1065466921,"node_id":"I_kwDOCqWoQc4_gbwp","number":171,"title":"Panic in v0.2.0","user":{"login":"screwyprof","id":1536274,"node_id":"MDQ6VXNlcjE1MzYyNzQ=","avatar_url":"https://avatars.githubusercontent.com/u/1536274?v=4","gravatar_id":"","url":"https://api.github.com/users/screwyprof","html_url":"https://github.com/screwyprof","followers_url":"https://api.github.com/users/screwyprof/followers","following_url":"https://api.github.com/users/screwyprof/following{/other_user}","gists_url":"https://api.github.com/users/screwyprof/gists{/gist_id}","starred_url":"https://api.github.com/users/screwyprof/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/screwyprof/subscriptions","organizations_url":"https://api.github.com/users/screwyprof/orgs","repos_url":"https://api.github.com/users/screwyprof/repos","events_url":"https://api.github.com/users/screwyprof/events{/privacy}","received_events_url":"https://api.github.com/users/screwyprof/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2021-11-28T23:27:40Z","updated_at":"2021-11-30T22:13:16Z","closed_at":"2021-11-30T22:13:16Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":178628673,"node_id":"MDEwOlJlcG9zaXRvcnkxNzg2Mjg2NzM=","name":"gofumpt","full_name":"mvdan/gofumpt","private":false,"owner":{"login":"mvdan","id":3576549,"node_id":"MDQ6VXNlcjM1NzY1NDk=","avatar_url":"https://avatars.githubusercontent.com/u/3576549?v=4","gravatar_id":"","url":"https://api.github.com/users/mvdan","html_url":"https://github.com/mvdan","followers_url":"https://api.github.com/users/mvdan/followers","following_url":"https://api.github.com/users/mvdan/following{/other_user}","gists_url":"https://api.github.com/users/mvdan/gists{/gist_id}","starred_url":"https://api.github.com/users/mvdan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mvdan/subscriptions","organizations_url":"https://api.github.com/users/mvdan/orgs","repos_url":"https://api.github.com/users/mvdan/repos","events_url":"https://api.github.com/users/mvdan/events{/privacy}","received_events_url":"https://api.github.com/users/mvdan/received_events","type":"User","user_view_type":"public","site_admin":false},"html_url":"https://github.com/mvdan/gofumpt","description":"A stricter gofmt","fork":false,"url":"https://api.github.com/repos/mvdan/gofumpt","forks_url":"https://api.github.com/repos/mvdan/gofumpt/forks","keys_url":"https://api.github.com/repos/mvdan/gofumpt/keys{/key_id}","collaborators_url":"https://api.github.com/repos/mvdan/gofumpt/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/mvdan/gofumpt/teams","hooks_url":"https://api.github.com/repos/mvdan/gofumpt/hooks","issue_events_url":"https://api.github.com/repos/mvdan/gofumpt/issues/events{/number}","events_url":"https://api.github.com/repos/mvdan/gofumpt/events","assignees_url":"https://api.github.com/repos/mvdan/gofumpt/assignees{/user}","branches_url":"https://api.github.com/repos/mvdan/gofumpt/branches{/branch}","tags_url":"https://api.github.com/repos/mvdan/gofumpt/tags","blobs_url":"https://api.github.com/repos/mvdan/gofumpt/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/mvdan/gofumpt/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/mvdan/gofumpt/git/refs{/sha}","trees_url":"https://api.github.com/repos/mvdan/gofumpt/git/trees{/sha}","statuses_url":"https://api.github.com/repos/mvdan/gofumpt/statuses/{sha}","languages_url":"https://api.github.com/repos/mvdan/gofumpt/languages","stargazers_url":"https://api.github.com/repos/mvdan/gofumpt/stargazers","contributors_url":"https://api.github.com/repos/mvdan/gofumpt/contributors","subscribers_url":"https://api.github.com/repos/mvdan/gofumpt/subscribers","subscription_url":"https://api.github.com/repos/mvdan/gofumpt/subscription","commits_url":"https://api.github.com/repos/mvdan/gofumpt/commits{/sha}","git_commits_url":"https://api.github.com/repos/mvdan/gofumpt/git/commits{/sha}","comments_url":"https://api.github.com/repos/mvdan/gofumpt/comments{/number}","issue_comment_url":"https://api.github.com/repos/mvdan/gofumpt/issues/comments{/number}","contents_url":"https://api.github.com/repos/mvdan/gofumpt/contents/{+path}","compare_url":"https://api.github.com/repos/mvdan/gofumpt/compare/{base}...{head}","merges_url":"https://api.github.com/repos/mvdan/gofumpt/merges","archive_url":"https://api.github.com/repos/mvdan/gofumpt/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/mvdan/gofumpt/downloads","issues_url":"https://api.github.com/repos/mvdan/gofumpt/issues{/number}","pulls_url":"https://api.github.com/repos/mvdan/gofumpt/pulls{/number}","milestones_url":"https://api.github.com/repos/mvdan/gofumpt/milestones{/number}","notifications_url":"https://api.github.com/repos/mvdan/gofumpt/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/mvdan/gofumpt/labels{/name}","releases_url":"https://api.github.com/repos/mvdan/gofumpt/releases{/id}","deployments_url":"https://api.github.com/repos/mvdan/gofumpt/deployments","created_at":"2019-03-31T01:17:51Z","updated_at":"2025-11-10T08:38:29Z","pushed_at":"2025-10-21T22:27:49Z","git_url":"git://github.com/mvdan/gofumpt.git","ssh_url":"git@github.com:mvdan/gofumpt.git","clone_url":"https://github.com/mvdan/gofumpt.git","svn_url":"https://github.com/mvdan/gofumpt","homepage":"https://pkg.go.dev/mvdan.cc/gofumpt","size":580,"stargazers_count":3776,"watchers_count":3776,"language":"Go","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":121,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":28,"license":{"key":"bsd-3-clause","name":"BSD 3-Clause \"New\" or \"Revised\" License","spdx_id":"BSD-3-Clause","url":"https://api.github.com/licenses/bsd-3-clause","node_id":"MDc6TGljZW5zZTU="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["format","go","gofmt","goimports","idiomatic","style"],"visibility":"public","forks":121,"open_issues":28,"watchers":3776,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"I've got a panic when I try to format the project. The older version didn't have such an issue. Do you happen to know if there's a quick workaround?\r\n\r\n```shell\r\ngofumpt -l -w ./...\r\n```\r\n\r\n```shell\r\npanic: invalid Pos value 1 (should be in [2583733, 2586227]) [recovered]\r\n        panic: invalid Pos value 1 (should be in [2583733, 25Ï86227])\r\n\r\ngoroutine 1 [running]:\r\ngolang.org/x/tools/go/ast/astutil.Apply.func1()\r\n        /Users/happygopher/go/pkg/mod/golang.org/x/tools@v0.1.8-0.2Ï0211102182255-bb4add04ddef/go/ast/astutil/rewrite.go:49 +0x89\r\npanic({0x12093a0, 0xc0000512f0})\r\n        /usr/local/opt/go/libexec/src/runtime/panic.go:1038 +0x215\r\ngo/token.(*File).Offset(0xc00042daa0, 0x2)\r\n        /usr/local/opt/go/libexec/src/go/token/position.go:281 +0xeb\r\nmvdan.cc/gofumpt/format.(*fumpter).addNewline(0xc000113cc0, 0xc000491500)\r\n        /Users/happygopher/go/pkg/mod/mvdan.cc/gofumpt@v0.2.0/format/format.go:213 +0x3a\r\nmvdan.cc/gofumpt/format.(*fumpter).applyPre(0xc000113cc0, 0xc00042dc30)\r\n        /Users/happygopher/go/pkg/mod/mvdan.cc/gofumpt@v0.2.0/format/format.go:558 +0x12f5\r\nmvdan.cc/gofumpt/format.File.func1(0xc00042dc30)\r\n        /Users/happygopher/go/pkg/mod/mvdan.cc/gofumpt@v0.2.0/format/format.go:104 +0x3a\r\ngolang.org/x/tools/go/ast/astutil.(*application).apply(0xc00042dc20, {0x12943a0, 0xc00012a9c0}, {0x1247806, 0x18}, 0xc00012e278, {0x12940d0, 0xc00012a990})\r\n        /Users/happygopher/go/pkg/mod/golang.org/x/tools@v0.1.8-0.20211102182255-bb4add04ddef/go/ast/astutil/rewrite.go:200 +0x202\r\ngolang.org/x/tools/go/ast/astutil.(*application).apply(0xc00042dc20, {0x1294350, 0xc000491600}, {0x1247a59, 0xc000491600}, 0x0, {0x12943a0, 0xc00012a9c0})\r\n        /Users/happygopher/go/pkg/mod/golang.org/x/tools@v0.1.8-0.20211102182255-bb4add04ddef/go/ast/astutil/rewrite.go:424 +0x17fd\r\ngolang.org/x/tools/go/ast/astutil.(*application).applyList(0xc00042dc20, {0x1294350, 0xc000491600}, {0x1247a59, 0x5})\r\n        /Users/happygopher/go/pkg/mod/golang.org/x/tools@v0.1.8-0.20211102182255-bb4add04ddef/go/ast/astutil/rewrite.go:479 +0xae\r\ngolang.org/x/tools/go/ast/astutil.(*application).apply(0xc00042dc20, {0x1294bc0, 0xc0000512c0}, {0x124786a, 0x18}, 0x18, {0x1294350, 0xc000491600})\r\n        /Users/happygopher/go/pkg/mod/golang.org/x/tools@v0.1.8-0.20211102182255-bb4add04ddef/go/ast/astutil/rewrite.go:430 +0xb0d\r\ngolang.org/x/tools/go/ast/astutil.Apply({0x1294350, 0xc000491600}, 0xc000198300, 0xc000198318)\r\n        /Users/happygopher/go/pkg/mod/golang.org/x/tools@v0.1.8-0.20211102182255-bb4add04ddef/go/ast/astutil/rewrite.go:54 +0x166\r\nmvdan.cc/gofumpt/format.File(0xc000186440, 0xc000491600, {{0xc00018cb40, 0xc000140000}, 0xa0})\r\n        /Users/happygopher/go/pkg/mod/mvdan.cc/gofumpt@v0.2.0/format/format.go:152 +0x335\r\nmain.processFile({0x7ffeefbff0fb, 0x3c}, {0x0, 0x0}, {0x12903c0, 0xc000180008}, 0x0)\r\n        /Users/happygopher/go/pkg/mod/mvdan.cc/gofumpt@v0.2.0/gofmt.go:130 +0x388\r\nmain.gofumptMain()\r\n        /Users/happygopher/go/pkg/mod/mvdan.cc/gofumpt@v0.2.0/gofmt.go:242 +0x458\r\nmain.main()\r\n        /Users/happygopher/go/pkg/mod/mvdan.cc/gofumpt@v0.2.0/gofmt.go:195 +0x19\r\n```\r\ngo version go1.17.2 darwin/amd64\r\n","reactions":{"url":"https://api.github.com/repos/mvdan/gofumpt/issues/171/reactions","total_count":2,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":1},"timeline_url":"https://api.github.com/repos/mvdan/gofumpt/issues/171/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"id":5707038956,"node_id":"MIE_lADOCqWoQc4-mZ8ZzwAAAAFUKoDs","url":"https://api.github.com/repos/mvdan/gofumpt/issues/events/5707038956","actor":{"login":"mvdan","id":3576549,"node_id":"MDQ6VXNlcjM1NzY1NDk=","avatar_url":"https://avatars.githubusercontent.com/u/3576549?v=4","gravatar_id":"","url":"https://api.github.com/users/mvdan","html_url":"https://github.com/mvdan","followers_url":"https://api.github.com/users/mvdan/followers","following_url":"https://api.github.com/users/mvdan/following{/other_user}","gists_url":"https://api.github.com/users/mvdan/gists{/gist_id}","starred_url":"https://api.github.com/users/mvdan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mvdan/subscriptions","organizations_url":"https://api.github.com/users/mvdan/orgs","repos_url":"https://api.github.com/users/mvdan/repos","events_url":"https://api.github.com/users/mvdan/events{/privacy}","received_events_url":"https://api.github.com/users/mvdan/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"milestoned","commit_id":null,"commit_url":null,"created_at":"2021-12-02T16:26:12Z","milestone":{"title":"v0.2.1"},"performed_via_github_app":null},{"id":11661904457,"node_id":"REFE_lADOCqWoQc4-mZ8ZzwAAAAK3GopJ","url":"https://api.github.com/repos/mvdan/gofumpt/issues/events/11661904457","actor":{"login":"gavinelder","id":1226100,"node_id":"MDQ6VXNlcjEyMjYxMDA=","avatar_url":"https://avatars.githubusercontent.com/u/1226100?v=4","gravatar_id":"","url":"https://api.github.com/users/gavinelder","html_url":"https://github.com/gavinelder","followers_url":"https://api.github.com/users/gavinelder/followers","following_url":"https://api.github.com/users/gavinelder/following{/other_user}","gists_url":"https://api.github.com/users/gavinelder/gists{/gist_id}","starred_url":"https://api.github.com/users/gavinelder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gavinelder/subscriptions","organizations_url":"https://api.github.com/users/gavinelder/orgs","repos_url":"https://api.github.com/users/gavinelder/repos","events_url":"https://api.github.com/users/gavinelder/events{/privacy}","received_events_url":"https://api.github.com/users/gavinelder/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"9d037d45f9bba9aac634623960a41439e4354675","commit_url":"https://api.github.com/repos/gavinelder/gofumpt/commits/9d037d45f9bba9aac634623960a41439e4354675","created_at":"2024-01-31T22:12:04Z","performed_via_github_app":null}]