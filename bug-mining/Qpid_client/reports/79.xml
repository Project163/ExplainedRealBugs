<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:17:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[QPIDJMS-154] Failover mechanism does not handle connection URLs in a predictable way</title>
                <link>https://issues.apache.org/jira/browse/QPIDJMS-154</link>
                <project id="12314524" key="QPIDJMS">Qpid JMS</project>
                    <description>&lt;p&gt;As discussed in this &lt;a href=&quot;http://qpid.2158936.n2.nabble.com/Unhandled-exception-when-using-High-Availabilty-in-Qpid-Java-Broker-6-0-0-td7639896.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;link&lt;/a&gt;, if the links provided in the failover URL are ordered in a way to have the Replicate first and then the Master. Then the connection will fail and an error will be thrown client-side.&lt;/p&gt;

&lt;p&gt;This is because the multi-threading behavior in the FailoverProvider is not correct. The main thread will not wait for the connection trial thread to try and find the active Master node. If we add a Sleep or debug the main thread to give the connection trial thread enough time to find the Master URL then the test works&lt;/p&gt;

&lt;p&gt;&lt;b&gt;&lt;em&gt;Log in case of failure:&lt;/em&gt;&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2016-03-11 10:46:31 DEBUG FailoverProvider:160 - Initiating initial connection attempt task
2016-03-11 10:46:33 DEBUG FailoverProvider:653 - Connection attempt:[1] to: amqp:&lt;span class=&quot;code-comment&quot;&gt;//localhost:10352?amqp.vhost=weather in-progress
&lt;/span&gt;2016-03-11 10:46:34 DEBUG FailoverProvider:963 - Executing Failover Task: create -&amp;gt; JmsConnectionInfo {} (1)
2016-03-11 10:46:34 DEBUG FailoverProvider:761 - Failover: the provider reports failure: Received error from remote peer without description [condition = amqp:not-found]
2016-03-11 10:46:34 DEBUG FailoverProvider:519 - handling Provider failure: Received error from remote peer without description [condition = amqp:not-found]
2016-03-11 10:46:34 DEBUG FailoverProvider:653 - Connection attempt:[1] to: amqp:&lt;span class=&quot;code-comment&quot;&gt;//localhost:5672?amqp.vhost=weather in-progress
&lt;/span&gt;2016-03-11 10:46:31 DEBUG FailoverProvider:160 - Initiating initial connection attempt task
2016-03-11 10:46:33 DEBUG FailoverProvider:653 - Connection attempt:[1] to: amqp:&lt;span class=&quot;code-comment&quot;&gt;//localhost:10352?amqp.vhost=weather in-progress
&lt;/span&gt;2016-03-11 10:46:34 DEBUG FailoverProvider:963 - Executing Failover Task: create -&amp;gt; JmsConnectionInfo {} (1)
2016-03-11 10:46:34 DEBUG FailoverProvider:761 - Failover: the provider reports failure: Received error from remote peer without description [condition = amqp:not-found]
2016-03-11 10:46:34 DEBUG FailoverProvider:519 - handling Provider failure: Received error from remote peer without description [condition = amqp:not-found]
2016-03-11 10:46:34 DEBUG FailoverProvider:653 - Connection attempt:[1] to: amqp:&lt;span class=&quot;code-comment&quot;&gt;//localhost:5672?amqp.vhost=weather in-progress&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;b&gt;&lt;em&gt;Logs in case we debug the main thread to allow the connection thread to finish:&lt;/em&gt;&lt;/b&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2016-03-11 11:03:37 DEBUG FailoverProvider:160 - Initiating initial connection attempt task
2016-03-11 11:04:05 DEBUG FailoverProvider:653 - Connection attempt:[1] to: amqp:&lt;span class=&quot;code-comment&quot;&gt;//localhost:10352?amqp.vhost=weather in-progress
&lt;/span&gt;2016-03-11 11:04:18 DEBUG FailoverProvider:963 - Executing Failover Task: create -&amp;gt; JmsConnectionInfo {} (1)
2016-03-11 11:04:18 DEBUG FailoverProvider:985 - Request received error: Cannot send to a non-connected transport.
2016-03-11 11:04:18 DEBUG FailoverProvider:519 - handling Provider failure: Cannot send to a non-connected transport.
2016-03-11 11:04:18 DEBUG FailoverProvider:985 - Request received error: Cannot send to a non-connected transport.
2016-03-11 11:04:18 DEBUG FailoverProvider:761 - Failover: the provider reports failure: Cannot send to a non-connected transport.
2016-03-11 11:04:18 DEBUG FailoverProvider:519 - handling Provider failure: Cannot send to a non-connected transport.
2016-03-11 11:04:18 DEBUG FailoverProvider:519 - handling Provider failure: Cannot send to a non-connected transport.
2016-03-11 11:04:40 DEBUG FailoverProvider:653 - Connection attempt:[1] to: amqp:&lt;span class=&quot;code-comment&quot;&gt;//localhost:5672?amqp.vhost=weather in-progress
&lt;/span&gt;2016-03-11 11:04:41 DEBUG FailoverProvider:963 - Executing Failover Task: create -&amp;gt; JmsConnectionInfo {} (1)
2016-03-11 11:04:42 INFO  JmsConnection:1114 - Connection ID::af28891b-adbe-47f1-9da2-ad03f124a215:1 connected to remote Broker: amqp:&lt;span class=&quot;code-comment&quot;&gt;//localhost:5672
&lt;/span&gt;2016-03-11 11:04:42 DEBUG FailoverProvider:963 - Executing Failover Task: create -&amp;gt; JmsSessionInfo {} (2)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;b&gt;&lt;em&gt;Test code:&lt;/em&gt;&lt;/b&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Test
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testScalabilityReversedOrder() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; JMSException {
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; brokerUrl = &lt;span class=&quot;code-quote&quot;&gt;&quot;failover:(amqp:&lt;span class=&quot;code-comment&quot;&gt;//localhost:10352,amqp://localhost:5672)?failover.nested.amqp.vhost=weather&quot;&lt;/span&gt;;
&lt;/span&gt;    ConnectionFactory connectionFactory = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JmsConnectionFactory(brokerUrl);
    Connection connection = connectionFactory.createConnection();
    Session session = connection.createSession(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, Session.AUTO_ACKNOWLEDGE);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12949058">QPIDJMS-154</key>
            <summary>Failover mechanism does not handle connection URLs in a predictable way</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tabish">Timothy A. Bish</assignee>
                                    <reporter username="sta191919@gmail.com">Adel Boutros</reporter>
                        <labels>
                    </labels>
                <created>Fri, 11 Mar 2016 11:38:25 +0000</created>
                <updated>Thu, 21 Jul 2016 12:18:17 +0000</updated>
                            <resolved>Wed, 16 Mar 2016 12:29:44 +0000</resolved>
                                    <version>0.8.0</version>
                                    <fixVersion>0.9.0</fixVersion>
                                    <component>qpid-jms-client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                                                            <comments>
                            <comment id="15190827" author="sta191919@gmail.com" created="Fri, 11 Mar 2016 11:42:55 +0000"  >&lt;p&gt;Broker&apos;s configuration&lt;/p&gt;</comment>
                            <comment id="15191087" author="tabish121" created="Fri, 11 Mar 2016 15:58:23 +0000"  >&lt;p&gt;When possble it is also helpful to capture a trace of the frames so we can see what is going on under the covers, there&apos;s a bit on that in the docs in the logging section at the end here: &lt;a href=&quot;https://qpid.apache.org/releases/qpid-jms-0.8.0/docs/index.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://qpid.apache.org/releases/qpid-jms-0.8.0/docs/index.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15194146" author="jira-bot" created="Mon, 14 Mar 2016 21:15:51 +0000"  >&lt;p&gt;Commit 15f6446ac0bda96230c9dbe0f54b7495911363b6 in qpid-jms&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tabish121&quot; class=&quot;user-hover&quot; rel=&quot;tabish121&quot;&gt;tabish121&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=qpid-jms.git;h=15f6446&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=qpid-jms.git;h=15f6446&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPIDJMS-154&quot; title=&quot;Failover mechanism does not handle connection URLs in a predictable way&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPIDJMS-154&quot;&gt;&lt;del&gt;QPIDJMS-154&lt;/del&gt;&lt;/a&gt; Don&apos;t pass along a JMSException on connect so that attempts&lt;br/&gt;
to connect can continue until stopped by user or by configuration.  &lt;/p&gt;
</comment>
                            <comment id="15194151" author="tabish121" created="Mon, 14 Mar 2016 21:17:51 +0000"  >&lt;p&gt;You should be able to build your own snapshot now and it should retry against the alternate host.  &lt;/p&gt;</comment>
                            <comment id="15195595" author="sta191919@gmail.com" created="Tue, 15 Mar 2016 16:33:51 +0000"  >&lt;p&gt;I have spoken too soon. Actually, the session is being created but the consumer cannot receive any message. Its call to receive is timeouting. In the below code, the 2nd test is failing.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;PS: The Master node is the one listening on 5672. The other 2 nodes are REPLICA&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;Successful test Log:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2016-03-15 17:29:35 DEBUG FailoverProvider:160 - Initiating initial connection attempt task
2016-03-15 17:29:35 DEBUG FailoverProvider:653 - Connection attempt:[1] to: amqp:&lt;span class=&quot;code-comment&quot;&gt;//localhost:5672?amqp.vhost=weather in-progress
&lt;/span&gt;2016-03-15 17:29:35 DEBUG InternalLoggerFactory:71 - Using SLF4J as the &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; logging framework
2016-03-15 17:29:35 DEBUG MultithreadEventLoopGroup:76 - -Dio.netty.eventLoopThreads: 24
2016-03-15 17:29:35 DEBUG PlatformDependent:71 - Platform: Windows
2016-03-15 17:29:35 DEBUG PlatformDependent:76 - Java version: 7
2016-03-15 17:29:35 DEBUG PlatformDependent:76 - -Dio.netty.noUnsafe: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
2016-03-15 17:29:35 DEBUG PlatformDependent0:76 - java.nio.ByteBuffer.cleaner: available
2016-03-15 17:29:35 DEBUG PlatformDependent0:76 - java.nio.Buffer.address: available
2016-03-15 17:29:35 DEBUG PlatformDependent0:76 - sun.misc.Unsafe.theUnsafe: available
2016-03-15 17:29:35 DEBUG PlatformDependent0:71 - sun.misc.Unsafe.copyMemory: available
2016-03-15 17:29:35 DEBUG PlatformDependent0:76 - java.nio.Bits.unaligned: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
2016-03-15 17:29:35 DEBUG PlatformDependent:76 - sun.misc.Unsafe: available
2016-03-15 17:29:35 DEBUG PlatformDependent:76 - -Dio.netty.noJavassist: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
2016-03-15 17:29:35 DEBUG PlatformDependent:71 - Javassist: available
2016-03-15 17:29:35 DEBUG PlatformDependent:76 - -Dio.netty.tmpdir: C:\Users\aboutros\AppData\Local\Temp (java.io.tmpdir)
2016-03-15 17:29:35 DEBUG PlatformDependent:76 - -Dio.netty.bitMode: 64 (sun.arch.data.model)
2016-03-15 17:29:35 DEBUG PlatformDependent:76 - -Dio.netty.noPreferDirect: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
2016-03-15 17:29:35 DEBUG NioEventLoop:76 - -Dio.netty.noKeySetOptimization: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
2016-03-15 17:29:35 DEBUG NioEventLoop:76 - -Dio.netty.selectorAutoRebuildThreshold: 512
2016-03-15 17:29:35 DEBUG PooledByteBufAllocator:76 - -Dio.netty.allocator.numHeapArenas: 12
2016-03-15 17:29:35 DEBUG PooledByteBufAllocator:76 - -Dio.netty.allocator.numDirectArenas: 12
2016-03-15 17:29:35 DEBUG PooledByteBufAllocator:76 - -Dio.netty.allocator.pageSize: 8192
2016-03-15 17:29:35 DEBUG PooledByteBufAllocator:76 - -Dio.netty.allocator.maxOrder: 11
2016-03-15 17:29:35 DEBUG PooledByteBufAllocator:76 - -Dio.netty.allocator.chunkSize: 16777216
2016-03-15 17:29:35 DEBUG ThreadLocalRandom:71 - -Dio.netty.initialSeedUniquifier: 0xfef29df1ac8a8913
2016-03-15 17:29:35 DEBUG ChannelOutboundBuffer:76 - -Dio.netty.threadLocalDirectBufferSize: 65536
2016-03-15 17:29:35 DEBUG ByteBufUtil:76 - -Dio.netty.allocator.type: unpooled
2016-03-15 17:29:35 DEBUG JavassistTypeParameterMatcherGenerator:76 - Generated: io.netty.util.internal.__matchers__.io.netty.buffer.ByteBufMatcher
2016-03-15 17:29:35 DEBUG FailoverProvider:963 - Executing Failover Task: create -&amp;gt; JmsConnectionInfo {} (1)
2016-03-15 17:29:35 DEBUG ResourceLeakDetector:81 - -Dio.netty.leakDetectionLevel: simple
2016-03-15 17:29:35 INFO  SaslMechanismFinder:93 - Best match &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; SASL auth was: SASL-ANONYMOUS
2016-03-15 17:29:35 DEBUG AmqpConnectionBuilder:71 - AmqpConnection { ID::37eae8b1-14ce-4809-ba78-35ccddcc8b82:1 } is now open: 
2016-03-15 17:29:35 INFO  JmsConnection:1114 - Connection ID::37eae8b1-14ce-4809-ba78-35ccddcc8b82:1 connected to remote Broker: amqp:&lt;span class=&quot;code-comment&quot;&gt;//localhost:5672
&lt;/span&gt;2016-03-15 17:29:35 DEBUG FailoverProvider:963 - Executing Failover Task: create -&amp;gt; JmsSessionInfo {} (2)
2016-03-15 17:29:35 DEBUG FailoverProvider:963 - Executing Failover Task: create -&amp;gt; JmsConsumerInfo {} (3)
2016-03-15 17:29:35 DEBUG FailoverProvider:963 - Executing Failover Task: start -&amp;gt; JmsConsumerInfo {} (4)
2016-03-15 17:29:35 DEBUG AmqpConsumer:520 - Dispatching received message: JmsInboundMessageDispatch {sequence = 1, messageId = ID::d1b9561b-d32f-4a0b-a083-70dda07d6675:1:1:1-1, consumerId = ID::37eae8b1-14ce-4809-ba78-35ccddcc8b82:1:1:1}
2016-03-15 17:29:35 DEBUG AmqpConsumer:520 - Dispatching received message: JmsInboundMessageDispatch {sequence = 2, messageId = ID::0f3b2678-1251-4481-b1d5-930f787eec8b:1:1:1-1, consumerId = ID::37eae8b1-14ce-4809-ba78-35ccddcc8b82:1:1:1}
2016-03-15 17:29:35 DEBUG AmqpConsumer:520 - Dispatching received message: JmsInboundMessageDispatch {sequence = 3, messageId = ID::c64f2b79-f126-4ed1-8822-8d9c8f6e784b:1:1:1-1, consumerId = ID::37eae8b1-14ce-4809-ba78-35ccddcc8b82:1:1:1}
2016-03-15 17:29:35 DEBUG FailoverProvider:963 - Executing Failover Task: create -&amp;gt; JmsProducerInfo {} (5)
2016-03-15 17:29:35 DEBUG AmqpConsumer:520 - Dispatching received message: JmsInboundMessageDispatch {sequence = 4, messageId = ID::f47b9f24-f740-4b76-b981-de25b91e87df:1:1:1-1, consumerId = ID::37eae8b1-14ce-4809-ba78-35ccddcc8b82:1:1:1}
2016-03-15 17:29:35 DEBUG AmqpConsumer:520 - Dispatching received message: JmsInboundMessageDispatch {sequence = 5, messageId = ID::e8c5f733-7382-4b29-a217-b8f3b5bc4617:1:1:1-1, consumerId = ID::37eae8b1-14ce-4809-ba78-35ccddcc8b82:1:1:1}
2016-03-15 17:29:35 DEBUG AmqpConsumer:520 - Dispatching received message: JmsInboundMessageDispatch {sequence = 6, messageId = ID::666cf19b-9b9e-4d2b-bea8-6572cef030e6:1:1:1-1, consumerId = ID::37eae8b1-14ce-4809-ba78-35ccddcc8b82:1:1:1}
2016-03-15 17:29:35 DEBUG AmqpConsumer:520 - Dispatching received message: JmsInboundMessageDispatch {sequence = 7, messageId = ID::f92beb52-b724-47a7-b3b9-80aa68a37d5d:1:1:1-1, consumerId = ID::37eae8b1-14ce-4809-ba78-35ccddcc8b82:1:1:1}
2016-03-15 17:29:35 DEBUG AmqpConsumer:520 - Dispatching received message: JmsInboundMessageDispatch {sequence = 8, messageId = ID::eed9e416-3a6c-4980-8eb3-dc29ebfeafd4:1:1:1-1, consumerId = ID::37eae8b1-14ce-4809-ba78-35ccddcc8b82:1:1:1}
2016-03-15 17:29:35 DEBUG AmqpSession:98 - Creating AmqpFixedProducer &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;: scalabilityQueue
2016-03-15 17:29:35 DEBUG FailoverProvider:963 - Executing Failover Task: send -&amp;gt; JmsOutboundMessageDispatch {dispatchId = ID::37eae8b1-14ce-4809-ba78-35ccddcc8b82:1:1:1-1 (6)
2016-03-15 17:29:35 DEBUG AmqpConsumer:520 - Dispatching received message: JmsInboundMessageDispatch {sequence = 9, messageId = ID::37eae8b1-14ce-4809-ba78-35ccddcc8b82:1:1:1-1, consumerId = ID::37eae8b1-14ce-4809-ba78-35ccddcc8b82:1:1:1}
2016-03-15 17:29:35 DEBUG FailoverProvider:963 - Executing Failover Task: message acknowledge -&amp;gt; JmsInboundMessageDispatch {sequence = 1, messageId = ID::d1b9561b-d32f-4a0b-a083-70dda07d6675:1:1:1-1, consumerId = ID::37eae8b1-14ce-4809-ba78-35ccddcc8b82:1:1:1} ackType: ACCEPTED (7)
2016-03-15 17:29:35 DEBUG AmqpConsumer:241 - Accepted Ack of message: JmsInboundMessageDispatch {sequence = 1, messageId = ID::d1b9561b-d32f-4a0b-a083-70dda07d6675:1:1:1-1, consumerId = ID::37eae8b1-14ce-4809-ba78-35ccddcc8b82:1:1:1}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Failing test Log:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2016-03-15 17:29:35 DEBUG FailoverProvider:160 - Initiating initial connection attempt task
2016-03-15 17:29:35 DEBUG FailoverProvider:653 - Connection attempt:[1] to: amqp:&lt;span class=&quot;code-comment&quot;&gt;//localhost:10354?amqp.vhost=weather in-progress
&lt;/span&gt;2016-03-15 17:29:35 DEBUG FailoverProvider:963 - Executing Failover Task: create -&amp;gt; JmsConnectionInfo {} (1)
2016-03-15 17:29:35 INFO  SaslMechanismFinder:93 - Best match &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; SASL auth was: SASL-ANONYMOUS
2016-03-15 17:29:35 INFO  AmqpAbstractResource:127 - Resource JmsConnectionInfo {} was remotely closed
2016-03-15 17:29:35 DEBUG FailoverProvider:1078 - Request received error: Received error from remote peer without description [condition = amqp:not-found]
2016-03-15 17:29:35 DEBUG FailoverProvider:519 - handling Provider failure: Received error from remote peer without description [condition = amqp:not-found]
2016-03-15 17:29:35 DEBUG FailoverProvider:761 - Failover: the provider reports failure: Received error from remote peer without description [condition = amqp:not-found]
2016-03-15 17:29:35 DEBUG FailoverProvider:519 - handling Provider failure: Received error from remote peer without description [condition = amqp:not-found]
2016-03-15 17:29:35 DEBUG FailoverProvider:653 - Connection attempt:[1] to: amqp:&lt;span class=&quot;code-comment&quot;&gt;//localhost:10352?amqp.vhost=weather in-progress
&lt;/span&gt;2016-03-15 17:29:35 DEBUG FailoverProvider:963 - Executing Failover Task: create -&amp;gt; JmsConnectionInfo {} (1)
2016-03-15 17:29:35 DEBUG AmqpProvider:746 - Transport connection remotely closed
2016-03-15 17:29:35 DEBUG FailoverProvider:1078 - Request received error: Transport connection remotely closed.
2016-03-15 17:29:35 DEBUG FailoverProvider:519 - handling Provider failure: Transport connection remotely closed.
2016-03-15 17:29:35 DEBUG FailoverProvider:761 - Failover: the provider reports failure: Transport connection remotely closed.
2016-03-15 17:29:35 DEBUG FailoverProvider:653 - Connection attempt:[1] to: amqp:&lt;span class=&quot;code-comment&quot;&gt;//localhost:5672?amqp.vhost=weather in-progress
&lt;/span&gt;2016-03-15 17:29:35 DEBUG FailoverProvider:519 - handling Provider failure: Transport connection remotely closed.
2016-03-15 17:29:35 DEBUG FailoverProvider:963 - Executing Failover Task: create -&amp;gt; JmsConnectionInfo {} (1)
2016-03-15 17:29:35 INFO  SaslMechanismFinder:93 - Best match &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; SASL auth was: SASL-ANONYMOUS
2016-03-15 17:29:35 DEBUG AmqpConnectionBuilder:71 - AmqpConnection { ID::5f6b0685-5b06-4a24-ae75-8b3bccdc2b1e:1 } is now open: 
2016-03-15 17:29:35 INFO  JmsConnection:1114 - Connection ID::5f6b0685-5b06-4a24-ae75-8b3bccdc2b1e:1 connected to remote Broker: amqp:&lt;span class=&quot;code-comment&quot;&gt;//localhost:5672
&lt;/span&gt;2016-03-15 17:29:35 DEBUG FailoverProvider:963 - Executing Failover Task: create -&amp;gt; JmsSessionInfo {} (2)
2016-03-15 17:29:35 DEBUG FailoverProvider:963 - Executing Failover Task: create -&amp;gt; JmsConsumerInfo {} (3)
2016-03-15 17:29:35 DEBUG FailoverProvider:963 - Executing Failover Task: start -&amp;gt; JmsConsumerInfo {} (4)
2016-03-15 17:29:35 DEBUG FailoverProvider:963 - Executing Failover Task: create -&amp;gt; JmsProducerInfo {} (5)
2016-03-15 17:29:35 DEBUG AmqpSession:98 - Creating AmqpFixedProducer &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;: scalabilityQueue
2016-03-15 17:29:35 DEBUG FailoverProvider:963 - Executing Failover Task: send -&amp;gt; JmsOutboundMessageDispatch {dispatchId = ID::5f6b0685-5b06-4a24-ae75-8b3bccdc2b1e:1:1:1-1 (6)
2016-03-15 17:29:35 DEBUG AmqpConsumer:520 - Dispatching received message: JmsInboundMessageDispatch {sequence = 10, messageId = ID::5f6b0685-5b06-4a24-ae75-8b3bccdc2b1e:1:1:1-1, consumerId = ID::37eae8b1-14ce-4809-ba78-35ccddcc8b82:1:1:1}
2016-03-15 17:29:40 DEBUG FailoverProvider:963 - Executing Failover Task: message pull -&amp;gt; ID::5f6b0685-5b06-4a24-ae75-8b3bccdc2b1e:1:1:1 (7)
2016-03-15 17:29:40 DEBUG FailoverProvider:963 - Executing Failover Task: start -&amp;gt; JmsConsumerInfo {} (8)

java.lang.AssertionError: expecting actual value not to be &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;

	at org.fest.assertions.Fail.failure(Fail.java:228)
	at org.fest.assertions.Fail.fail(Fail.java:167)
	at org.fest.assertions.Fail.failIfActualIsNull(Fail.java:100)
	at org.fest.assertions.GenericAssert.isNotNull(GenericAssert.java:238)
	at test.ScalabilityTest.exchangeMessages(ScalabilityTest.java:50)
	at test.ScalabilityTest.testScalabilityReversedOrder(ScalabilityTest.java:33)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:271)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:70)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
	at org.junit.runner.JUnitCore.run(JUnitCore.java:160)
	at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:69)
	at com.intellij.rt.execution.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:234)
	at com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:74)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at com.intellij.rt.execution.application.AppMain.main(AppMain.java:144)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.jms.*;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.qpid.jms.JmsConnectionFactory;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; org.fest.assertions.Assertions.assertThat;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.junit.Test;


&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ScalabilityTest {

    &lt;span class=&quot;code-comment&quot;&gt;//~ ----------------------------------------------------------------------------------------------------------------
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;//~ Methods 
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;//~ ----------------------------------------------------------------------------------------------------------------
&lt;/span&gt;
    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testScalability() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; JMSException {
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; brokerUrl = &lt;span class=&quot;code-quote&quot;&gt;&quot;failover:(amqp:&lt;span class=&quot;code-comment&quot;&gt;//localhost:5672,amqp://localhost:10354,amqp://localhost:10352)?failover.nested.amqp.vhost=weather&quot;&lt;/span&gt;;
&lt;/span&gt;        exchangeMessages(brokerUrl);
    }

    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testScalabilityReversedOrder() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; JMSException {
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; brokerUrl = &lt;span class=&quot;code-quote&quot;&gt;&quot;failover:(amqp:&lt;span class=&quot;code-comment&quot;&gt;//localhost:10354,amqp://localhost:10352,amqp://localhost:5672)?failover.nested.amqp.vhost=weather&quot;&lt;/span&gt;;
&lt;/span&gt;        exchangeMessages(brokerUrl);
    }

    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void exchangeMessages(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; brokerUrl) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; JMSException {
        ConnectionFactory connectionFactory = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JmsConnectionFactory(brokerUrl);
        Connection connection = connectionFactory.createConnection();
        Session session = connection.createSession(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, Session.AUTO_ACKNOWLEDGE);
        connection.start();
        Queue queue = session.createQueue(&lt;span class=&quot;code-quote&quot;&gt;&quot;scalabilityQueue&quot;&lt;/span&gt;);

        MessageConsumer consumer = session.createConsumer(queue);
        TextMessage message = session.createTextMessage(&lt;span class=&quot;code-quote&quot;&gt;&quot;Hello world!&quot;&lt;/span&gt;);
        MessageProducer producer = session.createProducer(queue);
        producer.send(message);

        TextMessage receivedMessage = (TextMessage) consumer.receive(5000);

        assertThat(receivedMessage).isNotNull();
        assertThat(receivedMessage.getText()).isEqualTo(message.getText());
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15195637" author="tabish121" created="Tue, 15 Mar 2016 16:55:52 +0000"  >&lt;p&gt;So this looks like it is a different issue from the original which means it might be best to open a new one to track it.  &lt;/p&gt;</comment>
                            <comment id="15196031" author="tabish121" created="Tue, 15 Mar 2016 19:30:02 +0000"  >&lt;p&gt;I tried reproducing this in an client side integration test and could not.  One thing I don&apos;t see in the test you have posted is clean-up code for the previously opened connections / consumers, is there such code?  Don&apos;t want to chase something if there is just a rogue consumer still running in the background given that both calls run consumers on the same Queue.&lt;/p&gt;</comment>
                            <comment id="15196299" author="jira-bot" created="Tue, 15 Mar 2016 21:29:29 +0000"  >&lt;p&gt;Commit 274fff802dfae00f5722ceebbc952362fcbe4e54 in qpid-jms&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tabish121&quot; class=&quot;user-hover&quot; rel=&quot;tabish121&quot;&gt;tabish121&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=qpid-jms.git;h=274fff8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=qpid-jms.git;h=274fff8&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPIDJMS-154&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/QPIDJMS-154&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Add more testing for connection state after failure to connect when the&lt;br/&gt;
peer sends error info.  &lt;/p&gt;</comment>
                            <comment id="15197179" author="sta191919@gmail.com" created="Wed, 16 Mar 2016 11:01:19 +0000"  >&lt;p&gt;You were absolutely right. When I closed the connection properly after each test, they are all run successfully. So for me the issue is fixed.&lt;/p&gt;

&lt;p&gt;I really apologize for missing out on the connection closing stuff.&lt;/p&gt;</comment>
                            <comment id="15197250" author="tabish121" created="Wed, 16 Mar 2016 12:29:33 +0000"  >&lt;p&gt;Great, just glad it&apos;s all working now.  &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12792782" name="Broker1.png" size="279311" author="sta191919@gmail.com" created="Fri, 11 Mar 2016 11:42:55 +0000"/>
                            <attachment id="12792783" name="broker2.png" size="284492" author="sta191919@gmail.com" created="Fri, 11 Mar 2016 11:42:55 +0000"/>
                    </attachments>
                <subtasks>
                            <subtask id="12949919">QPIDJMS-155</subtask>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 35 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2uihr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>