<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:18:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[QPIDJMS-474] NPE upon connection failure during transacted session setup</title>
                <link>https://issues.apache.org/jira/browse/QPIDJMS-474</link>
                <project id="12314524" key="QPIDJMS">Qpid JMS</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I am using qpid-cms-client version 0.39.0, but I can see that the same problem exists in the current version.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;The function `JmsLocalTransactionContext.onConnectionInterrupted is missing a null-check for the `transactionInfo` field.&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;This function is called from `JmsSession.onConnectionInterrupted`. If `transactionInfo` is null, this leads to the fact that consumers and producers are not properly notified of the interrupted connection.&lt;/p&gt;

&lt;p&gt;I am using qpid-jms-client in conjunction with Spring&apos;s `SingleConnectionFactory`. I can see rare cases where `transactionInfo` is null and in which the SpringConnectionFactory will not be informed about the transaction loss. In these cases, there is no automatic reconnect from Spring.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Below some logging when the NPE occurs:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2019-09-19T08:39:17,141 [WARN ] [AmqpProvider :(2):[amqps:&lt;span class=&quot;code-comment&quot;&gt;//10.0.0.12:5672]] AbstractEventExecutor - A task raised an exception. Task: org.apache.qpid.jms.provider.amqp.AmqpProvider$$Lambda$327/2054861790@467bfdd
&lt;/span&gt;java.lang.NullPointerException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
&#160; &#160; &#160; &#160; at org.apache.qpid.jms.JmsLocalTransactionContext.onConnectionInterrupted(JmsLocalTransactionContext.java:333) ~[qpid-jms-client-0.39.0.jar!/:?]
&#160; &#160; &#160; &#160; at org.apache.qpid.jms.JmsSession.onConnectionInterrupted(JmsSession.java:1340) ~[qpid-jms-client-0.39.0.jar!/:?]
&#160; &#160; &#160; &#160; at org.apache.qpid.jms.JmsConnection.onConnectionFailure(JmsConnection.java:1356) ~[qpid-jms-client-0.39.0.jar!/:?]
&#160; &#160; &#160; &#160; at org.apache.qpid.jms.provider.amqp.AmqpProvider.fireProviderException(AmqpProvider.java:1069) ~[qpid-jms-client-0.39.0.jar!/:?]
&#160; &#160; &#160; &#160; at org.apache.qpid.jms.provider.amqp.AmqpProvider.lambda$onTransportClosed$18(AmqpProvider.java:867) ~[qpid-jms-client-0.39.0.jar!/:?]
&#160; &#160; &#160; &#160; at io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:163) ~[netty-common-4.1.29.Final.jar!/:4.1.29.Final]
&#160; &#160; &#160; &#160; at io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:404) ~[netty-common-4.1.29.Final.jar!/:4.1.29.Final]
&#160; &#160; &#160; &#160; at io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:315) ~[netty-transport-&lt;span class=&quot;code-keyword&quot;&gt;native&lt;/span&gt;-epoll-4.1.29.Final-linux-x86_64.jar!/:4.1.29.Final]
&#160; &#160; &#160; &#160; at io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:884) ~[netty-common-4.1.29.Final.jar!/:4.1.29.Final]
&#160; &#160; &#160; &#160; at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748) [?:1.8.0_201]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;My suspicion is that this NPE is responsible for the exception not properly proparagated, but I am still investigating.&lt;/p&gt;

&lt;p&gt;It would help very much if anyone from the Qpid team could validate this as well.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</description>
                <environment></environment>
        <key id="13257654">QPIDJMS-474</key>
            <summary>NPE upon connection failure during transacted session setup</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="robbie">Robbie Gemmell</assignee>
                                    <reporter username="marioschlipf">Mario Schlipf</reporter>
                        <labels>
                    </labels>
                <created>Thu, 19 Sep 2019 12:05:16 +0000</created>
                <updated>Mon, 30 Sep 2019 07:51:44 +0000</updated>
                            <resolved>Thu, 19 Sep 2019 14:12:07 +0000</resolved>
                                    <version>0.45.0</version>
                                    <fixVersion>0.46.0</fixVersion>
                                    <component>qpid-jms-client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16933419" author="jira-bot" created="Thu, 19 Sep 2019 14:08:54 +0000"  >&lt;p&gt;Commit 4a9aab83bca11f7346215a827266e5039df1393d in qpid-jms&apos;s branch refs/heads/master from Robert Gemmell&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=qpid-jms.git;h=4a9aab8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=qpid-jms.git;h=4a9aab8&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPIDJMS-474&quot; title=&quot;NPE upon connection failure during transacted session setup&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPIDJMS-474&quot;&gt;&lt;del&gt;QPIDJMS-474&lt;/del&gt;&lt;/a&gt;: better handle connection failure mid-creation on transacted session&lt;/p&gt;</comment>
                            <comment id="16933425" author="gemmellr" created="Thu, 19 Sep 2019 14:12:07 +0000"  >&lt;p&gt;I&apos;ve pushed a change to address the issue, which can occur if connection failure occurs between a session being created on the wire, but before its transaction coordinator is first established and a transaction declared.&lt;/p&gt;</comment>
                            <comment id="16933460" author="marioschlipf" created="Thu, 19 Sep 2019 14:50:42 +0000"  >&lt;p&gt;Thank you very much for the quick resolution of this issue, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=robbie&quot; class=&quot;user-hover&quot; rel=&quot;robbie&quot;&gt;robbie&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="16936483" author="marioschlipf" created="Tue, 24 Sep 2019 07:08:18 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=robbie&quot; class=&quot;user-hover&quot; rel=&quot;robbie&quot;&gt;robbie&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;The broker that we connect to in our application kills the connection once every day. We have seen in the past days that this NPE has become a real problem in production and we manually need to restart our application because the connection problem is not properly propagated.&lt;/p&gt;

&lt;p&gt;Are there any plans when the next qpid-jms-client version 0.46 will be released?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Mario&lt;/p&gt;</comment>
                            <comment id="16937049" author="gemmellr" created="Tue, 24 Sep 2019 17:49:36 +0000"  >&lt;p&gt;I have just opened a vote on a 0.46.0 candidate, so depending on how the vote goes it may be released in a few days or so.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 7 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z06t5c:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>