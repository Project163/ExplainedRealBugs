<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:18:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[QPIDJMS-189] update JMSMessageID and JMSCorrelationID handling to address interop issues with non-JMS peers</title>
                <link>https://issues.apache.org/jira/browse/QPIDJMS-189</link>
                <project id="12314524" key="QPIDJMS">Qpid JMS</project>
                    <description>&lt;p&gt;When a JMS application sets JMSCorrelationID on a Message, it can do so either using a JMSMessageID value (a String beginning with &quot;ID:&quot;) or an application-specific string value. Previously we decided that the &quot;ID:&quot; prefix of a JMSMessageID should not be sent on the wire so other non-JMS client need not deal with it, and a message-id recieved from a non-JMS client would round-trip correctly as a correlation-id value. An annotation was used on messages to record whether an application-specific JMSCorrelationID value was in use so that recieving JMS clients would restore the &apos;ID:&apos; prefix for JMSCorrelationID if needed. &lt;/p&gt;

&lt;p&gt;This approach has an issue in that if a correlation-id value is rountripped into a response message by a client/service that doesnt understand the annotations use and include it in the response, then the JMSCorrelationID value retrieved from the response message may not match the value sent on the original message. &lt;/p&gt;

&lt;p&gt;Additionally, as originally noticed on this JIRA (details below), a bug and loose test has meant that the client HAS begun sending the &apos;ID:&apos; prefix for JMSMessageID values inadvertantly, which when roundtripped to a response message by a non-JMS peer, results in the JMSCorrelationID getting a second erroneous &apos;ID:&apos; prefix added when the response is examined by the original JMS application.&lt;/p&gt;

&lt;p&gt;This JIRA will serve to introduce changes to the JMSMessageID and JMSCorrelationID handling to help resolve these interop issues, changing things such that the &apos;ID:&apos; prefix is deliberately sent on the wire and for a correlation ids is used in place of the annotation to discriminate between one which is a message id string and one which is an application specific string.&lt;/p&gt;

&lt;p&gt;================&lt;br/&gt;
Original description&lt;/p&gt;

&lt;p&gt;I am trying to use Qpid JMS client to send a message to a non-JMS application which returns a message to the client based on the request&apos;s reply-to property.&lt;br/&gt;
In order to correlate the response received from the non-JMS app with the request, I want to use the incoming message&apos;s JMSCorrelationID property.&lt;br/&gt;
The non-JMS application simply takes the incoming message&apos;s message-id property and puts it into the outgoing response&apos;s correlation-id property.&lt;/p&gt;

&lt;p&gt;However, when I send a message using Qpid JMS with default configuration, e.g. using a connection URI like &lt;tt&gt;amqp://myhost:myport&lt;/tt&gt;, then the message ID of the sent message retrieved via &lt;tt&gt;Message.getJMSMessageId()&lt;/tt&gt; looks something like &lt;tt&gt;ID:aef45f-...&lt;/tt&gt; and the message-id of the incoming request in the non-JMS app contains the same ID, i.e. &lt;tt&gt;ID:aef45f-...&lt;/tt&gt;. However, the correlation ID retrieved from the response via &lt;tt&gt;Message.getJMSCorrelationId()&lt;/tt&gt; at the JMS client starts with &lt;tt&gt;ID:ID:aef45f-...&lt;/tt&gt;, i.e. having a duplicate &lt;em&gt;ID:&lt;/em&gt; prefix, and thus cannot be matched to the original message ID.&lt;/p&gt;

&lt;p&gt;I have tracked down the problem to the inconsistent implementation of &lt;tt&gt;AmqpJmsMessageFacade&lt;/tt&gt;&apos;s &lt;tt&gt;getMessageId()&lt;/tt&gt; and &lt;tt&gt;getCorrelationId()&lt;/tt&gt; methods. The former only adds an &lt;em&gt;ID:&lt;/em&gt; prefix to the underlying message ID if it doesn&apos;t already contain that prefix whereas the latter always adds the prefix (unless the &lt;tt&gt;x-opt-app-correlation-id&lt;/tt&gt; header is set).&lt;/p&gt;

&lt;p&gt;The problem can be worked around by explicitly setting another connection ID prefix using the &lt;tt&gt;jms.connectionIDPrefix&lt;/tt&gt; connection URI parameter ni order to define a different prefix than the default one (&lt;em&gt;ID&lt;/em&gt;).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12983832">QPIDJMS-189</key>
            <summary>update JMSMessageID and JMSCorrelationID handling to address interop issues with non-JMS peers</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="robbie">Robbie Gemmell</assignee>
                                    <reporter username="sophokles73">Kai Hudalla</reporter>
                        <labels>
                    </labels>
                <created>Mon, 27 Jun 2016 15:52:49 +0000</created>
                <updated>Mon, 9 Jan 2017 16:34:07 +0000</updated>
                            <resolved>Thu, 1 Sep 2016 15:22:27 +0000</resolved>
                                    <version>0.9.0</version>
                    <version>0.10.0</version>
                                    <fixVersion>0.11.0</fixVersion>
                                    <component>qpid-jms-client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15351307" author="gemmellr" created="Mon, 27 Jun 2016 16:01:10 +0000"  >&lt;p&gt;See also &lt;a href=&quot;https://issues.oasis-open.org/browse/AMQPBINDMAP-15&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://issues.oasis-open.org/browse/AMQPBINDMAP-15&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15367495" author="gemmellr" created="Fri, 8 Jul 2016 10:18:55 +0000"  >&lt;p&gt;Having a look at this again, and not misreading your comments this time, I see whats happened.&lt;/p&gt;

&lt;p&gt;The methods you mention are actually working as originally intended, though as per the above there are some issues with that regardless. The actual root problem here is that the client is mistakenly sending the &quot;ID:&quot; prefix in the message-id on the wire which it wasnt intended to and didnt used to. A change in behaviour was introduced while refactoring the message-id handling to support different ID types/formats and a test meant to verify that behaviour isnt strict enough in its checks, meaning the change of behaviour didn&apos;t get caught. By setting the connection id prefix, you effectively restored the &apos;dont send ID:&apos; behaviour and made it work in the manner originally intended.&lt;/p&gt;

&lt;p&gt;I&apos;ll look to get a fix for this in for 0.11.0, possibly in concert with changes around the above JIRA.&lt;/p&gt;</comment>
                            <comment id="15367569" author="sophokles73" created="Fri, 8 Jul 2016 11:38:05 +0000"  >&lt;p&gt;That is exactly what I had also figured. Thanks for taking another look &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15384007" author="gemmellr" created="Tue, 19 Jul 2016 11:50:59 +0000"  >&lt;p&gt;Attaching patch with potential changes for an overhaul of message-id and correlation-id handling, from trying out implementation of an idea for discussion (at OASIS).&lt;/p&gt;

&lt;p&gt;(I also made the simpler change to just stop sending the &quot;ID:&quot; prefix to restore the originally intended behaviour from &amp;lt;= 0.5.0, but seem to have misplaced it. It&apos;s comparatively trivial)&lt;/p&gt;</comment>
                            <comment id="15455692" author="jira-bot" created="Thu, 1 Sep 2016 15:02:23 +0000"  >&lt;p&gt;Commit 7b34f4fc3f62bc04dff36cdf0e110e6436a66dc9 in qpid-jms&apos;s branch refs/heads/master from Robert Gemmell&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=qpid-jms.git;h=7b34f4f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=qpid-jms.git;h=7b34f4f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPIDJMS-189&quot; title=&quot;update JMSMessageID and JMSCorrelationID handling to address interop issues with non-JMS peers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPIDJMS-189&quot;&gt;&lt;del&gt;QPIDJMS-189&lt;/del&gt;&lt;/a&gt;: update handling of JMSMessageID and JMSCorrelationID, facilitate better interop with non-JMS peers when round tripping for correlation&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Send the &apos;ID:&apos; prefix of JMSMessageID values on the wire &lt;span class=&quot;error&quot;&gt;&amp;#91;Deliberately, as opposed to accidentally as started happening&amp;#93;&lt;/span&gt;.&lt;/li&gt;
	&lt;li&gt;Use the &apos;ID:&apos; prefix on the wire for string based correlation-id values to distinguish whether they are application-specific or JMSMessageID based values.&lt;/li&gt;
	&lt;li&gt;Use AMQP_NO_PREFIX to escape arriving message-id strings that dont have the &apos;ID:&apos; prefix so they can be correctly round tripped back as correlation-id.&lt;/li&gt;
	&lt;li&gt;Account for arriving message-id and correlation-id strings that start with &apos;ID:&apos; &lt;b&gt;then&lt;/b&gt; an encoding prefix, ensure they roundtrip correctly to JMSCorrelationID.&lt;/li&gt;
	&lt;li&gt;Add PREFIXED_UUID_STRING option for sent message-id, leave existing option sending stringified UUID only.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15455694" author="jira-bot" created="Thu, 1 Sep 2016 15:02:26 +0000"  >&lt;p&gt;Commit 443a54d6c9fa919253316f01bbeed83bb27e7aef in qpid-jms&apos;s branch refs/heads/master from Robert Gemmell&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=qpid-jms.git;h=443a54d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=qpid-jms.git;h=443a54d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPIDJMS-189&quot; title=&quot;update JMSMessageID and JMSCorrelationID handling to address interop issues with non-JMS peers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPIDJMS-189&quot;&gt;&lt;del&gt;QPIDJMS-189&lt;/del&gt;&lt;/a&gt;: some test cleanup&lt;/p&gt;</comment>
                            <comment id="15455979" author="jira-bot" created="Thu, 1 Sep 2016 16:52:34 +0000"  >&lt;p&gt;Commit ae12a5a73d6cbc0d5c4e6c44d73ec5ff45b70749 in qpid-jms&apos;s branch refs/heads/master from Robert Gemmell&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=qpid-jms.git;h=ae12a5a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=qpid-jms.git;h=ae12a5a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPIDJMS-189&quot; title=&quot;update JMSMessageID and JMSCorrelationID handling to address interop issues with non-JMS peers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPIDJMS-189&quot;&gt;&lt;del&gt;QPIDJMS-189&lt;/del&gt;&lt;/a&gt;: include new option value in the config docs&lt;/p&gt;</comment>
                            <comment id="15471761" author="jira-bot" created="Wed, 7 Sep 2016 20:51:22 +0000"  >&lt;p&gt;Commit de50d9df553ab95594dc97f60047e3bf092fd478 in qpid-jms&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tabish121&quot; class=&quot;user-hover&quot; rel=&quot;tabish121&quot;&gt;tabish121&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=qpid-jms.git;h=de50d9d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=qpid-jms.git;h=de50d9d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPIDJMS-189&quot; title=&quot;update JMSMessageID and JMSCorrelationID handling to address interop issues with non-JMS peers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPIDJMS-189&quot;&gt;&lt;del&gt;QPIDJMS-189&lt;/del&gt;&lt;/a&gt;: Adds some missing Javadoc tags&lt;/p&gt;

&lt;p&gt;Exception tags needed if code checks are done to ensure all Javadocs&lt;br/&gt;
have correct tags.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12818800" name="0001-WIP-QPIDJMS-189-candidate-for-changes-to-JMSMessageI.patch" size="107410" author="robbie" created="Tue, 19 Jul 2016 11:50:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 10 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i30707:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>