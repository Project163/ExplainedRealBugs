<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:18:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[QPIDJMS-438] details of remotely closed Sessions are not removed from the Connection</title>
                <link>https://issues.apache.org/jira/browse/QPIDJMS-438</link>
                <project id="12314524" key="QPIDJMS">Qpid JMS</project>
                    <description>&lt;p&gt;The Connection keeps track of its Sessions for housekeeping purposes, and previously these details have only been cleaned up fully if the Session close() method is called. If a Session is remotely closed, further attempts to use it and its resources will throw an exception as they are then marked closed. It is probable an application wont then call close() on the Session.  If the application continues using the Connection in such a scenario, then the tracking details of the closed Session is retained thus leaking a small amount of memory, which if it is repeated a lot over time may eventually cause problems.&lt;/p&gt;

&lt;p&gt;The cleanup of this information should be moved into the Session shutdown process which occurs when it is locally or remotely closed.&lt;/p&gt;

&lt;p&gt;Original Description:&lt;br/&gt;
================&lt;/p&gt;

&lt;p&gt;We use Qpid JMS to connect to the Azure service bus.&lt;/p&gt;

&lt;p&gt;In our applications we cache the connections in a pool and cache a session for each connection for sending messages.&lt;/p&gt;

&lt;p&gt;When Azure believes the connection is idle for 5 minutes it is remotely closed. Resulting in closing the cached session in the application. The application responds by replacing the cached session with a newly created session.&lt;/p&gt;

&lt;p&gt;The problem here is that the closed sessions are not removed from the connection. Eventually resulting in an OutOfMemoryError.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13203957">QPIDJMS-438</key>
            <summary>details of remotely closed Sessions are not removed from the Connection</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tabish">Timothy A. Bish</assignee>
                                    <reporter username="ddfranco">David De Franco</reporter>
                        <labels>
                    </labels>
                <created>Wed, 12 Dec 2018 10:36:25 +0000</created>
                <updated>Thu, 20 Dec 2018 16:33:26 +0000</updated>
                            <resolved>Wed, 12 Dec 2018 17:33:41 +0000</resolved>
                                    <version>0.39.0</version>
                                    <fixVersion>0.40.0</fixVersion>
                                    <component>qpid-jms-client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16718922" author="gemmellr" created="Wed, 12 Dec 2018 12:33:13 +0000"  >&lt;p&gt;Inspecting things does suggest the sessions aren&apos;t fully cleaned up given a remote closure.&lt;/p&gt;

&lt;p&gt;Can you however enable protocol trace logging to show the remote session closures? I don&apos;t recall the sessions being closed from (potentially faulty) recollection of past discussion on this behaviour, only the producers. Its possible the behaviour has changed. Or are you closing your producers after each send and actually leaving the sessions &apos;unused&apos;?&lt;/p&gt;</comment>
                            <comment id="16718939" author="ddfranco" created="Wed, 12 Dec 2018 12:46:42 +0000"  >&lt;p&gt;We are not closing the producers. How can I enable the requested trace logging?&lt;/p&gt;</comment>
                            <comment id="16718943" author="gemmellr" created="Wed, 12 Dec 2018 12:49:18 +0000"  >&lt;p&gt;There are a couple of options, they are described at: &lt;a href=&quot;http://qpid.apache.org/releases/qpid-jms-0.39.0/docs/index.html#logging&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://qpid.apache.org/releases/qpid-jms-0.39.0/docs/index.html#logging&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16718948" author="ddfranco" created="Wed, 12 Dec 2018 13:02:47 +0000"  >&lt;p&gt;Added a trace log of the application sending two messages with the 5 minute timeout in between.&lt;/p&gt;</comment>
                            <comment id="16719034" author="gemmellr" created="Wed, 12 Dec 2018 14:42:20 +0000"  >&lt;p&gt;Ok, the logging shows the producer links are actually being closed after send, though not because your application code is closing the producer.&lt;/p&gt;

&lt;p&gt;In AMQP 1.0 sending links be established to a given &apos;address&apos; of a &apos;node&apos; (e.g queue). An extension mechanism was defined to allow producing to an &apos;anonymous relay&apos; node for use with things like JMS anonymous producers. Service Bus is not advertising support for the mechanism, and so the client is falling back to an behaviour which opens and closes sender links as messages are produced using the anonymous producer. As a result, when inbetween sends, your session really is &apos;unused&apos; and so ServiceBus does decide to close it. Can you use fixed-address producers?&lt;/p&gt;</comment>
                            <comment id="16719242" author="jira-bot" created="Wed, 12 Dec 2018 17:33:05 +0000"  >&lt;p&gt;Commit 26ec26863410ddf11097054987764b93567a4663 in qpid-jms&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tabish121&quot; class=&quot;user-hover&quot; rel=&quot;tabish121&quot;&gt;tabish121&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=qpid-jms.git;h=26ec268&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=qpid-jms.git;h=26ec268&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPIDJMS-438&quot; title=&quot;details of remotely closed Sessions are not removed from the Connection&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPIDJMS-438&quot;&gt;&lt;del&gt;QPIDJMS-438&lt;/del&gt;&lt;/a&gt; Ensure that closed sessions are removed from tracking&lt;/p&gt;

&lt;p&gt;When a session is remotely closed it can be left in the Connection&lt;br/&gt;
tracking map which can lead to large leaks of remotely closed sessions&lt;br/&gt;
over time.  Ensure it is removed on shutdown calls.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12951509" name="amqp.log" size="21458" author="ddfranco" created="Wed, 12 Dec 2018 13:02:09 +0000"/>
                            <attachment id="12951499" name="out-of-memory1.PNG" size="319282" author="ddfranco" created="Wed, 12 Dec 2018 10:36:19 +0000"/>
                            <attachment id="12951500" name="out-of-memory2.PNG" size="587397" author="ddfranco" created="Wed, 12 Dec 2018 10:36:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 48 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|s01fs0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>