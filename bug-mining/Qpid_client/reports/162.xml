<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:18:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[QPIDJMS-313] Message#getBody does not throw when attempting to read a BytesMessage as String.class</title>
                <link>https://issues.apache.org/jira/browse/QPIDJMS-313</link>
                <project id="12314524" key="QPIDJMS">Qpid JMS</project>
                    <description>&lt;p&gt;Consider the ActiveMQ Artemis test &lt;tt&gt;org.apache.activemq.artemis.tests.integration.jms.jms2client.BodyTest#testBodyConversion&lt;/tt&gt; adapted to run through multiple JMS ConnectionFactories in turn. This test passes with Core JMS client, is skipped (or should be skipped) with ActiveMQ OpenWire client (that is a JMS 1.1 client) and fails with qpid-jms client.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;         BytesMessage bytesMessage = sess.createBytesMessage();
         producer.send(bytesMessage);

         Message msg = cons.receiveNoWait();
         assertNotNull(msg);

         try {
            msg.getBody(String.class);
            fail(&quot;Exception expected&quot;);
         } catch (MessageFormatException e) {
         }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The failing line is the &lt;tt&gt;fail(&quot;Exception expected&quot;);&lt;/tt&gt;, because qpid-jms does not throw &lt;tt&gt;MessageFormatException&lt;/tt&gt; where it is supposed to.&lt;/p&gt;

&lt;p&gt;According to &lt;a href=&quot;https://docs.oracle.com/javaee/7/api/javax/jms/Message.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.oracle.com/javaee/7/api/javax/jms/Message.html&lt;/a&gt;. &quot;If the message is a BytesMessage then this parameter must be set to byte[].class (or java.lang.Object.class). This method will reset the BytesMessage before and after use.&quot; ... &quot;Throws: MessageFormatException&quot; ... &quot;if the message body cannot be assigned to the specified type.&quot;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13093466">QPIDJMS-313</key>
            <summary>Message#getBody does not throw when attempting to read a BytesMessage as String.class</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jdanek">Jiri Dan&#283;k</reporter>
                        <labels>
                    </labels>
                <created>Wed, 9 Aug 2017 12:48:44 +0000</created>
                <updated>Wed, 9 Aug 2017 16:02:50 +0000</updated>
                            <resolved>Wed, 9 Aug 2017 15:56:11 +0000</resolved>
                                    <version>0.23.0</version>
                    <version>0.24.0</version>
                                                    <component>qpid-jms-client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16120078" author="jira-bot" created="Wed, 9 Aug 2017 15:30:13 +0000"  >&lt;p&gt;Commit ab5f463366acf2547725b0043003d8b8168f46bf in qpid-jms&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tabish121&quot; class=&quot;user-hover&quot; rel=&quot;tabish121&quot;&gt;tabish121&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=qpid-jms.git;h=ab5f463&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=qpid-jms.git;h=ab5f463&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPIDJMS-313&quot; title=&quot;Message#getBody does not throw when attempting to read a BytesMessage as String.class&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPIDJMS-313&quot;&gt;&lt;del&gt;QPIDJMS-313&lt;/del&gt;&lt;/a&gt; Add some additional tests to show the issue is not valid&lt;/p&gt;

&lt;p&gt;Add a few more tests that check in different contexts that the getBody&lt;br/&gt;
method does throw when expected.&lt;/p&gt;</comment>
                            <comment id="16120079" author="tabish121" created="Wed, 9 Aug 2017 15:31:36 +0000"  >&lt;p&gt;This is already tested to work but I&apos;ve added a few other variations that show it works in the client test suite.  I&apos;d recommend checking your tests.  If you can supply a reproducer test for the Qpid JMS suite feel free to reopen. &lt;/p&gt;</comment>
                            <comment id="16120121" author="jdanek" created="Wed, 9 Aug 2017 15:51:48 +0000"  >&lt;p&gt;Thanks for investigating. The difference between what I have and what the Qpid JMS test suite has is essentially this&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;diff --git a/qpid-jms-client/src/test/java/org/apache/qpid/jms/message/JmsBytesMessageTest.java b/qpid-jms-client/src/test/java/org/apache/qpid/jms/message/JmsBytesMessageTest.java
index d56c533c..330f1208 100644
--- a/qpid-jms-client/src/test/java/org/apache/qpid/jms/message/JmsBytesMessageTest.java
+++ b/qpid-jms-client/src/test/java/org/apache/qpid/jms/message/JmsBytesMessageTest.java
@@ -968,8 +968,6 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;JmsBytesMessageTest {
     &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testGetBodyThrowsMessageFormatException() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; JMSException {
         JmsBytesMessage bytesMessage = factory.createBytesMessage();
         bytesMessage.setStringProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;property&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;value&quot;&lt;/span&gt;);
-        bytesMessage.writeByte((&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;) 1);
-        bytesMessage.writeInt(22);
 
         &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
             bytesMessage.getBody(&lt;span class=&quot;code-object&quot;&gt;StringBuffer&lt;/span&gt;.class);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If I remove the two lines (do not set any content of the message) then the Qpid JMS suite starts failing.&lt;/p&gt;</comment>
                            <comment id="16120126" author="tabish121" created="Wed, 9 Aug 2017 15:54:46 +0000"  >&lt;p&gt;Ah, so then your assumption of the result is incorrect then, if you read the Message API you will see that the bullet point below the one you quoted says:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;f the message is a TextMessage, ObjectMessage, MapMessage or BytesMessage and the message has no body, then the above does not apply and this parameter may be set to any type; the returned value will always be null.&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="16120132" author="jdanek" created="Wed, 9 Aug 2017 15:56:53 +0000"  >&lt;p&gt;Oh, I haven&apos;t read the whole document. Thanks.&lt;/p&gt;</comment>
                            <comment id="16120138" author="tabish121" created="Wed, 9 Aug 2017 15:59:15 +0000"  >&lt;p&gt;Give the initial source of the test I&apos;d assert that the Artemis JMS client is probably in violation of the spec if it is throwing the exception when there is no body. &lt;/p&gt;</comment>
                            <comment id="16120144" author="jdanek" created="Wed, 9 Aug 2017 16:02:50 +0000"  >&lt;p&gt;Agreed. I&apos;ve reported that as &lt;a href=&quot;https://issues.apache.org/jira/browse/ARTEMIS-1341&quot; title=&quot;Core JMS does not permit calling Message#getBytes(arbitrary type) when message has empty body&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ARTEMIS-1341&quot;&gt;&lt;del&gt;ARTEMIS-1341&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310460">
                    <name>Child-Issue</name>
                                            <outwardlinks description="is a parent of">
                                        <issuelink>
            <issuekey id="13093118">ARTEMIS-1330</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 14 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3ilav:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>