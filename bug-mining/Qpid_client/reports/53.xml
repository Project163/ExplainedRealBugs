<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:17:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[QPIDJMS-110] Incorrect error handling when the sender.send(...) call / message transfer causes an error</title>
                <link>https://issues.apache.org/jira/browse/QPIDJMS-110</link>
                <project id="12314524" key="QPIDJMS">Qpid JMS</project>
                    <description>&lt;p&gt;It seems to me that the error handling doesn&apos;t work properly when sending a message triggers an error (i.e. the sender.send(...) call, not creating sender). &lt;/p&gt;

&lt;p&gt;On the C++ broker, it is easy to configure the access control to allow message producers to send messages to a certain exchange (topic) only with some particular subjects / routing keys. When the subject / routing key is wrong, the C++ broker will raise &quot;unathorized access&quot; error and detach the link.&lt;/p&gt;

&lt;p&gt;I was running this scenario from the Qpid JMS client and it seems that it doesn&apos;t handle the error well:&lt;br/&gt;
1) Connect with the JMS client to the C++ broker&lt;br/&gt;
2) Open a sender to an exchange on the broker (this has to be allowed in the ACLs on the broker)&lt;br/&gt;
3) Try to send message with subject (i.e. JMSType) which is not allowed in broker ACLs&lt;br/&gt;
4) The broker detaches the link and the Proton library in the client seems to handle it, but the client doesn&apos;t seem to raise any exception to the outside.&lt;/p&gt;

&lt;p&gt;2015-09-15 17:48:36 +0200 TRACE org.apache.qpid.jms.provider.amqp.FRAMES - RECV: Detach{handle=0, closed=true, error=Error{condition=amqp:unauthorized-access, description=&apos;user1@QPID1234 cannot publish to broadcast with routing-key bad.routing.key (/builddir/build/BUILD/qpid-cpp-0.34/src/qpid/broker/amqp/Authorise.cpp:118)&apos;, info=null}}&lt;br/&gt;
2015-09-15 17:48:36 +0200 TRACE org.apache.qpid.jms.provider.amqp.AmqpProvider - New Proton Event: LINK_FLOW&lt;br/&gt;
2015-09-15 17:48:36 +0200 TRACE org.apache.qpid.jms.provider.amqp.AmqpProvider - New Proton Event: LINK_REMOTE_CLOSE&lt;br/&gt;
2015-09-15 17:48:36 +0200 INFO org.apache.qpid.jms.provider.amqp.AmqpAbstractResource - Resource JmsProducerInfo &lt;/p&gt;
{producerId = ID:7W0192-58645-1442332115394-0:1:1:1, destination = broadcast}
&lt;p&gt; was remotely closed&lt;br/&gt;
2015-09-15 17:48:36 +0200 TRACE org.apache.qpid.jms.provider.amqp.AmqpProvider - New Proton Event: LINK_LOCAL_CLOSE&lt;br/&gt;
2015-09-15 17:48:36 +0200 INFO org.apache.qpid.jms.JmsSession - A JMS resource has been remotely closed: JmsProducerInfo &lt;/p&gt;
{producerId = ID:7W0192-58645-1442332115394-0:1:1:1, destination = broadcast}
&lt;p&gt;2015-09-15 17:48:36 +0200 TRACE org.apache.qpid.jms.provider.amqp.FRAMES - SENT: Detach&lt;/p&gt;
{handle=0, closed=true, error=null}

&lt;p&gt;When sending messages asynchronously in a loop, the send(...) call will finish and few &quot;sent&quot; message later it will throw at least &quot;javax.jms.JMSException: send not allowed after the sender is closed.&quot; exception. It doesn&apos;t contain the original error, but at least it is clear that something went wrong. So I think that is quite OK.&lt;/p&gt;

&lt;p&gt;But when sending messages synchronously, it seems to get stuck in the send(...) call and never return, although the underlying session is already gone. I would expect that the send(...) call returns and either throws some exception directly or through the Exception Listener.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12864291">QPIDJMS-110</key>
            <summary>Incorrect error handling when the sender.send(...) call / message transfer causes an error</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="robbie">Robbie Gemmell</assignee>
                                    <reporter username="scholzj">Jakub Scholz</reporter>
                        <labels>
                    </labels>
                <created>Tue, 15 Sep 2015 16:02:25 +0000</created>
                <updated>Wed, 6 Jan 2016 12:32:54 +0000</updated>
                            <resolved>Thu, 17 Sep 2015 14:50:55 +0000</resolved>
                                                    <fixVersion>0.6.0</fixVersion>
                                    <component>qpid-jms-client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14745682" author="gemmellr" created="Tue, 15 Sep 2015 16:29:30 +0000"  >&lt;p&gt;Thanks for raising this..I&apos;d guess that the processing of the remote detach (which as you note, is occuring) isn&apos;t tripping the failure out the outstanding send task, giving the effect you see. It could be argued the broker should possibly have rejected the message, but given the same scenario could happen for other reasons anyway the client should handle it anyway. I&apos;ll take a look tomorrow.&lt;/p&gt;</comment>
                            <comment id="14747193" author="scholzj" created="Wed, 16 Sep 2015 09:16:27 +0000"  >&lt;p&gt;Similar scenario is when the queue where the transfer is targeted is full. In that case, the broker directly closes the connection, resulting in the same situation in the JMS client - the synchronous send gets stuck. But I guess this might also happen purely as a race condition, when the detach / connection close is triggered independently on the transfer, only with a wrong timing and cause the send to be stuck.&lt;/p&gt;</comment>
                            <comment id="14767942" author="jira-bot" created="Wed, 16 Sep 2015 12:12:57 +0000"  >&lt;p&gt;Commit 49aad78c81c33f9268f04c76449afa7fe439381c in qpid-jms&apos;s branch refs/heads/master from Robert Gemmell&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=qpid-jms.git;h=49aad78&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=qpid-jms.git;h=49aad78&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPIDJMS-110&quot; title=&quot;Incorrect error handling when the sender.send(...) call / message transfer causes an error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPIDJMS-110&quot;&gt;&lt;del&gt;QPIDJMS-110&lt;/del&gt;&lt;/a&gt;: ensure deliveries pending update get processed when the producer link is remotely closed&lt;/p&gt;</comment>
                            <comment id="14768829" author="gemmellr" created="Wed, 16 Sep 2015 12:15:49 +0000"  >&lt;p&gt;I have put in an initial change for the first issue. The related issue is a bit more general and will need some more thought. I&apos;m heading out for a while shortly but will look into that later&lt;/p&gt;</comment>
                            <comment id="14802780" author="jira-bot" created="Thu, 17 Sep 2015 11:46:46 +0000"  >&lt;p&gt;Commit 172c9102ffb94a0d246fcdf967e72a00ce40dc09 in qpid-jms&apos;s branch refs/heads/master from Robert Gemmell&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=qpid-jms.git;h=172c910&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=qpid-jms.git;h=172c910&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPIDJMS-110&quot; title=&quot;Incorrect error handling when the sender.send(...) call / message transfer causes an error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPIDJMS-110&quot;&gt;&lt;del&gt;QPIDJMS-110&lt;/del&gt;&lt;/a&gt;: ensure outstanding sync send requests are updated when the connection fails &lt;span class=&quot;error&quot;&gt;&amp;#91;and failover isnt in use&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="14802795" author="gemmellr" created="Thu, 17 Sep 2015 11:52:56 +0000"  >&lt;p&gt;I&apos;ve made another change aimed specifically at the second issue described with sync send(). There are more general changes needed in the related areas I think, but those will be a larger change on their own JIRA.&lt;/p&gt;</comment>
                            <comment id="14802834" author="scholzj" created="Thu, 17 Sep 2015 12:23:52 +0000"  >&lt;p&gt;I have retested both scenarios which I mentioned and can confirm that they work fine now. The synchronous send is always interrupted. Thanks for fixing this.&lt;/p&gt;</comment>
                            <comment id="14803026" author="gemmellr" created="Thu, 17 Sep 2015 14:50:55 +0000"  >&lt;p&gt;Great, thanks for verifying so quickly.&lt;/p&gt;</comment>
                            <comment id="14875782" author="jira-bot" created="Fri, 18 Sep 2015 15:32:19 +0000"  >&lt;p&gt;Commit 603a5f4c0cbdcf910e917edf333f453ad8943450 in qpid-jms&apos;s branch refs/heads/master from Robert Gemmell&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=qpid-jms.git;h=603a5f4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=qpid-jms.git;h=603a5f4&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPIDJMS-110&quot; title=&quot;Incorrect error handling when the sender.send(...) call / message transfer causes an error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPIDJMS-110&quot;&gt;&lt;del&gt;QPIDJMS-110&lt;/del&gt;&lt;/a&gt;: fix test issue causing sporadic failures&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 9 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2k7gv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>