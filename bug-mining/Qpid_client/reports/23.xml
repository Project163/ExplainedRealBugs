<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:17:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[QPIDJMS-65] updated SASL mechanism selection to consider available credentials</title>
                <link>https://issues.apache.org/jira/browse/QPIDJMS-65</link>
                <project id="12314524" key="QPIDJMS">Qpid JMS</project>
                    <description>&lt;p&gt;The SASL mechanism selection currently only looks at whether the server and client both support the mechanism. In cases tehre authentication credntials are required, we should also consider whether they are actually available and use another mechanism if they are not.&lt;/p&gt;

&lt;p&gt;Original Text:&lt;br/&gt;
When the CRAM-MD5 SASL mechanism is used and no jms.username or jms.password parameter was specified in connection URI, a NullPointerExpception will be thrown, for example:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;TRACE org.apache.qpid.jms.transports.netty.NettyTcpTransport - Attempted write of: 8 bytes
TRACE org.apache.qpid.jms.transports.netty.NettyTcpTransport - New data read: 68 bytes incoming: UnpooledHeapByteBuf(ridx: 0, widx: 68, cap: 65536)
TRACE org.apache.qpid.jms.provider.amqp.AmqpProvider - Received from Broker 68 bytes: UnpooledHeapByteBuf(ridx: 0, widx: 68, cap: 65536)
TRACE org.apache.qpid.jms.provider.amqp.AmqpProvider - New Proton Event: CONNECTION_INIT
TRACE org.apache.qpid.jms.provider.amqp.AmqpProvider - New Proton Event: SESSION_INIT
TRACE org.apache.qpid.jms.provider.amqp.AmqpProvider - New Proton Event: CONNECTION_LOCAL_OPEN
DEBUG org.apache.qpid.jms.sasl.SaslMechanismFinder - Unknown SASL mechanism: [DIGEST-MD5]
INFO org.apache.qpid.jms.sasl.SaslMechanismFinder - Best match &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; SASL auth was: SASL-CRAM-MD5
TRACE org.apache.qpid.jms.transports.netty.NettyTcpTransport - Attempted write of: 24 bytes
TRACE org.apache.qpid.jms.transports.netty.NettyTcpTransport - New data read: 55 bytes incoming: UnpooledHeapByteBuf(ridx: 0, widx: 55, cap: 65536)
TRACE org.apache.qpid.jms.provider.amqp.AmqpProvider - Received from Broker 55 bytes: UnpooledHeapByteBuf(ridx: 0, widx: 55, cap: 65536)
WARN org.apache.qpid.jms.provider.amqp.AmqpProvider - Caught Exception during update processing: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
java.lang.NullPointerException
	at org.apache.qpid.jms.sasl.CramMD5Mechanism.getChallengeResponse(CramMD5Mechanism.java:57)
	at org.apache.qpid.jms.provider.amqp.AmqpSaslAuthenticator.handleSaslStep(AmqpSaslAuthenticator.java:111)
	at org.apache.qpid.jms.provider.amqp.AmqpSaslAuthenticator.authenticate(AmqpSaslAuthenticator.java:63)
	at org.apache.qpid.jms.provider.amqp.AmqpConnection.processSaslAuthentication(AmqpConnection.java:155)
	at org.apache.qpid.jms.provider.amqp.AmqpProvider.processUpdates(AmqpProvider.java:777)
	at org.apache.qpid.jms.provider.amqp.AmqpProvider.access$1500(AmqpProvider.java:87)
	at org.apache.qpid.jms.provider.amqp.AmqpProvider$16.run(AmqpProvider.java:667)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)
	at java.util.concurrent.FutureTask.run(FutureTask.java:262)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:178)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:292)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
javax.jms.JMSException: java.lang.NullPointerException
Exception occurred and was caught by onException
	at org.apache.qpid.jms.exceptions.JmsExceptionSupport.create(JmsExceptionSupport.java:60)
	at org.apache.qpid.jms.JmsConnection.onAsyncException(JmsConnection.java:1169)
	at org.apache.qpid.jms.JmsConnection.onConnectionFailure(JmsConnection.java:1085)
	at org.apache.qpid.jms.provider.amqp.AmqpProvider.fireProviderException(AmqpProvider.java:832)
	at org.apache.qpid.jms.provider.amqp.AmqpProvider.processUpdates(AmqpProvider.java:781)
	at org.apache.qpid.jms.provider.amqp.AmqpProvider.access$1500(AmqpProvider.java:87)
	at org.apache.qpid.jms.provider.amqp.AmqpProvider$16.run(AmqpProvider.java:667)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)
	at java.util.concurrent.FutureTask.run(FutureTask.java:262)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:178)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:292)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
Caused by: java.io.IOException: java.lang.NullPointerException
	at org.apache.qpid.jms.util.IOExceptionSupport.create(IOExceptionSupport.java:45)
	... 11 more
Caused by: java.lang.NullPointerException
	at org.apache.qpid.jms.sasl.CramMD5Mechanism.getChallengeResponse(CramMD5Mechanism.java:57)
	at org.apache.qpid.jms.provider.amqp.AmqpSaslAuthenticator.handleSaslStep(AmqpSaslAuthenticator.java:111)
	at org.apache.qpid.jms.provider.amqp.AmqpSaslAuthenticator.authenticate(AmqpSaslAuthenticator.java:63)
	at org.apache.qpid.jms.provider.amqp.AmqpConnection.processSaslAuthentication(AmqpConnection.java:155)
	at org.apache.qpid.jms.provider.amqp.AmqpProvider.processUpdates(AmqpProvider.java:777)
	... 9 more&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The PLAIN mechanism actually validates username and password and replaces it with empty string in case they are null. However, setting the password to empty string causes another exception in SecretKeySpec. So the password has to be set for example to space to make it work.&lt;/p&gt;

&lt;p&gt;Is missing username or password (or set to empty string) actually a valid scenario? For example I don&apos;t think it can be configured on the Qpid C++ broker.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12834405">QPIDJMS-65</key>
            <summary>updated SASL mechanism selection to consider available credentials</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="robbie">Robbie Gemmell</assignee>
                                    <reporter username="scholzj">Jakub Scholz</reporter>
                        <labels>
                    </labels>
                <created>Mon, 1 Jun 2015 22:28:55 +0000</created>
                <updated>Wed, 6 Jan 2016 12:32:56 +0000</updated>
                            <resolved>Wed, 3 Jun 2015 15:08:20 +0000</resolved>
                                    <version>0.2.0</version>
                                    <fixVersion>0.3.0</fixVersion>
                                    <component>qpid-jms-client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14568157" author="scholzj" created="Mon, 1 Jun 2015 22:38:59 +0000"  >&lt;p&gt;This patch uses solution based on PlainMechanism - it replaces null value in username with empty string and null value or empty string in password with single space. IMHO, if nothing else, thanks to this patch the client throws better exception &quot;javax.jms.JMSSecurityException: Client failed to authenticate&quot;.&lt;/p&gt;</comment>
                            <comment id="14568882" author="gemmellr" created="Tue, 2 Jun 2015 10:07:50 +0000"  >&lt;p&gt;As you note, its not clear that it makes any sense for the username or password to be missing (same goes for PLAIN), so arguably the issue is that it elects to use the mechanism in the first place rather than what happens once it does. If a mechanism requires user info that isn&apos;t available then we should probably skip the mechanism, likely ending up with only ANONYMOUS and EXTERNAL being available for selection.&lt;/p&gt;</comment>
                            <comment id="14568960" author="scholzj" created="Tue, 2 Jun 2015 11:19:43 +0000"  >&lt;p&gt;Yeah, in my opinion, unless there is someone with a scenario where username &amp;amp; password based authentication doesn&apos;t require password or username, it would be best if the PLAIN and CRAM-MD5 are disabled in these cases. &lt;/p&gt;

&lt;p&gt;I think it would even slightly enhance the clients usability, because today, you cannot choose ANONYMOUS mechanism when PLAIN or CRAM-MD5 is available on the broker. With this implemented as you suggest, the client would simply ignore the PLAIN and CRAM-MD5 mechanisms in case username/password were not specified and default to ANONYMOUS.&lt;/p&gt;</comment>
                            <comment id="14568968" author="gemmellr" created="Tue, 2 Jun 2015 11:26:45 +0000"  >&lt;p&gt;Agreed. Being able to configure which mechanism(s) the client should elect to utilise is also something else that has been in mind (e.g it is mentioned on &lt;a href=&quot;https://issues.apache.org/jira/browse/QPIDJMS-61&quot; title=&quot;add support for setting the sasl / open frame &amp;#39;hostname&amp;#39;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPIDJMS-61&quot;&gt;&lt;del&gt;QPIDJMS-61&lt;/del&gt;&lt;/a&gt;, though needs its own JIRA really)&lt;/p&gt;</comment>
                            <comment id="14569206" author="jira-bot" created="Tue, 2 Jun 2015 14:52:00 +0000"  >&lt;p&gt;Commit 7e831696cd9be6758642eb0d366dc59073e4b158 in qpid-jms&apos;s branch refs/heads/master from Robert Gemmell&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=qpid-jms.git;h=7e83169&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=qpid-jms.git;h=7e83169&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPIDJMS-65&quot; title=&quot;updated SASL mechanism selection to consider available credentials&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPIDJMS-65&quot;&gt;&lt;del&gt;QPIDJMS-65&lt;/del&gt;&lt;/a&gt;: dont use CRAM-MD5 or PLAIN if either a username and password have not actually been supplied&lt;/p&gt;</comment>
                            <comment id="14569214" author="gemmellr" created="Tue, 2 Jun 2015 14:57:36 +0000"  >&lt;p&gt;I updated the mechanism selection process to take into account if the username and password are present. In doing so, it now occurs to me that we also shouldnt select EXTERNAL if we know there isnt a local principal already available from establishing the transport connection, still need some more updates to handle that.&lt;/p&gt;</comment>
                            <comment id="14569697" author="scholzj" created="Tue, 2 Jun 2015 20:29:00 +0000"  >&lt;p&gt;Looks great - exceptions are gone, and the choice of SASL mechanism corresponds to the passed values. Thanks.&lt;/p&gt;</comment>
                            <comment id="14570971" author="jira-bot" created="Wed, 3 Jun 2015 15:06:16 +0000"  >&lt;p&gt;Commit 2fde87949ea1d90f2e51de4a245f3bc36059fa30 in qpid-jms&apos;s branch refs/heads/master from Robert Gemmell&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=qpid-jms.git;h=2fde879&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=qpid-jms.git;h=2fde879&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPIDJMS-65&quot; title=&quot;updated SASL mechanism selection to consider available credentials&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPIDJMS-65&quot;&gt;&lt;del&gt;QPIDJMS-65&lt;/del&gt;&lt;/a&gt;: dont select EXTERNAL when we know there is no local principal established for the transport&lt;/p&gt;</comment>
                            <comment id="14571357" author="jira-bot" created="Wed, 3 Jun 2015 17:25:26 +0000"  >&lt;p&gt;Commit ab970da6b810fccf0f93c4ac7e07aab58ea8ab54 in qpid-jms&apos;s branch refs/heads/master from Robert Gemmell&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=qpid-jms.git;h=ab970da&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=qpid-jms.git;h=ab970da&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPIDJMS-65&quot; title=&quot;updated SASL mechanism selection to consider available credentials&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPIDJMS-65&quot;&gt;&lt;del&gt;QPIDJMS-65&lt;/del&gt;&lt;/a&gt;: avoid race leading to sporadic test failure&lt;/p&gt;</comment>
                            <comment id="14572914" author="jira-bot" created="Thu, 4 Jun 2015 14:51:02 +0000"  >&lt;p&gt;Commit 2198077f0c35950b240aa208038e2b7a9843c2ae in qpid-jms&apos;s branch refs/heads/master from Robert Gemmell&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=qpid-jms.git;h=2198077&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=qpid-jms.git;h=2198077&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPIDJMS-67&quot; title=&quot;AMQP header and Open+Close frames are sent after a SASL failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPIDJMS-67&quot;&gt;&lt;del&gt;QPIDJMS-67&lt;/del&gt;&lt;/a&gt;: workaround extraneous header+frames being sent, nix the transport output upon SASL failure&lt;/p&gt;

&lt;p&gt;Removes workaround from ab970da6b810fccf0f93c4ac7e07aab58ea8ab54 from &lt;a href=&quot;https://issues.apache.org/jira/browse/QPIDJMS-65&quot; title=&quot;updated SASL mechanism selection to consider available credentials&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPIDJMS-65&quot;&gt;&lt;del&gt;QPIDJMS-65&lt;/del&gt;&lt;/a&gt; as it was only needed due to exposing this defect.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12736672" name="QPIDJMS-65.patch" size="2016" author="scholzj" created="Mon, 1 Jun 2015 22:38:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 24 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2fhef:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>