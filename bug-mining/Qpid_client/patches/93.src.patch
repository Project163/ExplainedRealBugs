diff --git a/qpid-jms-client/src/test/java/org/apache/qpid/jms/integration/ProducerIntegrationTest.java b/qpid-jms-client/src/test/java/org/apache/qpid/jms/integration/ProducerIntegrationTest.java
index 274df166..c932dc75 100644
--- a/qpid-jms-client/src/test/java/org/apache/qpid/jms/integration/ProducerIntegrationTest.java
+++ b/qpid-jms-client/src/test/java/org/apache/qpid/jms/integration/ProducerIntegrationTest.java
@@ -1015,13 +1015,13 @@ public class ProducerIntegrationTest extends QpidJmsTestCase {
             testPeer.expectBegin();
             Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE);
 
-            // Expect producer creation, give it credit.
+            // Expect producer creation, don't give it credit.
             testPeer.expectSenderAttachWithoutGrantingCredit();
 
             String text = "myMessage";
 
-            // Producer has no credit so the send should block waiting for it.
-            testPeer.remotelyDetachLastOpenedLinkOnLastOpenedSession(true, true, AmqpError.RESOURCE_LIMIT_EXCEEDED, BREAD_CRUMB);
+            // Producer has no credit so the send should block waiting for it, then fail when the remote close occurs
+            testPeer.remotelyDetachLastOpenedLinkOnLastOpenedSession(true, true, AmqpError.RESOURCE_LIMIT_EXCEEDED, BREAD_CRUMB, 50);
             testPeer.expectClose();
 
             Queue queue = session.createQueue("myQueue");
@@ -1034,8 +1034,9 @@ public class ProducerIntegrationTest extends QpidJmsTestCase {
                 fail("Expected exception to be thrown");
             } catch (JMSException jmse) {
                 // Expected
-                assertNotNull("Expected exception to have a message", jmse.getMessage());
-                assertTrue("Expected breadcrumb to be present in message", jmse.getMessage().contains(BREAD_CRUMB));
+                String exMsg = jmse.getMessage();
+                assertNotNull("Expected exception to have a message", exMsg);
+                assertTrue("Expected breadcrumb not present in message, instead got: " + exMsg, exMsg.contains(BREAD_CRUMB));
             }
 
             connection.close();
diff --git a/qpid-jms-client/src/test/java/org/apache/qpid/jms/test/testpeer/TestAmqpPeer.java b/qpid-jms-client/src/test/java/org/apache/qpid/jms/test/testpeer/TestAmqpPeer.java
index 8e15f85f..deac1fd3 100644
--- a/qpid-jms-client/src/test/java/org/apache/qpid/jms/test/testpeer/TestAmqpPeer.java
+++ b/qpid-jms-client/src/test/java/org/apache/qpid/jms/test/testpeer/TestAmqpPeer.java
@@ -1851,7 +1851,7 @@ public class TestAmqpPeer implements AutoCloseable
     }
 
     public void remotelyEndLastOpenedSession(boolean expectEndResponse, long delayBeforeSend) {
-        remotelyEndLastOpenedSession(expectEndResponse, 0, null, null);
+        remotelyEndLastOpenedSession(expectEndResponse, delayBeforeSend, null, null);
     }
 
     public void remotelyEndLastOpenedSession(boolean expectEndResponse, final long delayBeforeSend, Symbol errorType, String errorMessage) {
@@ -1945,6 +1945,10 @@ public class TestAmqpPeer implements AutoCloseable
     }
 
     public void remotelyDetachLastOpenedLinkOnLastOpenedSession(boolean expectDetachResponse, boolean closed, Symbol errorType, String errorMessage) {
+        remotelyDetachLastOpenedLinkOnLastOpenedSession(expectDetachResponse, closed, errorType, errorMessage, 0);
+    }
+
+    public void remotelyDetachLastOpenedLinkOnLastOpenedSession(boolean expectDetachResponse, boolean closed, Symbol errorType, String errorMessage, final long delayBeforeSend) {
         synchronized (_handlersLock) {
             CompositeAmqpPeerRunnable comp = insertCompsiteActionForLastHandler();
 
@@ -1965,6 +1969,15 @@ public class TestAmqpPeer implements AutoCloseable
                 public void setValues() {
                     frameSender.setChannel(_lastInitiatedChannel);
                     detachFrame.setHandle(_lastInitiatedLinkHandle);
+
+                    //Insert a delay if requested
+                    if (delayBeforeSend > 0) {
+                        try {
+                            Thread.sleep(delayBeforeSend);
+                        } catch (InterruptedException e) {
+                            // Ignore
+                        }
+                    }
                 }
             });
             comp.add(frameSender);
