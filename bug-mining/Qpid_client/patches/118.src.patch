diff --git a/qpid-jms-client/src/main/java/org/apache/qpid/jms/provider/amqp/AmqpAnonymousFallbackProducer.java b/qpid-jms-client/src/main/java/org/apache/qpid/jms/provider/amqp/AmqpAnonymousFallbackProducer.java
index 3e07b253..447b4b22 100644
--- a/qpid-jms-client/src/main/java/org/apache/qpid/jms/provider/amqp/AmqpAnonymousFallbackProducer.java
+++ b/qpid-jms-client/src/main/java/org/apache/qpid/jms/provider/amqp/AmqpAnonymousFallbackProducer.java
@@ -110,8 +110,11 @@ public class AmqpAnonymousFallbackProducer extends AmqpProducer {
     @Override
     public void close(AsyncResult request) {
         // Trigger an immediate close, the internal producers that are currently in the cache
-        for (AmqpProducer producer : producerCache.values()) {
-            producer.close(new CloseRequest(producer));
+        // if the cache is enabled.
+        if (connection.isAnonymousProducerCache()) {
+            for (AmqpProducer producer : producerCache.values()) {
+                producer.close(new CloseRequest(producer));
+            }
         }
 
         request.onSuccess();
diff --git a/qpid-jms-client/src/test/java/org/apache/qpid/jms/integration/IntegrationTestFixture.java b/qpid-jms-client/src/test/java/org/apache/qpid/jms/integration/IntegrationTestFixture.java
index 2ddf739c..afcef744 100644
--- a/qpid-jms-client/src/test/java/org/apache/qpid/jms/integration/IntegrationTestFixture.java
+++ b/qpid-jms-client/src/test/java/org/apache/qpid/jms/integration/IntegrationTestFixture.java
@@ -137,7 +137,11 @@ public class IntegrationTestFixture {
         final String baseURI = scheme + "://localhost:" + testPeer.getServerPort();
         String remoteURI = baseURI;
         if (optionsString != null) {
-            remoteURI = baseURI + optionsString;
+            if (optionsString.startsWith("?")) {
+                remoteURI = baseURI + optionsString;
+            } else {
+                remoteURI = baseURI + "?" + optionsString;
+            }
         }
 
         return remoteURI;
diff --git a/qpid-jms-client/src/test/java/org/apache/qpid/jms/integration/SessionIntegrationTest.java b/qpid-jms-client/src/test/java/org/apache/qpid/jms/integration/SessionIntegrationTest.java
index 2922b0f6..2b188c22 100644
--- a/qpid-jms-client/src/test/java/org/apache/qpid/jms/integration/SessionIntegrationTest.java
+++ b/qpid-jms-client/src/test/java/org/apache/qpid/jms/integration/SessionIntegrationTest.java
@@ -1131,6 +1131,7 @@ public class SessionIntegrationTest extends QpidJmsTestCase {
 
             Message message = session.createMessage();
             producer.send(dest, message);
+            producer.close();
 
             connection.close();
 
