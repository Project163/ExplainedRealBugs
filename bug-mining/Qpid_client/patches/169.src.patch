diff --git a/qpid-jms-client/src/main/java/org/apache/qpid/jms/sasl/AbstractScramSHAMechanism.java b/qpid-jms-client/src/main/java/org/apache/qpid/jms/sasl/AbstractScramSHAMechanism.java
index 4565fc46..9665ecde 100644
--- a/qpid-jms-client/src/main/java/org/apache/qpid/jms/sasl/AbstractScramSHAMechanism.java
+++ b/qpid-jms-client/src/main/java/org/apache/qpid/jms/sasl/AbstractScramSHAMechanism.java
@@ -69,7 +69,7 @@ abstract class AbstractScramSHAMechanism extends AbstractMechanism {
             throw new SaslException("Request for initial response not expected in state " + state);
         }
         StringBuilder buf = new StringBuilder("n=");
-        buf.append(saslPrep(getUsername()));
+        buf.append(escapeUsername(saslPrep(getUsername())));
         buf.append(",r=");
         buf.append(clientNonce);
         clientFirstMessageBare = buf.toString();
@@ -221,6 +221,10 @@ abstract class AbstractScramSHAMechanism extends AbstractMechanism {
             throw new SaslException("Can only encode names and passwords which are restricted to ASCII characters");
         }
 
+        return name;
+    }
+
+    private String escapeUsername(String name) {
         name = name.replace("=", "=3D");
         name = name.replace(",", "=2C");
         return name;
diff --git a/qpid-jms-client/src/test/java/org/apache/qpid/jms/sasl/ScramSHA1MechanismTest.java b/qpid-jms-client/src/test/java/org/apache/qpid/jms/sasl/ScramSHA1MechanismTest.java
index 0011fb80..2138b8a7 100644
--- a/qpid-jms-client/src/test/java/org/apache/qpid/jms/sasl/ScramSHA1MechanismTest.java
+++ b/qpid-jms-client/src/test/java/org/apache/qpid/jms/sasl/ScramSHA1MechanismTest.java
@@ -16,8 +16,14 @@
  */
 package org.apache.qpid.jms.sasl;
 
+import static org.hamcrest.MatcherAssert.assertThat;
+import static org.hamcrest.Matchers.equalTo;
+import static org.hamcrest.Matchers.not;
+import static org.junit.Assert.assertArrayEquals;
 import static org.junit.Assert.assertTrue;
 
+import java.nio.charset.StandardCharsets;
+
 import org.junit.Test;
 
 /**
@@ -30,10 +36,10 @@ public class ScramSHA1MechanismTest extends AbstractScramSHAMechanismTestBase {
 
     private static final String CLIENT_NONCE = "fyko+d2lbbFgONRv9qkxdawL";
 
-    private static final byte[] EXPECTED_CLIENT_INITIAL_RESPONSE = "n,,n=user,r=fyko+d2lbbFgONRv9qkxdawL".getBytes();
-    private static final byte[] SERVER_FIRST_MESSAGE = "r=fyko+d2lbbFgONRv9qkxdawL3rfcNHYJY1ZVvWVs7j,s=QSXCR+Q6sek8bf92,i=4096".getBytes();
-    private static final byte[] EXPECTED_CLIENT_FINAL_MESSAGE = "c=biws,r=fyko+d2lbbFgONRv9qkxdawL3rfcNHYJY1ZVvWVs7j,p=v0X8v3Bz2T0CJGbJQyF0X+HI4Ts=".getBytes();
-    private static final byte[] SERVER_FINAL_MESSAGE = "v=rmF9pqV8S7suAoZWja4dJRkFsKQ=".getBytes();
+    private static final byte[] EXPECTED_CLIENT_INITIAL_RESPONSE = "n,,n=user,r=fyko+d2lbbFgONRv9qkxdawL".getBytes(StandardCharsets.UTF_8);
+    private static final byte[] SERVER_FIRST_MESSAGE = "r=fyko+d2lbbFgONRv9qkxdawL3rfcNHYJY1ZVvWVs7j,s=QSXCR+Q6sek8bf92,i=4096".getBytes(StandardCharsets.UTF_8);
+    private static final byte[] EXPECTED_CLIENT_FINAL_MESSAGE = "c=biws,r=fyko+d2lbbFgONRv9qkxdawL3rfcNHYJY1ZVvWVs7j,p=v0X8v3Bz2T0CJGbJQyF0X+HI4Ts=".getBytes(StandardCharsets.UTF_8);
+    private static final byte[] SERVER_FINAL_MESSAGE = "v=rmF9pqV8S7suAoZWja4dJRkFsKQ=".getBytes(StandardCharsets.UTF_8);
 
     public ScramSHA1MechanismTest() {
         super(EXPECTED_CLIENT_INITIAL_RESPONSE,
@@ -51,10 +57,68 @@ public class ScramSHA1MechanismTest extends AbstractScramSHAMechanismTestBase {
         return mech;
     }
 
+    @Test
+    public void testDifferentClientNonceOnEachInstance() throws Exception {
+        ScramSHA1Mechanism mech = new ScramSHA1Mechanism();
+        mech.setUsername(USERNAME);
+        mech.setPassword(PASSWORD);
+
+        ScramSHA1Mechanism mech2 = new ScramSHA1Mechanism();
+        mech2.setUsername(USERNAME);
+        mech2.setPassword(PASSWORD);
+
+        byte[] clientInitialResponse = mech.getInitialResponse();
+        byte[] clientInitialResponse2 = mech2.getInitialResponse();
+
+        assertTrue(new String(clientInitialResponse, StandardCharsets.UTF_8).startsWith("n,,n=user,r="));
+        assertTrue(new String(clientInitialResponse2, StandardCharsets.UTF_8).startsWith("n,,n=user,r="));
+
+        assertThat(clientInitialResponse, not(equalTo(clientInitialResponse2)));
+    }
+
     @Test
     public void testIsEnabledByDefault() {
         ScramSHA1Mechanism mech = new ScramSHA1Mechanism();
 
         assertTrue("Should be enabled by default", mech.isEnabledByDefault());
     }
+
+    @Test
+    public void testUsernameCommaEqualsCharactersEscaped() throws Exception {
+        String originalUsername = "user,name=";
+        String escapedUsername = "user=2Cname=3D";
+
+        String expectedInitialResponseString = "n,,n=" + escapedUsername + ",r=" + CLIENT_NONCE;
+
+        ScramSHA1Mechanism mech = new ScramSHA1Mechanism(CLIENT_NONCE);
+        mech.setUsername(originalUsername);
+        mech.setPassword("password");
+
+        byte[] clientInitialResponse = mech.getInitialResponse();
+        assertArrayEquals(expectedInitialResponseString.getBytes(StandardCharsets.UTF_8), clientInitialResponse);
+    }
+
+    @Test
+    public void testPasswordCommaEqualsCharactersNotEscaped() throws Exception {
+        Mechanism mechanism = getConfiguredMechanism();
+        mechanism.setPassword(PASSWORD + ",=");
+
+        byte[] clientInitialResponse = mechanism.getInitialResponse();
+        assertArrayEquals(EXPECTED_CLIENT_INITIAL_RESPONSE, clientInitialResponse);
+
+        byte[] serverFirstMessage = "r=fyko+d2lbbFgONRv9qkxdawLdcbfa301-1618-46ee-96c1-2bf60139dc7f,s=Q0zM1qzKMOmI0sAzE7dXt6ru4ZIXhAzn40g4mQXKQdw=,i=4096".getBytes(StandardCharsets.UTF_8);
+        byte[] expectedClientFinalMessage = "c=biws,r=fyko+d2lbbFgONRv9qkxdawLdcbfa301-1618-46ee-96c1-2bf60139dc7f,p=quRNWvZqGUvPXoazebZe0ZYsjQI=".getBytes(StandardCharsets.UTF_8);
+
+        byte[] clientFinalMessage = mechanism.getChallengeResponse(serverFirstMessage);
+
+        assertArrayEquals(expectedClientFinalMessage, clientFinalMessage);
+
+        byte[] serverFinalMessage = "v=dnJDHm3fp6WwVrl5yjZuqKp03lQ=".getBytes(StandardCharsets.UTF_8);
+        byte[] expectedFinalChallengeResponse = "".getBytes();
+
+        assertArrayEquals(expectedFinalChallengeResponse, mechanism.getChallengeResponse(serverFinalMessage));
+
+        mechanism.verifyCompletion();
+    }
+
 }
\ No newline at end of file
diff --git a/qpid-jms-client/src/test/java/org/apache/qpid/jms/sasl/ScramSHA256MechanismTest.java b/qpid-jms-client/src/test/java/org/apache/qpid/jms/sasl/ScramSHA256MechanismTest.java
index 945fcd77..6535beba 100644
--- a/qpid-jms-client/src/test/java/org/apache/qpid/jms/sasl/ScramSHA256MechanismTest.java
+++ b/qpid-jms-client/src/test/java/org/apache/qpid/jms/sasl/ScramSHA256MechanismTest.java
@@ -16,8 +16,14 @@
  */
 package org.apache.qpid.jms.sasl;
 
+import static org.hamcrest.MatcherAssert.assertThat;
+import static org.hamcrest.Matchers.equalTo;
+import static org.hamcrest.Matchers.not;
+import static org.junit.Assert.assertArrayEquals;
 import static org.junit.Assert.assertTrue;
 
+import java.nio.charset.StandardCharsets;
+
 import org.junit.Test;
 
 /**
@@ -30,10 +36,10 @@ public class ScramSHA256MechanismTest extends AbstractScramSHAMechanismTestBase
 
     private static final String CLIENT_NONCE = "rOprNGfwEbeRWgbNEkqO";
 
-    private static final byte[] EXPECTED_CLIENT_INITIAL_RESPONSE = "n,,n=user,r=rOprNGfwEbeRWgbNEkqO".getBytes();
-    private static final byte[] SERVER_FIRST_MESSAGE = "r=rOprNGfwEbeRWgbNEkqO%hvYDpWUa2RaTCAfuxFIlj)hNlF$k0,s=W22ZaJ0SNY7soEsUEjb6gQ==,i=4096".getBytes();
-    private static final byte[] EXPECTED_CLIENT_FINAL_MESSAGE = "c=biws,r=rOprNGfwEbeRWgbNEkqO%hvYDpWUa2RaTCAfuxFIlj)hNlF$k0,p=dHzbZapWIk4jUhN+Ute9ytag9zjfMHgsqmmiz7AndVQ=".getBytes();
-    private static final byte[] SERVER_FINAL_MESSAGE = "v=6rriTRBi23WpRR/wtup+mMhUZUn/dB5nLTJRsjl95G4=".getBytes();
+    private static final byte[] EXPECTED_CLIENT_INITIAL_RESPONSE = "n,,n=user,r=rOprNGfwEbeRWgbNEkqO".getBytes(StandardCharsets.UTF_8);
+    private static final byte[] SERVER_FIRST_MESSAGE = "r=rOprNGfwEbeRWgbNEkqO%hvYDpWUa2RaTCAfuxFIlj)hNlF$k0,s=W22ZaJ0SNY7soEsUEjb6gQ==,i=4096".getBytes(StandardCharsets.UTF_8);
+    private static final byte[] EXPECTED_CLIENT_FINAL_MESSAGE = "c=biws,r=rOprNGfwEbeRWgbNEkqO%hvYDpWUa2RaTCAfuxFIlj)hNlF$k0,p=dHzbZapWIk4jUhN+Ute9ytag9zjfMHgsqmmiz7AndVQ=".getBytes(StandardCharsets.UTF_8);
+    private static final byte[] SERVER_FINAL_MESSAGE = "v=6rriTRBi23WpRR/wtup+mMhUZUn/dB5nLTJRsjl95G4=".getBytes(StandardCharsets.UTF_8);
 
     public ScramSHA256MechanismTest() {
         super(EXPECTED_CLIENT_INITIAL_RESPONSE,
@@ -51,10 +57,67 @@ public class ScramSHA256MechanismTest extends AbstractScramSHAMechanismTestBase
         return mech;
     }
 
+    @Test
+    public void testDifferentClientNonceOnEachInstance() throws Exception {
+        ScramSHA256Mechanism mech = new ScramSHA256Mechanism();
+        mech.setUsername(USERNAME);
+        mech.setPassword(PASSWORD);
+
+        ScramSHA256Mechanism mech2 = new ScramSHA256Mechanism();
+        mech2.setUsername(USERNAME);
+        mech2.setPassword(PASSWORD);
+
+        byte[] clientInitialResponse = mech.getInitialResponse();
+        byte[] clientInitialResponse2 = mech2.getInitialResponse();
+
+        assertTrue(new String(clientInitialResponse, StandardCharsets.UTF_8).startsWith("n,,n=user,r="));
+        assertTrue(new String(clientInitialResponse2, StandardCharsets.UTF_8).startsWith("n,,n=user,r="));
+
+        assertThat(clientInitialResponse, not(equalTo(clientInitialResponse2)));
+    }
+
     @Test
     public void testIsEnabledByDefault() {
         ScramSHA256Mechanism mech = new ScramSHA256Mechanism();
 
         assertTrue("Should be enabled by default", mech.isEnabledByDefault());
     }
+
+    @Test
+    public void testUsernameCommaEqualsCharactersEscaped() throws Exception {
+        String originalUsername = "user,name=";
+        String escapedUsername = "user=2Cname=3D";
+
+        String expectedInitialResponseString = "n,,n=" + escapedUsername + ",r=" + CLIENT_NONCE;
+
+        ScramSHA256Mechanism mech = new ScramSHA256Mechanism(CLIENT_NONCE);
+        mech.setUsername(originalUsername);
+        mech.setPassword("password");
+
+        byte[] clientInitialResponse = mech.getInitialResponse();
+        assertArrayEquals(expectedInitialResponseString.getBytes(StandardCharsets.UTF_8), clientInitialResponse);
+    }
+
+    @Test
+    public void testPasswordCommaEqualsCharactersNotEscaped() throws Exception {
+        Mechanism mechanism = getConfiguredMechanism();
+        mechanism.setPassword(PASSWORD + ",=");
+
+        byte[] clientInitialResponse = mechanism.getInitialResponse();
+        assertArrayEquals(EXPECTED_CLIENT_INITIAL_RESPONSE, clientInitialResponse);
+
+        byte[] serverFirstMessage = "r=rOprNGfwEbeRWgbNEkqOb291012f-b281-47d3-acbc-fefffaad60f2,s=fQwuXmWB4XES7vNK4oBlLtH9cbWAmtxO+Z+tZ9m5W54=,i=4096".getBytes(StandardCharsets.UTF_8);
+        byte[] expectedClientFinalMessage = "c=biws,r=rOprNGfwEbeRWgbNEkqOb291012f-b281-47d3-acbc-fefffaad60f2,p=PNeUNfKwyqBPjMssgF7yk4iLt8W24NS/D99HjBbXwyw=".getBytes(StandardCharsets.UTF_8);
+
+        byte[] clientFinalMessage = mechanism.getChallengeResponse(serverFirstMessage);
+
+        assertArrayEquals(expectedClientFinalMessage, clientFinalMessage);
+
+        byte[] serverFinalMessage = "v=/N9SY26AOvz2QZkJZkyXpomWknaFWSN6zBGqg5RNG9w=".getBytes(StandardCharsets.UTF_8);
+        byte[] expectedFinalChallengeResponse = "".getBytes();
+
+        assertArrayEquals(expectedFinalChallengeResponse, mechanism.getChallengeResponse(serverFinalMessage));
+
+        mechanism.verifyCompletion();
+    }
 }
\ No newline at end of file
