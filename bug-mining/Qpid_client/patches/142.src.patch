diff --git a/qpid-jms-client/src/main/java/org/apache/qpid/jms/provider/amqp/AmqpProvider.java b/qpid-jms-client/src/main/java/org/apache/qpid/jms/provider/amqp/AmqpProvider.java
index d5d5ade9..b5712440 100644
--- a/qpid-jms-client/src/main/java/org/apache/qpid/jms/provider/amqp/AmqpProvider.java
+++ b/qpid-jms-client/src/main/java/org/apache/qpid/jms/provider/amqp/AmqpProvider.java
@@ -263,7 +263,7 @@ public class AmqpProvider implements Provider, TransportListener , AmqpResourceP
                         } else {
                             // If the SASL authentication occurred but failed then we don't
                             // need to do an open / close
-                            if (authenticator != null && !authenticator.wasSuccessful()) {
+                            if (authenticator != null && (!authenticator.isComplete() || !authenticator.wasSuccessful())) {
                                 request.onSuccess();
                                 return;
                             }
@@ -765,28 +765,34 @@ public class AmqpProvider implements Provider, TransportListener , AmqpResourceP
 
             @Override
             public void run() {
-                if (isTraceBytes()) {
-                    TRACE_BYTES.info("Received: {}", ByteBufUtil.hexDump(input));
-                }
+                try {
+                    if (isTraceBytes()) {
+                        TRACE_BYTES.info("Received: {}", ByteBufUtil.hexDump(input));
+                    }
 
-                ByteBuffer source = input.nioBuffer();
+                    ByteBuffer source = input.nioBuffer();
 
-                do {
-                    ByteBuffer buffer = protonTransport.getInputBuffer();
-                    int limit = Math.min(buffer.remaining(), source.remaining());
-                    ByteBuffer duplicate = source.duplicate();
-                    duplicate.limit(source.position() + limit);
-                    buffer.put(duplicate);
-                    protonTransport.processInput();
-                    source.position(source.position() + limit);
-                } while (source.hasRemaining());
+                    do {
+                        ByteBuffer buffer = protonTransport.getInputBuffer();
+                        int limit = Math.min(buffer.remaining(), source.remaining());
+                        ByteBuffer duplicate = source.duplicate();
+                        duplicate.limit(source.position() + limit);
+                        buffer.put(duplicate);
+                        protonTransport.processInput().checkIsOk();
+                        source.position(source.position() + limit);
+                    } while (source.hasRemaining());
 
-                ReferenceCountUtil.release(input);
+                    ReferenceCountUtil.release(input);
 
-                // Process the state changes from the latest data and then answer back
-                // any pending updates to the Broker.
-                processUpdates();
-                pumpToProtonTransport();
+                    // Process the state changes from the latest data and then answer back
+                    // any pending updates to the Broker.
+                    processUpdates();
+                    pumpToProtonTransport();
+                } catch (Throwable t) {
+                    LOG.warn("Caught problem during data processing: {}", t.getMessage(), t);
+
+                    fireProviderException(t);
+                }
             }
         });
     }
diff --git a/qpid-jms-client/src/main/java/org/apache/qpid/jms/provider/amqp/AmqpSaslAuthenticator.java b/qpid-jms-client/src/main/java/org/apache/qpid/jms/provider/amqp/AmqpSaslAuthenticator.java
index 9ee41e5b..88689db9 100644
--- a/qpid-jms-client/src/main/java/org/apache/qpid/jms/provider/amqp/AmqpSaslAuthenticator.java
+++ b/qpid-jms-client/src/main/java/org/apache/qpid/jms/provider/amqp/AmqpSaslAuthenticator.java
@@ -40,6 +40,7 @@ public class AmqpSaslAuthenticator {
     private final Principal localPrincipal;
     private Set<String> mechanismsRestriction;
     private final AsyncResult authenticationRequest;
+    private boolean complete;
 
     /**
      * Create the authenticator and initialize it.
@@ -106,7 +107,13 @@ public class AmqpSaslAuthenticator {
             authenticationRequest.onFailure(result);
         }
 
-        return authenticationRequest.isComplete();
+        complete = authenticationRequest.isComplete();
+
+        return complete;
+    }
+
+    public boolean isComplete() {
+       return complete;
     }
 
     public boolean wasSuccessful() throws IllegalStateException {
diff --git a/qpid-jms-client/src/test/java/org/apache/qpid/jms/integration/ConnectionIntegrationTest.java b/qpid-jms-client/src/test/java/org/apache/qpid/jms/integration/ConnectionIntegrationTest.java
index e5b752c9..76c14436 100644
--- a/qpid-jms-client/src/test/java/org/apache/qpid/jms/integration/ConnectionIntegrationTest.java
+++ b/qpid-jms-client/src/test/java/org/apache/qpid/jms/integration/ConnectionIntegrationTest.java
@@ -23,6 +23,7 @@ package org.apache.qpid.jms.integration;
 import static org.apache.qpid.jms.provider.amqp.AmqpSupport.NETWORK_HOST;
 import static org.apache.qpid.jms.provider.amqp.AmqpSupport.OPEN_HOSTNAME;
 import static org.apache.qpid.jms.provider.amqp.AmqpSupport.PORT;
+import static org.hamcrest.CoreMatchers.containsString;
 import static org.hamcrest.Matchers.allOf;
 import static org.hamcrest.Matchers.arrayContaining;
 import static org.hamcrest.Matchers.equalTo;
@@ -33,6 +34,7 @@ import static org.junit.Assert.assertEquals;
 import static org.junit.Assert.assertFalse;
 import static org.junit.Assert.assertNotNull;
 import static org.junit.Assert.assertNull;
+import static org.junit.Assert.assertThat;
 import static org.junit.Assert.assertTrue;
 import static org.junit.Assert.fail;
 
@@ -72,6 +74,7 @@ import org.apache.qpid.proton.amqp.Binary;
 import org.apache.qpid.proton.amqp.Symbol;
 import org.apache.qpid.proton.amqp.UnsignedInteger;
 import org.apache.qpid.proton.amqp.transaction.TxnCapability;
+import org.apache.qpid.proton.engine.impl.AmqpHeader;
 import org.hamcrest.Matcher;
 import org.junit.Test;
 
@@ -87,6 +90,32 @@ public class ConnectionIntegrationTest extends QpidJmsTestCase {
         }
     }
 
+    @Test(timeout = 10000)
+    public void testCreateConnectionToNonSaslPeer() throws Exception {
+        doConnectionWithUnexpectedHeaderTestImpl(AmqpHeader.HEADER);
+    }
+
+    @Test(timeout = 10000)
+    public void testCreateConnectionToNonAmqpPeer() throws Exception {
+        byte[] responseHeader = new byte[] { 'N', 'O', 'T', '-', 'A', 'M', 'Q', 'P' };
+        doConnectionWithUnexpectedHeaderTestImpl(responseHeader);
+    }
+
+    private void doConnectionWithUnexpectedHeaderTestImpl(byte[] responseHeader) throws Exception, IOException {
+        try (TestAmqpPeer testPeer = new TestAmqpPeer();) {
+
+            testPeer.expectHeader(AmqpHeader.SASL_HEADER, responseHeader);
+
+            ConnectionFactory factory = new JmsConnectionFactory("amqp://localhost:" + testPeer.getServerPort());
+            try {
+                factory.createConnection("guest", "guest");
+                fail("Expected connection creation to fail");
+            } catch (JMSException jmse) {
+                assertThat(jmse.getMessage(), containsString("SASL header mismatch"));
+            }
+        }
+    }
+
     @Test(timeout = 20000)
     public void testCloseConnectionTimesOut() throws Exception {
         try (TestAmqpPeer testPeer = new TestAmqpPeer();) {
diff --git a/qpid-jms-client/src/test/java/org/apache/qpid/jms/test/testpeer/TestAmqpPeer.java b/qpid-jms-client/src/test/java/org/apache/qpid/jms/test/testpeer/TestAmqpPeer.java
index 719fbc78..f6ebc7aa 100644
--- a/qpid-jms-client/src/test/java/org/apache/qpid/jms/test/testpeer/TestAmqpPeer.java
+++ b/qpid-jms-client/src/test/java/org/apache/qpid/jms/test/testpeer/TestAmqpPeer.java
@@ -433,6 +433,11 @@ public class TestAmqpPeer implements AutoCloseable
         return openFrame;
     }
 
+    public void expectHeader(byte[] header, byte[] response)
+    {
+        addHandler(new HeaderHandlerImpl(header, response));
+    }
+
     private void expectSaslAuthentication(Symbol mechanism, Matcher<Binary> initialResponseMatcher, Matcher<?> hostnameMatcher, boolean sendSaslHeaderResponse)
     {
         SaslMechanismsFrame saslMechanismsFrame = new SaslMechanismsFrame().setSaslServerMechanisms(mechanism);
