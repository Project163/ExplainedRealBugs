<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:36:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-1387] Memory leak related to shutdown hook</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-1387</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yang_zhong&quot; class=&quot;user-hover&quot; rel=&quot;yang_zhong&quot;&gt;yang_zhong&lt;/a&gt; reported this issue with the shutdown hook on &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-868&quot; title=&quot;Allow shutdown hook registration handling to be customizable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-868&quot;&gt;&lt;del&gt;LOG4J2-868&lt;/del&gt;&lt;/a&gt; (cannot raise a new issue because this is disabled to defend against an Denial of Service attack):&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;It&apos;s leaking memory in log4J 2.5 (AsyncLoggerContext) @ JDK 8u92.&lt;br/&gt;
Total 2G memory used by 2 AsyncLoggerContext, each references 1G DefaultShutdownCallBackRegistry$1&lt;br/&gt;
which references 4G DefaultShutdownCallBackRegistry&lt;br/&gt;
which references 4G CopyOnWriteArrayList&lt;br/&gt;
which references many many many DefaultShutdownCallBackRegistry$1&lt;br/&gt;
How to turn it off or what&apos;s the work-around please?&lt;/p&gt;&lt;/blockquote&gt;
</description>
                <environment></environment>
        <key id="12970286">LOG4J2-1387</key>
            <summary>Memory leak related to shutdown hook</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rpopma">Remko Popma</assignee>
                                    <reporter username="yang_zhong">Yang ZHONG</reporter>
                        <labels>
                    </labels>
                <created>Tue, 17 May 2016 07:52:31 +0000</created>
                <updated>Wed, 18 May 2016 15:56:11 +0000</updated>
                            <resolved>Wed, 18 May 2016 15:56:11 +0000</resolved>
                                    <version>2.5</version>
                                    <fixVersion>2.6</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15286190" author="remkop@yahoo.com" created="Tue, 17 May 2016 07:53:43 +0000"  >&lt;p&gt;A workaround is to disable the shutdown hook in the configuration with&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;Configuration status=&lt;span class=&quot;code-quote&quot;&gt;&quot;WARN&quot;&lt;/span&gt; shutdownHook=&lt;span class=&quot;code-quote&quot;&gt;&quot;disable&quot;&lt;/span&gt;&amp;gt;
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;Any more information to address the memory leak is welcome. I have not done much analysis on this yet. If you can provide a patch that would be ideal but additional analysis on what the problem is would be useful too.&lt;/p&gt;</comment>
                            <comment id="15287099" author="yang_zhong" created="Tue, 17 May 2016 17:48:19 +0000"  >&lt;p&gt;Heap dump (attached) was generated by &quot;-XX:+HeapDumpOnOutOfMemoryError&quot;, the time to reach Out Of Memory was a few hours.&lt;/p&gt;</comment>
                            <comment id="15288824" author="remkop@yahoo.com" created="Wed, 18 May 2016 11:31:49 +0000"  >&lt;p&gt;I am not 100% sure but it looks like the anonymous inner class in DefaultShutdownCallbackRegistry has a reference to its outer class which somehow causes this leak...&lt;/p&gt;

&lt;p&gt;I changed the anonymous inner class to a static inner class. Can you try if the version in master still has the issue? (Build with &lt;tt&gt;mvn clean install&lt;/tt&gt;.)&lt;/p&gt;</comment>
                            <comment id="15289193" author="remkop@yahoo.com" created="Wed, 18 May 2016 15:56:11 +0000"  >&lt;p&gt;Marking as resolved. I cannot do much more testing since I don&apos;t have a way to reproduce the problem. Please reopen if the problem persists. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12804476" name="HeapDump.png" size="214752" author="yang_zhong" created="Tue, 17 May 2016 17:47:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 27 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2y2c7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>