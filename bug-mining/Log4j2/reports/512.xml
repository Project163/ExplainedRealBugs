<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:34:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-1035] Log4j2 tries to SystemClassLoader when running on Google AppEngine</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-1035</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;Apache Struts recently switched to Log4j2 as a base logging layer and this broke deployments to Google AppEngine, below is the exception:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Uncaught exception from servlet
java.lang.ExceptionInInitializerError
	at org.apache.logging.log4j.status.StatusLogger.&amp;lt;clinit&amp;gt;(StatusLogger.java:55)
	at org.apache.logging.log4j.LogManager.&amp;lt;clinit&amp;gt;(LogManager.java:56)
	at org.apache.struts2.tiles.StrutsTilesListener.&amp;lt;clinit&amp;gt;(StrutsTilesListener.java:50)
	at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:57)
	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.lang.reflect.Constructor.newInstance(Constructor.java:526)
	at java.lang.Class.newInstance(Class.java:375)
	at org.mortbay.jetty.webapp.WebXmlConfiguration.newListenerInstance(WebXmlConfiguration.java:650)
	at org.mortbay.jetty.webapp.WebXmlConfiguration.initListener(WebXmlConfiguration.java:631)
	at org.mortbay.jetty.webapp.WebXmlConfiguration.initWebXmlElement(WebXmlConfiguration.java:368)
	at org.mortbay.jetty.webapp.WebXmlConfiguration.initialize(WebXmlConfiguration.java:289)
	at org.mortbay.jetty.webapp.WebXmlConfiguration.configure(WebXmlConfiguration.java:222)
	at org.mortbay.jetty.webapp.WebXmlConfiguration.configureWebApp(WebXmlConfiguration.java:180)
	at org.mortbay.jetty.webapp.WebAppContext.startContext(WebAppContext.java:1247)
	at org.mortbay.jetty.handler.ContextHandler.doStart(ContextHandler.java:517)
	at org.mortbay.jetty.webapp.WebAppContext.doStart(WebAppContext.java:467)
	at org.mortbay.component.AbstractLifeCycle.start(AbstractLifeCycle.java:50)
	at com.google.apphosting.runtime.jetty.AppVersionHandlerMap.createHandler(AppVersionHandlerMap.java:199)
	at com.google.apphosting.runtime.jetty.AppVersionHandlerMap.getHandler(AppVersionHandlerMap.java:174)
	at com.google.apphosting.runtime.jetty.JettyServletEngineAdapter.serviceRequest(JettyServletEngineAdapter.java:134)
	at com.google.apphosting.runtime.JavaRuntime$RequestRunnable.run(JavaRuntime.java:527)
	at com.google.tracing.TraceContext$TraceContextRunnable.runInContext(TraceContext.java:437)
	at com.google.tracing.TraceContext$TraceContextRunnable$1.run(TraceContext.java:444)
	at com.google.tracing.CurrentContext.runInContext(CurrentContext.java:230)
	at com.google.tracing.TraceContext$AbstractTraceContextCallback.runInInheritedContextNoUnref(TraceContext.java:308)
	at com.google.tracing.TraceContext$AbstractTraceContextCallback.runInInheritedContext(TraceContext.java:300)
	at com.google.tracing.TraceContext$TraceContextRunnable.run(TraceContext.java:441)
	at com.google.apphosting.runtime.ThreadGroupPool$PoolEntry.run(ThreadGroupPool.java:251)
	at java.lang.Thread.run(Thread.java:745)
Caused by: java.security.AccessControlException: access denied (&quot;java.lang.RuntimePermission&quot; &quot;getClassLoader&quot;)
	at java.security.AccessControlContext.checkPermission(AccessControlContext.java:382)
	at java.security.AccessController.checkPermission(AccessController.java:572)
	at java.lang.SecurityManager.checkPermission(SecurityManager.java:549)
	at com.google.apphosting.runtime.security.CustomSecurityManager.checkPermission(CustomSecurityManager.java:56)
	at java.lang.ClassLoader.checkClassLoaderPermission(ClassLoader.java:1606)
	at java.lang.ClassLoader.getSystemClassLoader(ClassLoader.java:1525)
	at org.apache.logging.log4j.util.LoaderUtil.findUrlResources(LoaderUtil.java:192)
	at org.apache.logging.log4j.util.LoaderUtil.findResources(LoaderUtil.java:183)
	at org.apache.logging.log4j.util.PropertiesUtil.&amp;lt;init&amp;gt;(PropertiesUtil.java:90)
	at org.apache.logging.log4j.util.PropertiesUtil.&amp;lt;clinit&amp;gt;(PropertiesUtil.java:36)
	... 30 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Looks like it tries to read a file from filesystem which is prohibited.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Google AppEngine&lt;/p&gt;</environment>
        <key id="12833671">LOG4J2-1035</key>
            <summary>Log4j2 tries to SystemClassLoader when running on Google AppEngine</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="lukaszlenart">Lukasz Lenart</reporter>
                        <labels>
                    </labels>
                <created>Fri, 29 May 2015 05:04:04 +0000</created>
                <updated>Thu, 11 Jun 2015 06:06:29 +0000</updated>
                            <resolved>Thu, 11 Jun 2015 05:19:36 +0000</resolved>
                                    <version>2.3</version>
                                    <fixVersion>2.4</fixVersion>
                                    <component>Configurators</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14578036" author="garydgregory" created="Mon, 8 Jun 2015 23:15:49 +0000"  >&lt;p&gt;I think we need more information and explanations.&lt;/p&gt;

&lt;p&gt;How do you configure log4j? Where is your configuration file? If you include your config file in a jar in your classpath for example, a class loader will still be involved in finding it.&lt;/p&gt;

&lt;p&gt;I suspect that this AccessControlException is not the first one we will see.&lt;/p&gt;</comment>
                            <comment id="14578395" author="lukaszlenart" created="Tue, 9 Jun 2015 06:25:24 +0000"  >&lt;p&gt;No special configuration files, but after analysing sources I found that the problem is in &lt;tt&gt;LoaderUtil.findResources()&lt;/tt&gt; method as it uses &lt;tt&gt;ClassLoader.getSystemClassLoader()&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="14578471" author="garydgregory" created="Tue, 9 Jun 2015 07:19:43 +0000"  >&lt;p&gt;Right, that&apos;s what I mentioned earlier and what you can see in the stack trace. Any suggestions? &lt;/p&gt;</comment>
                            <comment id="14578489" author="lukaszlenart" created="Tue, 9 Jun 2015 07:39:24 +0000"  >&lt;p&gt;&lt;tt&gt;NoOpStatusLogger&lt;/tt&gt; which doesn&apos;t touch filesystem nor SystemClassLoader &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14580064" author="lukaszlenart" created="Wed, 10 Jun 2015 05:47:22 +0000"  >&lt;p&gt;Maybe it would be better to add a flag to disable access to &lt;tt&gt;SystemClassLoader&lt;/tt&gt; in &lt;tt&gt;LoaderUtil&lt;/tt&gt; as probably &lt;tt&gt;LoaderUtil&lt;/tt&gt; is used elsewhere as well&lt;/p&gt;</comment>
                            <comment id="14580121" author="garydgregory" created="Wed, 10 Jun 2015 06:47:57 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lukaszlenart&quot; class=&quot;user-hover&quot; rel=&quot;lukaszlenart&quot;&gt;lukaszlenart&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Can you implementing this locally and see if GAE trips up on something else? If you get GAE working based on Git master, we can then talk about how to best fix this issue.&lt;/p&gt;</comment>
                            <comment id="14580129" author="lukaszlenart" created="Wed, 10 Jun 2015 06:52:20 +0000"  >&lt;p&gt;I&apos;m trying but cannot build Log4j2 - got some error on duplicated classes when running build &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14580153" author="lukaszlenart" created="Wed, 10 Jun 2015 07:20:17 +0000"  >&lt;p&gt;each time the same problem &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;WARNING] COMPILATION WARNING :
[INFO] -------------------------------------------------------------
[WARNING] bootstrap class path not set in conjunction with -source 1.6
/Users/lukaszlenart/Projects/Apache/logging-log4j2/log4j-perf/src/main/java/org/apache/logging/log4j/perf/jmh/ReflectionBenchmark.java:[31,18] Reflection is internal proprietary API and may be removed in a future release
[WARNING] /Users/lukaszlenart/Projects/Apache/logging-log4j2/log4j-perf/src/main/java/org/apache/logging/log4j/perf/jmh/ReflectionBenchmark.java:[31,18] Reflection is internal proprietary API and may be removed in a future release
[INFO] 2 warnings
[INFO] -------------------------------------------------------------
[INFO] -------------------------------------------------------------
[ERROR] COMPILATION ERROR :
[INFO] -------------------------------------------------------------
[ERROR] /Users/lukaszlenart/Projects/Apache/logging-log4j2/log4j-perf/target/generated-sources/annotations/org/openjdk/jmh/infra/generated/Blackhole_jmh_B1.java:[3,7] error: duplicate class: org.openjdk.jmh.infra.generated.Blackhole_jmh_B1
[ERROR] /Users/lukaszlenart/Projects/Apache/logging-log4j2/log4j-perf/target/generated-sources/annotations/org/openjdk/jmh/infra/generated/Blackhole_jmh_B2.java:[3,7] error: duplicate class: org.openjdk.jmh.infra.generated.Blackhole_jmh_B2
[ERROR] /Users/lukaszlenart/Projects/Apache/logging-log4j2/log4j-perf/target/generated-sources/annotations/org/openjdk/jmh/infra/generated/Blackhole_jmh_B3.java:[2,7] error: duplicate class: org.openjdk.jmh.infra.generated.Blackhole_jmh_B3
[ERROR] /Users/lukaszlenart/Projects/Apache/logging-log4j2/log4j-perf/target/generated-sources/annotations/org/openjdk/jmh/infra/generated/Blackhole_jmh.java:[2,7] error: duplicate class: org.openjdk.jmh.infra.generated.Blackhole_jmh
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14580161" author="garydgregory" created="Wed, 10 Jun 2015 07:25:54 +0000"  >&lt;p&gt;Yeah, I get the same. You can skip that module. For example &lt;tt&gt;mvn clean install -pl !log4j-perf&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="14580193" author="lukaszlenart" created="Wed, 10 Jun 2015 08:03:46 +0000"  >&lt;p&gt;I was able build and test my idea with additional flag and it works but there is another problem&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;83.5.254.19 - - [10/Jun/2015:00:51:29 -0700] &quot;GET / HTTP/1.1&quot; 500 0 - &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.81 Safari/537.36&quot; &quot;ride-by-wire.appspot.com&quot; ms=1714 cpu_ms=1405 loading_request=1 app_engine_release=1.9.22 instance=00c61b117c5174d7de5a02eeaf304961c03c1427
W 2015-06-10 00:51:29.546
[s~ride-by-wire/1.384915682490178443].&amp;lt;stderr&amp;gt;: ERROR StatusLogger catching

W 2015-06-10 00:51:29.549
[s~ride-by-wire/1.384915682490178443].&amp;lt;stderr&amp;gt;:  java.security.AccessControlException: access denied (&quot;java.lang.RuntimePermission&quot; &quot;modifyThreadGroup&quot;)

W 2015-06-10 00:51:29.549
[s~ride-by-wire/1.384915682490178443].&amp;lt;stderr&amp;gt;: 	at java.security.AccessControlContext.checkPermission(AccessControlContext.java:382)

W 2015-06-10 00:51:29.549
[s~ride-by-wire/1.384915682490178443].&amp;lt;stderr&amp;gt;: 	at java.security.AccessController.checkPermission(AccessController.java:572)

W 2015-06-10 00:51:29.549
[s~ride-by-wire/1.384915682490178443].&amp;lt;stderr&amp;gt;: 	at java.lang.SecurityManager.checkPermission(SecurityManager.java:549)

W 2015-06-10 00:51:29.549
[s~ride-by-wire/1.384915682490178443].&amp;lt;stderr&amp;gt;: 	at com.google.apphosting.runtime.security.CustomSecurityManager.checkPermission(CustomSecurityManager.java:56)

W 2015-06-10 00:51:29.549
[s~ride-by-wire/1.384915682490178443].&amp;lt;stderr&amp;gt;: 	at com.google.apphosting.runtime.security.CustomSecurityManager.checkAccess(CustomSecurityManager.java:131)

W 2015-06-10 00:51:29.549
[s~ride-by-wire/1.384915682490178443].&amp;lt;stderr&amp;gt;: 	at java.lang.ThreadGroup.checkAccess(ThreadGroup.java:315)

W 2015-06-10 00:51:29.549
[s~ride-by-wire/1.384915682490178443].&amp;lt;stderr&amp;gt;: 	at java.lang.Thread.init(Thread.java:391)

W 2015-06-10 00:51:29.549
[s~ride-by-wire/1.384915682490178443].&amp;lt;stderr&amp;gt;: 	at java.lang.Thread.init(Thread.java:349)

W 2015-06-10 00:51:29.549
[s~ride-by-wire/1.384915682490178443].&amp;lt;stderr&amp;gt;: 	at java.lang.Thread.&amp;lt;init&amp;gt;(Thread.java:675)

W 2015-06-10 00:51:29.549
[s~ride-by-wire/1.384915682490178443].&amp;lt;stderr&amp;gt;: 	at java.util.concurrent.Executors$DefaultThreadFactory.newThread(Executors.java:572)

W 2015-06-10 00:51:29.549
[s~ride-by-wire/1.384915682490178443].&amp;lt;stderr&amp;gt;: 	at org.apache.logging.log4j.core.util.DefaultShutdownCallbackRegistry.start(DefaultShutdownCallbackRegistry.java:124)

W 2015-06-10 00:51:29.549
[s~ride-by-wire/1.384915682490178443].&amp;lt;stderr&amp;gt;: 	at org.apache.logging.log4j.core.impl.Log4jContextFactory.initializeShutdownCallbackRegistry(Log4jContextFactory.java:123)

....
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14580213" author="lukaszlenart" created="Wed, 10 Jun 2015 08:24:57 +0000"  >&lt;p&gt;The above exception was resolved with including &lt;tt&gt;log4j2-web&lt;/tt&gt; module but another one pop up:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Uncaught exception from servlet
java.lang.NoClassDefFoundError: Could not initialize class org.apache.logging.log4j.core.util.Loader
	at org.apache.logging.log4j.core.lookup.Interpolator.&amp;lt;init&amp;gt;(Interpolator.java:114)
	at org.apache.logging.log4j.core.config.AbstractConfiguration.&amp;lt;init&amp;gt;(AbstractConfiguration.java:104)
	at org.apache.logging.log4j.core.config.NullConfiguration.&amp;lt;init&amp;gt;(NullConfiguration.java:30)
	at org.apache.logging.log4j.core.LoggerContext.&amp;lt;clinit&amp;gt;(LoggerContext.java:61)
	at org.apache.logging.log4j.core.selector.ClassLoaderContextSelector.locateContext(ClassLoaderContextSelector.java:145)
	at org.apache.logging.log4j.core.selector.ClassLoaderContextSelector.getContext(ClassLoaderContextSelector.java:70)
	at org.apache.logging.log4j.core.selector.ClassLoaderContextSelector.getContext(ClassLoaderContextSelector.java:57)
	at org.apache.logging.log4j.core.impl.Log4jContextFactory.getContext(Log4jContextFactory.java:142)
	at org.apache.logging.log4j.core.impl.Log4jContextFactory.getContext(Log4jContextFactory.java:41)
	at org.apache.logging.log4j.LogManager.getContext(LogManager.java:175)
	at org.apache.logging.log4j.LogManager.getLogger(LogManager.java:426)
	at org.apache.struts2.tiles.StrutsTilesListener.&amp;lt;clinit&amp;gt;(StrutsTilesListener.java:50)
	at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:57)
	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.lang.reflect.Constructor.newInstance(Constructor.java:526)
	at java.lang.Class.newInstance(Class.java:375)
	at org.mortbay.jetty.webapp.WebXmlConfiguration.newListenerInstance(WebXmlConfiguration.java:650)
	at org.mortbay.jetty.webapp.WebXmlConfiguration.initListener(WebXmlConfiguration.java:631)
	at org.mortbay.jetty.webapp.WebXmlConfiguration.initWebXmlElement(WebXmlConfiguration.java:368)
	at org.mortbay.jetty.webapp.WebXmlConfiguration.initialize(WebXmlConfiguration.java:289)
	at org.mortbay.jetty.webapp.WebXmlConfiguration.configure(WebXmlConfiguration.java:222)
	at org.mortbay.jetty.webapp.WebXmlConfiguration.configureWebApp(WebXmlConfiguration.java:180)
	at org.mortbay.jetty.webapp.WebAppContext.startContext(WebAppContext.java:1247)
	at org.mortbay.jetty.handler.ContextHandler.doStart(ContextHandler.java:517)
	at org.mortbay.jetty.webapp.WebAppContext.doStart(WebAppContext.java:467)
	at org.mortbay.component.AbstractLifeCycle.start(AbstractLifeCycle.java:50)
	at com.google.apphosting.runtime.jetty.AppVersionHandlerMap.createHandler(AppVersionHandlerMap.java:199)
	at com.google.apphosting.runtime.jetty.AppVersionHandlerMap.getHandler(AppVersionHandlerMap.java:174)
	at com.google.apphosting.runtime.jetty.JettyServletEngineAdapter.serviceRequest(JettyServletEngineAdapter.java:134)
	at com.google.apphosting.runtime.JavaRuntime$RequestRunnable.run(JavaRuntime.java:527)
	at com.google.tracing.TraceContext$TraceContextRunnable.runInContext(TraceContext.java:437)
	at com.google.tracing.TraceContext$TraceContextRunnable$1.run(TraceContext.java:444)
	at com.google.tracing.CurrentContext.runInContext(CurrentContext.java:230)
	at com.google.tracing.TraceContext$AbstractTraceContextCallback.runInInheritedContextNoUnref(TraceContext.java:308)
	at com.google.tracing.TraceContext$AbstractTraceContextCallback.runInInheritedContext(TraceContext.java:300)
	at com.google.tracing.TraceContext$TraceContextRunnable.run(TraceContext.java:441)
	at com.google.apphosting.runtime.ThreadGroupPool$PoolEntry.run(ThreadGroupPool.java:251)
	at java.lang.Thread.run(Thread.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14580258" author="lukaszlenart" created="Wed, 10 Jun 2015 08:57:58 +0000"  >&lt;p&gt;No idea how to solve this issue &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14580268" author="lukaszlenart" created="Wed, 10 Jun 2015 09:11:13 +0000"  >&lt;p&gt;Patch solves the original issue with accessing &lt;tt&gt;SystemClassLoader&lt;/tt&gt; and allows use other logging layers together with Log4j2&lt;/p&gt;</comment>
                            <comment id="14581271" author="garydgregory" created="Thu, 11 Jun 2015 00:12:40 +0000"  >&lt;p&gt;I&apos;m not sure we need yet another system property to fix this.&lt;/p&gt;

&lt;p&gt;In your use case, Java throws an exception for &lt;tt&gt;access denied (&quot;java.lang.RuntimePermission&quot; &quot;getClassLoader&quot;)&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;In the LoaderUtil class static init, we already check if this permission is set like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (SECURITY_MANAGER != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; getClassLoaderDisabled;
            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                SECURITY_MANAGER.checkPermission(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RuntimePermission(&lt;span class=&quot;code-quote&quot;&gt;&quot;getClassLoader&quot;&lt;/span&gt;));
                getClassLoaderDisabled = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
            } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; SecurityException ignored) {
                getClassLoaderDisabled = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
            }
            GET_CLASS_LOADER_DISABLED = getClassLoaderDisabled;
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
            GET_CLASS_LOADER_DISABLED = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So we know by the time we are in &lt;tt&gt;org.apache.logging.log4j.util.LoaderUtil.findUrlResources(LoaderUtil.java:192)&lt;/tt&gt; if the call to &lt;tt&gt;java.lang.ClassLoader.getSystemClassLoader(ClassLoader.java:1525)&lt;/tt&gt; will fail.&lt;/p&gt;

&lt;p&gt;Can you try this instead: &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;diff --git a/log4j-api/src/main/java/org/apache/logging/log4j/util/LoaderUtil.java b/log4j-api/src/main/java/org/apache/logging/log4j/util/LoaderUtil.java
index 277f0f4..8f68500 100644
--- a/log4j-api/src/main/java/org/apache/logging/log4j/util/LoaderUtil.java
+++ b/log4j-api/src/main/java/org/apache/logging/log4j/util/LoaderUtil.java
@@ -94,7 +94,7 @@
                 return cl;
             }
             final ClassLoader ccl = LoaderUtil.class.getClassLoader();
-            return ccl == null ? ClassLoader.getSystemClassLoader() : ccl;
+            return ccl == null &amp;amp;&amp;amp; !GET_CLASS_LOADER_DISABLED ? ClassLoader.getSystemClassLoader() : ccl;
         }
     }
 
@@ -192,7 +192,7 @@
         final ClassLoader[] candidates = {
             getThreadContextClassLoader(),
             LoaderUtil.class.getClassLoader(),
-            ClassLoader.getSystemClassLoader()
+            GET_CLASS_LOADER_DISABLED ? null : ClassLoader.getSystemClassLoader()
         };
         final Collection&amp;lt;UrlResource&amp;gt; resources = new LinkedHashSet&amp;lt;&amp;gt;();
         for (final ClassLoader cl : candidates) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Thank you,&lt;br/&gt;
Gary&lt;/p&gt;</comment>
                            <comment id="14581439" author="lukaszlenart" created="Thu, 11 Jun 2015 05:10:46 +0000"  >&lt;p&gt;Great! That works too!&lt;/p&gt;</comment>
                            <comment id="14581448" author="garydgregory" created="Thu, 11 Jun 2015 05:19:27 +0000"  >&lt;p&gt;Thank you for the confirmation.&lt;/p&gt;

&lt;p&gt;Please verify the code in Git master for the original issue and close the ticket.&lt;/p&gt;

&lt;p&gt;If there is more on this topic in general, let&apos;s continue in a new ticket.&lt;/p&gt;</comment>
                            <comment id="14581474" author="lukaszlenart" created="Thu, 11 Jun 2015 05:41:27 +0000"  >&lt;p&gt;Checked &lt;tt&gt;master&lt;/tt&gt; branch and everything looks ok, also deployed to GAE and works! Thanks!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12837044">LOG4J2-1051</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12738771" name="scl.patch" size="1727" author="lukaszlenart" created="Wed, 10 Jun 2015 09:11:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 23 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2fd0f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>