<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:41:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-3075] JsonTemplateLayout timestamp resolver doesn&apos;t format nanoseconds</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-3075</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;As reported in&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3073&quot; title=&quot;Issues using Lookup Plugin in Json Template Logging&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3073&quot;&gt;&lt;del&gt;LOG4J2-3073&lt;/del&gt;&lt;/a&gt;, &lt;tt&gt;TimestampResolver&lt;/tt&gt; of &lt;tt&gt;JsonTemplateLayout&lt;/tt&gt; doesn&apos;t format nanoseconds. The suspect is in the following form:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
formatResolverContext.calendar.setTimeInMillis(timestampMillis);
formatResolverContext.timestampFormat.format(
        formatResolverContext.calendar,
        formatResolverContext.formattedTimestampBuilder);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13373063">LOG4J2-3075</key>
            <summary>JsonTemplateLayout timestamp resolver doesn&apos;t format nanoseconds</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vy">Volkan Yazici</assignee>
                                    <reporter username="paulrubin37">Paul Rubin</reporter>
                        <labels>
                    </labels>
                <created>Fri, 16 Apr 2021 16:10:22 +0000</created>
                <updated>Tue, 8 Feb 2022 16:23:00 +0000</updated>
                            <resolved>Mon, 24 May 2021 19:25:39 +0000</resolved>
                                    <version>2.14.0</version>
                    <version>2.14.1</version>
                                    <fixVersion>3.0.0</fixVersion>
                    <fixVersion>2.15.0</fixVersion>
                                    <component>JsonTemplateLayout</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17341818" author="vy" created="Mon, 10 May 2021 10:29:53 +0000"  >&lt;p&gt;This issue has turned out to be a pretty difficult one to crack.&#160;I have done some preliminary study and checked &lt;tt&gt;DatePatternConverter&lt;/tt&gt; for inspiration. In a nutshell, this is what &lt;tt&gt;DataPatternConverter&lt;/tt&gt; does:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; Formatter createFormatter(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] options) {
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; FixedDateFormat fixedDateFormat = FixedDateFormat.createIfSupported(options);
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (fixedDateFormat != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; createFixedFormatter(fixedDateFormat);
    }
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; createNonFixedFormatter(options);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If &lt;tt&gt;FixedDateFormat&lt;/tt&gt; supports the user pattern, it uses the &lt;tt&gt;FixedDateFormat&lt;/tt&gt;, otherwise it falls back to &lt;tt&gt;FastDateFormat&lt;/tt&gt;. Here comes the tricky part... &lt;tt&gt;FixedDateFormat#formatInstant()&lt;/tt&gt; supports nanoseconds passed in by the Log4j &lt;tt&gt;Instant&lt;/tt&gt; argument. Though &lt;tt&gt;FastDateFormat&lt;/tt&gt; doesn&apos;t format nanoseconds at all, it is worse: in essence it is designed to work with &lt;tt&gt;Calendar&lt;/tt&gt; instances which doesn&apos;t support nanosecond precision! Hence, if the user pattern is not supported by the &lt;tt&gt;FixedDateFormat&lt;/tt&gt;, the fallback &lt;tt&gt;FastDateFormat&lt;/tt&gt; doesn&apos;t support nanoseconds. As a consequence, &lt;tt&gt;PatternLayout&lt;/tt&gt; doesn&apos;t support nanosecond either, &lt;em&gt;if&lt;/em&gt; the provided pattern cannot be formatted via &lt;tt&gt;FixedDateFormat&lt;/tt&gt;. The solution I have in mind is to extend &lt;tt&gt;FastDateFormat&lt;/tt&gt; to support nanoseconds. Though this necessitates substantial rewrite of the &lt;tt&gt;FastDatePrinter&lt;/tt&gt; used by &lt;tt&gt;FastDateFormat&lt;/tt&gt;. Apparently, this story kicks the hornets&apos; nest.&lt;/p&gt;</comment>
                            <comment id="17341884" author="paulrubin37" created="Mon, 10 May 2021 12:40:14 +0000"  >&lt;p&gt;I do not know if this will help or not I just created a String lookup that internally uses a DateTimeFormatter:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Plugin(name = &lt;span class=&quot;code-quote&quot;&gt;&quot;timestampnano&quot;&lt;/span&gt;, category = StrLookup.CATEGORY)
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;TimestampNano &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; StrLookup {

    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getTimeInNano() {
        Instant now = Instant.now();
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; getTimestampNano(now);
    }

    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getTimestampNano(Instant now) {
        DateTimeFormatter formatter = DateTimeFormatter.ISO_INSTANT;
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; formatter.format(now);
    }

    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; lookup(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; key) {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; getTimeInNano();
    }

    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; lookup(LogEvent event, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; key) {
        Instant now = Instant.now();
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!key.isEmpty()) {
            now = Instant.ofEpochSecond(event.getInstant().getEpochSecond(), event.getInstant().getNanoOfSecond());
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; getTimestampNano(now);
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I likely misused the key in the lookup, but I was trying to provide the ability to get the current time instead of the event time just so I could see the difference.&lt;/p&gt;</comment>
                            <comment id="17349179" author="jira-bot" created="Fri, 21 May 2021 12:12:49 +0000"  >&lt;p&gt;Commit 01959e488d8a704af3f030f1e52a6b8c88dfeb40 in logging-log4j2&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3075&quot; title=&quot;JsonTemplateLayout timestamp resolver doesn&amp;#39;t format nanoseconds&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3075&quot;&gt;&lt;del&gt;LOG4J2-3075&lt;/del&gt;&lt;/a&gt; from Volkan Yazici&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=01959e4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=01959e4&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3075&quot; title=&quot;JsonTemplateLayout timestamp resolver doesn&amp;#39;t format nanoseconds&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3075&quot;&gt;&lt;del&gt;LOG4J2-3075&lt;/del&gt;&lt;/a&gt; Fix formatting of nanoseconds in JsonTemplateLayout.&lt;/p&gt;</comment>
                            <comment id="17350583" author="jira-bot" created="Mon, 24 May 2021 18:59:13 +0000"  >&lt;p&gt;Commit 4e61e766624d33d9850ab1282ffee773ddcf4f9f in logging-log4j2&apos;s branch refs/heads/release-2.x from Volkan Yaz&#305;c&#305;&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=4e61e76&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=4e61e76&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3075&quot; title=&quot;JsonTemplateLayout timestamp resolver doesn&amp;#39;t format nanoseconds&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3075&quot;&gt;&lt;del&gt;LOG4J2-3075&lt;/del&gt;&lt;/a&gt; Fix formatting of nanoseconds in JsonTemplateLayout. (#495)&lt;/p&gt;
</comment>
                            <comment id="17350592" author="jira-bot" created="Mon, 24 May 2021 19:23:39 +0000"  >&lt;p&gt;Commit ebf770a5178eaa1b7ac6d0b4a14694232ba9c748 in logging-log4j2&apos;s branch refs/heads/master from Volkan Yaz&#305;c&#305;&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=ebf770a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=ebf770a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3075&quot; title=&quot;JsonTemplateLayout timestamp resolver doesn&amp;#39;t format nanoseconds&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3075&quot;&gt;&lt;del&gt;LOG4J2-3075&lt;/del&gt;&lt;/a&gt; Fix formatting of nanoseconds in JsonTemplateLayout. (#495)&lt;/p&gt;</comment>
                            <comment id="17350593" author="vy" created="Mon, 24 May 2021 19:25:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=paulrubin37&quot; class=&quot;user-hover&quot; rel=&quot;paulrubin37&quot;&gt;paulrubin37&lt;/a&gt;, I&apos;ve pushed a fix to &lt;tt&gt;release-2.x&lt;/tt&gt;. Would you mind confirming that the changes fix your issue and close this ticket, please?&lt;/p&gt;</comment>
                            <comment id="17351750" author="paulrubin37" created="Wed, 26 May 2021 12:21:29 +0000"  >&lt;p&gt;Sorry, I am unable to see any version&#160;beyond 2.14.1 which is what I am already using.&#160; I am unable to access the SNAPSHOT version from my network.&#160; I looked at the code and it seem that it will solve the issue.&#160;&#160;&lt;/p&gt;</comment>
                            <comment id="17352339" author="vy" created="Thu, 27 May 2021 08:34:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=paulrubin37&quot; class=&quot;user-hover&quot; rel=&quot;paulrubin37&quot;&gt;paulrubin37&lt;/a&gt;, could you try with the most recent artifact in &lt;a href=&quot;https://repository.apache.org/content/groups/public/org/apache/logging/log4j/log4j-layout-template-json/2.15.0-SNAPSHOT/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;the public snapshot repository&lt;/a&gt;, please?&lt;/p&gt;</comment>
                            <comment id="17488975" author="paulrubin37" created="Tue, 8 Feb 2022 16:10:30 +0000"  >&lt;p&gt;Ok, I am finally looking at 2.17.1 and it appears this is not working correctly, I am not sure I have correctly listed in the json schema:&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;@timestamp_nano&quot;&lt;/span&gt;: {
  &lt;span class=&quot;code-quote&quot;&gt;&quot;$resolver&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;timestamp&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;pattern&quot;&lt;/span&gt;: {
    &lt;span class=&quot;code-quote&quot;&gt;&quot;format&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;yyyy-MM-dd&lt;span class=&quot;code-quote&quot;&gt;&apos;T&apos;&lt;/span&gt;HH:mm:ss.SSSSSSSSS&lt;span class=&quot;code-quote&quot;&gt;&apos;Z&apos;&lt;/span&gt;&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;timeZone&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;UTC&quot;&lt;/span&gt;
  }
},
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The output is still showing milliseconds in the last three places:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;@timestamp_nano&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;2021-09-03T13:55:15.000000691Z&quot;&lt;/span&gt;,
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17488983" author="paulrubin37" created="Tue, 8 Feb 2022 16:22:50 +0000"  >&lt;p&gt;Sorry, I was looking at the wrong output this is working great.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 40 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0q400:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>