<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:42:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-2715] JDBCAppender commits to the DB a JTA RollbackOnly transaction and causes DB inconsistency</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-2715</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;I&apos;m using log4j2 in a Payara 5.183 server and I&apos;ve enabled a JDBC Appender connected to a JNDI datasource.&lt;/p&gt;

&lt;p&gt;&amp;lt;JDBC name=&quot;DBAppender&quot; tableName=&quot;LOG_TABLE&quot;&amp;gt;&lt;br/&gt;
&#160;&#160;&#160; &amp;lt;DataSource jndiName=&quot;myJNDI&quot;&amp;gt;&amp;lt;/DataSource&amp;gt;&lt;br/&gt;
&#160;&#160;&#160; &amp;lt;Column ...&quot; /&amp;gt;&#160;&#160;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160; &amp;lt;Column ...&quot; /&amp;gt;&lt;/p&gt;

&lt;p&gt;&amp;lt;/JDBC&amp;gt;&lt;/p&gt;

&lt;p&gt;The same datasource is used by the application to talk with the db. If the application, that uses EJB3, marks the transaction to be rolled back (sessionContext.setRollbackOnly()), each statement sent to the database (flush(), executeUpdate()) inside the transaction must not be committed.&lt;/p&gt;

&lt;p&gt;What happens is that using the &lt;b&gt;jdbc appender&lt;/b&gt; causes a commit that &lt;b&gt;&lt;font color=&quot;#de350b&quot;&gt;writes to the database everything&lt;/font&gt;&lt;/b&gt;, &lt;b&gt;causing database inconsistency&lt;/b&gt;.&lt;/p&gt;

&lt;p&gt;Using DriverManager instead of a JNDI works fine, but I don&apos;t know if I can set a connection pool with it.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;When log4j is inside a JTA transaction it should use another JDBC connection to log.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment>&lt;p&gt;Container Payara 5.183,&lt;/p&gt;

&lt;p&gt;Application: EAR using EJB 3, Hibernate 5.3.6-FINAL&lt;/p&gt;

&lt;p&gt;JDBC Driver: Oracle Driver ojdbc8&lt;/p&gt;</environment>
        <key id="13264284">LOG4J2-2715</key>
            <summary>JDBCAppender commits to the DB a JTA RollbackOnly transaction and causes DB inconsistency</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="davidobber">David Obber</reporter>
                        <labels>
                    </labels>
                <created>Thu, 24 Oct 2019 16:03:37 +0000</created>
                <updated>Sun, 6 Feb 2022 13:24:23 +0000</updated>
                            <resolved>Sun, 6 Feb 2022 13:24:23 +0000</resolved>
                                    <version>2.9.1</version>
                    <version>2.12.1</version>
                                    <fixVersion>2.17.2</fixVersion>
                                    <component>Appenders</component>
                    <component>JDBC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16959280" author="garydgregory" created="Thu, 24 Oct 2019 23:00:34 +0000"  >&lt;p&gt;Log4j expects to NOT share its JDBC Connections to the database with other components, that&apos;s a recipe for disaster.&lt;/p&gt;</comment>
                            <comment id="16959464" author="davidobber" created="Fri, 25 Oct 2019 06:24:28 +0000"  >&lt;p&gt;I completely agree. For that reason I think that it should be written in the documentation.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17487711" author="jira-bot" created="Sun, 6 Feb 2022 13:23:39 +0000"  >&lt;p&gt;Commit 910f5812c836aa0afeb4ffde1c9da9f8c3e878a3 in logging-log4j2&apos;s branch refs/heads/release-2.x from Gary Gregory&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=910f581&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=910f581&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2715&quot; title=&quot;JDBCAppender commits to the DB a JTA RollbackOnly transaction and causes DB inconsistency&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2715&quot;&gt;&lt;del&gt;LOG4J2-2715&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
JDBCAppender commits to the DB a JTA RollbackOnly transaction and causes&lt;br/&gt;
DB inconsistency.&lt;/p&gt;

&lt;p&gt;Update documentation.&lt;/p&gt;</comment>
                            <comment id="17487712" author="garydgregory" created="Sun, 6 Feb 2022 13:24:23 +0000"  >&lt;p&gt;I updated the site documentation but the changes will only appear when the next release is published.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 40 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z07x6o:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>