<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:40:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-2610] Windows - File creationTime issue for RollingFileAppender, combined time/size policy</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-2610</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;Hello Apache Log4j Team.&lt;/p&gt;

&lt;p&gt;Recently I encountered a boundary-condition issue with RollingFileAppender on Windows. Due to the nature of the issue it can be difficult to reproduce consistently, but I was able to do so using some files with old creation dates.&lt;/p&gt;

&lt;p&gt;It was reproduced with a configuration like this modified from one of the unit tests:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;
&#160;&#160;&#160; &amp;lt;RollingFile name=&lt;span class=&quot;code-quote&quot;&gt;&quot;RollingFile&quot;&lt;/span&gt; fileName=&lt;span class=&quot;code-quote&quot;&gt;&quot;target/rolling3/rollingtest.log&quot;&lt;/span&gt; filePattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;target/rolling3/rollingtest_%d\{yyyy-MM-dd}_%i_.log&quot;&lt;/span&gt;
&#160;&#160;&#160;&#160;&#160; append=&lt;span class=&quot;code-quote&quot;&gt;&quot;true&quot;&lt;/span&gt; bufferedIO=&lt;span class=&quot;code-quote&quot;&gt;&quot;true&quot;&lt;/span&gt; bufferSize=&lt;span class=&quot;code-quote&quot;&gt;&quot;8192&quot;&lt;/span&gt; immediateFlush=&lt;span class=&quot;code-quote&quot;&gt;&quot;true&quot;&lt;/span&gt;&amp;gt;
&#160;&#160;&#160;&#160;&#160; &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;PatternLayout pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;%d\{yyyy-MM-dd-HH-mm-ss} [%level] [%c] %msg%n&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
&#160;&#160;&#160;&#160;&#160; &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Policies&amp;gt;&lt;/span&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;TimeBasedTriggeringPolicy interval=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; modulate=&lt;span class=&quot;code-quote&quot;&gt;&quot;true&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;SizeBasedTriggeringPolicy size=&lt;span class=&quot;code-quote&quot;&gt;&quot;3500KB&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
&#160;&#160;&#160;&#160;&#160; &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Policies&amp;gt;&lt;/span&gt;
&#160;&#160;&#160;&#160;&#160; &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;DefaultRolloverStrategy max=&lt;span class=&quot;code-quote&quot;&gt;&quot;3&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
&#160;&#160;&#160; &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/RollingFile&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;where the &lt;ins&gt;current and rollover files both share the same directory&lt;/ins&gt;. It is easier to see when the date/time of the initial log file &quot;rollingtest.log&quot; has a creationTime that is a few days in the past (simulating a gap in processing between logs due to downtime).&lt;/p&gt;

&lt;p&gt;When the rolling append rolls the file over into one matching filePattern, it creates a &lt;ins&gt;new &quot;rollingtest.log&quot; file&lt;/ins&gt; which has a &lt;ins&gt;creationTIme equal to&lt;/ins&gt; the &lt;ins&gt;old file&apos;s creationTime&lt;/ins&gt; (instead of the current system time).&lt;/p&gt;

&lt;p&gt;For example if the current date is 2019-05-30 and the old file&apos;s creationTime is sometime in 2019-05-28 (2 days previous), after the rollover the newly created &quot;rolingtest.log&quot; will still have a creationTime of 2019-05-28 ... even though it was just re-created on 2019-05-30. This creates some strange behaviour the next time a rollover is processed by the RollingFileAppender (since the current log file appears to be a &quot;2-day-old file&quot; the 2nd rollover filename is incorrect).&lt;/p&gt;

&lt;p&gt;Going through some of the Log4j2 code it doesn&apos;t appear to be a direct bug in Log4j2, but rather due to a Windows behaviour called &quot;File System Tunneling&quot; (see blog &lt;a href=&quot;https://devblogs.microsoft.com/oldnewthing/20050715-14/?p=34923&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://devblogs.microsoft.com/oldnewthing/20050715-14/?p=34923&lt;/a&gt; for some details).&lt;/p&gt;

&lt;p&gt;While trying to figure out what was happening I also noticed that the unit test RollingAppenderSizeWithTimeTest.&lt;ins&gt;testAppender()&lt;/ins&gt; was &lt;ins&gt;consistently failing&lt;/ins&gt; under Windows too. Since that test involves very rapid rollovers it could be related to the &quot;tunneling&quot; behaviour in Windows or could be something entirely different.&lt;/p&gt;

&lt;p&gt;I&apos;ve attempted two mitigation fixes for both issues described in this Jira against the code for 2.12.0-SNAPSHOT. A GitHub PR with an initial fix attempt and unit test should follow soon.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows 10, JDK 7u79, Log4J2 2.11.2&lt;/p&gt;</environment>
        <key id="13234387">LOG4J2-2610</key>
            <summary>Windows - File creationTime issue for RollingFileAppender, combined time/size policy</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="JCjA492kH6347Vb10Ja53">James Chaplin</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 20 May 2019 19:57:18 +0000</created>
                <updated>Tue, 18 Jun 2019 04:22:04 +0000</updated>
                            <resolved>Sun, 2 Jun 2019 22:39:13 +0000</resolved>
                                    <version>2.11.2</version>
                                    <fixVersion>2.12.0</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="23400">6.5h</timespent>
                                <comments>
                            <comment id="16853770" author="ralph.goers@dslextreme.com" created="Sat, 1 Jun 2019 17:23:43 +0000"  >&lt;p&gt;Just a note that&#160;&lt;a href=&quot;https://df-stream.com/2012/02/file-system-tunneling-in-windows/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://df-stream.com/2012/02/file-system-tunneling-in-windows/&lt;/a&gt;&#160;mentions that file system tunneling can be disabled by setting a Windows registry key. I&apos;d like to find a programmatic way to do the same thing.&#160;&lt;a href=&quot;http://www.tweakscene.com/viewtopic.php?t=7263&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.tweakscene.com/viewtopic.php?t=7263&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Note that the articles I have found say the default cache time is 15 seconds, which is far too long for Log4j.&#160;&lt;/p&gt;

&lt;p&gt;I am attempting to fix this by explicitly setting the file creation time.&lt;/p&gt;</comment>
                            <comment id="16853798" author="garydgregory" created="Sat, 1 Jun 2019 19:33:56 +0000"  >&lt;blockquote&gt;
&lt;p&gt;file system tunneling can be disabled by setting a Windows registry key.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Maybe using JNA &lt;a href=&quot;https://java-native-access.github.io/jna/5.3.1/javadoc/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://java-native-access.github.io/jna/5.3.1/javadoc/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16853833" author="jcja492kh6347vb10ja53" created="Sat, 1 Jun 2019 22:47:01 +0000"  >&lt;p&gt;Hi.&lt;/p&gt;

&lt;p&gt;Although it might be &lt;em&gt;interesting&lt;/em&gt; to try JNA to manipulate the system tunneling state registry entry, I don&apos;t think it would be safe to make such a potentially invasive system-property change to Windows.&#160; It also might be one of those &quot;reboot required&quot; to pick-up-change properties.&lt;/p&gt;

&lt;p&gt;It probably wouldn&apos;t be the kind of side-effect a user would expect from a logging framework (not to mention the system tunneling cache time being an OS-wide setting).&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16854096" author="jira-bot" created="Sun, 2 Jun 2019 20:07:40 +0000"  >&lt;p&gt;Commit 6996fb0433bec6f4e5fd528159a63a7c04d4fb7f in logging-log4j2&apos;s branch refs/heads/release-2.x from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=6996fb0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=6996fb0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2610&quot; title=&quot;Windows - File creationTime issue for RollingFileAppender, combined time/size policy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2610&quot;&gt;&lt;del&gt;LOG4J2-2610&lt;/del&gt;&lt;/a&gt; - Explicitly set file creation time&lt;/p&gt;</comment>
                            <comment id="16854124" author="jira-bot" created="Sun, 2 Jun 2019 22:05:12 +0000"  >&lt;p&gt;Commit fc57d47fc8cbba882a996b6038c1c5c264b11ed2 in logging-log4j2&apos;s branch refs/heads/master from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=fc57d47&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=fc57d47&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2610&quot; title=&quot;Windows - File creationTime issue for RollingFileAppender, combined time/size policy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2610&quot;&gt;&lt;del&gt;LOG4J2-2610&lt;/del&gt;&lt;/a&gt; - Explicitly set file creation time&lt;/p&gt;</comment>
                            <comment id="16854126" author="jira-bot" created="Sun, 2 Jun 2019 22:13:49 +0000"  >&lt;p&gt;Commit b0f2315f7399f1aa0e612caebb7decc9efcfc7c8 in logging-log4j2&apos;s branch refs/heads/release-2.x from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=b0f2315&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=b0f2315&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2610&quot; title=&quot;Windows - File creationTime issue for RollingFileAppender, combined time/size policy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2610&quot;&gt;&lt;del&gt;LOG4J2-2610&lt;/del&gt;&lt;/a&gt; - Only update creation time if flie size is 0&lt;/p&gt;</comment>
                            <comment id="16854129" author="jira-bot" created="Sun, 2 Jun 2019 22:28:37 +0000"  >&lt;p&gt;Commit 51ace0af494ec3eafd2163b162692bae06653062 in logging-log4j2&apos;s branch refs/heads/master from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=51ace0a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=51ace0a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2610&quot; title=&quot;Windows - File creationTime issue for RollingFileAppender, combined time/size policy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2610&quot;&gt;&lt;del&gt;LOG4J2-2610&lt;/del&gt;&lt;/a&gt; - Only update creation time if flie size is 0&lt;/p&gt;</comment>
                            <comment id="16854136" author="ralph.goers@dslextreme.com" created="Sun, 2 Jun 2019 22:39:14 +0000"  >&lt;p&gt;A fix has been applied to both the release-2.x and master branches. Please verify and close.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13237047">LOG4J2-2620</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 24 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z02vd4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>