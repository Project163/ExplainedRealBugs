<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:40:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-2636] No default value for mdcId in SyslogAppender</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-2636</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;1) Main issue&lt;/p&gt;

&lt;p&gt;When&#160;Rfc5424Layout is created from configuration, it seems to receive default value:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@PluginAttribute(value = &lt;span class=&quot;code-quote&quot;&gt;&quot;mdcId&quot;&lt;/span&gt;, defaultString = DEFAULT_MDCID) &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; mdcId,&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;But SyslogAppender has it with no default:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@PluginBuilderAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;mdcId&quot;&lt;/span&gt;)
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; mdcId;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It is used in SyslogAppender.build() to create&#160;Rfc5424Layout. &#160;So, if I don&apos;t specify &quot;mdcId&quot; attribute in &amp;lt;Syslog&amp;gt;&quot; config element, I get this exception:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;ERROR StatusLogger Could not create plugin of type class org.apache.logging.log4j.core.appender.SyslogAppender for element Syslog: java.lang.IllegalArgumentException: No structured id name was supplied java.lang.IllegalArgumentException: No structured id name was supplied at org.apache.logging.log4j.message.StructuredDataId.&amp;lt;init&amp;gt;(StructuredDataId.java:146) at org.apache.logging.log4j.message.StructuredDataId.&amp;lt;init&amp;gt;(StructuredDataId.java:130) at org.apache.logging.log4j.core.layout.Rfc5424Layout.&amp;lt;init&amp;gt;(Rfc5424Layout.java:142) at org.apache.logging.log4j.core.layout.Rfc5424Layout.createLayout(Rfc5424Layout.java:672) at org.apache.logging.log4j.core.appender.SyslogAppender$Builder.build(SyslogAppender.java:117) at org.apache.logging.log4j.core.appender.SyslogAppender$Builder.build(SyslogAppender.java:50)&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;2) Documentation doesn&apos;t mention mdcId of SyslogAppender at all: &lt;a href=&quot;https://logging.apache.org/log4j/2.x/manual/appenders.html#SyslogAppender&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://logging.apache.org/log4j/2.x/manual/appenders.html#SyslogAppender&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;If I build site locally with &quot;mvn site&quot; in 2.11.2, it&apos;s not there either.&lt;/p&gt;

&lt;p&gt;3) Commit&#160;ce1183629fe89625a77872c7153853e7774502a6 (&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-922&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/LOG4J2-922&lt;/a&gt;) which introduces default value for mdcId in Rfc5424Layout has this code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.mdcId = id == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? DEFAULT_MDCID : id; &#160; &#160; &#160; &#160; 
&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.mdcSdId = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StructuredDataId(mdcId, enterpriseNumber, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;While &quot;this.mdcId&quot; is set in first line, the argument (not class member) mdcId is used in the second line. &#160;Maybe argument mdcId should be used in the first line instead of &quot;id&quot;? &#160;Maybe this.mdcId should be used in the second line instead of argument mdcId? I&apos;m not familiar with the code enough to tell for sure, it just feels suspicious to me.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13240756">LOG4J2-2636</key>
            <summary>No default value for mdcId in SyslogAppender</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="4" iconUrl="https://issues.apache.org/jira/images/icons/statuses/reopened.png" description="This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.">Reopened</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="fgunbin">Filipp Gunbin</reporter>
                        <labels>
                    </labels>
                <created>Thu, 20 Jun 2019 23:59:20 +0000</created>
                <updated>Sat, 11 Dec 2021 16:37:06 +0000</updated>
                                            <version>2.11.2</version>
                                    <fixVersion>2.16.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16869510" author="garydgregory" created="Fri, 21 Jun 2019 14:08:40 +0000"  >&lt;p&gt;How about:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
diff --git a/log4j-core/src/main/java/org/apache/logging/log4j/core/layout/Rfc5424Layout.java b/log4j-core/src/main/java/org/apache/logging/log4j/core/layout/Rfc5424Layout.java
index f019e84..374e6a4 100644
--- a/log4j-core/src/main/java/org/apache/logging/log4j/core/layout/Rfc5424Layout.java
+++ b/log4j-core/src/main/java/org/apache/logging/log4j/core/layout/Rfc5424Layout.java
@@ -138,8 +138,8 @@
         &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.includeMdc = includeMDC;
         &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.includeNewLine = includeNL;
         &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.escapeNewLine = escapeNL == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; : Matcher.quoteReplacement(escapeNL);
-        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.mdcId = id == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? DEFAULT_MDCID : id;
-        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.mdcSdId = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StructuredDataId(mdcId, enterpriseNumber, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
+        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.mdcId = mdcId == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? DEFAULT_MDCID : mdcId;
+        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.mdcSdId = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StructuredDataId(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.mdcId, enterpriseNumber, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
         &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.mdcPrefix = mdcPrefix;
         &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.eventPrefix = eventPrefix;
         &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.appName = appName;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;?&lt;/p&gt;</comment>
                            <comment id="16869546" author="fgunbin" created="Fri, 21 Jun 2019 14:51:11 +0000"  >&lt;p&gt;Yes, that&apos;s what I meant about 3rd point, but I really don&apos;t know about syslog enough to be sure&lt;/p&gt;</comment>
                            <comment id="16869658" author="ralph.goers@dslextreme.com" created="Fri, 21 Jun 2019 16:37:02 +0000"  >&lt;p&gt;The suggested patch is wrong. The id field is the default structured data id for all structured data elements. The mdcId field is the id value for the mdc structured data element only. Normally these would be the same but they don&apos;t have to be. So the id value should be the default for the mdcId.&lt;/p&gt;

&lt;p&gt;the code really should be&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.mdcId = mdcId != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? mdcId : id == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? DEFAULT_MDCID : id;
&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.mdcSdId = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StructuredDataId(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.mdcId, enterpriseNumber, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16869668" author="fgunbin" created="Fri, 21 Jun 2019 16:44:06 +0000"  >&lt;p&gt;Makes sense.&lt;/p&gt;</comment>
                            <comment id="16870428" author="jira-bot" created="Sun, 23 Jun 2019 03:57:13 +0000"  >&lt;p&gt;Commit 7ac64f0dc3d02a8cb734828360d28aa16c31044b in logging-log4j2&apos;s branch refs/heads/release-2.x from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=7ac64f0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=7ac64f0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2636&quot; title=&quot;No default value for mdcId in SyslogAppender&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2636&quot;&gt;LOG4J2-2636&lt;/a&gt; - RFC5424Layout was not properly setting default Structured Element id for the MDC&lt;/p&gt;</comment>
                            <comment id="16870429" author="jira-bot" created="Sun, 23 Jun 2019 03:58:53 +0000"  >&lt;p&gt;Commit 2753fafb3d5735b5c3b2f87853f2ad7c07ecd0b4 in logging-log4j2&apos;s branch refs/heads/master from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=2753faf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=2753faf&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2636&quot; title=&quot;No default value for mdcId in SyslogAppender&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2636&quot;&gt;LOG4J2-2636&lt;/a&gt; - RFC5424Layout was not properly setting default Structured Element id for the MDC&lt;/p&gt;</comment>
                            <comment id="16870430" author="ralph.goers@dslextreme.com" created="Sun, 23 Jun 2019 03:59:27 +0000"  >&lt;p&gt;The patch has been applied. Please verify and close.&lt;/p&gt;</comment>
                            <comment id="16870432" author="jira-bot" created="Sun, 23 Jun 2019 04:03:54 +0000"  >&lt;p&gt;Commit 7163c2cc975e6f73b534f1e8c0ad7af25df99550 in logging-log4j2&apos;s branch refs/heads/release-2.x from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=7163c2c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=7163c2c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2636&quot; title=&quot;No default value for mdcId in SyslogAppender&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2636&quot;&gt;LOG4J2-2636&lt;/a&gt; - RFC5424Layout was not properly setting default Structured Element id for the MDC&lt;/p&gt;</comment>
                            <comment id="16870433" author="jira-bot" created="Sun, 23 Jun 2019 04:04:12 +0000"  >&lt;p&gt;Commit 69da5f43898275188ae8ea9e7777db43c6ec05a7 in logging-log4j2&apos;s branch refs/heads/master from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=69da5f4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=69da5f4&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2636&quot; title=&quot;No default value for mdcId in SyslogAppender&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2636&quot;&gt;LOG4J2-2636&lt;/a&gt; - RFC5424Layout was not properly setting default Structured Element id for the MDC&lt;/p&gt;</comment>
                            <comment id="16871744" author="fgunbin" created="Mon, 24 Jun 2019 20:00:22 +0000"  >&lt;p&gt;Thanks. Wouldn&apos;t it be more consistent to also add default value in SyslogAppender? (point 1 in description).&lt;br/&gt;
Also, doc amendment would also be needed (point 2).&lt;br/&gt;
And, shouldn&apos;t these fixes also go to release-2.x? (I don&apos;t know the policy about branches in the project)&lt;br/&gt;
Reopening due to these comments.&lt;/p&gt;</comment>
                            <comment id="16871750" author="ralph.goers@dslextreme.com" created="Mon, 24 Jun 2019 20:10:32 +0000"  >&lt;ol&gt;
	&lt;li&gt;I see no reason to put the same logic in SyslogAppender as it just passes whatever values it got to the layout.&#160;&lt;/li&gt;
	&lt;li&gt;Yes, the documentation of the appender should mention mdcId.&lt;/li&gt;
	&lt;li&gt;The change was applied to both the master and release-2.x branches.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="16872290" author="fgunbin" created="Tue, 25 Jun 2019 11:44:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rgoers&quot; class=&quot;user-hover&quot; rel=&quot;rgoers&quot;&gt;rgoers&lt;/a&gt;&lt;br/&gt;
1) AFAICT, if we provide xml config for layout, mdcId will get default value. If we provide xml config for SyslogAppender, yes it will pass the value to layout, but without default. This is what I meant. I think it would be consistent to provide same default no matter how the component is created via xml config. I may be missing something, tho.&lt;br/&gt;
3) Thanks.&lt;/p&gt;</comment>
                            <comment id="16875613" author="ralph.goers@dslextreme.com" created="Sat, 29 Jun 2019 22:59:56 +0000"  >&lt;p&gt;I don&apos;t understand. If you don&apos;t provide a value for the Layout it will get a default value provided by the Layout. If you don&apos;t provide a value for the SyslogAppender it will get the default value provided by the Layout.&#160; What is the problem with that? In both cases it will get the same default value.&lt;/p&gt;</comment>
                            <comment id="16876142" author="fgunbin" created="Mon, 1 Jul 2019 12:12:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rgoers&quot; class=&quot;user-hover&quot; rel=&quot;rgoers&quot;&gt;rgoers&lt;/a&gt; Yes, I see, but maybe then we don&apos;t need default in Rfc5424Layout.java?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; Rfc5424Layout createLayout(
...
    @PluginAttribute(value = &lt;span class=&quot;code-quote&quot;&gt;&quot;mdcId&quot;&lt;/span&gt;, defaultString = DEFAULT_MDCID) &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; mdcId,
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So the default will always be given explicitly in Rfc5424Layout constructor.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12761972">LOG4J2-922</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 20 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z03yj4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>