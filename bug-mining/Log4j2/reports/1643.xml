<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:43:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-3624] NoClassDefFoundError initializing PropertiesUtil in Servlet 2.5 container</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-3624</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;The configuration I have in Tomcat 8 and Java 1.8 with the Servlet 2.5 style initialization works in 2.17.2, but breaks in 2.18.0 (and 2.19.0) with the following exception:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[localhost-startStop-1] Error configuring application listener of class org.apache.logging.log4j.web.Log4jServletContextListener
java.lang.NoClassDefFoundError: Could not initialize class org.apache.logging.log4j.util.PropertiesUtil
at org.apache.logging.log4j.status.StatusLogger.&amp;lt;clinit&amp;gt;(StatusLogger.java:78)
at org.apache.logging.log4j.web.Log4jServletContextListener.&amp;lt;clinit&amp;gt;(Log4jServletContextListener.java:44)
at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
&#8230;
at org.apache.catalina.core.StandardContext.listenerStart(StandardContext.java:4822)
&#8230;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;With log4j 2.17.2, there is no exception and &lt;tt&gt;Log4jServletFilter&lt;/tt&gt; initializes fine.&#160;&lt;/p&gt;

&lt;p&gt;I traced class loading during the web application initialization.&lt;/p&gt;

&lt;p&gt;With 2.18.0, the following classes are loaded:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;log4j.web.Log4jServletContainerInitializer log4j-web-2.18.0.jar&lt;/li&gt;
	&lt;li&gt;log4j.Logger log4j-api-2.18.0.jar&lt;/li&gt;
	&lt;li&gt;log4j.web.Log4jServletContextListener log4j-api-2.18.0.jar&lt;/li&gt;
	&lt;li&gt;log4j.web.Log4jWebSupport log4j-web-2.18.0.jar&lt;/li&gt;
	&lt;li&gt;log4j.core.LifeCycle log4j-core-2.18.0.jar&lt;/li&gt;
	&lt;li&gt;log4j.web.Log4jWebLifeCycle log4j-web-2.18.0.jar&lt;/li&gt;
	&lt;li&gt;com.ofc.data.server.MyBatisConfiguratingContextListener from classes&lt;/li&gt;
	&lt;li&gt;com.ofc.data.server.CleanupContextListener from classes&lt;/li&gt;
	&lt;li&gt;log4j.web.Log4jServletFilter log4j-web-2.18.0.jar&lt;/li&gt;
	&lt;li&gt;&#8230; other classes&lt;/li&gt;
	&lt;li&gt;log4j.spi.ExtendedLogger&lt;/li&gt;
	&lt;li&gt;log4j&#8230;&lt;/li&gt;
	&lt;li&gt;log4j.message.ParameterizedMessageFactory&lt;/li&gt;
	&lt;li&gt;log4j.util.Constants&lt;/li&gt;
	&lt;li&gt;log4j.util.PropertiesUtil&lt;/li&gt;
	&lt;li&gt;log4j.util.PropertySource&lt;/li&gt;
	&lt;li&gt;&#8230;&lt;/li&gt;
	&lt;li&gt;log4j.PropertySource$Comparator&lt;/li&gt;
	&lt;li&gt;log4j.util.BiConsumer&lt;/li&gt;
	&lt;li&gt;log4j.util.PropertiesUtil$Environment(Lambda)&#8230;&lt;/li&gt;
	&lt;li&gt;log4j.util.ServiceLoaderUtil&lt;/li&gt;
	&lt;li&gt;log4j.util.ServiceLoaderUtil.$ServiceLoaderSpliterator&lt;/li&gt;
	&lt;li&gt;java.util.ServiceConfigurationError&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;http://localhost:1313/ox-hugo/workspaces_EoJKh3w7hm_2022-10-27_15-56-03.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;With 2.17.2, it goes like this:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;log4j.web.Log4jServletContainerInitializer log4j-web-2.17.2.jar&lt;/li&gt;
	&lt;li&gt;log4j.Logger log4j-api-2.17.2.jar&lt;/li&gt;
	&lt;li&gt;log4j.web.Log4jServletContextListener log4j-api-2.17.2.jar&lt;/li&gt;
	&lt;li&gt;log4j.web.Log4jWebSupport log4j-web-2.17.2.jar&lt;/li&gt;
	&lt;li&gt;log4j.core.LifeCycle log4j-core-2.17.2.jar&lt;/li&gt;
	&lt;li&gt;log4j.web.Log4jWebLifeCycle log4j-web-2.17.2.jar&lt;/li&gt;
	&lt;li&gt;com.ofc.data.server.MyBatisConfiguratingContextListener from classes&lt;/li&gt;
	&lt;li&gt;com.ofc.data.server.CleanupContextListener from classes&lt;/li&gt;
	&lt;li&gt;log4j.web.Log4jServletFilter log4j-web-2.17.2.jar&lt;/li&gt;
	&lt;li&gt;&#8230; other classes&lt;/li&gt;
	&lt;li&gt;org.apache.tomcat.jdbc.pool.Validator&lt;/li&gt;
	&lt;li&gt;log4j.spi.ExtendedLogger&lt;/li&gt;
	&lt;li&gt;log4j&#8230;&lt;/li&gt;
	&lt;li&gt;log4j.message.ParameterizedMessageFactory&lt;/li&gt;
	&lt;li&gt;log4j.util.Constants&lt;/li&gt;
	&lt;li&gt;log4j.util.PropertiesUtil&lt;/li&gt;
	&lt;li&gt;log4j.util.PropertySource&lt;/li&gt;
	&lt;li&gt;&#8230;&lt;/li&gt;
	&lt;li&gt;log4j.PropertySource$Comparator&lt;/li&gt;
	&lt;li&gt;log4j.util.BiConsumer&lt;/li&gt;
	&lt;li&gt;log4j.util.PropertiesUtil$Environment&amp;#40;Lambda&amp;#41;&#8230;&lt;/li&gt;
	&lt;li&gt;java.lang.invoke.LambdaForm$&#8230;&lt;/li&gt;
	&lt;li&gt;log4j.util.EnvironmentPropertySource&lt;/li&gt;
	&lt;li&gt;log4j.util.SystemPropertiesPropertySource&lt;/li&gt;
	&lt;li&gt;log4j.util.PropertiesUtil.$Environment$$Lambda&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;http://localhost:1313/ox-hugo/workspaces_vBkgFs3RKy_2022-10-27_15-50-13.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;In 2.8.0, log4j.util.PropertiesUtil.$Environment$$Lambda is loaded but not invoked.&lt;/p&gt;

&lt;p&gt;It looks like there are recent changes in log4j.util.PropertiesUtil.$Environment in commits aaf13561e7 Piotr Karwasz 2022-03-10, 262828b193 2022-04-13. These are changes for &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3427&quot; title=&quot;ServiceLoader usage in a servlet environment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3427&quot;&gt;&lt;del&gt;LOG4J2-3427&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment>&lt;p&gt;Apache Tomcat/8.53&lt;/p&gt;

&lt;p&gt;Linux 4.14.1294-220.533.amzn2&lt;/p&gt;

&lt;p&gt;amd64&lt;/p&gt;

&lt;p&gt;JVM 1.8.0_3420-b07, Red Hat. Inc&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</environment>
        <key id="13492601">LOG4J2-3624</key>
            <summary>NoClassDefFoundError initializing PropertiesUtil in Servlet 2.5 container</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="nsushkin@openfinance.com">Nicholas Sushkin</reporter>
                        <labels>
                    </labels>
                <created>Thu, 27 Oct 2022 21:37:28 +0000</created>
                <updated>Wed, 12 Feb 2025 22:26:06 +0000</updated>
                            <resolved>Mon, 6 Jan 2025 12:48:03 +0000</resolved>
                                    <version>2.18.0</version>
                                    <fixVersion>2.23.0</fixVersion>
                                    <component>API</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17625348" author="pkarwasz" created="Thu, 27 Oct 2022 22:19:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nsushkin%40openfinance.com&quot; class=&quot;user-hover&quot; rel=&quot;nsushkin@openfinance.com&quot;&gt;nsushkin@openfinance.com&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Don&apos;t you have the cause of the &lt;tt&gt;NoClassDefFoundError&lt;/tt&gt; in your logs?&lt;/p&gt;</comment>
                            <comment id="17625398" author="nsushkin@openfinance.com" created="Fri, 28 Oct 2022 02:59:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pkarwasz&quot; class=&quot;user-hover&quot; rel=&quot;pkarwasz&quot;&gt;pkarwasz&lt;/a&gt; not sure. Either there is no cause or the cause is not being printed. Here&apos;s what I see:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13051530/13051530_image-2022-10-27-22-59-18-736.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="17654008" author="ralph.goers@dslextreme.com" created="Tue, 3 Jan 2023 13:45:44 +0000"  >&lt;p&gt;This looks to me like some Exception is being thrown in the PropertiesUtil constructor - probably in the constructor for the Environment. We should add a try/catch in there to log the exception.&lt;/p&gt;</comment>
                            <comment id="17654014" author="pkarwasz" created="Tue, 3 Jan 2023 13:57:20 +0000"  >&lt;p&gt;If I had to guess it fails just after the &lt;tt&gt;ServiceLoaderUtil#loadServices&lt;/tt&gt;: I encountered some situations, when the Java 9 version of &lt;tt&gt;ServiceLoaderUtil&lt;/tt&gt; returns a stream that throws exceptions (it uses the original &lt;tt&gt;ServiceLoader#stream&lt;/tt&gt; method). I removed the Java 9 version of the class in:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/logging-log4j2/commit/9877f246a9fabf656b5a2c0d9794e303b7bd099f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/logging-log4j2/commit/9877f246a9fabf656b5a2c0d9794e303b7bd099f&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nsushkin%40openfinance.com&quot; class=&quot;user-hover&quot; rel=&quot;nsushkin@openfinance.com&quot;&gt;nsushkin@openfinance.com&lt;/a&gt;: can you check if the problem persists in the newest &lt;tt&gt;2.19.1-SNAPSHOT&lt;/tt&gt;?&lt;/p&gt;</comment>
                            <comment id="17654685" author="nsushkin@openfinance.com" created="Thu, 5 Jan 2023 00:00:33 +0000"  >&lt;p&gt;Hi, Piotr,&lt;/p&gt;

&lt;p&gt;Thanks for taking a look at it. I tried the latest snapshot and I am still getting the same error. Did you change make it to the -67 snapshot?&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13054334/13054334_image-2023-01-04-18-53-27-006.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="17685494" author="pkarwasz" created="Tue, 7 Feb 2023 22:22:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nsushkin%40openfinance.com&quot; class=&quot;user-hover&quot; rel=&quot;nsushkin@openfinance.com&quot;&gt;nsushkin@openfinance.com&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;I still can&apos;t reproduce your issue in a clean Tomcat environment. I can only reproduce it if:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&#160;the web application is bundled with an old OSGI API (fixed in &lt;a href=&quot;https://github.com/apache/logging-log4j2/pull/1165&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;#1165&lt;/a&gt;)&lt;/li&gt;
	&lt;li&gt;I add a partial Log4j2 installation to Tomcat&apos;s common classloader (e.g. just `log4j-spring-boot`, fixed in &lt;a href=&quot;https://github.com/apache/logging-log4j2/pull/1263&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;#1263&lt;/a&gt;)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The fixes for those situations are already merged and available in the latest snapshot. Can you check if they fix your problem?&lt;/p&gt;</comment>
                            <comment id="17910176" author="pkarwasz" created="Mon, 6 Jan 2025 12:48:03 +0000"  >&lt;p&gt;&lt;tt&gt;StatusLogger&lt;/tt&gt; has been rewritten in version &lt;tt&gt;2.23.0&lt;/tt&gt; not to depend on &lt;tt&gt;PropertiesUtil&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;This should solve this problem.&lt;/p&gt;</comment>
                            <comment id="17926577" author="nsushkin@openfinance.com" created="Wed, 12 Feb 2025 20:48:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pkarwasz&quot; class=&quot;user-hover&quot; rel=&quot;pkarwasz&quot;&gt;pkarwasz&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Confirming the issue is resolved. I checked the latest log4j, 2.24.3, and it worked in my environment.&lt;/p&gt;

&lt;p&gt;Thank you so much for seeing this through to the resolution!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13051530" name="image-2022-10-27-22-59-18-736.png" size="316413" author="nsushkin@openfinance.com" created="Fri, 28 Oct 2022 02:59:20 +0000"/>
                            <attachment id="13054334" name="image-2023-01-04-18-53-27-006.png" size="347425" author="nsushkin@openfinance.com" created="Wed, 4 Jan 2023 23:53:28 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            38 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1ag20:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>