<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:40:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-2602] Same file is overwritten on rollover which causes logs loss</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-2602</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;In our log4j configuration we use&#160;SizeBasedTriggeringPolicy and&#160;DefaultRolloverStrategy(max&amp;gt;1) :&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Appenders&amp;gt;&lt;/span&gt;
        &amp;lt;RollingRandomAccessFile name=&lt;span class=&quot;code-quote&quot;&gt;&quot;file&quot;&lt;/span&gt; fileName=&lt;span class=&quot;code-quote&quot;&gt;&quot;log/server.log&quot;&lt;/span&gt;
                                 filePattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;log/server-%d{yyyy-MM-dd&lt;span class=&quot;code-quote&quot;&gt;&apos;T&apos;&lt;/span&gt;HH-mm-ss}.log.gz&quot;&lt;/span&gt;&amp;gt;
            &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;PatternLayout&amp;gt;&lt;/span&gt;
                &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;pattern&amp;gt;&lt;/span&gt;%level{length=1} %date{MMdd-HHmm:ss,SSS} %logger{1.} %message %X
                    [%thread]%n
                &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/pattern&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/PatternLayout&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Policies&amp;gt;&lt;/span&gt;
                &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;OnStartupTriggeringPolicy/&amp;gt;&lt;/span&gt;
                &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;SizeBasedTriggeringPolicy size=&lt;span class=&quot;code-quote&quot;&gt;&quot;10 MB&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Policies&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;DefaultRolloverStrategy max=&lt;span class=&quot;code-quote&quot;&gt;&quot;2000&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/RollingRandomAccessFile&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Appenders&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;After upgrading to log4j-core 2.11.2 we have noticed that after rollover insttead of creating new files same file&#160;gets&#160;overwritten.&lt;/p&gt;

&lt;p&gt;Looks like the issue is that&lt;/p&gt;

&lt;p&gt;org.apache.logging.log4j.core.appender.rolling.&lt;b&gt;PatternProcessor&lt;/b&gt;#formatFileName gives same filename for rollover, and the difference between &lt;b&gt;2.11.1&lt;/b&gt; version is that field &quot;prevFileTime&quot; never reseted after first time*:*&lt;/p&gt;

&lt;p&gt;&lt;b&gt;2.11.2&#160;org.apache.logging.log4j.core.appender.rolling.PatternProcessor#updateTime&lt;/b&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void updateTime() {
 &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (nextFileTime != 0) {
 prevFileTime = nextFileTime;
}
 }

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;it was always reseted in 2.11.1&lt;/p&gt;

&lt;p&gt;&lt;b&gt;2.11.1&#160;org.apache.logging.log4j.core.appender.rolling.PatternProcessor#updateTime&lt;/b&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void updateTime() {
 prevFileTime = nextFileTime;
}

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;so the same time(&lt;b&gt;prevFileTime&lt;/b&gt;)&#160;will be always used to form the filename for rollover&lt;/p&gt;

&lt;p&gt;&lt;b&gt;org.apache.logging.log4j.core.appender.rolling.PatternProcessor#formatFileName(org.apache.logging.log4j.core.lookup.StrSubstitutor, java.lang.StringBuilder, boolean, java.lang.Object)&lt;/b&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; time = useCurrentTime ? currentFileTime != 0 ? currentFileTime : &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis() :
 prevFileTime != 0 ? prevFileTime : &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis();

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13232091">LOG4J2-2602</key>
            <summary>Same file is overwritten on rollover which causes logs loss</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="Vitaliy">Vitaliy MAtuzko</reporter>
                        <labels>
                    </labels>
                <created>Tue, 7 May 2019 20:14:18 +0000</created>
                <updated>Tue, 6 Aug 2019 04:23:01 +0000</updated>
                            <resolved>Sun, 12 May 2019 22:38:03 +0000</resolved>
                                    <version>2.11.2</version>
                                    <fixVersion>2.12.0</fixVersion>
                                    <component>Appenders</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16838001" author="ralph.goers@dslextreme.com" created="Sun, 12 May 2019 05:08:13 +0000"  >&lt;p&gt;The documentation for size-based triggering policy says &quot;The file pattern must contain a&#160;&lt;tt&gt;%i&lt;/tt&gt;&#160;otherwise the target file will be overwritten on every rollover as the SizeBased Triggering Policy does not cause the timestamp value in the file name to change.&quot; This sentence was added in 2.11.2.&#160; As I recall the problem is that when the size-based appender is combined with a time-based appender a trigger driven from the size-based appender should just increment the counter and not cause the time to change. Changing the time in that case screws up the time-based appender.&#160;&lt;/p&gt;

&lt;p&gt;It may be possible to preserve the behavior you want if it is detected that only the size-based appender is present. I will have to check into that. But simply reverting that change is out of the question as it was necessary to fix a bunch of bugs in the time-based appenders.&lt;/p&gt;</comment>
                            <comment id="16838182" author="jira-bot" created="Sun, 12 May 2019 22:35:45 +0000"  >&lt;p&gt;Commit 56816509933d1155759a08bd1d2ade31e22613e9 in logging-log4j2&apos;s branch refs/heads/release-2.x from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=5681650&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=5681650&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2602&quot; title=&quot;Same file is overwritten on rollover which causes logs loss&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2602&quot;&gt;&lt;del&gt;LOG4J2-2602&lt;/del&gt;&lt;/a&gt; - Update file time when size based triggering policy is used without a time-based triggering policy&lt;/p&gt;</comment>
                            <comment id="16838183" author="jira-bot" created="Sun, 12 May 2019 22:36:05 +0000"  >&lt;p&gt;Commit 619707edd57fd6f562ea154d1eac56708b6634e2 in logging-log4j2&apos;s branch refs/heads/master from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=619707e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=619707e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2602&quot; title=&quot;Same file is overwritten on rollover which causes logs loss&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2602&quot;&gt;&lt;del&gt;LOG4J2-2602&lt;/del&gt;&lt;/a&gt; - Update file time when size based triggering policy is used without a time-based triggering policy&lt;/p&gt;</comment>
                            <comment id="16838184" author="ralph.goers@dslextreme.com" created="Sun, 12 May 2019 22:38:03 +0000"  >&lt;p&gt;Fixed in release-2.x and master. Please verify and close.&lt;/p&gt;</comment>
                            <comment id="16839179" author="vitaliy" created="Tue, 14 May 2019 07:45:41 +0000"  >&lt;p&gt;Verified, fixed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 27 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z02h7s:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>