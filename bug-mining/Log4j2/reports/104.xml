<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:31:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-246] UDP socket Appender error</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-246</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;On 2013/05/09, at 18:34, Tomek Kaczynski &amp;lt;tomek.kaczynski@gmail.com&amp;gt; wrote:&lt;/p&gt;

&lt;p&gt;Hi All,&lt;/p&gt;

&lt;p&gt;   I&apos;m using log4j2 since beta4, now beta5. In general it&apos;s a cute library, but there&apos;s some bug that I&apos;ve found out recently :&lt;/p&gt;

&lt;p&gt;   When a client code genreates a huge message ( 64k ), the underlying DatagramOutputStream fails ( UDP socket throws exception).&lt;/p&gt;

&lt;p&gt;  After that all following flushes fail because data buffer is not cleared upon exception.&lt;/p&gt;

&lt;p&gt; So in lines&lt;/p&gt;

&lt;p&gt;DatagramOutputStream:91&lt;br/&gt;
----------------------------------------------------------------------&lt;br/&gt;
    public synchronized void flush() throws IOException {&lt;br/&gt;
        if (this.data != null &amp;amp;&amp;amp; this.ds != null &amp;amp;&amp;amp; this.address != null) &lt;/p&gt;
{
            final DatagramPacket packet = new DatagramPacket(data, data.length, address, port);
            ds.send(packet);
        }
&lt;p&gt;        data = null;&lt;br/&gt;
    }&lt;/p&gt;

&lt;p&gt;--------------------------------------------------------------------------&lt;/p&gt;

&lt;p&gt;data = null should be put in finally block or some simillar solution could be applied.&lt;/p&gt;

&lt;p&gt;What do you think ?&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Tomek&lt;/p&gt;

&lt;p&gt;Moreover DatagramOutputStream should check if message size is less then 64k .&lt;/p&gt;</description>
                <environment></environment>
        <key id="12646776">LOG4J2-246</key>
            <summary>UDP socket Appender error</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rpopma">Remko Popma</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 May 2013 09:42:56 +0000</created>
                <updated>Wed, 29 May 2013 15:05:20 +0000</updated>
                            <resolved>Wed, 29 May 2013 05:56:59 +0000</resolved>
                                    <version>2.0-beta5</version>
                                    <fixVersion>2.0-beta7</fixVersion>
                                    <component>Appenders</component>
                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13653117" author="garydgregory" created="Thu, 9 May 2013 20:04:46 +0000"  >&lt;p&gt;I have refactored some TCP socket tests in order to test this issue. We now have an abstract test class with subclasses for TCP and UDP.&lt;/p&gt;

&lt;p&gt;The problem is that there are some odd errors in the new UDP tests that are @Ignore for now. &lt;/p&gt;

&lt;p&gt;From the debugger I see one log event properly marshaled and marshaled but for a second I get an exception.&lt;/p&gt;

&lt;p&gt;From Eclipse, running the test org.apache.logging.log4j.core.net.UDPSocketServerTest, I get:&lt;/p&gt;

&lt;p&gt;java.io.StreamCorruptedException: invalid stream header: 7372003E&lt;br/&gt;
	at java.io.ObjectInputStream.readStreamHeader(Unknown Source)&lt;br/&gt;
	at java.io.ObjectInputStream.&amp;lt;init&amp;gt;(Unknown Source)&lt;br/&gt;
	at org.apache.logging.log4j.core.net.UDPSocketServer$DatagramPacketHandler.&amp;lt;init&amp;gt;(UDPSocketServer.java:167)&lt;br/&gt;
	at org.apache.logging.log4j.core.net.UDPSocketServer.run(UDPSocketServer.java:140)&lt;br/&gt;
	at java.lang.Thread.run(Unknown Source)&lt;br/&gt;
Exception encountered on accept. Ignoring. Stack Trace :&lt;/p&gt;


&lt;p&gt;For these I am seeking help.&lt;/p&gt;

&lt;p&gt;See: &lt;/p&gt;

&lt;p&gt;commit -m &quot;Testing &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-246&quot; title=&quot;UDP socket Appender error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-246&quot;&gt;&lt;del&gt;LOG4J2-246&lt;/del&gt;&lt;/a&gt;: UDP socket Appender error. Needing help with UDPSocketServerTest, it is @Ignored for now.&quot; C:/svn/org/apache/log4j2/trunk/core/src/test/java/org/apache/logging/log4j/core/net/UDPSocketServerTest.java C:/svn/org/apache/log4j2/trunk/core/src/test/java/org/apache/logging/log4j/core/net/TCPSocketServerTest.java C:/svn/org/apache/log4j2/trunk/core/src/test/java/org/apache/logging/log4j/core/net/SocketServerTest.java C:/svn/org/apache/log4j2/trunk/core/src/test/java/org/apache/logging/log4j/core/net/UDPSocketServer.java C:/svn/org/apache/log4j2/trunk/core/src/test/java/org/apache/logging/log4j/core/net/AbstractSocketServerTest.java&lt;br/&gt;
    Adding         C:/svn/org/apache/log4j2/trunk/core/src/test/java/org/apache/logging/log4j/core/net/AbstractSocketServerTest.java&lt;br/&gt;
    Deleting       C:/svn/org/apache/log4j2/trunk/core/src/test/java/org/apache/logging/log4j/core/net/SocketServerTest.java&lt;br/&gt;
    Adding         C:/svn/org/apache/log4j2/trunk/core/src/test/java/org/apache/logging/log4j/core/net/TCPSocketServerTest.java&lt;br/&gt;
    Adding         C:/svn/org/apache/log4j2/trunk/core/src/test/java/org/apache/logging/log4j/core/net/UDPSocketServer.java&lt;br/&gt;
    Adding         C:/svn/org/apache/log4j2/trunk/core/src/test/java/org/apache/logging/log4j/core/net/UDPSocketServerTest.java&lt;br/&gt;
    Transmitting file data ...&lt;br/&gt;
    Committed revision 1480747.&lt;/p&gt;
</comment>
                            <comment id="13655818" author="remkop@yahoo.com" created="Mon, 13 May 2013 07:27:33 +0000"  >&lt;p&gt;Gary, the unit test problem (2nd event serialization fails) sounds familiar: &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-228&quot; title=&quot; Log4j2 UDP socket configure error. Class not found org.apache.logging.log4j.core.impl.Log4jLogEvent$LogEventProxy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-228&quot;&gt;&lt;del&gt;LOG4J2-228&lt;/del&gt;&lt;/a&gt; is also caused by a stream header issue.&lt;/p&gt;</comment>
                            <comment id="13657039" author="garydgregory" created="Tue, 14 May 2013 13:07:16 +0000"  >&lt;p&gt;Note that the header issue I see in the @Ignore test is affected by a timing factor. It does not always happen from the debugger.&lt;/p&gt;</comment>
                            <comment id="13669023" author="ralph.goers@dslextreme.com" created="Wed, 29 May 2013 05:56:59 +0000"  >&lt;p&gt;Fix committed in revision 1487289. Please verify and close.&lt;/p&gt;</comment>
                            <comment id="13669157" author="garydgregory" created="Wed, 29 May 2013 11:23:24 +0000"  >&lt;p&gt;Q: org.apache.logging.log4j.core.appender.AbstractAppender.error(String, LogEvent, Throwable) looks the same as org.apache.logging.log4j.core.appender.AbstractAppender.error(String, Throwable)&lt;/p&gt;

&lt;p&gt;Is that on purpose or the the LogEvent unused by mistake? Should it be logged? Should it be saved in the exception? &lt;/p&gt;

&lt;p&gt;With the code as is, there seems to be an opportunity for refactoring common code.&lt;/p&gt;</comment>
                            <comment id="13669267" author="ralph.goers@dslextreme.com" created="Wed, 29 May 2013 14:04:28 +0000"  >&lt;p&gt;Are we looking at the same code? AbstractAppender.error(String, LogEvent, Throwable) and AbstractAppender.error(String, Throwable) are not the same and the LogEvent parameter is not unused. They call different ErrorHandler methods - one takes the LogEvent and one does not. It just so happens that both those methods perform the same action but they aren&apos;t required to.&lt;/p&gt;</comment>
                            <comment id="13669277" author="garydgregory" created="Wed, 29 May 2013 14:11:32 +0000"  >&lt;p&gt;Arg, please accept my apologies, I meant &lt;tt&gt;org.apache.logging.log4j.core.appender.DefaultErrorHandler&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="13669294" author="ralph.goers@dslextreme.com" created="Wed, 29 May 2013 14:29:21 +0000"  >&lt;p&gt;OK. I don&apos;t think this Jira issue is the correct place to discuss enhancements to DefaultErrorHandler.&lt;/p&gt;</comment>
                            <comment id="13669330" author="garydgregory" created="Wed, 29 May 2013 15:05:20 +0000"  >&lt;p&gt;OK, started a thread on the ML.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12645219">LOG4J2-228</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>327134</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 26 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1kfzj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>327478</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>