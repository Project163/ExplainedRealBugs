<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:42:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-3304] SpringEnvironmentHolder getEnvironment always return null</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-3304</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;I am using SpringLookup and SpringProfileArbiter for conditional configuration,&#160; but it doesn&apos;t work. I debugged into SpringEnvironmentHolder and found that the getEnvironment method always returns null. Then I found the root cause is that when the factoryClassName is present and load successfully, the LogManagerStatus is not set in the static block of LogManager. It could be a bug, please take a look&lt;/p&gt;</description>
                <environment></environment>
        <key id="13420051">LOG4J2-3304</key>
            <summary>SpringEnvironmentHolder getEnvironment always return null</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="Francis_FY">francis</reporter>
                        <labels>
                    </labels>
                <created>Thu, 30 Dec 2021 14:38:59 +0000</created>
                <updated>Mon, 21 Feb 2022 03:25:20 +0000</updated>
                            <resolved>Mon, 21 Feb 2022 03:25:20 +0000</resolved>
                                    <version>2.17.1</version>
                                    <fixVersion>2.17.2</fixVersion>
                                    <component>API</component>
                    <component>Spring</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17466916" author="JIRAUSER281512" created="Thu, 30 Dec 2021 15:22:18 +0000"  >&lt;p&gt;I&apos;ve made a fix for this issue (&lt;a href=&quot;https://github.com/apache/logging-log4j2/pull/676&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/logging-log4j2/pull/676&lt;/a&gt;), If this is indeed a bug and the fix works, please review and merge it.&#160;&#160;&lt;/p&gt;</comment>
                            <comment id="17466929" author="ralph.goers@dslextreme.com" created="Thu, 30 Dec 2021 16:15:49 +0000"  >&lt;p&gt;I&apos;ve looked at the PR but I don&apos;t understand how it has anything to do with SpringEnvironmentHolder.getEnvironment() returning null.&lt;/p&gt;

&lt;p&gt;What version of Spring Boot are you using?&#160; Spring Boot 2.6 has made changes that we have not tested yet.&lt;/p&gt;

&lt;p&gt;It might also be helpful to have a sample app that demonstrates the problem.&lt;/p&gt;</comment>
                            <comment id="17466944" author="JIRAUSER281512" created="Thu, 30 Dec 2021 17:08:27 +0000"  >&lt;p&gt;I am using SpringBoot 2.1.1.RELEASE.&#160; &#160; &lt;font color=&quot;#172b4d&quot;&gt;LogManagerStatus.isInitialized() return false because LogManagerStatus.&lt;/font&gt;setInitialized is not called when the property log4j2.loggerContextFactory is present and load successfully, &#160;in the static block of LogManager.&lt;font color=&quot;#172b4d&quot;&gt; so the method getEnvironment will never execute the if block and the variable `environment` will always &#160;be null&lt;/font&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; Environment getEnvironment() {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (environment == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; LogManagerStatus.isInitialized() &amp;amp;&amp;amp; LogManager.getFactory() != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp;
            LogManager.getFactory().hasContext(SpringEnvironmentHolder.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;getName(), &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)) {
        lock.lock();
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (environment == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; obj = LogManager.getContext(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;).getObject(Log4j2CloudConfigLoggingSystem.ENVIRONMENT_KEY);
                environment = obj &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; Environment ? (Environment) obj : &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
            }
        } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
            lock.unlock();
        }
    }
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; environment;
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17466955" author="JIRAUSER281512" created="Thu, 30 Dec 2021 18:01:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rgoers&quot; class=&quot;user-hover&quot; rel=&quot;rgoers&quot;&gt;rgoers&lt;/a&gt;&#160; I created a sample application. &#160;&lt;a href=&quot;https://github.com/Francis-FY/log4j-springboot&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/Francis-FY/log4j-springboot&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17466979" author="ralph.goers@dslextreme.com" created="Thu, 30 Dec 2021 19:45:35 +0000"  >&lt;p&gt;OK. That explains it. I configure my Spring Boot apps by adding the following to bootstrap.yml&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
spring:
  application:
    name: my-app
  cloud:
    config:
      uri: https:&lt;span class=&quot;code-comment&quot;&gt;//spring-configuration-server.lab.apache.org
&lt;/span&gt;      username: someuser
      password: somepwd

logging:
 &#160; config: ${spring.cloud.config.uri}/${spring.application.name}/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/master/log4j2.xml?override=${spring.cloud.config.uri}/${spring.application.name}/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/master/log4j2-${spring.application.name}-dev.xml
   auth: 
     username: ${spring.cloud.config.username} 
     password: ${spring.cloud.config.password} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So I don&apos;t configure spring boot apps using the system property.&#160;&lt;/p&gt;

&lt;p&gt;I will take a look at this.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17495104" author="ralph.goers@dslextreme.com" created="Sun, 20 Feb 2022 08:46:12 +0000"  >&lt;p&gt;This patch will cause LogManager to be set to initialized even if no providers could be located. I believe setInitialized needs to also be called in an else block to fix this.&lt;/p&gt;</comment>
                            <comment id="17495244" author="jira-bot" created="Sun, 20 Feb 2022 22:26:06 +0000"  >&lt;p&gt;Commit 8e89ecd4a94e2f600423564c8381f8a0f9b12fe6 in logging-log4j2&apos;s branch refs/heads/release-2.x from Francis&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=8e89ecd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=8e89ecd&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3304&quot; title=&quot;SpringEnvironmentHolder getEnvironment always return null&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3304&quot;&gt;&lt;del&gt;LOG4J2-3304&lt;/del&gt;&lt;/a&gt; - Fix issue that the initialize status of LogManager is not set when factoryClassName is present and instantiate successfully (#676)&lt;/p&gt;
</comment>
                            <comment id="17495246" author="jira-bot" created="Sun, 20 Feb 2022 22:31:43 +0000"  >&lt;p&gt;Commit ef178a272235615f161c4e75faa4f3d947547681 in logging-log4j2&apos;s branch refs/heads/release-2.x from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=ef178a2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=ef178a2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3304&quot; title=&quot;SpringEnvironmentHolder getEnvironment always return null&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3304&quot;&gt;&lt;del&gt;LOG4J2-3304&lt;/del&gt;&lt;/a&gt; - Create test that verifies this fix&lt;/p&gt;</comment>
                            <comment id="17495247" author="jira-bot" created="Sun, 20 Feb 2022 22:31:44 +0000"  >&lt;p&gt;Commit d6c8ab0863c551cdf0f8a5b1966ab45e3cddf572 in logging-log4j2&apos;s branch refs/heads/release-2.x from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=d6c8ab0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=d6c8ab0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3304&quot; title=&quot;SpringEnvironmentHolder getEnvironment always return null&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3304&quot;&gt;&lt;del&gt;LOG4J2-3304&lt;/del&gt;&lt;/a&gt; - Mark LogManager as initialized when a LoggerFactory is specified&lt;/p&gt;</comment>
                            <comment id="17495265" author="jira-bot" created="Mon, 21 Feb 2022 00:55:47 +0000"  >&lt;p&gt;Commit 8e89ecd4a94e2f600423564c8381f8a0f9b12fe6 in logging-log4j2&apos;s branch refs/heads/dependabot/maven/org.apache.felix-maven-bundle-plugin-5.1.4 from Francis&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=8e89ecd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=8e89ecd&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3304&quot; title=&quot;SpringEnvironmentHolder getEnvironment always return null&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3304&quot;&gt;&lt;del&gt;LOG4J2-3304&lt;/del&gt;&lt;/a&gt; - Fix issue that the initialize status of LogManager is not set when factoryClassName is present and instantiate successfully (#676)&lt;/p&gt;
</comment>
                            <comment id="17495266" author="jira-bot" created="Mon, 21 Feb 2022 00:55:48 +0000"  >&lt;p&gt;Commit ef178a272235615f161c4e75faa4f3d947547681 in logging-log4j2&apos;s branch refs/heads/dependabot/maven/org.apache.felix-maven-bundle-plugin-5.1.4 from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=ef178a2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=ef178a2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3304&quot; title=&quot;SpringEnvironmentHolder getEnvironment always return null&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3304&quot;&gt;&lt;del&gt;LOG4J2-3304&lt;/del&gt;&lt;/a&gt; - Create test that verifies this fix&lt;/p&gt;</comment>
                            <comment id="17495267" author="jira-bot" created="Mon, 21 Feb 2022 00:55:49 +0000"  >&lt;p&gt;Commit d6c8ab0863c551cdf0f8a5b1966ab45e3cddf572 in logging-log4j2&apos;s branch refs/heads/dependabot/maven/org.apache.felix-maven-bundle-plugin-5.1.4 from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=d6c8ab0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=d6c8ab0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3304&quot; title=&quot;SpringEnvironmentHolder getEnvironment always return null&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3304&quot;&gt;&lt;del&gt;LOG4J2-3304&lt;/del&gt;&lt;/a&gt; - Mark LogManager as initialized when a LoggerFactory is specified&lt;/p&gt;</comment>
                            <comment id="17495297" author="jira-bot" created="Mon, 21 Feb 2022 03:22:56 +0000"  >&lt;p&gt;Commit af0d269b13f777992db00ef1829b827900a4e8d6 in logging-log4j2&apos;s branch refs/heads/master from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=af0d269&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=af0d269&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3304&quot; title=&quot;SpringEnvironmentHolder getEnvironment always return null&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3304&quot;&gt;&lt;del&gt;LOG4J2-3304&lt;/del&gt;&lt;/a&gt; - Mark LogManager as initialized when a LoggerFactory is specified&lt;/p&gt;</comment>
                            <comment id="17495298" author="jira-bot" created="Mon, 21 Feb 2022 03:22:57 +0000"  >&lt;p&gt;Commit 9cc2967a4f900862d6999bf9eb9715555af9e056 in logging-log4j2&apos;s branch refs/heads/master from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=9cc2967&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=9cc2967&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3304&quot; title=&quot;SpringEnvironmentHolder getEnvironment always return null&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3304&quot;&gt;&lt;del&gt;LOG4J2-3304&lt;/del&gt;&lt;/a&gt; - Mark LogManager as initialized when a LoggerFactory is specified&lt;/p&gt;</comment>
                            <comment id="17495301" author="ralph.goers@dslextreme.com" created="Mon, 21 Feb 2022 03:25:20 +0000"  >&lt;p&gt;The PR has been merged. Thanks! Please verify and close this.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 38 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0y4zk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>