<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:34:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-1048] FileConfigurationMonitor - High CPU usage</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-1048</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;I am observing some high system CPU usage as a result of high number of calls to System.currentTimeMillis() in FileConfigurationMonitor.checkConfiguration() method.&lt;/p&gt;

&lt;p&gt;The checkConfiguration() method is called as part of Logger&apos;s every log/logIfEnabled and isEnabled method, therefore getting called thousands of times in my application when under moderate load. Each one of these calls therefore results in calling System.currentTimeMillis().&lt;/p&gt;

&lt;p&gt;The following code change, where the currentTimeMillis() is called only when required seemed to reduce the cpu load&lt;/p&gt;

&lt;p&gt;&lt;del&gt;final long current = System.currentTimeMillis();&lt;/del&gt;&lt;br/&gt;
&lt;del&gt;if(((counter.incrementAndGet() &amp;amp; MASK) == 0) &amp;amp;&amp;amp; (current &amp;gt;= nextCheck))&lt;/del&gt;&lt;/p&gt;

&lt;p&gt;Fixed as&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; current;
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (((counter.incrementAndGet() &amp;amp; MASK) == 0) &amp;amp;&amp;amp; ((current = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis()) &amp;gt;= nextCheck)) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12836678">LOG4J2-1048</key>
            <summary>FileConfigurationMonitor - High CPU usage</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rpopma">Remko Popma</assignee>
                                    <reporter username="iconnj">Nikhil</reporter>
                        <labels>
                    </labels>
                <created>Tue, 9 Jun 2015 22:16:07 +0000</created>
                <updated>Thu, 11 Jun 2015 16:19:37 +0000</updated>
                            <resolved>Wed, 10 Jun 2015 15:33:21 +0000</resolved>
                                    <version>2.3</version>
                                    <fixVersion>2.4</fixVersion>
                                    <component>Configurators</component>
                    <component>Core</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14579725" author="garydgregory" created="Tue, 9 Jun 2015 23:13:19 +0000"  >&lt;p&gt;Note that there is a JIRA to redo this feature use the Java 7 file watch service.&lt;/p&gt;

&lt;p&gt;There is also another JIRA to redo all timings using the nanosecond API instead of the millisecond API.&lt;/p&gt;

&lt;p&gt;Nevertheless this is a good catch.&lt;/p&gt;

&lt;p&gt;Thank you.&lt;/p&gt;

&lt;p&gt;Also note that proposing changes is always better as patch file in unified diff format.&lt;/p&gt;

&lt;p&gt;G&lt;/p&gt;</comment>
                            <comment id="14579850" author="iconnj" created="Wed, 10 Jun 2015 01:47:55 +0000"  >&lt;p&gt;I have attached the diff file of the proposed change. Will the refactoring to redo this feature happen in v2.4? If not, can you please apply this patch in 2.4. &lt;/p&gt;

&lt;p&gt;We deploy Log4j2 in servlet container&apos;s lib directory rather then bundle them in individual wars, and we got several containers running different set of wars. Creating a File Watch will require me to deploy a dedicated service to each current and future containers we may add.&lt;/p&gt;</comment>
                            <comment id="14579980" author="garydgregory" created="Wed, 10 Jun 2015 03:36:15 +0000"  >&lt;p&gt;Linked this issue to &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-982&quot; title=&quot;Use System.nanoTime() to measure time intervals&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-982&quot;&gt;LOG4J2-982&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14580652" author="remkop@yahoo.com" created="Wed, 10 Jun 2015 15:33:21 +0000"  >&lt;p&gt;Fixed in Git in commit 4c95866. &lt;br/&gt;
Please verify and close.&lt;/p&gt;</comment>
                            <comment id="14582172" author="iconnj" created="Thu, 11 Jun 2015 16:19:26 +0000"  >&lt;p&gt;Thanks for getting this in the coming release.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310051">
                    <name>Supercedes</name>
                                                                <inwardlinks description="is superceded by">
                                        <issuelink>
            <issuekey id="12784635">LOG4J2-982</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12738726" name="LOG4J2-1048" size="737" author="iconnj" created="Wed, 10 Jun 2015 01:47:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 23 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2fur3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>