<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:34:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-952] Add ConfigurationBuilder for programmatic configuration.</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-952</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;I found &lt;a href=&quot;http://logging.apache.org/log4j/2.x/faq.html#config_from_code&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this link&lt;/a&gt; which said:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;You could use the static method #initialize(String contextName, ClassLoader loader, String configLocation) in org.apache.logging.log4j.core.config.Configurator. (You can pass null for the class loader.) Be aware that this class is not part of the public API so your code may break with any minor release.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This documentation is unclear because it points to a member function which needs a filename &lt;tt&gt;configLocation&lt;/tt&gt; where as the topic is &#187;without a configuration file&#171;.&lt;/p&gt;

&lt;p&gt;It shoud rather point to the member function &lt;tt&gt;org.apache.logging.log4j.core.config.Configurator.initialize(ClassLoader loader, ConfigurationSource source)&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Example:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.logging.log4j.core.config.ConfigurationSource;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.logging.log4j.core.config.Configurator;

&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; hardCodedXmlConfig =
        &lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&apos;1.0&apos;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&apos;UTF-8&apos;&lt;/span&gt;?&amp;gt;\n&quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;Configuration status=&lt;span class=&quot;code-quote&quot;&gt;&apos;INFO&apos;&lt;/span&gt;&amp;gt;\n&quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot;  &amp;lt;Appenders&amp;gt;\n&quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot;    &amp;lt;Console name=&lt;span class=&quot;code-quote&quot;&gt;&apos;Console&apos;&lt;/span&gt; target=&lt;span class=&quot;code-quote&quot;&gt;&apos;SYSTEM_OUT&apos;&lt;/span&gt;&amp;gt;\n&quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot;      &amp;lt;PatternLayout pattern=&lt;span class=&quot;code-quote&quot;&gt;&apos;%d{HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg%n&apos;&lt;/span&gt;/&amp;gt;\n&quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot;    &amp;lt;/Console&amp;gt;\n&quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot;  &amp;lt;/Appenders&amp;gt;\n&quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot;  &amp;lt;Loggers&amp;gt;\n&quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot;    &amp;lt;Root level=&lt;span class=&quot;code-quote&quot;&gt;&apos;debug&apos;&lt;/span&gt;&amp;gt;\n&quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot;      &amp;lt;AppenderRef ref=&lt;span class=&quot;code-quote&quot;&gt;&apos;Console&apos;&lt;/span&gt;/&amp;gt;\n&quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot;    &amp;lt;/Root&amp;gt;\n&quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot;  &amp;lt;/Loggers&amp;gt;\n&quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;/Configuration&amp;gt;\n&quot;&lt;/span&gt;;
&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
    Configurator.initialize(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ConfigurationSource(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ByteArrayInputStream(hardCodedXmlConfig.getBytes())));
} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {
    e.printStackTrace();
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12774177">LOG4J2-952</key>
            <summary>Add ConfigurationBuilder for programmatic configuration.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rgoers">Ralph Goers</assignee>
                                    <reporter username="FreeJoe">Joe Merten</reporter>
                        <labels>
                    </labels>
                <created>Wed, 11 Feb 2015 11:48:05 +0000</created>
                <updated>Wed, 21 Oct 2015 16:07:31 +0000</updated>
                            <resolved>Tue, 8 Sep 2015 00:50:12 +0000</resolved>
                                    <version>2.1</version>
                                    <fixVersion>2.4</fixVersion>
                                    <component>API</component>
                    <component>Configurators</component>
                    <component>Documentation</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14693918" author="xennex82" created="Wed, 12 Aug 2015 17:44:16 +0000"  >&lt;p&gt;You&apos;d still have a configuration file, just not on disk. But thanks for the pointer. To do it without XML file you need a lot of program calls. The API is not yet up to par with what you need to do, because for the lack of Builder methods mostly and essentially the difficulty in discovering what you need to do. I might write something for that when I have the time and the ability and the knowhow to do so.&lt;/p&gt;</comment>
                            <comment id="14693950" author="nobeh" created="Wed, 12 Aug 2015 17:59:24 +0000"  >&lt;p&gt;I&apos;ve been hitting the same requirement and I also raised it in the mailing list. In the end I started to develop this module:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/nobeh/log4j-configuration-builder&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/nobeh/log4j-configuration-builder&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;d be happy to see how it fits and how it can be developed further.&lt;/p&gt;

&lt;p&gt;P.S. IMHO this ticket should &lt;em&gt;not&lt;/em&gt; be an FAQ and it&apos;s valid requirement esp. regarding applications that follow a minimalistic approach towards configuration.&lt;/p&gt;</comment>
                            <comment id="14693969" author="ralph.goers@dslextreme.com" created="Wed, 12 Aug 2015 18:23:06 +0000"  >&lt;p&gt;Behrooz - I really like what you have done so far. Interestingly enough I was thinking about doing something like this a few days ago.  Would you be OK with us incorporating your code directly into Log4j? People have been asking for properties file support and I think it would be interesting to use a ConfigurationBuilder to implement it.&lt;/p&gt;</comment>
                            <comment id="14694006" author="nobeh" created="Wed, 12 Aug 2015 18:53:37 +0000"  >&lt;p&gt;Hi Ralph, thanks for taking a look on the repo. I am definitely interested in collaborating on this. Once I asked Gary and I was hoping he could do a code review on it. I understand that you guys at Apache Log4j are also very busy with different stuff. &lt;/p&gt;

&lt;p&gt;If you can provide me with more details of what should be completed plus testing, I am willing to continue on working it to reach a point that can actually be directly merged into Apache Log4j core. Please let me know. &lt;/p&gt;</comment>
                            <comment id="14694027" author="garydgregory" created="Wed, 12 Aug 2015 19:11:04 +0000"  >&lt;p&gt;Yep, your right on the busy part. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I am sorry I could not take the time to review your code. &lt;/p&gt;</comment>
                            <comment id="14694029" author="garydgregory" created="Wed, 12 Aug 2015 19:12:56 +0000"  >&lt;p&gt;Are we talking about using a Log4j 1 prop file in v2?&lt;/p&gt;</comment>
                            <comment id="14694048" author="xennex82" created="Wed, 12 Aug 2015 19:30:03 +0000"  >&lt;p&gt;I was writing this before all of your comments (the last 3, by Gary and Behrooz).&lt;/p&gt;

&lt;p&gt;I&apos;ve read the entire source file mostly. I&apos;d suggest putting everything in Maps and Sets and then generating the relevant objects out of that might not be the most.. pristine way of doing it, but I guess... I would suggest mostly not to use the same method for creating file and console loggers. I&apos;d suggest a way to set additivity and a way to set level per config. Per LoggerConfig. Personally I would prefer a directer way of dealing with these general objects, except with the way of not having to &quot;store&quot; them directly (ie. requiring the imports and all). That said, I&apos;d prefer to see the structure of the generated objects reflected in the method calls I do. For instance, I would want to generate LoggerConfigs and Appenders and add the Appenders to the LoggerConfigs.&lt;/p&gt;

&lt;p&gt;Something like.&lt;/p&gt;

&lt;p&gt;addLoggerConfig(&quot;name&quot;, additivity);&lt;br/&gt;
addAppender(&quot;name&quot;, Appenders.CONSOLE, pattern);&lt;br/&gt;
addAppenderToConfig(&quot;name&quot;, &quot;name&quot;);&lt;/p&gt;

&lt;p&gt;The closer you stay to the inherit structure, the more powerful your system will be; ie. the closer you stay to the actual configuration under the hood, the less you will run into impossibilities. That also should mean you operate on a Configuration (or at least its objects) directly, but I don&apos;t know how feasible that should be, given that many of these objects require a conf parameter to begin with; you can&apos;t just create them floating in free air. In any way, that is your specifics and mechanics, I&apos;m free to not use it if I want &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. That&apos;s all I&apos;m saying really. Mind you that you won&apos;t create a system that many users will not want to use for whatever reasons. If it is then incorporated into Log4J proper we&apos;d all be embarrassed &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;

&lt;p&gt;Ideally this should really be the Builder subclass (inner class) of Configuration itself. But that might make Configuration a huge file. But if it was incorporated, Configuration itself could have the newBuilder() method. That would indeed create a Configuration; after that comes installing. Your code currently does the entire reconfiguration and of course also installs the factory object. It essentially generates a config, gives it to the factory, the factory is given to the init system of Log4J, which then simply requests back the config from it. Maybe, generally, that couldn&apos;t be done if it was truly Configuration&apos;s Builder. Then you wouldn&apos;t have the weird issue at least that essentially &lt;tt&gt;configure()&lt;/tt&gt; is the main method of the class, and not &lt;tt&gt;build()&lt;/tt&gt; (kinda breaking the agreement or contract of that specification). Maybe you want to isolate the builder itself from some wrapper thing that causes the injection into the main system.&lt;/p&gt;

&lt;p&gt;In other words, the thing that applies it and effectuates it would be a different class from the Builder itself. I think that would be a better strategy, separation of concerns so to speak. But still good implementation and concept.&lt;/p&gt;

&lt;p&gt;That&apos;s all I wanted to say I guess. I&apos;m just a bystander at this point but just concerning myself with these things at the moment. Regards.&lt;/p&gt;</comment>
                            <comment id="14694184" author="xennex82" created="Wed, 12 Aug 2015 21:19:19 +0000"  >&lt;p&gt;You could have an API like:&lt;/p&gt;

&lt;p&gt;addAppender(&quot;name&quot;, TYPE, parameter) where parameter could be a vararg and the function under the hood adds the relevent type.&lt;/p&gt;

&lt;p&gt;addAppenderTo(&quot;name&quot;, &quot;target&quot;) where target could be a LoggerContext or anything else the way it works in this system.&lt;br/&gt;
addFilter(&quot;name&quot;, ...., ......)&lt;br/&gt;
addFilterTo(&quot;name&quot;, &quot;target&quot;). If your system has unique names (you could introduce that) for each identifier, then this single generic method could add both filters to appenders and any other things that it might need to be added to.&lt;/p&gt;

&lt;p&gt;What you get is a &quot;ref&quot; based system that almost mirrors the XML file. For example, my current project&apos;s logger configuration would be:&lt;/p&gt;

&lt;p&gt;addAppender(&quot;console&quot;, CONSOLE, pattern);&lt;br/&gt;
addConfig(&quot;server&quot;, TRACE, true);&lt;br/&gt;
addConfig(&quot;telnet&quot;, DEBUG, true);&lt;br/&gt;
addConfig(&quot;telnet.file&quot;, WARN, true);&lt;br/&gt;
addAppenderTo(&quot;console&quot;, &quot;root&quot;);&lt;br/&gt;
addAppender(&quot;optionsLog&quot;, FILEAPPEND, pattern);&lt;br/&gt;
addAppenderTo(&quot;optionsLog&quot;, &quot;telnet.file&quot;);&lt;/p&gt;

&lt;p&gt;That&apos;s my entire configuration. Done in 7 lines instead of 28 + 18 for a helper method. Most, many of those lines are builder methods though. You could also imagine these methods interfacing with actual builder methods. Which is what I was getting to: if you can create the objects direclty?.&lt;/p&gt;

&lt;p&gt;Ah never mind, I don&apos;t know how to do that cleanly. The classes themselves have builders (some of them) that you can use to complete the options. If you have an&lt;/p&gt;

&lt;p&gt;public Builder addSyslogAppender(String, String, int, String, String, String, int, String);&lt;/p&gt;

&lt;p&gt;then that kinda defeats the idea of having a builder &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. You&apos;d have to have a builder for that as well:&lt;/p&gt;

&lt;p&gt;addSyslogAppender(&quot;name&quot;, SyslogAppenderOptions.newBuilder().host(&quot;xxx.yyy.zz&quot;).port(2001).build());&lt;/p&gt;

&lt;p&gt;alternatively&lt;/p&gt;

&lt;p&gt;builder.addSyslogAppender(&quot;name&quot;, builder.syslog().host(&quot;&quot;).port(xx).build());&lt;/p&gt;

&lt;p&gt;or&lt;/p&gt;

&lt;p&gt;builder.addSyslogAppender(&quot;name&quot;).host(&quot;&quot;).port(xx);&lt;/p&gt;

&lt;p&gt;in the latter case this method would return a different kind of builder (SyslogAppenderOptions.Builder) that doesn&apos;t have a finalizer method (like build()) and in which the methods simply update the object that has already been registered in other words you&apos;d have a Map&amp;lt;String, SyslogAppenderOptions&amp;gt; and the first method (addSyslogAppender) would create the SyslogAppenderOptions.Builder, put it in the Map, return the object, and subsequent calls on that object fill in further details without any completion checking taking place at that point and at that time.&lt;/p&gt;

&lt;p&gt;Completion checking would happen when the generated spec is transformed into a configuration. This is an alternative way of doing builder stuff called a &quot;fluent API&quot; or a &quot;fluid API&quot;. &lt;/p&gt;

&lt;p&gt;builder.syslog(&quot;name&quot;).host(&quot;&quot;).port(xx);&lt;/p&gt;

&lt;p&gt;would probably be the smallest version of doing it &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. Anyway. Time to sleep almost I guess.&lt;/p&gt;</comment>
                            <comment id="14694867" author="mikaelstaldal" created="Thu, 13 Aug 2015 08:08:09 +0000"  >&lt;p&gt;I can see a problem with this, a simple spelling mistake would give you a broken configuration without the compiler noticing. This can be fixed by returning an Java object to be used instead of String refs. So it would look like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Appender console = addAppender(&lt;span class=&quot;code-quote&quot;&gt;&quot;console&quot;&lt;/span&gt;, CONSOLE, pattern);
LoggerConfig server = addConfig(&lt;span class=&quot;code-quote&quot;&gt;&quot;server&quot;&lt;/span&gt;, TRACE, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
LoggerConfig telnet = addConfig(&lt;span class=&quot;code-quote&quot;&gt;&quot;telnet&quot;&lt;/span&gt;, DEBUG, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
LoggerConfig telnetFile = addConfig(&lt;span class=&quot;code-quote&quot;&gt;&quot;telnet.file&quot;&lt;/span&gt;, WARN, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
addAppenderTo(console, Configuration.ROOT);
Appender optionsLog = addAppender(&lt;span class=&quot;code-quote&quot;&gt;&quot;optionsLog&quot;&lt;/span&gt;, FILEAPPEND, pattern);
addAppenderTo(optionsLog, telnetFile);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14695195" author="xennex82" created="Thu, 13 Aug 2015 13:10:01 +0000"  >&lt;p&gt;The problem is that it would no longer be a builder (not sure if that&apos;s a problem though....).&lt;/p&gt;

&lt;p&gt;The current builder implementation of Behrooz Nobakht (sorry if I don&apos;t remember your name &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;) saves string references and can validate them when the configuration is built. So even though the compiler won&apos;t notice, if a string that is referenced that should have been registered but isn&apos;t, the thing can just throw an error or exception. (Currently though, for instance if you request a loggerconfig that doesn&apos;t exist from the core API, it will just return the loggerconfig for Root. If you reference a level that doesn&apos;t exist, it will just return DEBUG. Etc, idk.).&lt;/p&gt;

&lt;p&gt;Also not sure if Configuration.ROOT would exist (whether it&apos;d be static reference to a LoggerConfig at this point, I don&apos;t know) &amp;#8211; maybe it should just be a static field of the interface, but it couldn&apos;t really be a loggerConfig I think.&lt;/p&gt;

&lt;p&gt;Besides, you&apos;d still need to import all of those classes: LoggerConfig from (LoggerConfig has a field called ... no a class called RootLogger but it is not a reference. You can&apos;t use that) ... from core.config, Appender from core.appender, and so on.&lt;/p&gt;

&lt;p&gt;In any case it wouldn&apos;t probably be hard to troubleshoot a config where you have made a small type, and the builder would probably tell you, so it&apos;s not that great of a problem. &lt;/p&gt;</comment>
                            <comment id="14695243" author="mikaelstaldal" created="Thu, 13 Aug 2015 13:55:12 +0000"  >&lt;p&gt;My code was only meant to be an example, details can be different.&lt;/p&gt;

&lt;p&gt;If make a typo in my code, I want the compiler to signal an error, I don&apos;t want to have to wait until it fails at runtime.&lt;/p&gt;

&lt;p&gt;That&apos;s the whole point of having a statically typed language like Java, otherwise we could as well use Python, Ruby, Javascript or some other dynamic language.&lt;/p&gt;</comment>
                            <comment id="14695261" author="ralph.goers@dslextreme.com" created="Thu, 13 Aug 2015 14:03:53 +0000"  >&lt;p&gt;Configuration from files in Log4j is a two step process. First the XML/JSON is read and converted into Nodes with properties. The Nodes have a parent/child relationship in accordance with how they are represented in the file.  Next the Nodes are processed and converted into objects such as Appenders, Filters, etc.  During the first phase it is unlikely you will see errors of the type you are expecting. That doesn&apos;t happen until the Nodes are processed.&lt;/p&gt;

&lt;p&gt;I should note - you will get the benefits from Java being statically typed - it just won&apos;t happen until the actually objects are created during the second phase.&lt;/p&gt;

&lt;p&gt;I would expect a ConfigurationBuilder would do the exact same thing - it would just create the Nodes with their properties. Not until you call the build() method would you actually find out if you have any errors.&lt;/p&gt;

&lt;p&gt;I&apos;m not really sure your analogy to a compiler really holds up here. This is more analogous to an interpreter than a compiler. i.e. the Configuration is always constructed dynamically at startup, not during a build process before the application runs.&lt;/p&gt;</comment>
                            <comment id="14695279" author="mikaelstaldal" created="Thu, 13 Aug 2015 14:17:03 +0000"  >&lt;p&gt;But if we can make it report more errors at compile time, why not?&lt;/p&gt;</comment>
                            <comment id="14695305" author="xennex82" created="Thu, 13 Aug 2015 14:31:49 +0000"  >&lt;p&gt;Well, because you have to change the implementation for that so completely that you are directly working with the resultant objects; something you are trying to avoid for reasons of the ..arduriousness (arduousness) of having to deal with all the types/classes yourself. Something you are precisely trying to avoid by using a Builder in this case.&lt;/p&gt;

&lt;p&gt;The whole point of the Builder is that you won&apos;t be dealing with Filters, Appenders and LoggerConfigs directly. So like Ralph says (and like Behrooz has made) it is a two stage process in which the objects are first represented differently internally (like with mapping relations in the current implementation of what Behrooz has proposed here). He turns his relations into a &quot;spec&quot; and then feeds the spec to a constructor method that creates a real Configuration/LoggerContext/Appender/Filter thing out of it.&lt;/p&gt;

&lt;p&gt;It would not be so bad if you dealt with e.g. LoggerConfigs directly as long as you (the programmer) doesn&apos;t have to store these in local variables and the like. So I think Ralph and Behrooz are just correct in that they want a translation layer.&lt;/p&gt;</comment>
                            <comment id="14695325" author="mikaelstaldal" created="Thu, 13 Aug 2015 14:55:51 +0000"  >&lt;p&gt;I don&apos;t understand what the disadvantage with the approach I proposed would be. The builder would still create the Appender/Filter/etc objects for you, you just have to save the reference and pass it in instead of a string literal.&lt;/p&gt;</comment>
                            <comment id="14695342" author="xennex82" created="Thu, 13 Aug 2015 15:17:34 +0000"  >&lt;p&gt;A typical builder paradigm is that there is a fixed &lt;em&gt;Context&lt;/em&gt; and the context doesn&apos;t change from one method invocation to the next.&lt;/p&gt;

&lt;p&gt;Normally any Builder returns the same Builder from any of its methods, as what you called the methods on.&lt;/p&gt;

&lt;p&gt;So the relationship holds that:&lt;/p&gt;

&lt;p&gt;Builder b = builder.doSomething() ----&amp;gt;  b == builder&lt;/p&gt;

&lt;p&gt;In fluent API speak this is called the context.&lt;/p&gt;

&lt;p&gt;If half of your methods return actual objects and the other half inserts those objects into the planned configuration (thus honouring the builder thing) then I guess technically there might not be an amazing issue (as long as the configuration object already exists and you can pass it into the new created objects) (which is in itself an issue) (you can&apos;t have flee floating objects, they have to be attached to a configuration right from the get go the way it currently is, I believe)....&lt;/p&gt;

&lt;p&gt;But the only advantage is a bit of type checking. You won&apos;t be creating a new Log4J configuration every day I hope. Unless you have a 1000 line configuration, even considering it would be possible with the builder, the amount of &quot;debugging&quot; you MIGHT need to do AFTER the runtime engine tells you there has been a mistake is just very minimal.&lt;/p&gt;

&lt;p&gt;There are just not any practical advantages to having the real objects in your hands.&lt;/p&gt;

&lt;p&gt;At WORST your program might display some errors because you have made a typing mistake, the exact same thing as when you&apos;d use an XML or other file!!!!!.&lt;/p&gt;

&lt;p&gt;Now if some method returned a specific builder instance FOR one of those objects and you were allowed to manipulate it own your own before sending it back into function (or being registered at the start) that might not be so bad:&lt;/p&gt;

&lt;p&gt;&lt;b&gt;In that case you&apos;d have the Configuration.Builder store a collection of Builder objects for the various classes. It would than transform those builder objects into actual objects before implanting them into the Configuration it is making.&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;However I think the two stage approach we have here is much prettier even if I don&apos;t agree with all the Maps, (seems too easy) and more powerful. Also I believe Maps are expensive objects, but that might be beside the point.&lt;/p&gt;

&lt;p&gt;The problem with the current situation is precisely that you need a large number of imports to do anything:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.logging.log4j.Level;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.logging.log4j.Logger;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.logging.log4j.LogManager;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.logging.log4j.core.LoggerContext;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.logging.log4j.core.Appender;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.logging.log4j.core.config.AppenderRef;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.logging.log4j.core.config.Configuration;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.logging.log4j.core.config.ConfigurationFactory;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.logging.log4j.core.config.LoggerConfig;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If you created an abstraction interface that would still require all those imports (because you&apos;d have to store the references yourself) that would perfectly devoid the whole sense of creating a fluid API (fluent API) to do things.&lt;/p&gt;

&lt;p&gt;So I think then the main advantage of having a Builder would be gone. A Builder should not give back weird objects, it should stay a Builder. Now, how important that is is up to debate.&lt;/p&gt;

&lt;p&gt;But I would at this point stick to the simple interface I have / we have described. Just use string literals, why not. The only alternative is to create something fluent that ensures you don&apos;t have to &lt;em&gt;keep the references around&lt;/em&gt; as you pass one object to the next. Then you&apos;d probably want to use sub-builder classes (such as SyslogOptions.Builder) that either did &quot;Register-in-Front&quot; as the prettiest solution, or &quot;Finalize-with-Build&quot; and pass the object to the system, as the ugliest. Like I have indicated.&lt;/p&gt;

&lt;p&gt;Personally I don&apos;t see why you&apos;d be interested in having a ConfigurationBuilder if the amount of work required to use it would still be 70% of what you had before?.&lt;/p&gt;</comment>
                            <comment id="14695358" author="mikaelstaldal" created="Thu, 13 Aug 2015 15:28:42 +0000"  >&lt;p&gt;Having some extra imports is not a big deal since all reasonable IDEs will help you doing them. Forcing compile time dependency on the log4j-core module would be an issue though (if that could be avoided otherwise).&lt;/p&gt;</comment>
                            <comment id="14695382" author="xennex82" created="Thu, 13 Aug 2015 15:40:31 +0000"  >&lt;p&gt;By the way, the next-prettiest interface API I can think of (after using regular Builder to Builder methods) is to use either new Builder types for the option sets (lot of work) or the existing Builder types for the actual objects (that exposes a lot of the inner mechanics).&lt;/p&gt;

&lt;p&gt;In the latter cause you&apos;d get this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; ConsoleAppender.Builder addConsoleAppender(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then you would use it by this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;builder.addConsoleAppender(&lt;span class=&quot;code-quote&quot;&gt;&quot;console&quot;&lt;/span&gt;).setLayout(
    builder.addPatternLayout(&lt;span class=&quot;code-quote&quot;&gt;&quot;pretty&quot;&lt;/span&gt;).setPattern(&lt;span class=&quot;code-quote&quot;&gt;&quot;...&quot;&lt;/span&gt;).setCharset(...)
);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This would imply that you leave half-finished objects: builder.addConsoleAppnder() would do:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;setConfiguration() on each of these builder objects&lt;/li&gt;
	&lt;li&gt;call the final build() on them&lt;/li&gt;
	&lt;li&gt;perform any other duties that you can&apos;t expect the user to partake in&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Which means you&apos;d expose a LOT of the inner mechanics, which leaves a lot of room to &quot;fuck up&quot;, so to speak.&lt;/p&gt;

&lt;p&gt;The closer means to having an abstraction API would not be to create the regular Builder classes/objects, but rather specialized &quot;OptionsetBuilder&quot; objects/classes. Which means you might need to create option-set-builders for the classes (like Syslog) that require a lot of parameters.&lt;/p&gt;

&lt;p&gt;All in all, a lot to think about I guess.&lt;/p&gt;</comment>
                            <comment id="14695397" author="xennex82" created="Thu, 13 Aug 2015 15:48:05 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Having some extra imports is not a big deal since all reasonable IDEs will help you doing them. Forcing compile time dependency on the log4j-core module would be an issue though (if that could be avoided otherwise).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That&apos;s not an excuse. If you have an IDE that will automate everything for you then you don&apos;t need an abstraction layer / builder thing. If you as well are going to have to store references and thus create local variables, then the amount of code reduction will be very very minimal. With adequate builder classes in the objects themselves, constructing the required objects is trivial really:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;conf.addAppender(
    org.apache.logging.log4j.core.appender.ConsoleAppender.newBuilder().
        setName(&lt;span class=&quot;code-quote&quot;&gt;&quot;ConsoleOwn&quot;&lt;/span&gt;).
        setLayout(
            org.apache.logging.log4j.core.layout.PatternLayout.newBuilder().
                withPattern(myPattern).
                withCharset(java.nio.charset.Charset.forName(&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;)).
                withConfiguration(conf).
                build()).
        build()
);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But even that is too arduous for my tastes. Just to avoid having to store objects, I would do:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;conf.getLoggerConfig(&lt;span class=&quot;code-quote&quot;&gt;&quot;root&quot;&lt;/span&gt;).addAppender(conf.getAppender(&lt;span class=&quot;code-quote&quot;&gt;&quot;ConsoleOwn&quot;&lt;/span&gt;), &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So you see I&apos;m already using &apos;string literals&apos;. I just want it to be faster, less verbose. And of course my tastes matter &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. that&apos;s why I&apos;m doing this &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;</comment>
                            <comment id="14695411" author="xennex82" created="Thu, 13 Aug 2015 15:53:32 +0000"  >&lt;blockquote&gt;&lt;p&gt;Forcing compile time dependency on the log4j-core module would be an issue though (if that could be avoided otherwise).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Indeed you would be requiring any user of the builder to delve deeply into the Core. You&apos;d be importing all those core classes. If you want an interface to be minimal, you should not be posing such requirements, even if you have an automated tool that will fill in the details for you. Anybody who does not use that IDE will be fux0red. The whole idea of creating a clean API is that it is minimal and easy to use, not sub-par-minimal and only easy to use if the required tools are in place.&lt;/p&gt;</comment>
                            <comment id="14695431" author="mikaelstaldal" created="Thu, 13 Aug 2015 16:02:48 +0000"  >&lt;p&gt;BTW, we could make the XML literal approach a bit easier by adding a String constructor to &lt;tt&gt;ConfigurationSource&lt;/tt&gt; (not throwing &lt;tt&gt;IOException&lt;/tt&gt;), and a new overloaded &lt;tt&gt;Configurator.initialize(ConfigurationSource)&lt;/tt&gt; so that you can do like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; hardCodedXmlConfig = &lt;span class=&quot;code-quote&quot;&gt;&quot;...&quot;&lt;/span&gt;;
Configurator.initialize(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ConfigurationSource(hardCodedXmlConfig));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14695452" author="xennex82" created="Thu, 13 Aug 2015 16:11:03 +0000"  >&lt;p&gt;It&apos;s weird anyway that &lt;tt&gt;getConfiguration(ConfigurationSource source)&lt;/tt&gt; is the abstract one that you need to override, but in fact it won&apos;t even get called unless &lt;tt&gt;getConfiguration(final String name, final java.net.URI configLocation)&lt;/tt&gt; calls it, which is not mandatory of being overriden &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. This is in Configuration.&lt;/p&gt;

&lt;p&gt;In Behrooz Nobakht&apos;s code, he also overrides both methods and returns the configuration he has already acquired from those two methods. Same thing I do I guess. (((I just have a new Factory that will ensure the ERROR message for not having a configuration file will not be departed))). That&apos;s the only reason my factory exists &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/tongue.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/tongue.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/tongue.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;</comment>
                            <comment id="14699550" author="nobeh" created="Mon, 17 Aug 2015 13:52:05 +0000"  >&lt;p&gt;Thank you Bart and Mikael for your comments. &lt;br/&gt;
My plan is to branch off my current repo with the same&lt;br/&gt;
JIRA ticket name and start to apply the comments and&lt;br/&gt;
ideas discussed here. In the end, I expect to have&lt;br/&gt;
a polished version, with tests and examples to show&lt;br/&gt;
the changes to the API. However, if I am not mistaken, &lt;br/&gt;
the code needs to certified and approved by Apache Log4J&lt;br/&gt;
PMC which means to me their comments should have higher&lt;br/&gt;
priority.&lt;/p&gt;

&lt;p&gt;My take-away from the comments and discussions:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Simplify the &quot;builder&quot; methods for user convenience&lt;/li&gt;
	&lt;li&gt;Refactor towards a more fluid/fluent API for a builder pattern&lt;/li&gt;
	&lt;li&gt;Stay close to and inherit the current `Configuration` and `LoggerConfig` hierarchy&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="14699575" author="ralph.goers@dslextreme.com" created="Mon, 17 Aug 2015 14:12:58 +0000"  >&lt;p&gt;Just so you are aware, I have started working on a builder that is different than yours. Please go ahead and continue on yours as it may be preferable.&lt;/p&gt;</comment>
                            <comment id="14700088" author="xennex82" created="Mon, 17 Aug 2015 19:30:03 +0000"  >&lt;p&gt;Please also check &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1095&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;LOG4J2-1095&lt;/a&gt; for the diagram I have made. I think it should be a good method to set this thing up.&lt;/p&gt;

&lt;p&gt;Behrooz, you already have an internal Specification. I think this specification should be a public resource that results from a SpecificationBuilder. The specification can then be manually fed to the factory. The factory is then fed to the system, or getConfiguration() is called on it directly. In any case giving a user multiple configurations in his/her hands might enable really easy switching of the logging system from one state to another. The current set of loggers can easily be updated against another configuration. So the steps would be:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;obtain a SpecificationBuilder&lt;/li&gt;
	&lt;li&gt;build a specification using the methods we have discussed&lt;/li&gt;
	&lt;li&gt;put the specification into a factory&lt;/li&gt;
	&lt;li&gt;feed the factory to the init system, or&lt;/li&gt;
	&lt;li&gt;obtain configurations directly from it.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;It seems to me a really great way to do this. There really should be one single architecture to it anyway, even if we have multiple implementations. I think making the Specification a public thing is the answer.&lt;/p&gt;

&lt;p&gt;Ralph, good luck with your attempt/try/endeavour. I hope it can converge on something, that even if there are multiple implementations, each will have their strengths or beauties and both might even be able to be used at the same time.&lt;/p&gt;

&lt;p&gt;Since the specification type is really only married to the factory you create, it should be possible for that the System does not have to know about the class. Or the builder. That is, unless we want a common interface for these things. The Builder would obviously extend (implement) core.util.Builder. The Specification is special for the Builder and the Factory, but who knows it might have common methods.&lt;/p&gt;

&lt;p&gt;I hope this works out. Regards,&lt;/p&gt;

&lt;p&gt;oh and Behrooz. I&apos;m not sure everything needs to be fluid, we haven&apos;t really had any talk about the actual methods (of the SpecBuilder) and what would be nice; but I think the SpecBuilder/ConfigBuilder itself should indeed be fluent. I think your third point is still important.&lt;/p&gt;</comment>
                            <comment id="14701287" author="ralph.goers@dslextreme.com" created="Tue, 18 Aug 2015 13:57:00 +0000"  >&lt;p&gt;I am working on a configuration builder that looks like the following:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        GenericConfigurationAssembler assembler = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GenericConfigurationAssembler();
        assembler.setStatusLevel(Level.DEBUG);
        AppenderAssembler appenderAssembler = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AppenderAssembler(assembler, &lt;span class=&quot;code-quote&quot;&gt;&quot;STDOUT&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;Console&quot;&lt;/span&gt;);
        LayoutAssembler layoutAssembler = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; LayoutAssembler(assembler, &lt;span class=&quot;code-quote&quot;&gt;&quot;PatternLayout&quot;&lt;/span&gt;);
        layoutAssembler.addAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;pattern&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;%d [%t] %-5level: %msg%n%throwable&quot;&lt;/span&gt;);
        appenderAssembler.addLayout(layoutAssembler.assemble());
        FilterAssembler filterAssembler = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FilterAssembler(assembler, &lt;span class=&quot;code-quote&quot;&gt;&quot;MarkerFilter&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;DENY&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;NEUTRAL&quot;&lt;/span&gt;);
        filterAssembler.addAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;marker&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;FLOW&quot;&lt;/span&gt;);
        appenderAssembler.addFilter(filterAssembler.assemble());
        assembler.addAppender(appenderAssembler.assemble());
        LoggerAssembler loggerAssembler = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; LoggerAssembler(assembler, &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.logging.log4j&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;DEBUG&quot;&lt;/span&gt;);
        loggerAssembler.addAppenderRef(&lt;span class=&quot;code-quote&quot;&gt;&quot;Console&quot;&lt;/span&gt;);
        assembler.addLogger(loggerAssembler.assemble());
        loggerAssembler = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; LoggerAssembler(assembler, &lt;span class=&quot;code-quote&quot;&gt;&quot;ERROR&quot;&lt;/span&gt;);
        loggerAssembler.addAppenderRef(&lt;span class=&quot;code-quote&quot;&gt;&quot;Console&quot;&lt;/span&gt;);
        Configuration config = assembler.assemble();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Ultimately it would be nice to have this encapsulated into a ConfigurationFactory as a Plugin.&lt;/p&gt;</comment>
                            <comment id="14701308" author="nobeh" created="Tue, 18 Aug 2015 14:11:25 +0000"  >&lt;p&gt;I would kindly need a confirmation, please. &lt;/p&gt;

&lt;p&gt;I appreciate all the effort Apache Log4J team puts into this amazing library as I&apos;ve replace a number of my environment for 2.x version and we already see the benefit. I hit a requirement and that&apos;s why I created my small solution for it. If you guys already have picked this up and have a nice solution for it, please let me know to stop my work. I sense there seems to a few simultaneous efforts and I am just as happy to reuse your work. Thanks.&lt;/p&gt;</comment>
                            <comment id="14701318" author="ralph.goers@dslextreme.com" created="Tue, 18 Aug 2015 14:18:44 +0000"  >&lt;p&gt;Behrooz - Nothing has been finished yet.  I posted the above to get feedback from others to see if I am on the right track.  From an external point of view, what I am implementing is different than yours in that I am not creating methods for each type of appender, filter, etc. Instead, I am using a more generic approach.  The downside to this is that you won&apos;t really see configuration errors when the application is compiled. They pretty much will only happen when the config.start() method is called (which is where they occur when configuring via XML or JSON).&lt;/p&gt;</comment>
                            <comment id="14701319" author="xennex82" created="Tue, 18 Aug 2015 14:19:00 +0000"  >&lt;p&gt;That is like really verbose! Oeph!.&lt;/p&gt;

&lt;p&gt;But I get the idea. However it is not much less verbose than the current method?....&lt;/p&gt;

&lt;p&gt;Essentially, the pattern is:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;create a top level assember&lt;/li&gt;
	&lt;li&gt;create sublevel assemblers that are already connected to the toplevel assembler&lt;/li&gt;
	&lt;li&gt;assemble the sublevels and add them to the toplevel&lt;/li&gt;
	&lt;li&gt;finally assemble the toplevel.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;It requires a lot of local variables. And hence a lot of imports. It is completely compositing in nature; that is cool. You could think to refactor it in this way:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;assembler.addLogger(
    assembler.getLoggerAssembler(&lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;)
        .addAppenderRef(&lt;span class=&quot;code-quote&quot;&gt;&quot;Console&quot;&lt;/span&gt;)
        .assemble()
)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then you can chain that:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;assembler.addAppender(
    assembler.getAppenderAssembler(&lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;)
        .addLayout( ..... )
        .assemble()
).addLogger(
    assembler.getLoggerAssembler(&lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;)
        .addAppenderRef(&lt;span class=&quot;code-quote&quot;&gt;&quot;Console&quot;&lt;/span&gt;)
        .assemble()
).assemble();&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then you&apos;d have the exact same functionality in a fluent layout, without requiring the local variables unless you want to use an appender (for example) twice. It also means you don&apos;t need to reference any classes, as the Assembler itself will produce new instances of those classes for you (with &lt;tt&gt;getLoggerAssembler()&lt;/tt&gt;. This will also void the requirement to constantly pass &apos;assembler&apos; as a parameter to those objects/methods.&lt;/p&gt;

&lt;p&gt;This may be the best solution we have thus far. It is a compositing framework, but all the assemblers return actual objects, right?. They are then not much different than the existing Builders of certain classes, in fact they do the same thing. The difference is you do not directly add them to a configuration, but that happens with the final assemble call.&lt;/p&gt;</comment>
                            <comment id="14701344" author="xennex82" created="Tue, 18 Aug 2015 14:32:26 +0000"  >&lt;p&gt;Let&apos;s say the difference is that &lt;tt&gt;getAssembler()&lt;/tt&gt; means the same as &lt;tt&gt;getSpecificationBuilder()&lt;/tt&gt; and &lt;tt&gt;getLoggerAssembler()&lt;/tt&gt; means the same as &lt;tt&gt;getLoggerSpecificationBuilder&lt;/tt&gt; but the idiom might be more attractive. I yet don&apos;t know if your assemblers return actual objects or specifications. If they return actual objects then there is not much of a compilation taking place.&lt;/p&gt;

&lt;p&gt;In that case, with actual objects being returned it is not different than having a ConfigurationBuilder that chains &quot;add&quot; methods and takes real e.g. ConsoleAppender.Builder objects, except that this is a generic approach using parameters for type differentiation rather than using a different builder for each specific class.&lt;/p&gt;

&lt;p&gt;The idiom is however prettier than using &quot;specificationBuilder&quot;. However, it might be almost the same thing.&lt;/p&gt;</comment>
                            <comment id="14702043" author="garydgregory" created="Tue, 18 Aug 2015 21:48:45 +0000"  >&lt;p&gt;Would this belong in the log4j-api or core module?&lt;/p&gt;

&lt;p&gt;Can &quot;DEBUG&quot; be replaced by Level.DEBUG, that would be type safe, or are the params meant to all be key-value Strings? I wonder if some APIs could be allowed for known public types like levels and markers. OTOH, I see this kind of code being called by tools as well that would only use Strings. This could be used to generate a config file for later deployment.&lt;/p&gt;</comment>
                            <comment id="14702530" author="ralph.goers@dslextreme.com" created="Wed, 19 Aug 2015 05:44:41 +0000"  >&lt;p&gt;Although I would prefer it in the API I am not really sure that is possible. The Assembler interfaces could be in the API but the actual implementation (GenericConfigurationAssembler) would need to be in core. Furthermore, I am envisioning modifying ConfigurationFactory to look for Plugins. The XML and JSON configuration factories could be converted to Plugins and then a user could implement a custom configuration factory plugin that contains code similar to the above.&lt;/p&gt;

&lt;p&gt;While we could accept the Level and Marker as objects, they would internally be converted to Strings as the assembler is creating the same Node hierarchy that the XML and JSON configurations create.  The actual objects get created when the configuration&apos;s start() method is called. This is actually why I am calling it an &quot;Assembler&quot; instead of a &quot;Builder&quot;. With a builder I would expect that the build method would create a fully constructed Configuration with the &quot;real&quot; objects attached to it.&lt;/p&gt;

&lt;p&gt;I took Bart&apos;s advice and added some get methods to the assemblers. The resulting code would now look like:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        GenericConfigurationAssembler assembler = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GenericConfigurationAssembler();
        assembler.setStatusLevel(Level.DEBUG);
        AppenderAssembler appenderAssembler = assembler.getAppenderAssembler(&lt;span class=&quot;code-quote&quot;&gt;&quot;STDOUT&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;CONSOLE&quot;&lt;/span&gt;);
        appenderAssembler.addLayout(appenderAssembler.getLayoutAssembler(&lt;span class=&quot;code-quote&quot;&gt;&quot;PatternLayout&quot;&lt;/span&gt;).
                addAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;pattern&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;%d [%t] %-5level: %msg%n%throwable&quot;&lt;/span&gt;).assemble());
        appenderAssembler.addFilter(appenderAssembler.getFilterAssembler(&lt;span class=&quot;code-quote&quot;&gt;&quot;MarkerFilter&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;DENY&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;NEUTRAL&quot;&lt;/span&gt;).addAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;marker&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;FLOW&quot;&lt;/span&gt;).assemble());
        assembler.addAppender(appenderAssembler.assemble());
        assembler.addLogger(assembler.getLoggerAssembler(&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.logging.log4j&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;DEBUG&quot;&lt;/span&gt;).addAppenderRef(&lt;span class=&quot;code-quote&quot;&gt;&quot;CONSOLE&quot;&lt;/span&gt;).assemble());
        assembler.addRootLogger(assembler.getRootLoggerAssembler(&lt;span class=&quot;code-quote&quot;&gt;&quot;ERROR&quot;&lt;/span&gt;).addAppenderRef(&lt;span class=&quot;code-quote&quot;&gt;&quot;Console&quot;&lt;/span&gt;).assemble());
        Configuration config = assembler.assemble();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14702957" author="xennex82" created="Wed, 19 Aug 2015 12:48:41 +0000"  >&lt;p&gt;Is there a reason the &quot;getFilterAssembler()&quot; (for instance) is being called on appenderAssembler instead of assembler? As I understand it filters can be attached to many things, that would make it odd to retrieve it from the sub-assembler type object?.&lt;/p&gt;

&lt;p&gt;In a general sense, is the compositing essential here?. Does it add anything that the appenderAssembler returns the LayoutAssembler, instead of the top level assembler?....&lt;/p&gt;

&lt;p&gt;But at least now I know how you are doing it. I suspected you would be using a Node structure like the current system, but I have no idea or knowledge about its internals, nor did I know that Configuration.start() does some building.&lt;/p&gt;

&lt;p&gt;Indeed the only API I imagined would be one that had an implementation that would create a &quot;ready made&quot; Configuration together with all the objects. Regards...&lt;/p&gt;
</comment>
                            <comment id="14703290" author="garydgregory" created="Wed, 19 Aug 2015 16:31:13 +0000"  >&lt;p&gt;It would be neat to be able to transmit a config (XML, JSON, or YAML) over a socket to get Log4j to reconfigure itself, instead of overwriting the config file which log4j must be watching. The assembler should be able to do toConfiguration() toXml(), toJson(), and toYaml(); or the Configuration could understand toXml(), toJson(), and toYaml().&lt;/p&gt;

&lt;p&gt;I wonder if we&apos;d want it to be Serializable such that tools can save and load configurations.&lt;/p&gt;</comment>
                            <comment id="14703355" author="ralph.goers@dslextreme.com" created="Wed, 19 Aug 2015 16:55:44 +0000"  >&lt;p&gt;Converting the Assembly into XML or JSON should be fairly easy to do.&lt;/p&gt;</comment>
                            <comment id="14703737" author="garydgregory" created="Wed, 19 Aug 2015 21:02:54 +0000"  >&lt;p&gt;Especially easy if you use Jackson.&lt;/p&gt;</comment>
                            <comment id="14703738" author="garydgregory" created="Wed, 19 Aug 2015 21:03:09 +0000"  >&lt;p&gt;Especially easy if you use Jackson.&lt;/p&gt;</comment>
                            <comment id="14708837" author="ralph.goers@dslextreme.com" created="Mon, 24 Aug 2015 06:12:47 +0000"  >&lt;p&gt;I have implemented the ConfigurationAssembler and have also implemented support for properties files that is implemented using the ConfigurationAssembler. Note that the property file syntax is in no way compatible with version 1.x. A sample file looks like:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;filters = Threshold

filter.Threshold.type = ThresholdFilter
filter.Threshold.level = DEBUG

appenders = Stdout

appender.Stdout.type = Console
appender.Stdout.name = StdOut
appender.Stdout.target = SYSTEM_OUT
appender.Stdout.layout.type = PatternLayout
appender.Stdout.layout.pattern = %d [%t] %-5level: %msg%n%throwable
appender.Stdout.filters = marker
appender.Stdout.filter.marker.type = MarkerFilter
appender.Stdout.filter.marker.onMatch = DENY
appender.Stdout.filter.marker.onMisMatch = NEUTRAL
appender.Stdout.filter.marker.marker = FLOW

loggers = log4j

logger.log4j.name = org.apache.logging.log4j
logger.log4j.appenderRefs = console
logger.log4j.appenderRef.console.ref = StdOut
logger.log4j.level = DEBUG
logger.log4j.additivity = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;

rootLogger.appenderRefs = console
rootLogger.appenderRef.console.ref = StdOut
rootLogger.level = ERROR
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Please review and provide feedback.&lt;/p&gt;</comment>
                            <comment id="14708860" author="remkop@yahoo.com" created="Mon, 24 Aug 2015 06:33:24 +0000"  >&lt;p&gt;Ralph, is this in a branch? I&apos;d like to play with the programmatic configuration and try to see how some common configurations would be achieved programmatically. &lt;br/&gt;
Also interested in how this would work with custom user-written plugins. &lt;/p&gt;

&lt;p&gt;Personally I don&apos;t see the attraction of having a properties config format, especially since our xml format is so much more intuitive and cleaner than log4j1. (Perhaps this is simply because I haven&apos;t used properties configuration for a long time...)&lt;/p&gt;

&lt;p&gt;That said, I don&apos;t see any issues with the sample properties config you gave. It is just a sample snippet and not a complete configuration, right? I don&apos;t see any loggers (named or root) with an appender-ref to the appenders. Come to think of it, how would one specify the case where a logger has multiple appenders at different levels?&lt;/p&gt;

&lt;p&gt;I guess we&apos;d need a manual page explaining which attributes (? keys?) are mandatory for which lookups/appenders/filters etc. &lt;/p&gt;</comment>
                            <comment id="14708864" author="ralph.goers@dslextreme.com" created="Mon, 24 Aug 2015 06:40:22 +0000"  >&lt;p&gt;No, it is not in a branch. You should be able to apply the patch to master. Note though that one of the unit test that was recently added is failing even before applying the patch.&lt;/p&gt;

&lt;p&gt;I added the support for properties because people keep asking about it and it was very useful in proving the assembler works.&lt;/p&gt;

&lt;p&gt;If you guys are ok with this then I will create the documentation separately.&lt;/p&gt;

&lt;p&gt;You would specify multiple appenderrefs on the logger. However I may have forgotten to support a level on the appenderref.&lt;/p&gt;</comment>
                            <comment id="14708881" author="garydgregory" created="Mon, 24 Aug 2015 07:15:44 +0000"  >&lt;p&gt;Have a different a properties file format than in version 1 begs for a version = 2 key-value pair.&lt;/p&gt;

&lt;p&gt;Is it possible to implement a v1 compatibility assembler/config?&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;</comment>
                            <comment id="14709192" author="ralph.goers@dslextreme.com" created="Mon, 24 Aug 2015 12:42:36 +0000"  >&lt;p&gt;The log4j1 file contains class names for appenders, etc. and the components have different parameters, so they could never really be compatible except in the simplest use case.&lt;/p&gt;

&lt;p&gt;To be honest, I never really understood the v1 format. The format I used is very similar to what Flume does.&lt;/p&gt;</comment>
                            <comment id="14709391" author="ralph.goers@dslextreme.com" created="Mon, 24 Aug 2015 14:40:29 +0000"  >&lt;p&gt;Updated the patch to include Filters and level on AppenderRef&lt;/p&gt;</comment>
                            <comment id="14711195" author="remkop@yahoo.com" created="Tue, 25 Aug 2015 12:42:31 +0000"  >&lt;p&gt;Finally had a chance to look at the patch. I like it. Looks clean and easy to read.&lt;/p&gt;

&lt;p&gt;FYI (minor detail) there is still a compilation error in /log4j-core/src/test/java/org/apache/logging/log4j/core/config/assembler/CustomConfigurationFactory.java: &quot;The method addAppenderRef(Component) in the type LoggerAssembler is not applicable for the arguments (String)&quot;&lt;/p&gt;

&lt;p&gt;The properties format support is also nice in that there is not much code. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;You provide some convenience methods to make it easy for users to add sub-components, like &lt;tt&gt;AppenderAssembler.addLayout&lt;/tt&gt; and &lt;tt&gt;AppenderAssembler.addFilter&lt;/tt&gt;. Otherwise, users need to call the &lt;tt&gt;addSubComponent&lt;/tt&gt; method. Is this powerful enough to support complex nested constructions like needed for &lt;tt&gt;RoutingAppender&lt;/tt&gt;?&lt;/p&gt;

&lt;p&gt;For example, what would a RollingFile appender like the below look like in a code-based configuration?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &amp;lt;Appenders&amp;gt;
    &amp;lt;RollingRandomAccessFile name=&lt;span class=&quot;code-quote&quot;&gt;&quot;RollingRandomAccessFile&quot;&lt;/span&gt; fileName=&lt;span class=&quot;code-quote&quot;&gt;&quot;logs/app.log&quot;&lt;/span&gt;
                 filePattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;logs/$${date:yyyy-MM}/app-%d{MM-dd-yyyy}-%i.log.gz&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;PatternLayout&amp;gt;
        &amp;lt;Pattern&amp;gt;%d %p %c{1.} [%t] %m%n&amp;lt;/Pattern&amp;gt;
      &amp;lt;/PatternLayout&amp;gt;
      &amp;lt;Policies&amp;gt;
        &amp;lt;TimeBasedTriggeringPolicy /&amp;gt;
        &amp;lt;SizeBasedTriggeringPolicy size=&lt;span class=&quot;code-quote&quot;&gt;&quot;250 MB&quot;&lt;/span&gt;/&amp;gt;
      &amp;lt;/Policies&amp;gt;
      &amp;lt;DefaultRolloverStrategy max=&lt;span class=&quot;code-quote&quot;&gt;&quot;20&quot;&lt;/span&gt;/&amp;gt;
    &amp;lt;/RollingRandomAccessFile&amp;gt;
  &amp;lt;/Appenders&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Would it look like this?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ConfigurationAssembler&amp;lt;AssembledConfiguration&amp;gt; cfgAssembler = getConfigurationAssembler();
AppenderAssembler appenderAssembler = cfgAssembler
    .getAppenderAssembler(&lt;span class=&quot;code-quote&quot;&gt;&quot;rolling&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;RollingRandomAccessFile&quot;&lt;/span&gt;)
        .addAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;fileName&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;logs/app.log&quot;&lt;/span&gt;)
        .addAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;filePattern&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;logs/$${date:yyyy-MM}/app-%d{MM-dd-yyyy}-%i.log.gz&quot;&lt;/span&gt;);
appenderAssembler.addLayout(cfgAssembler.getLayoutAssembler(&lt;span class=&quot;code-quote&quot;&gt;&quot;PatternLayout&quot;&lt;/span&gt;)
        .addAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;pattern&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;%d %p %c{1.} [%t] %m%n&quot;&lt;/span&gt;).assemble());

ComponentAssembler policiesAssembler = cfgAssembler
    .getComponentAssembler(&lt;span class=&quot;code-quote&quot;&gt;&quot;policies&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;Policies&quot;&lt;/span&gt;);
ComponentAssembler timeBasedAssembler = cfgAssembler
    .getComponentAssembler(&lt;span class=&quot;code-quote&quot;&gt;&quot;time&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;TimeBasedTriggeringPolicy&quot;&lt;/span&gt;);
ComponentAssembler sizeBasedAssembler = cfgAssembler
    .getComponentAssembler(&lt;span class=&quot;code-quote&quot;&gt;&quot;size&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;SizeBasedTriggeringPolicy&quot;&lt;/span&gt;)
        .addAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;size&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;250 MB&quot;&lt;/span&gt;);

policiesAssembler.addSubComponent(timeBasedAssembler.assemble());
policiesAssembler.addSubComponent(sizeBasedAssembler.assemble());

appenderAssembler.addSubComponent(policiesAssembler.assemble());

ComponentAssembler rollStrategyAssembler = cfgAssembler
    .getComponentAssembler(&lt;span class=&quot;code-quote&quot;&gt;&quot;rollStrategy&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;DefaultRolloverStrategy&quot;&lt;/span&gt;)
        .addAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;max&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;20&quot;&lt;/span&gt;);
appenderAssembler.addSubComponent(rollStrategyAssembler.assemble());

cfgAssembler.addAppender(appenderAssembler.assemble());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Do components need to have a name? In XML, TimeBasedTriggeringPolicy does not need a name. Can names be null or empty strings or is anything ok?&lt;/p&gt;

&lt;p&gt;Can we provide convenience methods for &lt;tt&gt;AsyncLogger&lt;/tt&gt; and &lt;tt&gt;AsyncRootLogger&lt;/tt&gt;?&lt;/p&gt;

&lt;p&gt;Finally, we need to document what steps users need to take to use either a properties configuration or a code-based configuration. In addition, it would be good to have an extensive example (like CustomConfigurationFactory, with a Properties example and a RollingFile appender) for both properties and code-based config. &lt;/p&gt;</comment>
                            <comment id="14712554" author="ralph.goers@dslextreme.com" created="Wed, 26 Aug 2015 05:53:17 +0000"  >&lt;p&gt;The hope is that using addComponent allows you to add anything. The others are just convenience methods. Technically we could create component assemblers for all the plugins but that seems a bit overboard. I should also point out that if you look at the specific Assemblers they are all just a thin wrapper around the ComponentAssembler. It should be very simple for users to create their wrapper objects for any custom components they build.&lt;/p&gt;

&lt;p&gt;Without actually copying your sample above into a Java class and trying it I would say what you have looks like what I would expect.&lt;/p&gt;

&lt;p&gt;Components are only required to have a name when the Plugin requires it.&lt;/p&gt;

&lt;p&gt;Yes, I need to add AsyncLogger and AsyncRootLogger. I also forgot to add CustomLevels. I will take care of that.&lt;/p&gt;

&lt;p&gt;Yes, if I get confirmation that you guys think this is the right way to go I will add documentation after I commit the code. Yes, both the programmatic and properties configuration need more examples. That said, the PropertiesConfigurationFactory is a pretty good example of how to use the assembler.&lt;/p&gt;
</comment>
                            <comment id="14716147" author="ralph.goers@dslextreme.com" created="Thu, 27 Aug 2015 06:18:29 +0000"  >&lt;p&gt;Updated version of the patch. Includes CustomLevels and support for AsyncRoot and AsyncLogger (although I haven&apos;t tested either yet).  Added another properties file configuration that contains a rolling file appender.&lt;/p&gt;</comment>
                            <comment id="14716879" author="ralph.goers@dslextreme.com" created="Thu, 27 Aug 2015 15:38:16 +0000"  >&lt;p&gt;Updated to fourth version of the patch to show both the time and size trigerring policies in the properties.&lt;/p&gt;</comment>
                            <comment id="14717987" author="remkop@yahoo.com" created="Fri, 28 Aug 2015 03:13:48 +0000"  >&lt;p&gt;Reviewed patch 4. This looks very nice. A lot of careful work went into this. I like it a lot.&lt;/p&gt;</comment>
                            <comment id="14717996" author="ralph.goers@dslextreme.com" created="Fri, 28 Aug 2015 03:22:46 +0000"  >&lt;p&gt;Thanks. I will wait for feedback from Gary. If he is OK with it I will commit it this weekend and work on getting the doc updated and hopefully get a couple more properties files examples.&lt;/p&gt;

&lt;p&gt;I still have to finish the work on &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1102&quot; title=&quot;Follow up: remaining tasks related to introducing FastDateFormat&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1102&quot;&gt;LOG4J2-1102&lt;/a&gt; as well.&lt;/p&gt;</comment>
                            <comment id="14718085" author="garydgregory" created="Fri, 28 Aug 2015 05:39:25 +0000"  >&lt;p&gt;Ralph, &lt;br/&gt;
Nice work!&lt;br/&gt;
Great stuff!&lt;/p&gt;

&lt;p&gt;Here are my notes; hopefully taken as well-intentioned, respectful and constructive criticism. (It&apos;s tricky when not in person sometimes!)&lt;/p&gt;

&lt;p&gt;In the text below, I tried to sort from most to least important but it&apos;s all important really &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;Right now, it looks like we have two ways to use an assembler: Through a properties file (which uses a &lt;tt&gt;ConfigurationFactory&lt;/tt&gt;) or a programatically with a custom &lt;tt&gt;ConfigurationFactory&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;For programmatic configuration, being forced to write a custom &lt;tt&gt;ConfigurationFactory&lt;/tt&gt; feels too twisty to me. &lt;/p&gt;

&lt;p&gt;I should just be able to write my assembler code (pun not intended, more on the name later) and feed it to the &lt;tt&gt;Configurator&lt;/tt&gt;. Yes, I can still do it with a &lt;tt&gt;ConfigurationFactory&lt;/tt&gt;, which seems nice for other use cases, like the properties file case.&lt;/p&gt;

&lt;p&gt;This feels more natural:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Configuation configuation = assembler.assemble();
Configurator.initialize(classloader, configuation);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;How do we get the assembler is for later in this text.&lt;/p&gt;

&lt;p&gt;We already have &lt;tt&gt;Configurator.initialize(ClassLoader, ConfigurationSource)&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;If &lt;tt&gt;ConfigurationSource&lt;/tt&gt; supports &lt;tt&gt;Assembler&lt;/tt&gt;, then I could say:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Configurator.initialize(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ConfigurationSource(assembler));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And we do not need &lt;tt&gt;Configurator.initialize(classloader, configuation)&lt;/tt&gt; except for convenience.&lt;/p&gt;

&lt;p&gt;We then need an &lt;tt&gt;AssemblerConfigurationFactory&lt;/tt&gt; that extends &lt;tt&gt;ConfigurationFactory&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Back to the question of where Assemblers come from; the patch provides:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ConfigurationFactory.getConfigurationAssembler()&lt;/li&gt;
	&lt;li&gt;ConfigurationFactory.getConfigurationAssembler(Class&amp;lt;T&amp;gt;)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;But this &lt;b&gt;really&lt;/b&gt; feels in the wrong place to me. A &lt;tt&gt;ConfigurationFactory&lt;/tt&gt; should return &lt;tt&gt;Configuration}}s, but since an {{Assembler&lt;/tt&gt; &lt;em&gt;produces&lt;/em&gt; {{Configuration}}s, then maybe it&apos;s OK. I&apos;m not 100% sold on that though.&lt;/p&gt;

&lt;p&gt;Having an &lt;tt&gt;AssemblerFactory&lt;/tt&gt; seems like the obvious answer. This then let&apos;s me write code that steers clear of &lt;tt&gt;ConfigurationFactory&lt;/tt&gt;:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Assembler assembler = AssemblerFactory.getConfigurationAssembler();
&lt;span class=&quot;code-comment&quot;&gt;// ... build up assembler ...
&lt;/span&gt;Configuation configuation = assembler.assemble();
Configurator.initialize(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ConfigurationSource(assembler));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;p&gt;I&apos;m not crazy about the term &quot;assembler&quot;. We are not using &quot;builder&quot; because... it&apos;s used to build plugin instances here and there? That does not seem like strong enough a reason.&lt;/p&gt;

&lt;p&gt;Looking back at the &apos;gang of four&apos; book, &quot;Builder&quot; really fits what we are doing here. I looked at the other Creational Pattern and the Abstract Factory could fit the bill too. &lt;/p&gt;

&lt;p&gt;It&apos;s just that I&apos;ve not seen the term &apos;assembler&apos; used like this before and it feels weird and violates (for me) the Principle of Least Astonishment. &lt;/p&gt;

&lt;p&gt;I feel like I need to explain to users why it&apos;s am assembler and not a builder or a factory. We should not have to do that or cause users to think about it.&lt;/p&gt;

&lt;p&gt;Going back to the code, the &lt;tt&gt;Assembler&lt;/tt&gt; class is exactly like the class &lt;tt&gt;org.apache.logging.log4j.core.util.Builder&lt;/tt&gt;, so that&apos;s lame (IMO), we should at least reuse &lt;tt&gt;Builder&lt;/tt&gt;. It would be (XP) smelly not to.&lt;/p&gt;

&lt;p&gt;I&apos;m starting to feel &quot;builder&quot; over &quot;assembler&quot; more and more but I do not know of your full reasoning so I&apos;ll stop here and let you reply.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;The test has code like:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        assembler.addAppender(appenderAssembler.assemble());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The assemble() method is called all over the place. That does not feel right. It&apos;s surfaces too many of the mechanics. Why not have a method &lt;tt&gt;ConfigurationAssembler.addAppender(AppenderAssembler)&lt;/tt&gt; that does the assemble on my behalf?&lt;/p&gt;

&lt;p&gt;In fact, I claim that we can have a more generic method: &lt;tt&gt;ConfigurationAssembler.add(Assembler)&lt;/tt&gt; that does the right thing based on the argument. The patch has:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Configuration getConfiguration(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; URI configLocation) {
        ConfigurationAssembler&amp;lt;AssembledConfiguration&amp;gt; assembler = getConfigurationAssembler();
        assembler.setStatusLevel(Level.ERROR);
        assembler.addFilter(
                assembler.getFilterAssembler(&lt;span class=&quot;code-quote&quot;&gt;&quot;ThresholdFilter&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;ACCEPT&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;NEUTRAL&quot;&lt;/span&gt;).addAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;level&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;DEBUG&quot;&lt;/span&gt;)
                        .assemble());
        AppenderAssembler appenderAssembler = assembler.getAppenderAssembler(&lt;span class=&quot;code-quote&quot;&gt;&quot;Stdout&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;CONSOLE&quot;&lt;/span&gt;).addAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;target&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;SYSTEM_OUT&quot;&lt;/span&gt;);
        appenderAssembler.addLayout(assembler.getLayoutAssembler(&lt;span class=&quot;code-quote&quot;&gt;&quot;PatternLayout&quot;&lt;/span&gt;).
                addAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;pattern&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;%d [%t] %-5level: %msg%n%throwable&quot;&lt;/span&gt;).assemble());
        appenderAssembler.addFilter(
                assembler.getFilterAssembler(&lt;span class=&quot;code-quote&quot;&gt;&quot;MarkerFilter&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;DENY&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;NEUTRAL&quot;&lt;/span&gt;).addAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;marker&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;FLOW&quot;&lt;/span&gt;).
                        assemble());
        assembler.addAppender(appenderAssembler.assemble());
        assembler.addLogger(assembler.getLoggerAssembler(&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.logging.log4j&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;DEBUG&quot;&lt;/span&gt;).
                addAppenderRef(assembler.getAppenderRefAssembler(&lt;span class=&quot;code-quote&quot;&gt;&quot;Stdout&quot;&lt;/span&gt;).assemble()).
                addAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;additivity&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;).assemble());
        assembler.addRootLogger(assembler.getRootLoggerAssembler(&lt;span class=&quot;code-quote&quot;&gt;&quot;ERROR&quot;&lt;/span&gt;)
                .addAppenderRef(assembler.getAppenderRefAssembler(&lt;span class=&quot;code-quote&quot;&gt;&quot;Stdout&quot;&lt;/span&gt;).assemble()).assemble());
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; assembler.assemble();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Just &lt;tt&gt;addAppender(AppenderAssembler)&lt;/tt&gt; and similar methods would give us:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Configuration getConfiguration(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; URI configLocation) {
        ConfigurationAssembler&amp;lt;AssembledConfiguration&amp;gt; assembler = getConfigurationAssembler();
        assembler.setStatusLevel(Level.ERROR);
        assembler.addFilter(
                assembler.getFilterAssembler(&lt;span class=&quot;code-quote&quot;&gt;&quot;ThresholdFilter&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;ACCEPT&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;NEUTRAL&quot;&lt;/span&gt;).addAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;level&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;DEBUG&quot;&lt;/span&gt;));
        AppenderAssembler appenderAssembler = assembler.getAppenderAssembler(&lt;span class=&quot;code-quote&quot;&gt;&quot;Stdout&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;CONSOLE&quot;&lt;/span&gt;).addAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;target&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;SYSTEM_OUT&quot;&lt;/span&gt;);
        appenderAssembler.addLayout(assembler.getLayoutAssembler(&lt;span class=&quot;code-quote&quot;&gt;&quot;PatternLayout&quot;&lt;/span&gt;).
                addAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;pattern&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;%d [%t] %-5level: %msg%n%throwable&quot;&lt;/span&gt;));
        appenderAssembler.addFilter(
                assembler.getFilterAssembler(&lt;span class=&quot;code-quote&quot;&gt;&quot;MarkerFilter&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;DENY&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;NEUTRAL&quot;&lt;/span&gt;).addAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;marker&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;FLOW&quot;&lt;/span&gt;));
        assembler.addAppender(appenderAssembler);
        assembler.addLogger(assembler.getLoggerAssembler(&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.logging.log4j&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;DEBUG&quot;&lt;/span&gt;).
                addAppenderRef(assembler.getAppenderRefAssembler(&lt;span class=&quot;code-quote&quot;&gt;&quot;Stdout&quot;&lt;/span&gt;)).
                addAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;additivity&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;));
        assembler.addRootLogger(assembler.getRootLoggerAssembler(&lt;span class=&quot;code-quote&quot;&gt;&quot;ERROR&quot;&lt;/span&gt;)
                .addAppenderRef(assembler.getAppenderRefAssembler(&lt;span class=&quot;code-quote&quot;&gt;&quot;Stdout&quot;&lt;/span&gt;)));
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; assembler.assemble();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Seing code that first calls &lt;tt&gt;getFilterAssembler()&lt;/tt&gt;, then &lt;tt&gt;addFilter()&lt;/tt&gt; seems redundant; I built a filter, it&apos;s typed as such, now I want to add it, but do I really have to say &quot;add filter&quot; vs. just &quot;add&quot;?&lt;/p&gt;

&lt;p&gt;A smart &lt;tt&gt;add()&lt;/tt&gt; would give us:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Configuration getConfiguration(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; URI configLocation) {
        ConfigurationAssembler&amp;lt;AssembledConfiguration&amp;gt; assembler = getConfigurationAssembler();
        assembler.setStatusLevel(Level.ERROR);
        assembler.add(
                assembler.getFilterAssembler(&lt;span class=&quot;code-quote&quot;&gt;&quot;ThresholdFilter&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;ACCEPT&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;NEUTRAL&quot;&lt;/span&gt;).addAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;level&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;DEBUG&quot;&lt;/span&gt;));
        AppenderAssembler appenderAssembler = assembler.getAppenderAssembler(&lt;span class=&quot;code-quote&quot;&gt;&quot;Stdout&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;CONSOLE&quot;&lt;/span&gt;).addAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;target&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;SYSTEM_OUT&quot;&lt;/span&gt;);
        appenderAssembler.add(assembler.getLayoutAssembler(&lt;span class=&quot;code-quote&quot;&gt;&quot;PatternLayout&quot;&lt;/span&gt;).
                addAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;pattern&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;%d [%t] %-5level: %msg%n%throwable&quot;&lt;/span&gt;));
        appenderAssembler.add(
                assembler.getFilterAssembler(&lt;span class=&quot;code-quote&quot;&gt;&quot;MarkerFilter&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;DENY&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;NEUTRAL&quot;&lt;/span&gt;).addAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;marker&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;FLOW&quot;&lt;/span&gt;));
        assembler.add(appenderAssembler);
        assembler.add(assembler.getLoggerAssembler(&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.logging.log4j&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;DEBUG&quot;&lt;/span&gt;).
                add(assembler.getAppenderRefAssembler(&lt;span class=&quot;code-quote&quot;&gt;&quot;Stdout&quot;&lt;/span&gt;)).
                addAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;additivity&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;));
        assembler.addRootLogger(assembler.getRootLoggerAssembler(&lt;span class=&quot;code-quote&quot;&gt;&quot;ERROR&quot;&lt;/span&gt;)
                .add(assembler.getAppenderRefAssembler(&lt;span class=&quot;code-quote&quot;&gt;&quot;Stdout&quot;&lt;/span&gt;)));
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; assembler.assemble();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Pushing it further, since I am talking to an assembler, do I really need to say &lt;tt&gt;getFilterAssembler()&lt;/tt&gt; vs. &lt;tt&gt;getFilter&lt;/tt&gt;. These get APIs only returns assemblers, there cannot be any confusion. So, removing the &quot;Assembler&quot; suffix, we have:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Configuration getConfiguration(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; URI configLocation) {
        ConfigurationAssembler&amp;lt;AssembledConfiguration&amp;gt; assembler = getConfigurationAssembler();
        assembler.setStatusLevel(Level.ERROR);
        assembler.add(
                assembler.getFilter(&lt;span class=&quot;code-quote&quot;&gt;&quot;ThresholdFilter&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;ACCEPT&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;NEUTRAL&quot;&lt;/span&gt;).addAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;level&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;DEBUG&quot;&lt;/span&gt;));
        AppenderAssembler appenderAssembler = assembler.getAppender(&lt;span class=&quot;code-quote&quot;&gt;&quot;Stdout&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;CONSOLE&quot;&lt;/span&gt;).addAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;target&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;SYSTEM_OUT&quot;&lt;/span&gt;);
        appenderAssembler.add(assembler.getLayout(&lt;span class=&quot;code-quote&quot;&gt;&quot;PatternLayout&quot;&lt;/span&gt;).
                addAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;pattern&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;%d [%t] %-5level: %msg%n%throwable&quot;&lt;/span&gt;));
        appenderAssembler.add(
                assembler.getFilter(&lt;span class=&quot;code-quote&quot;&gt;&quot;MarkerFilter&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;DENY&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;NEUTRAL&quot;&lt;/span&gt;).addAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;marker&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;FLOW&quot;&lt;/span&gt;));
        assembler.add(appenderAssembler);
        assembler.add(assembler.getLogger(&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.logging.log4j&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;DEBUG&quot;&lt;/span&gt;).
                add(assembler.getAppenderRef(&lt;span class=&quot;code-quote&quot;&gt;&quot;Stdout&quot;&lt;/span&gt;)).
                addAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;additivity&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;));
        assembler.addRootLogger(assembler.getRootLogger(&lt;span class=&quot;code-quote&quot;&gt;&quot;ERROR&quot;&lt;/span&gt;)
                .add(assembler.getAppenderRef(&lt;span class=&quot;code-quote&quot;&gt;&quot;Stdout&quot;&lt;/span&gt;)));
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; assembler.assemble();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Better?&lt;/p&gt;

&lt;p&gt;The &quot;get&quot; prefix is another one I am not sure about, because these are all factory methods, so &quot;new&quot; would be better. Unless these can be cached?&lt;/p&gt;

&lt;p&gt;With new:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Configuration getConfiguration(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; URI configLocation) {
        ConfigurationAssembler&amp;lt;AssembledConfiguration&amp;gt; assembler = getConfigurationAssembler();
        assembler.setStatusLevel(Level.ERROR);
        assembler.add(
                assembler.newFilter(&lt;span class=&quot;code-quote&quot;&gt;&quot;ThresholdFilter&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;ACCEPT&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;NEUTRAL&quot;&lt;/span&gt;).addAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;level&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;DEBUG&quot;&lt;/span&gt;));
        AppenderAssembler appenderAssembler = assembler.newAppender(&lt;span class=&quot;code-quote&quot;&gt;&quot;Stdout&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;CONSOLE&quot;&lt;/span&gt;).addAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;target&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;SYSTEM_OUT&quot;&lt;/span&gt;);
        appenderAssembler.add(assembler.newLayout(&lt;span class=&quot;code-quote&quot;&gt;&quot;PatternLayout&quot;&lt;/span&gt;).
                addAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;pattern&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;%d [%t] %-5level: %msg%n%throwable&quot;&lt;/span&gt;));
        appenderAssembler.add(
                assembler.newFilter(&lt;span class=&quot;code-quote&quot;&gt;&quot;MarkerFilter&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;DENY&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;NEUTRAL&quot;&lt;/span&gt;).addAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;marker&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;FLOW&quot;&lt;/span&gt;));
        assembler.add(appenderAssembler);
        assembler.add(assembler.newLogger(&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.logging.log4j&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;DEBUG&quot;&lt;/span&gt;).
                add(assembler.newAppenderRef(&lt;span class=&quot;code-quote&quot;&gt;&quot;Stdout&quot;&lt;/span&gt;)).
                addAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;additivity&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;));
        assembler.addRootLogger(assembler.newRootLogger(&lt;span class=&quot;code-quote&quot;&gt;&quot;ERROR&quot;&lt;/span&gt;)
                .add(assembler.newAppenderRef(&lt;span class=&quot;code-quote&quot;&gt;&quot;Stdout&quot;&lt;/span&gt;)));
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; assembler.assemble();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Better?&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;In the test I see:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        AppenderAssembler appenderAssembler = assembler.getAppenderAssembler(&lt;span class=&quot;code-quote&quot;&gt;&quot;Stdout&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;CONSOLE&quot;&lt;/span&gt;).addAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;target&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;SYSTEM_OUT&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And the Javadoc says:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    /**
     * Returns an Assembler &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; creating Appenders.
     * @param name The name of the Appender.
     * @param type The Plugin type of the Appender.
     * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; the AppenderAssembler.
     */
    AppenderAssembler getAppenderAssembler(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; type);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But the only way I see this of matching up is if the &quot;type&quot; argument matches the &lt;tt&gt;ConsoleAppeder&lt;/tt&gt;&apos;s &lt;tt&gt;@Plugin name&lt;/tt&gt;. &lt;br/&gt;
If that is indeed the case, the parameter name should be changed to &quot;pluginName&quot;. That makes it obvious and connects the dots for the reader.&lt;/p&gt;

&lt;p&gt;This comment applies to other APIs.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;What is the argument &lt;em&gt;against&lt;/em&gt; having:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    FilterAssembler getFilterAssembler(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; type, Filter.Result onMatch, Filter.Result onMisMatch);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This could be an &lt;em&gt;additional&lt;/em&gt; API, or replace the current String-based API, not sure.&lt;/p&gt;

&lt;p&gt;Same idea for APIs that take String levels.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;In &lt;tt&gt;org.apache.logging.log4j.core.config.ConfigurationFactory.getConfigurationAssembler(Class&amp;lt;T&amp;gt;)&lt;/tt&gt;, this is redundant:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DefaultConfigurationAssembler&amp;lt;T&amp;gt;(clazz);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Instead, say:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DefaultConfigurationAssembler&amp;lt;&amp;gt;(clazz);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note the use of Java 7 diamond notation.&lt;/p&gt;

&lt;p&gt;There are other generics clean ups we can do later, once other issues are settled.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;org.apache.logging.log4j.core.config.assembler.api&lt;br/&gt;
org.apache.logging.log4j.core.config.assembler.impl	&lt;/p&gt;

&lt;p&gt;If there are two packages then the &lt;tt&gt;impl&lt;/tt&gt; classes must be public. If you put all types in the same package, you can make the impl classes package private. One less worry about people using stuff they&apos;re not supposed to. Unless you &lt;b&gt;mean&lt;/b&gt; for the impl classes to be publicly used.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14718118" author="ralph.goers@dslextreme.com" created="Fri, 28 Aug 2015 06:31:01 +0000"  >&lt;p&gt;Wow your update is long!&lt;/p&gt;

&lt;p&gt;1. I have shown two ways to use the assembler. I implemented the PropertiesConfiguration with it just as an example of how it could be used. The CustomConfiguration is a way to do it purely programmatically.  There is no reason Configurator couldn&apos;t have an initialize method as you have shown. However, you will get the error that says no configuration was provided since the initial configuration is created when you call getContext(). To avoid that you MUST use a ConfigurationFactory.&lt;br/&gt;
2. I wanted to expose an API that we could guarantee and hide the implementation. I did not want users to use DefaultConfigurationAssembler directly. The most logical way to do that seemed to me to put the methods in the ConfigurationFactory class.&lt;br/&gt;
3. As I said previously, I didn&apos;t use &quot;Builder&quot; because I thought it gave the wrong impression. I would expect the build() method of a Builder to return the actual object. The assembler returns Components, not Appenders, Loggers, etc. I also expect that when Matt returns he may want to continue his work on creating &quot;real&quot; builders for everything. I did not want to raise the potential for a conflict with that.  &quot;Assembler&quot; seemed like it conveyed a similar enough meaning to Builder and frankly, it was the only other word I could think of.&lt;br/&gt;
4. I agree with everything else down to &quot;This comment applies to other APIs&quot;. I will try making those changes and see how it works out.&lt;br/&gt;
5. The only argument against using the concrete types is probably weak. They all have to be converted back to Strings as that is all Nodes can accept during the first pass of construction. AbstractConfiguration creates the actual objects based on the Plugin factory/builder.  Obviously, the ComponentAssembler can only accept Strings.&lt;br/&gt;
6. Generics gave me tons of headaches trying to eliminate all the warning messages. In the end it was impossible and I just had to suppress them. So I have no idea at this point if changing &amp;lt;T&amp;gt; to &amp;lt;&amp;gt; is going to cause one to pop back up. FWIW, I noticed a change you made yesterday to the Configuration class caused warnings to pop up all over the place. I had to modify AbstractConfiguration to suppress the warning there to make them all go away.&lt;br/&gt;
7. I think there is an error in your statement above. What do you mean the impl classes must be public? Yes, the intention is to make the API public and give it the same guarantee that we have to log4j-api. The only impl class users should use is to extend AssembledConfiguration as PropertiesConfiguration does. I believe DefaultConfigurationAssembler has to be public so ConfigurationFactory can access it.&lt;/p&gt;
</comment>
                            <comment id="14718315" author="xennex82" created="Fri, 28 Aug 2015 10:15:05 +0000"  >&lt;p&gt;Pff. Confusing, everything. I think the assembler solution you have arrived at is confusing in any case... &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;

&lt;p&gt;One, thing, first:&lt;/p&gt;

&lt;p&gt;The change from &lt;tt&gt;get&lt;/tt&gt; methods to &lt;tt&gt;new&lt;/tt&gt; methods is the best one you have suggested, Gary! That feels really good. Indeed they are all factory or construction things.&lt;/p&gt;

&lt;p&gt;Look, I am not much a fan of the &quot;Builder&quot; pattern because I&apos;m not much fan of &lt;em&gt;patterns&lt;/em&gt;. Whenever someone talks about &quot;design patterns&quot; I try to run away as far as I can because it kills me, it kills the vibe, it kills the spirit. Programming is fun and creative, but these patterns are boring and reactive. They seem to think or agree that there is a set way of doing things, when creativity is the opposite of that.&lt;/p&gt;

&lt;p&gt;So I agree with ralph  that you have to think outside of the box and feel what feels right for you.&lt;/p&gt;

&lt;p&gt;The problem I have with your solution Gary to not call &lt;tt&gt;.assemble()&lt;/tt&gt; yourself, is that you have an object that is half finished; by using compositing assemblers; it is exposed ANYWAY. You either choose NOT to expose them (and not have to deal with assemble() calls at all in the public interface) or you choose to expose them and complete the assembling/building.&lt;/p&gt;

&lt;p&gt;Because what happens if a user does call assemble() even when it is not intended? Are you going to make it protected? That will make it even more ugly.&lt;/p&gt;

&lt;p&gt;Like I&apos;ve said before &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1095&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;in LOG4J2-1095&lt;/a&gt; I feel the only right way is to use specifications. I also don&apos;t like the &quot;factory&quot; pattern as a must for doing things. Why a factory? Why these factories everywhere? Java is littered with them. And with &quot;impl&quot; classes and methods. I do not understand that. My mind is very intuitive and it does not understand that. It will have to &lt;em&gt;learn&lt;/em&gt; that, it does not come of itself, because it is not truth.&lt;/p&gt;

&lt;p&gt;I think you should have a very good reason for using a factory, if you don&apos;t have it, don&apos;t use it. The Log4J framework uses factories in one of these ill places for which there is not really a good reason (other than conforming to the pattern). So you have to work with that which makes any solution that actually is really elegant, it has to become less elegant to fit in, or rather, in order to harmonize it has to fit the existing model.&lt;/p&gt;

&lt;p&gt;Not wanting to insult the framework here &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;

&lt;p&gt;So when I see this API and IMPL packages I immediately get scared and want to run away &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. And it becomes incomprehensible to me.&lt;/p&gt;

&lt;p&gt;Because it&apos;s just a pattern that someone made up for no good reason. (The worst is the _anti_patterns. People who start to discuss everything people do WRONG; how insightful, how constructive, how embellishing, how nurturing!). I guess I&apos;m one of those now, I&apos;m anti-patterning the anti-pattern &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/tongue.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;

&lt;p&gt;Anyway, let&apos;s see if Gary made more good comments.&lt;/p&gt;

&lt;p&gt;Assembler vs. Builder. You see we are in a pinch because you can feel and Ralph does feel likely and apparently and perhaps obviously (so) that the builder &apos;pattern&apos; in itself might not be suitable.&lt;/p&gt;

&lt;p&gt;There is really very little reason, for instance, to actually make a Builder interface. How many times do you really need to pass abstract builder instances around? That you type with generics?. I mean generic builder instances that implement some master interface? It is a bit weird and redundant. The only purpose such an interface really has is to &quot;designate it as a pattern use case&quot;. It&apos;s a signature, nothing more, but not for the compiler, but for the programmer who cares about these things. From a functional perspective it&apos;s a bit superfluous. Much like generics itself, it&apos;s not very functional for the execution of actual programming code. If an apple falls from the tree and lands on my head, I do not care about what some God has written about how apples /should/ fall, I only care about the fact that it bounces off and I can eat it.&lt;/p&gt;

&lt;p&gt;So we are like researching, you and I, and Ralph mostly with the code he has written, which is of course very instructive perhaps only how not to do it &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; but in any case it is something that makes everything clearer, as he said to me when he wanted me to write real code in the emails or that he would like to write real code instead of only debating.&lt;/p&gt;

&lt;p&gt;So the code is a great advancement, that at first. So thank you people in any case &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;

&lt;p&gt;And I know I&apos;m probably a turd in saying these things and an arrogant asshole, but still.&lt;/p&gt;

&lt;p&gt;When I devised my idea for Behrooz or what&apos;s his name&apos;s existing code offering I was not all that happy about SpecificationBuilder.newAppenderSpecBuilder() either of course. That&apos;s the compositing thing.&lt;/p&gt;

&lt;p&gt;I was hinting at SpecificationBuilder.addAppender(real, parameters, for, that, thing) without any compositing taking place, or even SpecificationBuilder.addAppender(&quot;name).setParam().setParam();, which is still the best thing I have come up with, even if it is incongruent or even a bit dissonant with itself.&lt;/p&gt;

&lt;p&gt;You see &lt;tt&gt;SpecificationBuilder.addAppender()&lt;/tt&gt; would result a AppenderSpecBuilder &amp;#8211; what would happen is this:.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;addAppender registers the new SpecBuilder(of type Appender)&lt;/li&gt;
	&lt;li&gt;the registered object takes new values from its setParam or addAttribute or whatever methods&lt;/li&gt;
	&lt;li&gt;there is never any build method called on the thing because there is no build method or perhaps it is hidden; in any case when the specification is processed it is checked for incomplete objects (mandatory arguments) and such; this is at the time probably of creating the Configuration; by the factory that receives the specification. It could also be earlier but I would think validation is best when it is actually used.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Here is the key: by using a thing like this, we are using a more scripting approach than a compile-type-thing approach. Even the regular config files for Log4J are a scripting approach; they are validated when used, not at &quot;compile time&quot; (when you write the spec in your text editor). It is important to understand that an XML file is also a SPEC.&lt;/p&gt;

&lt;p&gt;And the Node Tree that results from it is also a SPEC.&lt;/p&gt;

&lt;p&gt;And the configuration that results from it (it is created now with &lt;tt&gt;start()&lt;/tt&gt; but I really think THAT is TOO late, but that aside for now) &amp;#8212; why should START be the thing that CREATES? It makes no sense really..... &lt;/p&gt;

&lt;p&gt;but if the solution has to fall within THAT system, it would probably be suboptimal from a good user&apos;s point of view.&lt;/p&gt;

&lt;p&gt;Everything is intertwined and the &apos;feel&apos; of one part of the system is going to be the same as the feel of another part in the system, because the system has to function as a whole. If there are important architectural constraints that dictate that within the system the &quot;best&quot; solution is to make use of those methods (like start()) but if those constraints are not of a high energy/frequency/faith/trust/belief/truth/nature if those constraints are not as beautiful or as pretty (goes the asshole again &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;) it means...&lt;/p&gt;

&lt;p&gt;Just saying that you have to work with what you have but what you have might render anything you create suboptimal or not elegant from a user point of view or even a developer point of view.&lt;/p&gt;

&lt;p&gt;Because it also has to harmonize with the system that is.&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;I would make the following suggestions:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;If you break away from the idea or requirement or truth that the Configuration is to be actually constructed and composed (including all of its objects) at START time, and towards the idea that all of it is constructed at CREATE time (e.g. by its factory) then you will end up seeing a better solution and the end solution you arrive at will be more elegant and more useful to a user actually using this thing.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Because simply put, this design choice favours any type of solution that chimes in with the existing XML-to-Node hierarchy and quite puts any other kind of solution at a disadvantage.&lt;br/&gt;
To make it even unworkable.&lt;/p&gt;

&lt;p&gt;I don&apos;t mind creating a solution of my own, as indicated, if only for exploration and study but it might take a bit of time as I don&apos;t understand the system very well but it could at least be a proof of concept as to what I say, but I need to get my system in working order again in any case first &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;

&lt;p&gt;I believe the power of Ralph is that he just transforms the programmatic thing into &apos; XML &apos; and that means he can address every possible object, class, configuration and type of objects, appenders, etc., with very little code.&lt;/p&gt;

&lt;p&gt;Anything I could write would probably require support for every single class unless I can find a way around that (perhaps by generating code).&lt;/p&gt;

&lt;p&gt;And it&apos;s clear I don&apos;t know enough about the system to do that, which is also why I have been holding back.&lt;/p&gt;

&lt;p&gt;So that&apos;s recommendation number one: ensure that the Configuration can be created fully at create time if you want this to be good. I&apos;m not even sure if that is possible.&lt;/p&gt;

&lt;p&gt;Next I believe it is still possible to turn it into more of a fluid code. Fluent code. You can still let assembler methods return all an assembler themselves. Makes for prettier code.&lt;/p&gt;

&lt;p&gt;So to recap, key points:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;we are talking about SPECs&lt;/li&gt;
	&lt;li&gt;coding is script-like rather than compile-like&lt;/li&gt;
	&lt;li&gt;new is better than get&lt;/li&gt;
	&lt;li&gt;a specification is processed by a factory that puts out objects&lt;/li&gt;
	&lt;li&gt;a start method should really not construct any objects (???????).&lt;/li&gt;
	&lt;li&gt;once you have a configuration you should be able to manipulate its objects&lt;/li&gt;
	&lt;li&gt;it should be possible to maintain multiple configurations independently and by hand&lt;/li&gt;
	&lt;li&gt;it should be possible to install new configurations with ease&lt;/li&gt;
	&lt;li&gt;the flow from object to object needs to improve, because there are too many entry-points to the code&lt;/li&gt;
	&lt;li&gt;there are too many objects that perform a function of control, without there being a path from the one to the other&lt;/li&gt;
	&lt;li&gt;I personally always prefer to store even a single important object in my application and use it to access every other important object, but perhaps that&apos;s just me.&lt;/li&gt;
	&lt;li&gt;libraries should not be dealing with these important objects anyway, as they need to abstract away from the logging framework used&lt;/li&gt;
	&lt;li&gt;even if they do not abstract away, they still need to abstract away from using these control objects, as it should be the application that&apos;s in control, not the library&lt;/li&gt;
	&lt;li&gt;it would not be bad if the library could on the other hand indicate a kind of default configuration (in terms of levels, perhaps)&lt;/li&gt;
	&lt;li&gt;that configuration would probably be some kind of default config file for the library (like a cascading system of config files?........ dunno?.........).&lt;/li&gt;
	&lt;li&gt;unless the library really has its own logging facility it should be up to the application to configure and start?.&lt;/li&gt;
	&lt;li&gt;I think SLF4J is a shameless plug &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I think it would be very powerful to have Configurations that you can install at will. Personally my only use case at this point is to change logger levels en masse according to a certain setup - that doesn&apos;t even require new appenders and such, and as such perhaps not even a new Configuration object. You might imagine a different kind of mapping from LoggerConfig to Level and you just install that LevelSetup into the configuration in the sense of Configuration.applyLevelScheme() or even Context.applyLevelScheme(). Thoughts? Is that a good idea?.... Perhaps too soon for it.&lt;/p&gt;

&lt;p&gt;Anyway I need to break. I&apos;ll leave it at this for now. Regards.&lt;/p&gt;</comment>
                            <comment id="14718553" author="ralph.goers@dslextreme.com" created="Fri, 28 Aug 2015 13:23:40 +0000"  >&lt;p&gt;Bart, Jira is not an email system for you to document every random thought. While your comments are welcome, please limit them to be concise and to the point or you may find that your comments are being edited or deleted.&lt;/p&gt;

&lt;p&gt;This comment is a great example. It can easily be reduced to a few sentences.&lt;/p&gt;

&lt;p&gt;Ralph&lt;/p&gt;

</comment>
                            <comment id="14718649" author="xennex82" created="Fri, 28 Aug 2015 14:35:29 +0000"  >&lt;p&gt;And you&apos;re also causing me to take time off my day because I have to write back to you in this way, defending myself and my way and my work, when I was actually coding something and having fun. If you were to accept what I write, we would all be much happier people. Except that it might not coincide with your goals, I don&apos;t know. I don&apos;t think this is really what you want. You&apos;re attacking me constantly and saying that my style is wrong and my way of thinking is wrong. And that I need to adjust, and become different. So as to suite you? Bah. I&apos;d rather be on my own then.&lt;/p&gt;</comment>
                            <comment id="14720067" author="garydgregory" created="Fri, 28 Aug 2015 16:06:23 +0000"  >&lt;p&gt;TL;DR except I saw the reference to &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1093&quot; title=&quot;Builder for FileAppender &quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1093&quot;&gt;LOG4J2-1093&lt;/a&gt;, so I commented there.&lt;/p&gt;</comment>
                            <comment id="14720604" author="garydgregory" created="Fri, 28 Aug 2015 21:28:11 +0000"  >&lt;p&gt;How about putting the patch in a branch so we can &quot;see&quot; it better and keep up with changes and evolve it until fully baked? &lt;/p&gt;

&lt;p&gt;I&apos;d like to reply to Ralph&apos;s comments but I will likely not get to it until Sunday.&lt;/p&gt;

&lt;p&gt;Good discussion!&lt;/p&gt;

&lt;p&gt;FWIW, this should not hold up a 2.4 RC. This new code would be good meat for 2.5 make 2.4 less of a big bang release. There is already a LOT in 2.4.&lt;/p&gt;

&lt;p&gt;Cheer,&lt;br/&gt;
Gary&lt;/p&gt;</comment>
                            <comment id="14720649" author="ralph.goers@dslextreme.com" created="Fri, 28 Aug 2015 21:49:26 +0000"  >&lt;p&gt;Sure. I can create a branch for this. I should have most of this weekend free as my wife is out of town and I was planning on addressing your comments then. I don&apos;t know if I would be able to do a release build at the same time. And I still have to finish the few final tasks on FastDateFormat. &lt;/p&gt;</comment>
                            <comment id="14721372" author="ralph.goers@dslextreme.com" created="Sun, 30 Aug 2015 04:07:10 +0000"  >&lt;p&gt;I made most of the changes you requested and checked in branch &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-952&quot; title=&quot;Add ConfigurationBuilder for programmatic configuration.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-952&quot;&gt;&lt;del&gt;LOG4J2-952&lt;/del&gt;&lt;/a&gt;. In addition, I overloaded the addAttribute method to accept various object classes as the value. I implemented the Configurator methods and created a unit test for that as well. If you are OK with this then I will start writing the documentation for it.&lt;/p&gt;</comment>
                            <comment id="14721519" author="remkop@yahoo.com" created="Sun, 30 Aug 2015 13:30:16 +0000"  >&lt;p&gt;Branch looks good to me.&lt;/p&gt;</comment>
                            <comment id="14721600" author="garydgregory" created="Sun, 30 Aug 2015 16:59:18 +0000"  >&lt;blockquote&gt;
&lt;p&gt;To avoid that you MUST use a ConfigurationFactory.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;OK, so that must be documented for now. I&apos;d still like to do programatic configuration w/o a ConfigurationFactory, so maybe I&apos;ll update the branch for that and we can deal with the error message at some later point. I do not want to be dissuaded for coding a solution one way vs. another because an error message is output.&lt;/p&gt;

&lt;p&gt;This also reminds me of an interesting point Bart or someone else brought up recently: The logging config file not found event as an ERROR is a bit alarmist. It could be a WARN or INFO, or be configurable.&lt;/p&gt;</comment>
                            <comment id="14721602" author="garydgregory" created="Sun, 30 Aug 2015 17:01:30 +0000"  >&lt;blockquote&gt;
&lt;p&gt;So I have no idea at this point if changing &amp;lt;T&amp;gt; to &amp;lt;&amp;gt; is going to cause one to pop back up.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The diamond notation just allows redundant text to be removed to clarify your code. I updated the branch with this one fix. I&apos;ll fix other stuff if I see it.&lt;/p&gt;</comment>
                            <comment id="14721604" author="garydgregory" created="Sun, 30 Aug 2015 17:04:03 +0000"  >&lt;blockquote&gt;
&lt;p&gt;7. I think there is an error in your statement above. What do you mean the impl classes must be public? Yes, the intention is to make the API public and give it the same guarantee that we have to log4j-api. The only impl class users should use is to extend AssembledConfiguration as PropertiesConfiguration does. I believe DefaultConfigurationAssembler has to be public so ConfigurationFactory can access it.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;My proposal is to merge both packages into one in order to only have types marked &lt;tt&gt;public&lt;/tt&gt; that MUST be public. We can make them all types public later, but for now, package private give us the flexibility to change things around in another release.&lt;/p&gt;</comment>
                            <comment id="14721606" author="garydgregory" created="Sun, 30 Aug 2015 17:16:22 +0000"  >&lt;blockquote&gt;
&lt;p&gt;As I said previously, I didn&apos;t use &quot;Builder&quot; because I thought it gave the wrong impression. I would expect the build() method of a Builder to return the actual object.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;But now, the test shows:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Configuration getConfiguration(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; URI configLocation) {
        ConfigurationAssembler&amp;lt;AssembledConfiguration&amp;gt; assembler = newConfiguration();
        assembler.setStatusLevel(Level.ERROR);
        assembler.add(assembler.newFilter(&lt;span class=&quot;code-quote&quot;&gt;&quot;ThresholdFilter&quot;&lt;/span&gt;, Filter.Result.ACCEPT, Filter.Result.NEUTRAL)
                .addAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;level&quot;&lt;/span&gt;, Level.DEBUG));
        AppenderAssembler appenderAssembler = assembler.newAppender(&lt;span class=&quot;code-quote&quot;&gt;&quot;Stdout&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;CONSOLE&quot;&lt;/span&gt;).addAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;target&quot;&lt;/span&gt;, ConsoleAppender.Target.SYSTEM_OUT);
        appenderAssembler.add(assembler.newLayout(&lt;span class=&quot;code-quote&quot;&gt;&quot;PatternLayout&quot;&lt;/span&gt;).
                addAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;pattern&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;%d [%t] %-5level: %msg%n%throwable&quot;&lt;/span&gt;));
        appenderAssembler.add(assembler.newFilter(&lt;span class=&quot;code-quote&quot;&gt;&quot;MarkerFilter&quot;&lt;/span&gt;, Filter.Result.DENY,
                Filter.Result.NEUTRAL).addAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;marker&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;FLOW&quot;&lt;/span&gt;));
        assembler.add(appenderAssembler);
        assembler.add(assembler.newLogger(&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.logging.log4j&quot;&lt;/span&gt;, Level.DEBUG).
                add(assembler.newAppenderRef(&lt;span class=&quot;code-quote&quot;&gt;&quot;Stdout&quot;&lt;/span&gt;)).
                addAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;additivity&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;));
        assembler.add(assembler.newRootLogger(Level.ERROR).add(assembler.newAppenderRef(&lt;span class=&quot;code-quote&quot;&gt;&quot;Stdout&quot;&lt;/span&gt;)));
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; assembler.assemble();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and the only call to assembler does return the actual object. The other assemble() calls are internal granted.&lt;/p&gt;

&lt;p&gt;And how is the assemble method documented? By using the &quot;builder&quot; terms! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    /**
     * Builds the plugin object after all configuration has been set. This will use &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; values &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; any
     * unspecified attributes &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the plugin.
     *
     * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; the configured plugin instance.
     * @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; org.apache.logging.log4j.core.config.ConfigurationException &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; there was an error building the plugin
     * object.
     */
    T assemble();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14721611" author="ralph.goers@dslextreme.com" created="Sun, 30 Aug 2015 17:25:11 +0000"  >&lt;p&gt;After writing the unit test for Configurator now I am not so sure whether that is true. The configuration is being passed in to the LoggerContextFactory and being used instead of going through the ConfigurationFactory - so that should avoid the error.&lt;/p&gt;

&lt;p&gt;I agree the message should not be an error (I guess this is a carryover from log4j 1).  If would suggest that we change it to warn and if we want it configurable that the configuration just to be to disable the message.&lt;/p&gt;</comment>
                            <comment id="14721613" author="ralph.goers@dslextreme.com" created="Sun, 30 Aug 2015 17:26:52 +0000"  >&lt;p&gt;I think it is much more clear having them in separate packages. Everything in the api package is public.  AssembledConfiguration is public only if you extend it with your own configuration, which usually won&apos;t be necessary.&lt;/p&gt;</comment>
                            <comment id="14721615" author="ralph.goers@dslextreme.com" created="Sun, 30 Aug 2015 17:30:15 +0000"  >&lt;p&gt;There is a huge difference between what a builder would do and what the assembler does.  When you get back a Configuration from the assemble method there are still no Appenders, LoggerConfigs, Filters, etc. attached to it.  A builder would build the &quot;real&quot; objects and attach them to the configuration.  The difference is that with a builder you would see errors when you call the build methods for each of the individual components. With the assembler you won&apos;t see those kinds of errors until the Configuration is started.  I see that as a huge difference from how the Builder pattern normally works.&lt;/p&gt;

&lt;p&gt;To be clear, the assembler works the same as how the XML, JSON and YAML configurations do. The first phase to to construct the hierarchy of configuration settings. The second phase, during the start method, is to convert those settings into actual objects by leveraging the Plugin builders/factories.  A set of configuration builders would not work this way. Instead each builder would construct a &quot;real&quot; object which would then be attached to the configuration. The start method would then simply start each of the objects attached to the configuration.&lt;/p&gt;</comment>
                            <comment id="14721619" author="garydgregory" created="Sun, 30 Aug 2015 17:36:48 +0000"  >&lt;p&gt;OK then, if it is clearer to you and you&apos;ve spent more time in the code, I&apos;ll buy that.&lt;/p&gt;</comment>
                            <comment id="14721627" author="garydgregory" created="Sun, 30 Aug 2015 17:55:40 +0000"  >&lt;p&gt;Thank you for clarifying that again, it helps a lot.&lt;/p&gt;

&lt;p&gt;This brings me to think that the name is not quite right. It&apos;s not about &quot;builder&quot; vs. &quot;assembler&quot;, it&apos;s more about what is being built/assembled: a configuration specification made from config Node.&lt;/p&gt;

&lt;p&gt;Now that I&apos;ve slogged through the config code some more see what confused me: The AbstractConfiguration holds on to both the Node tree and the real deal. &lt;/p&gt;

&lt;p&gt;So this new code, builds a tree object objects that then gets &apos;assembled&apos; into a tree of config Nodes. So it&apos;s a ConfigurationNodeBuilder. &lt;/p&gt;

&lt;p&gt;THAT&apos;s what was lot on me...&lt;/p&gt;</comment>
                            <comment id="14721628" author="xennex82" created="Sun, 30 Aug 2015 17:56:07 +0000"  >&lt;p&gt;It would still be Wise to change the error message from ERROR to WARN. I have idea how all of this fits together now but unless you&apos;ve changed something, by default at the start of the initialisation the ConfigurationFactory routines are called, it would be odd if they were not. ?....&lt;/p&gt;</comment>
                            <comment id="14721629" author="xennex82" created="Sun, 30 Aug 2015 17:59:33 +0000"  >&lt;p&gt;I think you are correct though. Separating it into two packages is a bad design choice. Separating the API and Core into two, was a bad design choice in any case, for the most of it. It creates a huge host of problems. It was not really the solution you wanted; I guess it is based on some &quot;pattern&quot;. I guess I have been saying that for a while now but you don&apos;t read my &quot;code&quot; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. It might also create the problem of having to import from multiple packages once again; one of the problems you were trying to solve.    But then I don&apos;t know anything about this now, I can&apos;t understand.&lt;/p&gt;

&lt;p&gt;Regards..&lt;/p&gt;</comment>
                            <comment id="14721635" author="xennex82" created="Sun, 30 Aug 2015 18:03:03 +0000"  >&lt;p&gt;That&apos;s what I&apos;ve been saying. It&apos;s a form of a SpecificationBuilder. But until you realise that....&lt;/p&gt;</comment>
                            <comment id="14721636" author="ralph.goers@dslextreme.com" created="Sun, 30 Aug 2015 18:06:08 +0000"  >&lt;p&gt;Yes, that is correct - although AbstractConfiguration should be dumping the node tree after the real stuff is created. But the ConfigurationAssembler (or whatever name you prefer) does return an actual Configuration object.&lt;/p&gt;

&lt;p&gt;Bart raised one good point that instantiating the actual configuration objects should probably not be done in the start method, but changing that at this point might be difficult as it can&apos;t be done in the constructor.  If we were to add a new method that performs the building of the objects before the start method is called then that could be incorporated and then this would be a legitimate builder.&lt;/p&gt;

&lt;p&gt;Lifecycle supports an initialized state so I think it would make sense to create an initialize method and move the appropriate code from the start method into that. I will at least give it a shot.&lt;/p&gt;</comment>
                            <comment id="14721640" author="xennex82" created="Sun, 30 Aug 2015 18:12:07 +0000"  >&lt;p&gt;I don&apos;t think you should hold on to what a &quot;builder&quot; is. You can build many forms of objects. If in the current system a Configuration without details (without generated compositing members) is the real deal, then that is what a builder makes, but of course it is not really the real deal.&lt;/p&gt;

&lt;p&gt;People fall into the trap of &apos;patterns&apos; too much. Like I said, the Builder can have a dozen different shapes. A typical builder would generally be Configuration.Builder with Configuration.newBuilder() as a static method that instantiates one.&lt;/p&gt;

&lt;p&gt;That might be preferable, but I don&apos;t know about how to have alternatives then. Though; anyone can subclass Configuration and turn THAT into SubClassedConfiguration.newBuilder().&lt;/p&gt;

&lt;p&gt;I think the pattern must be good; I mean the pattern that any solution must adhere to. If we get very diverse offerings it gets to be only confusing.&lt;/p&gt;

&lt;p&gt;Anyway, I am going to delete that long post since in Jira (at least here in Firefox) you get down at the bottom but you have to scroll up for this discussion. And you&apos;re not reading it anyway apparently. I&apos;ll just write something else....&lt;/p&gt;</comment>
                            <comment id="14721641" author="xennex82" created="Sun, 30 Aug 2015 18:13:17 +0000"  >&lt;p&gt;Better.&lt;/p&gt;</comment>
                            <comment id="14721643" author="xennex82" created="Sun, 30 Aug 2015 18:20:16 +0000"  >&lt;p&gt;I think I&apos;m just going to fork or &quot;subclass&quot; the thing. I mean Log4J as a whole. I&apos;ll just build my miniature version of it. Or at least a subsection of how to use it that coincides with me. I may not need to get rid of all the fluff and the bloat, but at least I can build my own solution to this that can get my project going again.&lt;/p&gt;

&lt;p&gt;Regards, and bye.&lt;/p&gt;</comment>
                            <comment id="14721648" author="garydgregory" created="Sun, 30 Aug 2015 18:36:17 +0000"  >&lt;p&gt;Yes, the branch looks good but I feel like it needs a little more work before merging.&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;Great work Ralph!&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;I&apos;m not sure I&apos;ll have much time today, but I&apos;m playing with it now for a couple of minutes. I&apos;ll be back on deck for sure in the AM.&lt;/p&gt;</comment>
                            <comment id="14721694" author="ralph.goers@dslextreme.com" created="Sun, 30 Aug 2015 19:50:06 +0000"  >&lt;p&gt;I have:&lt;br/&gt;
1. Modified Lifecycle to support and INITIAL state and add an initialize() method.&lt;br/&gt;
2. Added a default initialize method that sets the state to initialized.&lt;br/&gt;
3. Created an initialize method in AbstractConfiguration and moved the stuff related to object create from start into it.&lt;br/&gt;
4. Modified start to call initialize if the state is still INITIAL.&lt;br/&gt;
5. Renamed ConfigurationAssembler to ConfigurationBuilder and renamed its factory.&lt;br/&gt;
6. Renamed the other Assemblers to ComponentBuilders, since they construct Component objects.&lt;/p&gt;

&lt;p&gt;I forgot to rename the assembler package to builder. Will do that later this afternoon.&lt;/p&gt;</comment>
                            <comment id="14723845" author="garydgregory" created="Mon, 31 Aug 2015 18:43:32 +0000"  >&lt;p&gt;I can see the forest for the trees better and better in the branch now.&lt;/p&gt;

&lt;p&gt;This is looking good!&lt;/p&gt;

&lt;p&gt;For the first cut, I would make these classes package private:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;org.apache.logging.log4j.core.config.builder.impl.DefaultAppenderComponentBuilder&lt;/li&gt;
	&lt;li&gt;org.apache.logging.log4j.core.config.builder.impl.DefaultAppenderRefComponentBuilder&lt;/li&gt;
	&lt;li&gt;org.apache.logging.log4j.core.config.builder.impl.DefaultComponentBuilder&amp;lt;T extends ComponentBuilder&amp;gt;&lt;/li&gt;
	&lt;li&gt;org.apache.logging.log4j.core.config.builder.impl.DefaultCompositeFilterComponentBuilder&lt;/li&gt;
	&lt;li&gt;org.apache.logging.log4j.core.config.builder.impl.DefaultCustomLevelComponentBuilder&lt;/li&gt;
	&lt;li&gt;org.apache.logging.log4j.core.config.builder.impl.DefaultFilterComponentBuilder&lt;/li&gt;
	&lt;li&gt;org.apache.logging.log4j.core.config.builder.impl.DefaultLayoutComponentBuilder&lt;/li&gt;
	&lt;li&gt;org.apache.logging.log4j.core.config.builder.impl.DefaultLoggerComponentBuilder&lt;/li&gt;
	&lt;li&gt;org.apache.logging.log4j.core.config.builder.impl.DefaultRootLoggerComponentBuilder&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;That gives us the flexibility to adjust the impl at will for now. I think I asked this before but I am not sure I was able to interpret your answer correctly with the above in mind.&lt;/p&gt;

&lt;p&gt;Make P-Private?&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;</comment>
                            <comment id="14723875" author="ralph.goers@dslextreme.com" created="Mon, 31 Aug 2015 19:06:30 +0000"  >&lt;p&gt;Yes. I forgot to do that.&lt;/p&gt;</comment>
                            <comment id="14724105" author="garydgregory" created="Mon, 31 Aug 2015 21:46:28 +0000"  >&lt;p&gt;Committed to the branch.&lt;/p&gt;</comment>
                            <comment id="14724109" author="garydgregory" created="Mon, 31 Aug 2015 21:48:43 +0000"  >&lt;p&gt;In &lt;tt&gt;org.apache.logging.log4j.core.config.properties.PropertiesConfigurationFactory&lt;/tt&gt;, I see:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        Properties props = PropertiesUtil.extractSubset(properties, &lt;span class=&quot;code-quote&quot;&gt;&quot;property&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; key : props.stringPropertyNames()) {
            builder.addProperty(key, props.getProperty(key));
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Why not have a &lt;tt&gt;builder.addProperties(props)&lt;/tt&gt; method?&lt;/p&gt;

&lt;p&gt;Also, why not traverse the &lt;tt&gt;entrySet()&lt;/tt&gt;, you&apos;d get both the key and value at the same time, no inner-loop lookup.&lt;/p&gt;

&lt;p&gt;TY,&lt;br/&gt;
G&lt;/p&gt;</comment>
                            <comment id="14724123" author="ralph.goers@dslextreme.com" created="Mon, 31 Aug 2015 22:05:38 +0000"  >&lt;p&gt;I don&apos;t know that that optimization buys much since it will do the same thing. A caller such as CustomConfigurationFactory will still want to add properties one at a time.&lt;/p&gt;

&lt;p&gt;Properties entrySet() returns Set&amp;lt;Map.Entry&amp;lt;Object, Object&amp;gt;).  The way it is written avoids all the casting.&lt;/p&gt;</comment>
                            <comment id="14724831" author="garydgregory" created="Tue, 1 Sep 2015 05:54:39 +0000"  >&lt;p&gt;I think am done with the bulk of my changes for the branch.&lt;/p&gt;

&lt;p&gt;There is one more thing that is not quite right. The use of the fluent style, requires generics to be coded a certain way which affects &lt;tt&gt;ComponentBuilder&lt;/tt&gt;:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;org.apache.logging.log4j.core.config.builder.api.ComponentBuilder&amp;lt;T &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; ComponentBuilder&amp;lt;T&amp;gt;&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In order to return &lt;tt&gt;this&lt;/tt&gt;, each API should be coded to return &lt;tt&gt;ComponentBuilder&amp;lt;T&amp;gt;&lt;/tt&gt; and not &lt;tt&gt;T&lt;/tt&gt;. Doing so avoids the type casts and makes sense. Imagine a &lt;tt&gt;Foo&amp;lt;Integer&amp;gt;&lt;/tt&gt; class, you would want &lt;tt&gt;return this;&lt;/tt&gt; methods to be typed as &lt;tt&gt;public Foo&amp;lt;Integer&amp;gt; method()&lt;/tt&gt;, not &lt;tt&gt;public Integer method()&lt;/tt&gt;. But implementing this has a few ripples that I have not worked out yet. &lt;/p&gt;

&lt;p&gt;Maybe tomorrow or later... or someone else can take a stab at it.&lt;/p&gt;</comment>
                            <comment id="14726362" author="garydgregory" created="Tue, 1 Sep 2015 22:52:09 +0000"  >&lt;p&gt;I&apos;ve reviewed and updated the code as much as I can for now.&lt;/p&gt;

&lt;p&gt;I think other eyeballs would be good now and more tests are needed for sure, and then some Javadocs and documentation.&lt;/p&gt;

&lt;p&gt;It turns out that not using a custom factory was simple to do, so that&apos;s nice.&lt;/p&gt;

&lt;p&gt;Whether this happens in the branch or master does not really matter for now.&lt;/p&gt;

&lt;p&gt;The branch could be updated with the latest from master as well.&lt;/p&gt;</comment>
                            <comment id="14728514" author="ralph.goers@dslextreme.com" created="Thu, 3 Sep 2015 05:12:34 +0000"  >&lt;p&gt;I&apos;ve updated the branch from master, but I am sure that will only last a day or two &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;As far as I am concerned I think the code is fine. It just needs documentation. I&apos;d like to complete that over the long weekend and hopefully get a 2.4 release kicked off with this in it if that is OK.&lt;/p&gt;</comment>
                            <comment id="14728618" author="remkop@yahoo.com" created="Thu, 3 Sep 2015 07:31:19 +0000"  >&lt;p&gt;Go for it. I think we are all happy to merge this into master by now. Thanks in advance for doing the release work!&lt;/p&gt;</comment>
                            <comment id="14729206" author="garydgregory" created="Thu, 3 Sep 2015 15:04:14 +0000"  >&lt;p&gt;Sounds good. Any thoughts on getting &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1088&quot; title=&quot;Add Comma Separated Value (CSV) layouts for parameter and event logging.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1088&quot;&gt;&lt;del&gt;LOG4J2-1088&lt;/del&gt;&lt;/a&gt; discussed before 2.4?&lt;/p&gt;</comment>
                            <comment id="14734090" author="ralph.goers@dslextreme.com" created="Tue, 8 Sep 2015 00:50:12 +0000"  >&lt;p&gt;Branch &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-952&quot; title=&quot;Add ConfigurationBuilder for programmatic configuration.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-952&quot;&gt;&lt;del&gt;LOG4J2-952&lt;/del&gt;&lt;/a&gt; has been merged to master. Please verify and close.&lt;/p&gt;</comment>
                            <comment id="14967320" author="remkop@yahoo.com" created="Wed, 21 Oct 2015 15:31:05 +0000"  >&lt;p&gt;Now that this issue is resolved, can we remove branch origin/LOG4j2-952 since its code was merged into master?&lt;/p&gt;</comment>
                            <comment id="14967369" author="ralph.goers@dslextreme.com" created="Wed, 21 Oct 2015 16:07:31 +0000"  >&lt;p&gt;Yes&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310051">
                    <name>Supercedes</name>
                                            <outwardlinks description="supercedes">
                                        <issuelink>
            <issuekey id="12716238">LOG4J2-648</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12752016" name="LOG4J2-952-2.patch" size="97081" author="rgoers" created="Mon, 24 Aug 2015 14:40:29 +0000"/>
                            <attachment id="12752670" name="LOG4J2-952-3.patch" size="111243" author="rgoers" created="Thu, 27 Aug 2015 06:18:29 +0000"/>
                            <attachment id="12752782" name="LOG4J2-952-4.patch" size="111418" author="rgoers" created="Thu, 27 Aug 2015 15:38:16 +0000"/>
                            <attachment id="12751976" name="LOG4J2-952.patch" size="92148" author="rgoers" created="Mon, 24 Aug 2015 06:12:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 5 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i25h7b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>