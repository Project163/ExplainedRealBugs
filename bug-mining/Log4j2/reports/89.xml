<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:31:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-205] Deadlock with SocketAppender</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-205</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;We found a Deadlock in the SocketAppender (TCPSocketManager.java), when the reconnectionDelay is used.&lt;br/&gt;
A JUnit-Testcase (testTcpAppenderDeadlock()) has been attached, which reproduced the deadlock.&lt;/p&gt;

&lt;p&gt;Description of the JUnit-Testcase:&lt;br/&gt;
&#8226;	No SocketServer is startet&lt;br/&gt;
&#8226;	We generate a SocketAppender with a reconnectionDelay= 10sec&lt;br/&gt;
&#8226;	The SocketAppender acknowledges that no SocktServer is there, and start the timeout&lt;br/&gt;
&#8226;	During reconnectionDelay the SocketServer started and something is logged &lt;br/&gt;
&#8226;	Now the user-thread (here the JUNIT-Thread) and the Reconnector-Thread are blocking each other forever&lt;/p&gt;


&lt;p&gt;An additional Issue occurs: &lt;br/&gt;
If no SocketServer is available at the start of the SocketAppender, each user-thread is blocked at every logging operation up to the defined reconnection-time!&lt;/p&gt;


&lt;p&gt;Recommended solution:&lt;br/&gt;
TCPSocketManager.java&lt;br/&gt;
    @Override&lt;br/&gt;
    protected synchronized void write(final byte[] bytes, final int offset, final int length)  {&lt;br/&gt;
//        if (socket == null) {&lt;br/&gt;
//            if (connector != null) &lt;/p&gt;
{
//                connector.latch();
//            }
&lt;p&gt;//            if (socket == null) &lt;/p&gt;
{
//                final String msg = &quot;Error writing to &quot; + getName() + &quot; socket not available&quot;;
//                throw new AppenderRuntimeException(msg);
//            }
&lt;p&gt;//        }&lt;br/&gt;
       if (socket == null) {&lt;br/&gt;
			if (connector != null) &lt;/p&gt;
{
				return;
			}
&lt;p&gt; else &lt;/p&gt;
{
				final String msg = &quot;Error writing to &quot; + getName()
						+ &quot; socket not available&quot;;
				throw new AppenderRuntimeException(msg);
			}
&lt;p&gt;}&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12641829">LOG4J2-205</key>
            <summary>Deadlock with SocketAppender</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rgoers">Ralph Goers</assignee>
                                    <reporter username="gow">Werner </reporter>
                        <labels>
                    </labels>
                <created>Wed, 10 Apr 2013 12:51:52 +0000</created>
                <updated>Sat, 20 Apr 2013 06:00:12 +0000</updated>
                            <resolved>Sat, 20 Apr 2013 06:00:12 +0000</resolved>
                                    <version>2.0-beta4</version>
                                    <fixVersion>2.0-beta5</fixVersion>
                                    <component>Appenders</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13627746" author="gow" created="Wed, 10 Apr 2013 12:52:57 +0000"  >&lt;p&gt;JUnitTest for SocketAppender&lt;/p&gt;</comment>
                            <comment id="13637133" author="ralph.goers@dslextreme.com" created="Sat, 20 Apr 2013 06:00:12 +0000"  >&lt;p&gt;Deadlock was fixed in revision 1470110. A new option, immediateFail, was added to allow the event to not wait for the socket reconnection.  Please verify and close.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12577998" name="SocketAppenderTest.java" size="8259" author="gow" created="Wed, 10 Apr 2013 12:52:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>322244</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 31 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1jlkf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>322589</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>