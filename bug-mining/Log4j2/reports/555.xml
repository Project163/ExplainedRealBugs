<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:34:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-1108] NullPointerException when passing null to java.util.logging.Logger.setLevel()</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-1108</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;When using a 3rd party library (Twitter Finagle) which uses a custom java.util.logging.Level, I get this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.lang.NullPointerException
        at java.util.concurrent.ConcurrentHashMap.hash(ConcurrentHashMap.java:333)
        at java.util.concurrent.ConcurrentHashMap.get(ConcurrentHashMap.java:988)
        at org.apache.logging.log4j.jul.DefaultLevelConverter.toLevel(DefaultLevelConverter.java:119)
        at org.apache.logging.log4j.jul.LevelTranslator.toLevel(LevelTranslator.java:72)
        at org.apache.logging.log4j.jul.CoreLogger.setLevel(CoreLogger.java:47)
        at com.twitter.logging.Logger.setLevel(Logger.scala:63)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;-Djava.util.logging.manager=org.apache.logging.log4j.jul.LogManager&lt;/p&gt;</environment>
        <key id="12859587">LOG4J2-1108</key>
            <summary>NullPointerException when passing null to java.util.logging.Logger.setLevel()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ggregory">Gary D. Gregory</assignee>
                                    <reporter username="mikaelstaldal">Mikael St&#229;ldal</reporter>
                        <labels>
                    </labels>
                <created>Thu, 27 Aug 2015 12:24:53 +0000</created>
                <updated>Wed, 2 Sep 2015 08:22:53 +0000</updated>
                            <resolved>Tue, 1 Sep 2015 19:05:20 +0000</resolved>
                                    <version>2.4</version>
                                    <fixVersion>2.4</fixVersion>
                                    <component>JUL adapter</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14716584" author="mikaelstaldal" created="Thu, 27 Aug 2015 12:32:00 +0000"  >&lt;p&gt;Twitter Finagle calls &lt;tt&gt;java.util.logging.Logger.setLogger(Level)&lt;/tt&gt; with &lt;tt&gt;null&lt;/tt&gt;, which is valid according to &lt;a href=&quot;http://docs.oracle.com/javase/7/docs/api/java/util/logging/Logger.html#setLevel(java.util.logging.Level)&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://docs.oracle.com/javase/7/docs/api/java/util/logging/Logger.html#setLevel(java.util.logging.Level)&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14716687" author="ralph.goers@dslextreme.com" created="Thu, 27 Aug 2015 13:48:40 +0000"  >&lt;p&gt;Wonderful.&lt;/p&gt;</comment>
                            <comment id="14718091" author="garydgregory" created="Fri, 28 Aug 2015 05:50:38 +0000"  >&lt;p&gt;It also looks like our setLevel(Level) implementation &lt;tt&gt;org.apache.logging.log4j.jul.CoreLogger.setLevel(Level)&lt;/tt&gt; does not perform the proper security check:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Throws:&lt;br/&gt;
SecurityException - if a security manager exists and if the caller does not have LoggingPermission(&quot;control&quot;).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Am I reading that right? If so. then that should be covered by a new issue.&lt;/p&gt;</comment>
                            <comment id="14718097" author="garydgregory" created="Fri, 28 Aug 2015 05:59:03 +0000"  >&lt;p&gt;If we push the NPE fix down to &lt;tt&gt;org.apache.logging.log4j.jul.DefaultLevelConverter&lt;/tt&gt;, then that leaves the door open for a custom converter to do something else with a null, like mapping null to OFF. &lt;/p&gt;

&lt;p&gt;But at the converter level, you cannot do anything about changing the effective level by looking at the parent logger, so what you can do is limited.&lt;/p&gt;

&lt;p&gt;The spec says: &quot;If the new level is null, it means that this node should inherit its level from its nearest ancestor with a specific (non-null) level value.&quot;&lt;/p&gt;

&lt;p&gt;For us, does that mean we must remove this logger&apos;s logger config and set it to null?&lt;/p&gt;

&lt;p&gt;Right now, &lt;tt&gt;org.apache.logging.log4j.core.Logger.setLevel(Level)&lt;/tt&gt; does not do anything when given a null Level, it&apos;s a NoOp.&lt;/p&gt;</comment>
                            <comment id="14718172" author="mikaelstaldal" created="Fri, 28 Aug 2015 07:55:26 +0000"  >&lt;p&gt;Changing the title since this does not seems to be about custom levels as I initially though. Also setting this to blocker since it is new in 2.4 and it renders the JUL adapter unusable for me.&lt;/p&gt;</comment>
                            <comment id="14718183" author="mikaelstaldal" created="Fri, 28 Aug 2015 08:06:53 +0000"  >&lt;p&gt;According to &lt;a href=&quot;http://docs.oracle.com/javase/7/docs/api/java/util/logging/Logger.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://docs.oracle.com/javase/7/docs/api/java/util/logging/Logger.html&lt;/a&gt;, it is only in &lt;tt&gt;setLevel()&lt;/tt&gt; you are allowed to pass null as Level, so we don&apos;t have to support null Level to the other methods in Logger (such as log(Level, ...)).&lt;/p&gt;

&lt;p&gt;So I suggest we put the fix in &lt;tt&gt;CoreLogger.setLevel()&lt;/tt&gt; and make sure it never pass any null Level to the &lt;tt&gt;LevelConverter&lt;/tt&gt;. Then &lt;tt&gt;DefaultLevelConverter&lt;/tt&gt; does not have to be changed.&lt;/p&gt;</comment>
                            <comment id="14718485" author="ralph.goers@dslextreme.com" created="Fri, 28 Aug 2015 12:42:12 +0000"  >&lt;p&gt;I agree. Would it be possible for you to create a patch?&lt;/p&gt;</comment>
                            <comment id="14720003" author="mikaelstaldal" created="Fri, 28 Aug 2015 15:30:21 +0000"  >&lt;p&gt;Patch to fix this issue&lt;/p&gt;</comment>
                            <comment id="14720020" author="garydgregory" created="Fri, 28 Aug 2015 15:36:16 +0000"  >&lt;p&gt;Wait a sec. &lt;tt&gt;org.apache.logging.log4j.core.Logger.setLevel(Level)&lt;/tt&gt; still looks odd. We should do something with a null. The JUL behavior looks right to me.&lt;/p&gt;</comment>
                            <comment id="14720394" author="garydgregory" created="Fri, 28 Aug 2015 18:46:32 +0000"  >&lt;p&gt;In Git master. Please verify and close. Could use a code review.&lt;/p&gt;

&lt;p&gt;commitdiff: &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;a=commitdiff;h=81e2fa4c347f92ecb05aa000e939adfe310f935a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;a=commitdiff;h=81e2fa4c347f92ecb05aa000e939adfe310f935a&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;In particular: &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;a=commitdiff;h=81e2fa4c347f92ecb05aa000e939adfe310f935a#patch1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;a=commitdiff;h=81e2fa4c347f92ecb05aa000e939adfe310f935a#patch1&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="14720423" author="ralph.goers@dslextreme.com" created="Fri, 28 Aug 2015 19:12:52 +0000"  >&lt;p&gt;This is not correct. You can&apos;t modify a Logger to point to a different LoggerConfig just because the level is now null. That could possible change what filters and appenders are used.  What probably should happen here is that the LoggerConfig object is modified to have its level set to the level of its parent. Another option would be to do &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;config = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PrivateConfig(config, config.loggerConfig().getParent().getLevel());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14720433" author="garydgregory" created="Fri, 28 Aug 2015 19:24:04 +0000"  >&lt;p&gt;OK, so this works:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; void setLevel(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Level level) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (level != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            config = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PrivateConfig(config, level);
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
            config = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PrivateConfig(config, getParent().getLevel());
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Better? Should be refactored of course.&lt;/p&gt;

&lt;p&gt;Like this now:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; void setLevel(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Level level) {
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Level actualLevel = level != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? level : getParent().getLevel();
        config = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PrivateConfig(config, actualLevel);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14720449" author="ralph.goers@dslextreme.com" created="Fri, 28 Aug 2015 19:39:03 +0000"  >&lt;p&gt;I don&apos;t really like that because you are potentially creating a new Logger that didn&apos;t exist before.  Going after the level in the parent LoggerConfig should get you the same result.&lt;/p&gt;</comment>
                            <comment id="14720469" author="garydgregory" created="Fri, 28 Aug 2015 19:51:19 +0000"  >&lt;p&gt;I see how &lt;tt&gt;getParent()&lt;/tt&gt; can create a new Logger in the code now.&lt;/p&gt;

&lt;p&gt;The &lt;tt&gt;org.apache.logging.log4j.jul.CoreLoggerTest.testSetLevelToNull()&lt;/tt&gt; fails with:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; void setLevel(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Level level) {
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Level actualLevel = level != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? level : config.loggerConfig.getParent().getLevel();
        config = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PrivateConfig(config, actualLevel);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14720509" author="ralph.goers@dslextreme.com" created="Fri, 28 Aug 2015 20:23:55 +0000"  >&lt;p&gt;I&apos;ll have to look at this to see why.&lt;/p&gt;</comment>
                            <comment id="14720520" author="garydgregory" created="Fri, 28 Aug 2015 20:35:31 +0000"  >&lt;p&gt;Merci!&lt;/p&gt;</comment>
                            <comment id="14723482" author="mikaelstaldal" created="Mon, 31 Aug 2015 14:38:55 +0000"  >&lt;p&gt;Is this still resolved, or is there more work to be done?&lt;/p&gt;</comment>
                            <comment id="14723547" author="garydgregory" created="Mon, 31 Aug 2015 15:30:18 +0000"  >&lt;p&gt;It is functional now but &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ralphgoers&quot; class=&quot;user-hover&quot; rel=&quot;ralphgoers&quot;&gt;ralphgoers&lt;/a&gt; said he want to look at a more efficient implementation.&lt;/p&gt;</comment>
                            <comment id="14725231" author="mikaelstaldal" created="Tue, 1 Sep 2015 11:33:01 +0000"  >&lt;p&gt;This still doesn&apos;t work for me. I tested latest master, and now I get this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.lang.NullPointerException
        at org.apache.logging.log4j.core.Logger.setLevel(Logger.java:110)
        at org.apache.logging.log4j.jul.CoreLogger.setLevel(CoreLogger.java:48)
        at com.twitter.logging.Logger.setLevel(Logger.scala:63)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Logger.java:110 looks like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Level actualLevel = level != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? level : getParent().getLevel();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think that getParent() returns &lt;tt&gt;null&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="14725892" author="garydgregory" created="Tue, 1 Sep 2015 19:05:20 +0000"  >&lt;p&gt;Thank you.&lt;/p&gt;

&lt;p&gt;Root level edge case fixed in Git master (added new unit test).&lt;/p&gt;

&lt;p&gt;Please verify and close.&lt;/p&gt;
</comment>
                            <comment id="14726980" author="mikaelstaldal" created="Wed, 2 Sep 2015 08:22:53 +0000"  >&lt;p&gt;Works for me now&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12753009" name="setlevel.patch" size="2660" author="mikaelstaldal" created="Fri, 28 Aug 2015 15:30:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 12 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2jg2f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>