<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:40:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-1570] Logging with a lambda expression with a method call that also logs causes logs within method call to reference line num and method name as parent method</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-1570</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;While logging a message using lambda expressions. If i call a method within the log message (i.e logger.info(() -&amp;gt; &quot;foo&quot; +bar()) which also logs messages, those logs within the called method will reference the line number and method name of the method which invoked it.&lt;/p&gt;

&lt;p&gt;Running the following code demonstrates this issue:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;TestingLogging.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Logger LOGGER = LogManager.getLogger(TestingLogging.class);

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; foo(){
        LOGGER.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;bar&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;;
    }

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args){
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;correct method reference: &quot;&lt;/span&gt;);
        LOGGER.info(foo());

        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;\nincorrect method reference: &quot;&lt;/span&gt;);

        &lt;span class=&quot;code-comment&quot;&gt;// causes logging in foo to reference
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; line number and method (main)
&lt;/span&gt;        LOGGER.info(() -&amp;gt; foo());
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13003467">LOG4J2-1570</key>
            <summary>Logging with a lambda expression with a method call that also logs causes logs within method call to reference line num and method name as parent method</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="m8ypie">Joel Berta</reporter>
                        <labels>
                            <label>easyfix</label>
                            <label>newbie</label>
                    </labels>
                <created>Thu, 8 Sep 2016 06:44:21 +0000</created>
                <updated>Thu, 17 Jan 2019 04:02:13 +0000</updated>
                            <resolved>Thu, 17 Jan 2019 04:02:13 +0000</resolved>
                                    <version>2.6.2</version>
                                    <fixVersion>2.11.2</fixVersion>
                                    <component>API</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16711985" author="stefan.kuettner" created="Thu, 6 Dec 2018 20:18:00 +0000"  >&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;moved to new issue -&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16741775" author="ralph.goers@dslextreme.com" created="Mon, 14 Jan 2019 05:35:06 +0000"  >&lt;p&gt;Wow. I just ran the app and stopped it within StackLocator. I see&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.logging.log4j.util.StackLocator.calcLocation(StackLocator.java:172)
org.apache.logging.log4j.util.StackLocatorUtil.calcLocation(StackLocatorUtil.java:71)
org.apache.logging.log4j.core.impl.MutableLogEvent.getSource(MutableLogEvent.java:369)
org.apache.logging.log4j.core.pattern.ClassNamePatternConverter.format(ClassNamePatternConverter.java:60)
org.apache.logging.log4j.core.pattern.PatternFormatter.format(PatternFormatter.java:38)
org.apache.logging.log4j.core.layout.PatternLayout$PatternSerializer.toSerializable(PatternLayout.java:334)
org.apache.logging.log4j.core.layout.PatternLayout.toText(PatternLayout.java:233)
org.apache.logging.log4j.core.layout.PatternLayout.encode(PatternLayout.java:218)
org.apache.logging.log4j.core.layout.PatternLayout.encode(PatternLayout.java:58)
org.apache.logging.log4j.core.appender.AbstractOutputStreamAppender.directEncodeEvent(AbstractOutputStreamAppender.java:197)
org.apache.logging.log4j.core.appender.AbstractOutputStreamAppender.tryAppend(AbstractOutputStreamAppender.java:190)
org.apache.logging.log4j.core.appender.AbstractOutputStreamAppender.append(AbstractOutputStreamAppender.java:181)
org.apache.logging.log4j.core.config.AppenderControl.tryCallAppender(AppenderControl.java:156)
org.apache.logging.log4j.core.config.AppenderControl.callAppender0(AppenderControl.java:129)
org.apache.logging.log4j.core.config.AppenderControl.callAppenderPreventRecursion(AppenderControl.java:120)
org.apache.logging.log4j.core.config.AppenderControl.callAppender(AppenderControl.java:84)
org.apache.logging.log4j.core.config.LoggerConfig.callAppenders(LoggerConfig.java:464)
org.apache.logging.log4j.core.config.LoggerConfig.processLogEvent(LoggerConfig.java:448)
org.apache.logging.log4j.core.config.LoggerConfig.log(LoggerConfig.java:431)
org.apache.logging.log4j.core.config.LoggerConfig.log(LoggerConfig.java:406)
org.apache.logging.log4j.core.config.AwaitCompletionReliabilityStrategy.log(AwaitCompletionReliabilityStrategy.java:63)
org.apache.logging.log4j.core.Logger.logMessage(Logger.java:146)
org.apache.logging.log4j.spi.AbstractLogger.tryLogMessage(AbstractLogger.java:2170)
org.apache.logging.log4j.spi.AbstractLogger.logMessageTrackRecursion(AbstractLogger.java:2125)
org.apache.logging.log4j.spi.AbstractLogger.logMessageSafely(AbstractLogger.java:2108)
org.apache.logging.log4j.spi.AbstractLogger.logMessage(AbstractLogger.java:2002)
org.apache.logging.log4j.spi.AbstractLogger.logIfEnabled(AbstractLogger.java:1974)
org.apache.logging.log4j.spi.AbstractLogger.info(AbstractLogger.java:1321)
org.apache.App.foo(App.java:16)
org.apache.App.lambda$main$0(App.java:28)
org.apache.logging.log4j.util.LambdaUtil.getMessage(LambdaUtil.java:91)
org.apache.logging.log4j.spi.AbstractLogger.logMessage(AbstractLogger.java:1996)
org.apache.logging.log4j.spi.AbstractLogger.logIfEnabled(AbstractLogger.java:1859)
org.apache.logging.log4j.spi.AbstractLogger.info(AbstractLogger.java:1326)
org.apache.App.main(App.java:28)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;When StackLocator processes this it starts at the bottom and proceeds up until it finds the class of the logging implementation. In this case that is org.apache.logging.log4j.spi.AbstractLoggger. It then uses the stacktrace element immediately preceding that, which is App.main line 28,&#160; It seems the stack locator logic is just wrong. I&apos;m pretty sure this is just a mistake on my part and we need to walk the stack from the top.&lt;/p&gt;

&lt;p&gt;Interestingly, it appears that StackLocator in Java 9 doesn&apos;t behave this way and will work correctly.&lt;/p&gt;</comment>
                            <comment id="16742730" author="ralph.goers@dslextreme.com" created="Tue, 15 Jan 2019 04:15:25 +0000"  >&lt;p&gt;I have a fix. It seems the iostreams module fails when stack walking is done from the top down. I don&apos;t know why we don&apos;t normally see it but it also fails in Java 11 when using StackWalker. The problem is that the iostream loggers are called by the application and then delegate to Java I/O classes which eventually end up calling the same iostream class. So it ends up locating a sun class instead of the caller. I am considering ways to deal with this.&lt;/p&gt;</comment>
                            <comment id="16744666" author="jira-bot" created="Thu, 17 Jan 2019 04:00:48 +0000"  >&lt;p&gt;Commit 2f1ff291dfe1c859c1baa9ce5a457584b3ad0945 in logging-log4j2&apos;s branch refs/heads/master from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=2f1ff29&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=2f1ff29&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1570&quot; title=&quot;Logging with a lambda expression with a method call that also logs causes logs within method call to reference line num and method name as parent method&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1570&quot;&gt;&lt;del&gt;LOG4J2-1570&lt;/del&gt;&lt;/a&gt; - Logging with a lambda expression with a method call that also logs would cause logs within method call to reference line num and method name of the parent method&lt;/p&gt;</comment>
                            <comment id="16744667" author="jira-bot" created="Thu, 17 Jan 2019 04:01:08 +0000"  >&lt;p&gt;Commit dfc9615bed6a5354d185892ff1a2ce8e83839186 in logging-log4j2&apos;s branch refs/heads/release-2.x from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=dfc9615&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=dfc9615&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1570&quot; title=&quot;Logging with a lambda expression with a method call that also logs causes logs within method call to reference line num and method name as parent method&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1570&quot;&gt;&lt;del&gt;LOG4J2-1570&lt;/del&gt;&lt;/a&gt; - Logging with a lambda expression with a method call that also logs would cause logs within method call to reference line num and method name of the parent method&lt;/p&gt;</comment>
                            <comment id="16744668" author="ralph.goers@dslextreme.com" created="Thu, 17 Jan 2019 04:02:13 +0000"  >&lt;p&gt;Fix has been applied to both release-2.x and master branches. Please verify and close.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13209271">LOG4J2-2531</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 43 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i33dk7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>