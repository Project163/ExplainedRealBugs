<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:41:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-2766] TimeBasedTriggeringPolicy of RollingRandomAccessFile is not updated instantly</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-2766</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;If a RollingRandomAccessFile is updated with a new TimeBasedTriggeringPolicy during runtime, the new value is not updated until the original interval is reached once.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;E.g. if logging is initialized with the rule to rotate every day and is later rerconfigured to rotate every hour, then you have to wait until the next day in order to get hourly rotated files.&lt;/p&gt;

&lt;p&gt;This has to do with the ordering in the Update-Method of&#160;RollingRandomAccessFileManager. Before the new PatternProcessor is created the&#160;RollingRandomAccessFileManager initializes his TriggeringPolicy from the former PatternProcessor.&lt;/p&gt;

&lt;p&gt;org.apache.logging.log4j.core.appender.rolling.RollingRandomAccessFileManager:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void updateData(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; data) {
  &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; FactoryData factoryData = (FactoryData) data;
  setRolloverStrategy(factoryData.getRolloverStrategy());
  setTriggeringPolicy(factoryData.getTriggeringPolicy()); &lt;span class=&quot;code-comment&quot;&gt;// -&amp;gt; TimeBasedTriggeringPolicy.initialize will use old PatternProcessor
&lt;/span&gt;  setPatternProcessor(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PatternProcessor(factoryData.getPattern(), getPatternProcessor()));
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;org.apache.logging.log4j.core.appender.rolling.TimeBasedTriggeringPolicy:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void initialize(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; RollingFileManager aManager) {
  &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.manager = aManager;
  &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; current = aManager.getFileTime();
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (current == 0) {
    current = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis();
  }  &lt;span class=&quot;code-comment&quot;&gt;// LOG4J2-531: call getNextTime twice to force initialization of both prevFileTime and nextFileTime
&lt;/span&gt;  aManager.getPatternProcessor().getNextTime(current, interval, modulate);
  aManager.getPatternProcessor().setTimeBased(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);

  nextRolloverMillis = ThreadLocalRandom.current().nextLong(0, 1 + maxRandomDelayMillis)
        + aManager.getPatternProcessor().getNextTime(current, interval, modulate); &lt;span class=&quot;code-comment&quot;&gt;// -&amp;gt; time comes from the old PatternProcessor (see above: RollingRandomAccessFileManager.updateData)
&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;See also the attached simple testcase.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13281358">LOG4J2-2766</key>
            <summary>TimeBasedTriggeringPolicy of RollingRandomAccessFile is not updated instantly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rgoers">Ralph Goers</assignee>
                                    <reporter username="HeikoS">Heiko Schwanke</reporter>
                        <labels>
                    </labels>
                <created>Fri, 24 Jan 2020 10:18:53 +0000</created>
                <updated>Thu, 14 Jan 2021 10:35:14 +0000</updated>
                            <resolved>Sat, 18 Apr 2020 21:25:24 +0000</resolved>
                                    <version>2.13.0</version>
                                    <fixVersion>2.13.2</fixVersion>
                                    <component>Appenders</component>
                    <component>Configurators</component>
                    <component>Reconfiguration</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17086301" author="ralph.goers@dslextreme.com" created="Sat, 18 Apr 2020 04:59:29 +0000"  >&lt;p&gt;The ability to update the pattern processor was added in &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2457&quot; title=&quot;RollingRandomAccessFileManager ignores new file patterns from programmatic reconfiguration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2457&quot;&gt;&lt;del&gt;LOG4J2-2457&lt;/del&gt;&lt;/a&gt;, which copied the code from RollingFileManager. One would presume that if this code is wrong then RollingfileManager must also be wrong. The code in RollingFileManager was added in &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1964&quot; title=&quot;Dynamic reconfiguration does not work for filePattern of RollingFile&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1964&quot;&gt;&lt;del&gt;LOG4J2-1964&lt;/del&gt;&lt;/a&gt; but there is a comment there saying the ordering is wrong. The tests that were provided for that issue were invalid. This all started in &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-381&quot; title=&quot;Changes in SizeBasedTriggeringPolicy has no effects when automatic reconfiguration is on.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-381&quot;&gt;&lt;del&gt;LOG4J2-381&lt;/del&gt;&lt;/a&gt;. Before that changing these were not allowed. I am still wondering if allowing this was a bad idea. It does not appear to be thread-safe to me.&lt;/p&gt;</comment>
                            <comment id="17086656" author="jira-bot" created="Sat, 18 Apr 2020 21:24:10 +0000"  >&lt;p&gt;Commit 99809b488fee56935b2dbe0e241e8bff04426840 in logging-log4j2&apos;s branch refs/heads/release-2.x from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=99809b4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=99809b4&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2766&quot; title=&quot;TimeBasedTriggeringPolicy of RollingRandomAccessFile is not updated instantly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2766&quot;&gt;&lt;del&gt;LOG4J2-2766&lt;/del&gt;&lt;/a&gt;,&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2457&quot; title=&quot;RollingRandomAccessFileManager ignores new file patterns from programmatic reconfiguration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2457&quot;&gt;&lt;del&gt;LOG4J2-2457&lt;/del&gt;&lt;/a&gt; - Initialize PatternProcessor before trigging policy and allow file extension to be modified during reconfiguration&lt;/p&gt;</comment>
                            <comment id="17086658" author="jira-bot" created="Sat, 18 Apr 2020 21:24:24 +0000"  >&lt;p&gt;Commit d7ea9e60502b8ae3c46f290ae7d254f4a6e5aec6 in logging-log4j2&apos;s branch refs/heads/master from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=d7ea9e6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=d7ea9e6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2766&quot; title=&quot;TimeBasedTriggeringPolicy of RollingRandomAccessFile is not updated instantly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2766&quot;&gt;&lt;del&gt;LOG4J2-2766&lt;/del&gt;&lt;/a&gt;,&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2457&quot; title=&quot;RollingRandomAccessFileManager ignores new file patterns from programmatic reconfiguration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2457&quot;&gt;&lt;del&gt;LOG4J2-2457&lt;/del&gt;&lt;/a&gt; - Initialize PatternProcessor before trigging policy and allow file extension to be modified during reconfiguration&lt;/p&gt;</comment>
                            <comment id="17086660" author="ralph.goers@dslextreme.com" created="Sat, 18 Apr 2020 21:25:08 +0000"  >&lt;p&gt;updateData has been modified as suggested. Please verify and close.&lt;/p&gt;</comment>
                            <comment id="17264761" author="heikos" created="Thu, 14 Jan 2021 10:35:14 +0000"  >&lt;p&gt;Works now as expected - great work Ralph, thank you a lot.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13253927">LOG4J2-2685</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12666624">LOG4J2-381</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13084102">LOG4J2-1964</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13187877">LOG4J2-2457</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12991729" name="testcase.zip" size="1876" author="HeikoS" created="Fri, 24 Jan 2020 10:32:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 43 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0attc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>