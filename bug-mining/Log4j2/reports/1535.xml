<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:42:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-3330] Configurator.setLevel not fetching the correct LoggerContext</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-3330</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;I needed to set the log level for a certain logger in the application and for that I tried using the following code:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;Configurator.setLevel(logger,level)&lt;/tt&gt; but it did not seem to set the proper logging level.&lt;/p&gt;

&lt;p&gt;After looking over the source code I have noticed the following behaviour:&lt;/p&gt;

&lt;p&gt;Inside setLevel there is this line:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
LoggerContext loggerContext = LoggerContext.getContext(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Which fetches the LoggerContext for the caller class.&lt;/p&gt;

&lt;p&gt;In turn , LoggerContext.getContext has the following content:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; LoggerContext getContext(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; currentContext)
{ &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; (LoggerContext) LogManager.getContext(currentContext); }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Which delegates the context fetching to LogManager&lt;/p&gt;

&lt;p&gt;LogManager in turn get&apos;s the context by passing a hardcoded class name as the stack marker:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; FQCN = LogManager.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;getName();&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Because of this , the methods LoggerContext.getContext and LogManager.getContext behave differently in environments with multiple LoggerContexts and ClassLoaders&lt;/p&gt;

&lt;p&gt;Test:&#160;&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Calling LoggerContext.getContext - returns LoggerContextA - corresponding to the classloader of LoggerContext because if we look at the stack trace:&lt;/li&gt;
&lt;/ol&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
getCallerClass:151, StackLocator (org.apache.logging.log4j.util)
getCallerClass:70, StackLocatorUtil (org.apache.logging.log4j.util)
getCallerClass:58, StackLocatorUtil (org.apache.logging.log4j.util)
getContext:138, ClassLoaderContextSelector (org.apache.logging.log4j.core.selector)
getContext:123, ClassLoaderContextSelector (org.apache.logging.log4j.core.selector)
getContext:230, Log4jContextFactory (org.apache.logging.log4j.core.impl)
getContext:47, Log4jContextFactory (org.apache.logging.log4j.core.impl)
getContext:176, LogManager (org.apache.logging.log4j)
getContext:231, LoggerContext (org.apache.logging.log4j.core) &amp;lt;---- returns &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;
handle:24, LogLevelChangeHandler (com.ispring.log.event) &amp;lt;----- real caller class&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Because of the fact that the context is fetched by providing the hardcoded FQCN which is LogManager ... getCallerClass(FQCN) will return LoggerContext instead of returning LogLevelChangeHandler ( the real caller )&lt;/p&gt;

&lt;p&gt;2. Calling LogManager.getContext - returns LoggerContextB - corresponding to the classloader of LogLevelChangeHandler which is the correct behaviour since LogLevelChangeHandler is the class that is actually requesting the context.&lt;/p&gt;

&lt;p&gt;If we look at the stack trace:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
getCallerClass:151, StackLocator (org.apache.logging.log4j.util)
getCallerClass:70, StackLocatorUtil (org.apache.logging.log4j.util)
getCallerClass:58, StackLocatorUtil (org.apache.logging.log4j.util)
getContext:138, ClassLoaderContextSelector (org.apache.logging.log4j.core.selector)
getContext:123, ClassLoaderContextSelector (org.apache.logging.log4j.core.selector)
getContext:230, Log4jContextFactory (org.apache.logging.log4j.core.impl)
getContext:47, Log4jContextFactory (org.apache.logging.log4j.core.impl)
getContext:176, LogManager (org.apache.logging.log4j) &amp;lt;-- &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt; point&#160;
handle:25, LogLevelChangeHandler (com.ispring.log.event) &amp;lt;--- the correct &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;to be returned&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Because of the behaviour mentioned above , calling Configurator.setLevel doesn&apos;t have de desired effect in environments with multiple LoggerContexts ( webapp deployed in tomcat ) because it&apos;s setting the level one some LoggerContext which is not the one used by the application classes.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13422184">LOG4J2-3330</key>
            <summary>Configurator.setLevel not fetching the correct LoggerContext</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ggregory">Gary D. Gregory</assignee>
                                    <reporter username="mlemnaru">Mircea Lemnaru</reporter>
                        <labels>
                    </labels>
                <created>Wed, 12 Jan 2022 09:39:34 +0000</created>
                <updated>Sun, 16 Jan 2022 17:00:14 +0000</updated>
                            <resolved>Wed, 12 Jan 2022 14:00:04 +0000</resolved>
                                    <version>2.17.1</version>
                                    <fixVersion>2.17.2</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17474497" author="garydgregory" created="Wed, 12 Jan 2022 12:53:57 +0000"  >&lt;p&gt;The problems applies to the following APIs in &lt;tt&gt;org.apache.logging.log4j.core.config.Configurator&lt;/tt&gt;:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;setAllLevels(String, Level)&lt;/li&gt;
	&lt;li&gt;Configurator.setLevel(Map&amp;lt;String, Level&amp;gt;)&lt;/li&gt;
	&lt;li&gt;setLevel(String, Level)&lt;/li&gt;
	&lt;li&gt;setRootLevel(Level)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Fixing...&lt;/p&gt;</comment>
                            <comment id="17474509" author="jira-bot" created="Wed, 12 Jan 2022 13:09:14 +0000"  >&lt;p&gt;Commit 585df0052ccf7a9d0ff2bc2a625c975ff9eceb09 in logging-log4j2&apos;s branch refs/heads/release-2.x from Gary Gregory&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=585df00&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=585df00&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3330&quot; title=&quot;Configurator.setLevel not fetching the correct LoggerContext&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3330&quot;&gt;&lt;del&gt;LOG4J2-3330&lt;/del&gt;&lt;/a&gt; Configurator.setLevel not fetching the correct&lt;br/&gt;
LoggerContext.&lt;/p&gt;</comment>
                            <comment id="17474510" author="jira-bot" created="Wed, 12 Jan 2022 13:09:14 +0000"  >&lt;p&gt;Commit 8a77923fb8f451dc1f3e52c6e64e154c8bc2bcba in logging-log4j2&apos;s branch refs/heads/release-2.x from Gary Gregory&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=8a77923&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=8a77923&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3330&quot; title=&quot;Configurator.setLevel not fetching the correct LoggerContext&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3330&quot;&gt;&lt;del&gt;LOG4J2-3330&lt;/del&gt;&lt;/a&gt; Configurator.setLevel not fetching the correct&lt;br/&gt;
LoggerContext.&lt;/p&gt;</comment>
                            <comment id="17474546" author="garydgregory" created="Wed, 12 Jan 2022 13:59:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mlemnaru&quot; class=&quot;user-hover&quot; rel=&quot;mlemnaru&quot;&gt;mlemnaru&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Please try the git branch &lt;b&gt;release-2.x&lt;/b&gt; or a &lt;b&gt;2.17.2-SNAPSHOT&lt;/b&gt; build from &lt;a href=&quot;https://repository.apache.org/content/repositories/snapshots/org/apache/logging/log4j/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/repositories/snapshots/org/apache/logging/log4j/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17474547" author="jira-bot" created="Wed, 12 Jan 2022 14:00:43 +0000"  >&lt;p&gt;Commit 606bea12b2fa1399e7756aefdc1e422ab1a7c28c in logging-log4j2&apos;s branch refs/heads/master from Gary Gregory&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=606bea1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=606bea1&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3330&quot; title=&quot;Configurator.setLevel not fetching the correct LoggerContext&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3330&quot;&gt;&lt;del&gt;LOG4J2-3330&lt;/del&gt;&lt;/a&gt; Configurator.setLevel not fetching the correct&lt;br/&gt;
LoggerContext.&lt;/p&gt;</comment>
                            <comment id="17474551" author="jira-bot" created="Wed, 12 Jan 2022 14:03:38 +0000"  >&lt;p&gt;Commit 0fc41eb518d1e826ebc90ee7c9d1bacb3d1a3553 in logging-log4j2&apos;s branch refs/heads/release-2.x from Gary Gregory&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=0fc41eb&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=0fc41eb&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3330&quot; title=&quot;Configurator.setLevel not fetching the correct LoggerContext&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3330&quot;&gt;&lt;del&gt;LOG4J2-3330&lt;/del&gt;&lt;/a&gt; Configurator.setLevel not fetching the correct&lt;br/&gt;
LoggerContext.&lt;/p&gt;

&lt;p&gt;Don&apos;t use deprecated API that does not use its second argument anyway.&lt;/p&gt;</comment>
                            <comment id="17474552" author="jira-bot" created="Wed, 12 Jan 2022 14:04:57 +0000"  >&lt;p&gt;Commit 263763a92fbbcb168cc2b5e8961c45c5e9cb8f5a in logging-log4j2&apos;s branch refs/heads/master from Gary Gregory&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=263763a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=263763a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3330&quot; title=&quot;Configurator.setLevel not fetching the correct LoggerContext&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3330&quot;&gt;&lt;del&gt;LOG4J2-3330&lt;/del&gt;&lt;/a&gt; Configurator.setLevel not fetching the correct&lt;br/&gt;
LoggerContext.&lt;/p&gt;

&lt;p&gt;Don&apos;t use deprecated API that does not use its second argument anyway.&lt;/p&gt;

&lt;p&gt;Port from release-2.x.&lt;/p&gt;</comment>
                            <comment id="17476834" author="jira-bot" created="Sun, 16 Jan 2022 17:00:14 +0000"  >&lt;p&gt;Commit 7ed139634967f091c700fbc22c73d65f7af5cff9 in logging-log4j2&apos;s branch refs/heads/master from Gary Gregory&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=7ed1396&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=7ed1396&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3330&quot; title=&quot;Configurator.setLevel not fetching the correct LoggerContext&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3330&quot;&gt;&lt;del&gt;LOG4J2-3330&lt;/del&gt;&lt;/a&gt; Configurator.setLevel not fetching the correct&lt;br/&gt;
LoggerContext.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 43 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0yi4g:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>