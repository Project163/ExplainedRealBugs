<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:31:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-280] AsynchAppender&apos;s AsynchThread blocks Tomcat shutdown</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-280</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;Since I added an AsynchAppender to my configuration (to send mails with errors asynchronously), my Tomcat refuses to shut down nicely. It always freezes on a line like this:&lt;br/&gt;
...&lt;br/&gt;
Jun 11, 2013 6:57:04 PM org.apache.coyote.http11.Http11Protocol destroy&lt;br/&gt;
INFO: Stopping Coyote HTTP/1.1 on http-8080&lt;br/&gt;
Jun 11, 2013 6:57:04 PM org.apache.coyote.http11.Http11Protocol destroy&lt;br/&gt;
INFO: Stopping Coyote HTTP/1.1 on http-8443&lt;/p&gt;

&lt;p&gt;At this point, there is a non-daemon thread called &quot;Thread-2&quot; that, if I kill, Tomcat stops nicely.&lt;/p&gt;

&lt;p&gt;I have traced this issue to the AsynchThread in AsynchAppender, and if I stop using it in my configuration, Tomcat stops nicely again.&lt;/p&gt;

&lt;p&gt;Could you tell me what additional information I may provide to help track down this issue?&lt;/p&gt;</description>
                <environment>&lt;p&gt;Log4j 2.0 beta 4, Tomcat 6, Java 6 @ Mac OS X&lt;/p&gt;</environment>
        <key id="12652236">LOG4J2-280</key>
            <summary>AsynchAppender&apos;s AsynchThread blocks Tomcat shutdown</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rpopma">Remko Popma</assignee>
                                    <reporter username="vektor330">Matej Vit&#225;sek</reporter>
                        <labels>
                    </labels>
                <created>Tue, 11 Jun 2013 17:01:29 +0000</created>
                <updated>Tue, 23 Jul 2013 21:28:25 +0000</updated>
                            <resolved>Tue, 23 Jul 2013 21:28:25 +0000</resolved>
                                    <version>2.0-beta4</version>
                    <version>2.0-beta5</version>
                    <version>2.0-beta6</version>
                    <version>2.0-beta7</version>
                                    <fixVersion>2.0-beta8</fixVersion>
                    <fixVersion>2.0-beta9</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13680784" author="remkop@yahoo.com" created="Tue, 11 Jun 2013 22:52:43 +0000"  >&lt;p&gt;A similar issue was fixed in beta6. Can you try again with the latest release, beta7, and let us know if the issue is still there?&lt;/p&gt;</comment>
                            <comment id="13681002" author="vektor330" created="Wed, 12 Jun 2013 06:59:31 +0000"  >&lt;p&gt;Remko, thanks for the advice. I have just tried using beta7, and I am getting the same behavior.&lt;/p&gt;</comment>
                            <comment id="13691227" author="tn" created="Sat, 22 Jun 2013 19:27:43 +0000"  >&lt;p&gt;Could you provide a stacktrace of the thread that hangs? Looking at the code of the async appender, there is no apparent call that may block apart from the queue (but this is handled via the shutdown method).&lt;/p&gt;

&lt;p&gt;We could also issue a thread.interrupt() before the call to join, but I would still like to see the stacktrace first.&lt;/p&gt;</comment>
                            <comment id="13691361" author="ralph.goers@dslextreme.com" created="Sun, 23 Jun 2013 06:48:43 +0000"  >&lt;p&gt;Actually, the fix for this is most likely to have the AsyncThread constructor do &lt;/p&gt;

&lt;p&gt;this.setDaemon(true);&lt;/p&gt;</comment>
                            <comment id="13696241" author="remkop@yahoo.com" created="Sun, 30 Jun 2013 02:14:32 +0000"  >&lt;p&gt;Fixed in revision 1498051: threads used by the async loggers are now daemon threads so should not prevent the JVM from shutting down any more.&lt;/p&gt;

&lt;p&gt;Please verify and close.&lt;/p&gt;</comment>
                            <comment id="13704280" author="vektor330" created="Wed, 10 Jul 2013 07:33:15 +0000"  >&lt;p&gt;Thanks guys, I will test this as soon as beta8 is out (any idea about when it will be?).&lt;/p&gt;</comment>
                            <comment id="13714958" author="vektor330" created="Mon, 22 Jul 2013 06:52:25 +0000"  >&lt;p&gt;As far as I can tell, the aforementioned fix is not present in beta8...&lt;/p&gt;</comment>
                            <comment id="13714961" author="remkop@yahoo.com" created="Mon, 22 Jul 2013 07:01:30 +0000"  >&lt;p&gt;Matej, AsyncLogger threads are definitely daemon threads as of beta8.&lt;br/&gt;
Their thread name is now &quot;AsyncLogger-X&quot; or &quot;AsyncLoggerConfig-X&quot; (where X is 1, 2, 3...)&lt;/p&gt;

&lt;p&gt;What is the issue you are seeing? Same as before? What is the thread name? &lt;/p&gt;</comment>
                            <comment id="13714971" author="vektor330" created="Mon, 22 Jul 2013 07:16:32 +0000"  >&lt;p&gt;Remko, I have just downloaded the beta8 bin and src from the project main page. I am looking into the org.apache.logging.log4j.core.appender.AsyncAppender class and don&apos;t see any setDaemon() calls in it. When I run the Tomcat I am still having the original problems.&lt;/p&gt;</comment>
                            <comment id="13715051" author="remkop@yahoo.com" created="Mon, 22 Jul 2013 09:38:34 +0000"  >&lt;p&gt;Ah... My mistake!&lt;br/&gt;
Only AsyncLogger threads are daemon threads. I did not fix the AsyncAppender thread...&lt;br/&gt;
I&apos;ll fix this soon, so it is in the next release.&lt;/p&gt;

&lt;p&gt;As a workaround, is it possible for you to use the AsyncLoggers instead of AsyncAppender?&lt;/p&gt;</comment>
                            <comment id="13715053" author="vektor330" created="Mon, 22 Jul 2013 09:40:51 +0000"  >&lt;p&gt;Thanks for the info, I will probably wait for the next version (it was some time since I understood the config enough &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; ).&lt;/p&gt;</comment>
                            <comment id="13715126" author="remkop@yahoo.com" created="Mon, 22 Jul 2013 11:33:22 +0000"  >&lt;p&gt;The simplest way to use AsyncLoggers would be to remove the Async appender from the config and set system property &lt;tt&gt;-DLog4jContextSelector=org.apache.logging.log4j.core.async.AsyncLoggerContextSelector&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="13717644" author="remkop@yahoo.com" created="Tue, 23 Jul 2013 21:28:25 +0000"  >&lt;p&gt;Committed revision 1506290:&lt;br/&gt;
Additional fix to make AsyncAppender threads daemon threads and improve their thread name.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>332560</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 18 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ldbr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>332889</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>