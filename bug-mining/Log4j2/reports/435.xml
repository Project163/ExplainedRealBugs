<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:33:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-919] Logging system fails to initialize if XInclude is not available</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-919</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;I have a setup that involves Tomcat 7 running under JDK6 which has been using lgo4j 2 since around beta3 or so.  After a recent upgrade attempt I was left with a system that basically had no logging at all.&lt;/p&gt;

&lt;p&gt;I started back at beta6 (my last known working version) and upgraded one release at a time until it finally broke at beta9.  I got the source code for this version and spent a considerable amount of time running Tomcat under a debugger and tracing it down to an exception that occurs during initialization of the XML config.&lt;/p&gt;

&lt;p&gt;The actual exception, however, is not caught and then subsequently lost higher up in the stack!  And, to make matters worse, it never gets to the point of creating the StatusLogger, so I can&apos;t get any help from that kind of trace output.  So as a result, it just silently fails, and reverts back to the default configuration of ERROR to Console only with no internal log messages.&lt;/p&gt;

&lt;p&gt;After narrowing down to where the exception occurs, it seems to have been introduced in beta9 by &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-341&quot; title=&quot;Enable XInclude for XML configurations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-341&quot;&gt;&lt;del&gt;LOG4J2-341&lt;/del&gt;&lt;/a&gt; which adds XInclude support.  The offending line is in XMLconfiguration.enableXInclude(...) where it calls factory.setXIncludeAware(true).  I was unable to get the actual exception itself, but I think it was a NoSuchMethodError.  Using debug watches I painstakingly constructed this stack trace (line #s are based on beta9 code):&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.logging.log4j.core.config.XMLConfiguration.enableXInclude(XMLConfiguration.java:110)
org.apache.logging.log4j.core.config.XMLConfiguration.newDocumentBuilder(XMLConfiguration.java:97)
org.apache.logging.log4j.core.config.XMLConfiguration.&amp;lt;init&amp;gt;(XMLConfiguration.java:146)
org.apache.logging.log4j.core.config.XMLConfigurationFactory.getConfiguration(XMLConfigurationFactory.java:40)
org.apache.logging.log4j.core.config.ConfigurationFactory$Factory.getConfiguration(ConfigurationFactory.java:446)
org.apache.logging.log4j.core.config.ConfigurationFactory$Factory.getConfiguration(ConfigurationFactory.java:420)
org.apache.logging.log4j.core.LoggerContext.reconfigure(LoggerContext.java:377)
org.apache.logging.log4j.core.LoggerContext.start(LoggerContext.java:149)
org.apache.logging.log4j.core.impl.Log4jContextFactory.getContext(Log4jContextFactory.java:85)
org.apache.logging.log4j.core.impl.Log4jContextFactory.getContext(Log4jContextFactory.java:34)
org.apache.logging.log4j.LogManager.getContext(LogManager.java:200)
org.apache.log4j.Logger$PrivateManager.getContext(Logger.java:61)
org.apache.log4j.Logger.getLogger(Logger.java:39)
[snip for brevity]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This call is wrapped in a try/catch, but only catches these exceptions:&lt;br/&gt;
UnsupportedOperationException&lt;br/&gt;
AbstractMethodError&lt;/p&gt;

&lt;p&gt;I compared each version after that, and the code for this method hasn&apos;t really changed much (some revisions in 2.0-rc2 I believe) so that would be why the issue persists in 2.1 still.&lt;/p&gt;


&lt;p&gt;I have a feeling the javax.xml.* libraries on my system are outdated, and will look into that further.  But in the meantime I figured I would report this not-graceful-at-all handling of the situation where XInclude is not supported by the system.  Hopefully this is enough detail for someone to be able to reproduce &amp;amp; fix the problem.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Linux x86_64, JDK 1.6.x&lt;/p&gt;</environment>
        <key id="12760877">LOG4J2-919</key>
            <summary>Logging system fails to initialize if XInclude is not available</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ggregory">Gary D. Gregory</assignee>
                                    <reporter username="djohle">David Johle</reporter>
                        <labels>
                            <label>config</label>
                            <label>initialization</label>
                            <label>xml</label>
                    </labels>
                <created>Wed, 10 Dec 2014 22:20:12 +0000</created>
                <updated>Tue, 22 Sep 2015 17:34:24 +0000</updated>
                            <resolved>Fri, 12 Dec 2014 00:39:23 +0000</resolved>
                                    <version>2.0-beta9</version>
                    <version>2.0-rc1</version>
                    <version>2.0-rc2</version>
                    <version>2.0</version>
                    <version>2.0.1</version>
                    <version>2.0.2</version>
                    <version>2.1</version>
                                    <fixVersion>2.2</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14241870" author="garydgregory" created="Wed, 10 Dec 2014 22:34:37 +0000"  >&lt;p&gt;David,&lt;/p&gt;

&lt;p&gt;It sounds like you have an antique version of Xerces or the xml-aps jar on your endorsed class path. Is that possible for your set up?&lt;/p&gt;

&lt;p&gt;Can you use the latest Java 6 (IIRC that&apos;s update 45) just to rule that out?&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;</comment>
                            <comment id="14241879" author="garydgregory" created="Wed, 10 Dec 2014 22:41:06 +0000"  >&lt;p&gt;Actually, the Java version will not matter if the endorsed mechanism is used. I am guessing your Tomcat set up has an old Xerces like this: &lt;a href=&quot;https://community.oracle.com/thread/1629222?start=0&amp;amp;tstart=0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://community.oracle.com/thread/1629222?start=0&amp;amp;tstart=0&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14241881" author="garydgregory" created="Wed, 10 Dec 2014 22:42:00 +0000"  >&lt;p&gt;The question for us is whether we should change the code to guard against this specific issue (not a big change).&lt;/p&gt;</comment>
                            <comment id="14241931" author="djohle" created="Wed, 10 Dec 2014 23:17:56 +0000"  >&lt;p&gt;Yes, it was an outdated xerces in the endorsed directory.  Looks like it had been there for a LONG time, as in before the upgrade to Tomcat 7 a couple years back.  I obliterated that and everything fired up perfectly.&lt;/p&gt;

&lt;p&gt;So yes, I&apos;ll leave it up to you guys to decide on whether it&apos;s worth it or not to handle that situation differently in the Log4j 2 code.&lt;/p&gt;

&lt;p&gt;FWIW, it seems the place the exception was &quot;lost&quot; is in the LoggerContext.start() method, which has a try/finally without a catch.&lt;/p&gt;</comment>
                            <comment id="14243483" author="garydgregory" created="Fri, 12 Dec 2014 00:39:23 +0000"  >&lt;p&gt;Fixed in SVN. Feel free to test the SNAPSHOT build I just pushed: &lt;a href=&quot;https://repository.apache.org/content/repositories/snapshots/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/repositories/snapshots/&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12895508">LOG4J2-1127</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 49 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i23atz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>