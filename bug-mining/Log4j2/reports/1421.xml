<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:41:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-2883] Size based rolling stops working after first time base rolling</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-2883</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;When configuring a logger with time based rolling and size based rolling. The size based rolling fails after the first time based rolling.&lt;/p&gt;

&lt;p&gt;Note: This is slightly related to &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2875&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;LOG4J2-2875&lt;/a&gt;. With no modifications the sample code below shows the problem, but also IOExceptions occur which seems not to be related to this issue.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.awt.Desktop;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io.File;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.nio.file.Files;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.nio.file.Path;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; java.util.Arrays.asList;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; java.util.Collections.sort;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.List;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.Properties;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.logging.log4j.core.Logger;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.logging.log4j.core.LoggerContext;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.logging.log4j.core.config.properties.PropertiesConfiguration;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.logging.log4j.core.config.properties.PropertiesConfigurationBuilder;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; org.junit.jupiter.api.Assertions.assertEquals;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.junit.jupiter.api.Test;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;RollingTest {

  @Test
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void sizeBasedRollingBrokenAfterTimeBasedRolling() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.setProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;log4j2.debug&quot;&lt;/span&gt;, &quot;&quot;);

    Path tempDirectory = Files.createTempDirectory(&lt;span class=&quot;code-quote&quot;&gt;&quot;log4j2&quot;&lt;/span&gt;);
    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(tempDirectory);

    Properties log4j2Properties = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Properties();
    log4j2Properties.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;appender.localmsglog.type&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;RollingFile&quot;&lt;/span&gt;);
    log4j2Properties.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;appender.localmsglog.name&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;localmsglog&quot;&lt;/span&gt;);
    log4j2Properties.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;appender.localmsglog.filePattern&quot;&lt;/span&gt;, tempDirectory.toFile().getAbsolutePath() + &lt;span class=&quot;code-quote&quot;&gt;&quot;/%d{yyyy_MM_dd_mm}/messages-$${date:yyyy_MM_dd_HH_mm_ss_S}.log&quot;&lt;/span&gt;);
    log4j2Properties.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;appender.localmsglog.policies.type&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;Policies&quot;&lt;/span&gt;);
    log4j2Properties.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;appender.localmsglog.policies.1.type&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;SizeBasedTriggeringPolicy&quot;&lt;/span&gt;);
    log4j2Properties.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;appender.localmsglog.policies.1.size&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;10KB&quot;&lt;/span&gt;);
    log4j2Properties.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;appender.localmsglog.policies.2.type&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;TimeBasedTriggeringPolicy&quot;&lt;/span&gt;);

    log4j2Properties.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;rootLogger.level&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;info&quot;&lt;/span&gt;);
    log4j2Properties.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;rootLogger.appenderRef.1.ref&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;localmsglog&quot;&lt;/span&gt;);

    PropertiesConfiguration config = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PropertiesConfigurationBuilder()
            .setRootProperties(log4j2Properties)
            .build();

    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Test directory: &quot;&lt;/span&gt; + tempDirectory.toString());
    Desktop.getDesktop().open(tempDirectory.toFile());
    org.apache.logging.log4j.core.config.Configurator.reconfigure(config);

    LoggerContext context = LoggerContext.getContext(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
    Logger log = context.getRootLogger();

    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; 1000; i++) {
      log.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;nHq6p9kgfvWfjzDRYbZp&quot;&lt;/span&gt;);
    }
    &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(60000);
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; 1000; i++) {
      log.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;nHq6p9kgfvWfjzDRYbZp&quot;&lt;/span&gt;);
    }

    File tempDirectoryAsFile = tempDirectory.toFile();
    List&amp;lt;File&amp;gt; loggingFolders = asList(tempDirectoryAsFile.listFiles());
    sort(loggingFolders);
    &lt;span class=&quot;code-comment&quot;&gt;// Check &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; two folders were created
&lt;/span&gt;    assertEquals(2, loggingFolders.size());
    
    &lt;span class=&quot;code-comment&quot;&gt;// Check &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; first folder contains 3 log files
&lt;/span&gt;    assertEquals(3, loggingFolders.get(0).listFiles().length);

    &lt;span class=&quot;code-comment&quot;&gt;// Check &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; second folder contains 3 log files as well
&lt;/span&gt;    assertEquals(3, loggingFolders.get(1).listFiles().length);
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;Output:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;-------------------------------------------------------
 T E S T S
-------------------------------------------------------
Running com.amadeus.rail.utils.log4j.RollingTest
C:\Users\BENJAM~1.ASB\AppData\Local\Temp\log4j24342776539466181785
DEBUG StatusLogger Using ShutdownCallbackRegistry class org.apache.logging.log4j.core.util.DefaultShutdownCallbackRegistry
DEBUG StatusLogger Not in a ServletContext environment, thus not loading WebLookup plugin.
DEBUG StatusLogger AsyncLogger.ThreadNameStrategy=UNCACHED (user specified null, default is UNCACHED)
TRACE StatusLogger Using default SystemClock for timestamps.
DEBUG StatusLogger org.apache.logging.log4j.core.util.SystemClock supports precise timestamps.
Test directory: C:\Users\BENJAM~1.ASB\AppData\Local\Temp\log4j24342776539466181785
DEBUG StatusLogger Not in a ServletContext environment, thus not loading WebLookup plugin.
DEBUG StatusLogger Not in a ServletContext environment, thus not loading WebLookup plugin.
DEBUG StatusLogger Took 0,125982 seconds to load 239 plugins from jdk.internal.loader.ClassLoaders$AppClassLoader@57ccce09
DEBUG StatusLogger PluginManager &apos;Converter&apos; found 46 plugins
DEBUG StatusLogger Starting OutputStreamManager SYSTEM_OUT.false.false-1
DEBUG StatusLogger Starting LoggerContext[name=57ccce09, org.apache.logging.log4j.core.LoggerContext@f72a1a9]...
DEBUG StatusLogger Reconfiguration started for context[name=57ccce09] at URI null (org.apache.logging.log4j.core.LoggerContext@f72a1a9) with optional ClassLoader: null
DEBUG StatusLogger Not in a ServletContext environment, thus not loading WebLookup plugin.
DEBUG StatusLogger PluginManager &apos;ConfigurationFactory&apos; found 5 plugins
DEBUG StatusLogger Not in a ServletContext environment, thus not loading WebLookup plugin.
DEBUG StatusLogger Not in a ServletContext environment, thus not loading WebLookup plugin.
DEBUG StatusLogger Not in a ServletContext environment, thus not loading WebLookup plugin.
DEBUG StatusLogger Missing dependencies for Yaml support, ConfigurationFactory org.apache.logging.log4j.core.config.yaml.YamlConfigurationFactory is inactive
DEBUG StatusLogger Not in a ServletContext environment, thus not loading WebLookup plugin.
DEBUG StatusLogger Missing dependencies for Json support, ConfigurationFactory org.apache.logging.log4j.core.config.json.JsonConfigurationFactory is inactive
DEBUG StatusLogger Not in a ServletContext environment, thus not loading WebLookup plugin.
DEBUG StatusLogger Using configurationFactory org.apache.logging.log4j.core.config.ConfigurationFactory$Factory@cb49d772
TRACE StatusLogger Trying to find [log4j2-test57ccce09.properties] using context class loader jdk.internal.loader.ClassLoaders$AppClassLoader@57ccce09.
TRACE StatusLogger Trying to find [log4j2-test57ccce09.properties] using jdk.internal.loader.ClassLoaders$AppClassLoader@57ccce09 class loader.
TRACE StatusLogger Trying to find [log4j2-test57ccce09.properties] using jdk.internal.loader.ClassLoaders$AppClassLoader@57ccce09 class loader.
TRACE StatusLogger Trying to find [log4j2-test57ccce09.properties] using ClassLoader.getSystemResource().
TRACE StatusLogger Trying to find [log4j2-test57ccce09.properties] using context class loader jdk.internal.loader.ClassLoaders$AppClassLoader@57ccce09.
TRACE StatusLogger Trying to find [log4j2-test57ccce09.properties] using jdk.internal.loader.ClassLoaders$AppClassLoader@57ccce09 class loader.
TRACE StatusLogger Trying to find [log4j2-test57ccce09.properties] using jdk.internal.loader.ClassLoaders$AppClassLoader@57ccce09 class loader.
TRACE StatusLogger Trying to find [log4j2-test57ccce09.properties] using ClassLoader.getSystemResource().
TRACE StatusLogger Trying to find [log4j2-test57ccce09.yml] using context class loader jdk.internal.loader.ClassLoaders$AppClassLoader@57ccce09.
TRACE StatusLogger Trying to find [log4j2-test57ccce09.yml] using jdk.internal.loader.ClassLoaders$AppClassLoader@57ccce09 class loader.
TRACE StatusLogger Trying to find [log4j2-test57ccce09.yml] using jdk.internal.loader.ClassLoaders$AppClassLoader@57ccce09 class loader.
TRACE StatusLogger Trying to find [log4j2-test57ccce09.yml] using ClassLoader.getSystemResource().
TRACE StatusLogger Trying to find [log4j2-test57ccce09.yaml] using context class loader jdk.internal.loader.ClassLoaders$AppClassLoader@57ccce09.
TRACE StatusLogger Trying to find [log4j2-test57ccce09.yaml] using jdk.internal.loader.ClassLoaders$AppClassLoader@57ccce09 class loader.
TRACE StatusLogger Trying to find [log4j2-test57ccce09.yaml] using jdk.internal.loader.ClassLoaders$AppClassLoader@57ccce09 class loader.
TRACE StatusLogger Trying to find [log4j2-test57ccce09.yaml] using ClassLoader.getSystemResource().
TRACE StatusLogger Trying to find [log4j2-test57ccce09.json] using context class loader jdk.internal.loader.ClassLoaders$AppClassLoader@57ccce09.
TRACE StatusLogger Trying to find [log4j2-test57ccce09.json] using jdk.internal.loader.ClassLoaders$AppClassLoader@57ccce09 class loader.
TRACE StatusLogger Trying to find [log4j2-test57ccce09.json] using jdk.internal.loader.ClassLoaders$AppClassLoader@57ccce09 class loader.
TRACE StatusLogger Trying to find [log4j2-test57ccce09.json] using ClassLoader.getSystemResource().
TRACE StatusLogger Trying to find [log4j2-test57ccce09.jsn] using context class loader jdk.internal.loader.ClassLoaders$AppClassLoader@57ccce09.
TRACE StatusLogger Trying to find [log4j2-test57ccce09.jsn] using jdk.internal.loader.ClassLoaders$AppClassLoader@57ccce09 class loader.
TRACE StatusLogger Trying to find [log4j2-test57ccce09.jsn] using jdk.internal.loader.ClassLoaders$AppClassLoader@57ccce09 class loader.
TRACE StatusLogger Trying to find [log4j2-test57ccce09.jsn] using ClassLoader.getSystemResource().
TRACE StatusLogger Trying to find [log4j2-test57ccce09.xml] using context class loader jdk.internal.loader.ClassLoaders$AppClassLoader@57ccce09.
TRACE StatusLogger Trying to find [log4j2-test57ccce09.xml] using jdk.internal.loader.ClassLoaders$AppClassLoader@57ccce09 class loader.
TRACE StatusLogger Trying to find [log4j2-test57ccce09.xml] using jdk.internal.loader.ClassLoaders$AppClassLoader@57ccce09 class loader.
TRACE StatusLogger Trying to find [log4j2-test57ccce09.xml] using ClassLoader.getSystemResource().
TRACE StatusLogger Trying to find [log4j2-test.properties] using context class loader jdk.internal.loader.ClassLoaders$AppClassLoader@57ccce09.
DEBUG StatusLogger Not in a ServletContext environment, thus not loading WebLookup plugin.
DEBUG StatusLogger Apache Log4j Core 2.13.1 initializing configuration org.apache.logging.log4j.core.config.properties.PropertiesConfiguration@81c96556
DEBUG StatusLogger Installed 1 script engine
Warning: Nashorn engine is planned to be removed from a future JDK release
DEBUG StatusLogger Oracle Nashorn version: 11.0.6, language: ECMAScript, threading: Not Thread Safe, compile: true, names: [nashorn, Nashorn, js, JS, JavaScript, javascript, ECMAScript, ecmascript], factory class: jdk.nashorn.api.scripting.NashornScriptEngineFactory
DEBUG StatusLogger PluginManager &apos;Core&apos; found 133 plugins
DEBUG StatusLogger PluginManager &apos;Level&apos; found 1 plugins
DEBUG StatusLogger PluginManager &apos;Lookup&apos; found 15 plugins
DEBUG StatusLogger Building Plugin[name=AppenderRef, class=org.apache.logging.log4j.core.config.AppenderRef].
TRACE StatusLogger TypeConverterRegistry initializing.
DEBUG StatusLogger PluginManager &apos;TypeConverter&apos; found 26 plugins
DEBUG StatusLogger createAppenderRef(ref=&quot;consoleAppender&quot;, level=&quot;null&quot;, Filter=null)
DEBUG StatusLogger Building Plugin[name=AppenderRef, class=org.apache.logging.log4j.core.config.AppenderRef].
DEBUG StatusLogger createAppenderRef(ref=&quot;listAppender&quot;, level=&quot;null&quot;, Filter=null)
DEBUG StatusLogger Building Plugin[name=root, class=org.apache.logging.log4j.core.config.LoggerConfig$RootLogger].
DEBUG StatusLogger createLogger(additivity=&quot;null&quot;, level=&quot;INFO&quot;, includeLocation=&quot;null&quot;, ={consoleAppender, listAppender}, ={}, Configuration, Filter=null)
DEBUG StatusLogger Building Plugin[name=loggers, class=org.apache.logging.log4j.core.config.LoggersPlugin].
DEBUG StatusLogger createLoggers(={root})
DEBUG StatusLogger Building Plugin[name=layout, class=org.apache.logging.log4j.core.layout.PatternLayout].
DEBUG StatusLogger PatternLayout$Builder(pattern=&quot;[%d{yy-MMM-dd HH:mm:ss:SSS}] [%p] [%c{1}:%L] - %m&quot;, PatternSelector=null, Configuration, Replace=null, charset=&quot;null&quot;, alwaysWriteExceptions=&quot;null&quot;, disableAnsi=&quot;null&quot;, noConsoleNoAnsi=&quot;null&quot;, header=&quot;null&quot;, footer=&quot;null&quot;)
DEBUG StatusLogger PluginManager &apos;Converter&apos; found 46 plugins
DEBUG StatusLogger Building Plugin[name=appender, class=org.apache.logging.log4j.core.appender.ConsoleAppender].
DEBUG StatusLogger ConsoleAppender$Builder(target=&quot;null&quot;, follow=&quot;null&quot;, direct=&quot;null&quot;, bufferedIo=&quot;null&quot;, bufferSize=&quot;null&quot;, immediateFlush=&quot;null&quot;, ignoreExceptions=&quot;null&quot;, PatternLayout([%d{yy-MMM-dd HH:mm:ss:SSS}] [%p] [%c{1}:%L] - %m), name=&quot;consoleAppender&quot;, Configuration, Filter=null, ={})
DEBUG StatusLogger Starting OutputStreamManager SYSTEM_OUT.false.false
DEBUG StatusLogger Building Plugin[name=layout, class=org.apache.logging.log4j.core.layout.PatternLayout].
DEBUG StatusLogger PatternLayout$Builder(pattern=&quot;%m%n&quot;, PatternSelector=null, Configuration, Replace=null, charset=&quot;null&quot;, alwaysWriteExceptions=&quot;null&quot;, disableAnsi=&quot;null&quot;, noConsoleNoAnsi=&quot;null&quot;, header=&quot;null&quot;, footer=&quot;null&quot;)
DEBUG StatusLogger Building Plugin[name=appender, class=org.apache.logging.log4j.test.appender.ListAppender].
DEBUG StatusLogger ListAppender$Builder(name=&quot;listAppender&quot;, entryPerNewLine=&quot;null&quot;, raw=&quot;null&quot;, PatternLayout(%m%n), Filter=null)
DEBUG StatusLogger Building Plugin[name=appenders, class=org.apache.logging.log4j.core.config.AppendersPlugin].
DEBUG StatusLogger createAppenders(={consoleAppender, ListAppender [events=[], messages=[], data=[], newLine=false, raw=false, countDownLatch=null, getHandler()=org.apache.logging.log4j.core.appender.DefaultErrorHandler@a1fb8ca7, getLayout()=%m%n, getName()=listAppender, ignoreExceptions()=true, getFilter()=null, getState()=INITIALIZED]})
DEBUG StatusLogger Configuration org.apache.logging.log4j.core.config.properties.PropertiesConfiguration@81c96556 initialized
DEBUG StatusLogger Starting configuration org.apache.logging.log4j.core.config.properties.PropertiesConfiguration@81c96556
DEBUG StatusLogger Started configuration org.apache.logging.log4j.core.config.properties.PropertiesConfiguration@81c96556 OK.
TRACE StatusLogger Stopping org.apache.logging.log4j.core.config.DefaultConfiguration@98c0d638...
TRACE StatusLogger DefaultConfiguration notified 1 ReliabilityStrategies that config will be stopped.
TRACE StatusLogger DefaultConfiguration stopping root LoggerConfig.
TRACE StatusLogger DefaultConfiguration notifying ReliabilityStrategies that appenders will be stopped.
TRACE StatusLogger DefaultConfiguration stopping remaining Appenders.
DEBUG StatusLogger Shutting down OutputStreamManager SYSTEM_OUT.false.false-1
DEBUG StatusLogger OutputStream closed
DEBUG StatusLogger Shut down OutputStreamManager SYSTEM_OUT.false.false-1, all resources released: true
DEBUG StatusLogger Appender DefaultConsole-1 stopped with status true
TRACE StatusLogger DefaultConfiguration stopped 1 remaining Appenders.
TRACE StatusLogger DefaultConfiguration cleaning Appenders from 1 LoggerConfigs.
DEBUG StatusLogger Stopped org.apache.logging.log4j.core.config.DefaultConfiguration@98c0d638 OK
TRACE StatusLogger Reregistering MBeans after reconfigure. Selector=org.apache.logging.log4j.core.selector.ClassLoaderContextSelector@bafbb692
TRACE StatusLogger Reregistering context (1/1): &apos;57ccce09&apos; org.apache.logging.log4j.core.LoggerContext@f72a1a9
TRACE StatusLogger Unregistering but no MBeans found matching &apos;org.apache.logging.log4j2:type=57ccce09&apos;
TRACE StatusLogger Unregistering but no MBeans found matching &apos;org.apache.logging.log4j2:type=57ccce09,component=StatusLogger&apos;
TRACE StatusLogger Unregistering but no MBeans found matching &apos;org.apache.logging.log4j2:type=57ccce09,component=ContextSelector&apos;
TRACE StatusLogger Unregistering but no MBeans found matching &apos;org.apache.logging.log4j2:type=57ccce09,component=Loggers,name=*&apos;
TRACE StatusLogger Unregistering but no MBeans found matching &apos;org.apache.logging.log4j2:type=57ccce09,component=Appenders,name=*&apos;
TRACE StatusLogger Unregistering but no MBeans found matching &apos;org.apache.logging.log4j2:type=57ccce09,component=AsyncAppenders,name=*&apos;
TRACE StatusLogger Unregistering but no MBeans found matching &apos;org.apache.logging.log4j2:type=57ccce09,component=AsyncLoggerRingBuffer&apos;
TRACE StatusLogger Unregistering but no MBeans found matching &apos;org.apache.logging.log4j2:type=57ccce09,component=Loggers,name=*,subtype=RingBuffer&apos;
DEBUG StatusLogger Registering MBean org.apache.logging.log4j2:type=57ccce09
DEBUG StatusLogger Registering MBean org.apache.logging.log4j2:type=57ccce09,component=StatusLogger
DEBUG StatusLogger Registering MBean org.apache.logging.log4j2:type=57ccce09,component=ContextSelector
DEBUG StatusLogger Registering MBean org.apache.logging.log4j2:type=57ccce09,component=Loggers,name=
DEBUG StatusLogger Registering MBean org.apache.logging.log4j2:type=57ccce09,component=Appenders,name=consoleAppender
DEBUG StatusLogger Registering MBean org.apache.logging.log4j2:type=57ccce09,component=Appenders,name=listAppender
TRACE StatusLogger Using default SystemClock for timestamps.
DEBUG StatusLogger org.apache.logging.log4j.core.util.SystemClock supports precise timestamps.
TRACE StatusLogger Using DummyNanoClock for nanosecond timestamps.
DEBUG StatusLogger Reconfiguration complete for context[name=57ccce09] at URI C:\dev\src\java\amadeus-bahn\log4j2-utils\target\test-classes\log4j2-test.properties (org.apache.logging.log4j.core.LoggerContext@f72a1a9) with optional ClassLoader: null
DEBUG StatusLogger Shutdown hook enabled. Registering a new one.
DEBUG StatusLogger LoggerContext[name=57ccce09, org.apache.logging.log4j.core.LoggerContext@f72a1a9] started OK.
DEBUG StatusLogger Apache Log4j Core 2.13.1 initializing configuration org.apache.logging.log4j.core.config.properties.PropertiesConfiguration@79534c86
DEBUG StatusLogger Installed 1 script engine
Warning: Nashorn engine is planned to be removed from a future JDK release
DEBUG StatusLogger Oracle Nashorn version: 11.0.6, language: ECMAScript, threading: Not Thread Safe, compile: true, names: [nashorn, Nashorn, js, JS, JavaScript, javascript, ECMAScript, ecmascript], factory class: jdk.nashorn.api.scripting.NashornScriptEngineFactory
DEBUG StatusLogger PluginManager &apos;Core&apos; found 133 plugins
DEBUG StatusLogger PluginManager &apos;Level&apos; found 1 plugins
DEBUG StatusLogger PluginManager &apos;Lookup&apos; found 15 plugins
DEBUG StatusLogger Building Plugin[name=AppenderRef, class=org.apache.logging.log4j.core.config.AppenderRef].
DEBUG StatusLogger createAppenderRef(ref=&quot;localmsglog&quot;, level=&quot;null&quot;, Filter=null)
DEBUG StatusLogger Building Plugin[name=root, class=org.apache.logging.log4j.core.config.LoggerConfig$RootLogger].
DEBUG StatusLogger createLogger(additivity=&quot;null&quot;, level=&quot;INFO&quot;, includeLocation=&quot;null&quot;, ={localmsglog}, ={}, Configuration, Filter=null)
DEBUG StatusLogger Building Plugin[name=loggers, class=org.apache.logging.log4j.core.config.LoggersPlugin].
DEBUG StatusLogger createLoggers(={root})
DEBUG StatusLogger Building Plugin[name=SizeBasedTriggeringPolicy, class=org.apache.logging.log4j.core.appender.rolling.SizeBasedTriggeringPolicy].
DEBUG StatusLogger createPolicy(size=&quot;10KB&quot;)
DEBUG StatusLogger Building Plugin[name=TimeBasedTriggeringPolicy, class=org.apache.logging.log4j.core.appender.rolling.TimeBasedTriggeringPolicy].
DEBUG StatusLogger TimeBasedTriggeringPolicy$Builder(interval=&quot;null&quot;, modulate=&quot;null&quot;, maxRandomDelay=&quot;null&quot;)
DEBUG StatusLogger Building Plugin[name=Policies, class=org.apache.logging.log4j.core.appender.rolling.CompositeTriggeringPolicy].
DEBUG StatusLogger createPolicy(={SizeBasedTriggeringPolicy(size=10240), TimeBasedTriggeringPolicy(nextRolloverMillis=0, interval=1, modulate=false)})
DEBUG StatusLogger Building Plugin[name=appender, class=org.apache.logging.log4j.core.appender.RollingFileAppender].
DEBUG StatusLogger RollingFileAppender$Builder(fileName=&quot;null&quot;, filePattern=&quot;C:\Users\BENJAM~1.ASB\AppData\Local\Temp\log4j24342776539466181785/%d{yyyy_MM_dd_mm}/messages-${date:yyyy_MM_dd_HH_mm_ss_S}.log&quot;, append=&quot;null&quot;, locking=&quot;null&quot;, Policies(CompositeTriggeringPolicy(policies=[SizeBasedTriggeringPolicy(size=10240), TimeBasedTriggeringPolicy(nextRolloverMillis=0, interval=1, modulate=false)])), Strategy=null, advertise=&quot;null&quot;, advertiseUri=&quot;null&quot;, createOnDemand=&quot;null&quot;, filePermissions=&quot;null&quot;, fileOwner=&quot;null&quot;, fileGroup=&quot;null&quot;, bufferedIo=&quot;null&quot;, bufferSize=&quot;null&quot;, immediateFlush=&quot;null&quot;, ignoreExceptions=&quot;null&quot;, Layout=null, name=&quot;localmsglog&quot;, Configuration, Filter=null, ={})
DEBUG StatusLogger Not in a ServletContext environment, thus not loading WebLookup plugin.
DEBUG StatusLogger PluginManager &apos;Converter&apos; found 46 plugins
DEBUG StatusLogger Starting OutputStreamManager SYSTEM_OUT.false.false-2
DEBUG StatusLogger Starting RollingFileManager C:\Users\BENJAM~1.ASB\AppData\Local\Temp\log4j24342776539466181785/%d{yyyy_MM_dd_mm}/messages-${date:yyyy_MM_dd_HH_mm_ss_S}.log
DEBUG StatusLogger PluginManager &apos;FileConverter&apos; found 2 plugins
DEBUG StatusLogger Setting prev file time to 1970-01-01T01:00:00.000+0100
DEBUG StatusLogger Initializing triggering policy CompositeTriggeringPolicy(policies=[SizeBasedTriggeringPolicy(size=10240), TimeBasedTriggeringPolicy(nextRolloverMillis=0, interval=1, modulate=false)])
DEBUG StatusLogger Initializing triggering policy SizeBasedTriggeringPolicy(size=10240)
DEBUG StatusLogger Initializing triggering policy TimeBasedTriggeringPolicy(nextRolloverMillis=0, interval=1, modulate=false)
TRACE StatusLogger PatternProcessor.getNextTime returning 2020/07/02-12:26:00.000, nextFileTime=2020/07/02-12:25:00.000, prevFileTime=1970/01/01-01:00:00.000, current=2020/07/02-12:25:52.614, freq=EVERY_MINUTE
TRACE StatusLogger PatternProcessor.getNextTime returning 2020/07/02-12:26:00.000, nextFileTime=2020/07/02-12:25:00.000, prevFileTime=2020/07/02-12:25:00.000, current=2020/07/02-12:25:52.615, freq=EVERY_MINUTE
DEBUG StatusLogger Formatting file name. useCurrentTime=true. currentFileTime=0, prevFileTime=1593685500000
DEBUG StatusLogger Formatting file name. useCurrentTime=true. currentFileTime=0, prevFileTime=1593685500000
DEBUG StatusLogger Building Plugin[name=appenders, class=org.apache.logging.log4j.core.config.AppendersPlugin].
DEBUG StatusLogger createAppenders(={localmsglog})
DEBUG StatusLogger Configuration org.apache.logging.log4j.core.config.properties.PropertiesConfiguration@79534c86 initialized
DEBUG StatusLogger Starting configuration org.apache.logging.log4j.core.config.properties.PropertiesConfiguration@79534c86
DEBUG StatusLogger Started configuration org.apache.logging.log4j.core.config.properties.PropertiesConfiguration@79534c86 OK.
TRACE StatusLogger Stopping org.apache.logging.log4j.core.config.properties.PropertiesConfiguration@81c96556...
TRACE StatusLogger PropertiesConfiguration notified 2 ReliabilityStrategies that config will be stopped.
TRACE StatusLogger PropertiesConfiguration stopping 1 LoggerConfigs.
TRACE StatusLogger PropertiesConfiguration stopping root LoggerConfig.
TRACE StatusLogger PropertiesConfiguration notifying ReliabilityStrategies that appenders will be stopped.
TRACE StatusLogger PropertiesConfiguration stopping remaining Appenders.
DEBUG StatusLogger Shutting down OutputStreamManager SYSTEM_OUT.false.false
DEBUG StatusLogger OutputStream closed
DEBUG StatusLogger Shut down OutputStreamManager SYSTEM_OUT.false.false, all resources released: true
DEBUG StatusLogger Appender consoleAppender stopped with status true
TRACE StatusLogger PropertiesConfiguration stopped 2 remaining Appenders.
TRACE StatusLogger PropertiesConfiguration cleaning Appenders from 2 LoggerConfigs.
DEBUG StatusLogger Stopped org.apache.logging.log4j.core.config.properties.PropertiesConfiguration@81c96556 OK
TRACE StatusLogger Reregistering MBeans after reconfigure. Selector=org.apache.logging.log4j.core.selector.ClassLoaderContextSelector@bafbb692
TRACE StatusLogger Reregistering context (1/1): &apos;57ccce09&apos; org.apache.logging.log4j.core.LoggerContext@f72a1a9
TRACE StatusLogger Unregistering 1 MBeans: [org.apache.logging.log4j2:type=57ccce09]
TRACE StatusLogger Unregistering 1 MBeans: [org.apache.logging.log4j2:type=57ccce09,component=StatusLogger]
TRACE StatusLogger Unregistering 1 MBeans: [org.apache.logging.log4j2:type=57ccce09,component=ContextSelector]
TRACE StatusLogger Unregistering 1 MBeans: [org.apache.logging.log4j2:type=57ccce09,component=Loggers,name=]
TRACE StatusLogger Unregistering 2 MBeans: [org.apache.logging.log4j2:type=57ccce09,component=Appenders,name=consoleAppender, org.apache.logging.log4j2:type=57ccce09,component=Appenders,name=listAppender]
TRACE StatusLogger Unregistering but no MBeans found matching &apos;org.apache.logging.log4j2:type=57ccce09,component=AsyncAppenders,name=*&apos;
TRACE StatusLogger Unregistering but no MBeans found matching &apos;org.apache.logging.log4j2:type=57ccce09,component=AsyncLoggerRingBuffer&apos;
TRACE StatusLogger Unregistering but no MBeans found matching &apos;org.apache.logging.log4j2:type=57ccce09,component=Loggers,name=*,subtype=RingBuffer&apos;
DEBUG StatusLogger Registering MBean org.apache.logging.log4j2:type=57ccce09
DEBUG StatusLogger Registering MBean org.apache.logging.log4j2:type=57ccce09,component=StatusLogger
DEBUG StatusLogger Registering MBean org.apache.logging.log4j2:type=57ccce09,component=ContextSelector
DEBUG StatusLogger Registering MBean org.apache.logging.log4j2:type=57ccce09,component=Loggers,name=
DEBUG StatusLogger Registering MBean org.apache.logging.log4j2:type=57ccce09,component=Appenders,name=localmsglog
TRACE StatusLogger Using DummyNanoClock for nanosecond timestamps.
DEBUG StatusLogger Formatting file name. useCurrentTime=true. currentFileTime=0, prevFileTime=1593685500000
DEBUG StatusLogger Formatting file name. useCurrentTime=true. currentFileTime=0, prevFileTime=1593685500000
DEBUG StatusLogger Now writing to C:\Users\BENJAM~1.ASB\AppData\Local\Temp\log4j24342776539466181785/2020_07_02_25/messages-2020_07_02_12_25_52_650.log at 2020-07-02T12:25:52.650+0200
DEBUG StatusLogger Rolling C:\Users\BENJAM~1.ASB\AppData\Local\Temp\log4j24342776539466181785/2020_07_02_25/messages-2020_07_02_12_25_52_650.log
DEBUG StatusLogger Formatting file name. useCurrentTime=true. currentFileTime=0, prevFileTime=1593685500000
DEBUG StatusLogger Found 0 eligible files, max is  2147483647
TRACE StatusLogger DirectWriteRolloverStrategy.purge() took 1.0 milliseconds
DEBUG StatusLogger OutputStream closed
DEBUG StatusLogger Formatting file name. useCurrentTime=true. currentFileTime=0, prevFileTime=1593685500000
DEBUG StatusLogger Formatting file name. useCurrentTime=true. currentFileTime=0, prevFileTime=1593685500000
DEBUG StatusLogger Now writing to C:\Users\BENJAM~1.ASB\AppData\Local\Temp\log4j24342776539466181785/2020_07_02_25/messages-2020_07_02_12_25_52_686.log at 2020-07-02T12:25:52.686+0200
DEBUG StatusLogger Rolling C:\Users\BENJAM~1.ASB\AppData\Local\Temp\log4j24342776539466181785/2020_07_02_25/messages-2020_07_02_12_25_52_686.log
DEBUG StatusLogger Formatting file name. useCurrentTime=true. currentFileTime=0, prevFileTime=1593685500000
DEBUG StatusLogger Found 0 eligible files, max is  2147483647
TRACE StatusLogger DirectWriteRolloverStrategy.purge() took 1.0 milliseconds
DEBUG StatusLogger OutputStream closed
DEBUG StatusLogger Formatting file name. useCurrentTime=true. currentFileTime=0, prevFileTime=1593685500000
DEBUG StatusLogger Formatting file name. useCurrentTime=true. currentFileTime=0, prevFileTime=1593685500000
DEBUG StatusLogger Now writing to C:\Users\BENJAM~1.ASB\AppData\Local\Temp\log4j24342776539466181785/2020_07_02_25/messages-2020_07_02_12_25_52_710.log at 2020-07-02T12:25:52.710+0200
TRACE StatusLogger PatternProcessor.getNextTime returning 2020/07/02-12:27:00.000, nextFileTime=2020/07/02-12:26:00.000, prevFileTime=2020/07/02-12:25:00.000, current=2020/07/02-12:26:52.715, freq=EVERY_MINUTE
DEBUG StatusLogger Rolling C:\Users\BENJAM~1.ASB\AppData\Local\Temp\log4j24342776539466181785/2020_07_02_25/messages-2020_07_02_12_25_52_710.log
DEBUG StatusLogger Formatting file name. useCurrentTime=true. currentFileTime=1593685612716, prevFileTime=1593685500000
DEBUG StatusLogger Found 0 eligible files, max is  2147483647
TRACE StatusLogger DirectWriteRolloverStrategy.purge() took 2.0 milliseconds
DEBUG StatusLogger OutputStream closed
DEBUG StatusLogger Formatting file name. useCurrentTime=true. currentFileTime=1593685612716, prevFileTime=1593685500000
DEBUG StatusLogger Formatting file name. useCurrentTime=true. currentFileTime=1593685612716, prevFileTime=1593685500000
DEBUG StatusLogger Now writing to C:\Users\BENJAM~1.ASB\AppData\Local\Temp\log4j24342776539466181785/2020_07_02_26/messages-2020_07_02_12_26_52_716.log at 2020-07-02T12:26:52.722+0200
DEBUG StatusLogger Rolling C:\Users\BENJAM~1.ASB\AppData\Local\Temp\log4j24342776539466181785/2020_07_02_26/messages-2020_07_02_12_26_52_716.log
DEBUG StatusLogger Formatting file name. useCurrentTime=true. currentFileTime=1593685612716, prevFileTime=1593685560000
DEBUG StatusLogger Found 0 eligible files, max is  2147483647
TRACE StatusLogger DirectWriteRolloverStrategy.purge() took 2.0 milliseconds
DEBUG StatusLogger OutputStream closed
DEBUG StatusLogger Formatting file name. useCurrentTime=true. currentFileTime=1593685612716, prevFileTime=1593685560000
DEBUG StatusLogger Formatting file name. useCurrentTime=true. currentFileTime=1593685612716, prevFileTime=1593685560000
DEBUG StatusLogger Now writing to C:\Users\BENJAM~1.ASB\AppData\Local\Temp\log4j24342776539466181785/2020_07_02_26/messages-2020_07_02_12_26_52_716.log at 2020-07-02T12:26:52.761+0200
DEBUG StatusLogger Rolling C:\Users\BENJAM~1.ASB\AppData\Local\Temp\log4j24342776539466181785/2020_07_02_26/messages-2020_07_02_12_26_52_716.log
DEBUG StatusLogger Formatting file name. useCurrentTime=true. currentFileTime=1593685612716, prevFileTime=1593685560000
DEBUG StatusLogger Found 0 eligible files, max is  2147483647
TRACE StatusLogger DirectWriteRolloverStrategy.purge() took 2.0 milliseconds
DEBUG StatusLogger OutputStream closed
DEBUG StatusLogger Formatting file name. useCurrentTime=true. currentFileTime=1593685612716, prevFileTime=1593685560000
DEBUG StatusLogger Formatting file name. useCurrentTime=true. currentFileTime=1593685612716, prevFileTime=1593685560000
DEBUG StatusLogger Now writing to C:\Users\BENJAM~1.ASB\AppData\Local\Temp\log4j24342776539466181785/2020_07_02_26/messages-2020_07_02_12_26_52_716.log at 2020-07-02T12:26:52.800+0200
Tests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 61.866 s &amp;lt;&amp;lt;&amp;lt; FAILURE! - in com.amadeus.rail.utils.log4j.RollingTest
sizeBasedRollingBrokenAfterTimeBasedRolling  Time elapsed: 61.862 s  &amp;lt;&amp;lt;&amp;lt; FAILURE!
org.opentest4j.AssertionFailedError: expected: &amp;lt;3&amp;gt; but was: &amp;lt;1&amp;gt;
	at com.amadeus.rail.utils.log4j.RollingTest.sizeBasedRollingBrokenAfterTimeBasedRolling(RollingTest.java:68)

DEBUG StatusLogger Stopping LoggerContext[name=57ccce09, org.apache.logging.log4j.core.LoggerContext@f72a1a9]
DEBUG StatusLogger Stopping LoggerContext[name=57ccce09, org.apache.logging.log4j.core.LoggerContext@f72a1a9]...
TRACE StatusLogger Unregistering 1 MBeans: [org.apache.logging.log4j2:type=57ccce09]
TRACE StatusLogger Unregistering 1 MBeans: [org.apache.logging.log4j2:type=57ccce09,component=StatusLogger]
TRACE StatusLogger Unregistering 1 MBeans: [org.apache.logging.log4j2:type=57ccce09,component=ContextSelector]
TRACE StatusLogger Unregistering 1 MBeans: [org.apache.logging.log4j2:type=57ccce09,component=Loggers,name=]
TRACE StatusLogger Unregistering 1 MBeans: [org.apache.logging.log4j2:type=57ccce09,component=Appenders,name=localmsglog]
TRACE StatusLogger Unregistering but no MBeans found matching &apos;org.apache.logging.log4j2:type=57ccce09,component=AsyncAppenders,name=*&apos;
TRACE StatusLogger Unregistering but no MBeans found matching &apos;org.apache.logging.log4j2:type=57ccce09,component=AsyncLoggerRingBuffer&apos;
TRACE StatusLogger Unregistering but no MBeans found matching &apos;org.apache.logging.log4j2:typ[e=57ccce09,coImNpFoOne]n t=
L
oggers,name=*,subtype=R[ingBIuNfFfOe] rR&apos;
es
ults:

Failures: 
  RollingTest.sizeBasedRollingBrokenAfterTimeBasedRolling:68 expected: &amp;lt;3&amp;gt; but was: &amp;lt;1&amp;gt;

Tests run: 1, Failures: 1, Errors: 0, Skipped: 0

------------------------------------------------------------------------
BUILD FAILURE
------------------------------------------------------------------------
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13314640">LOG4J2-2883</key>
            <summary>Size based rolling stops working after first time base rolling</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="asbachb">Benjamin Asbach</reporter>
                        <labels>
                    </labels>
                <created>Thu, 2 Jul 2020 09:55:42 +0000</created>
                <updated>Sun, 2 Aug 2020 20:05:03 +0000</updated>
                            <resolved>Fri, 31 Jul 2020 04:21:32 +0000</resolved>
                                    <version>2.13.3</version>
                                    <fixVersion>2.14.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17150209" author="asbachb" created="Thu, 2 Jul 2020 11:46:00 +0000"  >&lt;p&gt;I did some monkey patching again which seem to work:&lt;/p&gt;

&lt;p&gt;org.apache.logging.log4j.core.appender.rolling.SizeBasedTriggeringPolicy&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    /**
     * Returns &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; a rollover should occur.
     * @param event   A reference to the currently event.
     * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; a rollover should take place, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; otherwise.
     */
    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isTriggeringEvent(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; LogEvent event) {
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; triggered = manager.getFileSize() &amp;gt; maxFileSize;
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (triggered) {
            manager.getPatternProcessor().setCurrentFileTime(&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis()); &lt;span class=&quot;code-comment&quot;&gt;//&amp;lt;= Added
&lt;/span&gt;            manager.getPatternProcessor().updateTime();
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; triggered;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17150211" author="asbachb" created="Thu, 2 Jul 2020 11:51:28 +0000"  >&lt;p&gt;If I understand the code correctly the PatternProcessor is responsible for generating filenames. The problem is guess it that it has a state which needs to be updated by the policies in order to create a correct filename. Perhaps this coupling could be worked on.&lt;/p&gt;</comment>
                            <comment id="17150263" author="asbachb" created="Thu, 2 Jul 2020 13:08:46 +0000"  >&lt;p&gt;I adjusted the timing of the test. It&apos;s not 100% reliable but much faster.&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.awt.Desktop;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io.File;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.nio.file.Files;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.nio.file.Path;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; java.util.Arrays.asList;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; java.util.Collections.sort;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.List;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.Properties;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.logging.log4j.core.Logger;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.logging.log4j.core.LoggerContext;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.logging.log4j.core.config.properties.PropertiesConfiguration;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.logging.log4j.core.config.properties.PropertiesConfigurationBuilder;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; org.junit.jupiter.api.Assertions.assertEquals;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.junit.jupiter.api.Test;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;RollingTest {

  @Test
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void sizeBasedRollingBrokenAfterTimeBasedRolling() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.setProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;log4j2.debug&quot;&lt;/span&gt;, &quot;&quot;);

    Path tempDirectory = Files.createTempDirectory(&lt;span class=&quot;code-quote&quot;&gt;&quot;log4j2&quot;&lt;/span&gt;);
    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(tempDirectory);

    Properties log4j2Properties = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Properties();
    log4j2Properties.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;appender.localmsglog.type&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;RollingFile&quot;&lt;/span&gt;);
    log4j2Properties.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;appender.localmsglog.name&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;localmsglog&quot;&lt;/span&gt;);
    log4j2Properties.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;appender.localmsglog.filePattern&quot;&lt;/span&gt;, tempDirectory.toFile().getAbsolutePath() + &lt;span class=&quot;code-quote&quot;&gt;&quot;/%d{yyyy_MM_dd_ss}/messages-$${date:yyyy_MM_dd_HH_mm_ss_S}.log&quot;&lt;/span&gt;);
    log4j2Properties.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;appender.localmsglog.strategy.type&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;TimeBasedSizeBasedCompatibleDirectWriteRolloverStrategy&quot;&lt;/span&gt;);
    log4j2Properties.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;appender.localmsglog.policies.type&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;Policies&quot;&lt;/span&gt;);
    log4j2Properties.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;appender.localmsglog.policies.1.type&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;UpdatingPatternProcessorTimestampSizeBasedTriggeringPolicy&quot;&lt;/span&gt;);
    log4j2Properties.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;appender.localmsglog.policies.1.size&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;1KB&quot;&lt;/span&gt;);
    log4j2Properties.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;appender.localmsglog.policies.2.type&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;TimeBasedTriggeringPolicy&quot;&lt;/span&gt;);

    log4j2Properties.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;rootLogger.level&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;info&quot;&lt;/span&gt;);
    log4j2Properties.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;rootLogger.appenderRef.1.ref&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;localmsglog&quot;&lt;/span&gt;);

    PropertiesConfiguration config = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PropertiesConfigurationBuilder()
            .setRootProperties(log4j2Properties)
            .build();

    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Test directory: &quot;&lt;/span&gt; + tempDirectory.toString());
    Desktop.getDesktop().open(tempDirectory.toFile());
    org.apache.logging.log4j.core.config.Configurator.reconfigure(config);

    LoggerContext context = LoggerContext.getContext(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
    Logger log = context.getRootLogger();

    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; 200; i++) {
      log.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;nHq6p9kgfvWfjzDRYbZp&quot;&lt;/span&gt;);
    }
    &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(2000);
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; 200; i++) {
      log.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;nHq6p9kgfvWfjzDRYbZp&quot;&lt;/span&gt;);
    }

    File tempDirectoryAsFile = tempDirectory.toFile();
    List&amp;lt;File&amp;gt; loggingFolders = asList(tempDirectoryAsFile.listFiles());
    sort(loggingFolders);
    &lt;span class=&quot;code-comment&quot;&gt;// Check &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; two folders were created
&lt;/span&gt;    assertEquals(2, loggingFolders.size());
    
    &lt;span class=&quot;code-comment&quot;&gt;// Check &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; first folder contains 3 log files
&lt;/span&gt;    assertEquals(5, loggingFolders.get(0).listFiles().length);

    &lt;span class=&quot;code-comment&quot;&gt;// Check &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; second folder contains 3 log files as well
&lt;/span&gt;    assertEquals(5, loggingFolders.get(1).listFiles().length);
  }
}

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17168379" author="jira-bot" created="Fri, 31 Jul 2020 04:20:08 +0000"  >&lt;p&gt;Commit 1a6f6b4a2c2bebb8a1ff32479d33ca8536a9c573 in logging-log4j2&apos;s branch refs/heads/release-2.x from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=1a6f6b4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=1a6f6b4&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2883&quot; title=&quot;Size based rolling stops working after first time base rolling&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2883&quot;&gt;&lt;del&gt;LOG4J2-2883&lt;/del&gt;&lt;/a&gt; - When When using DirectFileRolloverStrategy the file pattern was not being recalculated on size based rollover after a time based rollover had occurred.&lt;/p&gt;</comment>
                            <comment id="17168380" author="jira-bot" created="Fri, 31 Jul 2020 04:20:40 +0000"  >&lt;p&gt;Commit 3cdd1f312c997794fb6c741806ddd7f0024e0dcd in logging-log4j2&apos;s branch refs/heads/master from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=3cdd1f3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=3cdd1f3&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2883&quot; title=&quot;Size based rolling stops working after first time base rolling&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2883&quot;&gt;&lt;del&gt;LOG4J2-2883&lt;/del&gt;&lt;/a&gt; - When When using DirectFileRolloverStrategy the file pattern was not being recalculated on size based rollover after a time based rollover had occurred.&lt;/p&gt;</comment>
                            <comment id="17168381" author="ralph.goers@dslextreme.com" created="Fri, 31 Jul 2020 04:21:32 +0000"  >&lt;p&gt;Thanks for the good unit test. From that I was able to identify the problem and fix it. Please verify and close.&lt;/p&gt;</comment>
                            <comment id="17169424" author="jira-bot" created="Sat, 1 Aug 2020 22:38:41 +0000"  >&lt;p&gt;Commit 1252c531844e108c4c6316ecbcda9ae9f2d1aeb4 in logging-log4j2&apos;s branch refs/heads/release-2.x from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=1252c53&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=1252c53&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2883&quot; title=&quot;Size based rolling stops working after first time base rolling&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2883&quot;&gt;&lt;del&gt;LOG4J2-2883&lt;/del&gt;&lt;/a&gt; - Add unit test&lt;/p&gt;</comment>
                            <comment id="17169425" author="jira-bot" created="Sat, 1 Aug 2020 22:39:24 +0000"  >&lt;p&gt;Commit c0487ad694fd98f047b48fb7d43a74af99bbba28 in logging-log4j2&apos;s branch refs/heads/master from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=c0487ad&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=c0487ad&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2883&quot; title=&quot;Size based rolling stops working after first time base rolling&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2883&quot;&gt;&lt;del&gt;LOG4J2-2883&lt;/del&gt;&lt;/a&gt; - Add unit test&lt;/p&gt;</comment>
                            <comment id="17169623" author="jira-bot" created="Sun, 2 Aug 2020 20:05:00 +0000"  >&lt;p&gt;Commit 3cdd1f312c997794fb6c741806ddd7f0024e0dcd in logging-log4j2&apos;s branch refs/heads/dependabot/maven/org.apache.maven.plugins-maven-checkstyle-plugin-3.1.1 from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=3cdd1f3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=3cdd1f3&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2883&quot; title=&quot;Size based rolling stops working after first time base rolling&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2883&quot;&gt;&lt;del&gt;LOG4J2-2883&lt;/del&gt;&lt;/a&gt; - When When using DirectFileRolloverStrategy the file pattern was not being recalculated on size based rollover after a time based rollover had occurred.&lt;/p&gt;</comment>
                            <comment id="17169625" author="jira-bot" created="Sun, 2 Aug 2020 20:05:03 +0000"  >&lt;p&gt;Commit c0487ad694fd98f047b48fb7d43a74af99bbba28 in logging-log4j2&apos;s branch refs/heads/dependabot/maven/org.apache.maven.plugins-maven-checkstyle-plugin-3.1.1 from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=c0487ad&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=c0487ad&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2883&quot; title=&quot;Size based rolling stops working after first time base rolling&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2883&quot;&gt;&lt;del&gt;LOG4J2-2883&lt;/del&gt;&lt;/a&gt; - Add unit test&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13312263">LOG4J2-2875</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13317460">LOG4J2-2897</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 15 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0gebk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>