<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:42:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-3394] The &apos;rootLogger=${sys:root.logger:-INFO,console}&apos; does not work</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-3394</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;Tried the new feature introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3341&quot; title=&quot;Support passing something like &amp;#39;-Dlog4j.rootLogger=INFO,Console&amp;#39; from command line to set level and appenders at once&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3341&quot;&gt;&lt;del&gt;LOG4J2-3341&lt;/del&gt;&lt;/a&gt; in hbase.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/hbase/pull/4096&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hbase/pull/4096&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I built a tarball and try to start a standalone hbase instance locally, but log4j2 failed to load the system properties of rootLogger.&lt;/p&gt;

&lt;p&gt;Will upload the config and error output.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13426754">LOG4J2-3394</key>
            <summary>The &apos;rootLogger=${sys:root.logger:-INFO,console}&apos; does not work</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="zhangduo">Duo Zhang</reporter>
                        <labels>
                    </labels>
                <created>Sat, 5 Feb 2022 14:48:11 +0000</created>
                <updated>Fri, 11 Mar 2022 16:21:09 +0000</updated>
                            <resolved>Sun, 13 Feb 2022 05:35:14 +0000</resolved>
                                                                    <component>Configuration</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>12</watches>
                                                                                                                <comments>
                            <comment id="17487503" author="apache9" created="Sat, 5 Feb 2022 14:58:09 +0000"  >&lt;p&gt;The log4j2.properties is the configuration file I used, and log4j2.err is what I got on stderr.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2022-02-05 22:35:44,915 main WARN Error while converting string [${sys:hbase.root.logger:-INFO] to type [class org.apache.logging.log4j.Level]. Using default value [null]. java.lang.IllegalArgumentException: Unknown level constant [${SYS:HBASE.ROOT.LOGGER:-INFO].
	at org.apache.logging.log4j.Level.valueOf(Level.java:339)
	at org.apache.logging.log4j.core.config.plugins.convert.TypeConverters$LevelConverter.convert(TypeConverters.java:289)
	at org.apache.logging.log4j.core.config.plugins.convert.TypeConverters$LevelConverter.convert(TypeConverters.java:285)
	at org.apache.logging.log4j.core.config.plugins.convert.TypeConverters.convert(TypeConverters.java:420)
	at org.apache.logging.log4j.core.config.plugins.visitors.AbstractPluginVisitor.convert(AbstractPluginVisitor.java:149)
	at org.apache.logging.log4j.core.config.plugins.visitors.PluginAttributeVisitor.visit(PluginAttributeVisitor.java:44)
	at org.apache.logging.log4j.core.config.plugins.util.PluginBuilder.generateParameters(PluginBuilder.java:264)
	at org.apache.logging.log4j.core.config.plugins.util.PluginBuilder.build(PluginBuilder.java:137)
	at org.apache.logging.log4j.core.config.AbstractConfiguration.createPluginObject(AbstractConfiguration.java:1117)
	at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:1042)
	at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:1034)
	at org.apache.logging.log4j.core.config.AbstractConfiguration.doConfigure(AbstractConfiguration.java:648)
	at org.apache.logging.log4j.core.config.AbstractConfiguration.initialize(AbstractConfiguration.java:246)
	at org.apache.logging.log4j.core.config.AbstractConfiguration.start(AbstractConfiguration.java:292)
	at org.apache.logging.log4j.core.LoggerContext.setConfiguration(LoggerContext.java:621)
	at org.apache.logging.log4j.core.LoggerContext.reconfigure(LoggerContext.java:694)
	at org.apache.logging.log4j.core.LoggerContext.reconfigure(LoggerContext.java:711)
	at org.apache.logging.log4j.core.LoggerContext.start(LoggerContext.java:253)
	at org.apache.logging.log4j.core.impl.Log4jContextFactory.getContext(Log4jContextFactory.java:155)
	at org.apache.logging.log4j.core.impl.Log4jContextFactory.getContext(Log4jContextFactory.java:47)
	at org.apache.logging.log4j.LogManager.getContext(LogManager.java:196)
	at org.apache.logging.log4j.spi.AbstractLoggerAdapter.getContext(AbstractLoggerAdapter.java:137)
	at org.apache.logging.slf4j.Log4jLoggerFactory.getContext(Log4jLoggerFactory.java:55)
	at org.apache.logging.log4j.spi.AbstractLoggerAdapter.getLogger(AbstractLoggerAdapter.java:47)
	at org.apache.logging.slf4j.Log4jLoggerFactory.getLogger(Log4jLoggerFactory.java:33)
	at org.slf4j.LoggerFactory.getLogger(LoggerFactory.java:363)
	at org.slf4j.LoggerFactory.getLogger(LoggerFactory.java:388)
	at org.apache.hadoop.conf.Configuration.&amp;lt;clinit&amp;gt;(Configuration.java:227)
	at org.apache.hadoop.hbase.util.HBaseConfTool.main(HBaseConfTool.java:39)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is the error, it seems that in log4j2 we do not support variable lookup when configuring rootLogger directly in properties file? What I used to configure rootLogger is&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;rootLogger = ${sys:hbase.root.logger:-INFO,console}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For security logger, it is fine, as I just put the level and appender directly.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;logger.SecurityLogger.name = SecurityLogger
logger.SecurityLogger = INFO,RFAS
logger.SecurityLogger.additivity = false
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Checked classpath, I have the newest snapshot log4j2 jars.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;zhangduo@zhangduo-ubuntu:~/hbase/hbase-3.0.0-alpha-3-SNAPSHOT/lib/client-facing-thirdparty$ ls log4j*
log4j-1.2-api-2.17.2-20220205.141839-109.jar  log4j-api-2.17.2-20220205.141839-107.jar  log4j-core-2.17.2-20220205.141839-103.jar  log4j-slf4j-impl-2.17.2-20220131.204023-97.jar
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mattsicker&quot; class=&quot;user-hover&quot; rel=&quot;mattsicker&quot;&gt;mattsicker&lt;/a&gt; FYI.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="17487505" author="ckozak" created="Sat, 5 Feb 2022 15:07:37 +0000"  >&lt;p&gt;I see, the properties-specific configuration handling is evaluated prior to lookups, which means the raw value including the raw lookup is interpreted as a level. I think this is a strong counterexample against format-specific configuration handling, as it can conflict with assumptions we make elsewhere. I wonder if there&#8217;s a more general solution we can use to implement this feature?&lt;/p&gt;</comment>
                            <comment id="17487508" author="apache9" created="Sat, 5 Feb 2022 15:18:01 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ckozak&quot; class=&quot;user-hover&quot; rel=&quot;ckozak&quot;&gt;ckozak&lt;/a&gt; for the quick reply.&lt;/p&gt;

&lt;p&gt;I got your point. So maybe we could come back to the solutions discussed on the mailing list? To introduce a new CompoundProperty plugin which supports splitting one property to several properties, and then we could use these properties to config level and appenders separately.&lt;/p&gt;

&lt;p&gt;But there is still a problem that, how to configure multiple appenders in this case? As we could write something like &apos;rootLogger=INFO,Console,RFA&apos; in the current hadoop and hbase configuration files.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="17487514" author="garydgregory" created="Sat, 5 Feb 2022 15:42:57 +0000"  >&lt;p&gt;This looks wrong&lt;/p&gt;

&lt;p&gt;rootLogger = ${sys:hbase.root.logger:-INFO,console}&lt;/p&gt;

&lt;p&gt;It should be:&lt;/p&gt;

&lt;p&gt;rootLogger = ${sys:hbase.root.logger:-INFO},console&lt;/p&gt;</comment>
                            <comment id="17487531" author="ralph.goers@dslextreme.com" created="Sat, 5 Feb 2022 17:47:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggregory&quot; class=&quot;user-hover&quot; rel=&quot;ggregory&quot;&gt;ggregory&lt;/a&gt; No, the syntax is correct for what he is trying to do.&#160;&lt;/p&gt;

&lt;p&gt;The code Matt added simply takes the values it finds and replaces the specified property with the two &quot;normal&quot; properties that PropertiesConfiguration expects. It simply isn&apos;t interpolating the value before processing it. It should be relatively simple to do that. At this point it would be using the default Interpolator.&lt;/p&gt;

&lt;p&gt;If &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mattsicker&quot; class=&quot;user-hover&quot; rel=&quot;mattsicker&quot;&gt;mattsicker&lt;/a&gt; can&apos;t get to this I can do it right after I finish the task I am currently working on.&lt;/p&gt;</comment>
                            <comment id="17487650" author="apache9" created="Sun, 6 Feb 2022 09:11:51 +0000"  >&lt;blockquote&gt;
&lt;p&gt;This looks wrong&lt;/p&gt;

&lt;p&gt;rootLogger = ${sys:hbase.root.logger:-INFO,console}&lt;/p&gt;

&lt;p&gt;It should be:&lt;/p&gt;

&lt;p&gt;rootLogger = ${sys:hbase.root.logger:-INFO},console&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggregory&quot; class=&quot;user-hover&quot; rel=&quot;ggregory&quot;&gt;ggregory&lt;/a&gt; for chimming in. As &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rgoers&quot; class=&quot;user-hover&quot; rel=&quot;rgoers&quot;&gt;rgoers&lt;/a&gt; said above, the syntax is correct. Why I started the discussion thread on the dev list is because in hadoop and hbase we will use HADOOP_ROOT_LOGGER and HBASE_ROOT_LOGGER to config level and appenders at once, so the default value should be &apos;INFO,console&apos;.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;The code Matt added simply takes the values it finds and replaces the specified property with the two &quot;normal&quot; properties that PropertiesConfiguration expects. It simply isn&apos;t interpolating the value before processing it. It should be relatively simple to do that. At this point it would be using the default Interpolator.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The above comment from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ckozak&quot; class=&quot;user-hover&quot; rel=&quot;ckozak&quot;&gt;ckozak&lt;/a&gt; said this is an anti pattern in log4j, maybe the problem here is that, it is easy to add the interpolating but maybe the properties have not been fully initialized yet? I&apos;m not very familiar with the architecture, if simply adding interpolating can work then this is the easiest way to solve the problem.&lt;/p&gt;

&lt;p&gt;If not, maybe we could go back to the CompoundProperty solution. The CompoundProperty could use regex and each property under it can be a group of the regex matching result.&lt;/p&gt;

&lt;p&gt;And on configuration appenders, maybe we need to add appenderRefs which accept multiple appenders with a comma separated list. Although this is not a good practise for xml and yaml, but if we can only lookup variables when entering the format free configuration handling, this is the only possible solution to support adding multiple appenders at once?&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="17487727" author="jira-bot" created="Sun, 6 Feb 2022 17:38:59 +0000"  >&lt;p&gt;Commit 6d6ff5b85bbdba8895c41de5c5b6049e07635395 in logging-log4j2&apos;s branch refs/heads/release-2.x from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=6d6ff5b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=6d6ff5b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3394&quot; title=&quot;The &amp;#39;rootLogger=${sys:root.logger:-INFO,console}&amp;#39; does not work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3394&quot;&gt;&lt;del&gt;LOG4J2-3394&lt;/del&gt;&lt;/a&gt; - Allow substitution of system properties and environment variables in shorthand variables introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3341&quot; title=&quot;Support passing something like &amp;#39;-Dlog4j.rootLogger=INFO,Console&amp;#39; from command line to set level and appenders at once&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3341&quot;&gt;&lt;del&gt;LOG4J2-3341&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17488179" author="ralph.goers@dslextreme.com" created="Mon, 7 Feb 2022 15:37:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ckozak&quot; class=&quot;user-hover&quot; rel=&quot;ckozak&quot;&gt;ckozak&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vy&quot; class=&quot;user-hover&quot; rel=&quot;vy&quot;&gt;vy&lt;/a&gt; have vetoed the fix above. I am afraid we will be unable to implement this feature.&lt;/p&gt;</comment>
                            <comment id="17488180" author="jira-bot" created="Mon, 7 Feb 2022 15:39:13 +0000"  >&lt;p&gt;Commit ca161e7e86df696629d5a9404b342ef80a0fcf94 in logging-log4j2&apos;s branch refs/heads/release-2.x from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=ca161e7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=ca161e7&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Revert &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3394&quot; title=&quot;The &amp;#39;rootLogger=${sys:root.logger:-INFO,console}&amp;#39; does not work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3394&quot;&gt;&lt;del&gt;LOG4J2-3394&lt;/del&gt;&lt;/a&gt; - Allow substitution of system properties and environment variables in shorthand variables introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3341&quot; title=&quot;Support passing something like &amp;#39;-Dlog4j.rootLogger=INFO,Console&amp;#39; from command line to set level and appenders at once&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3341&quot;&gt;&lt;del&gt;LOG4J2-3341&lt;/del&gt;&lt;/a&gt;&quot;&lt;/p&gt;

&lt;p&gt;This reverts commit 6d6ff5b85bbdba8895c41de5c5b6049e07635395.&lt;/p&gt;</comment>
                            <comment id="17488186" author="ralph.goers@dslextreme.com" created="Mon, 7 Feb 2022 15:41:44 +0000"  >&lt;p&gt;Marking as won&apos;t fix due to vetoes. Without this I suspect the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3341&quot; title=&quot;Support passing something like &amp;#39;-Dlog4j.rootLogger=INFO,Console&amp;#39; from command line to set level and appenders at once&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3341&quot;&gt;&lt;del&gt;LOG4J2-3341&lt;/del&gt;&lt;/a&gt; should be reverted as well.&lt;/p&gt;</comment>
                            <comment id="17488190" author="apache9" created="Mon, 7 Feb 2022 15:43:37 +0000"  >&lt;p&gt;So let&apos;s go back to the CompoundProperty solution? I think in this way we will not break the architrcture of log4j2 too much, the most work will be done in hadoop and hbase, where we need to split the HADOOP_ROOT_LOGGER and HBASE_ROOT_LOGGER system property in log4j2 config file.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="17488196" author="apache9" created="Mon, 7 Feb 2022 15:49:19 +0000"  >&lt;p&gt;Please do not resolve issues so quickly as there are still other possible solutions.&lt;/p&gt;

&lt;p&gt;Or if you think we should open new issues to address the problem then please file the new issue before resolving this one. The problem has not been resolved yet.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="17488202" author="ckozak" created="Mon, 7 Feb 2022 15:53:21 +0000"  >&lt;p&gt;I&apos;m sure we can come up with a reasonable path forward for this!&lt;/p&gt;</comment>
                            <comment id="17488286" author="jvz" created="Mon, 7 Feb 2022 17:48:40 +0000"  >&lt;p&gt;So one of the hard parts to solve here is a combination of two factors:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Supporting a sort of compound value here with string substitution is difficult as string substitution applies to plugin attributes and values down the tree, but if we apply string substitution while pre-processing the properties, then substitution would be applied twice.&lt;/li&gt;
	&lt;li&gt;Introducing a new plugin or syntax for setting multiple values in a single attribute is a bit of a hack if it&apos;s only important for properties files.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Now this idea isn&apos;t the cleanest, either, but what if we had a separate properties substitution syntax here? Like #{property} or something like that. We could adapt some ideas on lazy-vs-eager variable substitution from Spring&apos;s expression language where $ and # mean different things.&lt;/p&gt;</comment>
                            <comment id="17488342" author="ralph.goers@dslextreme.com" created="Mon, 7 Feb 2022 18:40:16 +0000"  >&lt;p&gt;This issue is marked resolved as it relates to the bug in what Matt implemented. Matt&apos;s code is going to be removed and replaced with something else. So &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3341&quot; title=&quot;Support passing something like &amp;#39;-Dlog4j.rootLogger=INFO,Console&amp;#39; from command line to set level and appenders at once&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3341&quot;&gt;&lt;del&gt;LOG4J2-3341&lt;/del&gt;&lt;/a&gt; really needs to be reopened.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mattsicker&quot; class=&quot;user-hover&quot; rel=&quot;mattsicker&quot;&gt;mattsicker&lt;/a&gt; After you revert the change for &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3341&quot; title=&quot;Support passing something like &amp;#39;-Dlog4j.rootLogger=INFO,Console&amp;#39; from command line to set level and appenders at once&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3341&quot;&gt;&lt;del&gt;LOG4J2-3341&lt;/del&gt;&lt;/a&gt; I will look into adding the support as a &quot;normal&quot; property that simply performs two different actions. it does mean that if you do&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
rootLogger=${sys:root.logger:-INFO,console} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and then define the root.logger system property as something like:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
${sys:log.level:-INFO}, console
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The log level info replacement will not occur. Instead, it will get an error when it tries to set the level to &quot;${sys:log.level:-INFO}&quot;.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17488416" author="vy" created="Mon, 7 Feb 2022 20:27:12 +0000"  >&lt;p&gt;I think&#160;&lt;em&gt;&quot;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ckozak&quot; class=&quot;user-hover&quot; rel=&quot;ckozak&quot;&gt;ckozak&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vy&quot; class=&quot;user-hover&quot; rel=&quot;vy&quot;&gt;vy&lt;/a&gt; have vetoed the fix above&quot;&lt;/em&gt; needs some explanation. We simply didn&apos;t approve the way interpolation was implemented in the fix and that rendered the fix unusable. I see the point of the use case and want to make it work using Log4j. Though rather than implementing this as a Log4j feature, I am in favor of, if necessary, making Log4j extensible enough such that this feature could simply be implemented using plugins by the user. For instance, can we simply support the requested feature via a custom &lt;tt&gt;HadoopPropertiesConfigurationFactory&lt;/tt&gt; which is a slight derivation of our stock &lt;tt&gt;PropertiesConfigurationFactory&lt;/tt&gt;? Or the aforementioned &lt;tt&gt;CompoundProperty&lt;/tt&gt;?&lt;/p&gt;</comment>
                            <comment id="17488438" author="jvz" created="Mon, 7 Feb 2022 21:56:25 +0000"  >&lt;p&gt;Based on existing extension points, a custom ConfigurationFactory could theoretically be introduced at any time since 2.0. That&apos;s how programmatic configuration typically works, too (setting a custom factory with your configuration builder class).&lt;/p&gt;

&lt;p&gt;The CompoundProperty concept might work, though it smells like slowly introducing another type of expression language in the config file format.&lt;/p&gt;</comment>
                            <comment id="17488541" author="apache9" created="Tue, 8 Feb 2022 01:53:31 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Introducing a new plugin or syntax for setting multiple values in a single attribute is a bit of a hack if it&apos;s only important for properties files.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I would argue that this should not be limited only to properties files. We should have the same ability for all configuration formats.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;The CompoundProperty concept might work, though it smells like slowly introducing another type of expression language in the config file format.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Well, I think this is because we have dropped the support of log4j.rootLogger support, which is commonly used in log4j1, so we have to find other ways to support it. And if we want to make it generic enough, we have to introduce something like a DSL&#8230;&lt;/p&gt;

&lt;p&gt;For me, ConfigurationFactory is also fine. Is this already present in the log4j code base or it is still just an idea in mind?&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="17488563" author="jvz" created="Tue, 8 Feb 2022 02:37:08 +0000"  >&lt;p&gt;Yes, ConfigurationFactory is available in all Log4j2 releases. Some basic info in &lt;a href=&quot;https://logging.apache.org/log4j/2.x/manual/extending.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://logging.apache.org/log4j/2.x/manual/extending.html&lt;/a&gt;&#160;and further documented in &lt;a href=&quot;https://logging.apache.org/log4j/2.x/manual/customconfig.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://logging.apache.org/log4j/2.x/manual/customconfig.html&lt;/a&gt;&#160;(the latter uses the same API that we use in the properties file format implementation which has API docs here: &lt;a href=&quot;https://logging.apache.org/log4j/2.x/log4j-core/apidocs/org/apache/logging/log4j/core/config/builder/api/package-summary.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://logging.apache.org/log4j/2.x/log4j-core/apidocs/org/apache/logging/log4j/core/config/builder/api/package-summary.html&lt;/a&gt;&#160;)&lt;/p&gt;

&lt;p&gt;And what do you mean by root logger support? We do support that I thought?&lt;/p&gt;</comment>
                            <comment id="17488568" author="apache9" created="Tue, 8 Feb 2022 03:07:44 +0000"  >&lt;blockquote&gt;
&lt;p&gt;And what do you mean by root logger support? We do support that I thought?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I mean the log4j.rootLogger=level, appender1, appender2 syntax. Before &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3341&quot; title=&quot;Support passing something like &amp;#39;-Dlog4j.rootLogger=INFO,Console&amp;#39; from command line to set level and appenders at once&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3341&quot;&gt;&lt;del&gt;LOG4J2-3341&lt;/del&gt;&lt;/a&gt; it is not supported yet, but even after &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3341&quot; title=&quot;Support passing something like &amp;#39;-Dlog4j.rootLogger=INFO,Console&amp;#39; from command line to set level and appenders at once&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3341&quot;&gt;&lt;del&gt;LOG4J2-3341&lt;/del&gt;&lt;/a&gt;, it still does not support variable lookup, and now we also plan to revert it as the feature is just half done...&lt;/p&gt;

&lt;p&gt;Let me take a look at the ConfigurationFactory documentations.&lt;/p&gt;
</comment>
                            <comment id="17488581" author="apache9" created="Tue, 8 Feb 2022 04:23:16 +0000"  >&lt;p&gt;Oh, wait a minute, if this feature could be done via customized configuration factory, then why not just modify the PropertiesConfigurationFactory to support it? It is a common usage, not only for hadoop.&lt;/p&gt;

&lt;p&gt;You can search &apos;log4j configuration&apos; on google, at least for me, the first serveral results all tell you to use properties file and use &apos;log4j.rootLogger=level&lt;span class=&quot;error&quot;&gt;&amp;#91;, appender1, appender2&#8230;&amp;#93;&lt;/span&gt;&apos; syntax, so I prefer we still try to support this usage in log4j2...&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="17488583" author="jvz" created="Tue, 8 Feb 2022 04:25:51 +0000"  >&lt;p&gt;That&apos;s what I did, but there&apos;s a problem with double-evaluation of variables in properties when we do that. You can take a look at how Ralph tried to do here.&lt;/p&gt;</comment>
                            <comment id="17488587" author="apache9" created="Tue, 8 Feb 2022 04:36:16 +0000"  >&lt;p&gt;Yes, for this we are on the same page. I agree that we should not do this if it breaks some assumptions in log4j, please see my comment above.&lt;/p&gt;

&lt;p&gt;So now the problem is how to implement with other ways. Inside log4j, using CompoundProperty and appenderRefs is a possible way, and another proposed approach is to use a customized configuration factory. I&apos;m still learning from the code and documentation, and one querstion is as I said above, if it could be done via customized configuration factory, then why we can not support it by modifying the PropertiesConfigurationFactory?&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="17488588" author="ralph.goers@dslextreme.com" created="Tue, 8 Feb 2022 04:48:46 +0000"  >&lt;p&gt;The fix Matt did was to process the configuration before any other processing was done and to replace the single property with the properties the PropertiesConfiguration already supports. Unfortunately, that requires resolving any variables specified in the value since the syntax of the value covers multiple property values so you can&apos;t really know what the resolution will be. For example&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
log4j.rootLogger=${sys:root.log.level:-INFO}, console
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;could be specified and then you could do -Droot.log.level=&quot;INFO, file&quot; which, of course, would result in&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
log4j.rootLogger=INFO, file, console
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;which may, or may not, have been intended. But that is the mess combining properties this way causes, and which is why I am against using it in any other syntax. Worse, the fix I added resolved the properties during the preprocessing but then normal processing would have allowed a second pass at variable resolution. So if your -D contained another ${sys:...} string it would have been resolved, which is something we would rather avoid.&lt;/p&gt;

&lt;p&gt;The fix I plan on doing will remove the code Matt did and simply resolve the string as a &quot;normal&quot; property and perform the multiple actions that are required at that time. This will follow normal property resolution so the lookups will only be performed once. One other benefit is that the syntax can be as shown above - log4j.rootLogger=. This syntax is not possible with XML, Yaml or JSON in Log4j as our XML processing doesn&apos;t allow elements that have attributes or child elements to have a value and neither JSON or Yaml allow it either.&#160;&lt;/p&gt;

&lt;p&gt;The only downside to this is that it will clutter up the PropertiesConfigurationBuilder somewhat, but the whole point of the builder is to translate the properties syntax into a Node hierarchy so it is the correct place to perform this work.&lt;/p&gt;

&lt;p&gt;Note that you could have created your own HadoopPropertiesConfigurationFactory and extended the PropertiesConfigurationBuilder to do whatever you want but it seems many of the methods in the builder class are private, making it difficult to extend. We probably want to fix that in a separate Jira.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17488602" author="apache9" created="Tue, 8 Feb 2022 05:44:32 +0000"  >&lt;blockquote&gt;
&lt;p&gt;The only downside to this is that it will clutter up the PropertiesConfigurationBuilder somewhat, but the whole point of the builder is to translate the properties syntax into a Node hierarchy so it is the correct place to perform this work.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;So this is almost the same approch proposed above? Customize the PropertiesConfiguration related stuff...&lt;/p&gt;</comment>
                            <comment id="17488609" author="pkarwasz" created="Tue, 8 Feb 2022 06:18:33 +0000"  >&lt;p&gt;What about introducing a real &lt;tt&gt;setCompound&lt;/tt&gt; or modifying &lt;tt&gt;setLevel&lt;/tt&gt; on the &lt;tt&gt;LoggerConfig&lt;/tt&gt; component? This would allow a syntax as the one proposed by Carter in &lt;a href=&quot;https://github.com/apache/logging-log4j2/pull/735#issuecomment-1026245393&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this thread&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Basically we would have &lt;tt&gt;rootLogger.something&lt;/tt&gt; instead of &lt;tt&gt;rootLogger&lt;/tt&gt; but:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;this will apply to all formats (whether it will be useful or not),&lt;/li&gt;
	&lt;li&gt;we could omit the &lt;tt&gt;name&lt;/tt&gt; property for all other logger configs.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="17488630" author="ralph.goers@dslextreme.com" created="Tue, 8 Feb 2022 07:08:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhangduo&quot; class=&quot;user-hover&quot; rel=&quot;zhangduo&quot;&gt;zhangduo&lt;/a&gt; Yes - just a different spot in the code.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ppkarwasz&quot; class=&quot;user-hover&quot; rel=&quot;ppkarwasz&quot;&gt;ppkarwasz&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;The original request was to support the compound attribute to make it more compatible with what is being done with log4j1 properties configurations .The XML configuration for Log4j 1 does not support this.&lt;/p&gt;

&lt;p&gt;We are implementing this for the sole purpose of making the transition of Hadoop scripts easier, although we&apos;ve pointed out that the Hadoop scripts could have handled this with no changes to Log4j2.&lt;/p&gt;

&lt;p&gt;Modifying the LoggerConfig means it will apply to all formats. I do not want that.&#160; The XML, Yaml, and JSON syntaxes are fine just the way they are. introducing the notion of&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;Root config=&lt;span class=&quot;code-quote&quot;&gt;&quot;INFO, Console, File&quot;&lt;/span&gt;/&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Is not at all appealing to me, especially since it loses functionality. to be complete it would have to be something like:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;Root config=&lt;span class=&quot;code-quote&quot;&gt;&quot;INFO, MarkerFilter(marker=FLOW, onMatch=ACCEPT, onMismatch=NEUTRAL), {Console, DEBUG}, File, {File2, DEBUG, RegexFilter regex=&lt;span class=&quot;code-quote&quot;&gt;&apos;.* test .*&apos;&lt;/span&gt; onMatch=ACCEPT onMismatch=DENY&quot;&lt;/span&gt;/&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;which is completely ridiculous when you are dealing with a configuration format that is already well structured. Plus, parsing that string would be error-prone.&#160; To top it off, the equivalent syntax in JSON would be&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;Root&quot;&lt;/span&gt;: {&lt;span class=&quot;code-quote&quot;&gt;&quot;level&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;debug&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;AppenderRef&quot;&lt;/span&gt;: [{&lt;span class=&quot;code-quote&quot;&gt;&quot;ref&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;Console&quot;&lt;/span&gt;}, {&lt;span class=&quot;code-quote&quot;&gt;&quot;ref&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;File&quot;&lt;/span&gt;}]}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;which I personally find to be much more readable and far less error prone as there is absolutely no ambiguity.&lt;/p&gt;

&lt;p&gt;If you want to do that however, you are free to create your own ConfigurationFactory.&lt;/p&gt;</comment>
                            <comment id="17488651" author="apache9" created="Tue, 8 Feb 2022 08:00:03 +0000"  >&lt;p&gt;On xml, json, and yaml, I agree that they are already well structured, but what if we want to support passing multiple appenders via system properties or env?&lt;/p&gt;</comment>
                            <comment id="17488657" author="apache9" created="Tue, 8 Feb 2022 08:12:39 +0000"  >&lt;p&gt;And for my requirements, properties file is enough to support migrating hadoop to log4j2.&lt;/p&gt;

&lt;p&gt;But from the technical view, I prefer we have the same ability for different configuration file format.&lt;/p&gt;

&lt;p&gt;Thanks~&lt;/p&gt;</comment>
                            <comment id="17489967" author="apache9" created="Thu, 10 Feb 2022 05:34:52 +0000"  >&lt;p&gt;So waht is the current prefered approach?&lt;/p&gt;

&lt;p&gt;For me, I&apos;m OK with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rgoers&quot; class=&quot;user-hover&quot; rel=&quot;rgoers&quot;&gt;rgoers&lt;/a&gt;&apos;s approach to modify PropertiesConfiguration and only support the feature for properties file, as it is enough for hadoop and hbase.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="17490025" author="ralph.goers@dslextreme.com" created="Thu, 10 Feb 2022 08:19:08 +0000"  >&lt;p&gt;The approach I suggested still didn&#8217;t work with lookups. I have modified the approach and now have it working. I&#8217;ll get it committed tomorrow for you to try.&lt;/p&gt;</comment>
                            <comment id="17490032" author="apache9" created="Thu, 10 Feb 2022 08:27:10 +0000"  >&lt;p&gt;OK, thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rgoers&quot; class=&quot;user-hover&quot; rel=&quot;rgoers&quot;&gt;rgoers&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="17491502" author="ralph.goers@dslextreme.com" created="Sun, 13 Feb 2022 05:35:53 +0000"  >&lt;p&gt;Fix has been committed under &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3341&quot; title=&quot;Support passing something like &amp;#39;-Dlog4j.rootLogger=INFO,Console&amp;#39; from command line to set level and appenders at once&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3341&quot;&gt;&lt;del&gt;LOG4J2-3341&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="13422823">LOG4J2-3341</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13425523">HBASE-26723</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13422823">LOG4J2-3341</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13039682" name="log4j2.err" size="20976" author="zhangduo" created="Sat, 5 Feb 2022 14:49:33 +0000"/>
                            <attachment id="13039683" name="log4j2.properties" size="5405" author="zhangduo" created="Sat, 5 Feb 2022 14:49:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 39 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0za7c:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>