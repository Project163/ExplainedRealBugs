<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:33:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-832] ThrowableProxy fails if a class in logged stack trace throws java.lang.Error from initializer</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-832</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;When the Logger attempts to log a message with an exception stack trace, it uses the ThrowableProxy class to introspect classes in the stack trace frames.&lt;/p&gt;

&lt;p&gt;If the class sun.reflect.misc.Trampoline is in the stack trace, the introspection performed by ThrowableProxy will fail causing a java.lang.Error to be thrown by the Logger call.&lt;/p&gt;

&lt;p&gt;The sun.reflect.misc.Trampoline class is used by the sun.reflect.misc.MethodUtil class to perform reflection-based method invocations. MethodUtil is widely used by libraries to perform method invocations. I&apos;ve encountered this problem when invoking methods over JMX and inside Jetty.&lt;/p&gt;

&lt;p&gt;I am classifying this as a blocker because it means that any logging statement that is logging a Throwable message containing a MethodUtil-based reflection stack trace can cause a java.lang.Error to be thrown by Log4j2. &lt;/p&gt;

&lt;p&gt;I will attach a unit test for this failure.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Java 1.7u67 Linux/OSX/Win7, Java 1.7u60 Linux, Java 1.7u25 Linux&lt;/p&gt;</environment>
        <key id="12741876">LOG4J2-832</key>
            <summary>ThrowableProxy fails if a class in logged stack trace throws java.lang.Error from initializer</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="soleger">Seth Leger</reporter>
                        <labels>
                    </labels>
                <created>Tue, 16 Sep 2014 18:19:04 +0000</created>
                <updated>Wed, 17 Sep 2014 21:30:55 +0000</updated>
                            <resolved>Wed, 17 Sep 2014 21:12:54 +0000</resolved>
                                    <version>2.0</version>
                    <version>2.0.2</version>
                    <version>2.1</version>
                                    <fixVersion>2.1</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14135884" author="soleger" created="Tue, 16 Sep 2014 18:21:09 +0000"  >&lt;p&gt;This is the cause of the following issue:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://groups.google.com/forum/#!topic/lmax-disruptor/yLUPn4kkzkk/overview&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://groups.google.com/forum/#!topic/lmax-disruptor/yLUPn4kkzkk/overview&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14135896" author="soleger" created="Tue, 16 Sep 2014 18:27:07 +0000"  >&lt;p&gt;Here is a simple unit test that reproduces the problem by invoking a method via reflection using sun.reflect.misc.MethodUtil.&lt;/p&gt;</comment>
                            <comment id="14135911" author="soleger" created="Tue, 16 Sep 2014 18:33:40 +0000"  >&lt;p&gt;Here&apos;s the stack trace from the failure of the unit test:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.Error: Trampoline must not be defined by the bootstrap classloader
	at sun.reflect.misc.Trampoline.&amp;lt;clinit&amp;gt;(MethodUtil.java:55)
	at java.lang.Class.forName0(Native Method)
	at java.lang.Class.forName(Class.java:270)
	at org.apache.logging.log4j.core.util.Loader.initializeClass(Loader.java:285)
	at org.apache.logging.log4j.core.impl.ThrowableProxy.loadClass(ThrowableProxy.java:500)
	at org.apache.logging.log4j.core.impl.ThrowableProxy.toExtendedStackTrace(ThrowableProxy.java:621)
	at org.apache.logging.log4j.core.impl.ThrowableProxy.&amp;lt;init&amp;gt;(ThrowableProxy.java:146)
	at org.apache.logging.log4j.core.impl.Log4jLogEvent.getThrownProxy(Log4jLogEvent.java:323)
	at org.apache.logging.log4j.core.pattern.ExtendedThrowablePatternConverter.format(ExtendedThrowablePatternConverter.java:64)
	at org.apache.logging.log4j.core.pattern.PatternFormatter.format(PatternFormatter.java:36)
	at org.apache.logging.log4j.core.layout.PatternLayout.toSerializable(PatternLayout.java:189)
	at org.apache.logging.log4j.core.layout.PatternLayout.toSerializable(PatternLayout.java:53)
	at org.apache.logging.log4j.core.layout.AbstractStringLayout.toByteArray(AbstractStringLayout.java:52)
	at org.apache.logging.log4j.core.appender.AbstractOutputStreamAppender.append(AbstractOutputStreamAppender.java:104)
	at org.apache.logging.log4j.core.config.AppenderControl.callAppender(AppenderControl.java:97)
	at org.apache.logging.log4j.core.config.LoggerConfig.callAppenders(LoggerConfig.java:428)
	at org.apache.logging.log4j.core.config.LoggerConfig.log(LoggerConfig.java:407)
	at org.apache.logging.log4j.core.config.LoggerConfig.log(LoggerConfig.java:365)
	at org.apache.logging.log4j.core.Logger.logMessage(Logger.java:112)
	at org.apache.logging.log4j.spi.AbstractLogger.logMessage(AbstractLogger.java:1336)
	at org.apache.logging.log4j.spi.AbstractLogger.logIfEnabled(AbstractLogger.java:1325)
	at org.apache.logging.log4j.spi.AbstractLogger.error(AbstractLogger.java:551)
	at Log4j2MethodUtilTrampolineTest.testTrampolineException(Log4j2MethodUtilTrampolineTest.java:34)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:271)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:70)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
	at org.eclipse.jdt.internal.junit4.runner.JUnit4TestReference.run(JUnit4TestReference.java:50)
	at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:467)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:683)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:390)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:197)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14135924" author="soleger" created="Tue, 16 Sep 2014 18:37:45 +0000"  >&lt;p&gt;It looks like Pax Logging had an identical error that was recently fixed by adding a &apos;catch Throwable&apos; around the introspection:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://ops4j1.jira.com/browse/PAXLOGGING-169&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ops4j1.jira.com/browse/PAXLOGGING-169&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/ops4j/org.ops4j.pax.logging/commit/cc91695d03e4d28046dc96c4186ee154306e41e0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/ops4j/org.ops4j.pax.logging/commit/cc91695d03e4d28046dc96c4186ee154306e41e0&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14136005" author="garydgregory" created="Tue, 16 Sep 2014 19:14:10 +0000"  >&lt;p&gt;Would you be willing to clone from git our master branch and try the 2.1 code base? &lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;</comment>
                            <comment id="14136032" author="soleger" created="Tue, 16 Sep 2014 19:22:51 +0000"  >&lt;p&gt;Hi Gary, I&apos;m importing your code now to work on a patch. I&apos;ll also try the latest 2.1 code to see if the same error occurs.&lt;/p&gt;</comment>
                            <comment id="14136115" author="soleger" created="Tue, 16 Sep 2014 20:10:32 +0000"  >&lt;p&gt;&lt;del&gt;The problem also occurs in the latest master code.&lt;/del&gt; Update: I was inadvertently running the code against log4j 2.0.2. The issue has been fixed in the latest 2.1-SNAPSHOT code.&lt;/p&gt;

&lt;p&gt;I think that this patch will fix the issue. It changes some specific ClassNotFoundException catch clauses to catch Throwable so that the java.lang.Error thrown by sun.reflect.misc.Trampoline will be caught. This fixes the attached unit test.&lt;/p&gt;

&lt;p&gt;The patch applies against version 2.0.2 and the latest master code.&lt;/p&gt;</comment>
                            <comment id="14136421" author="garydgregory" created="Tue, 16 Sep 2014 22:51:32 +0000"  >&lt;p&gt;The patch &lt;tt&gt;C:\test\ggregory-log4j2.patch&lt;/tt&gt; only changes one catch and causes the test to pass. Could there be unforeseen problems catching Throwable instead of Exception here?&lt;/p&gt;</comment>
                            <comment id="14136425" author="garydgregory" created="Tue, 16 Sep 2014 22:53:02 +0000"  >&lt;p&gt;The other issue is that the test depends on running on an Oracle VM. There should be a way to do the test with reflection... but the attached &lt;tt&gt;C:\test\ggregory-log4j2-test.patch&lt;/tt&gt; passes when the fix is not applied which is not OK.&lt;/p&gt;</comment>
                            <comment id="14136685" author="garydgregory" created="Wed, 17 Sep 2014 02:39:31 +0000"  >&lt;p&gt;The new patch &lt;tt&gt;C:\test\ggregory-log4j2.patch&lt;/tt&gt; works from Eclipse but I cannot get the Maven build to complete as it gets stuck in a Flume test. I&apos;ve tried twice with the same result. Can anyone else try the patch? Also note that the unit test has some key lines commented out because it will not compile under Maven but compiles OK in Eclipse. This clearly needs some Maven magic; see the comments in the test class.&lt;/p&gt;</comment>
                            <comment id="14137037" author="soleger" created="Wed, 17 Sep 2014 10:33:15 +0000"  >&lt;p&gt;Here is an updated version of the test that runs under Maven by using reflection to instantiate MethodUtils and has additional comments.&lt;/p&gt;</comment>
                            <comment id="14137109" author="garydgregory" created="Wed, 17 Sep 2014 11:54:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=soleger&quot; class=&quot;user-hover&quot; rel=&quot;soleger&quot;&gt;soleger&lt;/a&gt;: The new test is invalid because it passes when the bug is unpatched (when the code still catches Exception instead of Throwable).&lt;/p&gt;

&lt;p&gt;That&apos;s the problem here, hard to prove there is a bug from a unit test, which we must have to make sure the fix does not get undone at some point in the future.&lt;/p&gt;</comment>
                            <comment id="14137331" author="soleger" created="Wed, 17 Sep 2014 14:37:26 +0000"  >&lt;p&gt;What JDK are you using when the test passes? I think that this behavior was introduced in later patches for Java 6 and Java 7. According to this code in Java 7u40, they added a static initializer to Trampoline that is throwing the error that I see on my Java 7 system:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://grepcode.com/file/repository.grepcode.com/java/root/jdk/openjdk/7u40-b43/sun/reflect/misc/MethodUtil.java#MethodUtil&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://grepcode.com/file/repository.grepcode.com/java/root/jdk/openjdk/7u40-b43/sun/reflect/misc/MethodUtil.java#MethodUtil&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Trampoline {
     &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; {
         &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (Trampoline.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;getClassLoader() == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
             &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Error(
                 &lt;span class=&quot;code-quote&quot;&gt;&quot;Trampoline must not be defined by the bootstrap classloader&quot;&lt;/span&gt;);
         }
     }
...
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Another person in my office is running the test on Java 6u65 and also gets an exception, although the exception is different (NoClassDefFoundError).&lt;/p&gt;</comment>
                            <comment id="14137333" author="brozow" created="Wed, 17 Sep 2014 14:38:07 +0000"  >&lt;p&gt;Here is the failure when running on Oracle Java 1.6.0&lt;/p&gt;

&lt;p&gt;java version &quot;1.6.0_65&quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.6.0_65-b14-462-11M4609)&lt;br/&gt;
Java HotSpot(TM) 64-Bit Server VM (build 20.65-b04-462, mixed mode)&lt;/p&gt;


&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;-------------------------------------------------------------------------------
Test set: Log4j2MethodUtilTrampolineTest
-------------------------------------------------------------------------------
Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 0.534 sec &amp;lt;&amp;lt;&amp;lt; FAILURE!
testTrampolineException(Log4j2MethodUtilTrampolineTest)  Time elapsed: 0.506 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!
java.lang.NoClassDefFoundError: Could not initialize class sun.reflect.misc.Trampoline
        at java.lang.Class.forName0(Native Method)
        at java.lang.Class.forName(Class.java:171)
        at org.apache.logging.log4j.core.util.Loader.loadClassWithDefaultClassLoader(Loader.java:272)
        at org.apache.logging.log4j.core.util.Loader.loadClass(Loader.java:267)
        at org.apache.logging.log4j.core.impl.ThrowableProxy.loadClass(ThrowableProxy.java:509)
        at org.apache.logging.log4j.core.impl.ThrowableProxy.toExtendedStackTrace(ThrowableProxy.java:621)
        at org.apache.logging.log4j.core.impl.ThrowableProxy.&amp;lt;init&amp;gt;(ThrowableProxy.java:170)
        at org.apache.logging.log4j.core.impl.ThrowableProxy.&amp;lt;init&amp;gt;(ThrowableProxy.java:148)
        at org.apache.logging.log4j.core.impl.Log4jLogEvent.getThrownProxy(Log4jLogEvent.java:323)
        at org.apache.logging.log4j.core.pattern.ExtendedThrowablePatternConverter.format(ExtendedThrowablePatternConverter.java:64)
        at org.apache.logging.log4j.core.pattern.PatternFormatter.format(PatternFormatter.java:36)
        at org.apache.logging.log4j.core.layout.PatternLayout.toSerializable(PatternLayout.java:189)
        at org.apache.logging.log4j.core.layout.PatternLayout.toSerializable(PatternLayout.java:53)
        at org.apache.logging.log4j.core.layout.AbstractStringLayout.toByteArray(AbstractStringLayout.java:52)
        at org.apache.logging.log4j.core.appender.AbstractOutputStreamAppender.append(AbstractOutputStreamAppender.java:104)
        at org.apache.logging.log4j.core.config.AppenderControl.callAppender(AppenderControl.java:97)
        at org.apache.logging.log4j.core.config.LoggerConfig.callAppenders(LoggerConfig.java:428)
        at org.apache.logging.log4j.core.config.LoggerConfig.log(LoggerConfig.java:407)
        at org.apache.logging.log4j.core.config.LoggerConfig.log(LoggerConfig.java:365)
        at org.apache.logging.log4j.core.Logger.logMessage(Logger.java:112)
        at org.apache.logging.log4j.spi.AbstractLogger.logMessage(AbstractLogger.java:1336)
        at org.apache.logging.log4j.spi.AbstractLogger.logIfEnabled(AbstractLogger.java:1325)
        at org.apache.logging.log4j.spi.AbstractLogger.error(AbstractLogger.java:551)
        at Log4j2MethodUtilTrampolineTest.testTrampolineException(Log4j2MethodUtilTrampolineTest.java:61)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)
        at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
        at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)
        at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
        at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:271)
        at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:70)
        at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)
        at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
        at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
        at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
        at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
        at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
        at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
        at org.apache.maven.surefire.junit4.JUnit4TestSet.execute(JUnit4TestSet.java:53)
        at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:123)
        at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:104)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14137352" author="garydgregory" created="Wed, 17 Sep 2014 14:53:03 +0000"  >&lt;p&gt;I am using:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java version &quot;1.7.0_67&quot;
Java(TM) SE Runtime Environment (build 1.7.0_67-b01)
Java HotSpot(TM) 64-Bit Server VM (build 24.65-b04, mixed mode)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Apache Maven 3.2.3 (33f8c3e1027c3ddde99d3cdebad2656a31e8fdf4; 2014-08-11T16:58:10-04:00)
Maven home: C:\Java\apache-maven-3.2.3
Java version: 1.7.0_67, vendor: Oracle Corporation
Java home: C:\Program Files\Java\jdk1.7.0_67\jre
Default locale: en_US, platform encoding: Cp1252
OS name: &quot;windows 7&quot;, version: &quot;6.1&quot;, arch: &quot;amd64&quot;, family: &quot;windows&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This is what I see when I run &lt;tt&gt;mvn clean test&lt;/tt&gt;:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.023 sec - in org.apache.logging.log4j.core.HostNameTest
Running org.apache.logging.log4j.core.impl.Log4j2MethodUtilTrampolineTest
java.lang.reflect.InvocationTargetException
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:606)
        at org.apache.logging.log4j.core.impl.Log4j2MethodUtilTrampolineTest.testTrampolineException(Log4j2MethodUtilTrampolineTest.java:65)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:606)
        at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)
        at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
        at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)
        at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
        at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:271)
        at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:70)
        at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)
        at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
        at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
        at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
        at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
        at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
        at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
        at org.junit.runners.Suite.runChild(Suite.java:127)
        at org.junit.runners.Suite.runChild(Suite.java:26)
        at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)
        at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)
        at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)
        at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)
        at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)
        at org.junit.runners.ParentRunner.run(ParentRunner.java:309)
        at org.junit.runner.JUnitCore.run(JUnitCore.java:160)
        at org.junit.runner.JUnitCore.run(JUnitCore.java:138)
        at org.apache.maven.surefire.junitcore.JUnitCoreWrapper.createRequestAndRun(JUnitCoreWrapper.java:113)
        at org.apache.maven.surefire.junitcore.JUnitCoreWrapper.executeEager(JUnitCoreWrapper.java:85)
        at org.apache.maven.surefire.junitcore.JUnitCoreWrapper.execute(JUnitCoreWrapper.java:54)
        at org.apache.maven.surefire.junitcore.JUnitCoreProvider.invoke(JUnitCoreProvider.java:134)
        at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:200)
        at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:153)
        at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:103)
Caused by: java.lang.IllegalAccessException: Class sun.reflect.misc.Trampoline can not access a member of class org.apache.logging.log4j.core.impl.Log4j2MethodUtilTrampolineTest$AlwaysThrowsException with modifiers &quot;public&quot;
        at sun.reflect.Reflection.ensureMemberAccess(Reflection.java:109)
        at java.lang.reflect.AccessibleObject.slowCheckMemberAccess(AccessibleObject.java:261)
        at java.lang.reflect.AccessibleObject.checkAccess(AccessibleObject.java:253)
        at java.lang.reflect.Method.invoke(Method.java:599)
        at sun.reflect.misc.Trampoline.invoke(MethodUtil.java:75)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:606)
        at sun.reflect.misc.MethodUtil.invoke(MethodUtil.java:279)
        ... 39 more
ERROR StatusLogger No log4j2 configuration file found. Using default configuration: logging only errors to the console.
11:44:07.649 [main] ERROR org.apache.logging.log4j.core.impl.Log4j2MethodUtilTrampolineTest - null
java.lang.reflect.InvocationTargetException
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.7.0_67]
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) ~[?:1.7.0_67]
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.7.0_67]
        at java.lang.reflect.Method.invoke(Method.java:606) ~[?:1.7.0_67]
        at org.apache.logging.log4j.core.impl.Log4j2MethodUtilTrampolineTest.testTrampolineException(Log4j2MethodUtilTrampolineTest.java:65) [test-classes/:?]
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.7.0_67]
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) ~[?:1.7.0_67]
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.7.0_67]
        at java.lang.reflect.Method.invoke(Method.java:606) ~[?:1.7.0_67]
        at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47) [junit-4.11.jar:?]
        at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12) [junit-4.11.jar:?]
        at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44) [junit-4.11.jar:?]
        at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17) [junit-4.11.jar:?]
        at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:271) [junit-4.11.jar:?]
        at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:70) [junit-4.11.jar:?]
        at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50) [junit-4.11.jar:?]
        at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238) [junit-4.11.jar:?]
        at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63) [junit-4.11.jar:?]
        at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236) [junit-4.11.jar:?]
        at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53) [junit-4.11.jar:?]
        at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229) [junit-4.11.jar:?]
        at org.junit.runners.ParentRunner.run(ParentRunner.java:309) [junit-4.11.jar:?]
        at org.junit.runners.Suite.runChild(Suite.java:127) [junit-4.11.jar:?]
        at org.junit.runners.Suite.runChild(Suite.java:26) [junit-4.11.jar:?]
        at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238) [junit-4.11.jar:?]
        at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63) [junit-4.11.jar:?]
        at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236) [junit-4.11.jar:?]
        at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53) [junit-4.11.jar:?]
        at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229) [junit-4.11.jar:?]
        at org.junit.runners.ParentRunner.run(ParentRunner.java:309) [junit-4.11.jar:?]
        at org.junit.runner.JUnitCore.run(JUnitCore.java:160) [junit-4.11.jar:?]
        at org.junit.runner.JUnitCore.run(JUnitCore.java:138) [junit-4.11.jar:?]
        at org.apache.maven.surefire.junitcore.JUnitCoreWrapper.createRequestAndRun(JUnitCoreWrapper.java:113) [surefire-junit47-2.17.jar:2.17]
        at org.apache.maven.surefire.junitcore.JUnitCoreWrapper.executeEager(JUnitCoreWrapper.java:85) [surefire-junit47-2.17.jar:2.17]
        at org.apache.maven.surefire.junitcore.JUnitCoreWrapper.execute(JUnitCoreWrapper.java:54) [surefire-junit47-2.17.jar:2.17]
        at org.apache.maven.surefire.junitcore.JUnitCoreProvider.invoke(JUnitCoreProvider.java:134) [surefire-junit47-2.17.jar:2.17]
        at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:200) [surefire-booter-2.17.jar:2.17]
        at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:153) [surefire-booter-2.17.jar:2.17]
        at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:103) [surefire-booter-2.17.jar:2.17]
Caused by: java.lang.IllegalAccessException: Class sun.reflect.misc.Trampoline can not access a member of class org.apache.logging.log4j.core.impl.Log4j2MethodUtilTrampolineTest$AlwaysThrowsException with modifiers &quot;public&quot;
        at sun.reflect.Reflection.ensureMemberAccess(Reflection.java:109) ~[?:1.7.0_67]
        at java.lang.reflect.AccessibleObject.slowCheckMemberAccess(AccessibleObject.java:261) ~[?:1.7.0_67]
        at java.lang.reflect.AccessibleObject.checkAccess(AccessibleObject.java:253) ~[?:1.7.0_67]
        at java.lang.reflect.Method.invoke(Method.java:599) ~[?:1.7.0_67]
        at sun.reflect.misc.Trampoline.invoke(MethodUtil.java:75) ~[?:1.7.0_67]
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.7.0_67]
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) ~[?:1.7.0_67]
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.7.0_67]
        at java.lang.reflect.Method.invoke(Method.java:606) ~[?:1.7.0_67]
        at sun.reflect.misc.MethodUtil.invoke(MethodUtil.java:279) ~[?:1.7.0_67]
        ... 39 more
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.114 sec - in org.apache.logging.log4j.core.impl.Log4j2MethodUtilTrampolineTest
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14137705" author="soleger" created="Wed, 17 Sep 2014 18:29:06 +0000"  >&lt;p&gt;I have figured out why the test is working for you and not me. The issue is fixed in the latest log4j 2.1-SNAPSHOT code. My POM file runs the test against log4j 2.0.2 which does fail.&lt;/p&gt;

&lt;p&gt;I have not figured out exactly which change in log4j master fixed the issue. I am a little worried because the catch() statements haven&apos;t been changed in ThrowableProxy so I wonder if a class could still trigger an exception here somehow.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure what to do now. You can mark the bug as fixed in 2.1 but anyone using log4j 2.0.x could still encounter this issue unless a fix is backported and released in a 2.0.3 release.&lt;/p&gt;</comment>
                            <comment id="14137770" author="garydgregory" created="Wed, 17 Sep 2014 19:14:09 +0000"  >&lt;p&gt;At this time, we are not planning a 2.0.3 release but 2.1 will be out in a few weeks at the latest.&lt;/p&gt;</comment>
                            <comment id="14137771" author="garydgregory" created="Wed, 17 Sep 2014 19:14:28 +0000"  >&lt;p&gt;Reporter says master works.&lt;/p&gt;</comment>
                            <comment id="14137844" author="soleger" created="Wed, 17 Sep 2014 19:45:26 +0000"  >&lt;p&gt;I&apos;ve written a new test that fails with the same error under 2.1-SNAPSHOT. I think that, in particular, the sun.reflect.misc.Trampoline class is working under 2.1-SNAPSHOT because of the way that the LoaderUtil code was rearranged. However, it is possible to write a simple class that causes log4j to crash when logging the stack trace. I&apos;ll attach a unit test for this condition now.&lt;/p&gt;</comment>
                            <comment id="14137852" author="soleger" created="Wed, 17 Sep 2014 19:51:08 +0000"  >&lt;p&gt;This test uses a class whose static initializer always throws java.lang.Error. If you try to log the Error stack trace that is generated when you load the class, than log4j fails because it is not catching the Error generated when reflecting the class.&lt;/p&gt;</comment>
                            <comment id="14137858" author="soleger" created="Wed, 17 Sep 2014 19:54:28 +0000"  >&lt;p&gt;Here&apos;s the stack trace from that test:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.NoClassDefFoundError: Could not initialize class Log4j2UninitializableClassTest$AlwaysThrowsError
        at java.lang.Class.forName0(Native Method)
        at java.lang.Class.forName(Class.java:270)
        at org.apache.logging.log4j.core.util.Loader.initializeClass(Loader.java:256)
        at org.apache.logging.log4j.core.impl.ThrowableProxy.loadClass(ThrowableProxy.java:499)
        at org.apache.logging.log4j.core.impl.ThrowableProxy.toExtendedStackTrace(ThrowableProxy.java:620)
        at org.apache.logging.log4j.core.impl.ThrowableProxy.&amp;lt;init&amp;gt;(ThrowableProxy.java:146)
        at org.apache.logging.log4j.core.impl.Log4jLogEvent.getThrownProxy(Log4jLogEvent.java:323)
        at org.apache.logging.log4j.core.pattern.ExtendedThrowablePatternConverter.format(ExtendedThrowablePatternConverter.java:64)
        at org.apache.logging.log4j.core.pattern.PatternFormatter.format(PatternFormatter.java:36)
        at org.apache.logging.log4j.core.layout.PatternLayout.toSerializable(PatternLayout.java:191)
        at org.apache.logging.log4j.core.layout.PatternLayout.toSerializable(PatternLayout.java:52)
        at org.apache.logging.log4j.core.layout.AbstractStringLayout.toByteArray(AbstractStringLayout.java:67)
        at org.apache.logging.log4j.core.appender.AbstractOutputStreamAppender.append(AbstractOutputStreamAppender.java:106)
        at org.apache.logging.log4j.core.config.AppenderControl.callAppender(AppenderControl.java:99)
        at org.apache.logging.log4j.core.config.LoggerConfig.callAppenders(LoggerConfig.java:430)
        at org.apache.logging.log4j.core.config.LoggerConfig.log(LoggerConfig.java:409)
        at org.apache.logging.log4j.core.config.LoggerConfig.log(LoggerConfig.java:367)
        at org.apache.logging.log4j.core.Logger.logMessage(Logger.java:112)
        at org.apache.logging.log4j.spi.AbstractLogger.logMessage(AbstractLogger.java:727)
        at org.apache.logging.log4j.spi.AbstractLogger.logIfEnabled(AbstractLogger.java:716)
        at org.apache.logging.log4j.spi.AbstractLogger.error(AbstractLogger.java:354)
        at Log4j2UninitializableClassTest.testLoggingStackTraceWithClassThatCannotInitialize(Log4j2UninitializableClassTest.java:43)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14137958" author="garydgregory" created="Wed, 17 Sep 2014 20:47:55 +0000"  >&lt;p&gt;Can you add an Apache License 2.0 header to your latest .java file? That, or create a unified diff file. Thank you!&lt;/p&gt;</comment>
                            <comment id="14137996" author="garydgregory" created="Wed, 17 Sep 2014 21:12:54 +0000"  >&lt;p&gt;Pushed to master. &lt;br/&gt;
Please verify and close. &lt;br/&gt;
Thank you for your patience and diligence!&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;</comment>
                            <comment id="14138015" author="soleger" created="Wed, 17 Sep 2014 21:30:55 +0000"  >&lt;p&gt;All available tests that I have for this condition pass with the latest 2.1-SNAPSHOT code. Thanks for the quick response to this issue! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12742114">LOG4J2-834</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12669177" name="LOG4J2-832.patch" size="1151" author="soleger" created="Tue, 16 Sep 2014 20:10:32 +0000"/>
                            <attachment id="12669380" name="Log4j2MethodUtilTrampolineTest.java" size="2322" author="soleger" created="Wed, 17 Sep 2014 10:33:15 +0000"/>
                            <attachment id="12669122" name="Log4j2MethodUtilTrampolineTest.java" size="1133" author="soleger" created="Tue, 16 Sep 2014 18:27:07 +0000"/>
                            <attachment id="12669488" name="Log4j2UninitializableClassTest.java" size="1515" author="soleger" created="Wed, 17 Sep 2014 19:51:08 +0000"/>
                            <attachment id="12669309" name="ggregory-log4j2.patch" size="3520" author="ggregory" created="Wed, 17 Sep 2014 02:39:31 +0000"/>
                            <attachment id="12669121" name="pom.xml" size="994" author="soleger" created="Tue, 16 Sep 2014 18:27:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 9 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2043r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>