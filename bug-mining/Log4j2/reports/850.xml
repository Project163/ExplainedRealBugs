<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:36:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-1452] Reusable messages break flow tracing logic</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-1452</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;Flow tracing assumes that you can save an instance of &lt;tt&gt;EntryMessage&lt;/tt&gt; across a method, but if you log something else within that method and reusable messages are in effect (as they are by default since 2.6), this does not always work properly.&lt;/p&gt;

&lt;p&gt;This code illustrate the issue:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        EntryMessage entryMessage = logger.traceEntry(logger.getMessageFactory().newMessage(&lt;span class=&quot;code-quote&quot;&gt;&quot;the entry&quot;&lt;/span&gt;));
        logger.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;something &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;&quot;&lt;/span&gt;);
        logger.traceExit(entryMessage);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It works as expected if you remove the middle &lt;tt&gt;logger.info()&lt;/tt&gt;, but with it the exit message gets messed up.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12985156">LOG4J2-1452</key>
            <summary>Reusable messages break flow tracing logic</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rpopma">Remko Popma</assignee>
                                    <reporter username="mikaelstaldal">Mikael St&#229;ldal</reporter>
                        <labels>
                    </labels>
                <created>Wed, 29 Jun 2016 19:38:18 +0000</created>
                <updated>Sun, 18 Sep 2016 10:37:53 +0000</updated>
                            <resolved>Sun, 18 Sep 2016 10:37:53 +0000</resolved>
                                    <version>2.6</version>
                    <version>2.6.1</version>
                                    <fixVersion>2.6.2</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="15355728" author="mikaelstaldal" created="Wed, 29 Jun 2016 19:40:02 +0000"  >&lt;p&gt;See the (incomplete) &lt;tt&gt;FlowTracingTest&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15355993" author="remkop@yahoo.com" created="Wed, 29 Jun 2016 23:22:33 +0000"  >&lt;p&gt;Good find!&lt;/p&gt;</comment>
                            <comment id="15356489" author="remkop@yahoo.com" created="Thu, 30 Jun 2016 04:23:56 +0000"  >&lt;p&gt;Notes on how to address this:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;The implementation of &lt;tt&gt;logger.traceEntry(&quot;some {}&quot;, &quot;message&quot;);&lt;/tt&gt; in AbstractLogger internally (in its &lt;tt&gt;entryMsg()&lt;/tt&gt; method) delegates to the MessageFactory to create a Message which is then wrapped in a FlowMessage by the FlowMessageFactory. If the MessageFactory creates ReusableMessages, we get the above problem. We can solve this by avoiding the MessageFactory and explicitly constructing the appropriate Message implementation class in the &lt;tt&gt;entryMsg&lt;/tt&gt; method.&lt;/li&gt;
	&lt;li&gt;Users may explicitly construct a Message with the Logger&apos;s MessageFactory as in the above example, resulting in the same problem. FlowMessageFactory will need to &quot;unpack&quot; any ReusableMessages that it is passed and construct an immutable Message from it. Documentation needs to be updated to say that ReusableMessages should not be passed as the parameter to &lt;tt&gt;traceEntry(Message)&lt;/tt&gt;.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15356735" author="mikaelstaldal" created="Thu, 30 Jun 2016 08:29:47 +0000"  >&lt;p&gt;Removing test since it was not well received.&lt;/p&gt;</comment>
                            <comment id="15357277" author="remkop@yahoo.com" created="Thu, 30 Jun 2016 15:27:25 +0000"  >&lt;p&gt;Fixed in master in commit 5b1c736.&lt;/p&gt;</comment>
                            <comment id="15357397" author="mikaelstaldal" created="Thu, 30 Jun 2016 16:28:22 +0000"  >&lt;p&gt;Seems to work.&lt;/p&gt;</comment>
                            <comment id="15357463" author="remkop@yahoo.com" created="Thu, 30 Jun 2016 16:55:51 +0000"  >&lt;p&gt;Thanks for confirming!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311120" key="com.pyxis.greenhopper.jira:gh-epic-link">
                        <customfieldname>Epic Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>LOG4J2-1270</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 20 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i30c27:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>