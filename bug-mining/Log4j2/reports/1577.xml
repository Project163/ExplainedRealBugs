<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:42:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-3439] log4j2 Spring Cloud config integration with MTLS gives NullPointerException</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-3439</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;Hello&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I am trying to use the log4j2 Spring cloud config integration capabilities and have been referring to the sample application on the github project &lt;a href=&quot;https://github.com/apache/logging-log4j2/tree/release-2.x/log4j-spring-cloud-config/log4j-spring-cloud-config-samples&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/logging-log4j2/tree/release-2.x/log4j-spring-cloud-config/log4j-spring-cloud-config-samples&lt;/a&gt; When I try to configure a MTLS HTTPs URL of my cloud config server in the bootstrap.yaml of my client application which needs to fetch the log4j2.xml, I get a NPE in the&#160;&lt;/p&gt;

&lt;p&gt;org.apache.logging.log4j.core.net.ssl.SslConfiguration.createSslContext(&lt;/p&gt;

&lt;p&gt;final boolean loadDefaultKeyManagerFactory, final boolean loadDefaultTrustManagerFactory) method when the&#160;SSLContext.getInstance(this.protocol); is invoked. On debugging I see that the protocol being passed from the SslConfigurationFactory to the SslConfiguration is &quot;https&quot; which causes SSLContext.getInstance() to throw an exception and thus no sslContext is created. I have attached the stacktrace for your reference.&lt;/p&gt;

&lt;p&gt;Below is my configuration. Please let me know if I am missing something.&lt;/p&gt;

&lt;p&gt;logging:&lt;br/&gt;
config: &lt;a href=&quot;https://localhost:8888/common/default/$&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://localhost:8888/common/default/$&lt;/a&gt;{CONFIG_SERVER_LABEL_ESCAPED}/log4j2.xml&lt;/p&gt;

&lt;p&gt;log4j2:&lt;br/&gt;
debug: true&lt;br/&gt;
keyStoreLocation: &lt;a href=&quot;file:///$&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:///$&lt;/a&gt;{HTTP_KEYSTORE_PATH}&lt;br/&gt;
keyStoreType: JKS&lt;br/&gt;
keyStorePassword: ${HTTP_KEYSTORE_PWD}&lt;br/&gt;
trustStoreLocation: &lt;a href=&quot;file:///$&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:///$&lt;/a&gt;{HTTP_TRUSTSTORE_PATH}&lt;br/&gt;
trustStoreKeyStoreType: JKS&lt;br/&gt;
trustStorePassword: ${HTTP_TRUSTSTORE_PWD}&lt;br/&gt;
sslVerifyHostName: false&lt;/p&gt;</description>
                <environment></environment>
        <key id="13434607">LOG4J2-3439</key>
            <summary>log4j2 Spring Cloud config integration with MTLS gives NullPointerException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pkarwasz">Piotr Karwasz</assignee>
                                    <reporter username="jayeshnetravali">Jayesh Netravali</reporter>
                        <labels>
                    </labels>
                <created>Fri, 18 Mar 2022 18:01:33 +0000</created>
                <updated>Wed, 6 Jul 2022 08:44:44 +0000</updated>
                            <resolved>Mon, 2 May 2022 21:11:49 +0000</resolved>
                                                    <fixVersion>2.18.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="17509149" author="pkarwasz" created="Sat, 19 Mar 2022 03:21:04 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jayeshnetravali&quot; class=&quot;user-hover&quot; rel=&quot;jayeshnetravali&quot;&gt;jayeshnetravali&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Thanks for reporting the issue. This seems like a typo in the code and will be shortly fixed.&lt;/p&gt;</comment>
                            <comment id="17509172" author="ralph.goers@dslextreme.com" created="Sat, 19 Mar 2022 05:39:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pkarwasz&quot; class=&quot;user-hover&quot; rel=&quot;pkarwasz&quot;&gt;pkarwasz&lt;/a&gt; That is pretty generous of you. I obviously didn&apos;t read the API description well enough. Obviously it should have been one of the values listed at &lt;a href=&quot;https://docs.oracle.com/javase/8/docs/technotes/guides/security/StandardNames.html#SSLContext.&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.oracle.com/javase/8/docs/technotes/guides/security/StandardNames.html#SSLContext.&lt;/a&gt; We default to SSL. To be honest, this seems wrong since all versions of SSL have security issues. I would expect we would always just specify TLS.&lt;/p&gt;</comment>
                            <comment id="17509201" author="pkarwasz" created="Sat, 19 Mar 2022 09:16:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rgoers&quot; class=&quot;user-hover&quot; rel=&quot;rgoers&quot;&gt;rgoers&lt;/a&gt;,&lt;br/&gt;
I never checked on old Java versions, but on Java 8 and later the &lt;em&gt;&quot;may support other versions&quot;&lt;/em&gt; is taken literally: e.g. the explicitly numbered protocols like &quot;TLSv1.2&quot; allows all protocols from SSLv3 to TLSv1.2 (but not TLSv1.3 on Java 11).&lt;/p&gt;

&lt;p&gt;So &quot;TLS&quot; and its &lt;a href=&quot;https://github.com/openjdk/jdk8u/blob/59efbfb2da0b1b588679db6375c124e224a0960e/jdk/src/share/classes/sun/security/ssl/SunJSSE.java#L212&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;alias &quot;SSL&quot;&lt;/a&gt; are the only rational choices: these actually use Java&apos;s security configuration (cf. &lt;a href=&quot;https://github.com/openjdk/jdk8u/blob/59efbfb2da0b1b588679db6375c124e224a0960e/jdk/src/share/classes/sun/security/ssl/SSLContextImpl.java#L893&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;source code&lt;/a&gt;) and I expect them to be forward compatible. Last year around JDK 8u291 all protocols except TLSv1.2 and TLSv1.3 were disabled by default.&lt;/p&gt;

&lt;p&gt;I agree with you, we should default to &quot;TLS&quot; because this sounds better and the &quot;SSL&quot; alias is disabled in FIPS mode. Tomcat does it too. I would go even further and deprecate the &quot;protocol&quot; property (document it better?), since the only other rational choice other than &quot;TLS&quot; is &quot;DTLS&quot;: users that don&apos;t know JSSE&apos;s details could get confused. Tomcat has two properties (cf. &lt;a href=&quot;https://tomcat.apache.org/tomcat-9.0-doc/config/http.html#SSL_Support_-_SSLHostConfig&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;documentation&lt;/a&gt;): &quot;protocols&quot;, which is the real one and &quot;sslProtocol&quot;, which is the &quot;fake&quot; JSSE protocol name.&lt;/p&gt;

&lt;p&gt;However that&apos;s beyond the scope of this issue. For this issue specifically I&apos;ll replace &quot;https&quot; with &lt;tt&gt;null&lt;/tt&gt;, add the missing unit tests and dust a little bit the documentation.&lt;/p&gt;</comment>
                            <comment id="17509340" author="jvz" created="Sat, 19 Mar 2022 21:07:56 +0000"  >&lt;p&gt;A safe default could be TLSv1.2, though TLSv1.3 is the&#160;&lt;em&gt;true&lt;/em&gt; safe default for TLS.&lt;/p&gt;</comment>
                            <comment id="17509519" author="pkarwasz" created="Sun, 20 Mar 2022 20:46:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mattsicker&quot; class=&quot;user-hover&quot; rel=&quot;mattsicker&quot;&gt;mattsicker&lt;/a&gt;: that is the actual problem with the &lt;tt&gt;SSLContext&lt;/tt&gt; algorithm names. &quot;TLSv1.2&quot; does not do what one might think, but activates every protocol version from SSL 3.0 up to TLS 1.2.&lt;/p&gt;

&lt;p&gt;I set the default to &quot;TLS&quot; in the PR with a comment explaining why we use this setting.&lt;/p&gt;</comment>
                            <comment id="17509522" author="jvz" created="Sun, 20 Mar 2022 21:07:11 +0000"  >&lt;p&gt;Got it, thanks for the explanation!&lt;/p&gt;</comment>
                            <comment id="17510337" author="jira-bot" created="Tue, 22 Mar 2022 08:51:08 +0000"  >&lt;p&gt;Commit 456f71b61ea65a0481a86f484a85773862206347 in logging-log4j2&apos;s branch refs/heads/release-2.x from Piotr P. Karwasz&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=456f71b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=456f71b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3439&quot; title=&quot;log4j2 Spring Cloud config integration with MTLS gives NullPointerException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3439&quot;&gt;&lt;del&gt;LOG4J2-3439&lt;/del&gt;&lt;/a&gt; Corrects default SSL configuration&lt;/p&gt;

&lt;p&gt;Replaces an invalid `SSLContext` algorithm name with Log4j&apos;s default and&lt;br/&gt;
adds unity tests.&lt;/p&gt;</comment>
                            <comment id="17510354" author="pkarwasz" created="Tue, 22 Mar 2022 09:14:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jayeshnetravali&quot; class=&quot;user-hover&quot; rel=&quot;jayeshnetravali&quot;&gt;jayeshnetravali&lt;/a&gt;,&lt;br/&gt;
I uploaded a fixed version to Apache&apos;s snapshot repository &lt;tt&gt;&lt;a href=&quot;https://repository.apache.org/snapshots&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/snapshots&lt;/a&gt;&lt;/tt&gt;. Can you check if the latest &lt;tt&gt;2.17.3-SNAPSHOT&lt;/tt&gt; fixes your problem and close the issue?&lt;/p&gt;</comment>
                            <comment id="17511096" author="JIRAUSER286800" created="Wed, 23 Mar 2022 08:25:43 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pkarwasz&quot; class=&quot;user-hover&quot; rel=&quot;pkarwasz&quot;&gt;pkarwasz&lt;/a&gt;, validated with 2.17.3-SNAPSHOT and this is working now.&lt;/p&gt;

&lt;p&gt;Happy to close this issue and appreciate the entire community&apos;s prompt response in resolving this.&lt;/p&gt;</comment>
                            <comment id="17511098" author="JIRAUSER286800" created="Wed, 23 Mar 2022 08:26:11 +0000"  >&lt;p&gt;Closing as this is working as expected.&lt;/p&gt;</comment>
                            <comment id="17527230" author="jira-bot" created="Sun, 24 Apr 2022 18:00:22 +0000"  >&lt;p&gt;Commit 2d3246467b70879adfe44ce619fec350394a7ad9 in logging-log4j2&apos;s branch refs/heads/master from Piotr P. Karwasz&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=2d3246467b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=2d3246467b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3439&quot; title=&quot;log4j2 Spring Cloud config integration with MTLS gives NullPointerException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3439&quot;&gt;&lt;del&gt;LOG4J2-3439&lt;/del&gt;&lt;/a&gt; Corrects default SSL configuration&lt;/p&gt;

&lt;p&gt;Replaces an invalid `SSLContext` algorithm name with Log4j&apos;s default and&lt;br/&gt;
adds unity tests.&lt;/p&gt;

&lt;p&gt;Conflicts:&lt;br/&gt;
	log4j-core/src/main/java/org/apache/logging/log4j/core/net/ssl/SslConfigurationFactory.java&lt;br/&gt;
	src/site/xdoc/manual/appenders.xml&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13041316" name="log4j-core-stacktrace.txt" size="33422" author="jayeshnetravali" created="Fri, 18 Mar 2022 18:01:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 29 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z10meg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>