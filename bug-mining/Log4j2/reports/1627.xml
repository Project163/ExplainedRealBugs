<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:43:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-3609] javac error when PluginProcessor (log4j-core jar) is in the classpath and annotation is not</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-3609</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;Java compilation (javac) fails to compile a class when the following conditions hold:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;the class transitively depends on an annotation;&lt;/li&gt;
	&lt;li&gt;the annotation is not in the classpath;&lt;/li&gt;
	&lt;li&gt;the log4j annotation processor (PluginProcessor) is in the classpath.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Assuming that &lt;tt&gt;MyAnnotation.class&lt;/tt&gt; is not in the classpath the error is the one shown below.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;error: cannot access MyAnnotation
  class file for MyAnnotation not found
1 error
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I admit that not including the annotation in the classpath could be considered a problem in general but there is no reason why the compilation should fail only when the log4j jar is in the classpath.&lt;/p&gt;

&lt;p&gt;It is pretty clear that the problem is related to the annotation processor present in log4j-core jar (PluginProcessor) cause removing the respective entries from the jar allows compilation to complete sucessfully.&lt;/p&gt;

&lt;p&gt;From the JDK perspective, it seems that this scenario was considered as a bug and was fixed somewhere in JDK6 allowing compilation to proceed even when annotations are missing from the classpath:&lt;br/&gt;
&lt;a href=&quot;https://bugs.java.com/bugdatabase/view_bug.do?bug_id=6365854&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://bugs.java.com/bugdatabase/view_bug.do?bug_id=6365854&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I will upload a minimal scenario with exact steps to reproduce the problem in a few minutes.&lt;/p&gt;</description>
                <environment>&lt;p&gt;The problem seems to be reproducible in every JDK. I tested with JDK 8, 11, 19, and 19.&lt;/p&gt;</environment>
        <key id="13483446">LOG4J2-3609</key>
            <summary>javac error when PluginProcessor (log4j-core jar) is in the classpath and annotation is not</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="mattsicker">Matt Sicker</assignee>
                                    <reporter username="zabetak">Stamatis Zampetakis</reporter>
                        <labels>
                    </labels>
                <created>Tue, 27 Sep 2022 12:04:17 +0000</created>
                <updated>Mon, 7 Apr 2025 16:02:22 +0000</updated>
                                            <version>2.19.0</version>
                                                    <component>Core</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17610021" author="zabetak" created="Tue, 27 Sep 2022 12:15:25 +0000"  >&lt;p&gt;I attached a mini project to reproduce the problem. The project can be found also here: &lt;a href=&quot;https://github.com/zabetak/LOG4J2-3609&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/zabetak/LOG4J2-3609&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17611992" author="jvz" created="Sat, 1 Oct 2022 21:56:06 +0000"  >&lt;p&gt;I&apos;m able to reproduce this issue in a unit test based on your test case. Upon further inspection, it seems to only happen when&#160;&lt;tt&gt;@MyAnnotation&lt;/tt&gt;&#160;has a retention policy of &lt;tt&gt;CLASS&lt;/tt&gt; (the default if unspecified) or &lt;tt&gt;RUNTIME&lt;/tt&gt;; it works fine when the retention policy is &lt;tt&gt;SOURCE&lt;/tt&gt;. This is a bit tricky to debug as annotation processing is already a tricky feature to debug in the first place. Let me see what I can figure out with further probing.&lt;/p&gt;</comment>
                            <comment id="17611997" author="jvz" created="Sat, 1 Oct 2022 22:25:45 +0000"  >&lt;p&gt;This seems to be a problem regardless of the annotation processor classes used; it&apos;s caused by having any annotation processors at all when compiling the class that links to a compiled class with a missing annotation. See &lt;a href=&quot;https://github.com/apache/logging-log4j2/commit/cd12efe23fa224575a79b62ecf3ece67f3c835ef&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/logging-log4j2/commit/cd12efe23fa224575a79b62ecf3ece67f3c835ef&lt;/a&gt;&#160;for the test (it&apos;s disabled by default).&lt;/p&gt;</comment>
                            <comment id="17612988" author="zabetak" created="Wed, 5 Oct 2022 12:54:58 +0000"  >&lt;p&gt;Thanks for looking into this Matt! I cannot say for if it is a javac problem or not but in general the presence of annotations processors complicates the build. Thankfully there are not many libraries packaging annotation processors in their core jars so similar problems can be easily avoided. &lt;/p&gt;

&lt;p&gt;From a log4j perspective it may worth considering to extract the annotation processor in a separate jar to facilitate the integration with other libraries. I haven&apos;t checked the code to see if what I am saying is feasible but just sharing my thoughts in case someone wants to pursue this further.&lt;/p&gt;</comment>
                            <comment id="17613036" author="jvz" created="Wed, 5 Oct 2022 15:12:57 +0000"  >&lt;p&gt;I think you&apos;ll be happy to see that in our 3.x branch (master), we&apos;re already gone and split up the plugin processor and even a major chunk of the plugin system into their own jars. We&apos;re still working on further splits of core, but the annotation processor was extracted partly due to problems with JPMS support in the first place. See &lt;a href=&quot;https://github.com/apache/logging-log4j2/tree/master/log4j-plugin-processor&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/logging-log4j2/tree/master/log4j-plugin-processor&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17613396" author="zabetak" created="Thu, 6 Oct 2022 09:24:43 +0000"  >&lt;p&gt;That&apos;s great news, looking forward for the 3.x release to come out!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13483462">CALCITE-5300</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13614456">HIVE-28885</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13484782">SOLR-16443</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13049823" name="LOG4J2-3609-repro.tar.gz" size="5072" author="zabetak" created="Tue, 27 Sep 2022 12:14:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 5 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z18vsg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>