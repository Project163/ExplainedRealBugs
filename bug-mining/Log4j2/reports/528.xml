<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:34:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-918] Combining Root and AsyncRoot in Xml configuration</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-918</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;Don&apos;t know if this is a documentation issue, a configuration bug, or just a user error, so I have left many fields empty in this report. &lt;/p&gt;

&lt;p&gt;I&apos;m trying to create an xml configuration where I have asynchronous logging to a socket, and synchronous logging to disk. &lt;/p&gt;

&lt;p&gt;The pdf-documentation says:&lt;br/&gt;
&lt;a href=&quot;http://logging.apache.org/log4j/2.x/log4j-users-guide.pdf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://logging.apache.org/log4j/2.x/log4j-users-guide.pdf&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&quot;Synchronous and asynchronous loggers can be combined in configuration. This gives you more&lt;br/&gt;
flexibility at the cost of a slight loss in performance (compared to making all loggers asynchronous).&lt;br/&gt;
Use the &amp;lt;asyncRoot&amp;gt; or &amp;lt;asyncLogger&amp;gt; configuration elements to specify the loggers that need to&lt;br/&gt;
be asynchronous. The same configuration file can also contain &amp;lt;root&amp;gt; and &amp;lt;logger&amp;gt; elements for&lt;br/&gt;
the synchronous loggers.&quot;&lt;/p&gt;

&lt;p&gt;.. so I created a configuration file that looks like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.0&quot;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;?&amp;gt;
&amp;lt;Configuration status=&lt;span class=&quot;code-quote&quot;&gt;&quot;trace&quot;&lt;/span&gt;&amp;gt;
	&amp;lt;Appenders&amp;gt;
		&amp;lt;Console name=&lt;span class=&quot;code-quote&quot;&gt;&quot;Console&quot;&lt;/span&gt; target=&lt;span class=&quot;code-quote&quot;&gt;&quot;SYSTEM_OUT&quot;&lt;/span&gt;&amp;gt;
			&amp;lt;PatternLayout pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;%d{HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg%n&quot;&lt;/span&gt; /&amp;gt;
		&amp;lt;/Console&amp;gt;
		&amp;lt;Socket name=&lt;span class=&quot;code-quote&quot;&gt;&quot;Socket&quot;&lt;/span&gt; host=&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt; port=&lt;span class=&quot;code-quote&quot;&gt;&quot;666&quot;&lt;/span&gt; immediateFail=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt; immediateFlush=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; reconnectionDelayMillis=&lt;span class=&quot;code-quote&quot;&gt;&quot;5000&quot;&lt;/span&gt;&amp;gt;
			&amp;lt;SerializedLayout /&amp;gt;
 		&amp;lt;/Socket&amp;gt;
	&amp;lt;/Appenders&amp;gt;
	&amp;lt;Loggers&amp;gt;
		&amp;lt;Root level=&lt;span class=&quot;code-quote&quot;&gt;&quot;debug&quot;&lt;/span&gt; includeLocation=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;&amp;gt;
			&amp;lt;AppenderRef ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;Console&quot;&lt;/span&gt; /&amp;gt;
		&amp;lt;/Root&amp;gt;
		&amp;lt;AsyncRoot level=&lt;span class=&quot;code-quote&quot;&gt;&quot;debug&quot;&lt;/span&gt; includeLocation=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;&amp;gt;
      		&amp;lt;AppenderRef ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;Socket&quot;&lt;/span&gt;/&amp;gt;
	    &amp;lt;/AsyncRoot&amp;gt;	
	&amp;lt;/Loggers&amp;gt;
&amp;lt;/Configuration&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That configuration only leads to logging to the socket appender, and nothing to the console. &lt;/p&gt;

&lt;p&gt;Changing the order of the root elements to:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;	&amp;lt;Loggers&amp;gt;
		&amp;lt;AsyncRoot level=&lt;span class=&quot;code-quote&quot;&gt;&quot;debug&quot;&lt;/span&gt; includeLocation=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;&amp;gt;
      		&amp;lt;AppenderRef ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;Socket&quot;&lt;/span&gt;/&amp;gt;
	    &amp;lt;/AsyncRoot&amp;gt;	
		&amp;lt;Root level=&lt;span class=&quot;code-quote&quot;&gt;&quot;debug&quot;&lt;/span&gt; includeLocation=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;&amp;gt;
			&amp;lt;AppenderRef ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;Console&quot;&lt;/span&gt; /&amp;gt;
		&amp;lt;/Root&amp;gt;
	&amp;lt;/Loggers&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Gives console logging, but no logging to the socket.&lt;/p&gt;

&lt;p&gt;Changing the config to:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;	&amp;lt;Loggers&amp;gt;
		&amp;lt;AsyncRoot level=&lt;span class=&quot;code-quote&quot;&gt;&quot;debug&quot;&lt;/span&gt; includeLocation=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;&amp;gt;
      		&amp;lt;AppenderRef ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;Socket&quot;&lt;/span&gt;/&amp;gt;
	    &amp;lt;/AsyncRoot&amp;gt;	
		&amp;lt;Logger name=&lt;span class=&quot;code-quote&quot;&gt;&quot;com&quot;&lt;/span&gt; level=&lt;span class=&quot;code-quote&quot;&gt;&quot;debug&quot;&lt;/span&gt; includeLocation=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;&amp;gt;
			&amp;lt;AppenderRef ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;Console&quot;&lt;/span&gt; /&amp;gt;
		&amp;lt;/Logger&amp;gt;
	&amp;lt;/Loggers&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Gives both console and socket logging, for &quot;com&quot; and descendants, but code that is logging to another domain than com does not end up in the console. &lt;br/&gt;
I also tried to leave the name empty in the test above, but that doesn&apos;t work.&lt;/p&gt;

&lt;p&gt;What&apos;s the problem? The documentation, or my understanding of it, or the implementation? &lt;/p&gt;

&lt;p&gt;I would really like to have both asynchronous and synchronous root in the same configuration.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12760735">LOG4J2-918</key>
            <summary>Combining Root and AsyncRoot in Xml configuration</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rpopma">Remko Popma</assignee>
                                    <reporter username="kajbj">Kaj Bjurman</reporter>
                        <labels>
                    </labels>
                <created>Wed, 10 Dec 2014 13:42:08 +0000</created>
                <updated>Sun, 5 Jul 2015 05:03:32 +0000</updated>
                            <resolved>Sun, 5 Jul 2015 05:03:32 +0000</resolved>
                                    <version>2.1</version>
                                    <fixVersion>2.4</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14241257" author="remkop@yahoo.com" created="Wed, 10 Dec 2014 15:42:35 +0000"  >&lt;p&gt;By design, you can only have one root. You can choose either async or sync, but you cannot have both in your configuration. However, within a single root logger you can have multiple appender-refs:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;Loggers&amp;gt;
  &amp;lt;AsyncRoot level=&lt;span class=&quot;code-quote&quot;&gt;&quot;debug&quot;&lt;/span&gt; includeLocation=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;&amp;gt;
    &amp;lt;AppenderRef ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;Socket&quot;&lt;/span&gt;/&amp;gt;
    &amp;lt;AppenderRef ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;Console&quot;&lt;/span&gt; /&amp;gt;
  &amp;lt;/AsyncRoot&amp;gt;	
&amp;lt;/Loggers&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Would that work for you?&lt;br/&gt;
The alternative is to have a root logger and one or more named loggers, but as you noted, a named logger configuration only logs events sent by a logger in the specified name space.&lt;/p&gt;</comment>
                            <comment id="14241386" author="kajbj" created="Wed, 10 Dec 2014 17:03:45 +0000"  >&lt;p&gt;The configuration in this issue, was a simplified one. We have a distributed system where each process should log to local files synchronously, and also have other appenders e.g syslog etc. The only appender/logging that we want to have asynchronous is the logging to a remote log server, since having one combined log file for all processes is more of &quot;a nice feature to have&quot;.&lt;/p&gt;

&lt;p&gt;Is it possible to make an appender async? &lt;/p&gt;
</comment>
                            <comment id="14241873" author="remkop@yahoo.com" created="Wed, 10 Dec 2014 22:37:21 +0000"  >&lt;p&gt;Yes, you can wrap any appender in an AsyncAppender. Sounds like that should give you what you have in mind. &lt;/p&gt;

&lt;p&gt;The manual page has example configs:&lt;br/&gt;
&lt;a href=&quot;http://logging.apache.org/log4j/log4j-2.1/manual/appenders.html#AsyncAppender&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://logging.apache.org/log4j/log4j-2.1/manual/appenders.html#AsyncAppender&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14242214" author="kajbj" created="Thu, 11 Dec 2014 06:34:00 +0000"  >&lt;p&gt;Ok. I will use the AsyncAppender, or create a custom AsyncAppender. I would rather have a circular buffer than a queue so that older events are thrown away instead of the new ones when we get a &quot;burst loss&quot;. &lt;/p&gt;

&lt;p&gt;You can if you want to close this issue, but it would be nice if the documentation got updated. The html documentation also says:&lt;br/&gt;
&lt;a href=&quot;http://logging.apache.org/log4j/2.0/manual/async.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://logging.apache.org/log4j/2.0/manual/async.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&quot;Synchronous and asynchronous loggers can be combined in configuration. This gives you more flexibility at the cost of a slight loss in performance (compared to making all loggers asynchronous). Use the &amp;lt;asyncRoot&amp;gt; or &amp;lt;asyncLogger&amp;gt; configuration elements to specify the loggers that need to be asynchronous. The same configuration file can also contain &amp;lt;root&amp;gt; and &amp;lt;logger&amp;gt; elements for the synchronous loggers.&quot;&lt;/p&gt;

&lt;p&gt;I&apos;m not native in English, but I guess I&apos;m not the only one who is reading that as: &lt;br/&gt;
Use the &amp;lt;asyncRoot&amp;gt; ... to specify the loggers that need to be asynchronous. The same configuration file can also contain &amp;lt;root&amp;gt; ...  for the synchronous loggers.&lt;/p&gt;

&lt;p&gt;It would be better if it clearly stated that the file can&apos;t have two roots. &lt;/p&gt;</comment>
                            <comment id="14243560" author="remkop@yahoo.com" created="Fri, 12 Dec 2014 01:34:25 +0000"  >&lt;p&gt;Thanks for pointing this out. I&apos;ll update the docs when I have a chance. &lt;/p&gt;</comment>
                            <comment id="14614133" author="remkop@yahoo.com" created="Sun, 5 Jul 2015 05:03:32 +0000"  >&lt;p&gt;Clarified docs. Committed to Git in 8d4dc1f28c062d968b2fc6b4432cb6d5d3d4f490. Please verify and close.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 20 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i239yn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>