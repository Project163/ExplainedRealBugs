<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:36:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-1318] LoggerContext#getLogger causes heavy GC overhead</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-1318</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;With the changes from &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1180&quot; title=&quot;Logger cache does not account for message factory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1180&quot;&gt;&lt;del&gt;LOG4J2-1180&lt;/del&gt;&lt;/a&gt;, when running performance testing scenarios, we are experiencing some throughput degradations due to an increase in the GC stall time.&lt;/p&gt;

&lt;p&gt;With the changes from &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1180&quot; title=&quot;Logger cache does not account for message factory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1180&quot;&gt;&lt;del&gt;LOG4J2-1180&lt;/del&gt;&lt;/a&gt;, the GC stall went from ~6% to ~11%, having an impact on the application of a reduction of ~32% of the operations throughput. The memory allocation rate both before and after the change is 4GB/s and 12GB/s respectively.&lt;/p&gt;

&lt;p&gt;In both cases, the relevant jvm configuration params were:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;-XX:+PrintGCApplicationStoppedTime -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintTenuringDistribution -XX:ErrorFile=%MHOME%/logs/err.log -Xloggc:%HOME%/logs/gc.log -XX:+HeapDumpOnOutOfMemoryError -XX:+AlwaysPreTouch -Xms2048m -XX:PermSize=256m -XX:MaxPermSize=256m -XX:+UseParNewGC -XX:NewSize=1024m -XX:+UseNUMA
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12950991">LOG4J2-1318</key>
            <summary>LoggerContext#getLogger causes heavy GC overhead</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rpopma">Remko Popma</assignee>
                                    <reporter username="elrodro83">Rodrigo Merino</reporter>
                        <labels>
                            <label>performance</label>
                    </labels>
                <created>Wed, 16 Mar 2016 20:49:13 +0000</created>
                <updated>Mon, 28 Mar 2016 20:55:26 +0000</updated>
                            <resolved>Mon, 28 Mar 2016 00:09:36 +0000</resolved>
                                    <version>2.5</version>
                                    <fixVersion>2.6</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15198229" author="garydgregory" created="Wed, 16 Mar 2016 21:36:00 +0000"  >&lt;p&gt;What the measurement for? 2.5 vs. 2.4.1? Or 2.4.1 + a patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1180&quot; title=&quot;Logger cache does not account for message factory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1180&quot;&gt;&lt;del&gt;LOG4J2-1180&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="15198307" author="remkop@yahoo.com" created="Wed, 16 Mar 2016 22:21:50 +0000"  >&lt;p&gt;GC-free steady state logging is a big theme of the upcoming 2.6 release. You can track its progress in the &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1270&quot; title=&quot;Garbage-free steady-state logging&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1270&quot;&gt;LOG4J2-1270&lt;/a&gt; epic and associated tickets. Feedback welcome!&lt;/p&gt;

&lt;p&gt;However the &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1270&quot; title=&quot;Garbage-free steady-state logging&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1270&quot;&gt;LOG4J2-1270&lt;/a&gt; work focusses on steady state logging, while it sounds like you experience issues during initialization. I don&apos;t know exactly what changes were made for &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1180&quot; title=&quot;Logger cache does not account for message factory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1180&quot;&gt;&lt;del&gt;LOG4J2-1180&lt;/del&gt;&lt;/a&gt;. Where are the temporary objects being created?&lt;/p&gt;</comment>
                            <comment id="15198474" author="remkop@yahoo.com" created="Thu, 17 Mar 2016 00:23:29 +0000"  >&lt;p&gt;I see now: each call to LoggerContext.getLogger() creates a String key to look up the logger. I guess our expectation was that Logger instances would be cached in fields so this lookup would not happen very often, while your usage is to look up the logger frequently.&lt;/p&gt;

&lt;p&gt;We can change the implementation to use a nested map, so composite keys are no longer needed.&lt;br/&gt;
Something like &lt;tt&gt;Map&amp;lt;Class&amp;lt;? extends MessageFactory&amp;gt;, Map&amp;lt;String, Logger&amp;gt;&lt;/tt&gt;. Getting things out and putting things in can be a bit fiddly, so perhaps we should wrap that logic in a custom &lt;tt&gt;LoggerCache&lt;/tt&gt; container class, so it can be reused by the various LoggerContext implementations.&lt;/p&gt;</comment>
                            <comment id="15199460" author="elrodro83" created="Thu, 17 Mar 2016 13:00:35 +0000"  >&lt;p&gt;The measurements were done fir 2.5 vs 2.5 without the changes from &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1180&quot; title=&quot;Logger cache does not account for message factory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1180&quot;&gt;&lt;del&gt;LOG4J2-1180&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15199465" author="elrodro83" created="Thu, 17 Mar 2016 13:02:36 +0000"  >&lt;p&gt;I think that avoiding the composite key creation would do the trick. As long as the composite maps you mentioned are optimized for reading, there should be no heavy impact.&lt;/p&gt;</comment>
                            <comment id="15199491" author="mikaelstaldal" created="Thu, 17 Mar 2016 13:14:46 +0000"  >&lt;p&gt;Can we use just the logger name as key if &lt;tt&gt;MessageFactory&lt;/tt&gt; is &lt;tt&gt;null&lt;/tt&gt;?&lt;/p&gt;</comment>
                            <comment id="15213443" author="remkop@yahoo.com" created="Sun, 27 Mar 2016 12:28:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garydgregory&quot; class=&quot;user-hover&quot; rel=&quot;garydgregory&quot;&gt;garydgregory&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ralph.goers%40dslextreme.com&quot; class=&quot;user-hover&quot; rel=&quot;ralph.goers@dslextreme.com&quot;&gt;ralph.goers@dslextreme.com&lt;/a&gt; can you take a look at SLF4JLoggerContext? It looks like the &lt;tt&gt;getLogger(String, MessageFactory)&lt;/tt&gt; method currently ignores the MessageFactory, and when I try to fix that in the spirit of &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1180&quot; title=&quot;Logger cache does not account for message factory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1180&quot;&gt;&lt;del&gt;LOG4J2-1180&lt;/del&gt;&lt;/a&gt;, the test in log4j-to-slf4j org.a.l.slf4j.LoggerTest breaks...  (getLogger_String_MessageFactoryMismatchNull and getLogger_String_MessageFactoryMismatch)&lt;/p&gt;

&lt;p&gt;Is there something special about SLF4J Loggers that they must be unique by name only, not by name/MessageFactory? Or are the current implementation and the test simply wrong - &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1180&quot; title=&quot;Logger cache does not account for message factory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1180&quot;&gt;&lt;del&gt;LOG4J2-1180&lt;/del&gt;&lt;/a&gt; was not addressed correctly here?&lt;/p&gt;</comment>
                            <comment id="15213472" author="remkop@yahoo.com" created="Sun, 27 Mar 2016 13:48:34 +0000"  >&lt;p&gt;Looking further, SLF4JLoggerContext is implemented a bit differently from the other LoggerContext implementations (SimpleLoggerContext, log4j-core LoggerContext and Log4jTaglibLoggerContext): the others all check if the previously registered logger matches the MessageFactory by calling  &lt;tt&gt;AbstractLogger.checkMessageFactory(logger, messageFactory)&lt;/tt&gt;, but SLF4JLoggerContext does not.&lt;/p&gt;

&lt;p&gt;Same question: is this a bug or is SLF4JLoggerContext special for some reason and is this difference by design?&lt;/p&gt;</comment>
                            <comment id="15213482" author="remkop@yahoo.com" created="Sun, 27 Mar 2016 14:37:47 +0000"  >&lt;p&gt;Fixed in master: I&apos;ve refactored the LoggerContext to use a different data structure that does not need temporary objects to be created during common operations. &lt;/p&gt;

&lt;p&gt;I did not make functional changes: the above question regarding SLF4JLoggerContext still remains, so I&apos;m leaving this ticket open.&lt;/p&gt;</comment>
                            <comment id="15213680" author="remkop@yahoo.com" created="Mon, 28 Mar 2016 00:09:36 +0000"  >&lt;p&gt;Resolving this issue. I reopened &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1180&quot; title=&quot;Logger cache does not account for message factory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1180&quot;&gt;&lt;del&gt;LOG4J2-1180&lt;/del&gt;&lt;/a&gt; with the above questions. &lt;/p&gt;

&lt;p&gt;Please verify the changes fix the reported GC problem and close. &lt;/p&gt;</comment>
                            <comment id="15214874" author="elrodro83" created="Mon, 28 Mar 2016 20:55:26 +0000"  >&lt;p&gt;The GC issue is fixed with this change. Closing.&lt;/p&gt;

&lt;p&gt;Thanks very much!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311120" key="com.pyxis.greenhopper.jira:gh-epic-link">
                        <customfieldname>Epic Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>LOG4J2-1270</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 34 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ushj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>