<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:41:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-2677] DeleteAction race results in failure to delete rolled files</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-2677</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;Uncovered this due to the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2658&quot; title=&quot;Exceptions during compacting in the context of RollingFileAppender are not logged&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2658&quot;&gt;&lt;del&gt;LOG4J2-2658&lt;/del&gt;&lt;/a&gt;, these failures were encountered but not logged previously.&lt;/p&gt;

&lt;p&gt;AbstractPathAction.execute uses Files.walkFileTree, which can fail if any file in the tree is deleted, regardless of whether or not it&apos;s related to files we&apos;re deleting. The walkFileTree API doesn&apos;t provide any way to continue in this case.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2019-08-19 16:47:10,819 Log4j2-TF-12-RollingFileManager-698 WARN Exception reported by action &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.logging.log4j.core.appender.rolling.RollingFileManager$AsyncAction&apos;&lt;/span&gt; java.nio.file.NoSuchFileException: &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/log/event.log
 at sun.nio.fs.UnixException.translateToIOException(UnixException.java:86)
 at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:102)
 at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:107)
 at sun.nio.fs.UnixFileAttributeViews$Basic.readAttributes(UnixFileAttributeViews.java:55)
 at sun.nio.fs.UnixFileSystemProvider.readAttributes(UnixFileSystemProvider.java:144)
 at sun.nio.fs.LinuxFileSystemProvider.readAttributes(LinuxFileSystemProvider.java:99)
 at java.nio.file.Files.readAttributes(Files.java:1737)
 at java.nio.file.FileTreeWalker.getAttributes(FileTreeWalker.java:219)
 at java.nio.file.FileTreeWalker.visit(FileTreeWalker.java:276)
 at java.nio.file.FileTreeWalker.next(FileTreeWalker.java:372)
 at java.nio.file.Files.walkFileTree(Files.java:2706)
 at org.apache.logging.log4j.core.appender.rolling.action.AbstractPathAction.execute(AbstractPathAction.java:76)
 at org.apache.logging.log4j.core.appender.rolling.action.DeleteAction.getSortedPaths(DeleteAction.java:162)
 at org.apache.logging.log4j.core.appender.rolling.action.DeleteAction.execute(DeleteAction.java:132)
 at org.apache.logging.log4j.core.appender.rolling.action.AbstractPathAction.execute(AbstractPathAction.java:69)
 at org.apache.logging.log4j.core.appender.rolling.action.DeleteAction.execute(DeleteAction.java:82)
 at org.apache.logging.log4j.core.appender.rolling.action.CompositeAction.execute(CompositeAction.java:74)
 at org.apache.logging.log4j.core.appender.rolling.RollingFileManager$AsyncAction.execute(RollingFileManager.java:482)
 at org.apache.logging.log4j.core.appender.rolling.action.AbstractAction.run(AbstractAction.java:66)
 at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
 at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
 at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13251709">LOG4J2-2677</key>
            <summary>DeleteAction race results in failure to delete rolled files</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ckozak">Carter Kozak</assignee>
                                    <reporter username="ckozak">Carter Kozak</reporter>
                        <labels>
                    </labels>
                <created>Mon, 19 Aug 2019 21:50:41 +0000</created>
                <updated>Tue, 24 Dec 2019 03:04:33 +0000</updated>
                            <resolved>Mon, 23 Dec 2019 23:13:44 +0000</resolved>
                                    <version>2.12.1</version>
                                    <fixVersion>2.13.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="17000906" author="anthon" created="Fri, 20 Dec 2019 14:15:13 +0000"  >&lt;p&gt;Hello All,&lt;/p&gt;

&lt;p&gt;I observe the same issue when two processes delete files from logs directory. I guess &lt;em&gt;Files.walkFileTree&lt;/em&gt; is fine but &lt;em&gt;SimpleFileVisitor&lt;/em&gt; re-throws IOException in any failures. I found org.apache.logging.log4j.core.appender.rolling.action.&lt;b&gt;DeleteAction&lt;/b&gt; uses two classes&#160;&lt;b&gt;SortingVisitor&lt;/b&gt; and&#160;&lt;b&gt;DeletingVisitor&lt;/b&gt; based on&#160;&lt;em&gt;SimpleFileVisitor&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
/**
 * Invoked &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; a file that could not be visited.
 *
 * &amp;lt;p&amp;gt; Unless overridden, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; method re-&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; the I/O exception that prevented
 * the file from being visited.
 */
@Override
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; FileVisitResult visitFileFailed(T file, IOException exc)
 &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException
{
 Objects.requireNonNull(file);
 &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; exc;
}

&#160;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;If Log4j2 could define a setting to configure these two visitors, it will fix the issue. I am not sure how to fix it correctly I mean something like below&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Override
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; FileVisitResult visitFileFailed(Path file, IOException exc) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
   &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; FileVisitResult.CONTINUE;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17000955" author="ckozak" created="Fri, 20 Dec 2019 15:10:01 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Anthon&quot; class=&quot;user-hover&quot; rel=&quot;Anthon&quot;&gt;Anthon&lt;/a&gt;, I&apos;ll take a look over the holiday!&lt;/p&gt;</comment>
                            <comment id="17000965" author="ckozak" created="Fri, 20 Dec 2019 15:30:28 +0000"  >&lt;p&gt;I took a quick look, this will be difficult to test in a meaningful way.&lt;/p&gt;

&lt;p&gt;I think we should probably continue to fail in most cases, but continue when we receive a NoSuchFileException.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/logging-log4j2/pull/322&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/logging-log4j2/pull/322&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17002535" author="jira-bot" created="Mon, 23 Dec 2019 23:12:43 +0000"  >&lt;p&gt;Commit 8d42a1a64ac79eca0644e660f1cbca39b1cc7320 in logging-log4j2&apos;s branch refs/heads/release-2.x from Carter Kozak&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=8d42a1a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=8d42a1a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2677&quot; title=&quot;DeleteAction race results in failure to delete rolled files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2677&quot;&gt;&lt;del&gt;LOG4J2-2677&lt;/del&gt;&lt;/a&gt;: Rollover and Deletion handle file deletions gracefully&lt;/p&gt;

&lt;p&gt;It&apos;s common for multiple appenders to write (and roll) log files&lt;br/&gt;
into a single directory. When these appenders are also responsible&lt;br/&gt;
for cleaning up after themselves, they must also search that&lt;br/&gt;
directory for files to delete. These searches are executed in&lt;br/&gt;
parallel by multiple appenders and have a chance to delete files&lt;br/&gt;
the other is checking before the file can be checked against&lt;br/&gt;
a regex or glob.&lt;br/&gt;
Missing files can safely be assumed to have been deleted.&lt;/p&gt;</comment>
                            <comment id="17002536" author="jira-bot" created="Mon, 23 Dec 2019 23:13:14 +0000"  >&lt;p&gt;Commit 9b77a9f8e533daf55b59e0374ae53c0e61ef77e9 in logging-log4j2&apos;s branch refs/heads/master from Carter Kozak&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=9b77a9f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=9b77a9f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2677&quot; title=&quot;DeleteAction race results in failure to delete rolled files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2677&quot;&gt;&lt;del&gt;LOG4J2-2677&lt;/del&gt;&lt;/a&gt;: Rollover and Deletion handle file deletions gracefully&lt;/p&gt;

&lt;p&gt;It&apos;s common for multiple appenders to write (and roll) log files&lt;br/&gt;
into a single directory. When these appenders are also responsible&lt;br/&gt;
for cleaning up after themselves, they must also search that&lt;br/&gt;
directory for files to delete. These searches are executed in&lt;br/&gt;
parallel by multiple appenders and have a chance to delete files&lt;br/&gt;
the other is checking before the file can be checked against&lt;br/&gt;
a regex or glob.&lt;br/&gt;
Missing files can safely be assumed to have been deleted.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 47 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z05tcw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>