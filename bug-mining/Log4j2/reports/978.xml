<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:37:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-1474] CronTriggeringPolicy raise exception and fail to rollover log file when evaluateOnStartup is true.</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-1474</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;I am migrating my project from log1.x to log2.x, and I was using DailyRollingFileAppender before, and now I am trying to use RollingFileAppender instead it.&lt;/p&gt;

&lt;p&gt;what i am doing is:&lt;br/&gt;
1. write a config file, with RollingFile&apos;s config, and use CronTriggeringPolicy config log file to roll over at middle-night.&lt;br/&gt;
2. also set it&apos;s CronTriggeringPolicy&apos;s evaluateOnStartup=true, require check roll over at start time.&lt;br/&gt;
3. I touch my log file to an older time, check it is working alright. &lt;br/&gt;
my touch command is: &lt;br/&gt;
&lt;tt&gt;touch -t 1607220101 biz-pubsvc-service.log&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;then i start my project, then I got an InvocationTargetException exception...........&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt; I then trace into the log4j2&apos;s source file, find the exception is caused by CronTriggeringPolicy&apos;s initialize method:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void initialize(RollingFileManager aManager) {
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.manager = aManager;
        Date nextDate = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Date(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.manager.getFileTime());
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.nextRollDate = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.cronExpression.getNextValidTimeAfter(nextDate);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.checkOnStartup &amp;amp;&amp;amp; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.nextRollDate.getTime() &amp;lt; &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis()) {
            &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.rollover(); &amp;gt;&amp;gt;&amp;gt; here, call rollover, need &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.&lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt;
        }

        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.&lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.configuration.getScheduler().scheduleWithCron(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.cronExpression, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CronTriggeringPolicy.CronTrigger());  &amp;gt;&amp;gt;&amp;gt; here assign &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.&lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; first time
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;we also refer CronTriggeringPolicy&apos;s rollover method&apos;s code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void rollover() {
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.manager.getPatternProcessor().setPrevFileTime(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.nextRollDate.getTime());
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.manager.rollover();
        Date fireDate = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.&lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt;.getFireTime(); &amp;gt;&amp;gt;&amp;gt; raise &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; pointer exception here !!! 
        Calendar cal = Calendar.getInstance();
        cal.setTime(fireDate);
        cal.add(13, -1);
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.nextRollDate = cal.getTime();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;  I think this BUG is easy to fix up by moving [ this.future = ...] &apos;s assignment just before the call of [ this.rollover(); ].&lt;/p&gt;

&lt;p&gt;thanks.&lt;/p&gt;

&lt;p&gt;Yin Mingjun&lt;/p&gt;

&lt;p&gt;PS1: my log4j2.xml config file -------------------------------------------------------&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.0&quot;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;?&amp;gt;
&amp;lt;configuration status=&lt;span class=&quot;code-quote&quot;&gt;&quot;warn&quot;&lt;/span&gt;&amp;gt;
  &amp;lt;appenders&amp;gt;
    &amp;lt;RollingFile name=&lt;span class=&quot;code-quote&quot;&gt;&quot;myFile&quot;&lt;/span&gt; fileName=&lt;span class=&quot;code-quote&quot;&gt;&quot;biz-pubsvc-service.log&quot;&lt;/span&gt; filePattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;biz-pubsvc-service.log.%d{yyyy-MM-dd}&quot;&lt;/span&gt; append=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;PatternLayout pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;[%d{yyyy-MM-dd HH:mm:ss,SSS}] %-5p [%t] %c{2} - %m%n&quot;&lt;/span&gt;/&amp;gt;
      &amp;lt;CronTriggeringPolicy schedule=&lt;span class=&quot;code-quote&quot;&gt;&quot;0 0 0 * * ?&quot;&lt;/span&gt; evaluateOnStartup=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;/&amp;gt;
    &amp;lt;/RollingFile&amp;gt;

    &amp;lt;Console name=&lt;span class=&quot;code-quote&quot;&gt;&quot;myConsole&quot;&lt;/span&gt; target=&lt;span class=&quot;code-quote&quot;&gt;&quot;SYSTEM_OUT&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;PatternLayout pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;[%d{yyyy-MM-dd HH:mm:ss,SSS}] %-5p [%t] %c{2} - %m%n&quot;&lt;/span&gt;/&amp;gt;
    &amp;lt;/Console&amp;gt;

  &amp;lt;/appenders&amp;gt;
  &amp;lt;loggers&amp;gt;
    &amp;lt;root level=&lt;span class=&quot;code-quote&quot;&gt;&quot;trace&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;appender-ref ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;myConsole&quot;&lt;/span&gt;/&amp;gt;
      &amp;lt;appender-ref ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;myFile&quot;&lt;/span&gt;/&amp;gt;
    &amp;lt;/root&amp;gt;
  &amp;lt;/loggers&amp;gt;
&amp;lt;/configuration&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;PS2: the raising exception&apos;s call stack ----------------------------------------&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2016-07-25 18:30:25,910 main ERROR Unable to invoke factory method in &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.logging.log4j.core.appender.RollingFileAppender &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; element RollingFile. java.lang.reflect.InvocationTargetException
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.apache.logging.log4j.core.config.plugins.util.PluginBuilder.build(PluginBuilder.java:132)
	at org.apache.logging.log4j.core.config.AbstractConfiguration.createPluginObject(AbstractConfiguration.java:918)
	at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:858)
	at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:850)
	at org.apache.logging.log4j.core.config.AbstractConfiguration.doConfigure(AbstractConfiguration.java:479)
	at org.apache.logging.log4j.core.config.AbstractConfiguration.initialize(AbstractConfiguration.java:219)
	at org.apache.logging.log4j.core.config.AbstractConfiguration.start(AbstractConfiguration.java:231)
	at org.apache.logging.log4j.core.LoggerContext.setConfiguration(LoggerContext.java:496)
	at org.apache.logging.log4j.core.LoggerContext.reconfigure(LoggerContext.java:566)
	at org.apache.logging.log4j.core.LoggerContext.reconfigure(LoggerContext.java:582)
	at org.apache.logging.log4j.core.LoggerContext.start(LoggerContext.java:217)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</description>
                <environment>&lt;p&gt;mac osx capiton/jvm 1.7/log4j-core 2.6.2&lt;/p&gt;</environment>
        <key id="12992228">LOG4J2-1474</key>
            <summary>CronTriggeringPolicy raise exception and fail to rollover log file when evaluateOnStartup is true.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ggregory">Gary D. Gregory</assignee>
                                    <reporter username="yinmingjuncn">yin mingjun</reporter>
                        <labels>
                    </labels>
                <created>Mon, 25 Jul 2016 10:57:00 +0000</created>
                <updated>Wed, 4 Jan 2017 06:48:46 +0000</updated>
                            <resolved>Wed, 7 Dec 2016 03:10:54 +0000</resolved>
                                    <version>2.6.2</version>
                                    <fixVersion>2.8</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15391925" author="remkop@yahoo.com" created="Mon, 25 Jul 2016 13:55:02 +0000"  >&lt;p&gt;Is that the complete stack trace?&lt;br/&gt;
Usually an InvocationTargetException has a &quot;Caused By (some other exception)&quot; with the stack trace of the underlying cause exception. Can you add the cause exception? &lt;/p&gt;</comment>
                            <comment id="15392983" author="yinmingjuncn" created="Tue, 26 Jul 2016 01:24:11 +0000"  >&lt;p&gt;OK, it&apos;s here!&lt;br/&gt;
------------------------------------- break line&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2016-07-25 18:30:25,910 main ERROR Unable to invoke factory method in &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.logging.log4j.core.appender.RollingFileAppender &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; element RollingFile. java.lang.reflect.InvocationTargetException
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.apache.logging.log4j.core.config.plugins.util.PluginBuilder.build(PluginBuilder.java:132)
	at org.apache.logging.log4j.core.config.AbstractConfiguration.createPluginObject(AbstractConfiguration.java:918)
	at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:858)
	at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:850)
	at org.apache.logging.log4j.core.config.AbstractConfiguration.doConfigure(AbstractConfiguration.java:479)
	at org.apache.logging.log4j.core.config.AbstractConfiguration.initialize(AbstractConfiguration.java:219)
	at org.apache.logging.log4j.core.config.AbstractConfiguration.start(AbstractConfiguration.java:231)
	at org.apache.logging.log4j.core.LoggerContext.setConfiguration(LoggerContext.java:496)
	at org.apache.logging.log4j.core.LoggerContext.reconfigure(LoggerContext.java:566)
	at org.apache.logging.log4j.core.LoggerContext.reconfigure(LoggerContext.java:582)
	at org.apache.logging.log4j.core.LoggerContext.start(LoggerContext.java:217)
	at org.apache.logging.log4j.core.impl.Log4jContextFactory.getContext(Log4jContextFactory.java:152)
	at org.apache.logging.log4j.core.impl.Log4jContextFactory.getContext(Log4jContextFactory.java:45)
	at org.apache.logging.log4j.LogManager.getContext(LogManager.java:194)
	at org.apache.logging.log4j.spi.AbstractLoggerAdapter.getContext(AbstractLoggerAdapter.java:103)
	at org.apache.logging.slf4j.Log4jLoggerFactory.getContext(Log4jLoggerFactory.java:43)
	at org.apache.logging.log4j.spi.AbstractLoggerAdapter.getLogger(AbstractLoggerAdapter.java:42)
	at org.apache.logging.slf4j.Log4jLoggerFactory.getLogger(Log4jLoggerFactory.java:29)
	at org.slf4j.LoggerFactory.getLogger(LoggerFactory.java:253)
	at com.alibaba.dubbo.common.logger.slf4j.Slf4jLoggerAdapter.getLogger(Slf4jLoggerAdapter.java:12)
	at com.alibaba.dubbo.common.logger.LoggerFactory.setLoggerAdapter(LoggerFactory.java:86)
	at com.alibaba.dubbo.common.logger.LoggerFactory.&amp;lt;clinit&amp;gt;(LoggerFactory.java:60)
	at com.alibaba.dubbo.common.Version.&amp;lt;clinit&amp;gt;(Version.java:37)
	at com.alibaba.dubbo.config.spring.schema.DubboNamespaceHandler.&amp;lt;clinit&amp;gt;(DubboNamespaceHandler.java:41)
	at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:57)
	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.lang.reflect.Constructor.newInstance(Constructor.java:526)
	at org.springframework.beans.BeanUtils.instantiateClass(BeanUtils.java:148)
	at org.springframework.beans.BeanUtils.instantiateClass(BeanUtils.java:105)
	at org.springframework.beans.factory.xml.DefaultNamespaceHandlerResolver.resolve(DefaultNamespaceHandlerResolver.java:129)
	at org.springframework.beans.factory.xml.BeanDefinitionParserDelegate.parseCustomElement(BeanDefinitionParserDelegate.java:1433)
	at org.springframework.beans.factory.xml.BeanDefinitionParserDelegate.parseCustomElement(BeanDefinitionParserDelegate.java:1428)
	at org.springframework.beans.factory.xml.DefaultBeanDefinitionDocumentReader.parseBeanDefinitions(DefaultBeanDefinitionDocumentReader.java:195)
	at org.springframework.beans.factory.xml.DefaultBeanDefinitionDocumentReader.doRegisterBeanDefinitions(DefaultBeanDefinitionDocumentReader.java:139)
	at org.springframework.beans.factory.xml.DefaultBeanDefinitionDocumentReader.registerBeanDefinitions(DefaultBeanDefinitionDocumentReader.java:108)
	at org.springframework.beans.factory.xml.XmlBeanDefinitionReader.registerBeanDefinitions(XmlBeanDefinitionReader.java:493)
	at org.springframework.beans.factory.xml.XmlBeanDefinitionReader.doLoadBeanDefinitions(XmlBeanDefinitionReader.java:390)
	at org.springframework.beans.factory.xml.XmlBeanDefinitionReader.loadBeanDefinitions(XmlBeanDefinitionReader.java:334)
	at org.springframework.beans.factory.xml.XmlBeanDefinitionReader.loadBeanDefinitions(XmlBeanDefinitionReader.java:302)
	at org.springframework.beans.factory.support.AbstractBeanDefinitionReader.loadBeanDefinitions(AbstractBeanDefinitionReader.java:174)
	at org.springframework.beans.factory.support.AbstractBeanDefinitionReader.loadBeanDefinitions(AbstractBeanDefinitionReader.java:209)
	at org.springframework.beans.factory.xml.DefaultBeanDefinitionDocumentReader.importBeanDefinitionResource(DefaultBeanDefinitionDocumentReader.java:250)
	at org.springframework.beans.factory.xml.DefaultBeanDefinitionDocumentReader.parseDefaultElement(DefaultBeanDefinitionDocumentReader.java:207)
	at org.springframework.beans.factory.xml.DefaultBeanDefinitionDocumentReader.parseBeanDefinitions(DefaultBeanDefinitionDocumentReader.java:192)
	at org.springframework.beans.factory.xml.DefaultBeanDefinitionDocumentReader.doRegisterBeanDefinitions(DefaultBeanDefinitionDocumentReader.java:139)
	at org.springframework.beans.factory.xml.DefaultBeanDefinitionDocumentReader.registerBeanDefinitions(DefaultBeanDefinitionDocumentReader.java:108)
	at org.springframework.beans.factory.xml.XmlBeanDefinitionReader.registerBeanDefinitions(XmlBeanDefinitionReader.java:493)
	at org.springframework.beans.factory.xml.XmlBeanDefinitionReader.doLoadBeanDefinitions(XmlBeanDefinitionReader.java:390)
	at org.springframework.beans.factory.xml.XmlBeanDefinitionReader.loadBeanDefinitions(XmlBeanDefinitionReader.java:334)
	at org.springframework.beans.factory.xml.XmlBeanDefinitionReader.loadBeanDefinitions(XmlBeanDefinitionReader.java:302)
	at org.springframework.beans.factory.support.AbstractBeanDefinitionReader.loadBeanDefinitions(AbstractBeanDefinitionReader.java:174)
	at org.springframework.beans.factory.support.AbstractBeanDefinitionReader.loadBeanDefinitions(AbstractBeanDefinitionReader.java:209)
	at org.springframework.beans.factory.support.AbstractBeanDefinitionReader.loadBeanDefinitions(AbstractBeanDefinitionReader.java:180)
	at org.springframework.beans.factory.support.AbstractBeanDefinitionReader.loadBeanDefinitions(AbstractBeanDefinitionReader.java:243)
	at org.springframework.test.context.support.AbstractGenericContextLoader.loadBeanDefinitions(AbstractGenericContextLoader.java:233)
	at org.springframework.test.context.support.AbstractGenericContextLoader.loadContext(AbstractGenericContextLoader.java:117)
	at org.springframework.test.context.support.AbstractGenericContextLoader.loadContext(AbstractGenericContextLoader.java:60)
	at org.springframework.test.context.support.AbstractDelegatingSmartContextLoader.delegateLoading(AbstractDelegatingSmartContextLoader.java:100)
	at org.springframework.test.context.support.AbstractDelegatingSmartContextLoader.loadContext(AbstractDelegatingSmartContextLoader.java:248)
	at org.springframework.test.context.CacheAwareContextLoaderDelegate.loadContextInternal(CacheAwareContextLoaderDelegate.java:64)
	at org.springframework.test.context.CacheAwareContextLoaderDelegate.loadContext(CacheAwareContextLoaderDelegate.java:91)
	at org.springframework.test.context.TestContext.getApplicationContext(TestContext.java:122)
	at org.springframework.test.context.support.DependencyInjectionTestExecutionListener.injectDependencies(DependencyInjectionTestExecutionListener.java:109)
	at org.springframework.test.context.support.DependencyInjectionTestExecutionListener.prepareTestInstance(DependencyInjectionTestExecutionListener.java:75)
	at org.springframework.test.context.TestContextManager.prepareTestInstance(TestContextManager.java:321)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.createTest(SpringJUnit4ClassRunner.java:211)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner$1.runReflectiveCall(SpringJUnit4ClassRunner.java:288)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.methodBlock(SpringJUnit4ClassRunner.java:284)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:231)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:88)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:231)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:60)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:229)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:50)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:222)
	at org.springframework.test.context.junit4.statements.RunBeforeTestClassCallbacks.evaluate(RunBeforeTestClassCallbacks.java:61)
	at org.springframework.test.context.junit4.statements.RunAfterTestClassCallbacks.evaluate(RunAfterTestClassCallbacks.java:71)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:300)
	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.run(SpringJUnit4ClassRunner.java:174)
	at org.junit.runner.JUnitCore.run(JUnitCore.java:157)
	at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:119)
	at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:42)
	at com.intellij.rt.execution.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:234)
	at com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:74)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at com.intellij.rt.execution.application.AppMain.main(AppMain.java:144)
Caused by: java.lang.NullPointerException
	at org.apache.logging.log4j.core.appender.rolling.CronTriggeringPolicy.rollover(CronTriggeringPolicy.java:128)
	at org.apache.logging.log4j.core.appender.rolling.CronTriggeringPolicy.initialize(CronTriggeringPolicy.java:69)
	at org.apache.logging.log4j.core.appender.rolling.RollingFileManager.initialize(RollingFileManager.java:82)
	at org.apache.logging.log4j.core.appender.RollingFileAppender.createAppender(RollingFileAppender.java:197)
	... 95 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15709103" author="neon" created="Wed, 30 Nov 2016 16:58:16 +0000"  >&lt;p&gt;I also see this issue using v2.6.2 the cause of the InvocationTargetException is a NullPointerException&lt;br/&gt;
 at CronTriggeringPolicy.rollover(CronTriggeringPolicy.java:128)&lt;br/&gt;
 at CronTriggeringPolicy.initialize(CronTriggeringPolicy.java:69)&lt;br/&gt;
 at CompositeTriggeringPolicy.initialize(CompositeTriggeringPolicy.java:49)&lt;/p&gt;

&lt;p&gt;Looking at source code, looks like the the if (checkOnStartup) block is executed before the future variable has been initialized, hence the NPE.&lt;/p&gt;</comment>
                            <comment id="15709275" author="garydgregory" created="Wed, 30 Nov 2016 17:59:37 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yinmingjuncn&quot; class=&quot;user-hover&quot; rel=&quot;yinmingjuncn&quot;&gt;yinmingjuncn&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=neon&quot; class=&quot;user-hover&quot; rel=&quot;neon&quot;&gt;neon&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;The fix might be easy but are you available to provide a unit test that demonstrate the problem to avoid regressions?&lt;/p&gt;

&lt;p&gt;Thank you,&lt;br/&gt;
Gary&lt;/p&gt;</comment>
                            <comment id="15711215" author="yinmingjuncn" created="Thu, 1 Dec 2016 07:48:03 +0000"  >&lt;p&gt;here is the unit test code when I test the feature of log4j2.&lt;br/&gt;
--------------------- break line:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testRollingFileManager() {
        TriggeringPolicy triggerPolicy = TimeBasedTriggeringPolicy.createPolicy(&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;);
        DefaultRolloverStrategy rolloverStrategy = DefaultRolloverStrategy.createStrategy(&lt;span class=&quot;code-quote&quot;&gt;&quot;7&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;max&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; NullConfiguration());
        RollingFileManager fileManager = RollingFileManager.getFileManager(&lt;span class=&quot;code-quote&quot;&gt;&quot;testcmd.log&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;testcmd.log.%d{yyyy-MM-dd}&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, triggerPolicy, rolloverStrategy, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, PatternLayout.createDefaultLayout(), 0, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);

        &lt;span class=&quot;code-comment&quot;&gt;//trigger rollover
&lt;/span&gt;        fileManager.rollover();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15727526" author="garydgregory" created="Wed, 7 Dec 2016 03:10:54 +0000"  >&lt;p&gt;In git master. All tests pass (added new tests as well). &lt;/p&gt;

&lt;p&gt;Log4j devs: Please code review.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yinmingjuncn&quot; class=&quot;user-hover&quot; rel=&quot;yinmingjuncn&quot;&gt;yinmingjuncn&lt;/a&gt;: Please verify and close.&lt;/p&gt;</comment>
                            <comment id="15728821" author="neon" created="Wed, 7 Dec 2016 13:52:27 +0000"  >&lt;p&gt;Same NPE in v2.7, can this fix be back-ported to 2.7.1?&lt;/p&gt;</comment>
                            <comment id="15728822" author="neon" created="Wed, 7 Dec 2016 13:52:27 +0000"  >&lt;p&gt;Same NPE in v2.7, can this fix be back-ported to 2.7.1?&lt;/p&gt;</comment>
                            <comment id="15729135" author="garydgregory" created="Wed, 7 Dec 2016 16:13:57 +0000"  >&lt;p&gt;We will end up releasing 2.7.1-SNAPSHOT as 2.8. We are not planning on a 2.7.1 release ATM. The next release will be 2.8 (even though the POMs in Git master currently say 2.7.1-SNAPSHOTs).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310060">
                    <name>Container</name>
                                                                <inwardlinks description="Is contained by">
                                        <issuelink>
            <issuekey id="13016106">LOG4J2-1653</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13016106">LOG4J2-1653</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 50 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i31g8v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>