<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:34:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-1069] Improper handling of JSON escape chars when deserializing JSON log events</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-1069</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;There is an error in the handling of JSON escape characters while determining the log event boundaries in a JSON stream.  This error is causing log events with JSON escaped characters in the message string to be skipped.  The existing tests do not appear to cover this case, and other serialization types are not affected.  Here is a test/fix patch: &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;diff --git a/log4j-core/src/main/java/org/apache/logging/log4j/core/net/server/JsonInputStreamLogEventBridge.java b/log4j-core/src/main/java/org/apache/logging/log4j/core/net/server/JsonInputStreamLogEventBridge.java
index 1b81644..8ed2732 100644
--- a/log4j-core/src/main/java/org/apache/logging/log4j/core/net/server/JsonInputStreamLogEventBridge.java
+++ b/log4j-core/src/main/java/org/apache/logging/log4j/core/net/server/JsonInputStreamLogEventBridge.java
@@ -55,8 +55,10 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;JsonInputStreamLogEventBridge &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; InputStreamLogEventBridge {
         &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; inEsc = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
         &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = start; i &amp;lt; charArray.length; i++) {
             &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;char&lt;/span&gt; c = charArray[i];
-            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!inEsc) {
-                inEsc = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
+            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (inEsc) {
+            	&lt;span class=&quot;code-comment&quot;&gt;// Skip &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;char&lt;/span&gt; and &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;
&lt;/span&gt;+            	inEsc = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
+            } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; { 
                 &lt;span class=&quot;code-keyword&quot;&gt;switch&lt;/span&gt; (c) {
                 &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; EVENT_START_MARKER:
                     &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!inStr) {
diff --git a/log4j-core/src/test/java/org/apache/logging/log4j/core/net/server/AbstractSocketServerTest.java b/log4j-core/src/test/java/org/apache/logging/log4j/core/net/server/AbstractSocketServerTest.java
index 891e278..2bdb3c3 100644
--- a/log4j-core/src/test/java/org/apache/logging/log4j/core/net/server/AbstractSocketServerTest.java
+++ b/log4j-core/src/test/java/org/apache/logging/log4j/core/net/server/AbstractSocketServerTest.java
@@ -69,7 +69,9 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;abstract&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;AbstractSocketServerTest {
     &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; MESSAGE = &lt;span class=&quot;code-quote&quot;&gt;&quot;This is test message&quot;&lt;/span&gt;;
 
     &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; MESSAGE_2 = &lt;span class=&quot;code-quote&quot;&gt;&quot;This is test message 2&quot;&lt;/span&gt;;
-
+    
+    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; MESSAGE_WITH_SPECIAL_CHARS = &lt;span class=&quot;code-quote&quot;&gt;&quot;{This}\n[is]\&quot;&lt;/span&gt;n\&lt;span class=&quot;code-quote&quot;&gt;&quot;a\&quot;&lt;/span&gt;\r\ntrue:\n\ttest,\nmessage&quot;;
+    
     &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; PORT_NUM = AvailablePortFinder.getNextAvailable();
 
     &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; PORT = &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.valueOf(PORT_NUM);
@@ -158,6 +160,13 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;abstract&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;AbstractSocketServerTest {
             testServer(m1, m2);
         }
     }
+    
+    
+    @Test
+    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testMessagesWithSpecialChars() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
+        testServer(MESSAGE_WITH_SPECIAL_CHARS);
+    }
+    
 
     &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void testServer(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; size) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
         &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] messages = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[size];
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The test provided is simplistic and does not attempt to cover all possible special characters as the bug has to do with escaped characters in general.  XML and java serialization handle the special chars in my test string without issue - I did not attempt to locate similar cases in the other serialization types.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12840541">LOG4J2-1069</key>
            <summary>Improper handling of JSON escape chars when deserializing JSON log events</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="braam">Sam Braam</reporter>
                        <labels>
                    </labels>
                <created>Thu, 25 Jun 2015 13:41:03 +0000</created>
                <updated>Thu, 16 Jul 2015 05:40:45 +0000</updated>
                            <resolved>Wed, 15 Jul 2015 20:09:03 +0000</resolved>
                                    <version>2.3</version>
                                    <fixVersion>2.4</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14627592" author="braam" created="Wed, 15 Jul 2015 06:16:43 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;BUMP&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;I&apos;d like to see this fixed in the 2.4 release so I can stop using my patched version.  Could somebody please take a look at my patch and merge it if applicable?  It&apos;s a pretty simple fix.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Sam&lt;/p&gt;</comment>
                            <comment id="14628642" author="garydgregory" created="Wed, 15 Jul 2015 20:09:03 +0000"  >&lt;p&gt;It looks to me like this is already in the git master. I&apos;ll resolve and you can then review and close.&lt;/p&gt;</comment>
                            <comment id="14629229" author="braam" created="Thu, 16 Jul 2015 05:40:45 +0000"  >&lt;p&gt;Verified as fixed&lt;/p&gt;

&lt;p&gt;Thanks, &lt;br/&gt;
Sam&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 18 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ghqf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>