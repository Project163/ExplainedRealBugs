<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:42:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-3491] High cpu, due to a change that cause to includeLocation by default for AsyncLogger</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-3491</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;&quot;include location&quot; is very expensive operation &#160;and has major impact on logging performance.&lt;br/&gt;
For Sync logger it is 1.3 - 5 times slower.&lt;br/&gt;
For AsyncLogger ( which most of use ) it is 30-100 times slower.&lt;br/&gt;
&lt;a href=&quot;https://www.google.com/url?q=https://logging.apache.org/log4j/2.x/manual/async.html%23Location&amp;amp;sa=D&amp;amp;source=buganizer&amp;amp;usg=AOvVaw3Xblc_t9SoycJEjv5YBMuy&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://logging.apache.org/log4j/2.x/manual/async.html#Location&lt;/a&gt;&lt;br/&gt;
--&amp;gt; For this reason, asynchronous loggers and asynchronous appenders do not include location information by default.&lt;/p&gt;

&lt;p&gt;A new change that was introduced in version 2.17.2, turn on includeLocation for AsyncLogger, although that default is supposed to be true.&lt;/p&gt;

&lt;p&gt;This happens when you define the async logger by using AsyncLogger, and not passing a selector, which is not required when explicit define the logger as AsyncLogger in the conf.&lt;/p&gt;


&lt;p&gt;Log4j is taking location by calling to StackStreamFactory:: fetchStackFrames (has been changed for log4j since jdk9). JDK 11 seems to have an issue with extensive usage of Stack walking with zgc:&lt;br/&gt;
&lt;a href=&quot;https://www.google.com/url?q=http://mail.openjdk.java.net/pipermail/zgc-dev/2019-March/000605.html&amp;amp;sa=D&amp;amp;source=buganizer&amp;amp;usg=AOvVaw0pnFKo1NWlG4I5cK64Mg1R&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://mail.openjdk.java.net/pipermail/zgc-dev/2019-March/000605.html&lt;/a&gt;&lt;br/&gt;
We are not using zge, but I think that also in the bug above they was not able to see it with G1, we experience similar issue with G1. After some time machine CPU can reach to 100%.&lt;/p&gt;

&lt;p&gt;With most threads spending time on calclocation:&lt;br/&gt;
&quot;CommandExecutor.GetCarpoolStatsRequest.20&quot; #2190 prio=5 os_prio=0 cpu=7522773.26ms elapsed=453703.28s tid=0x00007fab3c007000 nid=0x2a06 runnable &#160;&lt;span class=&quot;error&quot;&gt;&amp;#91;0x00007fa9e8ec9000&amp;#93;&lt;/span&gt;&lt;br/&gt;
&#160; &#160;java.lang.Thread.State: RUNNABLE&lt;br/&gt;
&#160; &#160; &#160; &#160; at java.lang.StackStreamFactory$AbstractStackWalker.fetchStackFrames(&lt;a href=&quot;https://www.google.com/url?q=http://java.base@11.0.14.1/Native&amp;amp;sa=D&amp;amp;source=buganizer&amp;amp;usg=AOvVaw0HydWGgDE1db8rBCDWGYN3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;java.base@11.0.14.1/Native&lt;/a&gt;&#160;Method)&lt;br/&gt;
&#160; &#160; &#160; &#160; at java.lang.StackStreamFactory$AbstractStackWalker.fetchStackFrames(&lt;a href=&quot;https://www.google.com/url?q=http://java.base@11.0.14.1/StackStreamFactory.java:386&amp;amp;sa=D&amp;amp;source=buganizer&amp;amp;usg=AOvVaw1u_cgyqloQ6LWVfG67KUwQ&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;java.base@11.0.14.1/StackStreamFactory.java:386&lt;/a&gt;)&lt;br/&gt;
&#160; &#160; &#160; &#160; at java.lang.StackStreamFactory$AbstractStackWalker.getNextBatch(&lt;a href=&quot;https://www.google.com/url?q=http://java.base@11.0.14.1/StackStreamFactory.java:322&amp;amp;sa=D&amp;amp;source=buganizer&amp;amp;usg=AOvVaw1HR1rPGZOS_z6BZ5VCxlLq&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;java.base@11.0.14.1/StackStreamFactory.java:322&lt;/a&gt;)&lt;br/&gt;
&#160; &#160; &#160; &#160; at java.lang.StackStreamFactory$AbstractStackWalker.peekFrame(&lt;a href=&quot;https://www.google.com/url?q=http://java.base@11.0.14.1/StackStreamFactory.java:263&amp;amp;sa=D&amp;amp;source=buganizer&amp;amp;usg=AOvVaw2VKV7dOJWNL5zFdUMmFHnL&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;java.base@11.0.14.1/StackStreamFactory.java:263&lt;/a&gt;)&lt;br/&gt;
&#160; &#160; &#160; &#160; at java.lang.StackStreamFactory$AbstractStackWalker.hasNext(&lt;a href=&quot;https://www.google.com/url?q=http://java.base@11.0.14.1/StackStreamFactory.java:351&amp;amp;sa=D&amp;amp;source=buganizer&amp;amp;usg=AOvVaw2EkcZgHDcrt33mHKq5vGt_&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;java.base@11.0.14.1/StackStreamFactory.java:351&lt;/a&gt;)&lt;br/&gt;
&#160; &#160; &#160; &#160; at java.lang.StackStreamFactory$StackFrameTraverser.tryAdvance(&lt;a href=&quot;https://www.google.com/url?q=http://java.base@11.0.14.1/StackStreamFactory.java:593&amp;amp;sa=D&amp;amp;source=buganizer&amp;amp;usg=AOvVaw2eVL54M84A0Kv3aZwnyLsY&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;java.base@11.0.14.1/StackStreamFactory.java:593&lt;/a&gt;)&lt;br/&gt;
&#160; &#160; &#160; &#160; at java.util.stream.ReferencePipeline.forEachWithCancel(&lt;a href=&quot;https://www.google.com/url?q=http://java.base@11.0.14.1/ReferencePipeline.java:127&amp;amp;sa=D&amp;amp;source=buganizer&amp;amp;usg=AOvVaw2Grt0cuvFH1J9VaIpx5so3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;java.base@11.0.14.1/ReferencePipeline.java:127&lt;/a&gt;)&lt;br/&gt;
&#160; &#160; &#160; &#160; at java.util.stream.AbstractPipeline.copyIntoWithCancel(&lt;a href=&quot;https://www.google.com/url?q=http://java.base@11.0.14.1/AbstractPipeline.java:502&amp;amp;sa=D&amp;amp;source=buganizer&amp;amp;usg=AOvVaw3mMsMQmY-yyv6nTiVk0D94&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;java.base@11.0.14.1/AbstractPipeline.java:502&lt;/a&gt;)&lt;br/&gt;
&#160; &#160; &#160; &#160; at java.util.stream.AbstractPipeline.copyInto(&lt;a href=&quot;https://www.google.com/url?q=http://java.base@11.0.14.1/AbstractPipeline.java:488&amp;amp;sa=D&amp;amp;source=buganizer&amp;amp;usg=AOvVaw1lEsyWH0G3dh8WRLP5AFmo&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;java.base@11.0.14.1/AbstractPipeline.java:488&lt;/a&gt;)&lt;br/&gt;
&#160; &#160; &#160; &#160; at java.util.stream.AbstractPipeline.wrapAndCopyInto(&lt;a href=&quot;https://www.google.com/url?q=http://java.base@11.0.14.1/AbstractPipeline.java:474&amp;amp;sa=D&amp;amp;source=buganizer&amp;amp;usg=AOvVaw1d-wZ9ic3nsusBeYlUnnna&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;java.base@11.0.14.1/AbstractPipeline.java:474&lt;/a&gt;)&lt;br/&gt;
&#160; &#160; &#160; &#160; at java.util.stream.FindOps$FindOp.evaluateSequential(&lt;a href=&quot;https://www.google.com/url?q=http://java.base@11.0.14.1/FindOps.java:150&amp;amp;sa=D&amp;amp;source=buganizer&amp;amp;usg=AOvVaw0IlT_70gWEukrAs58iS0d5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;java.base@11.0.14.1/FindOps.java:150&lt;/a&gt;)&lt;br/&gt;
&#160; &#160; &#160; &#160; at java.util.stream.AbstractPipeline.evaluate(&lt;a href=&quot;https://www.google.com/url?q=http://java.base@11.0.14.1/AbstractPipeline.java:234&amp;amp;sa=D&amp;amp;source=buganizer&amp;amp;usg=AOvVaw3BufQfOJm8JL6MA08GZWf1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;java.base@11.0.14.1/AbstractPipeline.java:234&lt;/a&gt;)&lt;br/&gt;
&#160; &#160; &#160; &#160; at java.util.stream.ReferencePipeline.findFirst(&lt;a href=&quot;https://www.google.com/url?q=http://java.base@11.0.14.1/ReferencePipeline.java:543&amp;amp;sa=D&amp;amp;source=buganizer&amp;amp;usg=AOvVaw3COTGYZ1jL-Q3tKefW899C&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;java.base@11.0.14.1/ReferencePipeline.java:543&lt;/a&gt;)&lt;br/&gt;
&#160; &#160; &#160; &#160; at org.apache.logging.log4j.util.StackLocator.lambda$calcLocation$15(StackLocator.java:100)&lt;br/&gt;
&#160; &#160; &#160; &#160; at org.apache.logging.log4j.util.StackLocator$$Lambda$127/0x00007fae153164b0.apply(Unknown Source)&lt;br/&gt;
&#160; &#160; &#160; &#160; at java.lang.StackStreamFactory$StackFrameTraverser.consumeFrames(&lt;a href=&quot;https://www.google.com/url?q=http://java.base@11.0.14.1/StackStreamFactory.java:534&amp;amp;sa=D&amp;amp;source=buganizer&amp;amp;usg=AOvVaw1RFzM_6925QHduj4lE3ACO&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;java.base@11.0.14.1/StackStreamFactory.java:534&lt;/a&gt;)&lt;br/&gt;
&#160; &#160; &#160; &#160; at java.lang.StackStreamFactory$AbstractStackWalker.doStackWalk(&lt;a href=&quot;https://www.google.com/url?q=http://java.base@11.0.14.1/StackStreamFactory.java:306&amp;amp;sa=D&amp;amp;source=buganizer&amp;amp;usg=AOvVaw26hvgz81UFf-6H8SrCZpse&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;java.base@11.0.14.1/StackStreamFactory.java:306&lt;/a&gt;)&lt;br/&gt;
&#160; &#160; &#160; &#160; at java.lang.StackStreamFactory$AbstractStackWalker.callStackWalk(&lt;a href=&quot;https://www.google.com/url?q=http://java.base@11.0.14.1/Native&amp;amp;sa=D&amp;amp;source=buganizer&amp;amp;usg=AOvVaw0HydWGgDE1db8rBCDWGYN3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;java.base@11.0.14.1/Native&lt;/a&gt;&#160;Method)&lt;br/&gt;
&#160; &#160; &#160; &#160; at java.lang.StackStreamFactory$AbstractStackWalker.beginStackWalk(&lt;a href=&quot;https://www.google.com/url?q=http://java.base@11.0.14.1/StackStreamFactory.java:370&amp;amp;sa=D&amp;amp;source=buganizer&amp;amp;usg=AOvVaw2BpfcKucv7skkNKw-Wn1Pu&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;java.base@11.0.14.1/StackStreamFactory.java:370&lt;/a&gt;)&lt;br/&gt;
&#160; &#160; &#160; &#160; at java.lang.StackStreamFactory$AbstractStackWalker.walk(&lt;a href=&quot;https://www.google.com/url?q=http://java.base@11.0.14.1/StackStreamFactory.java:243&amp;amp;sa=D&amp;amp;source=buganizer&amp;amp;usg=AOvVaw1c5cbOjaxOh58py5bl8LVS&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;java.base@11.0.14.1/StackStreamFactory.java:243&lt;/a&gt;)&lt;br/&gt;
&#160; &#160; &#160; &#160; at java.lang.StackWalker.walk(&lt;a href=&quot;https://www.google.com/url?q=http://java.base@11.0.14.1/StackWalker.java:498&amp;amp;sa=D&amp;amp;source=buganizer&amp;amp;usg=AOvVaw3WYvA9IjDO_K3G_L5tW7NE&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;java.base@11.0.14.1/StackWalker.java:498&lt;/a&gt;)&lt;br/&gt;
&#160; &#160; &#160; &#160; at org.apache.logging.log4j.util.StackLocator.calcLocation(StackLocator.java:97)&lt;br/&gt;
&#160; &#160; &#160; &#160; at org.apache.logging.log4j.util.StackLocatorUtil.calcLocation(StackLocatorUtil.java:121)&lt;br/&gt;
&#160; &#160; &#160; &#160; at org.apache.logging.log4j.core.impl.Log4jLogEvent.getSource(Log4jLogEvent.java:693)&lt;br/&gt;
&#160; &#160; &#160; &#160; at org.apache.logging.log4j.core.async.AsyncLoggerConfig.populateLazilyInitializedFields(AsyncLoggerConfig.java:171)&lt;br/&gt;
&#160; &#160; &#160; &#160; at org.apache.logging.log4j.core.async.AsyncLoggerConfig.logToAsyncDelegate(AsyncLoggerConfig.java:151)&lt;br/&gt;
&#160; &#160; &#160; &#160; at org.apache.logging.log4j.core.async.AsyncLoggerConfig.log(AsyncLoggerConfig.java:133)&lt;br/&gt;
&#160; &#160; &#160; &#160; at org.apache.logging.log4j.core.config.LoggerConfig.logParent(LoggerConfig.java:666)&lt;br/&gt;
&#160; &#160; &#160; &#160; at org.apache.logging.log4j.core.config.LoggerConfig.processLogEvent(LoggerConfig.java:635)&lt;br/&gt;
&#160; &#160; &#160; &#160; at org.apache.logging.log4j.core.config.LoggerConfig.log(LoggerConfig.java:616)&lt;br/&gt;
&#160; &#160; &#160; &#160; at org.apache.logging.log4j.core.async.AsyncLoggerConfig.log(AsyncLoggerConfig.java:138)&lt;br/&gt;
&#160; &#160; &#160; &#160; at org.apache.logging.log4j.core.config.LoggerConfig.logParent(LoggerConfig.java:666)&lt;br/&gt;
&#160; &#160; &#160; &#160; at org.apache.logging.log4j.core.config.LoggerConfig.processLogEvent(LoggerConfig.java:635)&lt;br/&gt;
&#160; &#160; &#160; &#160; at org.apache.logging.log4j.core.config.LoggerConfig.log(LoggerConfig.java:616)&lt;br/&gt;
&#160; &#160; &#160; &#160; at org.apache.logging.log4j.core.async.AsyncLoggerConfig.log(AsyncLoggerConfig.java:138)&lt;/p&gt;



&lt;p&gt;Starting in version 2.17.2, includelocation is set to true, although by default it is supposed to be false for AsyncLogger.&lt;/p&gt;

&lt;p&gt;Why, what has been changed that cause this?&lt;br/&gt;
A 2 month ago a change in the creation of LoggerConfig was introduced:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/logging-log4j2/commit/5a459dda1e731dfa93198db63493c1cb1cd1e941&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/logging-log4j2/commit/5a459dda1e731dfa93198db63493c1cb1cd1e941&lt;/a&gt;&lt;br/&gt;
&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13042943/13042943_image-2022-04-26-12-07-39-175.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;br/&gt;
With the new change the LoggerConfig is now created by a PluginBuilderFactory and not by a reflection triggering the static createLogger method.&lt;br/&gt;
The thing is that there is a change in the inner createlogger implementation.&lt;br/&gt;
Until version ( including ) 2.17.1, The createLogger, create an AsyncLoggerConfig with includeLocation param, based on this check includeLocation(includeLocation), which is just a simple check to the value of the param, the param is null, so it creates AsyncLoggerConfig with false includeLocation.&lt;/p&gt;

&lt;p&gt;However, In version &#160;2.17.2 the createLogger, evaluate includeLocation value by:&lt;br/&gt;
includeLocation(getIncludeLocation(), getConfig())&lt;/p&gt;

&lt;p&gt;This method in case of a null value for includeLocationConfigValue ( which is the case in both version ) , determines the includeLocation value based on:&lt;br/&gt;
!(context instanceof AsyncLoggerContext);&lt;br/&gt;
&lt;b&gt;However&lt;/b&gt;, in case that you have mixed loggers or use AsyncLogger, then the context is LoggerContext, although your logger is an async one, so now include location is set to true for your async logger.&lt;/p&gt;

&lt;p&gt;2.17.1 stack&lt;br/&gt;
return new AsyncLoggerConfig(name, Arrays.asList(refs), filter, level, additivity, properties, config, includeLocation(includeLocation));&lt;/p&gt;

&lt;p&gt;&#160; &#160; &#160; &#160; &#160; at org.apache.logging.log4j.core.async.AsyncLoggerConfig.createLogger(AsyncLoggerConfig.java:272)&lt;br/&gt;
&#160; &#160; &#160; &#160; &#160; at sun.reflect.NativeMethodAccessorImpl.invoke0(NativeMethodAccessorImpl.java:-1)&lt;br/&gt;
&#160; &#160; &#160; &#160; &#160; at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)&lt;br/&gt;
&#160; &#160; &#160; &#160; &#160; at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
&#160; &#160; &#160; &#160; &#160; at java.lang.reflect.Method.invoke(Method.java:498)&lt;br/&gt;
&#160; &#160; &#160; &#160; &#160; at org.apache.logging.log4j.core.config.plugins.util.PluginBuilder.build(PluginBuilder.java:136)&lt;/p&gt;

&lt;p&gt;2.17.2 stack:&lt;br/&gt;
return new AsyncLoggerConfig(name, container.refs, this.getFilter(), container.level, this.isAdditivity(), this.getProperties(), this.getConfig(), AsyncLoggerConfig.includeLocation(this.getIncludeLocation(), this.getConfig()));&lt;br/&gt;
&#160; &#160; &#160; &#160; &#160; at org.apache.logging.log4j.core.async.AsyncLoggerConfig.&amp;lt;init&amp;gt;(AsyncLoggerConfig.java:109)&lt;br/&gt;
&#160; &#160; &#160; &#160; &#160; at org.apache.logging.log4j.core.async.AsyncLoggerConfig$Builder.build(AsyncLoggerConfig.java:88)&lt;br/&gt;
&#160; &#160; &#160; &#160; &#160; at org.apache.logging.log4j.core.async.AsyncLoggerConfig$Builder.build(AsyncLoggerConfig.java:80)&lt;br/&gt;
&#160; &#160; &#160; &#160; &#160; at org.apache.logging.log4j.core.config.plugins.util.PluginBuilder.build(PluginBuilder.java:124)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;How to reproduce:&lt;/p&gt;

&lt;p&gt;Use the following log4j config. Don&apos;t pass a selector flag (no need to pass it if logger explicit is defined as AsyncLogger ).&lt;/p&gt;

&lt;p&gt;You will find that the AsyncLogger.includeLocation is set to true.&lt;/p&gt;

&lt;p&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&amp;gt;&lt;br/&gt;
&amp;lt;Configuration&amp;gt;&lt;br/&gt;
&#160; &amp;lt;Appenders&amp;gt;&lt;br/&gt;
&#160; &#160; &amp;lt;Console name=&quot;console&quot; target=&quot;SYSTEM_OUT&quot;&amp;gt;&lt;br/&gt;
&#160; &#160; &#160; &amp;lt;PatternLayout pattern=&quot;%d{mm:ss,SSS} &lt;span class=&quot;error&quot;&gt;&amp;#91;%t&amp;#93;&lt;/span&gt; %-5p %c{1} - %m%n&quot; /&amp;gt;&lt;br/&gt;
&#160; &#160; &amp;lt;/Console&amp;gt;&lt;br/&gt;
&#160; &amp;lt;/Appenders&amp;gt;&lt;br/&gt;
&#160; &amp;lt;Loggers&amp;gt;&lt;br/&gt;
&#160; &#160; &amp;lt;AsyncRoot level=&quot;info&quot;&amp;gt;&lt;br/&gt;
&#160; &#160; &#160; &amp;lt;AppenderRef ref=&quot;console&quot; /&amp;gt;&lt;br/&gt;
&#160; &#160; &amp;lt;/AsyncRoot&amp;gt;&lt;br/&gt;
&#160; &#160; &amp;lt;AsyncLogger name=&quot;com&quot; level=&quot;info&quot; /&amp;gt;&lt;br/&gt;
&#160; &amp;lt;/Loggers&amp;gt;&lt;br/&gt;
&amp;lt;/Configuration&amp;gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13441755">LOG4J2-3491</key>
            <summary>High cpu, due to a change that cause to includeLocation by default for AsyncLogger</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rgoers">Ralph Goers</assignee>
                                    <reporter username="avihaimar">avihai marchiano</reporter>
                        <labels>
                    </labels>
                <created>Tue, 26 Apr 2022 09:18:16 +0000</created>
                <updated>Fri, 27 May 2022 21:49:31 +0000</updated>
                            <resolved>Wed, 18 May 2022 21:43:18 +0000</resolved>
                                    <version>2.17.2</version>
                                    <fixVersion>2.18.0</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="17528407" author="ralph.goers@dslextreme.com" created="Tue, 26 Apr 2022 20:56:48 +0000"  >&lt;p&gt;Your analysis looks correct to me. I am surprised you didn&apos;t supply a PR to go with it.&lt;/p&gt;</comment>
                            <comment id="17528416" author="JIRAUSER288645" created="Tue, 26 Apr 2022 21:14:34 +0000"  >&lt;p&gt;As I see if for start, solution can be simple by keeping the same includeLocation evaluation as was before:&lt;br/&gt;
So instead of:&lt;br/&gt;
return new AsyncLoggerConfig(name, container.refs,getFilter(), container.level, isAdditivity(),getProperties(), getConfig(), includeLocation(getIncludeLocation(), getConfig()));&lt;/p&gt;

&lt;p&gt;It should be:&lt;br/&gt;
return new AsyncLoggerConfig(name, container.refs,getFilter(), container.level, isAdditivity(),getProperties(), getConfig(), includeLocation(getIncludeLocation()));&lt;/p&gt;</comment>
                            <comment id="17528428" author="JIRAUSER288551" created="Tue, 26 Apr 2022 21:58:26 +0000"  >&lt;p&gt;Except the includeLocation(String string) method has changed so that change won&apos;t help. It needs to be reverted back to Booleans.parseBoolean(configValue, false).&lt;/p&gt;</comment>
                            <comment id="17528431" author="JIRAUSER288645" created="Tue, 26 Apr 2022 22:08:21 +0000"  >&lt;p&gt;includeLocation(String string) was not changed.&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/logging-log4j2/blob/master/log4j-core/src/main/java/org/apache/logging/log4j/core/async/AsyncLoggerConfig.java#L285&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/logging-log4j2/blob/master/log4j-core/src/main/java/org/apache/logging/log4j/core/async/AsyncLoggerConfig.java#L285&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17528432" author="JIRAUSER288645" created="Tue, 26 Apr 2022 22:11:52 +0000"  >&lt;p&gt;Also - boolean includeLocation(final String includeLocationConfigValue, final Configuration configuration)&lt;br/&gt;
was not changed:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/logging-log4j2/blame/5a459dda1e731dfa93198db63493c1cb1cd1e941/log4j-core/src/main/java/org/apache/logging/log4j/core/config/LoggerConfig.java#L764&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/logging-log4j2/blame/5a459dda1e731dfa93198db63493c1cb1cd1e941/log4j-core/src/main/java/org/apache/logging/log4j/core/config/LoggerConfig.java#L764&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;the change is that now they init the config with includeLocation(final String includeLocationConfigValue, final Configuration configuration), which has different logic then:&lt;br/&gt;
includeLocation(String string)&lt;/p&gt;</comment>
                            <comment id="17528473" author="JIRAUSER288551" created="Wed, 27 Apr 2022 01:27:11 +0000"  >&lt;p&gt;You&apos;re correct. This is includeLocation(String s) from LoggerConfig I was afraid you were referring to:&lt;/p&gt;

&lt;p&gt;/**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;@deprecated Please use {@link #includeLocation(String, Configuration)}&lt;br/&gt;
*/&lt;br/&gt;
@Deprecated&lt;br/&gt;
protected static boolean includeLocation(final String includeLocationConfigValue) 
{
return includeLocation(includeLocationConfigValue, null);
}&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17529020" author="pkarwasz" created="Wed, 27 Apr 2022 19:49:45 +0000"  >&lt;p&gt;I would simply use:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Booleans.parseBoolean(getIncludeLocation(), &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;everywhere in the &lt;tt&gt;AsyncLoggerConfig.java&lt;/tt&gt; file.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=avihaimar&quot; class=&quot;user-hover&quot; rel=&quot;avihaimar&quot;&gt;avihaimar&lt;/a&gt;, could you send a PR with the fix and a regression test?&lt;/p&gt;</comment>
                            <comment id="17539098" author="jira-bot" created="Wed, 18 May 2022 21:41:51 +0000"  >&lt;p&gt;Commit 0c2997a01d088484b2178fbcf2075e93f54fab76 in logging-log4j2&apos;s branch refs/heads/master from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=0c2997a01d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=0c2997a01d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3491&quot; title=&quot;High cpu, due to a change that cause to includeLocation by default for AsyncLogger&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3491&quot;&gt;&lt;del&gt;LOG4J2-3491&lt;/del&gt;&lt;/a&gt; - Correctly default to not include location info for AsyncLoggers&lt;/p&gt;</comment>
                            <comment id="17539099" author="jira-bot" created="Wed, 18 May 2022 21:41:57 +0000"  >&lt;p&gt;Commit 26c7c42e8343c84971a64de66bca47392088259b in logging-log4j2&apos;s branch refs/heads/release-2.x from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=26c7c42e83&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=26c7c42e83&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3491&quot; title=&quot;High cpu, due to a change that cause to includeLocation by default for AsyncLogger&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3491&quot;&gt;&lt;del&gt;LOG4J2-3491&lt;/del&gt;&lt;/a&gt; - Correctly default to not include location info for AsyncLoggers&lt;/p&gt;</comment>
                            <comment id="17539100" author="ralph.goers@dslextreme.com" created="Wed, 18 May 2022 21:43:18 +0000"  >&lt;p&gt;The fix has been pushed to both the release-2.x and master branches. Please verify and close.&lt;/p&gt;</comment>
                            <comment id="17541709" author="jira-bot" created="Tue, 24 May 2022 21:07:41 +0000"  >&lt;p&gt;Commit 26c7c42e8343c84971a64de66bca47392088259b in logging-log4j2&apos;s branch refs/heads/dependabot/maven/com.h2database-h2-2.1.212 from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=26c7c42e83&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=26c7c42e83&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3491&quot; title=&quot;High cpu, due to a change that cause to includeLocation by default for AsyncLogger&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3491&quot;&gt;&lt;del&gt;LOG4J2-3491&lt;/del&gt;&lt;/a&gt; - Correctly default to not include location info for AsyncLoggers&lt;/p&gt;</comment>
                            <comment id="17543134" author="jira-bot" created="Fri, 27 May 2022 21:49:31 +0000"  >&lt;p&gt;Commit 26c7c42e8343c84971a64de66bca47392088259b in logging-log4j2&apos;s branch refs/heads/dependabot/maven/org.apache.maven.plugins-maven-site-plugin-3.12.0 from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=26c7c42e83&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=26c7c42e83&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3491&quot; title=&quot;High cpu, due to a change that cause to includeLocation by default for AsyncLogger&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3491&quot;&gt;&lt;del&gt;LOG4J2-3491&lt;/del&gt;&lt;/a&gt; - Correctly default to not include location info for AsyncLoggers&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13441382">LOG4J2-3487</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13042943" name="image-2022-04-26-12-07-39-175.png" size="437573" author="avihaimar" created="Tue, 26 Apr 2022 09:07:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 24 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z11tg8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>