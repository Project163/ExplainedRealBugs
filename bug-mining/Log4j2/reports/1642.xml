<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:43:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-3647] Equivalence of `LogBuilder` and `Logger` calls</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-3647</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;The following two calls should behave in the same way:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
logger.info(marker, &lt;span class=&quot;code-quote&quot;&gt;&quot;Hello Log4j2 Core!&quot;&lt;/span&gt;);
logger.atInfo().withMarker(marker).log(&lt;span class=&quot;code-quote&quot;&gt;&quot;Hello Log4j2 Core!&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If we use global filters and the filter returns &lt;tt&gt;ACCEPT&lt;/tt&gt;, the first call will log a message even if the logger&apos;s level is lower than &lt;tt&gt;INFO&lt;/tt&gt;. The second call will not log anything.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13517675">LOG4J2-3647</key>
            <summary>Equivalence of `LogBuilder` and `Logger` calls</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="pkarwasz">Piotr Karwasz</reporter>
                        <labels>
                    </labels>
                <created>Wed, 11 Jan 2023 19:47:08 +0000</created>
                <updated>Thu, 2 Feb 2023 14:12:24 +0000</updated>
                            <resolved>Thu, 2 Feb 2023 14:12:24 +0000</resolved>
                                                    <fixVersion>2.20.0</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17676948" author="ralph.goers@dslextreme.com" created="Sat, 14 Jan 2023 21:15:43 +0000"  >&lt;p&gt;This makes no sense to me.&lt;/p&gt;

&lt;p&gt;AbstractLogger does&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Override
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void info(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Marker marker, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Message message) {
    logIfEnabled(FQCN, Level.INFO, marker, message, message != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? message.getThrowable() : &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
}

@Override
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void logIfEnabled(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; fqcn, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Level level, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Marker marker, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Message message,
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Throwable throwable) {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isEnabled(level, marker, message, throwable)) {
        logMessageSafely(fqcn, level, marker, message, throwable);
    }
}

@Override
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; LogBuilder atInfo() {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; atLevel(Level.INFO);
} 

@Override
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; LogBuilder atLevel(Level level) {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isEnabled(level)) {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; getLogBuilder(level).reset(level);
    }
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; LogBuilder.NOOP;
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So in both of these cases isEnabled() is being called. In the logger.info() case if isEnabled returns false nothing is done. In the second case a NoOp LogBuilder is returned.&lt;/p&gt;

&lt;p&gt;In both isEnabled methods the global filter will be checked and then the logger&apos;s level will be evaluated ONLY if the filter is Neutral. This is handled in the various filter implementations in PrivateConfig, such as &lt;a href=&quot;https://github.com/apache/logging-log4j2/blob/release-2.x/log4j-core/src/main/java/org/apache/logging/log4j/core/Logger.java#L502.&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/logging-log4j2/blob/release-2.x/log4j-core/src/main/java/org/apache/logging/log4j/core/Logger.java#L502.&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Since the exact same mechanism is used to evaluate the filter and log level I fail to understand how this could be happening.&lt;/p&gt;</comment>
                            <comment id="17676949" author="pkarwasz" created="Sat, 14 Jan 2023 21:32:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rgoers&quot; class=&quot;user-hover&quot; rel=&quot;rgoers&quot;&gt;rgoers&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Yes, &lt;tt&gt;isEnabled&lt;/tt&gt; is called in both cases, but with a different set of parameters. Calling:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
logger.isEnabled(level);
logger.isEnabled(level, marker, message, throwable);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;can give different results. The test I put in the PR uses a `MarkerFilter` that accepts messages with a certain marker and returns &lt;tt&gt;NEUTRAL&lt;/tt&gt; for all others. Calling &lt;tt&gt;isEnabled(Level.INFO)&lt;/tt&gt; is the same as having &lt;b&gt;no&lt;/b&gt; marker and messages less specific than &lt;tt&gt;INFO&lt;/tt&gt; are rejected.&lt;/p&gt;</comment>
                            <comment id="17677416" author="ralph.goers@dslextreme.com" created="Mon, 16 Jan 2023 14:35:24 +0000"  >&lt;p&gt;Yes, I see the problem now.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 43 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1eqe8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>