<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:32:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-520] RollingRandomAccessFile with Async Appender skip logs</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-520</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;I have written a sample code which will write DEBUG, INFO , WARN logs in a single flile, I have written a logs in FOR loop printing numbers from 1 to 99.&lt;br/&gt;
sometime it print numbers incomplete sequence, like 1 to 67, 1 to 89 etc.&lt;/p&gt;

&lt;p&gt;log4j2.xml&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.0&quot;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;?&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Configuration&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Appenders&amp;gt;&lt;/span&gt;
    &amp;lt;RollingRandomAccessFile name=&lt;span class=&quot;code-quote&quot;&gt;&quot;RollingRandomAccessFile&quot;&lt;/span&gt;
      fileName=&lt;span class=&quot;code-quote&quot;&gt;&quot;logs/app.log&quot;&lt;/span&gt; filePattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;logs/$${date:yyyy-MM}/app-%d{MM-dd-yyyy}-%i.log&quot;&lt;/span&gt;
      immediateFlush=&lt;span class=&quot;code-quote&quot;&gt;&quot;false&quot;&lt;/span&gt; append=&lt;span class=&quot;code-quote&quot;&gt;&quot;true&quot;&lt;/span&gt; ignoreExceptions=&lt;span class=&quot;code-quote&quot;&gt;&quot;false&quot;&lt;/span&gt;&amp;gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;PatternLayout&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Pattern&amp;gt;&lt;/span&gt;%d %-5p [%t] (%F:%L) - %m%n&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Pattern&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/PatternLayout&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Policies&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;TimeBasedTriggeringPolicy /&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;SizeBasedTriggeringPolicy size=&lt;span class=&quot;code-quote&quot;&gt;&quot;100KB&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Policies&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/RollingRandomAccessFile&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Async name=&lt;span class=&quot;code-quote&quot;&gt;&quot;ASYNC&quot;&lt;/span&gt; includeLocation=&lt;span class=&quot;code-quote&quot;&gt;&quot;true&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;AppenderRef ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;RollingRandomAccessFile&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Async&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Appenders&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Loggers&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Root level=&lt;span class=&quot;code-quote&quot;&gt;&quot;debug&quot;&lt;/span&gt; includeLocation=&lt;span class=&quot;code-quote&quot;&gt;&quot;true&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;AppenderRef ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;ASYNC&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Root&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Loggers&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Configuration&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Sample Java Code&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.slf4j.Logger;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.slf4j.LoggerFactory;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;LoggerUtil {
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; Logger logger = LoggerFactory.getLogger(LoggerUtil.class);
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
		&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;start&quot;&lt;/span&gt;);
		logger.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;debug log&quot;&lt;/span&gt;);
		logger.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;info log&quot;&lt;/span&gt;);
		logger.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;error log&quot;&lt;/span&gt;);
		&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; 99; i++) {
			logger.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;{}&quot;&lt;/span&gt;,i);
			&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;I : - &quot;&lt;/span&gt; + i);
		}
		logger.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;finish printing logs&quot;&lt;/span&gt;);
		&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;end&quot;&lt;/span&gt;);		
	}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;JDK 1.6, Eclipse&lt;/p&gt;</environment>
        <key id="12691636">LOG4J2-520</key>
            <summary>RollingRandomAccessFile with Async Appender skip logs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rpopma">Remko Popma</assignee>
                                    <reporter username="Java">JavaTech</reporter>
                        <labels>
                    </labels>
                <created>Tue, 28 Jan 2014 14:14:44 +0000</created>
                <updated>Tue, 6 May 2014 09:43:10 +0000</updated>
                            <resolved>Mon, 5 May 2014 13:20:47 +0000</resolved>
                                    <version>2.0-beta9</version>
                    <version>2.0-rc1</version>
                                    <fixVersion>2.0-rc2</fixVersion>
                                    <component>Appenders</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13894265" author="llogiq" created="Fri, 7 Feb 2014 07:34:11 +0000"  >&lt;p&gt;This Bug has been referenced from &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-392&quot; title=&quot;Intermittent errors with appenders&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-392&quot;&gt;&lt;del&gt;LOG4J2-392&lt;/del&gt;&lt;/a&gt;, which is basically the same with async loggers instead of async appenders. With the current snapshot, the problems boil down to the same behavior.&lt;/p&gt;

&lt;p&gt;What happens is that the shutdown sequence leaves not enough time for async &lt;/p&gt;
{loggers, appenders} to write out the messages that still reside in the {ring buffer, queue}. They are just shut down without so much as a warning.&lt;br/&gt;
&lt;br/&gt;
The obvious solution is to allow for a grace period before shutting down async {loggers, appenders}
&lt;p&gt; and to raise an error (at least a status error message) when they fail to flush out all state to disk.&lt;/p&gt;

&lt;p&gt;@Remko: Thank you for looking into this.&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Andre&lt;/p&gt;</comment>
                            <comment id="13895504" author="remkop@yahoo.com" created="Sat, 8 Feb 2014 10:25:20 +0000"  >&lt;p&gt;I tried but was unable to reproduce the issue with the LoggerUtil class and log4j2.xml config from the description...&lt;/p&gt;

&lt;p&gt;Andre, I will try to reproduce the issue next with the AppenderOverwhelmer class you attached to &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-392&quot; title=&quot;Intermittent errors with appenders&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-392&quot;&gt;&lt;del&gt;LOG4J2-392&lt;/del&gt;&lt;/a&gt;. Can you provide the log4j2.xml config with which you can reproduce the issue? Also: are all loggers async? How many cores does your machine have? Thanks! &lt;/p&gt;</comment>
                            <comment id="13896077" author="llogiq" created="Sun, 9 Feb 2014 22:25:36 +0000"  >&lt;p&gt;@Remko: Here it is - the easiest all-async-logging log4j2.xml that I could come up with.&lt;/p&gt;</comment>
                            <comment id="13896129" author="remkop@yahoo.com" created="Mon, 10 Feb 2014 01:01:45 +0000"  >&lt;p&gt;Thanks Andre! I was able to reproduce this on my single-core work PC now (haven&apos;t tried other machines yet).&lt;/p&gt;</comment>
                            <comment id="13896239" author="llogiq" created="Mon, 10 Feb 2014 05:48:23 +0000"  >&lt;p&gt;Thank you Remko for devoting your time and energy so that we may reap the benefits of a well-maintained high-speed logging system &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Btw, if my reasoning is right this should be reproducible everywhere unless stdout is faster than async logging. I cannot conceive a reality where this could be the case though.&lt;/p&gt;

&lt;p&gt;Regards, Andre&lt;br/&gt;
l&lt;/p&gt;</comment>
                            <comment id="13905073" author="llogiq" created="Wed, 19 Feb 2014 08:52:08 +0000"  >&lt;p&gt;I just wanted to note that the problem (of course) persist in RC1, so it should be added to the affected versions.&lt;/p&gt;

&lt;p&gt;Also at least in my company, we&apos;re still on 2.0beta9 because of this bug. As I explained in &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-392&quot; title=&quot;Intermittent errors with appenders&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-392&quot;&gt;&lt;del&gt;LOG4J2-392&lt;/del&gt;&lt;/a&gt;, I deem the current silent swallowing of messages unacceptable for our use case, but we still want the performance benefit, so we just add a Thread.sleep(X) to the end of the program, increasing X until the error no longer appears.&lt;/p&gt;</comment>
                            <comment id="13905082" author="remkop@yahoo.com" created="Wed, 19 Feb 2014 11:03:40 +0000"  >&lt;p&gt;I added rc1 to the affected versions. &lt;/p&gt;

&lt;p&gt;By the way, is the reason you&apos;re still on beta9 because rc1 made something worse? The &lt;tt&gt;Thread.sleep()&lt;/tt&gt; workaround should work for both beta9 and rc1, or am I missing something?&lt;/p&gt;</comment>
                            <comment id="13905104" author="llogiq" created="Wed, 19 Feb 2014 11:24:25 +0000"  >&lt;p&gt;See my comment on &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-392&quot; title=&quot;Intermittent errors with appenders&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-392&quot;&gt;&lt;del&gt;LOG4J2-392&lt;/del&gt;&lt;/a&gt; - rc1 discards messages silently. Unless I add a &quot;done&quot; log event (which in the case of multithreaded applications may not be as easy, unless I let the main thread wait on all other threads), I won&apos;t know if the program finsihed.&lt;/p&gt;</comment>
                            <comment id="13988948" author="remkop@yahoo.com" created="Sun, 4 May 2014 09:12:45 +0000"  >&lt;p&gt;Andre, I&apos;ve started to look at this issue again.&lt;/p&gt;

&lt;p&gt;With your AppenderOverwhelmer program, and the log4j2.xml file attached to this issue, I can reproduce the issue.&lt;/p&gt;

&lt;p&gt;So far, I&apos;ve found that the application thread does wait correctly until there are no more log events in the ringbuffer. Only after the ringbuffer is empty does the program go ahead and shut down the disruptor.&lt;br/&gt;
Interestingly, even though the queue is empty, the ConsoleAppender only prints out 730,000-740,000 events (out of 1,000,000) before the application exits. I added a counter to this appender and this counter confirms not all events have reached the appender. What I don&apos;t understand yet is why the ringbuffer reports it is empty: this should not happen unless all events have been consumed...&lt;/p&gt;

&lt;p&gt;What is also interesting is that I cannot reproduce the problem with a RandomAccessFileAppender. If I replace the ConsoleAppender with a RandomAccessFileAppender and run the ApplicationOverwhelmer the resulting log file has all 1,000,000 events without dropping a single event.&lt;/p&gt;

&lt;p&gt;I need to look at this some more.&lt;/p&gt;</comment>
                            <comment id="13989002" author="remkop@yahoo.com" created="Sun, 4 May 2014 14:46:01 +0000"  >&lt;p&gt;You were right: this is related to the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-392&quot; title=&quot;Intermittent errors with appenders&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-392&quot;&gt;&lt;del&gt;LOG4J2-392&lt;/del&gt;&lt;/a&gt; and that fix is the culprit.&lt;br/&gt;
The problem with the current implementation is that appenders are removed before the ringbuffer has had a chance to drain.&lt;br/&gt;
I hope to have a better implementation soon.&lt;/p&gt;</comment>
                            <comment id="13989396" author="llogiq" created="Mon, 5 May 2014 09:57:45 +0000"  >&lt;p&gt;I see on 392 that you have pushed a fix, I&apos;m in the process of building it. Once I&apos;ve done, I&apos;ll return with results.&lt;/p&gt;</comment>
                            <comment id="13989407" author="remkop@yahoo.com" created="Mon, 5 May 2014 10:36:12 +0000"  >&lt;p&gt;I revisited the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-392&quot; title=&quot;Intermittent errors with appenders&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-392&quot;&gt;&lt;del&gt;LOG4J2-392&lt;/del&gt;&lt;/a&gt; and confirmed that this solves the problem with AsyncLoggerConfig. The new fix is available in trunk.&lt;/p&gt;

&lt;p&gt;Unfortunately I can still reproduce the problem with AsyncAppender using the ApplicationOverwhelmer test program. I will investigate this next.&lt;/p&gt;</comment>
                            <comment id="13989463" author="remkop@yahoo.com" created="Mon, 5 May 2014 12:32:27 +0000"  >&lt;p&gt;I think I got it. It took a bit of debugging, but it turns out that after the shutdown signal is sent to AsyncAppender.AsyncThread, all events that were still on the queue are not sent to the underlying appenders.&lt;/p&gt;

&lt;p&gt;Here is the relevant code of AsyncAppender:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;AsyncAppender &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; AbstractAppender {
    ...
209    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;AsyncThread &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt; {
        ...
223        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void run() {
            ...
248            &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-object&quot;&gt;Process&lt;/span&gt; any remaining items in the queue.
&lt;/span&gt;249            &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (!queue.isEmpty()) {
250                &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
251                    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Serializable s = queue.take();
252                    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (s &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; Log4jLogEvent) { &lt;span class=&quot;code-comment&quot;&gt;// &amp;lt;----- This is wrong
&lt;/span&gt;253                        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Log4jLogEvent event = Log4jLogEvent.deserialize(s);
254                        event.setEndOfBatch(queue.isEmpty());
255                        callAppenders(event);
256                    }
257                } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; InterruptedException ex) {
258                    &lt;span class=&quot;code-comment&quot;&gt;// May have been interrupted to shut down.
&lt;/span&gt;259                }
260            }
261        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note that the instanceof check on line 252 means that only elements whose class is &lt;tt&gt;Log4jLogEvent&lt;/tt&gt; are processed. It turns out that what is on the queue is objects of class Log4jLogEvent$LogEventProxy. So the check returns &lt;tt&gt;false&lt;/tt&gt; and everything that was still on the queue is ignored.&lt;/p&gt;

&lt;p&gt;Looks like this check was introduced in revision 1460984. The commit comment says &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-146&quot; title=&quot;Log4J 1.2 API implementation ClassCastException with SimpleLoggerContext&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-146&quot;&gt;&lt;del&gt;LOG4J2-146&lt;/del&gt;&lt;/a&gt; Avoid IllegalArgumentException in AsynchAppender&quot;.&lt;/p&gt;

&lt;p&gt;How to fix this? Remove the instanceof check altogether or keep the check but make it work correctly?&lt;br/&gt;
I&apos;m not sure what the instanceof check is trying to protect against, so I&apos;m not sure that removing it is a good idea.&lt;/p&gt;

&lt;p&gt;To keep the check, we can add a method to Log4jLogEvent:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; canDeserialize(Serializable s) {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; s &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; LogEventProxy;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Note that we cannot change the existing AsyncAppender code to &lt;tt&gt;if (s instanceof Log4jLogEvent$LogEventProxy)&lt;/tt&gt; because  Log4jLogEvent$LogEventProxy is a private inner class and is invisible to AsyncAppender.&lt;/p&gt;

&lt;p&gt;I think I&apos;ll go with the &lt;tt&gt;canDeserialize&lt;/tt&gt; method.&lt;/p&gt;</comment>
                            <comment id="13989497" author="remkop@yahoo.com" created="Mon, 5 May 2014 13:20:47 +0000"  >&lt;p&gt;Fixed in revision 1592522.&lt;br/&gt;
Please verify and close.&lt;/p&gt;</comment>
                            <comment id="13990445" author="llogiq" created="Tue, 6 May 2014 08:55:16 +0000"  >&lt;p&gt;As noted on &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-392&quot; title=&quot;Intermittent errors with appenders&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-392&quot;&gt;&lt;del&gt;LOG4J2-392&lt;/del&gt;&lt;/a&gt;, I can confirm that r1592539 fixes the issue for me.&lt;/p&gt;</comment>
                            <comment id="13990486" author="remkop@yahoo.com" created="Tue, 6 May 2014 09:43:10 +0000"  >&lt;p&gt;Thanks for the confirmation!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12691637">LOG4J2-521</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12691637">LOG4J2-521</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12627898" name="log4j2.xml" size="354" author="llogiq" created="Sun, 9 Feb 2014 22:25:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>370381</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 29 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ru2f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>370682</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>