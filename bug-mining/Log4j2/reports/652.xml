<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:35:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-1195] KafkaAppender doesn&apos;t work with SerializedLayout</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-1195</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;the KafkaAppender can&apos;t deserialize objects when the SerializedLayout is used:&lt;/p&gt;

&lt;p&gt;java.io.StreamCorruptedException: invalid stream header: 7372003E&lt;br/&gt;
	at java.io.ObjectInputStream.readStreamHeader(ObjectInputStream.java:806)&lt;br/&gt;
	at java.io.ObjectInputStream.&amp;lt;init&amp;gt;(ObjectInputStream.java:299)&lt;br/&gt;
	at com.example.inceptiontest.TestSerializer.deserializeLogEvent(TestSerializer.java:35)&lt;br/&gt;
	at com.example.inceptiontest.TestSerializer.serialize(TestSerializer.java:18)&lt;br/&gt;
	at com.example.inceptiontest.TestSerializer.serialize(TestSerializer.java:10)&lt;br/&gt;
	at org.apache.kafka.clients.producer.KafkaProducer.send(KafkaProducer.java:326)&lt;br/&gt;
	at org.apache.kafka.clients.producer.KafkaProducer.send(KafkaProducer.java:248)&lt;br/&gt;
	at org.apache.logging.log4j.core.appender.mom.kafka.KafkaManager.send(KafkaManager.java:80)&lt;br/&gt;
	at org.apache.logging.log4j.core.appender.mom.kafka.KafkaAppender.append(KafkaAppender.java:71)&lt;br/&gt;
	at org.apache.logging.log4j.core.config.AppenderControl.tryCallAppender(AppenderControl.java:148)&lt;br/&gt;
	at org.apache.logging.log4j.core.config.AppenderControl.callAppender0(AppenderControl.java:121)&lt;br/&gt;
	at org.apache.logging.log4j.core.config.AppenderControl.callAppenderPreventRecursion(AppenderControl.java:112)&lt;br/&gt;
	at org.apache.logging.log4j.core.config.AppenderControl.callAppender(AppenderControl.java:80)&lt;br/&gt;
	at org.apache.logging.log4j.core.config.LoggerConfig.callAppenders(LoggerConfig.java:390)&lt;br/&gt;
	at org.apache.logging.log4j.core.config.LoggerConfig.processLogEvent(LoggerConfig.java:378)&lt;br/&gt;
	at org.apache.logging.log4j.core.config.LoggerConfig.log(LoggerConfig.java:362)&lt;br/&gt;
	at org.apache.logging.log4j.core.config.LoggerConfig.log(LoggerConfig.java:352)&lt;br/&gt;
	at org.apache.logging.log4j.core.config.AwaitCompletionReliabilityStrategy.log(AwaitCompletionReliabilityStrategy.java:59)&lt;br/&gt;
	at org.apache.logging.log4j.core.Logger.logMessage(Logger.java:138)&lt;br/&gt;
	at org.apache.logging.log4j.spi.AbstractLogger.logMessage(AbstractLogger.java:1016)&lt;br/&gt;
	at org.apache.logging.log4j.spi.AbstractLogger.logIfEnabled(AbstractLogger.java:993)&lt;br/&gt;
	at org.apache.logging.log4j.spi.AbstractLogger.error(AbstractLogger.java:397)&lt;br/&gt;
	at com.example.inceptiontest.InceptionTest.main(InceptionTest.java:14)&lt;/p&gt;

&lt;p&gt;Looking through past issues, this seems related to a similar issue with SocketAppender at &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-181&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/LOG4J2-181&lt;/a&gt;. My understanding in the previous case was that the headers were not being set by the manager, and it seems to be the same case here.&lt;/p&gt;

&lt;p&gt;This is my xml configuration:&lt;/p&gt;

&lt;p&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;&lt;br/&gt;
&amp;lt;Configuration status=&quot;INFO&quot;&amp;gt;&lt;br/&gt;
    &amp;lt;Appenders&amp;gt;&lt;br/&gt;
        &amp;lt;Console name=&quot;Console&quot; target=&quot;SYSTEM_OUT&quot;&amp;gt;&lt;br/&gt;
            &amp;lt;PatternLayout pattern=&quot;%d&lt;/p&gt;
{HH:mm:ss.SSS}
&lt;p&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;%t&amp;#93;&lt;/span&gt; %-5level %logger&lt;/p&gt;
{36}
&lt;p&gt; - %msg%n&quot; /&amp;gt;&lt;br/&gt;
        &amp;lt;/Console&amp;gt;&lt;br/&gt;
        &amp;lt;Kafka name=&quot;Kafka&quot; topic=&quot;test&quot;&amp;gt;&lt;br/&gt;
            &amp;lt;SerializedLayout/&amp;gt;&lt;br/&gt;
            &amp;lt;Property name=&quot;bootstrap.servers&quot;&amp;gt;localhost:9092&amp;lt;/Property&amp;gt;&lt;br/&gt;
            &amp;lt;Property name=&quot;key.serializer&quot;&amp;gt;com.example.inceptiontest.TestSerializer&amp;lt;/Property&amp;gt;&lt;br/&gt;
            &amp;lt;Property name=&quot;value.serializer&quot;&amp;gt;com.example.inceptiontest.TestSerializer&amp;lt;/Property&amp;gt;&lt;br/&gt;
        &amp;lt;/Kafka&amp;gt;&lt;br/&gt;
    &amp;lt;/Appenders&amp;gt;&lt;br/&gt;
    &amp;lt;Loggers&amp;gt;&lt;br/&gt;
        &amp;lt;Root level=&quot;debug&quot;&amp;gt;&lt;br/&gt;
            &amp;lt;AppenderRef ref=&quot;Console&quot; /&amp;gt;&lt;br/&gt;
            &amp;lt;AppenderRef ref=&quot;Kafka&quot;/&amp;gt;&lt;br/&gt;
        &amp;lt;/Root&amp;gt;&lt;br/&gt;
        &amp;lt;Logger name=&quot;org.apache.kafka&quot; level=&quot;INFO&quot; /&amp;gt; &amp;lt;!-- avoid recursive logging --&amp;gt;&lt;br/&gt;
    &amp;lt;/Loggers&amp;gt;&lt;br/&gt;
&amp;lt;/Configuration&amp;gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12910826">LOG4J2-1195</key>
            <summary>KafkaAppender doesn&apos;t work with SerializedLayout</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikaelstaldal">Mikael St&#229;ldal</assignee>
                                    <reporter username="melvinclanceydu">Melvin Du</reporter>
                        <labels>
                    </labels>
                <created>Thu, 5 Nov 2015 20:07:48 +0000</created>
                <updated>Wed, 2 Dec 2015 09:18:00 +0000</updated>
                            <resolved>Wed, 18 Nov 2015 08:45:04 +0000</resolved>
                                    <version>2.4</version>
                    <version>2.4.1</version>
                                    <fixVersion>2.5</fixVersion>
                                    <component>Appenders</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14993348" author="mikaelstaldal" created="Fri, 6 Nov 2015 08:31:48 +0000"  >&lt;p&gt;Can you share the source code for &lt;tt&gt;com.example.inceptiontest.TestSerializer&lt;/tt&gt;?&lt;/p&gt;</comment>
                            <comment id="14993349" author="mikaelstaldal" created="Fri, 6 Nov 2015 08:35:16 +0000"  >&lt;p&gt;And may I ask why you use a custom Kafka serializer here (rather than using the default &lt;tt&gt;org.apache.kafka.common.serialization.ByteArraySerializer&lt;/tt&gt;)?&lt;/p&gt;</comment>
                            <comment id="14994291" author="melvinclanceydu" created="Fri, 6 Nov 2015 19:33:31 +0000"  >&lt;p&gt;Hi Mikael,&lt;br/&gt;
Here&apos;s the serializer code:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;TestSerializer &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; ByteArraySerializer {

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] serialize(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; topic, &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] data) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (data == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
        }
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(data);
            LogEvent logEvent = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.deserializeLogEvent(data);
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(logEvent);
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;error happened&quot;&lt;/span&gt;);
            e.printStackTrace();
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (ClassNotFoundException e) {
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;error happened&quot;&lt;/span&gt;);
            e.printStackTrace();
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.serialize(topic, data);
    }


    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; LogEvent deserializeLogEvent(&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] data) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException, ClassNotFoundException {
        ByteArrayInputStream bis = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ByteArrayInputStream(data);
        ObjectInput ois = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ObjectInputStream(bis);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; (LogEvent) ois.readObject();

    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;m new to log4j2, so initially I wanted to format  the LogEvent in the kafka serializer before emitting its contents. My previous plan was to use the serializedlayout to transmit the LogEvent object to the serializer, which would extract information from the object. I&apos;ve since moved to using a custom Layout to perform the formatting, and will use the straightforward kafka ByteArraySerializer on the results of the layout.&lt;/p&gt;

&lt;p&gt;I came across this issue in my first approach, which I&apos;m no longer using - feel free to downgrade this ticket priority.&lt;/p&gt;</comment>
                            <comment id="15031539" author="mikaelstaldal" created="Mon, 30 Nov 2015 09:25:12 +0000"  >&lt;p&gt;This is fixed, please verify and close.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12638688">LOG4J2-181</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 51 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2o0s7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>