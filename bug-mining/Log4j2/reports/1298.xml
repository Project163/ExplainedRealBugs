<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:40:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-2061] RollingFileManager not removed when RollingFileAppender is stopped, using DirectWriteRolloverStrategy</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-2061</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;When programmatically creating an instance of RollingFileAppender using RollingFileAppender.newBuilder.(config options).build(), an instance of RollingFileManager is created in AbstractManager.getManager(...), and this instance is stored in the hashmap AbstractManager.MAP as well as on the instance of RollingFileAppender in the super class AbstractOutputStreamAppender. This manager is created and stored in the AbstractManager.MAP with the name FILE_PATTERN (since we cannot create an instance of RollingFileAppender with a file name using the DirectWriteRolloverStrategy). However, the same manager is created with a NAME of NULL since it is trying to use file name as the name of the manager, but this parameter is not allowed using DirectWriteRolloverStrategy. &lt;/p&gt;

&lt;p&gt;The problem here is that the RollingFileManager is created with a name of FILE NAME (i.e., NULL when using DirectWriteRolloverStrategy) and added to the hashmap with a key of FILE PATTERN, but when the rolling file appender is stopped, it attempts to remove its manager from this MAP using RollingFileManager.name, which equates to FILE NAME which is NULL.&lt;/p&gt;

&lt;p&gt;Consider the following example:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;create a rolling file appender using the DirectWriteRolloverStrategy with a file pattern of &apos;output.%i.log&apos;&lt;/li&gt;
	&lt;li&gt;a RollingFileManager is created with the name NULL, but put in AbstractManager.MAP with the name &apos;output.%i.log&apos;&lt;/li&gt;
	&lt;li&gt;the rolling file appender is used to write a few line of log file&lt;/li&gt;
	&lt;li&gt;the rolling file appender is stopped using RollingFileAppender.stop(..)&lt;/li&gt;
	&lt;li&gt;the RollingFileManager is NOT removed from AbstractManager.MAP since it is trying to remove FILE NAME but it is keyed on FILE PATTERN&lt;/li&gt;
	&lt;li&gt;a NEW instance of rolling file appender is created using the DirectWriteRolloverStrategy with the SAME file pattern of &apos;output.%i.log&apos;.&lt;/li&gt;
	&lt;li&gt;a new instance of RollingFileManager is NOT created, as it already exists in the MAP, so the old instance is simply returned&lt;/li&gt;
	&lt;li&gt;the instance of RollingFileManager for the new instance of RollingFileAppender has a closed output stream, meaning that no logging is possible.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;In the above example you can see that if the old rolling file appender&apos;s output stream is closed, and a new instance created with the same file pattern, then the old manager will be used. I see no easy way of recreating this output stream.&lt;/p&gt;

&lt;p&gt;I found no documentation regarding why one cannot set the FILE NAME for a RollingFileAppender using DirectWriteRolloverStrategy. Being able to configure this may also solve the problem (unless it causes issues elsewhere), but another possible fix to this issue is to create the RollingFileManager with the name FILE PATTERN when using the DirectWriteRolloverStrategy. This way we add to the MAP the instance of RollingFileManager with the key FILE PATTERN, and we remove from the MAP RollingFileManager.name which equals FILE PATTERN&lt;/p&gt;</description>
                <environment>&lt;p&gt;*&lt;/p&gt;</environment>
        <key id="13106009">LOG4J2-2061</key>
            <summary>RollingFileManager not removed when RollingFileAppender is stopped, using DirectWriteRolloverStrategy</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rgoers">Ralph Goers</assignee>
                                    <reporter username="matthewhill">Matthew Hill</reporter>
                        <labels>
                    </labels>
                <created>Fri, 29 Sep 2017 10:42:29 +0000</created>
                <updated>Sat, 2 Feb 2019 23:37:45 +0000</updated>
                            <resolved>Sat, 2 Feb 2019 23:37:45 +0000</resolved>
                                    <version>2.9.0</version>
                                    <fixVersion>2.11.2</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16199534" author="garydgregory" created="Tue, 10 Oct 2017 23:08:24 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=matthewhill&quot; class=&quot;user-hover&quot; rel=&quot;matthewhill&quot;&gt;matthewhill&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Are you able to provide a unit test that reproduces the problem? This ticket is more likely to get some attention with some test code attached &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Thank you!&lt;br/&gt;
Gary&lt;/p&gt;</comment>
                            <comment id="16200248" author="matthewhill" created="Wed, 11 Oct 2017 13:10:19 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garydgregory&quot; class=&quot;user-hover&quot; rel=&quot;garydgregory&quot;&gt;garydgregory&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Please see attached a sample junit that shows the issue. The comments within the junit show what is expected and what actually happens.&lt;/p&gt;

&lt;p&gt;Regards&lt;br/&gt;
Matthew&lt;/p&gt;</comment>
                            <comment id="16389224" author="matthewhill" created="Wed, 7 Mar 2018 08:12:48 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garydgregory&quot; class=&quot;user-hover&quot; rel=&quot;garydgregory&quot;&gt;garydgregory&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Has there been any progress on this issue?&lt;/p&gt;</comment>
                            <comment id="16393684" author="garydgregory" created="Fri, 9 Mar 2018 22:11:59 +0000"  >&lt;p&gt;I have not looked at it. We are all volunteers here &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16394622" author="ralph.goers@dslextreme.com" created="Sun, 11 Mar 2018 19:43:04 +0000"  >&lt;p&gt;You cannot set the file name when using DirectWriteRolloverStrategy because it doesn&apos;t make sense. You are trying to directly write to each &quot;rolled-over&quot; file, all of which match the file pattern. Were it to write to the file name then it would just overwrite the same file on every rollover.&lt;/p&gt;</comment>
                            <comment id="16598397" author="matthewhill" created="Fri, 31 Aug 2018 08:04:08 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ralph.goers%40dslextreme.com&quot; class=&quot;user-hover&quot; rel=&quot;ralph.goers@dslextreme.com&quot;&gt;ralph.goers@dslextreme.com&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I may be misunderstanding something, but having a look at the build() method of&#160;RollingFileAppender it will log an error and return early if getName() is NULL. While I did find it strange that I had to set a file pattern as well as a file name, the assert of file name does not depend on the strategy (unless of course this was changed in a more recent version, I&apos;m still using v2.9.0).&#160;&lt;/p&gt;</comment>
                            <comment id="16598958" author="ralph.goers@dslextreme.com" created="Fri, 31 Aug 2018 16:13:10 +0000"  >&lt;p&gt;getName() is the name of the appender, not the file name. The appender has to have a name.&lt;/p&gt;</comment>
                            <comment id="16759238" author="ralph.goers@dslextreme.com" created="Sat, 2 Feb 2019 23:37:45 +0000"  >&lt;p&gt;I incorporated the unit test you provided and it now passes. Please verify and close.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12891476" name="Log4jIssue.zip" size="1916992" author="matthewhill" created="Wed, 11 Oct 2017 13:10:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 41 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3kpif:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>