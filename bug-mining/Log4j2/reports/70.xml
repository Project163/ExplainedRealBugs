<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:30:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-159] log4j.xml loading from classpath not working correct in osgi environment</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-159</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;I have problems while loading log4j.xml configuration file in osgi environment. &lt;/p&gt;

&lt;p&gt;I have the following started equinox container: &lt;/p&gt;

&lt;p&gt;+--------------------------------------------------------------------------------------------------------------------------------&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; osgi&amp;gt; ss log4j&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Framework is launched.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; id	State Bundle&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 58	RESOLVED my.log4j.xml.fragment&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Master=136&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 136	RESOLVED org.apache.commons.log4j-api_2.0.0.beta3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Fragments=58&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 137	RESOLVED org.apache.commons.log4j-core_2.0.0.beta3 &lt;br/&gt;
+--------------------------------------------------------------------------------------------------------------------------------&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;The log4j2 config file is packaged under my.log4j.xml.fragment.jar/log4j.xml. &lt;/p&gt;

&lt;p&gt;If I have the upper bundle-configuration &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;than the following output happens:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;+--------------------------------------------------------------------------------------------------------------------------------&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; ERROR StatusLogger Unable to locate a logging implementation, using SimpleLogger&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; FATAL Log4j_2 log4j-2.0.x logging&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; ERROR Log4j_2 log4j-2.0.x logging &lt;br/&gt;
+--------------------------------------------------------------------------------------------------------------------------------&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;&lt;b&gt;QUICKFIX&lt;/b&gt; If I update the org.apache.commons.log4j-core_2.0.0.beta3.jar!/META-INF/MANIFEST.MF &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;append: Fragment-Host: org.apache.commons.log4j-api&lt;/li&gt;
	&lt;li&gt;than log4j2 configuration is loaded and work.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;+--------------------------------------------------------------------------------------------------------------------------------&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; osgi&amp;gt; ss log4j&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Framework is launched.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; id	State Bundle&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 58	RESOLVED my.log4j.xml.fragment&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Master=136&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 136	RESOLVED org.apache.commons.log4j-api_2.0.0.beta3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Fragments=58, 137&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 137	RESOLVED org.apache.commons.log4j-core_2.0.0.beta3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Master=136 &lt;br/&gt;
+--------------------------------------------------------------------------------------------------------------------------------&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</description>
                <environment>&lt;p&gt;win7, eclipse 3.7 64bit&lt;/p&gt;</environment>
        <key id="12629859">LOG4J2-159</key>
            <summary>log4j.xml loading from classpath not working correct in osgi environment</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="5" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Trivial</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="4">Incomplete</resolution>
                                        <assignee username="rgoers">Ralph Goers</assignee>
                                    <reporter username="jwausle">Jan Winter</reporter>
                        <labels>
                    </labels>
                <created>Wed, 30 Jan 2013 09:23:54 +0000</created>
                <updated>Sun, 12 Jun 2016 03:25:31 +0000</updated>
                            <resolved>Sun, 12 Jun 2016 03:25:31 +0000</resolved>
                                    <version>2.0-beta3</version>
                    <version>2.0-rc1</version>
                                    <fixVersion>2.3</fixVersion>
                                    <component>API</component>
                    <component>Core</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13591926" author="ralph.goers@dslextreme.com" created="Mon, 4 Mar 2013 01:02:16 +0000"  >&lt;p&gt;Fixed in revision 1452163. Fragment-Host was added to the MANIFEST.MF for log4j2-core. Please verify and close.&lt;/p&gt;</comment>
                            <comment id="13649029" author="rwk" created="Sat, 4 May 2013 07:00:29 +0000"  >&lt;p&gt;The fix ends up being incorrect &amp;#8211; I suspect due to other activity in the meantime.&lt;/p&gt;

&lt;p&gt;I had to change the Fragment-Host: header to:&lt;/p&gt;

&lt;p&gt;Fragment-Host: org.apache.logging.log4j-api;bundle-version=2.0.0.beta5&lt;br/&gt;
to match the ID and version of the beta5 API bundle.&lt;/p&gt;

&lt;p&gt;I can verify it working with that modification (and some others I&apos;ll report separately).&lt;/p&gt;</comment>
                            <comment id="13649036" author="ralph.goers@dslextreme.com" created="Sat, 4 May 2013 07:44:17 +0000"  >&lt;p&gt;New patch applied in revision  1479054 which uses OSGi format version number in Fragment-Host. Please verify and close.&lt;/p&gt;</comment>
                            <comment id="13649162" author="rwk" created="Sat, 4 May 2013 20:33:08 +0000"  >&lt;p&gt;Sorry, I have to retract my prior verification &amp;#8211; it was a testing failure &amp;#8211; I was expecting one of my Junit tests to pick up the unintended output, rather than inspecting it myself.&lt;/p&gt;

&lt;p&gt;I don&apos;t think this can work as intended. Making it a fragment unifies the classloaders of core and API, but API isn&apos;t where the configuration files will reside.&lt;/p&gt;

&lt;p&gt;I think what it should do is:&lt;/p&gt;

&lt;p&gt;1) remove the Fragment-Host: header.&lt;br/&gt;
2) Try the thread context classloader.&lt;br/&gt;
3) Walk up the stack, trying each classloader encountered in turn, until we find a configuration.&lt;br/&gt;
4) Fail if none found.&lt;/p&gt;

&lt;p&gt;The tries in 2-3 would each be one iteration of the current check (including trying to use the system property &amp;#8211; it may only be available in one of the classloaders).&lt;/p&gt;

&lt;p&gt;The search could be reversed, giving preference to the outermost layer to control logging. This has its merits, but the code that&apos;s closer to the actual use of the API is more likely to supply a compatible configuration. A more complete solution might be to merge them somehow.&lt;/p&gt;

&lt;p&gt;But I vote for the initial pass to be inner-to-outer. You can get the reverse result by supplying your own thread context classloader to take control.&lt;/p&gt;

&lt;p&gt;It&apos;s worth noting that Eclipse supplies a thread context classloader that does a similar search. But I think we should do our own, for the cases where the thread context classloader has been replaced, and does not locate a configuration.&lt;/p&gt;

&lt;p&gt;I&apos;ll see about pulling the sources and coming up with a tested patch later this weekend.&lt;/p&gt;</comment>
                            <comment id="13649201" author="ralph.goers@dslextreme.com" created="Sat, 4 May 2013 23:17:42 +0000"  >&lt;p&gt;Reopening based on feedback.&lt;/p&gt;</comment>
                            <comment id="13651708" author="rwk" created="Wed, 8 May 2013 08:33:23 +0000"  >&lt;p&gt;Draft patch for this and &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-238&quot; title=&quot;OSGi dependency failures in core&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-238&quot;&gt;&lt;del&gt;LOG4J2-238&lt;/del&gt;&lt;/a&gt; uploaded to &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-238&quot; title=&quot;OSGi dependency failures in core&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-238&quot;&gt;&lt;del&gt;LOG4J2-238&lt;/del&gt;&lt;/a&gt; for preliminary review.&lt;/p&gt;</comment>
                            <comment id="13741088" author="rol" created="Thu, 15 Aug 2013 15:47:23 +0000"  >&lt;p&gt;I have the same problem with beta9, that&apos;s why I started a discussion about the topic: &lt;a href=&quot;http://apache-logging.6191.n7.nabble.com/Discussion-about-correct-initialization-of-log4j2-in-OSGi-context-td39733.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://apache-logging.6191.n7.nabble.com/Discussion-about-correct-initialization-of-log4j2-in-OSGi-context-td39733.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15029491" author="ralph.goers@dslextreme.com" created="Fri, 27 Nov 2015 06:05:10 +0000"  >&lt;p&gt;Is this still an issue?&lt;/p&gt;</comment>
                            <comment id="15326162" author="ralph.goers@dslextreme.com" created="Sun, 12 Jun 2016 03:25:31 +0000"  >&lt;p&gt;Closing this issue due to lack of feedback.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311120" key="com.pyxis.greenhopper.jira:gh-epic-link">
                        <customfieldname>Epic Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>LOG4J2-515</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>310355</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 23 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1hk7r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>310700</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>