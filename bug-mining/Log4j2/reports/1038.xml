<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:38:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-1753] java.lang.ClassNotFoundException: org.apache.logging.log4j.core.util.ExecutorServices when running the OSGi tests</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-1753</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;When running the OSGi tests for &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1664&quot; title=&quot;Improve OSGi unit tests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1664&quot;&gt;&lt;del&gt;LOG4J2-1664&lt;/del&gt;&lt;/a&gt;, a new java.lang.ClassNotFoundException: org.apache.logging.log4j.core.util.ExecutorServices (for both Felix and Equinox) appeared recently.&lt;/p&gt;

&lt;p&gt;Here is the Felix stack trace:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ERROR StatusLogger Failed to preload ExecutorServices class.
 java.lang.ClassNotFoundException: *** Class &apos;org.apache.logging.log4j.core.util.ExecutorServices&apos; was not found because bundle org.apache.logging.log4j.api [1] does not import &apos;org.apache.logging.log4j.core.util&apos; even though bundle org.apache.logging.log4j.core [2] does export it. To resolve this issue, add an import for &apos;org.apache.logging.log4j.core.util&apos; to bundle org.apache.logging.log4j.api [1]. ***
	at org.apache.felix.framework.BundleWiringImpl$BundleClassLoader.loadClass(BundleWiringImpl.java:2011)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:357)
	at java.lang.Class.forName0(Native Method)
	at java.lang.Class.forName(Class.java:264)
	at org.apache.logging.log4j.util.LoaderUtil.loadClass(LoaderUtil.java:141)
	at org.apache.logging.log4j.core.LoggerContext.&amp;lt;clinit&amp;gt;(LoggerContext.java:74)
	at org.apache.logging.log4j.core.osgi.BundleContextSelector.locateContext(BundleContextSelector.java:67)
	at org.apache.logging.log4j.core.osgi.BundleContextSelector.getContext(BundleContextSelector.java:53)
	at org.apache.logging.log4j.core.selector.ClassLoaderContextSelector.getContext(ClassLoaderContextSelector.java:57)
	at org.apache.logging.log4j.core.impl.Log4jContextFactory.getContext(Log4jContextFactory.java:147)
	at org.apache.logging.log4j.core.impl.Log4jContextFactory.getContext(Log4jContextFactory.java:45)
	at org.apache.logging.log4j.LogManager.getContext(LogManager.java:194)
	at org.apache.logging.log4j.LogManager.getLogger(LogManager.java:551)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.logging.log4j.osgi.tests.AbstractLoadBundleTest.log(AbstractLoadBundleTest.java:100)
	at org.apache.logging.log4j.osgi.tests.AbstractLoadBundleTest.testSimpleLogInAnOsgiContext(AbstractLoadBundleTest.java:279)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
	at org.junit.rules.ExternalResource$1.evaluate(ExternalResource.java:48)
	at org.junit.rules.RunRules.evaluate(RunRules.java:20)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
	at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:367)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:274)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:238)
	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:161)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:290)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:242)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:121)
Caused by: java.lang.ClassNotFoundException: org.apache.logging.log4j.core.util.ExecutorServices not found by org.apache.logging.log4j.api [1]
	at org.apache.felix.framework.BundleWiringImpl.findClassOrResourceByDelegation(BundleWiringImpl.java:1558)
	at org.apache.felix.framework.BundleWiringImpl.access$400(BundleWiringImpl.java:79)
	at org.apache.felix.framework.BundleWiringImpl$BundleClassLoader.loadClass(BundleWiringImpl.java:1998)
	... 45 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13030749">LOG4J2-1753</key>
            <summary>java.lang.ClassNotFoundException: org.apache.logging.log4j.core.util.ExecutorServices when running the OSGi tests</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="lhochet">Ludovic HOCHET</reporter>
                        <labels>
                    </labels>
                <created>Tue, 27 Dec 2016 18:04:07 +0000</created>
                <updated>Sun, 12 Mar 2017 20:11:07 +0000</updated>
                            <resolved>Sun, 12 Mar 2017 17:58:12 +0000</resolved>
                                                    <fixVersion>2.8.1</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="15781003" author="lhochet" created="Tue, 27 Dec 2016 18:36:27 +0000"  >&lt;p&gt;From the stack trace, org.apache.logging.log4j.core.util.ExecutorServices is requested by&lt;br/&gt;
org.apache.logging.log4j.core.LoggerContext.&amp;lt;clinit&amp;gt;(LoggerContext.java:74), the code being introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1642&quot; title=&quot;DefaultShutdownCallbackRegistry can throw a NoClassDefFoundError&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1642&quot;&gt;&lt;del&gt;LOG4J2-1642&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;A possible patch (patch-log4j2-1753.diff), as suggested by Felix error message, is to add an import for org.apache.logging.log4j.core.util to the log4j-api pom.&lt;/p&gt;</comment>
                            <comment id="15781050" author="ralphgoers" created="Tue, 27 Dec 2016 18:58:44 +0000"  >&lt;p&gt;In looking at your patch it appears that log4j-api already expresses a dependency on core.osgi?  I find osgi so confusing as I have no idea how the api can be dependent on the implementation of the api.&lt;/p&gt;</comment>
                            <comment id="15781531" author="lhochet" created="Tue, 27 Dec 2016 23:38:29 +0000"  >&lt;p&gt;The optional import of core.osgi is the result of &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-920&quot; title=&quot;ClassNotFoundException for BundleContextSelector when initialising in an OSGi environment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-920&quot;&gt;&lt;del&gt;LOG4J2-920&lt;/del&gt;&lt;/a&gt;, which was similar to the current issue: a class defined in Core is being instantiated from API, in order for that to happen the package where it is defined need first to be exported from Core then imported in API.&lt;/p&gt;

&lt;p&gt;More precisely, the code calls LoaderUtil::loadClass in API, and within that method it tries to load the class from the ThreadContextClassLoader and fails (for the tests nor the &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-920&quot; title=&quot;ClassNotFoundException for BundleContextSelector when initialising in an OSGi environment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-920&quot;&gt;&lt;del&gt;LOG4J2-920&lt;/del&gt;&lt;/a&gt; test app it is the application class loader, ie the class path which does not have the Log4J classes), it then tries Class.forName(className) which will use the class loader for LoaderUtil that is it will use the class loader for the API bundle and therefore will need to import the package containing the class.&lt;/p&gt;

&lt;p&gt;An alternative could be to use Class.forName(className, true, classLoaderFromTheBundleThatContainClassName) but that would require to identify the bundle from which to load className.&lt;/p&gt;

&lt;p&gt;Other alternatives may be to look at Java services (java.util.ServiceLoader) and OSGi services.&lt;/p&gt;</comment>
                            <comment id="15781675" author="jvz" created="Wed, 28 Dec 2016 00:50:18 +0000"  >&lt;p&gt;The ServiceLoader route might be more useful as it&apos;ll work with JDK9 modules far more easily than TCCL hacks.&lt;/p&gt;</comment>
                            <comment id="15781678" author="jvz" created="Wed, 28 Dec 2016 00:52:10 +0000"  >&lt;p&gt;The main confusion here is that in a normal OSGi environment, log4j-api and log4j-core would have different ClassLoaders, and the ClassLoader set to the current thread (the TCCL) tends to be set to seemingly random ClassLoaders based on what code is executing. Generally, you want to get the ClassLoader from a class in the jar you&apos;re looking at, but that&apos;s not always possible.&lt;/p&gt;</comment>
                            <comment id="15782103" author="ralphgoers" created="Wed, 28 Dec 2016 05:28:09 +0000"  >&lt;p&gt;The part I don&apos;t get is that I would think that this means anyone using OSGi is not allowed to create their own Log4j implemenation.&lt;/p&gt;</comment>
                            <comment id="15782150" author="remkop@yahoo.com" created="Wed, 28 Dec 2016 05:57:57 +0000"  >&lt;p&gt;Punishment doesn&apos;t fit the crime? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
Too light or too severe? :-D&lt;/p&gt;</comment>
                            <comment id="15782165" author="jvz" created="Wed, 28 Dec 2016 06:04:24 +0000"  >&lt;p&gt;I think that&apos;s a problem with the current workaround, and I mentioned that in &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-920&quot; title=&quot;ClassNotFoundException for BundleContextSelector when initialising in an OSGi environment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-920&quot;&gt;&lt;del&gt;LOG4J2-920&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15894030" author="rgansevles" created="Fri, 3 Mar 2017 09:57:41 +0000"  >&lt;p&gt;This issue is still has status OPEN, but it seems the proposed patch is applied in 2.8.1 via commit &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;a=commit;h=f34bb43321e3ff2b22492e51d5a38709f4d9e1e9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;a=commit;h=f34bb43321e3ff2b22492e51d5a38709f4d9e1e9&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="15900686" author="jvz" created="Wed, 8 Mar 2017 04:33:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhochet&quot; class=&quot;user-hover&quot; rel=&quot;lhochet&quot;&gt;lhochet&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garydgregory&quot; class=&quot;user-hover&quot; rel=&quot;garydgregory&quot;&gt;garydgregory&lt;/a&gt;: do you feel that this issue was fixed? I know there are still open questions about handling this better, but can the issue be resolved?&lt;/p&gt;</comment>
                            <comment id="15900861" author="garydgregory" created="Wed, 8 Mar 2017 07:45:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jvz&quot; class=&quot;user-hover&quot; rel=&quot;jvz&quot;&gt;jvz&lt;/a&gt; The tests pass now so that solves the reported issue. Let&apos;s see what &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhochet&quot; class=&quot;user-hover&quot; rel=&quot;lhochet&quot;&gt;lhochet&lt;/a&gt; says.&lt;/p&gt;</comment>
                            <comment id="15906608" author="lhochet" created="Sun, 12 Mar 2017 17:58:12 +0000"  >&lt;p&gt;I agree the commit fixes the issue I reported and now the OSGi tests are passing. Therefore I&apos;m closing this issue.&lt;/p&gt;</comment>
                            <comment id="15906675" author="jira-bot" created="Sun, 12 Mar 2017 20:11:07 +0000"  >&lt;p&gt;Commit 4e1f798ccc2de63054a22f30fa9508bc55139577 in logging-log4j2&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jvz&quot; class=&quot;user-hover&quot; rel=&quot;jvz&quot;&gt;jvz&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=4e1f798&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=4e1f798&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Add changelog entry for &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1753&quot; title=&quot;java.lang.ClassNotFoundException: org.apache.logging.log4j.core.util.ExecutorServices when running the OSGi tests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1753&quot;&gt;&lt;del&gt;LOG4J2-1753&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This was fixed in 2.8.1, but no changelog entry was ever added.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12844812" name="patch-log4j2-1753.diff" size="572" author="lhochet" created="Tue, 27 Dec 2016 18:36:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 36 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i381p3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>