<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:38:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-1934] JMS Appender does not know how to recover from a broken connection</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-1934</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;If a broker, like ActiveMQ goes up, down, and up. Log4j gives me:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2017-06-06 18:26:58,396 HPM-ListeningIoReactor 4 ERROR An exception occurred processing Appender ActiveMQ org.apache.logging.log4j.core.appender.AppenderLoggingException: javax.jms.IllegalStateException: The Session is closed
	at org.apache.logging.log4j.core.appender.mom.JmsAppender.append(JmsAppender.java:69)
	at org.apache.logging.log4j.core.config.AppenderControl.tryCallAppender(AppenderControl.java:156)
	at org.apache.logging.log4j.core.config.AppenderControl.callAppender0(AppenderControl.java:129)
	at org.apache.logging.log4j.core.config.AppenderControl.callAppenderPreventRecursion(AppenderControl.java:120)
	at org.apache.logging.log4j.core.config.AppenderControl.callAppender(AppenderControl.java:84)
	at org.apache.logging.log4j.core.config.LoggerConfig.callAppenders(LoggerConfig.java:448)
	at org.apache.logging.log4j.core.config.LoggerConfig.processLogEvent(LoggerConfig.java:433)
	at org.apache.logging.log4j.core.config.LoggerConfig.log(LoggerConfig.java:417)
	at org.apache.logging.log4j.core.config.LoggerConfig.log(LoggerConfig.java:403)
	at org.apache.logging.log4j.core.config.AwaitCompletionReliabilityStrategy.log(AwaitCompletionReliabilityStrategy.java:63)
	at org.apache.logging.log4j.core.Logger.logMessage(Logger.java:146)
	at org.apache.logging.log4j.spi.AbstractLogger.logMessageSafely(AbstractLogger.java:2091)
	at org.apache.logging.log4j.spi.AbstractLogger.logIfEnabled(AbstractLogger.java:1813)
	at org.apache.logging.log4j.spi.AbstractLogger.info(AbstractLogger.java:1267)
	&amp;gt;SNIP&amp;lt;
	at org.apache.http.nio.protocol.HttpAsyncService.requestReceived(HttpAsyncService.java:338)
	at org.apache.http.impl.nio.DefaultNHttpServerConnection.consumeInput(DefaultNHttpServerConnection.java:273)
	at org.apache.http.impl.nio.DefaultHttpServerIODispatch.onInputReady(DefaultHttpServerIODispatch.java:158)
	at org.apache.http.impl.nio.DefaultHttpServerIODispatch.onInputReady(DefaultHttpServerIODispatch.java:52)
	at org.apache.http.impl.nio.reactor.AbstractIODispatch.inputReady(AbstractIODispatch.java:114)
	at org.apache.http.impl.nio.reactor.BaseIOReactor.readable(BaseIOReactor.java:162)
	at org.apache.http.impl.nio.reactor.AbstractIOReactor.processEvent(AbstractIOReactor.java:337)
	at org.apache.http.impl.nio.reactor.AbstractIOReactor.processEvents(AbstractIOReactor.java:315)
	at org.apache.http.impl.nio.reactor.AbstractIOReactor.execute(AbstractIOReactor.java:276)
	at org.apache.http.impl.nio.reactor.BaseIOReactor.execute(BaseIOReactor.java:104)
	at org.apache.http.impl.nio.reactor.AbstractMultiworkerIOReactor$Worker.run(AbstractMultiworkerIOReactor.java:588)
	at java.lang.Thread.run(Unknown Source)
Caused by: javax.jms.IllegalStateException: The Session is closed
	at org.apache.activemq.ActiveMQSession.checkClosed(ActiveMQSession.java:771)
	at org.apache.activemq.ActiveMQSession.configureMessage(ActiveMQSession.java:759)
	at org.apache.activemq.ActiveMQSession.createMapMessage(ActiveMQSession.java:338)
	at org.apache.logging.log4j.core.appender.mom.JmsManager.createMessage(JmsManager.java:136)
	at org.apache.logging.log4j.core.appender.mom.JmsAppender.append(JmsAppender.java:65)
	... 28 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I plan on fixing that ASAP.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13077856">LOG4J2-1934</key>
            <summary>JMS Appender does not know how to recover from a broken connection</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ggregory">Gary D. Gregory</assignee>
                                    <reporter username="ggregory">Gary D. Gregory</reporter>
                        <labels>
                    </labels>
                <created>Wed, 7 Jun 2017 01:41:57 +0000</created>
                <updated>Fri, 7 Jul 2017 21:56:10 +0000</updated>
                            <resolved>Mon, 26 Jun 2017 01:59:45 +0000</resolved>
                                    <version>2.8.2</version>
                                    <fixVersion>2.9.0</fixVersion>
                                    <component>Appenders</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16041816" author="jvz" created="Wed, 7 Jun 2017 22:48:12 +0000"  >&lt;p&gt;As a workaround, can&apos;t you use a failover broker URL when connecting to ActiveMQ to allow the driver to auto-reconnect?&lt;/p&gt;</comment>
                            <comment id="16062141" author="jira-bot" created="Sat, 24 Jun 2017 21:28:18 +0000"  >&lt;p&gt;Commit c9ae6a85f46c5083f5b63c3442afd4e778291429 in logging-log4j2&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garydgregory&quot; class=&quot;user-hover&quot; rel=&quot;garydgregory&quot;&gt;garydgregory&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=c9ae6a8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=c9ae6a8&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1934&quot; title=&quot;JMS Appender does not know how to recover from a broken connection&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1934&quot;&gt;&lt;del&gt;LOG4J2-1934&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
JMS Appender does not know how to recover from a broken connection.&lt;br/&gt;
Refactor JMS Appender tests for Apache ActiveMQ and add new tests that&lt;br/&gt;
demonstrate the issue. Failing tests are annotated with @Ignore.&lt;/p&gt;</comment>
                            <comment id="16062481" author="jira-bot" created="Mon, 26 Jun 2017 01:58:25 +0000"  >&lt;p&gt;Commit 8573c8e563c2b734f17e6c7f4a141b7cfb80a286 in logging-log4j2&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garydgregory&quot; class=&quot;user-hover&quot; rel=&quot;garydgregory&quot;&gt;garydgregory&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=8573c8e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=8573c8e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1934&quot; title=&quot;JMS Appender does not know how to recover from a broken connection&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1934&quot;&gt;&lt;del&gt;LOG4J2-1934&lt;/del&gt;&lt;/a&gt; JMS Appender does not know how to recover from a broken&lt;br/&gt;
connection.&lt;/p&gt;</comment>
                            <comment id="16062484" author="garydgregory" created="Mon, 26 Jun 2017 01:59:45 +0000"  >&lt;p&gt;I am looking for a code review from the community. I&apos;ve written new tests to match the main reconnect aspect of this feature but more eyes on this would be nice.&lt;/p&gt;</comment>
                            <comment id="16062486" author="jira-bot" created="Mon, 26 Jun 2017 02:08:40 +0000"  >&lt;p&gt;Commit 19b20c0e75f71de5d5d04f6e1a4878249e88c81d in logging-log4j2&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garydgregory&quot; class=&quot;user-hover&quot; rel=&quot;garydgregory&quot;&gt;garydgregory&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=19b20c0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=19b20c0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1934&quot; title=&quot;JMS Appender does not know how to recover from a broken connection&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1934&quot;&gt;&lt;del&gt;LOG4J2-1934&lt;/del&gt;&lt;/a&gt; JMS Appender does not know how to recover from a broken&lt;br/&gt;
connection. Remove incorrect comment.&lt;/p&gt;</comment>
                            <comment id="16067595" author="jira-bot" created="Thu, 29 Jun 2017 02:12:59 +0000"  >&lt;p&gt;Commit 5d1b605d922d37c02afdd656ccdb4afae2864cd0 in logging-log4j2&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garydgregory&quot; class=&quot;user-hover&quot; rel=&quot;garydgregory&quot;&gt;garydgregory&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=5d1b605&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=5d1b605&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1934&quot; title=&quot;JMS Appender does not know how to recover from a broken connection&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1934&quot;&gt;&lt;del&gt;LOG4J2-1934&lt;/del&gt;&lt;/a&gt; JMS Appender does not know how to recover from a broken&lt;br/&gt;
connection.&lt;/p&gt;</comment>
                            <comment id="16068508" author="jira-bot" created="Thu, 29 Jun 2017 15:50:24 +0000"  >&lt;p&gt;Commit 5d1b605d922d37c02afdd656ccdb4afae2864cd0 in logging-log4j2&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1958&quot; title=&quot;Deprecate SerializedLayout and remove it as default&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1958&quot;&gt;&lt;del&gt;LOG4J2-1958&lt;/del&gt;&lt;/a&gt; from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garydgregory&quot; class=&quot;user-hover&quot; rel=&quot;garydgregory&quot;&gt;garydgregory&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=5d1b605&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=5d1b605&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1934&quot; title=&quot;JMS Appender does not know how to recover from a broken connection&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1934&quot;&gt;&lt;del&gt;LOG4J2-1934&lt;/del&gt;&lt;/a&gt; JMS Appender does not know how to recover from a broken&lt;br/&gt;
connection.&lt;/p&gt;</comment>
                            <comment id="16068545" author="ralph.goers@dslextreme.com" created="Thu, 29 Jun 2017 16:15:31 +0000"  >&lt;p&gt;I just took a look at the commit and I do NOT like this change. As I expected from your description you are creating new managers in the appender to reconnect. The responsibility for reconnecting should reside inside the manager, not in the Appender. Please redo it.&lt;/p&gt;</comment>
                            <comment id="16068686" author="garydgregory" created="Thu, 29 Jun 2017 17:44:19 +0000"  >&lt;p&gt;Hi Ralph,&lt;/p&gt;

&lt;p&gt;Thank you for the review.&lt;/p&gt;

&lt;p&gt;My motivation for the current solution was to implement this in a somewhat symmetrical way to reconfigure:&lt;/p&gt;

&lt;p&gt;Reconfigure: throw away the Appender and reuse the cached Manager.&lt;/p&gt;

&lt;p&gt;Recover: throw away the Manager and reuse the Appender.&lt;/p&gt;

&lt;p&gt;Otherwise, I would just implement a kind of manager inside the Manager...&lt;/p&gt;

&lt;p&gt;Further thoughts?&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;</comment>
                            <comment id="16068785" author="ralph.goers@dslextreme.com" created="Thu, 29 Jun 2017 18:52:41 +0000"  >&lt;p&gt;As I suggested before, take a look at how the TCP Socket Manager handles reconnection.&lt;/p&gt;</comment>
                            <comment id="16069140" author="garydgregory" created="Thu, 29 Jun 2017 22:43:02 +0000"  >&lt;p&gt;I did and I will rewrite the JMS appender.&lt;/p&gt;</comment>
                            <comment id="16075720" author="jira-bot" created="Thu, 6 Jul 2017 00:55:55 +0000"  >&lt;p&gt;Commit de7487ed22b03f5c1a73ddb8f8d0f8bc89b8f4d8 in logging-log4j2&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garydgregory&quot; class=&quot;user-hover&quot; rel=&quot;garydgregory&quot;&gt;garydgregory&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=de7487e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=de7487e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1934&quot; title=&quot;JMS Appender does not know how to recover from a broken connection&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1934&quot;&gt;&lt;del&gt;LOG4J2-1934&lt;/del&gt;&lt;/a&gt; JMS Appender does not know how to recover from a broken&lt;br/&gt;
connection.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1955&quot; title=&quot;JMS Appender should be able connect to a broker (later) even it is not present at configuration time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1955&quot;&gt;&lt;del&gt;LOG4J2-1955&lt;/del&gt;&lt;/a&gt;JMS Appender should be able connect to a broker (later)&lt;br/&gt;
even it is not present at configuration time.&lt;/p&gt;</comment>
                            <comment id="16075723" author="garydgregory" created="Thu, 6 Jul 2017 00:57:50 +0000"  >&lt;p&gt;In Git master: Recoded to follow the Reconnect thread pattern from &lt;tt&gt;TcpSocketManager&lt;/tt&gt;. Looking for a peer-review.&lt;/p&gt;</comment>
                            <comment id="16078526" author="mikaelstaldal" created="Fri, 7 Jul 2017 18:57:11 +0000"  >&lt;p&gt;The documentation should mention the default values for the two new properties on JmsAppender.&lt;/p&gt;</comment>
                            <comment id="16078535" author="mikaelstaldal" created="Fri, 7 Jul 2017 19:07:00 +0000"  >&lt;p&gt;I think the comment on JmsManager.Reconnector is wrong (copy-paste).&lt;/p&gt;</comment>
                            <comment id="16078751" author="jira-bot" created="Fri, 7 Jul 2017 21:55:07 +0000"  >&lt;p&gt;Commit 55f80f35060d60788393714514b1c27aa5773095 in logging-log4j2&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garydgregory&quot; class=&quot;user-hover&quot; rel=&quot;garydgregory&quot;&gt;garydgregory&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=55f80f3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=55f80f3&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1934&quot; title=&quot;JMS Appender does not know how to recover from a broken connection&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1934&quot;&gt;&lt;del&gt;LOG4J2-1934&lt;/del&gt;&lt;/a&gt; JMS Appender does not know how to recover from a broken&lt;br/&gt;
connection.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1955&quot; title=&quot;JMS Appender should be able connect to a broker (later) even it is not present at configuration time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1955&quot;&gt;&lt;del&gt;LOG4J2-1955&lt;/del&gt;&lt;/a&gt;JMS Appender should be able connect to a broker (later)&lt;br/&gt;
even it is not present at configuration time.&lt;/p&gt;</comment>
                            <comment id="16078757" author="garydgregory" created="Fri, 7 Jul 2017 21:55:57 +0000"  >&lt;p&gt;I added a &quot;Default&quot; column to the table for the JMA Appender. Thank you for noticing the missing information &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mikael.staldal%40home.se&quot; class=&quot;user-hover&quot; rel=&quot;mikael.staldal@home.se&quot;&gt;mikael.staldal@home.se&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 19 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3fyjr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>