<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:37:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-1583] Nested logging call disrupts output of outer logging call</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-1583</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;If a call to logger.info() invokes the toString() method on one of its parameters, and that toString() method invokes another method which has another, nested logging call, then the output of the outer call is mangled.&lt;/p&gt;

&lt;p&gt;This can be quite confusing as the nested logging may be conditional, or at DEBUG level, etc.&lt;/p&gt;

&lt;p&gt;Problem &lt;em&gt;appears&lt;/em&gt; to be related to ReusableParameterizedMessage.swapMessage() and the values in indices[].  (It looks inherently non-reentrant.)&lt;/p&gt;</description>
                <environment>&lt;p&gt;JVM 1.8.0_102, MacOS 10.11.6&lt;/p&gt;</environment>
        <key id="13005037">LOG4J2-1583</key>
            <summary>Nested logging call disrupts output of outer logging call</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rpopma">Remko Popma</assignee>
                                    <reporter username="larry_west">Larry West</reporter>
                        <labels>
                    </labels>
                <created>Wed, 14 Sep 2016 23:54:00 +0000</created>
                <updated>Sun, 18 Sep 2016 10:42:08 +0000</updated>
                            <resolved>Sat, 17 Sep 2016 13:06:13 +0000</resolved>
                                    <version>2.6</version>
                    <version>2.6.1</version>
                    <version>2.6.2</version>
                                    <fixVersion>2.7</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15491837" author="larry_west" created="Thu, 15 Sep 2016 00:08:02 +0000"  >&lt;p&gt;Here&apos;s a sample; Maven 3.x.&lt;/p&gt;

&lt;p&gt;Run Log4j2ProblemDemo.main(), no arguments required.&lt;/p&gt;

&lt;p&gt;Same files with directory structure in the bzip2&apos;d tarball&lt;/p&gt;</comment>
                            <comment id="15493286" author="mikaelstaldal" created="Thu, 15 Sep 2016 13:16:28 +0000"  >&lt;p&gt;Are you sure that this problem existed in 2.5? In that case it cannot be due to &lt;tt&gt;ReusableParameterizedMessage&lt;/tt&gt; since that was introduced in 2.6.&lt;/p&gt;</comment>
                            <comment id="15493723" author="remkop@yahoo.com" created="Thu, 15 Sep 2016 15:49:23 +0000"  >&lt;p&gt;Thank you for the report! I will look into it this weekend. &lt;/p&gt;</comment>
                            <comment id="15494962" author="larry_west" created="Fri, 16 Sep 2016 00:31:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mikaza&quot; class=&quot;user-hover&quot; rel=&quot;mikaza&quot;&gt;mikaza&lt;/a&gt; hmm... you&apos;re right. I misread my own sample output: it does not occur with 2.5. I only debugged into the issue while configured for 2.6.2.  Thanks for pointing that out!&lt;/p&gt;

&lt;h4&gt;&lt;a name=&quot;incorrectoutput%7B%7B2.6%7D%7D%2C%7B%7B2.6.1%7D%7D%2C%7B%7B2.6.2%7D%7D&quot;&gt;&lt;/a&gt;incorrect output &lt;tt&gt;2.6&lt;/tt&gt;, &lt;tt&gt;2.6.1&lt;/tt&gt;, &lt;tt&gt;2.6.2&lt;/tt&gt;&lt;/h4&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;17:27:20.711 INFO  [main] problem.demo.apache.log4j2.Log4j2ProblemDemo - getX: values x=3 y=4 z=5
17:27:20.712 INFO  [main] problem.demo.apache.log4j2.Log4j2ProblemDemo - getX: values x=3 y=4 z=5[Thing x=3 y=4 z=5]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;h4&gt;&lt;a name=&quot;correctoutput%7B%7B2.5%7D%7D&quot;&gt;&lt;/a&gt;correct output &lt;tt&gt;2.5&lt;/tt&gt;&lt;/h4&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;17:24:06.298 INFO  [main] problem.demo.apache.log4j2.Log4j2ProblemDemo - getX: values x=3 y=4 z=5
17:24:06.299 INFO  [main] problem.demo.apache.log4j2.Log4j2ProblemDemo - main: argCount=0 it=[Thing x=3 y=4 z=5]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15496229" author="remkop@yahoo.com" created="Fri, 16 Sep 2016 12:35:40 +0000"  >&lt;p&gt;I see the problem. Basically in the current code the same ReusableParameterizedMessage is being used to service both the outer logger call and the logging call in the parameter&apos;s toString() method. &lt;/p&gt;

&lt;p&gt;The correct behaviour is obviously to have separate Message instances for the separate logger calls. I will modify the ReusableMessageFactory to return new messages as long as the reusable message instance is still in use. So the reusable messages will only be reused when it is safe to do so.&lt;/p&gt;</comment>
                            <comment id="15498984" author="remkop@yahoo.com" created="Sat, 17 Sep 2016 13:06:14 +0000"  >&lt;p&gt;Fixed in master in commit ae87a67.&lt;/p&gt;

&lt;p&gt;Please verify and close.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12828558" name="LOG4J-1583.tbz2" size="2221" author="larry_west" created="Thu, 15 Sep 2016 00:08:02 +0000"/>
                            <attachment id="12828556" name="Log4j2ProblemDemo.java" size="1418" author="larry_west" created="Thu, 15 Sep 2016 00:08:02 +0000"/>
                            <attachment id="12828557" name="log4j2.xml" size="694" author="larry_west" created="Thu, 15 Sep 2016 00:08:02 +0000"/>
                            <attachment id="12828555" name="pom.xml" size="655" author="larry_west" created="Thu, 15 Sep 2016 00:08:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311120" key="com.pyxis.greenhopper.jira:gh-epic-link">
                        <customfieldname>Epic Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>LOG4J2-1270</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 9 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i33n8v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>