<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:34:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-1078] GelfLayout throws exception if some log event fields are null</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-1078</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;When log message is null:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2015-07-08 11:07:41,761 ERROR An exception occurred processing Appender Console java.lang.NullPointerException
	at com.fasterxml.jackson.core.io.JsonStringEncoder.quoteAsString(JsonStringEncoder.java:106)
	at org.apache.logging.log4j.core.layout.GelfLayout.toSerializable(GelfLayout.java:217)
	at org.apache.logging.log4j.core.layout.GelfLayout.toByteArray(GelfLayout.java:184)
	at org.apache.logging.log4j.core.appender.AbstractOutputStreamAppender.append(AbstractOutputStreamAppender.java:108)
	at org.apache.logging.log4j.core.config.AppenderControl.callAppender(AppenderControl.java:99)
	at org.apache.logging.log4j.core.config.LoggerConfig.callAppenders(LoggerConfig.java:430)
	at org.apache.logging.log4j.core.config.LoggerConfig.log(LoggerConfig.java:409)
	at org.apache.logging.log4j.core.config.LoggerConfig.log(LoggerConfig.java:367)
	at org.apache.logging.log4j.core.Logger.logMessage(Logger.java:112)
	at org.apache.logging.log4j.spi.AbstractLogger.logMessage(AbstractLogger.java:727)
	at org.apache.logging.log4j.spi.AbstractLogger.logIfEnabled(AbstractLogger.java:716)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12843463">LOG4J2-1078</key>
            <summary>GelfLayout throws exception if some log event fields are null</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="mikaelstaldal">Mikael St&#229;ldal</reporter>
                        <labels>
                    </labels>
                <created>Wed, 8 Jul 2015 09:09:46 +0000</created>
                <updated>Sat, 11 Jul 2015 08:48:46 +0000</updated>
                            <resolved>Wed, 8 Jul 2015 10:09:07 +0000</resolved>
                                    <version>2.3</version>
                                    <fixVersion>2.4</fixVersion>
                                    <component>Layouts</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14618334" author="garydgregory" created="Wed, 8 Jul 2015 10:09:07 +0000"  >&lt;p&gt;Thank you for the report.&lt;/p&gt;

&lt;p&gt;Fixed in git master. &lt;/p&gt;

&lt;p&gt;Please verify and fix.&lt;/p&gt;

&lt;p&gt;Keep the reports coming!&lt;/p&gt;
</comment>
                            <comment id="14618521" author="mikaelstaldal" created="Wed, 8 Jul 2015 12:42:38 +0000"  >&lt;p&gt;Shouldn&apos;t we set the message to &quot;null&quot; (rather than the empty string) if it&apos;s null? That&apos;s how PatternLayout works.&lt;/p&gt;</comment>
                            <comment id="14618527" author="mikaelstaldal" created="Wed, 8 Jul 2015 12:47:00 +0000"  >&lt;p&gt;For host, I think it makes sense to have it mandatory, and refuse to create the layout if null/unset.&lt;/p&gt;</comment>
                            <comment id="14618802" author="garydgregory" created="Wed, 8 Jul 2015 15:53:35 +0000"  >&lt;p&gt;The GELF spec (1) says:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;host string (UTF-8)&lt;br/&gt;
the name of the host, source or application that sent this message; MUST be set by client library.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;To me, that means it must be set to &quot;something&quot;, not null. Hence the current implementation.&lt;/p&gt;

&lt;p&gt;Looking at the spec and our source I wonder if we should be calling &lt;tt&gt;quoteAsUTF8()&lt;/tt&gt; instead of &lt;tt&gt;quoteAsString()&lt;/tt&gt;...&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;refuse to create the layout if null/unset.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The layout framework does not let you do that ATM.&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;

&lt;p&gt;(1) &lt;a href=&quot;https://www.graylog.org/resources/gelf-2/#gelf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.graylog.org/resources/gelf-2/#gelf&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14618814" author="mikaelstaldal" created="Wed, 8 Jul 2015 15:58:37 +0000"  >&lt;p&gt;OK, if it is not possible to enforce non-null of host at creation, then using the empty string makes sense.&lt;/p&gt;</comment>
                            <comment id="14618876" author="garydgregory" created="Wed, 8 Jul 2015 16:30:40 +0000"  >&lt;p&gt;Nevermind the &lt;tt&gt;quoteAsUTF8()&lt;/tt&gt;, that returns a byte[] and we are working with a String...&lt;/p&gt;</comment>
                            <comment id="14620151" author="mikaelstaldal" created="Thu, 9 Jul 2015 09:01:51 +0000"  >&lt;p&gt;I think the message should be &quot;null&quot; (rather than the empty string)? That&apos;s how PatternLayout works.&lt;/p&gt;</comment>
                            <comment id="14621339" author="garydgregory" created="Thu, 9 Jul 2015 21:45:53 +0000"  >&lt;p&gt;Hm... like &lt;tt&gt;host: &quot;null&quot;&lt;/tt&gt; or &lt;tt&gt;host: null&lt;/tt&gt;? What if I have &quot;null&quot; in my hosts file (far fetched I know).&lt;/p&gt;</comment>
                            <comment id="14621901" author="mikaelstaldal" created="Fri, 10 Jul 2015 07:38:59 +0000"  >&lt;p&gt;No, host can be empty string as now. But the message should be &quot;null&quot; if set to null.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        builder.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;\&quot;&lt;/span&gt;short_message\&lt;span class=&quot;code-quote&quot;&gt;&quot;:\&quot;&lt;/span&gt;&quot;).append(jsonEncoder.quoteAsString(toNullSafeString(event.getMessage().getFormattedMessage())))
                .append(Q);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14622633" author="garydgregory" created="Fri, 10 Jul 2015 17:37:12 +0000"  >&lt;p&gt;Hi Mikael,&lt;/p&gt;

&lt;p&gt;Why &lt;tt&gt;&quot;null&quot;&lt;/tt&gt; instead of &lt;tt&gt;&quot;&quot;&lt;/tt&gt;?&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;</comment>
                            <comment id="14622839" author="mikaelstaldal" created="Fri, 10 Jul 2015 20:07:00 +0000"  >&lt;p&gt;To be consistent with PatternLayout %m.&lt;/p&gt;

&lt;p&gt;That&apos;s what I think, but the empty string is better than crashing as in 2.3.&lt;/p&gt;</comment>
                            <comment id="14622921" author="garydgregory" created="Fri, 10 Jul 2015 21:32:08 +0000"  >&lt;p&gt;I&apos;m not so much concerned about consistency with another layout as I am with what is the correct value for &lt;em&gt;this&lt;/em&gt; layout. Since I am not a GELF expert, I&apos;d like to defer to someone who is. If you are, great. The little web searching I did has not revealing anything concrete.&lt;/p&gt;</comment>
                            <comment id="14623317" author="mikaelstaldal" created="Sat, 11 Jul 2015 08:48:29 +0000"  >&lt;p&gt;I would not say that I am a GELF &lt;em&gt;expert&lt;/em&gt;, even though I use it regularly.&lt;/p&gt;

&lt;p&gt;The GELF spec says: &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;short_message string (UTF-8)

a &lt;span class=&quot;code-object&quot;&gt;short&lt;/span&gt; descriptive message; MUST be set by client library.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This mean that we cannot leave it out, and we cannot set it to JSON &lt;tt&gt;null&lt;/tt&gt;. It must be present and set to some string. The GELF spec does not provide any explicit way to not have a message.&lt;/p&gt;

&lt;p&gt;I guess that in Log4j, &lt;tt&gt;event.getMessage().getFormattedMessage() == null&lt;/tt&gt; is uncommon and not expected most of the time, but it is obviously possible and we have to deal with it somehow.&lt;/p&gt;

&lt;p&gt;So let&apos;s leave it as &lt;tt&gt;&quot;&quot;&lt;/tt&gt;, to emphasize the fact that it is an odd case.&lt;/p&gt;

&lt;p&gt;(I recently encountered a &lt;tt&gt;null&lt;/tt&gt; log message from a library I use, and I have ensured that there exists a bug report to fix that, since I think that&apos;s an improper use of Log4j, or SLF4J as the library is using.)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 19 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2gzgn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>