<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:35:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-908] JSONLayout doesn&apos;t add a comma between log events</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-908</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;JSONLayout doesn&apos;t output a comma (,) between the log events. This makes it quite difficult to read and deserialize the log files.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12758361">LOG4J2-908</key>
            <summary>JSONLayout doesn&apos;t add a comma between log events</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ggregory">Gary D. Gregory</assignee>
                                    <reporter username="kliakos">Konstantinos Liakos</reporter>
                        <labels>
                    </labels>
                <created>Fri, 28 Nov 2014 15:28:19 +0000</created>
                <updated>Tue, 2 Feb 2016 16:43:36 +0000</updated>
                            <resolved>Wed, 30 Dec 2015 00:57:30 +0000</resolved>
                                    <version>2.1</version>
                                    <fixVersion>2.6</fixVersion>
                                    <component>Layouts</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="14228753" author="ggregory" created="Sat, 29 Nov 2014 12:45:05 +0000"  >&lt;p&gt;Ate you setting complete = true ?&lt;/p&gt;</comment>
                            <comment id="14228764" author="kliakos" created="Sat, 29 Nov 2014 13:14:51 +0000"  >&lt;p&gt;Yes, I am setting &amp;lt;JSONLayout complete=&quot;true&quot;/&amp;gt;, and not only it doesn&apos;t add a comma between logs, but it also doesn&apos;t add the json array footer(&quot;]&quot;).&lt;/p&gt;

&lt;p&gt;The output is like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-javascript&quot;&gt;[
{
  &lt;span class=&quot;code-quote&quot;&gt;&quot;timeMillis&quot;&lt;/span&gt; : 1417266618496,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;thread&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;level&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;INFO&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;message&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;info&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;endOfBatch&quot;&lt;/span&gt; : &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;loggerFqcn&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.logging.log4j.spi.AbstractLogger&quot;&lt;/span&gt;
}{
  &lt;span class=&quot;code-quote&quot;&gt;&quot;timeMillis&quot;&lt;/span&gt; : 1417266618875,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;thread&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;level&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;ERROR&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;message&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;error&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;endOfBatch&quot;&lt;/span&gt; : &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;loggerFqcn&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.logging.log4j.spi.AbstractLogger&quot;&lt;/span&gt;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14265357" author="patrickflaherty" created="Mon, 5 Jan 2015 23:49:01 +0000"  >&lt;p&gt;I sent an email to the log4j list...&lt;/p&gt;

&lt;p&gt;Here are the versions I am using:&lt;/p&gt;

&lt;p&gt;OpenJDK 1.7.0_71  (centos 6 64 bit)&lt;br/&gt;
jackson-annotations-2.4.4.jar&lt;br/&gt;
jackson-core-2.4.2.jar&lt;br/&gt;
jackson-databind-2.4.2.jar&lt;br/&gt;
log4j-api-2.1.jar&lt;br/&gt;
log4j-core-2.1.jar&lt;/p&gt;

&lt;p&gt;Here&apos;s a gist of the code, config, and output.&lt;br/&gt;
&lt;a href=&quot;https://gist.github.com/packplusplus/07b33eb19cbd3538f7af&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/packplusplus/07b33eb19cbd3538f7af&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I had netcat listening on port 5000, outputting to a file shows the same behavior. &lt;/p&gt;</comment>
                            <comment id="14271962" author="garydgregory" created="Fri, 9 Jan 2015 22:22:14 +0000"  >&lt;p&gt;We have two issues here:&lt;/p&gt;

&lt;p&gt;The first, which appears simple, is that the footer is never written. The JsonLayout class knows to write an ending &apos;]&apos; but its &lt;tt&gt;getFooter()&lt;/tt&gt; method must be called by Log4j. This would only happen when the appender is closed, probably when log4j shutsdown.&lt;/p&gt;

&lt;p&gt;The second problem is more problematic, we do not have the notion of a log event separator. We have header and footer of course. This is not a problem for the XML layout of course since there is no such thing as a collection separator in XML.&lt;/p&gt;

&lt;p&gt;This will need a bit of thinking and fiddling.&lt;/p&gt;

&lt;p&gt;Always writing a &apos;,&apos; will not work since you cannot have a dangling &apos;,&apos; in JSON.&lt;/p&gt;</comment>
                            <comment id="14272005" author="patrickflaherty" created="Fri, 9 Jan 2015 22:45:31 +0000"  >&lt;p&gt;If you check the gist output, I get the footer. Perhaps the original reporter is showing output is from a still running program, but I don&apos;t see the same behavior. &lt;/p&gt;

&lt;p&gt;Which package does the serialization to json? For my specific use case, I could hack it to put a newline per json object. &lt;/p&gt;

&lt;p&gt;Something like:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;{ &quot;timeMillis&quot; : 1419975785011, &quot;thread&quot; : &quot;main&quot;, &quot;level&quot; : &quot;TRACE&quot;, &quot;loggerName&quot; : &quot;Log4j2Example&quot;, &quot;message&quot; : &quot;Entering Log4j Example.&quot;, &quot;endOfBatch&quot; : false, &quot;loggerFqcn&quot; : &quot;org.apache.logging.log4j.spi.AbstractLogger&quot;}
{ &quot;timeMillis&quot; : 1419975785155, &quot;thread&quot; : &quot;main&quot;, &quot;level&quot; : &quot;DEBUG&quot;, &quot;loggerName&quot; : &quot;Log4j2Example&quot;, &quot;message&quot; : &quot;\tDebug Level&quot;, &quot;endOfBatch&quot; : false, &quot;loggerFqcn&quot; : &quot;org.apache.logging.log4j.spi.AbstractLogger&quot;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;would be perfectly cromulent for the purpose of piping logs into logstash. &lt;/p&gt;</comment>
                            <comment id="14272027" author="garydgregory" created="Fri, 9 Jan 2015 23:01:13 +0000"  >&lt;p&gt;If you use compact=false, you should get an EOL between log events, but you&apos;ll likely get lots of other EOLs. &lt;/p&gt;

&lt;p&gt;The JsonLayout class and its superclass implement output through Jackson.&lt;/p&gt;</comment>
                            <comment id="14273181" author="patrickflaherty" created="Mon, 12 Jan 2015 02:59:13 +0000"  >&lt;p&gt;No trailing EOL, so it doesn&apos;t get considered a valid object. I&apos;ll poke in the code, but I&apos;m pretty useless with java...&lt;/p&gt;

&lt;p&gt;{&lt;br/&gt;
  &quot;timeMillis&quot; : 1421031232404,&lt;br/&gt;
  &quot;thread&quot; : &quot;main&quot;,&lt;br/&gt;
  &quot;level&quot; : &quot;TRACE&quot;,&lt;br/&gt;
  &quot;loggerName&quot; : &quot;Log4j2Example&quot;,&lt;br/&gt;
  &quot;message&quot; : &quot;Entering Log4j Example.&quot;,&lt;br/&gt;
  &quot;endOfBatch&quot; : false,&lt;br/&gt;
  &quot;loggerFqcn&quot; : &quot;org.apache.logging.log4j.spi.AbstractLogger&quot;&lt;br/&gt;
}{&lt;br/&gt;
  &quot;timeMillis&quot; : 1421031232535,&lt;br/&gt;
  &quot;thread&quot; : &quot;main&quot;,&lt;br/&gt;
  &quot;level&quot; : &quot;DEBUG&quot;,&lt;br/&gt;
  &quot;loggerName&quot; : &quot;Log4j2Example&quot;,&lt;br/&gt;
  &quot;message&quot; : &quot;\tDebug Level&quot;,&lt;br/&gt;
  &quot;endOfBatch&quot; : false,&lt;br/&gt;
  &quot;loggerFqcn&quot; : &quot;org.apache.logging.log4j.spi.AbstractLogger&quot;&lt;br/&gt;
}{...&lt;/p&gt;</comment>
                            <comment id="14281224" author="garydgregory" created="Sat, 17 Jan 2015 05:47:14 +0000"  >&lt;p&gt;Please see &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-941&quot; title=&quot;Allow JSON layout to create one compact log record per line&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-941&quot;&gt;&lt;del&gt;LOG4J2-941&lt;/del&gt;&lt;/a&gt; to produce one compact log record per line.&lt;/p&gt;

&lt;p&gt;In order to properly separate the log records with a comma will require careful changes. A comma should always be added before a record, except the first one. Trailing commas are not allowed in JSON.&lt;/p&gt;</comment>
                            <comment id="15074340" author="rcoe67" created="Tue, 29 Dec 2015 21:52:35 +0000"  >&lt;p&gt;Could commas not be appended to each log event and then use the existing footer implementation to add an empty event and, if set, closing document square bracket, i.e., {}&amp;lt;]&amp;gt;?    It&apos;s a bit hacky, insofar as it introduces noise into the log, but &lt;b&gt;should&lt;/b&gt; not affect the behaviour of applications that process a json stream.&lt;/p&gt;

&lt;p&gt;Alternatively, would it be incorrect to interpret each log event as a complete document, in the case of setting complete=&quot;true&quot;?  Is there any reason the entire log needs to be wrapped in [ ... ]?  What&apos;s the semantic difference between a single event enclosed in square brackets, separated by commas, and a non-comma separated set of events that are each marked as documents with EOL delimiters?&lt;/p&gt;</comment>
                            <comment id="15074388" author="garydgregory" created="Tue, 29 Dec 2015 22:48:47 +0000"  >&lt;p&gt;How about adding the &quot;,&quot; if an event is not the 1st event and we are logging a &quot;complete&quot; document? (pardon some of the noise in the diff):&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;diff --git a/log4j-core/src/main/java/org/apache/logging/log4j/core/layout/AbstractJacksonLayout.java b/log4j-core/src/main/java/org/apache/logging/log4j/core/layout/AbstractJacksonLayout.java
index ca966fb..3b122e1 100644
--- a/log4j-core/src/main/java/org/apache/logging/log4j/core/layout/AbstractJacksonLayout.java
+++ b/log4j-core/src/main/java/org/apache/logging/log4j/core/layout/AbstractJacksonLayout.java
@@ -16,12 +16,16 @@
  */
 package org.apache.logging.log4j.core.layout;
 
+import java.io.IOException;
+import java.io.Writer;
 import java.nio.charset.Charset;
 
 import org.apache.logging.log4j.core.LogEvent;
+import org.apache.logging.log4j.core.util.StringBuilderWriter;
 import org.apache.logging.log4j.util.Strings;
 
-import com.fasterxml.jackson.core.JsonProcessingException;
+import com.fasterxml.jackson.core.JsonGenerationException;
+import com.fasterxml.jackson.databind.JsonMappingException;
 import com.fasterxml.jackson.databind.ObjectWriter;
 
 abstract class AbstractJacksonLayout extends AbstractStringLayout {
@@ -51,13 +55,22 @@
      */
     @Override
     public String toSerializable(final LogEvent event) {
+        StringBuilderWriter writer = new StringBuilderWriter();        
         try {
-            return this.objectWriter.writeValueAsString(event) + eol;
-        } catch (final JsonProcessingException e) {
+            toSerializable(event, writer);
+            return writer.toString();
+        } catch (final IOException e) {
             // Should this be an ISE or IAE?
             LOGGER.error(e);
             return Strings.EMPTY;
         }
     }
 
+    public void toSerializable(final LogEvent event, Writer writer)
+            throws JsonGenerationException, JsonMappingException, IOException {
+        objectWriter.writeValue(writer, event);
+        writer.write(eol);
+        markEvent();
+    }
+
 }
diff --git a/log4j-core/src/main/java/org/apache/logging/log4j/core/layout/AbstractLayout.java b/log4j-core/src/main/java/org/apache/logging/log4j/core/layout/AbstractLayout.java
index 4fa1d8e..9c5166e 100644
--- a/log4j-core/src/main/java/org/apache/logging/log4j/core/layout/AbstractLayout.java
+++ b/log4j-core/src/main/java/org/apache/logging/log4j/core/layout/AbstractLayout.java
@@ -50,6 +50,11 @@
     protected final byte[] footer;
 
     /**
+     * The count of events successfully processed by this layout.
+     */
+    protected long eventCount;
+
+    /**
      * Constructs a layout with an optional header and footer.
      * 
      * @param header
@@ -87,4 +92,8 @@
     public byte[] getHeader() {
         return header;
     }
+    
+    protected void markEvent() {
+        eventCount++;
+    }
 }
diff --git a/log4j-core/src/main/java/org/apache/logging/log4j/core/layout/JsonLayout.java b/log4j-core/src/main/java/org/apache/logging/log4j/core/layout/JsonLayout.java
index 04cda2d..5f3969c 100644
--- a/log4j-core/src/main/java/org/apache/logging/log4j/core/layout/JsonLayout.java
+++ b/log4j-core/src/main/java/org/apache/logging/log4j/core/layout/JsonLayout.java
@@ -16,12 +16,15 @@
  */
 package org.apache.logging.log4j.core.layout;
 
+import java.io.IOException;
+import java.io.Writer;
 import java.nio.charset.Charset;
 import java.nio.charset.StandardCharsets;
 import java.util.HashMap;
 import java.util.Map;
 
 import org.apache.logging.log4j.core.Layout;
+import org.apache.logging.log4j.core.LogEvent;
 import org.apache.logging.log4j.core.config.Node;
 import org.apache.logging.log4j.core.config.plugins.Plugin;
 import org.apache.logging.log4j.core.config.plugins.PluginAttribute;
@@ -32,8 +35,9 @@
  *
  * &amp;lt;h3&amp;gt;Complete well-formed JSON vs. fragment JSON&amp;lt;/h3&amp;gt;
  * &amp;lt;p&amp;gt;
- * If you configure {@code complete=&quot;true&quot;}, the appender outputs a well-formed JSON document. By default, with {@code complete=&quot;false&quot;},
- * you should include the output as an &amp;lt;em&amp;gt;external file&amp;lt;/em&amp;gt; in a separate file to form a well-formed JSON document.
+ * If you configure {@code complete=&quot;true&quot;}, the appender outputs a well-formed JSON document. By default, with
+ * {@code complete=&quot;false&quot;}, you should include the output as an &amp;lt;em&amp;gt;external file&amp;lt;/em&amp;gt; in a separate file to form a
+ * well-formed JSON document.
  * &amp;lt;/p&amp;gt;
  * &amp;lt;p&amp;gt;
  * A well-formed JSON event follows this pattern:
@@ -773,22 +777,22 @@
 }
  * &amp;lt;/pre&amp;gt;
  * &amp;lt;p&amp;gt;
- * If {@code complete=&quot;false&quot;}, the appender does not write the JSON open array character &quot;[&quot; at the start of the document. and &quot;]&quot; and the
- * end.
+ * If {@code complete=&quot;false&quot;}, the appender does not write the JSON open array character &quot;[&quot; at the start of the
+ * document. and &quot;]&quot; and the end.
  * &amp;lt;/p&amp;gt;
  * &amp;lt;p&amp;gt;
  * This approach enforces the independence of the JsonLayout and the appender where you embed it.
  * &amp;lt;/p&amp;gt;
  * &amp;lt;h3&amp;gt;Encoding&amp;lt;/h3&amp;gt;
  * &amp;lt;p&amp;gt;
- * Appenders using this layout should have their {@code charset} set to {@code UTF-8} or {@code UTF-16}, otherwise events containing non
- * ASCII characters could result in corrupted log files.
+ * Appenders using this layout should have their {@code charset} set to {@code UTF-8} or {@code UTF-16}, otherwise
+ * events containing non ASCII characters could result in corrupted log files.
  * &amp;lt;/p&amp;gt;
  * &amp;lt;h3&amp;gt;Pretty vs. compact XML&amp;lt;/h3&amp;gt;
  * &amp;lt;p&amp;gt;
- * By default, the JSON layout is not compact (a.k.a. not &quot;pretty&quot;) with {@code compact=&quot;false&quot;}, which means the appender uses end-of-line
- * characters and indents lines to format the text. If {@code compact=&quot;true&quot;}, then no end-of-line or indentation is used. Message content
- * may contain, of course, escaped end-of-lines.
+ * By default, the JSON layout is not compact (a.k.a. not &quot;pretty&quot;) with {@code compact=&quot;false&quot;}, which means the
+ * appender uses end-of-line characters and indents lines to format the text. If {@code compact=&quot;true&quot;}, then no
+ * end-of-line or indentation is used. Message content may contain, of course, escaped end-of-lines.
  * &amp;lt;/p&amp;gt;
  */
 @Plugin(name = &quot;JsonLayout&quot;, category = Node.CATEGORY, elementType = Layout.ELEMENT_TYPE, printObject = true)
@@ -798,9 +802,10 @@
 
     private static final long serialVersionUID = 1L;
 
-    protected JsonLayout(final boolean locationInfo, final boolean properties, final boolean complete, final boolean compact,
-            final boolean eventEol, final Charset charset) {
-        super(new JacksonFactory.JSON().newWriter(locationInfo, properties, compact), charset, compact, complete, eventEol);
+    protected JsonLayout(final boolean locationInfo, final boolean properties, final boolean complete,
+            final boolean compact, final boolean eventEol, final Charset charset) {
+        super(new JacksonFactory.JSON().newWriter(locationInfo, properties, compact), charset, compact, complete,
+                eventEol);
     }
 
     /**
@@ -851,18 +856,18 @@
      * Creates a JSON Layout.
      *
      * @param locationInfo
-     *        If &quot;true&quot;, includes the location information in the generated JSON.
+     *            If &quot;true&quot;, includes the location information in the generated JSON.
      * @param properties
-     *        If &quot;true&quot;, includes the thread context in the generated JSON.
+     *            If &quot;true&quot;, includes the thread context in the generated JSON.
      * @param complete
-     *        If &quot;true&quot;, includes the JSON header and footer, defaults to &quot;false&quot;.
+     *            If &quot;true&quot;, includes the JSON header and footer, defaults to &quot;false&quot;.
      * @param compact
-     *        If &quot;true&quot;, does not use end-of-lines and indentation, defaults to &quot;false&quot;.
+     *            If &quot;true&quot;, does not use end-of-lines and indentation, defaults to &quot;false&quot;.
      * @param eventEol
-     *        If &quot;true&quot;, forces an EOL after each log event (even if compact is &quot;true&quot;), defaults to &quot;false&quot;. This
-     *        allows one even per line, even in compact mode.
+     *            If &quot;true&quot;, forces an EOL after each log event (even if compact is &quot;true&quot;), defaults to &quot;false&quot;. This
+     *            allows one even per line, even in compact mode.
      * @param charset
-     *        The character set to use, if {@code null}, uses &quot;UTF-8&quot;.
+     *            The character set to use, if {@code null}, uses &quot;UTF-8&quot;.
      * @return A JSON Layout.
      */
     @PluginFactory
@@ -887,4 +892,12 @@
     public static AbstractJacksonLayout createDefaultLayout() {
         return new JsonLayout(false, false, false, false, false, StandardCharsets.UTF_8);
     }
+
+    @Override
+    public void toSerializable(final LogEvent event, Writer writer) throws IOException {
+        if (complete &amp;amp;&amp;amp; eventCount &amp;gt; 1) {
+            writer.append(&quot;, &quot;);
+        }
+        super.toSerializable(event, writer);
+    }
 }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15074509" author="garydgregory" created="Wed, 30 Dec 2015 00:57:30 +0000"  >&lt;p&gt;In Git master, please verify and close.&lt;/p&gt;</comment>
                            <comment id="15075059" author="rcoe67" created="Wed, 30 Dec 2015 14:20:26 +0000"  >&lt;p&gt;Hi Gary,&lt;/p&gt;

&lt;p&gt;One typo in the javadoc of the JSONLayout class:&lt;br/&gt;
 &quot;...By default, the JSON layout is not compact (a.k.a. not &quot;pretty&quot;) with &lt;/p&gt;
{@code compact=&quot;false&quot;}
&lt;p&gt;,...&quot;&lt;/p&gt;

&lt;p&gt;I think that should be (a.k.a. &lt;b&gt;is&lt;/b&gt; &quot;pretty&quot;)&lt;/p&gt;

&lt;p&gt;In the case of an unsafe shutdown, is there any concern of a the log file being corrupt (insofar as there would be no closing &quot;]&quot;) in the context of a log parser?  This relates back to my comment of yesterday.  I&apos;m unsure whether there&apos;s a semantic difference between separate log event documents (i.e., each event enclosed in &lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt; and separated by EOL characters) and a set of comma-separated events surrounded by square brackets (i.e., a list of events in a single document).  I realize this concern crosses a domain boundary (i.e., should log4j2 care about an upstream parser?) but should a log event parser be expected to validate the stream?  I don&apos;t think so, as it would require introducing state into the parser, e.g., to track the opening &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot; and match it to a closing &amp;quot;&amp;#93;&lt;/span&gt;&quot;, before parsing.&lt;/p&gt;

&lt;p&gt;Sorry if this is off-topic but my use case is in tcp streaming of log events, so enclosing them in a single document boundary doesn&apos;t make sense and I&apos;m wondering if there&apos;s really any semantic difference between a stream of EOL-delimited json documents and a single document that comma-delimits events?  If not, could the plugin be made simpler by always using the pattern &quot;[{...}]EOL&quot; and doing away with the associated plugin properties?  If the two representations are in-fact different, especially as it concerns an upstream parser like logstash, fluentd, elasticsearch, etc., then I apologize for muddying this issue.&lt;/p&gt;</comment>
                            <comment id="15075394" author="garydgregory" created="Wed, 30 Dec 2015 21:04:27 +0000"  >&lt;p&gt;I fixed the Javadoc, thank you for noticing that!&lt;/p&gt;</comment>
                            <comment id="15075405" author="garydgregory" created="Wed, 30 Dec 2015 21:13:49 +0000"  >&lt;p&gt;WRT commas and documents. &lt;/p&gt;

&lt;p&gt;Right now you can do a couple of things. You can have an appender and layout create a valid JSON document assuming Log4j shutsdown cleanly. This means you&apos;ll get a JSON document that is an array of log events. This usually makes most sense when you log to a file. This is the same concept as with the XML layout when you need to close the root element.&lt;/p&gt;

&lt;p&gt;Otherwise, you can create a stream of log events by setting complete to false, which will not emit the [ and ]. If you also set compact to false, you&apos;ll get no formatting. &lt;/p&gt;

&lt;p&gt;Depending on how your JSON parser works, this can work or not. Can your parser not know when an object end? Or does your parser blow up if it sees an incomplete object? I would imagine that if a parser is reading from stream as opposes to from a string, it would block until more bytes are available.&lt;/p&gt;

&lt;p&gt;An alternative would be to propose a new property like &quot;eventPostfix&quot; which you can set to end of line (%n perhaps if we use the pattern layout format). So if you use eventPostifx=&quot;%n&quot;, compact=&quot;true&quot;, and complete=&quot;false&quot;, you&apos;d get one log event per line, but not as a complete JSON doc.&lt;/p&gt;

&lt;p&gt;Thoughts?&lt;/p&gt;</comment>
                            <comment id="15075630" author="mikaelstaldal" created="Thu, 31 Dec 2015 02:11:22 +0000"  >&lt;p&gt;To me it seems quite arbitrary to use EOL (which I guess mean CR/LF) as a delimiter in the context of JSON.&lt;/p&gt;

&lt;p&gt;And I don&apos;t understand why you would like to enclose each log event with []. If you don&apos;t need the whole stream of events to be well-formed JSON, then why not just have each log event as &lt;/p&gt;
{...} (and thus the stream would be {...}
{...}
&lt;p&gt; )? A clever parser should be able to handle that.&lt;/p&gt;</comment>
                            <comment id="15075698" author="garydgregory" created="Thu, 31 Dec 2015 04:09:22 +0000"  >&lt;p&gt;I agree that a decent parser should be able to deal with the log event stream as is. &lt;/p&gt;

&lt;p&gt;The original issue is fixed AFAIAC.&lt;/p&gt;

&lt;p&gt;Hopefully we&apos;ll hear from the reporter...&lt;/p&gt;</comment>
                            <comment id="15075985" author="rcoe67" created="Thu, 31 Dec 2015 14:54:12 +0000"  >&lt;p&gt;True.  A clever parse &lt;b&gt;should&lt;/b&gt; but Logstash can&apos;t.  Only way to get Logstash to recognize log events without commas is to flush each one individually.  So, no batching.  I haven&apos;t tested whether logstash would process a stream of EOL-delimited documents, which is something I will investigate and report back if it can deal.  Plugging into a logstash/fluentd environment should be possible with log4j2 in batch mode, imo.&lt;/p&gt;</comment>
                            <comment id="15076047" author="garydgregory" created="Thu, 31 Dec 2015 16:24:33 +0000"  >&lt;p&gt;Don&apos;t forget that the layout now uses commas to separate events when in complete mode.&lt;/p&gt;</comment>
                            <comment id="15076068" author="mikaelstaldal" created="Thu, 31 Dec 2015 17:16:01 +0000"  >&lt;p&gt;I guess that you use logstash to route log events to some final destination? What destination is that? Sometimes it is possible to bypass logstash and configure Log4j to send log events directly to the final destination.&lt;/p&gt;</comment>
                            <comment id="15076069" author="mikaelstaldal" created="Thu, 31 Dec 2015 17:20:37 +0000"  >&lt;p&gt;The original issue is not about Logstash as far as I can see.&lt;/p&gt;

&lt;p&gt;If better integration with Logstash is needed, and this fix to JSONLayout is not sufficient, perhaps we should have a LogstashLayout, or LogstashAppender? Rather than making awkward hacks to JSONLayout.&lt;/p&gt;</comment>
                            <comment id="15076095" author="rcoe67" created="Thu, 31 Dec 2015 19:07:24 +0000"  >&lt;p&gt;I disagree with creating a new layout just for logstash.  Any parser willing to accept json should likewise conform to the spec, which this fix does for log4j2.  From limited experience I am confident that this fix will now allow batching events from log4j2 to elasticsearch.&lt;/p&gt;

&lt;p&gt;I side-railed this issue by introducing the question of whether there&apos;s any difference between a single array with multiple elements and multiple arrays with a single element, in the context of an external parser.  Having not yet tested whether logstash and/or fluentd can process a stream of json arrays, with/without comma and/or EOL delimeters, then suggesting a different format is premature.&lt;/p&gt;</comment>
                            <comment id="15076131" author="garydgregory" created="Thu, 31 Dec 2015 20:57:48 +0000"  >&lt;p&gt;I think we can close this issue since the bug is fixed and create a new issue for other behaviors. Check?&lt;/p&gt;</comment>
                            <comment id="15076182" author="ralph.goers@dslextreme.com" created="Thu, 31 Dec 2015 23:06:40 +0000"  >&lt;p&gt;I think I am very confused.  This issue implies that a &apos;,&apos; is required between log events in order for them to be usable by Logstash. However &lt;a href=&quot;http://stackoverflow.com/questions/22944168/json-variants-log4j-with-logstash/34532426#34532426&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/questions/22944168/json-variants-log4j-with-logstash/34532426#34532426&lt;/a&gt; says pretty much the opposite - that they can only be parsed when they don&apos;t have commas.&lt;/p&gt;</comment>
                            <comment id="15076239" author="rcoe67" created="Fri, 1 Jan 2016 03:49:52 +0000"  >&lt;p&gt;I see your point.  In that question, the solution is to use a json_lines codec, which effectively requires each log event to be sent individually.  If you send a stream of json events in batch mode, logstash will not process them.  But there is another logstash codec for json streams, which processes an array of comma delimited elements.  The first codec requires an EOL and the second codec requires commas.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure whether logstash can process a json object itself, i.e., an array wrapped in [].  If it can, I expect it to require the json_lines codec and the format would probably need to look like:&lt;br/&gt;
[{event}]&lt;br/&gt;
[{event}]&lt;/p&gt;

&lt;p&gt;as opposed to &lt;br/&gt;
[&lt;br/&gt;
{event},&lt;br/&gt;
{event}&lt;br/&gt;
]&lt;/p&gt;

&lt;p&gt;Not knowing is why I was asking about the semantic difference between a stream of json objects, i.e., [{}][{}]..., vs. an array of elements in a json object, i.e., [{},{},...].  If there is none, then finding a format that works in batch mode is preferred.&lt;/p&gt;

&lt;p&gt;btw, I&apos;m no logstash expert by any means.  This behaviour is what I saw when testing.  It may be that I didn&apos;t use the right combination of log4j2 properties to comply with logstash&apos;s codec.  The documentation on logstash codecs is sparse, to say the least.  What I saw when testing was that commas were required but I really can&apos;t remember whether I tried both codecs and in what combination of logstash codecs.  This is a big part of the integration problem, which is why I was asking about the semantic differences of different formats.&lt;/p&gt;</comment>
                            <comment id="15076240" author="mikaelstaldal" created="Fri, 1 Jan 2016 04:10:07 +0000"  >&lt;p&gt;In terms of JSON, there is a semantic difference between &lt;span class=&quot;error&quot;&gt;&amp;#91;{}&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;{}&amp;#93;&lt;/span&gt;... and &lt;span class=&quot;error&quot;&gt;&amp;#91;{},{},...&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="15076241" author="mikaelstaldal" created="Fri, 1 Jan 2016 04:14:17 +0000"  >&lt;p&gt;BTW, have you tried to use Log4j&apos;s GelfLayout and the gelf input to Logstash?&lt;/p&gt;</comment>
                            <comment id="15076244" author="rcoe67" created="Fri, 1 Jan 2016 04:47:48 +0000"  >&lt;p&gt;No but I did briefly look at it.  I actually dropped logstash from my pipe, because I wasn&apos;t confident in it&apos;s performance or behaviour.  Beyond its runtime being Jruby, I didn&apos;t like that logstash uses a blocking IO pipe and silently drops events when its buffer is full.  A key reason I am using log4j2 is its failover mechanism and I don&apos;t trust logstash to upstream the events it receives, which negates the failover of log4j2.  Instad, I am using the log4j2-elasticsearch plugin, &lt;a href=&quot;https://github.com/jprante/log4j2-elasticsearch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jprante/log4j2-elasticsearch&lt;/a&gt;, to go directly to elasticsearch.  What that leaves me, though, is to build my own parser for json events in the failover log, so I can recover them and send them upstream on service recovery.  For this, i am using jackson, which is what log4j2 uses to create the json layout.  Now is the time I wish log4j2 had a slightly more public API, to reverse the process, something akin to chainsaw.  Long story, I know, but thought it may help understand my persistence to understand semantics from a parser&apos;s POV. =)&lt;/p&gt;</comment>
                            <comment id="15076262" author="kliakos" created="Fri, 1 Jan 2016 10:03:43 +0000"  >&lt;p&gt;The issue was about JsonLayout not doing what the documentation claimed to do when complete=true. Anything else, while usefull, should be discussed in another topic.&lt;/p&gt;</comment>
                            <comment id="15076334" author="garydgregory" created="Fri, 1 Jan 2016 16:52:29 +0000"  >&lt;p&gt;Can you verify and close the issue please since you created it?&lt;/p&gt;

&lt;p&gt;Thank you and Happy New Year.&lt;/p&gt;</comment>
                            <comment id="15076520" author="kliakos" created="Sat, 2 Jan 2016 13:42:18 +0000"  >&lt;p&gt;Just tested it, and it seems there is an issue. The first 2 log events are not seperated by comma, while the rest do.&lt;/p&gt;

&lt;p&gt;The log file looks like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[
{
  &lt;span class=&quot;code-quote&quot;&gt;&quot;timeMillis&quot;&lt;/span&gt; : 1451741740683,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;thread&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;qtp28648256-15&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;level&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;ERROR&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;message&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;test&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;endOfBatch&quot;&lt;/span&gt; : &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;loggerFqcn&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.logging.log4j.spi.AbstractLogger&quot;&lt;/span&gt;
}
{
  &lt;span class=&quot;code-quote&quot;&gt;&quot;timeMillis&quot;&lt;/span&gt; : 1451741741605,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;thread&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;qtp28648256-16&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;level&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;ERROR&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;message&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;test&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;endOfBatch&quot;&lt;/span&gt; : &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;loggerFqcn&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.logging.log4j.spi.AbstractLogger&quot;&lt;/span&gt;
}
, {
  &lt;span class=&quot;code-quote&quot;&gt;&quot;timeMillis&quot;&lt;/span&gt; : 1451741744133,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;thread&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;qtp28648256-18&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;level&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;ERROR&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;message&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;test&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;endOfBatch&quot;&lt;/span&gt; : &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;loggerFqcn&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.logging.log4j.spi.AbstractLogger&quot;&lt;/span&gt;
}
, {
  &lt;span class=&quot;code-quote&quot;&gt;&quot;timeMillis&quot;&lt;/span&gt; : 1451741744452,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;thread&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;qtp28648256-21&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;level&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;ERROR&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;message&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;test&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;endOfBatch&quot;&lt;/span&gt; : &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;loggerFqcn&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.logging.log4j.spi.AbstractLogger&quot;&lt;/span&gt;
}
, {
  &lt;span class=&quot;code-quote&quot;&gt;&quot;timeMillis&quot;&lt;/span&gt; : 1451741744495,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;thread&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;qtp28648256-14&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;level&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;ERROR&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;message&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;test&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;endOfBatch&quot;&lt;/span&gt; : &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;loggerFqcn&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.logging.log4j.spi.AbstractLogger&quot;&lt;/span&gt;
}
, {
  &lt;span class=&quot;code-quote&quot;&gt;&quot;timeMillis&quot;&lt;/span&gt; : 1451741744677,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;thread&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;qtp28648256-17&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;level&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;ERROR&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;message&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;test&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;endOfBatch&quot;&lt;/span&gt; : &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;loggerFqcn&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.logging.log4j.spi.AbstractLogger&quot;&lt;/span&gt;
}
, {
  &lt;span class=&quot;code-quote&quot;&gt;&quot;timeMillis&quot;&lt;/span&gt; : 1451741744856,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;thread&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;qtp28648256-15&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;level&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;ERROR&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;message&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;test&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;endOfBatch&quot;&lt;/span&gt; : &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;loggerFqcn&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.logging.log4j.spi.AbstractLogger&quot;&lt;/span&gt;
}
, {
  &lt;span class=&quot;code-quote&quot;&gt;&quot;timeMillis&quot;&lt;/span&gt; : 1451741745017,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;thread&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;qtp28648256-16&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;level&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;ERROR&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;message&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;test&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;endOfBatch&quot;&lt;/span&gt; : &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;loggerFqcn&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.logging.log4j.spi.AbstractLogger&quot;&lt;/span&gt;
}
, {
  &lt;span class=&quot;code-quote&quot;&gt;&quot;timeMillis&quot;&lt;/span&gt; : 1451741745203,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;thread&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;qtp28648256-18&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;level&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;ERROR&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;message&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;test&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;endOfBatch&quot;&lt;/span&gt; : &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;loggerFqcn&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.logging.log4j.spi.AbstractLogger&quot;&lt;/span&gt;
}
, {
  &lt;span class=&quot;code-quote&quot;&gt;&quot;timeMillis&quot;&lt;/span&gt; : 1451741745391,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;thread&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;qtp28648256-21&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;level&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;ERROR&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;message&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;test&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;endOfBatch&quot;&lt;/span&gt; : &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;loggerFqcn&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.logging.log4j.spi.AbstractLogger&quot;&lt;/span&gt;
}
, {
  &lt;span class=&quot;code-quote&quot;&gt;&quot;timeMillis&quot;&lt;/span&gt; : 1451741745575,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;thread&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;qtp28648256-14&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;level&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;ERROR&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;message&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;test&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;endOfBatch&quot;&lt;/span&gt; : &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;loggerFqcn&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.logging.log4j.spi.AbstractLogger&quot;&lt;/span&gt;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15076744" author="garydgregory" created="Sun, 3 Jan 2016 01:34:53 +0000"  >&lt;p&gt;Oops, try again from Git master please (and close if it works for your use case).&lt;/p&gt;</comment>
                            <comment id="15081220" author="kliakos" created="Mon, 4 Jan 2016 14:41:24 +0000"  >&lt;p&gt;It&apos;s good now.&lt;/p&gt;</comment>
                            <comment id="15127949" author="ganshug" created="Tue, 2 Feb 2016 09:25:53 +0000"  >&lt;p&gt;When complete is set to false, comma is not added to separate records. By documentation complete attribute should only affect header/footer. Here are sample configuration files used and log generated&lt;/p&gt;

&lt;p&gt;1. When complete = false &lt;/p&gt;

&lt;p&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;&lt;br/&gt;
&amp;lt;Configuration status=&quot;OFF&quot;&amp;gt;&lt;br/&gt;
  &amp;lt;Appenders&amp;gt;&lt;br/&gt;
    &amp;lt;File name=&quot;XmlFile&quot; fileName=&quot;target/JsonCompleteFileAppenderTest.log&quot; immediateFlush=&quot;true&quot; append=&quot;false&quot;&amp;gt;&lt;br/&gt;
      &amp;lt;JSONLayout complete=&quot;false&quot; charset=&quot;UTF-8&quot; compact=&quot;false&quot; eventEol=&quot;false&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;/File&amp;gt;&lt;br/&gt;
  &amp;lt;/Appenders&amp;gt;&lt;/p&gt;

&lt;p&gt;  &amp;lt;Loggers&amp;gt;&lt;br/&gt;
    &amp;lt;Root level=&quot;all&quot; includeLocation=&quot;true&quot;&amp;gt;&lt;br/&gt;
      &amp;lt;AppenderRef ref=&quot;XmlFile&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;/Root&amp;gt;&lt;br/&gt;
  &amp;lt;/Loggers&amp;gt;&lt;br/&gt;
&amp;lt;/Configuration&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------&lt;/p&gt;

&lt;p&gt;{&lt;br/&gt;
  &quot;timeMillis&quot; : 1454404910569,&lt;br/&gt;
  &quot;thread&quot; : &quot;main&quot;,&lt;br/&gt;
  &quot;level&quot; : &quot;TRACE&quot;,&lt;br/&gt;
  &quot;loggerName&quot; : &quot;org.apache.logging.log4j.test.TestJira908&quot;,&lt;br/&gt;
  &quot;message&quot; : &quot;First message&quot;,&lt;br/&gt;
  &quot;endOfBatch&quot; : false,&lt;br/&gt;
  &quot;loggerFqcn&quot; : &quot;org.apache.logging.log4j.spi.AbstractLogger&quot;&lt;br/&gt;
}&lt;br/&gt;
{&lt;br/&gt;
  &quot;timeMillis&quot; : 1454404910699,&lt;br/&gt;
  &quot;thread&quot; : &quot;main&quot;,&lt;br/&gt;
  &quot;level&quot; : &quot;TRACE&quot;,&lt;br/&gt;
  &quot;loggerName&quot; : &quot;org.apache.logging.log4j.test.TestJira908&quot;,&lt;br/&gt;
  &quot;message&quot; : &quot;Second message&quot;,&lt;br/&gt;
  &quot;endOfBatch&quot; : false,&lt;br/&gt;
  &quot;loggerFqcn&quot; : &quot;org.apache.logging.log4j.spi.AbstractLogger&quot;&lt;br/&gt;
}&lt;br/&gt;
{&lt;br/&gt;
  &quot;timeMillis&quot; : 1454404910699,&lt;br/&gt;
  &quot;thread&quot; : &quot;main&quot;,&lt;br/&gt;
  &quot;level&quot; : &quot;TRACE&quot;,&lt;br/&gt;
  &quot;loggerName&quot; : &quot;org.apache.logging.log4j.test.TestJira908&quot;,&lt;br/&gt;
  &quot;message&quot; : &quot;Third message&quot;,&lt;br/&gt;
  &quot;endOfBatch&quot; : false,&lt;br/&gt;
  &quot;loggerFqcn&quot; : &quot;org.apache.logging.log4j.spi.AbstractLogger&quot;&lt;br/&gt;
}&lt;/p&gt;


&lt;p&gt;**********************************************************************&lt;/p&gt;

&lt;p&gt;1. When complete = true &lt;/p&gt;

&lt;p&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;&lt;br/&gt;
&amp;lt;Configuration status=&quot;OFF&quot;&amp;gt;&lt;br/&gt;
  &amp;lt;Appenders&amp;gt;&lt;br/&gt;
    &amp;lt;File name=&quot;XmlFile&quot; fileName=&quot;target/JsonCompleteFileAppenderTest.log&quot; immediateFlush=&quot;true&quot; append=&quot;false&quot;&amp;gt;&lt;br/&gt;
      &amp;lt;JSONLayout complete=&quot;true&quot; charset=&quot;UTF-8&quot; compact=&quot;false&quot; eventEol=&quot;false&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;/File&amp;gt;&lt;br/&gt;
  &amp;lt;/Appenders&amp;gt;&lt;/p&gt;

&lt;p&gt;  &amp;lt;Loggers&amp;gt;&lt;br/&gt;
    &amp;lt;Root level=&quot;all&quot; includeLocation=&quot;true&quot;&amp;gt;&lt;br/&gt;
      &amp;lt;AppenderRef ref=&quot;XmlFile&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;/Root&amp;gt;&lt;br/&gt;
  &amp;lt;/Loggers&amp;gt;&lt;br/&gt;
&amp;lt;/Configuration&amp;gt;&lt;/p&gt;


&lt;p&gt;-----------------------------------------------------&lt;/p&gt;

&lt;p&gt;[&lt;br/&gt;
{&lt;br/&gt;
  &quot;timeMillis&quot; : 1454405040352,&lt;br/&gt;
  &quot;thread&quot; : &quot;main&quot;,&lt;br/&gt;
  &quot;level&quot; : &quot;TRACE&quot;,&lt;br/&gt;
  &quot;loggerName&quot; : &quot;org.apache.logging.log4j.test.TestJira908&quot;,&lt;br/&gt;
  &quot;message&quot; : &quot;First message&quot;,&lt;br/&gt;
  &quot;endOfBatch&quot; : false,&lt;br/&gt;
  &quot;loggerFqcn&quot; : &quot;org.apache.logging.log4j.spi.AbstractLogger&quot;&lt;br/&gt;
}&lt;br/&gt;
, {&lt;br/&gt;
  &quot;timeMillis&quot; : 1454405040462,&lt;br/&gt;
  &quot;thread&quot; : &quot;main&quot;,&lt;br/&gt;
  &quot;level&quot; : &quot;TRACE&quot;,&lt;br/&gt;
  &quot;loggerName&quot; : &quot;org.apache.logging.log4j.test.TestJira908&quot;,&lt;br/&gt;
  &quot;message&quot; : &quot;Second message&quot;,&lt;br/&gt;
  &quot;endOfBatch&quot; : false,&lt;br/&gt;
  &quot;loggerFqcn&quot; : &quot;org.apache.logging.log4j.spi.AbstractLogger&quot;&lt;br/&gt;
}&lt;br/&gt;
, {&lt;br/&gt;
  &quot;timeMillis&quot; : 1454405040462,&lt;br/&gt;
  &quot;thread&quot; : &quot;main&quot;,&lt;br/&gt;
  &quot;level&quot; : &quot;TRACE&quot;,&lt;br/&gt;
  &quot;loggerName&quot; : &quot;org.apache.logging.log4j.test.TestJira908&quot;,&lt;br/&gt;
  &quot;message&quot; : &quot;Third message&quot;,&lt;br/&gt;
  &quot;endOfBatch&quot; : false,&lt;br/&gt;
  &quot;loggerFqcn&quot; : &quot;org.apache.logging.log4j.spi.AbstractLogger&quot;&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;]&lt;/p&gt;</comment>
                            <comment id="15127957" author="kliakos" created="Tue, 2 Feb 2016 09:30:09 +0000"  >&lt;p&gt;The docs say: the appender outputs a well-formed JSON document.&lt;/p&gt;

&lt;p&gt;To be well-formed, you need commas between the objects.&lt;/p&gt;</comment>
                            <comment id="15128504" author="mikaelstaldal" created="Tue, 2 Feb 2016 16:36:14 +0000"  >&lt;p&gt;The implementation is correct and documentation is wrong.&lt;/p&gt;</comment>
                            <comment id="15128518" author="mikaelstaldal" created="Tue, 2 Feb 2016 16:43:36 +0000"  >&lt;p&gt;Fixed documentation.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12768196">LOG4J2-941</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 42 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i22vhr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>