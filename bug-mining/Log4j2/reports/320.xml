<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:32:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-51] ClassCastException in Category logger</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-51</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;When a Category is &quot;created&quot; with the same name as a previously created log4j2 Logger, a ClassCastException occurs when calling category.l7dlog(...) and others.&lt;/p&gt;

&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-50&quot; title=&quot;Incorrect %C output (FQCN) &quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-50&quot;&gt;&lt;del&gt;LOG4J2-50&lt;/del&gt;&lt;/a&gt; for additional symptoms.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12523504">LOG4J2-51</key>
            <summary>ClassCastException in Category logger</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rgoers">Ralph Goers</assignee>
                                    <reporter username="jvasileff">John Vasileff</reporter>
                        <labels>
                    </labels>
                <created>Mon, 19 Sep 2011 01:10:05 +0000</created>
                <updated>Mon, 3 Oct 2011 22:07:41 +0000</updated>
                            <resolved>Tue, 27 Sep 2011 06:34:31 +0000</resolved>
                                                                    <component>Log4j 1.2 bridge</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13107575" author="jvasileff" created="Mon, 19 Sep 2011 01:11:22 +0000"  >&lt;p&gt;Attached test case for this issue.&lt;/p&gt;</comment>
                            <comment id="13107576" author="jvasileff" created="Mon, 19 Sep 2011 01:13:04 +0000"  >&lt;p&gt;Patch to fix the problem.  Commit notes:&lt;/p&gt;

&lt;p&gt;fix for Category.getInstance returning cached Logger&lt;/p&gt;

&lt;p&gt;When creating new Category instances, the Category class passed a custom&lt;br/&gt;
Factory to context.getLogger(factory, name).  The factory created loggers of&lt;br/&gt;
type CategoryFactory.CategoryLogger, and code in the Category class casted the&lt;br/&gt;
logger to this type.&lt;/p&gt;

&lt;p&gt;The problem was that context.getLogger(factory, name) only uses the provided&lt;br/&gt;
factory if it has to create a new logger.  Cached loggers would simply be&lt;br/&gt;
returned.  If the cached logger was created using a different factory, it was&lt;br/&gt;
not of type CategoryFactory.CategoryLogger and a ClassCastException would occur&lt;br/&gt;
during operations that called isEnabledFor or forcedLog.&lt;/p&gt;</comment>
                            <comment id="13107577" author="jvasileff" created="Mon, 19 Sep 2011 01:13:46 +0000"  >&lt;p&gt;re-attaching....&lt;/p&gt;</comment>
                            <comment id="13107578" author="jvasileff" created="Mon, 19 Sep 2011 01:15:30 +0000"  >&lt;p&gt;Attaching patch #3 in the series:&lt;/p&gt;

&lt;p&gt;remove dangerous logger factory override&lt;/p&gt;

&lt;p&gt;Remove LoggerContext support for custom logger factories.  All Loggers returned&lt;br/&gt;
by LoggerContext should be compatibile and of the same type.&lt;/p&gt;

&lt;p&gt;In the following:&lt;/p&gt;

&lt;p&gt;Logger getLogger(LoggerFactory factory, String name)&lt;/p&gt;

&lt;p&gt;the returned Logger was not guaranteed to be created by the provided factory.&lt;br/&gt;
The value of specifying a custom logger is diminished without this guarantee.&lt;/p&gt;

&lt;p&gt;Since only one instance of each logger exists, behavior should not be defined&lt;br/&gt;
by the caller of getLogger() that &quot;wins&quot; the race to be the one to determine&lt;br/&gt;
the factory used to create the logger.&lt;/p&gt;</comment>
                            <comment id="13114516" author="ralph.goers@dslextreme.com" created="Mon, 26 Sep 2011 07:47:34 +0000"  >&lt;p&gt;I applied the patches above and LogManager.getLogger() is still throwing a ClassCastException. In addition a second unit test is failing but I believe you said that error is fixed by the patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-50&quot; title=&quot;Incorrect %C output (FQCN) &quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-50&quot;&gt;&lt;del&gt;LOG4J2-50&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13114739" author="jvasileff" created="Mon, 26 Sep 2011 15:59:35 +0000"  >&lt;p&gt;Yes, the patch in &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-50&quot; title=&quot;Incorrect %C output (FQCN) &quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-50&quot;&gt;&lt;del&gt;LOG4J2-50&lt;/del&gt;&lt;/a&gt; is required to fix CategoryTest.testClassName().&lt;/p&gt;

&lt;p&gt;Where is the ClassCastException occurring?  I wonder if this is due to some interaction between the IDE and mvn build where a mix of old and new versions are being used.  Something like this happened to me, but after clean, etc., it cleared up.&lt;/p&gt;

&lt;p&gt;$ git log --oneline | head&lt;br/&gt;
276d6e1 cleanup FQCN code&lt;br/&gt;
bac5439 remove dangerous logger factory override&lt;br/&gt;
12a7861 fix for Category.getInstance returning cached Logger&lt;br/&gt;
d6e9975 add test for Category when using a log4j2 Logger&lt;br/&gt;
2db42d3 Enhance comments on getThrowable&lt;br/&gt;
cdc19e5 Test that class name in log message is correct&lt;/p&gt;

&lt;p&gt;$ mvn clean test&lt;br/&gt;
...&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Reactor Summary:&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Apache Log4j 2 ........................................ SUCCESS &lt;span class=&quot;error&quot;&gt;&amp;#91;1.454s&amp;#93;&lt;/span&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Log4J API ............................................. SUCCESS &lt;span class=&quot;error&quot;&gt;&amp;#91;2.689s&amp;#93;&lt;/span&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Log4J2 Core ........................................... SUCCESS &lt;span class=&quot;error&quot;&gt;&amp;#91;1:03.924s&amp;#93;&lt;/span&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Log4J Compatibility API ............................... SUCCESS &lt;span class=&quot;error&quot;&gt;&amp;#91;3.471s&amp;#93;&lt;/span&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; SLF4J Binding ......................................... SUCCESS &lt;span class=&quot;error&quot;&gt;&amp;#91;2.244s&amp;#93;&lt;/span&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Log4J2 Commons Logging ................................ SUCCESS &lt;span class=&quot;error&quot;&gt;&amp;#91;1.964s&amp;#93;&lt;/span&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; BUILD SUCCESSFUL&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Total time: 1 minute 16 seconds&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Finished at: Mon Sep 26 11:55:33 EDT 2011&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Final Memory: 37M/265M&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;/p&gt;

&lt;p&gt;$ cat log4j12-api/target/surefire-reports/org.apache.log4j.CategoryTest.txt &lt;br/&gt;
-------------------------------------------------------------------------------&lt;br/&gt;
Test set: org.apache.log4j.CategoryTest&lt;br/&gt;
-------------------------------------------------------------------------------&lt;br/&gt;
Tests run: 7, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.657 sec&lt;/p&gt;</comment>
                            <comment id="13115258" author="ralph.goers@dslextreme.com" created="Tue, 27 Sep 2011 06:34:31 +0000"  >&lt;p&gt;Patch was applied. Please verify and close.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12494998" name="0001-add-test-for-Category-when-using-a-log4j2-Logger.patch" size="1714" author="jvasileff" created="Mon, 19 Sep 2011 01:11:22 +0000"/>
                            <attachment id="12495000" name="0002-fix-for-Category.getInstance-returning-cached-Logger.patch" size="7596" author="jvasileff" created="Mon, 19 Sep 2011 01:13:46 +0000"/>
                            <attachment id="12495001" name="0003-remove-dangerous-logger-factory-override.patch" size="6640" author="jvasileff" created="Mon, 19 Sep 2011 01:15:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3258</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 9 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0124f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4110</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>