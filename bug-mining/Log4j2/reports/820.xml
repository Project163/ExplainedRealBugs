<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:36:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-1405] 2.6 html format - &quot;&lt;/table&gt;&lt;br&gt;&lt;/body&gt;&lt;/html&gt;&quot; inserted in the middle of &lt;TR&gt; when restart tomcat</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-1405</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;Hello,&lt;/p&gt;

&lt;p&gt;Updated 2.3 to 2.6. When reload tomcat7, the logfile (html format) not shown correctly:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;tr&amp;gt;
&amp;lt;td&amp;gt;13942164&amp;lt;/td&amp;gt;
&amp;lt;td title=&lt;span class=&quot;code-quote&quot;&gt;&quot;http-bio-.....exec-49 thread&quot;&lt;/span&gt;&amp;gt;http-bio-.....&amp;lt;/td&amp;gt;
&amp;lt;td title=&lt;span class=&quot;code-quote&quot;&gt;&quot;Level&quot;&lt;/span&gt;&amp;gt;INFO&amp;lt;/td&amp;gt;
&amp;lt;td title=&lt;span class=&quot;code-quote&quot;&gt;&quot; logger&quot;&lt;/span&gt;&amp;gt;ActionClass&amp;lt;/td&amp;gt;
&amp;lt;td title=&lt;span class=&quot;code-quote&quot;&gt;&quot;Message&quot;&lt;/span&gt;&amp;gt;......&amp;lt;/td&amp;gt;
&amp;lt;/tr&amp;gt;

&amp;lt;/table&amp;gt;
&amp;lt;br&amp;gt;
&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;

&amp;lt;tr&amp;gt;
&amp;lt;td&amp;gt;13936096&amp;lt;/td&amp;gt;
&amp;lt;td title=&lt;span class=&quot;code-quote&quot;&gt;&quot;.....c-50 thread&quot;&lt;/span&gt;&amp;gt;http-bio.....50&amp;lt;/td&amp;gt;
&amp;lt;td title=&lt;span class=&quot;code-quote&quot;&gt;&quot;Level&quot;&lt;/span&gt;&amp;gt;&amp;lt;font color=&lt;span class=&quot;code-quote&quot;&gt;&quot;#993300&quot;&lt;/span&gt;&amp;gt;&amp;lt;strong&amp;gt;WARN&amp;lt;/strong&amp;gt;&amp;lt;/font&amp;gt;&amp;lt;/td&amp;gt;
&amp;lt;td title=&lt;span class=&quot;code-quote&quot;&gt;&quot;logger&quot;&lt;/span&gt;&amp;gt;.....&amp;lt;/td&amp;gt;
&amp;lt;td title=&lt;span class=&quot;code-quote&quot;&gt;&quot;Message&quot;&lt;/span&gt;&amp;gt;.... &amp;lt;/td&amp;gt;
&amp;lt;/tr&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;&quot;&amp;lt;/table&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;&quot; is added in the middle, so html file cannot be printed correctly.&lt;/p&gt;


&lt;p&gt;Can someone help how to fix this please?&lt;/p&gt;

&lt;p&gt;Here is log4j2.xml config:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; &amp;lt;RollingFile name=&lt;span class=&quot;code-quote&quot;&gt;&quot;debug_html&quot;&lt;/span&gt;
                  fileName=&lt;span class=&quot;code-quote&quot;&gt;&quot;@log4j.debug.html@&quot;&lt;/span&gt;
                  filePattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;@log4j.debug.html@-%i.html&quot;&lt;/span&gt;&amp;gt;
        &amp;lt;HTMLLayout charset=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt; title=&lt;span class=&quot;code-quote&quot;&gt;&quot;.....&quot;&lt;/span&gt; /&amp;gt;
        &amp;lt;Policies&amp;gt;
           &amp;lt;SizeBasedTriggeringPolicy size=&lt;span class=&quot;code-quote&quot;&gt;&quot;5 MB&quot;&lt;/span&gt; /&amp;gt;
        &amp;lt;/Policies&amp;gt;
     &amp;lt;/RollingFile&amp;gt;


  &amp;lt;Logger name=&lt;span class=&quot;code-quote&quot;&gt;&quot;action&quot;&lt;/span&gt; level=&lt;span class=&quot;code-quote&quot;&gt;&quot;info&quot;&lt;/span&gt; additivity=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;&amp;gt;
     &amp;lt;AppenderRef ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;debug_html&quot;&lt;/span&gt;   /&amp;gt;
  &amp;lt;/Logger&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12975200">LOG4J2-1405</key>
            <summary>2.6 html format - &quot;&lt;/table&gt;&lt;br&gt;&lt;/body&gt;&lt;/html&gt;&quot; inserted in the middle of &lt;TR&gt; when restart tomcat</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rgoers">Ralph Goers</assignee>
                                    <reporter username="yle">yl</reporter>
                        <labels>
                    </labels>
                <created>Thu, 2 Jun 2016 15:29:04 +0000</created>
                <updated>Thu, 2 Mar 2017 17:01:15 +0000</updated>
                            <resolved>Mon, 6 Jun 2016 02:31:48 +0000</resolved>
                                    <version>2.6</version>
                                    <fixVersion>2.6.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15314143" author="remkop@yahoo.com" created="Fri, 3 Jun 2016 14:00:18 +0000"  >&lt;p&gt;Can you please provide steps to reproduce the issue? Do the steps below reproduce the issue?&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Start tomcat&lt;/li&gt;
	&lt;li&gt;deploy web application&lt;/li&gt;
	&lt;li&gt;open page in browser so that the application does some logging&lt;/li&gt;
	&lt;li&gt;reload the web application (or undeploy and deploy?)&lt;/li&gt;
	&lt;li&gt;open page in browser so that the application does some logging&lt;/li&gt;
	&lt;li&gt;verify log file&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Also, what version of Tomcat are you using?&lt;/p&gt;</comment>
                            <comment id="15314192" author="yle" created="Fri, 3 Jun 2016 14:32:40 +0000"  >&lt;p&gt;Hello,&lt;br/&gt;
 &amp;gt; ---------------------------------------------------&lt;br/&gt;
 &amp;gt; steps to reproduce the issue?&lt;/p&gt;

&lt;p&gt;Here is the info:&lt;/p&gt;

&lt;p&gt;(1) Deploy web app(springframe4.2.1 + struts2 + tiles3.0.5)&lt;/p&gt;

&lt;p&gt;(2) start Apache Tomcat/7.0.67&lt;/p&gt;

&lt;p&gt;(3) open login page&lt;br/&gt;
      html logs are shown correctly&lt;/p&gt;

&lt;p&gt;(4) reload tomcat&lt;br/&gt;
       No need to deploy again.&lt;br/&gt;
       Just reload tomcat under &lt;a href=&quot;http://hostname:8080/manager/html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hostname:8080/manager/html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;(5) open login page&lt;br/&gt;
       html logs are shown wrong format&lt;/p&gt;

&lt;p&gt;Attached the whole log file (debug.html).&lt;/p&gt;</comment>
                            <comment id="15314203" author="yle" created="Fri, 3 Jun 2016 14:39:40 +0000"  >&lt;p&gt;     To be more clear,   three buttons under commands column: &quot;Stop&quot;, &lt;br/&gt;
&quot;Reload&quot;, &quot;Undeploy&quot;&lt;br/&gt;
     click &quot;Reload&quot; button for the webapp will reproduce the issue.&lt;/p&gt;
</comment>
                            <comment id="15315349" author="remkop@yahoo.com" created="Sat, 4 Jun 2016 05:59:24 +0000"  >&lt;p&gt;Can you try adding &lt;tt&gt;OnStartupTriggeringPolicy&lt;/tt&gt; to your configuration:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; &amp;lt;RollingFile name=&lt;span class=&quot;code-quote&quot;&gt;&quot;debug_html&quot;&lt;/span&gt;
                  fileName=&lt;span class=&quot;code-quote&quot;&gt;&quot;@log4j.debug.html@&quot;&lt;/span&gt;
                  filePattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;@log4j.debug.html@-%i.html&quot;&lt;/span&gt;&amp;gt;
        &amp;lt;HTMLLayout charset=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt; title=&lt;span class=&quot;code-quote&quot;&gt;&quot;.....&quot;&lt;/span&gt; /&amp;gt;
        &amp;lt;Policies&amp;gt;
           &amp;lt;OnStartupTriggeringPolicy /&amp;gt;
           &amp;lt;SizeBasedTriggeringPolicy size=&lt;span class=&quot;code-quote&quot;&gt;&quot;5 MB&quot;&lt;/span&gt; /&amp;gt;
        &amp;lt;/Policies&amp;gt;
     &amp;lt;/RollingFile&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;What I think happened is that when you reload the web application, Log4j is stopped once and then started again. When it is stopped it performs cleanup, like writing footers and flushing buffers. The &lt;tt&gt;&amp;lt;/table&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;&lt;/tt&gt; is the HTML Layout footer.&lt;/p&gt;

&lt;p&gt;This is fine, but when the application is started again you want to start with a header and this is missing. I hope that by adding &lt;tt&gt;&amp;lt;OnStartupTriggeringPolicy /&amp;gt;&lt;/tt&gt; we can trigger a rollover when your web app is started again. This should generate the header at the start of the new file.&lt;/p&gt;</comment>
                            <comment id="15315565" author="ralph.goers@dslextreme.com" created="Sat, 4 Jun 2016 16:35:19 +0000"  >&lt;p&gt;Yes, that is definitely the problem. If the file exists then RollingFileManager is created with the writeHeader flag set to false as a log file should never have more than one header. But since the file didn&apos;t roll over more log events are just going to be appended to the file.&lt;/p&gt;

&lt;p&gt;However, we will need to check if the footer will be written again when OnStartupTriggeringPolicy runs.&lt;/p&gt;</comment>
                            <comment id="15315592" author="remkop@yahoo.com" created="Sat, 4 Jun 2016 17:54:25 +0000"  >&lt;p&gt;Good to hear about the first part, not sure I understood your last comment. &lt;/p&gt;

&lt;p&gt;What do we need to check?  Should rollover work differently depending on the trigger?&lt;/p&gt;</comment>
                            <comment id="15315630" author="ralph.goers@dslextreme.com" created="Sat, 4 Jun 2016 20:59:22 +0000"  >&lt;p&gt;Whenever the output stream is closed the footer is written. I believe that when the Appender starts it opens the output stream - the writeHeader flag isn&apos;t true so no header is written, then the rollover occurs which will close the stream and write a footer (which we don&apos;t want). Then the new file is opened.&lt;/p&gt;

&lt;p&gt;But I need to run a test and see if it actually works this way or if we roll before the file is even opened.&lt;/p&gt;</comment>
                            <comment id="15315687" author="ralph.goers@dslextreme.com" created="Sat, 4 Jun 2016 23:58:47 +0000"  >&lt;p&gt;It is as I feared. The footer does get written twice.&lt;/p&gt;</comment>
                            <comment id="15316135" author="remkop@yahoo.com" created="Mon, 6 Jun 2016 02:31:49 +0000"  >&lt;p&gt;Please add the &lt;tt&gt;OnStartupTriggeringPolicy&lt;/tt&gt; policy to your configuration.&lt;/p&gt;

&lt;p&gt;Ralph fixed the issue where&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;OnStartupTriggeringPolicy was forcing a rollover of empty files at startup and would append a second footer that was added by the prior shutdown.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This will be included in the 2.6.1 bugfix release which is now being reviewed.&lt;br/&gt;
Please verify and close.&lt;/p&gt;</comment>
                            <comment id="15892609" author="emilu" created="Thu, 2 Mar 2017 17:01:15 +0000"  >&lt;p&gt;Tried log4j2.8, when reload project (under tomcat manager, click &quot;Reload&quot; button; or just reinstall webapp to tomcat7), we still got &quot;&amp;lt;/table&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;&quot; between html table lines. &lt;/p&gt;

&lt;p&gt;Steps:&lt;br/&gt;
(1) Create on blank struts2 project &lt;/p&gt;

&lt;p&gt;     private static final Logger       log      = LogManager.getLogger(ProcessTestAction.class.getName());&lt;/p&gt;

&lt;p&gt;   public String execute() throws Exception &lt;/p&gt;
   {  
      log.debug(&quot;test1 reload webapp&quot;); 
      
      return SUCCESS; 
   }  


&lt;p&gt;(2) Run: &lt;br/&gt;
    &lt;a href=&quot;http://localhost:8080/blank/index.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8080/blank/index.html&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;(3) Display debug.html in browser&lt;/p&gt;


&lt;p&gt;(4) Open tomcat manager&lt;br/&gt;
    Click &quot;Reload&quot; button&lt;/p&gt;


&lt;p&gt;(5) Run: &lt;br/&gt;
    &lt;a href=&quot;http://localhost:8080/blank/index.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8080/blank/index.html&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;(6) Display debug.html in browser&lt;/p&gt;


&lt;p&gt;(7)  vi debug.html&lt;br/&gt;
      &quot;&amp;lt;/table&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;&quot; caused html report not shown correctly. &lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12923513">LOG4J2-1228</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12807971" name="debug.html" size="2026" author="yle" created="Fri, 3 Jun 2016 14:32:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 37 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2yw9r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>