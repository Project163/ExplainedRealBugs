<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:41:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-2916] If loggercontext got reconfigured and kafka appender got recreated, the previous producer can not be closed, which cause thread leak</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-2916</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;If loggercontext got reconfigured and kafka appender got recreated, the previous kafka producer thread can not be closed, which cause thread leak&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Repeat steps:&lt;/p&gt;

&lt;p&gt;xml configured to use kafka appender&lt;/p&gt;

&lt;p&gt;LoggerContext.getContext(false).reconfigure();&lt;br/&gt;
LoggerContext.getContext(false).reconfigure();&lt;br/&gt;
LoggerContext.getContext(false).reconfigure();&lt;br/&gt;
LoggerContext.getContext(false).reconfigure();&lt;br/&gt;
LoggerContext.getContext(false).reconfigure();&lt;br/&gt;
LoggerContext.getContext(false).reconfigure();&lt;br/&gt;
LoggerContext.getContext(false).reconfigure();&lt;br/&gt;
LoggerContext.getContext(false).reconfigure();&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Resolution:&lt;/p&gt;

&lt;p&gt;In case the abstractlogmanager always cache the latest new producer and old producer can not be released.&lt;/p&gt;

&lt;p&gt;When creating new kafkamanager, add a logic to release previous kafka producer.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;public void startup() {&lt;br/&gt;
 // If loggercontext reconfigured and kafka appender got recreated, the previous producer can not be closed&lt;br/&gt;
 // which cause thread leak&lt;br/&gt;
 if(producer != null)&lt;/p&gt;
{
 producer.close();
 }
&lt;p&gt; producer = producerFactory.newKafkaProducer(config);&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13324374">LOG4J2-2916</key>
            <summary>If loggercontext got reconfigured and kafka appender got recreated, the previous producer can not be closed, which cause thread leak</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vy">Volkan Yazici</assignee>
                                    <reporter username="wuqian">wuqian</reporter>
                        <labels>
                    </labels>
                <created>Tue, 25 Aug 2020 04:00:37 +0000</created>
                <updated>Thu, 12 Nov 2020 22:15:33 +0000</updated>
                            <resolved>Thu, 12 Nov 2020 22:15:33 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17230772" author="jira-bot" created="Thu, 12 Nov 2020 16:48:40 +0000"  >&lt;p&gt;Commit d8c8691917763451aa43a8d00f147d2c6fc799b1 in logging-log4j2&apos;s branch refs/heads/master from Volkan Yaz&#305;c&#305;&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=d8c8691&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=d8c8691&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2916&quot; title=&quot;If loggercontext got reconfigured and kafka appender got recreated, the previous producer can not be closed, which cause thread leak&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2916&quot;&gt;&lt;del&gt;LOG4J2-2916&lt;/del&gt;&lt;/a&gt; Avoid redundant Kafka producer instantiation causing thread leaks.&lt;/p&gt;</comment>
                            <comment id="17230999" author="jira-bot" created="Thu, 12 Nov 2020 22:10:25 +0000"  >&lt;p&gt;Commit 97db5743a3b10e9017bf70794d6275b21553dd44 in logging-log4j2&apos;s branch refs/heads/master from Volkan Yaz&#305;c&#305;&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=97db574&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=97db574&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2916&quot; title=&quot;If loggercontext got reconfigured and kafka appender got recreated, the previous producer can not be closed, which cause thread leak&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2916&quot;&gt;&lt;del&gt;LOG4J2-2916&lt;/del&gt;&lt;/a&gt; Avoid redundant Kafka producer instantiation causing thread leaks.&lt;/p&gt;</comment>
                            <comment id="17231000" author="jira-bot" created="Thu, 12 Nov 2020 22:11:19 +0000"  >&lt;p&gt;Commit 4bd4b5efe2cd1e1da7ef4c84cd205aba0d1187b4 in logging-log4j2&apos;s branch refs/heads/release-2.x from Volkan Yazici&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=4bd4b5e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=4bd4b5e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2916&quot; title=&quot;If loggercontext got reconfigured and kafka appender got recreated, the previous producer can not be closed, which cause thread leak&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2916&quot;&gt;&lt;del&gt;LOG4J2-2916&lt;/del&gt;&lt;/a&gt; Avoid redundant Kafka producer instantiation causing thread leaks.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0i21s:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>