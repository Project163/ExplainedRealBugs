<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:31:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-166] Routing Appender default Route broken for references</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-166</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;I recently updated to using beta4 and ran into a problem upon startup where I received numerous errors such as this:&lt;br/&gt;
2013-02-14 12:27:40,139 ERROR No Appender was configured for route null&lt;/p&gt;

&lt;p&gt;Everything was working great up though beta3.  After tracing it back, I think I found that it relates to the change Ralph alluded to in &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-129&quot; title=&quot;RoutingAppender dynamic appender creation only creates 1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-129&quot;&gt;&lt;del&gt;LOG4J2-129&lt;/del&gt;&lt;/a&gt;...&lt;br/&gt;
&quot;The problem was that the code was treating the Appender being created under the default Route as the default. That is incorrect. The code has been modified to just keep track of the default route.&quot;&lt;/p&gt;


&lt;p&gt;I think my setup was relying on that incorrect behavior, and that it&apos;s somewhat similar to what William is trying to accomplish.&lt;br/&gt;
(His comment: &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-129?focusedCommentId=13553008&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13553008&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/LOG4J2-129?focusedCommentId=13553008&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13553008&lt;/a&gt; )&lt;/p&gt;

&lt;p&gt;I have several appenders created, and a routing appender to map events to them using static definitions.  I also have a catch-all appender where I want all non-matched events to be sent.  The &lt;span class=&quot;error&quot;&gt;&amp;#91;abbreviated&amp;#93;&lt;/span&gt; configuration is like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &amp;lt;appenders&amp;gt;

    &amp;lt;RollingFile name=&lt;span class=&quot;code-quote&quot;&gt;&quot;apples&quot;&lt;/span&gt; fileName=&lt;span class=&quot;code-quote&quot;&gt;&quot;logs/apples&quot;&lt;/span&gt; filePattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;logs/apples.%d{yyyy-MM-dd}&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;PatternLayout pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;${commonLayout}&quot;&lt;/span&gt;/&amp;gt;
      &amp;lt;Policies&amp;gt;
        &amp;lt;TimeBasedTriggeringPolicy interval=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; modulate=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;/&amp;gt;
      &amp;lt;/Policies&amp;gt;
    &amp;lt;/RollingFile&amp;gt;

    &amp;lt;RollingFile name=&lt;span class=&quot;code-quote&quot;&gt;&quot;oranges&quot;&lt;/span&gt; fileName=&lt;span class=&quot;code-quote&quot;&gt;&quot;logs/oranges&quot;&lt;/span&gt; filePattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;logs/oranges.%d{yyyy-MM-dd}&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;PatternLayout pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;${commonLayout}&quot;&lt;/span&gt;/&amp;gt;
      &amp;lt;Policies&amp;gt;
        &amp;lt;TimeBasedTriggeringPolicy interval=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; modulate=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;/&amp;gt;
      &amp;lt;/Policies&amp;gt;
    &amp;lt;/RollingFile&amp;gt;

    &amp;lt;RollingFile name=&lt;span class=&quot;code-quote&quot;&gt;&quot;other&quot;&lt;/span&gt; fileName=&lt;span class=&quot;code-quote&quot;&gt;&quot;logs/other&quot;&lt;/span&gt; filePattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;logs/other.%d{yyyy-MM-dd}&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;PatternLayout pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;${commonLayout}&quot;&lt;/span&gt;/&amp;gt;
      &amp;lt;Policies&amp;gt;
        &amp;lt;TimeBasedTriggeringPolicy interval=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; modulate=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;/&amp;gt;
      &amp;lt;/Policies&amp;gt;
    &amp;lt;/RollingFile&amp;gt;

    &amp;lt;Routing name=&lt;span class=&quot;code-quote&quot;&gt;&quot;Routing&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;Routes pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;$${ctx:fruit}&quot;&lt;/span&gt;&amp;gt;
        &amp;lt;Route key=&lt;span class=&quot;code-quote&quot;&gt;&quot;apples&quot;&lt;/span&gt; ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;apples&quot;&lt;/span&gt;/&amp;gt;
        &amp;lt;Route key=&lt;span class=&quot;code-quote&quot;&gt;&quot;oranges&quot;&lt;/span&gt; ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;oranges&quot;&lt;/span&gt;/&amp;gt;
        &amp;lt;Route ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;other&quot;&lt;/span&gt;/&amp;gt;
      &amp;lt;/Routes&amp;gt;
    &amp;lt;/Routing&amp;gt;

  &amp;lt;/appenders&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So the idea is that anything which has a ctx:fruit value of apples/oranges goes into the specific files, any everything else (regardless of ctx:fruit being defined or not) going into the &quot;other&quot; file.&lt;/p&gt;

&lt;p&gt;At startup time, most (if not all) events fall into the case of not having ctx:fruit defined at all.  And during my debugging, I saw that &quot;...the replacement won&apos;t occur if the context value isn&apos;t present..&quot; as William mentioned.&lt;/p&gt;

&lt;p&gt;In RoutingAppender.java on line 107 there is:&lt;br/&gt;
   final String key = config.getSubst().replace(event, routes.getPattern());&lt;/p&gt;

&lt;p&gt;The value that ends up being assigned is the literal string &quot;${ctx:fruit}&quot; instead of null.  As a result, it chooses the default Route entry of &quot;other&quot; which hasn&apos;t been created yet, so it proceeds to create that appender.  So far so good, until...&lt;/p&gt;

&lt;p&gt;In RoutingAppender.java on lines 142-144 there is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Node routeNode = route.getNode();
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Node node : routeNode.getChildren()) {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (node.getType().getElementName().equals(&lt;span class=&quot;code-quote&quot;&gt;&quot;appender&quot;&lt;/span&gt;)) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I traced the execution and routeNode.getChildren() returns an empty list.  I believe this is due to the &amp;lt;Route/&amp;gt; entries in the config...they don&apos;t have any child nodes because they are just referencing some existing appenders.&lt;/p&gt;

</description>
                <environment></environment>
        <key id="12632445">LOG4J2-166</key>
            <summary>Routing Appender default Route broken for references</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="djohle">David Johle</reporter>
                        <labels>
                            <label>appender</label>
                            <label>config</label>
                            <label>configuration</label>
                            <label>route</label>
                            <label>routing</label>
                    </labels>
                <created>Thu, 14 Feb 2013 19:24:54 +0000</created>
                <updated>Sat, 20 Jul 2013 07:21:48 +0000</updated>
                            <resolved>Sat, 20 Jul 2013 07:21:48 +0000</resolved>
                                    <version>2.0-beta4</version>
                    <version>2.0-beta5</version>
                    <version>2.0-beta6</version>
                                    <fixVersion>2.0-beta9</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13678359" author="djohle" created="Fri, 7 Jun 2013 19:51:05 +0000"  >&lt;p&gt;PROGRESS!  I found a workaround for this issue, which also helps confirm and/or narrow down the problem.&lt;/p&gt;

&lt;p&gt;Messing around with beta6 today and I got it to work as it used to back in beta 3 by changing my XML in the following manner:&lt;/p&gt;

&lt;p&gt;Instead of defining my catch-all &quot;other&quot; logger in the &amp;lt;appenders&amp;gt; section and then putting a reference to it in the &amp;lt;Routes&amp;gt; I do an inline appender in a &amp;lt;Route&amp;gt; as my default.&lt;/p&gt;

&lt;p&gt;So, in line with what I&apos;ve discovered before, the XML now has a &amp;lt;Route&amp;gt; node with children, thus the routeNode.getChildren() is not empty, and no more &quot;No Appender was configured for route null&quot; error.&lt;/p&gt;



&lt;p&gt;So, in summary, this bug can be reduced to:&lt;/p&gt;

&lt;p&gt;Defining a default route for a routing appender does not work if the default route is a reference.&lt;/p&gt;</comment>
                            <comment id="13714370" author="ralph.goers@dslextreme.com" created="Sat, 20 Jul 2013 07:21:48 +0000"  >&lt;p&gt;The problem was that when the default route was selected it was not returning the AppenderControl.  This has been resolved in revision 1505102. Please verify and close.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>312941</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 18 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1i067:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>313287</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>