<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:41:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-3054] BasicContextSelector.hasContext should take default CONTEXT into account</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-3054</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;Issue was introduced in release&#160;&lt;b&gt;2.13.0&lt;/b&gt; as a side effect of implementation of&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2621&quot; title=&quot;Create log4j-plugins module and use ServiceLoader to load plugins&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2621&quot;&gt;&lt;del&gt;LOG4J2-2621&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;New method&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
BasicContextSelector.hasContext&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;returns &lt;ins&gt;false&lt;/ins&gt; even if Default context is started and have some appenders. &lt;br/&gt;
 This way&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
LogManager.shutdown() &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;do nothing in such case and all appenders from started Default context are not closed after LogManager.shutdown() returned.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;This in turn prevents log files from being deleted further from that process (at least on Windows).&lt;/p&gt;

&lt;p&gt;I have faced the issue in my functional tests that try to cleanup log files created in scope of the test. &lt;br/&gt;
 Cleanup code at first calls&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
LogManager.shutdown()&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and then&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Files.deleteIfExists(logFilePath);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The latter fails with the following error:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Can not remove file [C:\Users\xxx\AppData\Local\Temp\logA.log]Can not remove file at org.testng.Assert.fail(Assert.java:83) at com.jetbrains.service.util.logging.SLF4JBridgeTest.removeFile(SLF4JBridgeTest.java:157) at com.jetbrains.service.util.logging.SLF4JBridgeTest.cleanUpLogFiles(SLF4JBridgeTest.java:134) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:498) at org.testng.internal.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:80) at org.testng.internal.Invoker.invokeConfigurationMethod(Invoker.java:564) at org.testng.internal.Invoker.invokeConfigurations(Invoker.java:213) at org.testng.internal.Invoker.invokeConfigurations(Invoker.java:138) at org.testng.TestRunner.afterRun(TestRunner.java:1021) at org.testng.TestRunner.run(TestRunner.java:621) at org.testng.SuiteRunner.runTest(SuiteRunner.java:334) at org.testng.SuiteRunner.runSequentially(SuiteRunner.java:329) at org.testng.SuiteRunner.privateRun(SuiteRunner.java:291) at org.testng.SuiteRunner.run(SuiteRunner.java:240) at org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52) at org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:86) at org.testng.TestNG.runSuitesSequentially(TestNG.java:1198) at org.testng.TestNG.runSuitesLocally(TestNG.java:1123) at org.testng.TestNG.run(TestNG.java:1031) at org.gradle.api.internal.tasks.testing.testng.TestNGTestClassProcessor.runTests(TestNGTestClassProcessor.java:140) at org.gradle.api.internal.tasks.testing.testng.TestNGTestClassProcessor.stop(TestNGTestClassProcessor.java:89) at org.gradle.api.internal.tasks.testing.SuiteTestClassProcessor.stop(SuiteTestClassProcessor.java:61) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:498) at org.gradle.internal.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:35) at org.gradle.internal.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:24) at org.gradle.internal.dispatch.ContextClassLoaderDispatch.dispatch(ContextClassLoaderDispatch.java:32) at org.gradle.internal.dispatch.ProxyDispatchAdapter$DispatchingInvocationHandler.invoke(ProxyDispatchAdapter.java:93) at com.sun.proxy.$Proxy2.stop(Unknown Source) at org.gradle.api.internal.tasks.testing.worker.TestWorker.stop(TestWorker.java:132) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:498) at org.gradle.internal.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:35) at org.gradle.internal.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:24) at org.gradle.internal.remote.internal.hub.MessageHubBackedObjectConnection$DispatchWrapper.dispatch(MessageHubBackedObjectConnection.java:175) at org.gradle.internal.remote.internal.hub.MessageHubBackedObjectConnection$DispatchWrapper.dispatch(MessageHubBackedObjectConnection.java:157) at org.gradle.internal.remote.internal.hub.MessageHub$Handler.run(MessageHub.java:404) at org.gradle.internal.concurrent.ExecutorPolicy$CatchAndRecordFailures.onExecute(ExecutorPolicy.java:63) at org.gradle.internal.concurrent.ManagedExecutorImpl$1.run(ManagedExecutorImpl.java:46) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) at org.gradle.internal.concurrent.ThreadFactoryImpl$ManagedThreadRunnable.run(ThreadFactoryImpl.java:55) at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)Caused by: java.nio.file.FileSystemException: C:\Users\xxx\AppData\Local\Temp\logA.log: The process cannot access the file because it is being used by another process.&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;br/&gt;
 The same cleanup code run successfully for version &lt;b&gt;2.12.1&lt;/b&gt;&#160;(because it resolve Default context and close its appenders)&lt;/p&gt;

&lt;p&gt;It looks as if current method BasicContextSelector.hasContext&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Override
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; hasContext(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; fqcn, &lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt; loader, &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; currentContext) {
    LoggerContext ctx = ContextAnchor.THREAD_CONTEXT.get();
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ctx != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; ctx.isStarted();
}&#160;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;should be replaced with&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Override
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; hasContext(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; fqcn, &lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt; loader, &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; currentContext) {
    LoggerContext ctx = getContext(fqcn, loader, currentContext);
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ctx.isStarted();
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13367089">LOG4J2-3054</key>
            <summary>BasicContextSelector.hasContext should take default CONTEXT into account</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ckozak">Carter Kozak</assignee>
                                    <reporter username="alnat83">Alexey Barsov</reporter>
                        <labels>
                    </labels>
                <created>Tue, 23 Mar 2021 19:33:58 +0000</created>
                <updated>Sat, 3 Apr 2021 10:45:55 +0000</updated>
                            <resolved>Wed, 24 Mar 2021 01:00:16 +0000</resolved>
                                    <version>2.14.1</version>
                                    <fixVersion>2.15.0</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17307384" author="alnat83" created="Tue, 23 Mar 2021 20:02:38 +0000"  >&lt;p&gt;there is a workaround I used in tests. In addition to (or instead of) calling of LogManager.shutdown() one might call the following code that will terminate started current context directly (bypassing &lt;em&gt;hasContext&lt;/em&gt;&#160;call)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
LoggerContext context = (LoggerContext)LogManager.getContext();
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (context.isStarted()) {
  context.terminate();
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17307402" author="ckozak" created="Tue, 23 Mar 2021 20:21:59 +0000"  >&lt;p&gt;I&apos;m actively working on some other improvements to context selectors, I&apos;ll take a look at this in the next couple days. Thanks for the detailed report!&lt;/p&gt;</comment>
                            <comment id="17307448" author="ralph.goers@dslextreme.com" created="Tue, 23 Mar 2021 22:26:01 +0000"  >&lt;p&gt;For the record, this issue has nothing to do with &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2621&quot; title=&quot;Create log4j-plugins module and use ServiceLoader to load plugins&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2621&quot;&gt;&lt;del&gt;LOG4J2-2621&lt;/del&gt;&lt;/a&gt;. That issue only involved changes to the master branch, not release-2.x.&lt;/p&gt;</comment>
                            <comment id="17307485" author="jira-bot" created="Wed, 24 Mar 2021 00:57:52 +0000"  >&lt;p&gt;Commit 0ee8e2089457125a9efb9201fc6f7b301a3d2090 in logging-log4j2&apos;s branch refs/heads/release-2.x from Carter Kozak&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=0ee8e20&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=0ee8e20&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3054&quot; title=&quot;BasicContextSelector.hasContext should take default CONTEXT into account&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3054&quot;&gt;&lt;del&gt;LOG4J2-3054&lt;/del&gt;&lt;/a&gt;: BasicContextSelector takes the default context into account&lt;/p&gt;</comment>
                            <comment id="17307486" author="jira-bot" created="Wed, 24 Mar 2021 00:58:31 +0000"  >&lt;p&gt;Commit 20f9a97dbe5928c3b5077bcdd2a22ac92e941655 in logging-log4j2&apos;s branch refs/heads/master from Carter Kozak&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=20f9a97&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=20f9a97&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3054&quot; title=&quot;BasicContextSelector.hasContext should take default CONTEXT into account&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3054&quot;&gt;&lt;del&gt;LOG4J2-3054&lt;/del&gt;&lt;/a&gt;: BasicContextSelector takes the default context into account&lt;/p&gt;</comment>
                            <comment id="17307489" author="ckozak" created="Wed, 24 Mar 2021 01:00:17 +0000"  >&lt;p&gt;I&apos;ve merged the fix to release-2.x for the upcoming 2.15.0 release as well as master for 3.x.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=alnat83&quot; class=&quot;user-hover&quot; rel=&quot;alnat83&quot;&gt;alnat83&lt;/a&gt;&#160;can you verify the fix using a snapshot and close the ticket? Thanks!&lt;/p&gt;</comment>
                            <comment id="17307756" author="alnat83" created="Wed, 24 Mar 2021 11:15:02 +0000"  >&lt;p&gt;yes, the issue issue is gone in 2.15.0-SNAPSHOT, thanks!&lt;/p&gt;</comment>
                            <comment id="17310302" author="jira-bot" created="Sun, 28 Mar 2021 23:10:23 +0000"  >&lt;p&gt;Commit d02f446bbd8a3606084885cf67fc374d68d3328a in logging-log4j2&apos;s branch refs/heads/master-java11 from Carter Kozak&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=d02f446&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=d02f446&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3054&quot; title=&quot;BasicContextSelector.hasContext should take default CONTEXT into account&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3054&quot;&gt;&lt;del&gt;LOG4J2-3054&lt;/del&gt;&lt;/a&gt;: BasicContextSelector takes the default context into account&lt;/p&gt;</comment>
                            <comment id="17314230" author="jira-bot" created="Sat, 3 Apr 2021 10:45:55 +0000"  >&lt;p&gt;Commit 0ee8e2089457125a9efb9201fc6f7b301a3d2090 in logging-log4j2&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3004&quot; title=&quot;Migrate JsonTemplateLayout static resolvers to plugins&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3004&quot;&gt;&lt;del&gt;LOG4J2-3004&lt;/del&gt;&lt;/a&gt; from Carter Kozak&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=0ee8e20&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=0ee8e20&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3054&quot; title=&quot;BasicContextSelector.hasContext should take default CONTEXT into account&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3054&quot;&gt;&lt;del&gt;LOG4J2-3054&lt;/del&gt;&lt;/a&gt;: BasicContextSelector takes the default context into account&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 32 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0p3vc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>