<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:41:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-2211] MainMapLookup ${main:--file} placeholder doesn&apos;t work</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-2211</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;I&#160;use the&#160;MainMapLookup like the documentation(&lt;a href=&quot;http://logging.apache.org/log4j/2.x/manual/lookups.html#AppMainArgsLookup),i&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://logging.apache.org/log4j/2.x/manual/lookups.html#AppMainArgsLookup),b&lt;/a&gt;ut&#160;the &quot;${main:&#8211;file}&quot; doesn&apos;t work, it replace the&#160;placeholder by default value &quot;-file&quot;.&lt;/p&gt;

&lt;p&gt;log4j2.xml(log4j2 2.10.0)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.0&quot;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;?&amp;gt;
&amp;lt;Configuration status=&lt;span class=&quot;code-quote&quot;&gt;&quot;INFO&quot;&lt;/span&gt;&amp;gt;
&amp;lt;Appenders&amp;gt;
&amp;lt;Console name=&lt;span class=&quot;code-quote&quot;&gt;&quot;Console&quot;&lt;/span&gt; target=&lt;span class=&quot;code-quote&quot;&gt;&quot;SYSTEM_OUT&quot;&lt;/span&gt;&amp;gt;
&amp;lt;PatternLayout
pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;%d [%t] [${main:--file}] %-5level: %msg%n%throwable&quot;&lt;/span&gt; /&amp;gt;
&amp;lt;/Console&amp;gt;
&amp;lt;/Appenders&amp;gt;
&amp;lt;Loggers&amp;gt;
&amp;lt;Logger name=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.foo&quot;&lt;/span&gt; level=&lt;span class=&quot;code-quote&quot;&gt;&quot;DEBUG&quot;&lt;/span&gt; /&amp;gt;
&amp;lt;Root level=&lt;span class=&quot;code-quote&quot;&gt;&quot;TRACE&quot;&lt;/span&gt;&amp;gt;
&amp;lt;AppenderRef ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;Console&quot;&lt;/span&gt; /&amp;gt;
&amp;lt;/Root&amp;gt;
&amp;lt;/Loggers&amp;gt;
&amp;lt;/Configuration&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;im sure i have written the code:&#160;MainMapLookup.setMainArguments(args);&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;my program arguments are :&#160;--file foo.txt --verbose -x bar&lt;/p&gt;

&lt;p&gt;so i traced the source code, in&#160;StrSubstitutor.class line 958, it changes my varName &quot;main:&#8211;file&quot; to &quot;main&quot;. i can&apos;t&#160;understand the code : &quot;varName = varNameExpr.substring(0, i);&quot;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (valueDelimiterMatcher != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;char&lt;/span&gt; [] varNameExprChars = varNameExpr.toCharArray();
&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; valueDelimiterMatchLen = 0;
&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; varNameExprChars.length; i++) {
&lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; there&apos;s any nested variable when nested variable substitution disabled, then stop resolving name and &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; value.
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!substitutionInVariablesEnabled
&amp;amp;&amp;amp; prefixMatcher.isMatch(varNameExprChars, i, i, varNameExprChars.length) != 0) {
&lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
}
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ((valueDelimiterMatchLen = valueDelimiterMatcher.isMatch(varNameExprChars, i)) != 0) {
varName = varNameExpr.substring(0, i);
varDefaultValue = varNameExpr.substring(i + valueDelimiterMatchLen);
&lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
}
}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;then org.apache.logging.log4j.core.lookup.Interpolator.class&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Override
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; lookup(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; LogEvent event, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;) {
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
}

&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; prefixPos = &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;.indexOf(PREFIX_SEPARATOR);
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (prefixPos &amp;gt;= 0) {
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; prefix = &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;.substring(0, prefixPos).toLowerCase(Locale.US);
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name = &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;.substring(prefixPos + 1);
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; StrLookup lookup = lookups.get(prefix);
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (lookup &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; ConfigurationAware) {
((ConfigurationAware) lookup).setConfiguration(configuration);
}
&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; value = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (lookup != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
value = event == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? lookup.lookup(name) : lookup.lookup(event, name);
}

&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (value != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; value;
}
&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; = &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;.substring(prefixPos + 1);
}
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (defaultLookup != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; event == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? defaultLookup.lookup(&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;) : defaultLookup.lookup(event, &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;);
}
&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;in the red mark, var=&quot;main&quot; and&#160;prefixPos=-1. so it return the default value &quot;-file&quot;;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment>&lt;p&gt;java: 1.7&lt;br/&gt;
log4j: 2.10.0&lt;/p&gt;

&lt;p&gt;os : windows&lt;/p&gt;</environment>
        <key id="13133023">LOG4J2-2211</key>
            <summary>MainMapLookup ${main:--file} placeholder doesn&apos;t work</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="wangzhongkuo">wangzhongkuo</reporter>
                        <labels>
                            <label>newbie</label>
                    </labels>
                <created>Tue, 23 Jan 2018 11:44:28 +0000</created>
                <updated>Fri, 5 Jun 2020 08:20:42 +0000</updated>
                            <resolved>Sun, 16 Feb 2020 07:40:55 +0000</resolved>
                                    <version>2.10.0</version>
                                    <fixVersion>2.13.1</fixVersion>
                                    <component>Lookups</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3600">1h</timespent>
                                <comments>
                            <comment id="16336883" author="garydgregory" created="Wed, 24 Jan 2018 04:30:47 +0000"  >&lt;p&gt;This is a known issue and we already have a JIRA for it. The problem is that property substitution uses the format ${key:&lt;del&gt;defaultValue} value. So you can see that in ${main:&lt;/del&gt;&lt;del&gt;file}, the &lt;tt&gt;&lt;/del&gt;-file&lt;/tt&gt; is the default value.&lt;/p&gt;

&lt;p&gt;It would seem we need a way to escape within the ${} syntax.&lt;/p&gt;</comment>
                            <comment id="16336894" author="githubbot" created="Wed, 24 Jan 2018 04:53:17 +0000"  >&lt;p&gt;GitHub user wangzhongkuo opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/logging-log4j2/pull/144&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/logging-log4j2/pull/144&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Update StrSubstitutor.java&lt;/p&gt;

&lt;p&gt;    //fix bug &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2211&quot; title=&quot;MainMapLookup ${main:--file} placeholder doesn&amp;#39;t work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2211&quot;&gt;&lt;del&gt;LOG4J2-2211&lt;/del&gt;&lt;/a&gt; (&lt;a href=&quot;https://issues.apache.org/jira/projects/LOG4J2/issues/LOG4J2-2211?filter=addedrecently&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/projects/LOG4J2/issues/LOG4J2-2211?filter=addedrecently&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/wangzhongkuo/logging-log4j2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/wangzhongkuo/logging-log4j2&lt;/a&gt; patch-1&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/logging-log4j2/pull/144.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/logging-log4j2/pull/144.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #144&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 00c9e5658241855927af856768ea632520b4ab9a&lt;br/&gt;
Author: wangzhongkuo &amp;lt;wzk_it@...&amp;gt;&lt;br/&gt;
Date:   2018-01-24T04:52:38Z&lt;/p&gt;

&lt;p&gt;    Update StrSubstitutor.java&lt;/p&gt;

&lt;p&gt;    //fix bug &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2211&quot; title=&quot;MainMapLookup ${main:--file} placeholder doesn&amp;#39;t work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2211&quot;&gt;&lt;del&gt;LOG4J2-2211&lt;/del&gt;&lt;/a&gt; (&lt;a href=&quot;https://issues.apache.org/jira/projects/LOG4J2/issues/LOG4J2-2211?filter=addedrecently&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/projects/LOG4J2/issues/LOG4J2-2211?filter=addedrecently&lt;/a&gt;)&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16336929" author="githubbot" created="Wed, 24 Jan 2018 05:15:31 +0000"  >&lt;p&gt;Github user garydgregory commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/logging-log4j2/pull/144&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/logging-log4j2/pull/144&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thank you for your patch. Can you please provide a unit test?&lt;/p&gt;</comment>
                            <comment id="16336930" author="ralph.goers@dslextreme.com" created="Wed, 24 Jan 2018 05:18:34 +0000"  >&lt;p&gt;The syntax for lookups is &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;${lookupType:varName[:-defaultValue]]&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In this case I am not sure why the code is getting confused since &quot;main:&quot; should be stripped by the Interpolator and &quot;--file&quot; should be all that is left and since it doesn&apos;t start with &quot;:&quot; it should be considered to be the variable name. &lt;/p&gt;

&lt;p&gt;I don&apos;t understand how the provided patch solves this problem.&lt;/p&gt;

&lt;p&gt;We need to add a unit test for this so we can understand what the cause of the problem is.&lt;/p&gt;</comment>
                            <comment id="16336973" author="remkop@yahoo.com" created="Wed, 24 Jan 2018 06:06:31 +0000"  >&lt;p&gt;Added link to related (duplicate?) issue &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1013&quot; title=&quot;Log4j2 Main Arguments Lookup by name doesn&amp;#39;t work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1013&quot;&gt;&lt;del&gt;LOG4J2-1013&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I tried fixing &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1013&quot; title=&quot;Log4j2 Main Arguments Lookup by name doesn&amp;#39;t work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1013&quot;&gt;&lt;del&gt;LOG4J2-1013&lt;/del&gt;&lt;/a&gt; once but my fix broke the existing unit tests and I reverted since I did not have time to investigate in depth. &lt;/p&gt;

&lt;p&gt;(&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1013&quot; title=&quot;Log4j2 Main Arguments Lookup by name doesn&amp;#39;t work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1013&quot;&gt;&lt;del&gt;LOG4J2-1013&lt;/del&gt;&lt;/a&gt; has an attached patch with my attempted fix. Comments on that ticket have more detail.)&lt;/p&gt;</comment>
                            <comment id="16336989" author="githubbot" created="Wed, 24 Jan 2018 06:15:46 +0000"  >&lt;p&gt;Github user wangzhongkuo commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/logging-log4j2/pull/144&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/logging-log4j2/pull/144&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    i use the unit test org.apache.logging.log4j.core.lookup.MainInputArgumentsLookupTest &lt;/p&gt;</comment>
                            <comment id="16337587" author="wangzhongkuo" created="Wed, 24 Jan 2018 13:32:24 +0000"  >&lt;p&gt;```java&lt;/p&gt;

&lt;p&gt;/**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Resolves the specified variable. This implementation will try to extract&lt;/li&gt;
	&lt;li&gt;a variable prefix from the given variable name (the first colon (&apos;:&apos;) is&lt;/li&gt;
	&lt;li&gt;used as prefix separator). It then passes the name of the variable with&lt;/li&gt;
	&lt;li&gt;the prefix stripped to the lookup object registered for this prefix. If&lt;/li&gt;
	&lt;li&gt;no prefix can be found or if the associated lookup object cannot resolve&lt;/li&gt;
	&lt;li&gt;this variable, the default lookup object will be used.&lt;br/&gt;
 *&lt;/li&gt;
	&lt;li&gt;@param event The current LogEvent or null.&lt;/li&gt;
	&lt;li&gt;@param var the name of the variable whose value is to be looked up&lt;/li&gt;
	&lt;li&gt;@return the value of this variable or &amp;lt;b&amp;gt;null&amp;lt;/b&amp;gt; if it cannot be&lt;/li&gt;
	&lt;li&gt;resolved&lt;br/&gt;
 */&lt;br/&gt;
 @Override&lt;br/&gt;
 public String lookup(final LogEvent event, String var) {&lt;br/&gt;
 if (var == null) 
{
 return null;
 }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;final int prefixPos = var.indexOf(PREFIX_SEPARATOR);&lt;br/&gt;
 if (prefixPos &amp;gt;= 0) {&lt;br/&gt;
 final String prefix = var.substring(0, prefixPos).toLowerCase(Locale.US);&lt;br/&gt;
 final String name = var.substring(prefixPos + 1);&lt;br/&gt;
 final StrLookup lookup = lookups.get(prefix);&lt;br/&gt;
 if (lookup instanceof ConfigurationAware) &lt;/p&gt;
{
 ((ConfigurationAware) lookup).setConfiguration(configuration);
 }
&lt;p&gt; String value = null;&lt;br/&gt;
 if (lookup != null) &lt;/p&gt;
{
 value = event == null ? lookup.lookup(name) : lookup.lookup(event, name);
 }

&lt;p&gt;if (value != null) &lt;/p&gt;
{
 return value;
 }
&lt;p&gt; var = var.substring(prefixPos + 1);&lt;br/&gt;
 }&lt;br/&gt;
 if (defaultLookup != null) &lt;/p&gt;
{
 return event == null ? defaultLookup.lookup(var) : defaultLookup.lookup(event, var);
 }
&lt;p&gt; return null;&lt;br/&gt;
 }&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;in the method above, only if the var=&quot;main:&#8211;file&quot;, it can find the MainMapLookup and it&apos;t map contians all of the program arguments. e.g.&#160;{0=-&lt;del&gt;file, foo.txt=&lt;/del&gt;&lt;del&gt;verbose, 1=foo.txt, 2=&lt;/del&gt;-verbose, bar=null, 3=-x, 4=bar, --file=foo.txt, --verbose=-x, -x=bar}&lt;/p&gt;

&lt;p&gt;but the code &quot;varName = varNameExpr.substring(0, i);&quot; in&#160;org.apache.logging.log4j.core.lookup.StrSubstitutor.substitute(LogEvent, StringBuilder, int, int, List&amp;lt;String&amp;gt;) reassign it &quot;main&quot;, so can&apos;t find the matched lookup but defaultLookup, but&#160;defaultLookup&apos;s map does not cotains the params &quot;&#8211;file=foo.txt,&quot;, just return the default value &quot;-file&quot;.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16338017" author="githubbot" created="Wed, 24 Jan 2018 18:17:19 +0000"  >&lt;p&gt;Github user garydgregory commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/logging-log4j2/pull/144&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/logging-log4j2/pull/144&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    In general, this is the best process IMO:&lt;/p&gt;

&lt;p&gt;    1. Write a unit test that FAILS, therefore demonstrating that there is a problem.&lt;br/&gt;
    2. Apply your bug fix&lt;br/&gt;
    3. Run the test again and it now PASSES, demonstrating that your fix works.&lt;/p&gt;</comment>
                            <comment id="16338159" author="githubbot" created="Wed, 24 Jan 2018 20:17:51 +0000"  >&lt;p&gt;Github user rgoers commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/logging-log4j2/pull/144&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/logging-log4j2/pull/144&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    4. Run all the unit tests to make sure your fix didn&apos;t break something else.&lt;/p&gt;</comment>
                            <comment id="16338854" author="githubbot" created="Thu, 25 Jan 2018 07:32:17 +0000"  >&lt;p&gt;Github user wangzhongkuo commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/logging-log4j2/pull/144&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/logging-log4j2/pull/144&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @garydgregory @rgoers &lt;/p&gt;</comment>
                            <comment id="16338859" author="githubbot" created="Thu, 25 Jan 2018 07:37:22 +0000"  >&lt;p&gt;Github user wangzhongkuo commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/logging-log4j2/pull/144&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/logging-log4j2/pull/144&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @garydgregory @rgoers &lt;br/&gt;
    I&apos;m glad you can pay attention to this problem and what&apos;s the final result? By the way, how long time difference exists between us, i&apos;m in BeiJing...&lt;/p&gt;</comment>
                            <comment id="16339450" author="githubbot" created="Thu, 25 Jan 2018 16:20:38 +0000"  >&lt;p&gt;Github user garydgregory commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/logging-log4j2/pull/144&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/logging-log4j2/pull/144&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Hello,&lt;br/&gt;
    The fastest way to get traction on this issue is to provide a unit test in this PR.&lt;br/&gt;
    Gary&lt;/p&gt;</comment>
                            <comment id="16340656" author="githubbot" created="Fri, 26 Jan 2018 07:37:25 +0000"  >&lt;p&gt;GitHub user wangzhongkuo opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/logging-log4j2/pull/145&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/logging-log4j2/pull/145&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    fix bug &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2211&quot; title=&quot;MainMapLookup ${main:--file} placeholder doesn&amp;#39;t work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2211&quot;&gt;&lt;del&gt;LOG4J2-2211&lt;/del&gt;&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;    I have written an unit test&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/wangzhongkuo/logging-log4j2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/wangzhongkuo/logging-log4j2&lt;/a&gt; master&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/logging-log4j2/pull/145.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/logging-log4j2/pull/145.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #145&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 35d2bc2ac11296e23efc7a78f362d87354b19235&lt;br/&gt;
Author: wangzhongkuo &amp;lt;wangzhongkuo@...&amp;gt;&lt;br/&gt;
Date:   2018-01-26T07:33:14Z&lt;/p&gt;

&lt;p&gt;    fix bug &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2211&quot; title=&quot;MainMapLookup ${main:--file} placeholder doesn&amp;#39;t work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2211&quot;&gt;&lt;del&gt;LOG4J2-2211&lt;/del&gt;&lt;/a&gt; (&lt;a href=&quot;https://issues.apache.org/jira/projects/LOG4J2/issues/LOG4J2-2211?filter=addedrecently&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/projects/LOG4J2/issues/LOG4J2-2211?filter=addedrecently&lt;/a&gt;)&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16340657" author="githubbot" created="Fri, 26 Jan 2018 07:42:14 +0000"  >&lt;p&gt;Github user wangzhongkuo commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/logging-log4j2/pull/144&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/logging-log4j2/pull/144&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I have committed a new PR to the repository(pull 145) and i have run the first three steps, please check it.&lt;/p&gt;</comment>
                            <comment id="16340669" author="githubbot" created="Fri, 26 Jan 2018 07:56:28 +0000"  >&lt;p&gt;Github user wangzhongkuo commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/logging-log4j2/pull/145&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/logging-log4j2/pull/145&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I&apos;m puzzled why the all checks failed...&lt;br/&gt;
    `&lt;br/&gt;
    $ ./mvnw --toolchains=./.travis-toolchains.xml install -DskipTests=true -Dmaven.javadoc.skip=true -B -V&lt;br/&gt;
    Error: JAVA_HOME is not defined correctly.&lt;br/&gt;
      We cannot execute /usr/lib/jvm/java-7-oracle/bin/java&lt;br/&gt;
    The command &quot;./mvnw --toolchains=./.travis-toolchains.xml install -DskipTests=true -Dmaven.javadoc.skip=true -B -V&quot; failed and exited with 1 during .&lt;br/&gt;
    Your build has been stopped.&lt;br/&gt;
    `&lt;br/&gt;
    zhongkuo&lt;/p&gt;</comment>
                            <comment id="16345016" author="githubbot" created="Tue, 30 Jan 2018 13:11:16 +0000"  >&lt;p&gt;Github user wangzhongkuo commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/logging-log4j2/pull/144&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/logging-log4j2/pull/144&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I&apos;m disappointed&lt;/p&gt;</comment>
                            <comment id="16345306" author="githubbot" created="Tue, 30 Jan 2018 16:17:36 +0000"  >&lt;p&gt;Github user garydgregory commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/logging-log4j2/pull/144&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/logging-log4j2/pull/144&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @wangzhongkuo: We are a volunteer-based organization, and as such, we look for as much help as we can as all of our schedules are busy, as is yours I imagine. This is why we ask for contributions and for contributors to ease the addition of new features and the inclusion of bug fixes by follow a fairly light process to minimize the impact of changes and of time in reviewing patches. &lt;/p&gt;

&lt;p&gt;    With this in mind, this PR contains no unit tests, and as such will likely not get accepted (by me at least.) Do consider:&lt;/p&gt;

&lt;p&gt;    1. Write a unit test that FAILS, therefore demonstrating that there is a problem.&lt;br/&gt;
    2. Apply your bug fix&lt;br/&gt;
    3. Run the test again and it now PASSES, demonstrating that your fix works.&lt;br/&gt;
    4. Run all the unit tests to make sure your fix didn&apos;t break something else.&lt;/p&gt;

&lt;p&gt;    Thank you,&lt;br/&gt;
    Gary&lt;/p&gt;</comment>
                            <comment id="16346381" author="githubbot" created="Wed, 31 Jan 2018 07:47:21 +0000"  >&lt;p&gt;Github user wangzhongkuo commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/logging-log4j2/pull/144&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/logging-log4j2/pull/144&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I did what you said in PR 145, but i don&apos;t known why all checks failed.&lt;/p&gt;</comment>
                            <comment id="16346912" author="githubbot" created="Wed, 31 Jan 2018 14:32:20 +0000"  >&lt;p&gt;Github user garydgregory commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/logging-log4j2/pull/145&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/logging-log4j2/pull/145&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    There is something wrong with our Travis build. You can run &apos;mvn clean install&apos; from the command line. You&apos;ll Maven 3.5.2, Java 9 and Java 7 installed.&lt;/p&gt;</comment>
                            <comment id="16347481" author="githubbot" created="Wed, 31 Jan 2018 19:40:57 +0000"  >&lt;p&gt;Github user garydgregory commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/logging-log4j2/pull/144&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/logging-log4j2/pull/144&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Failing unit tests is something you will have to resolve before we can consider accepting this patch. I, at least, do not have the time to look into this now.&lt;/p&gt;</comment>
                            <comment id="16481511" author="githubbot" created="Sat, 19 May 2018 08:35:52 +0000"  >&lt;p&gt;Github user wangzhongkuo commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/logging-log4j2/pull/144&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/logging-log4j2/pull/144&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Is there any progress? @garydgregory &lt;/p&gt;</comment>
                            <comment id="16481820" author="garydgregory" created="Sun, 20 May 2018 01:12:22 +0000"  >&lt;p&gt;No progress here on my end. In related matters, Apache Commons Text 1.3 contains new string substitution code. &lt;/p&gt;</comment>
                            <comment id="17037731" author="jira-bot" created="Sun, 16 Feb 2020 07:38:38 +0000"  >&lt;p&gt;Commit 19aa7fd40606d728471953890f86c9ae4d88ea5b in logging-log4j2&apos;s branch refs/heads/master from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=19aa7fd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=19aa7fd&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2211&quot; title=&quot;MainMapLookup ${main:--file} placeholder doesn&amp;#39;t work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2211&quot;&gt;&lt;del&gt;LOG4J2-2211&lt;/del&gt;&lt;/a&gt; - Allow Lookup keys with leading dashes by using a slash as an escape character.&lt;/p&gt;</comment>
                            <comment id="17037732" author="jira-bot" created="Sun, 16 Feb 2020 07:38:55 +0000"  >&lt;p&gt;Commit bb1793874d3fada1c55dfe265e7a9d7ed4aa4c74 in logging-log4j2&apos;s branch refs/heads/release-2.x from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=bb17938&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=bb17938&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2211&quot; title=&quot;MainMapLookup ${main:--file} placeholder doesn&amp;#39;t work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2211&quot;&gt;&lt;del&gt;LOG4J2-2211&lt;/del&gt;&lt;/a&gt; - Allow Lookup keys with leading dashes by using a slash as an escape character.&lt;/p&gt;</comment>
                            <comment id="17037735" author="ralph.goers@dslextreme.com" created="Sun, 16 Feb 2020 07:40:55 +0000"  >&lt;p&gt;This issue has been resolved by adding support for an escape character so now you would specify &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
${main:\&#8211;file} 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;or &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
${main:\--file:-app.properties}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;Please verify and close.&lt;/p&gt;</comment>
                            <comment id="17126370" author="wangzhongkuo" created="Fri, 5 Jun 2020 04:15:01 +0000"  >&lt;p&gt;thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rgoers&quot; class=&quot;user-hover&quot; rel=&quot;rgoers&quot;&gt;rgoers&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12829791">LOG4J2-1013</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 23 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3p8rz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>