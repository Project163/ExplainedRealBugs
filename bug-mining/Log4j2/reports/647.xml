<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:35:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-1172] ThreadLocal leak [AsyncLogger$Info] on Tomcat when using AsyncLoggerContextSelector</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-1172</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;Tomcat warns at SEVERE level about a ThreadLocal leak (AsyncLogger$Info).&lt;/p&gt;

&lt;p&gt;Steps to reproduce:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Make all loggers async by using the AsyncLoggerContextSelector&lt;/li&gt;
	&lt;li&gt;Place the log4j jar files in the web app&apos;s WEB-INF/lib folder, and the configuration file in the class path or in a location configured in the web.xml&lt;/li&gt;
	&lt;li&gt;Start the web app, trigger some logging, then stop the web app.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Tomcat will warn&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;SEVERE: The web application [webapp] created a ThreadLocal with key of type [org.apache.logging.log4j.core.async.AsyncLogger$Info$1] (value [org.apache.logging.log4j.core.async.AsyncLogger$Info$1@136a1c9]) and a value of type [org.apache.logging.log4j.core.async.AsyncLogger.Info] (value [org.apache.logging.log4j.core.async.AsyncLogger$Info@597fb9]) but failed to remove it when the web application was stopped. Threads are going to be renewed over time to try and avoid a probable memory leak.&lt;/p&gt;&lt;/blockquote&gt;</description>
                <environment></environment>
        <key id="12907475">LOG4J2-1172</key>
            <summary>ThreadLocal leak [AsyncLogger$Info] on Tomcat when using AsyncLoggerContextSelector</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rpopma">Remko Popma</assignee>
                                    <reporter username="rpopma">Remko Popma</reporter>
                        <labels>
                    </labels>
                <created>Fri, 23 Oct 2015 16:56:46 +0000</created>
                <updated>Wed, 11 Nov 2015 11:47:52 +0000</updated>
                            <resolved>Wed, 11 Nov 2015 11:47:52 +0000</resolved>
                                    <version>2.4</version>
                    <version>2.4.1</version>
                    <version>2.5</version>
                                    <fixVersion>2.5</fixVersion>
                                    <component>Configurators</component>
                    <component>Web/Servlet</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="15000277" author="remkop@yahoo.com" created="Wed, 11 Nov 2015 11:47:52 +0000"  >&lt;p&gt;Fixed in master in commits 680eb6eb, a02bce46, f132f9ad, 908ae829, c9eff73f.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Log4jWebInitializerImpl.start() now detects if the LoggerContext is an AsyncLoggerContext, and if so,&lt;br/&gt;
  signals the AsyncLoggerContext that it is used in a web app and should not use custom ThreadLocals.&lt;/li&gt;
	&lt;li&gt;Depending on whether the AsyncLoggerContext has been signalled to avoid ThreadLocals or not,&lt;br/&gt;
  AsyncLogger now either re-uses a per-thread RingBufferLogEventTranslator instance (cached in a ThreadLocal),&lt;br/&gt;
  or (for web apps) creates a new varargs object array for each event.&lt;/li&gt;
	&lt;li&gt;Inner class AsyncLogger.Info has been removed.&lt;/li&gt;
	&lt;li&gt;ThreadNameCachingStrategy is now a top-level class.&lt;/li&gt;
	&lt;li&gt;The cached Thread name is stored in a ThreadLocal&amp;lt;String&amp;gt; in ThreadNameCachingStrategy.&lt;/li&gt;
	&lt;li&gt;NanoClock is now a non-static field in AsyncLogger.&lt;/li&gt;
	&lt;li&gt;AsyncLogger is now responsible for updating the NanoClock when the Configuration changes.&lt;/li&gt;
	&lt;li&gt;Determining if the current thread is the background thread is now done by comparing thread IDs, without requiring a ThreadLocal.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12660290">LOG4J2-323</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12688172">LOG4J2-493</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 2 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ng4n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>