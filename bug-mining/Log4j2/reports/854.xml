<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:36:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-904] RollingFile appender doesn&apos;t zip and create new files</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-904</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;Using TimeBasedTriggeringPolicy, with a filePattern of &lt;tt&gt;f:/Log4J/$${date:yyyy-MM}/IIB-%d{MM-dd-yyyy}-%i.log.zip&lt;/tt&gt; and a fileName of f:/Log4J/IIB.log:&lt;/p&gt;

&lt;p&gt;on date change, directory is created but filename is not zipped. Also old file is not cleared out, but just appended to.&lt;br/&gt;
Log4j2.xml:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;Configuration status = &lt;span class=&quot;code-quote&quot;&gt;&quot;warn&quot;&lt;/span&gt; name = &lt;span class=&quot;code-quote&quot;&gt;&quot;Log4j2_Configuration&quot;&lt;/span&gt; monitorInterval = &lt;span class=&quot;code-quote&quot;&gt;&quot;60&quot;&lt;/span&gt; packages = &quot;&quot;&amp;gt;
    &amp;lt;Appenders&amp;gt;
        &amp;lt;RollingFile name = &lt;span class=&quot;code-quote&quot;&gt;&quot;RollingFile&quot;&lt;/span&gt; fileName = &lt;span class=&quot;code-quote&quot;&gt;&quot;f:/Log4J/IIB.log&quot;&lt;/span&gt; filePattern = &lt;span class=&quot;code-quote&quot;&gt;&quot;f:/Log4J/$${date:yyyy-MM}/IIB-%d{MM-dd-yyyy}-%i.log.zip&quot;&lt;/span&gt; &amp;gt;
            &amp;lt;PatternLayout&amp;gt;
                &amp;lt;Pattern&amp;gt;%d %p %c{1} %m%n%n&amp;lt;/Pattern&amp;gt;
            &amp;lt;/PatternLayout&amp;gt;
            &amp;lt;Policies&amp;gt;
                &amp;lt;TimeBasedTriggeringPolicy interval = &lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; modulate = &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;/&amp;gt;
            &amp;lt;/Policies&amp;gt;
            &amp;lt;DefaultRolloverStrategy fileIndex = &lt;span class=&quot;code-quote&quot;&gt;&quot;min&quot;&lt;/span&gt; max = &lt;span class=&quot;code-quote&quot;&gt;&quot;7&quot;&lt;/span&gt; compressionLevel = &lt;span class=&quot;code-quote&quot;&gt;&quot;5&quot;&lt;/span&gt;/&amp;gt;
        &amp;lt;/RollingFile&amp;gt;
    &amp;lt;/Appenders&amp;gt;
    &amp;lt;Loggers&amp;gt;
        &amp;lt;Root level = &lt;span class=&quot;code-quote&quot;&gt;&quot;trace&quot;&lt;/span&gt;&amp;gt;
            &amp;lt;AppenderRef ref = &lt;span class=&quot;code-quote&quot;&gt;&quot;RollingFile&quot;&lt;/span&gt; level = &lt;span class=&quot;code-quote&quot;&gt;&quot;warn&quot;&lt;/span&gt;/&amp;gt;
        &amp;lt;/Root&amp;gt;
    &amp;lt;/Loggers&amp;gt;
&amp;lt;/Configuration&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;Windows 7&lt;/p&gt;</environment>
        <key id="12757172">LOG4J2-904</key>
            <summary>RollingFile appender doesn&apos;t zip and create new files</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="SAW">Stephen A. Weinfield</reporter>
                        <labels>
                    </labels>
                <created>Sat, 22 Nov 2014 17:27:36 +0000</created>
                <updated>Mon, 15 Oct 2018 09:02:45 +0000</updated>
                            <resolved>Mon, 4 Jul 2016 19:38:55 +0000</resolved>
                                    <version>2.1</version>
                                    <fixVersion>2.6.2</fixVersion>
                                    <component>Appenders</component>
                        <due></due>
                            <votes>3</votes>
                                    <watches>10</watches>
                                                                                                                <comments>
                            <comment id="14229564" author="oers" created="Mon, 1 Dec 2014 09:09:42 +0000"  >&lt;p&gt;I see a similar pattern with my log files.&lt;br/&gt;
Sometimes the zipping works and sometimes nothing will be zipped and the logs will be appended to the old file.&lt;br/&gt;
I found no error/clue in the logfile, for why this was happening.&lt;/p&gt;</comment>
                            <comment id="14232097" author="nickhardy" created="Tue, 2 Dec 2014 20:43:39 +0000"  >&lt;p&gt;I just ran into this bug as well, but not until i added fileIndex = &quot;min&quot; to the DefaultRolloverStrategy.&lt;br/&gt;
Setting the fileIndex to max does work as expected.&lt;/p&gt;</comment>
                            <comment id="14233039" author="oers" created="Wed, 3 Dec 2014 14:36:00 +0000"  >&lt;p&gt;My settings are just&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;		&amp;lt;RollingFile name=&lt;span class=&quot;code-quote&quot;&gt;&quot;fileAppender&quot;&lt;/span&gt; fileName=&lt;span class=&quot;code-quote&quot;&gt;&quot;${sys:catalina.base}/bms-${log.name}.log&quot;&lt;/span&gt;
			filePattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;${sys:catalina.base}}/archive/bms-${log.name}-%d{yyyy-dd-MM-HH}-%i.log.zip&quot;&lt;/span&gt;&amp;gt;
			&amp;lt;ThresholdFilter level=&lt;span class=&quot;code-quote&quot;&gt;&quot;DEBUG&quot;&lt;/span&gt; onMatch=&lt;span class=&quot;code-quote&quot;&gt;&quot;ACCEPT&quot;&lt;/span&gt;
				onMismatch=&lt;span class=&quot;code-quote&quot;&gt;&quot;DENY&quot;&lt;/span&gt; /&amp;gt;
			&amp;lt;PatternLayout pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;%d{dd.MM.yyyy HH:mm:ss,SSS} %-5p [%c] [%t] %m%n&quot;&lt;/span&gt; /&amp;gt;
			&amp;lt;Policies&amp;gt;
				&amp;lt;TimeBasedTriggeringPolicy interval=&lt;span class=&quot;code-quote&quot;&gt;&quot;6&quot;&lt;/span&gt;
					modulate=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; /&amp;gt;
				&amp;lt;SizeBasedTriggeringPolicy size=&lt;span class=&quot;code-quote&quot;&gt;&quot;250 MB&quot;&lt;/span&gt; /&amp;gt;
				&amp;lt;OnStartupTriggeringPolicy /&amp;gt;
			&amp;lt;/Policies&amp;gt;
			&amp;lt;DefaultRolloverStrategy max=&lt;span class=&quot;code-quote&quot;&gt;&quot;100&quot;&lt;/span&gt;/&amp;gt;
		&amp;lt;/RollingFile&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I did not specify a fileindex.&lt;/p&gt;</comment>
                            <comment id="14233074" author="saw" created="Wed, 3 Dec 2014 14:59:31 +0000"  >&lt;p&gt;Thank you. I will give it a try.&lt;/p&gt;</comment>
                            <comment id="14233141" author="nickhardy" created="Wed, 3 Dec 2014 16:03:08 +0000"  >&lt;p&gt;Here are my settings:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;		&amp;lt;RollingRandomAccessFile name=&lt;span class=&quot;code-quote&quot;&gt;&quot;mainlog&quot;&lt;/span&gt;
			fileName=&lt;span class=&quot;code-quote&quot;&gt;&quot;../logs/kcs.log&quot;&lt;/span&gt;
			filePattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;../logs/kcs/$${date:yyyy-MM}/kcs-%d{yyyy-MM-dd}-%i.log.zip&quot;&lt;/span&gt;&amp;gt;
			&amp;lt;PatternLayout&amp;gt;
				&amp;lt;Pattern&amp;gt;%d{MMM d, yyyy HH:mm:ss}: %5p (%F:%L) - %m%n&amp;lt;/Pattern&amp;gt;
			&amp;lt;/PatternLayout&amp;gt;
			&amp;lt;Policies&amp;gt;
				&amp;lt;TimeBasedTriggeringPolicy /&amp;gt;
				&amp;lt;SizeBasedTriggeringPolicy size=&lt;span class=&quot;code-quote&quot;&gt;&quot;3 MB&quot;&lt;/span&gt; /&amp;gt;
			&amp;lt;/Policies&amp;gt;
			&amp;lt;DefaultRolloverStrategy fileIndex=&lt;span class=&quot;code-quote&quot;&gt;&quot;max&quot;&lt;/span&gt; max=&lt;span class=&quot;code-quote&quot;&gt;&quot;100&quot;&lt;/span&gt; /&amp;gt;
		&amp;lt;/RollingRandomAccessFile&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This works as expected.&lt;/p&gt;</comment>
                            <comment id="14233434" author="nickhardy" created="Wed, 3 Dec 2014 19:53:40 +0000"  >&lt;p&gt;I did some more testing. It actually works with min and max settings.&lt;br/&gt;
But if you change the log4j2.xml while tomcat is running it will reload and start acting strange. (ie not zipping, not flushing before archiving and stuff like that)&lt;br/&gt;
If you stop tomcat, then modify the settings, redeploy and start tomcat again, it all works fine.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=oers&quot; class=&quot;user-hover&quot; rel=&quot;oers&quot;&gt;oers&lt;/a&gt;&lt;br/&gt;
You have a double brace in there you should take out. ${sys:catalina.base}}&lt;/p&gt;</comment>
                            <comment id="14233988" author="oers" created="Thu, 4 Dec 2014 07:48:06 +0000"  >&lt;p&gt;I just checked our environments (Tomcats 7.0.54)  and your observation seems to be correct.&lt;br/&gt;
On our Development and Test-Servers, which are constantly deployed by Jenkins, compressing/zip does not work consistently.&lt;br/&gt;
On our productive Servers, which are always redeployed cleanly (shutdown, deploy, start), everything works fine.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nickhardy&quot; class=&quot;user-hover&quot; rel=&quot;nickhardy&quot;&gt;nickhardy&lt;/a&gt; thanks for the hint. It was just a copy&amp;amp;paste error for this issue.&lt;/p&gt;</comment>
                            <comment id="14235783" author="saw" created="Fri, 5 Dec 2014 17:46:11 +0000"  >&lt;p&gt;This is not working on Windows!! Settings were changed with the server down. My settings are basically the same as per the doc:&lt;br/&gt;
&lt;tt&gt;fileName = &quot;f:/Log4J/IIB.log&quot; filePattern = &quot;f:/Log4J/$${date:yyyy-MM}/IIB-%d{MM-dd-yyyy}-%i.log.zip&quot;&lt;/tt&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;TimeBasedTriggeringPolicy interval = &lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; modulate = &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;/&amp;gt;

            &amp;lt;!--            &amp;lt;DefaultRolloverStrategy fileIndex = &lt;span class=&quot;code-quote&quot;&gt;&quot;max&quot;&lt;/span&gt; max = &lt;span class=&quot;code-quote&quot;&gt;&quot;7&quot;&lt;/span&gt; compressionLevel = &lt;span class=&quot;code-quote&quot;&gt;&quot;5&quot;&lt;/span&gt;/&amp;gt;  --&amp;gt;
            &amp;lt;DefaultRolloverStrategy max = &lt;span class=&quot;code-quote&quot;&gt;&quot;7&quot;&lt;/span&gt;/&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;1. Files are not zipped&lt;br/&gt;
2. A new file is not created each day; the old file is just appended to.&lt;/p&gt;

&lt;p&gt;Is there some way to escalate this issue?&lt;/p&gt;</comment>
                            <comment id="14236183" author="garydgregory" created="Fri, 5 Dec 2014 21:57:34 +0000"  >&lt;p&gt;The best way to speed things up is to provide a patch for a unit test and perhaps another for a fix.&lt;/p&gt;</comment>
                            <comment id="14236189" author="saw" created="Fri, 5 Dec 2014 22:03:12 +0000"  >&lt;p&gt;So how do I request a patch?&lt;/p&gt;</comment>
                            <comment id="14236211" author="garydgregory" created="Fri, 5 Dec 2014 22:20:06 +0000"  >&lt;p&gt;uh, I think you misread my comment, I said &quot;provide&quot; not &quot;request&quot;. &lt;/p&gt;

&lt;p&gt;Our guidelines are here: &lt;a href=&quot;https://logging.apache.org/log4j/2.x/guidelines.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://logging.apache.org/log4j/2.x/guidelines.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The page talks about &lt;tt&gt;svn diff&lt;/tt&gt; but that is wrong since we&apos;ve switched to Git, you&apos;d use &lt;tt&gt;git diff&lt;/tt&gt; instead.&lt;/p&gt;</comment>
                            <comment id="14237594" author="nickhardy" created="Mon, 8 Dec 2014 08:10:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=SAW&quot; class=&quot;user-hover&quot; rel=&quot;SAW&quot;&gt;SAW&lt;/a&gt;&lt;br/&gt;
All my tests have been on windows using Tomcat 7.0.42. They work for me.&lt;/p&gt;</comment>
                            <comment id="14968776" author="log4j2@maik.xyz" created="Thu, 22 Oct 2015 08:20:23 +0000"  >&lt;p&gt;Hi, i have the same issue here on my Windows 7/8 and on my OpenSuse 13 system with the same settings, which are as follows:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&amp;lt;RollingFile name=&lt;span class=&quot;code-quote&quot;&gt;&quot;rollingFile&quot;&lt;/span&gt; fileName=&lt;span class=&quot;code-quote&quot;&gt;&quot;${sys:catalina.home}/logs/app.log&quot;&lt;/span&gt;
                     filePattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;${sys:catalina.home}/logs/$${date:yyyy-MM}/app-%d{yyyy-MM-dd}.log.zip&quot;&lt;/span&gt;&amp;gt;
            &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;PatternLayout pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;%d %-5p [%-30.30c{1.}] (%-30F:%-4L) - %m%n&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Policies&amp;gt;&lt;/span&gt;
                &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;TimeBasedTriggeringPolicy interval=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; modulate=&lt;span class=&quot;code-quote&quot;&gt;&quot;true&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Policies&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;DefaultRolloverStrategy compressionLevel=&lt;span class=&quot;code-quote&quot;&gt;&quot;9&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/RollingFile&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The result is that the file, which got rolled over has the *.zip ending but when I open it, it is a normal text file. So no compression is happening at all. Same with other endings like *.gz, *.xz and so on.&lt;/p&gt;</comment>
                            <comment id="14969018" author="remkop@yahoo.com" created="Thu, 22 Oct 2015 12:10:21 +0000"  >&lt;p&gt;Is this with Log4j-2.4.1? A similar issue was fixed in &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1135&quot; title=&quot;Rollover renames to .zip file without compressing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1135&quot;&gt;&lt;del&gt;LOG4J2-1135&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;</comment>
                            <comment id="14969094" author="log4j2@maik.xyz" created="Thu, 22 Oct 2015 12:29:18 +0000"  >&lt;p&gt;Hi Remko,&lt;/p&gt;

&lt;p&gt;thanks for the hint. I upgraded to 2.4.1 and at least my issue is gone. &lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Maik.&lt;/p&gt;</comment>
                            <comment id="14980556" author="saw" created="Thu, 29 Oct 2015 14:50:57 +0000"  >&lt;p&gt;Thanks for the comment. I upgraded to v. 2.4.1. There is some improvement, but still some strangeness going on.&lt;br/&gt;
The RollingFile appender now does a daily roll, and zips the previous file to a directory named correctly according to the date mask. However the zipped files within the directory are post dated 2 days in advance. For example, today (Oct. 29, 2015) I ran a test. The prior log was placed in a directory named &quot;2015-10&quot;, and zipped with a name of &quot;filename-10-31-2015-1.log.zip&quot;. The same thing happened yesterday, as a zip file was created with a name of &quot;filename-10-30-2015-1.log.zip&quot;. &lt;/p&gt;</comment>
                            <comment id="14980583" author="remkop@yahoo.com" created="Thu, 29 Oct 2015 15:05:27 +0000"  >&lt;p&gt;Can you post your configuration file?&lt;/p&gt;</comment>
                            <comment id="14980647" author="saw" created="Thu, 29 Oct 2015 15:36:03 +0000"  >&lt;p&gt;Current configuration file:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.0&quot;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;?&amp;gt;
&amp;lt;Configuration status = &lt;span class=&quot;code-quote&quot;&gt;&quot;warn&quot;&lt;/span&gt; name = &lt;span class=&quot;code-quote&quot;&gt;&quot;MyApp&quot;&lt;/span&gt; packages = &quot;&quot;&amp;gt;
    &amp;lt;Appenders&amp;gt;
        &amp;lt;RollingRandomAccessFile name = &lt;span class=&quot;code-quote&quot;&gt;&quot;RollingRandomAccessFile&quot;&lt;/span&gt; fileName = &lt;span class=&quot;code-quote&quot;&gt;&quot;f:/Log4J/logs/RollingIIB.log&quot;&lt;/span&gt; filePattern = &lt;span class=&quot;code-quote&quot;&gt;&quot;f:/Log4J/logs/$${date:yyyy-MM}/RollingIIB-%d{MM-dd-yyyy}-%i.log.zip&quot;&lt;/span&gt;&amp;gt;
            &amp;lt;PatternLayout&amp;gt;
                &amp;lt;Pattern&amp;gt;%d %p %c{1.} [%t] %m%n&amp;lt;/Pattern&amp;gt;
            &amp;lt;/PatternLayout&amp;gt;
            &amp;lt;Policies&amp;gt;
                &amp;lt;OnStartupTriggeringPolicy/&amp;gt;
                &amp;lt;TimeBasedTriggeringPolicy interval = &lt;span class=&quot;code-quote&quot;&gt;&quot;4&quot;&lt;/span&gt;/&amp;gt;
                &amp;lt;SizeBasedTriggeringPolicy size = &lt;span class=&quot;code-quote&quot;&gt;&quot;250 MB&quot;&lt;/span&gt;/&amp;gt;
            &amp;lt;/Policies&amp;gt;
        &amp;lt;/RollingRandomAccessFile&amp;gt;
    &amp;lt;/Appenders&amp;gt;
    &amp;lt;Loggers&amp;gt;
        &amp;lt;Root level = &lt;span class=&quot;code-quote&quot;&gt;&quot;error&quot;&lt;/span&gt;&amp;gt;
            &amp;lt;AppenderRef ref = &lt;span class=&quot;code-quote&quot;&gt;&quot;RollingRandomAccessFile&quot;&lt;/span&gt;/&amp;gt;
        &amp;lt;/Root&amp;gt;
    &amp;lt;/Loggers&amp;gt;
&amp;lt;/Configuration&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14980649" author="saw" created="Thu, 29 Oct 2015 15:37:05 +0000"  >&lt;p&gt;&lt;tt&gt;filePattern = &quot;f:/Log4J/logs/$${date:yyyy-MM}/RollingIIB-%d{MM-dd-yyyy}-%i.log.zip&quot;&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="15263042" author="ralph.goers@dslextreme.com" created="Thu, 28 Apr 2016 21:23:42 +0000"  >&lt;p&gt;It would be good to know if these same problems occur with the CronTriggeringPolicy instead of the TimeBasedTriggeringPolicy. &lt;/p&gt;</comment>
                            <comment id="15299702" author="bmaehr" created="Wed, 25 May 2016 08:57:49 +0000"  >&lt;p&gt;Still no fix for this issue?!?&lt;/p&gt;

&lt;p&gt;I have the same problem with 2.5 on Windows: On midnight the log file according to filePattern is created but the log without time pattern is not cleared and contains all the old entries. &lt;br/&gt;
The main reason for RollingFileAppender is not working!&lt;/p&gt;</comment>
                            <comment id="15299979" author="saw" created="Wed, 25 May 2016 12:39:21 +0000"  >&lt;p&gt;I haven&apos;t looked at this in awhile. When I upgraded to v.2.4.1 it seemed to be working. The file mask I was using was:&lt;br/&gt;
&amp;lt;RollingRandomAccessFile name = &quot;RollingRandomAccessFile&quot; fileName = &quot;f:/Log4J/logs/RollingIIB.log&quot; filePattern = &quot;f:/Log4J/logs/$${date:yyyy-MM}/RollingIIB-%d&lt;/p&gt;
{MM-dd-yyyy}
&lt;p&gt;-%i.log.zip&quot;&amp;gt;&lt;/p&gt;</comment>
                            <comment id="15300215" author="garydgregory" created="Wed, 25 May 2016 15:25:28 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Still no fix for this issue?!?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;You are dealing with a volunteer based project here. Please don&apos;t loose sight of that. &lt;/p&gt;

&lt;p&gt;If you want things to go faster, you can always provide a patch with unit tests.&lt;/p&gt;</comment>
                            <comment id="15301469" author="ralph.goers@dslextreme.com" created="Thu, 26 May 2016 03:37:28 +0000"  >&lt;p&gt;Also, the &quot;fix&quot; for this issue is to change the File.renameTo() calls to Files.move() and File.delete() calls to Files.delete(path) so that failure of the delete will be detected and we can log the error. The most likely cause of this problem is that the file is in use. On Windows this causes both the attempt to rename to fail and following that the attempt to delete the file after it is copied to fail. Files.move() might work better on Windows than File.renameTo() but there is no guarantee.&lt;/p&gt;</comment>
                            <comment id="15301908" author="bmaehr" created="Thu, 26 May 2016 10:17:06 +0000"  >&lt;p&gt;I know this and tried to reproduce it yesterday for some hours.&lt;/p&gt;

&lt;p&gt;BUT RollingFile appender is IMHO the main use case for logging with log4j and Web-Application is IMHO the main use case for logging with java. Windows is not the main target platform but on this platform it is a MAJOR problem.&lt;/p&gt;

&lt;p&gt;And the &apos;best&apos; thing: I just changed from 1.2 to 2.5 because this bug should be fixed there (&lt;a href=&quot;http://do.whileloop.org/2014/02/14/log4j-rolling-file-appenders-in-windows/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://do.whileloop.org/2014/02/14/log4j-rolling-file-appenders-in-windows/&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="15303770" author="bmaehr" created="Fri, 27 May 2016 08:49:57 +0000"  >&lt;p&gt;Here the capturing of the Logging during rollover:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2016-05-27 00:00:00,311 scheduler_Worker-5 TRACE PatternProcessor.getNextTime returning 2016/05/28-00:00:00.000, nextFileTime=2016/05/27-00:00:00.000, prevFileTime=2016/05/26-00:00:00.000, current=2016/05/27-00:00:00.310, freq=DAILY
2016-05-27 00:00:00,318 scheduler_Worker-5 TRACE DefaultRolloverStrategy.purge() took 0.0 milliseconds
2016-05-27 00:00:00,318 scheduler_Worker-5 DEBUG RollingFileManager executing synchronous FileRenameAction[C:\Oracle\Middleware\user_projects\domains\entw_domain\servers\entw_server\logs\app.log to C:\Oracle\Middleware\user_projects\domains\entw_domain\servers\entw_server\logs\app-2016-05-26-4.log, renameEmptyFiles=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Looking at the code of FileRenameAction I would assume one of these possibilities:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;the source.renameTo(destination) is successful and for some reason the old content of the file is written to the new file&lt;/li&gt;
	&lt;li&gt;the source.renameTo(destination) fails, the copyFile(source, destination) is successful but the source.delete() fails silently&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The logging doesn&apos;t show which possibility is executed.&lt;/p&gt;</comment>
                            <comment id="15361376" author="bmaehr" created="Mon, 4 Jul 2016 14:18:15 +0000"  >&lt;p&gt;I have now a working FileRenameAction which does a truncate even if the log-file is locked some way and logs what it is doing and why it is failing. This implementation solved the problem on my Windows machine even if deleting the log-File was noch possible. &lt;/p&gt;

&lt;p&gt;Please check and add to the source code.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; execute(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; File source, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; File destination, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; renameEmptyFiles) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (renameEmptyFiles || (source.length() &amp;gt; 0)) {
            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; File parent = destination.getParentFile();
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ((parent != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &amp;amp;&amp;amp; !parent.exists()) {
                &lt;span class=&quot;code-comment&quot;&gt;// LOG4J2-679: ignore mkdirs() result: in multithreaded scenarios,
&lt;/span&gt;                &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; one thread succeeds the other thread returns &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
&lt;/span&gt;                &lt;span class=&quot;code-comment&quot;&gt;// even though directories have been created. Check &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; dir exists instead.
&lt;/span&gt;                parent.mkdirs();
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!parent.exists()) {
                    AbstractAction.LOGGER.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Unable to create directory {}&quot;&lt;/span&gt;, parent.getAbsolutePath());
                    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
                }
            }
            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                    Files.move(Paths.get(source.getAbsolutePath()), Paths.get(destination.getAbsolutePath()), StandardCopyOption.ATOMIC_MOVE,
                            StandardCopyOption.REPLACE_EXISTING);
                    AbstractAction.LOGGER.trace(&lt;span class=&quot;code-quote&quot;&gt;&quot;Renamed file {} to {} with Files.move&quot;&lt;/span&gt;, source.getAbsolutePath(), destination.getAbsolutePath());
                    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
                } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; IOException exMove) {
                    AbstractAction.LOGGER.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Unable to move file {} to {}: {} {}&quot;&lt;/span&gt;, source.getAbsolutePath(), destination.getAbsolutePath(),
                            exMove.getClass().getName(), exMove.getMessage());
                    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; result = source.renameTo(destination);
                    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!result) {
                        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                            Files.copy(Paths.get(source.getAbsolutePath()), Paths.get(destination.getAbsolutePath()), StandardCopyOption.REPLACE_EXISTING);
                            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                                Files.delete(Paths.get(source.getAbsolutePath()));
                                AbstractAction.LOGGER.trace(&lt;span class=&quot;code-quote&quot;&gt;&quot;Renamed file {} to {} with Files.copy and Files.delete&quot;&lt;/span&gt;, source.getAbsolutePath(),
                                        destination.getAbsolutePath());
                            } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; IOException exDelete) {
                                AbstractAction.LOGGER.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Unable to delete file {}: {} {}&quot;&lt;/span&gt;, source.getAbsolutePath(), exDelete.getClass().getName(),
                                        exDelete.getMessage());
                                &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                                    &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PrintWriter(source.getAbsolutePath()).close();
                                    AbstractAction.LOGGER.trace(&lt;span class=&quot;code-quote&quot;&gt;&quot;Renamed file {} to {} with Files.copy and overwrite old file&quot;&lt;/span&gt;, source.getAbsolutePath(),
                                            destination.getAbsolutePath());
                                } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; IOException exOwerwrite) {
                                    AbstractAction.LOGGER.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Unable to overwrite file {}: {} {}&quot;&lt;/span&gt;, source.getAbsolutePath(), exOwerwrite.getClass().getName(),
                                            exOwerwrite.getMessage());
                                }
                            }
                        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; IOException exCopy) {
                            AbstractAction.LOGGER.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Unable to copy file {} to {}: {} {}&quot;&lt;/span&gt;, source.getAbsolutePath(), destination.getAbsolutePath(),
                                    exCopy.getClass().getName(), exCopy.getMessage());
                        }
                    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
                        AbstractAction.LOGGER.trace(&lt;span class=&quot;code-quote&quot;&gt;&quot;Renamed file {} to {} with source.renameTo&quot;&lt;/span&gt;, source.getAbsolutePath(), destination.getAbsolutePath());
                    }
                    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; result;
                }
            } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; RuntimeException ex) {
                AbstractAction.LOGGER.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Unable to rename file {} to {}: {} {}&quot;&lt;/span&gt;, source.getAbsolutePath(), destination.getAbsolutePath(),
                        ex.getClass().getName(), ex.getMessage());
            }
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                source.delete();
            } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Exception exDelete) {
                AbstractAction.LOGGER.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Unable to delete empty file {}: {} {}&quot;&lt;/span&gt;, source.getAbsolutePath(), exDelete.getClass().getName(),
                        exDelete.getMessage());
            }
        }

        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
    }

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; </comment>
                            <comment id="15361739" author="ralph.goers@dslextreme.com" created="Mon, 4 Jul 2016 19:38:55 +0000"  >&lt;p&gt;Patch applied. Please verify and close.&lt;/p&gt;</comment>
                            <comment id="15361816" author="remkop@yahoo.com" created="Mon, 4 Jul 2016 22:51:42 +0000"  >&lt;p&gt;How will this behave in the case there are two independent processes logging to the same file? We regularly see questions on Stackoverflow from people trying to do this. Usually because the rollover gives strange results. Interested to know how the behavior will be with the new code. &lt;/p&gt;</comment>
                            <comment id="15361842" author="ralph.goers@dslextreme.com" created="Mon, 4 Jul 2016 23:51:06 +0000"  >&lt;p&gt;No different than it does now. RollingFileAppender doesn&apos;t support multiple processes writing to the same file. The main problem is that both processes will think it is time to roll the file over and make a horrible mess of things.&lt;/p&gt;</comment>
                            <comment id="15361860" author="bmaehr" created="Tue, 5 Jul 2016 00:41:08 +0000"  >&lt;p&gt;In fact I don&apos;t know and haven&apos;t tried it.&lt;br/&gt;
But my changes shouldn&apos;t make it worse cause my changes try to rename the file in two different ways (it was tried before in one of the ways) and then the file is copied and the old file deleted like before. Only if the deletion fails (what happend in my case often) it tries to delete the content of the file without deleting the file. And this seams to work so instead of getting a copy of the file and appending the content further to the original file the content of the original file is really truncated on my system.    &lt;/p&gt;</comment>
                            <comment id="15361897" author="remkop@yahoo.com" created="Tue, 5 Jul 2016 02:03:39 +0000"  >&lt;p&gt;What about race conditions where process A is still writing to the file when process B decides to roll it.&lt;br/&gt;
Previously, B could copy the file and zip the copy but would not be able to delete the original file. Then, when process A rolls over, the same thing happens. &lt;br/&gt;
Drawback: original file keeps growing. Benefit: events are never dropped.&lt;/p&gt;

&lt;p&gt;With the new code, the drawback of the growing file is gone, but could process B not truncate an event that was just added by A?&lt;/p&gt;</comment>
                            <comment id="15362034" author="ralph.goers@dslextreme.com" created="Tue, 5 Jul 2016 05:34:05 +0000"  >&lt;p&gt;I don&apos;t understand why you keep asking about use cases involving multiple processes.  The RollingFileAppender does not support that. I specifically did not add the option for file locking to the Appender, which is the only safe way for multiple processes to write to a file, because it is full of problems. Note that the documentation for the RollingFileAppender clearly says file locking is not supported.&lt;/p&gt;

&lt;p&gt;What you are forgetting is that without file locking writes from process A and process B can overlap and you will end up with garbage in the file. In addition, users are going to wonder why they have multiple copies of the files when they thought they should only have one.&lt;/p&gt;

&lt;p&gt;So unless you really want to redesign the RollingFileAppender to use a lock file or some other such mechanism to allow multiple processes to roll over the file safely, I am perfectly fine with the solution Bernhard provided.  &lt;/p&gt;

&lt;p&gt;I should add that I will be implementing another enhancement to have the RollingFileAppender only write to the &quot;rolled over&quot; file (the one specified via filePattern), so file renames won&apos;t be required. This mechanism is far more likely to be able to support multiple processes writing to the file but it will still require some trickery to make it work correctly.&lt;/p&gt;</comment>
                            <comment id="15362089" author="remkop@yahoo.com" created="Tue, 5 Jul 2016 06:40:15 +0000"  >&lt;p&gt;Okay. &lt;/p&gt;

&lt;p&gt;I think I caused a misunderstanding, sorry. I had not seen Bernhard&apos;s last comment when I posted my comment. This made it look like I am opposing Bernhard&apos;s solution which is not the case.&lt;/p&gt;

&lt;p&gt;I understand RollingFileAppender does not support multiple processes writing to the same file and I agree that we don&apos;t have a good solution for supporting such scenarios. &lt;/p&gt;

&lt;p&gt;The reason I asked is that we have seen several people on StackOverflow use RollingFileAppender the wrong way and getting into trouble, and I was just trying to understand what will happen with the new solution (to foresee what kind of questions to expect next). I may experiment a bit to satisfy my curiosity. I am not opposing this change.&lt;/p&gt;</comment>
                            <comment id="16649927" author="venkatsai" created="Mon, 15 Oct 2018 09:02:45 +0000"  >&lt;p&gt;Is this Issue in IIB(IBM INTEGRATION BUS)&#160;toolkit?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 5 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i22onz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>