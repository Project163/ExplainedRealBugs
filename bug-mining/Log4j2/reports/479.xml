<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:33:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-1002] PatternLayout is missing a new line for Exceptions with the short option</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-1002</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;I am struggeling to get the PatternLayout right when using %throwable, %ex or similar.&lt;br/&gt;
The first problem is, that if the exception is limited by the number of lines (e.g. with the option &lt;tt&gt;short&lt;/tt&gt; or providing a number), the converter &lt;tt&gt;ExtendedThrowablePatternConverter&lt;/tt&gt; doesn&apos;t attach a newline to the end of the stack.&lt;br/&gt;
On the other hand it does attach a newline at the end of the full stack.&lt;/p&gt;

&lt;p&gt;That is why&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;tt&gt;&amp;lt;PatternLayout pattern=&quot;%msg%n%ex&quot; /&amp;gt;&lt;/tt&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;produces the expected result for message with and without throwables: there are no empty lines in the log file and every log message starts in a new line. &lt;/p&gt;

&lt;p&gt;What about &lt;tt&gt;%ex{short&lt;/tt&gt;}?&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;tt&gt;&amp;lt;PatternLayout pattern=&quot;%msg%n%ex{short}&quot; /&amp;gt;&lt;/tt&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This has the problem that messages with throwables do not end with a new line. This produces all kinds of problems.&lt;/p&gt;

&lt;p&gt;Ok, let&apos;s add a newline&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;tt&gt;&amp;lt;PatternLayout alwaysWriteExceptions=&quot;false&quot; pattern=&quot;%msg%n%ex{short}%n&quot; /&amp;gt;&lt;/tt&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This has the problem that messages &lt;em&gt;without&lt;/em&gt; throwables are followed by an empty line. This is not acceptable on the console.&lt;/p&gt;

&lt;p&gt;So we need something more complicated:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;tt&gt;&amp;lt;PatternLayout alwaysWriteExceptions=&quot;false&quot; pattern=&quot;%msg%replace{%n%ex{short}%n}{[\r\n]+$}{}%n&quot; /&amp;gt;&lt;/tt&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yeah! It works (at least on Windows, Unix, Linux, Mac) and if the undocumented throwable &lt;tt&gt;separator&lt;/tt&gt; option is not used. But it&apos;s ugly and requires the alwaysWriteExceptions because the throwable pattern detection does not work any more.&lt;/p&gt;

&lt;p&gt;Short Term solution: Always add a newline to the exception.&lt;/p&gt;

&lt;p&gt;Long Term Solution:&lt;/p&gt;

&lt;p&gt;Add a conversion pattern &lt;tt&gt;%onThrowable{pattern1}[{pattern2}]&lt;/tt&gt; where pattern1 is appended when there is a throwable attached to the log message and the optional pattern2 is appended when there is no throwable appended.&lt;br/&gt;
The &lt;tt&gt;alwaysWriteExceptions=&quot;false&quot;&lt;/tt&gt; parameter could be replaced by &lt;tt&gt;pattern=&quot;%onThrowable{}&quot;&lt;/tt&gt; &lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows, eclipse&lt;/p&gt;</environment>
        <key id="12826009">LOG4J2-1002</key>
            <summary>PatternLayout is missing a new line for Exceptions with the short option</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="robert.schaft">Robert Schaft</reporter>
                        <labels>
                    </labels>
                <created>Wed, 29 Apr 2015 16:56:10 +0000</created>
                <updated>Fri, 29 May 2020 10:40:25 +0000</updated>
                                            <version>2.2</version>
                                                    <component>Layouts</component>
                    <component>Pattern Converters</component>
                        <due></due>
                            <votes>4</votes>
                                    <watches>9</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="1209600">336h</timeoriginalestimate>
                            <timeestimate seconds="1208400">335h 40m</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="14522889" author="garydgregory" created="Fri, 1 May 2015 07:33:32 +0000"  >&lt;p&gt;Why isn&apos;t the solution to make sure we have an EOL after all stack traces, long or short?&lt;/p&gt;</comment>
                            <comment id="14522906" author="garydgregory" created="Fri, 1 May 2015 07:58:31 +0000"  >&lt;p&gt;I can reproduce this FWIW...&lt;/p&gt;</comment>
                            <comment id="14523377" author="garydgregory" created="Fri, 1 May 2015 16:10:43 +0000"  >&lt;p&gt;This is a partial fix:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;diff --git a/log4j-core/src/main/java/org/apache/logging/log4j/core/pattern/ThrowablePatternConverter.java b/log4j-core/src/main/java/org/apache/logging/log4j/core/pattern/ThrowablePatternConverter.java
index a651ae6..d198a02 100644
--- a/log4j-core/src/main/java/org/apache/logging/log4j/core/pattern/ThrowablePatternConverter.java
+++ b/log4j-core/src/main/java/org/apache/logging/log4j/core/pattern/ThrowablePatternConverter.java
@@ -147,7 +147,7 @@
             final int limit = options.minLines(array.length) - 1;
             for (int i = 0; i &amp;lt;= limit; ++i) {
                 sb.append(array[i]);
-                if (i &amp;lt; limit) {
+                if (i &amp;lt;= limit) {
                     sb.append(options.getSeparator());
                 }
             }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But this causes the tag lib tests to fail:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Failed tests:
  CatchingTagTest.testDoEndTag:77-&amp;gt;verify:107 Incorrect message. expected:&amp;lt;...ion: This is a test.[]&amp;gt; but was:&amp;lt;...ion: This is a test.[
]&amp;gt;
  CatchingTagTest.testDoEndTagLevelObject:95-&amp;gt;verify:107 Incorrect message. expected:&amp;lt;...is is the last test.[]&amp;gt; but was:&amp;lt;...is is the last test.[
]&amp;gt;
  CatchingTagTest.testDoEndTagLevelString:86-&amp;gt;verify:107 Incorrect message. expected:&amp;lt;...his is another test.[]&amp;gt; but was:&amp;lt;...his is another test.[
]&amp;gt;
  LoggingMessageTagSupportTest.testDoEndTagMessageMarkerException:247-&amp;gt;verify:306 Incorrect message. expected:&amp;lt;...This is another test[]&amp;gt; but was:&amp;lt;...This is another test[
]&amp;gt;
  LoggingMessageTagSupportTest.testDoEndTagMessageNoMarkerException:233-&amp;gt;verify:306 Incorrect message. expected:&amp;lt;...tion: This is a test[]&amp;gt; but was:&amp;lt;...tion: This is a test[
]&amp;gt;
  LoggingMessageTagSupportTest.testDoEndTagObjectMarkerException:292-&amp;gt;verify:306 Incorrect message. expected:&amp;lt;...This is another test[]&amp;gt; but was:&amp;lt;...This is another test[
]&amp;gt;
  LoggingMessageTagSupportTest.testDoEndTagObjectNoMarkerException:280-&amp;gt;verify:306 Incorrect message. expected:&amp;lt;...tion: This is a test[]&amp;gt; but was:&amp;lt;...tion: This is a test[
]&amp;gt;
  LoggingMessageTagSupportTest.testDoEndTagStringMessageMarkerException:167-&amp;gt;verify:306 Incorrect message. expected:&amp;lt;...This is another test[]&amp;gt; but was:&amp;lt;...This is another test[
]&amp;gt;
  LoggingMessageTagSupportTest.testDoEndTagStringMessageNoMarkerException:155-&amp;gt;verify:306 Incorrect message. expected:&amp;lt;...tion: This is a test[]&amp;gt; but was:&amp;lt;...tion: This is a test[
]&amp;gt;
  LoggingMessageTagSupportTest.testDoEndTagStringWithParametersMarkerAndException:194-&amp;gt;verify:306 Incorrect message. expected:&amp;lt;...his is the last test[]&amp;gt; but was:&amp;lt;...his is the last test[
]&amp;gt;

Tests run: 78, Failures: 10, Errors: 0, Skipped: 0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I wonder if the tests are wrong and should allow the EOL or if the tab lib needs to trim if things need to be parameterized further.&lt;/p&gt;</comment>
                            <comment id="14526367" author="robert.schaft" created="Mon, 4 May 2015 07:28:56 +0000"  >&lt;p&gt;You could drop the &lt;tt&gt;if(i&amp;lt;=limit)&lt;/tt&gt; check because the loop already assures that. In other words: the separator must be always appended.&lt;/p&gt;</comment>
                            <comment id="14526370" author="robert.schaft" created="Mon, 4 May 2015 07:36:31 +0000"  >&lt;p&gt;Perhaps I was thinking too complicated. I wondered why %n and separator are there when on the other hand %n (or separator? What is your EOL?) is always at the end of the stack trace.&lt;/p&gt;

&lt;p&gt;So adding an EOL to the stack trace could be a short term solution.&lt;/p&gt;</comment>
                            <comment id="14526785" author="garydgregory" created="Mon, 4 May 2015 16:10:46 +0000"  >&lt;p&gt;What abvout the tag lib module and tests?&lt;/p&gt;</comment>
                            <comment id="14526795" author="robert.schaft" created="Mon, 4 May 2015 16:20:35 +0000"  >&lt;p&gt;I have no clue why and who wrote these tests. Perhaps that person could answer the initial question how to get the line break on short messages right.&lt;/p&gt;

&lt;p&gt;But the test failures make on thing clear: It breaks the compatibility to prior versions. So technically a new major version would be required.&lt;br/&gt;
But if this no-newline-feature is really used somewhere - I don&apos;t know.&lt;/p&gt;

&lt;p&gt;The onThrowable solution could be on the other hand implemented for the next minor version.&lt;/p&gt;</comment>
                            <comment id="16101316" author="nicolaisotta" created="Wed, 26 Jul 2017 08:17:02 +0000"  >&lt;p&gt;Any update on this?&lt;/p&gt;</comment>
                            <comment id="16104357" author="garydgregory" created="Fri, 28 Jul 2017 02:39:46 +0000"  >&lt;p&gt;Not unless someone provides a PR, preferably with a unit test &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16594803" author="quaff" created="Tue, 28 Aug 2018 10:33:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/logging-log4j2/blob/master/log4j-core/src/main/java/org/apache/logging/log4j/core/pattern/ThrowablePatternConverter.java#L185&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/logging-log4j2/blob/master/log4j-core/src/main/java/org/apache/logging/log4j/core/pattern/ThrowablePatternConverter.java#L185&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; StringWriter w = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StringWriter();
            throwable.printStackTrace(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PrintWriter(w));

            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] array = w.toString().split(Strings.LINE_SEPARATOR);
            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; limit = options.minLines(array.length) - 1;
            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; suffixNotBlank = Strings.isNotBlank(suffix);
            &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt;= limit; ++i) {
                buffer.append(array[i]);
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (suffixNotBlank) {
                    buffer.append(&lt;span class=&quot;code-quote&quot;&gt;&apos; &apos;&lt;/span&gt;);
                    buffer.append(suffix);
                }
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (i &amp;lt; limit) {
                    buffer.append(options.getSeparator());
                }
            }
            buffer.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;\n&quot;&lt;/span&gt;); &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; line should fix it&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;throwable.printStackTrace() will produce newline at end, and w.toString().split(Strings.LINE_SEPARATOR) lost it, buffer should append newline after loop.&lt;/p&gt;</comment>
                            <comment id="16594839" author="githubbot" created="Tue, 28 Aug 2018 11:11:57 +0000"  >&lt;p&gt;GitHub user quaff opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/logging-log4j2/pull/214&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/logging-log4j2/pull/214&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1002&quot; title=&quot;PatternLayout is missing a new line for Exceptions with the short option&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1002&quot;&gt;LOG4J2-1002&lt;/a&gt; - ThrowablePatternConverter should preserve EOF&lt;/p&gt;

&lt;p&gt;    throwable.printStackTrace() will produce EOF, but w.toString().split(Strings.LINE_SEPARATOR) drop it, buffer should append newline after loop.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/quaff/logging-log4j2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/quaff/logging-log4j2&lt;/a&gt; master&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/logging-log4j2/pull/214.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/logging-log4j2/pull/214.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #214&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 8eeaf69d0e4ca979dc2014e84170234d246cd75b&lt;br/&gt;
Author: Yanming Zhou &amp;lt;zhouyanming@...&amp;gt;&lt;br/&gt;
Date:   2018-08-28T11:06:19Z&lt;/p&gt;

&lt;p&gt;    ThrowablePatternConverter should preserve EOF&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1002&quot; title=&quot;PatternLayout is missing a new line for Exceptions with the short option&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1002&quot;&gt;LOG4J2-1002&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Signed-off-by: Yanming Zhou &amp;lt;zhouyanming@gmail.com&amp;gt;&lt;/p&gt;

&lt;hr /&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 12 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2e3af:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>