<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:30:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-126] Failover appender doesn&apos;t fail over on JMS Queue appender error</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-126</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;My goal is to send log messages via a JMS Queue unless the message broker is down, when I simple want send the logs to the Console.&lt;/p&gt;

&lt;p&gt;I configured a failover appender for this purpose:&lt;br/&gt;
 : &lt;br/&gt;
&amp;lt;appenders&amp;gt;&lt;/p&gt;

&lt;p&gt;...&lt;/p&gt;

&lt;p&gt;		&amp;lt;JMSQueue name=&quot;LiffLog4j2Queue&quot; queueBindingName=&quot;Log4j2Queue&quot; factoryBindingName=&quot;QueueConnectionFactory&quot;/&amp;gt;&lt;br/&gt;
		&amp;lt;Failover name=&quot;FailoverLiffLog4j2Queue&quot; primary=&quot;LiffLog4j2Queue&quot; suppressExceptions=&quot;false&quot;&amp;gt;&lt;br/&gt;
			&amp;lt;Failovers&amp;gt;&lt;br/&gt;
				&amp;lt;appender-ref ref=&quot;Console&quot;/&amp;gt;&lt;br/&gt;
			&amp;lt;/Failovers&amp;gt;&lt;br/&gt;
		&amp;lt;/Failover&amp;gt;&lt;br/&gt;
	&amp;lt;/appenders&amp;gt;&lt;br/&gt;
	&amp;lt;loggers&amp;gt;&lt;br/&gt;
		&amp;lt;root level=&quot;debug&quot;&amp;gt;&lt;br/&gt;
			&amp;lt;appender-ref ref=&quot;FailoverLiffLog4j2Queue&quot;/&amp;gt;		&lt;br/&gt;
		&amp;lt;/root&amp;gt;&lt;/p&gt;

&lt;p&gt;All works as expected when the message broker is up. &lt;/p&gt;

&lt;p&gt;When I shut down the message broker while running my application, instead of the log message  I get this message to my console :&lt;br/&gt;
2012-11-21 21:51:15,726 ERROR Could not publish message via JMS JMSQueue:QueueConnectionFactory.Log4j2Queue &lt;/p&gt;


&lt;p&gt;Using a failover appender I expected to get the log messages on the console.&lt;/p&gt;

&lt;p&gt;Also tried to start my application without ever starting message broker. In this case it correctly fails to connect : &lt;/p&gt;

&lt;p&gt;2012-11-21 22:10:08,315 DEBUG Calling createAppender on class org.apache.logging.log4j.core.appender.JMSQueueAppender for element JMSQueue with params(name=&quot;LiffLog4j2Queue&quot;, factoryName=&quot;null&quot;, providerURL=&quot;null&quot;, urlPkgPrefixes=&quot;null&quot;, securityPrincipalName=&quot;null&quot;, securityCredentials=&quot;null&quot;, factoryBindingName=&quot;QueueConnectionFactory&quot;, queueBindingName=&quot;Log4j2Queue&quot;, userName=&quot;null&quot;, password=&quot;null&quot;, null, null, suppressExceptions=&quot;null&quot;)&lt;br/&gt;
2012-11-21 22:10:10,167 ERROR Unable to establish connection javax.jms.JMSException: Could not connect to broker URL: tcp://localhost:61616. Reason: java.net.ConnectException: Connection refused: connect&lt;br/&gt;
	at org.apache.activemq.util.JMSExceptionSupport.create(JMSExceptionSupport.java:35)&lt;br/&gt;
	at org.apache.activemq.ActiveMQConnectionFactory.createActiveMQConnection(ActiveMQConnectionFactory.java:293)&lt;br/&gt;
	at org.apache.activemq.ActiveMQConnectionFactory.createActiveMQConnection(ActiveMQConnectionFactory.java:238)&lt;br/&gt;
	at org.apache.activemq.ActiveMQConnectionFactory.createQueueConnection(ActiveMQConnectionFactory.java:199)&lt;br/&gt;
	at org.apache.logging.log4j.core.net.JMSQueueManager$JMSQueueManagerFactory.createManager(JMSQueueManager.java:152)&lt;br/&gt;
	at org.apache.logging.log4j.core.net.JMSQueueManager$JMSQueueManagerFactory.createManager(JMSQueueManager.java:141)&lt;br/&gt;
	at org.apache.logging.log4j.core.appender.AbstractManager.getManager(AbstractManager.java:68)&lt;br/&gt;
	at org.apache.logging.log4j.core.net.JMSQueueManager.getJMSQueueManager(JMSQueueManager.java:86)&lt;br/&gt;
	at org.apache.logging.log4j.core.appender.JMSQueueAppender.createAppender(JMSQueueAppender.java:94)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
	at org.apache.logging.log4j.core.config.BaseConfiguration.createPluginObject(BaseConfiguration.java:711)&lt;br/&gt;
	at org.apache.logging.log4j.core.config.BaseConfiguration.createConfiguration(BaseConfiguration.java:477)&lt;br/&gt;
	at org.apache.logging.log4j.core.config.BaseConfiguration.createConfiguration(BaseConfiguration.java:469)&lt;br/&gt;
	at org.apache.logging.log4j.core.config.BaseConfiguration.doConfigure(BaseConfiguration.java:156)&lt;br/&gt;
	at org.apache.logging.log4j.core.config.BaseConfiguration.start(BaseConfiguration.java:114)&lt;br/&gt;
	at org.apache.logging.log4j.core.LoggerContext.setConfiguration(LoggerContext.java:251)&lt;br/&gt;
	at org.apache.logging.log4j.core.LoggerContext.reconfigure(LoggerContext.java:267)&lt;br/&gt;
	at org.apache.logging.log4j.core.LoggerContext.start(LoggerContext.java:134)&lt;br/&gt;
	at org.apache.logging.log4j.core.impl.Log4jContextFactory.getContext(Log4jContextFactory.java:75)&lt;br/&gt;
	at org.apache.logging.log4j.core.impl.Log4jContextFactory.getContext(Log4jContextFactory.java:30)&lt;br/&gt;
	at org.apache.logging.log4j.LogManager.getLogger(LogManager.java:165)&lt;br/&gt;
	at com.szabi.experiment.gui.Liff.&amp;lt;clinit&amp;gt;(Liff.java:16)&lt;br/&gt;
Caused by: java.net.ConnectException: Connection refused: connect&lt;br/&gt;
	at java.net.PlainSocketImpl.socketConnect(Native Method)&lt;br/&gt;
	at java.net.PlainSocketImpl.doConnect(PlainSocketImpl.java:351)&lt;br/&gt;
	at java.net.PlainSocketImpl.connectToAddress(PlainSocketImpl.java:213)&lt;br/&gt;
	at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:200)&lt;br/&gt;
	at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:366)&lt;br/&gt;
	at java.net.Socket.connect(Socket.java:529)&lt;br/&gt;
	at org.apache.activemq.transport.tcp.TcpTransport.connect(TcpTransport.java:504)&lt;br/&gt;
	at org.apache.activemq.transport.tcp.TcpTransport.doStart(TcpTransport.java:467)&lt;br/&gt;
	at org.apache.activemq.util.ServiceSupport.start(ServiceSupport.java:55)&lt;br/&gt;
	at org.apache.activemq.transport.AbstractInactivityMonitor.start(AbstractInactivityMonitor.java:132)&lt;br/&gt;
	at org.apache.activemq.transport.TransportFilter.start(TransportFilter.java:58)&lt;br/&gt;
	at org.apache.activemq.transport.WireFormatNegotiator.start(WireFormatNegotiator.java:72)&lt;br/&gt;
	at org.apache.activemq.transport.TransportFilter.start(TransportFilter.java:58)&lt;br/&gt;
	at org.apache.activemq.transport.TransportFilter.start(TransportFilter.java:58)&lt;br/&gt;
	at org.apache.activemq.ActiveMQConnectionFactory.createActiveMQConnection(ActiveMQConnectionFactory.java:273)&lt;br/&gt;
	... 23 more&lt;/p&gt;

&lt;p&gt;2012-11-21 22:10:10,177 ERROR Unable to invoke method createAppender in class org.apache.logging.log4j.core.appender.JMSQueueAppender for element JMSQueue java.lang.reflect.InvocationTargetException&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
	at org.apache.logging.log4j.core.config.BaseConfiguration.createPluginObject(BaseConfiguration.java:711)&lt;br/&gt;
	at org.apache.logging.log4j.core.config.BaseConfiguration.createConfiguration(BaseConfiguration.java:477)&lt;br/&gt;
	at org.apache.logging.log4j.core.config.BaseConfiguration.createConfiguration(BaseConfiguration.java:469)&lt;br/&gt;
	at org.apache.logging.log4j.core.config.BaseConfiguration.doConfigure(BaseConfiguration.java:156)&lt;br/&gt;
	at org.apache.logging.log4j.core.config.BaseConfiguration.start(BaseConfiguration.java:114)&lt;br/&gt;
	at org.apache.logging.log4j.core.LoggerContext.setConfiguration(LoggerContext.java:251)&lt;br/&gt;
	at org.apache.logging.log4j.core.LoggerContext.reconfigure(LoggerContext.java:267)&lt;br/&gt;
	at org.apache.logging.log4j.core.LoggerContext.start(LoggerContext.java:134)&lt;br/&gt;
	at org.apache.logging.log4j.core.impl.Log4jContextFactory.getContext(Log4jContextFactory.java:75)&lt;br/&gt;
	at org.apache.logging.log4j.core.impl.Log4jContextFactory.getContext(Log4jContextFactory.java:30)&lt;br/&gt;
	at org.apache.logging.log4j.LogManager.getLogger(LogManager.java:165)&lt;br/&gt;
	at com.szabi.experiment.gui.Liff.&amp;lt;clinit&amp;gt;(Liff.java:16)&lt;br/&gt;
Caused by: java.lang.IllegalStateException: Unable to create a manager&lt;br/&gt;
	at org.apache.logging.log4j.core.appender.AbstractManager.getManager(AbstractManager.java:70)&lt;br/&gt;
	at org.apache.logging.log4j.core.net.JMSQueueManager.getJMSQueueManager(JMSQueueManager.java:86)&lt;br/&gt;
	at org.apache.logging.log4j.core.appender.JMSQueueAppender.createAppender(JMSQueueAppender.java:94)&lt;br/&gt;
	... 16 more&lt;/p&gt;

&lt;p&gt;BUT shortly afterwards my application exits with : &lt;/p&gt;

&lt;p&gt;2012-11-21 22:10:10,238 ERROR Unable to locate primary Appender LiffLog4j2Queue&lt;br/&gt;
2012-11-21 22:10:10,239 DEBUG Reconfiguration completed&lt;br/&gt;
2012-11-21 22:10:10,277 ERROR Attempted to append to non-started appender FailoverLiffLog4j2Queue&lt;br/&gt;
2012-11-21 22:10:10,288 ERROR Attempted to append to non-started appender FailoverLiffLog4j2Queue&lt;br/&gt;
2012-11-21 22:10:10,292 DEBUG Shutting down FileManager output/experiment.log&lt;br/&gt;
Exception in thread &quot;main&quot; org.apache.logging.log4j.core.appender.AppenderRuntimeException: Attempted to append to non-started appender FailoverLiffLog4j2Queue&lt;br/&gt;
	at org.apache.logging.log4j.core.config.AppenderControl.callAppender(AppenderControl.java:88)&lt;br/&gt;
	at org.apache.logging.log4j.core.config.LoggerConfig.callAppenders(LoggerConfig.java:335)&lt;/p&gt;

&lt;p&gt;As it can not find primary appender (JMSQueue) it can not start the failover appender either.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12617216">LOG4J2-126</key>
            <summary>Failover appender doesn&apos;t fail over on JMS Queue appender error</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rgoers">Ralph Goers</assignee>
                                    <reporter username="bekisz">Szabolcs Beki</reporter>
                        <labels>
                    </labels>
                <created>Wed, 21 Nov 2012 21:21:51 +0000</created>
                <updated>Sun, 10 Feb 2013 22:04:34 +0000</updated>
                            <resolved>Sat, 1 Dec 2012 18:52:44 +0000</resolved>
                                    <version>2.0-beta4</version>
                                    <fixVersion>2.0-beta4</fixVersion>
                                    <component>Appenders</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13508023" author="ralph.goers@dslextreme.com" created="Sat, 1 Dec 2012 18:52:44 +0000"  >&lt;p&gt;The JMS Queue and Topic appenders will now initialize even if the queue or topic is unavailable and will retry the connection. Failover works as long as supressExceptions is set to false.  Please verify and close.&lt;/p&gt;</comment>
                            <comment id="13541021" author="bekisz" created="Sat, 29 Dec 2012 23:35:38 +0000"  >&lt;p&gt;Thanks for the fix. I still have some doubt whether  certain behavior is a feature or a bug. &lt;/p&gt;

&lt;p&gt;Currently it works the following way for me : &lt;/p&gt;

&lt;p&gt;Case 1 : JMS connection initially available, but later it goes down while the application is still running&lt;br/&gt;
     Failover appender works well and starts using the secondary appender (Console), and does NOT try to use primary appender any more&lt;br/&gt;
Case 2 : JMS connection initially not available &lt;br/&gt;
     Failover appender works and starts using the secondary appender (Console), but also keep trying to initialize the primary appender (JMSQueue), at each log message. &lt;/p&gt;

&lt;p&gt;In case 1 it doesn&apos;t reinitialize the primary connection, but in case 2 it tries it all the time, and this causes a major setback in performance.&lt;/p&gt;

&lt;p&gt;I think in both cases the initialization of the primary appender should work the same way. &lt;/p&gt;

&lt;p&gt;Preferably, after the first attempt it should not try to initialize primary connection in any of the cases, only if there is a reconfiguration or an explicit flag set. &lt;/p&gt;


</comment>
                            <comment id="13541600" author="ralph.goers@dslextreme.com" created="Tue, 1 Jan 2013 09:02:45 +0000"  >&lt;p&gt;Actually, I suspect both case 1 and 2 are operating the same way. The difference is that when the connection is initially not available the appender tries to reconnect on every event.  When the connection is initially available and fails it is not clearing the connection information and so keeps trying to send to the broken connection (which will fail) and then fails over to the failover.&lt;/p&gt;</comment>
                            <comment id="13541632" author="bekisz" created="Tue, 1 Jan 2013 13:07:58 +0000"  >&lt;p&gt;Yes, that&apos;s true. The real question is : &lt;/p&gt;

&lt;p&gt;Is it useful trying to reconnect on every event, when the appender initially is not available? &lt;/p&gt;

&lt;p&gt;In case of failing JMS queue appender initialization, the continuous reconnect attempts bog down the whole application and of course it does even make sense trying to reconnect after a few milliseconds.&lt;/p&gt;
</comment>
                            <comment id="13541901" author="ralph.goers@dslextreme.com" created="Tue, 1 Jan 2013 19:31:50 +0000"  >&lt;p&gt;I agree with you. &lt;/p&gt;

&lt;p&gt;I have modified the JMS appenders so that they always retry if the connection fails.  I have modified the FailoverAppender so that once the primary fails it will not invoke it again until some configurable time has elapsed. The default is 60 seconds.  Please check out the latest from trunk and confirm it is now working as expected.  &lt;/p&gt;</comment>
                            <comment id="13575549" author="bekisz" created="Sun, 10 Feb 2013 22:04:34 +0000"  >&lt;p&gt;Thanks. Now, it works as I imagined.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>259419</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 41 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0loyn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>124694</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>