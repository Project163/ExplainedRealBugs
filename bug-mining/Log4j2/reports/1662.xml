<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:43:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-3618] Multiple PropertySources with identical priority cannot be added to PropertiesUtil Environment</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-3618</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;The &lt;tt&gt;org.apache.logging.log4j.util.PropertiesUtil.Environment&lt;/tt&gt; maintains a set of &lt;tt&gt;sources&lt;/tt&gt; by using a &lt;tt&gt;ConcurrentSkipListSet&lt;/tt&gt; backed with a &lt;tt&gt;PropertySource.Comparator&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Somewhat surprisingly, the &lt;tt&gt;ConcurrentSkipListSet&lt;/tt&gt; will not add an item if comparing it to an existing one returns &lt;tt&gt;0&lt;/tt&gt;. This means that all &lt;tt&gt;PropertySource&lt;/tt&gt; implementations must have unique &lt;tt&gt;getPriority()&lt;/tt&gt; results. I think this might be better to use a &lt;tt&gt;Set&lt;/tt&gt; that uses &lt;tt&gt;equals/hashCode&lt;/tt&gt; to determine if items can be added and only use the &lt;tt&gt;Comparator&lt;/tt&gt; for sorting.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13486002">LOG4J2-3618</key>
            <summary>Multiple PropertySources with identical priority cannot be added to PropertiesUtil Environment</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="pwebb">Phillip Webb</reporter>
                        <labels>
                    </labels>
                <created>Thu, 13 Oct 2022 02:10:09 +0000</created>
                <updated>Fri, 16 Aug 2024 11:59:32 +0000</updated>
                            <resolved>Fri, 16 Aug 2024 11:59:32 +0000</resolved>
                                    <version>2.17.2</version>
                                    <fixVersion>2.24.0</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17617812" author="pkarwasz" created="Fri, 14 Oct 2022 15:39:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pwebb&quot; class=&quot;user-hover&quot; rel=&quot;pwebb&quot;&gt;pwebb&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Thanks for debugging the issue.&lt;/p&gt;

&lt;p&gt;The usage of an ordered set saves some &lt;tt&gt;sorted()&lt;/tt&gt; calls, but the comparator should distinguish between different property sources with the same priority, which is clearly not the case right now.&lt;/p&gt;

&lt;p&gt;That said I think that custom property sources should choose a different priority from the standard ones. These are ordered from smallest scope (single Spring Boot apps -100, single JVM Java properties 0) to largest scope (environment variables for all JVMs in the system 100). Values over 100 are used for developers default values.&lt;/p&gt;</comment>
                            <comment id="17617825" author="pwebb" created="Fri, 14 Oct 2022 16:06:14 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pkarwasz&quot; class=&quot;user-hover&quot; rel=&quot;pkarwasz&quot;&gt;pkarwasz&lt;/a&gt;. We do have a different priority from the standard property sources so I think most production apps won&apos;t encounter the issue. I found the problem when writing some tests and found that a property source from an earlier tests wasn&apos;t replaced by one in a later test.&lt;/p&gt;</comment>
                            <comment id="17618967" author="ralph.goers@dslextreme.com" created="Mon, 17 Oct 2022 15:43:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pkarwasz&quot; class=&quot;user-hover&quot; rel=&quot;pkarwasz&quot;&gt;pkarwasz&lt;/a&gt; What you are suggesting sounds different than the problem being reported. We clearly should allow multiple PropertySources with the same priority. However, it sounds like disallowing that was an attempt to prevent Log4j PropertySources from being modified or replaced. We could handle that just by disallowing PropertySources to be added or removed that are within a specified range. But that would also prevent users from inserting PropertySources into the middle of the list.&lt;/p&gt;

&lt;p&gt;I added the addPropertySource method recently to better support the case where Spring cannot add its PropertySource until after Log4j has created the initial set of PropertySources. From Phil&apos;s description it sounds like we also need to allow for removal/replacement for testing. &lt;/p&gt;
</comment>
                            <comment id="17619061" author="pkarwasz" created="Mon, 17 Oct 2022 19:02:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rgoers&quot; class=&quot;user-hover&quot; rel=&quot;rgoers&quot;&gt;rgoers&lt;/a&gt;, what I am suggesting is merely to modify &lt;tt&gt;PropertySource.Comparator&lt;/tt&gt; so that it returns 0 only if two property sources are equal (as objects).&lt;/p&gt;</comment>
                            <comment id="17619106" author="ralph.goers@dslextreme.com" created="Mon, 17 Oct 2022 21:27:27 +0000"  >&lt;p&gt;OK&lt;/p&gt;</comment>
                            <comment id="17874209" author="pkarwasz" created="Fri, 16 Aug 2024 11:59:32 +0000"  >&lt;p&gt;A fix is available in the current 2.24.0 snapshot.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 12 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z19bg8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>