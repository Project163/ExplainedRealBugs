<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:40:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-2667] &quot;Values not bound to statement&quot; when using JDBC appender, appender does not respect bufferSize=&quot;0&quot;.</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-2667</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Since version 2.11.2, the log4j2 library was unable to log message on database via JDBC connection.&#160;When using 2.11.1, no such problem was found.&#160;&lt;/p&gt;

&lt;p&gt;root cause:&#160;&lt;/p&gt;

&lt;p&gt;In org.sqlite.core.CorePreparedStatement, below function was called, but paramValid local variable is not initialized. Value of &quot;paramValid.cardinality()&quot; is always 0 which does not match with the&#160;total number of parameter.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void checkParameters() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SQLException
{ 
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (paramValid.cardinality() != paramCount) 
    &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SQLException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Values not bound to statement&quot;&lt;/span&gt;); 
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Sample appender in log4j2.xml&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;JDBC name=&lt;span class=&quot;code-quote&quot;&gt;&quot;jdbcAppender&quot;&lt;/span&gt; tableName=&lt;span class=&quot;code-quote&quot;&gt;&quot;LOG_TABLE&quot;&lt;/span&gt; bufferSize=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;&amp;gt;
  &amp;lt;ConnectionFactory class=&lt;span class=&quot;code-quote&quot;&gt;&quot;MY.SQLiteConnectionFactory&quot;&lt;/span&gt; method=&lt;span class=&quot;code-quote&quot;&gt;&quot;getDatabaseConnection&quot;&lt;/span&gt; /&amp;gt;
  &amp;lt;ColumnMapping name=&lt;span class=&quot;code-quote&quot;&gt;&quot;FIELD1&quot;&lt;/span&gt; type=&lt;span class=&quot;code-quote&quot;&gt;&quot;java.lang.&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&quot;&lt;/span&gt; pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;%X{FIELD1}&quot;&lt;/span&gt; /&amp;gt;
  &amp;lt;ColumnMapping name=&lt;span class=&quot;code-quote&quot;&gt;&quot;FIELD2&quot;&lt;/span&gt; type=&lt;span class=&quot;code-quote&quot;&gt;&quot;java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&quot;&lt;/span&gt; pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;%X{FIELD2}&quot;&lt;/span&gt; /&amp;gt;
  &amp;lt;ColumnMapping name=&lt;span class=&quot;code-quote&quot;&gt;&quot;FIELD3&quot;&lt;/span&gt; type=&lt;span class=&quot;code-quote&quot;&gt;&quot;java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&quot;&lt;/span&gt; pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;%X{FIELD3}&quot;&lt;/span&gt; /&amp;gt;
  &amp;lt;ColumnMapping name=&lt;span class=&quot;code-quote&quot;&gt;&quot;FIELD4&quot;&lt;/span&gt; type=&lt;span class=&quot;code-quote&quot;&gt;&quot;java.sql.Types.TIMESTAMP&quot;&lt;/span&gt; pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;%d{yyyy-MM-dd HH:mm:ss.SSS}&quot;&lt;/span&gt; /&amp;gt;
&amp;lt;/JDBC&amp;gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;Exception Log&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;panelContent&quot;&gt;
&lt;p&gt;2019-08-02 15:57:45,483 main ERROR An exception occurred processing Appender jdbcAppender org.apache.logging.log4j.core.appender.db.DbAppenderLoggingException: Failed to commit transaction logging event or flushing buffer.&lt;br/&gt;
 at org.apache.logging.log4j.core.appender.db.jdbc.JdbcDatabaseManager.commitAndClose(JdbcDatabaseManager.java:552)&lt;br/&gt;
 at org.apache.logging.log4j.core.appender.db.jdbc.JdbcDatabaseManager.writeThrough(JdbcDatabaseManager.java:867)&lt;br/&gt;
 at org.apache.logging.log4j.core.appender.db.AbstractDatabaseManager.write(AbstractDatabaseManager.java:264)&lt;br/&gt;
 at org.apache.logging.log4j.core.appender.db.AbstractDatabaseAppender.append(AbstractDatabaseAppender.java:110)&lt;br/&gt;
 at org.apache.logging.log4j.core.config.AppenderControl.tryCallAppender(AppenderControl.java:156)&lt;br/&gt;
 at org.apache.logging.log4j.core.config.AppenderControl.callAppender0(AppenderControl.java:129)&lt;br/&gt;
 at org.apache.logging.log4j.core.config.AppenderControl.callAppenderPreventRecursion(AppenderControl.java:120)&lt;br/&gt;
 at org.apache.logging.log4j.core.config.AppenderControl.callAppender(AppenderControl.java:84)&lt;br/&gt;
 at org.apache.logging.log4j.core.config.LoggerConfig.callAppenders(LoggerConfig.java:464)&lt;br/&gt;
 at org.apache.logging.log4j.core.config.LoggerConfig.processLogEvent(LoggerConfig.java:448)&lt;br/&gt;
 at org.apache.logging.log4j.core.config.LoggerConfig.log(LoggerConfig.java:431)&lt;br/&gt;
 at org.apache.logging.log4j.core.config.LoggerConfig.log(LoggerConfig.java:406)&lt;br/&gt;
 at org.apache.logging.log4j.core.config.AwaitCompletionReliabilityStrategy.log(AwaitCompletionReliabilityStrategy.java:63)&lt;br/&gt;
 at org.apache.logging.log4j.core.Logger.logMessage(Logger.java:146)&lt;br/&gt;
 at org.apache.logging.log4j.spi.AbstractLogger.tryLogMessage(AbstractLogger.java:2170)&lt;br/&gt;
 at org.apache.logging.log4j.spi.AbstractLogger.logMessageTrackRecursion(AbstractLogger.java:2125)&lt;br/&gt;
 at org.apache.logging.log4j.spi.AbstractLogger.logMessageSafely(AbstractLogger.java:2108)&lt;br/&gt;
 at org.apache.logging.log4j.spi.AbstractLogger.logMessage(AbstractLogger.java:2007)&lt;br/&gt;
 at org.apache.logging.log4j.spi.AbstractLogger.logIfEnabled(AbstractLogger.java:1866)&lt;br/&gt;
 at org.apache.logging.slf4j.Log4jLogger.info(Log4jLogger.java:179)&lt;br/&gt;
 ...&lt;br/&gt;
 Caused by: java.sql.SQLException: Values not bound to statement&lt;br/&gt;
 at org.sqlite.core.CorePreparedStatement.checkParameters(CorePreparedStatement.java:71)&lt;br/&gt;
 at org.sqlite.core.CorePreparedStatement.executeBatch(CorePreparedStatement.java:83)&lt;br/&gt;
 at org.apache.logging.log4j.core.appender.db.jdbc.JdbcDatabaseManager.commitAndClose(JdbcDatabaseManager.java:545)&lt;br/&gt;
 ...&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;Oracle Java 11.0.3,&#160;Windows Server 2016,&#160;Spring Boot 2.1.6&lt;/p&gt;</environment>
        <key id="13248532">LOG4J2-2667</key>
            <summary>&quot;Values not bound to statement&quot; when using JDBC appender, appender does not respect bufferSize=&quot;0&quot;.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ggregory">Gary D. Gregory</assignee>
                                    <reporter username="epmchui">Edith Chui</reporter>
                        <labels>
                    </labels>
                <created>Fri, 2 Aug 2019 08:31:01 +0000</created>
                <updated>Sat, 25 Jan 2020 18:09:56 +0000</updated>
                            <resolved>Mon, 20 Jan 2020 02:09:29 +0000</resolved>
                                    <version>2.11.2</version>
                    <version>2.12.0</version>
                                    <fixVersion>3.0.0</fixVersion>
                    <fixVersion>2.13.1</fixVersion>
                                    <component>Appenders</component>
                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16898805" author="garydgregory" created="Fri, 2 Aug 2019 11:15:10 +0000"  >&lt;p&gt;In order to help, I need a way to reproduce this. May you provide a test to do so? Using H2 as the database would be the best way to make this test standalone.&lt;/p&gt;</comment>
                            <comment id="16899745" author="epmchui" created="Mon, 5 Aug 2019 03:28:11 +0000"  >&lt;p&gt;Sample project attached&lt;/p&gt;</comment>
                            <comment id="16900356" author="garydgregory" created="Mon, 5 Aug 2019 19:40:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=epmchui&quot; class=&quot;user-hover&quot; rel=&quot;epmchui&quot;&gt;epmchui&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Thank you for attaching a project to reproduce the issue.&lt;/p&gt;

&lt;p&gt;The first problem is that your configuration uses a class that does not exist: &lt;tt&gt;java.sql.Types.TIMESTAMP&lt;/tt&gt;. You must have meant &lt;tt&gt;java.sql.Timestamp&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Beyond that, this could be a bug in the SQLite JDBC Driver:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;When an event comes in the JDBC appender, we call JDBC&apos;s&#160;&lt;tt&gt;PreparedStatement#set&lt;/tt&gt;&#160;for each configured column.&lt;/li&gt;
	&lt;li&gt;Then we call&#160;JDBC&apos;s&#160;&lt;tt&gt;PreparedStatement#addBatch()&lt;/tt&gt;&#160;build a list of &lt;tt&gt;INSERT&lt;/tt&gt;&#160;statements to send to the database.&lt;/li&gt;
	&lt;li&gt;We do this for each event that comes in until a threshold is met and the whole batch is sent to the database in one go. Buy, it looks like we do not really make good use of batching since all of our batches seem to be of size one, nevertheless we use the batch API.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The appender only uses batching if the driver says it supports it, which this SQLite driver says it does. But, when the appender calls &lt;tt&gt;PreparedStatement#clearParameters()&lt;/tt&gt; on this driver, there is a mismatch in expectations in how the SQLite bit field &lt;tt&gt;paramValid&lt;/tt&gt; is used in the driver which causes the exception you describe.&lt;/p&gt;

&lt;p&gt;I tried using the latest version of the JDBC Driver (3.28.0) but that does not help.&lt;/p&gt;

&lt;p&gt;The only thing I can think to do on the Log4j side is to add a setting to forcibly disable batching even when the driver says it supports it. This would cause the appender to immediately execute SQL INSERT statements instead of batching them.&lt;/p&gt;

&lt;p&gt;Any thoughts from the community?&lt;/p&gt;</comment>
                            <comment id="16900522" author="epmchui" created="Tue, 6 Aug 2019 01:36:13 +0000"  >&lt;ol&gt;
	&lt;li&gt;Both java.sql.Timestamp and&#160;java.sql.Types.TIMESTAMP can also simulate the issue. java.sql.Types.TIMESTAMP could be found in JDK Ref:&#160;&lt;a href=&quot;https://docs.oracle.com/en/java/javase/11/docs/api/java.sql/java/sql/Types.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.oracle.com/en/java/javase/11/docs/api/java.sql/java/sql/Types.html&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;In the JDBC appender,&#160;bufferSize=&quot;0&quot; was set which means the insert statement should be fired immediately.&#160;This setting can control whether it should be in batch or individual already.&lt;/li&gt;
	&lt;li&gt;Could you investigate what is being changed between log4j2&#160;2.11.1 and 2.11.2 because thing goes nice using&#160;2.11.1 with SQLite JDBC driver 3.25.2? Error was&#160;happened by just updating the log4j2 version to&#160;2.11.2 / 2.12.0.&#160;So, it has high chance that the new log4j2 version has something changed that it is not compatible with the SQLite JDBC driver even latest driver version was used.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="16901112" author="garydgregory" created="Tue, 6 Aug 2019 14:34:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=epmchui&quot; class=&quot;user-hover&quot; rel=&quot;epmchui&quot;&gt;epmchui&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;You CANNOT use &lt;tt&gt;type=&quot;java.sql.Types.TIMESTAMP&quot;&lt;/tt&gt;, you MUST use a fully qualified class name like &lt;tt&gt;java.sql.Timestamp&lt;/tt&gt;. If you turn on Log4j&apos;s status DEBUG logging, you can verify this:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;configuration packages=&quot;**.***.****.cmmp.audit.logger&quot; status=&quot;DEBUG&quot;&amp;gt;
...
&amp;lt;/configuration&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Yields:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2019-08-06 10:30:28,004 main WARN Error while converting string [java.sql.Types.TIMESTAMP] to type [class java.lang.Class]. Using default value [null]. java.lang.ClassNotFoundException: java.sql.Types.TIMESTAMP
	at java.base/jdk.internal.loader.BuiltinClassLoader.loadClass(BuiltinClassLoader.java:583)
	at java.base/jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass(ClassLoaders.java:178)
	at java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:521)
	at java.base/java.lang.Class.forName0(Native Method)
	at java.base/java.lang.Class.forName(Class.java:315)
	at org.apache.logging.log4j.util.LoaderUtil.loadClass(LoaderUtil.java:168)
	at org.apache.logging.log4j.core.config.plugins.convert.TypeConverters$ClassConverter.convert(TypeConverters.java:200)
	at org.apache.logging.log4j.core.config.plugins.convert.TypeConverters$ClassConverter.convert(TypeConverters.java:1)
	at org.apache.logging.log4j.core.config.plugins.convert.TypeConverters.convert(TypeConverters.java:419)
	at org.apache.logging.log4j.core.config.plugins.visitors.AbstractPluginVisitor.convert(AbstractPluginVisitor.java:151)
	at org.apache.logging.log4j.core.config.plugins.visitors.PluginBuilderAttributeVisitor.visit(PluginBuilderAttributeVisitor.java:50)
	at org.apache.logging.log4j.core.config.plugins.util.PluginBuilder.injectFields(PluginBuilder.java:185)
	at org.apache.logging.log4j.core.config.plugins.util.PluginBuilder.build(PluginBuilder.java:121)
	at org.apache.logging.log4j.core.config.AbstractConfiguration.createPluginObject(AbstractConfiguration.java:1002)
	at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:942)
	at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:934)
	at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:934)
	at org.apache.logging.log4j.core.config.AbstractConfiguration.doConfigure(AbstractConfiguration.java:552)
	at org.apache.logging.log4j.core.config.AbstractConfiguration.initialize(AbstractConfiguration.java:241)
	at org.apache.logging.log4j.core.config.AbstractConfiguration.start(AbstractConfiguration.java:288)
	at org.apache.logging.log4j.core.LoggerContext.setConfiguration(LoggerContext.java:579)
	at org.apache.logging.log4j.core.LoggerContext.reconfigure(LoggerContext.java:651)
	at org.apache.logging.log4j.core.LoggerContext.reconfigure(LoggerContext.java:668)
	at org.apache.logging.log4j.core.LoggerContext.start(LoggerContext.java:253)
	at org.apache.logging.log4j.core.impl.Log4jContextFactory.getContext(Log4jContextFactory.java:153)
	at org.apache.logging.log4j.core.impl.Log4jContextFactory.getContext(Log4jContextFactory.java:1)
	at org.apache.logging.log4j.LogManager.getContext(LogManager.java:155)
	at org.apache.logging.slf4j.Log4jLoggerFactory.getContext(Log4jLoggerFactory.java:45)
	at org.apache.logging.log4j.spi.AbstractLoggerAdapter.getLogger(AbstractLoggerAdapter.java:48)
	at org.apache.logging.slf4j.Log4jLoggerFactory.getLogger(Log4jLoggerFactory.java:1)
	at org.slf4j.LoggerFactory.getLogger(LoggerFactory.java:358)
	at apache.log4j2.issue.App.&amp;lt;clinit&amp;gt;(App.java:15)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It is likely (I&apos;ve not looked a git logs) that the more recent version of Log4j calls &lt;tt&gt;PreparedStatement#clearParameters()&lt;/tt&gt; in a spot where it did not in the past in order to release resources as soon as we are done with them.&lt;/p&gt;</comment>
                            <comment id="16901504" author="jira-bot" created="Tue, 6 Aug 2019 21:54:08 +0000"  >&lt;p&gt;Commit 7972089ad01a30568b2467581abac6f3cb70b769 in logging-log4j2&apos;s branch refs/heads/release-2.x from Gary Gregory&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=7972089&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=7972089&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2667&quot; title=&quot;&amp;quot;Values not bound to statement&amp;quot; when using JDBC appender, appender does not respect bufferSize=&amp;quot;0&amp;quot;.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2667&quot;&gt;&lt;del&gt;LOG4J2-2667&lt;/del&gt;&lt;/a&gt; &quot;Values not bound to statement&quot; when using JDBC appender,&lt;br/&gt;
appender does not respect bufferSize=&quot;0&quot;.&lt;/p&gt;</comment>
                            <comment id="16901505" author="jira-bot" created="Tue, 6 Aug 2019 21:57:26 +0000"  >&lt;p&gt;Commit 42a553ed349bc0e237b0f251bb09f7859e520ee8 in logging-log4j2&apos;s branch refs/heads/master from Gary Gregory&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=42a553e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=42a553e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2667&quot; title=&quot;&amp;quot;Values not bound to statement&amp;quot; when using JDBC appender, appender does not respect bufferSize=&amp;quot;0&amp;quot;.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2667&quot;&gt;&lt;del&gt;LOG4J2-2667&lt;/del&gt;&lt;/a&gt; &quot;Values not bound to statement&quot; when using JDBC appender,&lt;br/&gt;
appender does not respect bufferSize=&quot;0&quot;.&lt;/p&gt;</comment>
                            <comment id="16901512" author="garydgregory" created="Tue, 6 Aug 2019 22:06:49 +0000"  >&lt;p&gt;In git master and release-2.x.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=epmchui&quot; class=&quot;user-hover&quot; rel=&quot;epmchui&quot;&gt;epmchui&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Please download a 2.12.1-SNAPSHOT build and verify. The Maven snapshot repository is &lt;a href=&quot;https://repository.apache.org/content/repositories/snapshots/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/repositories/snapshots/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thank you,&lt;br/&gt;
Gary&lt;/p&gt;</comment>
                            <comment id="16901625" author="epmchui" created="Wed, 7 Aug 2019 02:04:48 +0000"  >&lt;p&gt;Retest result :&lt;/p&gt;

&lt;p&gt;2.12.1-SNAPSHOT&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;bufferSize=&quot;0&quot; : success&lt;/li&gt;
	&lt;li&gt;bufferSize=&quot;10&quot; : fail, same error&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;3.0.0-SNAPSHOT&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;bufferSize=&quot;0&quot; :&#160;no error but no log can be written to database&lt;/li&gt;
	&lt;li&gt;bufferSize=&quot;10&quot; :&#160;no error but no log can be written to database&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thank you very much.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16901626" author="garydgregory" created="Wed, 7 Aug 2019 02:08:28 +0000"  >&lt;p&gt;For this JDBC driver, a 0 buffer size is the only setting that will work. I did not publish a 3.0.0 snapshot so you might have picked up a version from before whenever builds.apache.org got around to building one.&lt;/p&gt;</comment>
                            <comment id="16901675" author="epmchui" created="Wed, 7 Aug 2019 03:58:06 +0000"  >&lt;p&gt;Extracted the SQLite code,&lt;/p&gt;

&lt;p&gt;org.apache.logging.log4j.core.appender.db.AbstractDatabaseManager.flush()&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Override
 &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; void flush() {
 &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.isRunning() &amp;amp;&amp;amp; isBuffered()) {
 &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.connectAndStart();
 &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; LogEvent event : &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.buffer) {
 &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.writeInternal(event, layout != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? layout.toSerializable(event) : &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
 }
 } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
 &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.commitAndClose();
 &lt;span class=&quot;code-comment&quot;&gt;// not sure &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; should be done when writing the events failed
&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.buffer.clear();
 }
 }
 }&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The paramValid was forcibly cleared in writeInternal() function. Since the whole logging action is still not finished and is waiting to be committed to database in commitAndClose(), that means paramValid is still in use by JDBC driver. It is not a right moment to clear the parameter as the whole operation is not came to the end.&#160;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I am not sure what is the impact&#160;of reverting the code of&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2489&quot; title=&quot;JDBC Appender should release parameter resources ASAP&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2489&quot;&gt;&lt;del&gt;LOG4J2-2489&lt;/del&gt;&lt;/a&gt;. Is there other solution to&#160;release the resource right after all things are done?&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Note (&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2489&quot; title=&quot;JDBC Appender should release parameter resources ASAP&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2489&quot;&gt;&lt;del&gt;LOG4J2-2489&lt;/del&gt;&lt;/a&gt;):&lt;/p&gt;

&lt;p&gt;org.apache.logging.log4j.core.appender.db.jdbc.JdbcDatabaseManager.writeInternal(LogEvent, Serializable)&lt;/p&gt;

&lt;p&gt;finally {&lt;br/&gt;
 // Release ASAP&lt;br/&gt;
 try&lt;/p&gt;

{ statement.clearParameters(); }

&lt;p&gt;catch (final SQLException e)&lt;/p&gt;

{ // Ignore }

&lt;p&gt;Closer.closeSilently(reader);&lt;br/&gt;
 }&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17019183" author="epmchui" created="Mon, 20 Jan 2020 02:09:29 +0000"  >&lt;p&gt;The development teams said only bufferSize=0 works. It will be great if bufferSize other than zero, can be solved as well. &lt;/p&gt;</comment>
                            <comment id="17019769" author="garydgregory" created="Mon, 20 Jan 2020 23:11:03 +0000"  >&lt;p&gt;Did you try the latest JDBC driver, 3.30.1?&lt;/p&gt;</comment>
                            <comment id="17019850" author="epmchui" created="Tue, 21 Jan 2020 04:42:27 +0000"  >&lt;p&gt;Yes, it is already the latest JDBC driver 3.30.1&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
       &amp;lt;dependency&amp;gt;
	    &amp;lt;groupId&amp;gt;org.xerial&amp;lt;/groupId&amp;gt;
	    &amp;lt;artifactId&amp;gt;sqlite-jdbc&amp;lt;/artifactId&amp;gt;
	    &amp;lt;version&amp;gt;3.30.1&amp;lt;/version&amp;gt;
	&amp;lt;/dependency&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17020323" author="garydgregory" created="Tue, 21 Jan 2020 15:57:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=epmchui&quot; class=&quot;user-hover&quot; rel=&quot;epmchui&quot;&gt;epmchui&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Are you on Log4j 2.13.0? If not, update to it, so we are all on the same page.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17020705" author="epmchui" created="Wed, 22 Jan 2020 01:26:11 +0000"  >&lt;p&gt;It is already 2.13.0.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Library used&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Version&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;slf4j-api&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.7.25&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;log4j-slf4j-impl&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.13.0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;log4j-jcl&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.13.0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;log4j-core&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.13.0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;sqlite-jdbc&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3.30.1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;spring-boot-starter-parent&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.1.6.RELEASE&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17023622" author="garydgregory" created="Sat, 25 Jan 2020 18:09:56 +0000"  >&lt;p&gt;If you are getting the same exception out of the JDBC driver, then this still looks to me like a bug in that JDBC driver. If I were you I&apos;d create the simplest JDBC test only using the JDBC driver and submit it as a bug to SQLite.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13248807">LOG4J2-2669</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13194515">LOG4J2-2489</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12976883" name="log4j2.issue.zip" size="8851" author="epmchui" created="Wed, 7 Aug 2019 02:04:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 42 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z059vs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>