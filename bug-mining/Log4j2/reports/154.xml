<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:31:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-330] NoSQLAppender cannot insert log event to MongoDB</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-330</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;Seems like NoSQLAppender can&apos;t insert any log events to Mongo due to lack of serializer for Level enum.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;2013-07-31 18:19:27,831 ERROR An exception occurred processing Appender databaseAppender java.lang.IllegalArgumentException: can&apos;t serialize class org.apache.logging.log4j.Level&lt;br/&gt;
    at org.bson.BasicBSONEncoder._putObjectField(BasicBSONEncoder.java:270)&lt;br/&gt;
    at org.bson.BasicBSONEncoder.putObject(BasicBSONEncoder.java:174)&lt;br/&gt;
    at org.bson.BasicBSONEncoder.putObject(BasicBSONEncoder.java:120)&lt;br/&gt;
    at com.mongodb.DefaultDBEncoder.writeObject(DefaultDBEncoder.java:27)&lt;br/&gt;
    at com.mongodb.OutMessage.putObject(OutMessage.java:289)&lt;br/&gt;
    at com.mongodb.DBApiLayer$MyCollection.insert(DBApiLayer.java:239)&lt;br/&gt;
    at com.mongodb.DBApiLayer$MyCollection.insert(DBApiLayer.java:204)&lt;br/&gt;
    at com.mongodb.DBCollection.insert(DBCollection.java:148)&lt;br/&gt;
    at com.mongodb.DBCollection.insert(DBCollection.java:91)&lt;br/&gt;
    at org.apache.logging.log4j.core.appender.db.nosql.mongo.MongoDBConnection.insertObject(MongoDBConnection.java:61)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Here is my config&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;&amp;lt;configuration status=&quot;WARN&quot;&amp;gt;&lt;br/&gt;
    &amp;lt;appenders&amp;gt;&lt;br/&gt;
        &amp;lt;NoSql name=&quot;databaseAppender&quot; suppressExceptions=&quot;true&quot;&amp;gt;&lt;br/&gt;
            &amp;lt;MongoDb collectionName=&quot;applicationLog&quot; factoryClassName=&quot;com.borsch.DBManager&quot; factoryMethodName=&quot;getNewMongoClient&quot; writeConcernConstant=&quot;NONE&quot; username=&quot;root&quot; password=&quot;qwe&quot;/&amp;gt;&lt;br/&gt;
        &amp;lt;/NoSql&amp;gt;&lt;br/&gt;
    &amp;lt;/appenders&amp;gt;&lt;br/&gt;
    &amp;lt;loggers&amp;gt;&lt;br/&gt;
        &amp;lt;root level=&quot;error&quot;&amp;gt;&lt;br/&gt;
            &amp;lt;appender-ref ref=&quot;databaseAppender&quot;/&amp;gt;&lt;br/&gt;
        &amp;lt;/root&amp;gt;&lt;br/&gt;
    &amp;lt;/loggers&amp;gt;&lt;br/&gt;
&amp;lt;/configuration&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;For now I used following workaround (code is in Scala)&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; 
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;LevelBSONEncoder &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; org.bson.Transformer {
  def transform(o: Any): AnyRef =
    o match { &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; level: org.apache.logging.log4j.Level =&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; java.lang.&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;(level.intLevel()) }
}

&lt;span class=&quot;code-comment&quot;&gt;// which is used like &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;
&lt;/span&gt;
org.bson.BSON.addEncodingHook(org.apache.logging.log4j.Level.ERROR.getClass, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; LevelBSONEncoder())
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;I think it should be done in appender.&lt;/p&gt;</description>
                <environment>&lt;p&gt;JDK 1.7, Mongo Driver 2.11.2&lt;/p&gt;</environment>
        <key id="12661037">LOG4J2-330</key>
            <summary>NoSQLAppender cannot insert log event to MongoDB</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="beamerblvd">Nick Williams</assignee>
                                    <reporter username="expert">expert</reporter>
                        <labels>
                    </labels>
                <created>Thu, 1 Aug 2013 02:05:45 +0000</created>
                <updated>Fri, 20 Jun 2014 02:20:34 +0000</updated>
                            <resolved>Fri, 20 Jun 2014 02:20:34 +0000</resolved>
                                    <version>2.0-beta8</version>
                                    <fixVersion>2.0-rc1</fixVersion>
                                    <component>Appenders</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13725963" author="beamerblvd" created="Thu, 1 Aug 2013 02:07:15 +0000"  >&lt;p&gt;Thanks. I&apos;ll get this in soon.&lt;/p&gt;</comment>
                            <comment id="13727254" author="beamerblvd" created="Fri, 2 Aug 2013 03:07:52 +0000"  >&lt;p&gt;Fixed in trunk. Please verify (either by compiling from trunk or waiting for beta9) and close.&lt;/p&gt;</comment>
                            <comment id="13727263" author="beamerblvd" created="Fri, 2 Aug 2013 03:17:54 +0000"  >&lt;p&gt;By the way: Unfortunately MongoDB does not provide a way to configure transformers on a per-connection basis. It&apos;s a static configuration, which is global and affects everything. There&apos;s no way really around this. If per-connection transformers had been allowed, I would have made this configurable. Since it has to be static (potentially affecting multiple applications in certain environments), I made the transformer use the String Level name, which is more verbose and less fragile than using the ordinal, level number, etc. Note that this is different than the one you are using, and so will result in log events being persisted differently.&lt;/p&gt;</comment>
                            <comment id="13770472" author="poorna" created="Wed, 18 Sep 2013 06:03:39 +0000"  >&lt;p&gt;I checked it in 2.0-beta9, it is still not working.Below is the stacktrace.&lt;/p&gt;

&lt;p&gt;java.lang.IllegalArgumentException: can&apos;t serialize class org.apache.logging.log4j.Level&lt;br/&gt;
	at org.bson.BasicBSONEncoder._putObjectField(BasicBSONEncoder.java:270)&lt;br/&gt;
	at org.bson.BasicBSONEncoder.putObject(BasicBSONEncoder.java:174)&lt;br/&gt;
	at org.bson.BasicBSONEncoder.putObject(BasicBSONEncoder.java:120)&lt;br/&gt;
	at com.mongodb.DefaultDBEncoder.writeObject(DefaultDBEncoder.java:27)&lt;br/&gt;
	at com.mongodb.OutMessage.putObject(OutMessage.java:289)&lt;br/&gt;
	at com.mongodb.DBApiLayer$MyCollection.insert(DBApiLayer.java:239)&lt;br/&gt;
	at com.mongodb.DBApiLayer$MyCollection.insert(DBApiLayer.java:204)&lt;br/&gt;
	at com.mongodb.DBCollection.insert(DBCollection.java:148)&lt;br/&gt;
	at com.mongodb.DBCollection.insert(DBCollection.java:91)&lt;/p&gt;

&lt;p&gt;I have looked at the class MongoDBConnection.java. Updated code only has decodeHook registered, not the encodeHook. Hence encoding is still failing. &lt;/p&gt;

</comment>
                            <comment id="13770507" author="beamerblvd" created="Wed, 18 Sep 2013 06:45:28 +0000"  >&lt;p&gt;*&lt;b&gt;head desk&lt;/b&gt;*&lt;/p&gt;

&lt;p&gt;That was a stupid mistake on my part. It&apos;s unfortunate that you weren&apos;t able to verify this bug before beta9 was released. I could have gotten it fixed. But it is what it is. The fix will be in 2.0.0.next.&lt;/p&gt;</comment>
                            <comment id="13770512" author="poorna" created="Wed, 18 Sep 2013 06:50:39 +0000"  >&lt;p&gt;Hi Nick,&lt;br/&gt;
        I am not the reporter of the bug. I just happened to upgrade to 2.0 today and encountered the issue.&lt;/p&gt;</comment>
                            <comment id="13770515" author="beamerblvd" created="Wed, 18 Sep 2013 06:52:43 +0000"  >&lt;p&gt;Oh. Haha. My bad. I guess that&apos;s my queue to go to bed. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14038273" author="remkop@yahoo.com" created="Fri, 20 Jun 2014 02:20:34 +0000"  >&lt;p&gt;Looks like Nick fixed this issue in RC1, as part of the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-475&quot; title=&quot;MongoDBConnection is broken because it uses addDecodingHook instead of addEncodingHook&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-475&quot;&gt;&lt;del&gt;LOG4J2-475&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Please verify and close.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>341226</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 22 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1munj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>341544</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>