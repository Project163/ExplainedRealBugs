<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:35:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-1232] Incorrect log rotation in last week of year</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-1232</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;I have log4j2.xml configuration with several log-files definitions like:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&amp;lt;RollingRandomAccessFile name=&lt;span class=&quot;code-quote&quot;&gt;&quot;FIX_MESSAGES_FILE_MARKET_DATA&quot;&lt;/span&gt; fileName=&lt;span class=&quot;code-quote&quot;&gt;&quot;logs/market_data_msg.log&quot;&lt;/span&gt;
                         filePattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;logs/market_data_msg.log-%d{yyyy-MM-&lt;span class=&quot;code-quote&quot;&gt;&apos;W&apos;&lt;/span&gt;W}&quot;&lt;/span&gt; immediateFlush=&lt;span class=&quot;code-quote&quot;&gt;&quot;false&quot;&lt;/span&gt;&amp;gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;PatternLayout pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;%m%n&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Policies&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;TimeBasedTriggeringPolicy/&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Policies&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/RollingRandomAccessFile&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Today (2015-12-28) all log files suddenly become almost empty. Reason in permanent rotation current log file in file &quot;market_data_msg.log-2014-12-W5&quot; (wrong year). As result of permanent rotation both files contains only 0 or 1 lines and information is lost!&lt;/p&gt;

&lt;p&gt;Obviously, the problem related with the fact that today started last week of the year.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12924482">LOG4J2-1232</key>
            <summary>Incorrect log rotation in last week of year</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="Nikolai">Nikolai</reporter>
                        <labels>
                    </labels>
                <created>Mon, 28 Dec 2015 11:52:21 +0000</created>
                <updated>Sun, 7 Feb 2021 16:53:39 +0000</updated>
                            <resolved>Sun, 7 Feb 2021 16:53:39 +0000</resolved>
                                    <version>2.3</version>
                    <version>2.5</version>
                                    <fixVersion>2.6</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15072708" author="nikolai" created="Mon, 28 Dec 2015 13:14:18 +0000"  >&lt;p&gt;Trace logging shows:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2015-12-28 08:04:02,767 TRACE PatternProcessor.getNextTime returning 2015/01/04-00:00:00.000, nextFileTime=2014/12/28-00:00:00.000, prevFileTime=1969/12/31-1
9:00:00.000, current=2015/12/28-08:04:02.767, freq=WEEKLY
2015-12-28 08:04:02,768 TRACE PatternProcessor.getNextTime returning 2015/01/04-00:00:00.000, nextFileTime=2014/12/28-00:00:00.000, prevFileTime=2014/12/28-0
0:00:00.000, current=2015/12/28-08:04:02.768, freq=WEEKLY
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15072738" author="nikolai" created="Mon, 28 Dec 2015 14:04:04 +0000"  >&lt;p&gt;Problem in method&lt;br/&gt;
&lt;tt&gt;org.apache.logging.log4j.core.appender.rolling.PatternProcessor#getNextTime&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;In branch &lt;tt&gt;if (frequency == RolloverFrequency.WEEKLY)&lt;/tt&gt; value of &lt;tt&gt;currentCal.get(Calendar.WEEK_OF_YEAR)&lt;/tt&gt; is 1!&lt;/p&gt;

&lt;p&gt;See &lt;tt&gt;java.util.Calendar#setMinimalDaysInFirstWeek&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="15082116" author="garydgregory" created="Tue, 5 Jan 2016 00:48:12 +0000"  >&lt;p&gt;If what you had in mind is something like:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;diff --git a/log4j-core/src/main/java/org/apache/logging/log4j/core/appender/rolling/PatternProcessor.java b/log4j-core/src/main/java/org/apache/logging/log4j/core/appender/rolling/PatternProcessor.java
index fbc74b4..7ec8eca 100644
--- a/log4j-core/src/main/java/org/apache/logging/log4j/core/appender/rolling/PatternProcessor.java
+++ b/log4j-core/src/main/java/org/apache/logging/log4j/core/appender/rolling/PatternProcessor.java
@@ -99,6 +99,7 @@
         final Calendar cal = Calendar.getInstance();
         cal.set(currentCal.get(Calendar.YEAR), 0, 1, 0, 0, 0);
         cal.set(Calendar.MILLISECOND, 0);
+        cal.setMinimalDaysInFirstWeek(1);
         if (frequency == RolloverFrequency.ANNUALLY) {
             increment(cal, Calendar.YEAR, increment, modulus);
             nextTime = cal.getTimeInMillis();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That does not work. Please see the unit test &lt;tt&gt;org.apache.logging.log4j.core.appender.rolling.PatternProcessorTest&lt;/tt&gt; that is annotated with &lt;tt&gt;@Ignored&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15091798" author="nikolai" created="Mon, 11 Jan 2016 11:31:59 +0000"  >&lt;p&gt;Gregory,&lt;br/&gt;
&lt;tt&gt;org.apache.logging.log4j.core.appender.rolling.PatternProcessor#getNextTime&lt;/tt&gt; may be easy fixed by adding two lines:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;currentCal.setMinimalDaysInFirstWeek(7);
cal.setMinimalDaysInFirstWeek(7);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Also, in your test (thanks for writing it!) expected is 3 January (due to force 1st day of the week to be Sunday).&lt;br/&gt;
&lt;tt&gt;00&lt;/tt&gt; is octal integers &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17280613" author="ralph.goers@dslextreme.com" created="Sun, 7 Feb 2021 16:53:39 +0000"  >&lt;p&gt;The fix for this issue was committed several years ago but apparently this issue was not updated.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 40 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2qc6n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>