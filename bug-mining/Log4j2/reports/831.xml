<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:36:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-1417] Unbox should respect Constants.ENABLE_THREADLOCALS</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-1417</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;The org.apache.logging.log4j.util.Unbox class stores a non-JDK class (Unbox$State) in a static ThreadLocal field.&lt;/p&gt;

&lt;p&gt;This may cause memory leaks in containers which share thread pools between applications.&lt;/p&gt;

&lt;p&gt;One way to accomplish this is to have two ThreadLocal fields: one that stores an array of StringBuilders, and one that stores an AtomicLong to track the current slot.&lt;/p&gt;

&lt;p&gt;(If there is a performance impact we can switch between alternative implementations depending on the value of Constants.ENABLE_THREADLOCALS.)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12976288">LOG4J2-1417</key>
            <summary>Unbox should respect Constants.ENABLE_THREADLOCALS</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rpopma">Remko Popma</assignee>
                                    <reporter username="rpopma">Remko Popma</reporter>
                        <labels>
                    </labels>
                <created>Tue, 7 Jun 2016 04:21:32 +0000</created>
                <updated>Sun, 18 Sep 2016 10:40:25 +0000</updated>
                            <resolved>Sun, 18 Sep 2016 10:40:24 +0000</resolved>
                                    <version>2.6</version>
                    <version>2.6.1</version>
                                    <fixVersion>2.6.2</fixVersion>
                                    <component>API</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="15325775" author="remkop@yahoo.com" created="Sat, 11 Jun 2016 08:25:50 +0000"  >&lt;p&gt;Added a web-app safe representation for storing StringBuilders in ThreadLocals.&lt;/p&gt;

&lt;p&gt;Performance testing showed the original representation is faster with multiple threads, so the web-safe representation is only used if Constants.ENABLE_THREADLOCALS is false.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Original representation with 4 threads&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;// java -Dlog4j2.enable.threadlocals=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -jar log4j-perf\target\benchmarks.jar &lt;span class=&quot;code-quote&quot;&gt;&quot;.*Unbox.*&quot;&lt;/span&gt; -f 1 -wi 10 -i 15 -t 4
&lt;/span&gt;
Benchmark                                  Mode  Samples    Score   Error  Units
o.a.l.l.p.j.UnboxBenchmark.boxBoolean    sample   797504   62.489 &#177; 1.197  ns/op
o.a.l.l.p.j.UnboxBenchmark.boxDouble     sample  1073882  475.165 &#177; 6.840  ns/op
o.a.l.l.p.j.UnboxBenchmark.boxFloat      sample   998490  279.987 &#177; 3.992  ns/op
o.a.l.l.p.j.UnboxBenchmark.boxInt        sample  1149793   78.770 &#177; 2.661  ns/op
o.a.l.l.p.j.UnboxBenchmark.boxLong       sample   629717   75.244 &#177; 0.865  ns/op
o.a.l.l.p.j.UnboxBenchmark.boxShort      sample   685683   69.648 &#177; 1.057  ns/op
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;b&gt;Web-safe representation with 4 threads&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;// java -Dlog4j2.enable.threadlocals=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; -jar log4j-perf\target\benchmarks.jar &lt;span class=&quot;code-quote&quot;&gt;&quot;.*Unbox.*&quot;&lt;/span&gt; -f 1 -wi 10 -i 15 -t 4
&lt;/span&gt;
Benchmark                                  Mode  Samples    Score    Error  Units
o.a.l.l.p.j.UnboxBenchmark.boxBoolean    sample   680750   69.998 &#177;  4.319  ns/op
o.a.l.l.p.j.UnboxBenchmark.boxDouble     sample  1096977  495.519 &#177; 11.621  ns/op
o.a.l.l.p.j.UnboxBenchmark.boxFloat      sample   952154  301.714 &#177; 12.061  ns/op
o.a.l.l.p.j.UnboxBenchmark.boxInt        sample   912080  102.098 &#177;  4.950  ns/op
o.a.l.l.p.j.UnboxBenchmark.boxLong       sample  1016424   95.503 &#177; 10.432  ns/op
o.a.l.l.p.j.UnboxBenchmark.boxShort      sample   611588   77.056 &#177;  2.721  ns/op
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Fixed in master.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12975850">LOG4J2-1412</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311120" key="com.pyxis.greenhopper.jira:gh-epic-link">
                        <customfieldname>Epic Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>LOG4J2-1270</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 23 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2z28n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>