<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:42:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-2956] Using log4j-spring-cloud-config-client and DynamicThresholdFilter cause Could not initialize class org.apache.logging.log4j.core.impl.ContextDataFactoryException</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-2956</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;Assumptions:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Application is a Spring Boot app.&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;It is configured to use&#160;spring-boot-starter-log4j2&lt;/tt&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&lt;tt&gt;There is a log4j2.cfg.xml provided through logging.config property and it is working fine. It contains following part:&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;DynamicThresholdFilter key=&quot;X-Log-Level&quot; onMatch=&quot;ACCEPT&quot; onMismatch=&quot;NEUTRAL&quot;&amp;gt; &#160; 
 &amp;lt;DefaultThreshold&amp;gt;INFO&amp;lt;/DefaultThreshold&amp;gt;
 &amp;lt;KeyValuePair key=&quot;DEBUG&quot; value=&quot;DEBUG&quot; /&amp;gt;
 &amp;lt;KeyValuePair key=&quot;TRACE&quot; value=&quot;TRACE&quot; /&amp;gt;
&amp;lt;/DynamicThresholdFilter&amp;gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;tt&gt;However when dependency&#160;log4j-spring-cloud-config-client is added application does not start with following exception:&lt;/tt&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Exception in thread &quot;main&quot; java.lang.NoClassDefFoundError: Could not initialize class org.apache.logging.log4j.core.impl.ContextDataFactoryException in thread &quot;main&quot; java.lang.NoClassDefFoundError: Could not initialize class org.apache.logging.log4j.core.impl.ContextDataFactory 
at org.apache.logging.log4j.core.impl.ThreadContextDataInjector$ForDefaultThreadContextMap.rawContextData(ThreadContextDataInjector.java:137) 
at org.apache.logging.log4j.core.filter.DynamicThresholdFilter.currentContextData(DynamicThresholdFilter.java:162) 
at org.apache.logging.log4j.core.filter.DynamicThresholdFilter.filter(DynamicThresholdFilter.java:152) at org.apache.logging.log4j.core.Logger$PrivateConfig.filter(Logger.java:609) 
at org.apache.logging.log4j.core.Logger.isEnabled(Logger.java:258) at org.apache.logging.log4j.spi.AbstractLogger.isEnabled(AbstractLogger.java:1513) 
at org.apache.commons.logging.LogAdapter$Log4jLog.isErrorEnabled(LogAdapter.java:175) at org.springframework.boot.SpringApplication.reportFailure(SpringApplication.java:836) 
at org.springframework.boot.SpringApplication.handleRunFailure(SpringApplication.java:812) at org.springframework.boot.SpringApplication.run(SpringApplication.java:325) 
at org.springframework.boot.SpringApplication.run(SpringApplication.java:1237) at org.springframework.boot.SpringApplication.run(SpringApplication.java:1226) 
at pl.frati.moray.configserver.ConfigServerApplication.main(ConfigServerApplication.java:12)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;First of all I have no idea what is missing. Without mentioned dependency application startup is correct. Also, removing&#160;DynamicThresholdFilter solves the problem as well.&lt;/p&gt;

&lt;p&gt;Second of all it seems that exception message is somewhat broken, because it does not say anything about what class is missing. I&apos;ve tried to debug this, but class&#160;ContextDataFactory is pretty hard to debug. Fix in exception message should ease the hunt.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13338684">LOG4J2-2956</key>
            <summary>Using log4j-spring-cloud-config-client and DynamicThresholdFilter cause Could not initialize class org.apache.logging.log4j.core.impl.ContextDataFactoryException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="raffig">Rafa&#322; Figas</reporter>
                        <labels>
                    </labels>
                <created>Tue, 3 Nov 2020 16:29:02 +0000</created>
                <updated>Mon, 9 May 2022 21:30:01 +0000</updated>
                            <resolved>Thu, 5 May 2022 19:56:50 +0000</resolved>
                                    <version>2.13.3</version>
                                    <fixVersion>2.18.0</fixVersion>
                                    <component>Spring</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17225860" author="ralph.goers@dslextreme.com" created="Wed, 4 Nov 2020 05:19:03 +0000"  >&lt;p&gt;Please verify the versions of Log4j included in your application. spring-boot-starter-log4j2 may not be including the Log4j 2.13.3. Since you didn&apos;t specify the Spring boot version I can&apos;t check that.&#160; But you can unzip your jar or war into a temp directory and look in BOOT-INF/lib to see what versions of the jars are included.&lt;/p&gt;

&lt;p&gt;As an alternative, you can replace the spring boot starter log4j2 jar with the actual log4j dependencies and you can directly control the versions.&lt;/p&gt;</comment>
                            <comment id="17226699" author="raffig" created="Thu, 5 Nov 2020 12:40:21 +0000"  >&lt;p&gt;Well, strange thing is that ADDING new dependency causes&#160;NoClassDefFoundError on something that worked perfectly fine before that addition.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I am using latest Spring Boot 2.3.4.RELEASE with Java 11 and Spring Cloud&#160;Hoxton.RELEASE&lt;/p&gt;

&lt;p&gt;I&apos;ve checked befor submitting bug, that all log4j dependecies are 2.13.3 version.&lt;/p&gt;

&lt;p&gt;My current dependency list is as follows (this is directly from jar file):&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;HdrHistogram-2.1.12.jar
JavaEWAH-1.1.6.jar
LatencyUtils-2.0.3.jar
bcpkix-jdk15on-1.60.jar
bcprov-jdk15on-1.60.jar
commons-codec-1.14.jar
commons-logging-1.2.jar
httpclient-4.5.12.jar
httpcore-4.4.13.jar
jackson-annotations-2.11.2.jar
jackson-core-2.11.2.jar
jackson-databind-2.11.2.jar
jackson-dataformat-yaml-2.11.2.jar
jackson-datatype-jdk8-2.11.2.jar
jackson-datatype-jsr310-2.11.2.jar
jackson-module-parameter-names-2.11.2.jar
jakarta.annotation-api-1.3.5.jar
jakarta.el-3.0.3.jar
jsch-0.1.54.jar
jul-to-slf4j-1.7.30.jar
jzlib-1.1.1.jar
log4j-api-2.13.3.jar
log4j-core-2.13.3.jar
log4j-docker-2.13.3.jar
log4j-jul-2.13.3.jar
log4j-slf4j-impl-2.13.3.jar
log4j-spring-cloud-config-client-2.13.3.jar
micrometer-core-1.5.5.jar
org.eclipse.jgit-5.1.3.201810200350-r.jar
org.eclipse.jgit.http.apache-5.1.3.201810200350-r.jar
slf4j-api-1.7.30.jar
snakeyaml-1.26.jar
spring-aop-5.2.9.RELEASE.jar
spring-beans-5.2.9.RELEASE.jar
spring-boot-2.3.4.RELEASE.jar
spring-boot-actuator-2.3.4.RELEASE.jar
spring-boot-actuator-autoconfigure-2.3.4.RELEASE.jar
spring-boot-autoconfigure-2.3.4.RELEASE.jar
spring-boot-configuration-processor-2.3.4.RELEASE.jar
spring-boot-starter-2.3.4.RELEASE.jar
spring-boot-starter-actuator-2.3.4.RELEASE.jar
spring-boot-starter-json-2.3.4.RELEASE.jar
spring-boot-starter-log4j2-2.3.4.RELEASE.jar
spring-boot-starter-tomcat-2.3.4.RELEASE.jar
spring-boot-starter-web-2.3.4.RELEASE.jar
spring-cloud-commons-2.2.0.RELEASE.jar
spring-cloud-config-client-2.2.0.RELEASE.jar
spring-cloud-config-server-2.2.0.RELEASE.jar
spring-cloud-context-2.2.0.RELEASE.jar
spring-context-5.2.9.RELEASE.jar
spring-context-support-5.2.9.RELEASE.jar
spring-core-5.2.9.RELEASE.jar
spring-expression-5.2.9.RELEASE.jar
spring-jcl-5.2.9.RELEASE.jar
spring-security-crypto-5.3.4.RELEASE.jar
spring-security-rsa-1.0.7.RELEASE.jar
spring-web-5.2.9.RELEASE.jar
spring-webmvc-5.2.9.RELEASE.jar
tomcat-embed-core-9.0.38.jar
tomcat-embed-websocket-9.0.38.jar&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17292601" author="ralph.goers@dslextreme.com" created="Mon, 1 Mar 2021 04:16:19 +0000"  >&lt;p&gt;I have a Spring Boot app and adding the DynamicThresholdFilter to its logging configuration doesn&apos;t cause any problems. I am using Log4j 2.14.0. I&apos;ve pasted my spring, tomcat, and log4j jars for this app.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-rw-r--r--  1 rgoers  staff   206630 Nov  7 12:34 log4j-1.2-api-2.14.0.jar
-rw-r--r--  1 rgoers  staff   301417 Nov  7 12:20 log4j-api-2.14.0.jar
-rw-r--r--  1 rgoers  staff    84080 Jun 10  2018 log4j-audit-api-1.0.0.jar
-rw-r--r--  1 rgoers  staff    55216 Jun 10  2018 log4j-catalog-api-1.0.0.jar
-rw-r--r--  1 rgoers  staff  1762733 Nov  7 12:20 log4j-core-2.14.0.jar
-rw-r--r--  1 rgoers  staff    12691 Nov  7 12:36 log4j-jcl-2.14.0.jar
-rw-r--r--  1 rgoers  staff    23872 Nov  7 12:35 log4j-slf4j-impl-2.14.0.jar
-rw-r--r--  1 rgoers  staff    21087 Nov  7 12:40 log4j-spring-boot-2.14.0.jar
-rw-r--r--  1 rgoers  staff    15156 Nov  7 12:40 log4j-spring-cloud-config-client-2.14.0.jar
-rw-r--r--  1 rgoers  staff    33460 Nov  7 12:36 log4j-web-2.14.0.jar
-rw-r--r--  1 rgoers  staff   148661 Jan 15  2020 spring-amqp-2.2.3.RELEASE.jar
-rw-r--r--  1 rgoers  staff   372753 Sep 15 08:22 spring-aop-5.2.9.RELEASE.jar
-rw-r--r--  1 rgoers  staff   688380 Sep 15 08:22 spring-beans-5.2.9.RELEASE.jar
-rw-r--r--  1 rgoers  staff  1122195 Sep 17 12:53 spring-boot-2.3.4.RELEASE.jar
-rw-r--r--  1 rgoers  staff   592609 Sep 17 12:52 spring-boot-actuator-2.3.4.RELEASE.jar
-rw-r--r--  1 rgoers  staff   515510 Sep 17 12:52 spring-boot-actuator-autoconfigure-2.3.4.RELEASE.jar
-rw-r--r--  1 rgoers  staff  1476367 Sep 17 12:52 spring-boot-autoconfigure-2.3.4.RELEASE.jar
-rw-r--r--  1 rgoers  staff     4763 Sep 17 12:52 spring-boot-starter-2.3.4.RELEASE.jar
-rw-r--r--  1 rgoers  staff     4802 Sep 17 12:52 spring-boot-starter-actuator-2.3.4.RELEASE.jar
-rw-r--r--  1 rgoers  staff     4746 Sep 17 12:52 spring-boot-starter-amqp-2.3.4.RELEASE.jar
-rw-r--r--  1 rgoers  staff     4741 Sep 17 12:52 spring-boot-starter-json-2.3.4.RELEASE.jar
-rw-r--r--  1 rgoers  staff     4790 Sep 17 12:52 spring-boot-starter-tomcat-2.3.4.RELEASE.jar
-rw-r--r--  1 rgoers  staff     4758 Sep 17 12:52 spring-boot-starter-validation-2.3.4.RELEASE.jar
-rw-r--r--  1 rgoers  staff     4798 Sep 17 12:52 spring-boot-starter-web-2.3.4.RELEASE.jar
-rw-r--r--  1 rgoers  staff    47629 Jul 31  2020 spring-cloud-bus-2.2.3.RELEASE.jar
-rw-r--r--  1 rgoers  staff   227430 Nov  9 09:25 spring-cloud-commons-2.2.6.RELEASE.jar
-rw-r--r--  1 rgoers  staff    43965 Nov  9 10:10 spring-cloud-config-client-2.2.6.RELEASE.jar
-rw-r--r--  1 rgoers  staff   127578 Nov  9 09:24 spring-cloud-context-2.2.6.RELEASE.jar
-rw-r--r--  1 rgoers  staff   129355 Nov  6 11:25 spring-cloud-function-context-3.0.11.RELEASE.jar
-rw-r--r--  1 rgoers  staff    15914 Nov  6 11:25 spring-cloud-function-core-3.0.11.RELEASE.jar
-rw-r--r--  1 rgoers  staff     2737 Nov  9 09:25 spring-cloud-starter-2.2.6.RELEASE.jar
-rw-r--r--  1 rgoers  staff     2686 Nov  9 10:13 spring-cloud-starter-config-2.2.6.RELEASE.jar
-rw-r--r--  1 rgoers  staff   296038 Nov  6 13:30 spring-cloud-stream-3.0.9.RELEASE.jar
-rw-r--r--  1 rgoers  staff    39435 Nov  6 13:38 spring-cloud-stream-binder-rabbit-3.0.9.RELEASE.jar
-rw-r--r--  1 rgoers  staff    34416 Nov  6 13:38 spring-cloud-stream-binder-rabbit-core-3.0.9.RELEASE.jar
-rw-r--r--  1 rgoers  staff  1229356 Sep 15 08:22 spring-context-5.2.9.RELEASE.jar
-rw-r--r--  1 rgoers  staff   182943 Sep 15 08:22 spring-context-support-5.2.9.RELEASE.jar
-rw-r--r--  1 rgoers  staff  1442482 Feb  1  1980 spring-core-5.2.9.RELEASE.jar
-rw-r--r--  1 rgoers  staff  1212127 Sep 16 11:49 spring-data-commons-2.3.4.RELEASE.jar
-rw-r--r--  1 rgoers  staff   282217 Sep 15 08:22 spring-expression-5.2.9.RELEASE.jar
-rw-r--r--  1 rgoers  staff   143501 Jul 22  2020 spring-integration-amqp-5.3.2.RELEASE.jar
-rw-r--r--  1 rgoers  staff  1577351 Jul 22  2020 spring-integration-core-5.3.2.RELEASE.jar
-rw-r--r--  1 rgoers  staff    71029 Jul 22  2020 spring-integration-jmx-5.3.2.RELEASE.jar
-rw-r--r--  1 rgoers  staff    23962 Sep 15 08:22 spring-jcl-5.2.9.RELEASE.jar
-rw-r--r--  1 rgoers  staff   549164 Sep 15 08:22 spring-messaging-5.2.9.RELEASE.jar
-rw-r--r--  1 rgoers  staff    19896 Mar  5  2015 spring-plugin-core-1.2.0.RELEASE.jar
-rw-r--r--  1 rgoers  staff     5145 Mar  5  2015 spring-plugin-metadata-1.2.0.RELEASE.jar
-rw-r--r--  1 rgoers  staff   512594 Sep 16 14:00 spring-rabbit-2.2.11.RELEASE.jar
-rw-r--r--  1 rgoers  staff   129403 Dec  9  2019 spring-retry-1.2.5.RELEASE.jar
-rw-r--r--  1 rgoers  staff    80061 Aug  5  2020 spring-security-crypto-5.3.4.RELEASE.jar
-rw-r--r--  1 rgoers  staff    19910 Dec  9  2019 spring-security-rsa-1.0.9.RELEASE.jar
-rw-r--r--  1 rgoers  staff   314820 Sep 15 08:22 spring-tx-5.2.9.RELEASE.jar
-rw-r--r--  1 rgoers  staff  1441860 Sep 15 08:22 spring-web-5.2.9.RELEASE.jar
-rw-r--r--  1 rgoers  staff   956593 Sep 15 08:23 spring-webmvc-5.2.9.RELEASE.jar
-rw-r--r--  1 rgoers  staff  3401538 Sep 10 09:05 tomcat-embed-core-9.0.38.jar
-rw-r--r--  1 rgoers  staff   270124 Sep 10 09:05 tomcat-embed-websocket-9.0.38.jar&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17524822" author="ralph.goers@dslextreme.com" created="Wed, 20 Apr 2022 09:16:37 +0000"  >&lt;p&gt;I am now seeing this same error in one of my apps but prior to the exception I see this&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 java.lang.ExceptionInInitializerError
&#160; &#160; at org.apache.logging.log4j.core.impl.ThreadContextDataInjector$ForDefaultThreadContextMap.rawContextData(ThreadContextDataInjector.java:171)
&#160; &#160; at org.apache.logging.log4j.core.filter.ThreadContextMapFilter.currentContextData(ThreadContextMapFilter.java:120)
&#160; &#160; at org.apache.logging.log4j.core.filter.ThreadContextMapFilter.filter(ThreadContextMapFilter.java:114)
&#160; &#160; at org.apache.logging.log4j.core.filter.ThreadContextMapFilter.filter(ThreadContextMapFilter.java:89)
&#160; &#160; at org.apache.logging.log4j.core.filter.CompositeFilter.filter(CompositeFilter.java:543)
&#160; &#160; at org.apache.logging.log4j.core.Logger$PrivateConfig.filter(Logger.java:609)
&#160; &#160; at org.apache.logging.log4j.core.Logger.isEnabled(Logger.java:258)
&#160; &#160; at org.apache.logging.log4j.spi.AbstractLogger.isEnabled(AbstractLogger.java:1513)
&#160; &#160; at org.apache.commons.logging.LogAdapter$Log4jLog.isDebugEnabled(LogAdapter.java:190)
&#160; &#160; at org.springframework.core.env.SystemEnvironmentPropertySource.getProperty(SystemEnvironmentPropertySource.java:94)
&#160; &#160; at org.springframework.boot.env.SystemEnvironmentPropertySourceEnvironmentPostProcessor$OriginAwareSystemEnvironmentPropertySource.getProperty(SystemEnvironmentPropertySourceEnvironmentPostProcessor.java:107)
&#160; &#160; at org.springframework.boot.context.properties.source.SpringConfigurationPropertySource.getConfigurationProperty(SpringConfigurationPropertySource.java:84)
&#160; &#160; at org.springframework.boot.context.properties.source.SpringIterableConfigurationPropertySource.getConfigurationProperty(SpringIterableConfigurationPropertySource.java:100)
&#160; &#160; at org.springframework.boot.context.properties.source.ConfigurationPropertySourcesPropertySource.findConfigurationProperty(ConfigurationPropertySourcesPropertySource.java:70)
&#160; &#160; at org.springframework.boot.context.properties.source.ConfigurationPropertySourcesPropertySource.findConfigurationProperty(ConfigurationPropertySourcesPropertySource.java:58)
&#160; &#160; at org.springframework.boot.context.properties.source.ConfigurationPropertySourcesPropertySource.containsProperty(ConfigurationPropertySourcesPropertySource.java:42)
&#160; &#160; at org.springframework.core.env.PropertySourcesPropertyResolver.containsProperty(PropertySourcesPropertyResolver.java:51)
&#160; &#160; at org.springframework.core.env.AbstractEnvironment.containsProperty(AbstractEnvironment.java:588)
&#160; &#160; at org.apache.logging.log4j.spring.boot.SpringPropertySource.containsProperty(SpringPropertySource.java:50)
&#160; &#160; at org.apache.logging.log4j.util.PropertiesUtil$Environment.get(PropertiesUtil.java:493)
&#160; &#160; at org.apache.logging.log4j.util.PropertiesUtil$Environment.access$200(PropertiesUtil.java:420)
&#160; &#160; at org.apache.logging.log4j.util.PropertiesUtil.getStringProperty(PropertiesUtil.java:368)
&#160; &#160; at org.apache.logging.log4j.util.PropertiesUtil.getBooleanProperty(PropertiesUtil.java:141)
&#160; &#160; at org.apache.logging.log4j.util.PropertiesUtil.getBooleanProperty(PropertiesUtil.java:130)
&#160; &#160; at org.apache.logging.log4j.core.jmx.Server.isJmxDisabled(Server.java:131)
&#160; &#160; at org.apache.logging.log4j.core.jmx.Server.reregisterMBeansAfterReconfigure(Server.java:136)
&#160; &#160; at org.apache.logging.log4j.core.LoggerContext.setConfiguration(LoggerContext.java:637)
&#160; &#160; at org.apache.logging.log4j.core.LoggerContext.start(LoggerContext.java:302)
&#160; &#160; at org.apache.logging.log4j.spring.boot.Log4j2CloudConfigLoggingSystem.loadConfiguration(Log4j2CloudConfigLoggingSystem.java:124)
&#160; &#160; at org.springframework.boot.logging.log4j2.Log4J2LoggingSystem.loadConfiguration(Log4J2LoggingSystem.java:181)
&#160; &#160; at org.springframework.boot.logging.AbstractLoggingSystem.initializeWithSpecificConfig(AbstractLoggingSystem.java:66)
&#160; &#160; at org.springframework.boot.logging.AbstractLoggingSystem.initialize(AbstractLoggingSystem.java:57)
&#160; &#160; at org.springframework.boot.logging.log4j2.Log4J2LoggingSystem.initialize(Log4J2LoggingSystem.java:163)
&#160; &#160; at org.apache.logging.log4j.spring.boot.Log4j2CloudConfigLoggingSystem.initialize(Log4j2CloudConfigLoggingSystem.java:81)
&#160; &#160; at org.springframework.boot.context.logging.LoggingApplicationListener.initializeSystem(LoggingApplicationListener.java:316)
&#160; &#160; at org.springframework.boot.context.logging.LoggingApplicationListener.initialize(LoggingApplicationListener.java:282)
&#160; &#160; at org.springframework.boot.context.logging.LoggingApplicationListener.onApplicationEnvironmentPreparedEvent(LoggingApplicationListener.java:240)
&#160; &#160; at org.springframework.boot.context.logging.LoggingApplicationListener.onApplicationEvent(LoggingApplicationListener.java:216)
&#160; &#160; at org.springframework.context.event.SimpleApplicationEventMulticaster.doInvokeListener(SimpleApplicationEventMulticaster.java:176)
&#160; &#160; at org.springframework.context.event.SimpleApplicationEventMulticaster.invokeListener(SimpleApplicationEventMulticaster.java:169)
&#160; &#160; at org.springframework.context.event.SimpleApplicationEventMulticaster.multicastEvent(SimpleApplicationEventMulticaster.java:143)
&#160; &#160; at org.springframework.context.event.SimpleApplicationEventMulticaster.multicastEvent(SimpleApplicationEventMulticaster.java:131)
&#160; &#160; at org.springframework.boot.context.event.EventPublishingRunListener.environmentPrepared(EventPublishingRunListener.java:82)
&#160; &#160; at org.springframework.boot.SpringApplicationRunListeners.lambda$environmentPrepared$2(SpringApplicationRunListeners.java:63)
&#160; &#160; at java.base/java.util.ArrayList.forEach(ArrayList.java:1541)
&#160; &#160; at org.springframework.boot.SpringApplicationRunListeners.doWithListeners(SpringApplicationRunListeners.java:117)
&#160; &#160; at org.springframework.boot.SpringApplicationRunListeners.doWithListeners(SpringApplicationRunListeners.java:111)
&#160; &#160; at org.springframework.boot.SpringApplicationRunListeners.environmentPrepared(SpringApplicationRunListeners.java:62)
&#160; &#160; at org.springframework.boot.SpringApplication.prepareEnvironment(SpringApplication.java:375)
&#160; &#160; at org.springframework.boot.SpringApplication.run(SpringApplication.java:333)
&#160; &#160; at org.springframework.boot.builder.SpringApplicationBuilder.run(SpringApplicationBuilder.java:143)
&#160; &#160; at org.springframework.cloud.bootstrap.BootstrapApplicationListener.bootstrapServiceContext(BootstrapApplicationListener.java:197)
&#160; &#160; at org.springframework.cloud.bootstrap.BootstrapApplicationListener.onApplicationEvent(BootstrapApplicationListener.java:114)
&#160; &#160; at org.springframework.cloud.bootstrap.BootstrapApplicationListener.onApplicationEvent(BootstrapApplicationListener.java:77)
&#160; &#160; at org.springframework.context.event.SimpleApplicationEventMulticaster.doInvokeListener(SimpleApplicationEventMulticaster.java:176)
&#160; &#160; at org.springframework.context.event.SimpleApplicationEventMulticaster.invokeListener(SimpleApplicationEventMulticaster.java:169)
&#160; &#160; at org.springframework.context.event.SimpleApplicationEventMulticaster.multicastEvent(SimpleApplicationEventMulticaster.java:143)
&#160; &#160; at org.springframework.context.event.SimpleApplicationEventMulticaster.multicastEvent(SimpleApplicationEventMulticaster.java:131)
&#160; &#160; at org.springframework.boot.context.event.EventPublishingRunListener.environmentPrepared(EventPublishingRunListener.java:82)
&#160; &#160; at org.springframework.boot.SpringApplicationRunListeners.lambda$environmentPrepared$2(SpringApplicationRunListeners.java:63)
&#160; &#160; at java.base/java.util.ArrayList.forEach(ArrayList.java:1541)
&#160; &#160; at org.springframework.boot.SpringApplicationRunListeners.doWithListeners(SpringApplicationRunListeners.java:117)
&#160; &#160; at org.springframework.boot.SpringApplicationRunListeners.doWithListeners(SpringApplicationRunListeners.java:111)
&#160; &#160; at org.springframework.boot.SpringApplicationRunListeners.environmentPrepared(SpringApplicationRunListeners.java:62)
&#160; &#160; at org.springframework.boot.SpringApplication.prepareEnvironment(SpringApplication.java:375)
&#160; &#160; at org.springframework.boot.SpringApplication.run(SpringApplication.java:333)
&#160; &#160; at org.springframework.boot.SpringApplication.run(SpringApplication.java:1365)
&#160; &#160; at org.springframework.boot.SpringApplication.run(SpringApplication.java:1354)
&#160; &#160; at com.nextiva.smsgateway.service.Application.main(Application.java:27)
&#160; &#160; at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
&#160; &#160; at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
&#160; &#160; at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
&#160; &#160; at java.base/java.lang.reflect.Method.invoke(Method.java:566)
&#160; &#160; at org.springframework.boot.loader.MainMethodRunner.run(MainMethodRunner.java:49)
&#160; &#160; at org.springframework.boot.loader.Launcher.launch(Launcher.java:108)
&#160; &#160; at org.springframework.boot.loader.Launcher.launch(Launcher.java:58)
&#160; &#160; at org.springframework.boot.loader.JarLauncher.main(JarLauncher.java:88)
Caused by: java.lang.NullPointerException
&#160; &#160; at org.apache.logging.log4j.core.filter.ThreadContextMapFilter.filter(ThreadContextMapFilter.java:114)
&#160; &#160; at org.apache.logging.log4j.core.filter.ThreadContextMapFilter.filter(ThreadContextMapFilter.java:89)
&#160; &#160; at org.apache.logging.log4j.core.filter.CompositeFilter.filter(CompositeFilter.java:543)
&#160; &#160; at org.apache.logging.log4j.core.Logger$PrivateConfig.filter(Logger.java:609)
&#160; &#160; at org.apache.logging.log4j.core.Logger.isEnabled(Logger.java:258)
&#160; &#160; at org.apache.logging.log4j.spi.AbstractLogger.isEnabled(AbstractLogger.java:1513)
&#160; &#160; at org.apache.commons.logging.LogAdapter$Log4jLog.isDebugEnabled(LogAdapter.java:190)
&#160; &#160; at org.springframework.core.env.SystemEnvironmentPropertySource.getProperty(SystemEnvironmentPropertySource.java:94)
&#160; &#160; at org.springframework.boot.env.SystemEnvironmentPropertySourceEnvironmentPostProcessor$OriginAwareSystemEnvironmentPropertySource.getProperty(SystemEnvironmentPropertySourceEnvironmentPostProcessor.java:107)
&#160; &#160; at org.springframework.core.env.SystemEnvironmentPropertySource.containsProperty(SystemEnvironmentPropertySource.java:83)
&#160; &#160; at org.springframework.boot.env.SystemEnvironmentPropertySourceEnvironmentPostProcessor$OriginAwareSystemEnvironmentPropertySource.containsProperty(SystemEnvironmentPropertySourceEnvironmentPostProcessor.java:102)
&#160; &#160; at org.springframework.core.env.PropertySourcesPropertyResolver.containsProperty(PropertySourcesPropertyResolver.java:51)
&#160; &#160; at org.springframework.core.env.AbstractEnvironment.containsProperty(AbstractEnvironment.java:588)
&#160; &#160; at org.apache.logging.log4j.spring.boot.SpringPropertySource.containsProperty(SpringPropertySource.java:50)
&#160; &#160; at org.apache.logging.log4j.util.PropertiesUtil$Environment.get(PropertiesUtil.java:493)
&#160; &#160; at org.apache.logging.log4j.util.PropertiesUtil$Environment.access$200(PropertiesUtil.java:420)
&#160; &#160; at org.apache.logging.log4j.util.PropertiesUtil.getStringProperty(PropertiesUtil.java:368)
&#160; &#160; at org.apache.logging.log4j.core.impl.ContextDataFactory.&amp;lt;clinit&amp;gt;(ContextDataFactory.java:49)
&#160; &#160; ... 77 more&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It seems that JMX is looking up a property that references Spring and it is trying to log something right after the configuration has been stored. It then tries to initialize ContextDataFactory but once again needs to look up a property and once again that tries to lookup a property. So the end result is that it finally ends up with an uninitialized ContextDataFactory and gets the NPE.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;A workaround to this is to specify&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-Dlog4j2.ContextData=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.logging.log4j.util.SortedArrayStringMap&quot;&lt;/span&gt; &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17532404" author="jira-bot" created="Thu, 5 May 2022 16:27:15 +0000"  >&lt;p&gt;Commit 7b236ceb1628dd5d6758d3f323948365d1c59abb in logging-log4j2&apos;s branch refs/heads/master from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=7b236ceb16&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=7b236ceb16&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2956&quot; title=&quot;Using log4j-spring-cloud-config-client and DynamicThresholdFilter cause Could not initialize class org.apache.logging.log4j.core.impl.ContextDataFactoryException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2956&quot;&gt;&lt;del&gt;LOG4J2-2956&lt;/del&gt;&lt;/a&gt; - Prevent ContextDataFactory error during startup&lt;/p&gt;</comment>
                            <comment id="17532405" author="jira-bot" created="Thu, 5 May 2022 16:27:55 +0000"  >&lt;p&gt;Commit 6bc69ab44faf962a4df7801b802ad67fca35a635 in logging-log4j2&apos;s branch refs/heads/release-2.x from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=6bc69ab44f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=6bc69ab44f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2956&quot; title=&quot;Using log4j-spring-cloud-config-client and DynamicThresholdFilter cause Could not initialize class org.apache.logging.log4j.core.impl.ContextDataFactoryException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2956&quot;&gt;&lt;del&gt;LOG4J2-2956&lt;/del&gt;&lt;/a&gt; - Prevent ContextDataFactory error during startup&lt;/p&gt;</comment>
                            <comment id="17532503" author="ralph.goers@dslextreme.com" created="Thu, 5 May 2022 19:55:31 +0000"  >&lt;p&gt;I&apos;ve committed a fix to both branches. Could you please checkout from release-2.x and see if it fixes the problem for you?&lt;/p&gt;</comment>
                            <comment id="17532505" author="jira-bot" created="Thu, 5 May 2022 19:59:52 +0000"  >&lt;p&gt;Commit 3ae669455565276e962b34ce5fdf7fd3dc7da3c2 in logging-log4j2&apos;s branch refs/heads/master from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=3ae6694555&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=3ae6694555&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2956&quot; title=&quot;Using log4j-spring-cloud-config-client and DynamicThresholdFilter cause Could not initialize class org.apache.logging.log4j.core.impl.ContextDataFactoryException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2956&quot;&gt;&lt;del&gt;LOG4J2-2956&lt;/del&gt;&lt;/a&gt; - Prevent ContextDataFactory error during startup&lt;/p&gt;</comment>
                            <comment id="17534027" author="jira-bot" created="Mon, 9 May 2022 21:30:01 +0000"  >&lt;p&gt;Commit 6bc69ab44faf962a4df7801b802ad67fca35a635 in logging-log4j2&apos;s branch refs/heads/dependabot/maven/org.apache.activemq-activemq-broker-5.17.1 from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=6bc69ab44f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=6bc69ab44f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2956&quot; title=&quot;Using log4j-spring-cloud-config-client and DynamicThresholdFilter cause Could not initialize class org.apache.logging.log4j.core.impl.ContextDataFactoryException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2956&quot;&gt;&lt;del&gt;LOG4J2-2956&lt;/del&gt;&lt;/a&gt; - Prevent ContextDataFactory error during startup&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 27 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0k9aw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>