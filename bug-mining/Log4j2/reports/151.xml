<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:31:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-318] On termination Log4j terminates before the application</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-318</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;My application is multi-threaded, when Ctrl-C is pressed to terminate it, Log4J ShutdownHooks in LoggerContext are called to close the appenders, so I lost any log that the application does during its termination.&lt;br/&gt;
What I think I need, is a way to disable the automatic close done by LoggerContext and a way to call the close by myself.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12658879">LOG4J2-318</key>
            <summary>On termination Log4j terminates before the application</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rgoers">Ralph Goers</assignee>
                                    <reporter username="masar">Maurizio Sartori</reporter>
                        <labels>
                            <label>shutdown</label>
                    </labels>
                <created>Sat, 20 Jul 2013 09:11:54 +0000</created>
                <updated>Tue, 23 Jul 2013 13:36:53 +0000</updated>
                            <resolved>Sat, 20 Jul 2013 23:19:28 +0000</resolved>
                                    <version>2.0-beta8</version>
                                    <fixVersion>2.0-beta9</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13714416" author="masar" created="Sat, 20 Jul 2013 12:50:41 +0000"  >&lt;p&gt;In the test.zip there is a test that shows the problem.&lt;/p&gt;

&lt;p&gt;If you leave the program run till end, the output is:&lt;/p&gt;

&lt;p&gt;OUT: main: start&lt;br/&gt;
INFO	main: start&lt;br/&gt;
OUT: run&lt;br/&gt;
INFO	run&lt;br/&gt;
OUT: run: HELLO 0&lt;br/&gt;
INFO	run: HELLO 0&lt;br/&gt;
OUT: main: ThreadPool 1&lt;br/&gt;
OUT: run: HELLO 1&lt;br/&gt;
INFO	main: ThreadPool 1&lt;br/&gt;
INFO	run: HELLO 1&lt;br/&gt;
OUT: main: ThreadPool 1&lt;br/&gt;
OUT: run: HELLO 2&lt;br/&gt;
INFO	main: ThreadPool 1&lt;br/&gt;
INFO	run: HELLO 2&lt;br/&gt;
OUT: main: ThreadPool 1&lt;br/&gt;
OUT: run: HELLO 3&lt;br/&gt;
INFO	main: ThreadPool 1&lt;br/&gt;
INFO	run: HELLO 3&lt;br/&gt;
OUT: run: HELLO 4&lt;br/&gt;
OUT: main: ThreadPool 1&lt;br/&gt;
INFO	run: HELLO 4&lt;br/&gt;
INFO	main: ThreadPool 1&lt;br/&gt;
OUT: main: ThreadPool 1&lt;br/&gt;
OUT: run: HELLO 5&lt;br/&gt;
INFO	main: ThreadPool 1&lt;br/&gt;
INFO	run: HELLO 5&lt;br/&gt;
OUT: main: ThreadPool 1&lt;br/&gt;
OUT: run: HELLO 6&lt;br/&gt;
INFO	main: ThreadPool 1&lt;br/&gt;
INFO	run: HELLO 6&lt;br/&gt;
OUT: main: ThreadPool 1&lt;br/&gt;
OUT: run: HELLO 7&lt;br/&gt;
INFO	main: ThreadPool 1&lt;br/&gt;
INFO	run: HELLO 7&lt;br/&gt;
OUT: run: HELLO 8&lt;br/&gt;
OUT: main: ThreadPool 1&lt;br/&gt;
INFO	run: HELLO 8&lt;br/&gt;
INFO	main: ThreadPool 1&lt;br/&gt;
OUT: run: HELLO 9&lt;br/&gt;
OUT: main: ThreadPool 1&lt;br/&gt;
INFO	run: HELLO 9&lt;br/&gt;
INFO	main: ThreadPool 1&lt;br/&gt;
OUT: run: done&lt;br/&gt;
OUT: main: ThreadPool 1&lt;br/&gt;
INFO	run: done&lt;br/&gt;
OUT: run: exit&lt;br/&gt;
INFO	main: ThreadPool 1&lt;br/&gt;
INFO	run: exit&lt;br/&gt;
OUT: main: terminated&lt;br/&gt;
INFO	main: terminated&lt;br/&gt;
OUT: main: exit&lt;br/&gt;
INFO	main: exit&lt;br/&gt;
2013-07-20 14:52:49,609 DEBUG Shutting down OutputStreamManager SYSTEM_OUT&lt;/p&gt;


&lt;p&gt;If you hit CtrlC the output is:&lt;/p&gt;

&lt;p&gt;OUT: main: start&lt;br/&gt;
INFO	main: start&lt;br/&gt;
OUT: run&lt;br/&gt;
INFO	run&lt;br/&gt;
OUT: run: HELLO 0&lt;br/&gt;
INFO	run: HELLO 0&lt;br/&gt;
OUT: run: HELLO 1&lt;br/&gt;
INFO	run: HELLO 1&lt;br/&gt;
OUT: main: ThreadPool 1&lt;br/&gt;
INFO	main: ThreadPool 1&lt;br/&gt;
OUT: run: HELLO 2&lt;br/&gt;
OUT: main: ThreadPool 1&lt;br/&gt;
INFO	run: HELLO 2&lt;br/&gt;
INFO	main: ThreadPool 1&lt;br/&gt;
OUT: run: HELLO 3&lt;br/&gt;
INFO	run: HELLO 3&lt;br/&gt;
OUT: main: ThreadPool 1&lt;br/&gt;
INFO	main: ThreadPool 1&lt;br/&gt;
^C&lt;br/&gt;
2013-07-20 14:51:35,636 DEBUG Shutting down OutputStreamManager SYSTEM_OUT&lt;br/&gt;
OUT: run: HELLO 4&lt;br/&gt;
OUT: main: ThreadPool 1&lt;br/&gt;
OUT: run: HELLO 5&lt;br/&gt;
OUT: main: ThreadPool 1&lt;br/&gt;
OUT: run: HELLO 6&lt;br/&gt;
OUT: main: ThreadPool 1&lt;br/&gt;
OUT: run: HELLO 7&lt;br/&gt;
OUT: main: ThreadPool 1&lt;br/&gt;
OUT: run: HELLO 8&lt;br/&gt;
OUT: main: ThreadPool 1&lt;br/&gt;
OUT: run: HELLO 9&lt;br/&gt;
OUT: main: ThreadPool 1&lt;br/&gt;
OUT: run: done&lt;br/&gt;
OUT: run: exit&lt;br/&gt;
OUT: main: ThreadPool 1&lt;br/&gt;
OUT: main: killed&lt;br/&gt;
OUT: main: exit&lt;/p&gt;

&lt;p&gt;Note that all the last logs are LOST!&lt;/p&gt;</comment>
                            <comment id="13714417" author="garydgregory" created="Sat, 20 Jul 2013 12:55:03 +0000"  >&lt;p&gt;You cannot control the order of JRE shutdown threads, so it seems to me we need to make using a Log4J shutdown thread optional. If you turn it off, you can then shutdown Log4j yourself.&lt;/p&gt;

&lt;p&gt;We could call the option &quot;shutdownHook=true|false&quot;.&lt;/p&gt;</comment>
                            <comment id="13714423" author="remkop@yahoo.com" created="Sat, 20 Jul 2013 13:17:50 +0000"  >&lt;p&gt;Or log4j2.disable.shutdownHook=true (because it&apos;s enabled by default.) I used similar naming for the sys prop that disables JMX instrumentation. &lt;/p&gt;</comment>
                            <comment id="13714429" author="garydgregory" created="Sat, 20 Jul 2013 13:45:50 +0000"  >&lt;p&gt;I do not like having to tweak the command line, everything should be done in the config file, even JMX. Sure, you can have command line gadgets if you like but only to &lt;em&gt;override&lt;/em&gt; the config file.&lt;/p&gt;
</comment>
                            <comment id="13714431" author="remkop@yahoo.com" created="Sat, 20 Jul 2013 13:51:01 +0000"  >&lt;p&gt;I don&apos;t disagree with you. &lt;br/&gt;
If you want to implement this as a config option, could you add an option for disabling JMX? It&apos;d be good to make that consistent. &lt;/p&gt;</comment>
                            <comment id="13714438" author="beamerblvd" created="Sat, 20 Jul 2013 14:39:06 +0000"  >&lt;p&gt;Agreed. I believe we need the following two configuration options. It seems to me that both should be attributes in the &lt;tt&gt;&amp;lt;configuration&amp;gt;&lt;/tt&gt; root element, &lt;em&gt;unless&lt;/em&gt; JMX has other configuration options (in which case it should get its own &lt;tt&gt;&amp;lt;Jmx&amp;gt;&lt;/tt&gt; sub-element).&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;&amp;lt;enableShutdownHook&amp;gt; &amp;lt;=&amp;gt; &amp;lt;quote&amp;gt; [ true | false ] &amp;lt;quote&amp;gt;&lt;/tt&gt; (default true)&lt;br/&gt;
&lt;tt&gt;&amp;lt;enableJmx&amp;gt; &amp;lt;=&amp;gt; &amp;lt;quote&amp;gt; [ true | false ] &amp;lt;quote&amp;gt;&lt;/tt&gt; (default true)&lt;/p&gt;

&lt;p&gt;My $0.02.&lt;/p&gt;</comment>
                            <comment id="13714460" author="garydgregory" created="Sat, 20 Jul 2013 15:43:52 +0000"  >&lt;p&gt;I think we should have a JMX subelement anyway. It is a large grain component and it just feels right to me. I&apos;m sure we&apos;ll want to configure other features at some point.&lt;/p&gt;</comment>
                            <comment id="13714516" author="beamerblvd" created="Sat, 20 Jul 2013 19:08:28 +0000"  >&lt;p&gt;I can agree with that.&lt;/p&gt;</comment>
                            <comment id="13714523" author="ralph.goers@dslextreme.com" created="Sat, 20 Jul 2013 19:36:51 +0000"  >&lt;p&gt;I am adding the configuration to allow disabling the shutdown hook. The JMX configuration should be in a separate Jira issue. I am also adding code to handle an IllegalStateException, which can occur when something tries to create a LoggerContext during JVM shutdown.&lt;/p&gt;

&lt;p&gt;I don&apos;t believe code any more code is needed to call shutdown. The user can currently do&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;org.apache.logging.log4j.core.LoggerContext context = (org.apache.logging.log4j.core.LoggerContext)LogManager.getContext(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
context.stop();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I don&apos;t believe shutdown should be part of the Log4j public API but should be part of the implementation, so the above is correct.&lt;/p&gt;</comment>
                            <comment id="13714571" author="ralph.goers@dslextreme.com" created="Sat, 20 Jul 2013 23:19:28 +0000"  >&lt;p&gt;Added &quot;shutdownHook&quot; attribute to the configuration element. If set to &quot;disable&quot; then no shutdown hook will be registered. If this doesn&apos;t meet your needs please let us know.&lt;/p&gt;</comment>
                            <comment id="13716387" author="masar" created="Tue, 23 Jul 2013 13:36:53 +0000"  >&lt;p&gt;I tested the beta9-SNAPSHOT with the shutdownHook, it works as expected.&lt;br/&gt;
Thanks.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12593336" name="test.zip" size="749328" author="masar" created="Sat, 20 Jul 2013 12:50:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>339072</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 18 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1mhe7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>339392</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>