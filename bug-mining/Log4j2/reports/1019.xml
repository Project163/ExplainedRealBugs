<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:38:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-1589] Value nesting during property substitution</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-1589</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;There is already a good description what &quot;default value nesting&quot; is: &lt;a href=&quot;http://logback.qos.ch/manual/configuration.html#nestedSubst&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://logback.qos.ch/manual/configuration.html#nestedSubst&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It is partially implemented in the log4j but it can still be improved.&lt;/p&gt;

&lt;p&gt;The problem appears if your default value is a variable too.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Example:&lt;/b&gt; We have a glassfish project. Our log files must be placed to the &amp;lt;some_log_root&amp;gt;/application/logfiles directory on the server and if we work locally somewhere on our computer in the glassfish root &amp;lt;glassfish_root&amp;gt;/application/logfiles.&lt;/p&gt;

&lt;p&gt;The &amp;lt;some_log_root&amp;gt; and &amp;lt;glassfish_root&amp;gt; will be set as a java system variables:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&amp;lt;some_log_root&amp;gt;: -Dpath.configured.by.provisioning=/some/path/onserver/&lt;/li&gt;
	&lt;li&gt;&amp;lt;glassfish_root&amp;gt;: -Dcom.sun.aas.instanceRoot=/glassfishroot/application/logfiles&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;At the moment we must have two log4j2.xml config files with different paths and it&apos;s not so great. So the target is to have only one config files that can handle thwo different paths.&lt;/p&gt;

&lt;p&gt;For example:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;...
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Properties&amp;gt;&lt;/span&gt;
       
   &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;path&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;${sys:path.configured.by.provisioning:-${sys:com.sun.aas.instanceRoot}}/application/logfiles/application/logfiles&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Property&amp;gt;&lt;/span&gt;
       
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Properties&amp;gt;&lt;/span&gt;
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If we deploy to the server and the value of path.configured.by.provisioning is the directory named &apos;master&apos; the substitution result of StrSubstitutor is &apos;master}&apos; then. But it works if we set this property as default value!:&lt;/p&gt;

&lt;p&gt;${sys:com.sun.aas.instanceRoot:-${sys:path.configured.by.provisioning}}&lt;/p&gt;

&lt;p&gt;So the default value will be properly substituted, but not the first property. The value of the first property is always: &amp;lt;dirname&amp;gt;}&lt;/p&gt;</description>
                <environment></environment>
        <key id="13005449">LOG4J2-1589</key>
            <summary>Value nesting during property substitution</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="dimarzio">Dmitriy Neretin</reporter>
                        <labels>
                            <label>StrSubstitutor</label>
                            <label>defaultVariable</label>
                    </labels>
                <created>Fri, 16 Sep 2016 13:55:58 +0000</created>
                <updated>Tue, 17 Jan 2017 20:53:54 +0000</updated>
                            <resolved>Mon, 16 Jan 2017 15:00:56 +0000</resolved>
                                    <version>2.5</version>
                    <version>2.7</version>
                                    <fixVersion>2.8</fixVersion>
                                    <component>Configurators</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15707880" author="garydgregory" created="Wed, 30 Nov 2016 07:54:45 +0000"  >&lt;p&gt;Are you willing to provide a patch?&lt;/p&gt;</comment>
                            <comment id="15708859" author="dimarzio" created="Wed, 30 Nov 2016 15:20:36 +0000"  >&lt;p&gt;Yes I&apos;ll do it &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15719531" author="remkop@yahoo.com" created="Sun, 4 Dec 2016 07:58:23 +0000"  >&lt;p&gt;Looking at the code for StrSubstitutor, it already has this field &lt;tt&gt;enableSubstitutionInVariables&lt;/tt&gt;. This is off by default. Can you experiment with switching this on and see if it works as expected? We would also need to be careful that switching this on would not cause any regression issues.&lt;/p&gt;</comment>
                            <comment id="15720670" author="ralphgoers" created="Sun, 4 Dec 2016 21:56:10 +0000"  >&lt;p&gt;I don&apos;t believe that property works the same way. As I recall, if the result of the substitution contains a ${..} then that will recursively be interpolated. It seems that here he wants the default value to also be a property. I don&apos;t believe that is currently supported.&lt;/p&gt;</comment>
                            <comment id="15823881" author="dimarzio" created="Mon, 16 Jan 2017 12:31:09 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=remkop%40yahoo.com&quot; class=&quot;user-hover&quot; rel=&quot;remkop@yahoo.com&quot;&gt;remkop@yahoo.com&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garydgregory&quot; class=&quot;user-hover&quot; rel=&quot;garydgregory&quot;&gt;garydgregory&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;v experimented with a source code for a while to understand how it actually works at all and the substitute algorithm in the StrSubstitutor is not the simplest &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; What I found out is - it&apos;s not a missing feature. It&apos;s only a bug. I will provide detailed description later (what was a problem and how to fix it). The problem is in the StrSubstitutor. If I activate the &apos;enableSubstitutionInVariables&apos; field it solves the problem. But there are some points I not understand:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Why is it always deactivated? With deactivated I mean &apos;false&apos;. The setter method is not used. So the value will be never changed.&lt;/li&gt;
	&lt;li&gt;I didn&apos;t see the possibility to activate this field by configuration, so I changed it directly in the code, installed it in the local maven repo and worked with local framework version&lt;/li&gt;
	&lt;li&gt;I have fear, if I activate the field it can produce some regression issues... And I don&apos;t understand the framework good enough to prevent it &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;My personal proposal: we left the field as is (false) but additionally check the property if the default property value is also a variable: &quot;:-${&quot; and only then we set it to true. After substitution we set it to false again. If you think it is a reasonable solution (or maybe you have a better solution) I could provide a patch.&lt;/p&gt;</comment>
                            <comment id="15824118" author="ralph.goers@dslextreme.com" created="Mon, 16 Jan 2017 15:00:56 +0000"  >&lt;p&gt;This should be addressed by the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1243&quot; title=&quot;Faulty placeholder substitution in config xml&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1243&quot;&gt;&lt;del&gt;LOG4J2-1243&lt;/del&gt;&lt;/a&gt;. Please verify and close.&lt;/p&gt;</comment>
                            <comment id="15824207" author="dimarzio" created="Mon, 16 Jan 2017 16:08:43 +0000"  >&lt;p&gt;Closed as duplicate.&lt;/p&gt;</comment>
                            <comment id="15825089" author="jira-bot" created="Tue, 17 Jan 2017 05:07:15 +0000"  >&lt;p&gt;Commit 2a49f555a4a00bdc5a95c852716595a27a73f61b in logging-log4j2&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ralph.goers%40dslextreme.com&quot; class=&quot;user-hover&quot; rel=&quot;ralph.goers@dslextreme.com&quot;&gt;ralph.goers@dslextreme.com&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=2a49f55&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=2a49f55&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1589&quot; title=&quot;Value nesting during property substitution&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1589&quot;&gt;&lt;del&gt;LOG4J2-1589&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15826781" author="jira-bot" created="Tue, 17 Jan 2017 20:53:54 +0000"  >&lt;p&gt;Commit 2a49f555a4a00bdc5a95c852716595a27a73f61b in logging-log4j2&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1748&quot; title=&quot;RollingFile appender prevents a stand alone application to terminate for as long as 60 sec&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1748&quot;&gt;&lt;del&gt;LOG4J2-1748&lt;/del&gt;&lt;/a&gt;and1780-remove-ExecutorService-from-LoggerContext from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ralph.goers%40dslextreme.com&quot; class=&quot;user-hover&quot; rel=&quot;ralph.goers@dslextreme.com&quot;&gt;ralph.goers@dslextreme.com&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=2a49f55&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=2a49f55&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1589&quot; title=&quot;Value nesting during property substitution&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1589&quot;&gt;&lt;del&gt;LOG4J2-1589&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12927115">LOG4J2-1243</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 44 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i33psf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>