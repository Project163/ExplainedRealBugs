<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:31:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-310] SMTPAppender does not send mails with error or fatal level without prior info event</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-310</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;When using an SMTPAppender a mail is only delivered on a fatal event if there occured an info event before.&lt;br/&gt;
Prior fatal events are ignored by SMTPAppender - other Appenders log them.&lt;/p&gt;

&lt;p&gt;A more detailed explanation/discussion including an example program can be found at:&lt;br/&gt;
&lt;a href=&quot;http://stackoverflow.com/questions/17657983/log4j2-smtpappender-does-not-send-mails-with-error-or-fatal-level&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/questions/17657983/log4j2-smtpappender-does-not-send-mails-with-error-or-fatal-level&lt;/a&gt;&lt;/p&gt;</description>
                <environment>&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Ubuntu Linux 12.04&lt;/li&gt;
	&lt;li&gt;java version &quot;1.6.0_27&quot;&lt;/li&gt;
	&lt;li&gt;OpenJDK Runtime Environment (IcedTea6 1.12.5) (6b27-1.12.5-0ubuntu0.12.04.1)&lt;/li&gt;
	&lt;li&gt;OpenJDK 64-Bit Server VM (build 20.0-b12, mixed mode)&lt;/li&gt;
&lt;/ul&gt;
</environment>
        <key id="12657934">LOG4J2-310</key>
            <summary>SMTPAppender does not send mails with error or fatal level without prior info event</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rpopma">Remko Popma</assignee>
                                    <reporter username="jwaldmann">Jost Waldmann</reporter>
                        <labels>
                    </labels>
                <created>Tue, 16 Jul 2013 06:45:10 +0000</created>
                <updated>Fri, 30 Aug 2013 09:05:11 +0000</updated>
                            <resolved>Tue, 27 Aug 2013 22:08:41 +0000</resolved>
                                    <version>2.0-beta7</version>
                                    <fixVersion>2.0-beta9</fixVersion>
                                    <component>Appenders</component>
                    <component>Filters</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13736094" author="olemasle" created="Sat, 10 Aug 2013 22:31:45 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I have found exactly the same bug (with Log4j2-beta8).&lt;/p&gt;

&lt;p&gt;I tried to track down the issue, and here is what I found.&lt;/p&gt;

&lt;p&gt;The issue is in org.apache.logging.log4j.core.net.SMTPManager, on lines 138-141:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; LogEvent[] priorEvents = buffer.removeAll();
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (priorEvents == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || priorEvents.length == 0) {
   &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;; &lt;span class=&quot;code-comment&quot;&gt;// nothing to &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt;, another thread already took all events
&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt; The &quot;prior events&quot; are first removed from the buffer. If the error event is the first event, there is nothing in this LogEvent array (no prior event), not even the current event (because events are added to the buffer only if they&apos;re filtered - see line 166 on org.apache.logging.log4j.core.appender.SMTPAppender).&lt;br/&gt;
Then, the condition &lt;tt&gt;(priorEvents == null || priorEvents.length == 0)&lt;/tt&gt; is true, and the mail is not sent.&lt;/p&gt;</comment>
                            <comment id="13738495" author="olemasle" created="Tue, 13 Aug 2013 16:59:23 +0000"  >&lt;p&gt;Hello,&lt;/p&gt;

&lt;p&gt;I&apos;ve attached a very simple patch with unit test, which seems to fix the bug.&lt;/p&gt;

&lt;p&gt;But there was this comment &quot;nothing to do, another thread already took all events&quot; so I&apos;m afraid I missed something... Could you please tell me if I can safely delete this condition?&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="13751258" author="olemasle" created="Tue, 27 Aug 2013 13:40:56 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;Is it possible for a commiter to apply this patch? The SMTPAppender is currently not fully usable because of this bug.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="13751316" author="remkop@yahoo.com" created="Tue, 27 Aug 2013 14:39:26 +0000"  >&lt;p&gt;The three lines you propose to remove were added to fix another problem. &lt;/p&gt;

&lt;p&gt;(committed in revision 1481278 2013/05/11 9:33)&lt;br/&gt;
&quot;check if LogEvents array removed from buffer is empty (may happen in concurrent scenarios) to avoid sending an empty email&quot; &lt;/p&gt;

&lt;p&gt;Just removing those lines would revert back to the old problem.&lt;br/&gt;
Unfortunately I cannot find the JIRA ticket for that issue and I cannot remember what that problem was exactly.&lt;/p&gt;

&lt;p&gt;Sorry this is not a complete answer...&lt;/p&gt;</comment>
                            <comment id="13751355" author="ralph.goers@dslextreme.com" created="Tue, 27 Aug 2013 15:28:11 +0000"  >&lt;p&gt;I searched the mailing lists and don&apos;t really see anything that lines up.  The only thing I see is &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-252&quot; title=&quot;SMTPAppender: send multiple events in one mail&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-252&quot;&gt;LOG4J2-252&lt;/a&gt; was created the day before this change was made. It is possible you made the change in response to that although it doesn&apos;t really address the problem reported there.  In addition, that fix seems wrong as it means that events that should be logged won&apos;t be. Just because another thread has logged an error and published all the buffered events doesn&apos;t mean the current event should be ignored. &lt;/p&gt;</comment>
                            <comment id="13751372" author="olemasle" created="Tue, 27 Aug 2013 15:48:37 +0000"  >&lt;p&gt;I see some concurrency considerations regarding the SMTPAppender in &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-149&quot; title=&quot;SMTPManager buffer access not synchronized; can result in empty emails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-149&quot;&gt;&lt;del&gt;LOG4J2-149&lt;/del&gt;&lt;/a&gt;, but it was months before the addition of those three lines. After the fix to &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-149&quot; title=&quot;SMTPManager buffer access not synchronized; can result in empty emails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-149&quot;&gt;&lt;del&gt;LOG4J2-149&lt;/del&gt;&lt;/a&gt;, it is stated that there is no more empty mails caused by multiple threads, so I cannot understand the issue fixed in May.&lt;/p&gt;</comment>
                            <comment id="13751769" author="remkop@yahoo.com" created="Tue, 27 Aug 2013 21:50:55 +0000"  >&lt;p&gt;Well, you&apos;re both right. I obviously should have documented that change better...&lt;br/&gt;
I guess the best way to move forward is to make the change Olivier is suggesting and if that causes any issue then deal with that separately.&lt;/p&gt;</comment>
                            <comment id="13751780" author="remkop@yahoo.com" created="Tue, 27 Aug 2013 22:08:41 +0000"  >&lt;p&gt;Committed in revision 1518012.&lt;br/&gt;
Please verify and close.&lt;/p&gt;</comment>
                            <comment id="13754508" author="olemasle" created="Fri, 30 Aug 2013 09:01:35 +0000"  >&lt;p&gt;For me, it&apos;s fixed, thanks. But I can not close the issue, as I&apos;m not the reporter.&lt;/p&gt;</comment>
                            <comment id="13754510" author="vektor330" created="Fri, 30 Aug 2013 09:05:11 +0000"  >&lt;p&gt;Guys, is this going into beta9? Any ETA on it? Thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12597767" name="log4j2-310.patch" size="2608" author="olemasle" created="Tue, 13 Aug 2013 16:59:23 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>338128</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 12 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1mbkv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>338449</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>