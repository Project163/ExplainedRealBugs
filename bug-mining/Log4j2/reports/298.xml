<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:32:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-392] Intermittent errors with appenders</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-392</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;I intermittently receive following errors after upgrading to beta 8. EVERYTHING was working well with beta 6:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;1st error (happens most frequently)&lt;br/&gt;
2013-09-05 10:48:37,722 ERROR Attempted to append to non-started appender LogFile&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;2nd error:&lt;br/&gt;
2013-09-05 10:49:38,268 ERROR Attempted to append to non-started appender LogFile&lt;br/&gt;
2013-09-05 10:49:38,268 ERROR Unable to write to stream log/ui-selenium-tests.log for appender LogFile&lt;br/&gt;
2013-09-05 10:49:38,269 ERROR An exception occurred processing Appender LogFile org.apache.logging.log4j.core.appender.AppenderRuntimeException: Error writing to RandomAccessFile log/ui-selenium-tests.log&lt;br/&gt;
	at org.apache.logging.log4j.core.appender.rolling.FastRollingFileManager.flush(FastRollingFileManager.java:108)&lt;br/&gt;
	at org.apache.logging.log4j.core.appender.rolling.FastRollingFileManager.write(FastRollingFileManager.java:89)&lt;br/&gt;
	at org.apache.logging.log4j.core.appender.OutputStreamManager.write(OutputStreamManager.java:129)&lt;br/&gt;
	at org.apache.logging.log4j.core.appender.AbstractOutputStreamAppender.append(AbstractOutputStreamAppender.java:115)&lt;br/&gt;
	at org.apache.logging.log4j.core.appender.FastRollingFileAppender.append(FastRollingFileAppender.java:97)&lt;br/&gt;
	at org.apache.logging.log4j.core.config.AppenderControl.callAppender(AppenderControl.java:102)&lt;br/&gt;
	at org.apache.logging.log4j.core.appender.AsyncAppender$AsyncThread.run(AsyncAppender.java:228)&lt;br/&gt;
Caused by: java.io.IOException: Write error&lt;br/&gt;
	at java.io.RandomAccessFile.writeBytes(Native Method)&lt;br/&gt;
	at java.io.RandomAccessFile.write(Unknown Source)&lt;br/&gt;
	at org.apache.logging.log4j.core.appender.rolling.FastRollingFileManager.flush(FastRollingFileManager.java:105)&lt;br/&gt;
	... 6 more&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment>&lt;p&gt;Windows 7 SP1 64bit&lt;/p&gt;</environment>
        <key id="12667035">LOG4J2-392</key>
            <summary>Intermittent errors with appenders</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rpopma">Remko Popma</assignee>
                                    <reporter username="ilynaf">ilynaf</reporter>
                        <labels>
                    </labels>
                <created>Thu, 5 Sep 2013 04:05:31 +0000</created>
                <updated>Sat, 12 Sep 2020 16:00:14 +0000</updated>
                            <resolved>Sat, 14 Jun 2014 16:44:21 +0000</resolved>
                                    <version>2.0-beta8</version>
                    <version>2.0-beta9</version>
                                    <fixVersion>2.0-rc2</fixVersion>
                    <fixVersion>2.1</fixVersion>
                                    <component>Appenders</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13758774" author="ilynaf" created="Thu, 5 Sep 2013 04:16:40 +0000"  >&lt;p&gt;Also happens with RollingFile appender&lt;/p&gt;</comment>
                            <comment id="13764581" author="ralph.goers@dslextreme.com" created="Wed, 11 Sep 2013 18:11:03 +0000"  >&lt;p&gt;Do you have the rest of the stack trace? Is there another &quot;Caused by&quot; further down?   &lt;/p&gt;</comment>
                            <comment id="13768108" author="ilynaf" created="Mon, 16 Sep 2013 06:47:46 +0000"  >&lt;p&gt;Unfortunately, this is all we have for the stack trace&lt;/p&gt;</comment>
                            <comment id="13779803" author="llogiq" created="Fri, 27 Sep 2013 10:09:55 +0000"  >&lt;p&gt;We appear to have the same problem using beta 9 with async appenders, however not all of our applications exhibit the same problem. &lt;/p&gt;

&lt;p&gt;I will look into the culprits and try to find out what triggers the problem. &lt;/p&gt;

&lt;p&gt;In the meantime, could someone with higher privileges in this issue tracker add 2.0-beta9 to the affected versions?&lt;/p&gt;

&lt;p&gt;Update: The problem appears when using asynchronous loggers. The applications in question exit via thrown exception to the default VM exception handler. No log4j exception handler has been installed. Note that I cannot reproduce the problem using a small test application that only logs once and then throws an exception, so it appears that something else is amiss.&lt;/p&gt;</comment>
                            <comment id="13812390" author="remkop@yahoo.com" created="Sun, 3 Nov 2013 14:54:41 +0000"  >&lt;p&gt;Andre, &lt;br/&gt;
Thanks for looking into this. I added 2.0-beta9 to the affected versions. You mention you are seeing the same problem, is that problem #1 or #2? (Or both?)&lt;/p&gt;

&lt;p&gt;Ilynaf and Andre,&lt;br/&gt;
Does this problem happen with a web application or with a stand-alone java application? (Details on java version, web container version, OS, etc may be useful.)&lt;/p&gt;

&lt;p&gt;Just judging from the error stack trace, it looks as if the appender is trying to write to a file that has been closed.&lt;br/&gt;
Would it be possible for you to provide a small program that reproduces the issue?&lt;/p&gt;</comment>
                            <comment id="13812708" author="ilynaf" created="Mon, 4 Nov 2013 09:37:09 +0000"  >&lt;p&gt;I&apos;ve attached a Java project for reproduction. This issue happens when I run a Java class which extends AbstractTestNGSpringContextTests using TestNG plugin for Eclipse:&lt;/p&gt;

&lt;p&gt;Env:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Eclipse: Kepler 64bit (4.3.1.M20130911-1000)&lt;/li&gt;
	&lt;li&gt;TestNG plugin: 6.8.6.20130914_0724&lt;/li&gt;
	&lt;li&gt;OS: Windows 7 SP1 64 bit&lt;/li&gt;
	&lt;li&gt;JDK: 1.7.0_45 64bit&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;How to reproduce:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Install TestNG plugin into Eclipse&lt;/li&gt;
	&lt;li&gt;Import the attached Java project to Eclipse&lt;/li&gt;
	&lt;li&gt;Run TempTest as TestNG Test (Ctrl + F11)&lt;/li&gt;
	&lt;li&gt;Look for error in Eclipse console&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I hope this will help&lt;/p&gt;</comment>
                            <comment id="13812813" author="llogiq" created="Mon, 4 Nov 2013 13:06:00 +0000"  >&lt;p&gt;Hi again,&lt;/p&gt;

&lt;p&gt;Remko, We are using standalone OpenJDK 1.7.0_25 on Windows 7SP1 64bit, Debian and LUbuntu.&lt;/p&gt;

&lt;p&gt;Another bit of evidence: The executable classes for the programs in question all extend other classes with or without logging. I have not yet found an error with programs where the main class does not extend anything (except the default Object). However, I have not enough specimen to be sufficiently confident (at a p-value of 5%).&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Andre&lt;/p&gt;</comment>
                            <comment id="13832454" author="llogiq" created="Tue, 26 Nov 2013 09:48:54 +0000"  >&lt;p&gt;Hi again. I now think the problem is that the classes in question log &lt;b&gt;a lot&lt;/b&gt; - so much that they overwhelm the appender, creating a huge backlog, which the AsyncLoggerThread is trying to finish. The shutdown hook apparently closes all files, which is the right thing to do - but it would be even better to join the appender thread before doing that.&lt;/p&gt;

&lt;p&gt;I&apos;m attaching a very small intuitive program that exhibits the problematic behavior, just by logging a lot.&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Andre&lt;/p&gt;</comment>
                            <comment id="13833602" author="llogiq" created="Wed, 27 Nov 2013 09:22:49 +0000"  >&lt;p&gt;Btw. this also explains why the problem did not happen in beta6 - AFAIR beta8 was the first version to &quot;fix&quot; a hanging threads issue by making the async logger thread a daemon thread.&lt;/p&gt;

&lt;p&gt;Update: Having looked inside the code, it appears that the shutdown thread should wait for 10 seconds giving the loggers time to finish. I can testify that the VM shutdown is quite immediate, so this does not appear to happen (I just re-checked with a System.err.println(&quot;Done&quot;); at the end, this comes a mere microsecond before the error). &lt;/p&gt;

&lt;p&gt;Unfortunately, I have not yet managed to reproduce the problem under a debugger, so I&apos;m a little stumped on how to progress.&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Andre&lt;/p&gt;</comment>
                            <comment id="13845979" author="remkop@yahoo.com" created="Thu, 12 Dec 2013 01:31:15 +0000"  >&lt;p&gt;Thanks Andre,&lt;br/&gt;
Sorry for the slow response time... I&apos;ve been swamped with $work. I hope to be able to take a look at this and some other issues this weekend.&lt;/p&gt;</comment>
                            <comment id="13846321" author="llogiq" created="Thu, 12 Dec 2013 14:15:55 +0000"  >&lt;p&gt;Hi Remko,&lt;/p&gt;

&lt;p&gt;No need to be sorry. It&apos;s not as if I pay you to work on this &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Maybe I&apos;ll find a few spare minutes until the weekend to btrace the ShutdownThread, to find out why it does not wait, btw. if it gets started at all. Otherwise, good luck.&lt;/p&gt;

&lt;p&gt;Keep up the good work!&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Andre&lt;/p&gt;</comment>
                            <comment id="13849033" author="llogiq" created="Mon, 16 Dec 2013 11:02:47 +0000"  >&lt;p&gt;Hi again,&lt;/p&gt;

&lt;p&gt;I finally managed to debug this thing. Interestingly, the logger in my example is not an org.apache.logging.log4j.core.async.AsyncLogger, as I would have expected, but a plain org.apache.logging.log4j.core.Logger. Despite my configuration having not a single synchronous &amp;lt;logger&amp;gt; or &amp;lt;root&amp;gt; entry, the context isn&apos;t even an AsyncLoggerContext. The reason appears to be that in org.apache.logging.log4j.core.impl.Log4jContextFactory.&amp;lt;init&amp;gt;, in line 44, the resulting LOG4J_CONTEXT_SELECTOR property (which refers to the &quot;Log4jContextSelector&quot; system property) is null, therefore the selector will be instantiated as a ClassLoaderContextSelector, which has absolutely no ties to the async package.&lt;/p&gt;

&lt;p&gt;Now I have two possible recourses:&lt;br/&gt;
1. Ask my colleagues to add static &lt;/p&gt;
{ System.setProperty(&quot;Log4jContextSelector&quot;, &quot;org.apache.logging.log4j.core.async.AsyncLoggerContextSelector&quot;); }
&lt;p&gt; to their classes&lt;br/&gt;
2. Change the ClassLoaderContextSelector to somehow distinguish between synchronous and asynchronous LoggerContexts.&lt;/p&gt;

&lt;p&gt;The first one is only a viable workaround if there are only asynchronous loggers. I am unsure how to implement the second. Maybe someone more competent than me in Log4j2 development could have a look? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Andre&lt;/p&gt;</comment>
                            <comment id="13885182" author="llogiq" created="Wed, 29 Jan 2014 09:50:42 +0000"  >&lt;p&gt;Hi again,&lt;/p&gt;

&lt;p&gt;@Remko: Great to see you working on this. If I can be of any assistance, let me know.&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Andre&lt;/p&gt;</comment>
                            <comment id="13893360" author="remkop@yahoo.com" created="Thu, 6 Feb 2014 13:54:49 +0000"  >&lt;p&gt;I modified &lt;tt&gt;BaseConfiguration.stop()&lt;/tt&gt; to ensure that all loggers and appenders are stopped in this order:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;-&lt;del&gt;AsyncLogger Disruptor thread&lt;/del&gt;- (this is not possible yet until we have a solution for &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-493&quot; title=&quot;Problem with AsyncLogger when web app is deployed/undeployed multiple times&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-493&quot;&gt;&lt;del&gt;LOG4J2-493&lt;/del&gt;&lt;/a&gt;)&lt;/li&gt;
	&lt;li&gt;AsyncLoggerConfig Disruptor thread(s)&lt;/li&gt;
	&lt;li&gt;AsyncAppender(s)&lt;/li&gt;
	&lt;li&gt;other appenders&lt;/li&gt;
	&lt;li&gt;non-async LoggerConfigs&lt;/li&gt;
	&lt;li&gt;root LoggerConfig (if non-async)&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Committed in revision 1565254.&lt;br/&gt;
Please verify and close.&lt;/p&gt;</comment>
                            <comment id="13893486" author="llogiq" created="Thu, 6 Feb 2014 16:09:59 +0000"  >&lt;p&gt;Hi Remko,&lt;/p&gt;

&lt;p&gt;I just built HEAD and tested the AppenderOverwhelmer again. This indeed removes the AppenderRuntimeException. However, running the AppenderOverwhelmer gets out only 3.047 of 10.000 messages to stdout on my machine before exiting with only a number of status debug messages.&lt;/p&gt;

&lt;p&gt;In my very humble opinion, this change makes it worse, not better. Before there was at least an error that implied that messages had not been written out. Now they are silently discarded. Ok, I get it, don&apos;t use async loggers for anything that should be logged under all circumstances, but adding a status error method if logs are being discarded, even better combined with a grace period (perhaps only if there are log messages waiting in the ring buffer) for async loggers would be really helpful.&lt;/p&gt;

&lt;p&gt;Please suggest how you want to go forward. If you like, I can close the bug and open a new one describing the behavior I discussed above.&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Andre&lt;/p&gt;</comment>
                            <comment id="13894024" author="remkop@yahoo.com" created="Fri, 7 Feb 2014 00:20:00 +0000"  >&lt;p&gt;Andre, thanks for checking!&lt;br/&gt;
I think that you have started to run into a different existing issue (&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-520&quot; title=&quot;RollingRandomAccessFile with Async Appender skip logs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-520&quot;&gt;&lt;del&gt;LOG4J2-520&lt;/del&gt;&lt;/a&gt;) now. I&apos;ll start to look at that one next. I hope this issue is fixed now but I&apos;d like ilynaf (who originally reported it) to also confirm the solution works for them before closing this ticket.&lt;/p&gt;

&lt;p&gt;ilynaf, sorry for taking so long to address this issue. Can you also confirm if the problem you were seeing no longer occurs with the latest version of trunk?&lt;/p&gt;</comment>
                            <comment id="13989333" author="remkop@yahoo.com" created="Mon, 5 May 2014 07:34:14 +0000"  >&lt;p&gt;Re-opening as the current fix may result in dropped events in case of slow appenders (&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-520&quot; title=&quot;RollingRandomAccessFile with Async Appender skip logs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-520&quot;&gt;&lt;del&gt;LOG4J2-520&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;</comment>
                            <comment id="13989345" author="remkop@yahoo.com" created="Mon, 5 May 2014 08:04:09 +0000"  >&lt;p&gt;The previous solution cleared the appenders from the logger config too soon.&lt;br/&gt;
The new solution first signals to all AsyncLoggerConfig instances that the application is being stopped. When all AsyncLoggerConfig instances are signalled, and the usage count drops to zero, the shared Disruptor is shut down. (It will process all enqueued events before actually stopping.)&lt;/p&gt;

&lt;p&gt;Only after all enqueued events have been processed are the appenders stopped and cleared from the logger configs.&lt;/p&gt;

&lt;p&gt;Fixed in revision 1592463.&lt;br/&gt;
Please verify and close.&lt;/p&gt;</comment>
                            <comment id="13990441" author="llogiq" created="Tue, 6 May 2014 08:53:33 +0000"  >&lt;p&gt;Sorry for the delay, I&apos;m down with laryngitis. I just re-compiled and re-checked. I can confirm that r1592539 fixes the problem in my environment.&lt;/p&gt;</comment>
                            <comment id="13990484" author="remkop@yahoo.com" created="Tue, 6 May 2014 09:41:53 +0000"  >&lt;p&gt;Great, thanks for the confirmation. Get well soon!&lt;/p&gt;</comment>
                            <comment id="14031610" author="remkop@yahoo.com" created="Sat, 14 Jun 2014 16:06:15 +0000"  >&lt;p&gt;Reopening this issue: When investigating &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-593&quot; title=&quot;INFO: Illegal access: this web application instance has been stopped already.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-593&quot;&gt;&lt;del&gt;LOG4J2-593&lt;/del&gt;&lt;/a&gt; with a configuration containing an &lt;tt&gt;&amp;lt;AsyncLogger&amp;gt;&lt;/tt&gt;, I found that the fix still has problems.&lt;/p&gt;

&lt;p&gt;This is what happens:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2014-06-14 23:45:46,080 TRACE AsyncLoggerConfigHelper not starting &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; disruptor, using existing object. Ref count is 2.
2014-06-14 23:45:46,080 TRACE AbstractConfiguration stopping...
2014-06-14 23:45:46,080 TRACE AsyncLoggerConfigHelper: not shutting down disruptor: ref count is 1.
2014-06-14 23:45:46,081 TRACE AbstractConfiguration stopped 1 AsyncLoggerConfigs.
2014-06-14 23:45:46,081 TRACE AsyncAppender stopping. Queue still has 0 events.
2014-06-14 23:45:46,081 TRACE AsyncAppender.AsyncThread shutting down. Processing remaining 0 queue events.
2014-06-14 23:45:46,081 TRACE AsyncAppender.AsyncThread stopped. Queue has 0 events remaining. Processed 0 and ignored 0 events since shutdown started.
2014-06-14 23:45:46,082 TRACE AsyncAppender stopped. Queue has 0 events.
2014-06-14 23:45:46,082 TRACE AbstractConfiguration stopped 1 AsyncAppenders.
2014-06-14 23:45:46,082 TRACE AbstractConfiguration stopped 3 Appenders.
2014-06-14 23:45:46,082 TRACE AsyncLoggerConfigHelper: shutting down disruptor: ref count is 0.
2014-06-14 23:45:46,083 TRACE AbstractConfiguration stopped 2 Loggers.
2014-06-14 23:45:46,083 DEBUG Unregistering MBean org.apache.logging.log4j2:type=AsyncLoggerContext
...
2014-06-14 23:45:46,084 DEBUG Unregistering MBean org.apache.logging.log4j2:type=AsyncLoggerContext,component=Loggers,name=com.foo.Bar
2014-06-14 23:45:46,084 DEBUG Unregistering MBean org.apache.logging.log4j2:type=AsyncLoggerContext,component=Loggers,name=
...
2014-06-14 23:45:46,086 DEBUG Unregistering MBean org.apache.logging.log4j2:type=AsyncLoggerContext,component=Loggers,name=com.foo.Bar,subtype=RingBuffer
2014-06-14 23:45:46,087 DEBUG Registering MBean org.apache.logging.log4j2:type=AsyncLoggerContext
...
2014-06-14 23:45:46,088 DEBUG Registering MBean org.apache.logging.log4j2:type=AsyncLoggerContext,component=Loggers,name=
2014-06-14 23:45:46,088 DEBUG Registering MBean org.apache.logging.log4j2:type=AsyncLoggerContext,component=Loggers,name=com.foo.Bar
2014-06-14 23:45:46,089 ERROR Could not register mbeans java.lang.NullPointerException
	at org.apache.logging.log4j.core.async.AsyncLoggerConfigHelper.createRingBufferAdmin(AsyncLoggerConfigHelper.java:357)
	at org.apache.logging.log4j.core.async.AsyncLoggerConfig.createRingBufferAdmin(AsyncLoggerConfig.java:146)
	at org.apache.logging.log4j.core.jmx.Server.registerLoggerConfigs(Server.java:328)
	at org.apache.logging.log4j.core.jmx.Server.reregisterMBeansAfterReconfigure(Server.java:158)
	at org.apache.logging.log4j.core.jmx.Server.reregisterMBeansAfterReconfigure(Server.java:119)
	at org.apache.logging.log4j.core.LoggerContext.setConfiguration(LoggerContext.java:362)
	at org.apache.logging.log4j.core.LoggerContext.start(LoggerContext.java:169)
	at org.apache.logging.log4j.core.jmx.LoggerContextAdmin.setConfigText(LoggerContextAdmin.java:183)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;AsyncLoggerConfigHelper currently has a single static Disruptor instance that is shared between multiple AsyncLoggerConfig instances. It keeps track of the reference count to decide when there are no more references and the Disruptor should be shut down.&lt;/p&gt;

&lt;p&gt;The reference count is increased when an AsyncLoggerConfig is started, and decreased when an AsyncLoggerConfig is stopped.&lt;/p&gt;

&lt;p&gt;With the current fix for this issue, &lt;tt&gt;AbstractConfiguration.stop()&lt;/tt&gt; may call &lt;tt&gt;AsyncLoggerConfig.stop()&lt;/tt&gt; multiple times on the same instance, which results in an incorrect reference count, causing the NPE above.&lt;/p&gt;</comment>
                            <comment id="14031620" author="remkop@yahoo.com" created="Sat, 14 Jun 2014 16:44:21 +0000"  >&lt;p&gt;Fixed in revision 1602598.&lt;/p&gt;

&lt;p&gt;The new solution brings back some code from a previous solution that keeps track of the AsyncLoggerConfig instances that have been stopped to prevent the same instance from being stopped more than once.&lt;/p&gt;

&lt;p&gt;At the same time, the new solution still correctly clears the appenders for &lt;em&gt;all&lt;/em&gt; LoggerConfigs, and still does this after all AsyncLoggerConfigs have been stopped.&lt;/p&gt;

&lt;p&gt;I verified that the AppenderOverwhelmer test still works correctly, and also verified that the above NPE (premature Disruptor shutdown) problem no longer occurs.&lt;/p&gt;</comment>
                            <comment id="14031797" author="remkop@yahoo.com" created="Sun, 15 Jun 2014 06:42:49 +0000"  >&lt;p&gt;Additional fix in revision 1602666.&lt;/p&gt;

&lt;p&gt;Similar to stopping, the same care must be taken when &lt;em&gt;starting&lt;/em&gt; LoggerConfigs: avoid starting the same LoggerConfig instance twice as it will mess up the AsyncLoggerConfigHelper ref count.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12721552">LOG4J2-672</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12691054">LOG4J2-511</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13326345">LOG4J2-2919</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="12695466">LOG4J2-539</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310051">
                    <name>Supercedes</name>
                                                                <inwardlinks description="is superceded by">
                                        <issuelink>
            <issuekey id="12737811">LOG4J2-807</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12615810" name="AppenderOverwhelmer.java" size="344" author="llogiq" created="Tue, 26 Nov 2013 09:50:10 +0000"/>
                            <attachment id="12611934" name="Log4J2.zip" size="4379910" author="ilynaf" created="Mon, 4 Nov 2013 09:29:53 +0000"/>
                            <attachment id="12601556" name="log4j2.xml" size="2616" author="ilynaf" created="Thu, 5 Sep 2013 04:09:11 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>346972</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 23 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ntxr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>347272</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>