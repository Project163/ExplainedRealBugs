<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:40:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-2712] log4j2 can&apos;t compress rollover log file</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-2712</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;Hi,&#160;&lt;/p&gt;

&lt;p&gt;&#160; When I used log4j2, I found in below case log4j2 can&apos;t compress my&#160; rotate log file.&lt;/p&gt;

&lt;p&gt;&amp;lt;RollingRandomAccessFile name=&quot;mf-info&quot; fileName=&quot;/var/log/oss_activity0_0.log&quot;&lt;br/&gt;
 filePattern=&quot;/var/log/oss_activity0_%i.log.gz&quot;&amp;gt;&lt;/p&gt;

&lt;p&gt;...&lt;/p&gt;

&lt;p&gt;&amp;lt;Policies&amp;gt;&lt;br/&gt;
&#160; &#160; &amp;lt;TimeBasedRollingPolicy/&amp;gt;&lt;br/&gt;
&#160; &#160; &amp;lt;SizeBasedTriggeringPolicy size=&quot;50 MB&quot;/&amp;gt;&lt;br/&gt;
 &amp;lt;/Policies&amp;gt;&lt;br/&gt;
 &amp;lt;DefaultRolloverStrategy max=&quot;50&quot; min=&quot;1&quot; fileIndex=&quot;min&quot;&amp;gt;&lt;/p&gt;

&lt;p&gt;&amp;lt;/DefaultRolloverStrategy&amp;gt;&lt;/p&gt;

&lt;p&gt;&amp;lt;/RollingRandomAccessFile&amp;gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I found when log file will rename to oss_activity0_1.log when oss_activity0_0.log reach 50MB size, but it will not be compressed to oss_activity0_1.log.gz.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Could you please help check this issue?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13263939">LOG4J2-2712</key>
            <summary>log4j2 can&apos;t compress rollover log file</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="madangle">Frank Fan</reporter>
                        <labels>
                    </labels>
                <created>Wed, 23 Oct 2019 06:49:22 +0000</created>
                <updated>Wed, 18 Dec 2019 06:12:19 +0000</updated>
                            <resolved>Sat, 9 Nov 2019 05:32:39 +0000</resolved>
                                    <version>2.11.0</version>
                                    <fixVersion>2.13.0</fixVersion>
                                    <component>Pattern Converters</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16966408" author="carlos.he" created="Mon, 4 Nov 2019 05:02:30 +0000"  >&lt;p&gt;Hello&#160;&lt;/p&gt;

&lt;p&gt;Could you help to put high priority to fix this issue ? thanks!&lt;/p&gt;

&lt;p&gt;BR&lt;br/&gt;
Carlos&lt;/p&gt;</comment>
                            <comment id="16966416" author="ralph.goers@dslextreme.com" created="Mon, 4 Nov 2019 05:50:02 +0000"  >&lt;p&gt;Please add status=&quot;debug&quot; to your configuration element and then send us the log generated by that when the error occurs. We only need the output from the status log, not what you are logging to the file.&#160;&lt;/p&gt;</comment>
                            <comment id="16966421" author="madangle" created="Mon, 4 Nov 2019 06:29:17 +0000"  >&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12984764/12984764_logwrong.txt&quot; title=&quot;logwrong.txt attached to LOG4J2-2712&quot;&gt;logwrong.txt&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;&#160; &#160;Please check the attachment&lt;/p&gt;</comment>
                            <comment id="16966728" author="ralph.goers@dslextreme.com" created="Mon, 4 Nov 2019 15:07:08 +0000"  >&lt;p&gt;Can you please try with the latest release - 2.12.1. There were a lot of changes post 2.11.0.&lt;/p&gt;</comment>
                            <comment id="16967314" author="madangle" created="Tue, 5 Nov 2019 08:00:04 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;&#160; I have tried with latest release 2.12.1, please see the log.&lt;/p&gt;

&lt;p&gt;oss_trace0_0.log should be rename to oss_trace0_1.log and gz to oss_trace0_1.log.gz, but we only see oss_trace0_1.log.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;RollingRandomAccessFile name=&lt;span class=&quot;code-quote&quot;&gt;&quot;mf-trace&quot;&lt;/span&gt; fileName=&lt;span class=&quot;code-quote&quot;&gt;&quot;/&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/opt/oss/log/common_mediations/oss_trace0_0.log&quot;&lt;/span&gt; filePattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;/&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/opt/oss/log/common_mediations/oss_trace0_%i.log.gz&quot;&lt;/span&gt;&amp;gt; 
  &amp;lt;Filters&amp;gt;
    &amp;lt;ThresholdFilter level=&lt;span class=&quot;code-quote&quot;&gt;&quot;TRACE&quot;&lt;/span&gt; onMatch=&lt;span class=&quot;code-quote&quot;&gt;&quot;NEUTRAL&quot;&lt;/span&gt; onMismatch=&lt;span class=&quot;code-quote&quot;&gt;&quot;DENY&quot;&lt;/span&gt;/&amp;gt;
  &amp;lt;/Filters&amp;gt; 
  &amp;lt;PatternLayout&amp;gt;
    &amp;lt;pattern&amp;gt;%d{yyyy-MM-dd-&lt;span class=&quot;code-quote&quot;&gt;&apos;T&apos;&lt;/span&gt;HH:mm:ss.SSSZ} | $${env:HOSTNAME} | | %-15t | %-5p | %c | %m%n&amp;lt;/pattern&amp;gt;
  &amp;lt;/PatternLayout&amp;gt;
  &amp;lt;Policies&amp;gt;
    &amp;lt;TimeBasedRollingPolicy/&amp;gt;
    &amp;lt;SizeBasedTriggeringPolicy size=&lt;span class=&quot;code-quote&quot;&gt;&quot;200 KB&quot;&lt;/span&gt;/&amp;gt;
  &amp;lt;/Policies&amp;gt;
  &amp;lt;DefaultRolloverStrategy max=&lt;span class=&quot;code-quote&quot;&gt;&quot;50&quot;&lt;/span&gt; min=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; fileIndex=&lt;span class=&quot;code-quote&quot;&gt;&quot;min&quot;&lt;/span&gt;&amp;gt;
  &amp;lt;/DefaultRolloverStrategy&amp;gt;
&amp;lt;/RollingRandomAccessFile&amp;gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12984899/12984899_log_error1.log&quot; title=&quot;log_error1.log attached to LOG4J2-2712&quot;&gt;log_error1.log&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="16967820" author="ralph.goers@dslextreme.com" created="Tue, 5 Nov 2019 19:52:51 +0000"  >&lt;p&gt;I am not sure why it would be the case, but the fact that you are specifying an invalid triggering policy might be causing this.&#160; Please change TimeBasedRollingPolicy to TimeBasedTriggeringPolicy and provide it with the appropriate parameters.&lt;/p&gt;</comment>
                            <comment id="16968037" author="madangle" created="Wed, 6 Nov 2019 02:54:40 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;&#160; I have corrected TimeBasedTriggeringPolicy. In our case, we only need&#160;SizeBasedTriggeringPolicy.&#160; But same result.&lt;/p&gt;

&lt;p&gt;only more need be mentioned, when i changed oss_trace_%i.log.gz, log can be compressed correctly.&lt;/p&gt;

&lt;p&gt;From my test, this issue should be fileName and filePattern matching. For example,&#160; fileName is test0.log, filePattern is test%i.log.gz, log could not be compressed.&#160; You also can test this in your own environment.&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;

&lt;p&gt;Br,&lt;/p&gt;

&lt;p&gt;Frank Fan&lt;/p&gt;</comment>
                            <comment id="16969764" author="carlos.he" created="Fri, 8 Nov 2019 02:30:59 +0000"  >&lt;p&gt;Hello Ralph&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Could you help on answering Frank&apos;s question? We&apos;re waiting for your help , thanks a lot!&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;BR&lt;br/&gt;
Carlos&lt;/p&gt;</comment>
                            <comment id="16969848" author="ralph.goers@dslextreme.com" created="Fri, 8 Nov 2019 05:32:52 +0000"  >&lt;p&gt;I have been able to duplicate the problem and I can see that there are two things that have to occur to cause this problem:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;The filename has to match the file pattern.&lt;/li&gt;
	&lt;li&gt;The min value has to be set to 1.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;What happens here is that the call to getEligibleFiles returns the list of files that are to be evaluated in the rollover. Because the file name matches the file pattern it is included in the list. In my tests if min=&quot;1&quot; was not specified then the compression still happened but the outcome was still not good as the file containing the current logs gets deleted. With min=&quot;1&quot; set it looks like it doesn&apos;t compress the files and it renames the file it is logging to.&#160; Hopefully excluding the target filename from the eligible files list should correct the problem.&lt;/p&gt;</comment>
                            <comment id="16970723" author="jira-bot" created="Sat, 9 Nov 2019 05:09:08 +0000"  >&lt;p&gt;Commit c245c5221c0517e7d5ee5656abacf01b1dc2af78 in logging-log4j2&apos;s branch refs/heads/release-2.x from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=c245c52&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=c245c52&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2712&quot; title=&quot;log4j2 can&amp;#39;t compress rollover log file&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2712&quot;&gt;&lt;del&gt;LOG4J2-2712&lt;/del&gt;&lt;/a&gt; - The rolling file appenders would fail to compress the file after rollover if the file name matched the file pattern&lt;/p&gt;</comment>
                            <comment id="16970724" author="jira-bot" created="Sat, 9 Nov 2019 05:31:46 +0000"  >&lt;p&gt;Commit f5548ccc3db5f4d08afd9c4010d3bee207615705 in logging-log4j2&apos;s branch refs/heads/master from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=f5548cc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=f5548cc&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2712&quot; title=&quot;log4j2 can&amp;#39;t compress rollover log file&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2712&quot;&gt;&lt;del&gt;LOG4J2-2712&lt;/del&gt;&lt;/a&gt; - The rolling file appenders would fail to compress the file after rollover if the file name matched the file pattern&lt;/p&gt;</comment>
                            <comment id="16970726" author="ralph.goers@dslextreme.com" created="Sat, 9 Nov 2019 05:32:39 +0000"  >&lt;p&gt;Fix has been pushed to both the release-2.x and master branches. Please verify and close.&lt;/p&gt;</comment>
                            <comment id="16971277" author="carlos.he" created="Mon, 11 Nov 2019 02:24:10 +0000"  >&lt;p&gt;Hello Ralph&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thanks a lot, and Do you have any estimation on when will such release-2.x be delivered?&lt;/p&gt;

&lt;p&gt;BR&lt;br/&gt;
Carlos&lt;/p&gt;</comment>
                            <comment id="16971307" author="ralph.goers@dslextreme.com" created="Mon, 11 Nov 2019 04:40:30 +0000"  >&lt;p&gt;Nothing firm, although I need a release soon for my own purposes. I would guess near the end of the month.&lt;/p&gt;</comment>
                            <comment id="16976333" author="madangle" created="Mon, 18 Nov 2019 07:47:09 +0000"  >&lt;p&gt;Hi Ralph,&lt;/p&gt;

&lt;p&gt;&#160; Could you please help share the compiled jar files because I failed to build this in my environment?&lt;/p&gt;

&lt;p&gt;Thanks a lot!&lt;/p&gt;

&lt;p&gt;Br,&lt;/p&gt;

&lt;p&gt;Frank Fan&lt;/p&gt;</comment>
                            <comment id="16984083" author="madangle" created="Thu, 28 Nov 2019 02:10:40 +0000"  >&lt;p&gt;Hi Ralph,&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160; Do you know when 2.13.0 could be published?&#160;&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Br,&lt;/p&gt;

&lt;p&gt;Frank Fan&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12984899" name="log_error1.log" size="49926" author="madangle" created="Tue, 5 Nov 2019 07:57:41 +0000"/>
                            <attachment id="12984764" name="logwrong.txt" size="67447" author="madangle" created="Mon, 4 Nov 2019 06:29:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 50 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z07v20:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>