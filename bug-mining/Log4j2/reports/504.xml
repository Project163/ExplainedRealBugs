<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:34:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-1042] Socket and Syslog appenders don&apos;t take timeout into account at startup</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-1042</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;ul&gt;
	&lt;li&gt;Steps to reproduce:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;run this code&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.logging.log4j.LogManager;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.logging.log4j.Logger;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;App
{
	&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Logger _logger = LogManager.getLogger(&lt;span class=&quot;code-quote&quot;&gt;&quot;TestLogger&quot;&lt;/span&gt;);

	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main( &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args )
	{
		_logger.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;some message&quot;&lt;/span&gt;);
		&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Done&quot;&lt;/span&gt;);
	}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;with this config&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.0&quot;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;?&amp;gt;
&amp;lt;Configuration status=&lt;span class=&quot;code-quote&quot;&gt;&quot;WARN&quot;&lt;/span&gt;&amp;gt;
  &amp;lt;Appenders&amp;gt;
    &amp;lt;Syslog name=&lt;span class=&quot;code-quote&quot;&gt;&quot;my-syslog&quot;&lt;/span&gt; host=&lt;span class=&quot;code-quote&quot;&gt;&quot;192.168.12.8&quot;&lt;/span&gt; port=&lt;span class=&quot;code-quote&quot;&gt;&quot;12201&quot;&lt;/span&gt; protocol=&lt;span class=&quot;code-quote&quot;&gt;&quot;TCP&quot;&lt;/span&gt; format=&lt;span class=&quot;code-quote&quot;&gt;&quot;RFC5424&quot;&lt;/span&gt; mdcId=&lt;span class=&quot;code-quote&quot;&gt;&quot;mdc&quot;&lt;/span&gt; includeMDC=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; appName=&lt;span class=&quot;code-quote&quot;&gt;&quot;testGTApp&quot;&lt;/span&gt; newLine=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; connectTimeoutMillis=&lt;span class=&quot;code-quote&quot;&gt;&quot;100&quot;&lt;/span&gt; immediateFail=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; reconnectionDelayMillis=&lt;span class=&quot;code-quote&quot;&gt;&quot;3000&quot;&lt;/span&gt; immediateFlush=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; /&amp;gt;
  &amp;lt;/Appenders&amp;gt;
  &amp;lt;Loggers&amp;gt;
    &amp;lt;Root level=&lt;span class=&quot;code-quote&quot;&gt;&quot;info&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;AppenderRef ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;my-syslog&quot;&lt;/span&gt;/&amp;gt;
    &amp;lt;/Root&amp;gt;
  &amp;lt;/Loggers&amp;gt;
&amp;lt;/Configuration&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;where 192.168.12.8 is a host that actually exist (it can be pinged), but nothing is listening on this port.&lt;br/&gt;
(for some reason I don&apos;t completely understand, the host must &lt;b&gt;not&lt;/b&gt; be localhost; otherwise we correctly get the expected behavior)&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Expected result:
	&lt;ul&gt;
		&lt;li&gt;log4j2 gives up trying to connect to the server after the specified timeout (here: 100ms)&lt;/li&gt;
		&lt;li&gt;the program prints &quot;Done&quot; on the console, and exits&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Actual result: the program doesn&apos;t print anything, and hangs forever.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;A thread dump shows&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; prio=10 tid=0x00007f8eac00a000 nid=0x2ca1 runnable [0x00007f8eb455a000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: RUNNABLE
	at java.net.PlainSocketImpl.socketConnect(Native Method)
	at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:339)
	- locked &amp;lt;0x00000007d94f5e38&amp;gt; (a java.net.SocksSocketImpl)
	at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:200)
	at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:182)
	at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)
	at java.net.Socket.connect(Socket.java:579)
	at java.net.Socket.connect(Socket.java:528)
	at java.net.Socket.&amp;lt;init&amp;gt;(Socket.java:425)
	at java.net.Socket.&amp;lt;init&amp;gt;(Socket.java:208)
	at org.apache.logging.log4j.core.net.TcpSocketManager$TcpSocketManagerFactory.createManager(TcpSocketManager.java:285)
	at org.apache.logging.log4j.core.net.TcpSocketManager$TcpSocketManagerFactory.createManager(TcpSocketManager.java:272)
	at org.apache.logging.log4j.core.appender.AbstractManager.getManager(AbstractManager.java:71)
	at org.apache.logging.log4j.core.appender.OutputStreamManager.getManager(OutputStreamManager.java:60)
	at org.apache.logging.log4j.core.net.TcpSocketManager.getSocketManager(TcpSocketManager.java:114)
	at org.apache.logging.log4j.core.appender.SocketAppender.createSocketManager(SocketAppender.java:173)
	at org.apache.logging.log4j.core.appender.SyslogAppender.createAppender(SyslogAppender.java:145)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
	&lt;li&gt;potential fix:&lt;br/&gt;
With the following patch, I get the expected result, along with a logged &quot;Error writing to TCP:192.168.12.8:12201 socket not available&quot;:&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;diff --git i/log4j-core/src/main/java/org/apache/logging/log4j/core/net/TcpSocketManager.java w/log4j-core/src/main/java/org/apache/logging/log4j/core/net/TcpSocketManager.java
index 9ab9f5f..0ba8d8a 100644
--- i/log4j-core/src/main/java/org/apache/logging/log4j/core/net/TcpSocketManager.java
+++ w/log4j-core/src/main/java/org/apache/logging/log4j/core/net/TcpSocketManager.java
@@ -282,7 +282,8 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;TcpSocketManager &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; AbstractSocketManager {
                 &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
             }
             &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
-                &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Socket socket = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Socket(data.host, data.port);
+               &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Socket socket = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Socket();
+               socket.connect(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; InetSocketAddress(data.host, data.port), data.connectTimeoutMillis);
                 os = socket.getOutputStream();
                 &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TcpSocketManager(name, os, socket, inetAddress, data.host, data.port,
                         data.connectTimeoutMillis, data.delayMillis, data.immediateFail, data.layout);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;Tested on ubuntu 14.04, with java:&lt;/p&gt;

&lt;p&gt;java version &quot;1.7.0_79&quot;&lt;br/&gt;
OpenJDK Runtime Environment (IcedTea 2.5.5) (7u79-2.5.5-0ubuntu0.14.04.2)&lt;br/&gt;
OpenJDK 64-Bit Server VM (build 24.79-b02, mixed mode)&lt;/p&gt;</environment>
        <key id="12835718">LOG4J2-1042</key>
            <summary>Socket and Syslog appenders don&apos;t take timeout into account at startup</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="gturri">Guillaume Turri</reporter>
                        <labels>
                    </labels>
                <created>Fri, 5 Jun 2015 13:48:06 +0000</created>
                <updated>Wed, 10 Jun 2015 06:45:56 +0000</updated>
                            <resolved>Fri, 5 Jun 2015 18:51:34 +0000</resolved>
                                    <version>2.3</version>
                                    <fixVersion>2.4</fixVersion>
                                    <component>Appenders</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14575006" author="garydgregory" created="Fri, 5 Jun 2015 18:51:21 +0000"  >&lt;p&gt;Guillaume, &lt;/p&gt;

&lt;p&gt;Thank you for your report and patch.&lt;/p&gt;

&lt;p&gt;In Git master now, please verify and close this ticket.&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;</comment>
                            <comment id="14575275" author="gturri" created="Fri, 5 Jun 2015 21:40:21 +0000"  >&lt;p&gt;Thanks a lot for replying so quickly!&lt;/p&gt;

&lt;p&gt;I&apos;ll have the time to ensure the issue is fixed, next week.&lt;/p&gt;</comment>
                            <comment id="14578821" author="gturri" created="Tue, 9 Jun 2015 12:34:02 +0000"  >&lt;p&gt;I&apos;m afraid I can&apos;t test master because I fail to compile it:&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Apache Log4j 2 .................................... SUCCESS &lt;span class=&quot;error&quot;&gt;&amp;#91;0.450s&amp;#93;&lt;/span&gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Apache Log4j API .................................. SUCCESS &lt;span class=&quot;error&quot;&gt;&amp;#91;8.145s&amp;#93;&lt;/span&gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Apache Log4j Core ................................. FAILURE &lt;span class=&quot;error&quot;&gt;&amp;#91;0.220s&amp;#93;&lt;/span&gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Apache Log4j 1.x Compatibility API ................ SKIPPED&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; Failed to execute goal on project log4j-core: Could not resolve dependencies for project org.apache.logging.log4j:log4j-core:jar:2.4-SNAPSHOT: Could not find artifact org.apache.logging.log4j:log4j-api:jar:tests:2.4-SNAPSHOT -&amp;gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;Help 1&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;However, I cherry-pick the fix on top of log4j-2.3, and I ensured that I works like this.&lt;/p&gt;</comment>
                            <comment id="14579189" author="garydgregory" created="Tue, 9 Jun 2015 16:38:46 +0000"  >&lt;p&gt;You can try this: &lt;tt&gt;mvn install&lt;/tt&gt;&lt;/p&gt;
</comment>
                            <comment id="14580115" author="gturri" created="Wed, 10 Jun 2015 06:43:54 +0000"  >&lt;p&gt;I compiled successfully. I could ensure the issue is fixed on master.&lt;/p&gt;

&lt;p&gt;Thanks again for handling this ticket so quickly!&lt;/p&gt;</comment>
                            <comment id="14580119" author="garydgregory" created="Wed, 10 Jun 2015 06:45:56 +0000"  >&lt;p&gt;You&apos;re welcome.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 24 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2fok7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>