<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:32:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-471] toString methods that perform logging can deadlock AsyncLogger</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-471</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;The AsyncLogger thread is the only consumer of a Disruptor RingBuffer which contains log events ostensibly produced by a number of other threads.  However, when AsyncLogger generates a log message, it has to call toString() on objects which can potentially also perform logging internally.  This results in a situation when the RingBuffer is nearly full whereby AsyncLogger has pulled an event from the RingBuffer, calls toString() on the associated objects, which call AsyncLogger.log which attempts to publish an event into a full buffer, which will park repeatedly without hope of ever leaving the loop.  Relevant stack trace is:&lt;br/&gt;
&quot;AsyncLogger-1&quot; daemon prio=10 tid=0x00007f7a705a8000 nid=0x3d73 runnable &lt;span class=&quot;error&quot;&gt;&amp;#91;0x00007f7a740d1000&amp;#93;&lt;/span&gt;&lt;br/&gt;
   java.lang.Thread.State: TIMED_WAITING (parking)&lt;br/&gt;
        at sun.misc.Unsafe.park(Native Method)&lt;br/&gt;
        at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:349)&lt;br/&gt;
        at com.lmax.disruptor.MultiProducerSequencer.next(MultiProducerSequencer.java:133)&lt;br/&gt;
        at com.lmax.disruptor.MultiProducerSequencer.next(MultiProducerSequencer.java:102)&lt;br/&gt;
        at com.lmax.disruptor.RingBuffer.publishEvent(RingBuffer.java:391)&lt;br/&gt;
        at com.lmax.disruptor.dsl.Disruptor.publishEvent(Disruptor.java:219)&lt;br/&gt;
        at org.apache.logging.log4j.core.async.AsyncLogger.log(AsyncLogger.java:214)&lt;br/&gt;
        at org.apache.logging.log4j.spi.AbstractLoggerWrapper.log(AbstractLoggerWrapper.java:55)&lt;br/&gt;
        at org.slf4j.impl.SLF4JLogger.debug(SLF4JLogger.java:138)&lt;br/&gt;
        at org.somepackage.SomeException.toString (SomeException.java:32)&lt;br/&gt;
        at java.lang.String.valueOf(String.java:2854)&lt;br/&gt;
        at java.io.PrintWriter.println(PrintWriter.java:754)&lt;br/&gt;
        at java.lang.Throwable$WrappedPrintWriter.println(Throwable.java:763)&lt;br/&gt;
        at java.lang.Throwable.printStackTrace(Throwable.java:654)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;locked &amp;lt;0x00000000cb2f6380&amp;gt; (a java.io.PrintWriter)&lt;br/&gt;
        at java.lang.Throwable.printStackTrace(Throwable.java:720)&lt;br/&gt;
        at org.apache.logging.log4j.core.pattern.ThrowablePatternConverter.formatOption(ThrowablePatternConverter.java:138)&lt;br/&gt;
        at org.apache.logging.log4j.core.pattern.ThrowablePatternConverter.format(ThrowablePatternConverter.java:80)&lt;br/&gt;
        at org.apache.logging.log4j.core.pattern.ExtendedThrowablePatternConverter.format(ExtendedThrowablePatternConverter.java:69)&lt;br/&gt;
        at org.apache.logging.log4j.core.pattern.PatternFormatter.format(PatternFormatter.java:36)&lt;br/&gt;
        at org.apache.logging.log4j.core.layout.PatternLayout.toSerializable(PatternLayout.java:167)&lt;br/&gt;
        at org.apache.logging.log4j.core.layout.PatternLayout.toSerializable(PatternLayout.java:52)&lt;br/&gt;
        at org.apache.logging.log4j.core.layout.AbstractStringLayout.toByteArray(AbstractStringLayout.java:45)&lt;br/&gt;
        at org.apache.logging.log4j.core.appender.AbstractOutputStreamAppender.append(AbstractOutputStreamAppender.java:111)&lt;br/&gt;
        at org.apache.logging.log4j.core.appender.RollingRandomAccessFileAppender.append(RollingRandomAccessFileAppender.java:96)&lt;br/&gt;
        at org.apache.logging.log4j.core.config.AppenderControl.callAppender(AppenderControl.java:99)&lt;br/&gt;
        at org.apache.logging.log4j.core.config.LoggerConfig.callAppenders(LoggerConfig.java:425)&lt;br/&gt;
        at org.apache.logging.log4j.core.config.LoggerConfig.log(LoggerConfig.java:406)&lt;br/&gt;
        at org.apache.logging.log4j.core.Logger$PrivateConfig.logEvent(Logger.java:273)&lt;br/&gt;
        at org.apache.logging.log4j.core.async.AsyncLogger.actualAsyncLog(AsyncLogger.java:230)&lt;br/&gt;
        at org.apache.logging.log4j.core.async.RingBufferLogEvent.execute(RingBufferLogEvent.java:98)&lt;br/&gt;
        at org.apache.logging.log4j.core.async.RingBufferLogEventHandler.onEvent(RingBufferLogEventHandler.java:43)&lt;br/&gt;
        at org.apache.logging.log4j.core.async.RingBufferLogEventHandler.onEvent(RingBufferLogEventHandler.java:28)&lt;br/&gt;
        at com.lmax.disruptor.BatchEventProcessor.run(BatchEventProcessor.java:133)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:724)&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment>&lt;p&gt;Debian Squeeze&lt;br/&gt;
Java 7u25&lt;/p&gt;</environment>
        <key id="12685928">LOG4J2-471</key>
            <summary>toString methods that perform logging can deadlock AsyncLogger</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rpopma">Remko Popma</assignee>
                                    <reporter username="abaldocchi">Anthony Baldocchi</reporter>
                        <labels>
                    </labels>
                <created>Sat, 21 Dec 2013 00:03:48 +0000</created>
                <updated>Sun, 10 Sep 2017 12:54:21 +0000</updated>
                            <resolved>Sat, 4 Jan 2014 09:10:25 +0000</resolved>
                                    <version>2.0-beta9</version>
                                    <fixVersion>2.0-rc1</fixVersion>
                    <fixVersion>2.0</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13855123" author="remkop@yahoo.com" created="Sun, 22 Dec 2013 07:26:22 +0000"  >&lt;p&gt;Anthony, from the stacktrace, I agree with your analysis. I&apos;m still thinking about how to solve this.&lt;br/&gt;
Did you use the default ring buffer size?&lt;/p&gt;

&lt;p&gt;Btw, it looks like this issue can also happen with &lt;tt&gt;AsyncAppender&lt;/tt&gt;. (See demo code below).&lt;br/&gt;
The saving grace with &lt;tt&gt;AsyncAppender&lt;/tt&gt; is that it can be configured to &lt;tt&gt;blocking=&quot;false&quot;&lt;/tt&gt;, which will log to an errorAppender when the queue is full. AsyncLoggers currently don&apos;t have any such mechanism.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; demo.deadlock;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.logging.log4j.LogManager;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.logging.log4j.Logger;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;DeadlockDemo {
    &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; Logger sLog = LogManager.getLogger(DeadlockDemo.class);

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;(Sysout) Before throwing ex...&quot;&lt;/span&gt;);
            sLog.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;(Log) Before throwing ex...&quot;&lt;/span&gt;);
            &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(1000);

            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; LoggingEx();
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception ex) {
            sLog.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Caught a {} problem&quot;&lt;/span&gt;, ex, ex);
            sLog.error(ex, ex);
        }
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;(Sysout) After catching ex&quot;&lt;/span&gt;);
        sLog.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;(Log) After catching ex&quot;&lt;/span&gt;);
        
        &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(1000);
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;(Sysout) After 1 sec...&quot;&lt;/span&gt;); &lt;span class=&quot;code-comment&quot;&gt;// I still see &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;
&lt;/span&gt;        sLog.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;(Log) After 1 sec...&quot;&lt;/span&gt;); &lt;span class=&quot;code-comment&quot;&gt;// causes deadlock on my laptop
&lt;/span&gt;        
        &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(1000);
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;(Sysout) After 2 sec...&quot;&lt;/span&gt;); &lt;span class=&quot;code-comment&quot;&gt;// I don&apos;t see &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; output
&lt;/span&gt;        sLog.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;(Log) After 2 sec...&quot;&lt;/span&gt;);
    }
    
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;LoggingEx &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Exception {
        &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Logger exLog = LogManager.getLogger(LoggingEx.class);
        
        @Override
        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; toString() {
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;(Sysout) Before LoggingEx calling logger.debug 300 times...&quot;&lt;/span&gt;);

            &lt;span class=&quot;code-comment&quot;&gt;// fill up AsyncAppender queue (128 slots)
&lt;/span&gt;            &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; 300; i++) {
                exLog.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;(Log) in LoggingEx.toString() {}...&quot;&lt;/span&gt;, i);
            }
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;(Sysout) After LoggingEx called logger.debug 300 times...&quot;&lt;/span&gt;);
            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(1000);
            } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException e) {
                e.printStackTrace();
            }
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;oops&quot;&lt;/span&gt;;
        }
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;log4j2.xml config:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.0&quot;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;?&amp;gt;
&amp;lt;configuration status=&lt;span class=&quot;code-quote&quot;&gt;&quot;TRACE&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;deadlock-demo&quot;&lt;/span&gt; packages=&quot;&quot;&amp;gt;
  &amp;lt;appenders&amp;gt;
      &amp;lt;Console name=&lt;span class=&quot;code-quote&quot;&gt;&quot;STDOUT&quot;&lt;/span&gt; target=&lt;span class=&quot;code-quote&quot;&gt;&quot;SYSTEM_OUT&quot;&lt;/span&gt;&amp;gt;
        &amp;lt;PatternLayout pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;%m%n&quot;&lt;/span&gt;/&amp;gt;
      &amp;lt;/Console&amp;gt;
    &amp;lt;Async name=&lt;span class=&quot;code-quote&quot;&gt;&quot;Async&quot;&lt;/span&gt; bufferSize=&lt;span class=&quot;code-quote&quot;&gt;&quot;128&quot;&lt;/span&gt; errorRef=&lt;span class=&quot;code-quote&quot;&gt;&quot;STDOUT&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;appenderRef ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;STDOUT&quot;&lt;/span&gt; /&amp;gt;
    &amp;lt;/Async&amp;gt;
  &amp;lt;/appenders&amp;gt;
  &amp;lt;loggers&amp;gt;
    &amp;lt;root level=&lt;span class=&quot;code-quote&quot;&gt;&quot;DEBUG&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;appenderRef ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;Async&quot;&lt;/span&gt; /&amp;gt;
    &amp;lt;/root&amp;gt;
  &amp;lt;/loggers&amp;gt;
&amp;lt;/configuration&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Output:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;(Sysout) Before throwing ex...
(Log) Before throwing ex...
(Sysout) Before LoggingEx calling logger.debug 300 times...
(Log) in LoggingEx.toString() 0...
(Log) in LoggingEx.toString() 1...
(Log) in LoggingEx.toString() 2...
...(omitted)
(Log) in LoggingEx.toString() 169...
(Log) in LoggingEx.toString() 170...
(Sysout) After LoggingEx called logger.debug 300 times...
(Log) in LoggingEx.toString() 171...
(Log) in LoggingEx.toString() 172...
...(omitted)
(Log) in LoggingEx.toString() 298...
(Log) in LoggingEx.toString() 299...
Caught a oops problem
demo.deadlock.DeadlockDemo$LoggingEx
	at demo.deadlock.DeadlockDemo.main(DeadlockDemo.java:32) [bin/:?]
(Sysout) After catching ex
(Sysout) Before LoggingEx calling logger.debug 300 times...
(Sysout) After 1 sec...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;... and the application hangs.&lt;/p&gt;</comment>
                            <comment id="13855135" author="abaldocchi" created="Sun, 22 Dec 2013 09:42:43 +0000"  >&lt;p&gt;Remko, in my current use case, the RingBuffer is configured to a smaller number of entries than the default (variable based on heap size and assuming a near-worst-case referenced object because asynchronous logging can potentially alter the expected lifecycle of objects if the logging thread is running behind; I was hitting OutOfMemoryErrors due to some large objects that couldn&apos;t be garbage collected until logging finished but new large objects could be generated because the thread that issued the log request was not blocked; 262144 large objects overflowed the heap).&lt;/p&gt;

&lt;p&gt;However, I think RingBuffer size only impacts the likelihood of encountering the issue (as the likelihood of hitting a full buffer decreases); as long as the buffer is filling more quickly than it is being emptied (not difficult to do with asynchronous logging), the buffer can reach fullness and, once full, this issue becomes significant.  With a high logging rate, a single rollover event might be all that is needed to reach buffer fullness, no matter how large.&lt;/p&gt;

&lt;p&gt;The workaround I&apos;m currently considering is a filter, akin to the BurstFilter, that makes use of the RingBufferAdmin introduced in 2.0-rc1 to reject logging events when the RingBuffer is full.  I like the idea of the errorAppender you mention for AsyncAppender; I&apos;m going to see if I can add similar fallback functionality as I&apos;d like to avoid dropping logging events entirely if at all possible.  &lt;/p&gt;

&lt;p&gt;An alternative solution I was considering was making use of a ThreadLocal to identify the AsyncLogger thread and then since I could determine if the thread was the AsyncLogger thread and that the RingBuffer was full, skip the publish event step and instead just call config.loggerconfig.log(...), passing the arguments on through.  Patch for this second solution is attached.&lt;/p&gt;</comment>
                            <comment id="13855136" author="abaldocchi" created="Sun, 22 Dec 2013 09:43:50 +0000"  >&lt;p&gt;Attached patch that avoids blocking due to full RingBuffer on the AsyncLogger thread.&lt;/p&gt;</comment>
                            <comment id="13855153" author="remkop@yahoo.com" created="Sun, 22 Dec 2013 11:41:17 +0000"  >&lt;p&gt;Anthony,&lt;br/&gt;
I&apos;ve taken a quick look at the patch you provided. I understand what you are trying to do and it seems a good idea to me.&lt;br/&gt;
Before your patch I was also thinking along lines of dropping events or using a fallback / errorAppender, but this solution seems much simpler. Nice!&lt;/p&gt;

&lt;p&gt;I want to play around with it a bit, and also see if this solution works for AsyncLoggerConfig (the use case where sync and async loggers are mixed, using &lt;tt&gt;AsyncLogger&lt;/tt&gt; or &lt;tt&gt;AsyncRoot&lt;/tt&gt; configuration elements).&lt;/p&gt;</comment>
                            <comment id="13862250" author="remkop@yahoo.com" created="Sat, 4 Jan 2014 09:10:03 +0000"  >&lt;p&gt;Anthony, thanks again for the patch!&lt;br/&gt;
I&apos;ve applied it with some changes, and also applied a variant of the same idea to AsyncLoggerConfig (for mixed sync and async loggers).&lt;/p&gt;

&lt;p&gt;I have not been able to create JUnit tests for the deadlock scenario, but I&apos;ve used the DeadLockDemo class in the &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-471?focusedCommentId=13855123&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13855123&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;comment above&lt;/a&gt; to verify the solution. Without the patch this class reliably deadlocks, with the patch there is no deadlock (both for AsyncLoggers and AsyncLoggerConfig).&lt;/p&gt;

&lt;p&gt;To test &lt;b&gt;AsyncLoggers&lt;/b&gt;, run the above &lt;tt&gt;demo.deadlock.DeadlockDemo&lt;/tt&gt; with system properties&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;-DLog4jContextSelector=org.apache.logging.log4j.core.async.AsyncLoggerContextSelector
-DAsyncLogger.RingBufferSize=128
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and configuration&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.0&quot;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;?&amp;gt;
&amp;lt;configuration status=&lt;span class=&quot;code-quote&quot;&gt;&quot;TRACE&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;deadlock-demo&quot;&lt;/span&gt; packages=&quot;&quot;&amp;gt;
  &amp;lt;appenders&amp;gt;
      &amp;lt;Console name=&lt;span class=&quot;code-quote&quot;&gt;&quot;STDOUT&quot;&lt;/span&gt; target=&lt;span class=&quot;code-quote&quot;&gt;&quot;SYSTEM_OUT&quot;&lt;/span&gt;&amp;gt;
        &amp;lt;PatternLayout pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;%m%n&quot;&lt;/span&gt;/&amp;gt;
      &amp;lt;/Console&amp;gt;
  &amp;lt;/appenders&amp;gt;
  &amp;lt;loggers&amp;gt;
    &amp;lt;root level=&lt;span class=&quot;code-quote&quot;&gt;&quot;DEBUG&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;appenderRef ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;STDOUT&quot;&lt;/span&gt; /&amp;gt;
    &amp;lt;/root&amp;gt;
  &amp;lt;/loggers&amp;gt;
&amp;lt;/configuration&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To test &lt;b&gt;AsyncLoggerConfig&lt;/b&gt; (mixed sync and async loggers), run the above &lt;tt&gt;demo.deadlock.DeadlockDemo&lt;/tt&gt; with system properties&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;-DAsyncLoggerConfig.RingBufferSize=128
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and configuration&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.0&quot;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;?&amp;gt;
&amp;lt;configuration status=&lt;span class=&quot;code-quote&quot;&gt;&quot;TRACE&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;deadlock-demo&quot;&lt;/span&gt; packages=&quot;&quot;&amp;gt;
  &amp;lt;appenders&amp;gt;
      &amp;lt;Console name=&lt;span class=&quot;code-quote&quot;&gt;&quot;STDOUT&quot;&lt;/span&gt; target=&lt;span class=&quot;code-quote&quot;&gt;&quot;SYSTEM_OUT&quot;&lt;/span&gt;&amp;gt;
        &amp;lt;PatternLayout pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;%m%n&quot;&lt;/span&gt;/&amp;gt;
      &amp;lt;/Console&amp;gt;
  &amp;lt;/appenders&amp;gt;
  &amp;lt;loggers&amp;gt;
    &amp;lt;AsyncRoot level=&lt;span class=&quot;code-quote&quot;&gt;&quot;DEBUG&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;appenderRef ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;STDOUT&quot;&lt;/span&gt; /&amp;gt;
    &amp;lt;/AsyncRoot&amp;gt;
  &amp;lt;/loggers&amp;gt;
&amp;lt;/configuration&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Fixed in revision 1555336.&lt;br/&gt;
Please verify and close.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13099798">LOG4J2-2031</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12687348">LOG4J2-485</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12620074" name="LOG4J2-471.patch" size="4504" author="abaldocchi" created="Sun, 22 Dec 2013 09:43:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>364888</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 46 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1qw6n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>365188</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>