<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:36:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-1346] Exception from Log4jServletContextListener prevents jetty-maven-plugin run-forked.</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-1346</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;I tried to integrate jacoco in my maven web project.&lt;br/&gt;
However it always failed with the following logs:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;WARNING&amp;#93;&lt;/span&gt; FAILED o.e.j.m.p.JettyWebAppContext@1d831c2&lt;/p&gt;
{/,file:/D:/works/paypos2/jacoco-spring/src/main/webapp/,UNAVAILABLE}
{file:/D:/works/paypos2/jacoco-spring/src/main/webapp/}
&lt;p&gt;: java.lang.IllegalStateException: C&lt;br/&gt;
ontext destroyed before it was initialized.&lt;br/&gt;
java.lang.IllegalStateException: Context destroyed before it was initialized.&lt;br/&gt;
        at org.apache.logging.log4j.web.Log4jServletContextListener.contextDestroyed(Log4jServletContextListener.java:55)&lt;/p&gt;

&lt;p&gt;I read the code and found Exception throw in org.apache.logging.log4j.web.Log4jServletContextListener.contextDestroyed:&lt;/p&gt;

&lt;p&gt;if (this.servletContext == null || this.initializer == null) &lt;/p&gt;
{
            throw new IllegalStateException(&quot;Context destroyed before it was initialized.&quot;);
        }

&lt;p&gt;This runtime exception fails jetty-maven-plugin web application configuration validation.&lt;/p&gt;

&lt;p&gt;So I have to write my own Listener to work around: (Log4jWebLifeCycle is not public, so I have to use public interface to operate.)&lt;/p&gt;

&lt;p&gt;public void contextDestroyed(final ServletContextEvent event) {&lt;br/&gt;
//    if (this.servletContext == null || this.initializer == null) &lt;/p&gt;
{
//      throw new IllegalStateException(&quot;Context destroyed before it was initialized.&quot;);
//    }
&lt;p&gt;//    LOGGER.debug(&quot;Log4jServletContextListener ensuring that Log4j shuts down properly.&quot;);&lt;/p&gt;

&lt;p&gt;    if (this.initializer != null) {&lt;br/&gt;
      if (this.initializer instanceof Log4jWebSupport) &lt;/p&gt;
{
        ((Log4jWebSupport)this.initializer).clearLoggerContext(); // the application is finished shutting down now
      }
&lt;p&gt;      this.initializer.stop();&lt;br/&gt;
    }&lt;br/&gt;
  }&lt;/p&gt;

&lt;p&gt;I think using a warning log is better than throw an exception in contextDestroyed, because this is shutting down stage.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12955167">LOG4J2-1346</key>
            <summary>Exception from Log4jServletContextListener prevents jetty-maven-plugin run-forked.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="simon_xianyu">Simon Xianyu</reporter>
                        <labels>
                    </labels>
                <created>Fri, 1 Apr 2016 02:01:13 +0000</created>
                <updated>Fri, 1 Apr 2016 02:21:07 +0000</updated>
                            <resolved>Fri, 1 Apr 2016 02:21:07 +0000</resolved>
                                    <version>2.5</version>
                                    <fixVersion>2.6</fixVersion>
                                    <component>Web/Servlet</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15221001" author="garydgregory" created="Fri, 1 Apr 2016 02:17:05 +0000"  >&lt;p&gt;In 2.6, the method will no longer throw an exception. It looks like this now:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void contextDestroyed(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ServletContextEvent event) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.servletContext == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.initializer == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            LOGGER.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Context destroyed before it was initialized.&quot;&lt;/span&gt;);
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
        }
        LOGGER.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Log4jServletContextListener ensuring that Log4j shuts down properly.&quot;&lt;/span&gt;);

        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.initializer.clearLoggerContext(); &lt;span class=&quot;code-comment&quot;&gt;// the application is finished shutting down now
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.initializer.stop();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15221006" author="garydgregory" created="Fri, 1 Apr 2016 02:20:49 +0000"  >&lt;p&gt;Reopening to update title.&lt;/p&gt;</comment>
                            <comment id="15221007" author="garydgregory" created="Fri, 1 Apr 2016 02:21:07 +0000"  >&lt;p&gt;Closing after title update.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 33 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2vhsf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>